<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/asn1</h2>
<ul>
<li><a href="/gostd/encoding/asn1/asn1.go.html">asn1.go</a></li>
<li><a href="/gostd/encoding/asn1/asn1_test.go.html">asn1_test.go</a></li>
<li><a href="/gostd/encoding/asn1/common.go.html">common.go</a></li>
<li><a href="/gostd/encoding/asn1/marshal.go.html" class="current">marshal.go</a></li>
<li><a href="/gostd/encoding/asn1/marshal_test.go.html">marshal_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3973547">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3973602">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3973656">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3973707">package</span>&nbsp;<span class="ident" id="3973715">asn1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3973721">import</span>&nbsp;<span class="op" id="3973728">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3973731">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3973740">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3973750">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3973757">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3973763">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3973775">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3973786">&#34;time&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3973794">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3973809">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3973812">//&nbsp;A&nbsp;forkableWriter&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;buffer&nbsp;that&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3973867">//&nbsp;&#39;forked&#39;&nbsp;to&nbsp;create&nbsp;new&nbsp;forkableWriters&nbsp;that&nbsp;bracket&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="3973926">//&nbsp;original.&nbsp;&nbsp;After</span><br>
<span class="lineno"></span><span class="comment" id="3973946">//&nbsp;&nbsp;&nbsp;&nbsp;pre,&nbsp;post&nbsp;:=&nbsp;w.fork();</span><br>
<span class="lineno"></span><span class="comment" id="3973975">//&nbsp;the&nbsp;overall&nbsp;sequence&nbsp;of&nbsp;bytes&nbsp;represented&nbsp;is&nbsp;logically&nbsp;w+pre+post.</span><br>
<span class="lineno"></span><span class="keyword" id="3974045">type</span>&nbsp;<span class="ident" id="3974050">forkableWriter</span>&nbsp;<span class="keyword" id="3974065">struct</span>&nbsp;<span class="op" id="3974072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3974075">*</span><span class="ident" id="3974076">bytes</span><span class="op" id="3974081">.</span><span class="ident" id="3974082">Buffer</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3974090">pre</span><span class="op" id="3974093">,</span>&nbsp;<span class="ident" id="3974095">post</span>&nbsp;<span class="op" id="3974100">*</span><span class="ident" id="3974101">forkableWriter</span><br>
<span class="lineno"></span><span class="op" id="3974116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3974119">func</span>&nbsp;<span class="ident" id="3974124">newForkableWriter</span><span class="op" id="3974141">(</span><span class="op" id="3974142">)</span>&nbsp;<span class="op" id="3974144">*</span><span class="ident" id="3974145">forkableWriter</span>&nbsp;<span class="op" id="3974160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3974163">return</span>&nbsp;<span class="op" id="3974170">&amp;</span><span class="ident" id="3974171">forkableWriter</span><span class="op" id="3974185">{</span><span class="builtinfunc" id="3974186">new</span><span class="op" id="3974189">(</span><span class="ident" id="3974190">bytes</span><span class="op" id="3974195">.</span><span class="ident" id="3974196">Buffer</span><span class="op" id="3974202">)</span><span class="op" id="3974203">,</span>&nbsp;<span class="ident" id="3974205">nil</span><span class="op" id="3974208">,</span>&nbsp;<span class="ident" id="3974210">nil</span><span class="op" id="3974213">}</span><br>
<span class="lineno">30</span><span class="op" id="3974215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3974218">func</span>&nbsp;<span class="op" id="3974223">(</span><span class="ident" id="3974224">f</span>&nbsp;<span class="op" id="3974226">*</span><span class="ident" id="3974227">forkableWriter</span><span class="op" id="3974241">)</span>&nbsp;<span class="ident" id="3974243">fork</span><span class="op" id="3974247">(</span><span class="op" id="3974248">)</span>&nbsp;<span class="op" id="3974250">(</span><span class="ident" id="3974251">pre</span><span class="op" id="3974254">,</span>&nbsp;<span class="ident" id="3974256">post</span>&nbsp;<span class="op" id="3974261">*</span><span class="ident" id="3974262">forkableWriter</span><span class="op" id="3974276">)</span>&nbsp;<span class="op" id="3974278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3974281">if</span>&nbsp;<span class="ident" id="3974284">f</span><span class="op" id="3974285">.</span><span class="ident" id="3974286">pre</span>&nbsp;<span class="op" id="3974290">!=</span>&nbsp;<span class="ident" id="3974293">nil</span>&nbsp;<span class="op" id="3974297">||</span>&nbsp;<span class="ident" id="3974300">f</span><span class="op" id="3974301">.</span><span class="ident" id="3974302">post</span>&nbsp;<span class="op" id="3974307">!=</span>&nbsp;<span class="ident" id="3974310">nil</span>&nbsp;<span class="op" id="3974314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3974318">panic</span><span class="op" id="3974323">(</span><span class="string" id="3974324">&#34;have&nbsp;already&nbsp;forked&#34;</span><span class="op" id="3974345">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3974348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3974351">f</span><span class="op" id="3974352">.</span><span class="ident" id="3974353">pre</span>&nbsp;<span class="op" id="3974357">=</span>&nbsp;<span class="ident" id="3974359">newForkableWriter</span><span class="op" id="3974376">(</span><span class="op" id="3974377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3974380">f</span><span class="op" id="3974381">.</span><span class="ident" id="3974382">post</span>&nbsp;<span class="op" id="3974387">=</span>&nbsp;<span class="ident" id="3974389">newForkableWriter</span><span class="op" id="3974406">(</span><span class="op" id="3974407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3974410">return</span>&nbsp;<span class="ident" id="3974417">f</span><span class="op" id="3974418">.</span><span class="ident" id="3974419">pre</span><span class="op" id="3974422">,</span>&nbsp;<span class="ident" id="3974424">f</span><span class="op" id="3974425">.</span><span class="ident" id="3974426">post</span><br>
<span class="lineno"></span><span class="op" id="3974431">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3974434">func</span>&nbsp;<span class="op" id="3974439">(</span><span class="ident" id="3974440">f</span>&nbsp;<span class="op" id="3974442">*</span><span class="ident" id="3974443">forkableWriter</span><span class="op" id="3974457">)</span>&nbsp;<span class="ident" id="3974459">Len</span><span class="op" id="3974462">(</span><span class="op" id="3974463">)</span>&nbsp;<span class="op" id="3974465">(</span><span class="ident" id="3974466">l</span>&nbsp;<span class="builtintype" id="3974468">int</span><span class="op" id="3974471">)</span>&nbsp;<span class="op" id="3974473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3974476">l</span>&nbsp;<span class="op" id="3974478">+=</span>&nbsp;<span class="ident" id="3974481">f</span><span class="op" id="3974482">.</span><span class="ident" id="3974483">Buffer</span><span class="op" id="3974489">.</span><span class="ident" id="3974490">Len</span><span class="op" id="3974493">(</span><span class="op" id="3974494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3974497">if</span>&nbsp;<span class="ident" id="3974500">f</span><span class="op" id="3974501">.</span><span class="ident" id="3974502">pre</span>&nbsp;<span class="op" id="3974506">!=</span>&nbsp;<span class="ident" id="3974509">nil</span>&nbsp;<span class="op" id="3974513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3974517">l</span>&nbsp;<span class="op" id="3974519">+=</span>&nbsp;<span class="ident" id="3974522">f</span><span class="op" id="3974523">.</span><span class="ident" id="3974524">pre</span><span class="op" id="3974527">.</span><span class="ident" id="3974528">Len</span><span class="op" id="3974531">(</span><span class="op" id="3974532">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3974535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3974538">if</span>&nbsp;<span class="ident" id="3974541">f</span><span class="op" id="3974542">.</span><span class="ident" id="3974543">post</span>&nbsp;<span class="op" id="3974548">!=</span>&nbsp;<span class="ident" id="3974551">nil</span>&nbsp;<span class="op" id="3974555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3974559">l</span>&nbsp;<span class="op" id="3974561">+=</span>&nbsp;<span class="ident" id="3974564">f</span><span class="op" id="3974565">.</span><span class="ident" id="3974566">post</span><span class="op" id="3974570">.</span><span class="ident" id="3974571">Len</span><span class="op" id="3974574">(</span><span class="op" id="3974575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3974578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3974581">return</span><br>
<span class="lineno">50</span><span class="op" id="3974588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3974591">func</span>&nbsp;<span class="op" id="3974596">(</span><span class="ident" id="3974597">f</span>&nbsp;<span class="op" id="3974599">*</span><span class="ident" id="3974600">forkableWriter</span><span class="op" id="3974614">)</span>&nbsp;<span class="ident" id="3974616">writeTo</span><span class="op" id="3974623">(</span><span class="ident" id="3974624">out</span>&nbsp;<span class="ident" id="3974628">io</span><span class="op" id="3974630">.</span><span class="ident" id="3974631">Writer</span><span class="op" id="3974637">)</span>&nbsp;<span class="op" id="3974639">(</span><span class="ident" id="3974640">n</span>&nbsp;<span class="builtintype" id="3974642">int</span><span class="op" id="3974645">,</span>&nbsp;<span class="ident" id="3974647">err</span>&nbsp;<span class="builtintype" id="3974651">error</span><span class="op" id="3974656">)</span>&nbsp;<span class="op" id="3974658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3974661">n</span><span class="op" id="3974662">,</span>&nbsp;<span class="ident" id="3974664">err</span>&nbsp;<span class="op" id="3974668">=</span>&nbsp;<span class="ident" id="3974670">out</span><span class="op" id="3974673">.</span><span class="ident" id="3974674">Write</span><span class="op" id="3974679">(</span><span class="ident" id="3974680">f</span><span class="op" id="3974681">.</span><span class="ident" id="3974682">Bytes</span><span class="op" id="3974687">(</span><span class="op" id="3974688">)</span><span class="op" id="3974689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3974692">if</span>&nbsp;<span class="ident" id="3974695">err</span>&nbsp;<span class="op" id="3974699">!=</span>&nbsp;<span class="ident" id="3974702">nil</span>&nbsp;<span class="op" id="3974706">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3974710">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3974718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3974722">var</span>&nbsp;<span class="ident" id="3974726">nn</span>&nbsp;<span class="builtintype" id="3974729">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3974735">if</span>&nbsp;<span class="ident" id="3974738">f</span><span class="op" id="3974739">.</span><span class="ident" id="3974740">pre</span>&nbsp;<span class="op" id="3974744">!=</span>&nbsp;<span class="ident" id="3974747">nil</span>&nbsp;<span class="op" id="3974751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3974755">nn</span><span class="op" id="3974757">,</span>&nbsp;<span class="ident" id="3974759">err</span>&nbsp;<span class="op" id="3974763">=</span>&nbsp;<span class="ident" id="3974765">f</span><span class="op" id="3974766">.</span><span class="ident" id="3974767">pre</span><span class="op" id="3974770">.</span><span class="ident" id="3974771">writeTo</span><span class="op" id="3974778">(</span><span class="ident" id="3974779">out</span><span class="op" id="3974782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3974786">n</span>&nbsp;<span class="op" id="3974788">+=</span>&nbsp;<span class="ident" id="3974791">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3974796">if</span>&nbsp;<span class="ident" id="3974799">err</span>&nbsp;<span class="op" id="3974803">!=</span>&nbsp;<span class="ident" id="3974806">nil</span>&nbsp;<span class="op" id="3974810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3974815">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3974824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3974827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3974831">if</span>&nbsp;<span class="ident" id="3974834">f</span><span class="op" id="3974835">.</span><span class="ident" id="3974836">post</span>&nbsp;<span class="op" id="3974841">!=</span>&nbsp;<span class="ident" id="3974844">nil</span>&nbsp;<span class="op" id="3974848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3974852">nn</span><span class="op" id="3974854">,</span>&nbsp;<span class="ident" id="3974856">err</span>&nbsp;<span class="op" id="3974860">=</span>&nbsp;<span class="ident" id="3974862">f</span><span class="op" id="3974863">.</span><span class="ident" id="3974864">post</span><span class="op" id="3974868">.</span><span class="ident" id="3974869">writeTo</span><span class="op" id="3974876">(</span><span class="ident" id="3974877">out</span><span class="op" id="3974880">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3974884">n</span>&nbsp;<span class="op" id="3974886">+=</span>&nbsp;<span class="ident" id="3974889">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3974893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3974896">return</span><br>
<span class="lineno"></span><span class="op" id="3974903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="3974906">func</span>&nbsp;<span class="ident" id="3974911">marshalBase128Int</span><span class="op" id="3974928">(</span><span class="ident" id="3974929">out</span>&nbsp;<span class="op" id="3974933">*</span><span class="ident" id="3974934">forkableWriter</span><span class="op" id="3974948">,</span>&nbsp;<span class="ident" id="3974950">n</span>&nbsp;<span class="ident" id="3974952">int64</span><span class="op" id="3974957">)</span>&nbsp;<span class="op" id="3974959">(</span><span class="ident" id="3974960">err</span>&nbsp;<span class="builtintype" id="3974964">error</span><span class="op" id="3974969">)</span>&nbsp;<span class="op" id="3974971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3974974">if</span>&nbsp;<span class="ident" id="3974977">n</span>&nbsp;<span class="op" id="3974979">==</span>&nbsp;<span class="num" id="3974982">0</span>&nbsp;<span class="op" id="3974984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3974988">err</span>&nbsp;<span class="op" id="3974992">=</span>&nbsp;<span class="ident" id="3974994">out</span><span class="op" id="3974997">.</span><span class="ident" id="3974998">WriteByte</span><span class="op" id="3975007">(</span><span class="num" id="3975008">0</span><span class="op" id="3975009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3975013">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3975021">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3975025">l</span>&nbsp;<span class="op" id="3975027">:=</span>&nbsp;<span class="num" id="3975030">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3975033">for</span>&nbsp;<span class="ident" id="3975037">i</span>&nbsp;<span class="op" id="3975039">:=</span>&nbsp;<span class="ident" id="3975042">n</span><span class="op" id="3975043">;</span>&nbsp;<span class="ident" id="3975045">i</span>&nbsp;<span class="op" id="3975047">&gt;</span>&nbsp;<span class="num" id="3975049">0</span><span class="op" id="3975050">;</span>&nbsp;<span class="ident" id="3975052">i</span>&nbsp;<span class="op" id="3975054">&gt;&gt;=</span>&nbsp;<span class="num" id="3975058">7</span>&nbsp;<span class="op" id="3975060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3975064">l</span><span class="op" id="3975065">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3975069">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3975073">for</span>&nbsp;<span class="ident" id="3975077">i</span>&nbsp;<span class="op" id="3975079">:=</span>&nbsp;<span class="ident" id="3975082">l</span>&nbsp;<span class="op" id="3975084">-</span>&nbsp;<span class="num" id="3975086">1</span><span class="op" id="3975087">;</span>&nbsp;<span class="ident" id="3975089">i</span>&nbsp;<span class="op" id="3975091">&gt;=</span>&nbsp;<span class="num" id="3975094">0</span><span class="op" id="3975095">;</span>&nbsp;<span class="ident" id="3975097">i</span><span class="op" id="3975098">--</span>&nbsp;<span class="op" id="3975101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3975105">o</span>&nbsp;<span class="op" id="3975107">:=</span>&nbsp;<span class="builtintype" id="3975110">byte</span><span class="op" id="3975114">(</span><span class="ident" id="3975115">n</span>&nbsp;<span class="op" id="3975117">&gt;&gt;</span>&nbsp;<span class="builtintype" id="3975120">uint</span><span class="op" id="3975124">(</span><span class="ident" id="3975125">i</span><span class="op" id="3975126">*</span><span class="num" id="3975127">7</span><span class="op" id="3975128">)</span><span class="op" id="3975129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3975133">o</span>&nbsp;<span class="op" id="3975135">&amp;=</span>&nbsp;<span class="num" id="3975138">0x7f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3975145">if</span>&nbsp;<span class="ident" id="3975148">i</span>&nbsp;<span class="op" id="3975150">!=</span>&nbsp;<span class="num" id="3975153">0</span>&nbsp;<span class="op" id="3975155">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3975160">o</span>&nbsp;<span class="op" id="3975162">|=</span>&nbsp;<span class="num" id="3975165">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3975172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3975176">err</span>&nbsp;<span class="op" id="3975180">=</span>&nbsp;<span class="ident" id="3975182">out</span><span class="op" id="3975185">.</span><span class="ident" id="3975186">WriteByte</span><span class="op" id="3975195">(</span><span class="ident" id="3975196">o</span><span class="op" id="3975197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3975201">if</span>&nbsp;<span class="ident" id="3975204">err</span>&nbsp;<span class="op" id="3975208">!=</span>&nbsp;<span class="ident" id="3975211">nil</span>&nbsp;<span class="op" id="3975215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3975220">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3975229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3975232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3975236">return</span>&nbsp;<span class="ident" id="3975243">nil</span><br>
<span class="lineno"></span><span class="op" id="3975247">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="3975250">func</span>&nbsp;<span class="ident" id="3975255">marshalInt64</span><span class="op" id="3975267">(</span><span class="ident" id="3975268">out</span>&nbsp;<span class="op" id="3975272">*</span><span class="ident" id="3975273">forkableWriter</span><span class="op" id="3975287">,</span>&nbsp;<span class="ident" id="3975289">i</span>&nbsp;<span class="ident" id="3975291">int64</span><span class="op" id="3975296">)</span>&nbsp;<span class="op" id="3975298">(</span><span class="ident" id="3975299">err</span>&nbsp;<span class="builtintype" id="3975303">error</span><span class="op" id="3975308">)</span>&nbsp;<span class="op" id="3975310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3975313">n</span>&nbsp;<span class="op" id="3975315">:=</span>&nbsp;<span class="ident" id="3975318">int64Length</span><span class="op" id="3975329">(</span><span class="ident" id="3975330">i</span><span class="op" id="3975331">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3975335">for</span>&nbsp;<span class="op" id="3975339">;</span>&nbsp;<span class="ident" id="3975341">n</span>&nbsp;<span class="op" id="3975343">&gt;</span>&nbsp;<span class="num" id="3975345">0</span><span class="op" id="3975346">;</span>&nbsp;<span class="ident" id="3975348">n</span><span class="op" id="3975349">--</span>&nbsp;<span class="op" id="3975352">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3975356">err</span>&nbsp;<span class="op" id="3975360">=</span>&nbsp;<span class="ident" id="3975362">out</span><span class="op" id="3975365">.</span><span class="ident" id="3975366">WriteByte</span><span class="op" id="3975375">(</span><span class="builtintype" id="3975376">byte</span><span class="op" id="3975380">(</span><span class="ident" id="3975381">i</span>&nbsp;<span class="op" id="3975383">&gt;&gt;</span>&nbsp;<span class="builtintype" id="3975386">uint</span><span class="op" id="3975390">(</span><span class="op" id="3975391">(</span><span class="ident" id="3975392">n</span><span class="op" id="3975393">-</span><span class="num" id="3975394">1</span><span class="op" id="3975395">)</span><span class="op" id="3975396">*</span><span class="num" id="3975397">8</span><span class="op" id="3975398">)</span><span class="op" id="3975399">)</span><span class="op" id="3975400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3975404">if</span>&nbsp;<span class="ident" id="3975407">err</span>&nbsp;<span class="op" id="3975411">!=</span>&nbsp;<span class="ident" id="3975414">nil</span>&nbsp;<span class="op" id="3975418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3975423">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3975432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3975435">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3975439">return</span>&nbsp;<span class="ident" id="3975446">nil</span><br>
<span class="lineno"></span><span class="op" id="3975450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3975453">func</span>&nbsp;<span class="ident" id="3975458">int64Length</span><span class="op" id="3975469">(</span><span class="ident" id="3975470">i</span>&nbsp;<span class="ident" id="3975472">int64</span><span class="op" id="3975477">)</span>&nbsp;<span class="op" id="3975479">(</span><span class="ident" id="3975480">numBytes</span>&nbsp;<span class="builtintype" id="3975489">int</span><span class="op" id="3975492">)</span>&nbsp;<span class="op" id="3975494">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3975497">numBytes</span>&nbsp;<span class="op" id="3975506">=</span>&nbsp;<span class="num" id="3975508">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3975512">for</span>&nbsp;<span class="ident" id="3975516">i</span>&nbsp;<span class="op" id="3975518">&gt;</span>&nbsp;<span class="num" id="3975520">127</span>&nbsp;<span class="op" id="3975524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3975528">numBytes</span><span class="op" id="3975536">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3975541">i</span>&nbsp;<span class="op" id="3975543">&gt;&gt;=</span>&nbsp;<span class="num" id="3975547">8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3975550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3975554">for</span>&nbsp;<span class="ident" id="3975558">i</span>&nbsp;<span class="op" id="3975560">&lt;</span>&nbsp;<span class="op" id="3975562">-</span><span class="num" id="3975563">128</span>&nbsp;<span class="op" id="3975567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3975571">numBytes</span><span class="op" id="3975579">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3975584">i</span>&nbsp;<span class="op" id="3975586">&gt;&gt;=</span>&nbsp;<span class="num" id="3975590">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3975593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3975597">return</span><br>
<span class="lineno"></span><span class="op" id="3975604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="3975607">func</span>&nbsp;<span class="ident" id="3975612">marshalBigInt</span><span class="op" id="3975625">(</span><span class="ident" id="3975626">out</span>&nbsp;<span class="op" id="3975630">*</span><span class="ident" id="3975631">forkableWriter</span><span class="op" id="3975645">,</span>&nbsp;<span class="ident" id="3975647">n</span>&nbsp;<span class="op" id="3975649">*</span><span class="ident" id="3975650">big</span><span class="op" id="3975653">.</span><span class="ident" id="3975654">Int</span><span class="op" id="3975657">)</span>&nbsp;<span class="op" id="3975659">(</span><span class="ident" id="3975660">err</span>&nbsp;<span class="builtintype" id="3975664">error</span><span class="op" id="3975669">)</span>&nbsp;<span class="op" id="3975671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3975674">if</span>&nbsp;<span class="ident" id="3975677">n</span><span class="op" id="3975678">.</span><span class="ident" id="3975679">Sign</span><span class="op" id="3975683">(</span><span class="op" id="3975684">)</span>&nbsp;<span class="op" id="3975686">&lt;</span>&nbsp;<span class="num" id="3975688">0</span>&nbsp;<span class="op" id="3975690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3975694">//&nbsp;A&nbsp;negative&nbsp;number&nbsp;has&nbsp;to&nbsp;be&nbsp;converted&nbsp;to&nbsp;two&#39;s-complement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3975757">//&nbsp;form.&nbsp;So&nbsp;we&#39;ll&nbsp;subtract&nbsp;1&nbsp;and&nbsp;invert.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3975807">//&nbsp;most-significant-bit&nbsp;isn&#39;t&nbsp;set&nbsp;then&nbsp;we&#39;ll&nbsp;need&nbsp;to&nbsp;pad&nbsp;the</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3975870">//&nbsp;beginning&nbsp;with&nbsp;0xff&nbsp;in&nbsp;order&nbsp;to&nbsp;keep&nbsp;the&nbsp;number&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3975933">nMinus1</span>&nbsp;<span class="op" id="3975941">:=</span>&nbsp;<span class="builtinfunc" id="3975944">new</span><span class="op" id="3975947">(</span><span class="ident" id="3975948">big</span><span class="op" id="3975951">.</span><span class="ident" id="3975952">Int</span><span class="op" id="3975955">)</span><span class="op" id="3975956">.</span><span class="ident" id="3975957">Neg</span><span class="op" id="3975960">(</span><span class="ident" id="3975961">n</span><span class="op" id="3975962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3975966">nMinus1</span><span class="op" id="3975973">.</span><span class="ident" id="3975974">Sub</span><span class="op" id="3975977">(</span><span class="ident" id="3975978">nMinus1</span><span class="op" id="3975985">,</span>&nbsp;<span class="ident" id="3975987">bigOne</span><span class="op" id="3975993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3975997">bytes</span>&nbsp;<span class="op" id="3976003">:=</span>&nbsp;<span class="ident" id="3976006">nMinus1</span><span class="op" id="3976013">.</span><span class="ident" id="3976014">Bytes</span><span class="op" id="3976019">(</span><span class="op" id="3976020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976024">for</span>&nbsp;<span class="ident" id="3976028">i</span>&nbsp;<span class="op" id="3976030">:=</span>&nbsp;<span class="keyword" id="3976033">range</span>&nbsp;<span class="ident" id="3976039">bytes</span>&nbsp;<span class="op" id="3976045">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976050">bytes</span><span class="op" id="3976055">[</span><span class="ident" id="3976056">i</span><span class="op" id="3976057">]</span>&nbsp;<span class="op" id="3976059">^=</span>&nbsp;<span class="num" id="3976062">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3976069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976073">if</span>&nbsp;<span class="builtinfunc" id="3976076">len</span><span class="op" id="3976079">(</span><span class="ident" id="3976080">bytes</span><span class="op" id="3976085">)</span>&nbsp;<span class="op" id="3976087">==</span>&nbsp;<span class="num" id="3976090">0</span>&nbsp;<span class="op" id="3976092">||</span>&nbsp;<span class="ident" id="3976095">bytes</span><span class="op" id="3976100">[</span><span class="num" id="3976101">0</span><span class="op" id="3976102">]</span><span class="op" id="3976103">&amp;</span><span class="num" id="3976104">0x80</span>&nbsp;<span class="op" id="3976109">==</span>&nbsp;<span class="num" id="3976112">0</span>&nbsp;<span class="op" id="3976114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976119">err</span>&nbsp;<span class="op" id="3976123">=</span>&nbsp;<span class="ident" id="3976125">out</span><span class="op" id="3976128">.</span><span class="ident" id="3976129">WriteByte</span><span class="op" id="3976138">(</span><span class="num" id="3976139">0xff</span><span class="op" id="3976143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976148">if</span>&nbsp;<span class="ident" id="3976151">err</span>&nbsp;<span class="op" id="3976155">!=</span>&nbsp;<span class="ident" id="3976158">nil</span>&nbsp;<span class="op" id="3976162">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976168">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3976178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3976182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976186">_</span><span class="op" id="3976187">,</span>&nbsp;<span class="ident" id="3976189">err</span>&nbsp;<span class="op" id="3976193">=</span>&nbsp;<span class="ident" id="3976195">out</span><span class="op" id="3976198">.</span><span class="ident" id="3976199">Write</span><span class="op" id="3976204">(</span><span class="ident" id="3976205">bytes</span><span class="op" id="3976210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3976213">}</span>&nbsp;<span class="keyword" id="3976215">else</span>&nbsp;<span class="keyword" id="3976220">if</span>&nbsp;<span class="ident" id="3976223">n</span><span class="op" id="3976224">.</span><span class="ident" id="3976225">Sign</span><span class="op" id="3976229">(</span><span class="op" id="3976230">)</span>&nbsp;<span class="op" id="3976232">==</span>&nbsp;<span class="num" id="3976235">0</span>&nbsp;<span class="op" id="3976237">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3976241">//&nbsp;Zero&nbsp;is&nbsp;written&nbsp;as&nbsp;a&nbsp;single&nbsp;0&nbsp;zero&nbsp;rather&nbsp;than&nbsp;no&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976303">err</span>&nbsp;<span class="op" id="3976307">=</span>&nbsp;<span class="ident" id="3976309">out</span><span class="op" id="3976312">.</span><span class="ident" id="3976313">WriteByte</span><span class="op" id="3976322">(</span><span class="num" id="3976323">0x00</span><span class="op" id="3976327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3976330">}</span>&nbsp;<span class="keyword" id="3976332">else</span>&nbsp;<span class="op" id="3976337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976341">bytes</span>&nbsp;<span class="op" id="3976347">:=</span>&nbsp;<span class="ident" id="3976350">n</span><span class="op" id="3976351">.</span><span class="ident" id="3976352">Bytes</span><span class="op" id="3976357">(</span><span class="op" id="3976358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976362">if</span>&nbsp;<span class="builtinfunc" id="3976365">len</span><span class="op" id="3976368">(</span><span class="ident" id="3976369">bytes</span><span class="op" id="3976374">)</span>&nbsp;<span class="op" id="3976376">&gt;</span>&nbsp;<span class="num" id="3976378">0</span>&nbsp;<span class="op" id="3976380">&amp;&amp;</span>&nbsp;<span class="ident" id="3976383">bytes</span><span class="op" id="3976388">[</span><span class="num" id="3976389">0</span><span class="op" id="3976390">]</span><span class="op" id="3976391">&amp;</span><span class="num" id="3976392">0x80</span>&nbsp;<span class="op" id="3976397">!=</span>&nbsp;<span class="num" id="3976400">0</span>&nbsp;<span class="op" id="3976402">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3976407">//&nbsp;We&#39;ll&nbsp;have&nbsp;to&nbsp;pad&nbsp;this&nbsp;with&nbsp;0x00&nbsp;in&nbsp;order&nbsp;to&nbsp;stop&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3976466">//&nbsp;looking&nbsp;like&nbsp;a&nbsp;negative&nbsp;number.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976504">err</span>&nbsp;<span class="op" id="3976508">=</span>&nbsp;<span class="ident" id="3976510">out</span><span class="op" id="3976513">.</span><span class="ident" id="3976514">WriteByte</span><span class="op" id="3976523">(</span><span class="num" id="3976524">0</span><span class="op" id="3976525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976530">if</span>&nbsp;<span class="ident" id="3976533">err</span>&nbsp;<span class="op" id="3976537">!=</span>&nbsp;<span class="ident" id="3976540">nil</span>&nbsp;<span class="op" id="3976544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976550">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3976560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3976564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976568">_</span><span class="op" id="3976569">,</span>&nbsp;<span class="ident" id="3976571">err</span>&nbsp;<span class="op" id="3976575">=</span>&nbsp;<span class="ident" id="3976577">out</span><span class="op" id="3976580">.</span><span class="ident" id="3976581">Write</span><span class="op" id="3976586">(</span><span class="ident" id="3976587">bytes</span><span class="op" id="3976592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3976595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976598">return</span><br>
<span class="lineno">165</span><span class="op" id="3976605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3976608">func</span>&nbsp;<span class="ident" id="3976613">marshalLength</span><span class="op" id="3976626">(</span><span class="ident" id="3976627">out</span>&nbsp;<span class="op" id="3976631">*</span><span class="ident" id="3976632">forkableWriter</span><span class="op" id="3976646">,</span>&nbsp;<span class="ident" id="3976648">i</span>&nbsp;<span class="builtintype" id="3976650">int</span><span class="op" id="3976653">)</span>&nbsp;<span class="op" id="3976655">(</span><span class="ident" id="3976656">err</span>&nbsp;<span class="builtintype" id="3976660">error</span><span class="op" id="3976665">)</span>&nbsp;<span class="op" id="3976667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976670">n</span>&nbsp;<span class="op" id="3976672">:=</span>&nbsp;<span class="ident" id="3976675">lengthLength</span><span class="op" id="3976687">(</span><span class="ident" id="3976688">i</span><span class="op" id="3976689">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976693">for</span>&nbsp;<span class="op" id="3976697">;</span>&nbsp;<span class="ident" id="3976699">n</span>&nbsp;<span class="op" id="3976701">&gt;</span>&nbsp;<span class="num" id="3976703">0</span><span class="op" id="3976704">;</span>&nbsp;<span class="ident" id="3976706">n</span><span class="op" id="3976707">--</span>&nbsp;<span class="op" id="3976710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976714">err</span>&nbsp;<span class="op" id="3976718">=</span>&nbsp;<span class="ident" id="3976720">out</span><span class="op" id="3976723">.</span><span class="ident" id="3976724">WriteByte</span><span class="op" id="3976733">(</span><span class="builtintype" id="3976734">byte</span><span class="op" id="3976738">(</span><span class="ident" id="3976739">i</span>&nbsp;<span class="op" id="3976741">&gt;&gt;</span>&nbsp;<span class="builtintype" id="3976744">uint</span><span class="op" id="3976748">(</span><span class="op" id="3976749">(</span><span class="ident" id="3976750">n</span><span class="op" id="3976751">-</span><span class="num" id="3976752">1</span><span class="op" id="3976753">)</span><span class="op" id="3976754">*</span><span class="num" id="3976755">8</span><span class="op" id="3976756">)</span><span class="op" id="3976757">)</span><span class="op" id="3976758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976762">if</span>&nbsp;<span class="ident" id="3976765">err</span>&nbsp;<span class="op" id="3976769">!=</span>&nbsp;<span class="ident" id="3976772">nil</span>&nbsp;<span class="op" id="3976776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976781">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3976790">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3976793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976797">return</span>&nbsp;<span class="ident" id="3976804">nil</span><br>
<span class="lineno"></span><span class="op" id="3976808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="3976811">func</span>&nbsp;<span class="ident" id="3976816">lengthLength</span><span class="op" id="3976828">(</span><span class="ident" id="3976829">i</span>&nbsp;<span class="builtintype" id="3976831">int</span><span class="op" id="3976834">)</span>&nbsp;<span class="op" id="3976836">(</span><span class="ident" id="3976837">numBytes</span>&nbsp;<span class="builtintype" id="3976846">int</span><span class="op" id="3976849">)</span>&nbsp;<span class="op" id="3976851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976854">numBytes</span>&nbsp;<span class="op" id="3976863">=</span>&nbsp;<span class="num" id="3976865">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976868">for</span>&nbsp;<span class="ident" id="3976872">i</span>&nbsp;<span class="op" id="3976874">&gt;</span>&nbsp;<span class="num" id="3976876">255</span>&nbsp;<span class="op" id="3976880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976884">numBytes</span><span class="op" id="3976892">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976897">i</span>&nbsp;<span class="op" id="3976899">&gt;&gt;=</span>&nbsp;<span class="num" id="3976903">8</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3976906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3976909">return</span><br>
<span class="lineno"></span><span class="op" id="3976916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3976919">func</span>&nbsp;<span class="ident" id="3976924">marshalTagAndLength</span><span class="op" id="3976943">(</span><span class="ident" id="3976944">out</span>&nbsp;<span class="op" id="3976948">*</span><span class="ident" id="3976949">forkableWriter</span><span class="op" id="3976963">,</span>&nbsp;<span class="ident" id="3976965">t</span>&nbsp;<span class="ident" id="3976967">tagAndLength</span><span class="op" id="3976979">)</span>&nbsp;<span class="op" id="3976981">(</span><span class="ident" id="3976982">err</span>&nbsp;<span class="builtintype" id="3976986">error</span><span class="op" id="3976991">)</span>&nbsp;<span class="op" id="3976993">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3976996">b</span>&nbsp;<span class="op" id="3976998">:=</span>&nbsp;<span class="builtintype" id="3977001">uint8</span><span class="op" id="3977006">(</span><span class="ident" id="3977007">t</span><span class="op" id="3977008">.</span><span class="ident" id="3977009">class</span><span class="op" id="3977014">)</span>&nbsp;<span class="op" id="3977016">&lt;&lt;</span>&nbsp;<span class="num" id="3977019">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977022">if</span>&nbsp;<span class="ident" id="3977025">t</span><span class="op" id="3977026">.</span><span class="ident" id="3977027">isCompound</span>&nbsp;<span class="op" id="3977038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977042">b</span>&nbsp;<span class="op" id="3977044">|=</span>&nbsp;<span class="num" id="3977047">0x20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977056">if</span>&nbsp;<span class="ident" id="3977059">t</span><span class="op" id="3977060">.</span><span class="ident" id="3977061">tag</span>&nbsp;<span class="op" id="3977065">&gt;=</span>&nbsp;<span class="num" id="3977068">31</span>&nbsp;<span class="op" id="3977071">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977075">b</span>&nbsp;<span class="op" id="3977077">|=</span>&nbsp;<span class="num" id="3977080">0x1f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977087">err</span>&nbsp;<span class="op" id="3977091">=</span>&nbsp;<span class="ident" id="3977093">out</span><span class="op" id="3977096">.</span><span class="ident" id="3977097">WriteByte</span><span class="op" id="3977106">(</span><span class="ident" id="3977107">b</span><span class="op" id="3977108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977112">if</span>&nbsp;<span class="ident" id="3977115">err</span>&nbsp;<span class="op" id="3977119">!=</span>&nbsp;<span class="ident" id="3977122">nil</span>&nbsp;<span class="op" id="3977126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977131">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977140">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977144">err</span>&nbsp;<span class="op" id="3977148">=</span>&nbsp;<span class="ident" id="3977150">marshalBase128Int</span><span class="op" id="3977167">(</span><span class="ident" id="3977168">out</span><span class="op" id="3977171">,</span>&nbsp;<span class="ident" id="3977173">int64</span><span class="op" id="3977178">(</span><span class="ident" id="3977179">t</span><span class="op" id="3977180">.</span><span class="ident" id="3977181">tag</span><span class="op" id="3977184">)</span><span class="op" id="3977185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977189">if</span>&nbsp;<span class="ident" id="3977192">err</span>&nbsp;<span class="op" id="3977196">!=</span>&nbsp;<span class="ident" id="3977199">nil</span>&nbsp;<span class="op" id="3977203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977208">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977220">}</span>&nbsp;<span class="keyword" id="3977222">else</span>&nbsp;<span class="op" id="3977227">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977231">b</span>&nbsp;<span class="op" id="3977233">|=</span>&nbsp;<span class="builtintype" id="3977236">uint8</span><span class="op" id="3977241">(</span><span class="ident" id="3977242">t</span><span class="op" id="3977243">.</span><span class="ident" id="3977244">tag</span><span class="op" id="3977247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977251">err</span>&nbsp;<span class="op" id="3977255">=</span>&nbsp;<span class="ident" id="3977257">out</span><span class="op" id="3977260">.</span><span class="ident" id="3977261">WriteByte</span><span class="op" id="3977270">(</span><span class="ident" id="3977271">b</span><span class="op" id="3977272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977276">if</span>&nbsp;<span class="ident" id="3977279">err</span>&nbsp;<span class="op" id="3977283">!=</span>&nbsp;<span class="ident" id="3977286">nil</span>&nbsp;<span class="op" id="3977290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977295">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977304">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977311">if</span>&nbsp;<span class="ident" id="3977314">t</span><span class="op" id="3977315">.</span><span class="ident" id="3977316">length</span>&nbsp;<span class="op" id="3977323">&gt;=</span>&nbsp;<span class="num" id="3977326">128</span>&nbsp;<span class="op" id="3977330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977334">l</span>&nbsp;<span class="op" id="3977336">:=</span>&nbsp;<span class="ident" id="3977339">lengthLength</span><span class="op" id="3977351">(</span><span class="ident" id="3977352">t</span><span class="op" id="3977353">.</span><span class="ident" id="3977354">length</span><span class="op" id="3977360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977364">err</span>&nbsp;<span class="op" id="3977368">=</span>&nbsp;<span class="ident" id="3977370">out</span><span class="op" id="3977373">.</span><span class="ident" id="3977374">WriteByte</span><span class="op" id="3977383">(</span><span class="num" id="3977384">0x80</span>&nbsp;<span class="op" id="3977389">|</span>&nbsp;<span class="builtintype" id="3977391">byte</span><span class="op" id="3977395">(</span><span class="ident" id="3977396">l</span><span class="op" id="3977397">)</span><span class="op" id="3977398">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977402">if</span>&nbsp;<span class="ident" id="3977405">err</span>&nbsp;<span class="op" id="3977409">!=</span>&nbsp;<span class="ident" id="3977412">nil</span>&nbsp;<span class="op" id="3977416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977421">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977434">err</span>&nbsp;<span class="op" id="3977438">=</span>&nbsp;<span class="ident" id="3977440">marshalLength</span><span class="op" id="3977453">(</span><span class="ident" id="3977454">out</span><span class="op" id="3977457">,</span>&nbsp;<span class="ident" id="3977459">t</span><span class="op" id="3977460">.</span><span class="ident" id="3977461">length</span><span class="op" id="3977467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977471">if</span>&nbsp;<span class="ident" id="3977474">err</span>&nbsp;<span class="op" id="3977478">!=</span>&nbsp;<span class="ident" id="3977481">nil</span>&nbsp;<span class="op" id="3977485">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977490">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977502">}</span>&nbsp;<span class="keyword" id="3977504">else</span>&nbsp;<span class="op" id="3977509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977513">err</span>&nbsp;<span class="op" id="3977517">=</span>&nbsp;<span class="ident" id="3977519">out</span><span class="op" id="3977522">.</span><span class="ident" id="3977523">WriteByte</span><span class="op" id="3977532">(</span><span class="builtintype" id="3977533">byte</span><span class="op" id="3977537">(</span><span class="ident" id="3977538">t</span><span class="op" id="3977539">.</span><span class="ident" id="3977540">length</span><span class="op" id="3977546">)</span><span class="op" id="3977547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977551">if</span>&nbsp;<span class="ident" id="3977554">err</span>&nbsp;<span class="op" id="3977558">!=</span>&nbsp;<span class="ident" id="3977561">nil</span>&nbsp;<span class="op" id="3977565">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977570">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977586">return</span>&nbsp;<span class="ident" id="3977593">nil</span><br>
<span class="lineno">230</span><span class="op" id="3977597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3977600">func</span>&nbsp;<span class="ident" id="3977605">marshalBitString</span><span class="op" id="3977621">(</span><span class="ident" id="3977622">out</span>&nbsp;<span class="op" id="3977626">*</span><span class="ident" id="3977627">forkableWriter</span><span class="op" id="3977641">,</span>&nbsp;<span class="ident" id="3977643">b</span>&nbsp;<span class="ident" id="3977645">BitString</span><span class="op" id="3977654">)</span>&nbsp;<span class="op" id="3977656">(</span><span class="ident" id="3977657">err</span>&nbsp;<span class="builtintype" id="3977661">error</span><span class="op" id="3977666">)</span>&nbsp;<span class="op" id="3977668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977671">paddingBits</span>&nbsp;<span class="op" id="3977683">:=</span>&nbsp;<span class="builtintype" id="3977686">byte</span><span class="op" id="3977690">(</span><span class="op" id="3977691">(</span><span class="num" id="3977692">8</span>&nbsp;<span class="op" id="3977694">-</span>&nbsp;<span class="ident" id="3977696">b</span><span class="op" id="3977697">.</span><span class="ident" id="3977698">BitLength</span><span class="op" id="3977707">%</span><span class="num" id="3977708">8</span><span class="op" id="3977709">)</span>&nbsp;<span class="op" id="3977711">%</span>&nbsp;<span class="num" id="3977713">8</span><span class="op" id="3977714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977717">err</span>&nbsp;<span class="op" id="3977721">=</span>&nbsp;<span class="ident" id="3977723">out</span><span class="op" id="3977726">.</span><span class="ident" id="3977727">WriteByte</span><span class="op" id="3977736">(</span><span class="ident" id="3977737">paddingBits</span><span class="op" id="3977748">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977751">if</span>&nbsp;<span class="ident" id="3977754">err</span>&nbsp;<span class="op" id="3977758">!=</span>&nbsp;<span class="ident" id="3977761">nil</span>&nbsp;<span class="op" id="3977765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977769">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3977777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3977780">_</span><span class="op" id="3977781">,</span>&nbsp;<span class="ident" id="3977783">err</span>&nbsp;<span class="op" id="3977787">=</span>&nbsp;<span class="ident" id="3977789">out</span><span class="op" id="3977792">.</span><span class="ident" id="3977793">Write</span><span class="op" id="3977798">(</span><span class="ident" id="3977799">b</span><span class="op" id="3977800">.</span><span class="ident" id="3977801">Bytes</span><span class="op" id="3977806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977809">return</span><br>
<span class="lineno">240</span><span class="op" id="3977816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3977819">func</span>&nbsp;<span class="ident" id="3977824">marshalObjectIdentifier</span><span class="op" id="3977847">(</span><span class="ident" id="3977848">out</span>&nbsp;<span class="op" id="3977852">*</span><span class="ident" id="3977853">forkableWriter</span><span class="op" id="3977867">,</span>&nbsp;<span class="ident" id="3977869">oid</span>&nbsp;<span class="op" id="3977873">[</span><span class="op" id="3977874">]</span><span class="builtintype" id="3977875">int</span><span class="op" id="3977878">)</span>&nbsp;<span class="op" id="3977880">(</span><span class="ident" id="3977881">err</span>&nbsp;<span class="builtintype" id="3977885">error</span><span class="op" id="3977890">)</span>&nbsp;<span class="op" id="3977892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977895">if</span>&nbsp;<span class="builtinfunc" id="3977898">len</span><span class="op" id="3977901">(</span><span class="ident" id="3977902">oid</span><span class="op" id="3977905">)</span>&nbsp;<span class="op" id="3977907">&lt;</span>&nbsp;<span class="num" id="3977909">2</span>&nbsp;<span class="op" id="3977911">||</span>&nbsp;<span class="ident" id="3977914">oid</span><span class="op" id="3977917">[</span><span class="num" id="3977918">0</span><span class="op" id="3977919">]</span>&nbsp;<span class="op" id="3977921">&gt;</span>&nbsp;<span class="num" id="3977923">2</span>&nbsp;<span class="op" id="3977925">||</span>&nbsp;<span class="op" id="3977928">(</span><span class="ident" id="3977929">oid</span><span class="op" id="3977932">[</span><span class="num" id="3977933">0</span><span class="op" id="3977934">]</span>&nbsp;<span class="op" id="3977936">&lt;</span>&nbsp;<span class="num" id="3977938">2</span>&nbsp;<span class="op" id="3977940">&amp;&amp;</span>&nbsp;<span class="ident" id="3977943">oid</span><span class="op" id="3977946">[</span><span class="num" id="3977947">1</span><span class="op" id="3977948">]</span>&nbsp;<span class="op" id="3977950">&gt;=</span>&nbsp;<span class="num" id="3977953">40</span><span class="op" id="3977955">)</span>&nbsp;<span class="op" id="3977957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3977961">return</span>&nbsp;<span class="ident" id="3977968">StructuralError</span><span class="op" id="3977983">{</span><span class="string" id="3977984">&#34;invalid&nbsp;object&nbsp;identifier&#34;</span><span class="op" id="3978011">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3978014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978018">err</span>&nbsp;<span class="op" id="3978022">=</span>&nbsp;<span class="ident" id="3978024">marshalBase128Int</span><span class="op" id="3978041">(</span><span class="ident" id="3978042">out</span><span class="op" id="3978045">,</span>&nbsp;<span class="ident" id="3978047">int64</span><span class="op" id="3978052">(</span><span class="ident" id="3978053">oid</span><span class="op" id="3978056">[</span><span class="num" id="3978057">0</span><span class="op" id="3978058">]</span><span class="op" id="3978059">*</span><span class="num" id="3978060">40</span><span class="op" id="3978062">+</span><span class="ident" id="3978063">oid</span><span class="op" id="3978066">[</span><span class="num" id="3978067">1</span><span class="op" id="3978068">]</span><span class="op" id="3978069">)</span><span class="op" id="3978070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978073">if</span>&nbsp;<span class="ident" id="3978076">err</span>&nbsp;<span class="op" id="3978080">!=</span>&nbsp;<span class="ident" id="3978083">nil</span>&nbsp;<span class="op" id="3978087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978091">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3978099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978102">for</span>&nbsp;<span class="ident" id="3978106">i</span>&nbsp;<span class="op" id="3978108">:=</span>&nbsp;<span class="num" id="3978111">2</span><span class="op" id="3978112">;</span>&nbsp;<span class="ident" id="3978114">i</span>&nbsp;<span class="op" id="3978116">&lt;</span>&nbsp;<span class="builtinfunc" id="3978118">len</span><span class="op" id="3978121">(</span><span class="ident" id="3978122">oid</span><span class="op" id="3978125">)</span><span class="op" id="3978126">;</span>&nbsp;<span class="ident" id="3978128">i</span><span class="op" id="3978129">++</span>&nbsp;<span class="op" id="3978132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978136">err</span>&nbsp;<span class="op" id="3978140">=</span>&nbsp;<span class="ident" id="3978142">marshalBase128Int</span><span class="op" id="3978159">(</span><span class="ident" id="3978160">out</span><span class="op" id="3978163">,</span>&nbsp;<span class="ident" id="3978165">int64</span><span class="op" id="3978170">(</span><span class="ident" id="3978171">oid</span><span class="op" id="3978174">[</span><span class="ident" id="3978175">i</span><span class="op" id="3978176">]</span><span class="op" id="3978177">)</span><span class="op" id="3978178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978182">if</span>&nbsp;<span class="ident" id="3978185">err</span>&nbsp;<span class="op" id="3978189">!=</span>&nbsp;<span class="ident" id="3978192">nil</span>&nbsp;<span class="op" id="3978196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978201">return</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3978210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3978213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978217">return</span><br>
<span class="lineno"></span><span class="op" id="3978224">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="3978227">func</span>&nbsp;<span class="ident" id="3978232">marshalPrintableString</span><span class="op" id="3978254">(</span><span class="ident" id="3978255">out</span>&nbsp;<span class="op" id="3978259">*</span><span class="ident" id="3978260">forkableWriter</span><span class="op" id="3978274">,</span>&nbsp;<span class="ident" id="3978276">s</span>&nbsp;<span class="builtintype" id="3978278">string</span><span class="op" id="3978284">)</span>&nbsp;<span class="op" id="3978286">(</span><span class="ident" id="3978287">err</span>&nbsp;<span class="builtintype" id="3978291">error</span><span class="op" id="3978296">)</span>&nbsp;<span class="op" id="3978298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978301">b</span>&nbsp;<span class="op" id="3978303">:=</span>&nbsp;<span class="op" id="3978306">[</span><span class="op" id="3978307">]</span><span class="builtintype" id="3978308">byte</span><span class="op" id="3978312">(</span><span class="ident" id="3978313">s</span><span class="op" id="3978314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978317">for</span>&nbsp;<span class="ident" id="3978321">_</span><span class="op" id="3978322">,</span>&nbsp;<span class="ident" id="3978324">c</span>&nbsp;<span class="op" id="3978326">:=</span>&nbsp;<span class="keyword" id="3978329">range</span>&nbsp;<span class="ident" id="3978335">b</span>&nbsp;<span class="op" id="3978337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978341">if</span>&nbsp;<span class="op" id="3978344">!</span><span class="ident" id="3978345">isPrintable</span><span class="op" id="3978356">(</span><span class="ident" id="3978357">c</span><span class="op" id="3978358">)</span>&nbsp;<span class="op" id="3978360">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978365">return</span>&nbsp;<span class="ident" id="3978372">StructuralError</span><span class="op" id="3978387">{</span><span class="string" id="3978388">&#34;PrintableString&nbsp;contains&nbsp;invalid&nbsp;character&#34;</span><span class="op" id="3978432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3978436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3978439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978443">_</span><span class="op" id="3978444">,</span>&nbsp;<span class="ident" id="3978446">err</span>&nbsp;<span class="op" id="3978450">=</span>&nbsp;<span class="ident" id="3978452">out</span><span class="op" id="3978455">.</span><span class="ident" id="3978456">Write</span><span class="op" id="3978461">(</span><span class="ident" id="3978462">b</span><span class="op" id="3978463">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978466">return</span><br>
<span class="lineno"></span><span class="op" id="3978473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3978476">func</span>&nbsp;<span class="ident" id="3978481">marshalIA5String</span><span class="op" id="3978497">(</span><span class="ident" id="3978498">out</span>&nbsp;<span class="op" id="3978502">*</span><span class="ident" id="3978503">forkableWriter</span><span class="op" id="3978517">,</span>&nbsp;<span class="ident" id="3978519">s</span>&nbsp;<span class="builtintype" id="3978521">string</span><span class="op" id="3978527">)</span>&nbsp;<span class="op" id="3978529">(</span><span class="ident" id="3978530">err</span>&nbsp;<span class="builtintype" id="3978534">error</span><span class="op" id="3978539">)</span>&nbsp;<span class="op" id="3978541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978544">b</span>&nbsp;<span class="op" id="3978546">:=</span>&nbsp;<span class="op" id="3978549">[</span><span class="op" id="3978550">]</span><span class="builtintype" id="3978551">byte</span><span class="op" id="3978555">(</span><span class="ident" id="3978556">s</span><span class="op" id="3978557">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978560">for</span>&nbsp;<span class="ident" id="3978564">_</span><span class="op" id="3978565">,</span>&nbsp;<span class="ident" id="3978567">c</span>&nbsp;<span class="op" id="3978569">:=</span>&nbsp;<span class="keyword" id="3978572">range</span>&nbsp;<span class="ident" id="3978578">b</span>&nbsp;<span class="op" id="3978580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978584">if</span>&nbsp;<span class="ident" id="3978587">c</span>&nbsp;<span class="op" id="3978589">&gt;</span>&nbsp;<span class="num" id="3978591">127</span>&nbsp;<span class="op" id="3978595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978600">return</span>&nbsp;<span class="ident" id="3978607">StructuralError</span><span class="op" id="3978622">{</span><span class="string" id="3978623">&#34;IA5String&nbsp;contains&nbsp;invalid&nbsp;character&#34;</span><span class="op" id="3978661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3978665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3978668">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978672">_</span><span class="op" id="3978673">,</span>&nbsp;<span class="ident" id="3978675">err</span>&nbsp;<span class="op" id="3978679">=</span>&nbsp;<span class="ident" id="3978681">out</span><span class="op" id="3978684">.</span><span class="ident" id="3978685">Write</span><span class="op" id="3978690">(</span><span class="ident" id="3978691">b</span><span class="op" id="3978692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978695">return</span><br>
<span class="lineno"></span><span class="op" id="3978702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="3978705">func</span>&nbsp;<span class="ident" id="3978710">marshalUTF8String</span><span class="op" id="3978727">(</span><span class="ident" id="3978728">out</span>&nbsp;<span class="op" id="3978732">*</span><span class="ident" id="3978733">forkableWriter</span><span class="op" id="3978747">,</span>&nbsp;<span class="ident" id="3978749">s</span>&nbsp;<span class="builtintype" id="3978751">string</span><span class="op" id="3978757">)</span>&nbsp;<span class="op" id="3978759">(</span><span class="ident" id="3978760">err</span>&nbsp;<span class="builtintype" id="3978764">error</span><span class="op" id="3978769">)</span>&nbsp;<span class="op" id="3978771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978774">_</span><span class="op" id="3978775">,</span>&nbsp;<span class="ident" id="3978777">err</span>&nbsp;<span class="op" id="3978781">=</span>&nbsp;<span class="ident" id="3978783">out</span><span class="op" id="3978786">.</span><span class="ident" id="3978787">Write</span><span class="op" id="3978792">(</span><span class="op" id="3978793">[</span><span class="op" id="3978794">]</span><span class="builtintype" id="3978795">byte</span><span class="op" id="3978799">(</span><span class="ident" id="3978800">s</span><span class="op" id="3978801">)</span><span class="op" id="3978802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978805">return</span><br>
<span class="lineno"></span><span class="op" id="3978812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="3978815">func</span>&nbsp;<span class="ident" id="3978820">marshalTwoDigits</span><span class="op" id="3978836">(</span><span class="ident" id="3978837">out</span>&nbsp;<span class="op" id="3978841">*</span><span class="ident" id="3978842">forkableWriter</span><span class="op" id="3978856">,</span>&nbsp;<span class="ident" id="3978858">v</span>&nbsp;<span class="builtintype" id="3978860">int</span><span class="op" id="3978863">)</span>&nbsp;<span class="op" id="3978865">(</span><span class="ident" id="3978866">err</span>&nbsp;<span class="builtintype" id="3978870">error</span><span class="op" id="3978875">)</span>&nbsp;<span class="op" id="3978877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3978880">err</span>&nbsp;<span class="op" id="3978884">=</span>&nbsp;<span class="ident" id="3978886">out</span><span class="op" id="3978889">.</span><span class="ident" id="3978890">WriteByte</span><span class="op" id="3978899">(</span><span class="builtintype" id="3978900">byte</span><span class="op" id="3978904">(</span><span class="string" id="3978905">&#39;0&#39;</span>&nbsp;<span class="op" id="3978909">+</span>&nbsp;<span class="op" id="3978911">(</span><span class="ident" id="3978912">v</span><span class="op" id="3978913">/</span><span class="num" id="3978914">10</span><span class="op" id="3978916">)</span><span class="op" id="3978917">%</span><span class="num" id="3978918">10</span><span class="op" id="3978920">)</span><span class="op" id="3978921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978924">if</span>&nbsp;<span class="ident" id="3978927">err</span>&nbsp;<span class="op" id="3978931">!=</span>&nbsp;<span class="ident" id="3978934">nil</span>&nbsp;<span class="op" id="3978938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978942">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3978950">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3978953">return</span>&nbsp;<span class="ident" id="3978960">out</span><span class="op" id="3978963">.</span><span class="ident" id="3978964">WriteByte</span><span class="op" id="3978973">(</span><span class="builtintype" id="3978974">byte</span><span class="op" id="3978978">(</span><span class="string" id="3978979">&#39;0&#39;</span>&nbsp;<span class="op" id="3978983">+</span>&nbsp;<span class="ident" id="3978985">v</span><span class="op" id="3978986">%</span><span class="num" id="3978987">10</span><span class="op" id="3978989">)</span><span class="op" id="3978990">)</span><br>
<span class="lineno"></span><span class="op" id="3978992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3978995">func</span>&nbsp;<span class="ident" id="3979000">marshalFourDigits</span><span class="op" id="3979017">(</span><span class="ident" id="3979018">out</span>&nbsp;<span class="op" id="3979022">*</span><span class="ident" id="3979023">forkableWriter</span><span class="op" id="3979037">,</span>&nbsp;<span class="ident" id="3979039">v</span>&nbsp;<span class="builtintype" id="3979041">int</span><span class="op" id="3979044">)</span>&nbsp;<span class="op" id="3979046">(</span><span class="ident" id="3979047">err</span>&nbsp;<span class="builtintype" id="3979051">error</span><span class="op" id="3979056">)</span>&nbsp;<span class="op" id="3979058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979061">var</span>&nbsp;<span class="ident" id="3979065">bytes</span>&nbsp;<span class="op" id="3979071">[</span><span class="num" id="3979072">4</span><span class="op" id="3979073">]</span><span class="builtintype" id="3979074">byte</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979080">for</span>&nbsp;<span class="ident" id="3979084">i</span>&nbsp;<span class="op" id="3979086">:=</span>&nbsp;<span class="keyword" id="3979089">range</span>&nbsp;<span class="ident" id="3979095">bytes</span>&nbsp;<span class="op" id="3979101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3979105">bytes</span><span class="op" id="3979110">[</span><span class="num" id="3979111">3</span><span class="op" id="3979112">-</span><span class="ident" id="3979113">i</span><span class="op" id="3979114">]</span>&nbsp;<span class="op" id="3979116">=</span>&nbsp;<span class="string" id="3979118">&#39;0&#39;</span>&nbsp;<span class="op" id="3979122">+</span>&nbsp;<span class="builtintype" id="3979124">byte</span><span class="op" id="3979128">(</span><span class="ident" id="3979129">v</span><span class="op" id="3979130">%</span><span class="num" id="3979131">10</span><span class="op" id="3979133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3979137">v</span>&nbsp;<span class="op" id="3979139">/=</span>&nbsp;<span class="num" id="3979142">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3979146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3979149">_</span><span class="op" id="3979150">,</span>&nbsp;<span class="ident" id="3979152">err</span>&nbsp;<span class="op" id="3979156">=</span>&nbsp;<span class="ident" id="3979158">out</span><span class="op" id="3979161">.</span><span class="ident" id="3979162">Write</span><span class="op" id="3979167">(</span><span class="ident" id="3979168">bytes</span><span class="op" id="3979173">[</span><span class="op" id="3979174">:</span><span class="op" id="3979175">]</span><span class="op" id="3979176">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979179">return</span><br>
<span class="lineno"></span><span class="op" id="3979186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3979189">func</span>&nbsp;<span class="ident" id="3979194">outsideUTCRange</span><span class="op" id="3979209">(</span><span class="ident" id="3979210">t</span>&nbsp;<span class="ident" id="3979212">time</span><span class="op" id="3979216">.</span><span class="ident" id="3979217">Time</span><span class="op" id="3979221">)</span>&nbsp;<span class="builtintype" id="3979223">bool</span>&nbsp;<span class="op" id="3979228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3979231">year</span>&nbsp;<span class="op" id="3979236">:=</span>&nbsp;<span class="ident" id="3979239">t</span><span class="op" id="3979240">.</span><span class="ident" id="3979241">Year</span><span class="op" id="3979245">(</span><span class="op" id="3979246">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979249">return</span>&nbsp;<span class="ident" id="3979256">year</span>&nbsp;<span class="op" id="3979261">&lt;</span>&nbsp;<span class="num" id="3979263">1950</span>&nbsp;<span class="op" id="3979268">||</span>&nbsp;<span class="ident" id="3979271">year</span>&nbsp;<span class="op" id="3979276">&gt;=</span>&nbsp;<span class="num" id="3979279">2050</span><br>
<span class="lineno"></span><span class="op" id="3979284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3979287">func</span>&nbsp;<span class="ident" id="3979292">marshalUTCTime</span><span class="op" id="3979306">(</span><span class="ident" id="3979307">out</span>&nbsp;<span class="op" id="3979311">*</span><span class="ident" id="3979312">forkableWriter</span><span class="op" id="3979326">,</span>&nbsp;<span class="ident" id="3979328">t</span>&nbsp;<span class="ident" id="3979330">time</span><span class="op" id="3979334">.</span><span class="ident" id="3979335">Time</span><span class="op" id="3979339">)</span>&nbsp;<span class="op" id="3979341">(</span><span class="ident" id="3979342">err</span>&nbsp;<span class="builtintype" id="3979346">error</span><span class="op" id="3979351">)</span>&nbsp;<span class="op" id="3979353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3979356">year</span>&nbsp;<span class="op" id="3979361">:=</span>&nbsp;<span class="ident" id="3979364">t</span><span class="op" id="3979365">.</span><span class="ident" id="3979366">Year</span><span class="op" id="3979370">(</span><span class="op" id="3979371">)</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979375">switch</span>&nbsp;<span class="op" id="3979382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979385">case</span>&nbsp;<span class="num" id="3979390">1950</span>&nbsp;<span class="op" id="3979395">&lt;=</span>&nbsp;<span class="ident" id="3979398">year</span>&nbsp;<span class="op" id="3979403">&amp;&amp;</span>&nbsp;<span class="ident" id="3979406">year</span>&nbsp;<span class="op" id="3979411">&lt;</span>&nbsp;<span class="num" id="3979413">2000</span><span class="op" id="3979417">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3979421">err</span>&nbsp;<span class="op" id="3979425">=</span>&nbsp;<span class="ident" id="3979427">marshalTwoDigits</span><span class="op" id="3979443">(</span><span class="ident" id="3979444">out</span><span class="op" id="3979447">,</span>&nbsp;<span class="builtintype" id="3979449">int</span><span class="op" id="3979452">(</span><span class="ident" id="3979453">year</span><span class="op" id="3979457">-</span><span class="num" id="3979458">1900</span><span class="op" id="3979462">)</span><span class="op" id="3979463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979466">case</span>&nbsp;<span class="num" id="3979471">2000</span>&nbsp;<span class="op" id="3979476">&lt;=</span>&nbsp;<span class="ident" id="3979479">year</span>&nbsp;<span class="op" id="3979484">&amp;&amp;</span>&nbsp;<span class="ident" id="3979487">year</span>&nbsp;<span class="op" id="3979492">&lt;</span>&nbsp;<span class="num" id="3979494">2050</span><span class="op" id="3979498">:</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3979502">err</span>&nbsp;<span class="op" id="3979506">=</span>&nbsp;<span class="ident" id="3979508">marshalTwoDigits</span><span class="op" id="3979524">(</span><span class="ident" id="3979525">out</span><span class="op" id="3979528">,</span>&nbsp;<span class="builtintype" id="3979530">int</span><span class="op" id="3979533">(</span><span class="ident" id="3979534">year</span><span class="op" id="3979538">-</span><span class="num" id="3979539">2000</span><span class="op" id="3979543">)</span><span class="op" id="3979544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979547">default</span><span class="op" id="3979554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979558">return</span>&nbsp;<span class="ident" id="3979565">StructuralError</span><span class="op" id="3979580">{</span><span class="string" id="3979581">&#34;cannot&nbsp;represent&nbsp;time&nbsp;as&nbsp;UTCTime&#34;</span><span class="op" id="3979615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3979618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979621">if</span>&nbsp;<span class="ident" id="3979624">err</span>&nbsp;<span class="op" id="3979628">!=</span>&nbsp;<span class="ident" id="3979631">nil</span>&nbsp;<span class="op" id="3979635">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979639">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3979647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979651">return</span>&nbsp;<span class="ident" id="3979658">marshalTimeCommon</span><span class="op" id="3979675">(</span><span class="ident" id="3979676">out</span><span class="op" id="3979679">,</span>&nbsp;<span class="ident" id="3979681">t</span><span class="op" id="3979682">)</span><br>
<span class="lineno"></span><span class="op" id="3979684">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="3979687">func</span>&nbsp;<span class="ident" id="3979692">marshalGeneralizedTime</span><span class="op" id="3979714">(</span><span class="ident" id="3979715">out</span>&nbsp;<span class="op" id="3979719">*</span><span class="ident" id="3979720">forkableWriter</span><span class="op" id="3979734">,</span>&nbsp;<span class="ident" id="3979736">t</span>&nbsp;<span class="ident" id="3979738">time</span><span class="op" id="3979742">.</span><span class="ident" id="3979743">Time</span><span class="op" id="3979747">)</span>&nbsp;<span class="op" id="3979749">(</span><span class="ident" id="3979750">err</span>&nbsp;<span class="builtintype" id="3979754">error</span><span class="op" id="3979759">)</span>&nbsp;<span class="op" id="3979761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3979764">year</span>&nbsp;<span class="op" id="3979769">:=</span>&nbsp;<span class="ident" id="3979772">t</span><span class="op" id="3979773">.</span><span class="ident" id="3979774">Year</span><span class="op" id="3979778">(</span><span class="op" id="3979779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979782">if</span>&nbsp;<span class="ident" id="3979785">year</span>&nbsp;<span class="op" id="3979790">&lt;</span>&nbsp;<span class="num" id="3979792">0</span>&nbsp;<span class="op" id="3979794">||</span>&nbsp;<span class="ident" id="3979797">year</span>&nbsp;<span class="op" id="3979802">&gt;</span>&nbsp;<span class="num" id="3979804">9999</span>&nbsp;<span class="op" id="3979809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979813">return</span>&nbsp;<span class="ident" id="3979820">StructuralError</span><span class="op" id="3979835">{</span><span class="string" id="3979836">&#34;cannot&nbsp;represent&nbsp;time&nbsp;as&nbsp;GeneralizedTime&#34;</span><span class="op" id="3979878">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3979881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979884">if</span>&nbsp;<span class="ident" id="3979887">err</span>&nbsp;<span class="op" id="3979891">=</span>&nbsp;<span class="ident" id="3979893">marshalFourDigits</span><span class="op" id="3979910">(</span><span class="ident" id="3979911">out</span><span class="op" id="3979914">,</span>&nbsp;<span class="ident" id="3979916">year</span><span class="op" id="3979920">)</span><span class="op" id="3979921">;</span>&nbsp;<span class="ident" id="3979923">err</span>&nbsp;<span class="op" id="3979927">!=</span>&nbsp;<span class="ident" id="3979930">nil</span>&nbsp;<span class="op" id="3979934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979938">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3979946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979950">return</span>&nbsp;<span class="ident" id="3979957">marshalTimeCommon</span><span class="op" id="3979974">(</span><span class="ident" id="3979975">out</span><span class="op" id="3979978">,</span>&nbsp;<span class="ident" id="3979980">t</span><span class="op" id="3979981">)</span><br>
<span class="lineno"></span><span class="op" id="3979983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3979986">func</span>&nbsp;<span class="ident" id="3979991">marshalTimeCommon</span><span class="op" id="3980008">(</span><span class="ident" id="3980009">out</span>&nbsp;<span class="op" id="3980013">*</span><span class="ident" id="3980014">forkableWriter</span><span class="op" id="3980028">,</span>&nbsp;<span class="ident" id="3980030">t</span>&nbsp;<span class="ident" id="3980032">time</span><span class="op" id="3980036">.</span><span class="ident" id="3980037">Time</span><span class="op" id="3980041">)</span>&nbsp;<span class="op" id="3980043">(</span><span class="ident" id="3980044">err</span>&nbsp;<span class="builtintype" id="3980048">error</span><span class="op" id="3980053">)</span>&nbsp;<span class="op" id="3980055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980058">_</span><span class="op" id="3980059">,</span>&nbsp;<span class="ident" id="3980061">month</span><span class="op" id="3980066">,</span>&nbsp;<span class="ident" id="3980068">day</span>&nbsp;<span class="op" id="3980072">:=</span>&nbsp;<span class="ident" id="3980075">t</span><span class="op" id="3980076">.</span><span class="ident" id="3980077">Date</span><span class="op" id="3980081">(</span><span class="op" id="3980082">)</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980086">err</span>&nbsp;<span class="op" id="3980090">=</span>&nbsp;<span class="ident" id="3980092">marshalTwoDigits</span><span class="op" id="3980108">(</span><span class="ident" id="3980109">out</span><span class="op" id="3980112">,</span>&nbsp;<span class="builtintype" id="3980114">int</span><span class="op" id="3980117">(</span><span class="ident" id="3980118">month</span><span class="op" id="3980123">)</span><span class="op" id="3980124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980127">if</span>&nbsp;<span class="ident" id="3980130">err</span>&nbsp;<span class="op" id="3980134">!=</span>&nbsp;<span class="ident" id="3980137">nil</span>&nbsp;<span class="op" id="3980141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980145">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3980153">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980157">err</span>&nbsp;<span class="op" id="3980161">=</span>&nbsp;<span class="ident" id="3980163">marshalTwoDigits</span><span class="op" id="3980179">(</span><span class="ident" id="3980180">out</span><span class="op" id="3980183">,</span>&nbsp;<span class="ident" id="3980185">day</span><span class="op" id="3980188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980191">if</span>&nbsp;<span class="ident" id="3980194">err</span>&nbsp;<span class="op" id="3980198">!=</span>&nbsp;<span class="ident" id="3980201">nil</span>&nbsp;<span class="op" id="3980205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980209">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3980217">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980221">hour</span><span class="op" id="3980225">,</span>&nbsp;<span class="ident" id="3980227">min</span><span class="op" id="3980230">,</span>&nbsp;<span class="ident" id="3980232">sec</span>&nbsp;<span class="op" id="3980236">:=</span>&nbsp;<span class="ident" id="3980239">t</span><span class="op" id="3980240">.</span><span class="ident" id="3980241">Clock</span><span class="op" id="3980246">(</span><span class="op" id="3980247">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980251">err</span>&nbsp;<span class="op" id="3980255">=</span>&nbsp;<span class="ident" id="3980257">marshalTwoDigits</span><span class="op" id="3980273">(</span><span class="ident" id="3980274">out</span><span class="op" id="3980277">,</span>&nbsp;<span class="ident" id="3980279">hour</span><span class="op" id="3980283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980286">if</span>&nbsp;<span class="ident" id="3980289">err</span>&nbsp;<span class="op" id="3980293">!=</span>&nbsp;<span class="ident" id="3980296">nil</span>&nbsp;<span class="op" id="3980300">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980304">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3980312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980316">err</span>&nbsp;<span class="op" id="3980320">=</span>&nbsp;<span class="ident" id="3980322">marshalTwoDigits</span><span class="op" id="3980338">(</span><span class="ident" id="3980339">out</span><span class="op" id="3980342">,</span>&nbsp;<span class="ident" id="3980344">min</span><span class="op" id="3980347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980350">if</span>&nbsp;<span class="ident" id="3980353">err</span>&nbsp;<span class="op" id="3980357">!=</span>&nbsp;<span class="ident" id="3980360">nil</span>&nbsp;<span class="op" id="3980364">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980368">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3980376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980380">err</span>&nbsp;<span class="op" id="3980384">=</span>&nbsp;<span class="ident" id="3980386">marshalTwoDigits</span><span class="op" id="3980402">(</span><span class="ident" id="3980403">out</span><span class="op" id="3980406">,</span>&nbsp;<span class="ident" id="3980408">sec</span><span class="op" id="3980411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980414">if</span>&nbsp;<span class="ident" id="3980417">err</span>&nbsp;<span class="op" id="3980421">!=</span>&nbsp;<span class="ident" id="3980424">nil</span>&nbsp;<span class="op" id="3980428">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980432">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3980440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980444">_</span><span class="op" id="3980445">,</span>&nbsp;<span class="ident" id="3980447">offset</span>&nbsp;<span class="op" id="3980454">:=</span>&nbsp;<span class="ident" id="3980457">t</span><span class="op" id="3980458">.</span><span class="ident" id="3980459">Zone</span><span class="op" id="3980463">(</span><span class="op" id="3980464">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980468">switch</span>&nbsp;<span class="op" id="3980475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980478">case</span>&nbsp;<span class="ident" id="3980483">offset</span><span class="op" id="3980489">/</span><span class="num" id="3980490">60</span>&nbsp;<span class="op" id="3980493">==</span>&nbsp;<span class="num" id="3980496">0</span><span class="op" id="3980497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980501">err</span>&nbsp;<span class="op" id="3980505">=</span>&nbsp;<span class="ident" id="3980507">out</span><span class="op" id="3980510">.</span><span class="ident" id="3980511">WriteByte</span><span class="op" id="3980520">(</span><span class="string" id="3980521">&#39;Z&#39;</span><span class="op" id="3980524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980528">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980536">case</span>&nbsp;<span class="ident" id="3980541">offset</span>&nbsp;<span class="op" id="3980548">&gt;</span>&nbsp;<span class="num" id="3980550">0</span><span class="op" id="3980551">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980555">err</span>&nbsp;<span class="op" id="3980559">=</span>&nbsp;<span class="ident" id="3980561">out</span><span class="op" id="3980564">.</span><span class="ident" id="3980565">WriteByte</span><span class="op" id="3980574">(</span><span class="string" id="3980575">&#39;+&#39;</span><span class="op" id="3980578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980581">case</span>&nbsp;<span class="ident" id="3980586">offset</span>&nbsp;<span class="op" id="3980593">&lt;</span>&nbsp;<span class="num" id="3980595">0</span><span class="op" id="3980596">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980600">err</span>&nbsp;<span class="op" id="3980604">=</span>&nbsp;<span class="ident" id="3980606">out</span><span class="op" id="3980609">.</span><span class="ident" id="3980610">WriteByte</span><span class="op" id="3980619">(</span><span class="string" id="3980620">&#39;-&#39;</span><span class="op" id="3980623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3980626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980630">if</span>&nbsp;<span class="ident" id="3980633">err</span>&nbsp;<span class="op" id="3980637">!=</span>&nbsp;<span class="ident" id="3980640">nil</span>&nbsp;<span class="op" id="3980644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980648">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3980656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980660">offsetMinutes</span>&nbsp;<span class="op" id="3980674">:=</span>&nbsp;<span class="ident" id="3980677">offset</span>&nbsp;<span class="op" id="3980684">/</span>&nbsp;<span class="num" id="3980686">60</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980690">if</span>&nbsp;<span class="ident" id="3980693">offsetMinutes</span>&nbsp;<span class="op" id="3980707">&lt;</span>&nbsp;<span class="num" id="3980709">0</span>&nbsp;<span class="op" id="3980711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980715">offsetMinutes</span>&nbsp;<span class="op" id="3980729">=</span>&nbsp;<span class="op" id="3980731">-</span><span class="ident" id="3980732">offsetMinutes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3980747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980751">err</span>&nbsp;<span class="op" id="3980755">=</span>&nbsp;<span class="ident" id="3980757">marshalTwoDigits</span><span class="op" id="3980773">(</span><span class="ident" id="3980774">out</span><span class="op" id="3980777">,</span>&nbsp;<span class="ident" id="3980779">offsetMinutes</span><span class="op" id="3980792">/</span><span class="num" id="3980793">60</span><span class="op" id="3980795">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980798">if</span>&nbsp;<span class="ident" id="3980801">err</span>&nbsp;<span class="op" id="3980805">!=</span>&nbsp;<span class="ident" id="3980808">nil</span>&nbsp;<span class="op" id="3980812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980816">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3980824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980828">err</span>&nbsp;<span class="op" id="3980832">=</span>&nbsp;<span class="ident" id="3980834">marshalTwoDigits</span><span class="op" id="3980850">(</span><span class="ident" id="3980851">out</span><span class="op" id="3980854">,</span>&nbsp;<span class="ident" id="3980856">offsetMinutes</span><span class="op" id="3980869">%</span><span class="num" id="3980870">60</span><span class="op" id="3980872">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980875">return</span><br>
<span class="lineno"></span><span class="op" id="3980882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3980885">func</span>&nbsp;<span class="ident" id="3980890">stripTagAndLength</span><span class="op" id="3980907">(</span><span class="ident" id="3980908">in</span>&nbsp;<span class="op" id="3980911">[</span><span class="op" id="3980912">]</span><span class="builtintype" id="3980913">byte</span><span class="op" id="3980917">)</span>&nbsp;<span class="op" id="3980919">[</span><span class="op" id="3980920">]</span><span class="builtintype" id="3980921">byte</span>&nbsp;<span class="op" id="3980926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980929">_</span><span class="op" id="3980930">,</span>&nbsp;<span class="ident" id="3980932">offset</span><span class="op" id="3980938">,</span>&nbsp;<span class="ident" id="3980940">err</span>&nbsp;<span class="op" id="3980944">:=</span>&nbsp;<span class="ident" id="3980947">parseTagAndLength</span><span class="op" id="3980964">(</span><span class="ident" id="3980965">in</span><span class="op" id="3980967">,</span>&nbsp;<span class="num" id="3980969">0</span><span class="op" id="3980970">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980973">if</span>&nbsp;<span class="ident" id="3980976">err</span>&nbsp;<span class="op" id="3980980">!=</span>&nbsp;<span class="ident" id="3980983">nil</span>&nbsp;<span class="op" id="3980987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980991">return</span>&nbsp;<span class="ident" id="3980998">in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3981002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981005">return</span>&nbsp;<span class="ident" id="3981012">in</span><span class="op" id="3981014">[</span><span class="ident" id="3981015">offset</span><span class="op" id="3981021">:</span><span class="op" id="3981022">]</span><br>
<span class="lineno"></span><span class="op" id="3981024">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span><span class="keyword" id="3981027">func</span>&nbsp;<span class="ident" id="3981032">marshalBody</span><span class="op" id="3981043">(</span><span class="ident" id="3981044">out</span>&nbsp;<span class="op" id="3981048">*</span><span class="ident" id="3981049">forkableWriter</span><span class="op" id="3981063">,</span>&nbsp;<span class="ident" id="3981065">value</span>&nbsp;<span class="ident" id="3981071">reflect</span><span class="op" id="3981078">.</span><span class="ident" id="3981079">Value</span><span class="op" id="3981084">,</span>&nbsp;<span class="ident" id="3981086">params</span>&nbsp;<span class="ident" id="3981093">fieldParameters</span><span class="op" id="3981108">)</span>&nbsp;<span class="op" id="3981110">(</span><span class="ident" id="3981111">err</span>&nbsp;<span class="builtintype" id="3981115">error</span><span class="op" id="3981120">)</span>&nbsp;<span class="op" id="3981122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981125">switch</span>&nbsp;<span class="ident" id="3981132">value</span><span class="op" id="3981137">.</span><span class="ident" id="3981138">Type</span><span class="op" id="3981142">(</span><span class="op" id="3981143">)</span>&nbsp;<span class="op" id="3981145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981148">case</span>&nbsp;<span class="ident" id="3981153">timeType</span><span class="op" id="3981161">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981165">t</span>&nbsp;<span class="op" id="3981167">:=</span>&nbsp;<span class="ident" id="3981170">value</span><span class="op" id="3981175">.</span><span class="ident" id="3981176">Interface</span><span class="op" id="3981185">(</span><span class="op" id="3981186">)</span><span class="op" id="3981187">.</span><span class="op" id="3981188">(</span><span class="ident" id="3981189">time</span><span class="op" id="3981193">.</span><span class="ident" id="3981194">Time</span><span class="op" id="3981198">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981202">if</span>&nbsp;<span class="ident" id="3981205">outsideUTCRange</span><span class="op" id="3981220">(</span><span class="ident" id="3981221">t</span><span class="op" id="3981222">)</span>&nbsp;<span class="op" id="3981224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981229">return</span>&nbsp;<span class="ident" id="3981236">marshalGeneralizedTime</span><span class="op" id="3981258">(</span><span class="ident" id="3981259">out</span><span class="op" id="3981262">,</span>&nbsp;<span class="ident" id="3981264">t</span><span class="op" id="3981265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3981269">}</span>&nbsp;<span class="keyword" id="3981271">else</span>&nbsp;<span class="op" id="3981276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981281">return</span>&nbsp;<span class="ident" id="3981288">marshalUTCTime</span><span class="op" id="3981302">(</span><span class="ident" id="3981303">out</span><span class="op" id="3981306">,</span>&nbsp;<span class="ident" id="3981308">t</span><span class="op" id="3981309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3981313">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981316">case</span>&nbsp;<span class="ident" id="3981321">bitStringType</span><span class="op" id="3981334">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981338">return</span>&nbsp;<span class="ident" id="3981345">marshalBitString</span><span class="op" id="3981361">(</span><span class="ident" id="3981362">out</span><span class="op" id="3981365">,</span>&nbsp;<span class="ident" id="3981367">value</span><span class="op" id="3981372">.</span><span class="ident" id="3981373">Interface</span><span class="op" id="3981382">(</span><span class="op" id="3981383">)</span><span class="op" id="3981384">.</span><span class="op" id="3981385">(</span><span class="ident" id="3981386">BitString</span><span class="op" id="3981395">)</span><span class="op" id="3981396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981399">case</span>&nbsp;<span class="ident" id="3981404">objectIdentifierType</span><span class="op" id="3981424">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981428">return</span>&nbsp;<span class="ident" id="3981435">marshalObjectIdentifier</span><span class="op" id="3981458">(</span><span class="ident" id="3981459">out</span><span class="op" id="3981462">,</span>&nbsp;<span class="ident" id="3981464">value</span><span class="op" id="3981469">.</span><span class="ident" id="3981470">Interface</span><span class="op" id="3981479">(</span><span class="op" id="3981480">)</span><span class="op" id="3981481">.</span><span class="op" id="3981482">(</span><span class="ident" id="3981483">ObjectIdentifier</span><span class="op" id="3981499">)</span><span class="op" id="3981500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981503">case</span>&nbsp;<span class="ident" id="3981508">bigIntType</span><span class="op" id="3981518">:</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981522">return</span>&nbsp;<span class="ident" id="3981529">marshalBigInt</span><span class="op" id="3981542">(</span><span class="ident" id="3981543">out</span><span class="op" id="3981546">,</span>&nbsp;<span class="ident" id="3981548">value</span><span class="op" id="3981553">.</span><span class="ident" id="3981554">Interface</span><span class="op" id="3981563">(</span><span class="op" id="3981564">)</span><span class="op" id="3981565">.</span><span class="op" id="3981566">(</span><span class="op" id="3981567">*</span><span class="ident" id="3981568">big</span><span class="op" id="3981571">.</span><span class="ident" id="3981572">Int</span><span class="op" id="3981575">)</span><span class="op" id="3981576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3981579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981583">switch</span>&nbsp;<span class="ident" id="3981590">v</span>&nbsp;<span class="op" id="3981592">:=</span>&nbsp;<span class="ident" id="3981595">value</span><span class="op" id="3981600">;</span>&nbsp;<span class="ident" id="3981602">v</span><span class="op" id="3981603">.</span><span class="ident" id="3981604">Kind</span><span class="op" id="3981608">(</span><span class="op" id="3981609">)</span>&nbsp;<span class="op" id="3981611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981614">case</span>&nbsp;<span class="ident" id="3981619">reflect</span><span class="op" id="3981626">.</span><span class="ident" id="3981627">Bool</span><span class="op" id="3981631">:</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981635">if</span>&nbsp;<span class="ident" id="3981638">v</span><span class="op" id="3981639">.</span><span class="ident" id="3981640">Bool</span><span class="op" id="3981644">(</span><span class="op" id="3981645">)</span>&nbsp;<span class="op" id="3981647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981652">return</span>&nbsp;<span class="ident" id="3981659">out</span><span class="op" id="3981662">.</span><span class="ident" id="3981663">WriteByte</span><span class="op" id="3981672">(</span><span class="num" id="3981673">255</span><span class="op" id="3981676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3981680">}</span>&nbsp;<span class="keyword" id="3981682">else</span>&nbsp;<span class="op" id="3981687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981692">return</span>&nbsp;<span class="ident" id="3981699">out</span><span class="op" id="3981702">.</span><span class="ident" id="3981703">WriteByte</span><span class="op" id="3981712">(</span><span class="num" id="3981713">0</span><span class="op" id="3981714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3981718">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981721">case</span>&nbsp;<span class="ident" id="3981726">reflect</span><span class="op" id="3981733">.</span><span class="ident" id="3981734">Int</span><span class="op" id="3981737">,</span>&nbsp;<span class="ident" id="3981739">reflect</span><span class="op" id="3981746">.</span><span class="ident" id="3981747">Int8</span><span class="op" id="3981751">,</span>&nbsp;<span class="ident" id="3981753">reflect</span><span class="op" id="3981760">.</span><span class="ident" id="3981761">Int16</span><span class="op" id="3981766">,</span>&nbsp;<span class="ident" id="3981768">reflect</span><span class="op" id="3981775">.</span><span class="ident" id="3981776">Int32</span><span class="op" id="3981781">,</span>&nbsp;<span class="ident" id="3981783">reflect</span><span class="op" id="3981790">.</span><span class="ident" id="3981791">Int64</span><span class="op" id="3981796">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981800">return</span>&nbsp;<span class="ident" id="3981807">marshalInt64</span><span class="op" id="3981819">(</span><span class="ident" id="3981820">out</span><span class="op" id="3981823">,</span>&nbsp;<span class="ident" id="3981825">int64</span><span class="op" id="3981830">(</span><span class="ident" id="3981831">v</span><span class="op" id="3981832">.</span><span class="ident" id="3981833">Int</span><span class="op" id="3981836">(</span><span class="op" id="3981837">)</span><span class="op" id="3981838">)</span><span class="op" id="3981839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981842">case</span>&nbsp;<span class="ident" id="3981847">reflect</span><span class="op" id="3981854">.</span><span class="ident" id="3981855">Struct</span><span class="op" id="3981861">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981865">t</span>&nbsp;<span class="op" id="3981867">:=</span>&nbsp;<span class="ident" id="3981870">v</span><span class="op" id="3981871">.</span><span class="ident" id="3981872">Type</span><span class="op" id="3981876">(</span><span class="op" id="3981877">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981882">startingField</span>&nbsp;<span class="op" id="3981896">:=</span>&nbsp;<span class="num" id="3981899">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3981904">//&nbsp;If&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;the&nbsp;structure&nbsp;is&nbsp;a&nbsp;non-empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3981962">//&nbsp;RawContents,&nbsp;then&nbsp;we&nbsp;don&#39;t&nbsp;bother&nbsp;serializing&nbsp;the&nbsp;rest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982023">if</span>&nbsp;<span class="ident" id="3982026">t</span><span class="op" id="3982027">.</span><span class="ident" id="3982028">NumField</span><span class="op" id="3982036">(</span><span class="op" id="3982037">)</span>&nbsp;<span class="op" id="3982039">&gt;</span>&nbsp;<span class="num" id="3982041">0</span>&nbsp;<span class="op" id="3982043">&amp;&amp;</span>&nbsp;<span class="ident" id="3982046">t</span><span class="op" id="3982047">.</span><span class="ident" id="3982048">Field</span><span class="op" id="3982053">(</span><span class="num" id="3982054">0</span><span class="op" id="3982055">)</span><span class="op" id="3982056">.</span><span class="ident" id="3982057">Type</span>&nbsp;<span class="op" id="3982062">==</span>&nbsp;<span class="ident" id="3982065">rawContentsType</span>&nbsp;<span class="op" id="3982081">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982086">s</span>&nbsp;<span class="op" id="3982088">:=</span>&nbsp;<span class="ident" id="3982091">v</span><span class="op" id="3982092">.</span><span class="ident" id="3982093">Field</span><span class="op" id="3982098">(</span><span class="num" id="3982099">0</span><span class="op" id="3982100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982105">if</span>&nbsp;<span class="ident" id="3982108">s</span><span class="op" id="3982109">.</span><span class="ident" id="3982110">Len</span><span class="op" id="3982113">(</span><span class="op" id="3982114">)</span>&nbsp;<span class="op" id="3982116">&gt;</span>&nbsp;<span class="num" id="3982118">0</span>&nbsp;<span class="op" id="3982120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982126">bytes</span>&nbsp;<span class="op" id="3982132">:=</span>&nbsp;<span class="builtinfunc" id="3982135">make</span><span class="op" id="3982139">(</span><span class="op" id="3982140">[</span><span class="op" id="3982141">]</span><span class="builtintype" id="3982142">byte</span><span class="op" id="3982146">,</span>&nbsp;<span class="ident" id="3982148">s</span><span class="op" id="3982149">.</span><span class="ident" id="3982150">Len</span><span class="op" id="3982153">(</span><span class="op" id="3982154">)</span><span class="op" id="3982155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982161">for</span>&nbsp;<span class="ident" id="3982165">i</span>&nbsp;<span class="op" id="3982167">:=</span>&nbsp;<span class="num" id="3982170">0</span><span class="op" id="3982171">;</span>&nbsp;<span class="ident" id="3982173">i</span>&nbsp;<span class="op" id="3982175">&lt;</span>&nbsp;<span class="ident" id="3982177">s</span><span class="op" id="3982178">.</span><span class="ident" id="3982179">Len</span><span class="op" id="3982182">(</span><span class="op" id="3982183">)</span><span class="op" id="3982184">;</span>&nbsp;<span class="ident" id="3982186">i</span><span class="op" id="3982187">++</span>&nbsp;<span class="op" id="3982190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982197">bytes</span><span class="op" id="3982202">[</span><span class="ident" id="3982203">i</span><span class="op" id="3982204">]</span>&nbsp;<span class="op" id="3982206">=</span>&nbsp;<span class="builtintype" id="3982208">uint8</span><span class="op" id="3982213">(</span><span class="ident" id="3982214">s</span><span class="op" id="3982215">.</span><span class="ident" id="3982216">Index</span><span class="op" id="3982221">(</span><span class="ident" id="3982222">i</span><span class="op" id="3982223">)</span><span class="op" id="3982224">.</span><span class="ident" id="3982225">Uint</span><span class="op" id="3982229">(</span><span class="op" id="3982230">)</span><span class="op" id="3982231">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3982237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3982243">/*&nbsp;The&nbsp;RawContents&nbsp;will&nbsp;contain&nbsp;the&nbsp;tag&nbsp;and<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;length&nbsp;fields&nbsp;but&nbsp;we&#39;ll&nbsp;also&nbsp;be&nbsp;writing<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;those&nbsp;ourselves,&nbsp;so&nbsp;we&nbsp;strip&nbsp;them&nbsp;out&nbsp;of<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;bytes&nbsp;*/</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982402">_</span><span class="op" id="3982403">,</span>&nbsp;<span class="ident" id="3982405">err</span>&nbsp;<span class="op" id="3982409">=</span>&nbsp;<span class="ident" id="3982411">out</span><span class="op" id="3982414">.</span><span class="ident" id="3982415">Write</span><span class="op" id="3982420">(</span><span class="ident" id="3982421">stripTagAndLength</span><span class="op" id="3982438">(</span><span class="ident" id="3982439">bytes</span><span class="op" id="3982444">)</span><span class="op" id="3982445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982451">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3982461">}</span>&nbsp;<span class="keyword" id="3982463">else</span>&nbsp;<span class="op" id="3982468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982474">startingField</span>&nbsp;<span class="op" id="3982488">=</span>&nbsp;<span class="num" id="3982490">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3982495">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3982499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982504">for</span>&nbsp;<span class="ident" id="3982508">i</span>&nbsp;<span class="op" id="3982510">:=</span>&nbsp;<span class="ident" id="3982513">startingField</span><span class="op" id="3982526">;</span>&nbsp;<span class="ident" id="3982528">i</span>&nbsp;<span class="op" id="3982530">&lt;</span>&nbsp;<span class="ident" id="3982532">t</span><span class="op" id="3982533">.</span><span class="ident" id="3982534">NumField</span><span class="op" id="3982542">(</span><span class="op" id="3982543">)</span><span class="op" id="3982544">;</span>&nbsp;<span class="ident" id="3982546">i</span><span class="op" id="3982547">++</span>&nbsp;<span class="op" id="3982550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982555">var</span>&nbsp;<span class="ident" id="3982559">pre</span>&nbsp;<span class="op" id="3982563">*</span><span class="ident" id="3982564">forkableWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982582">pre</span><span class="op" id="3982585">,</span>&nbsp;<span class="ident" id="3982587">out</span>&nbsp;<span class="op" id="3982591">=</span>&nbsp;<span class="ident" id="3982593">out</span><span class="op" id="3982596">.</span><span class="ident" id="3982597">fork</span><span class="op" id="3982601">(</span><span class="op" id="3982602">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982607">err</span>&nbsp;<span class="op" id="3982611">=</span>&nbsp;<span class="ident" id="3982613">marshalField</span><span class="op" id="3982625">(</span><span class="ident" id="3982626">pre</span><span class="op" id="3982629">,</span>&nbsp;<span class="ident" id="3982631">v</span><span class="op" id="3982632">.</span><span class="ident" id="3982633">Field</span><span class="op" id="3982638">(</span><span class="ident" id="3982639">i</span><span class="op" id="3982640">)</span><span class="op" id="3982641">,</span>&nbsp;<span class="ident" id="3982643">parseFieldParameters</span><span class="op" id="3982663">(</span><span class="ident" id="3982664">t</span><span class="op" id="3982665">.</span><span class="ident" id="3982666">Field</span><span class="op" id="3982671">(</span><span class="ident" id="3982672">i</span><span class="op" id="3982673">)</span><span class="op" id="3982674">.</span><span class="ident" id="3982675">Tag</span><span class="op" id="3982678">.</span><span class="ident" id="3982679">Get</span><span class="op" id="3982682">(</span><span class="string" id="3982683">&#34;asn1&#34;</span><span class="op" id="3982689">)</span><span class="op" id="3982690">)</span><span class="op" id="3982691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982696">if</span>&nbsp;<span class="ident" id="3982699">err</span>&nbsp;<span class="op" id="3982703">!=</span>&nbsp;<span class="ident" id="3982706">nil</span>&nbsp;<span class="op" id="3982710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982716">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3982726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3982730">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982734">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982742">case</span>&nbsp;<span class="ident" id="3982747">reflect</span><span class="op" id="3982754">.</span><span class="ident" id="3982755">Slice</span><span class="op" id="3982760">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982764">sliceType</span>&nbsp;<span class="op" id="3982774">:=</span>&nbsp;<span class="ident" id="3982777">v</span><span class="op" id="3982778">.</span><span class="ident" id="3982779">Type</span><span class="op" id="3982783">(</span><span class="op" id="3982784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982788">if</span>&nbsp;<span class="ident" id="3982791">sliceType</span><span class="op" id="3982800">.</span><span class="ident" id="3982801">Elem</span><span class="op" id="3982805">(</span><span class="op" id="3982806">)</span><span class="op" id="3982807">.</span><span class="ident" id="3982808">Kind</span><span class="op" id="3982812">(</span><span class="op" id="3982813">)</span>&nbsp;<span class="op" id="3982815">==</span>&nbsp;<span class="ident" id="3982818">reflect</span><span class="op" id="3982825">.</span><span class="ident" id="3982826">Uint8</span>&nbsp;<span class="op" id="3982832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982837">bytes</span>&nbsp;<span class="op" id="3982843">:=</span>&nbsp;<span class="builtinfunc" id="3982846">make</span><span class="op" id="3982850">(</span><span class="op" id="3982851">[</span><span class="op" id="3982852">]</span><span class="builtintype" id="3982853">byte</span><span class="op" id="3982857">,</span>&nbsp;<span class="ident" id="3982859">v</span><span class="op" id="3982860">.</span><span class="ident" id="3982861">Len</span><span class="op" id="3982864">(</span><span class="op" id="3982865">)</span><span class="op" id="3982866">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982871">for</span>&nbsp;<span class="ident" id="3982875">i</span>&nbsp;<span class="op" id="3982877">:=</span>&nbsp;<span class="num" id="3982880">0</span><span class="op" id="3982881">;</span>&nbsp;<span class="ident" id="3982883">i</span>&nbsp;<span class="op" id="3982885">&lt;</span>&nbsp;<span class="ident" id="3982887">v</span><span class="op" id="3982888">.</span><span class="ident" id="3982889">Len</span><span class="op" id="3982892">(</span><span class="op" id="3982893">)</span><span class="op" id="3982894">;</span>&nbsp;<span class="ident" id="3982896">i</span><span class="op" id="3982897">++</span>&nbsp;<span class="op" id="3982900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982906">bytes</span><span class="op" id="3982911">[</span><span class="ident" id="3982912">i</span><span class="op" id="3982913">]</span>&nbsp;<span class="op" id="3982915">=</span>&nbsp;<span class="builtintype" id="3982917">uint8</span><span class="op" id="3982922">(</span><span class="ident" id="3982923">v</span><span class="op" id="3982924">.</span><span class="ident" id="3982925">Index</span><span class="op" id="3982930">(</span><span class="ident" id="3982931">i</span><span class="op" id="3982932">)</span><span class="op" id="3982933">.</span><span class="ident" id="3982934">Uint</span><span class="op" id="3982938">(</span><span class="op" id="3982939">)</span><span class="op" id="3982940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3982945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982950">_</span><span class="op" id="3982951">,</span>&nbsp;<span class="ident" id="3982953">err</span>&nbsp;<span class="op" id="3982957">=</span>&nbsp;<span class="ident" id="3982959">out</span><span class="op" id="3982962">.</span><span class="ident" id="3982963">Write</span><span class="op" id="3982968">(</span><span class="ident" id="3982969">bytes</span><span class="op" id="3982974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982979">return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3982988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982993">var</span>&nbsp;<span class="ident" id="3982997">fp</span>&nbsp;<span class="ident" id="3983000">fieldParameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983018">for</span>&nbsp;<span class="ident" id="3983022">i</span>&nbsp;<span class="op" id="3983024">:=</span>&nbsp;<span class="num" id="3983027">0</span><span class="op" id="3983028">;</span>&nbsp;<span class="ident" id="3983030">i</span>&nbsp;<span class="op" id="3983032">&lt;</span>&nbsp;<span class="ident" id="3983034">v</span><span class="op" id="3983035">.</span><span class="ident" id="3983036">Len</span><span class="op" id="3983039">(</span><span class="op" id="3983040">)</span><span class="op" id="3983041">;</span>&nbsp;<span class="ident" id="3983043">i</span><span class="op" id="3983044">++</span>&nbsp;<span class="op" id="3983047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983052">var</span>&nbsp;<span class="ident" id="3983056">pre</span>&nbsp;<span class="op" id="3983060">*</span><span class="ident" id="3983061">forkableWriter</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983079">pre</span><span class="op" id="3983082">,</span>&nbsp;<span class="ident" id="3983084">out</span>&nbsp;<span class="op" id="3983088">=</span>&nbsp;<span class="ident" id="3983090">out</span><span class="op" id="3983093">.</span><span class="ident" id="3983094">fork</span><span class="op" id="3983098">(</span><span class="op" id="3983099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983104">err</span>&nbsp;<span class="op" id="3983108">=</span>&nbsp;<span class="ident" id="3983110">marshalField</span><span class="op" id="3983122">(</span><span class="ident" id="3983123">pre</span><span class="op" id="3983126">,</span>&nbsp;<span class="ident" id="3983128">v</span><span class="op" id="3983129">.</span><span class="ident" id="3983130">Index</span><span class="op" id="3983135">(</span><span class="ident" id="3983136">i</span><span class="op" id="3983137">)</span><span class="op" id="3983138">,</span>&nbsp;<span class="ident" id="3983140">fp</span><span class="op" id="3983142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983147">if</span>&nbsp;<span class="ident" id="3983150">err</span>&nbsp;<span class="op" id="3983154">!=</span>&nbsp;<span class="ident" id="3983157">nil</span>&nbsp;<span class="op" id="3983161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983167">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983177">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983185">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983193">case</span>&nbsp;<span class="ident" id="3983198">reflect</span><span class="op" id="3983205">.</span><span class="ident" id="3983206">String</span><span class="op" id="3983212">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983216">switch</span>&nbsp;<span class="ident" id="3983223">params</span><span class="op" id="3983229">.</span><span class="ident" id="3983230">stringType</span>&nbsp;<span class="op" id="3983241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983245">case</span>&nbsp;<span class="ident" id="3983250">tagIA5String</span><span class="op" id="3983262">:</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983267">return</span>&nbsp;<span class="ident" id="3983274">marshalIA5String</span><span class="op" id="3983290">(</span><span class="ident" id="3983291">out</span><span class="op" id="3983294">,</span>&nbsp;<span class="ident" id="3983296">v</span><span class="op" id="3983297">.</span><span class="ident" id="3983298">String</span><span class="op" id="3983304">(</span><span class="op" id="3983305">)</span><span class="op" id="3983306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983310">case</span>&nbsp;<span class="ident" id="3983315">tagPrintableString</span><span class="op" id="3983333">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983338">return</span>&nbsp;<span class="ident" id="3983345">marshalPrintableString</span><span class="op" id="3983367">(</span><span class="ident" id="3983368">out</span><span class="op" id="3983371">,</span>&nbsp;<span class="ident" id="3983373">v</span><span class="op" id="3983374">.</span><span class="ident" id="3983375">String</span><span class="op" id="3983381">(</span><span class="op" id="3983382">)</span><span class="op" id="3983383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983387">default</span><span class="op" id="3983394">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983399">return</span>&nbsp;<span class="ident" id="3983406">marshalUTF8String</span><span class="op" id="3983423">(</span><span class="ident" id="3983424">out</span><span class="op" id="3983427">,</span>&nbsp;<span class="ident" id="3983429">v</span><span class="op" id="3983430">.</span><span class="ident" id="3983431">String</span><span class="op" id="3983437">(</span><span class="op" id="3983438">)</span><span class="op" id="3983439">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983450">return</span>&nbsp;<span class="ident" id="3983457">StructuralError</span><span class="op" id="3983472">{</span><span class="string" id="3983473">&#34;unknown&nbsp;Go&nbsp;type&#34;</span><span class="op" id="3983490">}</span><br>
<span class="lineno"></span><span class="op" id="3983492">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span><span class="keyword" id="3983495">func</span>&nbsp;<span class="ident" id="3983500">marshalField</span><span class="op" id="3983512">(</span><span class="ident" id="3983513">out</span>&nbsp;<span class="op" id="3983517">*</span><span class="ident" id="3983518">forkableWriter</span><span class="op" id="3983532">,</span>&nbsp;<span class="ident" id="3983534">v</span>&nbsp;<span class="ident" id="3983536">reflect</span><span class="op" id="3983543">.</span><span class="ident" id="3983544">Value</span><span class="op" id="3983549">,</span>&nbsp;<span class="ident" id="3983551">params</span>&nbsp;<span class="ident" id="3983558">fieldParameters</span><span class="op" id="3983573">)</span>&nbsp;<span class="op" id="3983575">(</span><span class="ident" id="3983576">err</span>&nbsp;<span class="builtintype" id="3983580">error</span><span class="op" id="3983585">)</span>&nbsp;<span class="op" id="3983587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3983590">//&nbsp;If&nbsp;the&nbsp;field&nbsp;is&nbsp;an&nbsp;interface{}&nbsp;then&nbsp;recurse&nbsp;into&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983647">if</span>&nbsp;<span class="ident" id="3983650">v</span><span class="op" id="3983651">.</span><span class="ident" id="3983652">Kind</span><span class="op" id="3983656">(</span><span class="op" id="3983657">)</span>&nbsp;<span class="op" id="3983659">==</span>&nbsp;<span class="ident" id="3983662">reflect</span><span class="op" id="3983669">.</span><span class="ident" id="3983670">Interface</span>&nbsp;<span class="op" id="3983680">&amp;&amp;</span>&nbsp;<span class="ident" id="3983683">v</span><span class="op" id="3983684">.</span><span class="ident" id="3983685">Type</span><span class="op" id="3983689">(</span><span class="op" id="3983690">)</span><span class="op" id="3983691">.</span><span class="ident" id="3983692">NumMethod</span><span class="op" id="3983701">(</span><span class="op" id="3983702">)</span>&nbsp;<span class="op" id="3983704">==</span>&nbsp;<span class="num" id="3983707">0</span>&nbsp;<span class="op" id="3983709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983713">return</span>&nbsp;<span class="ident" id="3983720">marshalField</span><span class="op" id="3983732">(</span><span class="ident" id="3983733">out</span><span class="op" id="3983736">,</span>&nbsp;<span class="ident" id="3983738">v</span><span class="op" id="3983739">.</span><span class="ident" id="3983740">Elem</span><span class="op" id="3983744">(</span><span class="op" id="3983745">)</span><span class="op" id="3983746">,</span>&nbsp;<span class="ident" id="3983748">params</span><span class="op" id="3983754">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983761">if</span>&nbsp;<span class="ident" id="3983764">v</span><span class="op" id="3983765">.</span><span class="ident" id="3983766">Kind</span><span class="op" id="3983770">(</span><span class="op" id="3983771">)</span>&nbsp;<span class="op" id="3983773">==</span>&nbsp;<span class="ident" id="3983776">reflect</span><span class="op" id="3983783">.</span><span class="ident" id="3983784">Slice</span>&nbsp;<span class="op" id="3983790">&amp;&amp;</span>&nbsp;<span class="ident" id="3983793">v</span><span class="op" id="3983794">.</span><span class="ident" id="3983795">Len</span><span class="op" id="3983798">(</span><span class="op" id="3983799">)</span>&nbsp;<span class="op" id="3983801">==</span>&nbsp;<span class="num" id="3983804">0</span>&nbsp;<span class="op" id="3983806">&amp;&amp;</span>&nbsp;<span class="ident" id="3983809">params</span><span class="op" id="3983815">.</span><span class="ident" id="3983816">omitEmpty</span>&nbsp;<span class="op" id="3983826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983830">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983838">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983842">if</span>&nbsp;<span class="ident" id="3983845">params</span><span class="op" id="3983851">.</span><span class="ident" id="3983852">optional</span>&nbsp;<span class="op" id="3983861">&amp;&amp;</span>&nbsp;<span class="ident" id="3983864">params</span><span class="op" id="3983870">.</span><span class="ident" id="3983871">defaultValue</span>&nbsp;<span class="op" id="3983884">!=</span>&nbsp;<span class="ident" id="3983887">nil</span>&nbsp;<span class="op" id="3983891">&amp;&amp;</span>&nbsp;<span class="ident" id="3983894">canHaveDefaultValue</span><span class="op" id="3983913">(</span><span class="ident" id="3983914">v</span><span class="op" id="3983915">.</span><span class="ident" id="3983916">Kind</span><span class="op" id="3983920">(</span><span class="op" id="3983921">)</span><span class="op" id="3983922">)</span>&nbsp;<span class="op" id="3983924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983928">defaultValue</span>&nbsp;<span class="op" id="3983941">:=</span>&nbsp;<span class="ident" id="3983944">reflect</span><span class="op" id="3983951">.</span><span class="ident" id="3983952">New</span><span class="op" id="3983955">(</span><span class="ident" id="3983956">v</span><span class="op" id="3983957">.</span><span class="ident" id="3983958">Type</span><span class="op" id="3983962">(</span><span class="op" id="3983963">)</span><span class="op" id="3983964">)</span><span class="op" id="3983965">.</span><span class="ident" id="3983966">Elem</span><span class="op" id="3983970">(</span><span class="op" id="3983971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983975">defaultValue</span><span class="op" id="3983987">.</span><span class="ident" id="3983988">SetInt</span><span class="op" id="3983994">(</span><span class="op" id="3983995">*</span><span class="ident" id="3983996">params</span><span class="op" id="3984002">.</span><span class="ident" id="3984003">defaultValue</span><span class="op" id="3984015">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3984020">if</span>&nbsp;<span class="ident" id="3984023">reflect</span><span class="op" id="3984030">.</span><span class="ident" id="3984031">DeepEqual</span><span class="op" id="3984040">(</span><span class="ident" id="3984041">v</span><span class="op" id="3984042">.</span><span class="ident" id="3984043">Interface</span><span class="op" id="3984052">(</span><span class="op" id="3984053">)</span><span class="op" id="3984054">,</span>&nbsp;<span class="ident" id="3984056">defaultValue</span><span class="op" id="3984068">.</span><span class="ident" id="3984069">Interface</span><span class="op" id="3984078">(</span><span class="op" id="3984079">)</span><span class="op" id="3984080">)</span>&nbsp;<span class="op" id="3984082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3984087">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3984096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3984099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984103">//&nbsp;If&nbsp;no&nbsp;default&nbsp;value&nbsp;is&nbsp;given&nbsp;then&nbsp;the&nbsp;zero&nbsp;value&nbsp;for&nbsp;the&nbsp;type&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984172">//&nbsp;assumed&nbsp;to&nbsp;be&nbsp;the&nbsp;default&nbsp;value.&nbsp;This&nbsp;isn&#39;t&nbsp;obviously&nbsp;the&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3984242">//&nbsp;behaviour,&nbsp;but&nbsp;it&#39;s&nbsp;what&nbsp;Go&nbsp;has&nbsp;traditionally&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3984298">if</span>&nbsp;<span class="ident" id="3984301">params</span><span class="op" id="3984307">.</span><span class="ident" id="3984308">optional</span>&nbsp;<span class="op" id="3984317">&amp;&amp;</span>&nbsp;<span class="ident" id="3984320">params</span><span class="op" id="3984326">.</span><span class="ident" id="3984327">defaultValue</span>&nbsp;<span class="op" id="3984340">==</span>&nbsp;<span class="ident" id="3984343">nil</span>&nbsp;<span class="op" id="3984347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3984351">if</span>&nbsp;<span class="ident" id="3984354">reflect</span><span class="op" id="3984361">.</span><span class="ident" id="3984362">DeepEqual</span><span class="op" id="3984371">(</span><span class="ident" id="3984372">v</span><span class="op" id="3984373">.</span><span class="ident" id="3984374">Interface</span><span class="op" id="3984383">(</span><span class="op" id="3984384">)</span><span class="op" id="3984385">,</span>&nbsp;<span class="ident" id="3984387">reflect</span><span class="op" id="3984394">.</span><span class="ident" id="3984395">Zero</span><span class="op" id="3984399">(</span><span class="ident" id="3984400">v</span><span class="op" id="3984401">.</span><span class="ident" id="3984402">Type</span><span class="op" id="3984406">(</span><span class="op" id="3984407">)</span><span class="op" id="3984408">)</span><span class="op" id="3984409">.</span><span class="ident" id="3984410">Interface</span><span class="op" id="3984419">(</span><span class="op" id="3984420">)</span><span class="op" id="3984421">)</span>&nbsp;<span class="op" id="3984423">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3984428">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3984437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3984440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3984444">if</span>&nbsp;<span class="ident" id="3984447">v</span><span class="op" id="3984448">.</span><span class="ident" id="3984449">Type</span><span class="op" id="3984453">(</span><span class="op" id="3984454">)</span>&nbsp;<span class="op" id="3984456">==</span>&nbsp;<span class="ident" id="3984459">rawValueType</span>&nbsp;<span class="op" id="3984472">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984476">rv</span>&nbsp;<span class="op" id="3984479">:=</span>&nbsp;<span class="ident" id="3984482">v</span><span class="op" id="3984483">.</span><span class="ident" id="3984484">Interface</span><span class="op" id="3984493">(</span><span class="op" id="3984494">)</span><span class="op" id="3984495">.</span><span class="op" id="3984496">(</span><span class="ident" id="3984497">RawValue</span><span class="op" id="3984505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3984509">if</span>&nbsp;<span class="builtinfunc" id="3984512">len</span><span class="op" id="3984515">(</span><span class="ident" id="3984516">rv</span><span class="op" id="3984518">.</span><span class="ident" id="3984519">FullBytes</span><span class="op" id="3984528">)</span>&nbsp;<span class="op" id="3984530">!=</span>&nbsp;<span class="num" id="3984533">0</span>&nbsp;<span class="op" id="3984535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984540">_</span><span class="op" id="3984541">,</span>&nbsp;<span class="ident" id="3984543">err</span>&nbsp;<span class="op" id="3984547">=</span>&nbsp;<span class="ident" id="3984549">out</span><span class="op" id="3984552">.</span><span class="ident" id="3984553">Write</span><span class="op" id="3984558">(</span><span class="ident" id="3984559">rv</span><span class="op" id="3984561">.</span><span class="ident" id="3984562">FullBytes</span><span class="op" id="3984571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3984575">}</span>&nbsp;<span class="keyword" id="3984577">else</span>&nbsp;<span class="op" id="3984582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984587">err</span>&nbsp;<span class="op" id="3984591">=</span>&nbsp;<span class="ident" id="3984593">marshalTagAndLength</span><span class="op" id="3984612">(</span><span class="ident" id="3984613">out</span><span class="op" id="3984616">,</span>&nbsp;<span class="ident" id="3984618">tagAndLength</span><span class="op" id="3984630">{</span><span class="ident" id="3984631">rv</span><span class="op" id="3984633">.</span><span class="ident" id="3984634">Class</span><span class="op" id="3984639">,</span>&nbsp;<span class="ident" id="3984641">rv</span><span class="op" id="3984643">.</span><span class="ident" id="3984644">Tag</span><span class="op" id="3984647">,</span>&nbsp;<span class="builtinfunc" id="3984649">len</span><span class="op" id="3984652">(</span><span class="ident" id="3984653">rv</span><span class="op" id="3984655">.</span><span class="ident" id="3984656">Bytes</span><span class="op" id="3984661">)</span><span class="op" id="3984662">,</span>&nbsp;<span class="ident" id="3984664">rv</span><span class="op" id="3984666">.</span><span class="ident" id="3984667">IsCompound</span><span class="op" id="3984677">}</span><span class="op" id="3984678">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3984683">if</span>&nbsp;<span class="ident" id="3984686">err</span>&nbsp;<span class="op" id="3984690">!=</span>&nbsp;<span class="ident" id="3984693">nil</span>&nbsp;<span class="op" id="3984697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3984703">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3984713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984718">_</span><span class="op" id="3984719">,</span>&nbsp;<span class="ident" id="3984721">err</span>&nbsp;<span class="op" id="3984725">=</span>&nbsp;<span class="ident" id="3984727">out</span><span class="op" id="3984730">.</span><span class="ident" id="3984731">Write</span><span class="op" id="3984736">(</span><span class="ident" id="3984737">rv</span><span class="op" id="3984739">.</span><span class="ident" id="3984740">Bytes</span><span class="op" id="3984745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3984749">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3984753">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3984761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984765">tag</span><span class="op" id="3984768">,</span>&nbsp;<span class="ident" id="3984770">isCompound</span><span class="op" id="3984780">,</span>&nbsp;<span class="ident" id="3984782">ok</span>&nbsp;<span class="op" id="3984785">:=</span>&nbsp;<span class="ident" id="3984788">getUniversalType</span><span class="op" id="3984804">(</span><span class="ident" id="3984805">v</span><span class="op" id="3984806">.</span><span class="ident" id="3984807">Type</span><span class="op" id="3984811">(</span><span class="op" id="3984812">)</span><span class="op" id="3984813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3984816">if</span>&nbsp;<span class="op" id="3984819">!</span><span class="ident" id="3984820">ok</span>&nbsp;<span class="op" id="3984823">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984827">err</span>&nbsp;<span class="op" id="3984831">=</span>&nbsp;<span class="ident" id="3984833">StructuralError</span><span class="op" id="3984848">{</span><span class="ident" id="3984849">fmt</span><span class="op" id="3984852">.</span><span class="ident" id="3984853">Sprintf</span><span class="op" id="3984860">(</span><span class="string" id="3984861">&#34;unknown&nbsp;Go&nbsp;type:&nbsp;%v&#34;</span><span class="op" id="3984882">,</span>&nbsp;<span class="ident" id="3984884">v</span><span class="op" id="3984885">.</span><span class="ident" id="3984886">Type</span><span class="op" id="3984890">(</span><span class="op" id="3984891">)</span><span class="op" id="3984892">)</span><span class="op" id="3984893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3984897">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3984905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3984908">class</span>&nbsp;<span class="op" id="3984914">:=</span>&nbsp;<span class="ident" id="3984917">classUniversal</span><br>
<span class="lineno"></span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3984934">if</span>&nbsp;<span class="ident" id="3984937">params</span><span class="op" id="3984943">.</span><span class="ident" id="3984944">stringType</span>&nbsp;<span class="op" id="3984955">!=</span>&nbsp;<span class="num" id="3984958">0</span>&nbsp;<span class="op" id="3984960">&amp;&amp;</span>&nbsp;<span class="ident" id="3984963">tag</span>&nbsp;<span class="op" id="3984967">!=</span>&nbsp;<span class="ident" id="3984970">tagPrintableString</span>&nbsp;<span class="op" id="3984989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3984993">return</span>&nbsp;<span class="ident" id="3985000">StructuralError</span><span class="op" id="3985015">{</span><span class="string" id="3985016">&#34;explicit&nbsp;string&nbsp;type&nbsp;given&nbsp;to&nbsp;non-string&nbsp;member&#34;</span><span class="op" id="3985065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3985068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985072">switch</span>&nbsp;<span class="ident" id="3985079">tag</span>&nbsp;<span class="op" id="3985083">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985086">case</span>&nbsp;<span class="ident" id="3985091">tagPrintableString</span><span class="op" id="3985109">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985113">if</span>&nbsp;<span class="ident" id="3985116">params</span><span class="op" id="3985122">.</span><span class="ident" id="3985123">stringType</span>&nbsp;<span class="op" id="3985134">==</span>&nbsp;<span class="num" id="3985137">0</span>&nbsp;<span class="op" id="3985139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3985144">//&nbsp;This&nbsp;is&nbsp;a&nbsp;string&nbsp;without&nbsp;an&nbsp;explicit&nbsp;string&nbsp;type.&nbsp;We&#39;ll&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3985210">//&nbsp;a&nbsp;PrintableString&nbsp;if&nbsp;the&nbsp;character&nbsp;set&nbsp;in&nbsp;the&nbsp;string&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3985272">//&nbsp;sufficiently&nbsp;limited,&nbsp;otherwise&nbsp;we&#39;ll&nbsp;use&nbsp;a&nbsp;UTF8String.</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985334">for</span>&nbsp;<span class="ident" id="3985338">_</span><span class="op" id="3985339">,</span>&nbsp;<span class="ident" id="3985341">r</span>&nbsp;<span class="op" id="3985343">:=</span>&nbsp;<span class="keyword" id="3985346">range</span>&nbsp;<span class="ident" id="3985352">v</span><span class="op" id="3985353">.</span><span class="ident" id="3985354">String</span><span class="op" id="3985360">(</span><span class="op" id="3985361">)</span>&nbsp;<span class="op" id="3985363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985369">if</span>&nbsp;<span class="ident" id="3985372">r</span>&nbsp;<span class="op" id="3985374">&gt;=</span>&nbsp;<span class="ident" id="3985377">utf8</span><span class="op" id="3985381">.</span><span class="ident" id="3985382">RuneSelf</span>&nbsp;<span class="op" id="3985391">||</span>&nbsp;<span class="op" id="3985394">!</span><span class="ident" id="3985395">isPrintable</span><span class="op" id="3985406">(</span><span class="builtintype" id="3985407">byte</span><span class="op" id="3985411">(</span><span class="ident" id="3985412">r</span><span class="op" id="3985413">)</span><span class="op" id="3985414">)</span>&nbsp;<span class="op" id="3985416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985423">if</span>&nbsp;<span class="op" id="3985426">!</span><span class="ident" id="3985427">utf8</span><span class="op" id="3985431">.</span><span class="ident" id="3985432">ValidString</span><span class="op" id="3985443">(</span><span class="ident" id="3985444">v</span><span class="op" id="3985445">.</span><span class="ident" id="3985446">String</span><span class="op" id="3985452">(</span><span class="op" id="3985453">)</span><span class="op" id="3985454">)</span>&nbsp;<span class="op" id="3985456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985464">return</span>&nbsp;<span class="ident" id="3985471">errors</span><span class="op" id="3985477">.</span><span class="ident" id="3985478">New</span><span class="op" id="3985481">(</span><span class="string" id="3985482">&#34;asn1:&nbsp;string&nbsp;not&nbsp;valid&nbsp;UTF-8&#34;</span><span class="op" id="3985512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3985519">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985526">tag</span>&nbsp;<span class="op" id="3985530">=</span>&nbsp;<span class="ident" id="3985532">tagUTF8String</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985551">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3985561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3985566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3985570">}</span>&nbsp;<span class="keyword" id="3985572">else</span>&nbsp;<span class="op" id="3985577">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985582">tag</span>&nbsp;<span class="op" id="3985586">=</span>&nbsp;<span class="ident" id="3985588">params</span><span class="op" id="3985594">.</span><span class="ident" id="3985595">stringType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3985608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985611">case</span>&nbsp;<span class="ident" id="3985616">tagUTCTime</span><span class="op" id="3985626">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985630">if</span>&nbsp;<span class="ident" id="3985633">outsideUTCRange</span><span class="op" id="3985648">(</span><span class="ident" id="3985649">v</span><span class="op" id="3985650">.</span><span class="ident" id="3985651">Interface</span><span class="op" id="3985660">(</span><span class="op" id="3985661">)</span><span class="op" id="3985662">.</span><span class="op" id="3985663">(</span><span class="ident" id="3985664">time</span><span class="op" id="3985668">.</span><span class="ident" id="3985669">Time</span><span class="op" id="3985673">)</span><span class="op" id="3985674">)</span>&nbsp;<span class="op" id="3985676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985681">tag</span>&nbsp;<span class="op" id="3985685">=</span>&nbsp;<span class="ident" id="3985687">tagGeneralizedTime</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3985708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3985711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985715">if</span>&nbsp;<span class="ident" id="3985718">params</span><span class="op" id="3985724">.</span><span class="ident" id="3985725">set</span>&nbsp;<span class="op" id="3985729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985733">if</span>&nbsp;<span class="ident" id="3985736">tag</span>&nbsp;<span class="op" id="3985740">!=</span>&nbsp;<span class="ident" id="3985743">tagSequence</span>&nbsp;<span class="op" id="3985755">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985760">return</span>&nbsp;<span class="ident" id="3985767">StructuralError</span><span class="op" id="3985782">{</span><span class="string" id="3985783">&#34;non&nbsp;sequence&nbsp;tagged&nbsp;as&nbsp;set&#34;</span><span class="op" id="3985811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3985815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985819">tag</span>&nbsp;<span class="op" id="3985823">=</span>&nbsp;<span class="ident" id="3985825">tagSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3985833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985837">tags</span><span class="op" id="3985841">,</span>&nbsp;<span class="ident" id="3985843">body</span>&nbsp;<span class="op" id="3985848">:=</span>&nbsp;<span class="ident" id="3985851">out</span><span class="op" id="3985854">.</span><span class="ident" id="3985855">fork</span><span class="op" id="3985859">(</span><span class="op" id="3985860">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985864">err</span>&nbsp;<span class="op" id="3985868">=</span>&nbsp;<span class="ident" id="3985870">marshalBody</span><span class="op" id="3985881">(</span><span class="ident" id="3985882">body</span><span class="op" id="3985886">,</span>&nbsp;<span class="ident" id="3985888">v</span><span class="op" id="3985889">,</span>&nbsp;<span class="ident" id="3985891">params</span><span class="op" id="3985897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985900">if</span>&nbsp;<span class="ident" id="3985903">err</span>&nbsp;<span class="op" id="3985907">!=</span>&nbsp;<span class="ident" id="3985910">nil</span>&nbsp;<span class="op" id="3985914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985918">return</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3985926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3985930">bodyLen</span>&nbsp;<span class="op" id="3985938">:=</span>&nbsp;<span class="ident" id="3985941">body</span><span class="op" id="3985945">.</span><span class="ident" id="3985946">Len</span><span class="op" id="3985949">(</span><span class="op" id="3985950">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985954">var</span>&nbsp;<span class="ident" id="3985958">explicitTag</span>&nbsp;<span class="op" id="3985970">*</span><span class="ident" id="3985971">forkableWriter</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3985987">if</span>&nbsp;<span class="ident" id="3985990">params</span><span class="op" id="3985996">.</span><span class="ident" id="3985997">explicit</span>&nbsp;<span class="op" id="3986006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986010">explicitTag</span><span class="op" id="3986021">,</span>&nbsp;<span class="ident" id="3986023">tags</span>&nbsp;<span class="op" id="3986028">=</span>&nbsp;<span class="ident" id="3986030">tags</span><span class="op" id="3986034">.</span><span class="ident" id="3986035">fork</span><span class="op" id="3986039">(</span><span class="op" id="3986040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3986043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986047">if</span>&nbsp;<span class="op" id="3986050">!</span><span class="ident" id="3986051">params</span><span class="op" id="3986057">.</span><span class="ident" id="3986058">explicit</span>&nbsp;<span class="op" id="3986067">&amp;&amp;</span>&nbsp;<span class="ident" id="3986070">params</span><span class="op" id="3986076">.</span><span class="ident" id="3986077">tag</span>&nbsp;<span class="op" id="3986081">!=</span>&nbsp;<span class="ident" id="3986084">nil</span>&nbsp;<span class="op" id="3986088">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3986092">//&nbsp;implicit&nbsp;tag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986111">tag</span>&nbsp;<span class="op" id="3986115">=</span>&nbsp;<span class="op" id="3986117">*</span><span class="ident" id="3986118">params</span><span class="op" id="3986124">.</span><span class="ident" id="3986125">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986131">class</span>&nbsp;<span class="op" id="3986137">=</span>&nbsp;<span class="ident" id="3986139">classContextSpecific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3986161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986165">err</span>&nbsp;<span class="op" id="3986169">=</span>&nbsp;<span class="ident" id="3986171">marshalTagAndLength</span><span class="op" id="3986190">(</span><span class="ident" id="3986191">tags</span><span class="op" id="3986195">,</span>&nbsp;<span class="ident" id="3986197">tagAndLength</span><span class="op" id="3986209">{</span><span class="ident" id="3986210">class</span><span class="op" id="3986215">,</span>&nbsp;<span class="ident" id="3986217">tag</span><span class="op" id="3986220">,</span>&nbsp;<span class="ident" id="3986222">bodyLen</span><span class="op" id="3986229">,</span>&nbsp;<span class="ident" id="3986231">isCompound</span><span class="op" id="3986241">}</span><span class="op" id="3986242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986245">if</span>&nbsp;<span class="ident" id="3986248">err</span>&nbsp;<span class="op" id="3986252">!=</span>&nbsp;<span class="ident" id="3986255">nil</span>&nbsp;<span class="op" id="3986259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986263">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3986271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986275">if</span>&nbsp;<span class="ident" id="3986278">params</span><span class="op" id="3986284">.</span><span class="ident" id="3986285">explicit</span>&nbsp;<span class="op" id="3986294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986298">err</span>&nbsp;<span class="op" id="3986302">=</span>&nbsp;<span class="ident" id="3986304">marshalTagAndLength</span><span class="op" id="3986323">(</span><span class="ident" id="3986324">explicitTag</span><span class="op" id="3986335">,</span>&nbsp;<span class="ident" id="3986337">tagAndLength</span><span class="op" id="3986349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986354">class</span><span class="op" id="3986359">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3986366">classContextSpecific</span><span class="op" id="3986386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986391">tag</span><span class="op" id="3986394">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3986403">*</span><span class="ident" id="3986404">params</span><span class="op" id="3986410">.</span><span class="ident" id="3986411">tag</span><span class="op" id="3986414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986419">length</span><span class="op" id="3986425">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3986431">bodyLen</span>&nbsp;<span class="op" id="3986439">+</span>&nbsp;<span class="ident" id="3986441">tags</span><span class="op" id="3986445">.</span><span class="ident" id="3986446">Len</span><span class="op" id="3986449">(</span><span class="op" id="3986450">)</span><span class="op" id="3986451">,</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986456">isCompound</span><span class="op" id="3986466">:</span>&nbsp;<span class="builtintype" id="3986468">true</span><span class="op" id="3986472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3986476">}</span><span class="op" id="3986477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3986480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986484">return</span>&nbsp;<span class="ident" id="3986491">nil</span><br>
<span class="lineno">625</span><span class="op" id="3986495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3986498">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;ASN.1&nbsp;encoding&nbsp;of&nbsp;val.</span><br>
<span class="lineno"></span><span class="comment" id="3986544">//</span><br>
<span class="lineno"></span><span class="comment" id="3986547">//&nbsp;In&nbsp;addition&nbsp;to&nbsp;the&nbsp;struct&nbsp;tags&nbsp;recognised&nbsp;by&nbsp;Unmarshal,&nbsp;the&nbsp;following&nbsp;can&nbsp;be</span><br>
<span class="lineno">630</span><span class="comment" id="3986627">//&nbsp;used:</span><br>
<span class="lineno"></span><span class="comment" id="3986636">//</span><br>
<span class="lineno"></span><span class="comment" id="3986639">//&nbsp;&nbsp;&nbsp;&nbspia5:&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspcauses&nbsp;strings&nbsp;to&nbsp;be&nbsp;marshaled&nbsp;as&nbsp;ASN.1,&nbsp;IA5&nbsp;strings</span><br>
<span class="lineno"></span><span class="comment" id="3986701">//&nbsp;&nbsp;&nbsp;&nbspomitempty:&nbsp;&nbsp;&nbsp;&nbspcauses&nbsp;empty&nbsp;slices&nbsp;to&nbsp;be&nbsp;skipped</span><br>
<span class="lineno"></span><span class="comment" id="3986749">//&nbsp;&nbsp;&nbsp;&nbspprintable:&nbsp;&nbsp;&nbsp;&nbspcauses&nbsp;strings&nbsp;to&nbsp;be&nbsp;marshaled&nbsp;as&nbsp;ASN.1,&nbsp;PrintableString&nbsp;strings.</span><br>
<span class="lineno">635</span><span class="comment" id="3986829">//&nbsp;&nbsp;&nbsp;&nbsputf8:&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspcauses&nbsp;strings&nbsp;to&nbsp;be&nbsp;marshaled&nbsp;as&nbsp;ASN.1,&nbsp;UTF8&nbsp;strings</span><br>
<span class="lineno"></span><span class="keyword" id="3986893">func</span>&nbsp;<span class="ident" id="3986898">Marshal</span><span class="op" id="3986905">(</span><span class="ident" id="3986906">val</span>&nbsp;<span class="keyword" id="3986910">interface</span><span class="op" id="3986919">{</span><span class="op" id="3986920">}</span><span class="op" id="3986921">)</span>&nbsp;<span class="op" id="3986923">(</span><span class="op" id="3986924">[</span><span class="op" id="3986925">]</span><span class="builtintype" id="3986926">byte</span><span class="op" id="3986930">,</span>&nbsp;<span class="builtintype" id="3986932">error</span><span class="op" id="3986937">)</span>&nbsp;<span class="op" id="3986939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3986942">var</span>&nbsp;<span class="ident" id="3986946">out</span>&nbsp;<span class="ident" id="3986950">bytes</span><span class="op" id="3986955">.</span><span class="ident" id="3986956">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986964">v</span>&nbsp;<span class="op" id="3986966">:=</span>&nbsp;<span class="ident" id="3986969">reflect</span><span class="op" id="3986976">.</span><span class="ident" id="3986977">ValueOf</span><span class="op" id="3986984">(</span><span class="ident" id="3986985">val</span><span class="op" id="3986988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3986991">f</span>&nbsp;<span class="op" id="3986993">:=</span>&nbsp;<span class="ident" id="3986996">newForkableWriter</span><span class="op" id="3987013">(</span><span class="op" id="3987014">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987017">err</span>&nbsp;<span class="op" id="3987021">:=</span>&nbsp;<span class="ident" id="3987024">marshalField</span><span class="op" id="3987036">(</span><span class="ident" id="3987037">f</span><span class="op" id="3987038">,</span>&nbsp;<span class="ident" id="3987040">v</span><span class="op" id="3987041">,</span>&nbsp;<span class="ident" id="3987043">fieldParameters</span><span class="op" id="3987058">{</span><span class="op" id="3987059">}</span><span class="op" id="3987060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3987063">if</span>&nbsp;<span class="ident" id="3987066">err</span>&nbsp;<span class="op" id="3987070">!=</span>&nbsp;<span class="ident" id="3987073">nil</span>&nbsp;<span class="op" id="3987077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3987081">return</span>&nbsp;<span class="ident" id="3987088">nil</span><span class="op" id="3987091">,</span>&nbsp;<span class="ident" id="3987093">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3987098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3987101">_</span><span class="op" id="3987102">,</span>&nbsp;<span class="ident" id="3987104">err</span>&nbsp;<span class="op" id="3987108">=</span>&nbsp;<span class="ident" id="3987110">f</span><span class="op" id="3987111">.</span><span class="ident" id="3987112">writeTo</span><span class="op" id="3987119">(</span><span class="op" id="3987120">&amp;</span><span class="ident" id="3987121">out</span><span class="op" id="3987124">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3987127">return</span>&nbsp;<span class="ident" id="3987134">out</span><span class="op" id="3987137">.</span><span class="ident" id="3987138">Bytes</span><span class="op" id="3987143">(</span><span class="op" id="3987144">)</span><span class="op" id="3987145">,</span>&nbsp;<span class="ident" id="3987147">nil</span><br>
<span class="lineno"></span><span class="op" id="3987151">}</span>
</div>
</body>
</html>
