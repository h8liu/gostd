<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html" class="current">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2412244">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2412299">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2412353">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2412404">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2412474">package</span>&nbsp;<span class="ident" id="2412482">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2412486">import</span>&nbsp;<span class="op" id="2412493">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2412496">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2412502">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2412512">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2412515">const</span>&nbsp;<span class="op" id="2412521">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2412524">blockSize</span>&nbsp;<span class="op" id="2412534">=</span>&nbsp;<span class="num" id="2412536">4096</span><br>
<span class="lineno"></span><span class="op" id="2412541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2412544">func</span>&nbsp;<span class="op" id="2412549">(</span><span class="ident" id="2412550">f</span>&nbsp;<span class="op" id="2412552">*</span><span class="ident" id="2412553">File</span><span class="op" id="2412557">)</span>&nbsp;<span class="ident" id="2412559">readdirnames</span><span class="op" id="2412571">(</span><span class="ident" id="2412572">n</span>&nbsp;<span class="builtintype" id="2412574">int</span><span class="op" id="2412577">)</span>&nbsp;<span class="op" id="2412579">(</span><span class="ident" id="2412580">names</span>&nbsp;<span class="op" id="2412586">[</span><span class="op" id="2412587">]</span><span class="builtintype" id="2412588">string</span><span class="op" id="2412594">,</span>&nbsp;<span class="ident" id="2412596">err</span>&nbsp;<span class="builtintype" id="2412600">error</span><span class="op" id="2412605">)</span>&nbsp;<span class="op" id="2412607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2412610">//&nbsp;If&nbsp;this&nbsp;file&nbsp;has&nbsp;no&nbsp;dirinfo,&nbsp;create&nbsp;one.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2412655">if</span>&nbsp;<span class="ident" id="2412658">f</span><span class="op" id="2412659">.</span><span class="ident" id="2412660">dirinfo</span>&nbsp;<span class="op" id="2412668">==</span>&nbsp;<span class="builtintype" id="2412671">nil</span>&nbsp;<span class="op" id="2412675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2412679">f</span><span class="op" id="2412680">.</span><span class="ident" id="2412681">dirinfo</span>&nbsp;<span class="op" id="2412689">=</span>&nbsp;<span class="builtinfunc" id="2412691">new</span><span class="op" id="2412694">(</span><span class="ident" id="2412695">dirInfo</span><span class="op" id="2412702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2412706">//&nbsp;The&nbsp;buffer&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;a&nbsp;block&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2412753">f</span><span class="op" id="2412754">.</span><span class="ident" id="2412755">dirinfo</span><span class="op" id="2412762">.</span><span class="ident" id="2412763">buf</span>&nbsp;<span class="op" id="2412767">=</span>&nbsp;<span class="builtinfunc" id="2412769">make</span><span class="op" id="2412773">(</span><span class="op" id="2412774">[</span><span class="op" id="2412775">]</span><span class="builtintype" id="2412776">byte</span><span class="op" id="2412780">,</span>&nbsp;<span class="ident" id="2412782">blockSize</span><span class="op" id="2412791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2412794">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2412797">d</span>&nbsp;<span class="op" id="2412799">:=</span>&nbsp;<span class="ident" id="2412802">f</span><span class="op" id="2412803">.</span><span class="ident" id="2412804">dirinfo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2412814">size</span>&nbsp;<span class="op" id="2412819">:=</span>&nbsp;<span class="ident" id="2412822">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2412825">if</span>&nbsp;<span class="ident" id="2412828">size</span>&nbsp;<span class="op" id="2412833">&lt;=</span>&nbsp;<span class="num" id="2412836">0</span>&nbsp;<span class="op" id="2412838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2412842">size</span>&nbsp;<span class="op" id="2412847">=</span>&nbsp;<span class="num" id="2412849">100</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2412855">n</span>&nbsp;<span class="op" id="2412857">=</span>&nbsp;<span class="op" id="2412859">-</span><span class="num" id="2412860">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2412863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2412867">names</span>&nbsp;<span class="op" id="2412873">=</span>&nbsp;<span class="builtinfunc" id="2412875">make</span><span class="op" id="2412879">(</span><span class="op" id="2412880">[</span><span class="op" id="2412881">]</span><span class="builtintype" id="2412882">string</span><span class="op" id="2412888">,</span>&nbsp;<span class="num" id="2412890">0</span><span class="op" id="2412891">,</span>&nbsp;<span class="ident" id="2412893">size</span><span class="op" id="2412897">)</span>&nbsp;<span class="comment" id="2412899">//&nbsp;Empty&nbsp;with&nbsp;room&nbsp;to&nbsp;grow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2412928">for</span>&nbsp;<span class="ident" id="2412932">n</span>&nbsp;<span class="op" id="2412934">!=</span>&nbsp;<span class="num" id="2412937">0</span>&nbsp;<span class="op" id="2412939">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2412943">//&nbsp;Refill&nbsp;the&nbsp;buffer&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2412979">if</span>&nbsp;<span class="ident" id="2412982">d</span><span class="op" id="2412983">.</span><span class="ident" id="2412984">bufp</span>&nbsp;<span class="op" id="2412989">&gt;=</span>&nbsp;<span class="ident" id="2412992">d</span><span class="op" id="2412993">.</span><span class="ident" id="2412994">nbuf</span>&nbsp;<span class="op" id="2412999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2413004">d</span><span class="op" id="2413005">.</span><span class="ident" id="2413006">bufp</span>&nbsp;<span class="op" id="2413011">=</span>&nbsp;<span class="num" id="2413013">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2413018">var</span>&nbsp;<span class="ident" id="2413022">errno</span>&nbsp;<span class="builtintype" id="2413028">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2413037">d</span><span class="op" id="2413038">.</span><span class="ident" id="2413039">nbuf</span><span class="op" id="2413043">,</span>&nbsp;<span class="ident" id="2413045">errno</span>&nbsp;<span class="op" id="2413051">=</span>&nbsp;<span class="ident" id="2413053">fixCount</span><span class="op" id="2413061">(</span><span class="ident" id="2413062">syscall</span><span class="op" id="2413069">.</span><span class="ident" id="2413070">ReadDirent</span><span class="op" id="2413080">(</span><span class="ident" id="2413081">f</span><span class="op" id="2413082">.</span><span class="ident" id="2413083">fd</span><span class="op" id="2413085">,</span>&nbsp;<span class="ident" id="2413087">d</span><span class="op" id="2413088">.</span><span class="ident" id="2413089">buf</span><span class="op" id="2413092">)</span><span class="op" id="2413093">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2413098">if</span>&nbsp;<span class="ident" id="2413101">errno</span>&nbsp;<span class="op" id="2413107">!=</span>&nbsp;<span class="builtintype" id="2413110">nil</span>&nbsp;<span class="op" id="2413114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2413120">return</span>&nbsp;<span class="ident" id="2413127">names</span><span class="op" id="2413132">,</span>&nbsp;<span class="ident" id="2413134">NewSyscallError</span><span class="op" id="2413149">(</span><span class="string" id="2413150">&#34;readdirent&#34;</span><span class="op" id="2413162">,</span>&nbsp;<span class="ident" id="2413164">errno</span><span class="op" id="2413169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2413174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2413179">if</span>&nbsp;<span class="ident" id="2413182">d</span><span class="op" id="2413183">.</span><span class="ident" id="2413184">nbuf</span>&nbsp;<span class="op" id="2413189">&lt;=</span>&nbsp;<span class="num" id="2413192">0</span>&nbsp;<span class="op" id="2413194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2413200">break</span>&nbsp;<span class="comment" id="2413206">//&nbsp;EOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2413216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2413220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2413225">//&nbsp;Drain&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2413247">var</span>&nbsp;<span class="ident" id="2413251">nb</span><span class="op" id="2413253">,</span>&nbsp;<span class="ident" id="2413255">nc</span>&nbsp;<span class="builtintype" id="2413258">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2413264">nb</span><span class="op" id="2413266">,</span>&nbsp;<span class="ident" id="2413268">nc</span><span class="op" id="2413270">,</span>&nbsp;<span class="ident" id="2413272">names</span>&nbsp;<span class="op" id="2413278">=</span>&nbsp;<span class="ident" id="2413280">syscall</span><span class="op" id="2413287">.</span><span class="ident" id="2413288">ParseDirent</span><span class="op" id="2413299">(</span><span class="ident" id="2413300">d</span><span class="op" id="2413301">.</span><span class="ident" id="2413302">buf</span><span class="op" id="2413305">[</span><span class="ident" id="2413306">d</span><span class="op" id="2413307">.</span><span class="ident" id="2413308">bufp</span><span class="op" id="2413312">:</span><span class="ident" id="2413313">d</span><span class="op" id="2413314">.</span><span class="ident" id="2413315">nbuf</span><span class="op" id="2413319">]</span><span class="op" id="2413320">,</span>&nbsp;<span class="ident" id="2413322">n</span><span class="op" id="2413323">,</span>&nbsp;<span class="ident" id="2413325">names</span><span class="op" id="2413330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2413334">d</span><span class="op" id="2413335">.</span><span class="ident" id="2413336">bufp</span>&nbsp;<span class="op" id="2413341">+=</span>&nbsp;<span class="ident" id="2413344">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2413349">n</span>&nbsp;<span class="op" id="2413351">-=</span>&nbsp;<span class="ident" id="2413354">nc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2413358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2413361">if</span>&nbsp;<span class="ident" id="2413364">n</span>&nbsp;<span class="op" id="2413366">&gt;=</span>&nbsp;<span class="num" id="2413369">0</span>&nbsp;<span class="op" id="2413371">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2413374">len</span><span class="op" id="2413377">(</span><span class="ident" id="2413378">names</span><span class="op" id="2413383">)</span>&nbsp;<span class="op" id="2413385">==</span>&nbsp;<span class="num" id="2413388">0</span>&nbsp;<span class="op" id="2413390">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2413394">return</span>&nbsp;<span class="ident" id="2413401">names</span><span class="op" id="2413406">,</span>&nbsp;<span class="ident" id="2413408">io</span><span class="op" id="2413410">.</span><span class="ident" id="2413411">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2413416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2413419">return</span>&nbsp;<span class="ident" id="2413426">names</span><span class="op" id="2413431">,</span>&nbsp;<span class="builtintype" id="2413433">nil</span><br>
<span class="lineno"></span><span class="op" id="2413437">}</span>
</div>
</body>
</html>
