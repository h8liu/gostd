<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/zlib</h2>
<ul>
<li><a href="/gostd/compress/zlib/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/compress/zlib/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/zlib/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/zlib/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/compress/zlib/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5130594">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5130649">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5130703">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5130754">package</span>&nbsp;<span class="ident" id="5130762">zlib</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5130768">import</span>&nbsp;<span class="op" id="5130775">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5130778">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5130796">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5130803">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5130811">&#34;hash/adler32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5130827">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5130832">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5130835">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="5130915">//&nbsp;&#34;compress/zlib&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5130981">const</span>&nbsp;<span class="op" id="5130987">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130990">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5131009">=</span>&nbsp;<span class="ident" id="5131011">flate</span><span class="op" id="5131016">.</span><span class="ident" id="5131017">NoCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131032">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5131051">=</span>&nbsp;<span class="ident" id="5131053">flate</span><span class="op" id="5131058">.</span><span class="ident" id="5131059">BestSpeed</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131070">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5131089">=</span>&nbsp;<span class="ident" id="5131091">flate</span><span class="op" id="5131096">.</span><span class="ident" id="5131097">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131114">DefaultCompression</span>&nbsp;<span class="op" id="5131133">=</span>&nbsp;<span class="ident" id="5131135">flate</span><span class="op" id="5131140">.</span><span class="ident" id="5131141">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="5131160">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5131163">//&nbsp;A&nbsp;Writer&nbsp;takes&nbsp;data&nbsp;written&nbsp;to&nbsp;it&nbsp;and&nbsp;writes&nbsp;the&nbsp;compressed</span><br>
<span class="lineno">25</span><span class="comment" id="5131226">//&nbsp;form&nbsp;of&nbsp;that&nbsp;data&nbsp;to&nbsp;an&nbsp;underlying&nbsp;writer&nbsp;(see&nbsp;NewWriter).</span><br>
<span class="lineno"></span><span class="keyword" id="5131288">type</span>&nbsp;<span class="ident" id="5131293">Writer</span>&nbsp;<span class="keyword" id="5131300">struct</span>&nbsp;<span class="op" id="5131307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131310">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5131322">io</span><span class="op" id="5131324">.</span><span class="ident" id="5131325">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131333">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5131345">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131350">dict</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5131362">[</span><span class="op" id="5131363">]</span><span class="builtintype" id="5131364">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131370">compressor</span>&nbsp;&nbsp;<span class="op" id="5131382">*</span><span class="ident" id="5131383">flate</span><span class="op" id="5131388">.</span><span class="ident" id="5131389">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131397">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5131409">hash</span><span class="op" id="5131413">.</span><span class="ident" id="5131414">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131422">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5131434">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131441">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5131453">[</span><span class="num" id="5131454">4</span><span class="op" id="5131455">]</span><span class="builtintype" id="5131456">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131462">wroteHeader</span>&nbsp;<span class="builtintype" id="5131474">bool</span><br>
<span class="lineno">35</span><span class="op" id="5131479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5131482">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="5131517">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="5131583">//</span><br>
<span class="lineno">40</span><span class="comment" id="5131586">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="5131667">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5131722">func</span>&nbsp;<span class="ident" id="5131727">NewWriter</span><span class="op" id="5131736">(</span><span class="ident" id="5131737">w</span>&nbsp;<span class="ident" id="5131739">io</span><span class="op" id="5131741">.</span><span class="ident" id="5131742">Writer</span><span class="op" id="5131748">)</span>&nbsp;<span class="op" id="5131750">*</span><span class="ident" id="5131751">Writer</span>&nbsp;<span class="op" id="5131758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131761">z</span><span class="op" id="5131762">,</span>&nbsp;<span class="ident" id="5131764">_</span>&nbsp;<span class="op" id="5131766">:=</span>&nbsp;<span class="ident" id="5131769">NewWriterLevelDict</span><span class="op" id="5131787">(</span><span class="ident" id="5131788">w</span><span class="op" id="5131789">,</span>&nbsp;<span class="ident" id="5131791">DefaultCompression</span><span class="op" id="5131809">,</span>&nbsp;<span class="ident" id="5131811">nil</span><span class="op" id="5131814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131817">return</span>&nbsp;<span class="ident" id="5131824">z</span><br>
<span class="lineno">45</span><span class="op" id="5131826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5131829">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="5131909">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="5131944">//</span><br>
<span class="lineno">50</span><span class="comment" id="5131947">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5132021">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5132097">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5132144">func</span>&nbsp;<span class="ident" id="5132149">NewWriterLevel</span><span class="op" id="5132163">(</span><span class="ident" id="5132164">w</span>&nbsp;<span class="ident" id="5132166">io</span><span class="op" id="5132168">.</span><span class="ident" id="5132169">Writer</span><span class="op" id="5132175">,</span>&nbsp;<span class="ident" id="5132177">level</span>&nbsp;<span class="builtintype" id="5132183">int</span><span class="op" id="5132186">)</span>&nbsp;<span class="op" id="5132188">(</span><span class="op" id="5132189">*</span><span class="ident" id="5132190">Writer</span><span class="op" id="5132196">,</span>&nbsp;<span class="builtintype" id="5132198">error</span><span class="op" id="5132203">)</span>&nbsp;<span class="op" id="5132205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132208">return</span>&nbsp;<span class="ident" id="5132215">NewWriterLevelDict</span><span class="op" id="5132233">(</span><span class="ident" id="5132234">w</span><span class="op" id="5132235">,</span>&nbsp;<span class="ident" id="5132237">level</span><span class="op" id="5132242">,</span>&nbsp;<span class="ident" id="5132244">nil</span><span class="op" id="5132247">)</span><br>
<span class="lineno">55</span><span class="op" id="5132249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5132252">//&nbsp;NewWriterLevelDict&nbsp;is&nbsp;like&nbsp;NewWriterLevel&nbsp;but&nbsp;specifies&nbsp;a&nbsp;dictionary&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5132327">//&nbsp;compress&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5132345">//</span><br>
<span class="lineno">60</span><span class="comment" id="5132348">//&nbsp;The&nbsp;dictionary&nbsp;may&nbsp;be&nbsp;nil.&nbsp;If&nbsp;not,&nbsp;its&nbsp;contents&nbsp;should&nbsp;not&nbsp;be&nbsp;modified&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="5132428">//&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="5132453">func</span>&nbsp;<span class="ident" id="5132458">NewWriterLevelDict</span><span class="op" id="5132476">(</span><span class="ident" id="5132477">w</span>&nbsp;<span class="ident" id="5132479">io</span><span class="op" id="5132481">.</span><span class="ident" id="5132482">Writer</span><span class="op" id="5132488">,</span>&nbsp;<span class="ident" id="5132490">level</span>&nbsp;<span class="builtintype" id="5132496">int</span><span class="op" id="5132499">,</span>&nbsp;<span class="ident" id="5132501">dict</span>&nbsp;<span class="op" id="5132506">[</span><span class="op" id="5132507">]</span><span class="builtintype" id="5132508">byte</span><span class="op" id="5132512">)</span>&nbsp;<span class="op" id="5132514">(</span><span class="op" id="5132515">*</span><span class="ident" id="5132516">Writer</span><span class="op" id="5132522">,</span>&nbsp;<span class="builtintype" id="5132524">error</span><span class="op" id="5132529">)</span>&nbsp;<span class="op" id="5132531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132534">if</span>&nbsp;<span class="ident" id="5132537">level</span>&nbsp;<span class="op" id="5132543">&lt;</span>&nbsp;<span class="ident" id="5132545">DefaultCompression</span>&nbsp;<span class="op" id="5132564">||</span>&nbsp;<span class="ident" id="5132567">level</span>&nbsp;<span class="op" id="5132573">&gt;</span>&nbsp;<span class="ident" id="5132575">BestCompression</span>&nbsp;<span class="op" id="5132591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132595">return</span>&nbsp;<span class="ident" id="5132602">nil</span><span class="op" id="5132605">,</span>&nbsp;<span class="ident" id="5132607">fmt</span><span class="op" id="5132610">.</span><span class="ident" id="5132611">Errorf</span><span class="op" id="5132617">(</span><span class="string" id="5132618">&#34;zlib:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="5132655">,</span>&nbsp;<span class="ident" id="5132657">level</span><span class="op" id="5132662">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5132665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132668">return</span>&nbsp;<span class="op" id="5132675">&amp;</span><span class="ident" id="5132676">Writer</span><span class="op" id="5132682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5132686">w</span><span class="op" id="5132687">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5132693">w</span><span class="op" id="5132694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5132698">level</span><span class="op" id="5132703">:</span>&nbsp;<span class="ident" id="5132705">level</span><span class="op" id="5132710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5132714">dict</span><span class="op" id="5132718">:</span>&nbsp;&nbsp;<span class="ident" id="5132721">dict</span><span class="op" id="5132725">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5132728">}</span><span class="op" id="5132729">,</span>&nbsp;<span class="ident" id="5132731">nil</span><br>
<span class="lineno"></span><span class="op" id="5132735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5132738">//&nbsp;Reset&nbsp;clears&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;Writer&nbsp;z&nbsp;such&nbsp;that&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5132814">//&nbsp;initial&nbsp;state&nbsp;from&nbsp;NewWriterLevel&nbsp;or&nbsp;NewWriterLevelDict,&nbsp;but&nbsp;instead&nbsp;writing</span><br>
<span class="lineno">75</span><span class="comment" id="5132894">//&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5132903">func</span>&nbsp;<span class="op" id="5132908">(</span><span class="ident" id="5132909">z</span>&nbsp;<span class="op" id="5132911">*</span><span class="ident" id="5132912">Writer</span><span class="op" id="5132918">)</span>&nbsp;<span class="ident" id="5132920">Reset</span><span class="op" id="5132925">(</span><span class="ident" id="5132926">w</span>&nbsp;<span class="ident" id="5132928">io</span><span class="op" id="5132930">.</span><span class="ident" id="5132931">Writer</span><span class="op" id="5132937">)</span>&nbsp;<span class="op" id="5132939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5132942">z</span><span class="op" id="5132943">.</span><span class="ident" id="5132944">w</span>&nbsp;<span class="op" id="5132946">=</span>&nbsp;<span class="ident" id="5132948">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5132951">//&nbsp;z.level&nbsp;and&nbsp;z.dict&nbsp;left&nbsp;unchanged.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132990">if</span>&nbsp;<span class="ident" id="5132993">z</span><span class="op" id="5132994">.</span><span class="ident" id="5132995">compressor</span>&nbsp;<span class="op" id="5133006">!=</span>&nbsp;<span class="ident" id="5133009">nil</span>&nbsp;<span class="op" id="5133013">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133017">z</span><span class="op" id="5133018">.</span><span class="ident" id="5133019">compressor</span><span class="op" id="5133029">.</span><span class="ident" id="5133030">Reset</span><span class="op" id="5133035">(</span><span class="ident" id="5133036">w</span><span class="op" id="5133037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5133040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133043">if</span>&nbsp;<span class="ident" id="5133046">z</span><span class="op" id="5133047">.</span><span class="ident" id="5133048">digest</span>&nbsp;<span class="op" id="5133055">!=</span>&nbsp;<span class="ident" id="5133058">nil</span>&nbsp;<span class="op" id="5133062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133066">z</span><span class="op" id="5133067">.</span><span class="ident" id="5133068">digest</span><span class="op" id="5133074">.</span><span class="ident" id="5133075">Reset</span><span class="op" id="5133080">(</span><span class="op" id="5133081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5133084">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133087">z</span><span class="op" id="5133088">.</span><span class="ident" id="5133089">err</span>&nbsp;<span class="op" id="5133093">=</span>&nbsp;<span class="ident" id="5133095">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133100">z</span><span class="op" id="5133101">.</span><span class="ident" id="5133102">scratch</span>&nbsp;<span class="op" id="5133110">=</span>&nbsp;<span class="op" id="5133112">[</span><span class="num" id="5133113">4</span><span class="op" id="5133114">]</span><span class="builtintype" id="5133115">byte</span><span class="op" id="5133119">{</span><span class="op" id="5133120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133123">z</span><span class="op" id="5133124">.</span><span class="ident" id="5133125">wroteHeader</span>&nbsp;<span class="op" id="5133137">=</span>&nbsp;<span class="builtintype" id="5133139">false</span><br>
<span class="lineno"></span><span class="op" id="5133145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5133148">//&nbsp;writeHeader&nbsp;writes&nbsp;the&nbsp;ZLIB&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="5133187">func</span>&nbsp;<span class="op" id="5133192">(</span><span class="ident" id="5133193">z</span>&nbsp;<span class="op" id="5133195">*</span><span class="ident" id="5133196">Writer</span><span class="op" id="5133202">)</span>&nbsp;<span class="ident" id="5133204">writeHeader</span><span class="op" id="5133215">(</span><span class="op" id="5133216">)</span>&nbsp;<span class="op" id="5133218">(</span><span class="ident" id="5133219">err</span>&nbsp;<span class="builtintype" id="5133223">error</span><span class="op" id="5133228">)</span>&nbsp;<span class="op" id="5133230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133233">z</span><span class="op" id="5133234">.</span><span class="ident" id="5133235">wroteHeader</span>&nbsp;<span class="op" id="5133247">=</span>&nbsp;<span class="builtintype" id="5133249">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5133255">//&nbsp;ZLIB&nbsp;has&nbsp;a&nbsp;two-byte&nbsp;header&nbsp;(as&nbsp;documented&nbsp;in&nbsp;RFC&nbsp;1950).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5133315">//&nbsp;The&nbsp;first&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CINFO&nbsp;(compression&nbsp;info),&nbsp;which&nbsp;is&nbsp;7&nbsp;for&nbsp;the&nbsp;default&nbsp;deflate&nbsp;window&nbsp;size.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5133420">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CM&nbsp;(compression&nbsp;method),&nbsp;which&nbsp;is&nbsp;8&nbsp;for&nbsp;deflate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133499">z</span><span class="op" id="5133500">.</span><span class="ident" id="5133501">scratch</span><span class="op" id="5133508">[</span><span class="num" id="5133509">0</span><span class="op" id="5133510">]</span>&nbsp;<span class="op" id="5133512">=</span>&nbsp;<span class="num" id="5133514">0x78</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5133520">//&nbsp;The&nbsp;next&nbsp;two&nbsp;bits&nbsp;is&nbsp;the&nbsp;FLEVEL&nbsp;(compression&nbsp;level).&nbsp;The&nbsp;four&nbsp;values&nbsp;are:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5133598">//&nbsp;0=fastest,&nbsp;1=fast,&nbsp;2=default,&nbsp;3=best.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5133640">//&nbsp;The&nbsp;next&nbsp;bit,&nbsp;FDICT,&nbsp;is&nbsp;set&nbsp;if&nbsp;a&nbsp;dictionary&nbsp;is&nbsp;given.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5133698">//&nbsp;The&nbsp;final&nbsp;five&nbsp;FCHECK&nbsp;bits&nbsp;form&nbsp;a&nbsp;mod-31&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133753">switch</span>&nbsp;<span class="ident" id="5133760">z</span><span class="op" id="5133761">.</span><span class="ident" id="5133762">level</span>&nbsp;<span class="op" id="5133768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133771">case</span>&nbsp;<span class="num" id="5133776">0</span><span class="op" id="5133777">,</span>&nbsp;<span class="num" id="5133779">1</span><span class="op" id="5133780">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133784">z</span><span class="op" id="5133785">.</span><span class="ident" id="5133786">scratch</span><span class="op" id="5133793">[</span><span class="num" id="5133794">1</span><span class="op" id="5133795">]</span>&nbsp;<span class="op" id="5133797">=</span>&nbsp;<span class="num" id="5133799">0</span>&nbsp;<span class="op" id="5133801">&lt;&lt;</span>&nbsp;<span class="num" id="5133804">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133807">case</span>&nbsp;<span class="num" id="5133812">2</span><span class="op" id="5133813">,</span>&nbsp;<span class="num" id="5133815">3</span><span class="op" id="5133816">,</span>&nbsp;<span class="num" id="5133818">4</span><span class="op" id="5133819">,</span>&nbsp;<span class="num" id="5133821">5</span><span class="op" id="5133822">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133826">z</span><span class="op" id="5133827">.</span><span class="ident" id="5133828">scratch</span><span class="op" id="5133835">[</span><span class="num" id="5133836">1</span><span class="op" id="5133837">]</span>&nbsp;<span class="op" id="5133839">=</span>&nbsp;<span class="num" id="5133841">1</span>&nbsp;<span class="op" id="5133843">&lt;&lt;</span>&nbsp;<span class="num" id="5133846">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133849">case</span>&nbsp;<span class="num" id="5133854">6</span><span class="op" id="5133855">,</span>&nbsp;<span class="op" id="5133857">-</span><span class="num" id="5133858">1</span><span class="op" id="5133859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133863">z</span><span class="op" id="5133864">.</span><span class="ident" id="5133865">scratch</span><span class="op" id="5133872">[</span><span class="num" id="5133873">1</span><span class="op" id="5133874">]</span>&nbsp;<span class="op" id="5133876">=</span>&nbsp;<span class="num" id="5133878">2</span>&nbsp;<span class="op" id="5133880">&lt;&lt;</span>&nbsp;<span class="num" id="5133883">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133886">case</span>&nbsp;<span class="num" id="5133891">7</span><span class="op" id="5133892">,</span>&nbsp;<span class="num" id="5133894">8</span><span class="op" id="5133895">,</span>&nbsp;<span class="num" id="5133897">9</span><span class="op" id="5133898">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133902">z</span><span class="op" id="5133903">.</span><span class="ident" id="5133904">scratch</span><span class="op" id="5133911">[</span><span class="num" id="5133912">1</span><span class="op" id="5133913">]</span>&nbsp;<span class="op" id="5133915">=</span>&nbsp;<span class="num" id="5133917">3</span>&nbsp;<span class="op" id="5133919">&lt;&lt;</span>&nbsp;<span class="num" id="5133922">6</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133925">default</span><span class="op" id="5133932">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5133936">panic</span><span class="op" id="5133941">(</span><span class="string" id="5133942">&#34;unreachable&#34;</span><span class="op" id="5133955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5133958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133961">if</span>&nbsp;<span class="ident" id="5133964">z</span><span class="op" id="5133965">.</span><span class="ident" id="5133966">dict</span>&nbsp;<span class="op" id="5133971">!=</span>&nbsp;<span class="ident" id="5133974">nil</span>&nbsp;<span class="op" id="5133978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133982">z</span><span class="op" id="5133983">.</span><span class="ident" id="5133984">scratch</span><span class="op" id="5133991">[</span><span class="num" id="5133992">1</span><span class="op" id="5133993">]</span>&nbsp;<span class="op" id="5133995">|=</span>&nbsp;<span class="num" id="5133998">1</span>&nbsp;<span class="op" id="5134000">&lt;&lt;</span>&nbsp;<span class="num" id="5134003">5</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5134006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134009">z</span><span class="op" id="5134010">.</span><span class="ident" id="5134011">scratch</span><span class="op" id="5134018">[</span><span class="num" id="5134019">1</span><span class="op" id="5134020">]</span>&nbsp;<span class="op" id="5134022">+=</span>&nbsp;<span class="builtintype" id="5134025">uint8</span><span class="op" id="5134030">(</span><span class="num" id="5134031">31</span>&nbsp;<span class="op" id="5134034">-</span>&nbsp;<span class="op" id="5134036">(</span><span class="builtintype" id="5134037">uint16</span><span class="op" id="5134043">(</span><span class="ident" id="5134044">z</span><span class="op" id="5134045">.</span><span class="ident" id="5134046">scratch</span><span class="op" id="5134053">[</span><span class="num" id="5134054">0</span><span class="op" id="5134055">]</span><span class="op" id="5134056">)</span><span class="op" id="5134057">&lt;&lt;</span><span class="num" id="5134059">8</span><span class="op" id="5134060">+</span><span class="builtintype" id="5134061">uint16</span><span class="op" id="5134067">(</span><span class="ident" id="5134068">z</span><span class="op" id="5134069">.</span><span class="ident" id="5134070">scratch</span><span class="op" id="5134077">[</span><span class="num" id="5134078">1</span><span class="op" id="5134079">]</span><span class="op" id="5134080">)</span><span class="op" id="5134081">)</span><span class="op" id="5134082">%</span><span class="num" id="5134083">31</span><span class="op" id="5134085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134088">if</span>&nbsp;<span class="ident" id="5134091">_</span><span class="op" id="5134092">,</span>&nbsp;<span class="ident" id="5134094">err</span>&nbsp;<span class="op" id="5134098">=</span>&nbsp;<span class="ident" id="5134100">z</span><span class="op" id="5134101">.</span><span class="ident" id="5134102">w</span><span class="op" id="5134103">.</span><span class="ident" id="5134104">Write</span><span class="op" id="5134109">(</span><span class="ident" id="5134110">z</span><span class="op" id="5134111">.</span><span class="ident" id="5134112">scratch</span><span class="op" id="5134119">[</span><span class="num" id="5134120">0</span><span class="op" id="5134121">:</span><span class="num" id="5134122">2</span><span class="op" id="5134123">]</span><span class="op" id="5134124">)</span><span class="op" id="5134125">;</span>&nbsp;<span class="ident" id="5134127">err</span>&nbsp;<span class="op" id="5134131">!=</span>&nbsp;<span class="ident" id="5134134">nil</span>&nbsp;<span class="op" id="5134138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134142">return</span>&nbsp;<span class="ident" id="5134149">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5134154">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134157">if</span>&nbsp;<span class="ident" id="5134160">z</span><span class="op" id="5134161">.</span><span class="ident" id="5134162">dict</span>&nbsp;<span class="op" id="5134167">!=</span>&nbsp;<span class="ident" id="5134170">nil</span>&nbsp;<span class="op" id="5134174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5134178">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bytes&nbsp;are&nbsp;the&nbsp;Adler-32&nbsp;checksum&nbsp;of&nbsp;the&nbsp;dictionary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134248">checksum</span>&nbsp;<span class="op" id="5134257">:=</span>&nbsp;<span class="ident" id="5134260">adler32</span><span class="op" id="5134267">.</span><span class="ident" id="5134268">Checksum</span><span class="op" id="5134276">(</span><span class="ident" id="5134277">z</span><span class="op" id="5134278">.</span><span class="ident" id="5134279">dict</span><span class="op" id="5134283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134287">z</span><span class="op" id="5134288">.</span><span class="ident" id="5134289">scratch</span><span class="op" id="5134296">[</span><span class="num" id="5134297">0</span><span class="op" id="5134298">]</span>&nbsp;<span class="op" id="5134300">=</span>&nbsp;<span class="builtintype" id="5134302">uint8</span><span class="op" id="5134307">(</span><span class="ident" id="5134308">checksum</span>&nbsp;<span class="op" id="5134317">&gt;&gt;</span>&nbsp;<span class="num" id="5134320">24</span><span class="op" id="5134322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134326">z</span><span class="op" id="5134327">.</span><span class="ident" id="5134328">scratch</span><span class="op" id="5134335">[</span><span class="num" id="5134336">1</span><span class="op" id="5134337">]</span>&nbsp;<span class="op" id="5134339">=</span>&nbsp;<span class="builtintype" id="5134341">uint8</span><span class="op" id="5134346">(</span><span class="ident" id="5134347">checksum</span>&nbsp;<span class="op" id="5134356">&gt;&gt;</span>&nbsp;<span class="num" id="5134359">16</span><span class="op" id="5134361">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134365">z</span><span class="op" id="5134366">.</span><span class="ident" id="5134367">scratch</span><span class="op" id="5134374">[</span><span class="num" id="5134375">2</span><span class="op" id="5134376">]</span>&nbsp;<span class="op" id="5134378">=</span>&nbsp;<span class="builtintype" id="5134380">uint8</span><span class="op" id="5134385">(</span><span class="ident" id="5134386">checksum</span>&nbsp;<span class="op" id="5134395">&gt;&gt;</span>&nbsp;<span class="num" id="5134398">8</span><span class="op" id="5134399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134403">z</span><span class="op" id="5134404">.</span><span class="ident" id="5134405">scratch</span><span class="op" id="5134412">[</span><span class="num" id="5134413">3</span><span class="op" id="5134414">]</span>&nbsp;<span class="op" id="5134416">=</span>&nbsp;<span class="builtintype" id="5134418">uint8</span><span class="op" id="5134423">(</span><span class="ident" id="5134424">checksum</span>&nbsp;<span class="op" id="5134433">&gt;&gt;</span>&nbsp;<span class="num" id="5134436">0</span><span class="op" id="5134437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134441">if</span>&nbsp;<span class="ident" id="5134444">_</span><span class="op" id="5134445">,</span>&nbsp;<span class="ident" id="5134447">err</span>&nbsp;<span class="op" id="5134451">=</span>&nbsp;<span class="ident" id="5134453">z</span><span class="op" id="5134454">.</span><span class="ident" id="5134455">w</span><span class="op" id="5134456">.</span><span class="ident" id="5134457">Write</span><span class="op" id="5134462">(</span><span class="ident" id="5134463">z</span><span class="op" id="5134464">.</span><span class="ident" id="5134465">scratch</span><span class="op" id="5134472">[</span><span class="num" id="5134473">0</span><span class="op" id="5134474">:</span><span class="num" id="5134475">4</span><span class="op" id="5134476">]</span><span class="op" id="5134477">)</span><span class="op" id="5134478">;</span>&nbsp;<span class="ident" id="5134480">err</span>&nbsp;<span class="op" id="5134484">!=</span>&nbsp;<span class="ident" id="5134487">nil</span>&nbsp;<span class="op" id="5134491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134496">return</span>&nbsp;<span class="ident" id="5134503">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5134509">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5134512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134515">if</span>&nbsp;<span class="ident" id="5134518">z</span><span class="op" id="5134519">.</span><span class="ident" id="5134520">compressor</span>&nbsp;<span class="op" id="5134531">==</span>&nbsp;<span class="ident" id="5134534">nil</span>&nbsp;<span class="op" id="5134538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5134542">//&nbsp;Initialize&nbsp;deflater&nbsp;unless&nbsp;the&nbsp;Writer&nbsp;is&nbsp;being&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5134601">//&nbsp;after&nbsp;a&nbsp;Reset&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134626">z</span><span class="op" id="5134627">.</span><span class="ident" id="5134628">compressor</span><span class="op" id="5134638">,</span>&nbsp;<span class="ident" id="5134640">err</span>&nbsp;<span class="op" id="5134644">=</span>&nbsp;<span class="ident" id="5134646">flate</span><span class="op" id="5134651">.</span><span class="ident" id="5134652">NewWriterDict</span><span class="op" id="5134665">(</span><span class="ident" id="5134666">z</span><span class="op" id="5134667">.</span><span class="ident" id="5134668">w</span><span class="op" id="5134669">,</span>&nbsp;<span class="ident" id="5134671">z</span><span class="op" id="5134672">.</span><span class="ident" id="5134673">level</span><span class="op" id="5134678">,</span>&nbsp;<span class="ident" id="5134680">z</span><span class="op" id="5134681">.</span><span class="ident" id="5134682">dict</span><span class="op" id="5134686">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134690">if</span>&nbsp;<span class="ident" id="5134693">err</span>&nbsp;<span class="op" id="5134697">!=</span>&nbsp;<span class="ident" id="5134700">nil</span>&nbsp;<span class="op" id="5134704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134709">return</span>&nbsp;<span class="ident" id="5134716">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5134722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134726">z</span><span class="op" id="5134727">.</span><span class="ident" id="5134728">digest</span>&nbsp;<span class="op" id="5134735">=</span>&nbsp;<span class="ident" id="5134737">adler32</span><span class="op" id="5134744">.</span><span class="ident" id="5134745">New</span><span class="op" id="5134748">(</span><span class="op" id="5134749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5134752">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134755">return</span>&nbsp;<span class="ident" id="5134762">nil</span><br>
<span class="lineno"></span><span class="op" id="5134766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5134769">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5134841">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed&nbsp;or</span><br>
<span class="lineno">145</span><span class="comment" id="5134919">//&nbsp;explicitly&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5134942">func</span>&nbsp;<span class="op" id="5134947">(</span><span class="ident" id="5134948">z</span>&nbsp;<span class="op" id="5134950">*</span><span class="ident" id="5134951">Writer</span><span class="op" id="5134957">)</span>&nbsp;<span class="ident" id="5134959">Write</span><span class="op" id="5134964">(</span><span class="ident" id="5134965">p</span>&nbsp;<span class="op" id="5134967">[</span><span class="op" id="5134968">]</span><span class="builtintype" id="5134969">byte</span><span class="op" id="5134973">)</span>&nbsp;<span class="op" id="5134975">(</span><span class="ident" id="5134976">n</span>&nbsp;<span class="builtintype" id="5134978">int</span><span class="op" id="5134981">,</span>&nbsp;<span class="ident" id="5134983">err</span>&nbsp;<span class="builtintype" id="5134987">error</span><span class="op" id="5134992">)</span>&nbsp;<span class="op" id="5134994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134997">if</span>&nbsp;<span class="op" id="5135000">!</span><span class="ident" id="5135001">z</span><span class="op" id="5135002">.</span><span class="ident" id="5135003">wroteHeader</span>&nbsp;<span class="op" id="5135015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135019">z</span><span class="op" id="5135020">.</span><span class="ident" id="5135021">err</span>&nbsp;<span class="op" id="5135025">=</span>&nbsp;<span class="ident" id="5135027">z</span><span class="op" id="5135028">.</span><span class="ident" id="5135029">writeHeader</span><span class="op" id="5135040">(</span><span class="op" id="5135041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5135044">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135047">if</span>&nbsp;<span class="ident" id="5135050">z</span><span class="op" id="5135051">.</span><span class="ident" id="5135052">err</span>&nbsp;<span class="op" id="5135056">!=</span>&nbsp;<span class="ident" id="5135059">nil</span>&nbsp;<span class="op" id="5135063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135067">return</span>&nbsp;<span class="num" id="5135074">0</span><span class="op" id="5135075">,</span>&nbsp;<span class="ident" id="5135077">z</span><span class="op" id="5135078">.</span><span class="ident" id="5135079">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5135084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135087">if</span>&nbsp;<span class="builtinfunc" id="5135090">len</span><span class="op" id="5135093">(</span><span class="ident" id="5135094">p</span><span class="op" id="5135095">)</span>&nbsp;<span class="op" id="5135097">==</span>&nbsp;<span class="num" id="5135100">0</span>&nbsp;<span class="op" id="5135102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135106">return</span>&nbsp;<span class="num" id="5135113">0</span><span class="op" id="5135114">,</span>&nbsp;<span class="ident" id="5135116">nil</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5135121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135124">n</span><span class="op" id="5135125">,</span>&nbsp;<span class="ident" id="5135127">err</span>&nbsp;<span class="op" id="5135131">=</span>&nbsp;<span class="ident" id="5135133">z</span><span class="op" id="5135134">.</span><span class="ident" id="5135135">compressor</span><span class="op" id="5135145">.</span><span class="ident" id="5135146">Write</span><span class="op" id="5135151">(</span><span class="ident" id="5135152">p</span><span class="op" id="5135153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135156">if</span>&nbsp;<span class="ident" id="5135159">err</span>&nbsp;<span class="op" id="5135163">!=</span>&nbsp;<span class="ident" id="5135166">nil</span>&nbsp;<span class="op" id="5135170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135174">z</span><span class="op" id="5135175">.</span><span class="ident" id="5135176">err</span>&nbsp;<span class="op" id="5135180">=</span>&nbsp;<span class="ident" id="5135182">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135188">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5135196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135199">z</span><span class="op" id="5135200">.</span><span class="ident" id="5135201">digest</span><span class="op" id="5135207">.</span><span class="ident" id="5135208">Write</span><span class="op" id="5135213">(</span><span class="ident" id="5135214">p</span><span class="op" id="5135215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135218">return</span><br>
<span class="lineno"></span><span class="op" id="5135225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5135228">//&nbsp;Flush&nbsp;flushes&nbsp;the&nbsp;Writer&nbsp;to&nbsp;its&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5135285">func</span>&nbsp;<span class="op" id="5135290">(</span><span class="ident" id="5135291">z</span>&nbsp;<span class="op" id="5135293">*</span><span class="ident" id="5135294">Writer</span><span class="op" id="5135300">)</span>&nbsp;<span class="ident" id="5135302">Flush</span><span class="op" id="5135307">(</span><span class="op" id="5135308">)</span>&nbsp;<span class="builtintype" id="5135310">error</span>&nbsp;<span class="op" id="5135316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135319">if</span>&nbsp;<span class="op" id="5135322">!</span><span class="ident" id="5135323">z</span><span class="op" id="5135324">.</span><span class="ident" id="5135325">wroteHeader</span>&nbsp;<span class="op" id="5135337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135341">z</span><span class="op" id="5135342">.</span><span class="ident" id="5135343">err</span>&nbsp;<span class="op" id="5135347">=</span>&nbsp;<span class="ident" id="5135349">z</span><span class="op" id="5135350">.</span><span class="ident" id="5135351">writeHeader</span><span class="op" id="5135362">(</span><span class="op" id="5135363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5135366">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135369">if</span>&nbsp;<span class="ident" id="5135372">z</span><span class="op" id="5135373">.</span><span class="ident" id="5135374">err</span>&nbsp;<span class="op" id="5135378">!=</span>&nbsp;<span class="ident" id="5135381">nil</span>&nbsp;<span class="op" id="5135385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135389">return</span>&nbsp;<span class="ident" id="5135396">z</span><span class="op" id="5135397">.</span><span class="ident" id="5135398">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5135403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135406">z</span><span class="op" id="5135407">.</span><span class="ident" id="5135408">err</span>&nbsp;<span class="op" id="5135412">=</span>&nbsp;<span class="ident" id="5135414">z</span><span class="op" id="5135415">.</span><span class="ident" id="5135416">compressor</span><span class="op" id="5135426">.</span><span class="ident" id="5135427">Flush</span><span class="op" id="5135432">(</span><span class="op" id="5135433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135436">return</span>&nbsp;<span class="ident" id="5135443">z</span><span class="op" id="5135444">.</span><span class="ident" id="5135445">err</span><br>
<span class="lineno">175</span><span class="op" id="5135449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5135452">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="5135526">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5135585">func</span>&nbsp;<span class="op" id="5135590">(</span><span class="ident" id="5135591">z</span>&nbsp;<span class="op" id="5135593">*</span><span class="ident" id="5135594">Writer</span><span class="op" id="5135600">)</span>&nbsp;<span class="ident" id="5135602">Close</span><span class="op" id="5135607">(</span><span class="op" id="5135608">)</span>&nbsp;<span class="builtintype" id="5135610">error</span>&nbsp;<span class="op" id="5135616">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135619">if</span>&nbsp;<span class="op" id="5135622">!</span><span class="ident" id="5135623">z</span><span class="op" id="5135624">.</span><span class="ident" id="5135625">wroteHeader</span>&nbsp;<span class="op" id="5135637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135641">z</span><span class="op" id="5135642">.</span><span class="ident" id="5135643">err</span>&nbsp;<span class="op" id="5135647">=</span>&nbsp;<span class="ident" id="5135649">z</span><span class="op" id="5135650">.</span><span class="ident" id="5135651">writeHeader</span><span class="op" id="5135662">(</span><span class="op" id="5135663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5135666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135669">if</span>&nbsp;<span class="ident" id="5135672">z</span><span class="op" id="5135673">.</span><span class="ident" id="5135674">err</span>&nbsp;<span class="op" id="5135678">!=</span>&nbsp;<span class="ident" id="5135681">nil</span>&nbsp;<span class="op" id="5135685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135689">return</span>&nbsp;<span class="ident" id="5135696">z</span><span class="op" id="5135697">.</span><span class="ident" id="5135698">err</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5135703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135706">z</span><span class="op" id="5135707">.</span><span class="ident" id="5135708">err</span>&nbsp;<span class="op" id="5135712">=</span>&nbsp;<span class="ident" id="5135714">z</span><span class="op" id="5135715">.</span><span class="ident" id="5135716">compressor</span><span class="op" id="5135726">.</span><span class="ident" id="5135727">Close</span><span class="op" id="5135732">(</span><span class="op" id="5135733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135736">if</span>&nbsp;<span class="ident" id="5135739">z</span><span class="op" id="5135740">.</span><span class="ident" id="5135741">err</span>&nbsp;<span class="op" id="5135745">!=</span>&nbsp;<span class="ident" id="5135748">nil</span>&nbsp;<span class="op" id="5135752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135756">return</span>&nbsp;<span class="ident" id="5135763">z</span><span class="op" id="5135764">.</span><span class="ident" id="5135765">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5135770">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135773">checksum</span>&nbsp;<span class="op" id="5135782">:=</span>&nbsp;<span class="ident" id="5135785">z</span><span class="op" id="5135786">.</span><span class="ident" id="5135787">digest</span><span class="op" id="5135793">.</span><span class="ident" id="5135794">Sum32</span><span class="op" id="5135799">(</span><span class="op" id="5135800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5135803">//&nbsp;ZLIB&nbsp;(RFC&nbsp;1950)&nbsp;is&nbsp;big-endian,&nbsp;unlike&nbsp;GZIP&nbsp;(RFC&nbsp;1952).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135862">z</span><span class="op" id="5135863">.</span><span class="ident" id="5135864">scratch</span><span class="op" id="5135871">[</span><span class="num" id="5135872">0</span><span class="op" id="5135873">]</span>&nbsp;<span class="op" id="5135875">=</span>&nbsp;<span class="builtintype" id="5135877">uint8</span><span class="op" id="5135882">(</span><span class="ident" id="5135883">checksum</span>&nbsp;<span class="op" id="5135892">&gt;&gt;</span>&nbsp;<span class="num" id="5135895">24</span><span class="op" id="5135897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135900">z</span><span class="op" id="5135901">.</span><span class="ident" id="5135902">scratch</span><span class="op" id="5135909">[</span><span class="num" id="5135910">1</span><span class="op" id="5135911">]</span>&nbsp;<span class="op" id="5135913">=</span>&nbsp;<span class="builtintype" id="5135915">uint8</span><span class="op" id="5135920">(</span><span class="ident" id="5135921">checksum</span>&nbsp;<span class="op" id="5135930">&gt;&gt;</span>&nbsp;<span class="num" id="5135933">16</span><span class="op" id="5135935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135938">z</span><span class="op" id="5135939">.</span><span class="ident" id="5135940">scratch</span><span class="op" id="5135947">[</span><span class="num" id="5135948">2</span><span class="op" id="5135949">]</span>&nbsp;<span class="op" id="5135951">=</span>&nbsp;<span class="builtintype" id="5135953">uint8</span><span class="op" id="5135958">(</span><span class="ident" id="5135959">checksum</span>&nbsp;<span class="op" id="5135968">&gt;&gt;</span>&nbsp;<span class="num" id="5135971">8</span><span class="op" id="5135972">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135975">z</span><span class="op" id="5135976">.</span><span class="ident" id="5135977">scratch</span><span class="op" id="5135984">[</span><span class="num" id="5135985">3</span><span class="op" id="5135986">]</span>&nbsp;<span class="op" id="5135988">=</span>&nbsp;<span class="builtintype" id="5135990">uint8</span><span class="op" id="5135995">(</span><span class="ident" id="5135996">checksum</span>&nbsp;<span class="op" id="5136005">&gt;&gt;</span>&nbsp;<span class="num" id="5136008">0</span><span class="op" id="5136009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136012">_</span><span class="op" id="5136013">,</span>&nbsp;<span class="ident" id="5136015">z</span><span class="op" id="5136016">.</span><span class="ident" id="5136017">err</span>&nbsp;<span class="op" id="5136021">=</span>&nbsp;<span class="ident" id="5136023">z</span><span class="op" id="5136024">.</span><span class="ident" id="5136025">w</span><span class="op" id="5136026">.</span><span class="ident" id="5136027">Write</span><span class="op" id="5136032">(</span><span class="ident" id="5136033">z</span><span class="op" id="5136034">.</span><span class="ident" id="5136035">scratch</span><span class="op" id="5136042">[</span><span class="num" id="5136043">0</span><span class="op" id="5136044">:</span><span class="num" id="5136045">4</span><span class="op" id="5136046">]</span><span class="op" id="5136047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5136050">return</span>&nbsp;<span class="ident" id="5136057">z</span><span class="op" id="5136058">.</span><span class="ident" id="5136059">err</span><br>
<span class="lineno"></span><span class="op" id="5136063">}</span>
</div>
</body>
</html>
