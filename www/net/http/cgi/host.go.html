<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5135343">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5135398">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5135452">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5135503">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;host&nbsp;side&nbsp;of&nbsp;CGI&nbsp;(being&nbsp;the&nbsp;webserver</span><br>
<span class="lineno"></span><span class="comment" id="5135569">//&nbsp;parent&nbsp;process).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5135590">//&nbsp;Package&nbsp;cgi&nbsp;implements&nbsp;CGI&nbsp;(Common&nbsp;Gateway&nbsp;Interface)&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="5135660">//&nbsp;in&nbsp;RFC&nbsp;3875.</span><br>
<span class="lineno">10</span><span class="comment" id="5135676">//</span><br>
<span class="lineno"></span><span class="comment" id="5135679">//&nbsp;Note&nbsp;that&nbsp;using&nbsp;CGI&nbsp;means&nbsp;starting&nbsp;a&nbsp;new&nbsp;process&nbsp;to&nbsp;handle&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="5135746">//&nbsp;request,&nbsp;which&nbsp;is&nbsp;typically&nbsp;less&nbsp;efficient&nbsp;than&nbsp;using&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5135805">//&nbsp;long-running&nbsp;server.&nbsp;&nbsp;This&nbsp;package&nbsp;is&nbsp;intended&nbsp;primarily&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5135869">//&nbsp;compatibility&nbsp;with&nbsp;existing&nbsp;systems.</span><br>
<span class="lineno">15</span><span class="keyword" id="5135909">package</span>&nbsp;<span class="ident" id="5135917">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5135922">import</span>&nbsp;<span class="op" id="5135929">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5135932">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5135941">&#34;fmt&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5135948">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5135954">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5135961">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5135973">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5135979">&#34;os/exec&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5135990">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5136007">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5136017">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5136028">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5136039">&#34;strings&#34;</span><br>
<span class="lineno">30</span><span class="op" id="5136049">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5136052">var</span>&nbsp;<span class="ident" id="5136056">trailingPort</span>&nbsp;<span class="op" id="5136069">=</span>&nbsp;<span class="ident" id="5136071">regexp</span><span class="op" id="5136077">.</span><span class="ident" id="5136078">MustCompile</span><span class="op" id="5136089">(</span><span class="string" id="5136090">`:([0-9]+)$`</span><span class="op" id="5136102">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5136105">var</span>&nbsp;<span class="ident" id="5136109">osDefaultInheritEnv</span>&nbsp;<span class="op" id="5136129">=</span>&nbsp;<span class="keyword" id="5136131">map</span><span class="op" id="5136134">[</span><span class="builtintype" id="5136135">string</span><span class="op" id="5136141">]</span><span class="op" id="5136142">[</span><span class="op" id="5136143">]</span><span class="builtintype" id="5136144">string</span><span class="op" id="5136150">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5136153">&#34;darwin&#34;</span><span class="op" id="5136161">:</span>&nbsp;&nbsp;<span class="op" id="5136164">{</span><span class="string" id="5136165">&#34;DYLD_LIBRARY_PATH&#34;</span><span class="op" id="5136184">}</span><span class="op" id="5136185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5136188">&#34;freebsd&#34;</span><span class="op" id="5136197">:</span>&nbsp;<span class="op" id="5136199">{</span><span class="string" id="5136200">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5136217">}</span><span class="op" id="5136218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5136221">&#34;hpux&#34;</span><span class="op" id="5136227">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5136232">{</span><span class="string" id="5136233">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5136250">,</span>&nbsp;<span class="string" id="5136252">&#34;SHLIB_PATH&#34;</span><span class="op" id="5136264">}</span><span class="op" id="5136265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5136268">&#34;irix&#34;</span><span class="op" id="5136274">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5136279">{</span><span class="string" id="5136280">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5136297">,</span>&nbsp;<span class="string" id="5136299">&#34;LD_LIBRARYN32_PATH&#34;</span><span class="op" id="5136319">,</span>&nbsp;<span class="string" id="5136321">&#34;LD_LIBRARY64_PATH&#34;</span><span class="op" id="5136340">}</span><span class="op" id="5136341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5136344">&#34;linux&#34;</span><span class="op" id="5136351">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5136355">{</span><span class="string" id="5136356">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5136373">}</span><span class="op" id="5136374">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5136377">&#34;openbsd&#34;</span><span class="op" id="5136386">:</span>&nbsp;<span class="op" id="5136388">{</span><span class="string" id="5136389">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5136406">}</span><span class="op" id="5136407">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5136410">&#34;solaris&#34;</span><span class="op" id="5136419">:</span>&nbsp;<span class="op" id="5136421">{</span><span class="string" id="5136422">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5136439">,</span>&nbsp;<span class="string" id="5136441">&#34;LD_LIBRARY_PATH_32&#34;</span><span class="op" id="5136461">,</span>&nbsp;<span class="string" id="5136463">&#34;LD_LIBRARY_PATH_64&#34;</span><span class="op" id="5136483">}</span><span class="op" id="5136484">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5136487">&#34;windows&#34;</span><span class="op" id="5136496">:</span>&nbsp;<span class="op" id="5136498">{</span><span class="string" id="5136499">&#34;SystemRoot&#34;</span><span class="op" id="5136511">,</span>&nbsp;<span class="string" id="5136513">&#34;COMSPEC&#34;</span><span class="op" id="5136522">,</span>&nbsp;<span class="string" id="5136524">&#34;PATHEXT&#34;</span><span class="op" id="5136533">,</span>&nbsp;<span class="string" id="5136535">&#34;WINDIR&#34;</span><span class="op" id="5136543">}</span><span class="op" id="5136544">,</span><br>
<span class="lineno"></span><span class="op" id="5136546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5136549">//&nbsp;Handler&nbsp;runs&nbsp;an&nbsp;executable&nbsp;in&nbsp;a&nbsp;subprocess&nbsp;with&nbsp;a&nbsp;CGI&nbsp;environment.</span><br>
<span class="lineno"></span><span class="keyword" id="5136619">type</span>&nbsp;<span class="ident" id="5136624">Handler</span>&nbsp;<span class="keyword" id="5136632">struct</span>&nbsp;<span class="op" id="5136639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136642">Path</span>&nbsp;<span class="builtintype" id="5136647">string</span>&nbsp;<span class="comment" id="5136654">//&nbsp;path&nbsp;to&nbsp;the&nbsp;CGI&nbsp;executable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136685">Root</span>&nbsp;<span class="builtintype" id="5136690">string</span>&nbsp;<span class="comment" id="5136697">//&nbsp;root&nbsp;URI&nbsp;prefix&nbsp;of&nbsp;handler&nbsp;or&nbsp;empty&nbsp;for&nbsp;&#34;/&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5136746">//&nbsp;Dir&nbsp;specifies&nbsp;the&nbsp;CGI&nbsp;executable&#39;s&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5136804">//&nbsp;If&nbsp;Dir&nbsp;is&nbsp;empty,&nbsp;the&nbsp;base&nbsp;directory&nbsp;of&nbsp;Path&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5136861">//&nbsp;If&nbsp;Path&nbsp;has&nbsp;no&nbsp;base&nbsp;directory,&nbsp;the&nbsp;current&nbsp;working</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5136916">//&nbsp;directory&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136939">Dir</span>&nbsp;<span class="builtintype" id="5136943">string</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136952">Env</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5136963">[</span><span class="op" id="5136964">]</span><span class="builtintype" id="5136965">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5136975">//&nbsp;extra&nbsp;environment&nbsp;variables&nbsp;to&nbsp;set,&nbsp;if&nbsp;any,&nbsp;as&nbsp;&#34;key=value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137038">InheritEnv</span>&nbsp;<span class="op" id="5137049">[</span><span class="op" id="5137050">]</span><span class="builtintype" id="5137051">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5137061">//&nbsp;environment&nbsp;variables&nbsp;to&nbsp;inherit&nbsp;from&nbsp;host,&nbsp;as&nbsp;&#34;key&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137118">Logger</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5137129">*</span><span class="ident" id="5137130">log</span><span class="op" id="5137133">.</span><span class="ident" id="5137134">Logger</span>&nbsp;<span class="comment" id="5137141">//&nbsp;optional&nbsp;log&nbsp;for&nbsp;errors&nbsp;or&nbsp;nil&nbsp;to&nbsp;use&nbsp;log.Print</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137193">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5137204">[</span><span class="op" id="5137205">]</span><span class="builtintype" id="5137206">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5137216">//&nbsp;optional&nbsp;arguments&nbsp;to&nbsp;pass&nbsp;to&nbsp;child&nbsp;process</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5137265">//&nbsp;PathLocationHandler&nbsp;specifies&nbsp;the&nbsp;root&nbsp;http&nbsp;Handler&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5137326">//&nbsp;should&nbsp;handle&nbsp;internal&nbsp;redirects&nbsp;when&nbsp;the&nbsp;CGI&nbsp;process</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5137384">//&nbsp;returns&nbsp;a&nbsp;Location&nbsp;header&nbsp;value&nbsp;starting&nbsp;with&nbsp;a&nbsp;&#34;/&#34;,&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5137444">//&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;3875&nbsp;ยง&nbsp;6.3.2.&nbsp;This&nbsp;will&nbsp;likely&nbsp;be</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5137500">//&nbsp;http.DefaultServeMux.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5137526">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5137530">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;CGI&nbsp;response&nbsp;with&nbsp;a&nbsp;local&nbsp;URI&nbsp;path&nbsp;is&nbsp;instead&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5137595">//&nbsp;back&nbsp;to&nbsp;the&nbsp;client&nbsp;and&nbsp;not&nbsp;redirected&nbsp;internally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137649">PathLocationHandler</span>&nbsp;<span class="ident" id="5137669">http</span><span class="op" id="5137673">.</span><span class="ident" id="5137674">Handler</span><br>
<span class="lineno">70</span><span class="op" id="5137682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5137685">//&nbsp;removeLeadingDuplicates&nbsp;remove&nbsp;leading&nbsp;duplicate&nbsp;in&nbsp;environments.</span><br>
<span class="lineno"></span><span class="comment" id="5137754">//&nbsp;It&#39;s&nbsp;possible&nbsp;to&nbsp;override&nbsp;environment&nbsp;like&nbsp;following.</span><br>
<span class="lineno"></span><span class="comment" id="5137811">//&nbsp;&nbsp;&nbsp;&nbsp;cgi.Handler{</span><br>
<span class="lineno">75</span><span class="comment" id="5137830">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5137842">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Env:&nbsp;[]string{&#34;SCRIPT_FILENAME=foo.php&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="5137892">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="keyword" id="5137900">func</span>&nbsp;<span class="ident" id="5137905">removeLeadingDuplicates</span><span class="op" id="5137928">(</span><span class="ident" id="5137929">env</span>&nbsp;<span class="op" id="5137933">[</span><span class="op" id="5137934">]</span><span class="builtintype" id="5137935">string</span><span class="op" id="5137941">)</span>&nbsp;<span class="op" id="5137943">(</span><span class="ident" id="5137944">ret</span>&nbsp;<span class="op" id="5137948">[</span><span class="op" id="5137949">]</span><span class="builtintype" id="5137950">string</span><span class="op" id="5137956">)</span>&nbsp;<span class="op" id="5137958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137961">n</span>&nbsp;<span class="op" id="5137963">:=</span>&nbsp;<span class="builtinfunc" id="5137966">len</span><span class="op" id="5137969">(</span><span class="ident" id="5137970">env</span><span class="op" id="5137973">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5137976">for</span>&nbsp;<span class="ident" id="5137980">i</span>&nbsp;<span class="op" id="5137982">:=</span>&nbsp;<span class="num" id="5137985">0</span><span class="op" id="5137986">;</span>&nbsp;<span class="ident" id="5137988">i</span>&nbsp;<span class="op" id="5137990">&lt;</span>&nbsp;<span class="ident" id="5137992">n</span><span class="op" id="5137993">;</span>&nbsp;<span class="ident" id="5137995">i</span><span class="op" id="5137996">++</span>&nbsp;<span class="op" id="5137999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138003">e</span>&nbsp;<span class="op" id="5138005">:=</span>&nbsp;<span class="ident" id="5138008">env</span><span class="op" id="5138011">[</span><span class="ident" id="5138012">i</span><span class="op" id="5138013">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138017">s</span>&nbsp;<span class="op" id="5138019">:=</span>&nbsp;<span class="ident" id="5138022">strings</span><span class="op" id="5138029">.</span><span class="ident" id="5138030">SplitN</span><span class="op" id="5138036">(</span><span class="ident" id="5138037">e</span><span class="op" id="5138038">,</span>&nbsp;<span class="string" id="5138040">&#34;=&#34;</span><span class="op" id="5138043">,</span>&nbsp;<span class="num" id="5138045">2</span><span class="op" id="5138046">)</span><span class="op" id="5138047">[</span><span class="num" id="5138048">0</span><span class="op" id="5138049">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138053">found</span>&nbsp;<span class="op" id="5138059">:=</span>&nbsp;<span class="ident" id="5138062">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5138070">for</span>&nbsp;<span class="ident" id="5138074">j</span>&nbsp;<span class="op" id="5138076">:=</span>&nbsp;<span class="ident" id="5138079">i</span>&nbsp;<span class="op" id="5138081">+</span>&nbsp;<span class="num" id="5138083">1</span><span class="op" id="5138084">;</span>&nbsp;<span class="ident" id="5138086">j</span>&nbsp;<span class="op" id="5138088">&lt;</span>&nbsp;<span class="ident" id="5138090">n</span><span class="op" id="5138091">;</span>&nbsp;<span class="ident" id="5138093">j</span><span class="op" id="5138094">++</span>&nbsp;<span class="op" id="5138097">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5138102">if</span>&nbsp;<span class="ident" id="5138105">s</span>&nbsp;<span class="op" id="5138107">==</span>&nbsp;<span class="ident" id="5138110">strings</span><span class="op" id="5138117">.</span><span class="ident" id="5138118">SplitN</span><span class="op" id="5138124">(</span><span class="ident" id="5138125">env</span><span class="op" id="5138128">[</span><span class="ident" id="5138129">j</span><span class="op" id="5138130">]</span><span class="op" id="5138131">,</span>&nbsp;<span class="string" id="5138133">&#34;=&#34;</span><span class="op" id="5138136">,</span>&nbsp;<span class="num" id="5138138">2</span><span class="op" id="5138139">)</span><span class="op" id="5138140">[</span><span class="num" id="5138141">0</span><span class="op" id="5138142">]</span>&nbsp;<span class="op" id="5138144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138150">found</span>&nbsp;<span class="op" id="5138156">=</span>&nbsp;<span class="ident" id="5138158">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5138167">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5138176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5138180">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5138184">if</span>&nbsp;<span class="op" id="5138187">!</span><span class="ident" id="5138188">found</span>&nbsp;<span class="op" id="5138194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138199">ret</span>&nbsp;<span class="op" id="5138203">=</span>&nbsp;<span class="builtinfunc" id="5138205">append</span><span class="op" id="5138211">(</span><span class="ident" id="5138212">ret</span><span class="op" id="5138215">,</span>&nbsp;<span class="ident" id="5138217">e</span><span class="op" id="5138218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5138222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5138225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5138228">return</span><br>
<span class="lineno">95</span><span class="op" id="5138235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5138238">func</span>&nbsp;<span class="op" id="5138243">(</span><span class="ident" id="5138244">h</span>&nbsp;<span class="op" id="5138246">*</span><span class="ident" id="5138247">Handler</span><span class="op" id="5138254">)</span>&nbsp;<span class="ident" id="5138256">ServeHTTP</span><span class="op" id="5138265">(</span><span class="ident" id="5138266">rw</span>&nbsp;<span class="ident" id="5138269">http</span><span class="op" id="5138273">.</span><span class="ident" id="5138274">ResponseWriter</span><span class="op" id="5138288">,</span>&nbsp;<span class="ident" id="5138290">req</span>&nbsp;<span class="op" id="5138294">*</span><span class="ident" id="5138295">http</span><span class="op" id="5138299">.</span><span class="ident" id="5138300">Request</span><span class="op" id="5138307">)</span>&nbsp;<span class="op" id="5138309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138312">root</span>&nbsp;<span class="op" id="5138317">:=</span>&nbsp;<span class="ident" id="5138320">h</span><span class="op" id="5138321">.</span><span class="ident" id="5138322">Root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5138328">if</span>&nbsp;<span class="ident" id="5138331">root</span>&nbsp;<span class="op" id="5138336">==</span>&nbsp;<span class="string" id="5138339">&#34;&#34;</span>&nbsp;<span class="op" id="5138342">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138346">root</span>&nbsp;<span class="op" id="5138351">=</span>&nbsp;<span class="string" id="5138353">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5138358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5138362">if</span>&nbsp;<span class="builtinfunc" id="5138365">len</span><span class="op" id="5138368">(</span><span class="ident" id="5138369">req</span><span class="op" id="5138372">.</span><span class="ident" id="5138373">TransferEncoding</span><span class="op" id="5138389">)</span>&nbsp;<span class="op" id="5138391">&gt;</span>&nbsp;<span class="num" id="5138393">0</span>&nbsp;<span class="op" id="5138395">&amp;&amp;</span>&nbsp;<span class="ident" id="5138398">req</span><span class="op" id="5138401">.</span><span class="ident" id="5138402">TransferEncoding</span><span class="op" id="5138418">[</span><span class="num" id="5138419">0</span><span class="op" id="5138420">]</span>&nbsp;<span class="op" id="5138422">==</span>&nbsp;<span class="string" id="5138425">&#34;chunked&#34;</span>&nbsp;<span class="op" id="5138435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138439">rw</span><span class="op" id="5138441">.</span><span class="ident" id="5138442">WriteHeader</span><span class="op" id="5138453">(</span><span class="ident" id="5138454">http</span><span class="op" id="5138458">.</span><span class="ident" id="5138459">StatusBadRequest</span><span class="op" id="5138475">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138479">rw</span><span class="op" id="5138481">.</span><span class="ident" id="5138482">Write</span><span class="op" id="5138487">(</span><span class="op" id="5138488">[</span><span class="op" id="5138489">]</span><span class="builtintype" id="5138490">byte</span><span class="op" id="5138494">(</span><span class="string" id="5138495">&#34;Chunked&nbsp;request&nbsp;bodies&nbsp;are&nbsp;not&nbsp;supported&nbsp;by&nbsp;CGI.&#34;</span><span class="op" id="5138545">)</span><span class="op" id="5138546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5138550">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5138558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138562">pathInfo</span>&nbsp;<span class="op" id="5138571">:=</span>&nbsp;<span class="ident" id="5138574">req</span><span class="op" id="5138577">.</span><span class="ident" id="5138578">URL</span><span class="op" id="5138581">.</span><span class="ident" id="5138582">Path</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5138588">if</span>&nbsp;<span class="ident" id="5138591">root</span>&nbsp;<span class="op" id="5138596">!=</span>&nbsp;<span class="string" id="5138599">&#34;/&#34;</span>&nbsp;<span class="op" id="5138603">&amp;&amp;</span>&nbsp;<span class="ident" id="5138606">strings</span><span class="op" id="5138613">.</span><span class="ident" id="5138614">HasPrefix</span><span class="op" id="5138623">(</span><span class="ident" id="5138624">pathInfo</span><span class="op" id="5138632">,</span>&nbsp;<span class="ident" id="5138634">root</span><span class="op" id="5138638">)</span>&nbsp;<span class="op" id="5138640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138644">pathInfo</span>&nbsp;<span class="op" id="5138653">=</span>&nbsp;<span class="ident" id="5138655">pathInfo</span><span class="op" id="5138663">[</span><span class="builtinfunc" id="5138664">len</span><span class="op" id="5138667">(</span><span class="ident" id="5138668">root</span><span class="op" id="5138672">)</span><span class="op" id="5138673">:</span><span class="op" id="5138674">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5138677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138681">port</span>&nbsp;<span class="op" id="5138686">:=</span>&nbsp;<span class="string" id="5138689">&#34;80&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5138695">if</span>&nbsp;<span class="ident" id="5138698">matches</span>&nbsp;<span class="op" id="5138706">:=</span>&nbsp;<span class="ident" id="5138709">trailingPort</span><span class="op" id="5138721">.</span><span class="ident" id="5138722">FindStringSubmatch</span><span class="op" id="5138740">(</span><span class="ident" id="5138741">req</span><span class="op" id="5138744">.</span><span class="ident" id="5138745">Host</span><span class="op" id="5138749">)</span><span class="op" id="5138750">;</span>&nbsp;<span class="builtinfunc" id="5138752">len</span><span class="op" id="5138755">(</span><span class="ident" id="5138756">matches</span><span class="op" id="5138763">)</span>&nbsp;<span class="op" id="5138765">!=</span>&nbsp;<span class="num" id="5138768">0</span>&nbsp;<span class="op" id="5138770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138774">port</span>&nbsp;<span class="op" id="5138779">=</span>&nbsp;<span class="ident" id="5138781">matches</span><span class="op" id="5138788">[</span><span class="num" id="5138789">1</span><span class="op" id="5138790">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5138793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138797">env</span>&nbsp;<span class="op" id="5138801">:=</span>&nbsp;<span class="op" id="5138804">[</span><span class="op" id="5138805">]</span><span class="builtintype" id="5138806">string</span><span class="op" id="5138812">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5138816">&#34;SERVER_SOFTWARE=go&#34;</span><span class="op" id="5138836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5138840">&#34;SERVER_NAME=&#34;</span>&nbsp;<span class="op" id="5138855">+</span>&nbsp;<span class="ident" id="5138857">req</span><span class="op" id="5138860">.</span><span class="ident" id="5138861">Host</span><span class="op" id="5138865">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5138869">&#34;SERVER_PROTOCOL=HTTP/1.1&#34;</span><span class="op" id="5138895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5138899">&#34;HTTP_HOST=&#34;</span>&nbsp;<span class="op" id="5138912">+</span>&nbsp;<span class="ident" id="5138914">req</span><span class="op" id="5138917">.</span><span class="ident" id="5138918">Host</span><span class="op" id="5138922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5138926">&#34;GATEWAY_INTERFACE=CGI/1.1&#34;</span><span class="op" id="5138953">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5138957">&#34;REQUEST_METHOD=&#34;</span>&nbsp;<span class="op" id="5138975">+</span>&nbsp;<span class="ident" id="5138977">req</span><span class="op" id="5138980">.</span><span class="ident" id="5138981">Method</span><span class="op" id="5138987">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5138991">&#34;QUERY_STRING=&#34;</span>&nbsp;<span class="op" id="5139007">+</span>&nbsp;<span class="ident" id="5139009">req</span><span class="op" id="5139012">.</span><span class="ident" id="5139013">URL</span><span class="op" id="5139016">.</span><span class="ident" id="5139017">RawQuery</span><span class="op" id="5139025">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5139029">&#34;REQUEST_URI=&#34;</span>&nbsp;<span class="op" id="5139044">+</span>&nbsp;<span class="ident" id="5139046">req</span><span class="op" id="5139049">.</span><span class="ident" id="5139050">URL</span><span class="op" id="5139053">.</span><span class="ident" id="5139054">RequestURI</span><span class="op" id="5139064">(</span><span class="op" id="5139065">)</span><span class="op" id="5139066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5139070">&#34;PATH_INFO=&#34;</span>&nbsp;<span class="op" id="5139083">+</span>&nbsp;<span class="ident" id="5139085">pathInfo</span><span class="op" id="5139093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5139097">&#34;SCRIPT_NAME=&#34;</span>&nbsp;<span class="op" id="5139112">+</span>&nbsp;<span class="ident" id="5139114">root</span><span class="op" id="5139118">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5139122">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="5139141">+</span>&nbsp;<span class="ident" id="5139143">h</span><span class="op" id="5139144">.</span><span class="ident" id="5139145">Path</span><span class="op" id="5139149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5139153">&#34;REMOTE_ADDR=&#34;</span>&nbsp;<span class="op" id="5139168">+</span>&nbsp;<span class="ident" id="5139170">req</span><span class="op" id="5139173">.</span><span class="ident" id="5139174">RemoteAddr</span><span class="op" id="5139184">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5139188">&#34;REMOTE_HOST=&#34;</span>&nbsp;<span class="op" id="5139203">+</span>&nbsp;<span class="ident" id="5139205">req</span><span class="op" id="5139208">.</span><span class="ident" id="5139209">RemoteAddr</span><span class="op" id="5139219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5139223">&#34;SERVER_PORT=&#34;</span>&nbsp;<span class="op" id="5139238">+</span>&nbsp;<span class="ident" id="5139240">port</span><span class="op" id="5139244">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5139247">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139251">if</span>&nbsp;<span class="ident" id="5139254">req</span><span class="op" id="5139257">.</span><span class="ident" id="5139258">TLS</span>&nbsp;<span class="op" id="5139262">!=</span>&nbsp;<span class="ident" id="5139265">nil</span>&nbsp;<span class="op" id="5139269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139273">env</span>&nbsp;<span class="op" id="5139277">=</span>&nbsp;<span class="builtinfunc" id="5139279">append</span><span class="op" id="5139285">(</span><span class="ident" id="5139286">env</span><span class="op" id="5139289">,</span>&nbsp;<span class="string" id="5139291">&#34;HTTPS=on&#34;</span><span class="op" id="5139301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5139304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139308">for</span>&nbsp;<span class="ident" id="5139312">k</span><span class="op" id="5139313">,</span>&nbsp;<span class="ident" id="5139315">v</span>&nbsp;<span class="op" id="5139317">:=</span>&nbsp;<span class="keyword" id="5139320">range</span>&nbsp;<span class="ident" id="5139326">req</span><span class="op" id="5139329">.</span><span class="ident" id="5139330">Header</span>&nbsp;<span class="op" id="5139337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139341">k</span>&nbsp;<span class="op" id="5139343">=</span>&nbsp;<span class="ident" id="5139345">strings</span><span class="op" id="5139352">.</span><span class="ident" id="5139353">Map</span><span class="op" id="5139356">(</span><span class="ident" id="5139357">upperCaseAndUnderscore</span><span class="op" id="5139379">,</span>&nbsp;<span class="ident" id="5139381">k</span><span class="op" id="5139382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139386">joinStr</span>&nbsp;<span class="op" id="5139394">:=</span>&nbsp;<span class="string" id="5139397">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139404">if</span>&nbsp;<span class="ident" id="5139407">k</span>&nbsp;<span class="op" id="5139409">==</span>&nbsp;<span class="string" id="5139412">&#34;COOKIE&#34;</span>&nbsp;<span class="op" id="5139421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139426">joinStr</span>&nbsp;<span class="op" id="5139434">=</span>&nbsp;<span class="string" id="5139436">&#34;;&nbsp;&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5139443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139447">env</span>&nbsp;<span class="op" id="5139451">=</span>&nbsp;<span class="builtinfunc" id="5139453">append</span><span class="op" id="5139459">(</span><span class="ident" id="5139460">env</span><span class="op" id="5139463">,</span>&nbsp;<span class="string" id="5139465">&#34;HTTP_&#34;</span><span class="op" id="5139472">+</span><span class="ident" id="5139473">k</span><span class="op" id="5139474">+</span><span class="string" id="5139475">&#34;=&#34;</span><span class="op" id="5139478">+</span><span class="ident" id="5139479">strings</span><span class="op" id="5139486">.</span><span class="ident" id="5139487">Join</span><span class="op" id="5139491">(</span><span class="ident" id="5139492">v</span><span class="op" id="5139493">,</span>&nbsp;<span class="ident" id="5139495">joinStr</span><span class="op" id="5139502">)</span><span class="op" id="5139503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5139506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139510">if</span>&nbsp;<span class="ident" id="5139513">req</span><span class="op" id="5139516">.</span><span class="ident" id="5139517">ContentLength</span>&nbsp;<span class="op" id="5139531">&gt;</span>&nbsp;<span class="num" id="5139533">0</span>&nbsp;<span class="op" id="5139535">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139539">env</span>&nbsp;<span class="op" id="5139543">=</span>&nbsp;<span class="builtinfunc" id="5139545">append</span><span class="op" id="5139551">(</span><span class="ident" id="5139552">env</span><span class="op" id="5139555">,</span>&nbsp;<span class="ident" id="5139557">fmt</span><span class="op" id="5139560">.</span><span class="ident" id="5139561">Sprintf</span><span class="op" id="5139568">(</span><span class="string" id="5139569">&#34;CONTENT_LENGTH=%d&#34;</span><span class="op" id="5139588">,</span>&nbsp;<span class="ident" id="5139590">req</span><span class="op" id="5139593">.</span><span class="ident" id="5139594">ContentLength</span><span class="op" id="5139607">)</span><span class="op" id="5139608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5139611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139614">if</span>&nbsp;<span class="ident" id="5139617">ctype</span>&nbsp;<span class="op" id="5139623">:=</span>&nbsp;<span class="ident" id="5139626">req</span><span class="op" id="5139629">.</span><span class="ident" id="5139630">Header</span><span class="op" id="5139636">.</span><span class="ident" id="5139637">Get</span><span class="op" id="5139640">(</span><span class="string" id="5139641">&#34;Content-Type&#34;</span><span class="op" id="5139655">)</span><span class="op" id="5139656">;</span>&nbsp;<span class="ident" id="5139658">ctype</span>&nbsp;<span class="op" id="5139664">!=</span>&nbsp;<span class="string" id="5139667">&#34;&#34;</span>&nbsp;<span class="op" id="5139670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139674">env</span>&nbsp;<span class="op" id="5139678">=</span>&nbsp;<span class="builtinfunc" id="5139680">append</span><span class="op" id="5139686">(</span><span class="ident" id="5139687">env</span><span class="op" id="5139690">,</span>&nbsp;<span class="string" id="5139692">&#34;CONTENT_TYPE=&#34;</span><span class="op" id="5139707">+</span><span class="ident" id="5139708">ctype</span><span class="op" id="5139713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5139716">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139720">if</span>&nbsp;<span class="ident" id="5139723">h</span><span class="op" id="5139724">.</span><span class="ident" id="5139725">Env</span>&nbsp;<span class="op" id="5139729">!=</span>&nbsp;<span class="ident" id="5139732">nil</span>&nbsp;<span class="op" id="5139736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139740">env</span>&nbsp;<span class="op" id="5139744">=</span>&nbsp;<span class="builtinfunc" id="5139746">append</span><span class="op" id="5139752">(</span><span class="ident" id="5139753">env</span><span class="op" id="5139756">,</span>&nbsp;<span class="ident" id="5139758">h</span><span class="op" id="5139759">.</span><span class="ident" id="5139760">Env</span><span class="op" id="5139763">...</span><span class="op" id="5139766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5139769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139773">envPath</span>&nbsp;<span class="op" id="5139781">:=</span>&nbsp;<span class="ident" id="5139784">os</span><span class="op" id="5139786">.</span><span class="ident" id="5139787">Getenv</span><span class="op" id="5139793">(</span><span class="string" id="5139794">&#34;PATH&#34;</span><span class="op" id="5139800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139803">if</span>&nbsp;<span class="ident" id="5139806">envPath</span>&nbsp;<span class="op" id="5139814">==</span>&nbsp;<span class="string" id="5139817">&#34;&#34;</span>&nbsp;<span class="op" id="5139820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139824">envPath</span>&nbsp;<span class="op" id="5139832">=</span>&nbsp;<span class="string" id="5139834">&#34;/bin:/usr/bin:/usr/ucb:/usr/bsd:/usr/local/bin&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5139884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139887">env</span>&nbsp;<span class="op" id="5139891">=</span>&nbsp;<span class="builtinfunc" id="5139893">append</span><span class="op" id="5139899">(</span><span class="ident" id="5139900">env</span><span class="op" id="5139903">,</span>&nbsp;<span class="string" id="5139905">&#34;PATH=&#34;</span><span class="op" id="5139912">+</span><span class="ident" id="5139913">envPath</span><span class="op" id="5139920">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139924">for</span>&nbsp;<span class="ident" id="5139928">_</span><span class="op" id="5139929">,</span>&nbsp;<span class="ident" id="5139931">e</span>&nbsp;<span class="op" id="5139933">:=</span>&nbsp;<span class="keyword" id="5139936">range</span>&nbsp;<span class="ident" id="5139942">h</span><span class="op" id="5139943">.</span><span class="ident" id="5139944">InheritEnv</span>&nbsp;<span class="op" id="5139955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139959">if</span>&nbsp;<span class="ident" id="5139962">v</span>&nbsp;<span class="op" id="5139964">:=</span>&nbsp;<span class="ident" id="5139967">os</span><span class="op" id="5139969">.</span><span class="ident" id="5139970">Getenv</span><span class="op" id="5139976">(</span><span class="ident" id="5139977">e</span><span class="op" id="5139978">)</span><span class="op" id="5139979">;</span>&nbsp;<span class="ident" id="5139981">v</span>&nbsp;<span class="op" id="5139983">!=</span>&nbsp;<span class="string" id="5139986">&#34;&#34;</span>&nbsp;<span class="op" id="5139989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139994">env</span>&nbsp;<span class="op" id="5139998">=</span>&nbsp;<span class="builtinfunc" id="5140000">append</span><span class="op" id="5140006">(</span><span class="ident" id="5140007">env</span><span class="op" id="5140010">,</span>&nbsp;<span class="ident" id="5140012">e</span><span class="op" id="5140013">+</span><span class="string" id="5140014">&#34;=&#34;</span><span class="op" id="5140017">+</span><span class="ident" id="5140018">v</span><span class="op" id="5140019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140023">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140030">for</span>&nbsp;<span class="ident" id="5140034">_</span><span class="op" id="5140035">,</span>&nbsp;<span class="ident" id="5140037">e</span>&nbsp;<span class="op" id="5140039">:=</span>&nbsp;<span class="keyword" id="5140042">range</span>&nbsp;<span class="ident" id="5140048">osDefaultInheritEnv</span><span class="op" id="5140067">[</span><span class="ident" id="5140068">runtime</span><span class="op" id="5140075">.</span><span class="ident" id="5140076">GOOS</span><span class="op" id="5140080">]</span>&nbsp;<span class="op" id="5140082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140086">if</span>&nbsp;<span class="ident" id="5140089">v</span>&nbsp;<span class="op" id="5140091">:=</span>&nbsp;<span class="ident" id="5140094">os</span><span class="op" id="5140096">.</span><span class="ident" id="5140097">Getenv</span><span class="op" id="5140103">(</span><span class="ident" id="5140104">e</span><span class="op" id="5140105">)</span><span class="op" id="5140106">;</span>&nbsp;<span class="ident" id="5140108">v</span>&nbsp;<span class="op" id="5140110">!=</span>&nbsp;<span class="string" id="5140113">&#34;&#34;</span>&nbsp;<span class="op" id="5140116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140121">env</span>&nbsp;<span class="op" id="5140125">=</span>&nbsp;<span class="builtinfunc" id="5140127">append</span><span class="op" id="5140133">(</span><span class="ident" id="5140134">env</span><span class="op" id="5140137">,</span>&nbsp;<span class="ident" id="5140139">e</span><span class="op" id="5140140">+</span><span class="string" id="5140141">&#34;=&#34;</span><span class="op" id="5140144">+</span><span class="ident" id="5140145">v</span><span class="op" id="5140146">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140157">env</span>&nbsp;<span class="op" id="5140161">=</span>&nbsp;<span class="ident" id="5140163">removeLeadingDuplicates</span><span class="op" id="5140186">(</span><span class="ident" id="5140187">env</span><span class="op" id="5140190">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140194">var</span>&nbsp;<span class="ident" id="5140198">cwd</span><span class="op" id="5140201">,</span>&nbsp;<span class="ident" id="5140203">path</span>&nbsp;<span class="builtintype" id="5140208">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140216">if</span>&nbsp;<span class="ident" id="5140219">h</span><span class="op" id="5140220">.</span><span class="ident" id="5140221">Dir</span>&nbsp;<span class="op" id="5140225">!=</span>&nbsp;<span class="string" id="5140228">&#34;&#34;</span>&nbsp;<span class="op" id="5140231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140235">path</span>&nbsp;<span class="op" id="5140240">=</span>&nbsp;<span class="ident" id="5140242">h</span><span class="op" id="5140243">.</span><span class="ident" id="5140244">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140251">cwd</span>&nbsp;<span class="op" id="5140255">=</span>&nbsp;<span class="ident" id="5140257">h</span><span class="op" id="5140258">.</span><span class="ident" id="5140259">Dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140264">}</span>&nbsp;<span class="keyword" id="5140266">else</span>&nbsp;<span class="op" id="5140271">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140275">cwd</span><span class="op" id="5140278">,</span>&nbsp;<span class="ident" id="5140280">path</span>&nbsp;<span class="op" id="5140285">=</span>&nbsp;<span class="ident" id="5140287">filepath</span><span class="op" id="5140295">.</span><span class="ident" id="5140296">Split</span><span class="op" id="5140301">(</span><span class="ident" id="5140302">h</span><span class="op" id="5140303">.</span><span class="ident" id="5140304">Path</span><span class="op" id="5140308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140314">if</span>&nbsp;<span class="ident" id="5140317">cwd</span>&nbsp;<span class="op" id="5140321">==</span>&nbsp;<span class="string" id="5140324">&#34;&#34;</span>&nbsp;<span class="op" id="5140327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140331">cwd</span>&nbsp;<span class="op" id="5140335">=</span>&nbsp;<span class="string" id="5140337">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140342">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140346">internalError</span>&nbsp;<span class="op" id="5140360">:=</span>&nbsp;<span class="keyword" id="5140363">func</span><span class="op" id="5140367">(</span><span class="ident" id="5140368">err</span>&nbsp;<span class="builtintype" id="5140372">error</span><span class="op" id="5140377">)</span>&nbsp;<span class="op" id="5140379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140383">rw</span><span class="op" id="5140385">.</span><span class="ident" id="5140386">WriteHeader</span><span class="op" id="5140397">(</span><span class="ident" id="5140398">http</span><span class="op" id="5140402">.</span><span class="ident" id="5140403">StatusInternalServerError</span><span class="op" id="5140428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140432">h</span><span class="op" id="5140433">.</span><span class="ident" id="5140434">printf</span><span class="op" id="5140440">(</span><span class="string" id="5140441">&#34;CGI&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="5140456">,</span>&nbsp;<span class="ident" id="5140458">err</span><span class="op" id="5140461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140464">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140468">cmd</span>&nbsp;<span class="op" id="5140472">:=</span>&nbsp;<span class="op" id="5140475">&amp;</span><span class="ident" id="5140476">exec</span><span class="op" id="5140480">.</span><span class="ident" id="5140481">Cmd</span><span class="op" id="5140484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140488">Path</span><span class="op" id="5140492">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5140496">path</span><span class="op" id="5140500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140504">Args</span><span class="op" id="5140508">:</span>&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5140512">append</span><span class="op" id="5140518">(</span><span class="op" id="5140519">[</span><span class="op" id="5140520">]</span><span class="builtintype" id="5140521">string</span><span class="op" id="5140527">{</span><span class="ident" id="5140528">h</span><span class="op" id="5140529">.</span><span class="ident" id="5140530">Path</span><span class="op" id="5140534">}</span><span class="op" id="5140535">,</span>&nbsp;<span class="ident" id="5140537">h</span><span class="op" id="5140538">.</span><span class="ident" id="5140539">Args</span><span class="op" id="5140543">...</span><span class="op" id="5140546">)</span><span class="op" id="5140547">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140551">Dir</span><span class="op" id="5140554">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5140559">cwd</span><span class="op" id="5140562">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140566">Env</span><span class="op" id="5140569">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5140574">env</span><span class="op" id="5140577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140581">Stderr</span><span class="op" id="5140587">:</span>&nbsp;<span class="ident" id="5140589">os</span><span class="op" id="5140591">.</span><span class="ident" id="5140592">Stderr</span><span class="op" id="5140598">,</span>&nbsp;<span class="comment" id="5140600">//&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140615">if</span>&nbsp;<span class="ident" id="5140618">req</span><span class="op" id="5140621">.</span><span class="ident" id="5140622">ContentLength</span>&nbsp;<span class="op" id="5140636">!=</span>&nbsp;<span class="num" id="5140639">0</span>&nbsp;<span class="op" id="5140641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140645">cmd</span><span class="op" id="5140648">.</span><span class="ident" id="5140649">Stdin</span>&nbsp;<span class="op" id="5140655">=</span>&nbsp;<span class="ident" id="5140657">req</span><span class="op" id="5140660">.</span><span class="ident" id="5140661">Body</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140670">stdoutRead</span><span class="op" id="5140680">,</span>&nbsp;<span class="ident" id="5140682">err</span>&nbsp;<span class="op" id="5140686">:=</span>&nbsp;<span class="ident" id="5140689">cmd</span><span class="op" id="5140692">.</span><span class="ident" id="5140693">StdoutPipe</span><span class="op" id="5140703">(</span><span class="op" id="5140704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140707">if</span>&nbsp;<span class="ident" id="5140710">err</span>&nbsp;<span class="op" id="5140714">!=</span>&nbsp;<span class="ident" id="5140717">nil</span>&nbsp;<span class="op" id="5140721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140725">internalError</span><span class="op" id="5140738">(</span><span class="ident" id="5140739">err</span><span class="op" id="5140742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140746">return</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140758">err</span>&nbsp;<span class="op" id="5140762">=</span>&nbsp;<span class="ident" id="5140764">cmd</span><span class="op" id="5140767">.</span><span class="ident" id="5140768">Start</span><span class="op" id="5140773">(</span><span class="op" id="5140774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140777">if</span>&nbsp;<span class="ident" id="5140780">err</span>&nbsp;<span class="op" id="5140784">!=</span>&nbsp;<span class="ident" id="5140787">nil</span>&nbsp;<span class="op" id="5140791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140795">internalError</span><span class="op" id="5140808">(</span><span class="ident" id="5140809">err</span><span class="op" id="5140812">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140816">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140827">if</span>&nbsp;<span class="ident" id="5140830">hook</span>&nbsp;<span class="op" id="5140835">:=</span>&nbsp;<span class="ident" id="5140838">testHookStartProcess</span><span class="op" id="5140858">;</span>&nbsp;<span class="ident" id="5140860">hook</span>&nbsp;<span class="op" id="5140865">!=</span>&nbsp;<span class="ident" id="5140868">nil</span>&nbsp;<span class="op" id="5140872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140876">hook</span><span class="op" id="5140880">(</span><span class="ident" id="5140881">cmd</span><span class="op" id="5140884">.</span><span class="ident" id="5140885">Process</span><span class="op" id="5140892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140895">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140898">defer</span>&nbsp;<span class="ident" id="5140904">cmd</span><span class="op" id="5140907">.</span><span class="ident" id="5140908">Wait</span><span class="op" id="5140912">(</span><span class="op" id="5140913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140916">defer</span>&nbsp;<span class="ident" id="5140922">stdoutRead</span><span class="op" id="5140932">.</span><span class="ident" id="5140933">Close</span><span class="op" id="5140938">(</span><span class="op" id="5140939">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140943">linebody</span>&nbsp;<span class="op" id="5140952">:=</span>&nbsp;<span class="ident" id="5140955">bufio</span><span class="op" id="5140960">.</span><span class="ident" id="5140961">NewReaderSize</span><span class="op" id="5140974">(</span><span class="ident" id="5140975">stdoutRead</span><span class="op" id="5140985">,</span>&nbsp;<span class="num" id="5140987">1024</span><span class="op" id="5140991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140994">headers</span>&nbsp;<span class="op" id="5141002">:=</span>&nbsp;<span class="builtinfunc" id="5141005">make</span><span class="op" id="5141009">(</span><span class="ident" id="5141010">http</span><span class="op" id="5141014">.</span><span class="ident" id="5141015">Header</span><span class="op" id="5141021">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141024">statusCode</span>&nbsp;<span class="op" id="5141035">:=</span>&nbsp;<span class="num" id="5141038">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141041">headerLines</span>&nbsp;<span class="op" id="5141053">:=</span>&nbsp;<span class="num" id="5141056">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141059">sawBlankLine</span>&nbsp;<span class="op" id="5141072">:=</span>&nbsp;<span class="ident" id="5141075">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141082">for</span>&nbsp;<span class="op" id="5141086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141090">line</span><span class="op" id="5141094">,</span>&nbsp;<span class="ident" id="5141096">isPrefix</span><span class="op" id="5141104">,</span>&nbsp;<span class="ident" id="5141106">err</span>&nbsp;<span class="op" id="5141110">:=</span>&nbsp;<span class="ident" id="5141113">linebody</span><span class="op" id="5141121">.</span><span class="ident" id="5141122">ReadLine</span><span class="op" id="5141130">(</span><span class="op" id="5141131">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141135">if</span>&nbsp;<span class="ident" id="5141138">isPrefix</span>&nbsp;<span class="op" id="5141147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141152">rw</span><span class="op" id="5141154">.</span><span class="ident" id="5141155">WriteHeader</span><span class="op" id="5141166">(</span><span class="ident" id="5141167">http</span><span class="op" id="5141171">.</span><span class="ident" id="5141172">StatusInternalServerError</span><span class="op" id="5141197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141202">h</span><span class="op" id="5141203">.</span><span class="ident" id="5141204">printf</span><span class="op" id="5141210">(</span><span class="string" id="5141211">&#34;cgi:&nbsp;long&nbsp;header&nbsp;line&nbsp;from&nbsp;subprocess.&#34;</span><span class="op" id="5141251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141256">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5141265">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141269">if</span>&nbsp;<span class="ident" id="5141272">err</span>&nbsp;<span class="op" id="5141276">==</span>&nbsp;<span class="ident" id="5141279">io</span><span class="op" id="5141281">.</span><span class="ident" id="5141282">EOF</span>&nbsp;<span class="op" id="5141286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141291">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5141299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141303">if</span>&nbsp;<span class="ident" id="5141306">err</span>&nbsp;<span class="op" id="5141310">!=</span>&nbsp;<span class="ident" id="5141313">nil</span>&nbsp;<span class="op" id="5141317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141322">rw</span><span class="op" id="5141324">.</span><span class="ident" id="5141325">WriteHeader</span><span class="op" id="5141336">(</span><span class="ident" id="5141337">http</span><span class="op" id="5141341">.</span><span class="ident" id="5141342">StatusInternalServerError</span><span class="op" id="5141367">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141372">h</span><span class="op" id="5141373">.</span><span class="ident" id="5141374">printf</span><span class="op" id="5141380">(</span><span class="string" id="5141381">&#34;cgi:&nbsp;error&nbsp;reading&nbsp;headers:&nbsp;%v&#34;</span><span class="op" id="5141413">,</span>&nbsp;<span class="ident" id="5141415">err</span><span class="op" id="5141418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141423">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5141432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141436">if</span>&nbsp;<span class="builtinfunc" id="5141439">len</span><span class="op" id="5141442">(</span><span class="ident" id="5141443">line</span><span class="op" id="5141447">)</span>&nbsp;<span class="op" id="5141449">==</span>&nbsp;<span class="num" id="5141452">0</span>&nbsp;<span class="op" id="5141454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141459">sawBlankLine</span>&nbsp;<span class="op" id="5141472">=</span>&nbsp;<span class="ident" id="5141474">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141482">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5141490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141494">headerLines</span><span class="op" id="5141505">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141510">parts</span>&nbsp;<span class="op" id="5141516">:=</span>&nbsp;<span class="ident" id="5141519">strings</span><span class="op" id="5141526">.</span><span class="ident" id="5141527">SplitN</span><span class="op" id="5141533">(</span><span class="builtintype" id="5141534">string</span><span class="op" id="5141540">(</span><span class="ident" id="5141541">line</span><span class="op" id="5141545">)</span><span class="op" id="5141546">,</span>&nbsp;<span class="string" id="5141548">&#34;:&#34;</span><span class="op" id="5141551">,</span>&nbsp;<span class="num" id="5141553">2</span><span class="op" id="5141554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141558">if</span>&nbsp;<span class="builtinfunc" id="5141561">len</span><span class="op" id="5141564">(</span><span class="ident" id="5141565">parts</span><span class="op" id="5141570">)</span>&nbsp;<span class="op" id="5141572">&lt;</span>&nbsp;<span class="num" id="5141574">2</span>&nbsp;<span class="op" id="5141576">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141581">h</span><span class="op" id="5141582">.</span><span class="ident" id="5141583">printf</span><span class="op" id="5141589">(</span><span class="string" id="5141590">&#34;cgi:&nbsp;bogus&nbsp;header&nbsp;line:&nbsp;%s&#34;</span><span class="op" id="5141618">,</span>&nbsp;<span class="builtintype" id="5141620">string</span><span class="op" id="5141626">(</span><span class="ident" id="5141627">line</span><span class="op" id="5141631">)</span><span class="op" id="5141632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141637">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5141648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141652">header</span><span class="op" id="5141658">,</span>&nbsp;<span class="ident" id="5141660">val</span>&nbsp;<span class="op" id="5141664">:=</span>&nbsp;<span class="ident" id="5141667">parts</span><span class="op" id="5141672">[</span><span class="num" id="5141673">0</span><span class="op" id="5141674">]</span><span class="op" id="5141675">,</span>&nbsp;<span class="ident" id="5141677">parts</span><span class="op" id="5141682">[</span><span class="num" id="5141683">1</span><span class="op" id="5141684">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141688">header</span>&nbsp;<span class="op" id="5141695">=</span>&nbsp;<span class="ident" id="5141697">strings</span><span class="op" id="5141704">.</span><span class="ident" id="5141705">TrimSpace</span><span class="op" id="5141714">(</span><span class="ident" id="5141715">header</span><span class="op" id="5141721">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141725">val</span>&nbsp;<span class="op" id="5141729">=</span>&nbsp;<span class="ident" id="5141731">strings</span><span class="op" id="5141738">.</span><span class="ident" id="5141739">TrimSpace</span><span class="op" id="5141748">(</span><span class="ident" id="5141749">val</span><span class="op" id="5141752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141756">switch</span>&nbsp;<span class="op" id="5141763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141767">case</span>&nbsp;<span class="ident" id="5141772">header</span>&nbsp;<span class="op" id="5141779">==</span>&nbsp;<span class="string" id="5141782">&#34;Status&#34;</span><span class="op" id="5141790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141795">if</span>&nbsp;<span class="builtinfunc" id="5141798">len</span><span class="op" id="5141801">(</span><span class="ident" id="5141802">val</span><span class="op" id="5141805">)</span>&nbsp;<span class="op" id="5141807">&lt;</span>&nbsp;<span class="num" id="5141809">3</span>&nbsp;<span class="op" id="5141811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141817">h</span><span class="op" id="5141818">.</span><span class="ident" id="5141819">printf</span><span class="op" id="5141825">(</span><span class="string" id="5141826">&#34;cgi:&nbsp;bogus&nbsp;status&nbsp;(short):&nbsp;%q&#34;</span><span class="op" id="5141857">,</span>&nbsp;<span class="ident" id="5141859">val</span><span class="op" id="5141862">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141868">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5141878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141883">code</span><span class="op" id="5141887">,</span>&nbsp;<span class="ident" id="5141889">err</span>&nbsp;<span class="op" id="5141893">:=</span>&nbsp;<span class="ident" id="5141896">strconv</span><span class="op" id="5141903">.</span><span class="ident" id="5141904">Atoi</span><span class="op" id="5141908">(</span><span class="ident" id="5141909">val</span><span class="op" id="5141912">[</span><span class="num" id="5141913">0</span><span class="op" id="5141914">:</span><span class="num" id="5141915">3</span><span class="op" id="5141916">]</span><span class="op" id="5141917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141922">if</span>&nbsp;<span class="ident" id="5141925">err</span>&nbsp;<span class="op" id="5141929">!=</span>&nbsp;<span class="ident" id="5141932">nil</span>&nbsp;<span class="op" id="5141936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141942">h</span><span class="op" id="5141943">.</span><span class="ident" id="5141944">printf</span><span class="op" id="5141950">(</span><span class="string" id="5141951">&#34;cgi:&nbsp;bogus&nbsp;status:&nbsp;%q&#34;</span><span class="op" id="5141974">,</span>&nbsp;<span class="ident" id="5141976">val</span><span class="op" id="5141979">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141985">h</span><span class="op" id="5141986">.</span><span class="ident" id="5141987">printf</span><span class="op" id="5141993">(</span><span class="string" id="5141994">&#34;cgi:&nbsp;line&nbsp;was&nbsp;%q&#34;</span><span class="op" id="5142012">,</span>&nbsp;<span class="ident" id="5142014">line</span><span class="op" id="5142018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142024">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5142034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142039">statusCode</span>&nbsp;<span class="op" id="5142050">=</span>&nbsp;<span class="ident" id="5142052">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142059">default</span><span class="op" id="5142066">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142071">headers</span><span class="op" id="5142078">.</span><span class="ident" id="5142079">Add</span><span class="op" id="5142082">(</span><span class="ident" id="5142083">header</span><span class="op" id="5142089">,</span>&nbsp;<span class="ident" id="5142091">val</span><span class="op" id="5142094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5142098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5142101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142104">if</span>&nbsp;<span class="ident" id="5142107">headerLines</span>&nbsp;<span class="op" id="5142119">==</span>&nbsp;<span class="num" id="5142122">0</span>&nbsp;<span class="op" id="5142124">||</span>&nbsp;<span class="op" id="5142127">!</span><span class="ident" id="5142128">sawBlankLine</span>&nbsp;<span class="op" id="5142141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142145">rw</span><span class="op" id="5142147">.</span><span class="ident" id="5142148">WriteHeader</span><span class="op" id="5142159">(</span><span class="ident" id="5142160">http</span><span class="op" id="5142164">.</span><span class="ident" id="5142165">StatusInternalServerError</span><span class="op" id="5142190">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142194">h</span><span class="op" id="5142195">.</span><span class="ident" id="5142196">printf</span><span class="op" id="5142202">(</span><span class="string" id="5142203">&#34;cgi:&nbsp;no&nbsp;headers&#34;</span><span class="op" id="5142220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142224">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5142232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142236">if</span>&nbsp;<span class="ident" id="5142239">loc</span>&nbsp;<span class="op" id="5142243">:=</span>&nbsp;<span class="ident" id="5142246">headers</span><span class="op" id="5142253">.</span><span class="ident" id="5142254">Get</span><span class="op" id="5142257">(</span><span class="string" id="5142258">&#34;Location&#34;</span><span class="op" id="5142268">)</span><span class="op" id="5142269">;</span>&nbsp;<span class="ident" id="5142271">loc</span>&nbsp;<span class="op" id="5142275">!=</span>&nbsp;<span class="string" id="5142278">&#34;&#34;</span>&nbsp;<span class="op" id="5142281">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142285">if</span>&nbsp;<span class="ident" id="5142288">strings</span><span class="op" id="5142295">.</span><span class="ident" id="5142296">HasPrefix</span><span class="op" id="5142305">(</span><span class="ident" id="5142306">loc</span><span class="op" id="5142309">,</span>&nbsp;<span class="string" id="5142311">&#34;/&#34;</span><span class="op" id="5142314">)</span>&nbsp;<span class="op" id="5142316">&amp;&amp;</span>&nbsp;<span class="ident" id="5142319">h</span><span class="op" id="5142320">.</span><span class="ident" id="5142321">PathLocationHandler</span>&nbsp;<span class="op" id="5142341">!=</span>&nbsp;<span class="ident" id="5142344">nil</span>&nbsp;<span class="op" id="5142348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142353">h</span><span class="op" id="5142354">.</span><span class="ident" id="5142355">handleInternalRedirect</span><span class="op" id="5142377">(</span><span class="ident" id="5142378">rw</span><span class="op" id="5142380">,</span>&nbsp;<span class="ident" id="5142382">req</span><span class="op" id="5142385">,</span>&nbsp;<span class="ident" id="5142387">loc</span><span class="op" id="5142390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142395">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5142404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142408">if</span>&nbsp;<span class="ident" id="5142411">statusCode</span>&nbsp;<span class="op" id="5142422">==</span>&nbsp;<span class="num" id="5142425">0</span>&nbsp;<span class="op" id="5142427">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142432">statusCode</span>&nbsp;<span class="op" id="5142443">=</span>&nbsp;<span class="ident" id="5142445">http</span><span class="op" id="5142449">.</span><span class="ident" id="5142450">StatusFound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5142464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5142467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142471">if</span>&nbsp;<span class="ident" id="5142474">statusCode</span>&nbsp;<span class="op" id="5142485">==</span>&nbsp;<span class="num" id="5142488">0</span>&nbsp;<span class="op" id="5142490">&amp;&amp;</span>&nbsp;<span class="ident" id="5142493">headers</span><span class="op" id="5142500">.</span><span class="ident" id="5142501">Get</span><span class="op" id="5142504">(</span><span class="string" id="5142505">&#34;Content-Type&#34;</span><span class="op" id="5142519">)</span>&nbsp;<span class="op" id="5142521">==</span>&nbsp;<span class="string" id="5142524">&#34;&#34;</span>&nbsp;<span class="op" id="5142527">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142531">rw</span><span class="op" id="5142533">.</span><span class="ident" id="5142534">WriteHeader</span><span class="op" id="5142545">(</span><span class="ident" id="5142546">http</span><span class="op" id="5142550">.</span><span class="ident" id="5142551">StatusInternalServerError</span><span class="op" id="5142576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142580">h</span><span class="op" id="5142581">.</span><span class="ident" id="5142582">printf</span><span class="op" id="5142588">(</span><span class="string" id="5142589">&#34;cgi:&nbsp;missing&nbsp;required&nbsp;Content-Type&nbsp;in&nbsp;headers&#34;</span><span class="op" id="5142636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142640">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5142648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142652">if</span>&nbsp;<span class="ident" id="5142655">statusCode</span>&nbsp;<span class="op" id="5142666">==</span>&nbsp;<span class="num" id="5142669">0</span>&nbsp;<span class="op" id="5142671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142675">statusCode</span>&nbsp;<span class="op" id="5142686">=</span>&nbsp;<span class="ident" id="5142688">http</span><span class="op" id="5142692">.</span><span class="ident" id="5142693">StatusOK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5142703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5142707">//&nbsp;Copy&nbsp;headers&nbsp;to&nbsp;rw&#39;s&nbsp;headers,&nbsp;after&nbsp;we&#39;ve&nbsp;decided&nbsp;not&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5142768">//&nbsp;go&nbsp;into&nbsp;handleInternalRedirect,&nbsp;which&nbsp;won&#39;t&nbsp;want&nbsp;its&nbsp;rw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5142828">//&nbsp;headers&nbsp;to&nbsp;have&nbsp;been&nbsp;touched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142862">for</span>&nbsp;<span class="ident" id="5142866">k</span><span class="op" id="5142867">,</span>&nbsp;<span class="ident" id="5142869">vv</span>&nbsp;<span class="op" id="5142872">:=</span>&nbsp;<span class="keyword" id="5142875">range</span>&nbsp;<span class="ident" id="5142881">headers</span>&nbsp;<span class="op" id="5142889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142893">for</span>&nbsp;<span class="ident" id="5142897">_</span><span class="op" id="5142898">,</span>&nbsp;<span class="ident" id="5142900">v</span>&nbsp;<span class="op" id="5142902">:=</span>&nbsp;<span class="keyword" id="5142905">range</span>&nbsp;<span class="ident" id="5142911">vv</span>&nbsp;<span class="op" id="5142914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142919">rw</span><span class="op" id="5142921">.</span><span class="ident" id="5142922">Header</span><span class="op" id="5142928">(</span><span class="op" id="5142929">)</span><span class="op" id="5142930">.</span><span class="ident" id="5142931">Add</span><span class="op" id="5142934">(</span><span class="ident" id="5142935">k</span><span class="op" id="5142936">,</span>&nbsp;<span class="ident" id="5142938">v</span><span class="op" id="5142939">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5142943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5142946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142950">rw</span><span class="op" id="5142952">.</span><span class="ident" id="5142953">WriteHeader</span><span class="op" id="5142964">(</span><span class="ident" id="5142965">statusCode</span><span class="op" id="5142975">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142979">_</span><span class="op" id="5142980">,</span>&nbsp;<span class="ident" id="5142982">err</span>&nbsp;<span class="op" id="5142986">=</span>&nbsp;<span class="ident" id="5142988">io</span><span class="op" id="5142990">.</span><span class="ident" id="5142991">Copy</span><span class="op" id="5142995">(</span><span class="ident" id="5142996">rw</span><span class="op" id="5142998">,</span>&nbsp;<span class="ident" id="5143000">linebody</span><span class="op" id="5143008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5143011">if</span>&nbsp;<span class="ident" id="5143014">err</span>&nbsp;<span class="op" id="5143018">!=</span>&nbsp;<span class="ident" id="5143021">nil</span>&nbsp;<span class="op" id="5143025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143029">h</span><span class="op" id="5143030">.</span><span class="ident" id="5143031">printf</span><span class="op" id="5143037">(</span><span class="string" id="5143038">&#34;cgi:&nbsp;copy&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="5143059">,</span>&nbsp;<span class="ident" id="5143061">err</span><span class="op" id="5143064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5143068">//&nbsp;And&nbsp;kill&nbsp;the&nbsp;child&nbsp;CGI&nbsp;process&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;hang&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5143124">//&nbsp;the&nbsp;deferred&nbsp;cmd.Wait&nbsp;above&nbsp;if&nbsp;the&nbsp;error&nbsp;was&nbsp;just</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5143179">//&nbsp;the&nbsp;client&nbsp;(rw)&nbsp;going&nbsp;away.&nbsp;If&nbsp;it&nbsp;was&nbsp;a&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5143235">//&nbsp;(because&nbsp;the&nbsp;child&nbsp;died&nbsp;itself),&nbsp;then&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5143288">//&nbsp;kill&nbsp;of&nbsp;an&nbsp;already-dead&nbsp;process&nbsp;is&nbsp;harmless&nbsp;(the&nbsp;PID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5143346">//&nbsp;won&#39;t&nbsp;be&nbsp;reused&nbsp;until&nbsp;the&nbsp;Wait&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143390">cmd</span><span class="op" id="5143393">.</span><span class="ident" id="5143394">Process</span><span class="op" id="5143401">.</span><span class="ident" id="5143402">Kill</span><span class="op" id="5143406">(</span><span class="op" id="5143407">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5143410">}</span><br>
<span class="lineno"></span><span class="op" id="5143412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5143415">func</span>&nbsp;<span class="op" id="5143420">(</span><span class="ident" id="5143421">h</span>&nbsp;<span class="op" id="5143423">*</span><span class="ident" id="5143424">Handler</span><span class="op" id="5143431">)</span>&nbsp;<span class="ident" id="5143433">printf</span><span class="op" id="5143439">(</span><span class="ident" id="5143440">format</span>&nbsp;<span class="builtintype" id="5143447">string</span><span class="op" id="5143453">,</span>&nbsp;<span class="ident" id="5143455">v</span>&nbsp;<span class="op" id="5143457">...</span><span class="keyword" id="5143460">interface</span><span class="op" id="5143469">{</span><span class="op" id="5143470">}</span><span class="op" id="5143471">)</span>&nbsp;<span class="op" id="5143473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5143476">if</span>&nbsp;<span class="ident" id="5143479">h</span><span class="op" id="5143480">.</span><span class="ident" id="5143481">Logger</span>&nbsp;<span class="op" id="5143488">!=</span>&nbsp;<span class="ident" id="5143491">nil</span>&nbsp;<span class="op" id="5143495">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143499">h</span><span class="op" id="5143500">.</span><span class="ident" id="5143501">Logger</span><span class="op" id="5143507">.</span><span class="ident" id="5143508">Printf</span><span class="op" id="5143514">(</span><span class="ident" id="5143515">format</span><span class="op" id="5143521">,</span>&nbsp;<span class="ident" id="5143523">v</span><span class="op" id="5143524">...</span><span class="op" id="5143527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5143530">}</span>&nbsp;<span class="keyword" id="5143532">else</span>&nbsp;<span class="op" id="5143537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143541">log</span><span class="op" id="5143544">.</span><span class="ident" id="5143545">Printf</span><span class="op" id="5143551">(</span><span class="ident" id="5143552">format</span><span class="op" id="5143558">,</span>&nbsp;<span class="ident" id="5143560">v</span><span class="op" id="5143561">...</span><span class="op" id="5143564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5143567">}</span><br>
<span class="lineno"></span><span class="op" id="5143569">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="5143572">func</span>&nbsp;<span class="op" id="5143577">(</span><span class="ident" id="5143578">h</span>&nbsp;<span class="op" id="5143580">*</span><span class="ident" id="5143581">Handler</span><span class="op" id="5143588">)</span>&nbsp;<span class="ident" id="5143590">handleInternalRedirect</span><span class="op" id="5143612">(</span><span class="ident" id="5143613">rw</span>&nbsp;<span class="ident" id="5143616">http</span><span class="op" id="5143620">.</span><span class="ident" id="5143621">ResponseWriter</span><span class="op" id="5143635">,</span>&nbsp;<span class="ident" id="5143637">req</span>&nbsp;<span class="op" id="5143641">*</span><span class="ident" id="5143642">http</span><span class="op" id="5143646">.</span><span class="ident" id="5143647">Request</span><span class="op" id="5143654">,</span>&nbsp;<span class="ident" id="5143656">path</span>&nbsp;<span class="builtintype" id="5143661">string</span><span class="op" id="5143667">)</span>&nbsp;<span class="op" id="5143669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143672">url</span><span class="op" id="5143675">,</span>&nbsp;<span class="ident" id="5143677">err</span>&nbsp;<span class="op" id="5143681">:=</span>&nbsp;<span class="ident" id="5143684">req</span><span class="op" id="5143687">.</span><span class="ident" id="5143688">URL</span><span class="op" id="5143691">.</span><span class="ident" id="5143692">Parse</span><span class="op" id="5143697">(</span><span class="ident" id="5143698">path</span><span class="op" id="5143702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5143705">if</span>&nbsp;<span class="ident" id="5143708">err</span>&nbsp;<span class="op" id="5143712">!=</span>&nbsp;<span class="ident" id="5143715">nil</span>&nbsp;<span class="op" id="5143719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143723">rw</span><span class="op" id="5143725">.</span><span class="ident" id="5143726">WriteHeader</span><span class="op" id="5143737">(</span><span class="ident" id="5143738">http</span><span class="op" id="5143742">.</span><span class="ident" id="5143743">StatusInternalServerError</span><span class="op" id="5143768">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143772">h</span><span class="op" id="5143773">.</span><span class="ident" id="5143774">printf</span><span class="op" id="5143780">(</span><span class="string" id="5143781">&#34;cgi:&nbsp;error&nbsp;resolving&nbsp;local&nbsp;URI&nbsp;path&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="5143825">,</span>&nbsp;<span class="ident" id="5143827">path</span><span class="op" id="5143831">,</span>&nbsp;<span class="ident" id="5143833">err</span><span class="op" id="5143836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5143840">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5143848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5143851">//&nbsp;TODO:&nbsp;RFC&nbsp;3875&nbsp;isn&#39;t&nbsp;clear&nbsp;if&nbsp;only&nbsp;GET&nbsp;is&nbsp;supported,&nbsp;but&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5143915">//&nbsp;suggests&nbsp;so:&nbsp;&#34;Note&nbsp;that&nbsp;any&nbsp;message-body&nbsp;attached&nbsp;to&nbsp;the</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5143976">//&nbsp;request&nbsp;(such&nbsp;as&nbsp;for&nbsp;a&nbsp;POST&nbsp;request)&nbsp;may&nbsp;not&nbsp;be&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5144038">//&nbsp;to&nbsp;the&nbsp;resource&nbsp;that&nbsp;is&nbsp;the&nbsp;target&nbsp;of&nbsp;the&nbsp;redirect.&#34;&nbsp;&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5144099">//&nbsp;should&nbsp;do&nbsp;some&nbsp;tests&nbsp;against&nbsp;Apache&nbsp;to&nbsp;see&nbsp;how&nbsp;it&nbsp;handles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5144161">//&nbsp;POST,&nbsp;HEAD,&nbsp;etc.&nbsp;Does&nbsp;the&nbsp;internal&nbsp;redirect&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5144222">//&nbsp;method&nbsp;or&nbsp;just&nbsp;GET?&nbsp;What&nbsp;about&nbsp;incoming&nbsp;headers?</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5144275">//&nbsp;(e.g.&nbsp;Cookies)&nbsp;Which&nbsp;headers,&nbsp;if&nbsp;any,&nbsp;are&nbsp;copied&nbsp;into&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5144337">//&nbsp;second&nbsp;request?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144357">newReq</span>&nbsp;<span class="op" id="5144364">:=</span>&nbsp;<span class="op" id="5144367">&amp;</span><span class="ident" id="5144368">http</span><span class="op" id="5144372">.</span><span class="ident" id="5144373">Request</span><span class="op" id="5144380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144384">Method</span><span class="op" id="5144390">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5144396">&#34;GET&#34;</span><span class="op" id="5144401">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144405">URL</span><span class="op" id="5144408">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5144417">url</span><span class="op" id="5144420">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144424">Proto</span><span class="op" id="5144429">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5144436">&#34;HTTP/1.1&#34;</span><span class="op" id="5144446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144450">ProtoMajor</span><span class="op" id="5144460">:</span>&nbsp;<span class="num" id="5144462">1</span><span class="op" id="5144463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144467">ProtoMinor</span><span class="op" id="5144477">:</span>&nbsp;<span class="num" id="5144479">1</span><span class="op" id="5144480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144484">Header</span><span class="op" id="5144490">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5144496">make</span><span class="op" id="5144500">(</span><span class="ident" id="5144501">http</span><span class="op" id="5144505">.</span><span class="ident" id="5144506">Header</span><span class="op" id="5144512">)</span><span class="op" id="5144513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144517">Host</span><span class="op" id="5144521">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5144529">url</span><span class="op" id="5144532">.</span><span class="ident" id="5144533">Host</span><span class="op" id="5144537">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144541">RemoteAddr</span><span class="op" id="5144551">:</span>&nbsp;<span class="ident" id="5144553">req</span><span class="op" id="5144556">.</span><span class="ident" id="5144557">RemoteAddr</span><span class="op" id="5144567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144571">TLS</span><span class="op" id="5144574">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5144583">req</span><span class="op" id="5144586">.</span><span class="ident" id="5144587">TLS</span><span class="op" id="5144590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5144593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144596">h</span><span class="op" id="5144597">.</span><span class="ident" id="5144598">PathLocationHandler</span><span class="op" id="5144617">.</span><span class="ident" id="5144618">ServeHTTP</span><span class="op" id="5144627">(</span><span class="ident" id="5144628">rw</span><span class="op" id="5144630">,</span>&nbsp;<span class="ident" id="5144632">newReq</span><span class="op" id="5144638">)</span><br>
<span class="lineno"></span><span class="op" id="5144640">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="5144643">func</span>&nbsp;<span class="ident" id="5144648">upperCaseAndUnderscore</span><span class="op" id="5144670">(</span><span class="ident" id="5144671">r</span>&nbsp;<span class="builtintype" id="5144673">rune</span><span class="op" id="5144677">)</span>&nbsp;<span class="builtintype" id="5144679">rune</span>&nbsp;<span class="op" id="5144684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144687">switch</span>&nbsp;<span class="op" id="5144694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144697">case</span>&nbsp;<span class="ident" id="5144702">r</span>&nbsp;<span class="op" id="5144704">&gt;=</span>&nbsp;<span class="string" id="5144707">&#39;a&#39;</span>&nbsp;<span class="op" id="5144711">&amp;&amp;</span>&nbsp;<span class="ident" id="5144714">r</span>&nbsp;<span class="op" id="5144716">&lt;=</span>&nbsp;<span class="string" id="5144719">&#39;z&#39;</span><span class="op" id="5144722">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144726">return</span>&nbsp;<span class="ident" id="5144733">r</span>&nbsp;<span class="op" id="5144735">-</span>&nbsp;<span class="op" id="5144737">(</span><span class="string" id="5144738">&#39;a&#39;</span>&nbsp;<span class="op" id="5144742">-</span>&nbsp;<span class="string" id="5144744">&#39;A&#39;</span><span class="op" id="5144747">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144750">case</span>&nbsp;<span class="ident" id="5144755">r</span>&nbsp;<span class="op" id="5144757">==</span>&nbsp;<span class="string" id="5144760">&#39;-&#39;</span><span class="op" id="5144763">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144767">return</span>&nbsp;<span class="string" id="5144774">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144779">case</span>&nbsp;<span class="ident" id="5144784">r</span>&nbsp;<span class="op" id="5144786">==</span>&nbsp;<span class="string" id="5144789">&#39;=&#39;</span><span class="op" id="5144792">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5144796">//&nbsp;Maybe&nbsp;not&nbsp;part&nbsp;of&nbsp;the&nbsp;CGI&nbsp;&#39;spec&#39;&nbsp;but&nbsp;would&nbsp;mess&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5144852">//&nbsp;the&nbsp;environment&nbsp;in&nbsp;any&nbsp;case,&nbsp;as&nbsp;Go&nbsp;represents&nbsp;the</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5144907">//&nbsp;environment&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;&#34;key=value&#34;&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144959">return</span>&nbsp;<span class="string" id="5144966">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5144971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5144974">//&nbsp;TODO:&nbsp;other&nbsp;transformations&nbsp;in&nbsp;spec&nbsp;or&nbsp;practice?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5145027">return</span>&nbsp;<span class="ident" id="5145034">r</span><br>
<span class="lineno">375</span><span class="op" id="5145036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5145039">var</span>&nbsp;<span class="ident" id="5145043">testHookStartProcess</span>&nbsp;<span class="keyword" id="5145064">func</span><span class="op" id="5145068">(</span><span class="op" id="5145069">*</span><span class="ident" id="5145070">os</span><span class="op" id="5145072">.</span><span class="ident" id="5145073">Process</span><span class="op" id="5145080">)</span>&nbsp;<span class="comment" id="5145082">//&nbsp;nil&nbsp;except&nbsp;for&nbsp;some&nbsp;tests</span>
</div>
</body>
</html>
