<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/base64</h2>
<ul>
<li><a href="/gostd/encoding/base64/base64.go.html">base64.go</a></li>
<li><a href="/gostd/encoding/base64/base64_test.go.html">base64_test.go</a></li>
<li><a href="/gostd/encoding/base64/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7504639">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7504694">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7504748">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7504799">package</span>&nbsp;<span class="ident" id="7504807">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7504815">import</span>&nbsp;<span class="op" id="7504822">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7504825">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7504834">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7504844">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7504850">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7504863">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7504874">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7504885">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7504896">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7504903">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7504906">type</span>&nbsp;<span class="ident" id="7504911">testpair</span>&nbsp;<span class="keyword" id="7504920">struct</span>&nbsp;<span class="op" id="7504927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504930">decoded</span><span class="op" id="7504937">,</span>&nbsp;<span class="ident" id="7504939">encoded</span>&nbsp;<span class="builtintype" id="7504947">string</span><br>
<span class="lineno">20</span><span class="op" id="7504954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7504957">var</span>&nbsp;<span class="ident" id="7504961">pairs</span>&nbsp;<span class="op" id="7504967">=</span>&nbsp;<span class="op" id="7504969">[</span><span class="op" id="7504970">]</span><span class="ident" id="7504971">testpair</span><span class="op" id="7504979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7504982">//&nbsp;RFC&nbsp;3548&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505004">{</span><span class="string" id="7505005">&#34;\x14\xfb\x9c\x03\xd9\x7e&#34;</span><span class="op" id="7505031">,</span>&nbsp;<span class="string" id="7505033">&#34;FPucA9l+&#34;</span><span class="op" id="7505043">}</span><span class="op" id="7505044">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505047">{</span><span class="string" id="7505048">&#34;\x14\xfb\x9c\x03\xd9&#34;</span><span class="op" id="7505070">,</span>&nbsp;<span class="string" id="7505072">&#34;FPucA9k=&#34;</span><span class="op" id="7505082">}</span><span class="op" id="7505083">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505086">{</span><span class="string" id="7505087">&#34;\x14\xfb\x9c\x03&#34;</span><span class="op" id="7505105">,</span>&nbsp;<span class="string" id="7505107">&#34;FPucAw==&#34;</span><span class="op" id="7505117">}</span><span class="op" id="7505118">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7505122">//&nbsp;RFC&nbsp;4648&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505144">{</span><span class="string" id="7505145">&#34;&#34;</span><span class="op" id="7505147">,</span>&nbsp;<span class="string" id="7505149">&#34;&#34;</span><span class="op" id="7505151">}</span><span class="op" id="7505152">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505155">{</span><span class="string" id="7505156">&#34;f&#34;</span><span class="op" id="7505159">,</span>&nbsp;<span class="string" id="7505161">&#34;Zg==&#34;</span><span class="op" id="7505167">}</span><span class="op" id="7505168">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505171">{</span><span class="string" id="7505172">&#34;fo&#34;</span><span class="op" id="7505176">,</span>&nbsp;<span class="string" id="7505178">&#34;Zm8=&#34;</span><span class="op" id="7505184">}</span><span class="op" id="7505185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505188">{</span><span class="string" id="7505189">&#34;foo&#34;</span><span class="op" id="7505194">,</span>&nbsp;<span class="string" id="7505196">&#34;Zm9v&#34;</span><span class="op" id="7505202">}</span><span class="op" id="7505203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505206">{</span><span class="string" id="7505207">&#34;foob&#34;</span><span class="op" id="7505213">,</span>&nbsp;<span class="string" id="7505215">&#34;Zm9vYg==&#34;</span><span class="op" id="7505225">}</span><span class="op" id="7505226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505229">{</span><span class="string" id="7505230">&#34;fooba&#34;</span><span class="op" id="7505237">,</span>&nbsp;<span class="string" id="7505239">&#34;Zm9vYmE=&#34;</span><span class="op" id="7505249">}</span><span class="op" id="7505250">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505253">{</span><span class="string" id="7505254">&#34;foobar&#34;</span><span class="op" id="7505262">,</span>&nbsp;<span class="string" id="7505264">&#34;Zm9vYmFy&#34;</span><span class="op" id="7505274">}</span><span class="op" id="7505275">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7505279">//&nbsp;Wikipedia&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505302">{</span><span class="string" id="7505303">&#34;sure.&#34;</span><span class="op" id="7505310">,</span>&nbsp;<span class="string" id="7505312">&#34;c3VyZS4=&#34;</span><span class="op" id="7505322">}</span><span class="op" id="7505323">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505326">{</span><span class="string" id="7505327">&#34;sure&#34;</span><span class="op" id="7505333">,</span>&nbsp;<span class="string" id="7505335">&#34;c3VyZQ==&#34;</span><span class="op" id="7505345">}</span><span class="op" id="7505346">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505349">{</span><span class="string" id="7505350">&#34;sur&#34;</span><span class="op" id="7505355">,</span>&nbsp;<span class="string" id="7505357">&#34;c3Vy&#34;</span><span class="op" id="7505363">}</span><span class="op" id="7505364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505367">{</span><span class="string" id="7505368">&#34;su&#34;</span><span class="op" id="7505372">,</span>&nbsp;<span class="string" id="7505374">&#34;c3U=&#34;</span><span class="op" id="7505380">}</span><span class="op" id="7505381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505384">{</span><span class="string" id="7505385">&#34;leasure.&#34;</span><span class="op" id="7505395">,</span>&nbsp;<span class="string" id="7505397">&#34;bGVhc3VyZS4=&#34;</span><span class="op" id="7505411">}</span><span class="op" id="7505412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505415">{</span><span class="string" id="7505416">&#34;easure.&#34;</span><span class="op" id="7505425">,</span>&nbsp;<span class="string" id="7505427">&#34;ZWFzdXJlLg==&#34;</span><span class="op" id="7505441">}</span><span class="op" id="7505442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505445">{</span><span class="string" id="7505446">&#34;asure.&#34;</span><span class="op" id="7505454">,</span>&nbsp;<span class="string" id="7505456">&#34;YXN1cmUu&#34;</span><span class="op" id="7505466">}</span><span class="op" id="7505467">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505470">{</span><span class="string" id="7505471">&#34;sure.&#34;</span><span class="op" id="7505478">,</span>&nbsp;<span class="string" id="7505480">&#34;c3VyZS4=&#34;</span><span class="op" id="7505490">}</span><span class="op" id="7505491">,</span><br>
<span class="lineno"></span><span class="op" id="7505493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7505496">var</span>&nbsp;<span class="ident" id="7505500">bigtest</span>&nbsp;<span class="op" id="7505508">=</span>&nbsp;<span class="ident" id="7505510">testpair</span><span class="op" id="7505518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7505521">&#34;Twas&nbsp;brillig,&nbsp;and&nbsp;the&nbsp;slithy&nbsp;toves&#34;</span><span class="op" id="7505557">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7505560">&#34;VHdhcyBicmlsbGlnLCBhbmQgdGhlIHNsaXRoeSB0b3Zlcw==&#34;</span><span class="op" id="7505610">,</span><br>
<span class="lineno"></span><span class="op" id="7505612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7505615">func</span>&nbsp;<span class="ident" id="7505620">testEqual</span><span class="op" id="7505629">(</span><span class="ident" id="7505630">t</span>&nbsp;<span class="op" id="7505632">*</span><span class="ident" id="7505633">testing</span><span class="op" id="7505640">.</span><span class="ident" id="7505641">T</span><span class="op" id="7505642">,</span>&nbsp;<span class="ident" id="7505644">msg</span>&nbsp;<span class="builtintype" id="7505648">string</span><span class="op" id="7505654">,</span>&nbsp;<span class="ident" id="7505656">args</span>&nbsp;<span class="op" id="7505661">...</span><span class="keyword" id="7505664">interface</span><span class="op" id="7505673">{</span><span class="op" id="7505674">}</span><span class="op" id="7505675">)</span>&nbsp;<span class="builtintype" id="7505677">bool</span>&nbsp;<span class="op" id="7505682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7505685">if</span>&nbsp;<span class="ident" id="7505688">args</span><span class="op" id="7505692">[</span><span class="builtinfunc" id="7505693">len</span><span class="op" id="7505696">(</span><span class="ident" id="7505697">args</span><span class="op" id="7505701">)</span><span class="op" id="7505702">-</span><span class="num" id="7505703">2</span><span class="op" id="7505704">]</span>&nbsp;<span class="op" id="7505706">!=</span>&nbsp;<span class="ident" id="7505709">args</span><span class="op" id="7505713">[</span><span class="builtinfunc" id="7505714">len</span><span class="op" id="7505717">(</span><span class="ident" id="7505718">args</span><span class="op" id="7505722">)</span><span class="op" id="7505723">-</span><span class="num" id="7505724">1</span><span class="op" id="7505725">]</span>&nbsp;<span class="op" id="7505727">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505731">t</span><span class="op" id="7505732">.</span><span class="ident" id="7505733">Errorf</span><span class="op" id="7505739">(</span><span class="ident" id="7505740">msg</span><span class="op" id="7505743">,</span>&nbsp;<span class="ident" id="7505745">args</span><span class="op" id="7505749">...</span><span class="op" id="7505752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7505756">return</span>&nbsp;<span class="builtintype" id="7505763">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7505773">return</span>&nbsp;<span class="builtintype" id="7505780">true</span><br>
<span class="lineno"></span><span class="op" id="7505785">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="7505788">func</span>&nbsp;<span class="ident" id="7505793">TestEncode</span><span class="op" id="7505803">(</span><span class="ident" id="7505804">t</span>&nbsp;<span class="op" id="7505806">*</span><span class="ident" id="7505807">testing</span><span class="op" id="7505814">.</span><span class="ident" id="7505815">T</span><span class="op" id="7505816">)</span>&nbsp;<span class="op" id="7505818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7505821">for</span>&nbsp;<span class="ident" id="7505825">_</span><span class="op" id="7505826">,</span>&nbsp;<span class="ident" id="7505828">p</span>&nbsp;<span class="op" id="7505830">:=</span>&nbsp;<span class="keyword" id="7505833">range</span>&nbsp;<span class="ident" id="7505839">pairs</span>&nbsp;<span class="op" id="7505845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505849">got</span>&nbsp;<span class="op" id="7505853">:=</span>&nbsp;<span class="ident" id="7505856">StdEncoding</span><span class="op" id="7505867">.</span><span class="ident" id="7505868">EncodeToString</span><span class="op" id="7505882">(</span><span class="op" id="7505883">[</span><span class="op" id="7505884">]</span><span class="builtintype" id="7505885">byte</span><span class="op" id="7505889">(</span><span class="ident" id="7505890">p</span><span class="op" id="7505891">.</span><span class="ident" id="7505892">decoded</span><span class="op" id="7505899">)</span><span class="op" id="7505900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505904">testEqual</span><span class="op" id="7505913">(</span><span class="ident" id="7505914">t</span><span class="op" id="7505915">,</span>&nbsp;<span class="string" id="7505917">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7505943">,</span>&nbsp;<span class="ident" id="7505945">p</span><span class="op" id="7505946">.</span><span class="ident" id="7505947">decoded</span><span class="op" id="7505954">,</span>&nbsp;<span class="ident" id="7505956">got</span><span class="op" id="7505959">,</span>&nbsp;<span class="ident" id="7505961">p</span><span class="op" id="7505962">.</span><span class="ident" id="7505963">encoded</span><span class="op" id="7505970">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505973">}</span><br>
<span class="lineno"></span><span class="op" id="7505975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7505978">func</span>&nbsp;<span class="ident" id="7505983">TestEncoder</span><span class="op" id="7505994">(</span><span class="ident" id="7505995">t</span>&nbsp;<span class="op" id="7505997">*</span><span class="ident" id="7505998">testing</span><span class="op" id="7506005">.</span><span class="ident" id="7506006">T</span><span class="op" id="7506007">)</span>&nbsp;<span class="op" id="7506009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7506012">for</span>&nbsp;<span class="ident" id="7506016">_</span><span class="op" id="7506017">,</span>&nbsp;<span class="ident" id="7506019">p</span>&nbsp;<span class="op" id="7506021">:=</span>&nbsp;<span class="keyword" id="7506024">range</span>&nbsp;<span class="ident" id="7506030">pairs</span>&nbsp;<span class="op" id="7506036">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506040">bb</span>&nbsp;<span class="op" id="7506043">:=</span>&nbsp;<span class="op" id="7506046">&amp;</span><span class="ident" id="7506047">bytes</span><span class="op" id="7506052">.</span><span class="ident" id="7506053">Buffer</span><span class="op" id="7506059">{</span><span class="op" id="7506060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506064">encoder</span>&nbsp;<span class="op" id="7506072">:=</span>&nbsp;<span class="ident" id="7506075">NewEncoder</span><span class="op" id="7506085">(</span><span class="ident" id="7506086">StdEncoding</span><span class="op" id="7506097">,</span>&nbsp;<span class="ident" id="7506099">bb</span><span class="op" id="7506101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506105">encoder</span><span class="op" id="7506112">.</span><span class="ident" id="7506113">Write</span><span class="op" id="7506118">(</span><span class="op" id="7506119">[</span><span class="op" id="7506120">]</span><span class="builtintype" id="7506121">byte</span><span class="op" id="7506125">(</span><span class="ident" id="7506126">p</span><span class="op" id="7506127">.</span><span class="ident" id="7506128">decoded</span><span class="op" id="7506135">)</span><span class="op" id="7506136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506140">encoder</span><span class="op" id="7506147">.</span><span class="ident" id="7506148">Close</span><span class="op" id="7506153">(</span><span class="op" id="7506154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506158">testEqual</span><span class="op" id="7506167">(</span><span class="ident" id="7506168">t</span><span class="op" id="7506169">,</span>&nbsp;<span class="string" id="7506171">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7506197">,</span>&nbsp;<span class="ident" id="7506199">p</span><span class="op" id="7506200">.</span><span class="ident" id="7506201">decoded</span><span class="op" id="7506208">,</span>&nbsp;<span class="ident" id="7506210">bb</span><span class="op" id="7506212">.</span><span class="ident" id="7506213">String</span><span class="op" id="7506219">(</span><span class="op" id="7506220">)</span><span class="op" id="7506221">,</span>&nbsp;<span class="ident" id="7506223">p</span><span class="op" id="7506224">.</span><span class="ident" id="7506225">encoded</span><span class="op" id="7506232">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7506235">}</span><br>
<span class="lineno"></span><span class="op" id="7506237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7506240">func</span>&nbsp;<span class="ident" id="7506245">TestEncoderBuffering</span><span class="op" id="7506265">(</span><span class="ident" id="7506266">t</span>&nbsp;<span class="op" id="7506268">*</span><span class="ident" id="7506269">testing</span><span class="op" id="7506276">.</span><span class="ident" id="7506277">T</span><span class="op" id="7506278">)</span>&nbsp;<span class="op" id="7506280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506283">input</span>&nbsp;<span class="op" id="7506289">:=</span>&nbsp;<span class="op" id="7506292">[</span><span class="op" id="7506293">]</span><span class="builtintype" id="7506294">byte</span><span class="op" id="7506298">(</span><span class="ident" id="7506299">bigtest</span><span class="op" id="7506306">.</span><span class="ident" id="7506307">decoded</span><span class="op" id="7506314">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7506317">for</span>&nbsp;<span class="ident" id="7506321">bs</span>&nbsp;<span class="op" id="7506324">:=</span>&nbsp;<span class="num" id="7506327">1</span><span class="op" id="7506328">;</span>&nbsp;<span class="ident" id="7506330">bs</span>&nbsp;<span class="op" id="7506333">&lt;=</span>&nbsp;<span class="num" id="7506336">12</span><span class="op" id="7506338">;</span>&nbsp;<span class="ident" id="7506340">bs</span><span class="op" id="7506342">++</span>&nbsp;<span class="op" id="7506345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506349">bb</span>&nbsp;<span class="op" id="7506352">:=</span>&nbsp;<span class="op" id="7506355">&amp;</span><span class="ident" id="7506356">bytes</span><span class="op" id="7506361">.</span><span class="ident" id="7506362">Buffer</span><span class="op" id="7506368">{</span><span class="op" id="7506369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506373">encoder</span>&nbsp;<span class="op" id="7506381">:=</span>&nbsp;<span class="ident" id="7506384">NewEncoder</span><span class="op" id="7506394">(</span><span class="ident" id="7506395">StdEncoding</span><span class="op" id="7506406">,</span>&nbsp;<span class="ident" id="7506408">bb</span><span class="op" id="7506410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7506414">for</span>&nbsp;<span class="ident" id="7506418">pos</span>&nbsp;<span class="op" id="7506422">:=</span>&nbsp;<span class="num" id="7506425">0</span><span class="op" id="7506426">;</span>&nbsp;<span class="ident" id="7506428">pos</span>&nbsp;<span class="op" id="7506432">&lt;</span>&nbsp;<span class="builtinfunc" id="7506434">len</span><span class="op" id="7506437">(</span><span class="ident" id="7506438">input</span><span class="op" id="7506443">)</span><span class="op" id="7506444">;</span>&nbsp;<span class="ident" id="7506446">pos</span>&nbsp;<span class="op" id="7506450">+=</span>&nbsp;<span class="ident" id="7506453">bs</span>&nbsp;<span class="op" id="7506456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506461">end</span>&nbsp;<span class="op" id="7506465">:=</span>&nbsp;<span class="ident" id="7506468">pos</span>&nbsp;<span class="op" id="7506472">+</span>&nbsp;<span class="ident" id="7506474">bs</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7506480">if</span>&nbsp;<span class="ident" id="7506483">end</span>&nbsp;<span class="op" id="7506487">&gt;</span>&nbsp;<span class="builtinfunc" id="7506489">len</span><span class="op" id="7506492">(</span><span class="ident" id="7506493">input</span><span class="op" id="7506498">)</span>&nbsp;<span class="op" id="7506500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506506">end</span>&nbsp;<span class="op" id="7506510">=</span>&nbsp;<span class="builtinfunc" id="7506512">len</span><span class="op" id="7506515">(</span><span class="ident" id="7506516">input</span><span class="op" id="7506521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7506526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506531">n</span><span class="op" id="7506532">,</span>&nbsp;<span class="ident" id="7506534">err</span>&nbsp;<span class="op" id="7506538">:=</span>&nbsp;<span class="ident" id="7506541">encoder</span><span class="op" id="7506548">.</span><span class="ident" id="7506549">Write</span><span class="op" id="7506554">(</span><span class="ident" id="7506555">input</span><span class="op" id="7506560">[</span><span class="ident" id="7506561">pos</span><span class="op" id="7506564">:</span><span class="ident" id="7506565">end</span><span class="op" id="7506568">]</span><span class="op" id="7506569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506574">testEqual</span><span class="op" id="7506583">(</span><span class="ident" id="7506584">t</span><span class="op" id="7506585">,</span>&nbsp;<span class="string" id="7506587">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7506621">,</span>&nbsp;<span class="ident" id="7506623">input</span><span class="op" id="7506628">[</span><span class="ident" id="7506629">pos</span><span class="op" id="7506632">:</span><span class="ident" id="7506633">end</span><span class="op" id="7506636">]</span><span class="op" id="7506637">,</span>&nbsp;<span class="ident" id="7506639">err</span><span class="op" id="7506642">,</span>&nbsp;<span class="builtintype" id="7506644">error</span><span class="op" id="7506649">(</span><span class="ident" id="7506650">nil</span><span class="op" id="7506653">)</span><span class="op" id="7506654">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506659">testEqual</span><span class="op" id="7506668">(</span><span class="ident" id="7506669">t</span><span class="op" id="7506670">,</span>&nbsp;<span class="string" id="7506672">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7506707">,</span>&nbsp;<span class="ident" id="7506709">input</span><span class="op" id="7506714">[</span><span class="ident" id="7506715">pos</span><span class="op" id="7506718">:</span><span class="ident" id="7506719">end</span><span class="op" id="7506722">]</span><span class="op" id="7506723">,</span>&nbsp;<span class="ident" id="7506725">n</span><span class="op" id="7506726">,</span>&nbsp;<span class="ident" id="7506728">end</span><span class="op" id="7506731">-</span><span class="ident" id="7506732">pos</span><span class="op" id="7506735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7506739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506743">err</span>&nbsp;<span class="op" id="7506747">:=</span>&nbsp;<span class="ident" id="7506750">encoder</span><span class="op" id="7506757">.</span><span class="ident" id="7506758">Close</span><span class="op" id="7506763">(</span><span class="op" id="7506764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506768">testEqual</span><span class="op" id="7506777">(</span><span class="ident" id="7506778">t</span><span class="op" id="7506779">,</span>&nbsp;<span class="string" id="7506781">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7506811">,</span>&nbsp;<span class="ident" id="7506813">err</span><span class="op" id="7506816">,</span>&nbsp;<span class="builtintype" id="7506818">error</span><span class="op" id="7506823">(</span><span class="ident" id="7506824">nil</span><span class="op" id="7506827">)</span><span class="op" id="7506828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506832">testEqual</span><span class="op" id="7506841">(</span><span class="ident" id="7506842">t</span><span class="op" id="7506843">,</span>&nbsp;<span class="string" id="7506845">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7506878">,</span>&nbsp;<span class="ident" id="7506880">bs</span><span class="op" id="7506882">,</span>&nbsp;<span class="ident" id="7506884">bigtest</span><span class="op" id="7506891">.</span><span class="ident" id="7506892">decoded</span><span class="op" id="7506899">,</span>&nbsp;<span class="ident" id="7506901">bb</span><span class="op" id="7506903">.</span><span class="ident" id="7506904">String</span><span class="op" id="7506910">(</span><span class="op" id="7506911">)</span><span class="op" id="7506912">,</span>&nbsp;<span class="ident" id="7506914">bigtest</span><span class="op" id="7506921">.</span><span class="ident" id="7506922">encoded</span><span class="op" id="7506929">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7506932">}</span><br>
<span class="lineno"></span><span class="op" id="7506934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7506937">func</span>&nbsp;<span class="ident" id="7506942">TestDecode</span><span class="op" id="7506952">(</span><span class="ident" id="7506953">t</span>&nbsp;<span class="op" id="7506955">*</span><span class="ident" id="7506956">testing</span><span class="op" id="7506963">.</span><span class="ident" id="7506964">T</span><span class="op" id="7506965">)</span>&nbsp;<span class="op" id="7506967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7506970">for</span>&nbsp;<span class="ident" id="7506974">_</span><span class="op" id="7506975">,</span>&nbsp;<span class="ident" id="7506977">p</span>&nbsp;<span class="op" id="7506979">:=</span>&nbsp;<span class="keyword" id="7506982">range</span>&nbsp;<span class="ident" id="7506988">pairs</span>&nbsp;<span class="op" id="7506994">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506998">dbuf</span>&nbsp;<span class="op" id="7507003">:=</span>&nbsp;<span class="builtinfunc" id="7507006">make</span><span class="op" id="7507010">(</span><span class="op" id="7507011">[</span><span class="op" id="7507012">]</span><span class="builtintype" id="7507013">byte</span><span class="op" id="7507017">,</span>&nbsp;<span class="ident" id="7507019">StdEncoding</span><span class="op" id="7507030">.</span><span class="ident" id="7507031">DecodedLen</span><span class="op" id="7507041">(</span><span class="builtinfunc" id="7507042">len</span><span class="op" id="7507045">(</span><span class="ident" id="7507046">p</span><span class="op" id="7507047">.</span><span class="ident" id="7507048">encoded</span><span class="op" id="7507055">)</span><span class="op" id="7507056">)</span><span class="op" id="7507057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7507061">count</span><span class="op" id="7507066">,</span>&nbsp;<span class="ident" id="7507068">end</span><span class="op" id="7507071">,</span>&nbsp;<span class="ident" id="7507073">err</span>&nbsp;<span class="op" id="7507077">:=</span>&nbsp;<span class="ident" id="7507080">StdEncoding</span><span class="op" id="7507091">.</span><span class="ident" id="7507092">decode</span><span class="op" id="7507098">(</span><span class="ident" id="7507099">dbuf</span><span class="op" id="7507103">,</span>&nbsp;<span class="op" id="7507105">[</span><span class="op" id="7507106">]</span><span class="builtintype" id="7507107">byte</span><span class="op" id="7507111">(</span><span class="ident" id="7507112">p</span><span class="op" id="7507113">.</span><span class="ident" id="7507114">encoded</span><span class="op" id="7507121">)</span><span class="op" id="7507122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7507126">testEqual</span><span class="op" id="7507135">(</span><span class="ident" id="7507136">t</span><span class="op" id="7507137">,</span>&nbsp;<span class="string" id="7507139">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7507171">,</span>&nbsp;<span class="ident" id="7507173">p</span><span class="op" id="7507174">.</span><span class="ident" id="7507175">encoded</span><span class="op" id="7507182">,</span>&nbsp;<span class="ident" id="7507184">err</span><span class="op" id="7507187">,</span>&nbsp;<span class="builtintype" id="7507189">error</span><span class="op" id="7507194">(</span><span class="ident" id="7507195">nil</span><span class="op" id="7507198">)</span><span class="op" id="7507199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7507203">testEqual</span><span class="op" id="7507212">(</span><span class="ident" id="7507213">t</span><span class="op" id="7507214">,</span>&nbsp;<span class="string" id="7507216">&#34;Decode(%q)&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7507249">,</span>&nbsp;<span class="ident" id="7507251">p</span><span class="op" id="7507252">.</span><span class="ident" id="7507253">encoded</span><span class="op" id="7507260">,</span>&nbsp;<span class="ident" id="7507262">count</span><span class="op" id="7507267">,</span>&nbsp;<span class="builtinfunc" id="7507269">len</span><span class="op" id="7507272">(</span><span class="ident" id="7507273">p</span><span class="op" id="7507274">.</span><span class="ident" id="7507275">decoded</span><span class="op" id="7507282">)</span><span class="op" id="7507283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7507287">if</span>&nbsp;<span class="builtinfunc" id="7507290">len</span><span class="op" id="7507293">(</span><span class="ident" id="7507294">p</span><span class="op" id="7507295">.</span><span class="ident" id="7507296">encoded</span><span class="op" id="7507303">)</span>&nbsp;<span class="op" id="7507305">&gt;</span>&nbsp;<span class="num" id="7507307">0</span>&nbsp;<span class="op" id="7507309">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7507314">testEqual</span><span class="op" id="7507323">(</span><span class="ident" id="7507324">t</span><span class="op" id="7507325">,</span>&nbsp;<span class="string" id="7507327">&#34;Decode(%q)&nbsp;=&nbsp;end&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7507357">,</span>&nbsp;<span class="ident" id="7507359">p</span><span class="op" id="7507360">.</span><span class="ident" id="7507361">encoded</span><span class="op" id="7507368">,</span>&nbsp;<span class="ident" id="7507370">end</span><span class="op" id="7507373">,</span>&nbsp;<span class="op" id="7507375">(</span><span class="ident" id="7507376">p</span><span class="op" id="7507377">.</span><span class="ident" id="7507378">encoded</span><span class="op" id="7507385">[</span><span class="builtinfunc" id="7507386">len</span><span class="op" id="7507389">(</span><span class="ident" id="7507390">p</span><span class="op" id="7507391">.</span><span class="ident" id="7507392">encoded</span><span class="op" id="7507399">)</span><span class="op" id="7507400">-</span><span class="num" id="7507401">1</span><span class="op" id="7507402">]</span>&nbsp;<span class="op" id="7507404">==</span>&nbsp;<span class="string" id="7507407">&#39;=&#39;</span><span class="op" id="7507410">)</span><span class="op" id="7507411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7507415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7507419">testEqual</span><span class="op" id="7507428">(</span><span class="ident" id="7507429">t</span><span class="op" id="7507430">,</span>&nbsp;<span class="string" id="7507432">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7507458">,</span>&nbsp;<span class="ident" id="7507460">p</span><span class="op" id="7507461">.</span><span class="ident" id="7507462">encoded</span><span class="op" id="7507469">,</span>&nbsp;<span class="builtintype" id="7507471">string</span><span class="op" id="7507477">(</span><span class="ident" id="7507478">dbuf</span><span class="op" id="7507482">[</span><span class="num" id="7507483">0</span><span class="op" id="7507484">:</span><span class="ident" id="7507485">count</span><span class="op" id="7507490">]</span><span class="op" id="7507491">)</span><span class="op" id="7507492">,</span>&nbsp;<span class="ident" id="7507494">p</span><span class="op" id="7507495">.</span><span class="ident" id="7507496">decoded</span><span class="op" id="7507503">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7507508">dbuf</span><span class="op" id="7507512">,</span>&nbsp;<span class="ident" id="7507514">err</span>&nbsp;<span class="op" id="7507518">=</span>&nbsp;<span class="ident" id="7507520">StdEncoding</span><span class="op" id="7507531">.</span><span class="ident" id="7507532">DecodeString</span><span class="op" id="7507544">(</span><span class="ident" id="7507545">p</span><span class="op" id="7507546">.</span><span class="ident" id="7507547">encoded</span><span class="op" id="7507554">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7507558">testEqual</span><span class="op" id="7507567">(</span><span class="ident" id="7507568">t</span><span class="op" id="7507569">,</span>&nbsp;<span class="string" id="7507571">&#34;DecodeString(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7507609">,</span>&nbsp;<span class="ident" id="7507611">p</span><span class="op" id="7507612">.</span><span class="ident" id="7507613">encoded</span><span class="op" id="7507620">,</span>&nbsp;<span class="ident" id="7507622">err</span><span class="op" id="7507625">,</span>&nbsp;<span class="builtintype" id="7507627">error</span><span class="op" id="7507632">(</span><span class="ident" id="7507633">nil</span><span class="op" id="7507636">)</span><span class="op" id="7507637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7507641">testEqual</span><span class="op" id="7507650">(</span><span class="ident" id="7507651">t</span><span class="op" id="7507652">,</span>&nbsp;<span class="string" id="7507654">&#34;DecodeString(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7507686">,</span>&nbsp;<span class="builtintype" id="7507688">string</span><span class="op" id="7507694">(</span><span class="ident" id="7507695">dbuf</span><span class="op" id="7507699">)</span><span class="op" id="7507700">,</span>&nbsp;<span class="ident" id="7507702">p</span><span class="op" id="7507703">.</span><span class="ident" id="7507704">decoded</span><span class="op" id="7507711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7507714">}</span><br>
<span class="lineno"></span><span class="op" id="7507716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="7507719">func</span>&nbsp;<span class="ident" id="7507724">TestDecoder</span><span class="op" id="7507735">(</span><span class="ident" id="7507736">t</span>&nbsp;<span class="op" id="7507738">*</span><span class="ident" id="7507739">testing</span><span class="op" id="7507746">.</span><span class="ident" id="7507747">T</span><span class="op" id="7507748">)</span>&nbsp;<span class="op" id="7507750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7507753">for</span>&nbsp;<span class="ident" id="7507757">_</span><span class="op" id="7507758">,</span>&nbsp;<span class="ident" id="7507760">p</span>&nbsp;<span class="op" id="7507762">:=</span>&nbsp;<span class="keyword" id="7507765">range</span>&nbsp;<span class="ident" id="7507771">pairs</span>&nbsp;<span class="op" id="7507777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7507781">decoder</span>&nbsp;<span class="op" id="7507789">:=</span>&nbsp;<span class="ident" id="7507792">NewDecoder</span><span class="op" id="7507802">(</span><span class="ident" id="7507803">StdEncoding</span><span class="op" id="7507814">,</span>&nbsp;<span class="ident" id="7507816">strings</span><span class="op" id="7507823">.</span><span class="ident" id="7507824">NewReader</span><span class="op" id="7507833">(</span><span class="ident" id="7507834">p</span><span class="op" id="7507835">.</span><span class="ident" id="7507836">encoded</span><span class="op" id="7507843">)</span><span class="op" id="7507844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7507848">dbuf</span>&nbsp;<span class="op" id="7507853">:=</span>&nbsp;<span class="builtinfunc" id="7507856">make</span><span class="op" id="7507860">(</span><span class="op" id="7507861">[</span><span class="op" id="7507862">]</span><span class="builtintype" id="7507863">byte</span><span class="op" id="7507867">,</span>&nbsp;<span class="ident" id="7507869">StdEncoding</span><span class="op" id="7507880">.</span><span class="ident" id="7507881">DecodedLen</span><span class="op" id="7507891">(</span><span class="builtinfunc" id="7507892">len</span><span class="op" id="7507895">(</span><span class="ident" id="7507896">p</span><span class="op" id="7507897">.</span><span class="ident" id="7507898">encoded</span><span class="op" id="7507905">)</span><span class="op" id="7507906">)</span><span class="op" id="7507907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7507911">count</span><span class="op" id="7507916">,</span>&nbsp;<span class="ident" id="7507918">err</span>&nbsp;<span class="op" id="7507922">:=</span>&nbsp;<span class="ident" id="7507925">decoder</span><span class="op" id="7507932">.</span><span class="ident" id="7507933">Read</span><span class="op" id="7507937">(</span><span class="ident" id="7507938">dbuf</span><span class="op" id="7507942">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7507946">if</span>&nbsp;<span class="ident" id="7507949">err</span>&nbsp;<span class="op" id="7507953">!=</span>&nbsp;<span class="ident" id="7507956">nil</span>&nbsp;<span class="op" id="7507960">&amp;&amp;</span>&nbsp;<span class="ident" id="7507963">err</span>&nbsp;<span class="op" id="7507967">!=</span>&nbsp;<span class="ident" id="7507970">io</span><span class="op" id="7507972">.</span><span class="ident" id="7507973">EOF</span>&nbsp;<span class="op" id="7507977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7507982">t</span><span class="op" id="7507983">.</span><span class="ident" id="7507984">Fatal</span><span class="op" id="7507989">(</span><span class="string" id="7507990">&#34;Read&nbsp;failed&#34;</span><span class="op" id="7508003">,</span>&nbsp;<span class="ident" id="7508005">err</span><span class="op" id="7508008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7508012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7508016">testEqual</span><span class="op" id="7508025">(</span><span class="ident" id="7508026">t</span><span class="op" id="7508027">,</span>&nbsp;<span class="string" id="7508029">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7508064">,</span>&nbsp;<span class="ident" id="7508066">p</span><span class="op" id="7508067">.</span><span class="ident" id="7508068">encoded</span><span class="op" id="7508075">,</span>&nbsp;<span class="ident" id="7508077">count</span><span class="op" id="7508082">,</span>&nbsp;<span class="builtinfunc" id="7508084">len</span><span class="op" id="7508087">(</span><span class="ident" id="7508088">p</span><span class="op" id="7508089">.</span><span class="ident" id="7508090">decoded</span><span class="op" id="7508097">)</span><span class="op" id="7508098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7508102">testEqual</span><span class="op" id="7508111">(</span><span class="ident" id="7508112">t</span><span class="op" id="7508113">,</span>&nbsp;<span class="string" id="7508115">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7508145">,</span>&nbsp;<span class="ident" id="7508147">p</span><span class="op" id="7508148">.</span><span class="ident" id="7508149">encoded</span><span class="op" id="7508156">,</span>&nbsp;<span class="builtintype" id="7508158">string</span><span class="op" id="7508164">(</span><span class="ident" id="7508165">dbuf</span><span class="op" id="7508169">[</span><span class="num" id="7508170">0</span><span class="op" id="7508171">:</span><span class="ident" id="7508172">count</span><span class="op" id="7508177">]</span><span class="op" id="7508178">)</span><span class="op" id="7508179">,</span>&nbsp;<span class="ident" id="7508181">p</span><span class="op" id="7508182">.</span><span class="ident" id="7508183">decoded</span><span class="op" id="7508190">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7508194">if</span>&nbsp;<span class="ident" id="7508197">err</span>&nbsp;<span class="op" id="7508201">!=</span>&nbsp;<span class="ident" id="7508204">io</span><span class="op" id="7508206">.</span><span class="ident" id="7508207">EOF</span>&nbsp;<span class="op" id="7508211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7508216">count</span><span class="op" id="7508221">,</span>&nbsp;<span class="ident" id="7508223">err</span>&nbsp;<span class="op" id="7508227">=</span>&nbsp;<span class="ident" id="7508229">decoder</span><span class="op" id="7508236">.</span><span class="ident" id="7508237">Read</span><span class="op" id="7508241">(</span><span class="ident" id="7508242">dbuf</span><span class="op" id="7508246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7508250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7508254">testEqual</span><span class="op" id="7508263">(</span><span class="ident" id="7508264">t</span><span class="op" id="7508265">,</span>&nbsp;<span class="string" id="7508267">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7508295">,</span>&nbsp;<span class="ident" id="7508297">p</span><span class="op" id="7508298">.</span><span class="ident" id="7508299">encoded</span><span class="op" id="7508306">,</span>&nbsp;<span class="ident" id="7508308">err</span><span class="op" id="7508311">,</span>&nbsp;<span class="ident" id="7508313">io</span><span class="op" id="7508315">.</span><span class="ident" id="7508316">EOF</span><span class="op" id="7508319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7508322">}</span><br>
<span class="lineno">130</span><span class="op" id="7508324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7508327">func</span>&nbsp;<span class="ident" id="7508332">TestDecoderBuffering</span><span class="op" id="7508352">(</span><span class="ident" id="7508353">t</span>&nbsp;<span class="op" id="7508355">*</span><span class="ident" id="7508356">testing</span><span class="op" id="7508363">.</span><span class="ident" id="7508364">T</span><span class="op" id="7508365">)</span>&nbsp;<span class="op" id="7508367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7508370">for</span>&nbsp;<span class="ident" id="7508374">bs</span>&nbsp;<span class="op" id="7508377">:=</span>&nbsp;<span class="num" id="7508380">1</span><span class="op" id="7508381">;</span>&nbsp;<span class="ident" id="7508383">bs</span>&nbsp;<span class="op" id="7508386">&lt;=</span>&nbsp;<span class="num" id="7508389">12</span><span class="op" id="7508391">;</span>&nbsp;<span class="ident" id="7508393">bs</span><span class="op" id="7508395">++</span>&nbsp;<span class="op" id="7508398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7508402">decoder</span>&nbsp;<span class="op" id="7508410">:=</span>&nbsp;<span class="ident" id="7508413">NewDecoder</span><span class="op" id="7508423">(</span><span class="ident" id="7508424">StdEncoding</span><span class="op" id="7508435">,</span>&nbsp;<span class="ident" id="7508437">strings</span><span class="op" id="7508444">.</span><span class="ident" id="7508445">NewReader</span><span class="op" id="7508454">(</span><span class="ident" id="7508455">bigtest</span><span class="op" id="7508462">.</span><span class="ident" id="7508463">encoded</span><span class="op" id="7508470">)</span><span class="op" id="7508471">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7508475">buf</span>&nbsp;<span class="op" id="7508479">:=</span>&nbsp;<span class="builtinfunc" id="7508482">make</span><span class="op" id="7508486">(</span><span class="op" id="7508487">[</span><span class="op" id="7508488">]</span><span class="builtintype" id="7508489">byte</span><span class="op" id="7508493">,</span>&nbsp;<span class="builtinfunc" id="7508495">len</span><span class="op" id="7508498">(</span><span class="ident" id="7508499">bigtest</span><span class="op" id="7508506">.</span><span class="ident" id="7508507">decoded</span><span class="op" id="7508514">)</span><span class="op" id="7508515">+</span><span class="num" id="7508516">12</span><span class="op" id="7508518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7508522">var</span>&nbsp;<span class="ident" id="7508526">total</span>&nbsp;<span class="builtintype" id="7508532">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7508538">for</span>&nbsp;<span class="ident" id="7508542">total</span>&nbsp;<span class="op" id="7508548">=</span>&nbsp;<span class="num" id="7508550">0</span><span class="op" id="7508551">;</span>&nbsp;<span class="ident" id="7508553">total</span>&nbsp;<span class="op" id="7508559">&lt;</span>&nbsp;<span class="builtinfunc" id="7508561">len</span><span class="op" id="7508564">(</span><span class="ident" id="7508565">bigtest</span><span class="op" id="7508572">.</span><span class="ident" id="7508573">decoded</span><span class="op" id="7508580">)</span><span class="op" id="7508581">;</span>&nbsp;<span class="op" id="7508583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7508588">n</span><span class="op" id="7508589">,</span>&nbsp;<span class="ident" id="7508591">err</span>&nbsp;<span class="op" id="7508595">:=</span>&nbsp;<span class="ident" id="7508598">decoder</span><span class="op" id="7508605">.</span><span class="ident" id="7508606">Read</span><span class="op" id="7508610">(</span><span class="ident" id="7508611">buf</span><span class="op" id="7508614">[</span><span class="ident" id="7508615">total</span>&nbsp;<span class="op" id="7508621">:</span>&nbsp;<span class="ident" id="7508623">total</span><span class="op" id="7508628">+</span><span class="ident" id="7508629">bs</span><span class="op" id="7508631">]</span><span class="op" id="7508632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7508637">testEqual</span><span class="op" id="7508646">(</span><span class="ident" id="7508647">t</span><span class="op" id="7508648">,</span>&nbsp;<span class="string" id="7508650">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="7508695">,</span>&nbsp;<span class="ident" id="7508697">bigtest</span><span class="op" id="7508704">.</span><span class="ident" id="7508705">encoded</span><span class="op" id="7508712">,</span>&nbsp;<span class="ident" id="7508714">total</span><span class="op" id="7508719">,</span>&nbsp;<span class="ident" id="7508721">n</span><span class="op" id="7508722">,</span>&nbsp;<span class="ident" id="7508724">err</span><span class="op" id="7508727">,</span>&nbsp;<span class="builtintype" id="7508729">error</span><span class="op" id="7508734">(</span><span class="ident" id="7508735">nil</span><span class="op" id="7508738">)</span><span class="op" id="7508739">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7508744">total</span>&nbsp;<span class="op" id="7508750">+=</span>&nbsp;<span class="ident" id="7508753">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7508757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7508761">testEqual</span><span class="op" id="7508770">(</span><span class="ident" id="7508771">t</span><span class="op" id="7508772">,</span>&nbsp;<span class="string" id="7508774">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7508807">,</span>&nbsp;<span class="ident" id="7508809">bs</span><span class="op" id="7508811">,</span>&nbsp;<span class="ident" id="7508813">bigtest</span><span class="op" id="7508820">.</span><span class="ident" id="7508821">encoded</span><span class="op" id="7508828">,</span>&nbsp;<span class="builtintype" id="7508830">string</span><span class="op" id="7508836">(</span><span class="ident" id="7508837">buf</span><span class="op" id="7508840">[</span><span class="num" id="7508841">0</span><span class="op" id="7508842">:</span><span class="ident" id="7508843">total</span><span class="op" id="7508848">]</span><span class="op" id="7508849">)</span><span class="op" id="7508850">,</span>&nbsp;<span class="ident" id="7508852">bigtest</span><span class="op" id="7508859">.</span><span class="ident" id="7508860">decoded</span><span class="op" id="7508867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7508870">}</span><br>
<span class="lineno"></span><span class="op" id="7508872">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="7508875">func</span>&nbsp;<span class="ident" id="7508880">TestDecodeCorrupt</span><span class="op" id="7508897">(</span><span class="ident" id="7508898">t</span>&nbsp;<span class="op" id="7508900">*</span><span class="ident" id="7508901">testing</span><span class="op" id="7508908">.</span><span class="ident" id="7508909">T</span><span class="op" id="7508910">)</span>&nbsp;<span class="op" id="7508912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7508915">testCases</span>&nbsp;<span class="op" id="7508925">:=</span>&nbsp;<span class="op" id="7508928">[</span><span class="op" id="7508929">]</span><span class="keyword" id="7508930">struct</span>&nbsp;<span class="op" id="7508937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7508941">input</span>&nbsp;&nbsp;<span class="builtintype" id="7508948">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7508957">offset</span>&nbsp;<span class="builtintype" id="7508964">int</span>&nbsp;<span class="comment" id="7508968">//&nbsp;-1&nbsp;means&nbsp;no&nbsp;corruption.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7508996">}</span><span class="op" id="7508997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509001">{</span><span class="string" id="7509002">&#34;&#34;</span><span class="op" id="7509004">,</span>&nbsp;<span class="op" id="7509006">-</span><span class="num" id="7509007">1</span><span class="op" id="7509008">}</span><span class="op" id="7509009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509013">{</span><span class="string" id="7509014">&#34;!!!!&#34;</span><span class="op" id="7509020">,</span>&nbsp;<span class="num" id="7509022">0</span><span class="op" id="7509023">}</span><span class="op" id="7509024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509028">{</span><span class="string" id="7509029">&#34;====&#34;</span><span class="op" id="7509035">,</span>&nbsp;<span class="num" id="7509037">0</span><span class="op" id="7509038">}</span><span class="op" id="7509039">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509043">{</span><span class="string" id="7509044">&#34;x===&#34;</span><span class="op" id="7509050">,</span>&nbsp;<span class="num" id="7509052">1</span><span class="op" id="7509053">}</span><span class="op" id="7509054">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509058">{</span><span class="string" id="7509059">&#34;=AAA&#34;</span><span class="op" id="7509065">,</span>&nbsp;<span class="num" id="7509067">0</span><span class="op" id="7509068">}</span><span class="op" id="7509069">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509073">{</span><span class="string" id="7509074">&#34;A=AA&#34;</span><span class="op" id="7509080">,</span>&nbsp;<span class="num" id="7509082">1</span><span class="op" id="7509083">}</span><span class="op" id="7509084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509088">{</span><span class="string" id="7509089">&#34;AA=A&#34;</span><span class="op" id="7509095">,</span>&nbsp;<span class="num" id="7509097">2</span><span class="op" id="7509098">}</span><span class="op" id="7509099">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509103">{</span><span class="string" id="7509104">&#34;AA==A&#34;</span><span class="op" id="7509111">,</span>&nbsp;<span class="num" id="7509113">4</span><span class="op" id="7509114">}</span><span class="op" id="7509115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509119">{</span><span class="string" id="7509120">&#34;AAA=AAAA&#34;</span><span class="op" id="7509130">,</span>&nbsp;<span class="num" id="7509132">4</span><span class="op" id="7509133">}</span><span class="op" id="7509134">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509138">{</span><span class="string" id="7509139">&#34;AAAAA&#34;</span><span class="op" id="7509146">,</span>&nbsp;<span class="num" id="7509148">4</span><span class="op" id="7509149">}</span><span class="op" id="7509150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509154">{</span><span class="string" id="7509155">&#34;AAAAAA&#34;</span><span class="op" id="7509163">,</span>&nbsp;<span class="num" id="7509165">4</span><span class="op" id="7509166">}</span><span class="op" id="7509167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509171">{</span><span class="string" id="7509172">&#34;A=&#34;</span><span class="op" id="7509176">,</span>&nbsp;<span class="num" id="7509178">1</span><span class="op" id="7509179">}</span><span class="op" id="7509180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509184">{</span><span class="string" id="7509185">&#34;A==&#34;</span><span class="op" id="7509190">,</span>&nbsp;<span class="num" id="7509192">1</span><span class="op" id="7509193">}</span><span class="op" id="7509194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509198">{</span><span class="string" id="7509199">&#34;AA=&#34;</span><span class="op" id="7509204">,</span>&nbsp;<span class="num" id="7509206">3</span><span class="op" id="7509207">}</span><span class="op" id="7509208">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509212">{</span><span class="string" id="7509213">&#34;AA==&#34;</span><span class="op" id="7509219">,</span>&nbsp;<span class="op" id="7509221">-</span><span class="num" id="7509222">1</span><span class="op" id="7509223">}</span><span class="op" id="7509224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509228">{</span><span class="string" id="7509229">&#34;AAA=&#34;</span><span class="op" id="7509235">,</span>&nbsp;<span class="op" id="7509237">-</span><span class="num" id="7509238">1</span><span class="op" id="7509239">}</span><span class="op" id="7509240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509244">{</span><span class="string" id="7509245">&#34;AAAA&#34;</span><span class="op" id="7509251">,</span>&nbsp;<span class="op" id="7509253">-</span><span class="num" id="7509254">1</span><span class="op" id="7509255">}</span><span class="op" id="7509256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509260">{</span><span class="string" id="7509261">&#34;AAAAAA=&#34;</span><span class="op" id="7509270">,</span>&nbsp;<span class="num" id="7509272">7</span><span class="op" id="7509273">}</span><span class="op" id="7509274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509278">{</span><span class="string" id="7509279">&#34;YWJjZA=====&#34;</span><span class="op" id="7509292">,</span>&nbsp;<span class="num" id="7509294">8</span><span class="op" id="7509295">}</span><span class="op" id="7509296">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7509302">for</span>&nbsp;<span class="ident" id="7509306">_</span><span class="op" id="7509307">,</span>&nbsp;<span class="ident" id="7509309">tc</span>&nbsp;<span class="op" id="7509312">:=</span>&nbsp;<span class="keyword" id="7509315">range</span>&nbsp;<span class="ident" id="7509321">testCases</span>&nbsp;<span class="op" id="7509331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7509335">dbuf</span>&nbsp;<span class="op" id="7509340">:=</span>&nbsp;<span class="builtinfunc" id="7509343">make</span><span class="op" id="7509347">(</span><span class="op" id="7509348">[</span><span class="op" id="7509349">]</span><span class="builtintype" id="7509350">byte</span><span class="op" id="7509354">,</span>&nbsp;<span class="ident" id="7509356">StdEncoding</span><span class="op" id="7509367">.</span><span class="ident" id="7509368">DecodedLen</span><span class="op" id="7509378">(</span><span class="builtinfunc" id="7509379">len</span><span class="op" id="7509382">(</span><span class="ident" id="7509383">tc</span><span class="op" id="7509385">.</span><span class="ident" id="7509386">input</span><span class="op" id="7509391">)</span><span class="op" id="7509392">)</span><span class="op" id="7509393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7509397">_</span><span class="op" id="7509398">,</span>&nbsp;<span class="ident" id="7509400">err</span>&nbsp;<span class="op" id="7509404">:=</span>&nbsp;<span class="ident" id="7509407">StdEncoding</span><span class="op" id="7509418">.</span><span class="ident" id="7509419">Decode</span><span class="op" id="7509425">(</span><span class="ident" id="7509426">dbuf</span><span class="op" id="7509430">,</span>&nbsp;<span class="op" id="7509432">[</span><span class="op" id="7509433">]</span><span class="builtintype" id="7509434">byte</span><span class="op" id="7509438">(</span><span class="ident" id="7509439">tc</span><span class="op" id="7509441">.</span><span class="ident" id="7509442">input</span><span class="op" id="7509447">)</span><span class="op" id="7509448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7509452">if</span>&nbsp;<span class="ident" id="7509455">tc</span><span class="op" id="7509457">.</span><span class="ident" id="7509458">offset</span>&nbsp;<span class="op" id="7509465">==</span>&nbsp;<span class="op" id="7509468">-</span><span class="num" id="7509469">1</span>&nbsp;<span class="op" id="7509471">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7509476">if</span>&nbsp;<span class="ident" id="7509479">err</span>&nbsp;<span class="op" id="7509483">!=</span>&nbsp;<span class="ident" id="7509486">nil</span>&nbsp;<span class="op" id="7509490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7509496">t</span><span class="op" id="7509497">.</span><span class="ident" id="7509498">Error</span><span class="op" id="7509503">(</span><span class="string" id="7509504">&#34;Decoder&nbsp;wrongly&nbsp;detected&nbsp;coruption&nbsp;in&#34;</span><span class="op" id="7509543">,</span>&nbsp;<span class="ident" id="7509545">tc</span><span class="op" id="7509547">.</span><span class="ident" id="7509548">input</span><span class="op" id="7509553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7509563">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509574">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7509578">switch</span>&nbsp;<span class="ident" id="7509585">err</span>&nbsp;<span class="op" id="7509589">:=</span>&nbsp;<span class="ident" id="7509592">err</span><span class="op" id="7509595">.</span><span class="op" id="7509596">(</span><span class="keyword" id="7509597">type</span><span class="op" id="7509601">)</span>&nbsp;<span class="op" id="7509603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7509607">case</span>&nbsp;<span class="ident" id="7509612">CorruptInputError</span><span class="op" id="7509629">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7509634">testEqual</span><span class="op" id="7509643">(</span><span class="ident" id="7509644">t</span><span class="op" id="7509645">,</span>&nbsp;<span class="string" id="7509647">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7509687">,</span>&nbsp;<span class="ident" id="7509689">tc</span><span class="op" id="7509691">.</span><span class="ident" id="7509692">input</span><span class="op" id="7509697">,</span>&nbsp;<span class="builtintype" id="7509699">int</span><span class="op" id="7509702">(</span><span class="ident" id="7509703">err</span><span class="op" id="7509706">)</span><span class="op" id="7509707">,</span>&nbsp;<span class="ident" id="7509709">tc</span><span class="op" id="7509711">.</span><span class="ident" id="7509712">offset</span><span class="op" id="7509718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7509722">default</span><span class="op" id="7509729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7509734">t</span><span class="op" id="7509735">.</span><span class="ident" id="7509736">Error</span><span class="op" id="7509741">(</span><span class="string" id="7509742">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="7509782">,</span>&nbsp;<span class="ident" id="7509784">tc</span><span class="op" id="7509786">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7509793">}</span><br>
<span class="lineno"></span><span class="op" id="7509795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7509798">func</span>&nbsp;<span class="ident" id="7509803">TestBig</span><span class="op" id="7509810">(</span><span class="ident" id="7509811">t</span>&nbsp;<span class="op" id="7509813">*</span><span class="ident" id="7509814">testing</span><span class="op" id="7509821">.</span><span class="ident" id="7509822">T</span><span class="op" id="7509823">)</span>&nbsp;<span class="op" id="7509825">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7509828">n</span>&nbsp;<span class="op" id="7509830">:=</span>&nbsp;<span class="num" id="7509833">3</span><span class="op" id="7509834">*</span><span class="num" id="7509835">1000</span>&nbsp;<span class="op" id="7509840">+</span>&nbsp;<span class="num" id="7509842">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7509845">raw</span>&nbsp;<span class="op" id="7509849">:=</span>&nbsp;<span class="builtinfunc" id="7509852">make</span><span class="op" id="7509856">(</span><span class="op" id="7509857">[</span><span class="op" id="7509858">]</span><span class="builtintype" id="7509859">byte</span><span class="op" id="7509863">,</span>&nbsp;<span class="ident" id="7509865">n</span><span class="op" id="7509866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7509869">const</span>&nbsp;<span class="ident" id="7509875">alpha</span>&nbsp;<span class="op" id="7509881">=</span>&nbsp;<span class="string" id="7509883">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7509949">for</span>&nbsp;<span class="ident" id="7509953">i</span>&nbsp;<span class="op" id="7509955">:=</span>&nbsp;<span class="num" id="7509958">0</span><span class="op" id="7509959">;</span>&nbsp;<span class="ident" id="7509961">i</span>&nbsp;<span class="op" id="7509963">&lt;</span>&nbsp;<span class="ident" id="7509965">n</span><span class="op" id="7509966">;</span>&nbsp;<span class="ident" id="7509968">i</span><span class="op" id="7509969">++</span>&nbsp;<span class="op" id="7509972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7509976">raw</span><span class="op" id="7509979">[</span><span class="ident" id="7509980">i</span><span class="op" id="7509981">]</span>&nbsp;<span class="op" id="7509983">=</span>&nbsp;<span class="ident" id="7509985">alpha</span><span class="op" id="7509990">[</span><span class="ident" id="7509991">i</span><span class="op" id="7509992">%</span><span class="builtinfunc" id="7509993">len</span><span class="op" id="7509996">(</span><span class="ident" id="7509997">alpha</span><span class="op" id="7510002">)</span><span class="op" id="7510003">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7510006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7510009">encoded</span>&nbsp;<span class="op" id="7510017">:=</span>&nbsp;<span class="builtinfunc" id="7510020">new</span><span class="op" id="7510023">(</span><span class="ident" id="7510024">bytes</span><span class="op" id="7510029">.</span><span class="ident" id="7510030">Buffer</span><span class="op" id="7510036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7510039">w</span>&nbsp;<span class="op" id="7510041">:=</span>&nbsp;<span class="ident" id="7510044">NewEncoder</span><span class="op" id="7510054">(</span><span class="ident" id="7510055">StdEncoding</span><span class="op" id="7510066">,</span>&nbsp;<span class="ident" id="7510068">encoded</span><span class="op" id="7510075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7510078">nn</span><span class="op" id="7510080">,</span>&nbsp;<span class="ident" id="7510082">err</span>&nbsp;<span class="op" id="7510086">:=</span>&nbsp;<span class="ident" id="7510089">w</span><span class="op" id="7510090">.</span><span class="ident" id="7510091">Write</span><span class="op" id="7510096">(</span><span class="ident" id="7510097">raw</span><span class="op" id="7510100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7510103">if</span>&nbsp;<span class="ident" id="7510106">nn</span>&nbsp;<span class="op" id="7510109">!=</span>&nbsp;<span class="ident" id="7510112">n</span>&nbsp;<span class="op" id="7510114">||</span>&nbsp;<span class="ident" id="7510117">err</span>&nbsp;<span class="op" id="7510121">!=</span>&nbsp;<span class="ident" id="7510124">nil</span>&nbsp;<span class="op" id="7510128">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7510132">t</span><span class="op" id="7510133">.</span><span class="ident" id="7510134">Fatalf</span><span class="op" id="7510140">(</span><span class="string" id="7510141">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7510183">,</span>&nbsp;<span class="ident" id="7510185">nn</span><span class="op" id="7510187">,</span>&nbsp;<span class="ident" id="7510189">err</span><span class="op" id="7510192">,</span>&nbsp;<span class="ident" id="7510194">n</span><span class="op" id="7510195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7510198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7510201">err</span>&nbsp;<span class="op" id="7510205">=</span>&nbsp;<span class="ident" id="7510207">w</span><span class="op" id="7510208">.</span><span class="ident" id="7510209">Close</span><span class="op" id="7510214">(</span><span class="op" id="7510215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7510218">if</span>&nbsp;<span class="ident" id="7510221">err</span>&nbsp;<span class="op" id="7510225">!=</span>&nbsp;<span class="ident" id="7510228">nil</span>&nbsp;<span class="op" id="7510232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7510236">t</span><span class="op" id="7510237">.</span><span class="ident" id="7510238">Fatalf</span><span class="op" id="7510244">(</span><span class="string" id="7510245">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7510276">,</span>&nbsp;<span class="ident" id="7510278">err</span><span class="op" id="7510281">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7510284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7510287">decoded</span><span class="op" id="7510294">,</span>&nbsp;<span class="ident" id="7510296">err</span>&nbsp;<span class="op" id="7510300">:=</span>&nbsp;<span class="ident" id="7510303">ioutil</span><span class="op" id="7510309">.</span><span class="ident" id="7510310">ReadAll</span><span class="op" id="7510317">(</span><span class="ident" id="7510318">NewDecoder</span><span class="op" id="7510328">(</span><span class="ident" id="7510329">StdEncoding</span><span class="op" id="7510340">,</span>&nbsp;<span class="ident" id="7510342">encoded</span><span class="op" id="7510349">)</span><span class="op" id="7510350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7510353">if</span>&nbsp;<span class="ident" id="7510356">err</span>&nbsp;<span class="op" id="7510360">!=</span>&nbsp;<span class="ident" id="7510363">nil</span>&nbsp;<span class="op" id="7510367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7510371">t</span><span class="op" id="7510372">.</span><span class="ident" id="7510373">Fatalf</span><span class="op" id="7510379">(</span><span class="string" id="7510380">&#34;ioutil.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="7510417">,</span>&nbsp;<span class="ident" id="7510419">err</span><span class="op" id="7510422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7510425">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7510429">if</span>&nbsp;<span class="op" id="7510432">!</span><span class="ident" id="7510433">bytes</span><span class="op" id="7510438">.</span><span class="ident" id="7510439">Equal</span><span class="op" id="7510444">(</span><span class="ident" id="7510445">raw</span><span class="op" id="7510448">,</span>&nbsp;<span class="ident" id="7510450">decoded</span><span class="op" id="7510457">)</span>&nbsp;<span class="op" id="7510459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7510463">var</span>&nbsp;<span class="ident" id="7510467">i</span>&nbsp;<span class="builtintype" id="7510469">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7510475">for</span>&nbsp;<span class="ident" id="7510479">i</span>&nbsp;<span class="op" id="7510481">=</span>&nbsp;<span class="num" id="7510483">0</span><span class="op" id="7510484">;</span>&nbsp;<span class="ident" id="7510486">i</span>&nbsp;<span class="op" id="7510488">&lt;</span>&nbsp;<span class="builtinfunc" id="7510490">len</span><span class="op" id="7510493">(</span><span class="ident" id="7510494">decoded</span><span class="op" id="7510501">)</span>&nbsp;<span class="op" id="7510503">&amp;&amp;</span>&nbsp;<span class="ident" id="7510506">i</span>&nbsp;<span class="op" id="7510508">&lt;</span>&nbsp;<span class="builtinfunc" id="7510510">len</span><span class="op" id="7510513">(</span><span class="ident" id="7510514">raw</span><span class="op" id="7510517">)</span><span class="op" id="7510518">;</span>&nbsp;<span class="ident" id="7510520">i</span><span class="op" id="7510521">++</span>&nbsp;<span class="op" id="7510524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7510529">if</span>&nbsp;<span class="ident" id="7510532">decoded</span><span class="op" id="7510539">[</span><span class="ident" id="7510540">i</span><span class="op" id="7510541">]</span>&nbsp;<span class="op" id="7510543">!=</span>&nbsp;<span class="ident" id="7510546">raw</span><span class="op" id="7510549">[</span><span class="ident" id="7510550">i</span><span class="op" id="7510551">]</span>&nbsp;<span class="op" id="7510553">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7510559">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7510568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7510572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7510576">t</span><span class="op" id="7510577">.</span><span class="ident" id="7510578">Errorf</span><span class="op" id="7510584">(</span><span class="string" id="7510585">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="7510637">,</span>&nbsp;<span class="ident" id="7510639">n</span><span class="op" id="7510640">,</span>&nbsp;<span class="ident" id="7510642">i</span><span class="op" id="7510643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7510646">}</span><br>
<span class="lineno">220</span><span class="op" id="7510648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7510651">func</span>&nbsp;<span class="ident" id="7510656">TestNewLineCharacters</span><span class="op" id="7510677">(</span><span class="ident" id="7510678">t</span>&nbsp;<span class="op" id="7510680">*</span><span class="ident" id="7510681">testing</span><span class="op" id="7510688">.</span><span class="ident" id="7510689">T</span><span class="op" id="7510690">)</span>&nbsp;<span class="op" id="7510692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7510695">//&nbsp;Each&nbsp;of&nbsp;these&nbsp;should&nbsp;decode&nbsp;to&nbsp;the&nbsp;string&nbsp;&#34;sure&#34;,&nbsp;without&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7510765">const</span>&nbsp;<span class="ident" id="7510771">expected</span>&nbsp;<span class="op" id="7510780">=</span>&nbsp;<span class="string" id="7510782">&#34;sure&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7510790">examples</span>&nbsp;<span class="op" id="7510799">:=</span>&nbsp;<span class="op" id="7510802">[</span><span class="op" id="7510803">]</span><span class="builtintype" id="7510804">string</span><span class="op" id="7510810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7510814">&#34;c3VyZQ==&#34;</span><span class="op" id="7510824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7510828">&#34;c3VyZQ==\r&#34;</span><span class="op" id="7510840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7510844">&#34;c3VyZQ==\n&#34;</span><span class="op" id="7510856">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7510860">&#34;c3VyZQ==\r\n&#34;</span><span class="op" id="7510874">,</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7510878">&#34;c3VyZ\r\nQ==&#34;</span><span class="op" id="7510892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7510896">&#34;c3V\ryZ\nQ==&#34;</span><span class="op" id="7510910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7510914">&#34;c3V\nyZ\rQ==&#34;</span><span class="op" id="7510928">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7510932">&#34;c3VyZ\nQ==&#34;</span><span class="op" id="7510944">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7510948">&#34;c3VyZQ\n==&#34;</span><span class="op" id="7510960">,</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7510964">&#34;c3VyZQ=\n=&#34;</span><span class="op" id="7510976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7510980">&#34;c3VyZQ=\r\n\r\n=&#34;</span><span class="op" id="7510998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7511001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511004">for</span>&nbsp;<span class="ident" id="7511008">_</span><span class="op" id="7511009">,</span>&nbsp;<span class="ident" id="7511011">e</span>&nbsp;<span class="op" id="7511013">:=</span>&nbsp;<span class="keyword" id="7511016">range</span>&nbsp;<span class="ident" id="7511022">examples</span>&nbsp;<span class="op" id="7511031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511035">buf</span><span class="op" id="7511038">,</span>&nbsp;<span class="ident" id="7511040">err</span>&nbsp;<span class="op" id="7511044">:=</span>&nbsp;<span class="ident" id="7511047">StdEncoding</span><span class="op" id="7511058">.</span><span class="ident" id="7511059">DecodeString</span><span class="op" id="7511071">(</span><span class="ident" id="7511072">e</span><span class="op" id="7511073">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511077">if</span>&nbsp;<span class="ident" id="7511080">err</span>&nbsp;<span class="op" id="7511084">!=</span>&nbsp;<span class="ident" id="7511087">nil</span>&nbsp;<span class="op" id="7511091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511096">t</span><span class="op" id="7511097">.</span><span class="ident" id="7511098">Errorf</span><span class="op" id="7511104">(</span><span class="string" id="7511105">&#34;Decode(%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7511128">,</span>&nbsp;<span class="ident" id="7511130">e</span><span class="op" id="7511131">,</span>&nbsp;<span class="ident" id="7511133">err</span><span class="op" id="7511136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511141">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7511152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511156">if</span>&nbsp;<span class="ident" id="7511159">s</span>&nbsp;<span class="op" id="7511161">:=</span>&nbsp;<span class="builtintype" id="7511164">string</span><span class="op" id="7511170">(</span><span class="ident" id="7511171">buf</span><span class="op" id="7511174">)</span><span class="op" id="7511175">;</span>&nbsp;<span class="ident" id="7511177">s</span>&nbsp;<span class="op" id="7511179">!=</span>&nbsp;<span class="ident" id="7511182">expected</span>&nbsp;<span class="op" id="7511191">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511196">t</span><span class="op" id="7511197">.</span><span class="ident" id="7511198">Errorf</span><span class="op" id="7511204">(</span><span class="string" id="7511205">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7511231">,</span>&nbsp;<span class="ident" id="7511233">e</span><span class="op" id="7511234">,</span>&nbsp;<span class="ident" id="7511236">s</span><span class="op" id="7511237">,</span>&nbsp;<span class="ident" id="7511239">expected</span><span class="op" id="7511247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7511251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7511254">}</span><br>
<span class="lineno"></span><span class="op" id="7511256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="7511259">type</span>&nbsp;<span class="ident" id="7511264">nextRead</span>&nbsp;<span class="keyword" id="7511273">struct</span>&nbsp;<span class="op" id="7511280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511283">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7511287">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7511293">//&nbsp;bytes&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511313">err</span>&nbsp;<span class="builtintype" id="7511317">error</span>&nbsp;<span class="comment" id="7511323">//&nbsp;error&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="op" id="7511342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="7511345">//&nbsp;faultInjectReader&nbsp;returns&nbsp;data&nbsp;from&nbsp;source,&nbsp;rate-limited</span><br>
<span class="lineno"></span><span class="comment" id="7511405">//&nbsp;and&nbsp;with&nbsp;the&nbsp;errors&nbsp;as&nbsp;written&nbsp;to&nbsp;nextc.</span><br>
<span class="lineno"></span><span class="keyword" id="7511449">type</span>&nbsp;<span class="ident" id="7511454">faultInjectReader</span>&nbsp;<span class="keyword" id="7511472">struct</span>&nbsp;<span class="op" id="7511479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511482">source</span>&nbsp;<span class="builtintype" id="7511489">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511497">nextc</span>&nbsp;&nbsp;<span class="op" id="7511504">&lt;-</span><span class="keyword" id="7511506">chan</span>&nbsp;<span class="ident" id="7511511">nextRead</span><br>
<span class="lineno">260</span><span class="op" id="7511520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7511523">func</span>&nbsp;<span class="op" id="7511528">(</span><span class="ident" id="7511529">r</span>&nbsp;<span class="op" id="7511531">*</span><span class="ident" id="7511532">faultInjectReader</span><span class="op" id="7511549">)</span>&nbsp;<span class="ident" id="7511551">Read</span><span class="op" id="7511555">(</span><span class="ident" id="7511556">p</span>&nbsp;<span class="op" id="7511558">[</span><span class="op" id="7511559">]</span><span class="builtintype" id="7511560">byte</span><span class="op" id="7511564">)</span>&nbsp;<span class="op" id="7511566">(</span><span class="builtintype" id="7511567">int</span><span class="op" id="7511570">,</span>&nbsp;<span class="builtintype" id="7511572">error</span><span class="op" id="7511577">)</span>&nbsp;<span class="op" id="7511579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511582">nr</span>&nbsp;<span class="op" id="7511585">:=</span>&nbsp;<span class="op" id="7511588">&lt;-</span><span class="ident" id="7511590">r</span><span class="op" id="7511591">.</span><span class="ident" id="7511592">nextc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511599">if</span>&nbsp;<span class="builtinfunc" id="7511602">len</span><span class="op" id="7511605">(</span><span class="ident" id="7511606">p</span><span class="op" id="7511607">)</span>&nbsp;<span class="op" id="7511609">&gt;</span>&nbsp;<span class="ident" id="7511611">nr</span><span class="op" id="7511613">.</span><span class="ident" id="7511614">n</span>&nbsp;<span class="op" id="7511616">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511620">p</span>&nbsp;<span class="op" id="7511622">=</span>&nbsp;<span class="ident" id="7511624">p</span><span class="op" id="7511625">[</span><span class="op" id="7511626">:</span><span class="ident" id="7511627">nr</span><span class="op" id="7511629">.</span><span class="ident" id="7511630">n</span><span class="op" id="7511631">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7511634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511637">n</span>&nbsp;<span class="op" id="7511639">:=</span>&nbsp;<span class="builtinfunc" id="7511642">copy</span><span class="op" id="7511646">(</span><span class="ident" id="7511647">p</span><span class="op" id="7511648">,</span>&nbsp;<span class="ident" id="7511650">r</span><span class="op" id="7511651">.</span><span class="ident" id="7511652">source</span><span class="op" id="7511658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511661">r</span><span class="op" id="7511662">.</span><span class="ident" id="7511663">source</span>&nbsp;<span class="op" id="7511670">=</span>&nbsp;<span class="ident" id="7511672">r</span><span class="op" id="7511673">.</span><span class="ident" id="7511674">source</span><span class="op" id="7511680">[</span><span class="ident" id="7511681">n</span><span class="op" id="7511682">:</span><span class="op" id="7511683">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511686">return</span>&nbsp;<span class="ident" id="7511693">n</span><span class="op" id="7511694">,</span>&nbsp;<span class="ident" id="7511696">nr</span><span class="op" id="7511698">.</span><span class="ident" id="7511699">err</span><br>
<span class="lineno">270</span><span class="op" id="7511703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7511706">//&nbsp;tests&nbsp;that&nbsp;we&nbsp;don&#39;t&nbsp;ignore&nbsp;errors&nbsp;from&nbsp;our&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span><span class="keyword" id="7511770">func</span>&nbsp;<span class="ident" id="7511775">TestDecoderIssue3577</span><span class="op" id="7511795">(</span><span class="ident" id="7511796">t</span>&nbsp;<span class="op" id="7511798">*</span><span class="ident" id="7511799">testing</span><span class="op" id="7511806">.</span><span class="ident" id="7511807">T</span><span class="op" id="7511808">)</span>&nbsp;<span class="op" id="7511810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511813">next</span>&nbsp;<span class="op" id="7511818">:=</span>&nbsp;<span class="builtinfunc" id="7511821">make</span><span class="op" id="7511825">(</span><span class="keyword" id="7511826">chan</span>&nbsp;<span class="ident" id="7511831">nextRead</span><span class="op" id="7511839">,</span>&nbsp;<span class="num" id="7511841">10</span><span class="op" id="7511843">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511846">wantErr</span>&nbsp;<span class="op" id="7511854">:=</span>&nbsp;<span class="ident" id="7511857">errors</span><span class="op" id="7511863">.</span><span class="ident" id="7511864">New</span><span class="op" id="7511867">(</span><span class="string" id="7511868">&#34;my&nbsp;error&#34;</span><span class="op" id="7511878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511881">next</span>&nbsp;<span class="op" id="7511886">&lt;-</span>&nbsp;<span class="ident" id="7511889">nextRead</span><span class="op" id="7511897">{</span><span class="num" id="7511898">5</span><span class="op" id="7511899">,</span>&nbsp;<span class="ident" id="7511901">nil</span><span class="op" id="7511904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511907">next</span>&nbsp;<span class="op" id="7511912">&lt;-</span>&nbsp;<span class="ident" id="7511915">nextRead</span><span class="op" id="7511923">{</span><span class="num" id="7511924">10</span><span class="op" id="7511926">,</span>&nbsp;<span class="ident" id="7511928">wantErr</span><span class="op" id="7511935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511938">next</span>&nbsp;<span class="op" id="7511943">&lt;-</span>&nbsp;<span class="ident" id="7511946">nextRead</span><span class="op" id="7511954">{</span><span class="num" id="7511955">0</span><span class="op" id="7511956">,</span>&nbsp;<span class="ident" id="7511958">wantErr</span><span class="op" id="7511965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7511968">d</span>&nbsp;<span class="op" id="7511970">:=</span>&nbsp;<span class="ident" id="7511973">NewDecoder</span><span class="op" id="7511983">(</span><span class="ident" id="7511984">StdEncoding</span><span class="op" id="7511995">,</span>&nbsp;<span class="op" id="7511997">&amp;</span><span class="ident" id="7511998">faultInjectReader</span><span class="op" id="7512015">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512019">source</span><span class="op" id="7512025">:</span>&nbsp;<span class="string" id="7512027">&#34;VHdhcyBicmlsbGlnLCBhbmQgdGhlIHNsaXRoeSB0b3Zlcw==&#34;</span><span class="op" id="7512077">,</span>&nbsp;<span class="comment" id="7512079">//&nbsp;twas&nbsp;brillig...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512100">nextc</span><span class="op" id="7512105">:</span>&nbsp;&nbsp;<span class="ident" id="7512108">next</span><span class="op" id="7512112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512115">}</span><span class="op" id="7512116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512119">errc</span>&nbsp;<span class="op" id="7512124">:=</span>&nbsp;<span class="builtinfunc" id="7512127">make</span><span class="op" id="7512131">(</span><span class="keyword" id="7512132">chan</span>&nbsp;<span class="builtintype" id="7512137">error</span><span class="op" id="7512142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512145">go</span>&nbsp;<span class="keyword" id="7512148">func</span><span class="op" id="7512152">(</span><span class="op" id="7512153">)</span>&nbsp;<span class="op" id="7512155">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512159">_</span><span class="op" id="7512160">,</span>&nbsp;<span class="ident" id="7512162">err</span>&nbsp;<span class="op" id="7512166">:=</span>&nbsp;<span class="ident" id="7512169">ioutil</span><span class="op" id="7512175">.</span><span class="ident" id="7512176">ReadAll</span><span class="op" id="7512183">(</span><span class="ident" id="7512184">d</span><span class="op" id="7512185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512189">errc</span>&nbsp;<span class="op" id="7512194">&lt;-</span>&nbsp;<span class="ident" id="7512197">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512202">}</span><span class="op" id="7512203">(</span><span class="op" id="7512204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512207">select</span>&nbsp;<span class="op" id="7512214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512217">case</span>&nbsp;<span class="ident" id="7512222">err</span>&nbsp;<span class="op" id="7512226">:=</span>&nbsp;<span class="op" id="7512229">&lt;-</span><span class="ident" id="7512231">errc</span><span class="op" id="7512235">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512239">if</span>&nbsp;<span class="ident" id="7512242">err</span>&nbsp;<span class="op" id="7512246">!=</span>&nbsp;<span class="ident" id="7512249">wantErr</span>&nbsp;<span class="op" id="7512257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512262">t</span><span class="op" id="7512263">.</span><span class="ident" id="7512264">Errorf</span><span class="op" id="7512270">(</span><span class="string" id="7512271">&#34;got&nbsp;error&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7512294">,</span>&nbsp;<span class="ident" id="7512296">err</span><span class="op" id="7512299">,</span>&nbsp;<span class="ident" id="7512301">wantErr</span><span class="op" id="7512308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512315">case</span>&nbsp;<span class="op" id="7512320">&lt;-</span><span class="ident" id="7512322">time</span><span class="op" id="7512326">.</span><span class="ident" id="7512327">After</span><span class="op" id="7512332">(</span><span class="num" id="7512333">5</span>&nbsp;<span class="op" id="7512335">*</span>&nbsp;<span class="ident" id="7512337">time</span><span class="op" id="7512341">.</span><span class="ident" id="7512342">Second</span><span class="op" id="7512348">)</span><span class="op" id="7512349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512353">t</span><span class="op" id="7512354">.</span><span class="ident" id="7512355">Errorf</span><span class="op" id="7512361">(</span><span class="string" id="7512362">&#34;timeout;&nbsp;Decoder&nbsp;blocked&nbsp;without&nbsp;returning&nbsp;an&nbsp;error&#34;</span><span class="op" id="7512415">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512418">}</span><br>
<span class="lineno"></span><span class="op" id="7512420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7512423">func</span>&nbsp;<span class="ident" id="7512428">TestDecoderIssue4779</span><span class="op" id="7512448">(</span><span class="ident" id="7512449">t</span>&nbsp;<span class="op" id="7512451">*</span><span class="ident" id="7512452">testing</span><span class="op" id="7512459">.</span><span class="ident" id="7512460">T</span><span class="op" id="7512461">)</span>&nbsp;<span class="op" id="7512463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512466">encoded</span>&nbsp;<span class="op" id="7512474">:=</span>&nbsp;<span class="string" id="7512477">`CP/EAT8AAAEF<br>
<span class="lineno">300</span>AQEBAQEBAAAAAAAAAAMAAQIEBQYHCAkKCwEAAQUBAQEBAQEAAAAAAAAAAQACAwQFBgcICQoLEAAB<br>
<span class="lineno"></span>BAEDAgQCBQcGCAUDDDMBAAIRAwQhEjEFQVFhEyJxgTIGFJGhsUIjJBVSwWIzNHKC0UMHJZJT8OHx<br>
<span class="lineno"></span>Y3M1FqKygyZEk1RkRcKjdDYX0lXiZfKzhMPTdePzRieUpIW0lcTU5PSltcXV5fVWZnaGlqa2xtbm<br>
<span class="lineno"></span>9jdHV2d3h5ent8fX5/cRAAICAQIEBAMEBQYHBwYFNQEAAhEDITESBEFRYXEiEwUygZEUobFCI8FS<br>
<span class="lineno"></span>0fAzJGLhcoKSQ1MVY3M08SUGFqKygwcmNcLSRJNUoxdkRVU2dGXi8rOEw9N14/NGlKSFtJXE1OT0<br>
<span class="lineno">305</span>pbXF1eX1VmZ2hpamtsbW5vYnN0dXZ3eHl6e3x//aAAwDAQACEQMRAD8A9VSSSSUpJJJJSkkkJ+Tj<br>
<span class="lineno"></span>1kiy1jCJJDnAcCTykpKkuQ6p/jN6FgmxlNduXawwAzaGH+V6jn/R/wCt71zdn+N/qL3kVYFNYB4N<br>
<span class="lineno"></span>ji6PDVjWpKp9TSXnvTf8bFNjg3qOEa2n6VlLpj/rT/pf567DpX1i6L1hs9Py67X8mqdtg/rUWbbf<br>
<span class="lineno"></span>+gkp0kkkklKSSSSUpJJJJT//0PVUkkklKVLq3WMDpGI7KzrNjADtYNXvI/Mqr/Pd/q9W3vaxjnvM<br>
<span class="lineno"></span>NaCXE9gNSvGPrf8AWS3qmba5jjsJhoB0DAf0NDf6sevf+/lf8Hj0JJATfWT6/dV6oXU1uOLQeKKn<br>
<span class="lineno">310</span>EQP+Hubtfe/+R7Mf/g7f5xcocp++Z11JMCJPgFBxOg7/AOuqDx8I/ikpkXkmSdU8mJIJA/O8EMAy<br>
<span class="lineno"></span>j+mSARB/17pKVXYWHXjsj7yIex0PadzXMO1zT5KHoNA3HT8ietoGhgjsfA+CSnvvqh/jJtqsrwOv<br>
<span class="lineno"></span>2b6NGNzXfTYexzJ+nU7/ALkf4P8Awv6P9KvTQQ4AgyDqCF85Pho3CTB7eHwXoH+LT65uZbX9X+o2<br>
<span class="lineno"></span>bqbPb06551Y4<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513508">encodedShort</span>&nbsp;<span class="op" id="7513521">:=</span>&nbsp;<span class="ident" id="7513524">strings</span><span class="op" id="7513531">.</span><span class="ident" id="7513532">Replace</span><span class="op" id="7513539">(</span><span class="ident" id="7513540">encoded</span><span class="op" id="7513547">,</span>&nbsp;<span class="string" id="7513549">&#34;\n&#34;</span><span class="op" id="7513553">,</span>&nbsp;<span class="string" id="7513555">&#34;&#34;</span><span class="op" id="7513557">,</span>&nbsp;<span class="op" id="7513559">-</span><span class="num" id="7513560">1</span><span class="op" id="7513561">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513565">dec</span>&nbsp;<span class="op" id="7513569">:=</span>&nbsp;<span class="ident" id="7513572">NewDecoder</span><span class="op" id="7513582">(</span><span class="ident" id="7513583">StdEncoding</span><span class="op" id="7513594">,</span>&nbsp;<span class="ident" id="7513596">strings</span><span class="op" id="7513603">.</span><span class="ident" id="7513604">NewReader</span><span class="op" id="7513613">(</span><span class="ident" id="7513614">encoded</span><span class="op" id="7513621">)</span><span class="op" id="7513622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513625">res1</span><span class="op" id="7513629">,</span>&nbsp;<span class="ident" id="7513631">err</span>&nbsp;<span class="op" id="7513635">:=</span>&nbsp;<span class="ident" id="7513638">ioutil</span><span class="op" id="7513644">.</span><span class="ident" id="7513645">ReadAll</span><span class="op" id="7513652">(</span><span class="ident" id="7513653">dec</span><span class="op" id="7513656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7513659">if</span>&nbsp;<span class="ident" id="7513662">err</span>&nbsp;<span class="op" id="7513666">!=</span>&nbsp;<span class="ident" id="7513669">nil</span>&nbsp;<span class="op" id="7513673">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513677">t</span><span class="op" id="7513678">.</span><span class="ident" id="7513679">Errorf</span><span class="op" id="7513685">(</span><span class="string" id="7513686">&#34;ReadAll&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7513706">,</span>&nbsp;<span class="ident" id="7513708">err</span><span class="op" id="7513711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7513714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513718">dec</span>&nbsp;<span class="op" id="7513722">=</span>&nbsp;<span class="ident" id="7513724">NewDecoder</span><span class="op" id="7513734">(</span><span class="ident" id="7513735">StdEncoding</span><span class="op" id="7513746">,</span>&nbsp;<span class="ident" id="7513748">strings</span><span class="op" id="7513755">.</span><span class="ident" id="7513756">NewReader</span><span class="op" id="7513765">(</span><span class="ident" id="7513766">encodedShort</span><span class="op" id="7513778">)</span><span class="op" id="7513779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7513782">var</span>&nbsp;<span class="ident" id="7513786">res2</span>&nbsp;<span class="op" id="7513791">[</span><span class="op" id="7513792">]</span><span class="builtintype" id="7513793">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513799">res2</span><span class="op" id="7513803">,</span>&nbsp;<span class="ident" id="7513805">err</span>&nbsp;<span class="op" id="7513809">=</span>&nbsp;<span class="ident" id="7513811">ioutil</span><span class="op" id="7513817">.</span><span class="ident" id="7513818">ReadAll</span><span class="op" id="7513825">(</span><span class="ident" id="7513826">dec</span><span class="op" id="7513829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7513832">if</span>&nbsp;<span class="ident" id="7513835">err</span>&nbsp;<span class="op" id="7513839">!=</span>&nbsp;<span class="ident" id="7513842">nil</span>&nbsp;<span class="op" id="7513846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513850">t</span><span class="op" id="7513851">.</span><span class="ident" id="7513852">Errorf</span><span class="op" id="7513858">(</span><span class="string" id="7513859">&#34;ReadAll&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7513879">,</span>&nbsp;<span class="ident" id="7513881">err</span><span class="op" id="7513884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7513887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7513891">if</span>&nbsp;<span class="op" id="7513894">!</span><span class="ident" id="7513895">bytes</span><span class="op" id="7513900">.</span><span class="ident" id="7513901">Equal</span><span class="op" id="7513906">(</span><span class="ident" id="7513907">res1</span><span class="op" id="7513911">,</span>&nbsp;<span class="ident" id="7513913">res2</span><span class="op" id="7513917">)</span>&nbsp;<span class="op" id="7513919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513923">t</span><span class="op" id="7513924">.</span><span class="ident" id="7513925">Error</span><span class="op" id="7513930">(</span><span class="string" id="7513931">&#34;Decoded&nbsp;results&nbsp;not&nbsp;equal&#34;</span><span class="op" id="7513958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7513961">}</span><br>
<span class="lineno"></span><span class="op" id="7513963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="7513966">func</span>&nbsp;<span class="ident" id="7513971">TestDecoderIssue7733</span><span class="op" id="7513991">(</span><span class="ident" id="7513992">t</span>&nbsp;<span class="op" id="7513994">*</span><span class="ident" id="7513995">testing</span><span class="op" id="7514002">.</span><span class="ident" id="7514003">T</span><span class="op" id="7514004">)</span>&nbsp;<span class="op" id="7514006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514009">s</span><span class="op" id="7514010">,</span>&nbsp;<span class="ident" id="7514012">err</span>&nbsp;<span class="op" id="7514016">:=</span>&nbsp;<span class="ident" id="7514019">StdEncoding</span><span class="op" id="7514030">.</span><span class="ident" id="7514031">DecodeString</span><span class="op" id="7514043">(</span><span class="string" id="7514044">&#34;YWJjZA=====&#34;</span><span class="op" id="7514057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514060">want</span>&nbsp;<span class="op" id="7514065">:=</span>&nbsp;<span class="ident" id="7514068">CorruptInputError</span><span class="op" id="7514085">(</span><span class="num" id="7514086">8</span><span class="op" id="7514087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514090">if</span>&nbsp;<span class="op" id="7514093">!</span><span class="ident" id="7514094">reflect</span><span class="op" id="7514101">.</span><span class="ident" id="7514102">DeepEqual</span><span class="op" id="7514111">(</span><span class="ident" id="7514112">want</span><span class="op" id="7514116">,</span>&nbsp;<span class="ident" id="7514118">err</span><span class="op" id="7514121">)</span>&nbsp;<span class="op" id="7514123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514127">t</span><span class="op" id="7514128">.</span><span class="ident" id="7514129">Errorf</span><span class="op" id="7514135">(</span><span class="string" id="7514136">&#34;Error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;CorruptInputError(8)&#34;</span><span class="op" id="7514175">,</span>&nbsp;<span class="ident" id="7514177">err</span><span class="op" id="7514180">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514186">if</span>&nbsp;<span class="builtintype" id="7514189">string</span><span class="op" id="7514195">(</span><span class="ident" id="7514196">s</span><span class="op" id="7514197">)</span>&nbsp;<span class="op" id="7514199">!=</span>&nbsp;<span class="string" id="7514202">&#34;abcd&#34;</span>&nbsp;<span class="op" id="7514209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514213">t</span><span class="op" id="7514214">.</span><span class="ident" id="7514215">Errorf</span><span class="op" id="7514221">(</span><span class="string" id="7514222">&#34;DecodeString&nbsp;=&nbsp;%q;&nbsp;want&nbsp;abcd&#34;</span><span class="op" id="7514252">,</span>&nbsp;<span class="ident" id="7514254">s</span><span class="op" id="7514255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514258">}</span><br>
<span class="lineno"></span><span class="op" id="7514260">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="7514263">func</span>&nbsp;<span class="ident" id="7514268">BenchmarkEncodeToString</span><span class="op" id="7514291">(</span><span class="ident" id="7514292">b</span>&nbsp;<span class="op" id="7514294">*</span><span class="ident" id="7514295">testing</span><span class="op" id="7514302">.</span><span class="ident" id="7514303">B</span><span class="op" id="7514304">)</span>&nbsp;<span class="op" id="7514306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514309">data</span>&nbsp;<span class="op" id="7514314">:=</span>&nbsp;<span class="builtinfunc" id="7514317">make</span><span class="op" id="7514321">(</span><span class="op" id="7514322">[</span><span class="op" id="7514323">]</span><span class="builtintype" id="7514324">byte</span><span class="op" id="7514328">,</span>&nbsp;<span class="num" id="7514330">8192</span><span class="op" id="7514334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514337">b</span><span class="op" id="7514338">.</span><span class="ident" id="7514339">SetBytes</span><span class="op" id="7514347">(</span><span class="ident" id="7514348">int64</span><span class="op" id="7514353">(</span><span class="builtinfunc" id="7514354">len</span><span class="op" id="7514357">(</span><span class="ident" id="7514358">data</span><span class="op" id="7514362">)</span><span class="op" id="7514363">)</span><span class="op" id="7514364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514367">for</span>&nbsp;<span class="ident" id="7514371">i</span>&nbsp;<span class="op" id="7514373">:=</span>&nbsp;<span class="num" id="7514376">0</span><span class="op" id="7514377">;</span>&nbsp;<span class="ident" id="7514379">i</span>&nbsp;<span class="op" id="7514381">&lt;</span>&nbsp;<span class="ident" id="7514383">b</span><span class="op" id="7514384">.</span><span class="ident" id="7514385">N</span><span class="op" id="7514386">;</span>&nbsp;<span class="ident" id="7514388">i</span><span class="op" id="7514389">++</span>&nbsp;<span class="op" id="7514392">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514396">StdEncoding</span><span class="op" id="7514407">.</span><span class="ident" id="7514408">EncodeToString</span><span class="op" id="7514422">(</span><span class="ident" id="7514423">data</span><span class="op" id="7514427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514430">}</span><br>
<span class="lineno"></span><span class="op" id="7514432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7514435">func</span>&nbsp;<span class="ident" id="7514440">BenchmarkDecodeString</span><span class="op" id="7514461">(</span><span class="ident" id="7514462">b</span>&nbsp;<span class="op" id="7514464">*</span><span class="ident" id="7514465">testing</span><span class="op" id="7514472">.</span><span class="ident" id="7514473">B</span><span class="op" id="7514474">)</span>&nbsp;<span class="op" id="7514476">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514479">data</span>&nbsp;<span class="op" id="7514484">:=</span>&nbsp;<span class="ident" id="7514487">StdEncoding</span><span class="op" id="7514498">.</span><span class="ident" id="7514499">EncodeToString</span><span class="op" id="7514513">(</span><span class="builtinfunc" id="7514514">make</span><span class="op" id="7514518">(</span><span class="op" id="7514519">[</span><span class="op" id="7514520">]</span><span class="builtintype" id="7514521">byte</span><span class="op" id="7514525">,</span>&nbsp;<span class="num" id="7514527">8192</span><span class="op" id="7514531">)</span><span class="op" id="7514532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514535">b</span><span class="op" id="7514536">.</span><span class="ident" id="7514537">SetBytes</span><span class="op" id="7514545">(</span><span class="ident" id="7514546">int64</span><span class="op" id="7514551">(</span><span class="builtinfunc" id="7514552">len</span><span class="op" id="7514555">(</span><span class="ident" id="7514556">data</span><span class="op" id="7514560">)</span><span class="op" id="7514561">)</span><span class="op" id="7514562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514565">for</span>&nbsp;<span class="ident" id="7514569">i</span>&nbsp;<span class="op" id="7514571">:=</span>&nbsp;<span class="num" id="7514574">0</span><span class="op" id="7514575">;</span>&nbsp;<span class="ident" id="7514577">i</span>&nbsp;<span class="op" id="7514579">&lt;</span>&nbsp;<span class="ident" id="7514581">b</span><span class="op" id="7514582">.</span><span class="ident" id="7514583">N</span><span class="op" id="7514584">;</span>&nbsp;<span class="ident" id="7514586">i</span><span class="op" id="7514587">++</span>&nbsp;<span class="op" id="7514590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514594">StdEncoding</span><span class="op" id="7514605">.</span><span class="ident" id="7514606">DecodeString</span><span class="op" id="7514618">(</span><span class="ident" id="7514619">data</span><span class="op" id="7514623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514626">}</span><br>
<span class="lineno">360</span><span class="op" id="7514628">}</span>
</div>
</body>
</html>
