<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html" class="current">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4829468">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4829523">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4829577">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4829628">package</span>&nbsp;<span class="ident" id="4829636">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4829643">//&nbsp;moveToFrontDecoder&nbsp;implements&nbsp;a&nbsp;move-to-front&nbsp;list.&nbsp;Such&nbsp;a&nbsp;list&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="4829716">//&nbsp;efficient&nbsp;way&nbsp;to&nbsp;transform&nbsp;a&nbsp;string&nbsp;with&nbsp;repeating&nbsp;elements&nbsp;into&nbsp;one&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="4829793">//&nbsp;many&nbsp;small&nbsp;valued&nbsp;numbers,&nbsp;which&nbsp;is&nbsp;suitable&nbsp;for&nbsp;entropy&nbsp;encoding.&nbsp;It&nbsp;works</span><br>
<span class="lineno">10</span><span class="comment" id="4829872">//&nbsp;by&nbsp;starting&nbsp;with&nbsp;an&nbsp;initial&nbsp;list&nbsp;of&nbsp;symbols&nbsp;and&nbsp;references&nbsp;symbols&nbsp;by&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="4829951">//&nbsp;index&nbsp;into&nbsp;that&nbsp;list.&nbsp;When&nbsp;a&nbsp;symbol&nbsp;is&nbsp;referenced,&nbsp;it&#39;s&nbsp;moved&nbsp;to&nbsp;the&nbsp;front</span><br>
<span class="lineno"></span><span class="comment" id="4830029">//&nbsp;of&nbsp;the&nbsp;list.&nbsp;Thus,&nbsp;a&nbsp;repeated&nbsp;symbol&nbsp;ends&nbsp;up&nbsp;being&nbsp;encoded&nbsp;with&nbsp;many&nbsp;zeros,</span><br>
<span class="lineno"></span><span class="comment" id="4830108">//&nbsp;as&nbsp;the&nbsp;symbol&nbsp;will&nbsp;be&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list&nbsp;after&nbsp;the&nbsp;first&nbsp;access.</span><br>
<span class="lineno"></span><span class="keyword" id="4830182">type</span>&nbsp;<span class="ident" id="4830187">moveToFrontDecoder</span>&nbsp;<span class="op" id="4830206">[</span><span class="op" id="4830207">]</span><span class="builtintype" id="4830208">byte</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4830214">//&nbsp;newMTFDecoder&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;explicit&nbsp;initial&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="4830293">//&nbsp;of&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="4830308">func</span>&nbsp;<span class="ident" id="4830313">newMTFDecoder</span><span class="op" id="4830326">(</span><span class="ident" id="4830327">symbols</span>&nbsp;<span class="op" id="4830335">[</span><span class="op" id="4830336">]</span><span class="builtintype" id="4830337">byte</span><span class="op" id="4830341">)</span>&nbsp;<span class="ident" id="4830343">moveToFrontDecoder</span>&nbsp;<span class="op" id="4830362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830365">if</span>&nbsp;<span class="builtinfunc" id="4830368">len</span><span class="op" id="4830371">(</span><span class="ident" id="4830372">symbols</span><span class="op" id="4830379">)</span>&nbsp;<span class="op" id="4830381">&gt;</span>&nbsp;<span class="num" id="4830383">256</span>&nbsp;<span class="op" id="4830387">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4830391">panic</span><span class="op" id="4830396">(</span><span class="string" id="4830397">&#34;too&nbsp;many&nbsp;symbols&#34;</span><span class="op" id="4830415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830421">return</span>&nbsp;<span class="ident" id="4830428">moveToFrontDecoder</span><span class="op" id="4830446">(</span><span class="ident" id="4830447">symbols</span><span class="op" id="4830454">)</span><br>
<span class="lineno"></span><span class="op" id="4830456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4830459">//&nbsp;newMTFDecoderWithRange&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="4830533">//&nbsp;symbol&nbsp;list&nbsp;of&nbsp;0...n-1.</span><br>
<span class="lineno"></span><span class="keyword" id="4830560">func</span>&nbsp;<span class="ident" id="4830565">newMTFDecoderWithRange</span><span class="op" id="4830587">(</span><span class="ident" id="4830588">n</span>&nbsp;<span class="builtintype" id="4830590">int</span><span class="op" id="4830593">)</span>&nbsp;<span class="ident" id="4830595">moveToFrontDecoder</span>&nbsp;<span class="op" id="4830614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830617">if</span>&nbsp;<span class="ident" id="4830620">n</span>&nbsp;<span class="op" id="4830622">&gt;</span>&nbsp;<span class="num" id="4830624">256</span>&nbsp;<span class="op" id="4830628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4830632">panic</span><span class="op" id="4830637">(</span><span class="string" id="4830638">&#34;newMTFDecoderWithRange:&nbsp;cannot&nbsp;have&nbsp;&gt;&nbsp;256&nbsp;symbols&#34;</span><span class="op" id="4830689">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830696">m</span>&nbsp;<span class="op" id="4830698">:=</span>&nbsp;<span class="builtinfunc" id="4830701">make</span><span class="op" id="4830705">(</span><span class="op" id="4830706">[</span><span class="op" id="4830707">]</span><span class="builtintype" id="4830708">byte</span><span class="op" id="4830712">,</span>&nbsp;<span class="ident" id="4830714">n</span><span class="op" id="4830715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830718">for</span>&nbsp;<span class="ident" id="4830722">i</span>&nbsp;<span class="op" id="4830724">:=</span>&nbsp;<span class="num" id="4830727">0</span><span class="op" id="4830728">;</span>&nbsp;<span class="ident" id="4830730">i</span>&nbsp;<span class="op" id="4830732">&lt;</span>&nbsp;<span class="ident" id="4830734">n</span><span class="op" id="4830735">;</span>&nbsp;<span class="ident" id="4830737">i</span><span class="op" id="4830738">++</span>&nbsp;<span class="op" id="4830741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830745">m</span><span class="op" id="4830746">[</span><span class="ident" id="4830747">i</span><span class="op" id="4830748">]</span>&nbsp;<span class="op" id="4830750">=</span>&nbsp;<span class="builtintype" id="4830752">byte</span><span class="op" id="4830756">(</span><span class="ident" id="4830757">i</span><span class="op" id="4830758">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830764">return</span>&nbsp;<span class="ident" id="4830771">moveToFrontDecoder</span><span class="op" id="4830789">(</span><span class="ident" id="4830790">m</span><span class="op" id="4830791">)</span><br>
<span class="lineno"></span><span class="op" id="4830793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4830796">func</span>&nbsp;<span class="op" id="4830801">(</span><span class="ident" id="4830802">m</span>&nbsp;<span class="ident" id="4830804">moveToFrontDecoder</span><span class="op" id="4830822">)</span>&nbsp;<span class="ident" id="4830824">Decode</span><span class="op" id="4830830">(</span><span class="ident" id="4830831">n</span>&nbsp;<span class="builtintype" id="4830833">int</span><span class="op" id="4830836">)</span>&nbsp;<span class="op" id="4830838">(</span><span class="ident" id="4830839">b</span>&nbsp;<span class="builtintype" id="4830841">byte</span><span class="op" id="4830845">)</span>&nbsp;<span class="op" id="4830847">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830850">//&nbsp;Implement&nbsp;move-to-front&nbsp;with&nbsp;a&nbsp;simple&nbsp;copy.&nbsp;This&nbsp;approach</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830912">//&nbsp;beats&nbsp;more&nbsp;sophisticated&nbsp;approaches&nbsp;in&nbsp;benchmarking,&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830978">//&nbsp;because&nbsp;it&nbsp;has&nbsp;high&nbsp;locality&nbsp;of&nbsp;reference&nbsp;inside&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4831036">//&nbsp;single&nbsp;cache&nbsp;line&nbsp;(most&nbsp;move-to-front&nbsp;operations&nbsp;have&nbsp;n&nbsp;&lt;&nbsp;64).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4831103">b</span>&nbsp;<span class="op" id="4831105">=</span>&nbsp;<span class="ident" id="4831107">m</span><span class="op" id="4831108">[</span><span class="ident" id="4831109">n</span><span class="op" id="4831110">]</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4831113">copy</span><span class="op" id="4831117">(</span><span class="ident" id="4831118">m</span><span class="op" id="4831119">[</span><span class="num" id="4831120">1</span><span class="op" id="4831121">:</span><span class="op" id="4831122">]</span><span class="op" id="4831123">,</span>&nbsp;<span class="ident" id="4831125">m</span><span class="op" id="4831126">[</span><span class="op" id="4831127">:</span><span class="ident" id="4831128">n</span><span class="op" id="4831129">]</span><span class="op" id="4831130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4831133">m</span><span class="op" id="4831134">[</span><span class="num" id="4831135">0</span><span class="op" id="4831136">]</span>&nbsp;<span class="op" id="4831138">=</span>&nbsp;<span class="ident" id="4831140">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831143">return</span><br>
<span class="lineno"></span><span class="op" id="4831150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4831153">//&nbsp;First&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="4831207">func</span>&nbsp;<span class="op" id="4831212">(</span><span class="ident" id="4831213">m</span>&nbsp;<span class="ident" id="4831215">moveToFrontDecoder</span><span class="op" id="4831233">)</span>&nbsp;<span class="ident" id="4831235">First</span><span class="op" id="4831240">(</span><span class="op" id="4831241">)</span>&nbsp;<span class="builtintype" id="4831243">byte</span>&nbsp;<span class="op" id="4831248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831251">return</span>&nbsp;<span class="ident" id="4831258">m</span><span class="op" id="4831259">[</span><span class="num" id="4831260">0</span><span class="op" id="4831261">]</span><br>
<span class="lineno"></span><span class="op" id="4831263">}</span>
</div>
</body>
</html>
