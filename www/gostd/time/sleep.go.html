<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>time</h2>
<ul>
<li><a href="/gostd/time/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/time/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/time/format.go.html">format.go</a></li>
<li><a href="/gostd/time/format_test.go.html">format_test.go</a></li>
<li><a href="/gostd/time/internal_test.go.html">internal_test.go</a></li>
<li><a href="/gostd/time/sleep.go.html" class="current">sleep.go</a></li>
<li><a href="/gostd/time/sleep_test.go.html">sleep_test.go</a></li>
<li><a href="/gostd/time/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/time/tick.go.html">tick.go</a></li>
<li><a href="/gostd/time/tick_test.go.html">tick_test.go</a></li>
<li><a href="/gostd/time/time.go.html">time.go</a></li>
<li><a href="/gostd/time/time_test.go.html">time_test.go</a></li>
<li><a href="/gostd/time/zoneinfo.go.html">zoneinfo.go</a></li>
<li><a href="/gostd/time/zoneinfo_read.go.html">zoneinfo_read.go</a></li>
<li><a href="/gostd/time/zoneinfo_test.go.html">zoneinfo_test.go</a></li>
<li><a href="/gostd/time/zoneinfo_unix.go.html">zoneinfo_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2704436">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2704491">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2704545">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2704596">package</span>&nbsp;<span class="ident" id="2704604">time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2704610">//&nbsp;Sleep&nbsp;pauses&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;duration&nbsp;d.</span><br>
<span class="lineno"></span><span class="comment" id="2704677">//&nbsp;A&nbsp;negative&nbsp;or&nbsp;zero&nbsp;duration&nbsp;causes&nbsp;Sleep&nbsp;to&nbsp;return&nbsp;immediately.</span><br>
<span class="lineno"></span><span class="keyword" id="2704744">func</span>&nbsp;<span class="ident" id="2704749">Sleep</span><span class="op" id="2704754">(</span><span class="ident" id="2704755">d</span>&nbsp;<span class="ident" id="2704757">Duration</span><span class="op" id="2704765">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2704768">//&nbsp;runtimeNano&nbsp;returns&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;runtime&nbsp;clock&nbsp;in&nbsp;nanoseconds.</span><br>
<span class="lineno"></span><span class="keyword" id="2704846">func</span>&nbsp;<span class="ident" id="2704851">runtimeNano</span><span class="op" id="2704862">(</span><span class="op" id="2704863">)</span>&nbsp;<span class="ident" id="2704865">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2704872">//&nbsp;Interface&nbsp;to&nbsp;timers&nbsp;implemented&nbsp;in&nbsp;package&nbsp;runtime.</span><br>
<span class="lineno">15</span><span class="comment" id="2704927">//&nbsp;Must&nbsp;be&nbsp;in&nbsp;sync&nbsp;with&nbsp;../runtime/runtime.h:/^struct.Timer$</span><br>
<span class="lineno"></span><span class="keyword" id="2704988">type</span>&nbsp;<span class="ident" id="2704993">runtimeTimer</span>&nbsp;<span class="keyword" id="2705006">struct</span>&nbsp;<span class="op" id="2705013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2705016">i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2705023">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2705028">when</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2705035">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2705042">period</span>&nbsp;<span class="ident" id="2705049">int64</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2705056">f</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2705063">func</span><span class="op" id="2705067">(</span><span class="keyword" id="2705068">interface</span><span class="op" id="2705077">{</span><span class="op" id="2705078">}</span><span class="op" id="2705079">,</span>&nbsp;<span class="builtintype" id="2705081">uintptr</span><span class="op" id="2705088">)</span>&nbsp;<span class="comment" id="2705090">//&nbsp;NOTE:&nbsp;must&nbsp;not&nbsp;be&nbsp;closure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2705120">arg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2705127">interface</span><span class="op" id="2705136">{</span><span class="op" id="2705137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2705140">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2705147">uintptr</span><br>
<span class="lineno"></span><span class="op" id="2705155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2705158">//&nbsp;when&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;setting&nbsp;the&nbsp;&#39;when&#39;&nbsp;field&nbsp;of&nbsp;a&nbsp;runtimeTimer.</span><br>
<span class="lineno"></span><span class="comment" id="2705235">//&nbsp;It&nbsp;returns&nbsp;what&nbsp;the&nbsp;time&nbsp;will&nbsp;be,&nbsp;in&nbsp;nanoseconds,&nbsp;Duration&nbsp;d&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="comment" id="2705314">//&nbsp;If&nbsp;d&nbsp;is&nbsp;negative,&nbsp;it&nbsp;is&nbsp;ignored.&nbsp;&nbsp;If&nbsp;the&nbsp;returned&nbsp;value&nbsp;would&nbsp;be&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="2705392">//&nbsp;zero&nbsp;because&nbsp;of&nbsp;an&nbsp;overflow,&nbsp;MaxInt64&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="2705446">func</span>&nbsp;<span class="ident" id="2705451">when</span><span class="op" id="2705455">(</span><span class="ident" id="2705456">d</span>&nbsp;<span class="ident" id="2705458">Duration</span><span class="op" id="2705466">)</span>&nbsp;<span class="ident" id="2705468">int64</span>&nbsp;<span class="op" id="2705474">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2705477">if</span>&nbsp;<span class="ident" id="2705480">d</span>&nbsp;<span class="op" id="2705482">&lt;=</span>&nbsp;<span class="num" id="2705485">0</span>&nbsp;<span class="op" id="2705487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2705491">return</span>&nbsp;<span class="ident" id="2705498">runtimeNano</span><span class="op" id="2705509">(</span><span class="op" id="2705510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2705513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2705516">t</span>&nbsp;<span class="op" id="2705518">:=</span>&nbsp;<span class="ident" id="2705521">runtimeNano</span><span class="op" id="2705532">(</span><span class="op" id="2705533">)</span>&nbsp;<span class="op" id="2705535">+</span>&nbsp;<span class="ident" id="2705537">int64</span><span class="op" id="2705542">(</span><span class="ident" id="2705543">d</span><span class="op" id="2705544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2705547">if</span>&nbsp;<span class="ident" id="2705550">t</span>&nbsp;<span class="op" id="2705552">&lt;</span>&nbsp;<span class="num" id="2705554">0</span>&nbsp;<span class="op" id="2705556">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2705560">t</span>&nbsp;<span class="op" id="2705562">=</span>&nbsp;<span class="num" id="2705564">1</span><span class="op" id="2705565">&lt;&lt;</span><span class="num" id="2705567">63</span>&nbsp;<span class="op" id="2705570">-</span>&nbsp;<span class="num" id="2705572">1</span>&nbsp;<span class="comment" id="2705574">//&nbsp;math.MaxInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2705592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2705595">return</span>&nbsp;<span class="ident" id="2705602">t</span><br>
<span class="lineno"></span><span class="op" id="2705604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2705607">func</span>&nbsp;<span class="ident" id="2705612">startTimer</span><span class="op" id="2705622">(</span><span class="op" id="2705623">*</span><span class="ident" id="2705624">runtimeTimer</span><span class="op" id="2705636">)</span><br>
<span class="lineno"></span><span class="keyword" id="2705638">func</span>&nbsp;<span class="ident" id="2705643">stopTimer</span><span class="op" id="2705652">(</span><span class="op" id="2705653">*</span><span class="ident" id="2705654">runtimeTimer</span><span class="op" id="2705666">)</span>&nbsp;<span class="builtintype" id="2705668">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2705674">//&nbsp;The&nbsp;Timer&nbsp;type&nbsp;represents&nbsp;a&nbsp;single&nbsp;event.</span><br>
<span class="lineno"></span><span class="comment" id="2705719">//&nbsp;When&nbsp;the&nbsp;Timer&nbsp;expires,&nbsp;the&nbsp;current&nbsp;time&nbsp;will&nbsp;be&nbsp;sent&nbsp;on&nbsp;C,</span><br>
<span class="lineno">45</span><span class="comment" id="2705782">//&nbsp;unless&nbsp;the&nbsp;Timer&nbsp;was&nbsp;created&nbsp;by&nbsp;AfterFunc.</span><br>
<span class="lineno"></span><span class="comment" id="2705828">//&nbsp;A&nbsp;Timer&nbsp;must&nbsp;be&nbsp;created&nbsp;with&nbsp;NewTimer&nbsp;or&nbsp;AfterFunc.</span><br>
<span class="lineno"></span><span class="keyword" id="2705883">type</span>&nbsp;<span class="ident" id="2705888">Timer</span>&nbsp;<span class="keyword" id="2705894">struct</span>&nbsp;<span class="op" id="2705901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2705904">C</span>&nbsp;<span class="op" id="2705906">&lt;-</span><span class="keyword" id="2705908">chan</span>&nbsp;<span class="ident" id="2705913">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2705919">r</span>&nbsp;<span class="ident" id="2705921">runtimeTimer</span><br>
<span class="lineno">50</span><span class="op" id="2705934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2705937">//&nbsp;Stop&nbsp;prevents&nbsp;the&nbsp;Timer&nbsp;from&nbsp;firing.</span><br>
<span class="lineno"></span><span class="comment" id="2705977">//&nbsp;It&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;call&nbsp;stops&nbsp;the&nbsp;timer,&nbsp;false&nbsp;if&nbsp;the&nbsp;timer&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="2706056">//&nbsp;expired&nbsp;or&nbsp;been&nbsp;stopped.</span><br>
<span class="lineno">55</span><span class="comment" id="2706084">//&nbsp;Stop&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;channel,&nbsp;to&nbsp;prevent&nbsp;a&nbsp;read&nbsp;from&nbsp;the&nbsp;channel&nbsp;succeeding</span><br>
<span class="lineno"></span><span class="comment" id="2706166">//&nbsp;incorrectly.</span><br>
<span class="lineno"></span><span class="keyword" id="2706182">func</span>&nbsp;<span class="op" id="2706187">(</span><span class="ident" id="2706188">t</span>&nbsp;<span class="op" id="2706190">*</span><span class="ident" id="2706191">Timer</span><span class="op" id="2706196">)</span>&nbsp;<span class="ident" id="2706198">Stop</span><span class="op" id="2706202">(</span><span class="op" id="2706203">)</span>&nbsp;<span class="builtintype" id="2706205">bool</span>&nbsp;<span class="op" id="2706210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2706213">if</span>&nbsp;<span class="ident" id="2706216">t</span><span class="op" id="2706217">.</span><span class="ident" id="2706218">r</span><span class="op" id="2706219">.</span><span class="ident" id="2706220">f</span>&nbsp;<span class="op" id="2706222">==</span>&nbsp;<span class="builtintype" id="2706225">nil</span>&nbsp;<span class="op" id="2706229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2706233">panic</span><span class="op" id="2706238">(</span><span class="string" id="2706239">&#34;time:&nbsp;Stop&nbsp;called&nbsp;on&nbsp;uninitialized&nbsp;Timer&#34;</span><span class="op" id="2706281">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2706284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2706287">return</span>&nbsp;<span class="ident" id="2706294">stopTimer</span><span class="op" id="2706303">(</span><span class="op" id="2706304">&amp;</span><span class="ident" id="2706305">t</span><span class="op" id="2706306">.</span><span class="ident" id="2706307">r</span><span class="op" id="2706308">)</span><br>
<span class="lineno"></span><span class="op" id="2706310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2706313">//&nbsp;NewTimer&nbsp;creates&nbsp;a&nbsp;new&nbsp;Timer&nbsp;that&nbsp;will&nbsp;send</span><br>
<span class="lineno">65</span><span class="comment" id="2706360">//&nbsp;the&nbsp;current&nbsp;time&nbsp;on&nbsp;its&nbsp;channel&nbsp;after&nbsp;at&nbsp;least&nbsp;duration&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="2706422">func</span>&nbsp;<span class="ident" id="2706427">NewTimer</span><span class="op" id="2706435">(</span><span class="ident" id="2706436">d</span>&nbsp;<span class="ident" id="2706438">Duration</span><span class="op" id="2706446">)</span>&nbsp;<span class="op" id="2706448">*</span><span class="ident" id="2706449">Timer</span>&nbsp;<span class="op" id="2706455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2706458">c</span>&nbsp;<span class="op" id="2706460">:=</span>&nbsp;<span class="builtinfunc" id="2706463">make</span><span class="op" id="2706467">(</span><span class="keyword" id="2706468">chan</span>&nbsp;<span class="ident" id="2706473">Time</span><span class="op" id="2706477">,</span>&nbsp;<span class="num" id="2706479">1</span><span class="op" id="2706480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2706483">t</span>&nbsp;<span class="op" id="2706485">:=</span>&nbsp;<span class="op" id="2706488">&amp;</span><span class="ident" id="2706489">Timer</span><span class="op" id="2706494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2706498">C</span><span class="op" id="2706499">:</span>&nbsp;<span class="ident" id="2706501">c</span><span class="op" id="2706502">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2706506">r</span><span class="op" id="2706507">:</span>&nbsp;<span class="ident" id="2706509">runtimeTimer</span><span class="op" id="2706521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2706526">when</span><span class="op" id="2706530">:</span>&nbsp;<span class="ident" id="2706532">when</span><span class="op" id="2706536">(</span><span class="ident" id="2706537">d</span><span class="op" id="2706538">)</span><span class="op" id="2706539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2706544">f</span><span class="op" id="2706545">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2706550">sendTime</span><span class="op" id="2706558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2706563">arg</span><span class="op" id="2706566">:</span>&nbsp;&nbsp;<span class="ident" id="2706569">c</span><span class="op" id="2706570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2706574">}</span><span class="op" id="2706575">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2706578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2706581">startTimer</span><span class="op" id="2706591">(</span><span class="op" id="2706592">&amp;</span><span class="ident" id="2706593">t</span><span class="op" id="2706594">.</span><span class="ident" id="2706595">r</span><span class="op" id="2706596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2706599">return</span>&nbsp;<span class="ident" id="2706606">t</span><br>
<span class="lineno"></span><span class="op" id="2706608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2706611">//&nbsp;Reset&nbsp;changes&nbsp;the&nbsp;timer&nbsp;to&nbsp;expire&nbsp;after&nbsp;duration&nbsp;d.</span><br>
<span class="lineno"></span><span class="comment" id="2706666">//&nbsp;It&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;timer&nbsp;had&nbsp;been&nbsp;active,&nbsp;false&nbsp;if&nbsp;the&nbsp;timer&nbsp;had</span><br>
<span class="lineno"></span><span class="comment" id="2706738">//&nbsp;expired&nbsp;or&nbsp;been&nbsp;stopped.</span><br>
<span class="lineno"></span><span class="keyword" id="2706766">func</span>&nbsp;<span class="op" id="2706771">(</span><span class="ident" id="2706772">t</span>&nbsp;<span class="op" id="2706774">*</span><span class="ident" id="2706775">Timer</span><span class="op" id="2706780">)</span>&nbsp;<span class="ident" id="2706782">Reset</span><span class="op" id="2706787">(</span><span class="ident" id="2706788">d</span>&nbsp;<span class="ident" id="2706790">Duration</span><span class="op" id="2706798">)</span>&nbsp;<span class="builtintype" id="2706800">bool</span>&nbsp;<span class="op" id="2706805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2706808">if</span>&nbsp;<span class="ident" id="2706811">t</span><span class="op" id="2706812">.</span><span class="ident" id="2706813">r</span><span class="op" id="2706814">.</span><span class="ident" id="2706815">f</span>&nbsp;<span class="op" id="2706817">==</span>&nbsp;<span class="builtintype" id="2706820">nil</span>&nbsp;<span class="op" id="2706824">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2706828">panic</span><span class="op" id="2706833">(</span><span class="string" id="2706834">&#34;time:&nbsp;Reset&nbsp;called&nbsp;on&nbsp;uninitialized&nbsp;Timer&#34;</span><span class="op" id="2706877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2706880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2706883">w</span>&nbsp;<span class="op" id="2706885">:=</span>&nbsp;<span class="ident" id="2706888">when</span><span class="op" id="2706892">(</span><span class="ident" id="2706893">d</span><span class="op" id="2706894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2706897">active</span>&nbsp;<span class="op" id="2706904">:=</span>&nbsp;<span class="ident" id="2706907">stopTimer</span><span class="op" id="2706916">(</span><span class="op" id="2706917">&amp;</span><span class="ident" id="2706918">t</span><span class="op" id="2706919">.</span><span class="ident" id="2706920">r</span><span class="op" id="2706921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2706924">t</span><span class="op" id="2706925">.</span><span class="ident" id="2706926">r</span><span class="op" id="2706927">.</span><span class="ident" id="2706928">when</span>&nbsp;<span class="op" id="2706933">=</span>&nbsp;<span class="ident" id="2706935">w</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2706938">startTimer</span><span class="op" id="2706948">(</span><span class="op" id="2706949">&amp;</span><span class="ident" id="2706950">t</span><span class="op" id="2706951">.</span><span class="ident" id="2706952">r</span><span class="op" id="2706953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2706956">return</span>&nbsp;<span class="ident" id="2706963">active</span><br>
<span class="lineno"></span><span class="op" id="2706970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2706973">func</span>&nbsp;<span class="ident" id="2706978">sendTime</span><span class="op" id="2706986">(</span><span class="ident" id="2706987">c</span>&nbsp;<span class="keyword" id="2706989">interface</span><span class="op" id="2706998">{</span><span class="op" id="2706999">}</span><span class="op" id="2707000">,</span>&nbsp;<span class="ident" id="2707002">seq</span>&nbsp;<span class="builtintype" id="2707006">uintptr</span><span class="op" id="2707013">)</span>&nbsp;<span class="op" id="2707015">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2707018">//&nbsp;Non-blocking&nbsp;send&nbsp;of&nbsp;time&nbsp;on&nbsp;c.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2707054">//&nbsp;Used&nbsp;in&nbsp;NewTimer,&nbsp;it&nbsp;cannot&nbsp;block&nbsp;anyway&nbsp;(buffer).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2707109">//&nbsp;Used&nbsp;in&nbsp;NewTicker,&nbsp;dropping&nbsp;sends&nbsp;on&nbsp;the&nbsp;floor&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2707163">//&nbsp;the&nbsp;desired&nbsp;behavior&nbsp;when&nbsp;the&nbsp;reader&nbsp;gets&nbsp;behind,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2707217">//&nbsp;because&nbsp;the&nbsp;sends&nbsp;are&nbsp;periodic.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2707253">select</span>&nbsp;<span class="op" id="2707260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2707263">case</span>&nbsp;<span class="ident" id="2707268">c</span><span class="op" id="2707269">.</span><span class="op" id="2707270">(</span><span class="keyword" id="2707271">chan</span>&nbsp;<span class="ident" id="2707276">Time</span><span class="op" id="2707280">)</span>&nbsp;<span class="op" id="2707282">&lt;-</span>&nbsp;<span class="ident" id="2707285">Now</span><span class="op" id="2707288">(</span><span class="op" id="2707289">)</span><span class="op" id="2707290">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2707293">default</span><span class="op" id="2707300">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2707303">}</span><br>
<span class="lineno"></span><span class="op" id="2707305">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="2707308">//&nbsp;After&nbsp;waits&nbsp;for&nbsp;the&nbsp;duration&nbsp;to&nbsp;elapse&nbsp;and&nbsp;then&nbsp;sends&nbsp;the&nbsp;current&nbsp;time</span><br>
<span class="lineno"></span><span class="comment" id="2707382">//&nbsp;on&nbsp;the&nbsp;returned&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="2707410">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;NewTimer(d).C.</span><br>
<span class="lineno"></span><span class="keyword" id="2707448">func</span>&nbsp;<span class="ident" id="2707453">After</span><span class="op" id="2707458">(</span><span class="ident" id="2707459">d</span>&nbsp;<span class="ident" id="2707461">Duration</span><span class="op" id="2707469">)</span>&nbsp;<span class="op" id="2707471">&lt;-</span><span class="keyword" id="2707473">chan</span>&nbsp;<span class="ident" id="2707478">Time</span>&nbsp;<span class="op" id="2707483">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2707486">return</span>&nbsp;<span class="ident" id="2707493">NewTimer</span><span class="op" id="2707501">(</span><span class="ident" id="2707502">d</span><span class="op" id="2707503">)</span><span class="op" id="2707504">.</span><span class="ident" id="2707505">C</span><br>
<span class="lineno"></span><span class="op" id="2707507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2707510">//&nbsp;AfterFunc&nbsp;waits&nbsp;for&nbsp;the&nbsp;duration&nbsp;to&nbsp;elapse&nbsp;and&nbsp;then&nbsp;calls&nbsp;f</span><br>
<span class="lineno"></span><span class="comment" id="2707573">//&nbsp;in&nbsp;its&nbsp;own&nbsp;goroutine.&nbsp;It&nbsp;returns&nbsp;a&nbsp;Timer&nbsp;that&nbsp;can</span><br>
<span class="lineno">115</span><span class="comment" id="2707626">//&nbsp;be&nbsp;used&nbsp;to&nbsp;cancel&nbsp;the&nbsp;call&nbsp;using&nbsp;its&nbsp;Stop&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="2707679">func</span>&nbsp;<span class="ident" id="2707684">AfterFunc</span><span class="op" id="2707693">(</span><span class="ident" id="2707694">d</span>&nbsp;<span class="ident" id="2707696">Duration</span><span class="op" id="2707704">,</span>&nbsp;<span class="ident" id="2707706">f</span>&nbsp;<span class="keyword" id="2707708">func</span><span class="op" id="2707712">(</span><span class="op" id="2707713">)</span><span class="op" id="2707714">)</span>&nbsp;<span class="op" id="2707716">*</span><span class="ident" id="2707717">Timer</span>&nbsp;<span class="op" id="2707723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2707726">t</span>&nbsp;<span class="op" id="2707728">:=</span>&nbsp;<span class="op" id="2707731">&amp;</span><span class="ident" id="2707732">Timer</span><span class="op" id="2707737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2707741">r</span><span class="op" id="2707742">:</span>&nbsp;<span class="ident" id="2707744">runtimeTimer</span><span class="op" id="2707756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2707761">when</span><span class="op" id="2707765">:</span>&nbsp;<span class="ident" id="2707767">when</span><span class="op" id="2707771">(</span><span class="ident" id="2707772">d</span><span class="op" id="2707773">)</span><span class="op" id="2707774">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2707779">f</span><span class="op" id="2707780">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2707785">goFunc</span><span class="op" id="2707791">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2707796">arg</span><span class="op" id="2707799">:</span>&nbsp;&nbsp;<span class="ident" id="2707802">f</span><span class="op" id="2707803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2707807">}</span><span class="op" id="2707808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2707811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2707814">startTimer</span><span class="op" id="2707824">(</span><span class="op" id="2707825">&amp;</span><span class="ident" id="2707826">t</span><span class="op" id="2707827">.</span><span class="ident" id="2707828">r</span><span class="op" id="2707829">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2707832">return</span>&nbsp;<span class="ident" id="2707839">t</span><br>
<span class="lineno"></span><span class="op" id="2707841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2707844">func</span>&nbsp;<span class="ident" id="2707849">goFunc</span><span class="op" id="2707855">(</span><span class="ident" id="2707856">arg</span>&nbsp;<span class="keyword" id="2707860">interface</span><span class="op" id="2707869">{</span><span class="op" id="2707870">}</span><span class="op" id="2707871">,</span>&nbsp;<span class="ident" id="2707873">seq</span>&nbsp;<span class="builtintype" id="2707877">uintptr</span><span class="op" id="2707884">)</span>&nbsp;<span class="op" id="2707886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2707889">go</span>&nbsp;<span class="ident" id="2707892">arg</span><span class="op" id="2707895">.</span><span class="op" id="2707896">(</span><span class="keyword" id="2707897">func</span><span class="op" id="2707901">(</span><span class="op" id="2707902">)</span><span class="op" id="2707903">)</span><span class="op" id="2707904">(</span><span class="op" id="2707905">)</span><br>
<span class="lineno">130</span><span class="op" id="2707907">}</span>
</div>
</body>
</html>
