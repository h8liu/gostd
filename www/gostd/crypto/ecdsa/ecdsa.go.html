<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/ecdsa</h2>
<ul>
<li><a href="/gostd/crypto/ecdsa/ecdsa.go.html" class="current">ecdsa.go</a></li>
<li><a href="/gostd/crypto/ecdsa/ecdsa_test.go.html">ecdsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4873404">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4873459">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4873513">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4873564">//&nbsp;Package&nbsp;ecdsa&nbsp;implements&nbsp;the&nbsp;Elliptic&nbsp;Curve&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4873643">//&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4873669">package</span>&nbsp;<span class="ident" id="4873677">ecdsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4873684">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="4873699">//&nbsp;&nbsp;&nbsp;[NSA]:&nbsp;Suite&nbsp;B&nbsp;implementer&#39;s&nbsp;guide&nbsp;to&nbsp;FIPS&nbsp;186-3,</span><br>
<span class="lineno"></span><span class="comment" id="4873754">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.nsa.gov/ia/_files/ecdsa.pdf</span><br>
<span class="lineno"></span><span class="comment" id="4873800">//&nbsp;&nbsp;&nbsp;[SECG]:&nbsp;SECG,&nbsp;SEC1</span><br>
<span class="lineno"></span><span class="comment" id="4873824">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.secg.org/download/aid-780/sec1-v2.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4873881">import</span>&nbsp;<span class="op" id="4873888">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4873891">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4873901">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4873920">&#34;encoding/asn1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4873937">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4873943">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4873954">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4873957">//&nbsp;PublicKey&nbsp;represents&nbsp;an&nbsp;ECDSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4874002">type</span>&nbsp;<span class="ident" id="4874007">PublicKey</span>&nbsp;<span class="keyword" id="4874017">struct</span>&nbsp;<span class="op" id="4874024">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4874027">elliptic</span><span class="op" id="4874035">.</span><span class="ident" id="4874036">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4874043">X</span><span class="op" id="4874044">,</span>&nbsp;<span class="ident" id="4874046">Y</span>&nbsp;<span class="op" id="4874048">*</span><span class="ident" id="4874049">big</span><span class="op" id="4874052">.</span><span class="ident" id="4874053">Int</span><br>
<span class="lineno"></span><span class="op" id="4874057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4874060">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;ECDSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno">30</span><span class="keyword" id="4874106">type</span>&nbsp;<span class="ident" id="4874111">PrivateKey</span>&nbsp;<span class="keyword" id="4874122">struct</span>&nbsp;<span class="op" id="4874129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4874132">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4874143">D</span>&nbsp;<span class="op" id="4874145">*</span><span class="ident" id="4874146">big</span><span class="op" id="4874149">.</span><span class="ident" id="4874150">Int</span><br>
<span class="lineno"></span><span class="op" id="4874154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="4874157">type</span>&nbsp;<span class="ident" id="4874162">ecdsaSignature</span>&nbsp;<span class="keyword" id="4874177">struct</span>&nbsp;<span class="op" id="4874184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4874187">R</span><span class="op" id="4874188">,</span>&nbsp;<span class="ident" id="4874190">S</span>&nbsp;<span class="op" id="4874192">*</span><span class="ident" id="4874193">big</span><span class="op" id="4874196">.</span><span class="ident" id="4874197">Int</span><br>
<span class="lineno"></span><span class="op" id="4874201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4874204">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno">40</span><span class="keyword" id="4874260">func</span>&nbsp;<span class="op" id="4874265">(</span><span class="ident" id="4874266">priv</span>&nbsp;<span class="op" id="4874271">*</span><span class="ident" id="4874272">PrivateKey</span><span class="op" id="4874282">)</span>&nbsp;<span class="ident" id="4874284">Public</span><span class="op" id="4874290">(</span><span class="op" id="4874291">)</span>&nbsp;<span class="ident" id="4874293">crypto</span><span class="op" id="4874299">.</span><span class="ident" id="4874300">PublicKey</span>&nbsp;<span class="op" id="4874310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4874313">return</span>&nbsp;<span class="op" id="4874320">&amp;</span><span class="ident" id="4874321">priv</span><span class="op" id="4874325">.</span><span class="ident" id="4874326">PublicKey</span><br>
<span class="lineno"></span><span class="op" id="4874336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4874339">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;This&nbsp;method&nbsp;is</span><br>
<span class="lineno">45</span><span class="comment" id="4874413">//&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4874491">//&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign&nbsp;function&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4874568">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="4874581">func</span>&nbsp;<span class="op" id="4874586">(</span><span class="ident" id="4874587">priv</span>&nbsp;<span class="op" id="4874592">*</span><span class="ident" id="4874593">PrivateKey</span><span class="op" id="4874603">)</span>&nbsp;<span class="ident" id="4874605">Sign</span><span class="op" id="4874609">(</span><span class="ident" id="4874610">rand</span>&nbsp;<span class="ident" id="4874615">io</span><span class="op" id="4874617">.</span><span class="ident" id="4874618">Reader</span><span class="op" id="4874624">,</span>&nbsp;<span class="ident" id="4874626">msg</span>&nbsp;<span class="op" id="4874630">[</span><span class="op" id="4874631">]</span><span class="builtintype" id="4874632">byte</span><span class="op" id="4874636">,</span>&nbsp;<span class="ident" id="4874638">opts</span>&nbsp;<span class="ident" id="4874643">crypto</span><span class="op" id="4874649">.</span><span class="ident" id="4874650">SignerOpts</span><span class="op" id="4874660">)</span>&nbsp;<span class="op" id="4874662">(</span><span class="op" id="4874663">[</span><span class="op" id="4874664">]</span><span class="builtintype" id="4874665">byte</span><span class="op" id="4874669">,</span>&nbsp;<span class="builtintype" id="4874671">error</span><span class="op" id="4874676">)</span>&nbsp;<span class="op" id="4874678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4874681">r</span><span class="op" id="4874682">,</span>&nbsp;<span class="ident" id="4874684">s</span><span class="op" id="4874685">,</span>&nbsp;<span class="ident" id="4874687">err</span>&nbsp;<span class="op" id="4874691">:=</span>&nbsp;<span class="ident" id="4874694">Sign</span><span class="op" id="4874698">(</span><span class="ident" id="4874699">rand</span><span class="op" id="4874703">,</span>&nbsp;<span class="ident" id="4874705">priv</span><span class="op" id="4874709">,</span>&nbsp;<span class="ident" id="4874711">msg</span><span class="op" id="4874714">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4874717">if</span>&nbsp;<span class="ident" id="4874720">err</span>&nbsp;<span class="op" id="4874724">!=</span>&nbsp;<span class="ident" id="4874727">nil</span>&nbsp;<span class="op" id="4874731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4874735">return</span>&nbsp;<span class="ident" id="4874742">nil</span><span class="op" id="4874745">,</span>&nbsp;<span class="ident" id="4874747">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4874752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4874756">return</span>&nbsp;<span class="ident" id="4874763">asn1</span><span class="op" id="4874767">.</span><span class="ident" id="4874768">Marshal</span><span class="op" id="4874775">(</span><span class="ident" id="4874776">ecdsaSignature</span><span class="op" id="4874790">{</span><span class="ident" id="4874791">r</span><span class="op" id="4874792">,</span>&nbsp;<span class="ident" id="4874794">s</span><span class="op" id="4874795">}</span><span class="op" id="4874796">)</span><br>
<span class="lineno">55</span><span class="op" id="4874798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4874801">var</span>&nbsp;<span class="ident" id="4874805">one</span>&nbsp;<span class="op" id="4874809">=</span>&nbsp;<span class="builtinfunc" id="4874811">new</span><span class="op" id="4874814">(</span><span class="ident" id="4874815">big</span><span class="op" id="4874818">.</span><span class="ident" id="4874819">Int</span><span class="op" id="4874822">)</span><span class="op" id="4874823">.</span><span class="ident" id="4874824">SetInt64</span><span class="op" id="4874832">(</span><span class="num" id="4874833">1</span><span class="op" id="4874834">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4874837">//&nbsp;randFieldElement&nbsp;returns&nbsp;a&nbsp;random&nbsp;element&nbsp;of&nbsp;the&nbsp;field&nbsp;underlying&nbsp;the&nbsp;given</span><br>
<span class="lineno">60</span><span class="comment" id="4874916">//&nbsp;curve&nbsp;using&nbsp;the&nbsp;procedure&nbsp;given&nbsp;in&nbsp;[NSA]&nbsp;A.2.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4874967">func</span>&nbsp;<span class="ident" id="4874972">randFieldElement</span><span class="op" id="4874988">(</span><span class="ident" id="4874989">c</span>&nbsp;<span class="ident" id="4874991">elliptic</span><span class="op" id="4874999">.</span><span class="ident" id="4875000">Curve</span><span class="op" id="4875005">,</span>&nbsp;<span class="ident" id="4875007">rand</span>&nbsp;<span class="ident" id="4875012">io</span><span class="op" id="4875014">.</span><span class="ident" id="4875015">Reader</span><span class="op" id="4875021">)</span>&nbsp;<span class="op" id="4875023">(</span><span class="ident" id="4875024">k</span>&nbsp;<span class="op" id="4875026">*</span><span class="ident" id="4875027">big</span><span class="op" id="4875030">.</span><span class="ident" id="4875031">Int</span><span class="op" id="4875034">,</span>&nbsp;<span class="ident" id="4875036">err</span>&nbsp;<span class="builtintype" id="4875040">error</span><span class="op" id="4875045">)</span>&nbsp;<span class="op" id="4875047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4875050">params</span>&nbsp;<span class="op" id="4875057">:=</span>&nbsp;<span class="ident" id="4875060">c</span><span class="op" id="4875061">.</span><span class="ident" id="4875062">Params</span><span class="op" id="4875068">(</span><span class="op" id="4875069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4875072">b</span>&nbsp;<span class="op" id="4875074">:=</span>&nbsp;<span class="builtinfunc" id="4875077">make</span><span class="op" id="4875081">(</span><span class="op" id="4875082">[</span><span class="op" id="4875083">]</span><span class="builtintype" id="4875084">byte</span><span class="op" id="4875088">,</span>&nbsp;<span class="ident" id="4875090">params</span><span class="op" id="4875096">.</span><span class="ident" id="4875097">BitSize</span><span class="op" id="4875104">/</span><span class="num" id="4875105">8</span><span class="op" id="4875106">+</span><span class="num" id="4875107">8</span><span class="op" id="4875108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4875111">_</span><span class="op" id="4875112">,</span>&nbsp;<span class="ident" id="4875114">err</span>&nbsp;<span class="op" id="4875118">=</span>&nbsp;<span class="ident" id="4875120">io</span><span class="op" id="4875122">.</span><span class="ident" id="4875123">ReadFull</span><span class="op" id="4875131">(</span><span class="ident" id="4875132">rand</span><span class="op" id="4875136">,</span>&nbsp;<span class="ident" id="4875138">b</span><span class="op" id="4875139">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875142">if</span>&nbsp;<span class="ident" id="4875145">err</span>&nbsp;<span class="op" id="4875149">!=</span>&nbsp;<span class="ident" id="4875152">nil</span>&nbsp;<span class="op" id="4875156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875160">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4875168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4875172">k</span>&nbsp;<span class="op" id="4875174">=</span>&nbsp;<span class="builtinfunc" id="4875176">new</span><span class="op" id="4875179">(</span><span class="ident" id="4875180">big</span><span class="op" id="4875183">.</span><span class="ident" id="4875184">Int</span><span class="op" id="4875187">)</span><span class="op" id="4875188">.</span><span class="ident" id="4875189">SetBytes</span><span class="op" id="4875197">(</span><span class="ident" id="4875198">b</span><span class="op" id="4875199">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4875202">n</span>&nbsp;<span class="op" id="4875204">:=</span>&nbsp;<span class="builtinfunc" id="4875207">new</span><span class="op" id="4875210">(</span><span class="ident" id="4875211">big</span><span class="op" id="4875214">.</span><span class="ident" id="4875215">Int</span><span class="op" id="4875218">)</span><span class="op" id="4875219">.</span><span class="ident" id="4875220">Sub</span><span class="op" id="4875223">(</span><span class="ident" id="4875224">params</span><span class="op" id="4875230">.</span><span class="ident" id="4875231">N</span><span class="op" id="4875232">,</span>&nbsp;<span class="ident" id="4875234">one</span><span class="op" id="4875237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4875240">k</span><span class="op" id="4875241">.</span><span class="ident" id="4875242">Mod</span><span class="op" id="4875245">(</span><span class="ident" id="4875246">k</span><span class="op" id="4875247">,</span>&nbsp;<span class="ident" id="4875249">n</span><span class="op" id="4875250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4875253">k</span><span class="op" id="4875254">.</span><span class="ident" id="4875255">Add</span><span class="op" id="4875258">(</span><span class="ident" id="4875259">k</span><span class="op" id="4875260">,</span>&nbsp;<span class="ident" id="4875262">one</span><span class="op" id="4875265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875268">return</span><br>
<span class="lineno"></span><span class="op" id="4875275">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4875278">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&nbsp;and&nbsp;private&nbsp;key&nbsp;pair.</span><br>
<span class="lineno"></span><span class="keyword" id="4875334">func</span>&nbsp;<span class="ident" id="4875339">GenerateKey</span><span class="op" id="4875350">(</span><span class="ident" id="4875351">c</span>&nbsp;<span class="ident" id="4875353">elliptic</span><span class="op" id="4875361">.</span><span class="ident" id="4875362">Curve</span><span class="op" id="4875367">,</span>&nbsp;<span class="ident" id="4875369">rand</span>&nbsp;<span class="ident" id="4875374">io</span><span class="op" id="4875376">.</span><span class="ident" id="4875377">Reader</span><span class="op" id="4875383">)</span>&nbsp;<span class="op" id="4875385">(</span><span class="ident" id="4875386">priv</span>&nbsp;<span class="op" id="4875391">*</span><span class="ident" id="4875392">PrivateKey</span><span class="op" id="4875402">,</span>&nbsp;<span class="ident" id="4875404">err</span>&nbsp;<span class="builtintype" id="4875408">error</span><span class="op" id="4875413">)</span>&nbsp;<span class="op" id="4875415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4875418">k</span><span class="op" id="4875419">,</span>&nbsp;<span class="ident" id="4875421">err</span>&nbsp;<span class="op" id="4875425">:=</span>&nbsp;<span class="ident" id="4875428">randFieldElement</span><span class="op" id="4875444">(</span><span class="ident" id="4875445">c</span><span class="op" id="4875446">,</span>&nbsp;<span class="ident" id="4875448">rand</span><span class="op" id="4875452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875455">if</span>&nbsp;<span class="ident" id="4875458">err</span>&nbsp;<span class="op" id="4875462">!=</span>&nbsp;<span class="ident" id="4875465">nil</span>&nbsp;<span class="op" id="4875469">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875473">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4875481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4875485">priv</span>&nbsp;<span class="op" id="4875490">=</span>&nbsp;<span class="builtinfunc" id="4875492">new</span><span class="op" id="4875495">(</span><span class="ident" id="4875496">PrivateKey</span><span class="op" id="4875506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4875509">priv</span><span class="op" id="4875513">.</span><span class="ident" id="4875514">PublicKey</span><span class="op" id="4875523">.</span><span class="ident" id="4875524">Curve</span>&nbsp;<span class="op" id="4875530">=</span>&nbsp;<span class="ident" id="4875532">c</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4875535">priv</span><span class="op" id="4875539">.</span><span class="ident" id="4875540">D</span>&nbsp;<span class="op" id="4875542">=</span>&nbsp;<span class="ident" id="4875544">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4875547">priv</span><span class="op" id="4875551">.</span><span class="ident" id="4875552">PublicKey</span><span class="op" id="4875561">.</span><span class="ident" id="4875562">X</span><span class="op" id="4875563">,</span>&nbsp;<span class="ident" id="4875565">priv</span><span class="op" id="4875569">.</span><span class="ident" id="4875570">PublicKey</span><span class="op" id="4875579">.</span><span class="ident" id="4875580">Y</span>&nbsp;<span class="op" id="4875582">=</span>&nbsp;<span class="ident" id="4875584">c</span><span class="op" id="4875585">.</span><span class="ident" id="4875586">ScalarBaseMult</span><span class="op" id="4875600">(</span><span class="ident" id="4875601">k</span><span class="op" id="4875602">.</span><span class="ident" id="4875603">Bytes</span><span class="op" id="4875608">(</span><span class="op" id="4875609">)</span><span class="op" id="4875610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875613">return</span><br>
<span class="lineno"></span><span class="op" id="4875620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="4875623">//&nbsp;hashToInt&nbsp;converts&nbsp;a&nbsp;hash&nbsp;value&nbsp;to&nbsp;an&nbsp;integer.&nbsp;There&nbsp;is&nbsp;some&nbsp;disagreement</span><br>
<span class="lineno"></span><span class="comment" id="4875700">//&nbsp;about&nbsp;how&nbsp;this&nbsp;is&nbsp;done.&nbsp;[NSA]&nbsp;suggests&nbsp;that&nbsp;this&nbsp;is&nbsp;done&nbsp;in&nbsp;the&nbsp;obvious</span><br>
<span class="lineno"></span><span class="comment" id="4875775">//&nbsp;manner,&nbsp;but&nbsp;[SECG]&nbsp;truncates&nbsp;the&nbsp;hash&nbsp;to&nbsp;the&nbsp;bit-length&nbsp;of&nbsp;the&nbsp;curve&nbsp;order</span><br>
<span class="lineno"></span><span class="comment" id="4875853">//&nbsp;first.&nbsp;We&nbsp;follow&nbsp;[SECG]&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;OpenSSL&nbsp;does.&nbsp;Additionally,</span><br>
<span class="lineno"></span><span class="comment" id="4875928">//&nbsp;OpenSSL&nbsp;right&nbsp;shifts&nbsp;excess&nbsp;bits&nbsp;from&nbsp;the&nbsp;number&nbsp;if&nbsp;the&nbsp;hash&nbsp;is&nbsp;too&nbsp;large</span><br>
<span class="lineno">95</span><span class="comment" id="4876005">//&nbsp;and&nbsp;we&nbsp;mirror&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span><span class="keyword" id="4876032">func</span>&nbsp;<span class="ident" id="4876037">hashToInt</span><span class="op" id="4876046">(</span><span class="ident" id="4876047">hash</span>&nbsp;<span class="op" id="4876052">[</span><span class="op" id="4876053">]</span><span class="builtintype" id="4876054">byte</span><span class="op" id="4876058">,</span>&nbsp;<span class="ident" id="4876060">c</span>&nbsp;<span class="ident" id="4876062">elliptic</span><span class="op" id="4876070">.</span><span class="ident" id="4876071">Curve</span><span class="op" id="4876076">)</span>&nbsp;<span class="op" id="4876078">*</span><span class="ident" id="4876079">big</span><span class="op" id="4876082">.</span><span class="ident" id="4876083">Int</span>&nbsp;<span class="op" id="4876087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4876090">orderBits</span>&nbsp;<span class="op" id="4876100">:=</span>&nbsp;<span class="ident" id="4876103">c</span><span class="op" id="4876104">.</span><span class="ident" id="4876105">Params</span><span class="op" id="4876111">(</span><span class="op" id="4876112">)</span><span class="op" id="4876113">.</span><span class="ident" id="4876114">N</span><span class="op" id="4876115">.</span><span class="ident" id="4876116">BitLen</span><span class="op" id="4876122">(</span><span class="op" id="4876123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4876126">orderBytes</span>&nbsp;<span class="op" id="4876137">:=</span>&nbsp;<span class="op" id="4876140">(</span><span class="ident" id="4876141">orderBits</span>&nbsp;<span class="op" id="4876151">+</span>&nbsp;<span class="num" id="4876153">7</span><span class="op" id="4876154">)</span>&nbsp;<span class="op" id="4876156">/</span>&nbsp;<span class="num" id="4876158">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4876161">if</span>&nbsp;<span class="builtinfunc" id="4876164">len</span><span class="op" id="4876167">(</span><span class="ident" id="4876168">hash</span><span class="op" id="4876172">)</span>&nbsp;<span class="op" id="4876174">&gt;</span>&nbsp;<span class="ident" id="4876176">orderBytes</span>&nbsp;<span class="op" id="4876187">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4876191">hash</span>&nbsp;<span class="op" id="4876196">=</span>&nbsp;<span class="ident" id="4876198">hash</span><span class="op" id="4876202">[</span><span class="op" id="4876203">:</span><span class="ident" id="4876204">orderBytes</span><span class="op" id="4876214">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4876217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4876221">ret</span>&nbsp;<span class="op" id="4876225">:=</span>&nbsp;<span class="builtinfunc" id="4876228">new</span><span class="op" id="4876231">(</span><span class="ident" id="4876232">big</span><span class="op" id="4876235">.</span><span class="ident" id="4876236">Int</span><span class="op" id="4876239">)</span><span class="op" id="4876240">.</span><span class="ident" id="4876241">SetBytes</span><span class="op" id="4876249">(</span><span class="ident" id="4876250">hash</span><span class="op" id="4876254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4876257">excess</span>&nbsp;<span class="op" id="4876264">:=</span>&nbsp;<span class="builtinfunc" id="4876267">len</span><span class="op" id="4876270">(</span><span class="ident" id="4876271">hash</span><span class="op" id="4876275">)</span><span class="op" id="4876276">*</span><span class="num" id="4876277">8</span>&nbsp;<span class="op" id="4876279">-</span>&nbsp;<span class="ident" id="4876281">orderBits</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4876292">if</span>&nbsp;<span class="ident" id="4876295">excess</span>&nbsp;<span class="op" id="4876302">&gt;</span>&nbsp;<span class="num" id="4876304">0</span>&nbsp;<span class="op" id="4876306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4876310">ret</span><span class="op" id="4876313">.</span><span class="ident" id="4876314">Rsh</span><span class="op" id="4876317">(</span><span class="ident" id="4876318">ret</span><span class="op" id="4876321">,</span>&nbsp;<span class="builtintype" id="4876323">uint</span><span class="op" id="4876327">(</span><span class="ident" id="4876328">excess</span><span class="op" id="4876334">)</span><span class="op" id="4876335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4876338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4876341">return</span>&nbsp;<span class="ident" id="4876348">ret</span><br>
<span class="lineno"></span><span class="op" id="4876352">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4876355">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4876432">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4876510">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4876581">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">115</span><span class="keyword" id="4876619">func</span>&nbsp;<span class="ident" id="4876624">fermatInverse</span><span class="op" id="4876637">(</span><span class="ident" id="4876638">k</span><span class="op" id="4876639">,</span>&nbsp;<span class="ident" id="4876641">N</span>&nbsp;<span class="op" id="4876643">*</span><span class="ident" id="4876644">big</span><span class="op" id="4876647">.</span><span class="ident" id="4876648">Int</span><span class="op" id="4876651">)</span>&nbsp;<span class="op" id="4876653">*</span><span class="ident" id="4876654">big</span><span class="op" id="4876657">.</span><span class="ident" id="4876658">Int</span>&nbsp;<span class="op" id="4876662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4876665">two</span>&nbsp;<span class="op" id="4876669">:=</span>&nbsp;<span class="ident" id="4876672">big</span><span class="op" id="4876675">.</span><span class="ident" id="4876676">NewInt</span><span class="op" id="4876682">(</span><span class="num" id="4876683">2</span><span class="op" id="4876684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4876687">nMinus2</span>&nbsp;<span class="op" id="4876695">:=</span>&nbsp;<span class="builtinfunc" id="4876698">new</span><span class="op" id="4876701">(</span><span class="ident" id="4876702">big</span><span class="op" id="4876705">.</span><span class="ident" id="4876706">Int</span><span class="op" id="4876709">)</span><span class="op" id="4876710">.</span><span class="ident" id="4876711">Sub</span><span class="op" id="4876714">(</span><span class="ident" id="4876715">N</span><span class="op" id="4876716">,</span>&nbsp;<span class="ident" id="4876718">two</span><span class="op" id="4876721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4876724">return</span>&nbsp;<span class="builtinfunc" id="4876731">new</span><span class="op" id="4876734">(</span><span class="ident" id="4876735">big</span><span class="op" id="4876738">.</span><span class="ident" id="4876739">Int</span><span class="op" id="4876742">)</span><span class="op" id="4876743">.</span><span class="ident" id="4876744">Exp</span><span class="op" id="4876747">(</span><span class="ident" id="4876748">k</span><span class="op" id="4876749">,</span>&nbsp;<span class="ident" id="4876751">nMinus2</span><span class="op" id="4876758">,</span>&nbsp;<span class="ident" id="4876760">N</span><span class="op" id="4876761">)</span><br>
<span class="lineno"></span><span class="op" id="4876763">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="4876766">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4876846">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4876924">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4877003">//&nbsp;rand.</span><br>
<span class="lineno">125</span><span class="keyword" id="4877012">func</span>&nbsp;<span class="ident" id="4877017">Sign</span><span class="op" id="4877021">(</span><span class="ident" id="4877022">rand</span>&nbsp;<span class="ident" id="4877027">io</span><span class="op" id="4877029">.</span><span class="ident" id="4877030">Reader</span><span class="op" id="4877036">,</span>&nbsp;<span class="ident" id="4877038">priv</span>&nbsp;<span class="op" id="4877043">*</span><span class="ident" id="4877044">PrivateKey</span><span class="op" id="4877054">,</span>&nbsp;<span class="ident" id="4877056">hash</span>&nbsp;<span class="op" id="4877061">[</span><span class="op" id="4877062">]</span><span class="builtintype" id="4877063">byte</span><span class="op" id="4877067">)</span>&nbsp;<span class="op" id="4877069">(</span><span class="ident" id="4877070">r</span><span class="op" id="4877071">,</span>&nbsp;<span class="ident" id="4877073">s</span>&nbsp;<span class="op" id="4877075">*</span><span class="ident" id="4877076">big</span><span class="op" id="4877079">.</span><span class="ident" id="4877080">Int</span><span class="op" id="4877083">,</span>&nbsp;<span class="ident" id="4877085">err</span>&nbsp;<span class="builtintype" id="4877089">error</span><span class="op" id="4877094">)</span>&nbsp;<span class="op" id="4877096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4877099">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877119">c</span>&nbsp;<span class="op" id="4877121">:=</span>&nbsp;<span class="ident" id="4877124">priv</span><span class="op" id="4877128">.</span><span class="ident" id="4877129">PublicKey</span><span class="op" id="4877138">.</span><span class="ident" id="4877139">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877146">N</span>&nbsp;<span class="op" id="4877148">:=</span>&nbsp;<span class="ident" id="4877151">c</span><span class="op" id="4877152">.</span><span class="ident" id="4877153">Params</span><span class="op" id="4877159">(</span><span class="op" id="4877160">)</span><span class="op" id="4877161">.</span><span class="ident" id="4877162">N</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877166">var</span>&nbsp;<span class="ident" id="4877170">k</span><span class="op" id="4877171">,</span>&nbsp;<span class="ident" id="4877173">kInv</span>&nbsp;<span class="op" id="4877178">*</span><span class="ident" id="4877179">big</span><span class="op" id="4877182">.</span><span class="ident" id="4877183">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877188">for</span>&nbsp;<span class="op" id="4877192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877196">for</span>&nbsp;<span class="op" id="4877200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877205">k</span><span class="op" id="4877206">,</span>&nbsp;<span class="ident" id="4877208">err</span>&nbsp;<span class="op" id="4877212">=</span>&nbsp;<span class="ident" id="4877214">randFieldElement</span><span class="op" id="4877230">(</span><span class="ident" id="4877231">c</span><span class="op" id="4877232">,</span>&nbsp;<span class="ident" id="4877234">rand</span><span class="op" id="4877238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877243">if</span>&nbsp;<span class="ident" id="4877246">err</span>&nbsp;<span class="op" id="4877250">!=</span>&nbsp;<span class="ident" id="4877253">nil</span>&nbsp;<span class="op" id="4877257">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877263">r</span>&nbsp;<span class="op" id="4877265">=</span>&nbsp;<span class="ident" id="4877267">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877275">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4877285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877291">kInv</span>&nbsp;<span class="op" id="4877296">=</span>&nbsp;<span class="ident" id="4877298">fermatInverse</span><span class="op" id="4877311">(</span><span class="ident" id="4877312">k</span><span class="op" id="4877313">,</span>&nbsp;<span class="ident" id="4877315">N</span><span class="op" id="4877316">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877321">r</span><span class="op" id="4877322">,</span>&nbsp;<span class="ident" id="4877324">_</span>&nbsp;<span class="op" id="4877326">=</span>&nbsp;<span class="ident" id="4877328">priv</span><span class="op" id="4877332">.</span><span class="ident" id="4877333">Curve</span><span class="op" id="4877338">.</span><span class="ident" id="4877339">ScalarBaseMult</span><span class="op" id="4877353">(</span><span class="ident" id="4877354">k</span><span class="op" id="4877355">.</span><span class="ident" id="4877356">Bytes</span><span class="op" id="4877361">(</span><span class="op" id="4877362">)</span><span class="op" id="4877363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877368">r</span><span class="op" id="4877369">.</span><span class="ident" id="4877370">Mod</span><span class="op" id="4877373">(</span><span class="ident" id="4877374">r</span><span class="op" id="4877375">,</span>&nbsp;<span class="ident" id="4877377">N</span><span class="op" id="4877378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877383">if</span>&nbsp;<span class="ident" id="4877386">r</span><span class="op" id="4877387">.</span><span class="ident" id="4877388">Sign</span><span class="op" id="4877392">(</span><span class="op" id="4877393">)</span>&nbsp;<span class="op" id="4877395">!=</span>&nbsp;<span class="num" id="4877398">0</span>&nbsp;<span class="op" id="4877400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877406">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4877415">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4877419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877424">e</span>&nbsp;<span class="op" id="4877426">:=</span>&nbsp;<span class="ident" id="4877429">hashToInt</span><span class="op" id="4877438">(</span><span class="ident" id="4877439">hash</span><span class="op" id="4877443">,</span>&nbsp;<span class="ident" id="4877445">c</span><span class="op" id="4877446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877450">s</span>&nbsp;<span class="op" id="4877452">=</span>&nbsp;<span class="builtinfunc" id="4877454">new</span><span class="op" id="4877457">(</span><span class="ident" id="4877458">big</span><span class="op" id="4877461">.</span><span class="ident" id="4877462">Int</span><span class="op" id="4877465">)</span><span class="op" id="4877466">.</span><span class="ident" id="4877467">Mul</span><span class="op" id="4877470">(</span><span class="ident" id="4877471">priv</span><span class="op" id="4877475">.</span><span class="ident" id="4877476">D</span><span class="op" id="4877477">,</span>&nbsp;<span class="ident" id="4877479">r</span><span class="op" id="4877480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877484">s</span><span class="op" id="4877485">.</span><span class="ident" id="4877486">Add</span><span class="op" id="4877489">(</span><span class="ident" id="4877490">s</span><span class="op" id="4877491">,</span>&nbsp;<span class="ident" id="4877493">e</span><span class="op" id="4877494">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877498">s</span><span class="op" id="4877499">.</span><span class="ident" id="4877500">Mul</span><span class="op" id="4877503">(</span><span class="ident" id="4877504">s</span><span class="op" id="4877505">,</span>&nbsp;<span class="ident" id="4877507">kInv</span><span class="op" id="4877511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877515">s</span><span class="op" id="4877516">.</span><span class="ident" id="4877517">Mod</span><span class="op" id="4877520">(</span><span class="ident" id="4877521">s</span><span class="op" id="4877522">,</span>&nbsp;<span class="ident" id="4877524">N</span><span class="op" id="4877525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877529">if</span>&nbsp;<span class="ident" id="4877532">s</span><span class="op" id="4877533">.</span><span class="ident" id="4877534">Sign</span><span class="op" id="4877538">(</span><span class="op" id="4877539">)</span>&nbsp;<span class="op" id="4877541">!=</span>&nbsp;<span class="num" id="4877544">0</span>&nbsp;<span class="op" id="4877546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877551">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4877559">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4877562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877566">return</span><br>
<span class="lineno"></span><span class="op" id="4877573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="4877576">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;Its</span><br>
<span class="lineno"></span><span class="comment" id="4877656">//&nbsp;return&nbsp;value&nbsp;records&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4877712">func</span>&nbsp;<span class="ident" id="4877717">Verify</span><span class="op" id="4877723">(</span><span class="ident" id="4877724">pub</span>&nbsp;<span class="op" id="4877728">*</span><span class="ident" id="4877729">PublicKey</span><span class="op" id="4877738">,</span>&nbsp;<span class="ident" id="4877740">hash</span>&nbsp;<span class="op" id="4877745">[</span><span class="op" id="4877746">]</span><span class="builtintype" id="4877747">byte</span><span class="op" id="4877751">,</span>&nbsp;<span class="ident" id="4877753">r</span><span class="op" id="4877754">,</span>&nbsp;<span class="ident" id="4877756">s</span>&nbsp;<span class="op" id="4877758">*</span><span class="ident" id="4877759">big</span><span class="op" id="4877762">.</span><span class="ident" id="4877763">Int</span><span class="op" id="4877766">)</span>&nbsp;<span class="builtintype" id="4877768">bool</span>&nbsp;<span class="op" id="4877773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4877776">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877796">c</span>&nbsp;<span class="op" id="4877798">:=</span>&nbsp;<span class="ident" id="4877801">pub</span><span class="op" id="4877804">.</span><span class="ident" id="4877805">Curve</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877812">N</span>&nbsp;<span class="op" id="4877814">:=</span>&nbsp;<span class="ident" id="4877817">c</span><span class="op" id="4877818">.</span><span class="ident" id="4877819">Params</span><span class="op" id="4877825">(</span><span class="op" id="4877826">)</span><span class="op" id="4877827">.</span><span class="ident" id="4877828">N</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877832">if</span>&nbsp;<span class="ident" id="4877835">r</span><span class="op" id="4877836">.</span><span class="ident" id="4877837">Sign</span><span class="op" id="4877841">(</span><span class="op" id="4877842">)</span>&nbsp;<span class="op" id="4877844">==</span>&nbsp;<span class="num" id="4877847">0</span>&nbsp;<span class="op" id="4877849">||</span>&nbsp;<span class="ident" id="4877852">s</span><span class="op" id="4877853">.</span><span class="ident" id="4877854">Sign</span><span class="op" id="4877858">(</span><span class="op" id="4877859">)</span>&nbsp;<span class="op" id="4877861">==</span>&nbsp;<span class="num" id="4877864">0</span>&nbsp;<span class="op" id="4877866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877870">return</span>&nbsp;<span class="builtintype" id="4877877">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4877884">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877887">if</span>&nbsp;<span class="ident" id="4877890">r</span><span class="op" id="4877891">.</span><span class="ident" id="4877892">Cmp</span><span class="op" id="4877895">(</span><span class="ident" id="4877896">N</span><span class="op" id="4877897">)</span>&nbsp;<span class="op" id="4877899">&gt;=</span>&nbsp;<span class="num" id="4877902">0</span>&nbsp;<span class="op" id="4877904">||</span>&nbsp;<span class="ident" id="4877907">s</span><span class="op" id="4877908">.</span><span class="ident" id="4877909">Cmp</span><span class="op" id="4877912">(</span><span class="ident" id="4877913">N</span><span class="op" id="4877914">)</span>&nbsp;<span class="op" id="4877916">&gt;=</span>&nbsp;<span class="num" id="4877919">0</span>&nbsp;<span class="op" id="4877921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877925">return</span>&nbsp;<span class="builtintype" id="4877932">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4877939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877942">e</span>&nbsp;<span class="op" id="4877944">:=</span>&nbsp;<span class="ident" id="4877947">hashToInt</span><span class="op" id="4877956">(</span><span class="ident" id="4877957">hash</span><span class="op" id="4877961">,</span>&nbsp;<span class="ident" id="4877963">c</span><span class="op" id="4877964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877967">w</span>&nbsp;<span class="op" id="4877969">:=</span>&nbsp;<span class="builtinfunc" id="4877972">new</span><span class="op" id="4877975">(</span><span class="ident" id="4877976">big</span><span class="op" id="4877979">.</span><span class="ident" id="4877980">Int</span><span class="op" id="4877983">)</span><span class="op" id="4877984">.</span><span class="ident" id="4877985">ModInverse</span><span class="op" id="4877995">(</span><span class="ident" id="4877996">s</span><span class="op" id="4877997">,</span>&nbsp;<span class="ident" id="4877999">N</span><span class="op" id="4878000">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878004">u1</span>&nbsp;<span class="op" id="4878007">:=</span>&nbsp;<span class="ident" id="4878010">e</span><span class="op" id="4878011">.</span><span class="ident" id="4878012">Mul</span><span class="op" id="4878015">(</span><span class="ident" id="4878016">e</span><span class="op" id="4878017">,</span>&nbsp;<span class="ident" id="4878019">w</span><span class="op" id="4878020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878023">u1</span><span class="op" id="4878025">.</span><span class="ident" id="4878026">Mod</span><span class="op" id="4878029">(</span><span class="ident" id="4878030">u1</span><span class="op" id="4878032">,</span>&nbsp;<span class="ident" id="4878034">N</span><span class="op" id="4878035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878038">u2</span>&nbsp;<span class="op" id="4878041">:=</span>&nbsp;<span class="ident" id="4878044">w</span><span class="op" id="4878045">.</span><span class="ident" id="4878046">Mul</span><span class="op" id="4878049">(</span><span class="ident" id="4878050">r</span><span class="op" id="4878051">,</span>&nbsp;<span class="ident" id="4878053">w</span><span class="op" id="4878054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878057">u2</span><span class="op" id="4878059">.</span><span class="ident" id="4878060">Mod</span><span class="op" id="4878063">(</span><span class="ident" id="4878064">u2</span><span class="op" id="4878066">,</span>&nbsp;<span class="ident" id="4878068">N</span><span class="op" id="4878069">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878073">x1</span><span class="op" id="4878075">,</span>&nbsp;<span class="ident" id="4878077">y1</span>&nbsp;<span class="op" id="4878080">:=</span>&nbsp;<span class="ident" id="4878083">c</span><span class="op" id="4878084">.</span><span class="ident" id="4878085">ScalarBaseMult</span><span class="op" id="4878099">(</span><span class="ident" id="4878100">u1</span><span class="op" id="4878102">.</span><span class="ident" id="4878103">Bytes</span><span class="op" id="4878108">(</span><span class="op" id="4878109">)</span><span class="op" id="4878110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878113">x2</span><span class="op" id="4878115">,</span>&nbsp;<span class="ident" id="4878117">y2</span>&nbsp;<span class="op" id="4878120">:=</span>&nbsp;<span class="ident" id="4878123">c</span><span class="op" id="4878124">.</span><span class="ident" id="4878125">ScalarMult</span><span class="op" id="4878135">(</span><span class="ident" id="4878136">pub</span><span class="op" id="4878139">.</span><span class="ident" id="4878140">X</span><span class="op" id="4878141">,</span>&nbsp;<span class="ident" id="4878143">pub</span><span class="op" id="4878146">.</span><span class="ident" id="4878147">Y</span><span class="op" id="4878148">,</span>&nbsp;<span class="ident" id="4878150">u2</span><span class="op" id="4878152">.</span><span class="ident" id="4878153">Bytes</span><span class="op" id="4878158">(</span><span class="op" id="4878159">)</span><span class="op" id="4878160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878163">x</span><span class="op" id="4878164">,</span>&nbsp;<span class="ident" id="4878166">y</span>&nbsp;<span class="op" id="4878168">:=</span>&nbsp;<span class="ident" id="4878171">c</span><span class="op" id="4878172">.</span><span class="ident" id="4878173">Add</span><span class="op" id="4878176">(</span><span class="ident" id="4878177">x1</span><span class="op" id="4878179">,</span>&nbsp;<span class="ident" id="4878181">y1</span><span class="op" id="4878183">,</span>&nbsp;<span class="ident" id="4878185">x2</span><span class="op" id="4878187">,</span>&nbsp;<span class="ident" id="4878189">y2</span><span class="op" id="4878191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4878194">if</span>&nbsp;<span class="ident" id="4878197">x</span><span class="op" id="4878198">.</span><span class="ident" id="4878199">Sign</span><span class="op" id="4878203">(</span><span class="op" id="4878204">)</span>&nbsp;<span class="op" id="4878206">==</span>&nbsp;<span class="num" id="4878209">0</span>&nbsp;<span class="op" id="4878211">&amp;&amp;</span>&nbsp;<span class="ident" id="4878214">y</span><span class="op" id="4878215">.</span><span class="ident" id="4878216">Sign</span><span class="op" id="4878220">(</span><span class="op" id="4878221">)</span>&nbsp;<span class="op" id="4878223">==</span>&nbsp;<span class="num" id="4878226">0</span>&nbsp;<span class="op" id="4878228">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4878232">return</span>&nbsp;<span class="builtintype" id="4878239">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4878246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878249">x</span><span class="op" id="4878250">.</span><span class="ident" id="4878251">Mod</span><span class="op" id="4878254">(</span><span class="ident" id="4878255">x</span><span class="op" id="4878256">,</span>&nbsp;<span class="ident" id="4878258">N</span><span class="op" id="4878259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4878262">return</span>&nbsp;<span class="ident" id="4878269">x</span><span class="op" id="4878270">.</span><span class="ident" id="4878271">Cmp</span><span class="op" id="4878274">(</span><span class="ident" id="4878275">r</span><span class="op" id="4878276">)</span>&nbsp;<span class="op" id="4878278">==</span>&nbsp;<span class="num" id="4878281">0</span><br>
<span class="lineno"></span><span class="op" id="4878283">}</span>
</div>
</body>
</html>
