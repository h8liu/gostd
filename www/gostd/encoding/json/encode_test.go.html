<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html" class="current">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6522677">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6522732">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6522786">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6522837">package</span>&nbsp;<span class="ident" id="6522845">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6522851">import</span>&nbsp;<span class="op" id="6522858">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6522861">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6522870">&#34;math&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6522878">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6522889">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6522900">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="6522910">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6522913">type</span>&nbsp;<span class="ident" id="6522918">Optionals</span>&nbsp;<span class="keyword" id="6522928">struct</span>&nbsp;<span class="op" id="6522935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6522938">Sr</span>&nbsp;<span class="builtintype" id="6522941">string</span>&nbsp;<span class="string" id="6522948">`json:&#34;sr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6522961">So</span>&nbsp;<span class="builtintype" id="6522964">string</span>&nbsp;<span class="string" id="6522971">`json:&#34;so,omitempty&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6522994">Sw</span>&nbsp;<span class="builtintype" id="6522997">string</span>&nbsp;<span class="string" id="6523004">`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523017">Ir</span>&nbsp;<span class="builtintype" id="6523020">int</span>&nbsp;<span class="string" id="6523024">`json:&#34;omitempty&#34;`</span>&nbsp;<span class="comment" id="6523043">//&nbsp;actually&nbsp;named&nbsp;omitempty,&nbsp;not&nbsp;an&nbsp;option</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523087">Io</span>&nbsp;<span class="builtintype" id="6523090">int</span>&nbsp;<span class="string" id="6523094">`json:&#34;io,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523118">Slr</span>&nbsp;<span class="op" id="6523122">[</span><span class="op" id="6523123">]</span><span class="builtintype" id="6523124">string</span>&nbsp;<span class="string" id="6523131">`json:&#34;slr,random&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523152">Slo</span>&nbsp;<span class="op" id="6523156">[</span><span class="op" id="6523157">]</span><span class="builtintype" id="6523158">string</span>&nbsp;<span class="string" id="6523165">`json:&#34;slo,omitempty&#34;`</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523190">Mr</span>&nbsp;<span class="keyword" id="6523193">map</span><span class="op" id="6523196">[</span><span class="builtintype" id="6523197">string</span><span class="op" id="6523203">]</span><span class="keyword" id="6523204">interface</span><span class="op" id="6523213">{</span><span class="op" id="6523214">}</span>&nbsp;<span class="string" id="6523216">`json:&#34;mr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523229">Mo</span>&nbsp;<span class="keyword" id="6523232">map</span><span class="op" id="6523235">[</span><span class="builtintype" id="6523236">string</span><span class="op" id="6523242">]</span><span class="keyword" id="6523243">interface</span><span class="op" id="6523252">{</span><span class="op" id="6523253">}</span>&nbsp;<span class="string" id="6523255">`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523277">Fr</span>&nbsp;<span class="builtintype" id="6523280">float64</span>&nbsp;<span class="string" id="6523288">`json:&#34;fr&#34;`</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523301">Fo</span>&nbsp;<span class="builtintype" id="6523304">float64</span>&nbsp;<span class="string" id="6523312">`json:&#34;fo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523336">Br</span>&nbsp;<span class="builtintype" id="6523339">bool</span>&nbsp;<span class="string" id="6523344">`json:&#34;br&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523357">Bo</span>&nbsp;<span class="builtintype" id="6523360">bool</span>&nbsp;<span class="string" id="6523365">`json:&#34;bo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523389">Ur</span>&nbsp;<span class="builtintype" id="6523392">uint</span>&nbsp;<span class="string" id="6523397">`json:&#34;ur&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523410">Uo</span>&nbsp;<span class="builtintype" id="6523413">uint</span>&nbsp;<span class="string" id="6523418">`json:&#34;uo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523442">Str</span>&nbsp;<span class="keyword" id="6523446">struct</span><span class="op" id="6523452">{</span><span class="op" id="6523453">}</span>&nbsp;<span class="string" id="6523455">`json:&#34;str&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523469">Sto</span>&nbsp;<span class="keyword" id="6523473">struct</span><span class="op" id="6523479">{</span><span class="op" id="6523480">}</span>&nbsp;<span class="string" id="6523482">`json:&#34;sto,omitempty&#34;`</span><br>
<span class="lineno">40</span><span class="op" id="6523505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6523508">var</span>&nbsp;<span class="ident" id="6523512">optionalsExpected</span>&nbsp;<span class="op" id="6523530">=</span>&nbsp;<span class="string" id="6523532">`{<br>
<span class="lineno"></span>&nbsp;&#34;sr&#34;:&nbsp;&#34;&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;omitempty&#34;:&nbsp;0,<br>
<span class="lineno">45</span>&nbsp;&#34;slr&#34;:&nbsp;null,<br>
<span class="lineno"></span>&nbsp;&#34;mr&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;fr&#34;:&nbsp;0,<br>
<span class="lineno"></span>&nbsp;&#34;br&#34;:&nbsp;false,<br>
<span class="lineno"></span>&nbsp;&#34;ur&#34;:&nbsp;0,<br>
<span class="lineno">50</span>&nbsp;&#34;str&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;sto&#34;:&nbsp;{}<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6523649">func</span>&nbsp;<span class="ident" id="6523654">TestOmitEmpty</span><span class="op" id="6523667">(</span><span class="ident" id="6523668">t</span>&nbsp;<span class="op" id="6523670">*</span><span class="ident" id="6523671">testing</span><span class="op" id="6523678">.</span><span class="ident" id="6523679">T</span><span class="op" id="6523680">)</span>&nbsp;<span class="op" id="6523682">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6523685">var</span>&nbsp;<span class="ident" id="6523689">o</span>&nbsp;<span class="ident" id="6523691">Optionals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523702">o</span><span class="op" id="6523703">.</span><span class="ident" id="6523704">Sw</span>&nbsp;<span class="op" id="6523707">=</span>&nbsp;<span class="string" id="6523709">&#34;something&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523722">o</span><span class="op" id="6523723">.</span><span class="ident" id="6523724">Mr</span>&nbsp;<span class="op" id="6523727">=</span>&nbsp;<span class="keyword" id="6523729">map</span><span class="op" id="6523732">[</span><span class="builtintype" id="6523733">string</span><span class="op" id="6523739">]</span><span class="keyword" id="6523740">interface</span><span class="op" id="6523749">{</span><span class="op" id="6523750">}</span><span class="op" id="6523751">{</span><span class="op" id="6523752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523755">o</span><span class="op" id="6523756">.</span><span class="ident" id="6523757">Mo</span>&nbsp;<span class="op" id="6523760">=</span>&nbsp;<span class="keyword" id="6523762">map</span><span class="op" id="6523765">[</span><span class="builtintype" id="6523766">string</span><span class="op" id="6523772">]</span><span class="keyword" id="6523773">interface</span><span class="op" id="6523782">{</span><span class="op" id="6523783">}</span><span class="op" id="6523784">{</span><span class="op" id="6523785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523789">got</span><span class="op" id="6523792">,</span>&nbsp;<span class="ident" id="6523794">err</span>&nbsp;<span class="op" id="6523798">:=</span>&nbsp;<span class="ident" id="6523801">MarshalIndent</span><span class="op" id="6523814">(</span><span class="op" id="6523815">&amp;</span><span class="ident" id="6523816">o</span><span class="op" id="6523817">,</span>&nbsp;<span class="string" id="6523819">&#34;&#34;</span><span class="op" id="6523821">,</span>&nbsp;<span class="string" id="6523823">&#34;&nbsp;&#34;</span><span class="op" id="6523826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6523829">if</span>&nbsp;<span class="ident" id="6523832">err</span>&nbsp;<span class="op" id="6523836">!=</span>&nbsp;<span class="ident" id="6523839">nil</span>&nbsp;<span class="op" id="6523843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523847">t</span><span class="op" id="6523848">.</span><span class="ident" id="6523849">Fatal</span><span class="op" id="6523854">(</span><span class="ident" id="6523855">err</span><span class="op" id="6523858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6523861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6523864">if</span>&nbsp;<span class="ident" id="6523867">got</span>&nbsp;<span class="op" id="6523871">:=</span>&nbsp;<span class="builtintype" id="6523874">string</span><span class="op" id="6523880">(</span><span class="ident" id="6523881">got</span><span class="op" id="6523884">)</span><span class="op" id="6523885">;</span>&nbsp;<span class="ident" id="6523887">got</span>&nbsp;<span class="op" id="6523891">!=</span>&nbsp;<span class="ident" id="6523894">optionalsExpected</span>&nbsp;<span class="op" id="6523912">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6523916">t</span><span class="op" id="6523917">.</span><span class="ident" id="6523918">Errorf</span><span class="op" id="6523924">(</span><span class="string" id="6523925">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="6523947">,</span>&nbsp;<span class="ident" id="6523949">got</span><span class="op" id="6523952">,</span>&nbsp;<span class="ident" id="6523954">optionalsExpected</span><span class="op" id="6523971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6523974">}</span><br>
<span class="lineno"></span><span class="op" id="6523976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6523979">type</span>&nbsp;<span class="ident" id="6523984">StringTag</span>&nbsp;<span class="keyword" id="6523994">struct</span>&nbsp;<span class="op" id="6524001">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6524004">BoolStr</span>&nbsp;<span class="builtintype" id="6524012">bool</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6524019">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6524037">IntStr</span>&nbsp;&nbsp;<span class="ident" id="6524045">int64</span>&nbsp;&nbsp;<span class="string" id="6524052">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6524070">StrStr</span>&nbsp;&nbsp;<span class="builtintype" id="6524078">string</span>&nbsp;<span class="string" id="6524085">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6524102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6524105">var</span>&nbsp;<span class="ident" id="6524109">stringTagExpected</span>&nbsp;<span class="op" id="6524127">=</span>&nbsp;<span class="string" id="6524129">`{<br>
<span class="lineno"></span>&nbsp;&#34;BoolStr&#34;:&nbsp;&#34;true&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;IntStr&#34;:&nbsp;&#34;42&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;StrStr&#34;:&nbsp;&#34;\&#34;xzbit\&#34;&#34;<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="6524196">func</span>&nbsp;<span class="ident" id="6524201">TestStringTag</span><span class="op" id="6524214">(</span><span class="ident" id="6524215">t</span>&nbsp;<span class="op" id="6524217">*</span><span class="ident" id="6524218">testing</span><span class="op" id="6524225">.</span><span class="ident" id="6524226">T</span><span class="op" id="6524227">)</span>&nbsp;<span class="op" id="6524229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6524232">var</span>&nbsp;<span class="ident" id="6524236">s</span>&nbsp;<span class="ident" id="6524238">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6524249">s</span><span class="op" id="6524250">.</span><span class="ident" id="6524251">BoolStr</span>&nbsp;<span class="op" id="6524259">=</span>&nbsp;<span class="builtintype" id="6524261">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6524267">s</span><span class="op" id="6524268">.</span><span class="ident" id="6524269">IntStr</span>&nbsp;<span class="op" id="6524276">=</span>&nbsp;<span class="num" id="6524278">42</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6524282">s</span><span class="op" id="6524283">.</span><span class="ident" id="6524284">StrStr</span>&nbsp;<span class="op" id="6524291">=</span>&nbsp;<span class="string" id="6524293">&#34;xzbit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6524302">got</span><span class="op" id="6524305">,</span>&nbsp;<span class="ident" id="6524307">err</span>&nbsp;<span class="op" id="6524311">:=</span>&nbsp;<span class="ident" id="6524314">MarshalIndent</span><span class="op" id="6524327">(</span><span class="op" id="6524328">&amp;</span><span class="ident" id="6524329">s</span><span class="op" id="6524330">,</span>&nbsp;<span class="string" id="6524332">&#34;&#34;</span><span class="op" id="6524334">,</span>&nbsp;<span class="string" id="6524336">&#34;&nbsp;&#34;</span><span class="op" id="6524339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6524342">if</span>&nbsp;<span class="ident" id="6524345">err</span>&nbsp;<span class="op" id="6524349">!=</span>&nbsp;<span class="ident" id="6524352">nil</span>&nbsp;<span class="op" id="6524356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6524360">t</span><span class="op" id="6524361">.</span><span class="ident" id="6524362">Fatal</span><span class="op" id="6524367">(</span><span class="ident" id="6524368">err</span><span class="op" id="6524371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6524374">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6524377">if</span>&nbsp;<span class="ident" id="6524380">got</span>&nbsp;<span class="op" id="6524384">:=</span>&nbsp;<span class="builtintype" id="6524387">string</span><span class="op" id="6524393">(</span><span class="ident" id="6524394">got</span><span class="op" id="6524397">)</span><span class="op" id="6524398">;</span>&nbsp;<span class="ident" id="6524400">got</span>&nbsp;<span class="op" id="6524404">!=</span>&nbsp;<span class="ident" id="6524407">stringTagExpected</span>&nbsp;<span class="op" id="6524425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6524429">t</span><span class="op" id="6524430">.</span><span class="ident" id="6524431">Fatalf</span><span class="op" id="6524437">(</span><span class="string" id="6524438">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="6524460">,</span>&nbsp;<span class="ident" id="6524462">got</span><span class="op" id="6524465">,</span>&nbsp;<span class="ident" id="6524467">stringTagExpected</span><span class="op" id="6524484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6524487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6524491">//&nbsp;Verify&nbsp;that&nbsp;it&nbsp;round-trips.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6524523">var</span>&nbsp;<span class="ident" id="6524527">s2</span>&nbsp;<span class="ident" id="6524530">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6524541">err</span>&nbsp;<span class="op" id="6524545">=</span>&nbsp;<span class="ident" id="6524547">NewDecoder</span><span class="op" id="6524557">(</span><span class="ident" id="6524558">bytes</span><span class="op" id="6524563">.</span><span class="ident" id="6524564">NewReader</span><span class="op" id="6524573">(</span><span class="ident" id="6524574">got</span><span class="op" id="6524577">)</span><span class="op" id="6524578">)</span><span class="op" id="6524579">.</span><span class="ident" id="6524580">Decode</span><span class="op" id="6524586">(</span><span class="op" id="6524587">&amp;</span><span class="ident" id="6524588">s2</span><span class="op" id="6524590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6524593">if</span>&nbsp;<span class="ident" id="6524596">err</span>&nbsp;<span class="op" id="6524600">!=</span>&nbsp;<span class="ident" id="6524603">nil</span>&nbsp;<span class="op" id="6524607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6524611">t</span><span class="op" id="6524612">.</span><span class="ident" id="6524613">Fatalf</span><span class="op" id="6524619">(</span><span class="string" id="6524620">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="6524632">,</span>&nbsp;<span class="ident" id="6524634">err</span><span class="op" id="6524637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6524640">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6524643">if</span>&nbsp;<span class="op" id="6524646">!</span><span class="ident" id="6524647">reflect</span><span class="op" id="6524654">.</span><span class="ident" id="6524655">DeepEqual</span><span class="op" id="6524664">(</span><span class="ident" id="6524665">s</span><span class="op" id="6524666">,</span>&nbsp;<span class="ident" id="6524668">s2</span><span class="op" id="6524670">)</span>&nbsp;<span class="op" id="6524672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6524676">t</span><span class="op" id="6524677">.</span><span class="ident" id="6524678">Fatalf</span><span class="op" id="6524684">(</span><span class="string" id="6524685">&#34;decode&nbsp;didn&#39;t&nbsp;match.\nsource:&nbsp;%#v\nEncoded&nbsp;as:\n%s\ndecode:&nbsp;%#v&#34;</span><span class="op" id="6524750">,</span>&nbsp;<span class="ident" id="6524752">s</span><span class="op" id="6524753">,</span>&nbsp;<span class="builtintype" id="6524755">string</span><span class="op" id="6524761">(</span><span class="ident" id="6524762">got</span><span class="op" id="6524765">)</span><span class="op" id="6524766">,</span>&nbsp;<span class="ident" id="6524768">s2</span><span class="op" id="6524770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6524773">}</span><br>
<span class="lineno"></span><span class="op" id="6524775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="6524778">//&nbsp;byte&nbsp;slices&nbsp;are&nbsp;special&nbsp;even&nbsp;if&nbsp;they&#39;re&nbsp;renamed&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="6524836">type</span>&nbsp;<span class="ident" id="6524841">renamedByte</span>&nbsp;<span class="builtintype" id="6524853">byte</span><br>
<span class="lineno"></span><span class="keyword" id="6524858">type</span>&nbsp;<span class="ident" id="6524863">renamedByteSlice</span>&nbsp;<span class="op" id="6524880">[</span><span class="op" id="6524881">]</span><span class="builtintype" id="6524882">byte</span><br>
<span class="lineno"></span><span class="keyword" id="6524887">type</span>&nbsp;<span class="ident" id="6524892">renamedRenamedByteSlice</span>&nbsp;<span class="op" id="6524916">[</span><span class="op" id="6524917">]</span><span class="ident" id="6524918">renamedByte</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6524931">func</span>&nbsp;<span class="ident" id="6524936">TestEncodeRenamedByteSlice</span><span class="op" id="6524962">(</span><span class="ident" id="6524963">t</span>&nbsp;<span class="op" id="6524965">*</span><span class="ident" id="6524966">testing</span><span class="op" id="6524973">.</span><span class="ident" id="6524974">T</span><span class="op" id="6524975">)</span>&nbsp;<span class="op" id="6524977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6524980">s</span>&nbsp;<span class="op" id="6524982">:=</span>&nbsp;<span class="ident" id="6524985">renamedByteSlice</span><span class="op" id="6525001">(</span><span class="string" id="6525002">&#34;abc&#34;</span><span class="op" id="6525007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6525010">result</span><span class="op" id="6525016">,</span>&nbsp;<span class="ident" id="6525018">err</span>&nbsp;<span class="op" id="6525022">:=</span>&nbsp;<span class="ident" id="6525025">Marshal</span><span class="op" id="6525032">(</span><span class="ident" id="6525033">s</span><span class="op" id="6525034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6525037">if</span>&nbsp;<span class="ident" id="6525040">err</span>&nbsp;<span class="op" id="6525044">!=</span>&nbsp;<span class="ident" id="6525047">nil</span>&nbsp;<span class="op" id="6525051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6525055">t</span><span class="op" id="6525056">.</span><span class="ident" id="6525057">Fatal</span><span class="op" id="6525062">(</span><span class="ident" id="6525063">err</span><span class="op" id="6525066">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6525069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6525072">expect</span>&nbsp;<span class="op" id="6525079">:=</span>&nbsp;<span class="string" id="6525082">`&#34;YWJj&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6525092">if</span>&nbsp;<span class="builtintype" id="6525095">string</span><span class="op" id="6525101">(</span><span class="ident" id="6525102">result</span><span class="op" id="6525108">)</span>&nbsp;<span class="op" id="6525110">!=</span>&nbsp;<span class="ident" id="6525113">expect</span>&nbsp;<span class="op" id="6525120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6525124">t</span><span class="op" id="6525125">.</span><span class="ident" id="6525126">Errorf</span><span class="op" id="6525132">(</span><span class="string" id="6525133">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6525150">,</span>&nbsp;<span class="ident" id="6525152">result</span><span class="op" id="6525158">,</span>&nbsp;<span class="ident" id="6525160">expect</span><span class="op" id="6525166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6525169">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6525172">r</span>&nbsp;<span class="op" id="6525174">:=</span>&nbsp;<span class="ident" id="6525177">renamedRenamedByteSlice</span><span class="op" id="6525200">(</span><span class="string" id="6525201">&#34;abc&#34;</span><span class="op" id="6525206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6525209">result</span><span class="op" id="6525215">,</span>&nbsp;<span class="ident" id="6525217">err</span>&nbsp;<span class="op" id="6525221">=</span>&nbsp;<span class="ident" id="6525223">Marshal</span><span class="op" id="6525230">(</span><span class="ident" id="6525231">r</span><span class="op" id="6525232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6525235">if</span>&nbsp;<span class="ident" id="6525238">err</span>&nbsp;<span class="op" id="6525242">!=</span>&nbsp;<span class="ident" id="6525245">nil</span>&nbsp;<span class="op" id="6525249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6525253">t</span><span class="op" id="6525254">.</span><span class="ident" id="6525255">Fatal</span><span class="op" id="6525260">(</span><span class="ident" id="6525261">err</span><span class="op" id="6525264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6525267">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6525270">if</span>&nbsp;<span class="builtintype" id="6525273">string</span><span class="op" id="6525279">(</span><span class="ident" id="6525280">result</span><span class="op" id="6525286">)</span>&nbsp;<span class="op" id="6525288">!=</span>&nbsp;<span class="ident" id="6525291">expect</span>&nbsp;<span class="op" id="6525298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6525302">t</span><span class="op" id="6525303">.</span><span class="ident" id="6525304">Errorf</span><span class="op" id="6525310">(</span><span class="string" id="6525311">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6525328">,</span>&nbsp;<span class="ident" id="6525330">result</span><span class="op" id="6525336">,</span>&nbsp;<span class="ident" id="6525338">expect</span><span class="op" id="6525344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6525347">}</span><br>
<span class="lineno"></span><span class="op" id="6525349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6525352">var</span>&nbsp;<span class="ident" id="6525356">unsupportedValues</span>&nbsp;<span class="op" id="6525374">=</span>&nbsp;<span class="op" id="6525376">[</span><span class="op" id="6525377">]</span><span class="keyword" id="6525378">interface</span><span class="op" id="6525387">{</span><span class="op" id="6525388">}</span><span class="op" id="6525389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6525392">math</span><span class="op" id="6525396">.</span><span class="ident" id="6525397">NaN</span><span class="op" id="6525400">(</span><span class="op" id="6525401">)</span><span class="op" id="6525402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6525405">math</span><span class="op" id="6525409">.</span><span class="ident" id="6525410">Inf</span><span class="op" id="6525413">(</span><span class="op" id="6525414">-</span><span class="num" id="6525415">1</span><span class="op" id="6525416">)</span><span class="op" id="6525417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6525420">math</span><span class="op" id="6525424">.</span><span class="ident" id="6525425">Inf</span><span class="op" id="6525428">(</span><span class="num" id="6525429">1</span><span class="op" id="6525430">)</span><span class="op" id="6525431">,</span><br>
<span class="lineno"></span><span class="op" id="6525433">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="6525436">func</span>&nbsp;<span class="ident" id="6525441">TestUnsupportedValues</span><span class="op" id="6525462">(</span><span class="ident" id="6525463">t</span>&nbsp;<span class="op" id="6525465">*</span><span class="ident" id="6525466">testing</span><span class="op" id="6525473">.</span><span class="ident" id="6525474">T</span><span class="op" id="6525475">)</span>&nbsp;<span class="op" id="6525477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6525480">for</span>&nbsp;<span class="ident" id="6525484">_</span><span class="op" id="6525485">,</span>&nbsp;<span class="ident" id="6525487">v</span>&nbsp;<span class="op" id="6525489">:=</span>&nbsp;<span class="keyword" id="6525492">range</span>&nbsp;<span class="ident" id="6525498">unsupportedValues</span>&nbsp;<span class="op" id="6525516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6525520">if</span>&nbsp;<span class="ident" id="6525523">_</span><span class="op" id="6525524">,</span>&nbsp;<span class="ident" id="6525526">err</span>&nbsp;<span class="op" id="6525530">:=</span>&nbsp;<span class="ident" id="6525533">Marshal</span><span class="op" id="6525540">(</span><span class="ident" id="6525541">v</span><span class="op" id="6525542">)</span><span class="op" id="6525543">;</span>&nbsp;<span class="ident" id="6525545">err</span>&nbsp;<span class="op" id="6525549">!=</span>&nbsp;<span class="ident" id="6525552">nil</span>&nbsp;<span class="op" id="6525556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6525561">if</span>&nbsp;<span class="ident" id="6525564">_</span><span class="op" id="6525565">,</span>&nbsp;<span class="ident" id="6525567">ok</span>&nbsp;<span class="op" id="6525570">:=</span>&nbsp;<span class="ident" id="6525573">err</span><span class="op" id="6525576">.</span><span class="op" id="6525577">(</span><span class="op" id="6525578">*</span><span class="ident" id="6525579">UnsupportedValueError</span><span class="op" id="6525600">)</span><span class="op" id="6525601">;</span>&nbsp;<span class="op" id="6525603">!</span><span class="ident" id="6525604">ok</span>&nbsp;<span class="op" id="6525607">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6525613">t</span><span class="op" id="6525614">.</span><span class="ident" id="6525615">Errorf</span><span class="op" id="6525621">(</span><span class="string" id="6525622">&#34;for&nbsp;%v,&nbsp;got&nbsp;%T&nbsp;want&nbsp;UnsupportedValueError&#34;</span><span class="op" id="6525665">,</span>&nbsp;<span class="ident" id="6525667">v</span><span class="op" id="6525668">,</span>&nbsp;<span class="ident" id="6525670">err</span><span class="op" id="6525673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6525678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6525682">}</span>&nbsp;<span class="keyword" id="6525684">else</span>&nbsp;<span class="op" id="6525689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6525694">t</span><span class="op" id="6525695">.</span><span class="ident" id="6525696">Errorf</span><span class="op" id="6525702">(</span><span class="string" id="6525703">&#34;for&nbsp;%v,&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6525727">,</span>&nbsp;<span class="ident" id="6525729">v</span><span class="op" id="6525730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6525734">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6525737">}</span><br>
<span class="lineno"></span><span class="op" id="6525739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6525742">//&nbsp;Ref&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="6525810">type</span>&nbsp;<span class="ident" id="6525815">Ref</span>&nbsp;<span class="builtintype" id="6525819">int</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="6525824">func</span>&nbsp;<span class="op" id="6525829">(</span><span class="op" id="6525830">*</span><span class="ident" id="6525831">Ref</span><span class="op" id="6525834">)</span>&nbsp;<span class="ident" id="6525836">MarshalJSON</span><span class="op" id="6525847">(</span><span class="op" id="6525848">)</span>&nbsp;<span class="op" id="6525850">(</span><span class="op" id="6525851">[</span><span class="op" id="6525852">]</span><span class="builtintype" id="6525853">byte</span><span class="op" id="6525857">,</span>&nbsp;<span class="builtintype" id="6525859">error</span><span class="op" id="6525864">)</span>&nbsp;<span class="op" id="6525866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6525869">return</span>&nbsp;<span class="op" id="6525876">[</span><span class="op" id="6525877">]</span><span class="builtintype" id="6525878">byte</span><span class="op" id="6525882">(</span><span class="string" id="6525883">`&#34;ref&#34;`</span><span class="op" id="6525890">)</span><span class="op" id="6525891">,</span>&nbsp;<span class="ident" id="6525893">nil</span><br>
<span class="lineno"></span><span class="op" id="6525897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="6525900">func</span>&nbsp;<span class="op" id="6525905">(</span><span class="ident" id="6525906">r</span>&nbsp;<span class="op" id="6525908">*</span><span class="ident" id="6525909">Ref</span><span class="op" id="6525912">)</span>&nbsp;<span class="ident" id="6525914">UnmarshalJSON</span><span class="op" id="6525927">(</span><span class="op" id="6525928">[</span><span class="op" id="6525929">]</span><span class="builtintype" id="6525930">byte</span><span class="op" id="6525934">)</span>&nbsp;<span class="builtintype" id="6525936">error</span>&nbsp;<span class="op" id="6525942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6525945">*</span><span class="ident" id="6525946">r</span>&nbsp;<span class="op" id="6525948">=</span>&nbsp;<span class="num" id="6525950">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6525954">return</span>&nbsp;<span class="ident" id="6525961">nil</span><br>
<span class="lineno"></span><span class="op" id="6525965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6525968">//&nbsp;Val&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="6526018">type</span>&nbsp;<span class="ident" id="6526023">Val</span>&nbsp;<span class="builtintype" id="6526027">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6526032">func</span>&nbsp;<span class="op" id="6526037">(</span><span class="ident" id="6526038">Val</span><span class="op" id="6526041">)</span>&nbsp;<span class="ident" id="6526043">MarshalJSON</span><span class="op" id="6526054">(</span><span class="op" id="6526055">)</span>&nbsp;<span class="op" id="6526057">(</span><span class="op" id="6526058">[</span><span class="op" id="6526059">]</span><span class="builtintype" id="6526060">byte</span><span class="op" id="6526064">,</span>&nbsp;<span class="builtintype" id="6526066">error</span><span class="op" id="6526071">)</span>&nbsp;<span class="op" id="6526073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6526076">return</span>&nbsp;<span class="op" id="6526083">[</span><span class="op" id="6526084">]</span><span class="builtintype" id="6526085">byte</span><span class="op" id="6526089">(</span><span class="string" id="6526090">`&#34;val&#34;`</span><span class="op" id="6526097">)</span><span class="op" id="6526098">,</span>&nbsp;<span class="ident" id="6526100">nil</span><br>
<span class="lineno">165</span><span class="op" id="6526104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6526107">//&nbsp;RefText&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="6526179">type</span>&nbsp;<span class="ident" id="6526184">RefText</span>&nbsp;<span class="builtintype" id="6526192">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="6526197">func</span>&nbsp;<span class="op" id="6526202">(</span><span class="op" id="6526203">*</span><span class="ident" id="6526204">RefText</span><span class="op" id="6526211">)</span>&nbsp;<span class="ident" id="6526213">MarshalText</span><span class="op" id="6526224">(</span><span class="op" id="6526225">)</span>&nbsp;<span class="op" id="6526227">(</span><span class="op" id="6526228">[</span><span class="op" id="6526229">]</span><span class="builtintype" id="6526230">byte</span><span class="op" id="6526234">,</span>&nbsp;<span class="builtintype" id="6526236">error</span><span class="op" id="6526241">)</span>&nbsp;<span class="op" id="6526243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6526246">return</span>&nbsp;<span class="op" id="6526253">[</span><span class="op" id="6526254">]</span><span class="builtintype" id="6526255">byte</span><span class="op" id="6526259">(</span><span class="string" id="6526260">`&#34;ref&#34;`</span><span class="op" id="6526267">)</span><span class="op" id="6526268">,</span>&nbsp;<span class="ident" id="6526270">nil</span><br>
<span class="lineno"></span><span class="op" id="6526274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6526277">func</span>&nbsp;<span class="op" id="6526282">(</span><span class="ident" id="6526283">r</span>&nbsp;<span class="op" id="6526285">*</span><span class="ident" id="6526286">RefText</span><span class="op" id="6526293">)</span>&nbsp;<span class="ident" id="6526295">UnmarshalText</span><span class="op" id="6526308">(</span><span class="op" id="6526309">[</span><span class="op" id="6526310">]</span><span class="builtintype" id="6526311">byte</span><span class="op" id="6526315">)</span>&nbsp;<span class="builtintype" id="6526317">error</span>&nbsp;<span class="op" id="6526323">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6526326">*</span><span class="ident" id="6526327">r</span>&nbsp;<span class="op" id="6526329">=</span>&nbsp;<span class="num" id="6526331">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6526335">return</span>&nbsp;<span class="ident" id="6526342">nil</span><br>
<span class="lineno"></span><span class="op" id="6526346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6526349">//&nbsp;ValText&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno">180</span><span class="keyword" id="6526403">type</span>&nbsp;<span class="ident" id="6526408">ValText</span>&nbsp;<span class="builtintype" id="6526416">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6526421">func</span>&nbsp;<span class="op" id="6526426">(</span><span class="ident" id="6526427">ValText</span><span class="op" id="6526434">)</span>&nbsp;<span class="ident" id="6526436">MarshalText</span><span class="op" id="6526447">(</span><span class="op" id="6526448">)</span>&nbsp;<span class="op" id="6526450">(</span><span class="op" id="6526451">[</span><span class="op" id="6526452">]</span><span class="builtintype" id="6526453">byte</span><span class="op" id="6526457">,</span>&nbsp;<span class="builtintype" id="6526459">error</span><span class="op" id="6526464">)</span>&nbsp;<span class="op" id="6526466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6526469">return</span>&nbsp;<span class="op" id="6526476">[</span><span class="op" id="6526477">]</span><span class="builtintype" id="6526478">byte</span><span class="op" id="6526482">(</span><span class="string" id="6526483">`&#34;val&#34;`</span><span class="op" id="6526490">)</span><span class="op" id="6526491">,</span>&nbsp;<span class="ident" id="6526493">nil</span><br>
<span class="lineno"></span><span class="op" id="6526497">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="6526500">func</span>&nbsp;<span class="ident" id="6526505">TestRefValMarshal</span><span class="op" id="6526522">(</span><span class="ident" id="6526523">t</span>&nbsp;<span class="op" id="6526525">*</span><span class="ident" id="6526526">testing</span><span class="op" id="6526533">.</span><span class="ident" id="6526534">T</span><span class="op" id="6526535">)</span>&nbsp;<span class="op" id="6526537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6526540">var</span>&nbsp;<span class="ident" id="6526544">s</span>&nbsp;<span class="op" id="6526546">=</span>&nbsp;<span class="keyword" id="6526548">struct</span>&nbsp;<span class="op" id="6526555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526559">R0</span>&nbsp;<span class="ident" id="6526562">Ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526568">R1</span>&nbsp;<span class="op" id="6526571">*</span><span class="ident" id="6526572">Ref</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526578">R2</span>&nbsp;<span class="ident" id="6526581">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526591">R3</span>&nbsp;<span class="op" id="6526594">*</span><span class="ident" id="6526595">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526605">V0</span>&nbsp;<span class="ident" id="6526608">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526614">V1</span>&nbsp;<span class="op" id="6526617">*</span><span class="ident" id="6526618">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526624">V2</span>&nbsp;<span class="ident" id="6526627">ValText</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526637">V3</span>&nbsp;<span class="op" id="6526640">*</span><span class="ident" id="6526641">ValText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6526650">}</span><span class="op" id="6526651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526655">R0</span><span class="op" id="6526657">:</span>&nbsp;<span class="num" id="6526659">12</span><span class="op" id="6526661">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526665">R1</span><span class="op" id="6526667">:</span>&nbsp;<span class="builtinfunc" id="6526669">new</span><span class="op" id="6526672">(</span><span class="ident" id="6526673">Ref</span><span class="op" id="6526676">)</span><span class="op" id="6526677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526681">R2</span><span class="op" id="6526683">:</span>&nbsp;<span class="num" id="6526685">14</span><span class="op" id="6526687">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526691">R3</span><span class="op" id="6526693">:</span>&nbsp;<span class="builtinfunc" id="6526695">new</span><span class="op" id="6526698">(</span><span class="ident" id="6526699">RefText</span><span class="op" id="6526706">)</span><span class="op" id="6526707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526711">V0</span><span class="op" id="6526713">:</span>&nbsp;<span class="num" id="6526715">13</span><span class="op" id="6526717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526721">V1</span><span class="op" id="6526723">:</span>&nbsp;<span class="builtinfunc" id="6526725">new</span><span class="op" id="6526728">(</span><span class="ident" id="6526729">Val</span><span class="op" id="6526732">)</span><span class="op" id="6526733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526737">V2</span><span class="op" id="6526739">:</span>&nbsp;<span class="num" id="6526741">15</span><span class="op" id="6526743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526747">V3</span><span class="op" id="6526749">:</span>&nbsp;<span class="builtinfunc" id="6526751">new</span><span class="op" id="6526754">(</span><span class="ident" id="6526755">ValText</span><span class="op" id="6526762">)</span><span class="op" id="6526763">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6526766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6526769">const</span>&nbsp;<span class="ident" id="6526775">want</span>&nbsp;<span class="op" id="6526780">=</span>&nbsp;<span class="string" id="6526782">`{&#34;R0&#34;:&#34;ref&#34;,&#34;R1&#34;:&#34;ref&#34;,&#34;R2&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;R3&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;V0&#34;:&#34;val&#34;,&#34;V1&#34;:&#34;val&#34;,&#34;V2&#34;:&#34;\&#34;val\&#34;&#34;,&#34;V3&#34;:&#34;\&#34;val\&#34;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526891">b</span><span class="op" id="6526892">,</span>&nbsp;<span class="ident" id="6526894">err</span>&nbsp;<span class="op" id="6526898">:=</span>&nbsp;<span class="ident" id="6526901">Marshal</span><span class="op" id="6526908">(</span><span class="op" id="6526909">&amp;</span><span class="ident" id="6526910">s</span><span class="op" id="6526911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6526914">if</span>&nbsp;<span class="ident" id="6526917">err</span>&nbsp;<span class="op" id="6526921">!=</span>&nbsp;<span class="ident" id="6526924">nil</span>&nbsp;<span class="op" id="6526928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6526932">t</span><span class="op" id="6526933">.</span><span class="ident" id="6526934">Fatalf</span><span class="op" id="6526940">(</span><span class="string" id="6526941">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="6526954">,</span>&nbsp;<span class="ident" id="6526956">err</span><span class="op" id="6526959">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6526962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6526965">if</span>&nbsp;<span class="ident" id="6526968">got</span>&nbsp;<span class="op" id="6526972">:=</span>&nbsp;<span class="builtintype" id="6526975">string</span><span class="op" id="6526981">(</span><span class="ident" id="6526982">b</span><span class="op" id="6526983">)</span><span class="op" id="6526984">;</span>&nbsp;<span class="ident" id="6526986">got</span>&nbsp;<span class="op" id="6526990">!=</span>&nbsp;<span class="ident" id="6526993">want</span>&nbsp;<span class="op" id="6526998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6527002">t</span><span class="op" id="6527003">.</span><span class="ident" id="6527004">Errorf</span><span class="op" id="6527010">(</span><span class="string" id="6527011">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6527028">,</span>&nbsp;<span class="ident" id="6527030">got</span><span class="op" id="6527033">,</span>&nbsp;<span class="ident" id="6527035">want</span><span class="op" id="6527039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6527042">}</span><br>
<span class="lineno"></span><span class="op" id="6527044">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="6527047">//&nbsp;C&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="6527101">type</span>&nbsp;<span class="ident" id="6527106">C</span>&nbsp;<span class="builtintype" id="6527108">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6527113">func</span>&nbsp;<span class="op" id="6527118">(</span><span class="ident" id="6527119">C</span><span class="op" id="6527120">)</span>&nbsp;<span class="ident" id="6527122">MarshalJSON</span><span class="op" id="6527133">(</span><span class="op" id="6527134">)</span>&nbsp;<span class="op" id="6527136">(</span><span class="op" id="6527137">[</span><span class="op" id="6527138">]</span><span class="builtintype" id="6527139">byte</span><span class="op" id="6527143">,</span>&nbsp;<span class="builtintype" id="6527145">error</span><span class="op" id="6527150">)</span>&nbsp;<span class="op" id="6527152">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6527155">return</span>&nbsp;<span class="op" id="6527162">[</span><span class="op" id="6527163">]</span><span class="builtintype" id="6527164">byte</span><span class="op" id="6527168">(</span><span class="string" id="6527169">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="6527176">)</span><span class="op" id="6527177">,</span>&nbsp;<span class="ident" id="6527179">nil</span><br>
<span class="lineno"></span><span class="op" id="6527183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6527186">//&nbsp;CText&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="6527244">type</span>&nbsp;<span class="ident" id="6527249">CText</span>&nbsp;<span class="builtintype" id="6527255">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="6527260">func</span>&nbsp;<span class="op" id="6527265">(</span><span class="ident" id="6527266">CText</span><span class="op" id="6527271">)</span>&nbsp;<span class="ident" id="6527273">MarshalText</span><span class="op" id="6527284">(</span><span class="op" id="6527285">)</span>&nbsp;<span class="op" id="6527287">(</span><span class="op" id="6527288">[</span><span class="op" id="6527289">]</span><span class="builtintype" id="6527290">byte</span><span class="op" id="6527294">,</span>&nbsp;<span class="builtintype" id="6527296">error</span><span class="op" id="6527301">)</span>&nbsp;<span class="op" id="6527303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6527306">return</span>&nbsp;<span class="op" id="6527313">[</span><span class="op" id="6527314">]</span><span class="builtintype" id="6527315">byte</span><span class="op" id="6527319">(</span><span class="string" id="6527320">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="6527327">)</span><span class="op" id="6527328">,</span>&nbsp;<span class="ident" id="6527330">nil</span><br>
<span class="lineno"></span><span class="op" id="6527334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6527337">func</span>&nbsp;<span class="ident" id="6527342">TestMarshalerEscaping</span><span class="op" id="6527363">(</span><span class="ident" id="6527364">t</span>&nbsp;<span class="op" id="6527366">*</span><span class="ident" id="6527367">testing</span><span class="op" id="6527374">.</span><span class="ident" id="6527375">T</span><span class="op" id="6527376">)</span>&nbsp;<span class="op" id="6527378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6527381">var</span>&nbsp;<span class="ident" id="6527385">c</span>&nbsp;<span class="ident" id="6527387">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6527390">want</span>&nbsp;<span class="op" id="6527395">:=</span>&nbsp;<span class="string" id="6527398">`&#34;\u003c\u0026\u003e&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6527422">b</span><span class="op" id="6527423">,</span>&nbsp;<span class="ident" id="6527425">err</span>&nbsp;<span class="op" id="6527429">:=</span>&nbsp;<span class="ident" id="6527432">Marshal</span><span class="op" id="6527439">(</span><span class="ident" id="6527440">c</span><span class="op" id="6527441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6527444">if</span>&nbsp;<span class="ident" id="6527447">err</span>&nbsp;<span class="op" id="6527451">!=</span>&nbsp;<span class="ident" id="6527454">nil</span>&nbsp;<span class="op" id="6527458">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6527462">t</span><span class="op" id="6527463">.</span><span class="ident" id="6527464">Fatalf</span><span class="op" id="6527470">(</span><span class="string" id="6527471">&#34;Marshal(c):&nbsp;%v&#34;</span><span class="op" id="6527487">,</span>&nbsp;<span class="ident" id="6527489">err</span><span class="op" id="6527492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6527495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6527498">if</span>&nbsp;<span class="ident" id="6527501">got</span>&nbsp;<span class="op" id="6527505">:=</span>&nbsp;<span class="builtintype" id="6527508">string</span><span class="op" id="6527514">(</span><span class="ident" id="6527515">b</span><span class="op" id="6527516">)</span><span class="op" id="6527517">;</span>&nbsp;<span class="ident" id="6527519">got</span>&nbsp;<span class="op" id="6527523">!=</span>&nbsp;<span class="ident" id="6527526">want</span>&nbsp;<span class="op" id="6527531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6527535">t</span><span class="op" id="6527536">.</span><span class="ident" id="6527537">Errorf</span><span class="op" id="6527543">(</span><span class="string" id="6527544">&#34;Marshal(c)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6527572">,</span>&nbsp;<span class="ident" id="6527574">got</span><span class="op" id="6527577">,</span>&nbsp;<span class="ident" id="6527579">want</span><span class="op" id="6527583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6527586">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6527590">var</span>&nbsp;<span class="ident" id="6527594">ct</span>&nbsp;<span class="ident" id="6527597">CText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6527604">want</span>&nbsp;<span class="op" id="6527609">=</span>&nbsp;<span class="string" id="6527611">`&#34;\&#34;\u003c\u0026\u003e\&#34;&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6527639">b</span><span class="op" id="6527640">,</span>&nbsp;<span class="ident" id="6527642">err</span>&nbsp;<span class="op" id="6527646">=</span>&nbsp;<span class="ident" id="6527648">Marshal</span><span class="op" id="6527655">(</span><span class="ident" id="6527656">ct</span><span class="op" id="6527658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6527661">if</span>&nbsp;<span class="ident" id="6527664">err</span>&nbsp;<span class="op" id="6527668">!=</span>&nbsp;<span class="ident" id="6527671">nil</span>&nbsp;<span class="op" id="6527675">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6527679">t</span><span class="op" id="6527680">.</span><span class="ident" id="6527681">Fatalf</span><span class="op" id="6527687">(</span><span class="string" id="6527688">&#34;Marshal(ct):&nbsp;%v&#34;</span><span class="op" id="6527705">,</span>&nbsp;<span class="ident" id="6527707">err</span><span class="op" id="6527710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6527713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6527716">if</span>&nbsp;<span class="ident" id="6527719">got</span>&nbsp;<span class="op" id="6527723">:=</span>&nbsp;<span class="builtintype" id="6527726">string</span><span class="op" id="6527732">(</span><span class="ident" id="6527733">b</span><span class="op" id="6527734">)</span><span class="op" id="6527735">;</span>&nbsp;<span class="ident" id="6527737">got</span>&nbsp;<span class="op" id="6527741">!=</span>&nbsp;<span class="ident" id="6527744">want</span>&nbsp;<span class="op" id="6527749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6527753">t</span><span class="op" id="6527754">.</span><span class="ident" id="6527755">Errorf</span><span class="op" id="6527761">(</span><span class="string" id="6527762">&#34;Marshal(ct)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6527791">,</span>&nbsp;<span class="ident" id="6527793">got</span><span class="op" id="6527796">,</span>&nbsp;<span class="ident" id="6527798">want</span><span class="op" id="6527802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6527805">}</span><br>
<span class="lineno">250</span><span class="op" id="6527807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6527810">type</span>&nbsp;<span class="ident" id="6527815">IntType</span>&nbsp;<span class="builtintype" id="6527823">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6527828">type</span>&nbsp;<span class="ident" id="6527833">MyStruct</span>&nbsp;<span class="keyword" id="6527842">struct</span>&nbsp;<span class="op" id="6527849">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6527852">IntType</span><br>
<span class="lineno"></span><span class="op" id="6527860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6527863">func</span>&nbsp;<span class="ident" id="6527868">TestAnonymousNonstruct</span><span class="op" id="6527890">(</span><span class="ident" id="6527891">t</span>&nbsp;<span class="op" id="6527893">*</span><span class="ident" id="6527894">testing</span><span class="op" id="6527901">.</span><span class="ident" id="6527902">T</span><span class="op" id="6527903">)</span>&nbsp;<span class="op" id="6527905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6527908">var</span>&nbsp;<span class="ident" id="6527912">i</span>&nbsp;<span class="ident" id="6527914">IntType</span>&nbsp;<span class="op" id="6527922">=</span>&nbsp;<span class="num" id="6527924">11</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6527928">a</span>&nbsp;<span class="op" id="6527930">:=</span>&nbsp;<span class="ident" id="6527933">MyStruct</span><span class="op" id="6527941">{</span><span class="ident" id="6527942">i</span><span class="op" id="6527943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6527946">const</span>&nbsp;<span class="ident" id="6527952">want</span>&nbsp;<span class="op" id="6527957">=</span>&nbsp;<span class="string" id="6527959">`{&#34;IntType&#34;:11}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6527978">b</span><span class="op" id="6527979">,</span>&nbsp;<span class="ident" id="6527981">err</span>&nbsp;<span class="op" id="6527985">:=</span>&nbsp;<span class="ident" id="6527988">Marshal</span><span class="op" id="6527995">(</span><span class="ident" id="6527996">a</span><span class="op" id="6527997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6528000">if</span>&nbsp;<span class="ident" id="6528003">err</span>&nbsp;<span class="op" id="6528007">!=</span>&nbsp;<span class="ident" id="6528010">nil</span>&nbsp;<span class="op" id="6528014">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528018">t</span><span class="op" id="6528019">.</span><span class="ident" id="6528020">Fatalf</span><span class="op" id="6528026">(</span><span class="string" id="6528027">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="6528040">,</span>&nbsp;<span class="ident" id="6528042">err</span><span class="op" id="6528045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6528048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6528051">if</span>&nbsp;<span class="ident" id="6528054">got</span>&nbsp;<span class="op" id="6528058">:=</span>&nbsp;<span class="builtintype" id="6528061">string</span><span class="op" id="6528067">(</span><span class="ident" id="6528068">b</span><span class="op" id="6528069">)</span><span class="op" id="6528070">;</span>&nbsp;<span class="ident" id="6528072">got</span>&nbsp;<span class="op" id="6528076">!=</span>&nbsp;<span class="ident" id="6528079">want</span>&nbsp;<span class="op" id="6528084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528088">t</span><span class="op" id="6528089">.</span><span class="ident" id="6528090">Errorf</span><span class="op" id="6528096">(</span><span class="string" id="6528097">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6528114">,</span>&nbsp;<span class="ident" id="6528116">got</span><span class="op" id="6528119">,</span>&nbsp;<span class="ident" id="6528121">want</span><span class="op" id="6528125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6528128">}</span><br>
<span class="lineno">270</span><span class="op" id="6528130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6528133">type</span>&nbsp;<span class="ident" id="6528138">BugA</span>&nbsp;<span class="keyword" id="6528143">struct</span>&nbsp;<span class="op" id="6528150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528153">S</span>&nbsp;<span class="builtintype" id="6528155">string</span><br>
<span class="lineno"></span><span class="op" id="6528162">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="6528165">type</span>&nbsp;<span class="ident" id="6528170">BugB</span>&nbsp;<span class="keyword" id="6528175">struct</span>&nbsp;<span class="op" id="6528182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528185">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528191">S</span>&nbsp;<span class="builtintype" id="6528193">string</span><br>
<span class="lineno"></span><span class="op" id="6528200">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="6528203">type</span>&nbsp;<span class="ident" id="6528208">BugC</span>&nbsp;<span class="keyword" id="6528213">struct</span>&nbsp;<span class="op" id="6528220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528223">S</span>&nbsp;<span class="builtintype" id="6528225">string</span><br>
<span class="lineno"></span><span class="op" id="6528232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="6528235">//&nbsp;Legal&nbsp;Go:&nbsp;We&nbsp;never&nbsp;use&nbsp;the&nbsp;repeated&nbsp;embedded&nbsp;field&nbsp;(S).</span><br>
<span class="lineno"></span><span class="keyword" id="6528294">type</span>&nbsp;<span class="ident" id="6528299">BugX</span>&nbsp;<span class="keyword" id="6528304">struct</span>&nbsp;<span class="op" id="6528311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528314">A</span>&nbsp;<span class="builtintype" id="6528316">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528321">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528327">BugB</span><br>
<span class="lineno">290</span><span class="op" id="6528332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6528335">//&nbsp;Issue&nbsp;5245.</span><br>
<span class="lineno"></span><span class="keyword" id="6528350">func</span>&nbsp;<span class="ident" id="6528355">TestEmbeddedBug</span><span class="op" id="6528370">(</span><span class="ident" id="6528371">t</span>&nbsp;<span class="op" id="6528373">*</span><span class="ident" id="6528374">testing</span><span class="op" id="6528381">.</span><span class="ident" id="6528382">T</span><span class="op" id="6528383">)</span>&nbsp;<span class="op" id="6528385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528388">v</span>&nbsp;<span class="op" id="6528390">:=</span>&nbsp;<span class="ident" id="6528393">BugB</span><span class="op" id="6528397">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528401">BugA</span><span class="op" id="6528405">{</span><span class="string" id="6528406">&#34;A&#34;</span><span class="op" id="6528409">}</span><span class="op" id="6528410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6528414">&#34;B&#34;</span><span class="op" id="6528417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6528420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528423">b</span><span class="op" id="6528424">,</span>&nbsp;<span class="ident" id="6528426">err</span>&nbsp;<span class="op" id="6528430">:=</span>&nbsp;<span class="ident" id="6528433">Marshal</span><span class="op" id="6528440">(</span><span class="ident" id="6528441">v</span><span class="op" id="6528442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6528445">if</span>&nbsp;<span class="ident" id="6528448">err</span>&nbsp;<span class="op" id="6528452">!=</span>&nbsp;<span class="ident" id="6528455">nil</span>&nbsp;<span class="op" id="6528459">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528463">t</span><span class="op" id="6528464">.</span><span class="ident" id="6528465">Fatal</span><span class="op" id="6528470">(</span><span class="string" id="6528471">&#34;Marshal:&#34;</span><span class="op" id="6528481">,</span>&nbsp;<span class="ident" id="6528483">err</span><span class="op" id="6528486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6528489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528492">want</span>&nbsp;<span class="op" id="6528497">:=</span>&nbsp;<span class="string" id="6528500">`{&#34;S&#34;:&#34;B&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528513">got</span>&nbsp;<span class="op" id="6528517">:=</span>&nbsp;<span class="builtintype" id="6528520">string</span><span class="op" id="6528526">(</span><span class="ident" id="6528527">b</span><span class="op" id="6528528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6528531">if</span>&nbsp;<span class="ident" id="6528534">got</span>&nbsp;<span class="op" id="6528538">!=</span>&nbsp;<span class="ident" id="6528541">want</span>&nbsp;<span class="op" id="6528546">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528550">t</span><span class="op" id="6528551">.</span><span class="ident" id="6528552">Fatalf</span><span class="op" id="6528558">(</span><span class="string" id="6528559">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6528584">,</span>&nbsp;<span class="ident" id="6528586">got</span><span class="op" id="6528589">,</span>&nbsp;<span class="ident" id="6528591">want</span><span class="op" id="6528595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6528598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6528601">//&nbsp;Now&nbsp;check&nbsp;that&nbsp;the&nbsp;duplicate&nbsp;field,&nbsp;S,&nbsp;does&nbsp;not&nbsp;appear.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528661">x</span>&nbsp;<span class="op" id="6528663">:=</span>&nbsp;<span class="ident" id="6528666">BugX</span><span class="op" id="6528670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528674">A</span><span class="op" id="6528675">:</span>&nbsp;<span class="num" id="6528677">23</span><span class="op" id="6528679">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6528682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528685">b</span><span class="op" id="6528686">,</span>&nbsp;<span class="ident" id="6528688">err</span>&nbsp;<span class="op" id="6528692">=</span>&nbsp;<span class="ident" id="6528694">Marshal</span><span class="op" id="6528701">(</span><span class="ident" id="6528702">x</span><span class="op" id="6528703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6528706">if</span>&nbsp;<span class="ident" id="6528709">err</span>&nbsp;<span class="op" id="6528713">!=</span>&nbsp;<span class="ident" id="6528716">nil</span>&nbsp;<span class="op" id="6528720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528724">t</span><span class="op" id="6528725">.</span><span class="ident" id="6528726">Fatal</span><span class="op" id="6528731">(</span><span class="string" id="6528732">&#34;Marshal:&#34;</span><span class="op" id="6528742">,</span>&nbsp;<span class="ident" id="6528744">err</span><span class="op" id="6528747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6528750">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528753">want</span>&nbsp;<span class="op" id="6528758">=</span>&nbsp;<span class="string" id="6528760">`{&#34;A&#34;:23}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528772">got</span>&nbsp;<span class="op" id="6528776">=</span>&nbsp;<span class="builtintype" id="6528778">string</span><span class="op" id="6528784">(</span><span class="ident" id="6528785">b</span><span class="op" id="6528786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6528789">if</span>&nbsp;<span class="ident" id="6528792">got</span>&nbsp;<span class="op" id="6528796">!=</span>&nbsp;<span class="ident" id="6528799">want</span>&nbsp;<span class="op" id="6528804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528808">t</span><span class="op" id="6528809">.</span><span class="ident" id="6528810">Fatalf</span><span class="op" id="6528816">(</span><span class="string" id="6528817">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6528842">,</span>&nbsp;<span class="ident" id="6528844">got</span><span class="op" id="6528847">,</span>&nbsp;<span class="ident" id="6528849">want</span><span class="op" id="6528853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6528856">}</span><br>
<span class="lineno">320</span><span class="op" id="6528858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6528861">type</span>&nbsp;<span class="ident" id="6528866">BugD</span>&nbsp;<span class="keyword" id="6528871">struct</span>&nbsp;<span class="op" id="6528878">{</span>&nbsp;<span class="comment" id="6528880">//&nbsp;Same&nbsp;as&nbsp;BugA&nbsp;after&nbsp;tagging.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528912">XXX</span>&nbsp;<span class="builtintype" id="6528916">string</span>&nbsp;<span class="string" id="6528923">`json:&#34;S&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6528934">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="6528937">//&nbsp;BugD&#39;s&nbsp;tagged&nbsp;S&nbsp;field&nbsp;should&nbsp;dominate&nbsp;BugA&#39;s.</span><br>
<span class="lineno"></span><span class="keyword" id="6528986">type</span>&nbsp;<span class="ident" id="6528991">BugY</span>&nbsp;<span class="keyword" id="6528996">struct</span>&nbsp;<span class="op" id="6529003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529006">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529012">BugD</span><br>
<span class="lineno">330</span><span class="op" id="6529017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6529020">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;dominates&nbsp;untagged&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="6529079">func</span>&nbsp;<span class="ident" id="6529084">TestTaggedFieldDominates</span><span class="op" id="6529108">(</span><span class="ident" id="6529109">t</span>&nbsp;<span class="op" id="6529111">*</span><span class="ident" id="6529112">testing</span><span class="op" id="6529119">.</span><span class="ident" id="6529120">T</span><span class="op" id="6529121">)</span>&nbsp;<span class="op" id="6529123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529126">v</span>&nbsp;<span class="op" id="6529128">:=</span>&nbsp;<span class="ident" id="6529131">BugY</span><span class="op" id="6529135">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529139">BugA</span><span class="op" id="6529143">{</span><span class="string" id="6529144">&#34;BugA&#34;</span><span class="op" id="6529150">}</span><span class="op" id="6529151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529155">BugD</span><span class="op" id="6529159">{</span><span class="string" id="6529160">&#34;BugD&#34;</span><span class="op" id="6529166">}</span><span class="op" id="6529167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529173">b</span><span class="op" id="6529174">,</span>&nbsp;<span class="ident" id="6529176">err</span>&nbsp;<span class="op" id="6529180">:=</span>&nbsp;<span class="ident" id="6529183">Marshal</span><span class="op" id="6529190">(</span><span class="ident" id="6529191">v</span><span class="op" id="6529192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529195">if</span>&nbsp;<span class="ident" id="6529198">err</span>&nbsp;<span class="op" id="6529202">!=</span>&nbsp;<span class="ident" id="6529205">nil</span>&nbsp;<span class="op" id="6529209">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529213">t</span><span class="op" id="6529214">.</span><span class="ident" id="6529215">Fatal</span><span class="op" id="6529220">(</span><span class="string" id="6529221">&#34;Marshal:&#34;</span><span class="op" id="6529231">,</span>&nbsp;<span class="ident" id="6529233">err</span><span class="op" id="6529236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529242">want</span>&nbsp;<span class="op" id="6529247">:=</span>&nbsp;<span class="string" id="6529250">`{&#34;S&#34;:&#34;BugD&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529266">got</span>&nbsp;<span class="op" id="6529270">:=</span>&nbsp;<span class="builtintype" id="6529273">string</span><span class="op" id="6529279">(</span><span class="ident" id="6529280">b</span><span class="op" id="6529281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529284">if</span>&nbsp;<span class="ident" id="6529287">got</span>&nbsp;<span class="op" id="6529291">!=</span>&nbsp;<span class="ident" id="6529294">want</span>&nbsp;<span class="op" id="6529299">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529303">t</span><span class="op" id="6529304">.</span><span class="ident" id="6529305">Fatalf</span><span class="op" id="6529311">(</span><span class="string" id="6529312">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6529337">,</span>&nbsp;<span class="ident" id="6529339">got</span><span class="op" id="6529342">,</span>&nbsp;<span class="ident" id="6529344">want</span><span class="op" id="6529348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529351">}</span><br>
<span class="lineno"></span><span class="op" id="6529353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6529356">//&nbsp;There&nbsp;are&nbsp;no&nbsp;tags&nbsp;here,&nbsp;so&nbsp;S&nbsp;should&nbsp;not&nbsp;appear.</span><br>
<span class="lineno">350</span><span class="keyword" id="6529407">type</span>&nbsp;<span class="ident" id="6529412">BugZ</span>&nbsp;<span class="keyword" id="6529417">struct</span>&nbsp;<span class="op" id="6529424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529427">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529433">BugC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529439">BugY</span>&nbsp;<span class="comment" id="6529444">//&nbsp;Contains&nbsp;a&nbsp;tagged&nbsp;S&nbsp;field&nbsp;through&nbsp;BugD;&nbsp;should&nbsp;not&nbsp;dominate.</span><br>
<span class="lineno"></span><span class="op" id="6529508">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="6529511">func</span>&nbsp;<span class="ident" id="6529516">TestDuplicatedFieldDisappears</span><span class="op" id="6529545">(</span><span class="ident" id="6529546">t</span>&nbsp;<span class="op" id="6529548">*</span><span class="ident" id="6529549">testing</span><span class="op" id="6529556">.</span><span class="ident" id="6529557">T</span><span class="op" id="6529558">)</span>&nbsp;<span class="op" id="6529560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529563">v</span>&nbsp;<span class="op" id="6529565">:=</span>&nbsp;<span class="ident" id="6529568">BugZ</span><span class="op" id="6529572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529576">BugA</span><span class="op" id="6529580">{</span><span class="string" id="6529581">&#34;BugA&#34;</span><span class="op" id="6529587">}</span><span class="op" id="6529588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529592">BugC</span><span class="op" id="6529596">{</span><span class="string" id="6529597">&#34;BugC&#34;</span><span class="op" id="6529603">}</span><span class="op" id="6529604">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529608">BugY</span><span class="op" id="6529612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529617">BugA</span><span class="op" id="6529621">{</span><span class="string" id="6529622">&#34;nested&nbsp;BugA&#34;</span><span class="op" id="6529635">}</span><span class="op" id="6529636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529641">BugD</span><span class="op" id="6529645">{</span><span class="string" id="6529646">&#34;nested&nbsp;BugD&#34;</span><span class="op" id="6529659">}</span><span class="op" id="6529660">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529664">}</span><span class="op" id="6529665">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529668">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529671">b</span><span class="op" id="6529672">,</span>&nbsp;<span class="ident" id="6529674">err</span>&nbsp;<span class="op" id="6529678">:=</span>&nbsp;<span class="ident" id="6529681">Marshal</span><span class="op" id="6529688">(</span><span class="ident" id="6529689">v</span><span class="op" id="6529690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529693">if</span>&nbsp;<span class="ident" id="6529696">err</span>&nbsp;<span class="op" id="6529700">!=</span>&nbsp;<span class="ident" id="6529703">nil</span>&nbsp;<span class="op" id="6529707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529711">t</span><span class="op" id="6529712">.</span><span class="ident" id="6529713">Fatal</span><span class="op" id="6529718">(</span><span class="string" id="6529719">&#34;Marshal:&#34;</span><span class="op" id="6529729">,</span>&nbsp;<span class="ident" id="6529731">err</span><span class="op" id="6529734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529740">want</span>&nbsp;<span class="op" id="6529745">:=</span>&nbsp;<span class="string" id="6529748">`{}`</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529754">got</span>&nbsp;<span class="op" id="6529758">:=</span>&nbsp;<span class="builtintype" id="6529761">string</span><span class="op" id="6529767">(</span><span class="ident" id="6529768">b</span><span class="op" id="6529769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529772">if</span>&nbsp;<span class="ident" id="6529775">got</span>&nbsp;<span class="op" id="6529779">!=</span>&nbsp;<span class="ident" id="6529782">want</span>&nbsp;<span class="op" id="6529787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529791">t</span><span class="op" id="6529792">.</span><span class="ident" id="6529793">Fatalf</span><span class="op" id="6529799">(</span><span class="string" id="6529800">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6529825">,</span>&nbsp;<span class="ident" id="6529827">got</span><span class="op" id="6529830">,</span>&nbsp;<span class="ident" id="6529832">want</span><span class="op" id="6529836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529839">}</span><br>
<span class="lineno"></span><span class="op" id="6529841">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="6529844">func</span>&nbsp;<span class="ident" id="6529849">TestStringBytes</span><span class="op" id="6529864">(</span><span class="ident" id="6529865">t</span>&nbsp;<span class="op" id="6529867">*</span><span class="ident" id="6529868">testing</span><span class="op" id="6529875">.</span><span class="ident" id="6529876">T</span><span class="op" id="6529877">)</span>&nbsp;<span class="op" id="6529879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6529882">//&nbsp;Test&nbsp;that&nbsp;encodeState.stringBytes&nbsp;and&nbsp;encodeState.string&nbsp;use&nbsp;the&nbsp;same&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529966">es</span>&nbsp;<span class="op" id="6529969">:=</span>&nbsp;<span class="op" id="6529972">&amp;</span><span class="ident" id="6529973">encodeState</span><span class="op" id="6529984">{</span><span class="op" id="6529985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529988">var</span>&nbsp;<span class="ident" id="6529992">r</span>&nbsp;<span class="op" id="6529994">[</span><span class="op" id="6529995">]</span><span class="builtintype" id="6529996">rune</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530002">for</span>&nbsp;<span class="ident" id="6530006">i</span>&nbsp;<span class="op" id="6530008">:=</span>&nbsp;<span class="string" id="6530011">&#39;\u0000&#39;</span><span class="op" id="6530019">;</span>&nbsp;<span class="ident" id="6530021">i</span>&nbsp;<span class="op" id="6530023">&lt;=</span>&nbsp;<span class="ident" id="6530026">unicode</span><span class="op" id="6530033">.</span><span class="ident" id="6530034">MaxRune</span><span class="op" id="6530041">;</span>&nbsp;<span class="ident" id="6530043">i</span><span class="op" id="6530044">++</span>&nbsp;<span class="op" id="6530047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530051">r</span>&nbsp;<span class="op" id="6530053">=</span>&nbsp;<span class="builtinfunc" id="6530055">append</span><span class="op" id="6530061">(</span><span class="ident" id="6530062">r</span><span class="op" id="6530063">,</span>&nbsp;<span class="ident" id="6530065">i</span><span class="op" id="6530066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530072">s</span>&nbsp;<span class="op" id="6530074">:=</span>&nbsp;<span class="builtintype" id="6530077">string</span><span class="op" id="6530083">(</span><span class="ident" id="6530084">r</span><span class="op" id="6530085">)</span>&nbsp;<span class="op" id="6530087">+</span>&nbsp;<span class="string" id="6530089">&#34;\xff\xff\xffhello&#34;</span>&nbsp;<span class="comment" id="6530109">//&nbsp;some&nbsp;invalid&nbsp;UTF-8&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530136">_</span><span class="op" id="6530137">,</span>&nbsp;<span class="ident" id="6530139">err</span>&nbsp;<span class="op" id="6530143">:=</span>&nbsp;<span class="ident" id="6530146">es</span><span class="op" id="6530148">.</span><span class="builtintype" id="6530149">string</span><span class="op" id="6530155">(</span><span class="ident" id="6530156">s</span><span class="op" id="6530157">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530160">if</span>&nbsp;<span class="ident" id="6530163">err</span>&nbsp;<span class="op" id="6530167">!=</span>&nbsp;<span class="ident" id="6530170">nil</span>&nbsp;<span class="op" id="6530174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530178">t</span><span class="op" id="6530179">.</span><span class="ident" id="6530180">Fatal</span><span class="op" id="6530185">(</span><span class="ident" id="6530186">err</span><span class="op" id="6530189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530196">esBytes</span>&nbsp;<span class="op" id="6530204">:=</span>&nbsp;<span class="op" id="6530207">&amp;</span><span class="ident" id="6530208">encodeState</span><span class="op" id="6530219">{</span><span class="op" id="6530220">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530223">_</span><span class="op" id="6530224">,</span>&nbsp;<span class="ident" id="6530226">err</span>&nbsp;<span class="op" id="6530230">=</span>&nbsp;<span class="ident" id="6530232">esBytes</span><span class="op" id="6530239">.</span><span class="ident" id="6530240">stringBytes</span><span class="op" id="6530251">(</span><span class="op" id="6530252">[</span><span class="op" id="6530253">]</span><span class="builtintype" id="6530254">byte</span><span class="op" id="6530258">(</span><span class="ident" id="6530259">s</span><span class="op" id="6530260">)</span><span class="op" id="6530261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530264">if</span>&nbsp;<span class="ident" id="6530267">err</span>&nbsp;<span class="op" id="6530271">!=</span>&nbsp;<span class="ident" id="6530274">nil</span>&nbsp;<span class="op" id="6530278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530282">t</span><span class="op" id="6530283">.</span><span class="ident" id="6530284">Fatal</span><span class="op" id="6530289">(</span><span class="ident" id="6530290">err</span><span class="op" id="6530293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530300">enc</span>&nbsp;<span class="op" id="6530304">:=</span>&nbsp;<span class="ident" id="6530307">es</span><span class="op" id="6530309">.</span><span class="ident" id="6530310">Buffer</span><span class="op" id="6530316">.</span><span class="ident" id="6530317">String</span><span class="op" id="6530323">(</span><span class="op" id="6530324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530327">encBytes</span>&nbsp;<span class="op" id="6530336">:=</span>&nbsp;<span class="ident" id="6530339">esBytes</span><span class="op" id="6530346">.</span><span class="ident" id="6530347">Buffer</span><span class="op" id="6530353">.</span><span class="ident" id="6530354">String</span><span class="op" id="6530360">(</span><span class="op" id="6530361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530364">if</span>&nbsp;<span class="ident" id="6530367">enc</span>&nbsp;<span class="op" id="6530371">!=</span>&nbsp;<span class="ident" id="6530374">encBytes</span>&nbsp;<span class="op" id="6530383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530387">i</span>&nbsp;<span class="op" id="6530389">:=</span>&nbsp;<span class="num" id="6530392">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530396">for</span>&nbsp;<span class="ident" id="6530400">i</span>&nbsp;<span class="op" id="6530402">&lt;</span>&nbsp;<span class="builtinfunc" id="6530404">len</span><span class="op" id="6530407">(</span><span class="ident" id="6530408">enc</span><span class="op" id="6530411">)</span>&nbsp;<span class="op" id="6530413">&amp;&amp;</span>&nbsp;<span class="ident" id="6530416">i</span>&nbsp;<span class="op" id="6530418">&lt;</span>&nbsp;<span class="builtinfunc" id="6530420">len</span><span class="op" id="6530423">(</span><span class="ident" id="6530424">encBytes</span><span class="op" id="6530432">)</span>&nbsp;<span class="op" id="6530434">&amp;&amp;</span>&nbsp;<span class="ident" id="6530437">enc</span><span class="op" id="6530440">[</span><span class="ident" id="6530441">i</span><span class="op" id="6530442">]</span>&nbsp;<span class="op" id="6530444">==</span>&nbsp;<span class="ident" id="6530447">encBytes</span><span class="op" id="6530455">[</span><span class="ident" id="6530456">i</span><span class="op" id="6530457">]</span>&nbsp;<span class="op" id="6530459">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530464">i</span><span class="op" id="6530465">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530474">enc</span>&nbsp;<span class="op" id="6530478">=</span>&nbsp;<span class="ident" id="6530480">enc</span><span class="op" id="6530483">[</span><span class="ident" id="6530484">i</span><span class="op" id="6530485">:</span><span class="op" id="6530486">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530490">encBytes</span>&nbsp;<span class="op" id="6530499">=</span>&nbsp;<span class="ident" id="6530501">encBytes</span><span class="op" id="6530509">[</span><span class="ident" id="6530510">i</span><span class="op" id="6530511">:</span><span class="op" id="6530512">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530516">i</span>&nbsp;<span class="op" id="6530518">=</span>&nbsp;<span class="num" id="6530520">0</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530524">for</span>&nbsp;<span class="ident" id="6530528">i</span>&nbsp;<span class="op" id="6530530">&lt;</span>&nbsp;<span class="builtinfunc" id="6530532">len</span><span class="op" id="6530535">(</span><span class="ident" id="6530536">enc</span><span class="op" id="6530539">)</span>&nbsp;<span class="op" id="6530541">&amp;&amp;</span>&nbsp;<span class="ident" id="6530544">i</span>&nbsp;<span class="op" id="6530546">&lt;</span>&nbsp;<span class="builtinfunc" id="6530548">len</span><span class="op" id="6530551">(</span><span class="ident" id="6530552">encBytes</span><span class="op" id="6530560">)</span>&nbsp;<span class="op" id="6530562">&amp;&amp;</span>&nbsp;<span class="ident" id="6530565">enc</span><span class="op" id="6530568">[</span><span class="builtinfunc" id="6530569">len</span><span class="op" id="6530572">(</span><span class="ident" id="6530573">enc</span><span class="op" id="6530576">)</span><span class="op" id="6530577">-</span><span class="ident" id="6530578">i</span><span class="op" id="6530579">-</span><span class="num" id="6530580">1</span><span class="op" id="6530581">]</span>&nbsp;<span class="op" id="6530583">==</span>&nbsp;<span class="ident" id="6530586">encBytes</span><span class="op" id="6530594">[</span><span class="builtinfunc" id="6530595">len</span><span class="op" id="6530598">(</span><span class="ident" id="6530599">encBytes</span><span class="op" id="6530607">)</span><span class="op" id="6530608">-</span><span class="ident" id="6530609">i</span><span class="op" id="6530610">-</span><span class="num" id="6530611">1</span><span class="op" id="6530612">]</span>&nbsp;<span class="op" id="6530614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530619">i</span><span class="op" id="6530620">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530629">enc</span>&nbsp;<span class="op" id="6530633">=</span>&nbsp;<span class="ident" id="6530635">enc</span><span class="op" id="6530638">[</span><span class="op" id="6530639">:</span><span class="builtinfunc" id="6530640">len</span><span class="op" id="6530643">(</span><span class="ident" id="6530644">enc</span><span class="op" id="6530647">)</span><span class="op" id="6530648">-</span><span class="ident" id="6530649">i</span><span class="op" id="6530650">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530654">encBytes</span>&nbsp;<span class="op" id="6530663">=</span>&nbsp;<span class="ident" id="6530665">encBytes</span><span class="op" id="6530673">[</span><span class="op" id="6530674">:</span><span class="builtinfunc" id="6530675">len</span><span class="op" id="6530678">(</span><span class="ident" id="6530679">encBytes</span><span class="op" id="6530687">)</span><span class="op" id="6530688">-</span><span class="ident" id="6530689">i</span><span class="op" id="6530690">]</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530695">if</span>&nbsp;<span class="builtinfunc" id="6530698">len</span><span class="op" id="6530701">(</span><span class="ident" id="6530702">enc</span><span class="op" id="6530705">)</span>&nbsp;<span class="op" id="6530707">&gt;</span>&nbsp;<span class="num" id="6530709">20</span>&nbsp;<span class="op" id="6530712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530717">enc</span>&nbsp;<span class="op" id="6530721">=</span>&nbsp;<span class="ident" id="6530723">enc</span><span class="op" id="6530726">[</span><span class="op" id="6530727">:</span><span class="num" id="6530728">20</span><span class="op" id="6530730">]</span>&nbsp;<span class="op" id="6530732">+</span>&nbsp;<span class="string" id="6530734">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530746">if</span>&nbsp;<span class="builtinfunc" id="6530749">len</span><span class="op" id="6530752">(</span><span class="ident" id="6530753">encBytes</span><span class="op" id="6530761">)</span>&nbsp;<span class="op" id="6530763">&gt;</span>&nbsp;<span class="num" id="6530765">20</span>&nbsp;<span class="op" id="6530768">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530773">encBytes</span>&nbsp;<span class="op" id="6530782">=</span>&nbsp;<span class="ident" id="6530784">encBytes</span><span class="op" id="6530792">[</span><span class="op" id="6530793">:</span><span class="num" id="6530794">20</span><span class="op" id="6530796">]</span>&nbsp;<span class="op" id="6530798">+</span>&nbsp;<span class="string" id="6530800">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530813">t</span><span class="op" id="6530814">.</span><span class="ident" id="6530815">Errorf</span><span class="op" id="6530821">(</span><span class="string" id="6530822">&#34;encodings&nbsp;differ&nbsp;at&nbsp;%#q&nbsp;vs&nbsp;%#q&#34;</span><span class="op" id="6530854">,</span>&nbsp;<span class="ident" id="6530856">enc</span><span class="op" id="6530859">,</span>&nbsp;<span class="ident" id="6530861">encBytes</span><span class="op" id="6530869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530872">}</span><br>
<span class="lineno">420</span><span class="op" id="6530874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6530877">func</span>&nbsp;<span class="ident" id="6530882">TestIssue6458</span><span class="op" id="6530895">(</span><span class="ident" id="6530896">t</span>&nbsp;<span class="op" id="6530898">*</span><span class="ident" id="6530899">testing</span><span class="op" id="6530906">.</span><span class="ident" id="6530907">T</span><span class="op" id="6530908">)</span>&nbsp;<span class="op" id="6530910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530913">type</span>&nbsp;<span class="ident" id="6530918">Foo</span>&nbsp;<span class="keyword" id="6530922">struct</span>&nbsp;<span class="op" id="6530929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530933">M</span>&nbsp;<span class="ident" id="6530935">RawMessage</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530950">x</span>&nbsp;<span class="op" id="6530952">:=</span>&nbsp;<span class="ident" id="6530955">Foo</span><span class="op" id="6530958">{</span><span class="ident" id="6530959">RawMessage</span><span class="op" id="6530969">(</span><span class="string" id="6530970">`&#34;foo&#34;`</span><span class="op" id="6530977">)</span><span class="op" id="6530978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530982">b</span><span class="op" id="6530983">,</span>&nbsp;<span class="ident" id="6530985">err</span>&nbsp;<span class="op" id="6530989">:=</span>&nbsp;<span class="ident" id="6530992">Marshal</span><span class="op" id="6530999">(</span><span class="op" id="6531000">&amp;</span><span class="ident" id="6531001">x</span><span class="op" id="6531002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6531005">if</span>&nbsp;<span class="ident" id="6531008">err</span>&nbsp;<span class="op" id="6531012">!=</span>&nbsp;<span class="ident" id="6531015">nil</span>&nbsp;<span class="op" id="6531019">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531023">t</span><span class="op" id="6531024">.</span><span class="ident" id="6531025">Fatal</span><span class="op" id="6531030">(</span><span class="ident" id="6531031">err</span><span class="op" id="6531034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6531040">if</span>&nbsp;<span class="ident" id="6531043">want</span>&nbsp;<span class="op" id="6531048">:=</span>&nbsp;<span class="string" id="6531051">`{&#34;M&#34;:&#34;foo&#34;}`</span><span class="op" id="6531064">;</span>&nbsp;<span class="builtintype" id="6531066">string</span><span class="op" id="6531072">(</span><span class="ident" id="6531073">b</span><span class="op" id="6531074">)</span>&nbsp;<span class="op" id="6531076">!=</span>&nbsp;<span class="ident" id="6531079">want</span>&nbsp;<span class="op" id="6531084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531088">t</span><span class="op" id="6531089">.</span><span class="ident" id="6531090">Errorf</span><span class="op" id="6531096">(</span><span class="string" id="6531097">&#34;Marshal(&amp;x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6531126">,</span>&nbsp;<span class="ident" id="6531128">b</span><span class="op" id="6531129">,</span>&nbsp;<span class="ident" id="6531131">want</span><span class="op" id="6531135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531138">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531142">b</span><span class="op" id="6531143">,</span>&nbsp;<span class="ident" id="6531145">err</span>&nbsp;<span class="op" id="6531149">=</span>&nbsp;<span class="ident" id="6531151">Marshal</span><span class="op" id="6531158">(</span><span class="ident" id="6531159">x</span><span class="op" id="6531160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6531163">if</span>&nbsp;<span class="ident" id="6531166">err</span>&nbsp;<span class="op" id="6531170">!=</span>&nbsp;<span class="ident" id="6531173">nil</span>&nbsp;<span class="op" id="6531177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531181">t</span><span class="op" id="6531182">.</span><span class="ident" id="6531183">Fatal</span><span class="op" id="6531188">(</span><span class="ident" id="6531189">err</span><span class="op" id="6531192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531195">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6531199">if</span>&nbsp;<span class="ident" id="6531202">want</span>&nbsp;<span class="op" id="6531207">:=</span>&nbsp;<span class="string" id="6531210">`{&#34;M&#34;:&#34;ImZvbyI=&#34;}`</span><span class="op" id="6531228">;</span>&nbsp;<span class="builtintype" id="6531230">string</span><span class="op" id="6531236">(</span><span class="ident" id="6531237">b</span><span class="op" id="6531238">)</span>&nbsp;<span class="op" id="6531240">!=</span>&nbsp;<span class="ident" id="6531243">want</span>&nbsp;<span class="op" id="6531248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531252">t</span><span class="op" id="6531253">.</span><span class="ident" id="6531254">Errorf</span><span class="op" id="6531260">(</span><span class="string" id="6531261">&#34;Marshal(x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6531289">,</span>&nbsp;<span class="ident" id="6531291">b</span><span class="op" id="6531292">,</span>&nbsp;<span class="ident" id="6531294">want</span><span class="op" id="6531298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531301">}</span><br>
<span class="lineno"></span><span class="op" id="6531303">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="6531306">func</span>&nbsp;<span class="ident" id="6531311">TestHTMLEscape</span><span class="op" id="6531325">(</span><span class="ident" id="6531326">t</span>&nbsp;<span class="op" id="6531328">*</span><span class="ident" id="6531329">testing</span><span class="op" id="6531336">.</span><span class="ident" id="6531337">T</span><span class="op" id="6531338">)</span>&nbsp;<span class="op" id="6531340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6531343">var</span>&nbsp;<span class="ident" id="6531347">b</span><span class="op" id="6531348">,</span>&nbsp;<span class="ident" id="6531350">want</span>&nbsp;<span class="ident" id="6531355">bytes</span><span class="op" id="6531360">.</span><span class="ident" id="6531361">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531369">m</span>&nbsp;<span class="op" id="6531371">:=</span>&nbsp;<span class="string" id="6531374">`{&#34;M&#34;:&#34;&lt;html&gt;foo&nbsp;&amp;`</span>&nbsp;<span class="op" id="6531394">+</span>&nbsp;<span class="string" id="6531396">&#34;\xe2\x80\xa8&nbsp;\xe2\x80\xa9&#34;</span>&nbsp;<span class="op" id="6531424">+</span>&nbsp;<span class="string" id="6531426">`&lt;/html&gt;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531439">want</span><span class="op" id="6531443">.</span><span class="ident" id="6531444">Write</span><span class="op" id="6531449">(</span><span class="op" id="6531450">[</span><span class="op" id="6531451">]</span><span class="builtintype" id="6531452">byte</span><span class="op" id="6531456">(</span><span class="string" id="6531457">`{&#34;M&#34;:&#34;\u003chtml\u003efoo&nbsp;\u0026\u2028&nbsp;\u2029\u003c/html\u003e&#34;}`</span><span class="op" id="6531523">)</span><span class="op" id="6531524">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531527">HTMLEscape</span><span class="op" id="6531537">(</span><span class="op" id="6531538">&amp;</span><span class="ident" id="6531539">b</span><span class="op" id="6531540">,</span>&nbsp;<span class="op" id="6531542">[</span><span class="op" id="6531543">]</span><span class="builtintype" id="6531544">byte</span><span class="op" id="6531548">(</span><span class="ident" id="6531549">m</span><span class="op" id="6531550">)</span><span class="op" id="6531551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6531554">if</span>&nbsp;<span class="op" id="6531557">!</span><span class="ident" id="6531558">bytes</span><span class="op" id="6531563">.</span><span class="ident" id="6531564">Equal</span><span class="op" id="6531569">(</span><span class="ident" id="6531570">b</span><span class="op" id="6531571">.</span><span class="ident" id="6531572">Bytes</span><span class="op" id="6531577">(</span><span class="op" id="6531578">)</span><span class="op" id="6531579">,</span>&nbsp;<span class="ident" id="6531581">want</span><span class="op" id="6531585">.</span><span class="ident" id="6531586">Bytes</span><span class="op" id="6531591">(</span><span class="op" id="6531592">)</span><span class="op" id="6531593">)</span>&nbsp;<span class="op" id="6531595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531599">t</span><span class="op" id="6531600">.</span><span class="ident" id="6531601">Errorf</span><span class="op" id="6531607">(</span><span class="string" id="6531608">&#34;HTMLEscape(&amp;b,&nbsp;[]byte(m))&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6531649">,</span>&nbsp;<span class="ident" id="6531651">b</span><span class="op" id="6531652">.</span><span class="ident" id="6531653">Bytes</span><span class="op" id="6531658">(</span><span class="op" id="6531659">)</span><span class="op" id="6531660">,</span>&nbsp;<span class="ident" id="6531662">want</span><span class="op" id="6531666">.</span><span class="ident" id="6531667">Bytes</span><span class="op" id="6531672">(</span><span class="op" id="6531673">)</span><span class="op" id="6531674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531677">}</span><br>
<span class="lineno"></span><span class="op" id="6531679">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="6531682">//&nbsp;golang.org/issue/8582</span><br>
<span class="lineno"></span><span class="keyword" id="6531707">func</span>&nbsp;<span class="ident" id="6531712">TestEncodePointerString</span><span class="op" id="6531735">(</span><span class="ident" id="6531736">t</span>&nbsp;<span class="op" id="6531738">*</span><span class="ident" id="6531739">testing</span><span class="op" id="6531746">.</span><span class="ident" id="6531747">T</span><span class="op" id="6531748">)</span>&nbsp;<span class="op" id="6531750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6531753">type</span>&nbsp;<span class="ident" id="6531758">stringPointer</span>&nbsp;<span class="keyword" id="6531772">struct</span>&nbsp;<span class="op" id="6531779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531783">N</span>&nbsp;<span class="op" id="6531785">*</span><span class="ident" id="6531786">int64</span>&nbsp;<span class="string" id="6531792">`json:&#34;n,string&#34;`</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6531814">var</span>&nbsp;<span class="ident" id="6531818">n</span>&nbsp;<span class="ident" id="6531820">int64</span>&nbsp;<span class="op" id="6531826">=</span>&nbsp;<span class="num" id="6531828">42</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531832">b</span><span class="op" id="6531833">,</span>&nbsp;<span class="ident" id="6531835">err</span>&nbsp;<span class="op" id="6531839">:=</span>&nbsp;<span class="ident" id="6531842">Marshal</span><span class="op" id="6531849">(</span><span class="ident" id="6531850">stringPointer</span><span class="op" id="6531863">{</span><span class="ident" id="6531864">N</span><span class="op" id="6531865">:</span>&nbsp;<span class="op" id="6531867">&amp;</span><span class="ident" id="6531868">n</span><span class="op" id="6531869">}</span><span class="op" id="6531870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6531873">if</span>&nbsp;<span class="ident" id="6531876">err</span>&nbsp;<span class="op" id="6531880">!=</span>&nbsp;<span class="ident" id="6531883">nil</span>&nbsp;<span class="op" id="6531887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531891">t</span><span class="op" id="6531892">.</span><span class="ident" id="6531893">Fatalf</span><span class="op" id="6531899">(</span><span class="string" id="6531900">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="6531913">,</span>&nbsp;<span class="ident" id="6531915">err</span><span class="op" id="6531918">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6531924">if</span>&nbsp;<span class="ident" id="6531927">got</span><span class="op" id="6531930">,</span>&nbsp;<span class="ident" id="6531932">want</span>&nbsp;<span class="op" id="6531937">:=</span>&nbsp;<span class="builtintype" id="6531940">string</span><span class="op" id="6531946">(</span><span class="ident" id="6531947">b</span><span class="op" id="6531948">)</span><span class="op" id="6531949">,</span>&nbsp;<span class="string" id="6531951">`{&#34;n&#34;:&#34;42&#34;}`</span><span class="op" id="6531963">;</span>&nbsp;<span class="ident" id="6531965">got</span>&nbsp;<span class="op" id="6531969">!=</span>&nbsp;<span class="ident" id="6531972">want</span>&nbsp;<span class="op" id="6531977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531981">t</span><span class="op" id="6531982">.</span><span class="ident" id="6531983">Errorf</span><span class="op" id="6531989">(</span><span class="string" id="6531990">&#34;Marshal&nbsp;=&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6532013">,</span>&nbsp;<span class="ident" id="6532015">got</span><span class="op" id="6532018">,</span>&nbsp;<span class="ident" id="6532020">want</span><span class="op" id="6532024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532030">var</span>&nbsp;<span class="ident" id="6532034">back</span>&nbsp;<span class="ident" id="6532039">stringPointer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532054">err</span>&nbsp;<span class="op" id="6532058">=</span>&nbsp;<span class="ident" id="6532060">Unmarshal</span><span class="op" id="6532069">(</span><span class="ident" id="6532070">b</span><span class="op" id="6532071">,</span>&nbsp;<span class="op" id="6532073">&amp;</span><span class="ident" id="6532074">back</span><span class="op" id="6532078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532081">if</span>&nbsp;<span class="ident" id="6532084">err</span>&nbsp;<span class="op" id="6532088">!=</span>&nbsp;<span class="ident" id="6532091">nil</span>&nbsp;<span class="op" id="6532095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532099">t</span><span class="op" id="6532100">.</span><span class="ident" id="6532101">Fatalf</span><span class="op" id="6532107">(</span><span class="string" id="6532108">&#34;Unmarshal:&nbsp;%v&#34;</span><span class="op" id="6532123">,</span>&nbsp;<span class="ident" id="6532125">err</span><span class="op" id="6532128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532134">if</span>&nbsp;<span class="ident" id="6532137">back</span><span class="op" id="6532141">.</span><span class="ident" id="6532142">N</span>&nbsp;<span class="op" id="6532144">==</span>&nbsp;<span class="ident" id="6532147">nil</span>&nbsp;<span class="op" id="6532151">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532155">t</span><span class="op" id="6532156">.</span><span class="ident" id="6532157">Fatalf</span><span class="op" id="6532163">(</span><span class="string" id="6532164">&#34;Unmarshalled&nbsp;nil&nbsp;N&nbsp;field&#34;</span><span class="op" id="6532190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532196">if</span>&nbsp;<span class="op" id="6532199">*</span><span class="ident" id="6532200">back</span><span class="op" id="6532204">.</span><span class="ident" id="6532205">N</span>&nbsp;<span class="op" id="6532207">!=</span>&nbsp;<span class="num" id="6532210">42</span>&nbsp;<span class="op" id="6532213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532217">t</span><span class="op" id="6532218">.</span><span class="ident" id="6532219">Fatalf</span><span class="op" id="6532225">(</span><span class="string" id="6532226">&#34;*N&nbsp;=&nbsp;%d;&nbsp;want&nbsp;42&#34;</span><span class="op" id="6532244">,</span>&nbsp;<span class="op" id="6532246">*</span><span class="ident" id="6532247">back</span><span class="op" id="6532251">.</span><span class="ident" id="6532252">N</span><span class="op" id="6532253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532256">}</span><br>
<span class="lineno">480</span><span class="op" id="6532258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6532261">var</span>&nbsp;<span class="ident" id="6532265">encodeStringTests</span>&nbsp;<span class="op" id="6532283">=</span>&nbsp;<span class="op" id="6532285">[</span><span class="op" id="6532286">]</span><span class="keyword" id="6532287">struct</span>&nbsp;<span class="op" id="6532294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532297">in</span>&nbsp;&nbsp;<span class="builtintype" id="6532301">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532309">out</span>&nbsp;<span class="builtintype" id="6532313">string</span><br>
<span class="lineno">485</span><span class="op" id="6532320">}</span><span class="op" id="6532321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532324">{</span><span class="string" id="6532325">&#34;\x00&#34;</span><span class="op" id="6532331">,</span>&nbsp;<span class="string" id="6532333">`&#34;\u0000&#34;`</span><span class="op" id="6532343">}</span><span class="op" id="6532344">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532347">{</span><span class="string" id="6532348">&#34;\x01&#34;</span><span class="op" id="6532354">,</span>&nbsp;<span class="string" id="6532356">`&#34;\u0001&#34;`</span><span class="op" id="6532366">}</span><span class="op" id="6532367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532370">{</span><span class="string" id="6532371">&#34;\x02&#34;</span><span class="op" id="6532377">,</span>&nbsp;<span class="string" id="6532379">`&#34;\u0002&#34;`</span><span class="op" id="6532389">}</span><span class="op" id="6532390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532393">{</span><span class="string" id="6532394">&#34;\x03&#34;</span><span class="op" id="6532400">,</span>&nbsp;<span class="string" id="6532402">`&#34;\u0003&#34;`</span><span class="op" id="6532412">}</span><span class="op" id="6532413">,</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532416">{</span><span class="string" id="6532417">&#34;\x04&#34;</span><span class="op" id="6532423">,</span>&nbsp;<span class="string" id="6532425">`&#34;\u0004&#34;`</span><span class="op" id="6532435">}</span><span class="op" id="6532436">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532439">{</span><span class="string" id="6532440">&#34;\x05&#34;</span><span class="op" id="6532446">,</span>&nbsp;<span class="string" id="6532448">`&#34;\u0005&#34;`</span><span class="op" id="6532458">}</span><span class="op" id="6532459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532462">{</span><span class="string" id="6532463">&#34;\x06&#34;</span><span class="op" id="6532469">,</span>&nbsp;<span class="string" id="6532471">`&#34;\u0006&#34;`</span><span class="op" id="6532481">}</span><span class="op" id="6532482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532485">{</span><span class="string" id="6532486">&#34;\x07&#34;</span><span class="op" id="6532492">,</span>&nbsp;<span class="string" id="6532494">`&#34;\u0007&#34;`</span><span class="op" id="6532504">}</span><span class="op" id="6532505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532508">{</span><span class="string" id="6532509">&#34;\x08&#34;</span><span class="op" id="6532515">,</span>&nbsp;<span class="string" id="6532517">`&#34;\u0008&#34;`</span><span class="op" id="6532527">}</span><span class="op" id="6532528">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532531">{</span><span class="string" id="6532532">&#34;\x09&#34;</span><span class="op" id="6532538">,</span>&nbsp;<span class="string" id="6532540">`&#34;\t&#34;`</span><span class="op" id="6532546">}</span><span class="op" id="6532547">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532550">{</span><span class="string" id="6532551">&#34;\x0a&#34;</span><span class="op" id="6532557">,</span>&nbsp;<span class="string" id="6532559">`&#34;\n&#34;`</span><span class="op" id="6532565">}</span><span class="op" id="6532566">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532569">{</span><span class="string" id="6532570">&#34;\x0b&#34;</span><span class="op" id="6532576">,</span>&nbsp;<span class="string" id="6532578">`&#34;\u000b&#34;`</span><span class="op" id="6532588">}</span><span class="op" id="6532589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532592">{</span><span class="string" id="6532593">&#34;\x0c&#34;</span><span class="op" id="6532599">,</span>&nbsp;<span class="string" id="6532601">`&#34;\u000c&#34;`</span><span class="op" id="6532611">}</span><span class="op" id="6532612">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532615">{</span><span class="string" id="6532616">&#34;\x0d&#34;</span><span class="op" id="6532622">,</span>&nbsp;<span class="string" id="6532624">`&#34;\r&#34;`</span><span class="op" id="6532630">}</span><span class="op" id="6532631">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532634">{</span><span class="string" id="6532635">&#34;\x0e&#34;</span><span class="op" id="6532641">,</span>&nbsp;<span class="string" id="6532643">`&#34;\u000e&#34;`</span><span class="op" id="6532653">}</span><span class="op" id="6532654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532657">{</span><span class="string" id="6532658">&#34;\x0f&#34;</span><span class="op" id="6532664">,</span>&nbsp;<span class="string" id="6532666">`&#34;\u000f&#34;`</span><span class="op" id="6532676">}</span><span class="op" id="6532677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532680">{</span><span class="string" id="6532681">&#34;\x10&#34;</span><span class="op" id="6532687">,</span>&nbsp;<span class="string" id="6532689">`&#34;\u0010&#34;`</span><span class="op" id="6532699">}</span><span class="op" id="6532700">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532703">{</span><span class="string" id="6532704">&#34;\x11&#34;</span><span class="op" id="6532710">,</span>&nbsp;<span class="string" id="6532712">`&#34;\u0011&#34;`</span><span class="op" id="6532722">}</span><span class="op" id="6532723">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532726">{</span><span class="string" id="6532727">&#34;\x12&#34;</span><span class="op" id="6532733">,</span>&nbsp;<span class="string" id="6532735">`&#34;\u0012&#34;`</span><span class="op" id="6532745">}</span><span class="op" id="6532746">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532749">{</span><span class="string" id="6532750">&#34;\x13&#34;</span><span class="op" id="6532756">,</span>&nbsp;<span class="string" id="6532758">`&#34;\u0013&#34;`</span><span class="op" id="6532768">}</span><span class="op" id="6532769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532772">{</span><span class="string" id="6532773">&#34;\x14&#34;</span><span class="op" id="6532779">,</span>&nbsp;<span class="string" id="6532781">`&#34;\u0014&#34;`</span><span class="op" id="6532791">}</span><span class="op" id="6532792">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532795">{</span><span class="string" id="6532796">&#34;\x15&#34;</span><span class="op" id="6532802">,</span>&nbsp;<span class="string" id="6532804">`&#34;\u0015&#34;`</span><span class="op" id="6532814">}</span><span class="op" id="6532815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532818">{</span><span class="string" id="6532819">&#34;\x16&#34;</span><span class="op" id="6532825">,</span>&nbsp;<span class="string" id="6532827">`&#34;\u0016&#34;`</span><span class="op" id="6532837">}</span><span class="op" id="6532838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532841">{</span><span class="string" id="6532842">&#34;\x17&#34;</span><span class="op" id="6532848">,</span>&nbsp;<span class="string" id="6532850">`&#34;\u0017&#34;`</span><span class="op" id="6532860">}</span><span class="op" id="6532861">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532864">{</span><span class="string" id="6532865">&#34;\x18&#34;</span><span class="op" id="6532871">,</span>&nbsp;<span class="string" id="6532873">`&#34;\u0018&#34;`</span><span class="op" id="6532883">}</span><span class="op" id="6532884">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532887">{</span><span class="string" id="6532888">&#34;\x19&#34;</span><span class="op" id="6532894">,</span>&nbsp;<span class="string" id="6532896">`&#34;\u0019&#34;`</span><span class="op" id="6532906">}</span><span class="op" id="6532907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532910">{</span><span class="string" id="6532911">&#34;\x1a&#34;</span><span class="op" id="6532917">,</span>&nbsp;<span class="string" id="6532919">`&#34;\u001a&#34;`</span><span class="op" id="6532929">}</span><span class="op" id="6532930">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532933">{</span><span class="string" id="6532934">&#34;\x1b&#34;</span><span class="op" id="6532940">,</span>&nbsp;<span class="string" id="6532942">`&#34;\u001b&#34;`</span><span class="op" id="6532952">}</span><span class="op" id="6532953">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532956">{</span><span class="string" id="6532957">&#34;\x1c&#34;</span><span class="op" id="6532963">,</span>&nbsp;<span class="string" id="6532965">`&#34;\u001c&#34;`</span><span class="op" id="6532975">}</span><span class="op" id="6532976">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532979">{</span><span class="string" id="6532980">&#34;\x1d&#34;</span><span class="op" id="6532986">,</span>&nbsp;<span class="string" id="6532988">`&#34;\u001d&#34;`</span><span class="op" id="6532998">}</span><span class="op" id="6532999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533002">{</span><span class="string" id="6533003">&#34;\x1e&#34;</span><span class="op" id="6533009">,</span>&nbsp;<span class="string" id="6533011">`&#34;\u001e&#34;`</span><span class="op" id="6533021">}</span><span class="op" id="6533022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533025">{</span><span class="string" id="6533026">&#34;\x1f&#34;</span><span class="op" id="6533032">,</span>&nbsp;<span class="string" id="6533034">`&#34;\u001f&#34;`</span><span class="op" id="6533044">}</span><span class="op" id="6533045">,</span><br>
<span class="lineno"></span><span class="op" id="6533047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span><span class="keyword" id="6533050">func</span>&nbsp;<span class="ident" id="6533055">TestEncodeString</span><span class="op" id="6533071">(</span><span class="ident" id="6533072">t</span>&nbsp;<span class="op" id="6533074">*</span><span class="ident" id="6533075">testing</span><span class="op" id="6533082">.</span><span class="ident" id="6533083">T</span><span class="op" id="6533084">)</span>&nbsp;<span class="op" id="6533086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533089">for</span>&nbsp;<span class="ident" id="6533093">_</span><span class="op" id="6533094">,</span>&nbsp;<span class="ident" id="6533096">tt</span>&nbsp;<span class="op" id="6533099">:=</span>&nbsp;<span class="keyword" id="6533102">range</span>&nbsp;<span class="ident" id="6533108">encodeStringTests</span>&nbsp;<span class="op" id="6533126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533130">b</span><span class="op" id="6533131">,</span>&nbsp;<span class="ident" id="6533133">err</span>&nbsp;<span class="op" id="6533137">:=</span>&nbsp;<span class="ident" id="6533140">Marshal</span><span class="op" id="6533147">(</span><span class="ident" id="6533148">tt</span><span class="op" id="6533150">.</span><span class="ident" id="6533151">in</span><span class="op" id="6533153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533157">if</span>&nbsp;<span class="ident" id="6533160">err</span>&nbsp;<span class="op" id="6533164">!=</span>&nbsp;<span class="ident" id="6533167">nil</span>&nbsp;<span class="op" id="6533171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533176">t</span><span class="op" id="6533177">.</span><span class="ident" id="6533178">Errorf</span><span class="op" id="6533184">(</span><span class="string" id="6533185">&#34;Marshal(%q):&nbsp;%v&#34;</span><span class="op" id="6533202">,</span>&nbsp;<span class="ident" id="6533204">tt</span><span class="op" id="6533206">.</span><span class="ident" id="6533207">in</span><span class="op" id="6533209">,</span>&nbsp;<span class="ident" id="6533211">err</span><span class="op" id="6533214">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533219">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533234">out</span>&nbsp;<span class="op" id="6533238">:=</span>&nbsp;<span class="builtintype" id="6533241">string</span><span class="op" id="6533247">(</span><span class="ident" id="6533248">b</span><span class="op" id="6533249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533253">if</span>&nbsp;<span class="ident" id="6533256">out</span>&nbsp;<span class="op" id="6533260">!=</span>&nbsp;<span class="ident" id="6533263">tt</span><span class="op" id="6533265">.</span><span class="ident" id="6533266">out</span>&nbsp;<span class="op" id="6533270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533275">t</span><span class="op" id="6533276">.</span><span class="ident" id="6533277">Errorf</span><span class="op" id="6533283">(</span><span class="string" id="6533284">&#34;Marshal(%q)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6533313">,</span>&nbsp;<span class="ident" id="6533315">tt</span><span class="op" id="6533317">.</span><span class="ident" id="6533318">in</span><span class="op" id="6533320">,</span>&nbsp;<span class="ident" id="6533322">out</span><span class="op" id="6533325">,</span>&nbsp;<span class="ident" id="6533327">tt</span><span class="op" id="6533329">.</span><span class="ident" id="6533330">out</span><span class="op" id="6533333">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533340">}</span><br>
<span class="lineno"></span><span class="op" id="6533342">}</span>
</div>
</body>
</html>
