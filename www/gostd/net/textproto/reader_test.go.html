<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6822382">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6822438">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6822492">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6822543">package</span>&nbsp;<span class="ident" id="6822551">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6822562">import</span>&nbsp;<span class="op" id="6822569">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6822572">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6822581">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6822590">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6822596">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6822607">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6822618">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6822628">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6822631">type</span>&nbsp;<span class="ident" id="6822636">canonicalHeaderKeyTest</span>&nbsp;<span class="keyword" id="6822659">struct</span>&nbsp;<span class="op" id="6822666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6822669">in</span><span class="op" id="6822671">,</span>&nbsp;<span class="ident" id="6822673">out</span>&nbsp;<span class="builtintype" id="6822677">string</span><br>
<span class="lineno"></span><span class="op" id="6822684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6822687">var</span>&nbsp;<span class="ident" id="6822691">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="6822715">=</span>&nbsp;<span class="op" id="6822717">[</span><span class="op" id="6822718">]</span><span class="ident" id="6822719">canonicalHeaderKeyTest</span><span class="op" id="6822741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6822744">{</span><span class="string" id="6822745">&#34;a-b-c&#34;</span><span class="op" id="6822752">,</span>&nbsp;<span class="string" id="6822754">&#34;A-B-C&#34;</span><span class="op" id="6822761">}</span><span class="op" id="6822762">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6822765">{</span><span class="string" id="6822766">&#34;a-1-c&#34;</span><span class="op" id="6822773">,</span>&nbsp;<span class="string" id="6822775">&#34;A-1-C&#34;</span><span class="op" id="6822782">}</span><span class="op" id="6822783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6822786">{</span><span class="string" id="6822787">&#34;User-Agent&#34;</span><span class="op" id="6822799">,</span>&nbsp;<span class="string" id="6822801">&#34;User-Agent&#34;</span><span class="op" id="6822813">}</span><span class="op" id="6822814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6822817">{</span><span class="string" id="6822818">&#34;uSER-aGENT&#34;</span><span class="op" id="6822830">,</span>&nbsp;<span class="string" id="6822832">&#34;User-Agent&#34;</span><span class="op" id="6822844">}</span><span class="op" id="6822845">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6822848">{</span><span class="string" id="6822849">&#34;user-agent&#34;</span><span class="op" id="6822861">,</span>&nbsp;<span class="string" id="6822863">&#34;User-Agent&#34;</span><span class="op" id="6822875">}</span><span class="op" id="6822876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6822879">{</span><span class="string" id="6822880">&#34;USER-AGENT&#34;</span><span class="op" id="6822892">,</span>&nbsp;<span class="string" id="6822894">&#34;User-Agent&#34;</span><span class="op" id="6822906">}</span><span class="op" id="6822907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6822910">{</span><span class="string" id="6822911">&#34;üser-agenT&#34;</span><span class="op" id="6822924">,</span>&nbsp;<span class="string" id="6822926">&#34;üser-Agent&#34;</span><span class="op" id="6822939">}</span><span class="op" id="6822940">,</span>&nbsp;<span class="comment" id="6822942">//&nbsp;non-ASCII&nbsp;unchanged</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6822967">//&nbsp;This&nbsp;caused&nbsp;a&nbsp;panic&nbsp;due&nbsp;to&nbsp;mishandling&nbsp;of&nbsp;a&nbsp;space:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823022">{</span><span class="string" id="6823023">&#34;C&nbsp;Ontent-Transfer-Encoding&#34;</span><span class="op" id="6823051">,</span>&nbsp;<span class="string" id="6823053">&#34;C-Ontent-Transfer-Encoding&#34;</span><span class="op" id="6823081">}</span><span class="op" id="6823082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823085">{</span><span class="string" id="6823086">&#34;foo&nbsp;bar&#34;</span><span class="op" id="6823095">,</span>&nbsp;<span class="string" id="6823097">&#34;Foo-Bar&#34;</span><span class="op" id="6823106">}</span><span class="op" id="6823107">,</span><br>
<span class="lineno"></span><span class="op" id="6823109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6823112">func</span>&nbsp;<span class="ident" id="6823117">TestCanonicalMIMEHeaderKey</span><span class="op" id="6823143">(</span><span class="ident" id="6823144">t</span>&nbsp;<span class="op" id="6823146">*</span><span class="ident" id="6823147">testing</span><span class="op" id="6823154">.</span><span class="ident" id="6823155">T</span><span class="op" id="6823156">)</span>&nbsp;<span class="op" id="6823158">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823161">for</span>&nbsp;<span class="ident" id="6823165">_</span><span class="op" id="6823166">,</span>&nbsp;<span class="ident" id="6823168">tt</span>&nbsp;<span class="op" id="6823171">:=</span>&nbsp;<span class="keyword" id="6823174">range</span>&nbsp;<span class="ident" id="6823180">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="6823204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823208">if</span>&nbsp;<span class="ident" id="6823211">s</span>&nbsp;<span class="op" id="6823213">:=</span>&nbsp;<span class="ident" id="6823216">CanonicalMIMEHeaderKey</span><span class="op" id="6823238">(</span><span class="ident" id="6823239">tt</span><span class="op" id="6823241">.</span><span class="ident" id="6823242">in</span><span class="op" id="6823244">)</span><span class="op" id="6823245">;</span>&nbsp;<span class="ident" id="6823247">s</span>&nbsp;<span class="op" id="6823249">!=</span>&nbsp;<span class="ident" id="6823252">tt</span><span class="op" id="6823254">.</span><span class="ident" id="6823255">out</span>&nbsp;<span class="op" id="6823259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823264">t</span><span class="op" id="6823265">.</span><span class="ident" id="6823266">Errorf</span><span class="op" id="6823272">(</span><span class="string" id="6823273">&#34;CanonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6823315">,</span>&nbsp;<span class="ident" id="6823317">tt</span><span class="op" id="6823319">.</span><span class="ident" id="6823320">in</span><span class="op" id="6823322">,</span>&nbsp;<span class="ident" id="6823324">s</span><span class="op" id="6823325">,</span>&nbsp;<span class="ident" id="6823327">tt</span><span class="op" id="6823329">.</span><span class="ident" id="6823330">out</span><span class="op" id="6823333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823340">}</span><br>
<span class="lineno">40</span><span class="op" id="6823342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6823345">func</span>&nbsp;<span class="ident" id="6823350">reader</span><span class="op" id="6823356">(</span><span class="ident" id="6823357">s</span>&nbsp;<span class="builtintype" id="6823359">string</span><span class="op" id="6823365">)</span>&nbsp;<span class="op" id="6823367">*</span><span class="ident" id="6823368">Reader</span>&nbsp;<span class="op" id="6823375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823378">return</span>&nbsp;<span class="ident" id="6823385">NewReader</span><span class="op" id="6823394">(</span><span class="ident" id="6823395">bufio</span><span class="op" id="6823400">.</span><span class="ident" id="6823401">NewReader</span><span class="op" id="6823410">(</span><span class="ident" id="6823411">strings</span><span class="op" id="6823418">.</span><span class="ident" id="6823419">NewReader</span><span class="op" id="6823428">(</span><span class="ident" id="6823429">s</span><span class="op" id="6823430">)</span><span class="op" id="6823431">)</span><span class="op" id="6823432">)</span><br>
<span class="lineno"></span><span class="op" id="6823434">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="6823437">func</span>&nbsp;<span class="ident" id="6823442">TestReadLine</span><span class="op" id="6823454">(</span><span class="ident" id="6823455">t</span>&nbsp;<span class="op" id="6823457">*</span><span class="ident" id="6823458">testing</span><span class="op" id="6823465">.</span><span class="ident" id="6823466">T</span><span class="op" id="6823467">)</span>&nbsp;<span class="op" id="6823469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823472">r</span>&nbsp;<span class="op" id="6823474">:=</span>&nbsp;<span class="ident" id="6823477">reader</span><span class="op" id="6823483">(</span><span class="string" id="6823484">&#34;line1\nline2\n&#34;</span><span class="op" id="6823500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823503">s</span><span class="op" id="6823504">,</span>&nbsp;<span class="ident" id="6823506">err</span>&nbsp;<span class="op" id="6823510">:=</span>&nbsp;<span class="ident" id="6823513">r</span><span class="op" id="6823514">.</span><span class="ident" id="6823515">ReadLine</span><span class="op" id="6823523">(</span><span class="op" id="6823524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823527">if</span>&nbsp;<span class="ident" id="6823530">s</span>&nbsp;<span class="op" id="6823532">!=</span>&nbsp;<span class="string" id="6823535">&#34;line1&#34;</span>&nbsp;<span class="op" id="6823543">||</span>&nbsp;<span class="ident" id="6823546">err</span>&nbsp;<span class="op" id="6823550">!=</span>&nbsp;<span class="ident" id="6823553">nil</span>&nbsp;<span class="op" id="6823557">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823561">t</span><span class="op" id="6823562">.</span><span class="ident" id="6823563">Fatalf</span><span class="op" id="6823569">(</span><span class="string" id="6823570">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6823586">,</span>&nbsp;<span class="ident" id="6823588">s</span><span class="op" id="6823589">,</span>&nbsp;<span class="ident" id="6823591">err</span><span class="op" id="6823594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823600">s</span><span class="op" id="6823601">,</span>&nbsp;<span class="ident" id="6823603">err</span>&nbsp;<span class="op" id="6823607">=</span>&nbsp;<span class="ident" id="6823609">r</span><span class="op" id="6823610">.</span><span class="ident" id="6823611">ReadLine</span><span class="op" id="6823619">(</span><span class="op" id="6823620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823623">if</span>&nbsp;<span class="ident" id="6823626">s</span>&nbsp;<span class="op" id="6823628">!=</span>&nbsp;<span class="string" id="6823631">&#34;line2&#34;</span>&nbsp;<span class="op" id="6823639">||</span>&nbsp;<span class="ident" id="6823642">err</span>&nbsp;<span class="op" id="6823646">!=</span>&nbsp;<span class="ident" id="6823649">nil</span>&nbsp;<span class="op" id="6823653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823657">t</span><span class="op" id="6823658">.</span><span class="ident" id="6823659">Fatalf</span><span class="op" id="6823665">(</span><span class="string" id="6823666">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6823682">,</span>&nbsp;<span class="ident" id="6823684">s</span><span class="op" id="6823685">,</span>&nbsp;<span class="ident" id="6823687">err</span><span class="op" id="6823690">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823696">s</span><span class="op" id="6823697">,</span>&nbsp;<span class="ident" id="6823699">err</span>&nbsp;<span class="op" id="6823703">=</span>&nbsp;<span class="ident" id="6823705">r</span><span class="op" id="6823706">.</span><span class="ident" id="6823707">ReadLine</span><span class="op" id="6823715">(</span><span class="op" id="6823716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823719">if</span>&nbsp;<span class="ident" id="6823722">s</span>&nbsp;<span class="op" id="6823724">!=</span>&nbsp;<span class="string" id="6823727">&#34;&#34;</span>&nbsp;<span class="op" id="6823730">||</span>&nbsp;<span class="ident" id="6823733">err</span>&nbsp;<span class="op" id="6823737">!=</span>&nbsp;<span class="ident" id="6823740">io</span><span class="op" id="6823742">.</span><span class="ident" id="6823743">EOF</span>&nbsp;<span class="op" id="6823747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823751">t</span><span class="op" id="6823752">.</span><span class="ident" id="6823753">Fatalf</span><span class="op" id="6823759">(</span><span class="string" id="6823760">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6823773">,</span>&nbsp;<span class="ident" id="6823775">s</span><span class="op" id="6823776">,</span>&nbsp;<span class="ident" id="6823778">err</span><span class="op" id="6823781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823784">}</span><br>
<span class="lineno">60</span><span class="op" id="6823786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6823789">func</span>&nbsp;<span class="ident" id="6823794">TestReadContinuedLine</span><span class="op" id="6823815">(</span><span class="ident" id="6823816">t</span>&nbsp;<span class="op" id="6823818">*</span><span class="ident" id="6823819">testing</span><span class="op" id="6823826">.</span><span class="ident" id="6823827">T</span><span class="op" id="6823828">)</span>&nbsp;<span class="op" id="6823830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823833">r</span>&nbsp;<span class="op" id="6823835">:=</span>&nbsp;<span class="ident" id="6823838">reader</span><span class="op" id="6823844">(</span><span class="string" id="6823845">&#34;line1\nline\n&nbsp;2\nline3\n&#34;</span><span class="op" id="6823871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823874">s</span><span class="op" id="6823875">,</span>&nbsp;<span class="ident" id="6823877">err</span>&nbsp;<span class="op" id="6823881">:=</span>&nbsp;<span class="ident" id="6823884">r</span><span class="op" id="6823885">.</span><span class="ident" id="6823886">ReadContinuedLine</span><span class="op" id="6823903">(</span><span class="op" id="6823904">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823907">if</span>&nbsp;<span class="ident" id="6823910">s</span>&nbsp;<span class="op" id="6823912">!=</span>&nbsp;<span class="string" id="6823915">&#34;line1&#34;</span>&nbsp;<span class="op" id="6823923">||</span>&nbsp;<span class="ident" id="6823926">err</span>&nbsp;<span class="op" id="6823930">!=</span>&nbsp;<span class="ident" id="6823933">nil</span>&nbsp;<span class="op" id="6823937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823941">t</span><span class="op" id="6823942">.</span><span class="ident" id="6823943">Fatalf</span><span class="op" id="6823949">(</span><span class="string" id="6823950">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6823966">,</span>&nbsp;<span class="ident" id="6823968">s</span><span class="op" id="6823969">,</span>&nbsp;<span class="ident" id="6823971">err</span><span class="op" id="6823974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823980">s</span><span class="op" id="6823981">,</span>&nbsp;<span class="ident" id="6823983">err</span>&nbsp;<span class="op" id="6823987">=</span>&nbsp;<span class="ident" id="6823989">r</span><span class="op" id="6823990">.</span><span class="ident" id="6823991">ReadContinuedLine</span><span class="op" id="6824008">(</span><span class="op" id="6824009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6824012">if</span>&nbsp;<span class="ident" id="6824015">s</span>&nbsp;<span class="op" id="6824017">!=</span>&nbsp;<span class="string" id="6824020">&#34;line&nbsp;2&#34;</span>&nbsp;<span class="op" id="6824029">||</span>&nbsp;<span class="ident" id="6824032">err</span>&nbsp;<span class="op" id="6824036">!=</span>&nbsp;<span class="ident" id="6824039">nil</span>&nbsp;<span class="op" id="6824043">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824047">t</span><span class="op" id="6824048">.</span><span class="ident" id="6824049">Fatalf</span><span class="op" id="6824055">(</span><span class="string" id="6824056">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6824072">,</span>&nbsp;<span class="ident" id="6824074">s</span><span class="op" id="6824075">,</span>&nbsp;<span class="ident" id="6824077">err</span><span class="op" id="6824080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6824083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824086">s</span><span class="op" id="6824087">,</span>&nbsp;<span class="ident" id="6824089">err</span>&nbsp;<span class="op" id="6824093">=</span>&nbsp;<span class="ident" id="6824095">r</span><span class="op" id="6824096">.</span><span class="ident" id="6824097">ReadContinuedLine</span><span class="op" id="6824114">(</span><span class="op" id="6824115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6824118">if</span>&nbsp;<span class="ident" id="6824121">s</span>&nbsp;<span class="op" id="6824123">!=</span>&nbsp;<span class="string" id="6824126">&#34;line3&#34;</span>&nbsp;<span class="op" id="6824134">||</span>&nbsp;<span class="ident" id="6824137">err</span>&nbsp;<span class="op" id="6824141">!=</span>&nbsp;<span class="ident" id="6824144">nil</span>&nbsp;<span class="op" id="6824148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824152">t</span><span class="op" id="6824153">.</span><span class="ident" id="6824154">Fatalf</span><span class="op" id="6824160">(</span><span class="string" id="6824161">&#34;Line&nbsp;3:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6824177">,</span>&nbsp;<span class="ident" id="6824179">s</span><span class="op" id="6824180">,</span>&nbsp;<span class="ident" id="6824182">err</span><span class="op" id="6824185">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6824188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824191">s</span><span class="op" id="6824192">,</span>&nbsp;<span class="ident" id="6824194">err</span>&nbsp;<span class="op" id="6824198">=</span>&nbsp;<span class="ident" id="6824200">r</span><span class="op" id="6824201">.</span><span class="ident" id="6824202">ReadContinuedLine</span><span class="op" id="6824219">(</span><span class="op" id="6824220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6824223">if</span>&nbsp;<span class="ident" id="6824226">s</span>&nbsp;<span class="op" id="6824228">!=</span>&nbsp;<span class="string" id="6824231">&#34;&#34;</span>&nbsp;<span class="op" id="6824234">||</span>&nbsp;<span class="ident" id="6824237">err</span>&nbsp;<span class="op" id="6824241">!=</span>&nbsp;<span class="ident" id="6824244">io</span><span class="op" id="6824246">.</span><span class="ident" id="6824247">EOF</span>&nbsp;<span class="op" id="6824251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824255">t</span><span class="op" id="6824256">.</span><span class="ident" id="6824257">Fatalf</span><span class="op" id="6824263">(</span><span class="string" id="6824264">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6824277">,</span>&nbsp;<span class="ident" id="6824279">s</span><span class="op" id="6824280">,</span>&nbsp;<span class="ident" id="6824282">err</span><span class="op" id="6824285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6824288">}</span><br>
<span class="lineno">80</span><span class="op" id="6824290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6824293">func</span>&nbsp;<span class="ident" id="6824298">TestReadCodeLine</span><span class="op" id="6824314">(</span><span class="ident" id="6824315">t</span>&nbsp;<span class="op" id="6824317">*</span><span class="ident" id="6824318">testing</span><span class="op" id="6824325">.</span><span class="ident" id="6824326">T</span><span class="op" id="6824327">)</span>&nbsp;<span class="op" id="6824329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824332">r</span>&nbsp;<span class="op" id="6824334">:=</span>&nbsp;<span class="ident" id="6824337">reader</span><span class="op" id="6824343">(</span><span class="string" id="6824344">&#34;123&nbsp;hi\n234&nbsp;bye\n345&nbsp;no&nbsp;way\n&#34;</span><span class="op" id="6824375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824378">code</span><span class="op" id="6824382">,</span>&nbsp;<span class="ident" id="6824384">msg</span><span class="op" id="6824387">,</span>&nbsp;<span class="ident" id="6824389">err</span>&nbsp;<span class="op" id="6824393">:=</span>&nbsp;<span class="ident" id="6824396">r</span><span class="op" id="6824397">.</span><span class="ident" id="6824398">ReadCodeLine</span><span class="op" id="6824410">(</span><span class="num" id="6824411">0</span><span class="op" id="6824412">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6824415">if</span>&nbsp;<span class="ident" id="6824418">code</span>&nbsp;<span class="op" id="6824423">!=</span>&nbsp;<span class="num" id="6824426">123</span>&nbsp;<span class="op" id="6824430">||</span>&nbsp;<span class="ident" id="6824433">msg</span>&nbsp;<span class="op" id="6824437">!=</span>&nbsp;<span class="string" id="6824440">&#34;hi&#34;</span>&nbsp;<span class="op" id="6824445">||</span>&nbsp;<span class="ident" id="6824448">err</span>&nbsp;<span class="op" id="6824452">!=</span>&nbsp;<span class="ident" id="6824455">nil</span>&nbsp;<span class="op" id="6824459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824463">t</span><span class="op" id="6824464">.</span><span class="ident" id="6824465">Fatalf</span><span class="op" id="6824471">(</span><span class="string" id="6824472">&#34;Line&nbsp;1:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6824492">,</span>&nbsp;<span class="ident" id="6824494">code</span><span class="op" id="6824498">,</span>&nbsp;<span class="ident" id="6824500">msg</span><span class="op" id="6824503">,</span>&nbsp;<span class="ident" id="6824505">err</span><span class="op" id="6824508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6824511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824514">code</span><span class="op" id="6824518">,</span>&nbsp;<span class="ident" id="6824520">msg</span><span class="op" id="6824523">,</span>&nbsp;<span class="ident" id="6824525">err</span>&nbsp;<span class="op" id="6824529">=</span>&nbsp;<span class="ident" id="6824531">r</span><span class="op" id="6824532">.</span><span class="ident" id="6824533">ReadCodeLine</span><span class="op" id="6824545">(</span><span class="num" id="6824546">23</span><span class="op" id="6824548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6824551">if</span>&nbsp;<span class="ident" id="6824554">code</span>&nbsp;<span class="op" id="6824559">!=</span>&nbsp;<span class="num" id="6824562">234</span>&nbsp;<span class="op" id="6824566">||</span>&nbsp;<span class="ident" id="6824569">msg</span>&nbsp;<span class="op" id="6824573">!=</span>&nbsp;<span class="string" id="6824576">&#34;bye&#34;</span>&nbsp;<span class="op" id="6824582">||</span>&nbsp;<span class="ident" id="6824585">err</span>&nbsp;<span class="op" id="6824589">!=</span>&nbsp;<span class="ident" id="6824592">nil</span>&nbsp;<span class="op" id="6824596">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824600">t</span><span class="op" id="6824601">.</span><span class="ident" id="6824602">Fatalf</span><span class="op" id="6824608">(</span><span class="string" id="6824609">&#34;Line&nbsp;2:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6824629">,</span>&nbsp;<span class="ident" id="6824631">code</span><span class="op" id="6824635">,</span>&nbsp;<span class="ident" id="6824637">msg</span><span class="op" id="6824640">,</span>&nbsp;<span class="ident" id="6824642">err</span><span class="op" id="6824645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6824648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824651">code</span><span class="op" id="6824655">,</span>&nbsp;<span class="ident" id="6824657">msg</span><span class="op" id="6824660">,</span>&nbsp;<span class="ident" id="6824662">err</span>&nbsp;<span class="op" id="6824666">=</span>&nbsp;<span class="ident" id="6824668">r</span><span class="op" id="6824669">.</span><span class="ident" id="6824670">ReadCodeLine</span><span class="op" id="6824682">(</span><span class="num" id="6824683">346</span><span class="op" id="6824686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6824689">if</span>&nbsp;<span class="ident" id="6824692">code</span>&nbsp;<span class="op" id="6824697">!=</span>&nbsp;<span class="num" id="6824700">345</span>&nbsp;<span class="op" id="6824704">||</span>&nbsp;<span class="ident" id="6824707">msg</span>&nbsp;<span class="op" id="6824711">!=</span>&nbsp;<span class="string" id="6824714">&#34;no&nbsp;way&#34;</span>&nbsp;<span class="op" id="6824723">||</span>&nbsp;<span class="ident" id="6824726">err</span>&nbsp;<span class="op" id="6824730">==</span>&nbsp;<span class="ident" id="6824733">nil</span>&nbsp;<span class="op" id="6824737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824741">t</span><span class="op" id="6824742">.</span><span class="ident" id="6824743">Fatalf</span><span class="op" id="6824749">(</span><span class="string" id="6824750">&#34;Line&nbsp;3:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6824770">,</span>&nbsp;<span class="ident" id="6824772">code</span><span class="op" id="6824776">,</span>&nbsp;<span class="ident" id="6824778">msg</span><span class="op" id="6824781">,</span>&nbsp;<span class="ident" id="6824783">err</span><span class="op" id="6824786">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6824789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6824792">if</span>&nbsp;<span class="ident" id="6824795">e</span><span class="op" id="6824796">,</span>&nbsp;<span class="ident" id="6824798">ok</span>&nbsp;<span class="op" id="6824801">:=</span>&nbsp;<span class="ident" id="6824804">err</span><span class="op" id="6824807">.</span><span class="op" id="6824808">(</span><span class="op" id="6824809">*</span><span class="ident" id="6824810">Error</span><span class="op" id="6824815">)</span><span class="op" id="6824816">;</span>&nbsp;<span class="op" id="6824818">!</span><span class="ident" id="6824819">ok</span>&nbsp;<span class="op" id="6824822">||</span>&nbsp;<span class="ident" id="6824825">e</span><span class="op" id="6824826">.</span><span class="ident" id="6824827">Code</span>&nbsp;<span class="op" id="6824832">!=</span>&nbsp;<span class="ident" id="6824835">code</span>&nbsp;<span class="op" id="6824840">||</span>&nbsp;<span class="ident" id="6824843">e</span><span class="op" id="6824844">.</span><span class="ident" id="6824845">Msg</span>&nbsp;<span class="op" id="6824849">!=</span>&nbsp;<span class="ident" id="6824852">msg</span>&nbsp;<span class="op" id="6824856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824860">t</span><span class="op" id="6824861">.</span><span class="ident" id="6824862">Fatalf</span><span class="op" id="6824868">(</span><span class="string" id="6824869">&#34;Line&nbsp;3:&nbsp;wrong&nbsp;error&nbsp;%v\n&#34;</span><span class="op" id="6824895">,</span>&nbsp;<span class="ident" id="6824897">err</span><span class="op" id="6824900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6824903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824906">code</span><span class="op" id="6824910">,</span>&nbsp;<span class="ident" id="6824912">msg</span><span class="op" id="6824915">,</span>&nbsp;<span class="ident" id="6824917">err</span>&nbsp;<span class="op" id="6824921">=</span>&nbsp;<span class="ident" id="6824923">r</span><span class="op" id="6824924">.</span><span class="ident" id="6824925">ReadCodeLine</span><span class="op" id="6824937">(</span><span class="num" id="6824938">1</span><span class="op" id="6824939">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6824942">if</span>&nbsp;<span class="ident" id="6824945">code</span>&nbsp;<span class="op" id="6824950">!=</span>&nbsp;<span class="num" id="6824953">0</span>&nbsp;<span class="op" id="6824955">||</span>&nbsp;<span class="ident" id="6824958">msg</span>&nbsp;<span class="op" id="6824962">!=</span>&nbsp;<span class="string" id="6824965">&#34;&#34;</span>&nbsp;<span class="op" id="6824968">||</span>&nbsp;<span class="ident" id="6824971">err</span>&nbsp;<span class="op" id="6824975">!=</span>&nbsp;<span class="ident" id="6824978">io</span><span class="op" id="6824980">.</span><span class="ident" id="6824981">EOF</span>&nbsp;<span class="op" id="6824985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824989">t</span><span class="op" id="6824990">.</span><span class="ident" id="6824991">Fatalf</span><span class="op" id="6824997">(</span><span class="string" id="6824998">&#34;EOF:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6825015">,</span>&nbsp;<span class="ident" id="6825017">code</span><span class="op" id="6825021">,</span>&nbsp;<span class="ident" id="6825023">msg</span><span class="op" id="6825026">,</span>&nbsp;<span class="ident" id="6825028">err</span><span class="op" id="6825031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6825034">}</span><br>
<span class="lineno"></span><span class="op" id="6825036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6825039">func</span>&nbsp;<span class="ident" id="6825044">TestReadDotLines</span><span class="op" id="6825060">(</span><span class="ident" id="6825061">t</span>&nbsp;<span class="op" id="6825063">*</span><span class="ident" id="6825064">testing</span><span class="op" id="6825071">.</span><span class="ident" id="6825072">T</span><span class="op" id="6825073">)</span>&nbsp;<span class="op" id="6825075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825078">r</span>&nbsp;<span class="op" id="6825080">:=</span>&nbsp;<span class="ident" id="6825083">reader</span><span class="op" id="6825089">(</span><span class="string" id="6825090">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanother\n&#34;</span><span class="op" id="6825153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825156">s</span><span class="op" id="6825157">,</span>&nbsp;<span class="ident" id="6825159">err</span>&nbsp;<span class="op" id="6825163">:=</span>&nbsp;<span class="ident" id="6825166">r</span><span class="op" id="6825167">.</span><span class="ident" id="6825168">ReadDotLines</span><span class="op" id="6825180">(</span><span class="op" id="6825181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825184">want</span>&nbsp;<span class="op" id="6825189">:=</span>&nbsp;<span class="op" id="6825192">[</span><span class="op" id="6825193">]</span><span class="builtintype" id="6825194">string</span><span class="op" id="6825200">{</span><span class="string" id="6825201">&#34;dotlines&#34;</span><span class="op" id="6825211">,</span>&nbsp;<span class="string" id="6825213">&#34;foo&#34;</span><span class="op" id="6825218">,</span>&nbsp;<span class="string" id="6825220">&#34;.bar&#34;</span><span class="op" id="6825226">,</span>&nbsp;<span class="string" id="6825228">&#34;..baz&#34;</span><span class="op" id="6825235">,</span>&nbsp;<span class="string" id="6825237">&#34;quux&#34;</span><span class="op" id="6825243">,</span>&nbsp;<span class="string" id="6825245">&#34;&#34;</span><span class="op" id="6825247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6825250">if</span>&nbsp;<span class="op" id="6825253">!</span><span class="ident" id="6825254">reflect</span><span class="op" id="6825261">.</span><span class="ident" id="6825262">DeepEqual</span><span class="op" id="6825271">(</span><span class="ident" id="6825272">s</span><span class="op" id="6825273">,</span>&nbsp;<span class="ident" id="6825275">want</span><span class="op" id="6825279">)</span>&nbsp;<span class="op" id="6825281">||</span>&nbsp;<span class="ident" id="6825284">err</span>&nbsp;<span class="op" id="6825288">!=</span>&nbsp;<span class="ident" id="6825291">nil</span>&nbsp;<span class="op" id="6825295">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825299">t</span><span class="op" id="6825300">.</span><span class="ident" id="6825301">Fatalf</span><span class="op" id="6825307">(</span><span class="string" id="6825308">&#34;ReadDotLines:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="6825330">,</span>&nbsp;<span class="ident" id="6825332">s</span><span class="op" id="6825333">,</span>&nbsp;<span class="ident" id="6825335">err</span><span class="op" id="6825338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6825341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825345">s</span><span class="op" id="6825346">,</span>&nbsp;<span class="ident" id="6825348">err</span>&nbsp;<span class="op" id="6825352">=</span>&nbsp;<span class="ident" id="6825354">r</span><span class="op" id="6825355">.</span><span class="ident" id="6825356">ReadDotLines</span><span class="op" id="6825368">(</span><span class="op" id="6825369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825372">want</span>&nbsp;<span class="op" id="6825377">=</span>&nbsp;<span class="op" id="6825379">[</span><span class="op" id="6825380">]</span><span class="builtintype" id="6825381">string</span><span class="op" id="6825387">{</span><span class="string" id="6825388">&#34;another&#34;</span><span class="op" id="6825397">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6825400">if</span>&nbsp;<span class="op" id="6825403">!</span><span class="ident" id="6825404">reflect</span><span class="op" id="6825411">.</span><span class="ident" id="6825412">DeepEqual</span><span class="op" id="6825421">(</span><span class="ident" id="6825422">s</span><span class="op" id="6825423">,</span>&nbsp;<span class="ident" id="6825425">want</span><span class="op" id="6825429">)</span>&nbsp;<span class="op" id="6825431">||</span>&nbsp;<span class="ident" id="6825434">err</span>&nbsp;<span class="op" id="6825438">!=</span>&nbsp;<span class="ident" id="6825441">io</span><span class="op" id="6825443">.</span><span class="ident" id="6825444">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6825461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825465">t</span><span class="op" id="6825466">.</span><span class="ident" id="6825467">Fatalf</span><span class="op" id="6825473">(</span><span class="string" id="6825474">&#34;ReadDotLines2:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="6825497">,</span>&nbsp;<span class="ident" id="6825499">s</span><span class="op" id="6825500">,</span>&nbsp;<span class="ident" id="6825502">err</span><span class="op" id="6825505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6825508">}</span><br>
<span class="lineno"></span><span class="op" id="6825510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="6825513">func</span>&nbsp;<span class="ident" id="6825518">TestReadDotBytes</span><span class="op" id="6825534">(</span><span class="ident" id="6825535">t</span>&nbsp;<span class="op" id="6825537">*</span><span class="ident" id="6825538">testing</span><span class="op" id="6825545">.</span><span class="ident" id="6825546">T</span><span class="op" id="6825547">)</span>&nbsp;<span class="op" id="6825549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825552">r</span>&nbsp;<span class="op" id="6825554">:=</span>&nbsp;<span class="ident" id="6825557">reader</span><span class="op" id="6825563">(</span><span class="string" id="6825564">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanot.her\r\n&#34;</span><span class="op" id="6825630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825633">b</span><span class="op" id="6825634">,</span>&nbsp;<span class="ident" id="6825636">err</span>&nbsp;<span class="op" id="6825640">:=</span>&nbsp;<span class="ident" id="6825643">r</span><span class="op" id="6825644">.</span><span class="ident" id="6825645">ReadDotBytes</span><span class="op" id="6825657">(</span><span class="op" id="6825658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825661">want</span>&nbsp;<span class="op" id="6825666">:=</span>&nbsp;<span class="op" id="6825669">[</span><span class="op" id="6825670">]</span><span class="builtintype" id="6825671">byte</span><span class="op" id="6825675">(</span><span class="string" id="6825676">&#34;dotlines\nfoo\n.bar\n..baz\nquux\n\n&#34;</span><span class="op" id="6825714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6825717">if</span>&nbsp;<span class="op" id="6825720">!</span><span class="ident" id="6825721">reflect</span><span class="op" id="6825728">.</span><span class="ident" id="6825729">DeepEqual</span><span class="op" id="6825738">(</span><span class="ident" id="6825739">b</span><span class="op" id="6825740">,</span>&nbsp;<span class="ident" id="6825742">want</span><span class="op" id="6825746">)</span>&nbsp;<span class="op" id="6825748">||</span>&nbsp;<span class="ident" id="6825751">err</span>&nbsp;<span class="op" id="6825755">!=</span>&nbsp;<span class="ident" id="6825758">nil</span>&nbsp;<span class="op" id="6825762">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825766">t</span><span class="op" id="6825767">.</span><span class="ident" id="6825768">Fatalf</span><span class="op" id="6825774">(</span><span class="string" id="6825775">&#34;ReadDotBytes:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="6825797">,</span>&nbsp;<span class="ident" id="6825799">b</span><span class="op" id="6825800">,</span>&nbsp;<span class="ident" id="6825802">err</span><span class="op" id="6825805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6825808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825812">b</span><span class="op" id="6825813">,</span>&nbsp;<span class="ident" id="6825815">err</span>&nbsp;<span class="op" id="6825819">=</span>&nbsp;<span class="ident" id="6825821">r</span><span class="op" id="6825822">.</span><span class="ident" id="6825823">ReadDotBytes</span><span class="op" id="6825835">(</span><span class="op" id="6825836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825839">want</span>&nbsp;<span class="op" id="6825844">=</span>&nbsp;<span class="op" id="6825846">[</span><span class="op" id="6825847">]</span><span class="builtintype" id="6825848">byte</span><span class="op" id="6825852">(</span><span class="string" id="6825853">&#34;anot.her\n&#34;</span><span class="op" id="6825865">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6825868">if</span>&nbsp;<span class="op" id="6825871">!</span><span class="ident" id="6825872">reflect</span><span class="op" id="6825879">.</span><span class="ident" id="6825880">DeepEqual</span><span class="op" id="6825889">(</span><span class="ident" id="6825890">b</span><span class="op" id="6825891">,</span>&nbsp;<span class="ident" id="6825893">want</span><span class="op" id="6825897">)</span>&nbsp;<span class="op" id="6825899">||</span>&nbsp;<span class="ident" id="6825902">err</span>&nbsp;<span class="op" id="6825906">!=</span>&nbsp;<span class="ident" id="6825909">io</span><span class="op" id="6825911">.</span><span class="ident" id="6825912">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6825929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825933">t</span><span class="op" id="6825934">.</span><span class="ident" id="6825935">Fatalf</span><span class="op" id="6825941">(</span><span class="string" id="6825942">&#34;ReadDotBytes2:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="6825965">,</span>&nbsp;<span class="ident" id="6825967">b</span><span class="op" id="6825968">,</span>&nbsp;<span class="ident" id="6825970">err</span><span class="op" id="6825973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6825976">}</span><br>
<span class="lineno"></span><span class="op" id="6825978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="6825981">func</span>&nbsp;<span class="ident" id="6825986">TestReadMIMEHeader</span><span class="op" id="6826004">(</span><span class="ident" id="6826005">t</span>&nbsp;<span class="op" id="6826007">*</span><span class="ident" id="6826008">testing</span><span class="op" id="6826015">.</span><span class="ident" id="6826016">T</span><span class="op" id="6826017">)</span>&nbsp;<span class="op" id="6826019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826022">r</span>&nbsp;<span class="op" id="6826024">:=</span>&nbsp;<span class="ident" id="6826027">reader</span><span class="op" id="6826033">(</span><span class="string" id="6826034">&#34;my-key:&nbsp;Value&nbsp;1&nbsp;&nbsp;\r\nLong-key:&nbsp;Even&nbsp;\n&nbsp;Longer&nbsp;Value\r\nmy-Key:&nbsp;Value&nbsp;2\r\n\n&#34;</span><span class="op" id="6826112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826115">m</span><span class="op" id="6826116">,</span>&nbsp;<span class="ident" id="6826118">err</span>&nbsp;<span class="op" id="6826122">:=</span>&nbsp;<span class="ident" id="6826125">r</span><span class="op" id="6826126">.</span><span class="ident" id="6826127">ReadMIMEHeader</span><span class="op" id="6826141">(</span><span class="op" id="6826142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826145">want</span>&nbsp;<span class="op" id="6826150">:=</span>&nbsp;<span class="ident" id="6826153">MIMEHeader</span><span class="op" id="6826163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6826167">&#34;My-Key&#34;</span><span class="op" id="6826175">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6826179">{</span><span class="string" id="6826180">&#34;Value&nbsp;1&#34;</span><span class="op" id="6826189">,</span>&nbsp;<span class="string" id="6826191">&#34;Value&nbsp;2&#34;</span><span class="op" id="6826200">}</span><span class="op" id="6826201">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6826205">&#34;Long-Key&#34;</span><span class="op" id="6826215">:</span>&nbsp;<span class="op" id="6826217">{</span><span class="string" id="6826218">&#34;Even&nbsp;Longer&nbsp;Value&#34;</span><span class="op" id="6826237">}</span><span class="op" id="6826238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6826241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6826244">if</span>&nbsp;<span class="op" id="6826247">!</span><span class="ident" id="6826248">reflect</span><span class="op" id="6826255">.</span><span class="ident" id="6826256">DeepEqual</span><span class="op" id="6826265">(</span><span class="ident" id="6826266">m</span><span class="op" id="6826267">,</span>&nbsp;<span class="ident" id="6826269">want</span><span class="op" id="6826273">)</span>&nbsp;<span class="op" id="6826275">||</span>&nbsp;<span class="ident" id="6826278">err</span>&nbsp;<span class="op" id="6826282">!=</span>&nbsp;<span class="ident" id="6826285">nil</span>&nbsp;<span class="op" id="6826289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826293">t</span><span class="op" id="6826294">.</span><span class="ident" id="6826295">Fatalf</span><span class="op" id="6826301">(</span><span class="string" id="6826302">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6826335">,</span>&nbsp;<span class="ident" id="6826337">m</span><span class="op" id="6826338">,</span>&nbsp;<span class="ident" id="6826340">err</span><span class="op" id="6826343">,</span>&nbsp;<span class="ident" id="6826345">want</span><span class="op" id="6826349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6826352">}</span><br>
<span class="lineno">145</span><span class="op" id="6826354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6826357">func</span>&nbsp;<span class="ident" id="6826362">TestReadMIMEHeaderSingle</span><span class="op" id="6826386">(</span><span class="ident" id="6826387">t</span>&nbsp;<span class="op" id="6826389">*</span><span class="ident" id="6826390">testing</span><span class="op" id="6826397">.</span><span class="ident" id="6826398">T</span><span class="op" id="6826399">)</span>&nbsp;<span class="op" id="6826401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826404">r</span>&nbsp;<span class="op" id="6826406">:=</span>&nbsp;<span class="ident" id="6826409">reader</span><span class="op" id="6826415">(</span><span class="string" id="6826416">&#34;Foo:&nbsp;bar\n\n&#34;</span><span class="op" id="6826430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826433">m</span><span class="op" id="6826434">,</span>&nbsp;<span class="ident" id="6826436">err</span>&nbsp;<span class="op" id="6826440">:=</span>&nbsp;<span class="ident" id="6826443">r</span><span class="op" id="6826444">.</span><span class="ident" id="6826445">ReadMIMEHeader</span><span class="op" id="6826459">(</span><span class="op" id="6826460">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826463">want</span>&nbsp;<span class="op" id="6826468">:=</span>&nbsp;<span class="ident" id="6826471">MIMEHeader</span><span class="op" id="6826481">{</span><span class="string" id="6826482">&#34;Foo&#34;</span><span class="op" id="6826487">:</span>&nbsp;<span class="op" id="6826489">{</span><span class="string" id="6826490">&#34;bar&#34;</span><span class="op" id="6826495">}</span><span class="op" id="6826496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6826499">if</span>&nbsp;<span class="op" id="6826502">!</span><span class="ident" id="6826503">reflect</span><span class="op" id="6826510">.</span><span class="ident" id="6826511">DeepEqual</span><span class="op" id="6826520">(</span><span class="ident" id="6826521">m</span><span class="op" id="6826522">,</span>&nbsp;<span class="ident" id="6826524">want</span><span class="op" id="6826528">)</span>&nbsp;<span class="op" id="6826530">||</span>&nbsp;<span class="ident" id="6826533">err</span>&nbsp;<span class="op" id="6826537">!=</span>&nbsp;<span class="ident" id="6826540">nil</span>&nbsp;<span class="op" id="6826544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826548">t</span><span class="op" id="6826549">.</span><span class="ident" id="6826550">Fatalf</span><span class="op" id="6826556">(</span><span class="string" id="6826557">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6826590">,</span>&nbsp;<span class="ident" id="6826592">m</span><span class="op" id="6826593">,</span>&nbsp;<span class="ident" id="6826595">err</span><span class="op" id="6826598">,</span>&nbsp;<span class="ident" id="6826600">want</span><span class="op" id="6826604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6826607">}</span><br>
<span class="lineno"></span><span class="op" id="6826609">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="6826612">func</span>&nbsp;<span class="ident" id="6826617">TestLargeReadMIMEHeader</span><span class="op" id="6826640">(</span><span class="ident" id="6826641">t</span>&nbsp;<span class="op" id="6826643">*</span><span class="ident" id="6826644">testing</span><span class="op" id="6826651">.</span><span class="ident" id="6826652">T</span><span class="op" id="6826653">)</span>&nbsp;<span class="op" id="6826655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826658">data</span>&nbsp;<span class="op" id="6826663">:=</span>&nbsp;<span class="builtinfunc" id="6826666">make</span><span class="op" id="6826670">(</span><span class="op" id="6826671">[</span><span class="op" id="6826672">]</span><span class="builtintype" id="6826673">byte</span><span class="op" id="6826677">,</span>&nbsp;<span class="num" id="6826679">16</span><span class="op" id="6826681">*</span><span class="num" id="6826682">1024</span><span class="op" id="6826686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6826689">for</span>&nbsp;<span class="ident" id="6826693">i</span>&nbsp;<span class="op" id="6826695">:=</span>&nbsp;<span class="num" id="6826698">0</span><span class="op" id="6826699">;</span>&nbsp;<span class="ident" id="6826701">i</span>&nbsp;<span class="op" id="6826703">&lt;</span>&nbsp;<span class="builtinfunc" id="6826705">len</span><span class="op" id="6826708">(</span><span class="ident" id="6826709">data</span><span class="op" id="6826713">)</span><span class="op" id="6826714">;</span>&nbsp;<span class="ident" id="6826716">i</span><span class="op" id="6826717">++</span>&nbsp;<span class="op" id="6826720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826724">data</span><span class="op" id="6826728">[</span><span class="ident" id="6826729">i</span><span class="op" id="6826730">]</span>&nbsp;<span class="op" id="6826732">=</span>&nbsp;<span class="string" id="6826734">&#39;x&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6826739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826742">sdata</span>&nbsp;<span class="op" id="6826748">:=</span>&nbsp;<span class="builtintype" id="6826751">string</span><span class="op" id="6826757">(</span><span class="ident" id="6826758">data</span><span class="op" id="6826762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826765">r</span>&nbsp;<span class="op" id="6826767">:=</span>&nbsp;<span class="ident" id="6826770">reader</span><span class="op" id="6826776">(</span><span class="string" id="6826777">&#34;Cookie:&nbsp;&#34;</span>&nbsp;<span class="op" id="6826788">+</span>&nbsp;<span class="ident" id="6826790">sdata</span>&nbsp;<span class="op" id="6826796">+</span>&nbsp;<span class="string" id="6826798">&#34;\r\n\n&#34;</span><span class="op" id="6826806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826809">m</span><span class="op" id="6826810">,</span>&nbsp;<span class="ident" id="6826812">err</span>&nbsp;<span class="op" id="6826816">:=</span>&nbsp;<span class="ident" id="6826819">r</span><span class="op" id="6826820">.</span><span class="ident" id="6826821">ReadMIMEHeader</span><span class="op" id="6826835">(</span><span class="op" id="6826836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6826839">if</span>&nbsp;<span class="ident" id="6826842">err</span>&nbsp;<span class="op" id="6826846">!=</span>&nbsp;<span class="ident" id="6826849">nil</span>&nbsp;<span class="op" id="6826853">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826857">t</span><span class="op" id="6826858">.</span><span class="ident" id="6826859">Fatalf</span><span class="op" id="6826865">(</span><span class="string" id="6826866">&#34;ReadMIMEHeader:&nbsp;%v&#34;</span><span class="op" id="6826886">,</span>&nbsp;<span class="ident" id="6826888">err</span><span class="op" id="6826891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6826894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826897">cookie</span>&nbsp;<span class="op" id="6826904">:=</span>&nbsp;<span class="ident" id="6826907">m</span><span class="op" id="6826908">.</span><span class="ident" id="6826909">Get</span><span class="op" id="6826912">(</span><span class="string" id="6826913">&#34;Cookie&#34;</span><span class="op" id="6826921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6826924">if</span>&nbsp;<span class="ident" id="6826927">cookie</span>&nbsp;<span class="op" id="6826934">!=</span>&nbsp;<span class="ident" id="6826937">sdata</span>&nbsp;<span class="op" id="6826943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6826947">t</span><span class="op" id="6826948">.</span><span class="ident" id="6826949">Fatalf</span><span class="op" id="6826955">(</span><span class="string" id="6826956">&#34;ReadMIMEHeader:&nbsp;%v&nbsp;bytes,&nbsp;want&nbsp;%v&nbsp;bytes&#34;</span><span class="op" id="6826997">,</span>&nbsp;<span class="builtinfunc" id="6826999">len</span><span class="op" id="6827002">(</span><span class="ident" id="6827003">cookie</span><span class="op" id="6827009">)</span><span class="op" id="6827010">,</span>&nbsp;<span class="builtinfunc" id="6827012">len</span><span class="op" id="6827015">(</span><span class="ident" id="6827016">sdata</span><span class="op" id="6827021">)</span><span class="op" id="6827022">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6827025">}</span><br>
<span class="lineno"></span><span class="op" id="6827027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6827030">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;read&nbsp;slightly-bogus&nbsp;MIME&nbsp;headers&nbsp;seen&nbsp;in&nbsp;the&nbsp;wild,</span><br>
<span class="lineno"></span><span class="comment" id="6827097">//&nbsp;with&nbsp;spaces&nbsp;before&nbsp;colons,&nbsp;and&nbsp;spaces&nbsp;in&nbsp;keys.</span><br>
<span class="lineno">175</span><span class="keyword" id="6827147">func</span>&nbsp;<span class="ident" id="6827152">TestReadMIMEHeaderNonCompliant</span><span class="op" id="6827182">(</span><span class="ident" id="6827183">t</span>&nbsp;<span class="op" id="6827185">*</span><span class="ident" id="6827186">testing</span><span class="op" id="6827193">.</span><span class="ident" id="6827194">T</span><span class="op" id="6827195">)</span>&nbsp;<span class="op" id="6827197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6827200">//&nbsp;Invalid&nbsp;HTTP&nbsp;response&nbsp;header&nbsp;as&nbsp;sent&nbsp;by&nbsp;an&nbsp;Axis&nbsp;security</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6827261">//&nbsp;camera:&nbsp;(this&nbsp;is&nbsp;handled&nbsp;by&nbsp;IE,&nbsp;Firefox,&nbsp;Chrome,&nbsp;curl,&nbsp;etc.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827326">r</span>&nbsp;<span class="op" id="6827328">:=</span>&nbsp;<span class="ident" id="6827331">reader</span><span class="op" id="6827337">(</span><span class="string" id="6827338">&#34;Foo:&nbsp;bar\r\n&#34;</span>&nbsp;<span class="op" id="6827353">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827357">&#34;Content-Language:&nbsp;en\r\n&#34;</span>&nbsp;<span class="op" id="6827384">+</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827388">&#34;SID&nbsp;:&nbsp;0\r\n&#34;</span>&nbsp;<span class="op" id="6827402">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827406">&#34;Audio&nbsp;Mode&nbsp;:&nbsp;None\r\n&#34;</span>&nbsp;<span class="op" id="6827430">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827434">&#34;Privilege&nbsp;:&nbsp;127\r\n\r\n&#34;</span><span class="op" id="6827459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827462">m</span><span class="op" id="6827463">,</span>&nbsp;<span class="ident" id="6827465">err</span>&nbsp;<span class="op" id="6827469">:=</span>&nbsp;<span class="ident" id="6827472">r</span><span class="op" id="6827473">.</span><span class="ident" id="6827474">ReadMIMEHeader</span><span class="op" id="6827488">(</span><span class="op" id="6827489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827492">want</span>&nbsp;<span class="op" id="6827497">:=</span>&nbsp;<span class="ident" id="6827500">MIMEHeader</span><span class="op" id="6827510">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827514">&#34;Foo&#34;</span><span class="op" id="6827519">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6827534">{</span><span class="string" id="6827535">&#34;bar&#34;</span><span class="op" id="6827540">}</span><span class="op" id="6827541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827545">&#34;Content-Language&#34;</span><span class="op" id="6827563">:</span>&nbsp;<span class="op" id="6827565">{</span><span class="string" id="6827566">&#34;en&#34;</span><span class="op" id="6827570">}</span><span class="op" id="6827571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827575">&#34;Sid&#34;</span><span class="op" id="6827580">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6827595">{</span><span class="string" id="6827596">&#34;0&#34;</span><span class="op" id="6827599">}</span><span class="op" id="6827600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827604">&#34;Audio-Mode&#34;</span><span class="op" id="6827616">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6827624">{</span><span class="string" id="6827625">&#34;None&#34;</span><span class="op" id="6827631">}</span><span class="op" id="6827632">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827636">&#34;Privilege&#34;</span><span class="op" id="6827647">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6827656">{</span><span class="string" id="6827657">&#34;127&#34;</span><span class="op" id="6827662">}</span><span class="op" id="6827663">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6827666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6827669">if</span>&nbsp;<span class="op" id="6827672">!</span><span class="ident" id="6827673">reflect</span><span class="op" id="6827680">.</span><span class="ident" id="6827681">DeepEqual</span><span class="op" id="6827690">(</span><span class="ident" id="6827691">m</span><span class="op" id="6827692">,</span>&nbsp;<span class="ident" id="6827694">want</span><span class="op" id="6827698">)</span>&nbsp;<span class="op" id="6827700">||</span>&nbsp;<span class="ident" id="6827703">err</span>&nbsp;<span class="op" id="6827707">!=</span>&nbsp;<span class="ident" id="6827710">nil</span>&nbsp;<span class="op" id="6827714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827718">t</span><span class="op" id="6827719">.</span><span class="ident" id="6827720">Fatalf</span><span class="op" id="6827726">(</span><span class="string" id="6827727">&#34;ReadMIMEHeader&nbsp;=\n%v,&nbsp;%v;&nbsp;want:\n%v&#34;</span><span class="op" id="6827764">,</span>&nbsp;<span class="ident" id="6827766">m</span><span class="op" id="6827767">,</span>&nbsp;<span class="ident" id="6827769">err</span><span class="op" id="6827772">,</span>&nbsp;<span class="ident" id="6827774">want</span><span class="op" id="6827778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6827781">}</span><br>
<span class="lineno"></span><span class="op" id="6827783">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="6827786">type</span>&nbsp;<span class="ident" id="6827791">readResponseTest</span>&nbsp;<span class="keyword" id="6827808">struct</span>&nbsp;<span class="op" id="6827815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827818">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6827827">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827835">inCode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6827844">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827849">wantCode</span>&nbsp;<span class="builtintype" id="6827858">int</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827863">wantMsg</span>&nbsp;&nbsp;<span class="builtintype" id="6827872">string</span><br>
<span class="lineno"></span><span class="op" id="6827879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6827882">var</span>&nbsp;<span class="ident" id="6827886">readResponseTests</span>&nbsp;<span class="op" id="6827904">=</span>&nbsp;<span class="op" id="6827906">[</span><span class="op" id="6827907">]</span><span class="ident" id="6827908">readResponseTest</span><span class="op" id="6827924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6827927">{</span><span class="string" id="6827928">&#34;230-Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span>&nbsp;<span class="op" id="6827981">+</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827985">&#34;Read&nbsp;the&nbsp;file&nbsp;README.txt,\n&#34;</span>&nbsp;<span class="op" id="6828015">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6828019">&#34;230&nbsp;&nbsp;please&#34;</span><span class="op" id="6828032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6828036">23</span><span class="op" id="6828038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6828042">230</span><span class="op" id="6828045">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6828049">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\nRead&nbsp;the&nbsp;file&nbsp;README.txt,\n&nbsp;please&#34;</span><span class="op" id="6828131">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828134">}</span><span class="op" id="6828135">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828139">{</span><span class="string" id="6828140">&#34;230&nbsp;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span><span class="op" id="6828192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6828196">23</span><span class="op" id="6828198">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6828202">230</span><span class="op" id="6828205">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6828209">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply&#34;</span><span class="op" id="6828255">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828258">}</span><span class="op" id="6828259">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828263">{</span><span class="string" id="6828264">&#34;400-A\n400-B\n400&nbsp;C&#34;</span><span class="op" id="6828285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6828289">4</span><span class="op" id="6828290">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6828294">400</span><span class="op" id="6828297">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6828301">&#34;A\nB\nC&#34;</span><span class="op" id="6828310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828313">}</span><span class="op" id="6828314">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828318">{</span><span class="string" id="6828319">&#34;400-A\r\n400-B\r\n400&nbsp;C\r\n&#34;</span><span class="op" id="6828348">,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6828352">4</span><span class="op" id="6828353">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6828357">400</span><span class="op" id="6828360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6828364">&#34;A\nB\nC&#34;</span><span class="op" id="6828373">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828376">}</span><span class="op" id="6828377">,</span><br>
<span class="lineno"></span><span class="op" id="6828379">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="6828382">//&nbsp;See&nbsp;http://www.ietf.org/rfc/rfc959.txt&nbsp;page&nbsp;36.</span><br>
<span class="lineno"></span><span class="keyword" id="6828433">func</span>&nbsp;<span class="ident" id="6828438">TestRFC959Lines</span><span class="op" id="6828453">(</span><span class="ident" id="6828454">t</span>&nbsp;<span class="op" id="6828456">*</span><span class="ident" id="6828457">testing</span><span class="op" id="6828464">.</span><span class="ident" id="6828465">T</span><span class="op" id="6828466">)</span>&nbsp;<span class="op" id="6828468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828471">for</span>&nbsp;<span class="ident" id="6828475">i</span><span class="op" id="6828476">,</span>&nbsp;<span class="ident" id="6828478">tt</span>&nbsp;<span class="op" id="6828481">:=</span>&nbsp;<span class="keyword" id="6828484">range</span>&nbsp;<span class="ident" id="6828490">readResponseTests</span>&nbsp;<span class="op" id="6828508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828512">r</span>&nbsp;<span class="op" id="6828514">:=</span>&nbsp;<span class="ident" id="6828517">reader</span><span class="op" id="6828523">(</span><span class="ident" id="6828524">tt</span><span class="op" id="6828526">.</span><span class="ident" id="6828527">in</span>&nbsp;<span class="op" id="6828530">+</span>&nbsp;<span class="string" id="6828532">&#34;\nFOLLOWING&nbsp;DATA&#34;</span><span class="op" id="6828550">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828554">code</span><span class="op" id="6828558">,</span>&nbsp;<span class="ident" id="6828560">msg</span><span class="op" id="6828563">,</span>&nbsp;<span class="ident" id="6828565">err</span>&nbsp;<span class="op" id="6828569">:=</span>&nbsp;<span class="ident" id="6828572">r</span><span class="op" id="6828573">.</span><span class="ident" id="6828574">ReadResponse</span><span class="op" id="6828586">(</span><span class="ident" id="6828587">tt</span><span class="op" id="6828589">.</span><span class="ident" id="6828590">inCode</span><span class="op" id="6828596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828600">if</span>&nbsp;<span class="ident" id="6828603">err</span>&nbsp;<span class="op" id="6828607">!=</span>&nbsp;<span class="ident" id="6828610">nil</span>&nbsp;<span class="op" id="6828614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828619">t</span><span class="op" id="6828620">.</span><span class="ident" id="6828621">Errorf</span><span class="op" id="6828627">(</span><span class="string" id="6828628">&#34;#%d:&nbsp;ReadResponse:&nbsp;%v&#34;</span><span class="op" id="6828651">,</span>&nbsp;<span class="ident" id="6828653">i</span><span class="op" id="6828654">,</span>&nbsp;<span class="ident" id="6828656">err</span><span class="op" id="6828659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828664">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828675">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828679">if</span>&nbsp;<span class="ident" id="6828682">code</span>&nbsp;<span class="op" id="6828687">!=</span>&nbsp;<span class="ident" id="6828690">tt</span><span class="op" id="6828692">.</span><span class="ident" id="6828693">wantCode</span>&nbsp;<span class="op" id="6828702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828707">t</span><span class="op" id="6828708">.</span><span class="ident" id="6828709">Errorf</span><span class="op" id="6828715">(</span><span class="string" id="6828716">&#34;#%d:&nbsp;code=%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6828739">,</span>&nbsp;<span class="ident" id="6828741">i</span><span class="op" id="6828742">,</span>&nbsp;<span class="ident" id="6828744">code</span><span class="op" id="6828748">,</span>&nbsp;<span class="ident" id="6828750">tt</span><span class="op" id="6828752">.</span><span class="ident" id="6828753">wantCode</span><span class="op" id="6828761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828769">if</span>&nbsp;<span class="ident" id="6828772">msg</span>&nbsp;<span class="op" id="6828776">!=</span>&nbsp;<span class="ident" id="6828779">tt</span><span class="op" id="6828781">.</span><span class="ident" id="6828782">wantMsg</span>&nbsp;<span class="op" id="6828790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828795">t</span><span class="op" id="6828796">.</span><span class="ident" id="6828797">Errorf</span><span class="op" id="6828803">(</span><span class="string" id="6828804">&#34;#%d:&nbsp;msg=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6828826">,</span>&nbsp;<span class="ident" id="6828828">i</span><span class="op" id="6828829">,</span>&nbsp;<span class="ident" id="6828831">msg</span><span class="op" id="6828834">,</span>&nbsp;<span class="ident" id="6828836">tt</span><span class="op" id="6828838">.</span><span class="ident" id="6828839">wantMsg</span><span class="op" id="6828846">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828853">}</span><br>
<span class="lineno"></span><span class="op" id="6828855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6828858">func</span>&nbsp;<span class="ident" id="6828863">TestCommonHeaders</span><span class="op" id="6828880">(</span><span class="ident" id="6828881">t</span>&nbsp;<span class="op" id="6828883">*</span><span class="ident" id="6828884">testing</span><span class="op" id="6828891">.</span><span class="ident" id="6828892">T</span><span class="op" id="6828893">)</span>&nbsp;<span class="op" id="6828895">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828898">for</span>&nbsp;<span class="ident" id="6828902">h</span>&nbsp;<span class="op" id="6828904">:=</span>&nbsp;<span class="keyword" id="6828907">range</span>&nbsp;<span class="ident" id="6828913">commonHeader</span>&nbsp;<span class="op" id="6828926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828930">if</span>&nbsp;<span class="ident" id="6828933">h</span>&nbsp;<span class="op" id="6828935">!=</span>&nbsp;<span class="ident" id="6828938">CanonicalMIMEHeaderKey</span><span class="op" id="6828960">(</span><span class="ident" id="6828961">h</span><span class="op" id="6828962">)</span>&nbsp;<span class="op" id="6828964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828969">t</span><span class="op" id="6828970">.</span><span class="ident" id="6828971">Errorf</span><span class="op" id="6828977">(</span><span class="string" id="6828978">&#34;Non-canonical&nbsp;header&nbsp;%q&nbsp;in&nbsp;commonHeader&#34;</span><span class="op" id="6829019">,</span>&nbsp;<span class="ident" id="6829021">h</span><span class="op" id="6829022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829029">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829032">b</span>&nbsp;<span class="op" id="6829034">:=</span>&nbsp;<span class="op" id="6829037">[</span><span class="op" id="6829038">]</span><span class="builtintype" id="6829039">byte</span><span class="op" id="6829043">(</span><span class="string" id="6829044">&#34;content-Length&#34;</span><span class="op" id="6829060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829063">want</span>&nbsp;<span class="op" id="6829068">:=</span>&nbsp;<span class="string" id="6829071">&#34;Content-Length&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829089">n</span>&nbsp;<span class="op" id="6829091">:=</span>&nbsp;<span class="ident" id="6829094">testing</span><span class="op" id="6829101">.</span><span class="ident" id="6829102">AllocsPerRun</span><span class="op" id="6829114">(</span><span class="num" id="6829115">200</span><span class="op" id="6829118">,</span>&nbsp;<span class="keyword" id="6829120">func</span><span class="op" id="6829124">(</span><span class="op" id="6829125">)</span>&nbsp;<span class="op" id="6829127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829131">if</span>&nbsp;<span class="ident" id="6829134">x</span>&nbsp;<span class="op" id="6829136">:=</span>&nbsp;<span class="ident" id="6829139">canonicalMIMEHeaderKey</span><span class="op" id="6829161">(</span><span class="ident" id="6829162">b</span><span class="op" id="6829163">)</span><span class="op" id="6829164">;</span>&nbsp;<span class="ident" id="6829166">x</span>&nbsp;<span class="op" id="6829168">!=</span>&nbsp;<span class="ident" id="6829171">want</span>&nbsp;<span class="op" id="6829176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829181">t</span><span class="op" id="6829182">.</span><span class="ident" id="6829183">Fatalf</span><span class="op" id="6829189">(</span><span class="string" id="6829190">&#34;canonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6829232">,</span>&nbsp;<span class="ident" id="6829234">b</span><span class="op" id="6829235">,</span>&nbsp;<span class="ident" id="6829237">x</span><span class="op" id="6829238">,</span>&nbsp;<span class="ident" id="6829240">want</span><span class="op" id="6829244">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829251">}</span><span class="op" id="6829252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829255">if</span>&nbsp;<span class="ident" id="6829258">n</span>&nbsp;<span class="op" id="6829260">&gt;</span>&nbsp;<span class="num" id="6829262">0</span>&nbsp;<span class="op" id="6829264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829268">t</span><span class="op" id="6829269">.</span><span class="ident" id="6829270">Errorf</span><span class="op" id="6829276">(</span><span class="string" id="6829277">&#34;canonicalMIMEHeaderKey&nbsp;allocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;0&#34;</span><span class="op" id="6829321">,</span>&nbsp;<span class="ident" id="6829323">n</span><span class="op" id="6829324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829327">}</span><br>
<span class="lineno">265</span><span class="op" id="6829329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6829332">var</span>&nbsp;<span class="ident" id="6829336">clientHeaders</span>&nbsp;<span class="op" id="6829350">=</span>&nbsp;<span class="ident" id="6829352">strings</span><span class="op" id="6829359">.</span><span class="ident" id="6829360">Replace</span><span class="op" id="6829367">(</span><span class="string" id="6829368">`Host:&nbsp;golang.org<br>
<span class="lineno"></span>Connection:&nbsp;keep-alive<br>
<span class="lineno"></span>Cache-Control:&nbsp;max-age=0<br>
<span class="lineno">270</span>Accept:&nbsp;application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5<br>
<span class="lineno"></span>User-Agent:&nbsp;Mozilla/5.0&nbsp;(X11;&nbsp;U;&nbsp;Linux&nbsp;x86_64;&nbsp;en-US)&nbsp;AppleWebKit/534.3&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/6.0.472.63&nbsp;Safari/534.3<br>
<span class="lineno"></span>Accept-Encoding:&nbsp;gzip,deflate,sdch<br>
<span class="lineno"></span>Accept-Language:&nbsp;en-US,en;q=0.8,fr-CH;q=0.6<br>
<span class="lineno"></span>Accept-Charset:&nbsp;ISO-8859-1,utf-8;q=0.7,*;q=0.3<br>
<span class="lineno">275</span>COOKIE:&nbsp;__utma=000000000.0000000000.0000000000.0000000000.0000000000.00;&nbsp;__utmb=000000000.0.00.0000000000;&nbsp;__utmc=000000000;&nbsp;__utmz=000000000.0000000000.00.0.utmcsr=code.google.com|utmccn=(referral)|utmcmd=referral|utmcct=/p/go/issues/detail<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno"></span>`</span><span class="op" id="6830045">,</span>&nbsp;<span class="string" id="6830047">&#34;\n&#34;</span><span class="op" id="6830051">,</span>&nbsp;<span class="string" id="6830053">&#34;\r\n&#34;</span><span class="op" id="6830059">,</span>&nbsp;<span class="op" id="6830061">-</span><span class="num" id="6830062">1</span><span class="op" id="6830063">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="6830066">var</span>&nbsp;<span class="ident" id="6830070">serverHeaders</span>&nbsp;<span class="op" id="6830084">=</span>&nbsp;<span class="ident" id="6830086">strings</span><span class="op" id="6830093">.</span><span class="ident" id="6830094">Replace</span><span class="op" id="6830101">(</span><span class="string" id="6830102">`Content-Type:&nbsp;text/html;&nbsp;charset=utf-8<br>
<span class="lineno"></span>Content-Encoding:&nbsp;gzip<br>
<span class="lineno"></span>Date:&nbsp;Thu,&nbsp;27&nbsp;Sep&nbsp;2012&nbsp;09:03:33&nbsp;GMT<br>
<span class="lineno"></span>Server:&nbsp;Google&nbsp;Frontend<br>
<span class="lineno"></span>Cache-Control:&nbsp;private<br>
<span class="lineno">285</span>Content-Length:&nbsp;2298<br>
<span class="lineno"></span>VIA:&nbsp;1.1&nbsp;proxy.example.com:80&nbsp;(XXX/n.n.n-nnn)<br>
<span class="lineno"></span>Connection:&nbsp;Close<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno">290</span>`</span><span class="op" id="6830354">,</span>&nbsp;<span class="string" id="6830356">&#34;\n&#34;</span><span class="op" id="6830360">,</span>&nbsp;<span class="string" id="6830362">&#34;\r\n&#34;</span><span class="op" id="6830368">,</span>&nbsp;<span class="op" id="6830370">-</span><span class="num" id="6830371">1</span><span class="op" id="6830372">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6830375">func</span>&nbsp;<span class="ident" id="6830380">BenchmarkReadMIMEHeader</span><span class="op" id="6830403">(</span><span class="ident" id="6830404">b</span>&nbsp;<span class="op" id="6830406">*</span><span class="ident" id="6830407">testing</span><span class="op" id="6830414">.</span><span class="ident" id="6830415">B</span><span class="op" id="6830416">)</span>&nbsp;<span class="op" id="6830418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830421">b</span><span class="op" id="6830422">.</span><span class="ident" id="6830423">ReportAllocs</span><span class="op" id="6830435">(</span><span class="op" id="6830436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830439">var</span>&nbsp;<span class="ident" id="6830443">buf</span>&nbsp;<span class="ident" id="6830447">bytes</span><span class="op" id="6830452">.</span><span class="ident" id="6830453">Buffer</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830461">br</span>&nbsp;<span class="op" id="6830464">:=</span>&nbsp;<span class="ident" id="6830467">bufio</span><span class="op" id="6830472">.</span><span class="ident" id="6830473">NewReader</span><span class="op" id="6830482">(</span><span class="op" id="6830483">&amp;</span><span class="ident" id="6830484">buf</span><span class="op" id="6830487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830490">r</span>&nbsp;<span class="op" id="6830492">:=</span>&nbsp;<span class="ident" id="6830495">NewReader</span><span class="op" id="6830504">(</span><span class="ident" id="6830505">br</span><span class="op" id="6830507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830510">for</span>&nbsp;<span class="ident" id="6830514">i</span>&nbsp;<span class="op" id="6830516">:=</span>&nbsp;<span class="num" id="6830519">0</span><span class="op" id="6830520">;</span>&nbsp;<span class="ident" id="6830522">i</span>&nbsp;<span class="op" id="6830524">&lt;</span>&nbsp;<span class="ident" id="6830526">b</span><span class="op" id="6830527">.</span><span class="ident" id="6830528">N</span><span class="op" id="6830529">;</span>&nbsp;<span class="ident" id="6830531">i</span><span class="op" id="6830532">++</span>&nbsp;<span class="op" id="6830535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830539">var</span>&nbsp;<span class="ident" id="6830543">want</span>&nbsp;<span class="builtintype" id="6830548">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830554">var</span>&nbsp;<span class="ident" id="6830558">find</span>&nbsp;<span class="builtintype" id="6830563">string</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830572">if</span>&nbsp;<span class="op" id="6830575">(</span><span class="ident" id="6830576">i</span>&nbsp;<span class="op" id="6830578">&amp;</span>&nbsp;<span class="num" id="6830580">1</span><span class="op" id="6830581">)</span>&nbsp;<span class="op" id="6830583">==</span>&nbsp;<span class="num" id="6830586">1</span>&nbsp;<span class="op" id="6830588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830593">buf</span><span class="op" id="6830596">.</span><span class="ident" id="6830597">WriteString</span><span class="op" id="6830608">(</span><span class="ident" id="6830609">clientHeaders</span><span class="op" id="6830622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830627">want</span>&nbsp;<span class="op" id="6830632">=</span>&nbsp;<span class="num" id="6830634">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830640">find</span>&nbsp;<span class="op" id="6830645">=</span>&nbsp;<span class="string" id="6830647">&#34;Cookie&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830658">}</span>&nbsp;<span class="keyword" id="6830660">else</span>&nbsp;<span class="op" id="6830665">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830670">buf</span><span class="op" id="6830673">.</span><span class="ident" id="6830674">WriteString</span><span class="op" id="6830685">(</span><span class="ident" id="6830686">serverHeaders</span><span class="op" id="6830699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830704">want</span>&nbsp;<span class="op" id="6830709">=</span>&nbsp;<span class="num" id="6830711">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830716">find</span>&nbsp;<span class="op" id="6830721">=</span>&nbsp;<span class="string" id="6830723">&#34;Via&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830735">h</span><span class="op" id="6830736">,</span>&nbsp;<span class="ident" id="6830738">err</span>&nbsp;<span class="op" id="6830742">:=</span>&nbsp;<span class="ident" id="6830745">r</span><span class="op" id="6830746">.</span><span class="ident" id="6830747">ReadMIMEHeader</span><span class="op" id="6830761">(</span><span class="op" id="6830762">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830766">if</span>&nbsp;<span class="ident" id="6830769">err</span>&nbsp;<span class="op" id="6830773">!=</span>&nbsp;<span class="ident" id="6830776">nil</span>&nbsp;<span class="op" id="6830780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830785">b</span><span class="op" id="6830786">.</span><span class="ident" id="6830787">Fatal</span><span class="op" id="6830792">(</span><span class="ident" id="6830793">err</span><span class="op" id="6830796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830804">if</span>&nbsp;<span class="builtinfunc" id="6830807">len</span><span class="op" id="6830810">(</span><span class="ident" id="6830811">h</span><span class="op" id="6830812">)</span>&nbsp;<span class="op" id="6830814">!=</span>&nbsp;<span class="ident" id="6830817">want</span>&nbsp;<span class="op" id="6830822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830827">b</span><span class="op" id="6830828">.</span><span class="ident" id="6830829">Fatalf</span><span class="op" id="6830835">(</span><span class="string" id="6830836">&#34;wrong&nbsp;number&nbsp;of&nbsp;headers:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6830878">,</span>&nbsp;<span class="builtinfunc" id="6830880">len</span><span class="op" id="6830883">(</span><span class="ident" id="6830884">h</span><span class="op" id="6830885">)</span><span class="op" id="6830886">,</span>&nbsp;<span class="ident" id="6830888">want</span><span class="op" id="6830892">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830900">if</span>&nbsp;<span class="ident" id="6830903">_</span><span class="op" id="6830904">,</span>&nbsp;<span class="ident" id="6830906">ok</span>&nbsp;<span class="op" id="6830909">:=</span>&nbsp;<span class="ident" id="6830912">h</span><span class="op" id="6830913">[</span><span class="ident" id="6830914">find</span><span class="op" id="6830918">]</span><span class="op" id="6830919">;</span>&nbsp;<span class="op" id="6830921">!</span><span class="ident" id="6830922">ok</span>&nbsp;<span class="op" id="6830925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830930">b</span><span class="op" id="6830931">.</span><span class="ident" id="6830932">Fatalf</span><span class="op" id="6830938">(</span><span class="string" id="6830939">&#34;did&nbsp;not&nbsp;find&nbsp;key&nbsp;%s&#34;</span><span class="op" id="6830960">,</span>&nbsp;<span class="ident" id="6830962">find</span><span class="op" id="6830966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830973">}</span><br>
<span class="lineno">320</span><span class="op" id="6830975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6830978">func</span>&nbsp;<span class="ident" id="6830983">BenchmarkUncommon</span><span class="op" id="6831000">(</span><span class="ident" id="6831001">b</span>&nbsp;<span class="op" id="6831003">*</span><span class="ident" id="6831004">testing</span><span class="op" id="6831011">.</span><span class="ident" id="6831012">B</span><span class="op" id="6831013">)</span>&nbsp;<span class="op" id="6831015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831018">b</span><span class="op" id="6831019">.</span><span class="ident" id="6831020">ReportAllocs</span><span class="op" id="6831032">(</span><span class="op" id="6831033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831036">var</span>&nbsp;<span class="ident" id="6831040">buf</span>&nbsp;<span class="ident" id="6831044">bytes</span><span class="op" id="6831049">.</span><span class="ident" id="6831050">Buffer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831058">br</span>&nbsp;<span class="op" id="6831061">:=</span>&nbsp;<span class="ident" id="6831064">bufio</span><span class="op" id="6831069">.</span><span class="ident" id="6831070">NewReader</span><span class="op" id="6831079">(</span><span class="op" id="6831080">&amp;</span><span class="ident" id="6831081">buf</span><span class="op" id="6831084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831087">r</span>&nbsp;<span class="op" id="6831089">:=</span>&nbsp;<span class="ident" id="6831092">NewReader</span><span class="op" id="6831101">(</span><span class="ident" id="6831102">br</span><span class="op" id="6831104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831107">for</span>&nbsp;<span class="ident" id="6831111">i</span>&nbsp;<span class="op" id="6831113">:=</span>&nbsp;<span class="num" id="6831116">0</span><span class="op" id="6831117">;</span>&nbsp;<span class="ident" id="6831119">i</span>&nbsp;<span class="op" id="6831121">&lt;</span>&nbsp;<span class="ident" id="6831123">b</span><span class="op" id="6831124">.</span><span class="ident" id="6831125">N</span><span class="op" id="6831126">;</span>&nbsp;<span class="ident" id="6831128">i</span><span class="op" id="6831129">++</span>&nbsp;<span class="op" id="6831132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831136">buf</span><span class="op" id="6831139">.</span><span class="ident" id="6831140">WriteString</span><span class="op" id="6831151">(</span><span class="string" id="6831152">&#34;uncommon-header-for-benchmark:&nbsp;foo\r\n\r\n&#34;</span><span class="op" id="6831196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831200">h</span><span class="op" id="6831201">,</span>&nbsp;<span class="ident" id="6831203">err</span>&nbsp;<span class="op" id="6831207">:=</span>&nbsp;<span class="ident" id="6831210">r</span><span class="op" id="6831211">.</span><span class="ident" id="6831212">ReadMIMEHeader</span><span class="op" id="6831226">(</span><span class="op" id="6831227">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831231">if</span>&nbsp;<span class="ident" id="6831234">err</span>&nbsp;<span class="op" id="6831238">!=</span>&nbsp;<span class="ident" id="6831241">nil</span>&nbsp;<span class="op" id="6831245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831250">b</span><span class="op" id="6831251">.</span><span class="ident" id="6831252">Fatal</span><span class="op" id="6831257">(</span><span class="ident" id="6831258">err</span><span class="op" id="6831261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831269">if</span>&nbsp;<span class="ident" id="6831272">_</span><span class="op" id="6831273">,</span>&nbsp;<span class="ident" id="6831275">ok</span>&nbsp;<span class="op" id="6831278">:=</span>&nbsp;<span class="ident" id="6831281">h</span><span class="op" id="6831282">[</span><span class="string" id="6831283">&#34;Uncommon-Header-For-Benchmark&#34;</span><span class="op" id="6831314">]</span><span class="op" id="6831315">;</span>&nbsp;<span class="op" id="6831317">!</span><span class="ident" id="6831318">ok</span>&nbsp;<span class="op" id="6831321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831326">b</span><span class="op" id="6831327">.</span><span class="ident" id="6831328">Fatal</span><span class="op" id="6831333">(</span><span class="string" id="6831334">&#34;Missing&nbsp;result&nbsp;header.&#34;</span><span class="op" id="6831358">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831365">}</span><br>
<span class="lineno"></span><span class="op" id="6831367">}</span>
</div>
</body>
</html>
