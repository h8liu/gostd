<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/arch8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/arch8/console.go.html">console.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu.go.html">cpu.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu_test.go.html">cpu_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/device.go.html">device.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/exception.go.html">exception.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br_test.go.html">inst_br_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm_test.go.html">inst_imm_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg_test.go.html">inst_reg_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/int_bus.go.html">int_bus.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt.go.html">interrupt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt_test.go.html">interrupt_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/machine.go.html">machine.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/multi_core.go.html">multi_core.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page.go.html">page.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table.go.html">page_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table_test.go.html">page_table_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_test.go.html">page_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory.go.html">phy_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory_test.go.html">phy_memory_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs.go.html">regs.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs_test.go.html">regs_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/run_image.go.html">run_image.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/serial.go.html">serial.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/ticker.go.html">ticker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory.go.html">virt_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory_test.go.html">virt_memory_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="4788504">package</span>&nbsp;<span class="ident" id="4788512">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4788519">//&nbsp;InstSys&nbsp;exectues&nbsp;a&nbsp;system&nbsp;instruction</span><br>
<span class="lineno"></span><span class="keyword" id="4788560">type</span>&nbsp;<span class="ident" id="4788565">instSys</span>&nbsp;<span class="keyword" id="4788573">struct</span><span class="op" id="4788579">{</span><span class="op" id="4788580">}</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span><span class="comment" id="4788583">//&nbsp;I&nbsp;executes&nbsp;the&nbsp;system&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="4788621">//&nbsp;Returns&nbsp;any&nbsp;exception&nbsp;encountered.</span><br>
<span class="lineno"></span><span class="keyword" id="4788659">func</span>&nbsp;<span class="op" id="4788664">(</span><span class="ident" id="4788665">i</span>&nbsp;<span class="op" id="4788667">*</span><span class="ident" id="4788668">instSys</span><span class="op" id="4788675">)</span>&nbsp;<span class="ident" id="4788677">I</span><span class="op" id="4788678">(</span><span class="ident" id="4788679">cpu</span>&nbsp;<span class="op" id="4788683">*</span><span class="ident" id="4788684">cpu</span><span class="op" id="4788687">,</span>&nbsp;<span class="ident" id="4788689">in</span>&nbsp;<span class="builtintype" id="4788692">uint32</span><span class="op" id="4788698">)</span>&nbsp;<span class="op" id="4788700">*</span><span class="ident" id="4788701">Excep</span>&nbsp;<span class="op" id="4788707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788710">op</span>&nbsp;<span class="op" id="4788713">:=</span>&nbsp;<span class="op" id="4788716">(</span><span class="ident" id="4788717">in</span>&nbsp;<span class="op" id="4788720">&gt;&gt;</span>&nbsp;<span class="num" id="4788723">24</span><span class="op" id="4788725">)</span>&nbsp;<span class="op" id="4788727">&amp;</span>&nbsp;<span class="num" id="4788729">0xff</span>&nbsp;<span class="comment" id="4788734">//&nbsp;(32:24]</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788746">src</span>&nbsp;<span class="op" id="4788750">:=</span>&nbsp;<span class="op" id="4788753">(</span><span class="ident" id="4788754">in</span>&nbsp;<span class="op" id="4788757">&gt;&gt;</span>&nbsp;<span class="num" id="4788760">21</span><span class="op" id="4788762">)</span>&nbsp;<span class="op" id="4788764">&amp;</span>&nbsp;<span class="num" id="4788766">0x7</span>&nbsp;<span class="comment" id="4788770">//&nbsp;(24:21]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788782">s</span>&nbsp;<span class="op" id="4788784">:=</span>&nbsp;<span class="ident" id="4788787">cpu</span><span class="op" id="4788790">.</span><span class="ident" id="4788791">regs</span><span class="op" id="4788795">[</span><span class="ident" id="4788796">src</span><span class="op" id="4788799">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788803">switch</span>&nbsp;<span class="ident" id="4788810">op</span>&nbsp;<span class="op" id="4788813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788816">case</span>&nbsp;<span class="num" id="4788821">64</span><span class="op" id="4788823">:</span>&nbsp;<span class="comment" id="4788825">//&nbsp;halt</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788835">return</span>&nbsp;<span class="ident" id="4788842">errHalt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788851">case</span>&nbsp;<span class="num" id="4788856">65</span><span class="op" id="4788858">:</span>&nbsp;<span class="comment" id="4788860">//&nbsp;syscall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788873">if</span>&nbsp;<span class="op" id="4788876">!</span><span class="ident" id="4788877">cpu</span><span class="op" id="4788880">.</span><span class="ident" id="4788881">UserMode</span><span class="op" id="4788889">(</span><span class="op" id="4788890">)</span>&nbsp;<span class="op" id="4788892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788897">return</span>&nbsp;<span class="ident" id="4788904">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4788921">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788925">return</span>&nbsp;<span class="ident" id="4788932">cpu</span><span class="op" id="4788935">.</span><span class="ident" id="4788936">Syscall</span><span class="op" id="4788943">(</span><span class="op" id="4788944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788947">case</span>&nbsp;<span class="num" id="4788952">66</span><span class="op" id="4788954">:</span>&nbsp;<span class="comment" id="4788956">//&nbsp;usermod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788969">cpu</span><span class="op" id="4788972">.</span><span class="ident" id="4788973">ring</span>&nbsp;<span class="op" id="4788978">=</span>&nbsp;<span class="num" id="4788980">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788983">case</span>&nbsp;<span class="num" id="4788988">67</span><span class="op" id="4788990">:</span>&nbsp;<span class="comment" id="4788992">//&nbsp;vtable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789004">if</span>&nbsp;<span class="ident" id="4789007">cpu</span><span class="op" id="4789010">.</span><span class="ident" id="4789011">UserMode</span><span class="op" id="4789019">(</span><span class="op" id="4789020">)</span>&nbsp;<span class="op" id="4789022">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789027">return</span>&nbsp;<span class="ident" id="4789034">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4789051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789055">cpu</span><span class="op" id="4789058">.</span><span class="ident" id="4789059">virtMem</span><span class="op" id="4789066">.</span><span class="ident" id="4789067">SetTable</span><span class="op" id="4789075">(</span><span class="ident" id="4789076">s</span><span class="op" id="4789077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789080">case</span>&nbsp;<span class="num" id="4789085">68</span><span class="op" id="4789087">:</span>&nbsp;<span class="comment" id="4789089">//&nbsp;iret</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789099">if</span>&nbsp;<span class="ident" id="4789102">cpu</span><span class="op" id="4789105">.</span><span class="ident" id="4789106">UserMode</span><span class="op" id="4789114">(</span><span class="op" id="4789115">)</span>&nbsp;<span class="op" id="4789117">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789122">return</span>&nbsp;<span class="ident" id="4789129">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4789146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789150">return</span>&nbsp;<span class="ident" id="4789157">cpu</span><span class="op" id="4789160">.</span><span class="ident" id="4789161">Iret</span><span class="op" id="4789165">(</span><span class="op" id="4789166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789169">case</span>&nbsp;<span class="num" id="4789174">69</span><span class="op" id="4789176">:</span>&nbsp;<span class="comment" id="4789178">//&nbsp;cpuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789189">s</span>&nbsp;<span class="op" id="4789191">=</span>&nbsp;<span class="builtintype" id="4789193">uint32</span><span class="op" id="4789199">(</span><span class="ident" id="4789200">cpu</span><span class="op" id="4789203">.</span><span class="ident" id="4789204">index</span><span class="op" id="4789209">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789212">default</span><span class="op" id="4789219">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789223">return</span>&nbsp;<span class="ident" id="4789230">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4789246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789250">cpu</span><span class="op" id="4789253">.</span><span class="ident" id="4789254">regs</span><span class="op" id="4789258">[</span><span class="ident" id="4789259">src</span><span class="op" id="4789262">]</span>&nbsp;<span class="op" id="4789264">=</span>&nbsp;<span class="ident" id="4789266">s</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789270">return</span>&nbsp;<span class="ident" id="4789277">nil</span><br>
<span class="lineno"></span><span class="op" id="4789281">}</span>
</div>
</body>
</html>
