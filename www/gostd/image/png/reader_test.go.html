<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7362981">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7363036">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7363090">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7363141">package</span>&nbsp;<span class="ident" id="7363149">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7363154">import</span>&nbsp;<span class="op" id="7363161">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363164">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363173">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363180">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363189">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363204">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363210">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363223">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363229">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363240">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7363250">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7363253">var</span>&nbsp;<span class="ident" id="7363257">filenames</span>&nbsp;<span class="op" id="7363267">=</span>&nbsp;<span class="op" id="7363269">[</span><span class="op" id="7363270">]</span><span class="builtintype" id="7363271">string</span><span class="op" id="7363277">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363280">&#34;basn0g01&#34;</span><span class="op" id="7363290">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363293">&#34;basn0g01-30&#34;</span><span class="op" id="7363306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363309">&#34;basn0g02&#34;</span><span class="op" id="7363319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363322">&#34;basn0g02-29&#34;</span><span class="op" id="7363335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363338">&#34;basn0g04&#34;</span><span class="op" id="7363348">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363351">&#34;basn0g04-31&#34;</span><span class="op" id="7363364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363367">&#34;basn0g08&#34;</span><span class="op" id="7363377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363380">&#34;basn0g16&#34;</span><span class="op" id="7363390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363393">&#34;basn2c08&#34;</span><span class="op" id="7363403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363406">&#34;basn2c16&#34;</span><span class="op" id="7363416">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363419">&#34;basn3p01&#34;</span><span class="op" id="7363429">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363432">&#34;basn3p02&#34;</span><span class="op" id="7363442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363445">&#34;basn3p04&#34;</span><span class="op" id="7363455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363458">&#34;basn3p04-31i&#34;</span><span class="op" id="7363472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363475">&#34;basn3p08&#34;</span><span class="op" id="7363485">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363488">&#34;basn3p08-trns&#34;</span><span class="op" id="7363503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363506">&#34;basn4a08&#34;</span><span class="op" id="7363516">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363519">&#34;basn4a16&#34;</span><span class="op" id="7363529">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363532">&#34;basn6a08&#34;</span><span class="op" id="7363542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363545">&#34;basn6a16&#34;</span><span class="op" id="7363555">,</span><br>
<span class="lineno">40</span><span class="op" id="7363557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7363560">var</span>&nbsp;<span class="ident" id="7363564">filenamesPaletted</span>&nbsp;<span class="op" id="7363582">=</span>&nbsp;<span class="op" id="7363584">[</span><span class="op" id="7363585">]</span><span class="builtintype" id="7363586">string</span><span class="op" id="7363592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363595">&#34;basn3p01&#34;</span><span class="op" id="7363605">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363608">&#34;basn3p02&#34;</span><span class="op" id="7363618">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363621">&#34;basn3p04&#34;</span><span class="op" id="7363631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363634">&#34;basn3p08&#34;</span><span class="op" id="7363644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363647">&#34;basn3p08-trns&#34;</span><span class="op" id="7363662">,</span><br>
<span class="lineno"></span><span class="op" id="7363664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="7363667">var</span>&nbsp;<span class="ident" id="7363671">filenamesShort</span>&nbsp;<span class="op" id="7363686">=</span>&nbsp;<span class="op" id="7363688">[</span><span class="op" id="7363689">]</span><span class="builtintype" id="7363690">string</span><span class="op" id="7363696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363699">&#34;basn0g01&#34;</span><span class="op" id="7363709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363712">&#34;basn0g04-31&#34;</span><span class="op" id="7363725">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7363728">&#34;basn6a16&#34;</span><span class="op" id="7363738">,</span><br>
<span class="lineno"></span><span class="op" id="7363740">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="7363743">func</span>&nbsp;<span class="ident" id="7363748">readPNG</span><span class="op" id="7363755">(</span><span class="ident" id="7363756">filename</span>&nbsp;<span class="builtintype" id="7363765">string</span><span class="op" id="7363771">)</span>&nbsp;<span class="op" id="7363773">(</span><span class="ident" id="7363774">image</span><span class="op" id="7363779">.</span><span class="ident" id="7363780">Image</span><span class="op" id="7363785">,</span>&nbsp;<span class="builtintype" id="7363787">error</span><span class="op" id="7363792">)</span>&nbsp;<span class="op" id="7363794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7363797">f</span><span class="op" id="7363798">,</span>&nbsp;<span class="ident" id="7363800">err</span>&nbsp;<span class="op" id="7363804">:=</span>&nbsp;<span class="ident" id="7363807">os</span><span class="op" id="7363809">.</span><span class="ident" id="7363810">Open</span><span class="op" id="7363814">(</span><span class="ident" id="7363815">filename</span><span class="op" id="7363823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363826">if</span>&nbsp;<span class="ident" id="7363829">err</span>&nbsp;<span class="op" id="7363833">!=</span>&nbsp;<span class="ident" id="7363836">nil</span>&nbsp;<span class="op" id="7363840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363844">return</span>&nbsp;<span class="ident" id="7363851">nil</span><span class="op" id="7363854">,</span>&nbsp;<span class="ident" id="7363856">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7363861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363864">defer</span>&nbsp;<span class="ident" id="7363870">f</span><span class="op" id="7363871">.</span><span class="ident" id="7363872">Close</span><span class="op" id="7363877">(</span><span class="op" id="7363878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363881">return</span>&nbsp;<span class="ident" id="7363888">Decode</span><span class="op" id="7363894">(</span><span class="ident" id="7363895">f</span><span class="op" id="7363896">)</span><br>
<span class="lineno"></span><span class="op" id="7363898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="7363901">//&nbsp;An&nbsp;approximation&nbsp;of&nbsp;the&nbsp;sng&nbsp;command-line&nbsp;tool.</span><br>
<span class="lineno"></span><span class="keyword" id="7363951">func</span>&nbsp;<span class="ident" id="7363956">sng</span><span class="op" id="7363959">(</span><span class="ident" id="7363960">w</span>&nbsp;<span class="ident" id="7363962">io</span><span class="op" id="7363964">.</span><span class="ident" id="7363965">WriteCloser</span><span class="op" id="7363976">,</span>&nbsp;<span class="ident" id="7363978">filename</span>&nbsp;<span class="builtintype" id="7363987">string</span><span class="op" id="7363993">,</span>&nbsp;<span class="ident" id="7363995">png</span>&nbsp;<span class="ident" id="7363999">image</span><span class="op" id="7364004">.</span><span class="ident" id="7364005">Image</span><span class="op" id="7364010">)</span>&nbsp;<span class="op" id="7364012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364015">defer</span>&nbsp;<span class="ident" id="7364021">w</span><span class="op" id="7364022">.</span><span class="ident" id="7364023">Close</span><span class="op" id="7364028">(</span><span class="op" id="7364029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364032">bounds</span>&nbsp;<span class="op" id="7364039">:=</span>&nbsp;<span class="ident" id="7364042">png</span><span class="op" id="7364045">.</span><span class="ident" id="7364046">Bounds</span><span class="op" id="7364052">(</span><span class="op" id="7364053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364056">cm</span>&nbsp;<span class="op" id="7364059">:=</span>&nbsp;<span class="ident" id="7364062">png</span><span class="op" id="7364065">.</span><span class="ident" id="7364066">ColorModel</span><span class="op" id="7364076">(</span><span class="op" id="7364077">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364080">var</span>&nbsp;<span class="ident" id="7364084">bitdepth</span>&nbsp;<span class="builtintype" id="7364093">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364098">switch</span>&nbsp;<span class="ident" id="7364105">cm</span>&nbsp;<span class="op" id="7364108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364111">case</span>&nbsp;<span class="ident" id="7364116">color</span><span class="op" id="7364121">.</span><span class="ident" id="7364122">RGBAModel</span><span class="op" id="7364131">,</span>&nbsp;<span class="ident" id="7364133">color</span><span class="op" id="7364138">.</span><span class="ident" id="7364139">NRGBAModel</span><span class="op" id="7364149">,</span>&nbsp;<span class="ident" id="7364151">color</span><span class="op" id="7364156">.</span><span class="ident" id="7364157">AlphaModel</span><span class="op" id="7364167">,</span>&nbsp;<span class="ident" id="7364169">color</span><span class="op" id="7364174">.</span><span class="ident" id="7364175">GrayModel</span><span class="op" id="7364184">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364188">bitdepth</span>&nbsp;<span class="op" id="7364197">=</span>&nbsp;<span class="num" id="7364199">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364202">default</span><span class="op" id="7364209">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364213">bitdepth</span>&nbsp;<span class="op" id="7364222">=</span>&nbsp;<span class="num" id="7364224">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7364228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364231">cpm</span><span class="op" id="7364234">,</span>&nbsp;<span class="ident" id="7364236">_</span>&nbsp;<span class="op" id="7364238">:=</span>&nbsp;<span class="ident" id="7364241">cm</span><span class="op" id="7364243">.</span><span class="op" id="7364244">(</span><span class="ident" id="7364245">color</span><span class="op" id="7364250">.</span><span class="ident" id="7364251">Palette</span><span class="op" id="7364258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364261">var</span>&nbsp;<span class="ident" id="7364265">paletted</span>&nbsp;<span class="op" id="7364274">*</span><span class="ident" id="7364275">image</span><span class="op" id="7364280">.</span><span class="ident" id="7364281">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364291">if</span>&nbsp;<span class="ident" id="7364294">cpm</span>&nbsp;<span class="op" id="7364298">!=</span>&nbsp;<span class="ident" id="7364301">nil</span>&nbsp;<span class="op" id="7364305">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364309">switch</span>&nbsp;<span class="op" id="7364316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364320">case</span>&nbsp;<span class="builtinfunc" id="7364325">len</span><span class="op" id="7364328">(</span><span class="ident" id="7364329">cpm</span><span class="op" id="7364332">)</span>&nbsp;<span class="op" id="7364334">&lt;=</span>&nbsp;<span class="num" id="7364337">2</span><span class="op" id="7364338">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364343">bitdepth</span>&nbsp;<span class="op" id="7364352">=</span>&nbsp;<span class="num" id="7364354">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364358">case</span>&nbsp;<span class="builtinfunc" id="7364363">len</span><span class="op" id="7364366">(</span><span class="ident" id="7364367">cpm</span><span class="op" id="7364370">)</span>&nbsp;<span class="op" id="7364372">&lt;=</span>&nbsp;<span class="num" id="7364375">4</span><span class="op" id="7364376">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364381">bitdepth</span>&nbsp;<span class="op" id="7364390">=</span>&nbsp;<span class="num" id="7364392">2</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364396">case</span>&nbsp;<span class="builtinfunc" id="7364401">len</span><span class="op" id="7364404">(</span><span class="ident" id="7364405">cpm</span><span class="op" id="7364408">)</span>&nbsp;<span class="op" id="7364410">&lt;=</span>&nbsp;<span class="num" id="7364413">16</span><span class="op" id="7364415">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364420">bitdepth</span>&nbsp;<span class="op" id="7364429">=</span>&nbsp;<span class="num" id="7364431">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364435">default</span><span class="op" id="7364442">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364447">bitdepth</span>&nbsp;<span class="op" id="7364456">=</span>&nbsp;<span class="num" id="7364458">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7364462">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364466">paletted</span>&nbsp;<span class="op" id="7364475">=</span>&nbsp;<span class="ident" id="7364477">png</span><span class="op" id="7364480">.</span><span class="op" id="7364481">(</span><span class="op" id="7364482">*</span><span class="ident" id="7364483">image</span><span class="op" id="7364488">.</span><span class="ident" id="7364489">Paletted</span><span class="op" id="7364497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7364500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7364504">//&nbsp;Write&nbsp;the&nbsp;filename&nbsp;and&nbsp;IHDR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364537">io</span><span class="op" id="7364539">.</span><span class="ident" id="7364540">WriteString</span><span class="op" id="7364551">(</span><span class="ident" id="7364552">w</span><span class="op" id="7364553">,</span>&nbsp;<span class="string" id="7364555">&#34;#SNG:&nbsp;from&nbsp;&#34;</span><span class="op" id="7364568">+</span><span class="ident" id="7364569">filename</span><span class="op" id="7364577">+</span><span class="string" id="7364578">&#34;.png\nIHDR&nbsp;{\n&#34;</span><span class="op" id="7364594">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364597">fmt</span><span class="op" id="7364600">.</span><span class="ident" id="7364601">Fprintf</span><span class="op" id="7364608">(</span><span class="ident" id="7364609">w</span><span class="op" id="7364610">,</span>&nbsp;<span class="string" id="7364612">&#34;&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;%d;&nbsp;height:&nbsp;%d;&nbsp;bitdepth:&nbsp;%d;\n&#34;</span><span class="op" id="7364656">,</span>&nbsp;<span class="ident" id="7364658">bounds</span><span class="op" id="7364664">.</span><span class="ident" id="7364665">Dx</span><span class="op" id="7364667">(</span><span class="op" id="7364668">)</span><span class="op" id="7364669">,</span>&nbsp;<span class="ident" id="7364671">bounds</span><span class="op" id="7364677">.</span><span class="ident" id="7364678">Dy</span><span class="op" id="7364680">(</span><span class="op" id="7364681">)</span><span class="op" id="7364682">,</span>&nbsp;<span class="ident" id="7364684">bitdepth</span><span class="op" id="7364692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364695">switch</span>&nbsp;<span class="op" id="7364702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364705">case</span>&nbsp;<span class="ident" id="7364710">cm</span>&nbsp;<span class="op" id="7364713">==</span>&nbsp;<span class="ident" id="7364716">color</span><span class="op" id="7364721">.</span><span class="ident" id="7364722">RGBAModel</span><span class="op" id="7364731">,</span>&nbsp;<span class="ident" id="7364733">cm</span>&nbsp;<span class="op" id="7364736">==</span>&nbsp;<span class="ident" id="7364739">color</span><span class="op" id="7364744">.</span><span class="ident" id="7364745">RGBA64Model</span><span class="op" id="7364756">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364760">io</span><span class="op" id="7364762">.</span><span class="ident" id="7364763">WriteString</span><span class="op" id="7364774">(</span><span class="ident" id="7364775">w</span><span class="op" id="7364776">,</span>&nbsp;<span class="string" id="7364778">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color;\n&#34;</span><span class="op" id="7364798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364801">case</span>&nbsp;<span class="ident" id="7364806">cm</span>&nbsp;<span class="op" id="7364809">==</span>&nbsp;<span class="ident" id="7364812">color</span><span class="op" id="7364817">.</span><span class="ident" id="7364818">NRGBAModel</span><span class="op" id="7364828">,</span>&nbsp;<span class="ident" id="7364830">cm</span>&nbsp;<span class="op" id="7364833">==</span>&nbsp;<span class="ident" id="7364836">color</span><span class="op" id="7364841">.</span><span class="ident" id="7364842">NRGBA64Model</span><span class="op" id="7364854">:</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364858">io</span><span class="op" id="7364860">.</span><span class="ident" id="7364861">WriteString</span><span class="op" id="7364872">(</span><span class="ident" id="7364873">w</span><span class="op" id="7364874">,</span>&nbsp;<span class="string" id="7364876">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;alpha;\n&#34;</span><span class="op" id="7364902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364905">case</span>&nbsp;<span class="ident" id="7364910">cm</span>&nbsp;<span class="op" id="7364913">==</span>&nbsp;<span class="ident" id="7364916">color</span><span class="op" id="7364921">.</span><span class="ident" id="7364922">GrayModel</span><span class="op" id="7364931">,</span>&nbsp;<span class="ident" id="7364933">cm</span>&nbsp;<span class="op" id="7364936">==</span>&nbsp;<span class="ident" id="7364939">color</span><span class="op" id="7364944">.</span><span class="ident" id="7364945">Gray16Model</span><span class="op" id="7364956">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364960">io</span><span class="op" id="7364962">.</span><span class="ident" id="7364963">WriteString</span><span class="op" id="7364974">(</span><span class="ident" id="7364975">w</span><span class="op" id="7364976">,</span>&nbsp;<span class="string" id="7364978">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;grayscale;\n&#34;</span><span class="op" id="7365002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365005">case</span>&nbsp;<span class="ident" id="7365010">cpm</span>&nbsp;<span class="op" id="7365014">!=</span>&nbsp;<span class="ident" id="7365017">nil</span><span class="op" id="7365020">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365024">io</span><span class="op" id="7365026">.</span><span class="ident" id="7365027">WriteString</span><span class="op" id="7365038">(</span><span class="ident" id="7365039">w</span><span class="op" id="7365040">,</span>&nbsp;<span class="string" id="7365042">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;palette;\n&#34;</span><span class="op" id="7365070">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365073">default</span><span class="op" id="7365080">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365084">io</span><span class="op" id="7365086">.</span><span class="ident" id="7365087">WriteString</span><span class="op" id="7365098">(</span><span class="ident" id="7365099">w</span><span class="op" id="7365100">,</span>&nbsp;<span class="string" id="7365102">&#34;unknown&nbsp;PNG&nbsp;decoder&nbsp;color&nbsp;model\n&#34;</span><span class="op" id="7365137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7365140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365143">io</span><span class="op" id="7365145">.</span><span class="ident" id="7365146">WriteString</span><span class="op" id="7365157">(</span><span class="ident" id="7365158">w</span><span class="op" id="7365159">,</span>&nbsp;<span class="string" id="7365161">&#34;}\n&#34;</span><span class="op" id="7365166">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7365170">//&nbsp;We&nbsp;fake&nbsp;a&nbsp;gAMA&nbsp;output.&nbsp;The&nbsp;test&nbsp;files&nbsp;have&nbsp;a&nbsp;gAMA&nbsp;chunk&nbsp;but&nbsp;the&nbsp;go&nbsp;PNG&nbsp;parser&nbsp;ignores&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7365263">//&nbsp;(the&nbsp;PNG&nbsp;spec&nbsp;section&nbsp;11.3&nbsp;says&nbsp;&#34;Ancillary&nbsp;chunks&nbsp;may&nbsp;be&nbsp;ignored&nbsp;by&nbsp;a&nbsp;decoder&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365348">io</span><span class="op" id="7365350">.</span><span class="ident" id="7365351">WriteString</span><span class="op" id="7365362">(</span><span class="ident" id="7365363">w</span><span class="op" id="7365364">,</span>&nbsp;<span class="string" id="7365366">&#34;gAMA&nbsp;{1.0000}\n&#34;</span><span class="op" id="7365383">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7365387">//&nbsp;Write&nbsp;the&nbsp;PLTE&nbsp;and&nbsp;tRNS&nbsp;(if&nbsp;applicable).</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365432">if</span>&nbsp;<span class="ident" id="7365435">cpm</span>&nbsp;<span class="op" id="7365439">!=</span>&nbsp;<span class="ident" id="7365442">nil</span>&nbsp;<span class="op" id="7365446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365450">lastAlpha</span>&nbsp;<span class="op" id="7365460">:=</span>&nbsp;<span class="op" id="7365463">-</span><span class="num" id="7365464">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365468">io</span><span class="op" id="7365470">.</span><span class="ident" id="7365471">WriteString</span><span class="op" id="7365482">(</span><span class="ident" id="7365483">w</span><span class="op" id="7365484">,</span>&nbsp;<span class="string" id="7365486">&#34;PLTE&nbsp;{\n&#34;</span><span class="op" id="7365496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365500">for</span>&nbsp;<span class="ident" id="7365504">i</span><span class="op" id="7365505">,</span>&nbsp;<span class="ident" id="7365507">c</span>&nbsp;<span class="op" id="7365509">:=</span>&nbsp;<span class="keyword" id="7365512">range</span>&nbsp;<span class="ident" id="7365518">cpm</span>&nbsp;<span class="op" id="7365522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365527">var</span>&nbsp;<span class="ident" id="7365531">r</span><span class="op" id="7365532">,</span>&nbsp;<span class="ident" id="7365534">g</span><span class="op" id="7365535">,</span>&nbsp;<span class="ident" id="7365537">b</span><span class="op" id="7365538">,</span>&nbsp;<span class="ident" id="7365540">a</span>&nbsp;<span class="builtintype" id="7365542">uint8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365551">switch</span>&nbsp;<span class="ident" id="7365558">c</span>&nbsp;<span class="op" id="7365560">:=</span>&nbsp;<span class="ident" id="7365563">c</span><span class="op" id="7365564">.</span><span class="op" id="7365565">(</span><span class="keyword" id="7365566">type</span><span class="op" id="7365570">)</span>&nbsp;<span class="op" id="7365572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365577">case</span>&nbsp;<span class="ident" id="7365582">color</span><span class="op" id="7365587">.</span><span class="ident" id="7365588">RGBA</span><span class="op" id="7365592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365598">r</span><span class="op" id="7365599">,</span>&nbsp;<span class="ident" id="7365601">g</span><span class="op" id="7365602">,</span>&nbsp;<span class="ident" id="7365604">b</span><span class="op" id="7365605">,</span>&nbsp;<span class="ident" id="7365607">a</span>&nbsp;<span class="op" id="7365609">=</span>&nbsp;<span class="ident" id="7365611">c</span><span class="op" id="7365612">.</span><span class="ident" id="7365613">R</span><span class="op" id="7365614">,</span>&nbsp;<span class="ident" id="7365616">c</span><span class="op" id="7365617">.</span><span class="ident" id="7365618">G</span><span class="op" id="7365619">,</span>&nbsp;<span class="ident" id="7365621">c</span><span class="op" id="7365622">.</span><span class="ident" id="7365623">B</span><span class="op" id="7365624">,</span>&nbsp;<span class="num" id="7365626">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365634">case</span>&nbsp;<span class="ident" id="7365639">color</span><span class="op" id="7365644">.</span><span class="ident" id="7365645">NRGBA</span><span class="op" id="7365650">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365656">r</span><span class="op" id="7365657">,</span>&nbsp;<span class="ident" id="7365659">g</span><span class="op" id="7365660">,</span>&nbsp;<span class="ident" id="7365662">b</span><span class="op" id="7365663">,</span>&nbsp;<span class="ident" id="7365665">a</span>&nbsp;<span class="op" id="7365667">=</span>&nbsp;<span class="ident" id="7365669">c</span><span class="op" id="7365670">.</span><span class="ident" id="7365671">R</span><span class="op" id="7365672">,</span>&nbsp;<span class="ident" id="7365674">c</span><span class="op" id="7365675">.</span><span class="ident" id="7365676">G</span><span class="op" id="7365677">,</span>&nbsp;<span class="ident" id="7365679">c</span><span class="op" id="7365680">.</span><span class="ident" id="7365681">B</span><span class="op" id="7365682">,</span>&nbsp;<span class="ident" id="7365684">c</span><span class="op" id="7365685">.</span><span class="ident" id="7365686">A</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365691">default</span><span class="op" id="7365698">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7365704">panic</span><span class="op" id="7365709">(</span><span class="string" id="7365710">&#34;unknown&nbsp;palette&nbsp;color&nbsp;type&#34;</span><span class="op" id="7365738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7365743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365748">if</span>&nbsp;<span class="ident" id="7365751">a</span>&nbsp;<span class="op" id="7365753">!=</span>&nbsp;<span class="num" id="7365756">0xff</span>&nbsp;<span class="op" id="7365761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365767">lastAlpha</span>&nbsp;<span class="op" id="7365777">=</span>&nbsp;<span class="ident" id="7365779">i</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7365784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365789">fmt</span><span class="op" id="7365792">.</span><span class="ident" id="7365793">Fprintf</span><span class="op" id="7365800">(</span><span class="ident" id="7365801">w</span><span class="op" id="7365802">,</span>&nbsp;<span class="string" id="7365804">&#34;&nbsp;&nbsp;&nbsp;&nbsp;(%3d,%3d,%3d)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;rgb&nbsp;=&nbsp;(0x%02x,0x%02x,0x%02x)\n&#34;</span><span class="op" id="7365860">,</span>&nbsp;<span class="ident" id="7365862">r</span><span class="op" id="7365863">,</span>&nbsp;<span class="ident" id="7365865">g</span><span class="op" id="7365866">,</span>&nbsp;<span class="ident" id="7365868">b</span><span class="op" id="7365869">,</span>&nbsp;<span class="ident" id="7365871">r</span><span class="op" id="7365872">,</span>&nbsp;<span class="ident" id="7365874">g</span><span class="op" id="7365875">,</span>&nbsp;<span class="ident" id="7365877">b</span><span class="op" id="7365878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7365882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365886">io</span><span class="op" id="7365888">.</span><span class="ident" id="7365889">WriteString</span><span class="op" id="7365900">(</span><span class="ident" id="7365901">w</span><span class="op" id="7365902">,</span>&nbsp;<span class="string" id="7365904">&#34;}\n&#34;</span><span class="op" id="7365909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365913">if</span>&nbsp;<span class="ident" id="7365916">lastAlpha</span>&nbsp;<span class="op" id="7365926">!=</span>&nbsp;<span class="op" id="7365929">-</span><span class="num" id="7365930">1</span>&nbsp;<span class="op" id="7365932">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365937">io</span><span class="op" id="7365939">.</span><span class="ident" id="7365940">WriteString</span><span class="op" id="7365951">(</span><span class="ident" id="7365952">w</span><span class="op" id="7365953">,</span>&nbsp;<span class="string" id="7365955">&#34;tRNS&nbsp;{\n&#34;</span><span class="op" id="7365965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365970">for</span>&nbsp;<span class="ident" id="7365974">i</span>&nbsp;<span class="op" id="7365976">:=</span>&nbsp;<span class="num" id="7365979">0</span><span class="op" id="7365980">;</span>&nbsp;<span class="ident" id="7365982">i</span>&nbsp;<span class="op" id="7365984">&lt;=</span>&nbsp;<span class="ident" id="7365987">lastAlpha</span><span class="op" id="7365996">;</span>&nbsp;<span class="ident" id="7365998">i</span><span class="op" id="7365999">++</span>&nbsp;<span class="op" id="7366002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366008">_</span><span class="op" id="7366009">,</span>&nbsp;<span class="ident" id="7366011">_</span><span class="op" id="7366012">,</span>&nbsp;<span class="ident" id="7366014">_</span><span class="op" id="7366015">,</span>&nbsp;<span class="ident" id="7366017">a</span>&nbsp;<span class="op" id="7366019">:=</span>&nbsp;<span class="ident" id="7366022">cpm</span><span class="op" id="7366025">[</span><span class="ident" id="7366026">i</span><span class="op" id="7366027">]</span><span class="op" id="7366028">.</span><span class="ident" id="7366029">RGBA</span><span class="op" id="7366033">(</span><span class="op" id="7366034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366040">a</span>&nbsp;<span class="op" id="7366042">&gt;&gt;=</span>&nbsp;<span class="num" id="7366046">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366052">fmt</span><span class="op" id="7366055">.</span><span class="ident" id="7366056">Fprintf</span><span class="op" id="7366063">(</span><span class="ident" id="7366064">w</span><span class="op" id="7366065">,</span>&nbsp;<span class="string" id="7366067">&#34;&nbsp;%d&#34;</span><span class="op" id="7366072">,</span>&nbsp;<span class="ident" id="7366074">a</span><span class="op" id="7366075">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7366080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366085">io</span><span class="op" id="7366087">.</span><span class="ident" id="7366088">WriteString</span><span class="op" id="7366099">(</span><span class="ident" id="7366100">w</span><span class="op" id="7366101">,</span>&nbsp;<span class="string" id="7366103">&#34;}\n&#34;</span><span class="op" id="7366108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7366112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7366115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7366119">//&nbsp;Write&nbsp;the&nbsp;IMAGE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366140">io</span><span class="op" id="7366142">.</span><span class="ident" id="7366143">WriteString</span><span class="op" id="7366154">(</span><span class="ident" id="7366155">w</span><span class="op" id="7366156">,</span>&nbsp;<span class="string" id="7366158">&#34;IMAGE&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;pixels&nbsp;hex\n&#34;</span><span class="op" id="7366185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366188">for</span>&nbsp;<span class="ident" id="7366192">y</span>&nbsp;<span class="op" id="7366194">:=</span>&nbsp;<span class="ident" id="7366197">bounds</span><span class="op" id="7366203">.</span><span class="ident" id="7366204">Min</span><span class="op" id="7366207">.</span><span class="ident" id="7366208">Y</span><span class="op" id="7366209">;</span>&nbsp;<span class="ident" id="7366211">y</span>&nbsp;<span class="op" id="7366213">&lt;</span>&nbsp;<span class="ident" id="7366215">bounds</span><span class="op" id="7366221">.</span><span class="ident" id="7366222">Max</span><span class="op" id="7366225">.</span><span class="ident" id="7366226">Y</span><span class="op" id="7366227">;</span>&nbsp;<span class="ident" id="7366229">y</span><span class="op" id="7366230">++</span>&nbsp;<span class="op" id="7366233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366237">switch</span>&nbsp;<span class="op" id="7366244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366248">case</span>&nbsp;<span class="ident" id="7366253">cm</span>&nbsp;<span class="op" id="7366256">==</span>&nbsp;<span class="ident" id="7366259">color</span><span class="op" id="7366264">.</span><span class="ident" id="7366265">GrayModel</span><span class="op" id="7366274">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366279">for</span>&nbsp;<span class="ident" id="7366283">x</span>&nbsp;<span class="op" id="7366285">:=</span>&nbsp;<span class="ident" id="7366288">bounds</span><span class="op" id="7366294">.</span><span class="ident" id="7366295">Min</span><span class="op" id="7366298">.</span><span class="ident" id="7366299">X</span><span class="op" id="7366300">;</span>&nbsp;<span class="ident" id="7366302">x</span>&nbsp;<span class="op" id="7366304">&lt;</span>&nbsp;<span class="ident" id="7366306">bounds</span><span class="op" id="7366312">.</span><span class="ident" id="7366313">Max</span><span class="op" id="7366316">.</span><span class="ident" id="7366317">X</span><span class="op" id="7366318">;</span>&nbsp;<span class="ident" id="7366320">x</span><span class="op" id="7366321">++</span>&nbsp;<span class="op" id="7366324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366330">gray</span>&nbsp;<span class="op" id="7366335">:=</span>&nbsp;<span class="ident" id="7366338">png</span><span class="op" id="7366341">.</span><span class="ident" id="7366342">At</span><span class="op" id="7366344">(</span><span class="ident" id="7366345">x</span><span class="op" id="7366346">,</span>&nbsp;<span class="ident" id="7366348">y</span><span class="op" id="7366349">)</span><span class="op" id="7366350">.</span><span class="op" id="7366351">(</span><span class="ident" id="7366352">color</span><span class="op" id="7366357">.</span><span class="ident" id="7366358">Gray</span><span class="op" id="7366362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366368">fmt</span><span class="op" id="7366371">.</span><span class="ident" id="7366372">Fprintf</span><span class="op" id="7366379">(</span><span class="ident" id="7366380">w</span><span class="op" id="7366381">,</span>&nbsp;<span class="string" id="7366383">&#34;%02x&#34;</span><span class="op" id="7366389">,</span>&nbsp;<span class="ident" id="7366391">gray</span><span class="op" id="7366395">.</span><span class="ident" id="7366396">Y</span><span class="op" id="7366397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7366402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366406">case</span>&nbsp;<span class="ident" id="7366411">cm</span>&nbsp;<span class="op" id="7366414">==</span>&nbsp;<span class="ident" id="7366417">color</span><span class="op" id="7366422">.</span><span class="ident" id="7366423">Gray16Model</span><span class="op" id="7366434">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366439">for</span>&nbsp;<span class="ident" id="7366443">x</span>&nbsp;<span class="op" id="7366445">:=</span>&nbsp;<span class="ident" id="7366448">bounds</span><span class="op" id="7366454">.</span><span class="ident" id="7366455">Min</span><span class="op" id="7366458">.</span><span class="ident" id="7366459">X</span><span class="op" id="7366460">;</span>&nbsp;<span class="ident" id="7366462">x</span>&nbsp;<span class="op" id="7366464">&lt;</span>&nbsp;<span class="ident" id="7366466">bounds</span><span class="op" id="7366472">.</span><span class="ident" id="7366473">Max</span><span class="op" id="7366476">.</span><span class="ident" id="7366477">X</span><span class="op" id="7366478">;</span>&nbsp;<span class="ident" id="7366480">x</span><span class="op" id="7366481">++</span>&nbsp;<span class="op" id="7366484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366490">gray16</span>&nbsp;<span class="op" id="7366497">:=</span>&nbsp;<span class="ident" id="7366500">png</span><span class="op" id="7366503">.</span><span class="ident" id="7366504">At</span><span class="op" id="7366506">(</span><span class="ident" id="7366507">x</span><span class="op" id="7366508">,</span>&nbsp;<span class="ident" id="7366510">y</span><span class="op" id="7366511">)</span><span class="op" id="7366512">.</span><span class="op" id="7366513">(</span><span class="ident" id="7366514">color</span><span class="op" id="7366519">.</span><span class="ident" id="7366520">Gray16</span><span class="op" id="7366526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366532">fmt</span><span class="op" id="7366535">.</span><span class="ident" id="7366536">Fprintf</span><span class="op" id="7366543">(</span><span class="ident" id="7366544">w</span><span class="op" id="7366545">,</span>&nbsp;<span class="string" id="7366547">&#34;%04x&nbsp;&#34;</span><span class="op" id="7366554">,</span>&nbsp;<span class="ident" id="7366556">gray16</span><span class="op" id="7366562">.</span><span class="ident" id="7366563">Y</span><span class="op" id="7366564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7366569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366573">case</span>&nbsp;<span class="ident" id="7366578">cm</span>&nbsp;<span class="op" id="7366581">==</span>&nbsp;<span class="ident" id="7366584">color</span><span class="op" id="7366589">.</span><span class="ident" id="7366590">RGBAModel</span><span class="op" id="7366599">:</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366604">for</span>&nbsp;<span class="ident" id="7366608">x</span>&nbsp;<span class="op" id="7366610">:=</span>&nbsp;<span class="ident" id="7366613">bounds</span><span class="op" id="7366619">.</span><span class="ident" id="7366620">Min</span><span class="op" id="7366623">.</span><span class="ident" id="7366624">X</span><span class="op" id="7366625">;</span>&nbsp;<span class="ident" id="7366627">x</span>&nbsp;<span class="op" id="7366629">&lt;</span>&nbsp;<span class="ident" id="7366631">bounds</span><span class="op" id="7366637">.</span><span class="ident" id="7366638">Max</span><span class="op" id="7366641">.</span><span class="ident" id="7366642">X</span><span class="op" id="7366643">;</span>&nbsp;<span class="ident" id="7366645">x</span><span class="op" id="7366646">++</span>&nbsp;<span class="op" id="7366649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366655">rgba</span>&nbsp;<span class="op" id="7366660">:=</span>&nbsp;<span class="ident" id="7366663">png</span><span class="op" id="7366666">.</span><span class="ident" id="7366667">At</span><span class="op" id="7366669">(</span><span class="ident" id="7366670">x</span><span class="op" id="7366671">,</span>&nbsp;<span class="ident" id="7366673">y</span><span class="op" id="7366674">)</span><span class="op" id="7366675">.</span><span class="op" id="7366676">(</span><span class="ident" id="7366677">color</span><span class="op" id="7366682">.</span><span class="ident" id="7366683">RGBA</span><span class="op" id="7366687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366693">fmt</span><span class="op" id="7366696">.</span><span class="ident" id="7366697">Fprintf</span><span class="op" id="7366704">(</span><span class="ident" id="7366705">w</span><span class="op" id="7366706">,</span>&nbsp;<span class="string" id="7366708">&#34;%02x%02x%02x&nbsp;&#34;</span><span class="op" id="7366723">,</span>&nbsp;<span class="ident" id="7366725">rgba</span><span class="op" id="7366729">.</span><span class="ident" id="7366730">R</span><span class="op" id="7366731">,</span>&nbsp;<span class="ident" id="7366733">rgba</span><span class="op" id="7366737">.</span><span class="ident" id="7366738">G</span><span class="op" id="7366739">,</span>&nbsp;<span class="ident" id="7366741">rgba</span><span class="op" id="7366745">.</span><span class="ident" id="7366746">B</span><span class="op" id="7366747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7366752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366756">case</span>&nbsp;<span class="ident" id="7366761">cm</span>&nbsp;<span class="op" id="7366764">==</span>&nbsp;<span class="ident" id="7366767">color</span><span class="op" id="7366772">.</span><span class="ident" id="7366773">RGBA64Model</span><span class="op" id="7366784">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366789">for</span>&nbsp;<span class="ident" id="7366793">x</span>&nbsp;<span class="op" id="7366795">:=</span>&nbsp;<span class="ident" id="7366798">bounds</span><span class="op" id="7366804">.</span><span class="ident" id="7366805">Min</span><span class="op" id="7366808">.</span><span class="ident" id="7366809">X</span><span class="op" id="7366810">;</span>&nbsp;<span class="ident" id="7366812">x</span>&nbsp;<span class="op" id="7366814">&lt;</span>&nbsp;<span class="ident" id="7366816">bounds</span><span class="op" id="7366822">.</span><span class="ident" id="7366823">Max</span><span class="op" id="7366826">.</span><span class="ident" id="7366827">X</span><span class="op" id="7366828">;</span>&nbsp;<span class="ident" id="7366830">x</span><span class="op" id="7366831">++</span>&nbsp;<span class="op" id="7366834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366840">rgba64</span>&nbsp;<span class="op" id="7366847">:=</span>&nbsp;<span class="ident" id="7366850">png</span><span class="op" id="7366853">.</span><span class="ident" id="7366854">At</span><span class="op" id="7366856">(</span><span class="ident" id="7366857">x</span><span class="op" id="7366858">,</span>&nbsp;<span class="ident" id="7366860">y</span><span class="op" id="7366861">)</span><span class="op" id="7366862">.</span><span class="op" id="7366863">(</span><span class="ident" id="7366864">color</span><span class="op" id="7366869">.</span><span class="ident" id="7366870">RGBA64</span><span class="op" id="7366876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366882">fmt</span><span class="op" id="7366885">.</span><span class="ident" id="7366886">Fprintf</span><span class="op" id="7366893">(</span><span class="ident" id="7366894">w</span><span class="op" id="7366895">,</span>&nbsp;<span class="string" id="7366897">&#34;%04x%04x%04x&nbsp;&#34;</span><span class="op" id="7366912">,</span>&nbsp;<span class="ident" id="7366914">rgba64</span><span class="op" id="7366920">.</span><span class="ident" id="7366921">R</span><span class="op" id="7366922">,</span>&nbsp;<span class="ident" id="7366924">rgba64</span><span class="op" id="7366930">.</span><span class="ident" id="7366931">G</span><span class="op" id="7366932">,</span>&nbsp;<span class="ident" id="7366934">rgba64</span><span class="op" id="7366940">.</span><span class="ident" id="7366941">B</span><span class="op" id="7366942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7366947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366951">case</span>&nbsp;<span class="ident" id="7366956">cm</span>&nbsp;<span class="op" id="7366959">==</span>&nbsp;<span class="ident" id="7366962">color</span><span class="op" id="7366967">.</span><span class="ident" id="7366968">NRGBAModel</span><span class="op" id="7366978">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366983">for</span>&nbsp;<span class="ident" id="7366987">x</span>&nbsp;<span class="op" id="7366989">:=</span>&nbsp;<span class="ident" id="7366992">bounds</span><span class="op" id="7366998">.</span><span class="ident" id="7366999">Min</span><span class="op" id="7367002">.</span><span class="ident" id="7367003">X</span><span class="op" id="7367004">;</span>&nbsp;<span class="ident" id="7367006">x</span>&nbsp;<span class="op" id="7367008">&lt;</span>&nbsp;<span class="ident" id="7367010">bounds</span><span class="op" id="7367016">.</span><span class="ident" id="7367017">Max</span><span class="op" id="7367020">.</span><span class="ident" id="7367021">X</span><span class="op" id="7367022">;</span>&nbsp;<span class="ident" id="7367024">x</span><span class="op" id="7367025">++</span>&nbsp;<span class="op" id="7367028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367034">nrgba</span>&nbsp;<span class="op" id="7367040">:=</span>&nbsp;<span class="ident" id="7367043">png</span><span class="op" id="7367046">.</span><span class="ident" id="7367047">At</span><span class="op" id="7367049">(</span><span class="ident" id="7367050">x</span><span class="op" id="7367051">,</span>&nbsp;<span class="ident" id="7367053">y</span><span class="op" id="7367054">)</span><span class="op" id="7367055">.</span><span class="op" id="7367056">(</span><span class="ident" id="7367057">color</span><span class="op" id="7367062">.</span><span class="ident" id="7367063">NRGBA</span><span class="op" id="7367068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367074">fmt</span><span class="op" id="7367077">.</span><span class="ident" id="7367078">Fprintf</span><span class="op" id="7367085">(</span><span class="ident" id="7367086">w</span><span class="op" id="7367087">,</span>&nbsp;<span class="string" id="7367089">&#34;%02x%02x%02x%02x&nbsp;&#34;</span><span class="op" id="7367108">,</span>&nbsp;<span class="ident" id="7367110">nrgba</span><span class="op" id="7367115">.</span><span class="ident" id="7367116">R</span><span class="op" id="7367117">,</span>&nbsp;<span class="ident" id="7367119">nrgba</span><span class="op" id="7367124">.</span><span class="ident" id="7367125">G</span><span class="op" id="7367126">,</span>&nbsp;<span class="ident" id="7367128">nrgba</span><span class="op" id="7367133">.</span><span class="ident" id="7367134">B</span><span class="op" id="7367135">,</span>&nbsp;<span class="ident" id="7367137">nrgba</span><span class="op" id="7367142">.</span><span class="ident" id="7367143">A</span><span class="op" id="7367144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7367149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367153">case</span>&nbsp;<span class="ident" id="7367158">cm</span>&nbsp;<span class="op" id="7367161">==</span>&nbsp;<span class="ident" id="7367164">color</span><span class="op" id="7367169">.</span><span class="ident" id="7367170">NRGBA64Model</span><span class="op" id="7367182">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367187">for</span>&nbsp;<span class="ident" id="7367191">x</span>&nbsp;<span class="op" id="7367193">:=</span>&nbsp;<span class="ident" id="7367196">bounds</span><span class="op" id="7367202">.</span><span class="ident" id="7367203">Min</span><span class="op" id="7367206">.</span><span class="ident" id="7367207">X</span><span class="op" id="7367208">;</span>&nbsp;<span class="ident" id="7367210">x</span>&nbsp;<span class="op" id="7367212">&lt;</span>&nbsp;<span class="ident" id="7367214">bounds</span><span class="op" id="7367220">.</span><span class="ident" id="7367221">Max</span><span class="op" id="7367224">.</span><span class="ident" id="7367225">X</span><span class="op" id="7367226">;</span>&nbsp;<span class="ident" id="7367228">x</span><span class="op" id="7367229">++</span>&nbsp;<span class="op" id="7367232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367238">nrgba64</span>&nbsp;<span class="op" id="7367246">:=</span>&nbsp;<span class="ident" id="7367249">png</span><span class="op" id="7367252">.</span><span class="ident" id="7367253">At</span><span class="op" id="7367255">(</span><span class="ident" id="7367256">x</span><span class="op" id="7367257">,</span>&nbsp;<span class="ident" id="7367259">y</span><span class="op" id="7367260">)</span><span class="op" id="7367261">.</span><span class="op" id="7367262">(</span><span class="ident" id="7367263">color</span><span class="op" id="7367268">.</span><span class="ident" id="7367269">NRGBA64</span><span class="op" id="7367276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367282">fmt</span><span class="op" id="7367285">.</span><span class="ident" id="7367286">Fprintf</span><span class="op" id="7367293">(</span><span class="ident" id="7367294">w</span><span class="op" id="7367295">,</span>&nbsp;<span class="string" id="7367297">&#34;%04x%04x%04x%04x&nbsp;&#34;</span><span class="op" id="7367316">,</span>&nbsp;<span class="ident" id="7367318">nrgba64</span><span class="op" id="7367325">.</span><span class="ident" id="7367326">R</span><span class="op" id="7367327">,</span>&nbsp;<span class="ident" id="7367329">nrgba64</span><span class="op" id="7367336">.</span><span class="ident" id="7367337">G</span><span class="op" id="7367338">,</span>&nbsp;<span class="ident" id="7367340">nrgba64</span><span class="op" id="7367347">.</span><span class="ident" id="7367348">B</span><span class="op" id="7367349">,</span>&nbsp;<span class="ident" id="7367351">nrgba64</span><span class="op" id="7367358">.</span><span class="ident" id="7367359">A</span><span class="op" id="7367360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7367365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367369">case</span>&nbsp;<span class="ident" id="7367374">cpm</span>&nbsp;<span class="op" id="7367378">!=</span>&nbsp;<span class="ident" id="7367381">nil</span><span class="op" id="7367384">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367389">var</span>&nbsp;<span class="ident" id="7367393">b</span><span class="op" id="7367394">,</span>&nbsp;<span class="ident" id="7367396">c</span>&nbsp;<span class="builtintype" id="7367398">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367405">for</span>&nbsp;<span class="ident" id="7367409">x</span>&nbsp;<span class="op" id="7367411">:=</span>&nbsp;<span class="ident" id="7367414">bounds</span><span class="op" id="7367420">.</span><span class="ident" id="7367421">Min</span><span class="op" id="7367424">.</span><span class="ident" id="7367425">X</span><span class="op" id="7367426">;</span>&nbsp;<span class="ident" id="7367428">x</span>&nbsp;<span class="op" id="7367430">&lt;</span>&nbsp;<span class="ident" id="7367432">bounds</span><span class="op" id="7367438">.</span><span class="ident" id="7367439">Max</span><span class="op" id="7367442">.</span><span class="ident" id="7367443">X</span><span class="op" id="7367444">;</span>&nbsp;<span class="ident" id="7367446">x</span><span class="op" id="7367447">++</span>&nbsp;<span class="op" id="7367450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367456">b</span>&nbsp;<span class="op" id="7367458">=</span>&nbsp;<span class="ident" id="7367460">b</span><span class="op" id="7367461">&lt;&lt;</span><span class="builtintype" id="7367463">uint</span><span class="op" id="7367467">(</span><span class="ident" id="7367468">bitdepth</span><span class="op" id="7367476">)</span>&nbsp;<span class="op" id="7367478">|</span>&nbsp;<span class="builtintype" id="7367480">int</span><span class="op" id="7367483">(</span><span class="ident" id="7367484">paletted</span><span class="op" id="7367492">.</span><span class="ident" id="7367493">ColorIndexAt</span><span class="op" id="7367505">(</span><span class="ident" id="7367506">x</span><span class="op" id="7367507">,</span>&nbsp;<span class="ident" id="7367509">y</span><span class="op" id="7367510">)</span><span class="op" id="7367511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367517">c</span><span class="op" id="7367518">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367525">if</span>&nbsp;<span class="ident" id="7367528">c</span>&nbsp;<span class="op" id="7367530">==</span>&nbsp;<span class="num" id="7367533">8</span><span class="op" id="7367534">/</span><span class="ident" id="7367535">bitdepth</span>&nbsp;<span class="op" id="7367544">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367551">fmt</span><span class="op" id="7367554">.</span><span class="ident" id="7367555">Fprintf</span><span class="op" id="7367562">(</span><span class="ident" id="7367563">w</span><span class="op" id="7367564">,</span>&nbsp;<span class="string" id="7367566">&#34;%02x&#34;</span><span class="op" id="7367572">,</span>&nbsp;<span class="ident" id="7367574">b</span><span class="op" id="7367575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367582">b</span>&nbsp;<span class="op" id="7367584">=</span>&nbsp;<span class="num" id="7367586">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367593">c</span>&nbsp;<span class="op" id="7367595">=</span>&nbsp;<span class="num" id="7367597">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7367603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7367608">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367613">if</span>&nbsp;<span class="ident" id="7367616">c</span>&nbsp;<span class="op" id="7367618">!=</span>&nbsp;<span class="num" id="7367621">0</span>&nbsp;<span class="op" id="7367623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367629">for</span>&nbsp;<span class="ident" id="7367633">c</span>&nbsp;<span class="op" id="7367635">!=</span>&nbsp;<span class="num" id="7367638">8</span><span class="op" id="7367639">/</span><span class="ident" id="7367640">bitdepth</span>&nbsp;<span class="op" id="7367649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367656">b</span>&nbsp;<span class="op" id="7367658">=</span>&nbsp;<span class="ident" id="7367660">b</span>&nbsp;<span class="op" id="7367662">&lt;&lt;</span>&nbsp;<span class="builtintype" id="7367665">uint</span><span class="op" id="7367669">(</span><span class="ident" id="7367670">bitdepth</span><span class="op" id="7367678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367685">c</span><span class="op" id="7367686">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7367693">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367699">fmt</span><span class="op" id="7367702">.</span><span class="ident" id="7367703">Fprintf</span><span class="op" id="7367710">(</span><span class="ident" id="7367711">w</span><span class="op" id="7367712">,</span>&nbsp;<span class="string" id="7367714">&#34;%02x&#34;</span><span class="op" id="7367720">,</span>&nbsp;<span class="ident" id="7367722">b</span><span class="op" id="7367723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7367728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7367732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367736">io</span><span class="op" id="7367738">.</span><span class="ident" id="7367739">WriteString</span><span class="op" id="7367750">(</span><span class="ident" id="7367751">w</span><span class="op" id="7367752">,</span>&nbsp;<span class="string" id="7367754">&#34;\n&#34;</span><span class="op" id="7367758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7367761">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367764">io</span><span class="op" id="7367766">.</span><span class="ident" id="7367767">WriteString</span><span class="op" id="7367778">(</span><span class="ident" id="7367779">w</span><span class="op" id="7367780">,</span>&nbsp;<span class="string" id="7367782">&#34;}\n&#34;</span><span class="op" id="7367787">)</span><br>
<span class="lineno"></span><span class="op" id="7367789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7367792">func</span>&nbsp;<span class="ident" id="7367797">TestReader</span><span class="op" id="7367807">(</span><span class="ident" id="7367808">t</span>&nbsp;<span class="op" id="7367810">*</span><span class="ident" id="7367811">testing</span><span class="op" id="7367818">.</span><span class="ident" id="7367819">T</span><span class="op" id="7367820">)</span>&nbsp;<span class="op" id="7367822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367825">names</span>&nbsp;<span class="op" id="7367831">:=</span>&nbsp;<span class="ident" id="7367834">filenames</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367845">if</span>&nbsp;<span class="ident" id="7367848">testing</span><span class="op" id="7367855">.</span><span class="ident" id="7367856">Short</span><span class="op" id="7367861">(</span><span class="op" id="7367862">)</span>&nbsp;<span class="op" id="7367864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367868">names</span>&nbsp;<span class="op" id="7367874">=</span>&nbsp;<span class="ident" id="7367876">filenamesShort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7367892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367895">for</span>&nbsp;<span class="ident" id="7367899">_</span><span class="op" id="7367900">,</span>&nbsp;<span class="ident" id="7367902">fn</span>&nbsp;<span class="op" id="7367905">:=</span>&nbsp;<span class="keyword" id="7367908">range</span>&nbsp;<span class="ident" id="7367914">names</span>&nbsp;<span class="op" id="7367920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7367924">//&nbsp;Read&nbsp;the&nbsp;.png&nbsp;file.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367949">img</span><span class="op" id="7367952">,</span>&nbsp;<span class="ident" id="7367954">err</span>&nbsp;<span class="op" id="7367958">:=</span>&nbsp;<span class="ident" id="7367961">readPNG</span><span class="op" id="7367968">(</span><span class="string" id="7367969">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="7367990">+</span>&nbsp;<span class="ident" id="7367992">fn</span>&nbsp;<span class="op" id="7367995">+</span>&nbsp;<span class="string" id="7367997">&#34;.png&#34;</span><span class="op" id="7368003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368007">if</span>&nbsp;<span class="ident" id="7368010">err</span>&nbsp;<span class="op" id="7368014">!=</span>&nbsp;<span class="ident" id="7368017">nil</span>&nbsp;<span class="op" id="7368021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7368026">t</span><span class="op" id="7368027">.</span><span class="ident" id="7368028">Error</span><span class="op" id="7368033">(</span><span class="ident" id="7368034">fn</span><span class="op" id="7368036">,</span>&nbsp;<span class="ident" id="7368038">err</span><span class="op" id="7368041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368046">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7368057">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368062">if</span>&nbsp;<span class="ident" id="7368065">fn</span>&nbsp;<span class="op" id="7368068">==</span>&nbsp;<span class="string" id="7368071">&#34;basn4a16&#34;</span>&nbsp;<span class="op" id="7368082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7368087">//&nbsp;basn4a16.sng&nbsp;is&nbsp;gray&nbsp;+&nbsp;alpha&nbsp;but&nbsp;sng()&nbsp;will&nbsp;produce&nbsp;true&nbsp;color&nbsp;+&nbsp;alpha</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7368164">//&nbsp;so&nbsp;we&nbsp;just&nbsp;check&nbsp;a&nbsp;single&nbsp;random&nbsp;pixel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7368210">c</span>&nbsp;<span class="op" id="7368212">:=</span>&nbsp;<span class="ident" id="7368215">img</span><span class="op" id="7368218">.</span><span class="ident" id="7368219">At</span><span class="op" id="7368221">(</span><span class="num" id="7368222">2</span><span class="op" id="7368223">,</span>&nbsp;<span class="num" id="7368225">1</span><span class="op" id="7368226">)</span><span class="op" id="7368227">.</span><span class="op" id="7368228">(</span><span class="ident" id="7368229">color</span><span class="op" id="7368234">.</span><span class="ident" id="7368235">NRGBA64</span><span class="op" id="7368242">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368247">if</span>&nbsp;<span class="ident" id="7368250">c</span><span class="op" id="7368251">.</span><span class="ident" id="7368252">R</span>&nbsp;<span class="op" id="7368254">!=</span>&nbsp;<span class="num" id="7368257">0x11a7</span>&nbsp;<span class="op" id="7368264">||</span>&nbsp;<span class="ident" id="7368267">c</span><span class="op" id="7368268">.</span><span class="ident" id="7368269">G</span>&nbsp;<span class="op" id="7368271">!=</span>&nbsp;<span class="num" id="7368274">0x11a7</span>&nbsp;<span class="op" id="7368281">||</span>&nbsp;<span class="ident" id="7368284">c</span><span class="op" id="7368285">.</span><span class="ident" id="7368286">B</span>&nbsp;<span class="op" id="7368288">!=</span>&nbsp;<span class="num" id="7368291">0x11a7</span>&nbsp;<span class="op" id="7368298">||</span>&nbsp;<span class="ident" id="7368301">c</span><span class="op" id="7368302">.</span><span class="ident" id="7368303">A</span>&nbsp;<span class="op" id="7368305">!=</span>&nbsp;<span class="num" id="7368308">0x1085</span>&nbsp;<span class="op" id="7368315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7368321">t</span><span class="op" id="7368322">.</span><span class="ident" id="7368323">Error</span><span class="op" id="7368328">(</span><span class="ident" id="7368329">fn</span><span class="op" id="7368331">,</span>&nbsp;<span class="ident" id="7368333">fmt</span><span class="op" id="7368336">.</span><span class="ident" id="7368337">Errorf</span><span class="op" id="7368343">(</span><span class="string" id="7368344">&#34;wrong&nbsp;pixel&nbsp;value&nbsp;at&nbsp;(2,&nbsp;1):&nbsp;%x&#34;</span><span class="op" id="7368377">,</span>&nbsp;<span class="ident" id="7368379">c</span><span class="op" id="7368380">)</span><span class="op" id="7368381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7368386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368391">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7368402">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7368407">piper</span><span class="op" id="7368412">,</span>&nbsp;<span class="ident" id="7368414">pipew</span>&nbsp;<span class="op" id="7368420">:=</span>&nbsp;<span class="ident" id="7368423">io</span><span class="op" id="7368425">.</span><span class="ident" id="7368426">Pipe</span><span class="op" id="7368430">(</span><span class="op" id="7368431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7368435">pb</span>&nbsp;<span class="op" id="7368438">:=</span>&nbsp;<span class="ident" id="7368441">bufio</span><span class="op" id="7368446">.</span><span class="ident" id="7368447">NewScanner</span><span class="op" id="7368457">(</span><span class="ident" id="7368458">piper</span><span class="op" id="7368463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368467">go</span>&nbsp;<span class="ident" id="7368470">sng</span><span class="op" id="7368473">(</span><span class="ident" id="7368474">pipew</span><span class="op" id="7368479">,</span>&nbsp;<span class="ident" id="7368481">fn</span><span class="op" id="7368483">,</span>&nbsp;<span class="ident" id="7368485">img</span><span class="op" id="7368488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368492">defer</span>&nbsp;<span class="ident" id="7368498">piper</span><span class="op" id="7368503">.</span><span class="ident" id="7368504">Close</span><span class="op" id="7368509">(</span><span class="op" id="7368510">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7368515">//&nbsp;Read&nbsp;the&nbsp;.sng&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7368540">sf</span><span class="op" id="7368542">,</span>&nbsp;<span class="ident" id="7368544">err</span>&nbsp;<span class="op" id="7368548">:=</span>&nbsp;<span class="ident" id="7368551">os</span><span class="op" id="7368553">.</span><span class="ident" id="7368554">Open</span><span class="op" id="7368558">(</span><span class="string" id="7368559">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="7368580">+</span>&nbsp;<span class="ident" id="7368582">fn</span>&nbsp;<span class="op" id="7368585">+</span>&nbsp;<span class="string" id="7368587">&#34;.sng&#34;</span><span class="op" id="7368593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368597">if</span>&nbsp;<span class="ident" id="7368600">err</span>&nbsp;<span class="op" id="7368604">!=</span>&nbsp;<span class="ident" id="7368607">nil</span>&nbsp;<span class="op" id="7368611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7368616">t</span><span class="op" id="7368617">.</span><span class="ident" id="7368618">Error</span><span class="op" id="7368623">(</span><span class="ident" id="7368624">fn</span><span class="op" id="7368626">,</span>&nbsp;<span class="ident" id="7368628">err</span><span class="op" id="7368631">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368636">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7368647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368651">defer</span>&nbsp;<span class="ident" id="7368657">sf</span><span class="op" id="7368659">.</span><span class="ident" id="7368660">Close</span><span class="op" id="7368665">(</span><span class="op" id="7368666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7368670">sb</span>&nbsp;<span class="op" id="7368673">:=</span>&nbsp;<span class="ident" id="7368676">bufio</span><span class="op" id="7368681">.</span><span class="ident" id="7368682">NewScanner</span><span class="op" id="7368692">(</span><span class="ident" id="7368693">sf</span><span class="op" id="7368695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368699">if</span>&nbsp;<span class="ident" id="7368702">err</span>&nbsp;<span class="op" id="7368706">!=</span>&nbsp;<span class="ident" id="7368709">nil</span>&nbsp;<span class="op" id="7368713">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7368718">t</span><span class="op" id="7368719">.</span><span class="ident" id="7368720">Error</span><span class="op" id="7368725">(</span><span class="ident" id="7368726">fn</span><span class="op" id="7368728">,</span>&nbsp;<span class="ident" id="7368730">err</span><span class="op" id="7368733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368738">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7368749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7368754">//&nbsp;Compare&nbsp;the&nbsp;two,&nbsp;in&nbsp;SNG&nbsp;format,&nbsp;line&nbsp;by&nbsp;line.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368805">for</span>&nbsp;<span class="op" id="7368809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7368814">pdone</span>&nbsp;<span class="op" id="7368820">:=</span>&nbsp;<span class="op" id="7368823">!</span><span class="ident" id="7368824">pb</span><span class="op" id="7368826">.</span><span class="ident" id="7368827">Scan</span><span class="op" id="7368831">(</span><span class="op" id="7368832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7368837">sdone</span>&nbsp;<span class="op" id="7368843">:=</span>&nbsp;<span class="op" id="7368846">!</span><span class="ident" id="7368847">sb</span><span class="op" id="7368849">.</span><span class="ident" id="7368850">Scan</span><span class="op" id="7368854">(</span><span class="op" id="7368855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368860">if</span>&nbsp;<span class="ident" id="7368863">pdone</span>&nbsp;<span class="op" id="7368869">&amp;&amp;</span>&nbsp;<span class="ident" id="7368872">sdone</span>&nbsp;<span class="op" id="7368878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368884">break</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7368893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368898">if</span>&nbsp;<span class="ident" id="7368901">pdone</span>&nbsp;<span class="op" id="7368907">||</span>&nbsp;<span class="ident" id="7368910">sdone</span>&nbsp;<span class="op" id="7368916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7368922">t</span><span class="op" id="7368923">.</span><span class="ident" id="7368924">Errorf</span><span class="op" id="7368930">(</span><span class="string" id="7368931">&#34;%s:&nbsp;Different&nbsp;sizes&#34;</span><span class="op" id="7368952">,</span>&nbsp;<span class="ident" id="7368954">fn</span><span class="op" id="7368956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368962">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7368971">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7368976">ps</span>&nbsp;<span class="op" id="7368979">:=</span>&nbsp;<span class="ident" id="7368982">pb</span><span class="op" id="7368984">.</span><span class="ident" id="7368985">Text</span><span class="op" id="7368989">(</span><span class="op" id="7368990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7368995">ss</span>&nbsp;<span class="op" id="7368998">:=</span>&nbsp;<span class="ident" id="7369001">sb</span><span class="op" id="7369003">.</span><span class="ident" id="7369004">Text</span><span class="op" id="7369008">(</span><span class="op" id="7369009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369014">if</span>&nbsp;<span class="ident" id="7369017">ps</span>&nbsp;<span class="op" id="7369020">!=</span>&nbsp;<span class="ident" id="7369023">ss</span>&nbsp;<span class="op" id="7369026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369032">t</span><span class="op" id="7369033">.</span><span class="ident" id="7369034">Errorf</span><span class="op" id="7369040">(</span><span class="string" id="7369041">&#34;%s:&nbsp;Mismatch\n%sversus\n%s\n&#34;</span><span class="op" id="7369071">,</span>&nbsp;<span class="ident" id="7369073">fn</span><span class="op" id="7369075">,</span>&nbsp;<span class="ident" id="7369077">ps</span><span class="op" id="7369079">,</span>&nbsp;<span class="ident" id="7369081">ss</span><span class="op" id="7369083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369089">break</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369106">if</span>&nbsp;<span class="ident" id="7369109">pb</span><span class="op" id="7369111">.</span><span class="ident" id="7369112">Err</span><span class="op" id="7369115">(</span><span class="op" id="7369116">)</span>&nbsp;<span class="op" id="7369118">!=</span>&nbsp;<span class="ident" id="7369121">nil</span>&nbsp;<span class="op" id="7369125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369130">t</span><span class="op" id="7369131">.</span><span class="ident" id="7369132">Error</span><span class="op" id="7369137">(</span><span class="ident" id="7369138">fn</span><span class="op" id="7369140">,</span>&nbsp;<span class="ident" id="7369142">pb</span><span class="op" id="7369144">.</span><span class="ident" id="7369145">Err</span><span class="op" id="7369148">(</span><span class="op" id="7369149">)</span><span class="op" id="7369150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369154">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369158">if</span>&nbsp;<span class="ident" id="7369161">sb</span><span class="op" id="7369163">.</span><span class="ident" id="7369164">Err</span><span class="op" id="7369167">(</span><span class="op" id="7369168">)</span>&nbsp;<span class="op" id="7369170">!=</span>&nbsp;<span class="ident" id="7369173">nil</span>&nbsp;<span class="op" id="7369177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369182">t</span><span class="op" id="7369183">.</span><span class="ident" id="7369184">Error</span><span class="op" id="7369189">(</span><span class="ident" id="7369190">fn</span><span class="op" id="7369192">,</span>&nbsp;<span class="ident" id="7369194">sb</span><span class="op" id="7369196">.</span><span class="ident" id="7369197">Err</span><span class="op" id="7369200">(</span><span class="op" id="7369201">)</span><span class="op" id="7369202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369209">}</span><br>
<span class="lineno"></span><span class="op" id="7369211">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="7369214">var</span>&nbsp;<span class="ident" id="7369218">readerErrors</span>&nbsp;<span class="op" id="7369231">=</span>&nbsp;<span class="op" id="7369233">[</span><span class="op" id="7369234">]</span><span class="keyword" id="7369235">struct</span>&nbsp;<span class="op" id="7369242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369245">file</span>&nbsp;<span class="builtintype" id="7369250">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369258">err</span>&nbsp;&nbsp;<span class="builtintype" id="7369263">string</span><br>
<span class="lineno"></span><span class="op" id="7369270">}</span><span class="op" id="7369271">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369274">{</span><span class="string" id="7369275">&#34;invalid-zlib.png&#34;</span><span class="op" id="7369293">,</span>&nbsp;<span class="string" id="7369295">&#34;zlib:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="7369319">}</span><span class="op" id="7369320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369323">{</span><span class="string" id="7369324">&#34;invalid-crc32.png&#34;</span><span class="op" id="7369343">,</span>&nbsp;<span class="string" id="7369345">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="7369363">}</span><span class="op" id="7369364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369367">{</span><span class="string" id="7369368">&#34;invalid-noend.png&#34;</span><span class="op" id="7369387">,</span>&nbsp;<span class="string" id="7369389">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="7369405">}</span><span class="op" id="7369406">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369409">{</span><span class="string" id="7369410">&#34;invalid-trunc.png&#34;</span><span class="op" id="7369429">,</span>&nbsp;<span class="string" id="7369431">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="7369447">}</span><span class="op" id="7369448">,</span><br>
<span class="lineno"></span><span class="op" id="7369450">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="7369453">func</span>&nbsp;<span class="ident" id="7369458">TestReaderError</span><span class="op" id="7369473">(</span><span class="ident" id="7369474">t</span>&nbsp;<span class="op" id="7369476">*</span><span class="ident" id="7369477">testing</span><span class="op" id="7369484">.</span><span class="ident" id="7369485">T</span><span class="op" id="7369486">)</span>&nbsp;<span class="op" id="7369488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369491">for</span>&nbsp;<span class="ident" id="7369495">_</span><span class="op" id="7369496">,</span>&nbsp;<span class="ident" id="7369498">tt</span>&nbsp;<span class="op" id="7369501">:=</span>&nbsp;<span class="keyword" id="7369504">range</span>&nbsp;<span class="ident" id="7369510">readerErrors</span>&nbsp;<span class="op" id="7369523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369527">img</span><span class="op" id="7369530">,</span>&nbsp;<span class="ident" id="7369532">err</span>&nbsp;<span class="op" id="7369536">:=</span>&nbsp;<span class="ident" id="7369539">readPNG</span><span class="op" id="7369546">(</span><span class="string" id="7369547">&#34;testdata/&#34;</span>&nbsp;<span class="op" id="7369559">+</span>&nbsp;<span class="ident" id="7369561">tt</span><span class="op" id="7369563">.</span><span class="ident" id="7369564">file</span><span class="op" id="7369568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369572">if</span>&nbsp;<span class="ident" id="7369575">err</span>&nbsp;<span class="op" id="7369579">==</span>&nbsp;<span class="ident" id="7369582">nil</span>&nbsp;<span class="op" id="7369586">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369591">t</span><span class="op" id="7369592">.</span><span class="ident" id="7369593">Errorf</span><span class="op" id="7369599">(</span><span class="string" id="7369600">&#34;decoding&nbsp;%s:&nbsp;missing&nbsp;error&#34;</span><span class="op" id="7369628">,</span>&nbsp;<span class="ident" id="7369630">tt</span><span class="op" id="7369632">.</span><span class="ident" id="7369633">file</span><span class="op" id="7369637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369642">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369657">if</span>&nbsp;<span class="op" id="7369660">!</span><span class="ident" id="7369661">strings</span><span class="op" id="7369668">.</span><span class="ident" id="7369669">Contains</span><span class="op" id="7369677">(</span><span class="ident" id="7369678">err</span><span class="op" id="7369681">.</span><span class="ident" id="7369682">Error</span><span class="op" id="7369687">(</span><span class="op" id="7369688">)</span><span class="op" id="7369689">,</span>&nbsp;<span class="ident" id="7369691">tt</span><span class="op" id="7369693">.</span><span class="ident" id="7369694">err</span><span class="op" id="7369697">)</span>&nbsp;<span class="op" id="7369699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369704">t</span><span class="op" id="7369705">.</span><span class="ident" id="7369706">Errorf</span><span class="op" id="7369712">(</span><span class="string" id="7369713">&#34;decoding&nbsp;%s:&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7369739">,</span>&nbsp;<span class="ident" id="7369741">tt</span><span class="op" id="7369743">.</span><span class="ident" id="7369744">file</span><span class="op" id="7369748">,</span>&nbsp;<span class="ident" id="7369750">err</span><span class="op" id="7369753">,</span>&nbsp;<span class="ident" id="7369755">tt</span><span class="op" id="7369757">.</span><span class="ident" id="7369758">err</span><span class="op" id="7369761">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369769">if</span>&nbsp;<span class="ident" id="7369772">img</span>&nbsp;<span class="op" id="7369776">!=</span>&nbsp;<span class="ident" id="7369779">nil</span>&nbsp;<span class="op" id="7369783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369788">t</span><span class="op" id="7369789">.</span><span class="ident" id="7369790">Errorf</span><span class="op" id="7369796">(</span><span class="string" id="7369797">&#34;decoding&nbsp;%s:&nbsp;have&nbsp;image&nbsp;+&nbsp;error&#34;</span><span class="op" id="7369830">,</span>&nbsp;<span class="ident" id="7369832">tt</span><span class="op" id="7369834">.</span><span class="ident" id="7369835">file</span><span class="op" id="7369839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7369846">}</span><br>
<span class="lineno">295</span><span class="op" id="7369848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7369851">func</span>&nbsp;<span class="ident" id="7369856">TestPalettedDecodeConfig</span><span class="op" id="7369880">(</span><span class="ident" id="7369881">t</span>&nbsp;<span class="op" id="7369883">*</span><span class="ident" id="7369884">testing</span><span class="op" id="7369891">.</span><span class="ident" id="7369892">T</span><span class="op" id="7369893">)</span>&nbsp;<span class="op" id="7369895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369898">for</span>&nbsp;<span class="ident" id="7369902">_</span><span class="op" id="7369903">,</span>&nbsp;<span class="ident" id="7369905">fn</span>&nbsp;<span class="op" id="7369908">:=</span>&nbsp;<span class="keyword" id="7369911">range</span>&nbsp;<span class="ident" id="7369917">filenamesPaletted</span>&nbsp;<span class="op" id="7369935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7369939">f</span><span class="op" id="7369940">,</span>&nbsp;<span class="ident" id="7369942">err</span>&nbsp;<span class="op" id="7369946">:=</span>&nbsp;<span class="ident" id="7369949">os</span><span class="op" id="7369951">.</span><span class="ident" id="7369952">Open</span><span class="op" id="7369956">(</span><span class="string" id="7369957">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="7369978">+</span>&nbsp;<span class="ident" id="7369980">fn</span>&nbsp;<span class="op" id="7369983">+</span>&nbsp;<span class="string" id="7369985">&#34;.png&#34;</span><span class="op" id="7369991">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7369995">if</span>&nbsp;<span class="ident" id="7369998">err</span>&nbsp;<span class="op" id="7370002">!=</span>&nbsp;<span class="ident" id="7370005">nil</span>&nbsp;<span class="op" id="7370009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370014">t</span><span class="op" id="7370015">.</span><span class="ident" id="7370016">Errorf</span><span class="op" id="7370022">(</span><span class="string" id="7370023">&#34;%s:&nbsp;open&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7370044">,</span>&nbsp;<span class="ident" id="7370046">fn</span><span class="op" id="7370048">,</span>&nbsp;<span class="ident" id="7370050">err</span><span class="op" id="7370053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370058">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370073">defer</span>&nbsp;<span class="ident" id="7370079">f</span><span class="op" id="7370080">.</span><span class="ident" id="7370081">Close</span><span class="op" id="7370086">(</span><span class="op" id="7370087">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370091">cfg</span><span class="op" id="7370094">,</span>&nbsp;<span class="ident" id="7370096">err</span>&nbsp;<span class="op" id="7370100">:=</span>&nbsp;<span class="ident" id="7370103">DecodeConfig</span><span class="op" id="7370115">(</span><span class="ident" id="7370116">f</span><span class="op" id="7370117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370121">if</span>&nbsp;<span class="ident" id="7370124">err</span>&nbsp;<span class="op" id="7370128">!=</span>&nbsp;<span class="ident" id="7370131">nil</span>&nbsp;<span class="op" id="7370135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370140">t</span><span class="op" id="7370141">.</span><span class="ident" id="7370142">Errorf</span><span class="op" id="7370148">(</span><span class="string" id="7370149">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7370157">,</span>&nbsp;<span class="ident" id="7370159">fn</span><span class="op" id="7370161">,</span>&nbsp;<span class="ident" id="7370163">err</span><span class="op" id="7370166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370171">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370182">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370186">pal</span><span class="op" id="7370189">,</span>&nbsp;<span class="ident" id="7370191">ok</span>&nbsp;<span class="op" id="7370194">:=</span>&nbsp;<span class="ident" id="7370197">cfg</span><span class="op" id="7370200">.</span><span class="ident" id="7370201">ColorModel</span><span class="op" id="7370211">.</span><span class="op" id="7370212">(</span><span class="ident" id="7370213">color</span><span class="op" id="7370218">.</span><span class="ident" id="7370219">Palette</span><span class="op" id="7370226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370230">if</span>&nbsp;<span class="op" id="7370233">!</span><span class="ident" id="7370234">ok</span>&nbsp;<span class="op" id="7370237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370242">t</span><span class="op" id="7370243">.</span><span class="ident" id="7370244">Errorf</span><span class="op" id="7370250">(</span><span class="string" id="7370251">&#34;%s:&nbsp;expected&nbsp;paletted&nbsp;color&nbsp;model&#34;</span><span class="op" id="7370286">,</span>&nbsp;<span class="ident" id="7370288">fn</span><span class="op" id="7370290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370295">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370306">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370310">if</span>&nbsp;<span class="ident" id="7370313">pal</span>&nbsp;<span class="op" id="7370317">==</span>&nbsp;<span class="ident" id="7370320">nil</span>&nbsp;<span class="op" id="7370324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370329">t</span><span class="op" id="7370330">.</span><span class="ident" id="7370331">Errorf</span><span class="op" id="7370337">(</span><span class="string" id="7370338">&#34;%s:&nbsp;palette&nbsp;not&nbsp;initialized&#34;</span><span class="op" id="7370367">,</span>&nbsp;<span class="ident" id="7370369">fn</span><span class="op" id="7370371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370376">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370390">}</span><br>
<span class="lineno">320</span><span class="op" id="7370392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7370395">func</span>&nbsp;<span class="ident" id="7370400">benchmarkDecode</span><span class="op" id="7370415">(</span><span class="ident" id="7370416">b</span>&nbsp;<span class="op" id="7370418">*</span><span class="ident" id="7370419">testing</span><span class="op" id="7370426">.</span><span class="ident" id="7370427">B</span><span class="op" id="7370428">,</span>&nbsp;<span class="ident" id="7370430">filename</span>&nbsp;<span class="builtintype" id="7370439">string</span><span class="op" id="7370445">,</span>&nbsp;<span class="ident" id="7370447">bytesPerPixel</span>&nbsp;<span class="builtintype" id="7370461">int</span><span class="op" id="7370464">)</span>&nbsp;<span class="op" id="7370466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370469">b</span><span class="op" id="7370470">.</span><span class="ident" id="7370471">StopTimer</span><span class="op" id="7370480">(</span><span class="op" id="7370481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370484">data</span><span class="op" id="7370488">,</span>&nbsp;<span class="ident" id="7370490">err</span>&nbsp;<span class="op" id="7370494">:=</span>&nbsp;<span class="ident" id="7370497">ioutil</span><span class="op" id="7370503">.</span><span class="ident" id="7370504">ReadFile</span><span class="op" id="7370512">(</span><span class="ident" id="7370513">filename</span><span class="op" id="7370521">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370524">if</span>&nbsp;<span class="ident" id="7370527">err</span>&nbsp;<span class="op" id="7370531">!=</span>&nbsp;<span class="ident" id="7370534">nil</span>&nbsp;<span class="op" id="7370538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370542">b</span><span class="op" id="7370543">.</span><span class="ident" id="7370544">Fatal</span><span class="op" id="7370549">(</span><span class="ident" id="7370550">err</span><span class="op" id="7370553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370559">s</span>&nbsp;<span class="op" id="7370561">:=</span>&nbsp;<span class="builtintype" id="7370564">string</span><span class="op" id="7370570">(</span><span class="ident" id="7370571">data</span><span class="op" id="7370575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370578">cfg</span><span class="op" id="7370581">,</span>&nbsp;<span class="ident" id="7370583">err</span>&nbsp;<span class="op" id="7370587">:=</span>&nbsp;<span class="ident" id="7370590">DecodeConfig</span><span class="op" id="7370602">(</span><span class="ident" id="7370603">strings</span><span class="op" id="7370610">.</span><span class="ident" id="7370611">NewReader</span><span class="op" id="7370620">(</span><span class="ident" id="7370621">s</span><span class="op" id="7370622">)</span><span class="op" id="7370623">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370626">if</span>&nbsp;<span class="ident" id="7370629">err</span>&nbsp;<span class="op" id="7370633">!=</span>&nbsp;<span class="ident" id="7370636">nil</span>&nbsp;<span class="op" id="7370640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370644">b</span><span class="op" id="7370645">.</span><span class="ident" id="7370646">Fatal</span><span class="op" id="7370651">(</span><span class="ident" id="7370652">err</span><span class="op" id="7370655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370661">b</span><span class="op" id="7370662">.</span><span class="ident" id="7370663">SetBytes</span><span class="op" id="7370671">(</span><span class="ident" id="7370672">int64</span><span class="op" id="7370677">(</span><span class="ident" id="7370678">cfg</span><span class="op" id="7370681">.</span><span class="ident" id="7370682">Width</span>&nbsp;<span class="op" id="7370688">*</span>&nbsp;<span class="ident" id="7370690">cfg</span><span class="op" id="7370693">.</span><span class="ident" id="7370694">Height</span>&nbsp;<span class="op" id="7370701">*</span>&nbsp;<span class="ident" id="7370703">bytesPerPixel</span><span class="op" id="7370716">)</span><span class="op" id="7370717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370720">b</span><span class="op" id="7370721">.</span><span class="ident" id="7370722">StartTimer</span><span class="op" id="7370732">(</span><span class="op" id="7370733">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370736">for</span>&nbsp;<span class="ident" id="7370740">i</span>&nbsp;<span class="op" id="7370742">:=</span>&nbsp;<span class="num" id="7370745">0</span><span class="op" id="7370746">;</span>&nbsp;<span class="ident" id="7370748">i</span>&nbsp;<span class="op" id="7370750">&lt;</span>&nbsp;<span class="ident" id="7370752">b</span><span class="op" id="7370753">.</span><span class="ident" id="7370754">N</span><span class="op" id="7370755">;</span>&nbsp;<span class="ident" id="7370757">i</span><span class="op" id="7370758">++</span>&nbsp;<span class="op" id="7370761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370765">Decode</span><span class="op" id="7370771">(</span><span class="ident" id="7370772">strings</span><span class="op" id="7370779">.</span><span class="ident" id="7370780">NewReader</span><span class="op" id="7370789">(</span><span class="ident" id="7370790">s</span><span class="op" id="7370791">)</span><span class="op" id="7370792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370795">}</span><br>
<span class="lineno"></span><span class="op" id="7370797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="7370800">func</span>&nbsp;<span class="ident" id="7370805">BenchmarkDecodeGray</span><span class="op" id="7370824">(</span><span class="ident" id="7370825">b</span>&nbsp;<span class="op" id="7370827">*</span><span class="ident" id="7370828">testing</span><span class="op" id="7370835">.</span><span class="ident" id="7370836">B</span><span class="op" id="7370837">)</span>&nbsp;<span class="op" id="7370839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370842">benchmarkDecode</span><span class="op" id="7370857">(</span><span class="ident" id="7370858">b</span><span class="op" id="7370859">,</span>&nbsp;<span class="string" id="7370861">&#34;testdata/benchGray.png&#34;</span><span class="op" id="7370885">,</span>&nbsp;<span class="num" id="7370887">1</span><span class="op" id="7370888">)</span><br>
<span class="lineno"></span><span class="op" id="7370890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7370893">func</span>&nbsp;<span class="ident" id="7370898">BenchmarkDecodeNRGBAGradient</span><span class="op" id="7370926">(</span><span class="ident" id="7370927">b</span>&nbsp;<span class="op" id="7370929">*</span><span class="ident" id="7370930">testing</span><span class="op" id="7370937">.</span><span class="ident" id="7370938">B</span><span class="op" id="7370939">)</span>&nbsp;<span class="op" id="7370941">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370944">benchmarkDecode</span><span class="op" id="7370959">(</span><span class="ident" id="7370960">b</span><span class="op" id="7370961">,</span>&nbsp;<span class="string" id="7370963">&#34;testdata/benchNRGBA-gradient.png&#34;</span><span class="op" id="7370997">,</span>&nbsp;<span class="num" id="7370999">4</span><span class="op" id="7371000">)</span><br>
<span class="lineno"></span><span class="op" id="7371002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7371005">func</span>&nbsp;<span class="ident" id="7371010">BenchmarkDecodeNRGBAOpaque</span><span class="op" id="7371036">(</span><span class="ident" id="7371037">b</span>&nbsp;<span class="op" id="7371039">*</span><span class="ident" id="7371040">testing</span><span class="op" id="7371047">.</span><span class="ident" id="7371048">B</span><span class="op" id="7371049">)</span>&nbsp;<span class="op" id="7371051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371054">benchmarkDecode</span><span class="op" id="7371069">(</span><span class="ident" id="7371070">b</span><span class="op" id="7371071">,</span>&nbsp;<span class="string" id="7371073">&#34;testdata/benchNRGBA-opaque.png&#34;</span><span class="op" id="7371105">,</span>&nbsp;<span class="num" id="7371107">4</span><span class="op" id="7371108">)</span><br>
<span class="lineno">350</span><span class="op" id="7371110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7371113">func</span>&nbsp;<span class="ident" id="7371118">BenchmarkDecodePaletted</span><span class="op" id="7371141">(</span><span class="ident" id="7371142">b</span>&nbsp;<span class="op" id="7371144">*</span><span class="ident" id="7371145">testing</span><span class="op" id="7371152">.</span><span class="ident" id="7371153">B</span><span class="op" id="7371154">)</span>&nbsp;<span class="op" id="7371156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371159">benchmarkDecode</span><span class="op" id="7371174">(</span><span class="ident" id="7371175">b</span><span class="op" id="7371176">,</span>&nbsp;<span class="string" id="7371178">&#34;testdata/benchPaletted.png&#34;</span><span class="op" id="7371206">,</span>&nbsp;<span class="num" id="7371208">1</span><span class="op" id="7371209">)</span><br>
<span class="lineno"></span><span class="op" id="7371211">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="7371214">func</span>&nbsp;<span class="ident" id="7371219">BenchmarkDecodeRGB</span><span class="op" id="7371237">(</span><span class="ident" id="7371238">b</span>&nbsp;<span class="op" id="7371240">*</span><span class="ident" id="7371241">testing</span><span class="op" id="7371248">.</span><span class="ident" id="7371249">B</span><span class="op" id="7371250">)</span>&nbsp;<span class="op" id="7371252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371255">benchmarkDecode</span><span class="op" id="7371270">(</span><span class="ident" id="7371271">b</span><span class="op" id="7371272">,</span>&nbsp;<span class="string" id="7371274">&#34;testdata/benchRGB.png&#34;</span><span class="op" id="7371297">,</span>&nbsp;<span class="num" id="7371299">4</span><span class="op" id="7371300">)</span><br>
<span class="lineno"></span><span class="op" id="7371302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="keyword" id="7371305">func</span>&nbsp;<span class="ident" id="7371310">BenchmarkDecodeInterlacing</span><span class="op" id="7371336">(</span><span class="ident" id="7371337">b</span>&nbsp;<span class="op" id="7371339">*</span><span class="ident" id="7371340">testing</span><span class="op" id="7371347">.</span><span class="ident" id="7371348">B</span><span class="op" id="7371349">)</span>&nbsp;<span class="op" id="7371351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371354">benchmarkDecode</span><span class="op" id="7371369">(</span><span class="ident" id="7371370">b</span><span class="op" id="7371371">,</span>&nbsp;<span class="string" id="7371373">&#34;testdata/benchRGB-interlace.png&#34;</span><span class="op" id="7371406">,</span>&nbsp;<span class="num" id="7371408">4</span><span class="op" id="7371409">)</span><br>
<span class="lineno"></span><span class="op" id="7371411">}</span>
</div>
</body>
</html>
