<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8056237">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8056292">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8056346">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8056397">package</span>&nbsp;<span class="ident" id="8056405">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8056410">import</span>&nbsp;<span class="op" id="8056417">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8056420">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8056429">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8056436">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8056442">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8056453">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8056464">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8056474">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="8056477">//&nbsp;Test&nbsp;basic&nbsp;operations&nbsp;in&nbsp;a&nbsp;safe&nbsp;manner.</span><br>
<span class="lineno"></span><span class="keyword" id="8056520">func</span>&nbsp;<span class="ident" id="8056525">TestBasicEncoderDecoder</span><span class="op" id="8056548">(</span><span class="ident" id="8056549">t</span>&nbsp;<span class="op" id="8056551">*</span><span class="ident" id="8056552">testing</span><span class="op" id="8056559">.</span><span class="ident" id="8056560">T</span><span class="op" id="8056561">)</span>&nbsp;<span class="op" id="8056563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8056566">var</span>&nbsp;<span class="ident" id="8056570">values</span>&nbsp;<span class="op" id="8056577">=</span>&nbsp;<span class="op" id="8056579">[</span><span class="op" id="8056580">]</span><span class="keyword" id="8056581">interface</span><span class="op" id="8056590">{</span><span class="op" id="8056591">}</span><span class="op" id="8056592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8056596">true</span><span class="op" id="8056600">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8056604">int</span><span class="op" id="8056607">(</span><span class="num" id="8056608">123</span><span class="op" id="8056611">)</span><span class="op" id="8056612">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8056616">int8</span><span class="op" id="8056620">(</span><span class="num" id="8056621">123</span><span class="op" id="8056624">)</span><span class="op" id="8056625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8056629">int16</span><span class="op" id="8056634">(</span><span class="op" id="8056635">-</span><span class="num" id="8056636">12345</span><span class="op" id="8056641">)</span><span class="op" id="8056642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8056646">int32</span><span class="op" id="8056651">(</span><span class="num" id="8056652">123456</span><span class="op" id="8056658">)</span><span class="op" id="8056659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8056663">int64</span><span class="op" id="8056668">(</span><span class="op" id="8056669">-</span><span class="num" id="8056670">1234567</span><span class="op" id="8056677">)</span><span class="op" id="8056678">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8056682">uint</span><span class="op" id="8056686">(</span><span class="num" id="8056687">123</span><span class="op" id="8056690">)</span><span class="op" id="8056691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8056695">uint8</span><span class="op" id="8056700">(</span><span class="num" id="8056701">123</span><span class="op" id="8056704">)</span><span class="op" id="8056705">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8056709">uint16</span><span class="op" id="8056715">(</span><span class="num" id="8056716">12345</span><span class="op" id="8056721">)</span><span class="op" id="8056722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8056726">uint32</span><span class="op" id="8056732">(</span><span class="num" id="8056733">123456</span><span class="op" id="8056739">)</span><span class="op" id="8056740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8056744">uint64</span><span class="op" id="8056750">(</span><span class="num" id="8056751">1234567</span><span class="op" id="8056758">)</span><span class="op" id="8056759">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8056763">uintptr</span><span class="op" id="8056770">(</span><span class="num" id="8056771">12345678</span><span class="op" id="8056779">)</span><span class="op" id="8056780">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8056784">float32</span><span class="op" id="8056791">(</span><span class="num" id="8056792">1.2345</span><span class="op" id="8056798">)</span><span class="op" id="8056799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8056803">float64</span><span class="op" id="8056810">(</span><span class="num" id="8056811">1.2345678</span><span class="op" id="8056820">)</span><span class="op" id="8056821">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8056825">complex64</span><span class="op" id="8056834">(</span><span class="num" id="8056835">1.2345</span>&nbsp;<span class="op" id="8056842">+</span>&nbsp;<span class="num" id="8056844">2.3456i</span><span class="op" id="8056851">)</span><span class="op" id="8056852">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8056856">complex128</span><span class="op" id="8056866">(</span><span class="num" id="8056867">1.2345678</span>&nbsp;<span class="op" id="8056877">+</span>&nbsp;<span class="num" id="8056879">2.3456789i</span><span class="op" id="8056889">)</span><span class="op" id="8056890">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8056894">[</span><span class="op" id="8056895">]</span><span class="builtintype" id="8056896">byte</span><span class="op" id="8056900">(</span><span class="string" id="8056901">&#34;hello&#34;</span><span class="op" id="8056908">)</span><span class="op" id="8056909">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8056913">string</span><span class="op" id="8056919">(</span><span class="string" id="8056920">&#34;hello&#34;</span><span class="op" id="8056927">)</span><span class="op" id="8056928">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8056931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8056934">for</span>&nbsp;<span class="ident" id="8056938">_</span><span class="op" id="8056939">,</span>&nbsp;<span class="ident" id="8056941">value</span>&nbsp;<span class="op" id="8056947">:=</span>&nbsp;<span class="keyword" id="8056950">range</span>&nbsp;<span class="ident" id="8056956">values</span>&nbsp;<span class="op" id="8056963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8056967">b</span>&nbsp;<span class="op" id="8056969">:=</span>&nbsp;<span class="builtinfunc" id="8056972">new</span><span class="op" id="8056975">(</span><span class="ident" id="8056976">bytes</span><span class="op" id="8056981">.</span><span class="ident" id="8056982">Buffer</span><span class="op" id="8056988">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8056992">enc</span>&nbsp;<span class="op" id="8056996">:=</span>&nbsp;<span class="ident" id="8056999">NewEncoder</span><span class="op" id="8057009">(</span><span class="ident" id="8057010">b</span><span class="op" id="8057011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057015">err</span>&nbsp;<span class="op" id="8057019">:=</span>&nbsp;<span class="ident" id="8057022">enc</span><span class="op" id="8057025">.</span><span class="ident" id="8057026">Encode</span><span class="op" id="8057032">(</span><span class="ident" id="8057033">value</span><span class="op" id="8057038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8057042">if</span>&nbsp;<span class="ident" id="8057045">err</span>&nbsp;<span class="op" id="8057049">!=</span>&nbsp;<span class="ident" id="8057052">nil</span>&nbsp;<span class="op" id="8057056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057061">t</span><span class="op" id="8057062">.</span><span class="ident" id="8057063">Error</span><span class="op" id="8057068">(</span><span class="string" id="8057069">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8057084">,</span>&nbsp;<span class="ident" id="8057086">err</span><span class="op" id="8057089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8057093">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057097">dec</span>&nbsp;<span class="op" id="8057101">:=</span>&nbsp;<span class="ident" id="8057104">NewDecoder</span><span class="op" id="8057114">(</span><span class="ident" id="8057115">b</span><span class="op" id="8057116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057120">result</span>&nbsp;<span class="op" id="8057127">:=</span>&nbsp;<span class="ident" id="8057130">reflect</span><span class="op" id="8057137">.</span><span class="ident" id="8057138">New</span><span class="op" id="8057141">(</span><span class="ident" id="8057142">reflect</span><span class="op" id="8057149">.</span><span class="ident" id="8057150">TypeOf</span><span class="op" id="8057156">(</span><span class="ident" id="8057157">value</span><span class="op" id="8057162">)</span><span class="op" id="8057163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057167">err</span>&nbsp;<span class="op" id="8057171">=</span>&nbsp;<span class="ident" id="8057173">dec</span><span class="op" id="8057176">.</span><span class="ident" id="8057177">Decode</span><span class="op" id="8057183">(</span><span class="ident" id="8057184">result</span><span class="op" id="8057190">.</span><span class="ident" id="8057191">Interface</span><span class="op" id="8057200">(</span><span class="op" id="8057201">)</span><span class="op" id="8057202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8057206">if</span>&nbsp;<span class="ident" id="8057209">err</span>&nbsp;<span class="op" id="8057213">!=</span>&nbsp;<span class="ident" id="8057216">nil</span>&nbsp;<span class="op" id="8057220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057225">t</span><span class="op" id="8057226">.</span><span class="ident" id="8057227">Fatalf</span><span class="op" id="8057233">(</span><span class="string" id="8057234">&#34;error&nbsp;decoding&nbsp;%T:&nbsp;%v:&#34;</span><span class="op" id="8057258">,</span>&nbsp;<span class="ident" id="8057260">reflect</span><span class="op" id="8057267">.</span><span class="ident" id="8057268">TypeOf</span><span class="op" id="8057274">(</span><span class="ident" id="8057275">value</span><span class="op" id="8057280">)</span><span class="op" id="8057281">,</span>&nbsp;<span class="ident" id="8057283">err</span><span class="op" id="8057286">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8057290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8057294">if</span>&nbsp;<span class="op" id="8057297">!</span><span class="ident" id="8057298">reflect</span><span class="op" id="8057305">.</span><span class="ident" id="8057306">DeepEqual</span><span class="op" id="8057315">(</span><span class="ident" id="8057316">value</span><span class="op" id="8057321">,</span>&nbsp;<span class="ident" id="8057323">result</span><span class="op" id="8057329">.</span><span class="ident" id="8057330">Elem</span><span class="op" id="8057334">(</span><span class="op" id="8057335">)</span><span class="op" id="8057336">.</span><span class="ident" id="8057337">Interface</span><span class="op" id="8057346">(</span><span class="op" id="8057347">)</span><span class="op" id="8057348">)</span>&nbsp;<span class="op" id="8057350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057355">t</span><span class="op" id="8057356">.</span><span class="ident" id="8057357">Fatalf</span><span class="op" id="8057363">(</span><span class="string" id="8057364">&#34;%T:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8057388">,</span>&nbsp;<span class="ident" id="8057390">value</span><span class="op" id="8057395">,</span>&nbsp;<span class="ident" id="8057397">value</span><span class="op" id="8057402">,</span>&nbsp;<span class="ident" id="8057404">result</span><span class="op" id="8057410">.</span><span class="ident" id="8057411">Elem</span><span class="op" id="8057415">(</span><span class="op" id="8057416">)</span><span class="op" id="8057417">.</span><span class="ident" id="8057418">Interface</span><span class="op" id="8057427">(</span><span class="op" id="8057428">)</span><span class="op" id="8057429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8057433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8057436">}</span><br>
<span class="lineno">55</span><span class="op" id="8057438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8057441">type</span>&nbsp;<span class="ident" id="8057446">ET0</span>&nbsp;<span class="keyword" id="8057450">struct</span>&nbsp;<span class="op" id="8057457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057460">A</span>&nbsp;<span class="builtintype" id="8057462">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057467">B</span>&nbsp;<span class="builtintype" id="8057469">string</span><br>
<span class="lineno">60</span><span class="op" id="8057476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8057479">type</span>&nbsp;<span class="ident" id="8057484">ET2</span>&nbsp;<span class="keyword" id="8057488">struct</span>&nbsp;<span class="op" id="8057495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057498">X</span>&nbsp;<span class="builtintype" id="8057500">string</span><br>
<span class="lineno"></span><span class="op" id="8057507">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="8057510">type</span>&nbsp;<span class="ident" id="8057515">ET1</span>&nbsp;<span class="keyword" id="8057519">struct</span>&nbsp;<span class="op" id="8057526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057529">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8057534">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057539">Et2</span>&nbsp;&nbsp;<span class="op" id="8057544">*</span><span class="ident" id="8057545">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057550">Next</span>&nbsp;<span class="op" id="8057555">*</span><span class="ident" id="8057556">ET1</span><br>
<span class="lineno">70</span><span class="op" id="8057560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8057563">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;name&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno"></span><span class="keyword" id="8057613">type</span>&nbsp;<span class="ident" id="8057618">ET3</span>&nbsp;<span class="keyword" id="8057622">struct</span>&nbsp;<span class="op" id="8057629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057632">A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8057646">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057651">Et2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8057665">*</span><span class="ident" id="8057666">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057671">DifferentNext</span>&nbsp;<span class="op" id="8057685">*</span><span class="ident" id="8057686">ET1</span><br>
<span class="lineno"></span><span class="op" id="8057690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8057693">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;type&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno">80</span><span class="keyword" id="8057743">type</span>&nbsp;<span class="ident" id="8057748">ET4</span>&nbsp;<span class="keyword" id="8057752">struct</span>&nbsp;<span class="op" id="8057759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057762">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8057767">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057772">Et2</span>&nbsp;&nbsp;<span class="builtintype" id="8057777">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057786">Next</span>&nbsp;<span class="builtintype" id="8057791">int</span><br>
<span class="lineno"></span><span class="op" id="8057795">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="8057798">func</span>&nbsp;<span class="ident" id="8057803">TestEncoderDecoder</span><span class="op" id="8057821">(</span><span class="ident" id="8057822">t</span>&nbsp;<span class="op" id="8057824">*</span><span class="ident" id="8057825">testing</span><span class="op" id="8057832">.</span><span class="ident" id="8057833">T</span><span class="op" id="8057834">)</span>&nbsp;<span class="op" id="8057836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057839">b</span>&nbsp;<span class="op" id="8057841">:=</span>&nbsp;<span class="builtinfunc" id="8057844">new</span><span class="op" id="8057847">(</span><span class="ident" id="8057848">bytes</span><span class="op" id="8057853">.</span><span class="ident" id="8057854">Buffer</span><span class="op" id="8057860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057863">enc</span>&nbsp;<span class="op" id="8057867">:=</span>&nbsp;<span class="ident" id="8057870">NewEncoder</span><span class="op" id="8057880">(</span><span class="ident" id="8057881">b</span><span class="op" id="8057882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057885">et0</span>&nbsp;<span class="op" id="8057889">:=</span>&nbsp;<span class="builtinfunc" id="8057892">new</span><span class="op" id="8057895">(</span><span class="ident" id="8057896">ET0</span><span class="op" id="8057899">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057902">et0</span><span class="op" id="8057905">.</span><span class="ident" id="8057906">A</span>&nbsp;<span class="op" id="8057908">=</span>&nbsp;<span class="num" id="8057910">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057913">et0</span><span class="op" id="8057916">.</span><span class="ident" id="8057917">B</span>&nbsp;<span class="op" id="8057919">=</span>&nbsp;<span class="string" id="8057921">&#34;gobs&nbsp;of&nbsp;fun&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057936">err</span>&nbsp;<span class="op" id="8057940">:=</span>&nbsp;<span class="ident" id="8057943">enc</span><span class="op" id="8057946">.</span><span class="ident" id="8057947">Encode</span><span class="op" id="8057953">(</span><span class="ident" id="8057954">et0</span><span class="op" id="8057957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8057960">if</span>&nbsp;<span class="ident" id="8057963">err</span>&nbsp;<span class="op" id="8057967">!=</span>&nbsp;<span class="ident" id="8057970">nil</span>&nbsp;<span class="op" id="8057974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057978">t</span><span class="op" id="8057979">.</span><span class="ident" id="8057980">Error</span><span class="op" id="8057985">(</span><span class="string" id="8057986">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8058001">,</span>&nbsp;<span class="ident" id="8058003">err</span><span class="op" id="8058006">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8058009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8058012">//fmt.Printf(&#34;%&nbsp;x&nbsp;%q\n&#34;,&nbsp;b,&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8058044">//Debug(b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058056">dec</span>&nbsp;<span class="op" id="8058060">:=</span>&nbsp;<span class="ident" id="8058063">NewDecoder</span><span class="op" id="8058073">(</span><span class="ident" id="8058074">b</span><span class="op" id="8058075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058078">newEt0</span>&nbsp;<span class="op" id="8058085">:=</span>&nbsp;<span class="builtinfunc" id="8058088">new</span><span class="op" id="8058091">(</span><span class="ident" id="8058092">ET0</span><span class="op" id="8058095">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058098">err</span>&nbsp;<span class="op" id="8058102">=</span>&nbsp;<span class="ident" id="8058104">dec</span><span class="op" id="8058107">.</span><span class="ident" id="8058108">Decode</span><span class="op" id="8058114">(</span><span class="ident" id="8058115">newEt0</span><span class="op" id="8058121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8058124">if</span>&nbsp;<span class="ident" id="8058127">err</span>&nbsp;<span class="op" id="8058131">!=</span>&nbsp;<span class="ident" id="8058134">nil</span>&nbsp;<span class="op" id="8058138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058142">t</span><span class="op" id="8058143">.</span><span class="ident" id="8058144">Fatal</span><span class="op" id="8058149">(</span><span class="string" id="8058150">&#34;error&nbsp;decoding&nbsp;ET0:&#34;</span><span class="op" id="8058171">,</span>&nbsp;<span class="ident" id="8058173">err</span><span class="op" id="8058176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8058179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8058183">if</span>&nbsp;<span class="op" id="8058186">!</span><span class="ident" id="8058187">reflect</span><span class="op" id="8058194">.</span><span class="ident" id="8058195">DeepEqual</span><span class="op" id="8058204">(</span><span class="ident" id="8058205">et0</span><span class="op" id="8058208">,</span>&nbsp;<span class="ident" id="8058210">newEt0</span><span class="op" id="8058216">)</span>&nbsp;<span class="op" id="8058218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058222">t</span><span class="op" id="8058223">.</span><span class="ident" id="8058224">Fatalf</span><span class="op" id="8058230">(</span><span class="string" id="8058231">&#34;invalid&nbsp;data&nbsp;for&nbsp;et0:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="8058276">,</span>&nbsp;<span class="op" id="8058278">*</span><span class="ident" id="8058279">et0</span><span class="op" id="8058282">,</span>&nbsp;<span class="op" id="8058284">*</span><span class="ident" id="8058285">newEt0</span><span class="op" id="8058291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8058294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8058297">if</span>&nbsp;<span class="ident" id="8058300">b</span><span class="op" id="8058301">.</span><span class="ident" id="8058302">Len</span><span class="op" id="8058305">(</span><span class="op" id="8058306">)</span>&nbsp;<span class="op" id="8058308">!=</span>&nbsp;<span class="num" id="8058311">0</span>&nbsp;<span class="op" id="8058313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058317">t</span><span class="op" id="8058318">.</span><span class="ident" id="8058319">Error</span><span class="op" id="8058324">(</span><span class="string" id="8058325">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="8058338">,</span>&nbsp;<span class="ident" id="8058340">b</span><span class="op" id="8058341">.</span><span class="ident" id="8058342">Len</span><span class="op" id="8058345">(</span><span class="op" id="8058346">)</span><span class="op" id="8058347">,</span>&nbsp;<span class="string" id="8058349">&#34;bytes&nbsp;left&#34;</span><span class="op" id="8058361">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8058364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8058367">//&nbsp;&nbsp;&nbsp;&nbspt.FailNow()</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058384">b</span>&nbsp;<span class="op" id="8058386">=</span>&nbsp;<span class="builtinfunc" id="8058388">new</span><span class="op" id="8058391">(</span><span class="ident" id="8058392">bytes</span><span class="op" id="8058397">.</span><span class="ident" id="8058398">Buffer</span><span class="op" id="8058404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058407">enc</span>&nbsp;<span class="op" id="8058411">=</span>&nbsp;<span class="ident" id="8058413">NewEncoder</span><span class="op" id="8058423">(</span><span class="ident" id="8058424">b</span><span class="op" id="8058425">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058428">et1</span>&nbsp;<span class="op" id="8058432">:=</span>&nbsp;<span class="builtinfunc" id="8058435">new</span><span class="op" id="8058438">(</span><span class="ident" id="8058439">ET1</span><span class="op" id="8058442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058445">et1</span><span class="op" id="8058448">.</span><span class="ident" id="8058449">A</span>&nbsp;<span class="op" id="8058451">=</span>&nbsp;<span class="num" id="8058453">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058456">et1</span><span class="op" id="8058459">.</span><span class="ident" id="8058460">Et2</span>&nbsp;<span class="op" id="8058464">=</span>&nbsp;<span class="builtinfunc" id="8058466">new</span><span class="op" id="8058469">(</span><span class="ident" id="8058470">ET2</span><span class="op" id="8058473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058476">err</span>&nbsp;<span class="op" id="8058480">=</span>&nbsp;<span class="ident" id="8058482">enc</span><span class="op" id="8058485">.</span><span class="ident" id="8058486">Encode</span><span class="op" id="8058492">(</span><span class="ident" id="8058493">et1</span><span class="op" id="8058496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8058499">if</span>&nbsp;<span class="ident" id="8058502">err</span>&nbsp;<span class="op" id="8058506">!=</span>&nbsp;<span class="ident" id="8058509">nil</span>&nbsp;<span class="op" id="8058513">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058517">t</span><span class="op" id="8058518">.</span><span class="ident" id="8058519">Error</span><span class="op" id="8058524">(</span><span class="string" id="8058525">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8058540">,</span>&nbsp;<span class="ident" id="8058542">err</span><span class="op" id="8058545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8058548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058551">dec</span>&nbsp;<span class="op" id="8058555">=</span>&nbsp;<span class="ident" id="8058557">NewDecoder</span><span class="op" id="8058567">(</span><span class="ident" id="8058568">b</span><span class="op" id="8058569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058572">newEt1</span>&nbsp;<span class="op" id="8058579">:=</span>&nbsp;<span class="builtinfunc" id="8058582">new</span><span class="op" id="8058585">(</span><span class="ident" id="8058586">ET1</span><span class="op" id="8058589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058592">err</span>&nbsp;<span class="op" id="8058596">=</span>&nbsp;<span class="ident" id="8058598">dec</span><span class="op" id="8058601">.</span><span class="ident" id="8058602">Decode</span><span class="op" id="8058608">(</span><span class="ident" id="8058609">newEt1</span><span class="op" id="8058615">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8058618">if</span>&nbsp;<span class="ident" id="8058621">err</span>&nbsp;<span class="op" id="8058625">!=</span>&nbsp;<span class="ident" id="8058628">nil</span>&nbsp;<span class="op" id="8058632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058636">t</span><span class="op" id="8058637">.</span><span class="ident" id="8058638">Fatal</span><span class="op" id="8058643">(</span><span class="string" id="8058644">&#34;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="8058665">,</span>&nbsp;<span class="ident" id="8058667">err</span><span class="op" id="8058670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8058673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8058677">if</span>&nbsp;<span class="op" id="8058680">!</span><span class="ident" id="8058681">reflect</span><span class="op" id="8058688">.</span><span class="ident" id="8058689">DeepEqual</span><span class="op" id="8058698">(</span><span class="ident" id="8058699">et1</span><span class="op" id="8058702">,</span>&nbsp;<span class="ident" id="8058704">newEt1</span><span class="op" id="8058710">)</span>&nbsp;<span class="op" id="8058712">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058716">t</span><span class="op" id="8058717">.</span><span class="ident" id="8058718">Fatalf</span><span class="op" id="8058724">(</span><span class="string" id="8058725">&#34;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="8058770">,</span>&nbsp;<span class="op" id="8058772">*</span><span class="ident" id="8058773">et1</span><span class="op" id="8058776">,</span>&nbsp;<span class="op" id="8058778">*</span><span class="ident" id="8058779">newEt1</span><span class="op" id="8058785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8058788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8058791">if</span>&nbsp;<span class="ident" id="8058794">b</span><span class="op" id="8058795">.</span><span class="ident" id="8058796">Len</span><span class="op" id="8058799">(</span><span class="op" id="8058800">)</span>&nbsp;<span class="op" id="8058802">!=</span>&nbsp;<span class="num" id="8058805">0</span>&nbsp;<span class="op" id="8058807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058811">t</span><span class="op" id="8058812">.</span><span class="ident" id="8058813">Error</span><span class="op" id="8058818">(</span><span class="string" id="8058819">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="8058832">,</span>&nbsp;<span class="ident" id="8058834">b</span><span class="op" id="8058835">.</span><span class="ident" id="8058836">Len</span><span class="op" id="8058839">(</span><span class="op" id="8058840">)</span><span class="op" id="8058841">,</span>&nbsp;<span class="string" id="8058843">&#34;bytes&nbsp;left&#34;</span><span class="op" id="8058855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8058858">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058862">enc</span><span class="op" id="8058865">.</span><span class="ident" id="8058866">Encode</span><span class="op" id="8058872">(</span><span class="ident" id="8058873">et1</span><span class="op" id="8058876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058879">newEt1</span>&nbsp;<span class="op" id="8058886">=</span>&nbsp;<span class="builtinfunc" id="8058888">new</span><span class="op" id="8058891">(</span><span class="ident" id="8058892">ET1</span><span class="op" id="8058895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058898">err</span>&nbsp;<span class="op" id="8058902">=</span>&nbsp;<span class="ident" id="8058904">dec</span><span class="op" id="8058907">.</span><span class="ident" id="8058908">Decode</span><span class="op" id="8058914">(</span><span class="ident" id="8058915">newEt1</span><span class="op" id="8058921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8058924">if</span>&nbsp;<span class="ident" id="8058927">err</span>&nbsp;<span class="op" id="8058931">!=</span>&nbsp;<span class="ident" id="8058934">nil</span>&nbsp;<span class="op" id="8058938">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8058942">t</span><span class="op" id="8058943">.</span><span class="ident" id="8058944">Fatal</span><span class="op" id="8058949">(</span><span class="string" id="8058950">&#34;round&nbsp;2:&nbsp;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="8058980">,</span>&nbsp;<span class="ident" id="8058982">err</span><span class="op" id="8058985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8058988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8058991">if</span>&nbsp;<span class="op" id="8058994">!</span><span class="ident" id="8058995">reflect</span><span class="op" id="8059002">.</span><span class="ident" id="8059003">DeepEqual</span><span class="op" id="8059012">(</span><span class="ident" id="8059013">et1</span><span class="op" id="8059016">,</span>&nbsp;<span class="ident" id="8059018">newEt1</span><span class="op" id="8059024">)</span>&nbsp;<span class="op" id="8059026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8059030">t</span><span class="op" id="8059031">.</span><span class="ident" id="8059032">Fatalf</span><span class="op" id="8059038">(</span><span class="string" id="8059039">&#34;round&nbsp;2:&nbsp;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="8059093">,</span>&nbsp;<span class="op" id="8059095">*</span><span class="ident" id="8059096">et1</span><span class="op" id="8059099">,</span>&nbsp;<span class="op" id="8059101">*</span><span class="ident" id="8059102">newEt1</span><span class="op" id="8059108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8059111">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8059114">if</span>&nbsp;<span class="ident" id="8059117">b</span><span class="op" id="8059118">.</span><span class="ident" id="8059119">Len</span><span class="op" id="8059122">(</span><span class="op" id="8059123">)</span>&nbsp;<span class="op" id="8059125">!=</span>&nbsp;<span class="num" id="8059128">0</span>&nbsp;<span class="op" id="8059130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8059134">t</span><span class="op" id="8059135">.</span><span class="ident" id="8059136">Error</span><span class="op" id="8059141">(</span><span class="string" id="8059142">&#34;round&nbsp;2:&nbsp;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="8059164">,</span>&nbsp;<span class="ident" id="8059166">b</span><span class="op" id="8059167">.</span><span class="ident" id="8059168">Len</span><span class="op" id="8059171">(</span><span class="op" id="8059172">)</span><span class="op" id="8059173">,</span>&nbsp;<span class="string" id="8059175">&#34;bytes&nbsp;left&#34;</span><span class="op" id="8059187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8059190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8059194">//&nbsp;Now&nbsp;test&nbsp;with&nbsp;a&nbsp;running&nbsp;encoder/decoder&nbsp;pair&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;type&nbsp;mismatch.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8059278">err</span>&nbsp;<span class="op" id="8059282">=</span>&nbsp;<span class="ident" id="8059284">enc</span><span class="op" id="8059287">.</span><span class="ident" id="8059288">Encode</span><span class="op" id="8059294">(</span><span class="ident" id="8059295">et1</span><span class="op" id="8059298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8059301">if</span>&nbsp;<span class="ident" id="8059304">err</span>&nbsp;<span class="op" id="8059308">!=</span>&nbsp;<span class="ident" id="8059311">nil</span>&nbsp;<span class="op" id="8059315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8059319">t</span><span class="op" id="8059320">.</span><span class="ident" id="8059321">Error</span><span class="op" id="8059326">(</span><span class="string" id="8059327">&#34;round&nbsp;3:&nbsp;encoder&nbsp;fail:&#34;</span><span class="op" id="8059351">,</span>&nbsp;<span class="ident" id="8059353">err</span><span class="op" id="8059356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8059359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8059362">newEt2</span>&nbsp;<span class="op" id="8059369">:=</span>&nbsp;<span class="builtinfunc" id="8059372">new</span><span class="op" id="8059375">(</span><span class="ident" id="8059376">ET2</span><span class="op" id="8059379">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8059382">err</span>&nbsp;<span class="op" id="8059386">=</span>&nbsp;<span class="ident" id="8059388">dec</span><span class="op" id="8059391">.</span><span class="ident" id="8059392">Decode</span><span class="op" id="8059398">(</span><span class="ident" id="8059399">newEt2</span><span class="op" id="8059405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8059408">if</span>&nbsp;<span class="ident" id="8059411">err</span>&nbsp;<span class="op" id="8059415">==</span>&nbsp;<span class="ident" id="8059418">nil</span>&nbsp;<span class="op" id="8059422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8059426">t</span><span class="op" id="8059427">.</span><span class="ident" id="8059428">Fatal</span><span class="op" id="8059433">(</span><span class="string" id="8059434">&#34;round&nbsp;3:&nbsp;expected&nbsp;`bad&nbsp;type&#39;&nbsp;error&nbsp;decoding&nbsp;ET2&#34;</span><span class="op" id="8059483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8059486">}</span><br>
<span class="lineno"></span><span class="op" id="8059488">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="8059491">//&nbsp;Run&nbsp;one&nbsp;value&nbsp;through&nbsp;the&nbsp;encoder/decoder,&nbsp;but&nbsp;use&nbsp;the&nbsp;wrong&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="8059561">//&nbsp;Input&nbsp;is&nbsp;always&nbsp;an&nbsp;ET1;&nbsp;we&nbsp;compare&nbsp;it&nbsp;to&nbsp;whatever&nbsp;is&nbsp;under&nbsp;&#39;e&#39;.</span><br>
<span class="lineno"></span><span class="keyword" id="8059628">func</span>&nbsp;<span class="ident" id="8059633">badTypeCheck</span><span class="op" id="8059645">(</span><span class="ident" id="8059646">e</span>&nbsp;<span class="keyword" id="8059648">interface</span><span class="op" id="8059657">{</span><span class="op" id="8059658">}</span><span class="op" id="8059659">,</span>&nbsp;<span class="ident" id="8059661">shouldFail</span>&nbsp;<span class="builtintype" id="8059672">bool</span><span class="op" id="8059676">,</span>&nbsp;<span class="ident" id="8059678">msg</span>&nbsp;<span class="builtintype" id="8059682">string</span><span class="op" id="8059688">,</span>&nbsp;<span class="ident" id="8059690">t</span>&nbsp;<span class="op" id="8059692">*</span><span class="ident" id="8059693">testing</span><span class="op" id="8059700">.</span><span class="ident" id="8059701">T</span><span class="op" id="8059702">)</span>&nbsp;<span class="op" id="8059704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8059707">b</span>&nbsp;<span class="op" id="8059709">:=</span>&nbsp;<span class="builtinfunc" id="8059712">new</span><span class="op" id="8059715">(</span><span class="ident" id="8059716">bytes</span><span class="op" id="8059721">.</span><span class="ident" id="8059722">Buffer</span><span class="op" id="8059728">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8059731">enc</span>&nbsp;<span class="op" id="8059735">:=</span>&nbsp;<span class="ident" id="8059738">NewEncoder</span><span class="op" id="8059748">(</span><span class="ident" id="8059749">b</span><span class="op" id="8059750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8059753">et1</span>&nbsp;<span class="op" id="8059757">:=</span>&nbsp;<span class="builtinfunc" id="8059760">new</span><span class="op" id="8059763">(</span><span class="ident" id="8059764">ET1</span><span class="op" id="8059767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8059770">et1</span><span class="op" id="8059773">.</span><span class="ident" id="8059774">A</span>&nbsp;<span class="op" id="8059776">=</span>&nbsp;<span class="num" id="8059778">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8059781">et1</span><span class="op" id="8059784">.</span><span class="ident" id="8059785">Et2</span>&nbsp;<span class="op" id="8059789">=</span>&nbsp;<span class="builtinfunc" id="8059791">new</span><span class="op" id="8059794">(</span><span class="ident" id="8059795">ET2</span><span class="op" id="8059798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8059801">err</span>&nbsp;<span class="op" id="8059805">:=</span>&nbsp;<span class="ident" id="8059808">enc</span><span class="op" id="8059811">.</span><span class="ident" id="8059812">Encode</span><span class="op" id="8059818">(</span><span class="ident" id="8059819">et1</span><span class="op" id="8059822">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8059825">if</span>&nbsp;<span class="ident" id="8059828">err</span>&nbsp;<span class="op" id="8059832">!=</span>&nbsp;<span class="ident" id="8059835">nil</span>&nbsp;<span class="op" id="8059839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8059843">t</span><span class="op" id="8059844">.</span><span class="ident" id="8059845">Error</span><span class="op" id="8059850">(</span><span class="string" id="8059851">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8059866">,</span>&nbsp;<span class="ident" id="8059868">err</span><span class="op" id="8059871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8059874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8059877">dec</span>&nbsp;<span class="op" id="8059881">:=</span>&nbsp;<span class="ident" id="8059884">NewDecoder</span><span class="op" id="8059894">(</span><span class="ident" id="8059895">b</span><span class="op" id="8059896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8059899">err</span>&nbsp;<span class="op" id="8059903">=</span>&nbsp;<span class="ident" id="8059905">dec</span><span class="op" id="8059908">.</span><span class="ident" id="8059909">Decode</span><span class="op" id="8059915">(</span><span class="ident" id="8059916">e</span><span class="op" id="8059917">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8059920">if</span>&nbsp;<span class="ident" id="8059923">shouldFail</span>&nbsp;<span class="op" id="8059934">&amp;&amp;</span>&nbsp;<span class="ident" id="8059937">err</span>&nbsp;<span class="op" id="8059941">==</span>&nbsp;<span class="ident" id="8059944">nil</span>&nbsp;<span class="op" id="8059948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8059952">t</span><span class="op" id="8059953">.</span><span class="ident" id="8059954">Error</span><span class="op" id="8059959">(</span><span class="string" id="8059960">&#34;expected&nbsp;error&nbsp;for&#34;</span><span class="op" id="8059980">,</span>&nbsp;<span class="ident" id="8059982">msg</span><span class="op" id="8059985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8059988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8059991">if</span>&nbsp;<span class="op" id="8059994">!</span><span class="ident" id="8059995">shouldFail</span>&nbsp;<span class="op" id="8060006">&amp;&amp;</span>&nbsp;<span class="ident" id="8060009">err</span>&nbsp;<span class="op" id="8060013">!=</span>&nbsp;<span class="ident" id="8060016">nil</span>&nbsp;<span class="op" id="8060020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8060024">t</span><span class="op" id="8060025">.</span><span class="ident" id="8060026">Error</span><span class="op" id="8060031">(</span><span class="string" id="8060032">&#34;unexpected&nbsp;error&nbsp;for&#34;</span><span class="op" id="8060054">,</span>&nbsp;<span class="ident" id="8060056">msg</span><span class="op" id="8060059">,</span>&nbsp;<span class="ident" id="8060061">err</span><span class="op" id="8060064">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8060067">}</span><br>
<span class="lineno"></span><span class="op" id="8060069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8060072">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;bad&nbsp;type&nbsp;the&nbsp;first&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="8060125">func</span>&nbsp;<span class="ident" id="8060130">TestWrongTypeDecoder</span><span class="op" id="8060150">(</span><span class="ident" id="8060151">t</span>&nbsp;<span class="op" id="8060153">*</span><span class="ident" id="8060154">testing</span><span class="op" id="8060161">.</span><span class="ident" id="8060162">T</span><span class="op" id="8060163">)</span>&nbsp;<span class="op" id="8060165">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8060168">badTypeCheck</span><span class="op" id="8060180">(</span><span class="builtinfunc" id="8060181">new</span><span class="op" id="8060184">(</span><span class="ident" id="8060185">ET2</span><span class="op" id="8060188">)</span><span class="op" id="8060189">,</span>&nbsp;<span class="builtintype" id="8060191">true</span><span class="op" id="8060195">,</span>&nbsp;<span class="string" id="8060197">&#34;no&nbsp;fields&nbsp;in&nbsp;common&#34;</span><span class="op" id="8060218">,</span>&nbsp;<span class="ident" id="8060220">t</span><span class="op" id="8060221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8060224">badTypeCheck</span><span class="op" id="8060236">(</span><span class="builtinfunc" id="8060237">new</span><span class="op" id="8060240">(</span><span class="ident" id="8060241">ET3</span><span class="op" id="8060244">)</span><span class="op" id="8060245">,</span>&nbsp;<span class="builtintype" id="8060247">false</span><span class="op" id="8060252">,</span>&nbsp;<span class="string" id="8060254">&#34;different&nbsp;name&nbsp;of&nbsp;field&#34;</span><span class="op" id="8060279">,</span>&nbsp;<span class="ident" id="8060281">t</span><span class="op" id="8060282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8060285">badTypeCheck</span><span class="op" id="8060297">(</span><span class="builtinfunc" id="8060298">new</span><span class="op" id="8060301">(</span><span class="ident" id="8060302">ET4</span><span class="op" id="8060305">)</span><span class="op" id="8060306">,</span>&nbsp;<span class="builtintype" id="8060308">true</span><span class="op" id="8060312">,</span>&nbsp;<span class="string" id="8060314">&#34;different&nbsp;type&nbsp;of&nbsp;field&#34;</span><span class="op" id="8060339">,</span>&nbsp;<span class="ident" id="8060341">t</span><span class="op" id="8060342">)</span><br>
<span class="lineno"></span><span class="op" id="8060344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="8060347">func</span>&nbsp;<span class="ident" id="8060352">corruptDataCheck</span><span class="op" id="8060368">(</span><span class="ident" id="8060369">s</span>&nbsp;<span class="builtintype" id="8060371">string</span><span class="op" id="8060377">,</span>&nbsp;<span class="ident" id="8060379">err</span>&nbsp;<span class="builtintype" id="8060383">error</span><span class="op" id="8060388">,</span>&nbsp;<span class="ident" id="8060390">t</span>&nbsp;<span class="op" id="8060392">*</span><span class="ident" id="8060393">testing</span><span class="op" id="8060400">.</span><span class="ident" id="8060401">T</span><span class="op" id="8060402">)</span>&nbsp;<span class="op" id="8060404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8060407">b</span>&nbsp;<span class="op" id="8060409">:=</span>&nbsp;<span class="ident" id="8060412">bytes</span><span class="op" id="8060417">.</span><span class="ident" id="8060418">NewBufferString</span><span class="op" id="8060433">(</span><span class="ident" id="8060434">s</span><span class="op" id="8060435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8060438">dec</span>&nbsp;<span class="op" id="8060442">:=</span>&nbsp;<span class="ident" id="8060445">NewDecoder</span><span class="op" id="8060455">(</span><span class="ident" id="8060456">b</span><span class="op" id="8060457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8060460">err1</span>&nbsp;<span class="op" id="8060465">:=</span>&nbsp;<span class="ident" id="8060468">dec</span><span class="op" id="8060471">.</span><span class="ident" id="8060472">Decode</span><span class="op" id="8060478">(</span><span class="builtinfunc" id="8060479">new</span><span class="op" id="8060482">(</span><span class="ident" id="8060483">ET2</span><span class="op" id="8060486">)</span><span class="op" id="8060487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8060490">if</span>&nbsp;<span class="ident" id="8060493">err1</span>&nbsp;<span class="op" id="8060498">!=</span>&nbsp;<span class="ident" id="8060501">err</span>&nbsp;<span class="op" id="8060505">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8060509">t</span><span class="op" id="8060510">.</span><span class="ident" id="8060511">Errorf</span><span class="op" id="8060517">(</span><span class="string" id="8060518">&#34;from&nbsp;%q&nbsp;expected&nbsp;error&nbsp;%s;&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8060553">,</span>&nbsp;<span class="ident" id="8060555">s</span><span class="op" id="8060556">,</span>&nbsp;<span class="ident" id="8060558">err</span><span class="op" id="8060561">,</span>&nbsp;<span class="ident" id="8060563">err1</span><span class="op" id="8060567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8060570">}</span><br>
<span class="lineno"></span><span class="op" id="8060572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8060575">//&nbsp;Check&nbsp;that&nbsp;we&nbsp;survive&nbsp;bad&nbsp;data.</span><br>
<span class="lineno">200</span><span class="keyword" id="8060610">func</span>&nbsp;<span class="ident" id="8060615">TestBadData</span><span class="op" id="8060626">(</span><span class="ident" id="8060627">t</span>&nbsp;<span class="op" id="8060629">*</span><span class="ident" id="8060630">testing</span><span class="op" id="8060637">.</span><span class="ident" id="8060638">T</span><span class="op" id="8060639">)</span>&nbsp;<span class="op" id="8060641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8060644">corruptDataCheck</span><span class="op" id="8060660">(</span><span class="string" id="8060661">&#34;&#34;</span><span class="op" id="8060663">,</span>&nbsp;<span class="ident" id="8060665">io</span><span class="op" id="8060667">.</span><span class="ident" id="8060668">EOF</span><span class="op" id="8060671">,</span>&nbsp;<span class="ident" id="8060673">t</span><span class="op" id="8060674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8060677">corruptDataCheck</span><span class="op" id="8060693">(</span><span class="string" id="8060694">&#34;\x7Fhi&#34;</span><span class="op" id="8060702">,</span>&nbsp;<span class="ident" id="8060704">io</span><span class="op" id="8060706">.</span><span class="ident" id="8060707">ErrUnexpectedEOF</span><span class="op" id="8060723">,</span>&nbsp;<span class="ident" id="8060725">t</span><span class="op" id="8060726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8060729">corruptDataCheck</span><span class="op" id="8060745">(</span><span class="string" id="8060746">&#34;\x03now&nbsp;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&#34;</span><span class="op" id="8060784">,</span>&nbsp;<span class="ident" id="8060786">errBadType</span><span class="op" id="8060796">,</span>&nbsp;<span class="ident" id="8060798">t</span><span class="op" id="8060799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8060802">//&nbsp;issue&nbsp;6323.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8060818">corruptDataCheck</span><span class="op" id="8060834">(</span><span class="string" id="8060835">&#34;\x04\x24foo&#34;</span><span class="op" id="8060848">,</span>&nbsp;<span class="ident" id="8060850">errRange</span><span class="op" id="8060858">,</span>&nbsp;<span class="ident" id="8060860">t</span><span class="op" id="8060861">)</span><br>
<span class="lineno"></span><span class="op" id="8060863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8060866">//&nbsp;Types&nbsp;not&nbsp;supported&nbsp;at&nbsp;top&nbsp;level&nbsp;by&nbsp;the&nbsp;Encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="8060918">var</span>&nbsp;<span class="ident" id="8060922">unsupportedValues</span>&nbsp;<span class="op" id="8060940">=</span>&nbsp;<span class="op" id="8060942">[</span><span class="op" id="8060943">]</span><span class="keyword" id="8060944">interface</span><span class="op" id="8060953">{</span><span class="op" id="8060954">}</span><span class="op" id="8060955">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8060958">make</span><span class="op" id="8060962">(</span><span class="keyword" id="8060963">chan</span>&nbsp;<span class="builtintype" id="8060968">int</span><span class="op" id="8060971">)</span><span class="op" id="8060972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8060975">func</span><span class="op" id="8060979">(</span><span class="ident" id="8060980">a</span>&nbsp;<span class="builtintype" id="8060982">int</span><span class="op" id="8060985">)</span>&nbsp;<span class="builtintype" id="8060987">bool</span>&nbsp;<span class="op" id="8060992">{</span>&nbsp;<span class="keyword" id="8060994">return</span>&nbsp;<span class="builtintype" id="8061001">true</span>&nbsp;<span class="op" id="8061006">}</span><span class="op" id="8061007">,</span><br>
<span class="lineno"></span><span class="op" id="8061009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8061012">func</span>&nbsp;<span class="ident" id="8061017">TestUnsupported</span><span class="op" id="8061032">(</span><span class="ident" id="8061033">t</span>&nbsp;<span class="op" id="8061035">*</span><span class="ident" id="8061036">testing</span><span class="op" id="8061043">.</span><span class="ident" id="8061044">T</span><span class="op" id="8061045">)</span>&nbsp;<span class="op" id="8061047">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061050">var</span>&nbsp;<span class="ident" id="8061054">b</span>&nbsp;<span class="ident" id="8061056">bytes</span><span class="op" id="8061061">.</span><span class="ident" id="8061062">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061070">enc</span>&nbsp;<span class="op" id="8061074">:=</span>&nbsp;<span class="ident" id="8061077">NewEncoder</span><span class="op" id="8061087">(</span><span class="op" id="8061088">&amp;</span><span class="ident" id="8061089">b</span><span class="op" id="8061090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061093">for</span>&nbsp;<span class="ident" id="8061097">_</span><span class="op" id="8061098">,</span>&nbsp;<span class="ident" id="8061100">v</span>&nbsp;<span class="op" id="8061102">:=</span>&nbsp;<span class="keyword" id="8061105">range</span>&nbsp;<span class="ident" id="8061111">unsupportedValues</span>&nbsp;<span class="op" id="8061129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061133">err</span>&nbsp;<span class="op" id="8061137">:=</span>&nbsp;<span class="ident" id="8061140">enc</span><span class="op" id="8061143">.</span><span class="ident" id="8061144">Encode</span><span class="op" id="8061150">(</span><span class="ident" id="8061151">v</span><span class="op" id="8061152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061156">if</span>&nbsp;<span class="ident" id="8061159">err</span>&nbsp;<span class="op" id="8061163">==</span>&nbsp;<span class="ident" id="8061166">nil</span>&nbsp;<span class="op" id="8061170">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061175">t</span><span class="op" id="8061176">.</span><span class="ident" id="8061177">Errorf</span><span class="op" id="8061183">(</span><span class="string" id="8061184">&#34;expected&nbsp;error&nbsp;for&nbsp;%T;&nbsp;got&nbsp;none&#34;</span><span class="op" id="8061217">,</span>&nbsp;<span class="ident" id="8061219">v</span><span class="op" id="8061220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8061224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8061227">}</span><br>
<span class="lineno"></span><span class="op" id="8061229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="8061232">func</span>&nbsp;<span class="ident" id="8061237">encAndDec</span><span class="op" id="8061246">(</span><span class="ident" id="8061247">in</span><span class="op" id="8061249">,</span>&nbsp;<span class="ident" id="8061251">out</span>&nbsp;<span class="keyword" id="8061255">interface</span><span class="op" id="8061264">{</span><span class="op" id="8061265">}</span><span class="op" id="8061266">)</span>&nbsp;<span class="builtintype" id="8061268">error</span>&nbsp;<span class="op" id="8061274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061277">b</span>&nbsp;<span class="op" id="8061279">:=</span>&nbsp;<span class="builtinfunc" id="8061282">new</span><span class="op" id="8061285">(</span><span class="ident" id="8061286">bytes</span><span class="op" id="8061291">.</span><span class="ident" id="8061292">Buffer</span><span class="op" id="8061298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061301">enc</span>&nbsp;<span class="op" id="8061305">:=</span>&nbsp;<span class="ident" id="8061308">NewEncoder</span><span class="op" id="8061318">(</span><span class="ident" id="8061319">b</span><span class="op" id="8061320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061323">err</span>&nbsp;<span class="op" id="8061327">:=</span>&nbsp;<span class="ident" id="8061330">enc</span><span class="op" id="8061333">.</span><span class="ident" id="8061334">Encode</span><span class="op" id="8061340">(</span><span class="ident" id="8061341">in</span><span class="op" id="8061343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061346">if</span>&nbsp;<span class="ident" id="8061349">err</span>&nbsp;<span class="op" id="8061353">!=</span>&nbsp;<span class="ident" id="8061356">nil</span>&nbsp;<span class="op" id="8061360">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061364">return</span>&nbsp;<span class="ident" id="8061371">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8061376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061379">dec</span>&nbsp;<span class="op" id="8061383">:=</span>&nbsp;<span class="ident" id="8061386">NewDecoder</span><span class="op" id="8061396">(</span><span class="ident" id="8061397">b</span><span class="op" id="8061398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061401">err</span>&nbsp;<span class="op" id="8061405">=</span>&nbsp;<span class="ident" id="8061407">dec</span><span class="op" id="8061410">.</span><span class="ident" id="8061411">Decode</span><span class="op" id="8061417">(</span><span class="ident" id="8061418">out</span><span class="op" id="8061421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061424">if</span>&nbsp;<span class="ident" id="8061427">err</span>&nbsp;<span class="op" id="8061431">!=</span>&nbsp;<span class="ident" id="8061434">nil</span>&nbsp;<span class="op" id="8061438">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061442">return</span>&nbsp;<span class="ident" id="8061449">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8061454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061457">return</span>&nbsp;<span class="ident" id="8061464">nil</span><br>
<span class="lineno"></span><span class="op" id="8061468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="8061471">func</span>&nbsp;<span class="ident" id="8061476">TestTypeToPtrType</span><span class="op" id="8061493">(</span><span class="ident" id="8061494">t</span>&nbsp;<span class="op" id="8061496">*</span><span class="ident" id="8061497">testing</span><span class="op" id="8061504">.</span><span class="ident" id="8061505">T</span><span class="op" id="8061506">)</span>&nbsp;<span class="op" id="8061508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8061511">//&nbsp;Encode&nbsp;a&nbsp;T,&nbsp;decode&nbsp;a&nbsp;*T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061539">type</span>&nbsp;<span class="ident" id="8061544">Type0</span>&nbsp;<span class="keyword" id="8061550">struct</span>&nbsp;<span class="op" id="8061557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061561">A</span>&nbsp;<span class="builtintype" id="8061563">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8061568">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061571">t0</span>&nbsp;<span class="op" id="8061574">:=</span>&nbsp;<span class="ident" id="8061577">Type0</span><span class="op" id="8061582">{</span><span class="num" id="8061583">7</span><span class="op" id="8061584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061587">t0p</span>&nbsp;<span class="op" id="8061591">:=</span>&nbsp;<span class="builtinfunc" id="8061594">new</span><span class="op" id="8061597">(</span><span class="ident" id="8061598">Type0</span><span class="op" id="8061603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061606">if</span>&nbsp;<span class="ident" id="8061609">err</span>&nbsp;<span class="op" id="8061613">:=</span>&nbsp;<span class="ident" id="8061616">encAndDec</span><span class="op" id="8061625">(</span><span class="ident" id="8061626">t0</span><span class="op" id="8061628">,</span>&nbsp;<span class="ident" id="8061630">t0p</span><span class="op" id="8061633">)</span><span class="op" id="8061634">;</span>&nbsp;<span class="ident" id="8061636">err</span>&nbsp;<span class="op" id="8061640">!=</span>&nbsp;<span class="ident" id="8061643">nil</span>&nbsp;<span class="op" id="8061647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061651">t</span><span class="op" id="8061652">.</span><span class="ident" id="8061653">Error</span><span class="op" id="8061658">(</span><span class="ident" id="8061659">err</span><span class="op" id="8061662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8061665">}</span><br>
<span class="lineno">250</span><span class="op" id="8061667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8061670">func</span>&nbsp;<span class="ident" id="8061675">TestPtrTypeToType</span><span class="op" id="8061692">(</span><span class="ident" id="8061693">t</span>&nbsp;<span class="op" id="8061695">*</span><span class="ident" id="8061696">testing</span><span class="op" id="8061703">.</span><span class="ident" id="8061704">T</span><span class="op" id="8061705">)</span>&nbsp;<span class="op" id="8061707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8061710">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061738">type</span>&nbsp;<span class="ident" id="8061743">Type1</span>&nbsp;<span class="keyword" id="8061749">struct</span>&nbsp;<span class="op" id="8061756">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061760">A</span>&nbsp;<span class="builtintype" id="8061762">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8061768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061771">t1p</span>&nbsp;<span class="op" id="8061775">:=</span>&nbsp;<span class="op" id="8061778">&amp;</span><span class="ident" id="8061779">Type1</span><span class="op" id="8061784">{</span><span class="num" id="8061785">17</span><span class="op" id="8061787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061790">var</span>&nbsp;<span class="ident" id="8061794">t1</span>&nbsp;<span class="ident" id="8061797">Type1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061804">if</span>&nbsp;<span class="ident" id="8061807">err</span>&nbsp;<span class="op" id="8061811">:=</span>&nbsp;<span class="ident" id="8061814">encAndDec</span><span class="op" id="8061823">(</span><span class="ident" id="8061824">t1</span><span class="op" id="8061826">,</span>&nbsp;<span class="ident" id="8061828">t1p</span><span class="op" id="8061831">)</span><span class="op" id="8061832">;</span>&nbsp;<span class="ident" id="8061834">err</span>&nbsp;<span class="op" id="8061838">!=</span>&nbsp;<span class="ident" id="8061841">nil</span>&nbsp;<span class="op" id="8061845">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061849">t</span><span class="op" id="8061850">.</span><span class="ident" id="8061851">Error</span><span class="op" id="8061856">(</span><span class="ident" id="8061857">err</span><span class="op" id="8061860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8061863">}</span><br>
<span class="lineno"></span><span class="op" id="8061865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8061868">func</span>&nbsp;<span class="ident" id="8061873">TestTypeToPtrPtrPtrPtrType</span><span class="op" id="8061899">(</span><span class="ident" id="8061900">t</span>&nbsp;<span class="op" id="8061902">*</span><span class="ident" id="8061903">testing</span><span class="op" id="8061910">.</span><span class="ident" id="8061911">T</span><span class="op" id="8061912">)</span>&nbsp;<span class="op" id="8061914">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061917">type</span>&nbsp;<span class="ident" id="8061922">Type2</span>&nbsp;<span class="keyword" id="8061928">struct</span>&nbsp;<span class="op" id="8061935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061939">A</span>&nbsp;<span class="op" id="8061941">*</span><span class="op" id="8061942">*</span><span class="op" id="8061943">*</span><span class="op" id="8061944">*</span><span class="builtintype" id="8061945">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8061954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061957">t2</span>&nbsp;<span class="op" id="8061960">:=</span>&nbsp;<span class="ident" id="8061963">Type2</span><span class="op" id="8061968">{</span><span class="op" id="8061969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061972">t2</span><span class="op" id="8061974">.</span><span class="ident" id="8061975">A</span>&nbsp;<span class="op" id="8061977">=</span>&nbsp;<span class="builtinfunc" id="8061979">new</span><span class="op" id="8061982">(</span><span class="op" id="8061983">*</span><span class="op" id="8061984">*</span><span class="op" id="8061985">*</span><span class="builtintype" id="8061986">float64</span><span class="op" id="8061993">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8061996">*</span><span class="ident" id="8061997">t2</span><span class="op" id="8061999">.</span><span class="ident" id="8062000">A</span>&nbsp;<span class="op" id="8062002">=</span>&nbsp;<span class="builtinfunc" id="8062004">new</span><span class="op" id="8062007">(</span><span class="op" id="8062008">*</span><span class="op" id="8062009">*</span><span class="builtintype" id="8062010">float64</span><span class="op" id="8062017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8062020">*</span><span class="op" id="8062021">*</span><span class="ident" id="8062022">t2</span><span class="op" id="8062024">.</span><span class="ident" id="8062025">A</span>&nbsp;<span class="op" id="8062027">=</span>&nbsp;<span class="builtinfunc" id="8062029">new</span><span class="op" id="8062032">(</span><span class="op" id="8062033">*</span><span class="builtintype" id="8062034">float64</span><span class="op" id="8062041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8062044">*</span><span class="op" id="8062045">*</span><span class="op" id="8062046">*</span><span class="ident" id="8062047">t2</span><span class="op" id="8062049">.</span><span class="ident" id="8062050">A</span>&nbsp;<span class="op" id="8062052">=</span>&nbsp;<span class="builtinfunc" id="8062054">new</span><span class="op" id="8062057">(</span><span class="builtintype" id="8062058">float64</span><span class="op" id="8062065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8062068">*</span><span class="op" id="8062069">*</span><span class="op" id="8062070">*</span><span class="op" id="8062071">*</span><span class="ident" id="8062072">t2</span><span class="op" id="8062074">.</span><span class="ident" id="8062075">A</span>&nbsp;<span class="op" id="8062077">=</span>&nbsp;<span class="num" id="8062079">27.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062085">t2pppp</span>&nbsp;<span class="op" id="8062092">:=</span>&nbsp;<span class="builtinfunc" id="8062095">new</span><span class="op" id="8062098">(</span><span class="op" id="8062099">*</span><span class="op" id="8062100">*</span><span class="op" id="8062101">*</span><span class="ident" id="8062102">Type2</span><span class="op" id="8062107">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8062110">if</span>&nbsp;<span class="ident" id="8062113">err</span>&nbsp;<span class="op" id="8062117">:=</span>&nbsp;<span class="ident" id="8062120">encAndDec</span><span class="op" id="8062129">(</span><span class="ident" id="8062130">t2</span><span class="op" id="8062132">,</span>&nbsp;<span class="ident" id="8062134">t2pppp</span><span class="op" id="8062140">)</span><span class="op" id="8062141">;</span>&nbsp;<span class="ident" id="8062143">err</span>&nbsp;<span class="op" id="8062147">!=</span>&nbsp;<span class="ident" id="8062150">nil</span>&nbsp;<span class="op" id="8062154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062158">t</span><span class="op" id="8062159">.</span><span class="ident" id="8062160">Fatal</span><span class="op" id="8062165">(</span><span class="ident" id="8062166">err</span><span class="op" id="8062169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8062172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8062175">if</span>&nbsp;<span class="op" id="8062178">*</span><span class="op" id="8062179">*</span><span class="op" id="8062180">*</span><span class="op" id="8062181">*</span><span class="op" id="8062182">(</span><span class="op" id="8062183">*</span><span class="op" id="8062184">*</span><span class="op" id="8062185">*</span><span class="op" id="8062186">*</span><span class="ident" id="8062187">t2pppp</span><span class="op" id="8062193">)</span><span class="op" id="8062194">.</span><span class="ident" id="8062195">A</span>&nbsp;<span class="op" id="8062197">!=</span>&nbsp;<span class="op" id="8062200">*</span><span class="op" id="8062201">*</span><span class="op" id="8062202">*</span><span class="op" id="8062203">*</span><span class="ident" id="8062204">t2</span><span class="op" id="8062206">.</span><span class="ident" id="8062207">A</span>&nbsp;<span class="op" id="8062209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062213">t</span><span class="op" id="8062214">.</span><span class="ident" id="8062215">Errorf</span><span class="op" id="8062221">(</span><span class="string" id="8062222">&#34;wrong&nbsp;value&nbsp;after&nbsp;decode:&nbsp;%g&nbsp;not&nbsp;%g&#34;</span><span class="op" id="8062259">,</span>&nbsp;<span class="op" id="8062261">*</span><span class="op" id="8062262">*</span><span class="op" id="8062263">*</span><span class="op" id="8062264">*</span><span class="op" id="8062265">(</span><span class="op" id="8062266">*</span><span class="op" id="8062267">*</span><span class="op" id="8062268">*</span><span class="op" id="8062269">*</span><span class="ident" id="8062270">t2pppp</span><span class="op" id="8062276">)</span><span class="op" id="8062277">.</span><span class="ident" id="8062278">A</span><span class="op" id="8062279">,</span>&nbsp;<span class="op" id="8062281">*</span><span class="op" id="8062282">*</span><span class="op" id="8062283">*</span><span class="op" id="8062284">*</span><span class="ident" id="8062285">t2</span><span class="op" id="8062287">.</span><span class="ident" id="8062288">A</span><span class="op" id="8062289">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8062292">}</span><br>
<span class="lineno"></span><span class="op" id="8062294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8062297">func</span>&nbsp;<span class="ident" id="8062302">TestSlice</span><span class="op" id="8062311">(</span><span class="ident" id="8062312">t</span>&nbsp;<span class="op" id="8062314">*</span><span class="ident" id="8062315">testing</span><span class="op" id="8062322">.</span><span class="ident" id="8062323">T</span><span class="op" id="8062324">)</span>&nbsp;<span class="op" id="8062326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8062329">type</span>&nbsp;<span class="ident" id="8062334">Type3</span>&nbsp;<span class="keyword" id="8062340">struct</span>&nbsp;<span class="op" id="8062347">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062351">A</span>&nbsp;<span class="op" id="8062353">[</span><span class="op" id="8062354">]</span><span class="builtintype" id="8062355">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8062363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062366">t3p</span>&nbsp;<span class="op" id="8062370">:=</span>&nbsp;<span class="op" id="8062373">&amp;</span><span class="ident" id="8062374">Type3</span><span class="op" id="8062379">{</span><span class="op" id="8062380">[</span><span class="op" id="8062381">]</span><span class="builtintype" id="8062382">string</span><span class="op" id="8062388">{</span><span class="string" id="8062389">&#34;hello&#34;</span><span class="op" id="8062396">,</span>&nbsp;<span class="string" id="8062398">&#34;world&#34;</span><span class="op" id="8062405">}</span><span class="op" id="8062406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8062409">var</span>&nbsp;<span class="ident" id="8062413">t3</span>&nbsp;<span class="ident" id="8062416">Type3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8062423">if</span>&nbsp;<span class="ident" id="8062426">err</span>&nbsp;<span class="op" id="8062430">:=</span>&nbsp;<span class="ident" id="8062433">encAndDec</span><span class="op" id="8062442">(</span><span class="ident" id="8062443">t3</span><span class="op" id="8062445">,</span>&nbsp;<span class="ident" id="8062447">t3p</span><span class="op" id="8062450">)</span><span class="op" id="8062451">;</span>&nbsp;<span class="ident" id="8062453">err</span>&nbsp;<span class="op" id="8062457">!=</span>&nbsp;<span class="ident" id="8062460">nil</span>&nbsp;<span class="op" id="8062464">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062468">t</span><span class="op" id="8062469">.</span><span class="ident" id="8062470">Error</span><span class="op" id="8062475">(</span><span class="ident" id="8062476">err</span><span class="op" id="8062479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8062482">}</span><br>
<span class="lineno"></span><span class="op" id="8062484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8062487">func</span>&nbsp;<span class="ident" id="8062492">TestValueError</span><span class="op" id="8062506">(</span><span class="ident" id="8062507">t</span>&nbsp;<span class="op" id="8062509">*</span><span class="ident" id="8062510">testing</span><span class="op" id="8062517">.</span><span class="ident" id="8062518">T</span><span class="op" id="8062519">)</span>&nbsp;<span class="op" id="8062521">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8062524">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8062552">type</span>&nbsp;<span class="ident" id="8062557">Type4</span>&nbsp;<span class="keyword" id="8062563">struct</span>&nbsp;<span class="op" id="8062570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062574">A</span>&nbsp;<span class="builtintype" id="8062576">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8062581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062584">t4p</span>&nbsp;<span class="op" id="8062588">:=</span>&nbsp;<span class="op" id="8062591">&amp;</span><span class="ident" id="8062592">Type4</span><span class="op" id="8062597">{</span><span class="num" id="8062598">3</span><span class="op" id="8062599">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8062602">var</span>&nbsp;<span class="ident" id="8062606">t4</span>&nbsp;<span class="ident" id="8062609">Type4</span>&nbsp;<span class="comment" id="8062615">//&nbsp;note:&nbsp;not&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8062640">if</span>&nbsp;<span class="ident" id="8062643">err</span>&nbsp;<span class="op" id="8062647">:=</span>&nbsp;<span class="ident" id="8062650">encAndDec</span><span class="op" id="8062659">(</span><span class="ident" id="8062660">t4p</span><span class="op" id="8062663">,</span>&nbsp;<span class="ident" id="8062665">t4</span><span class="op" id="8062667">)</span><span class="op" id="8062668">;</span>&nbsp;<span class="ident" id="8062670">err</span>&nbsp;<span class="op" id="8062674">==</span>&nbsp;<span class="ident" id="8062677">nil</span>&nbsp;<span class="op" id="8062681">||</span>&nbsp;<span class="ident" id="8062684">strings</span><span class="op" id="8062691">.</span><span class="ident" id="8062692">Index</span><span class="op" id="8062697">(</span><span class="ident" id="8062698">err</span><span class="op" id="8062701">.</span><span class="ident" id="8062702">Error</span><span class="op" id="8062707">(</span><span class="op" id="8062708">)</span><span class="op" id="8062709">,</span>&nbsp;<span class="string" id="8062711">&#34;pointer&#34;</span><span class="op" id="8062720">)</span>&nbsp;<span class="op" id="8062722">&lt;</span>&nbsp;<span class="num" id="8062724">0</span>&nbsp;<span class="op" id="8062726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062730">t</span><span class="op" id="8062731">.</span><span class="ident" id="8062732">Error</span><span class="op" id="8062737">(</span><span class="string" id="8062738">&#34;expected&nbsp;error&nbsp;about&nbsp;pointer;&nbsp;got&#34;</span><span class="op" id="8062773">,</span>&nbsp;<span class="ident" id="8062775">err</span><span class="op" id="8062778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8062781">}</span><br>
<span class="lineno"></span><span class="op" id="8062783">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="keyword" id="8062786">func</span>&nbsp;<span class="ident" id="8062791">TestArray</span><span class="op" id="8062800">(</span><span class="ident" id="8062801">t</span>&nbsp;<span class="op" id="8062803">*</span><span class="ident" id="8062804">testing</span><span class="op" id="8062811">.</span><span class="ident" id="8062812">T</span><span class="op" id="8062813">)</span>&nbsp;<span class="op" id="8062815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8062818">type</span>&nbsp;<span class="ident" id="8062823">Type5</span>&nbsp;<span class="keyword" id="8062829">struct</span>&nbsp;<span class="op" id="8062836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062840">A</span>&nbsp;<span class="op" id="8062842">[</span><span class="num" id="8062843">3</span><span class="op" id="8062844">]</span><span class="builtintype" id="8062845">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062854">B</span>&nbsp;<span class="op" id="8062856">[</span><span class="num" id="8062857">3</span><span class="op" id="8062858">]</span><span class="builtintype" id="8062859">byte</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8062865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8062868">type</span>&nbsp;<span class="ident" id="8062873">Type6</span>&nbsp;<span class="keyword" id="8062879">struct</span>&nbsp;<span class="op" id="8062886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062890">A</span>&nbsp;<span class="op" id="8062892">[</span><span class="num" id="8062893">2</span><span class="op" id="8062894">]</span><span class="builtintype" id="8062895">string</span>&nbsp;<span class="comment" id="8062902">//&nbsp;can&#39;t&nbsp;hold&nbsp;t5.a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8062922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062925">t5</span>&nbsp;<span class="op" id="8062928">:=</span>&nbsp;<span class="ident" id="8062931">Type5</span><span class="op" id="8062936">{</span><span class="op" id="8062937">[</span><span class="num" id="8062938">3</span><span class="op" id="8062939">]</span><span class="builtintype" id="8062940">string</span><span class="op" id="8062946">{</span><span class="string" id="8062947">&#34;hello&#34;</span><span class="op" id="8062954">,</span>&nbsp;<span class="string" id="8062956">&#34;,&#34;</span><span class="op" id="8062959">,</span>&nbsp;<span class="string" id="8062961">&#34;world&#34;</span><span class="op" id="8062968">}</span><span class="op" id="8062969">,</span>&nbsp;<span class="op" id="8062971">[</span><span class="num" id="8062972">3</span><span class="op" id="8062973">]</span><span class="builtintype" id="8062974">byte</span><span class="op" id="8062978">{</span><span class="num" id="8062979">1</span><span class="op" id="8062980">,</span>&nbsp;<span class="num" id="8062982">2</span><span class="op" id="8062983">,</span>&nbsp;<span class="num" id="8062985">3</span><span class="op" id="8062986">}</span><span class="op" id="8062987">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8062990">var</span>&nbsp;<span class="ident" id="8062994">t5p</span>&nbsp;<span class="ident" id="8062998">Type5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063005">if</span>&nbsp;<span class="ident" id="8063008">err</span>&nbsp;<span class="op" id="8063012">:=</span>&nbsp;<span class="ident" id="8063015">encAndDec</span><span class="op" id="8063024">(</span><span class="ident" id="8063025">t5</span><span class="op" id="8063027">,</span>&nbsp;<span class="op" id="8063029">&amp;</span><span class="ident" id="8063030">t5p</span><span class="op" id="8063033">)</span><span class="op" id="8063034">;</span>&nbsp;<span class="ident" id="8063036">err</span>&nbsp;<span class="op" id="8063040">!=</span>&nbsp;<span class="ident" id="8063043">nil</span>&nbsp;<span class="op" id="8063047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063051">t</span><span class="op" id="8063052">.</span><span class="ident" id="8063053">Error</span><span class="op" id="8063058">(</span><span class="ident" id="8063059">err</span><span class="op" id="8063062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8063065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063068">var</span>&nbsp;<span class="ident" id="8063072">t6</span>&nbsp;<span class="ident" id="8063075">Type6</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063082">if</span>&nbsp;<span class="ident" id="8063085">err</span>&nbsp;<span class="op" id="8063089">:=</span>&nbsp;<span class="ident" id="8063092">encAndDec</span><span class="op" id="8063101">(</span><span class="ident" id="8063102">t5</span><span class="op" id="8063104">,</span>&nbsp;<span class="op" id="8063106">&amp;</span><span class="ident" id="8063107">t6</span><span class="op" id="8063109">)</span><span class="op" id="8063110">;</span>&nbsp;<span class="ident" id="8063112">err</span>&nbsp;<span class="op" id="8063116">==</span>&nbsp;<span class="ident" id="8063119">nil</span>&nbsp;<span class="op" id="8063123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063127">t</span><span class="op" id="8063128">.</span><span class="ident" id="8063129">Error</span><span class="op" id="8063134">(</span><span class="string" id="8063135">&#34;should&nbsp;fail&nbsp;with&nbsp;mismatched&nbsp;array&nbsp;sizes&#34;</span><span class="op" id="8063176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8063179">}</span><br>
<span class="lineno"></span><span class="op" id="8063181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="8063184">func</span>&nbsp;<span class="ident" id="8063189">TestRecursiveMapType</span><span class="op" id="8063209">(</span><span class="ident" id="8063210">t</span>&nbsp;<span class="op" id="8063212">*</span><span class="ident" id="8063213">testing</span><span class="op" id="8063220">.</span><span class="ident" id="8063221">T</span><span class="op" id="8063222">)</span>&nbsp;<span class="op" id="8063224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063227">type</span>&nbsp;<span class="ident" id="8063232">recursiveMap</span>&nbsp;<span class="keyword" id="8063245">map</span><span class="op" id="8063248">[</span><span class="builtintype" id="8063249">string</span><span class="op" id="8063255">]</span><span class="ident" id="8063256">recursiveMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063270">r1</span>&nbsp;<span class="op" id="8063273">:=</span>&nbsp;<span class="ident" id="8063276">recursiveMap</span><span class="op" id="8063288">{</span><span class="string" id="8063289">&#34;A&#34;</span><span class="op" id="8063292">:</span>&nbsp;<span class="ident" id="8063294">recursiveMap</span><span class="op" id="8063306">{</span><span class="string" id="8063307">&#34;B&#34;</span><span class="op" id="8063310">:</span>&nbsp;<span class="ident" id="8063312">nil</span><span class="op" id="8063315">,</span>&nbsp;<span class="string" id="8063317">&#34;C&#34;</span><span class="op" id="8063320">:</span>&nbsp;<span class="ident" id="8063322">nil</span><span class="op" id="8063325">}</span><span class="op" id="8063326">,</span>&nbsp;<span class="string" id="8063328">&#34;D&#34;</span><span class="op" id="8063331">:</span>&nbsp;<span class="ident" id="8063333">nil</span><span class="op" id="8063336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063339">r2</span>&nbsp;<span class="op" id="8063342">:=</span>&nbsp;<span class="builtinfunc" id="8063345">make</span><span class="op" id="8063349">(</span><span class="ident" id="8063350">recursiveMap</span><span class="op" id="8063362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063365">if</span>&nbsp;<span class="ident" id="8063368">err</span>&nbsp;<span class="op" id="8063372">:=</span>&nbsp;<span class="ident" id="8063375">encAndDec</span><span class="op" id="8063384">(</span><span class="ident" id="8063385">r1</span><span class="op" id="8063387">,</span>&nbsp;<span class="op" id="8063389">&amp;</span><span class="ident" id="8063390">r2</span><span class="op" id="8063392">)</span><span class="op" id="8063393">;</span>&nbsp;<span class="ident" id="8063395">err</span>&nbsp;<span class="op" id="8063399">!=</span>&nbsp;<span class="ident" id="8063402">nil</span>&nbsp;<span class="op" id="8063406">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063410">t</span><span class="op" id="8063411">.</span><span class="ident" id="8063412">Error</span><span class="op" id="8063417">(</span><span class="ident" id="8063418">err</span><span class="op" id="8063421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8063424">}</span><br>
<span class="lineno"></span><span class="op" id="8063426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8063429">func</span>&nbsp;<span class="ident" id="8063434">TestRecursiveSliceType</span><span class="op" id="8063456">(</span><span class="ident" id="8063457">t</span>&nbsp;<span class="op" id="8063459">*</span><span class="ident" id="8063460">testing</span><span class="op" id="8063467">.</span><span class="ident" id="8063468">T</span><span class="op" id="8063469">)</span>&nbsp;<span class="op" id="8063471">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063474">type</span>&nbsp;<span class="ident" id="8063479">recursiveSlice</span>&nbsp;<span class="op" id="8063494">[</span><span class="op" id="8063495">]</span><span class="ident" id="8063496">recursiveSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063512">r1</span>&nbsp;<span class="op" id="8063515">:=</span>&nbsp;<span class="ident" id="8063518">recursiveSlice</span><span class="op" id="8063532">{</span><span class="num" id="8063533">0</span><span class="op" id="8063534">:</span>&nbsp;<span class="ident" id="8063536">recursiveSlice</span><span class="op" id="8063550">{</span><span class="num" id="8063551">0</span><span class="op" id="8063552">:</span>&nbsp;<span class="ident" id="8063554">nil</span><span class="op" id="8063557">}</span><span class="op" id="8063558">,</span>&nbsp;<span class="num" id="8063560">1</span><span class="op" id="8063561">:</span>&nbsp;<span class="ident" id="8063563">nil</span><span class="op" id="8063566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063569">r2</span>&nbsp;<span class="op" id="8063572">:=</span>&nbsp;<span class="builtinfunc" id="8063575">make</span><span class="op" id="8063579">(</span><span class="ident" id="8063580">recursiveSlice</span><span class="op" id="8063594">,</span>&nbsp;<span class="num" id="8063596">0</span><span class="op" id="8063597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063600">if</span>&nbsp;<span class="ident" id="8063603">err</span>&nbsp;<span class="op" id="8063607">:=</span>&nbsp;<span class="ident" id="8063610">encAndDec</span><span class="op" id="8063619">(</span><span class="ident" id="8063620">r1</span><span class="op" id="8063622">,</span>&nbsp;<span class="op" id="8063624">&amp;</span><span class="ident" id="8063625">r2</span><span class="op" id="8063627">)</span><span class="op" id="8063628">;</span>&nbsp;<span class="ident" id="8063630">err</span>&nbsp;<span class="op" id="8063634">!=</span>&nbsp;<span class="ident" id="8063637">nil</span>&nbsp;<span class="op" id="8063641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063645">t</span><span class="op" id="8063646">.</span><span class="ident" id="8063647">Error</span><span class="op" id="8063652">(</span><span class="ident" id="8063653">err</span><span class="op" id="8063656">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8063659">}</span><br>
<span class="lineno"></span><span class="op" id="8063661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8063664">//&nbsp;Regression&nbsp;test&nbsp;for&nbsp;bug:&nbsp;must&nbsp;send&nbsp;zero&nbsp;values&nbsp;inside&nbsp;arrays</span><br>
<span class="lineno"></span><span class="keyword" id="8063728">func</span>&nbsp;<span class="ident" id="8063733">TestDefaultsInArray</span><span class="op" id="8063752">(</span><span class="ident" id="8063753">t</span>&nbsp;<span class="op" id="8063755">*</span><span class="ident" id="8063756">testing</span><span class="op" id="8063763">.</span><span class="ident" id="8063764">T</span><span class="op" id="8063765">)</span>&nbsp;<span class="op" id="8063767">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063770">type</span>&nbsp;<span class="ident" id="8063775">Type7</span>&nbsp;<span class="keyword" id="8063781">struct</span>&nbsp;<span class="op" id="8063788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063792">B</span>&nbsp;<span class="op" id="8063794">[</span><span class="op" id="8063795">]</span><span class="builtintype" id="8063796">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063803">I</span>&nbsp;<span class="op" id="8063805">[</span><span class="op" id="8063806">]</span><span class="builtintype" id="8063807">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063813">S</span>&nbsp;<span class="op" id="8063815">[</span><span class="op" id="8063816">]</span><span class="builtintype" id="8063817">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063826">F</span>&nbsp;<span class="op" id="8063828">[</span><span class="op" id="8063829">]</span><span class="builtintype" id="8063830">float64</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8063839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063842">t7</span>&nbsp;<span class="op" id="8063845">:=</span>&nbsp;<span class="ident" id="8063848">Type7</span><span class="op" id="8063853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8063857">[</span><span class="op" id="8063858">]</span><span class="builtintype" id="8063859">bool</span><span class="op" id="8063863">{</span><span class="builtintype" id="8063864">false</span><span class="op" id="8063869">,</span>&nbsp;<span class="builtintype" id="8063871">false</span><span class="op" id="8063876">,</span>&nbsp;<span class="builtintype" id="8063878">true</span><span class="op" id="8063882">}</span><span class="op" id="8063883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8063887">[</span><span class="op" id="8063888">]</span><span class="builtintype" id="8063889">int</span><span class="op" id="8063892">{</span><span class="num" id="8063893">0</span><span class="op" id="8063894">,</span>&nbsp;<span class="num" id="8063896">0</span><span class="op" id="8063897">,</span>&nbsp;<span class="num" id="8063899">1</span><span class="op" id="8063900">}</span><span class="op" id="8063901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8063905">[</span><span class="op" id="8063906">]</span><span class="builtintype" id="8063907">string</span><span class="op" id="8063913">{</span><span class="string" id="8063914">&#34;hi&#34;</span><span class="op" id="8063918">,</span>&nbsp;<span class="string" id="8063920">&#34;&#34;</span><span class="op" id="8063922">,</span>&nbsp;<span class="string" id="8063924">&#34;there&#34;</span><span class="op" id="8063931">}</span><span class="op" id="8063932">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8063936">[</span><span class="op" id="8063937">]</span><span class="builtintype" id="8063938">float64</span><span class="op" id="8063945">{</span><span class="num" id="8063946">0</span><span class="op" id="8063947">,</span>&nbsp;<span class="num" id="8063949">0</span><span class="op" id="8063950">,</span>&nbsp;<span class="num" id="8063952">1</span><span class="op" id="8063953">}</span><span class="op" id="8063954">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8063957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063960">var</span>&nbsp;<span class="ident" id="8063964">t7p</span>&nbsp;<span class="ident" id="8063968">Type7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063975">if</span>&nbsp;<span class="ident" id="8063978">err</span>&nbsp;<span class="op" id="8063982">:=</span>&nbsp;<span class="ident" id="8063985">encAndDec</span><span class="op" id="8063994">(</span><span class="ident" id="8063995">t7</span><span class="op" id="8063997">,</span>&nbsp;<span class="op" id="8063999">&amp;</span><span class="ident" id="8064000">t7p</span><span class="op" id="8064003">)</span><span class="op" id="8064004">;</span>&nbsp;<span class="ident" id="8064006">err</span>&nbsp;<span class="op" id="8064010">!=</span>&nbsp;<span class="ident" id="8064013">nil</span>&nbsp;<span class="op" id="8064017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064021">t</span><span class="op" id="8064022">.</span><span class="ident" id="8064023">Error</span><span class="op" id="8064028">(</span><span class="ident" id="8064029">err</span><span class="op" id="8064032">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8064035">}</span><br>
<span class="lineno"></span><span class="op" id="8064037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8064040">var</span>&nbsp;<span class="ident" id="8064044">testInt</span>&nbsp;<span class="builtintype" id="8064052">int</span><br>
<span class="lineno"></span><span class="keyword" id="8064056">var</span>&nbsp;<span class="ident" id="8064060">testFloat32</span>&nbsp;<span class="builtintype" id="8064072">float32</span><br>
<span class="lineno">365</span><span class="keyword" id="8064080">var</span>&nbsp;<span class="ident" id="8064084">testString</span>&nbsp;<span class="builtintype" id="8064095">string</span><br>
<span class="lineno"></span><span class="keyword" id="8064102">var</span>&nbsp;<span class="ident" id="8064106">testSlice</span>&nbsp;<span class="op" id="8064116">[</span><span class="op" id="8064117">]</span><span class="builtintype" id="8064118">string</span><br>
<span class="lineno"></span><span class="keyword" id="8064125">var</span>&nbsp;<span class="ident" id="8064129">testMap</span>&nbsp;<span class="keyword" id="8064137">map</span><span class="op" id="8064140">[</span><span class="builtintype" id="8064141">string</span><span class="op" id="8064147">]</span><span class="builtintype" id="8064148">int</span><br>
<span class="lineno"></span><span class="keyword" id="8064152">var</span>&nbsp;<span class="ident" id="8064156">testArray</span>&nbsp;<span class="op" id="8064166">[</span><span class="num" id="8064167">7</span><span class="op" id="8064168">]</span><span class="builtintype" id="8064169">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="8064174">type</span>&nbsp;<span class="ident" id="8064179">SingleTest</span>&nbsp;<span class="keyword" id="8064190">struct</span>&nbsp;<span class="op" id="8064197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064200">in</span>&nbsp;&nbsp;<span class="keyword" id="8064204">interface</span><span class="op" id="8064213">{</span><span class="op" id="8064214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064217">out</span>&nbsp;<span class="keyword" id="8064221">interface</span><span class="op" id="8064230">{</span><span class="op" id="8064231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064234">err</span>&nbsp;<span class="builtintype" id="8064238">string</span><br>
<span class="lineno"></span><span class="op" id="8064245">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="8064248">var</span>&nbsp;<span class="ident" id="8064252">singleTests</span>&nbsp;<span class="op" id="8064264">=</span>&nbsp;<span class="op" id="8064266">[</span><span class="op" id="8064267">]</span><span class="ident" id="8064268">SingleTest</span><span class="op" id="8064278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8064281">{</span><span class="num" id="8064282">17</span><span class="op" id="8064284">,</span>&nbsp;<span class="op" id="8064286">&amp;</span><span class="ident" id="8064287">testInt</span><span class="op" id="8064294">,</span>&nbsp;<span class="string" id="8064296">&#34;&#34;</span><span class="op" id="8064298">}</span><span class="op" id="8064299">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8064302">{</span><span class="builtintype" id="8064303">float32</span><span class="op" id="8064310">(</span><span class="num" id="8064311">17.5</span><span class="op" id="8064315">)</span><span class="op" id="8064316">,</span>&nbsp;<span class="op" id="8064318">&amp;</span><span class="ident" id="8064319">testFloat32</span><span class="op" id="8064330">,</span>&nbsp;<span class="string" id="8064332">&#34;&#34;</span><span class="op" id="8064334">}</span><span class="op" id="8064335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8064338">{</span><span class="string" id="8064339">&#34;bike&nbsp;shed&#34;</span><span class="op" id="8064350">,</span>&nbsp;<span class="op" id="8064352">&amp;</span><span class="ident" id="8064353">testString</span><span class="op" id="8064363">,</span>&nbsp;<span class="string" id="8064365">&#34;&#34;</span><span class="op" id="8064367">}</span><span class="op" id="8064368">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8064371">{</span><span class="op" id="8064372">[</span><span class="op" id="8064373">]</span><span class="builtintype" id="8064374">string</span><span class="op" id="8064380">{</span><span class="string" id="8064381">&#34;bike&#34;</span><span class="op" id="8064387">,</span>&nbsp;<span class="string" id="8064389">&#34;shed&#34;</span><span class="op" id="8064395">,</span>&nbsp;<span class="string" id="8064397">&#34;paint&#34;</span><span class="op" id="8064404">,</span>&nbsp;<span class="string" id="8064406">&#34;color&#34;</span><span class="op" id="8064413">}</span><span class="op" id="8064414">,</span>&nbsp;<span class="op" id="8064416">&amp;</span><span class="ident" id="8064417">testSlice</span><span class="op" id="8064426">,</span>&nbsp;<span class="string" id="8064428">&#34;&#34;</span><span class="op" id="8064430">}</span><span class="op" id="8064431">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8064434">{</span><span class="keyword" id="8064435">map</span><span class="op" id="8064438">[</span><span class="builtintype" id="8064439">string</span><span class="op" id="8064445">]</span><span class="builtintype" id="8064446">int</span><span class="op" id="8064449">{</span><span class="string" id="8064450">&#34;seven&#34;</span><span class="op" id="8064457">:</span>&nbsp;<span class="num" id="8064459">7</span><span class="op" id="8064460">,</span>&nbsp;<span class="string" id="8064462">&#34;twelve&#34;</span><span class="op" id="8064470">:</span>&nbsp;<span class="num" id="8064472">12</span><span class="op" id="8064474">}</span><span class="op" id="8064475">,</span>&nbsp;<span class="op" id="8064477">&amp;</span><span class="ident" id="8064478">testMap</span><span class="op" id="8064485">,</span>&nbsp;<span class="string" id="8064487">&#34;&#34;</span><span class="op" id="8064489">}</span><span class="op" id="8064490">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8064493">{</span><span class="op" id="8064494">[</span><span class="num" id="8064495">7</span><span class="op" id="8064496">]</span><span class="builtintype" id="8064497">int</span><span class="op" id="8064500">{</span><span class="num" id="8064501">4</span><span class="op" id="8064502">,</span>&nbsp;<span class="num" id="8064504">55</span><span class="op" id="8064506">,</span>&nbsp;<span class="num" id="8064508">0</span><span class="op" id="8064509">,</span>&nbsp;<span class="num" id="8064511">0</span><span class="op" id="8064512">,</span>&nbsp;<span class="num" id="8064514">0</span><span class="op" id="8064515">,</span>&nbsp;<span class="num" id="8064517">0</span><span class="op" id="8064518">,</span>&nbsp;<span class="num" id="8064520">0</span><span class="op" id="8064521">}</span><span class="op" id="8064522">,</span>&nbsp;<span class="op" id="8064524">&amp;</span><span class="ident" id="8064525">testArray</span><span class="op" id="8064534">,</span>&nbsp;<span class="string" id="8064536">&#34;&#34;</span><span class="op" id="8064538">}</span><span class="op" id="8064539">,</span>&nbsp;<span class="comment" id="8064541">//&nbsp;case&nbsp;that&nbsp;once&nbsp;triggered&nbsp;a&nbsp;bug</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8064576">{</span><span class="op" id="8064577">[</span><span class="num" id="8064578">7</span><span class="op" id="8064579">]</span><span class="builtintype" id="8064580">int</span><span class="op" id="8064583">{</span><span class="num" id="8064584">4</span><span class="op" id="8064585">,</span>&nbsp;<span class="num" id="8064587">55</span><span class="op" id="8064589">,</span>&nbsp;<span class="num" id="8064591">1</span><span class="op" id="8064592">,</span>&nbsp;<span class="num" id="8064594">44</span><span class="op" id="8064596">,</span>&nbsp;<span class="num" id="8064598">22</span><span class="op" id="8064600">,</span>&nbsp;<span class="num" id="8064602">66</span><span class="op" id="8064604">,</span>&nbsp;<span class="num" id="8064606">1234</span><span class="op" id="8064610">}</span><span class="op" id="8064611">,</span>&nbsp;<span class="op" id="8064613">&amp;</span><span class="ident" id="8064614">testArray</span><span class="op" id="8064623">,</span>&nbsp;<span class="string" id="8064625">&#34;&#34;</span><span class="op" id="8064627">}</span><span class="op" id="8064628">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8064632">//&nbsp;Decode&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8064650">{</span><span class="num" id="8064651">172</span><span class="op" id="8064654">,</span>&nbsp;<span class="op" id="8064656">&amp;</span><span class="ident" id="8064657">testFloat32</span><span class="op" id="8064668">,</span>&nbsp;<span class="string" id="8064670">&#34;type&#34;</span><span class="op" id="8064676">}</span><span class="op" id="8064677">,</span><br>
<span class="lineno"></span><span class="op" id="8064679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8064682">func</span>&nbsp;<span class="ident" id="8064687">TestSingletons</span><span class="op" id="8064701">(</span><span class="ident" id="8064702">t</span>&nbsp;<span class="op" id="8064704">*</span><span class="ident" id="8064705">testing</span><span class="op" id="8064712">.</span><span class="ident" id="8064713">T</span><span class="op" id="8064714">)</span>&nbsp;<span class="op" id="8064716">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064719">b</span>&nbsp;<span class="op" id="8064721">:=</span>&nbsp;<span class="builtinfunc" id="8064724">new</span><span class="op" id="8064727">(</span><span class="ident" id="8064728">bytes</span><span class="op" id="8064733">.</span><span class="ident" id="8064734">Buffer</span><span class="op" id="8064740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064743">enc</span>&nbsp;<span class="op" id="8064747">:=</span>&nbsp;<span class="ident" id="8064750">NewEncoder</span><span class="op" id="8064760">(</span><span class="ident" id="8064761">b</span><span class="op" id="8064762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064765">dec</span>&nbsp;<span class="op" id="8064769">:=</span>&nbsp;<span class="ident" id="8064772">NewDecoder</span><span class="op" id="8064782">(</span><span class="ident" id="8064783">b</span><span class="op" id="8064784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064787">for</span>&nbsp;<span class="ident" id="8064791">_</span><span class="op" id="8064792">,</span>&nbsp;<span class="ident" id="8064794">test</span>&nbsp;<span class="op" id="8064799">:=</span>&nbsp;<span class="keyword" id="8064802">range</span>&nbsp;<span class="ident" id="8064808">singleTests</span>&nbsp;<span class="op" id="8064820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064824">b</span><span class="op" id="8064825">.</span><span class="ident" id="8064826">Reset</span><span class="op" id="8064831">(</span><span class="op" id="8064832">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064836">err</span>&nbsp;<span class="op" id="8064840">:=</span>&nbsp;<span class="ident" id="8064843">enc</span><span class="op" id="8064846">.</span><span class="ident" id="8064847">Encode</span><span class="op" id="8064853">(</span><span class="ident" id="8064854">test</span><span class="op" id="8064858">.</span><span class="ident" id="8064859">in</span><span class="op" id="8064861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064865">if</span>&nbsp;<span class="ident" id="8064868">err</span>&nbsp;<span class="op" id="8064872">!=</span>&nbsp;<span class="ident" id="8064875">nil</span>&nbsp;<span class="op" id="8064879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064884">t</span><span class="op" id="8064885">.</span><span class="ident" id="8064886">Errorf</span><span class="op" id="8064892">(</span><span class="string" id="8064893">&#34;error&nbsp;encoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="8064916">,</span>&nbsp;<span class="ident" id="8064918">test</span><span class="op" id="8064922">.</span><span class="ident" id="8064923">in</span><span class="op" id="8064925">,</span>&nbsp;<span class="ident" id="8064927">err</span><span class="op" id="8064930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064935">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8064946">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064950">err</span>&nbsp;<span class="op" id="8064954">=</span>&nbsp;<span class="ident" id="8064956">dec</span><span class="op" id="8064959">.</span><span class="ident" id="8064960">Decode</span><span class="op" id="8064966">(</span><span class="ident" id="8064967">test</span><span class="op" id="8064971">.</span><span class="ident" id="8064972">out</span><span class="op" id="8064975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064979">switch</span>&nbsp;<span class="op" id="8064986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064990">case</span>&nbsp;<span class="ident" id="8064995">err</span>&nbsp;<span class="op" id="8064999">!=</span>&nbsp;<span class="ident" id="8065002">nil</span>&nbsp;<span class="op" id="8065006">&amp;&amp;</span>&nbsp;<span class="ident" id="8065009">test</span><span class="op" id="8065013">.</span><span class="ident" id="8065014">err</span>&nbsp;<span class="op" id="8065018">==</span>&nbsp;<span class="string" id="8065021">&#34;&#34;</span><span class="op" id="8065023">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065028">t</span><span class="op" id="8065029">.</span><span class="ident" id="8065030">Errorf</span><span class="op" id="8065036">(</span><span class="string" id="8065037">&#34;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="8065060">,</span>&nbsp;<span class="ident" id="8065062">test</span><span class="op" id="8065066">.</span><span class="ident" id="8065067">in</span><span class="op" id="8065069">,</span>&nbsp;<span class="ident" id="8065071">err</span><span class="op" id="8065074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065079">continue</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065090">case</span>&nbsp;<span class="ident" id="8065095">err</span>&nbsp;<span class="op" id="8065099">==</span>&nbsp;<span class="ident" id="8065102">nil</span>&nbsp;<span class="op" id="8065106">&amp;&amp;</span>&nbsp;<span class="ident" id="8065109">test</span><span class="op" id="8065113">.</span><span class="ident" id="8065114">err</span>&nbsp;<span class="op" id="8065118">!=</span>&nbsp;<span class="string" id="8065121">&#34;&#34;</span><span class="op" id="8065123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065128">t</span><span class="op" id="8065129">.</span><span class="ident" id="8065130">Errorf</span><span class="op" id="8065136">(</span><span class="string" id="8065137">&#34;expected&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="8065169">,</span>&nbsp;<span class="ident" id="8065171">test</span><span class="op" id="8065175">.</span><span class="ident" id="8065176">in</span><span class="op" id="8065178">,</span>&nbsp;<span class="ident" id="8065180">test</span><span class="op" id="8065184">.</span><span class="ident" id="8065185">err</span><span class="op" id="8065188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065193">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065204">case</span>&nbsp;<span class="ident" id="8065209">err</span>&nbsp;<span class="op" id="8065213">!=</span>&nbsp;<span class="ident" id="8065216">nil</span>&nbsp;<span class="op" id="8065220">&amp;&amp;</span>&nbsp;<span class="ident" id="8065223">test</span><span class="op" id="8065227">.</span><span class="ident" id="8065228">err</span>&nbsp;<span class="op" id="8065232">!=</span>&nbsp;<span class="string" id="8065235">&#34;&#34;</span><span class="op" id="8065237">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065242">if</span>&nbsp;<span class="ident" id="8065245">strings</span><span class="op" id="8065252">.</span><span class="ident" id="8065253">Index</span><span class="op" id="8065258">(</span><span class="ident" id="8065259">err</span><span class="op" id="8065262">.</span><span class="ident" id="8065263">Error</span><span class="op" id="8065268">(</span><span class="op" id="8065269">)</span><span class="op" id="8065270">,</span>&nbsp;<span class="ident" id="8065272">test</span><span class="op" id="8065276">.</span><span class="ident" id="8065277">err</span><span class="op" id="8065280">)</span>&nbsp;<span class="op" id="8065282">&lt;</span>&nbsp;<span class="num" id="8065284">0</span>&nbsp;<span class="op" id="8065286">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065292">t</span><span class="op" id="8065293">.</span><span class="ident" id="8065294">Errorf</span><span class="op" id="8065300">(</span><span class="string" id="8065301">&#34;wrong&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;wanted&nbsp;%s,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8065345">,</span>&nbsp;<span class="ident" id="8065347">test</span><span class="op" id="8065351">.</span><span class="ident" id="8065352">in</span><span class="op" id="8065354">,</span>&nbsp;<span class="ident" id="8065356">test</span><span class="op" id="8065360">.</span><span class="ident" id="8065361">err</span><span class="op" id="8065364">,</span>&nbsp;<span class="ident" id="8065366">err</span><span class="op" id="8065369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8065374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065379">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8065390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8065394">//&nbsp;Get&nbsp;rid&nbsp;of&nbsp;the&nbsp;pointer&nbsp;in&nbsp;the&nbsp;rhs</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065433">val</span>&nbsp;<span class="op" id="8065437">:=</span>&nbsp;<span class="ident" id="8065440">reflect</span><span class="op" id="8065447">.</span><span class="ident" id="8065448">ValueOf</span><span class="op" id="8065455">(</span><span class="ident" id="8065456">test</span><span class="op" id="8065460">.</span><span class="ident" id="8065461">out</span><span class="op" id="8065464">)</span><span class="op" id="8065465">.</span><span class="ident" id="8065466">Elem</span><span class="op" id="8065470">(</span><span class="op" id="8065471">)</span><span class="op" id="8065472">.</span><span class="ident" id="8065473">Interface</span><span class="op" id="8065482">(</span><span class="op" id="8065483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065487">if</span>&nbsp;<span class="op" id="8065490">!</span><span class="ident" id="8065491">reflect</span><span class="op" id="8065498">.</span><span class="ident" id="8065499">DeepEqual</span><span class="op" id="8065508">(</span><span class="ident" id="8065509">test</span><span class="op" id="8065513">.</span><span class="ident" id="8065514">in</span><span class="op" id="8065516">,</span>&nbsp;<span class="ident" id="8065518">val</span><span class="op" id="8065521">)</span>&nbsp;<span class="op" id="8065523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065528">t</span><span class="op" id="8065529">.</span><span class="ident" id="8065530">Errorf</span><span class="op" id="8065536">(</span><span class="string" id="8065537">&#34;decoding&nbsp;singleton:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8065577">,</span>&nbsp;<span class="ident" id="8065579">test</span><span class="op" id="8065583">.</span><span class="ident" id="8065584">in</span><span class="op" id="8065586">,</span>&nbsp;<span class="ident" id="8065588">val</span><span class="op" id="8065591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8065595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8065598">}</span><br>
<span class="lineno">420</span><span class="op" id="8065600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8065603">func</span>&nbsp;<span class="ident" id="8065608">TestStructNonStruct</span><span class="op" id="8065627">(</span><span class="ident" id="8065628">t</span>&nbsp;<span class="op" id="8065630">*</span><span class="ident" id="8065631">testing</span><span class="op" id="8065638">.</span><span class="ident" id="8065639">T</span><span class="op" id="8065640">)</span>&nbsp;<span class="op" id="8065642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065645">type</span>&nbsp;<span class="ident" id="8065650">Struct</span>&nbsp;<span class="keyword" id="8065657">struct</span>&nbsp;<span class="op" id="8065664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065668">A</span>&nbsp;<span class="builtintype" id="8065670">string</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8065678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065681">type</span>&nbsp;<span class="ident" id="8065686">NonStruct</span>&nbsp;<span class="builtintype" id="8065696">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065704">s</span>&nbsp;<span class="op" id="8065706">:=</span>&nbsp;<span class="ident" id="8065709">Struct</span><span class="op" id="8065715">{</span><span class="string" id="8065716">&#34;hello&#34;</span><span class="op" id="8065723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065726">var</span>&nbsp;<span class="ident" id="8065730">sp</span>&nbsp;<span class="ident" id="8065733">Struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065741">if</span>&nbsp;<span class="ident" id="8065744">err</span>&nbsp;<span class="op" id="8065748">:=</span>&nbsp;<span class="ident" id="8065751">encAndDec</span><span class="op" id="8065760">(</span><span class="ident" id="8065761">s</span><span class="op" id="8065762">,</span>&nbsp;<span class="op" id="8065764">&amp;</span><span class="ident" id="8065765">sp</span><span class="op" id="8065767">)</span><span class="op" id="8065768">;</span>&nbsp;<span class="ident" id="8065770">err</span>&nbsp;<span class="op" id="8065774">!=</span>&nbsp;<span class="ident" id="8065777">nil</span>&nbsp;<span class="op" id="8065781">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065785">t</span><span class="op" id="8065786">.</span><span class="ident" id="8065787">Error</span><span class="op" id="8065792">(</span><span class="ident" id="8065793">err</span><span class="op" id="8065796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8065799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065802">var</span>&nbsp;<span class="ident" id="8065806">ns</span>&nbsp;<span class="ident" id="8065809">NonStruct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065820">if</span>&nbsp;<span class="ident" id="8065823">err</span>&nbsp;<span class="op" id="8065827">:=</span>&nbsp;<span class="ident" id="8065830">encAndDec</span><span class="op" id="8065839">(</span><span class="ident" id="8065840">s</span><span class="op" id="8065841">,</span>&nbsp;<span class="op" id="8065843">&amp;</span><span class="ident" id="8065844">ns</span><span class="op" id="8065846">)</span><span class="op" id="8065847">;</span>&nbsp;<span class="ident" id="8065849">err</span>&nbsp;<span class="op" id="8065853">==</span>&nbsp;<span class="ident" id="8065856">nil</span>&nbsp;<span class="op" id="8065860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065864">t</span><span class="op" id="8065865">.</span><span class="ident" id="8065866">Error</span><span class="op" id="8065871">(</span><span class="string" id="8065872">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;struct/non-struct&#34;</span><span class="op" id="8065912">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8065915">}</span>&nbsp;<span class="keyword" id="8065917">else</span>&nbsp;<span class="keyword" id="8065922">if</span>&nbsp;<span class="ident" id="8065925">strings</span><span class="op" id="8065932">.</span><span class="ident" id="8065933">Index</span><span class="op" id="8065938">(</span><span class="ident" id="8065939">err</span><span class="op" id="8065942">.</span><span class="ident" id="8065943">Error</span><span class="op" id="8065948">(</span><span class="op" id="8065949">)</span><span class="op" id="8065950">,</span>&nbsp;<span class="string" id="8065952">&#34;type&#34;</span><span class="op" id="8065958">)</span>&nbsp;<span class="op" id="8065960">&lt;</span>&nbsp;<span class="num" id="8065962">0</span>&nbsp;<span class="op" id="8065964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065968">t</span><span class="op" id="8065969">.</span><span class="ident" id="8065970">Error</span><span class="op" id="8065975">(</span><span class="string" id="8065976">&#34;for&nbsp;struct/non-struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8066024">,</span>&nbsp;<span class="ident" id="8066026">err</span><span class="op" id="8066029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8066035">//&nbsp;Now&nbsp;try&nbsp;the&nbsp;other&nbsp;way</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8066061">var</span>&nbsp;<span class="ident" id="8066065">nsp</span>&nbsp;<span class="ident" id="8066069">NonStruct</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8066080">if</span>&nbsp;<span class="ident" id="8066083">err</span>&nbsp;<span class="op" id="8066087">:=</span>&nbsp;<span class="ident" id="8066090">encAndDec</span><span class="op" id="8066099">(</span><span class="ident" id="8066100">ns</span><span class="op" id="8066102">,</span>&nbsp;<span class="op" id="8066104">&amp;</span><span class="ident" id="8066105">nsp</span><span class="op" id="8066108">)</span><span class="op" id="8066109">;</span>&nbsp;<span class="ident" id="8066111">err</span>&nbsp;<span class="op" id="8066115">!=</span>&nbsp;<span class="ident" id="8066118">nil</span>&nbsp;<span class="op" id="8066122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066126">t</span><span class="op" id="8066127">.</span><span class="ident" id="8066128">Error</span><span class="op" id="8066133">(</span><span class="ident" id="8066134">err</span><span class="op" id="8066137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8066143">if</span>&nbsp;<span class="ident" id="8066146">err</span>&nbsp;<span class="op" id="8066150">:=</span>&nbsp;<span class="ident" id="8066153">encAndDec</span><span class="op" id="8066162">(</span><span class="ident" id="8066163">ns</span><span class="op" id="8066165">,</span>&nbsp;<span class="op" id="8066167">&amp;</span><span class="ident" id="8066168">s</span><span class="op" id="8066169">)</span><span class="op" id="8066170">;</span>&nbsp;<span class="ident" id="8066172">err</span>&nbsp;<span class="op" id="8066176">==</span>&nbsp;<span class="ident" id="8066179">nil</span>&nbsp;<span class="op" id="8066183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066187">t</span><span class="op" id="8066188">.</span><span class="ident" id="8066189">Error</span><span class="op" id="8066194">(</span><span class="string" id="8066195">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;non-struct/struct&#34;</span><span class="op" id="8066235">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066238">}</span>&nbsp;<span class="keyword" id="8066240">else</span>&nbsp;<span class="keyword" id="8066245">if</span>&nbsp;<span class="ident" id="8066248">strings</span><span class="op" id="8066255">.</span><span class="ident" id="8066256">Index</span><span class="op" id="8066261">(</span><span class="ident" id="8066262">err</span><span class="op" id="8066265">.</span><span class="ident" id="8066266">Error</span><span class="op" id="8066271">(</span><span class="op" id="8066272">)</span><span class="op" id="8066273">,</span>&nbsp;<span class="string" id="8066275">&#34;type&#34;</span><span class="op" id="8066281">)</span>&nbsp;<span class="op" id="8066283">&lt;</span>&nbsp;<span class="num" id="8066285">0</span>&nbsp;<span class="op" id="8066287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066291">t</span><span class="op" id="8066292">.</span><span class="ident" id="8066293">Error</span><span class="op" id="8066298">(</span><span class="string" id="8066299">&#34;for&nbsp;non-struct/struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8066347">,</span>&nbsp;<span class="ident" id="8066349">err</span><span class="op" id="8066352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066355">}</span><br>
<span class="lineno"></span><span class="op" id="8066357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="8066360">type</span>&nbsp;<span class="ident" id="8066365">interfaceIndirectTestI</span>&nbsp;<span class="keyword" id="8066388">interface</span>&nbsp;<span class="op" id="8066398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066401">F</span><span class="op" id="8066402">(</span><span class="op" id="8066403">)</span>&nbsp;<span class="builtintype" id="8066405">bool</span><br>
<span class="lineno"></span><span class="op" id="8066410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8066413">type</span>&nbsp;<span class="ident" id="8066418">interfaceIndirectTestT</span>&nbsp;<span class="keyword" id="8066441">struct</span><span class="op" id="8066447">{</span><span class="op" id="8066448">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="8066451">func</span>&nbsp;<span class="op" id="8066456">(</span><span class="ident" id="8066457">this</span>&nbsp;<span class="op" id="8066462">*</span><span class="ident" id="8066463">interfaceIndirectTestT</span><span class="op" id="8066485">)</span>&nbsp;<span class="ident" id="8066487">F</span><span class="op" id="8066488">(</span><span class="op" id="8066489">)</span>&nbsp;<span class="builtintype" id="8066491">bool</span>&nbsp;<span class="op" id="8066496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8066499">return</span>&nbsp;<span class="builtintype" id="8066506">true</span><br>
<span class="lineno"></span><span class="op" id="8066511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="comment" id="8066514">//&nbsp;A&nbsp;version&nbsp;of&nbsp;a&nbsp;bug&nbsp;reported&nbsp;on&nbsp;golang-nuts.&nbsp;&nbsp;Also&nbsp;tests&nbsp;top-level</span><br>
<span class="lineno"></span><span class="comment" id="8066583">//&nbsp;slice&nbsp;of&nbsp;interfaces.&nbsp;&nbsp;The&nbsp;issue&nbsp;was&nbsp;registering&nbsp;*T&nbsp;caused&nbsp;T&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="8066652">//&nbsp;stored&nbsp;as&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="8066684">func</span>&nbsp;<span class="ident" id="8066689">TestInterfaceIndirect</span><span class="op" id="8066710">(</span><span class="ident" id="8066711">t</span>&nbsp;<span class="op" id="8066713">*</span><span class="ident" id="8066714">testing</span><span class="op" id="8066721">.</span><span class="ident" id="8066722">T</span><span class="op" id="8066723">)</span>&nbsp;<span class="op" id="8066725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066728">Register</span><span class="op" id="8066736">(</span><span class="op" id="8066737">&amp;</span><span class="ident" id="8066738">interfaceIndirectTestT</span><span class="op" id="8066760">{</span><span class="op" id="8066761">}</span><span class="op" id="8066762">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066765">b</span>&nbsp;<span class="op" id="8066767">:=</span>&nbsp;<span class="builtinfunc" id="8066770">new</span><span class="op" id="8066773">(</span><span class="ident" id="8066774">bytes</span><span class="op" id="8066779">.</span><span class="ident" id="8066780">Buffer</span><span class="op" id="8066786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066789">w</span>&nbsp;<span class="op" id="8066791">:=</span>&nbsp;<span class="op" id="8066794">[</span><span class="op" id="8066795">]</span><span class="ident" id="8066796">interfaceIndirectTestI</span><span class="op" id="8066818">{</span><span class="op" id="8066819">&amp;</span><span class="ident" id="8066820">interfaceIndirectTestT</span><span class="op" id="8066842">{</span><span class="op" id="8066843">}</span><span class="op" id="8066844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066847">err</span>&nbsp;<span class="op" id="8066851">:=</span>&nbsp;<span class="ident" id="8066854">NewEncoder</span><span class="op" id="8066864">(</span><span class="ident" id="8066865">b</span><span class="op" id="8066866">)</span><span class="op" id="8066867">.</span><span class="ident" id="8066868">Encode</span><span class="op" id="8066874">(</span><span class="ident" id="8066875">w</span><span class="op" id="8066876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8066879">if</span>&nbsp;<span class="ident" id="8066882">err</span>&nbsp;<span class="op" id="8066886">!=</span>&nbsp;<span class="ident" id="8066889">nil</span>&nbsp;<span class="op" id="8066893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066897">t</span><span class="op" id="8066898">.</span><span class="ident" id="8066899">Fatal</span><span class="op" id="8066904">(</span><span class="string" id="8066905">&#34;encode&nbsp;error:&#34;</span><span class="op" id="8066920">,</span>&nbsp;<span class="ident" id="8066922">err</span><span class="op" id="8066925">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8066932">var</span>&nbsp;<span class="ident" id="8066936">r</span>&nbsp;<span class="op" id="8066938">[</span><span class="op" id="8066939">]</span><span class="ident" id="8066940">interfaceIndirectTestI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066964">err</span>&nbsp;<span class="op" id="8066968">=</span>&nbsp;<span class="ident" id="8066970">NewDecoder</span><span class="op" id="8066980">(</span><span class="ident" id="8066981">b</span><span class="op" id="8066982">)</span><span class="op" id="8066983">.</span><span class="ident" id="8066984">Decode</span><span class="op" id="8066990">(</span><span class="op" id="8066991">&amp;</span><span class="ident" id="8066992">r</span><span class="op" id="8066993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8066996">if</span>&nbsp;<span class="ident" id="8066999">err</span>&nbsp;<span class="op" id="8067003">!=</span>&nbsp;<span class="ident" id="8067006">nil</span>&nbsp;<span class="op" id="8067010">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067014">t</span><span class="op" id="8067015">.</span><span class="ident" id="8067016">Fatal</span><span class="op" id="8067021">(</span><span class="string" id="8067022">&#34;decode&nbsp;error:&#34;</span><span class="op" id="8067037">,</span>&nbsp;<span class="ident" id="8067039">err</span><span class="op" id="8067042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067045">}</span><br>
<span class="lineno"></span><span class="op" id="8067047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8067050">//&nbsp;Now&nbsp;follow&nbsp;various&nbsp;tests&nbsp;that&nbsp;decode&nbsp;into&nbsp;things&nbsp;that&nbsp;can&#39;t&nbsp;represent&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="8067127">//&nbsp;encoded&nbsp;value,&nbsp;all&nbsp;of&nbsp;which&nbsp;should&nbsp;be&nbsp;legal.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8067176">//&nbsp;Also,&nbsp;when&nbsp;the&nbsp;ignored&nbsp;object&nbsp;contains&nbsp;an&nbsp;interface&nbsp;value,&nbsp;it&nbsp;may&nbsp;define</span><br>
<span class="lineno"></span><span class="comment" id="8067252">//&nbsp;types.&nbsp;Make&nbsp;sure&nbsp;that&nbsp;skipping&nbsp;the&nbsp;value&nbsp;still&nbsp;defines&nbsp;the&nbsp;types&nbsp;by&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="8067329">//&nbsp;the&nbsp;encoder/decoder&nbsp;pair&nbsp;to&nbsp;send&nbsp;a&nbsp;value&nbsp;afterwards.&nbsp;&nbsp;If&nbsp;an&nbsp;interface</span><br>
<span class="lineno">485</span><span class="comment" id="8067402">//&nbsp;is&nbsp;sent,&nbsp;its&nbsp;type&nbsp;in&nbsp;the&nbsp;test&nbsp;is&nbsp;always&nbsp;NewType0,&nbsp;so&nbsp;this&nbsp;checks&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8067479">//&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;don&#39;t&nbsp;skew&nbsp;with&nbsp;respect&nbsp;to&nbsp;type&nbsp;definitions.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8067548">type</span>&nbsp;<span class="ident" id="8067553">Struct0</span>&nbsp;<span class="keyword" id="8067561">struct</span>&nbsp;<span class="op" id="8067568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067571">I</span>&nbsp;<span class="keyword" id="8067573">interface</span><span class="op" id="8067582">{</span><span class="op" id="8067583">}</span><br>
<span class="lineno">490</span><span class="op" id="8067585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8067588">type</span>&nbsp;<span class="ident" id="8067593">NewType0</span>&nbsp;<span class="keyword" id="8067602">struct</span>&nbsp;<span class="op" id="8067609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067612">S</span>&nbsp;<span class="builtintype" id="8067614">string</span><br>
<span class="lineno"></span><span class="op" id="8067621">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="8067624">type</span>&nbsp;<span class="ident" id="8067629">ignoreTest</span>&nbsp;<span class="keyword" id="8067640">struct</span>&nbsp;<span class="op" id="8067647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067650">in</span><span class="op" id="8067652">,</span>&nbsp;<span class="ident" id="8067654">out</span>&nbsp;<span class="keyword" id="8067658">interface</span><span class="op" id="8067667">{</span><span class="op" id="8067668">}</span><br>
<span class="lineno"></span><span class="op" id="8067670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="8067673">var</span>&nbsp;<span class="ident" id="8067677">ignoreTests</span>&nbsp;<span class="op" id="8067689">=</span>&nbsp;<span class="op" id="8067691">[</span><span class="op" id="8067692">]</span><span class="ident" id="8067693">ignoreTest</span><span class="op" id="8067703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8067706">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;an&nbsp;empty&nbsp;struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067752">{</span><span class="op" id="8067753">&amp;</span><span class="keyword" id="8067754">struct</span><span class="op" id="8067760">{</span>&nbsp;<span class="ident" id="8067762">A</span>&nbsp;<span class="builtintype" id="8067764">int</span>&nbsp;<span class="op" id="8067768">}</span><span class="op" id="8067769">{</span><span class="num" id="8067770">23</span><span class="op" id="8067772">}</span><span class="op" id="8067773">,</span>&nbsp;<span class="op" id="8067775">&amp;</span><span class="keyword" id="8067776">struct</span><span class="op" id="8067782">{</span><span class="op" id="8067783">}</span><span class="op" id="8067784">{</span><span class="op" id="8067785">}</span><span class="op" id="8067786">}</span><span class="op" id="8067787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8067790">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067827">{</span><span class="op" id="8067828">&amp;</span><span class="keyword" id="8067829">struct</span><span class="op" id="8067835">{</span>&nbsp;<span class="ident" id="8067837">A</span>&nbsp;<span class="builtintype" id="8067839">int</span>&nbsp;<span class="op" id="8067843">}</span><span class="op" id="8067844">{</span><span class="num" id="8067845">23</span><span class="op" id="8067847">}</span><span class="op" id="8067848">,</span>&nbsp;<span class="ident" id="8067850">nil</span><span class="op" id="8067853">}</span><span class="op" id="8067854">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8067857">//&nbsp;Decode&nbsp;singleton&nbsp;string&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067897">{</span><span class="string" id="8067898">&#34;hello,&nbsp;world&#34;</span><span class="op" id="8067912">,</span>&nbsp;<span class="ident" id="8067914">nil</span><span class="op" id="8067917">}</span><span class="op" id="8067918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8067921">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067960">{</span><span class="op" id="8067961">[</span><span class="op" id="8067962">]</span><span class="builtintype" id="8067963">int</span><span class="op" id="8067966">{</span><span class="num" id="8067967">1</span><span class="op" id="8067968">,</span>&nbsp;<span class="num" id="8067970">2</span><span class="op" id="8067971">,</span>&nbsp;<span class="num" id="8067973">3</span><span class="op" id="8067974">,</span>&nbsp;<span class="num" id="8067976">4</span><span class="op" id="8067977">}</span><span class="op" id="8067978">,</span>&nbsp;<span class="ident" id="8067980">nil</span><span class="op" id="8067983">}</span><span class="op" id="8067984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8067987">//&nbsp;Decode&nbsp;struct&nbsp;containing&nbsp;an&nbsp;interface&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068041">{</span><span class="op" id="8068042">&amp;</span><span class="ident" id="8068043">Struct0</span><span class="op" id="8068050">{</span><span class="op" id="8068051">&amp;</span><span class="ident" id="8068052">NewType0</span><span class="op" id="8068060">{</span><span class="string" id="8068061">&#34;value0&#34;</span><span class="op" id="8068069">}</span><span class="op" id="8068070">}</span><span class="op" id="8068071">,</span>&nbsp;<span class="ident" id="8068073">nil</span><span class="op" id="8068076">}</span><span class="op" id="8068077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8068080">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;of&nbsp;interfaces&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068133">{</span><span class="op" id="8068134">[</span><span class="op" id="8068135">]</span><span class="keyword" id="8068136">interface</span><span class="op" id="8068145">{</span><span class="op" id="8068146">}</span><span class="op" id="8068147">{</span><span class="string" id="8068148">&#34;hi&#34;</span><span class="op" id="8068152">,</span>&nbsp;<span class="op" id="8068154">&amp;</span><span class="ident" id="8068155">NewType0</span><span class="op" id="8068163">{</span><span class="string" id="8068164">&#34;value1&#34;</span><span class="op" id="8068172">}</span><span class="op" id="8068173">,</span>&nbsp;<span class="num" id="8068175">23</span><span class="op" id="8068177">}</span><span class="op" id="8068178">,</span>&nbsp;<span class="ident" id="8068180">nil</span><span class="op" id="8068183">}</span><span class="op" id="8068184">,</span><br>
<span class="lineno"></span><span class="op" id="8068186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="8068189">func</span>&nbsp;<span class="ident" id="8068194">TestDecodeIntoNothing</span><span class="op" id="8068215">(</span><span class="ident" id="8068216">t</span>&nbsp;<span class="op" id="8068218">*</span><span class="ident" id="8068219">testing</span><span class="op" id="8068226">.</span><span class="ident" id="8068227">T</span><span class="op" id="8068228">)</span>&nbsp;<span class="op" id="8068230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068233">Register</span><span class="op" id="8068241">(</span><span class="builtinfunc" id="8068242">new</span><span class="op" id="8068245">(</span><span class="ident" id="8068246">NewType0</span><span class="op" id="8068254">)</span><span class="op" id="8068255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068258">for</span>&nbsp;<span class="ident" id="8068262">i</span><span class="op" id="8068263">,</span>&nbsp;<span class="ident" id="8068265">test</span>&nbsp;<span class="op" id="8068270">:=</span>&nbsp;<span class="keyword" id="8068273">range</span>&nbsp;<span class="ident" id="8068279">ignoreTests</span>&nbsp;<span class="op" id="8068291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068295">b</span>&nbsp;<span class="op" id="8068297">:=</span>&nbsp;<span class="builtinfunc" id="8068300">new</span><span class="op" id="8068303">(</span><span class="ident" id="8068304">bytes</span><span class="op" id="8068309">.</span><span class="ident" id="8068310">Buffer</span><span class="op" id="8068316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068320">enc</span>&nbsp;<span class="op" id="8068324">:=</span>&nbsp;<span class="ident" id="8068327">NewEncoder</span><span class="op" id="8068337">(</span><span class="ident" id="8068338">b</span><span class="op" id="8068339">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068343">err</span>&nbsp;<span class="op" id="8068347">:=</span>&nbsp;<span class="ident" id="8068350">enc</span><span class="op" id="8068353">.</span><span class="ident" id="8068354">Encode</span><span class="op" id="8068360">(</span><span class="ident" id="8068361">test</span><span class="op" id="8068365">.</span><span class="ident" id="8068366">in</span><span class="op" id="8068368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068372">if</span>&nbsp;<span class="ident" id="8068375">err</span>&nbsp;<span class="op" id="8068379">!=</span>&nbsp;<span class="ident" id="8068382">nil</span>&nbsp;<span class="op" id="8068386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068391">t</span><span class="op" id="8068392">.</span><span class="ident" id="8068393">Errorf</span><span class="op" id="8068399">(</span><span class="string" id="8068400">&#34;%d:&nbsp;encode&nbsp;error&nbsp;%s:&#34;</span><span class="op" id="8068422">,</span>&nbsp;<span class="ident" id="8068424">i</span><span class="op" id="8068425">,</span>&nbsp;<span class="ident" id="8068427">err</span><span class="op" id="8068430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068435">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068446">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068450">dec</span>&nbsp;<span class="op" id="8068454">:=</span>&nbsp;<span class="ident" id="8068457">NewDecoder</span><span class="op" id="8068467">(</span><span class="ident" id="8068468">b</span><span class="op" id="8068469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068473">err</span>&nbsp;<span class="op" id="8068477">=</span>&nbsp;<span class="ident" id="8068479">dec</span><span class="op" id="8068482">.</span><span class="ident" id="8068483">Decode</span><span class="op" id="8068489">(</span><span class="ident" id="8068490">test</span><span class="op" id="8068494">.</span><span class="ident" id="8068495">out</span><span class="op" id="8068498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068502">if</span>&nbsp;<span class="ident" id="8068505">err</span>&nbsp;<span class="op" id="8068509">!=</span>&nbsp;<span class="ident" id="8068512">nil</span>&nbsp;<span class="op" id="8068516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068521">t</span><span class="op" id="8068522">.</span><span class="ident" id="8068523">Errorf</span><span class="op" id="8068529">(</span><span class="string" id="8068530">&#34;%d:&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8068552">,</span>&nbsp;<span class="ident" id="8068554">i</span><span class="op" id="8068555">,</span>&nbsp;<span class="ident" id="8068557">err</span><span class="op" id="8068560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068565">continue</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8068580">//&nbsp;Now&nbsp;see&nbsp;if&nbsp;the&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;are&nbsp;in&nbsp;a&nbsp;consistent&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068647">str</span>&nbsp;<span class="op" id="8068651">:=</span>&nbsp;<span class="ident" id="8068654">fmt</span><span class="op" id="8068657">.</span><span class="ident" id="8068658">Sprintf</span><span class="op" id="8068665">(</span><span class="string" id="8068666">&#34;Value&nbsp;%d&#34;</span><span class="op" id="8068676">,</span>&nbsp;<span class="ident" id="8068678">i</span><span class="op" id="8068679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068683">err</span>&nbsp;<span class="op" id="8068687">=</span>&nbsp;<span class="ident" id="8068689">enc</span><span class="op" id="8068692">.</span><span class="ident" id="8068693">Encode</span><span class="op" id="8068699">(</span><span class="op" id="8068700">&amp;</span><span class="ident" id="8068701">NewType0</span><span class="op" id="8068709">{</span><span class="ident" id="8068710">str</span><span class="op" id="8068713">}</span><span class="op" id="8068714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068718">if</span>&nbsp;<span class="ident" id="8068721">err</span>&nbsp;<span class="op" id="8068725">!=</span>&nbsp;<span class="ident" id="8068728">nil</span>&nbsp;<span class="op" id="8068732">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068737">t</span><span class="op" id="8068738">.</span><span class="ident" id="8068739">Fatalf</span><span class="op" id="8068745">(</span><span class="string" id="8068746">&#34;%d:&nbsp;NewType0&nbsp;encode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8068777">,</span>&nbsp;<span class="ident" id="8068779">i</span><span class="op" id="8068780">,</span>&nbsp;<span class="ident" id="8068782">err</span><span class="op" id="8068785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068793">ns</span>&nbsp;<span class="op" id="8068796">:=</span>&nbsp;<span class="builtinfunc" id="8068799">new</span><span class="op" id="8068802">(</span><span class="ident" id="8068803">NewType0</span><span class="op" id="8068811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068815">err</span>&nbsp;<span class="op" id="8068819">=</span>&nbsp;<span class="ident" id="8068821">dec</span><span class="op" id="8068824">.</span><span class="ident" id="8068825">Decode</span><span class="op" id="8068831">(</span><span class="ident" id="8068832">ns</span><span class="op" id="8068834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068838">if</span>&nbsp;<span class="ident" id="8068841">err</span>&nbsp;<span class="op" id="8068845">!=</span>&nbsp;<span class="ident" id="8068848">nil</span>&nbsp;<span class="op" id="8068852">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068857">t</span><span class="op" id="8068858">.</span><span class="ident" id="8068859">Fatalf</span><span class="op" id="8068865">(</span><span class="string" id="8068866">&#34;%d:&nbsp;NewType0&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8068897">,</span>&nbsp;<span class="ident" id="8068899">i</span><span class="op" id="8068900">,</span>&nbsp;<span class="ident" id="8068902">err</span><span class="op" id="8068905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068913">if</span>&nbsp;<span class="ident" id="8068916">ns</span><span class="op" id="8068918">.</span><span class="ident" id="8068919">S</span>&nbsp;<span class="op" id="8068921">!=</span>&nbsp;<span class="ident" id="8068924">str</span>&nbsp;<span class="op" id="8068928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068933">t</span><span class="op" id="8068934">.</span><span class="ident" id="8068935">Fatalf</span><span class="op" id="8068941">(</span><span class="string" id="8068942">&#34;%d:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8068966">,</span>&nbsp;<span class="ident" id="8068968">i</span><span class="op" id="8068969">,</span>&nbsp;<span class="ident" id="8068971">str</span><span class="op" id="8068974">,</span>&nbsp;<span class="ident" id="8068976">ns</span><span class="op" id="8068978">.</span><span class="ident" id="8068979">S</span><span class="op" id="8068980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068984">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068987">}</span><br>
<span class="lineno"></span><span class="op" id="8068989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8068992">//&nbsp;Another&nbsp;bug&nbsp;from&nbsp;golang-nuts,&nbsp;involving&nbsp;nested&nbsp;interfaces.</span><br>
<span class="lineno"></span><span class="keyword" id="8069054">type</span>&nbsp;<span class="ident" id="8069059">Bug0Outer</span>&nbsp;<span class="keyword" id="8069069">struct</span>&nbsp;<span class="op" id="8069076">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069079">Bug0Field</span>&nbsp;<span class="keyword" id="8069089">interface</span><span class="op" id="8069098">{</span><span class="op" id="8069099">}</span><br>
<span class="lineno"></span><span class="op" id="8069101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8069104">type</span>&nbsp;<span class="ident" id="8069109">Bug0Inner</span>&nbsp;<span class="keyword" id="8069119">struct</span>&nbsp;<span class="op" id="8069126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069129">A</span>&nbsp;<span class="builtintype" id="8069131">int</span><br>
<span class="lineno">555</span><span class="op" id="8069135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8069138">func</span>&nbsp;<span class="ident" id="8069143">TestNestedInterfaces</span><span class="op" id="8069163">(</span><span class="ident" id="8069164">t</span>&nbsp;<span class="op" id="8069166">*</span><span class="ident" id="8069167">testing</span><span class="op" id="8069174">.</span><span class="ident" id="8069175">T</span><span class="op" id="8069176">)</span>&nbsp;<span class="op" id="8069178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069181">var</span>&nbsp;<span class="ident" id="8069185">buf</span>&nbsp;<span class="ident" id="8069189">bytes</span><span class="op" id="8069194">.</span><span class="ident" id="8069195">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069203">e</span>&nbsp;<span class="op" id="8069205">:=</span>&nbsp;<span class="ident" id="8069208">NewEncoder</span><span class="op" id="8069218">(</span><span class="op" id="8069219">&amp;</span><span class="ident" id="8069220">buf</span><span class="op" id="8069223">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069226">d</span>&nbsp;<span class="op" id="8069228">:=</span>&nbsp;<span class="ident" id="8069231">NewDecoder</span><span class="op" id="8069241">(</span><span class="op" id="8069242">&amp;</span><span class="ident" id="8069243">buf</span><span class="op" id="8069246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069249">Register</span><span class="op" id="8069257">(</span><span class="builtinfunc" id="8069258">new</span><span class="op" id="8069261">(</span><span class="ident" id="8069262">Bug0Outer</span><span class="op" id="8069271">)</span><span class="op" id="8069272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069275">Register</span><span class="op" id="8069283">(</span><span class="builtinfunc" id="8069284">new</span><span class="op" id="8069287">(</span><span class="ident" id="8069288">Bug0Inner</span><span class="op" id="8069297">)</span><span class="op" id="8069298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069301">f</span>&nbsp;<span class="op" id="8069303">:=</span>&nbsp;<span class="op" id="8069306">&amp;</span><span class="ident" id="8069307">Bug0Outer</span><span class="op" id="8069316">{</span><span class="op" id="8069317">&amp;</span><span class="ident" id="8069318">Bug0Outer</span><span class="op" id="8069327">{</span><span class="op" id="8069328">&amp;</span><span class="ident" id="8069329">Bug0Inner</span><span class="op" id="8069338">{</span><span class="num" id="8069339">7</span><span class="op" id="8069340">}</span><span class="op" id="8069341">}</span><span class="op" id="8069342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069345">var</span>&nbsp;<span class="ident" id="8069349">v</span>&nbsp;<span class="keyword" id="8069351">interface</span><span class="op" id="8069360">{</span><span class="op" id="8069361">}</span>&nbsp;<span class="op" id="8069363">=</span>&nbsp;<span class="ident" id="8069365">f</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069368">err</span>&nbsp;<span class="op" id="8069372">:=</span>&nbsp;<span class="ident" id="8069375">e</span><span class="op" id="8069376">.</span><span class="ident" id="8069377">Encode</span><span class="op" id="8069383">(</span><span class="op" id="8069384">&amp;</span><span class="ident" id="8069385">v</span><span class="op" id="8069386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069389">if</span>&nbsp;<span class="ident" id="8069392">err</span>&nbsp;<span class="op" id="8069396">!=</span>&nbsp;<span class="ident" id="8069399">nil</span>&nbsp;<span class="op" id="8069403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069407">t</span><span class="op" id="8069408">.</span><span class="ident" id="8069409">Fatal</span><span class="op" id="8069414">(</span><span class="string" id="8069415">&#34;Encode:&#34;</span><span class="op" id="8069424">,</span>&nbsp;<span class="ident" id="8069426">err</span><span class="op" id="8069429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8069432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069435">err</span>&nbsp;<span class="op" id="8069439">=</span>&nbsp;<span class="ident" id="8069441">d</span><span class="op" id="8069442">.</span><span class="ident" id="8069443">Decode</span><span class="op" id="8069449">(</span><span class="op" id="8069450">&amp;</span><span class="ident" id="8069451">v</span><span class="op" id="8069452">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069455">if</span>&nbsp;<span class="ident" id="8069458">err</span>&nbsp;<span class="op" id="8069462">!=</span>&nbsp;<span class="ident" id="8069465">nil</span>&nbsp;<span class="op" id="8069469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069473">t</span><span class="op" id="8069474">.</span><span class="ident" id="8069475">Fatal</span><span class="op" id="8069480">(</span><span class="string" id="8069481">&#34;Decode:&#34;</span><span class="op" id="8069490">,</span>&nbsp;<span class="ident" id="8069492">err</span><span class="op" id="8069495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8069498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8069501">//&nbsp;Make&nbsp;sure&nbsp;it&nbsp;decoded&nbsp;correctly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069537">outer1</span><span class="op" id="8069543">,</span>&nbsp;<span class="ident" id="8069545">ok</span>&nbsp;<span class="op" id="8069548">:=</span>&nbsp;<span class="ident" id="8069551">v</span><span class="op" id="8069552">.</span><span class="op" id="8069553">(</span><span class="op" id="8069554">*</span><span class="ident" id="8069555">Bug0Outer</span><span class="op" id="8069564">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069567">if</span>&nbsp;<span class="op" id="8069570">!</span><span class="ident" id="8069571">ok</span>&nbsp;<span class="op" id="8069574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069578">t</span><span class="op" id="8069579">.</span><span class="ident" id="8069580">Fatalf</span><span class="op" id="8069586">(</span><span class="string" id="8069587">&#34;v&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="8069608">,</span>&nbsp;<span class="ident" id="8069610">v</span><span class="op" id="8069611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8069614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069617">outer2</span><span class="op" id="8069623">,</span>&nbsp;<span class="ident" id="8069625">ok</span>&nbsp;<span class="op" id="8069628">:=</span>&nbsp;<span class="ident" id="8069631">outer1</span><span class="op" id="8069637">.</span><span class="ident" id="8069638">Bug0Field</span><span class="op" id="8069647">.</span><span class="op" id="8069648">(</span><span class="op" id="8069649">*</span><span class="ident" id="8069650">Bug0Outer</span><span class="op" id="8069659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069662">if</span>&nbsp;<span class="op" id="8069665">!</span><span class="ident" id="8069666">ok</span>&nbsp;<span class="op" id="8069669">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069673">t</span><span class="op" id="8069674">.</span><span class="ident" id="8069675">Fatalf</span><span class="op" id="8069681">(</span><span class="string" id="8069682">&#34;v.Bug0Field&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="8069713">,</span>&nbsp;<span class="ident" id="8069715">outer1</span><span class="op" id="8069721">.</span><span class="ident" id="8069722">Bug0Field</span><span class="op" id="8069731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8069734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069737">inner</span><span class="op" id="8069742">,</span>&nbsp;<span class="ident" id="8069744">ok</span>&nbsp;<span class="op" id="8069747">:=</span>&nbsp;<span class="ident" id="8069750">outer2</span><span class="op" id="8069756">.</span><span class="ident" id="8069757">Bug0Field</span><span class="op" id="8069766">.</span><span class="op" id="8069767">(</span><span class="op" id="8069768">*</span><span class="ident" id="8069769">Bug0Inner</span><span class="op" id="8069778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069781">if</span>&nbsp;<span class="op" id="8069784">!</span><span class="ident" id="8069785">ok</span>&nbsp;<span class="op" id="8069788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069792">t</span><span class="op" id="8069793">.</span><span class="ident" id="8069794">Fatalf</span><span class="op" id="8069800">(</span><span class="string" id="8069801">&#34;v.Bug0Field.Bug0Field&nbsp;not&nbsp;Bug0Inner:&nbsp;%T&#34;</span><span class="op" id="8069842">,</span>&nbsp;<span class="ident" id="8069844">outer2</span><span class="op" id="8069850">.</span><span class="ident" id="8069851">Bug0Field</span><span class="op" id="8069860">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8069863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069866">if</span>&nbsp;<span class="ident" id="8069869">inner</span><span class="op" id="8069874">.</span><span class="ident" id="8069875">A</span>&nbsp;<span class="op" id="8069877">!=</span>&nbsp;<span class="num" id="8069880">7</span>&nbsp;<span class="op" id="8069882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069886">t</span><span class="op" id="8069887">.</span><span class="ident" id="8069888">Fatalf</span><span class="op" id="8069894">(</span><span class="string" id="8069895">&#34;final&nbsp;value&nbsp;%d;&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8069924">,</span>&nbsp;<span class="ident" id="8069926">inner</span><span class="op" id="8069931">.</span><span class="ident" id="8069932">A</span><span class="op" id="8069933">,</span>&nbsp;<span class="num" id="8069935">7</span><span class="op" id="8069936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8069939">}</span><br>
<span class="lineno"></span><span class="op" id="8069941">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="8069944">//&nbsp;The&nbsp;bugs&nbsp;keep&nbsp;coming.&nbsp;We&nbsp;forgot&nbsp;to&nbsp;send&nbsp;map&nbsp;subtypes&nbsp;before&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8070017">type</span>&nbsp;<span class="ident" id="8070022">Bug1Elem</span>&nbsp;<span class="keyword" id="8070031">struct</span>&nbsp;<span class="op" id="8070038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070041">Name</span>&nbsp;<span class="builtintype" id="8070046">string</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070054">Id</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8070059">int</span><br>
<span class="lineno"></span><span class="op" id="8070063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8070066">type</span>&nbsp;<span class="ident" id="8070071">Bug1StructMap</span>&nbsp;<span class="keyword" id="8070085">map</span><span class="op" id="8070088">[</span><span class="builtintype" id="8070089">string</span><span class="op" id="8070095">]</span><span class="ident" id="8070096">Bug1Elem</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="keyword" id="8070106">func</span>&nbsp;<span class="ident" id="8070111">bug1EncDec</span><span class="op" id="8070121">(</span><span class="ident" id="8070122">in</span>&nbsp;<span class="ident" id="8070125">Bug1StructMap</span><span class="op" id="8070138">,</span>&nbsp;<span class="ident" id="8070140">out</span>&nbsp;<span class="op" id="8070144">*</span><span class="ident" id="8070145">Bug1StructMap</span><span class="op" id="8070158">)</span>&nbsp;<span class="builtintype" id="8070160">error</span>&nbsp;<span class="op" id="8070166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070169">return</span>&nbsp;<span class="ident" id="8070176">nil</span><br>
<span class="lineno"></span><span class="op" id="8070180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8070183">func</span>&nbsp;<span class="ident" id="8070188">TestMapBug1</span><span class="op" id="8070199">(</span><span class="ident" id="8070200">t</span>&nbsp;<span class="op" id="8070202">*</span><span class="ident" id="8070203">testing</span><span class="op" id="8070210">.</span><span class="ident" id="8070211">T</span><span class="op" id="8070212">)</span>&nbsp;<span class="op" id="8070214">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070217">in</span>&nbsp;<span class="op" id="8070220">:=</span>&nbsp;<span class="builtinfunc" id="8070223">make</span><span class="op" id="8070227">(</span><span class="ident" id="8070228">Bug1StructMap</span><span class="op" id="8070241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070244">in</span><span class="op" id="8070246">[</span><span class="string" id="8070247">&#34;val1&#34;</span><span class="op" id="8070253">]</span>&nbsp;<span class="op" id="8070255">=</span>&nbsp;<span class="ident" id="8070257">Bug1Elem</span><span class="op" id="8070265">{</span><span class="string" id="8070266">&#34;elem1&#34;</span><span class="op" id="8070273">,</span>&nbsp;<span class="num" id="8070275">1</span><span class="op" id="8070276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070279">in</span><span class="op" id="8070281">[</span><span class="string" id="8070282">&#34;val2&#34;</span><span class="op" id="8070288">]</span>&nbsp;<span class="op" id="8070290">=</span>&nbsp;<span class="ident" id="8070292">Bug1Elem</span><span class="op" id="8070300">{</span><span class="string" id="8070301">&#34;elem2&#34;</span><span class="op" id="8070308">,</span>&nbsp;<span class="num" id="8070310">2</span><span class="op" id="8070311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070315">b</span>&nbsp;<span class="op" id="8070317">:=</span>&nbsp;<span class="builtinfunc" id="8070320">new</span><span class="op" id="8070323">(</span><span class="ident" id="8070324">bytes</span><span class="op" id="8070329">.</span><span class="ident" id="8070330">Buffer</span><span class="op" id="8070336">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070339">enc</span>&nbsp;<span class="op" id="8070343">:=</span>&nbsp;<span class="ident" id="8070346">NewEncoder</span><span class="op" id="8070356">(</span><span class="ident" id="8070357">b</span><span class="op" id="8070358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070361">err</span>&nbsp;<span class="op" id="8070365">:=</span>&nbsp;<span class="ident" id="8070368">enc</span><span class="op" id="8070371">.</span><span class="ident" id="8070372">Encode</span><span class="op" id="8070378">(</span><span class="ident" id="8070379">in</span><span class="op" id="8070381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070384">if</span>&nbsp;<span class="ident" id="8070387">err</span>&nbsp;<span class="op" id="8070391">!=</span>&nbsp;<span class="ident" id="8070394">nil</span>&nbsp;<span class="op" id="8070398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070402">t</span><span class="op" id="8070403">.</span><span class="ident" id="8070404">Fatal</span><span class="op" id="8070409">(</span><span class="string" id="8070410">&#34;encode:&#34;</span><span class="op" id="8070419">,</span>&nbsp;<span class="ident" id="8070421">err</span><span class="op" id="8070424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8070427">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070430">dec</span>&nbsp;<span class="op" id="8070434">:=</span>&nbsp;<span class="ident" id="8070437">NewDecoder</span><span class="op" id="8070447">(</span><span class="ident" id="8070448">b</span><span class="op" id="8070449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070452">out</span>&nbsp;<span class="op" id="8070456">:=</span>&nbsp;<span class="builtinfunc" id="8070459">make</span><span class="op" id="8070463">(</span><span class="ident" id="8070464">Bug1StructMap</span><span class="op" id="8070477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070480">err</span>&nbsp;<span class="op" id="8070484">=</span>&nbsp;<span class="ident" id="8070486">dec</span><span class="op" id="8070489">.</span><span class="ident" id="8070490">Decode</span><span class="op" id="8070496">(</span><span class="op" id="8070497">&amp;</span><span class="ident" id="8070498">out</span><span class="op" id="8070501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070504">if</span>&nbsp;<span class="ident" id="8070507">err</span>&nbsp;<span class="op" id="8070511">!=</span>&nbsp;<span class="ident" id="8070514">nil</span>&nbsp;<span class="op" id="8070518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070522">t</span><span class="op" id="8070523">.</span><span class="ident" id="8070524">Fatal</span><span class="op" id="8070529">(</span><span class="string" id="8070530">&#34;decode:&#34;</span><span class="op" id="8070539">,</span>&nbsp;<span class="ident" id="8070541">err</span><span class="op" id="8070544">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8070547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070550">if</span>&nbsp;<span class="op" id="8070553">!</span><span class="ident" id="8070554">reflect</span><span class="op" id="8070561">.</span><span class="ident" id="8070562">DeepEqual</span><span class="op" id="8070571">(</span><span class="ident" id="8070572">in</span><span class="op" id="8070574">,</span>&nbsp;<span class="ident" id="8070576">out</span><span class="op" id="8070579">)</span>&nbsp;<span class="op" id="8070581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070585">t</span><span class="op" id="8070586">.</span><span class="ident" id="8070587">Errorf</span><span class="op" id="8070593">(</span><span class="string" id="8070594">&#34;mismatch:&nbsp;%v&nbsp;%v&#34;</span><span class="op" id="8070611">,</span>&nbsp;<span class="ident" id="8070613">in</span><span class="op" id="8070615">,</span>&nbsp;<span class="ident" id="8070617">out</span><span class="op" id="8070620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8070623">}</span><br>
<span class="lineno"></span><span class="op" id="8070625">}</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span><span class="keyword" id="8070628">func</span>&nbsp;<span class="ident" id="8070633">TestGobMapInterfaceEncode</span><span class="op" id="8070658">(</span><span class="ident" id="8070659">t</span>&nbsp;<span class="op" id="8070661">*</span><span class="ident" id="8070662">testing</span><span class="op" id="8070669">.</span><span class="ident" id="8070670">T</span><span class="op" id="8070671">)</span>&nbsp;<span class="op" id="8070673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070676">m</span>&nbsp;<span class="op" id="8070678">:=</span>&nbsp;<span class="keyword" id="8070681">map</span><span class="op" id="8070684">[</span><span class="builtintype" id="8070685">string</span><span class="op" id="8070691">]</span><span class="keyword" id="8070692">interface</span><span class="op" id="8070701">{</span><span class="op" id="8070702">}</span><span class="op" id="8070703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8070707">&#34;up&#34;</span><span class="op" id="8070711">:</span>&nbsp;<span class="builtintype" id="8070713">uintptr</span><span class="op" id="8070720">(</span><span class="num" id="8070721">0</span><span class="op" id="8070722">)</span><span class="op" id="8070723">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8070727">&#34;i0&#34;</span><span class="op" id="8070731">:</span>&nbsp;<span class="op" id="8070733">[</span><span class="op" id="8070734">]</span><span class="builtintype" id="8070735">int</span><span class="op" id="8070738">{</span><span class="op" id="8070739">-</span><span class="num" id="8070740">1</span><span class="op" id="8070741">}</span><span class="op" id="8070742">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8070746">&#34;i1&#34;</span><span class="op" id="8070750">:</span>&nbsp;<span class="op" id="8070752">[</span><span class="op" id="8070753">]</span><span class="builtintype" id="8070754">int8</span><span class="op" id="8070758">{</span><span class="op" id="8070759">-</span><span class="num" id="8070760">1</span><span class="op" id="8070761">}</span><span class="op" id="8070762">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8070766">&#34;i2&#34;</span><span class="op" id="8070770">:</span>&nbsp;<span class="op" id="8070772">[</span><span class="op" id="8070773">]</span><span class="builtintype" id="8070774">int16</span><span class="op" id="8070779">{</span><span class="op" id="8070780">-</span><span class="num" id="8070781">1</span><span class="op" id="8070782">}</span><span class="op" id="8070783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8070787">&#34;i3&#34;</span><span class="op" id="8070791">:</span>&nbsp;<span class="op" id="8070793">[</span><span class="op" id="8070794">]</span><span class="builtintype" id="8070795">int32</span><span class="op" id="8070800">{</span><span class="op" id="8070801">-</span><span class="num" id="8070802">1</span><span class="op" id="8070803">}</span><span class="op" id="8070804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8070808">&#34;i4&#34;</span><span class="op" id="8070812">:</span>&nbsp;<span class="op" id="8070814">[</span><span class="op" id="8070815">]</span><span class="ident" id="8070816">int64</span><span class="op" id="8070821">{</span><span class="op" id="8070822">-</span><span class="num" id="8070823">1</span><span class="op" id="8070824">}</span><span class="op" id="8070825">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8070829">&#34;u0&#34;</span><span class="op" id="8070833">:</span>&nbsp;<span class="op" id="8070835">[</span><span class="op" id="8070836">]</span><span class="builtintype" id="8070837">uint</span><span class="op" id="8070841">{</span><span class="num" id="8070842">1</span><span class="op" id="8070843">}</span><span class="op" id="8070844">,</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8070848">&#34;u1&#34;</span><span class="op" id="8070852">:</span>&nbsp;<span class="op" id="8070854">[</span><span class="op" id="8070855">]</span><span class="builtintype" id="8070856">uint8</span><span class="op" id="8070861">{</span><span class="num" id="8070862">1</span><span class="op" id="8070863">}</span><span class="op" id="8070864">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8070868">&#34;u2&#34;</span><span class="op" id="8070872">:</span>&nbsp;<span class="op" id="8070874">[</span><span class="op" id="8070875">]</span><span class="builtintype" id="8070876">uint16</span><span class="op" id="8070882">{</span><span class="num" id="8070883">1</span><span class="op" id="8070884">}</span><span class="op" id="8070885">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8070889">&#34;u3&#34;</span><span class="op" id="8070893">:</span>&nbsp;<span class="op" id="8070895">[</span><span class="op" id="8070896">]</span><span class="builtintype" id="8070897">uint32</span><span class="op" id="8070903">{</span><span class="num" id="8070904">1</span><span class="op" id="8070905">}</span><span class="op" id="8070906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8070910">&#34;u4&#34;</span><span class="op" id="8070914">:</span>&nbsp;<span class="op" id="8070916">[</span><span class="op" id="8070917">]</span><span class="ident" id="8070918">uint64</span><span class="op" id="8070924">{</span><span class="num" id="8070925">1</span><span class="op" id="8070926">}</span><span class="op" id="8070927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8070931">&#34;f0&#34;</span><span class="op" id="8070935">:</span>&nbsp;<span class="op" id="8070937">[</span><span class="op" id="8070938">]</span><span class="builtintype" id="8070939">float32</span><span class="op" id="8070946">{</span><span class="num" id="8070947">1</span><span class="op" id="8070948">}</span><span class="op" id="8070949">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8070953">&#34;f1&#34;</span><span class="op" id="8070957">:</span>&nbsp;<span class="op" id="8070959">[</span><span class="op" id="8070960">]</span><span class="builtintype" id="8070961">float64</span><span class="op" id="8070968">{</span><span class="num" id="8070969">1</span><span class="op" id="8070970">}</span><span class="op" id="8070971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8070975">&#34;c0&#34;</span><span class="op" id="8070979">:</span>&nbsp;<span class="op" id="8070981">[</span><span class="op" id="8070982">]</span><span class="builtintype" id="8070983">complex64</span><span class="op" id="8070992">{</span><span class="builtinfunc" id="8070993">complex</span><span class="op" id="8071000">(</span><span class="num" id="8071001">2</span><span class="op" id="8071002">,</span>&nbsp;<span class="op" id="8071004">-</span><span class="num" id="8071005">2</span><span class="op" id="8071006">)</span><span class="op" id="8071007">}</span><span class="op" id="8071008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8071012">&#34;c1&#34;</span><span class="op" id="8071016">:</span>&nbsp;<span class="op" id="8071018">[</span><span class="op" id="8071019">]</span><span class="builtintype" id="8071020">complex128</span><span class="op" id="8071030">{</span><span class="builtinfunc" id="8071031">complex</span><span class="op" id="8071038">(</span><span class="num" id="8071039">2</span><span class="op" id="8071040">,</span>&nbsp;<span class="builtintype" id="8071042">float64</span><span class="op" id="8071049">(</span><span class="op" id="8071050">-</span><span class="num" id="8071051">2</span><span class="op" id="8071052">)</span><span class="op" id="8071053">)</span><span class="op" id="8071054">}</span><span class="op" id="8071055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8071059">&#34;us&#34;</span><span class="op" id="8071063">:</span>&nbsp;<span class="op" id="8071065">[</span><span class="op" id="8071066">]</span><span class="builtintype" id="8071067">uintptr</span><span class="op" id="8071074">{</span><span class="num" id="8071075">0</span><span class="op" id="8071076">}</span><span class="op" id="8071077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8071081">&#34;bo&#34;</span><span class="op" id="8071085">:</span>&nbsp;<span class="op" id="8071087">[</span><span class="op" id="8071088">]</span><span class="builtintype" id="8071089">bool</span><span class="op" id="8071093">{</span><span class="builtintype" id="8071094">false</span><span class="op" id="8071099">}</span><span class="op" id="8071100">,</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8071104">&#34;st&#34;</span><span class="op" id="8071108">:</span>&nbsp;<span class="op" id="8071110">[</span><span class="op" id="8071111">]</span><span class="builtintype" id="8071112">string</span><span class="op" id="8071118">{</span><span class="string" id="8071119">&#34;s&#34;</span><span class="op" id="8071122">}</span><span class="op" id="8071123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8071126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071129">enc</span>&nbsp;<span class="op" id="8071133">:=</span>&nbsp;<span class="ident" id="8071136">NewEncoder</span><span class="op" id="8071146">(</span><span class="builtinfunc" id="8071147">new</span><span class="op" id="8071150">(</span><span class="ident" id="8071151">bytes</span><span class="op" id="8071156">.</span><span class="ident" id="8071157">Buffer</span><span class="op" id="8071163">)</span><span class="op" id="8071164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071167">err</span>&nbsp;<span class="op" id="8071171">:=</span>&nbsp;<span class="ident" id="8071174">enc</span><span class="op" id="8071177">.</span><span class="ident" id="8071178">Encode</span><span class="op" id="8071184">(</span><span class="ident" id="8071185">m</span><span class="op" id="8071186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8071189">if</span>&nbsp;<span class="ident" id="8071192">err</span>&nbsp;<span class="op" id="8071196">!=</span>&nbsp;<span class="ident" id="8071199">nil</span>&nbsp;<span class="op" id="8071203">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071207">t</span><span class="op" id="8071208">.</span><span class="ident" id="8071209">Errorf</span><span class="op" id="8071215">(</span><span class="string" id="8071216">&#34;encode&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="8071232">,</span>&nbsp;<span class="ident" id="8071234">err</span><span class="op" id="8071237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8071240">}</span><br>
<span class="lineno"></span><span class="op" id="8071242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8071245">func</span>&nbsp;<span class="ident" id="8071250">TestSliceReusesMemory</span><span class="op" id="8071271">(</span><span class="ident" id="8071272">t</span>&nbsp;<span class="op" id="8071274">*</span><span class="ident" id="8071275">testing</span><span class="op" id="8071282">.</span><span class="ident" id="8071283">T</span><span class="op" id="8071284">)</span>&nbsp;<span class="op" id="8071286">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071289">buf</span>&nbsp;<span class="op" id="8071293">:=</span>&nbsp;<span class="builtinfunc" id="8071296">new</span><span class="op" id="8071299">(</span><span class="ident" id="8071300">bytes</span><span class="op" id="8071305">.</span><span class="ident" id="8071306">Buffer</span><span class="op" id="8071312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8071315">//&nbsp;Bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8071325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071329">x</span>&nbsp;<span class="op" id="8071331">:=</span>&nbsp;<span class="op" id="8071334">[</span><span class="op" id="8071335">]</span><span class="builtintype" id="8071336">byte</span><span class="op" id="8071340">(</span><span class="string" id="8071341">&#34;abcd&#34;</span><span class="op" id="8071347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071351">enc</span>&nbsp;<span class="op" id="8071355">:=</span>&nbsp;<span class="ident" id="8071358">NewEncoder</span><span class="op" id="8071368">(</span><span class="ident" id="8071369">buf</span><span class="op" id="8071372">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071376">err</span>&nbsp;<span class="op" id="8071380">:=</span>&nbsp;<span class="ident" id="8071383">enc</span><span class="op" id="8071386">.</span><span class="ident" id="8071387">Encode</span><span class="op" id="8071393">(</span><span class="ident" id="8071394">x</span><span class="op" id="8071395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8071399">if</span>&nbsp;<span class="ident" id="8071402">err</span>&nbsp;<span class="op" id="8071406">!=</span>&nbsp;<span class="ident" id="8071409">nil</span>&nbsp;<span class="op" id="8071413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071418">t</span><span class="op" id="8071419">.</span><span class="ident" id="8071420">Errorf</span><span class="op" id="8071426">(</span><span class="string" id="8071427">&#34;bytes:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="8071446">,</span>&nbsp;<span class="ident" id="8071448">err</span><span class="op" id="8071451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8071455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8071459">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071500">y</span>&nbsp;<span class="op" id="8071502">:=</span>&nbsp;<span class="op" id="8071505">[</span><span class="op" id="8071506">]</span><span class="builtintype" id="8071507">byte</span><span class="op" id="8071511">(</span><span class="string" id="8071512">&#34;ABCDE&#34;</span><span class="op" id="8071519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071523">addr</span>&nbsp;<span class="op" id="8071528">:=</span>&nbsp;<span class="op" id="8071531">&amp;</span><span class="ident" id="8071532">y</span><span class="op" id="8071533">[</span><span class="num" id="8071534">0</span><span class="op" id="8071535">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071539">dec</span>&nbsp;<span class="op" id="8071543">:=</span>&nbsp;<span class="ident" id="8071546">NewDecoder</span><span class="op" id="8071556">(</span><span class="ident" id="8071557">buf</span><span class="op" id="8071560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071564">err</span>&nbsp;<span class="op" id="8071568">=</span>&nbsp;<span class="ident" id="8071570">dec</span><span class="op" id="8071573">.</span><span class="ident" id="8071574">Decode</span><span class="op" id="8071580">(</span><span class="op" id="8071581">&amp;</span><span class="ident" id="8071582">y</span><span class="op" id="8071583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8071587">if</span>&nbsp;<span class="ident" id="8071590">err</span>&nbsp;<span class="op" id="8071594">!=</span>&nbsp;<span class="ident" id="8071597">nil</span>&nbsp;<span class="op" id="8071601">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071606">t</span><span class="op" id="8071607">.</span><span class="ident" id="8071608">Fatal</span><span class="op" id="8071613">(</span><span class="string" id="8071614">&#34;bytes:&nbsp;decode:&#34;</span><span class="op" id="8071630">,</span>&nbsp;<span class="ident" id="8071632">err</span><span class="op" id="8071635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8071639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8071643">if</span>&nbsp;<span class="op" id="8071646">!</span><span class="ident" id="8071647">bytes</span><span class="op" id="8071652">.</span><span class="ident" id="8071653">Equal</span><span class="op" id="8071658">(</span><span class="ident" id="8071659">x</span><span class="op" id="8071660">,</span>&nbsp;<span class="ident" id="8071662">y</span><span class="op" id="8071663">)</span>&nbsp;<span class="op" id="8071665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071670">t</span><span class="op" id="8071671">.</span><span class="ident" id="8071672">Errorf</span><span class="op" id="8071678">(</span><span class="string" id="8071679">&#34;bytes:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="8071708">,</span>&nbsp;<span class="ident" id="8071710">x</span><span class="op" id="8071711">,</span>&nbsp;<span class="ident" id="8071713">y</span><span class="op" id="8071714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8071718">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8071722">if</span>&nbsp;<span class="ident" id="8071725">addr</span>&nbsp;<span class="op" id="8071730">!=</span>&nbsp;<span class="op" id="8071733">&amp;</span><span class="ident" id="8071734">y</span><span class="op" id="8071735">[</span><span class="num" id="8071736">0</span><span class="op" id="8071737">]</span>&nbsp;<span class="op" id="8071739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071744">t</span><span class="op" id="8071745">.</span><span class="ident" id="8071746">Errorf</span><span class="op" id="8071752">(</span><span class="string" id="8071753">&#34;bytes:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="8071786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8071790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8071793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8071796">//&nbsp;general&nbsp;slice</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8071814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071818">x</span>&nbsp;<span class="op" id="8071820">:=</span>&nbsp;<span class="op" id="8071823">[</span><span class="op" id="8071824">]</span><span class="builtintype" id="8071825">rune</span><span class="op" id="8071829">(</span><span class="string" id="8071830">&#34;abcd&#34;</span><span class="op" id="8071836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071840">enc</span>&nbsp;<span class="op" id="8071844">:=</span>&nbsp;<span class="ident" id="8071847">NewEncoder</span><span class="op" id="8071857">(</span><span class="ident" id="8071858">buf</span><span class="op" id="8071861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071865">err</span>&nbsp;<span class="op" id="8071869">:=</span>&nbsp;<span class="ident" id="8071872">enc</span><span class="op" id="8071875">.</span><span class="ident" id="8071876">Encode</span><span class="op" id="8071882">(</span><span class="ident" id="8071883">x</span><span class="op" id="8071884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8071888">if</span>&nbsp;<span class="ident" id="8071891">err</span>&nbsp;<span class="op" id="8071895">!=</span>&nbsp;<span class="ident" id="8071898">nil</span>&nbsp;<span class="op" id="8071902">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071907">t</span><span class="op" id="8071908">.</span><span class="ident" id="8071909">Errorf</span><span class="op" id="8071915">(</span><span class="string" id="8071916">&#34;ints:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="8071934">,</span>&nbsp;<span class="ident" id="8071936">err</span><span class="op" id="8071939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8071943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8071947">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071988">y</span>&nbsp;<span class="op" id="8071990">:=</span>&nbsp;<span class="op" id="8071993">[</span><span class="op" id="8071994">]</span><span class="builtintype" id="8071995">rune</span><span class="op" id="8071999">(</span><span class="string" id="8072000">&#34;ABCDE&#34;</span><span class="op" id="8072007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072011">addr</span>&nbsp;<span class="op" id="8072016">:=</span>&nbsp;<span class="op" id="8072019">&amp;</span><span class="ident" id="8072020">y</span><span class="op" id="8072021">[</span><span class="num" id="8072022">0</span><span class="op" id="8072023">]</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072027">dec</span>&nbsp;<span class="op" id="8072031">:=</span>&nbsp;<span class="ident" id="8072034">NewDecoder</span><span class="op" id="8072044">(</span><span class="ident" id="8072045">buf</span><span class="op" id="8072048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072052">err</span>&nbsp;<span class="op" id="8072056">=</span>&nbsp;<span class="ident" id="8072058">dec</span><span class="op" id="8072061">.</span><span class="ident" id="8072062">Decode</span><span class="op" id="8072068">(</span><span class="op" id="8072069">&amp;</span><span class="ident" id="8072070">y</span><span class="op" id="8072071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072075">if</span>&nbsp;<span class="ident" id="8072078">err</span>&nbsp;<span class="op" id="8072082">!=</span>&nbsp;<span class="ident" id="8072085">nil</span>&nbsp;<span class="op" id="8072089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072094">t</span><span class="op" id="8072095">.</span><span class="ident" id="8072096">Fatal</span><span class="op" id="8072101">(</span><span class="string" id="8072102">&#34;ints:&nbsp;decode:&#34;</span><span class="op" id="8072117">,</span>&nbsp;<span class="ident" id="8072119">err</span><span class="op" id="8072122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072126">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072130">if</span>&nbsp;<span class="op" id="8072133">!</span><span class="ident" id="8072134">reflect</span><span class="op" id="8072141">.</span><span class="ident" id="8072142">DeepEqual</span><span class="op" id="8072151">(</span><span class="ident" id="8072152">x</span><span class="op" id="8072153">,</span>&nbsp;<span class="ident" id="8072155">y</span><span class="op" id="8072156">)</span>&nbsp;<span class="op" id="8072158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072163">t</span><span class="op" id="8072164">.</span><span class="ident" id="8072165">Errorf</span><span class="op" id="8072171">(</span><span class="string" id="8072172">&#34;ints:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="8072200">,</span>&nbsp;<span class="ident" id="8072202">x</span><span class="op" id="8072203">,</span>&nbsp;<span class="ident" id="8072205">y</span><span class="op" id="8072206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072214">if</span>&nbsp;<span class="ident" id="8072217">addr</span>&nbsp;<span class="op" id="8072222">!=</span>&nbsp;<span class="op" id="8072225">&amp;</span><span class="ident" id="8072226">y</span><span class="op" id="8072227">[</span><span class="num" id="8072228">0</span><span class="op" id="8072229">]</span>&nbsp;<span class="op" id="8072231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072236">t</span><span class="op" id="8072237">.</span><span class="ident" id="8072238">Errorf</span><span class="op" id="8072244">(</span><span class="string" id="8072245">&#34;ints:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="8072277">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072284">}</span><br>
<span class="lineno"></span><span class="op" id="8072286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8072289">//&nbsp;Used&nbsp;to&nbsp;crash:&nbsp;negative&nbsp;count&nbsp;in&nbsp;recvMessage.</span><br>
<span class="lineno">705</span><span class="keyword" id="8072338">func</span>&nbsp;<span class="ident" id="8072343">TestBadCount</span><span class="op" id="8072355">(</span><span class="ident" id="8072356">t</span>&nbsp;<span class="op" id="8072358">*</span><span class="ident" id="8072359">testing</span><span class="op" id="8072366">.</span><span class="ident" id="8072367">T</span><span class="op" id="8072368">)</span>&nbsp;<span class="op" id="8072370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072373">b</span>&nbsp;<span class="op" id="8072375">:=</span>&nbsp;<span class="op" id="8072378">[</span><span class="op" id="8072379">]</span><span class="builtintype" id="8072380">byte</span><span class="op" id="8072384">{</span><span class="num" id="8072385">0xfb</span><span class="op" id="8072389">,</span>&nbsp;<span class="num" id="8072391">0xa5</span><span class="op" id="8072395">,</span>&nbsp;<span class="num" id="8072397">0x82</span><span class="op" id="8072401">,</span>&nbsp;<span class="num" id="8072403">0x2f</span><span class="op" id="8072407">,</span>&nbsp;<span class="num" id="8072409">0xca</span><span class="op" id="8072413">,</span>&nbsp;<span class="num" id="8072415">0x1</span><span class="op" id="8072418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072421">if</span>&nbsp;<span class="ident" id="8072424">err</span>&nbsp;<span class="op" id="8072428">:=</span>&nbsp;<span class="ident" id="8072431">NewDecoder</span><span class="op" id="8072441">(</span><span class="ident" id="8072442">bytes</span><span class="op" id="8072447">.</span><span class="ident" id="8072448">NewReader</span><span class="op" id="8072457">(</span><span class="ident" id="8072458">b</span><span class="op" id="8072459">)</span><span class="op" id="8072460">)</span><span class="op" id="8072461">.</span><span class="ident" id="8072462">Decode</span><span class="op" id="8072468">(</span><span class="ident" id="8072469">nil</span><span class="op" id="8072472">)</span><span class="op" id="8072473">;</span>&nbsp;<span class="ident" id="8072475">err</span>&nbsp;<span class="op" id="8072479">==</span>&nbsp;<span class="ident" id="8072482">nil</span>&nbsp;<span class="op" id="8072486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072490">t</span><span class="op" id="8072491">.</span><span class="ident" id="8072492">Error</span><span class="op" id="8072497">(</span><span class="string" id="8072498">&#34;expected&nbsp;error&nbsp;from&nbsp;bad&nbsp;count&#34;</span><span class="op" id="8072529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072532">}</span>&nbsp;<span class="keyword" id="8072534">else</span>&nbsp;<span class="keyword" id="8072539">if</span>&nbsp;<span class="ident" id="8072542">err</span><span class="op" id="8072545">.</span><span class="ident" id="8072546">Error</span><span class="op" id="8072551">(</span><span class="op" id="8072552">)</span>&nbsp;<span class="op" id="8072554">!=</span>&nbsp;<span class="ident" id="8072557">errBadCount</span><span class="op" id="8072568">.</span><span class="ident" id="8072569">Error</span><span class="op" id="8072574">(</span><span class="op" id="8072575">)</span>&nbsp;<span class="op" id="8072577">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072581">t</span><span class="op" id="8072582">.</span><span class="ident" id="8072583">Error</span><span class="op" id="8072588">(</span><span class="string" id="8072589">&#34;expected&nbsp;bad&nbsp;count&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8072620">,</span>&nbsp;<span class="ident" id="8072622">err</span><span class="op" id="8072625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072628">}</span><br>
<span class="lineno"></span><span class="op" id="8072630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8072633">//&nbsp;Verify&nbsp;that&nbsp;sequential&nbsp;Decoders&nbsp;built&nbsp;on&nbsp;a&nbsp;single&nbsp;input&nbsp;will</span><br>
<span class="lineno">715</span><span class="comment" id="8072697">//&nbsp;succeed&nbsp;if&nbsp;the&nbsp;input&nbsp;implements&nbsp;ReadByte&nbsp;and&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="8072757">//&nbsp;type&nbsp;information&nbsp;in&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="8072792">func</span>&nbsp;<span class="ident" id="8072797">TestSequentialDecoder</span><span class="op" id="8072818">(</span><span class="ident" id="8072819">t</span>&nbsp;<span class="op" id="8072821">*</span><span class="ident" id="8072822">testing</span><span class="op" id="8072829">.</span><span class="ident" id="8072830">T</span><span class="op" id="8072831">)</span>&nbsp;<span class="op" id="8072833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072836">b</span>&nbsp;<span class="op" id="8072838">:=</span>&nbsp;<span class="builtinfunc" id="8072841">new</span><span class="op" id="8072844">(</span><span class="ident" id="8072845">bytes</span><span class="op" id="8072850">.</span><span class="ident" id="8072851">Buffer</span><span class="op" id="8072857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072860">enc</span>&nbsp;<span class="op" id="8072864">:=</span>&nbsp;<span class="ident" id="8072867">NewEncoder</span><span class="op" id="8072877">(</span><span class="ident" id="8072878">b</span><span class="op" id="8072879">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072882">const</span>&nbsp;<span class="ident" id="8072888">count</span>&nbsp;<span class="op" id="8072894">=</span>&nbsp;<span class="num" id="8072896">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072900">for</span>&nbsp;<span class="ident" id="8072904">i</span>&nbsp;<span class="op" id="8072906">:=</span>&nbsp;<span class="num" id="8072909">0</span><span class="op" id="8072910">;</span>&nbsp;<span class="ident" id="8072912">i</span>&nbsp;<span class="op" id="8072914">&lt;</span>&nbsp;<span class="ident" id="8072916">count</span><span class="op" id="8072921">;</span>&nbsp;<span class="ident" id="8072923">i</span><span class="op" id="8072924">++</span>&nbsp;<span class="op" id="8072927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072931">s</span>&nbsp;<span class="op" id="8072933">:=</span>&nbsp;<span class="ident" id="8072936">fmt</span><span class="op" id="8072939">.</span><span class="ident" id="8072940">Sprintf</span><span class="op" id="8072947">(</span><span class="string" id="8072948">&#34;%d&#34;</span><span class="op" id="8072952">,</span>&nbsp;<span class="ident" id="8072954">i</span><span class="op" id="8072955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072959">if</span>&nbsp;<span class="ident" id="8072962">err</span>&nbsp;<span class="op" id="8072966">:=</span>&nbsp;<span class="ident" id="8072969">enc</span><span class="op" id="8072972">.</span><span class="ident" id="8072973">Encode</span><span class="op" id="8072979">(</span><span class="ident" id="8072980">s</span><span class="op" id="8072981">)</span><span class="op" id="8072982">;</span>&nbsp;<span class="ident" id="8072984">err</span>&nbsp;<span class="op" id="8072988">!=</span>&nbsp;<span class="ident" id="8072991">nil</span>&nbsp;<span class="op" id="8072995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073000">t</span><span class="op" id="8073001">.</span><span class="ident" id="8073002">Error</span><span class="op" id="8073007">(</span><span class="string" id="8073008">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8073023">,</span>&nbsp;<span class="ident" id="8073025">err</span><span class="op" id="8073028">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8073032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8073035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073038">for</span>&nbsp;<span class="ident" id="8073042">i</span>&nbsp;<span class="op" id="8073044">:=</span>&nbsp;<span class="num" id="8073047">0</span><span class="op" id="8073048">;</span>&nbsp;<span class="ident" id="8073050">i</span>&nbsp;<span class="op" id="8073052">&lt;</span>&nbsp;<span class="ident" id="8073054">count</span><span class="op" id="8073059">;</span>&nbsp;<span class="ident" id="8073061">i</span><span class="op" id="8073062">++</span>&nbsp;<span class="op" id="8073065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073069">dec</span>&nbsp;<span class="op" id="8073073">:=</span>&nbsp;<span class="ident" id="8073076">NewDecoder</span><span class="op" id="8073086">(</span><span class="ident" id="8073087">b</span><span class="op" id="8073088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073092">var</span>&nbsp;<span class="ident" id="8073096">s</span>&nbsp;<span class="builtintype" id="8073098">string</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073107">if</span>&nbsp;<span class="ident" id="8073110">err</span>&nbsp;<span class="op" id="8073114">:=</span>&nbsp;<span class="ident" id="8073117">dec</span><span class="op" id="8073120">.</span><span class="ident" id="8073121">Decode</span><span class="op" id="8073127">(</span><span class="op" id="8073128">&amp;</span><span class="ident" id="8073129">s</span><span class="op" id="8073130">)</span><span class="op" id="8073131">;</span>&nbsp;<span class="ident" id="8073133">err</span>&nbsp;<span class="op" id="8073137">!=</span>&nbsp;<span class="ident" id="8073140">nil</span>&nbsp;<span class="op" id="8073144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073149">t</span><span class="op" id="8073150">.</span><span class="ident" id="8073151">Fatal</span><span class="op" id="8073156">(</span><span class="string" id="8073157">&#34;decoder&nbsp;fail:&#34;</span><span class="op" id="8073172">,</span>&nbsp;<span class="ident" id="8073174">err</span><span class="op" id="8073177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8073181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073185">if</span>&nbsp;<span class="ident" id="8073188">s</span>&nbsp;<span class="op" id="8073190">!=</span>&nbsp;<span class="ident" id="8073193">fmt</span><span class="op" id="8073196">.</span><span class="ident" id="8073197">Sprintf</span><span class="op" id="8073204">(</span><span class="string" id="8073205">&#34;%d&#34;</span><span class="op" id="8073209">,</span>&nbsp;<span class="ident" id="8073211">i</span><span class="op" id="8073212">)</span>&nbsp;<span class="op" id="8073214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073219">t</span><span class="op" id="8073220">.</span><span class="ident" id="8073221">Fatalf</span><span class="op" id="8073227">(</span><span class="string" id="8073228">&#34;decode&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8073255">,</span>&nbsp;<span class="ident" id="8073257">i</span><span class="op" id="8073258">,</span>&nbsp;<span class="ident" id="8073260">s</span><span class="op" id="8073261">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8073265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8073268">}</span><br>
<span class="lineno"></span><span class="op" id="8073270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8073273">//&nbsp;Should&nbsp;be&nbsp;able&nbsp;to&nbsp;have&nbsp;unrepresentable&nbsp;fields&nbsp;(chan,&nbsp;func,&nbsp;*chan&nbsp;etc.);&nbsp;we&nbsp;just&nbsp;ignore&nbsp;them.</span><br>
<span class="lineno">740</span><span class="keyword" id="8073369">type</span>&nbsp;<span class="ident" id="8073374">Bug2</span>&nbsp;<span class="keyword" id="8073379">struct</span>&nbsp;<span class="op" id="8073386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073389">A</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8073393">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073398">C</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="8073402">chan</span>&nbsp;<span class="builtintype" id="8073407">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073412">CP</span>&nbsp;&nbsp;<span class="op" id="8073416">*</span><span class="keyword" id="8073417">chan</span>&nbsp;<span class="builtintype" id="8073422">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073427">F</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="8073431">func</span><span class="op" id="8073435">(</span><span class="op" id="8073436">)</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073439">FPP</span>&nbsp;<span class="op" id="8073443">*</span><span class="op" id="8073444">*</span><span class="keyword" id="8073445">func</span><span class="op" id="8073449">(</span><span class="op" id="8073450">)</span><br>
<span class="lineno"></span><span class="op" id="8073452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8073455">func</span>&nbsp;<span class="ident" id="8073460">TestChanFuncIgnored</span><span class="op" id="8073479">(</span><span class="ident" id="8073480">t</span>&nbsp;<span class="op" id="8073482">*</span><span class="ident" id="8073483">testing</span><span class="op" id="8073490">.</span><span class="ident" id="8073491">T</span><span class="op" id="8073492">)</span>&nbsp;<span class="op" id="8073494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073497">c</span>&nbsp;<span class="op" id="8073499">:=</span>&nbsp;<span class="builtinfunc" id="8073502">make</span><span class="op" id="8073506">(</span><span class="keyword" id="8073507">chan</span>&nbsp;<span class="builtintype" id="8073512">int</span><span class="op" id="8073515">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073518">f</span>&nbsp;<span class="op" id="8073520">:=</span>&nbsp;<span class="keyword" id="8073523">func</span><span class="op" id="8073527">(</span><span class="op" id="8073528">)</span>&nbsp;<span class="op" id="8073530">{</span><span class="op" id="8073531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073534">fp</span>&nbsp;<span class="op" id="8073537">:=</span>&nbsp;<span class="op" id="8073540">&amp;</span><span class="ident" id="8073541">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073544">b0</span>&nbsp;<span class="op" id="8073547">:=</span>&nbsp;<span class="ident" id="8073550">Bug2</span><span class="op" id="8073554">{</span><span class="num" id="8073555">23</span><span class="op" id="8073557">,</span>&nbsp;<span class="ident" id="8073559">c</span><span class="op" id="8073560">,</span>&nbsp;<span class="op" id="8073562">&amp;</span><span class="ident" id="8073563">c</span><span class="op" id="8073564">,</span>&nbsp;<span class="ident" id="8073566">f</span><span class="op" id="8073567">,</span>&nbsp;<span class="op" id="8073569">&amp;</span><span class="ident" id="8073570">fp</span><span class="op" id="8073572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073575">var</span>&nbsp;<span class="ident" id="8073579">buf</span>&nbsp;<span class="ident" id="8073583">bytes</span><span class="op" id="8073588">.</span><span class="ident" id="8073589">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073597">enc</span>&nbsp;<span class="op" id="8073601">:=</span>&nbsp;<span class="ident" id="8073604">NewEncoder</span><span class="op" id="8073614">(</span><span class="op" id="8073615">&amp;</span><span class="ident" id="8073616">buf</span><span class="op" id="8073619">)</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073622">if</span>&nbsp;<span class="ident" id="8073625">err</span>&nbsp;<span class="op" id="8073629">:=</span>&nbsp;<span class="ident" id="8073632">enc</span><span class="op" id="8073635">.</span><span class="ident" id="8073636">Encode</span><span class="op" id="8073642">(</span><span class="ident" id="8073643">b0</span><span class="op" id="8073645">)</span><span class="op" id="8073646">;</span>&nbsp;<span class="ident" id="8073648">err</span>&nbsp;<span class="op" id="8073652">!=</span>&nbsp;<span class="ident" id="8073655">nil</span>&nbsp;<span class="op" id="8073659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073663">t</span><span class="op" id="8073664">.</span><span class="ident" id="8073665">Fatal</span><span class="op" id="8073670">(</span><span class="string" id="8073671">&#34;error&nbsp;encoding:&#34;</span><span class="op" id="8073688">,</span>&nbsp;<span class="ident" id="8073690">err</span><span class="op" id="8073693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8073696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073699">var</span>&nbsp;<span class="ident" id="8073703">b1</span>&nbsp;<span class="ident" id="8073706">Bug2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073712">err</span>&nbsp;<span class="op" id="8073716">:=</span>&nbsp;<span class="ident" id="8073719">NewDecoder</span><span class="op" id="8073729">(</span><span class="op" id="8073730">&amp;</span><span class="ident" id="8073731">buf</span><span class="op" id="8073734">)</span><span class="op" id="8073735">.</span><span class="ident" id="8073736">Decode</span><span class="op" id="8073742">(</span><span class="op" id="8073743">&amp;</span><span class="ident" id="8073744">b1</span><span class="op" id="8073746">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073749">if</span>&nbsp;<span class="ident" id="8073752">err</span>&nbsp;<span class="op" id="8073756">!=</span>&nbsp;<span class="ident" id="8073759">nil</span>&nbsp;<span class="op" id="8073763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073767">t</span><span class="op" id="8073768">.</span><span class="ident" id="8073769">Fatal</span><span class="op" id="8073774">(</span><span class="string" id="8073775">&#34;decode:&#34;</span><span class="op" id="8073784">,</span>&nbsp;<span class="ident" id="8073786">err</span><span class="op" id="8073789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8073792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073795">if</span>&nbsp;<span class="ident" id="8073798">b1</span><span class="op" id="8073800">.</span><span class="ident" id="8073801">A</span>&nbsp;<span class="op" id="8073803">!=</span>&nbsp;<span class="ident" id="8073806">b0</span><span class="op" id="8073808">.</span><span class="ident" id="8073809">A</span>&nbsp;<span class="op" id="8073811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073815">t</span><span class="op" id="8073816">.</span><span class="ident" id="8073817">Fatalf</span><span class="op" id="8073823">(</span><span class="string" id="8073824">&#34;got&nbsp;%d&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8073840">,</span>&nbsp;<span class="ident" id="8073842">b1</span><span class="op" id="8073844">.</span><span class="ident" id="8073845">A</span><span class="op" id="8073846">,</span>&nbsp;<span class="ident" id="8073848">b0</span><span class="op" id="8073850">.</span><span class="ident" id="8073851">A</span><span class="op" id="8073852">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8073855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073858">if</span>&nbsp;<span class="ident" id="8073861">b1</span><span class="op" id="8073863">.</span><span class="ident" id="8073864">C</span>&nbsp;<span class="op" id="8073866">!=</span>&nbsp;<span class="ident" id="8073869">nil</span>&nbsp;<span class="op" id="8073873">||</span>&nbsp;<span class="ident" id="8073876">b1</span><span class="op" id="8073878">.</span><span class="ident" id="8073879">CP</span>&nbsp;<span class="op" id="8073882">!=</span>&nbsp;<span class="ident" id="8073885">nil</span>&nbsp;<span class="op" id="8073889">||</span>&nbsp;<span class="ident" id="8073892">b1</span><span class="op" id="8073894">.</span><span class="ident" id="8073895">F</span>&nbsp;<span class="op" id="8073897">!=</span>&nbsp;<span class="ident" id="8073900">nil</span>&nbsp;<span class="op" id="8073904">||</span>&nbsp;<span class="ident" id="8073907">b1</span><span class="op" id="8073909">.</span><span class="ident" id="8073910">FPP</span>&nbsp;<span class="op" id="8073914">!=</span>&nbsp;<span class="ident" id="8073917">nil</span>&nbsp;<span class="op" id="8073921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073925">t</span><span class="op" id="8073926">.</span><span class="ident" id="8073927">Fatal</span><span class="op" id="8073932">(</span><span class="string" id="8073933">&#34;unexpected&nbsp;value&nbsp;for&nbsp;chan&nbsp;or&nbsp;func&#34;</span><span class="op" id="8073968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8073971">}</span><br>
<span class="lineno"></span><span class="op" id="8073973">}</span><br>
<span class="lineno">770</span><br>
<span class="lineno"></span><span class="keyword" id="8073976">func</span>&nbsp;<span class="ident" id="8073981">TestSliceIncompatibility</span><span class="op" id="8074005">(</span><span class="ident" id="8074006">t</span>&nbsp;<span class="op" id="8074008">*</span><span class="ident" id="8074009">testing</span><span class="op" id="8074016">.</span><span class="ident" id="8074017">T</span><span class="op" id="8074018">)</span>&nbsp;<span class="op" id="8074020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074023">var</span>&nbsp;<span class="ident" id="8074027">in</span>&nbsp;<span class="op" id="8074030">=</span>&nbsp;<span class="op" id="8074032">[</span><span class="op" id="8074033">]</span><span class="builtintype" id="8074034">byte</span><span class="op" id="8074038">{</span><span class="num" id="8074039">1</span><span class="op" id="8074040">,</span>&nbsp;<span class="num" id="8074042">2</span><span class="op" id="8074043">,</span>&nbsp;<span class="num" id="8074045">3</span><span class="op" id="8074046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074049">var</span>&nbsp;<span class="ident" id="8074053">out</span>&nbsp;<span class="op" id="8074057">[</span><span class="op" id="8074058">]</span><span class="builtintype" id="8074059">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074064">if</span>&nbsp;<span class="ident" id="8074067">err</span>&nbsp;<span class="op" id="8074071">:=</span>&nbsp;<span class="ident" id="8074074">encAndDec</span><span class="op" id="8074083">(</span><span class="ident" id="8074084">in</span><span class="op" id="8074086">,</span>&nbsp;<span class="op" id="8074088">&amp;</span><span class="ident" id="8074089">out</span><span class="op" id="8074092">)</span><span class="op" id="8074093">;</span>&nbsp;<span class="ident" id="8074095">err</span>&nbsp;<span class="op" id="8074099">==</span>&nbsp;<span class="ident" id="8074102">nil</span>&nbsp;<span class="op" id="8074106">{</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074110">t</span><span class="op" id="8074111">.</span><span class="ident" id="8074112">Error</span><span class="op" id="8074117">(</span><span class="string" id="8074118">&#34;expected&nbsp;compatibility&nbsp;error&#34;</span><span class="op" id="8074148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8074151">}</span><br>
<span class="lineno"></span><span class="op" id="8074153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8074156">//&nbsp;Mutually&nbsp;recursive&nbsp;slices&nbsp;of&nbsp;structs&nbsp;caused&nbsp;problems.</span><br>
<span class="lineno">780</span><span class="keyword" id="8074213">type</span>&nbsp;<span class="ident" id="8074218">Bug3</span>&nbsp;<span class="keyword" id="8074223">struct</span>&nbsp;<span class="op" id="8074230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074233">Num</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8074242">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074247">Children</span>&nbsp;<span class="op" id="8074256">[</span><span class="op" id="8074257">]</span><span class="op" id="8074258">*</span><span class="ident" id="8074259">Bug3</span><br>
<span class="lineno"></span><span class="op" id="8074264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">785</span><span class="keyword" id="8074267">func</span>&nbsp;<span class="ident" id="8074272">TestGobPtrSlices</span><span class="op" id="8074288">(</span><span class="ident" id="8074289">t</span>&nbsp;<span class="op" id="8074291">*</span><span class="ident" id="8074292">testing</span><span class="op" id="8074299">.</span><span class="ident" id="8074300">T</span><span class="op" id="8074301">)</span>&nbsp;<span class="op" id="8074303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074306">in</span>&nbsp;<span class="op" id="8074309">:=</span>&nbsp;<span class="op" id="8074312">[</span><span class="op" id="8074313">]</span><span class="op" id="8074314">*</span><span class="ident" id="8074315">Bug3</span><span class="op" id="8074319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8074323">{</span><span class="num" id="8074324">1</span><span class="op" id="8074325">,</span>&nbsp;<span class="ident" id="8074327">nil</span><span class="op" id="8074330">}</span><span class="op" id="8074331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8074335">{</span><span class="num" id="8074336">2</span><span class="op" id="8074337">,</span>&nbsp;<span class="ident" id="8074339">nil</span><span class="op" id="8074342">}</span><span class="op" id="8074343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8074346">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074349">b</span>&nbsp;<span class="op" id="8074351">:=</span>&nbsp;<span class="builtinfunc" id="8074354">new</span><span class="op" id="8074357">(</span><span class="ident" id="8074358">bytes</span><span class="op" id="8074363">.</span><span class="ident" id="8074364">Buffer</span><span class="op" id="8074370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074373">err</span>&nbsp;<span class="op" id="8074377">:=</span>&nbsp;<span class="ident" id="8074380">NewEncoder</span><span class="op" id="8074390">(</span><span class="ident" id="8074391">b</span><span class="op" id="8074392">)</span><span class="op" id="8074393">.</span><span class="ident" id="8074394">Encode</span><span class="op" id="8074400">(</span><span class="op" id="8074401">&amp;</span><span class="ident" id="8074402">in</span><span class="op" id="8074404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074407">if</span>&nbsp;<span class="ident" id="8074410">err</span>&nbsp;<span class="op" id="8074414">!=</span>&nbsp;<span class="ident" id="8074417">nil</span>&nbsp;<span class="op" id="8074421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074425">t</span><span class="op" id="8074426">.</span><span class="ident" id="8074427">Fatal</span><span class="op" id="8074432">(</span><span class="string" id="8074433">&#34;encode:&#34;</span><span class="op" id="8074442">,</span>&nbsp;<span class="ident" id="8074444">err</span><span class="op" id="8074447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8074450">}</span><br>
<span class="lineno">795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074454">var</span>&nbsp;<span class="ident" id="8074458">out</span>&nbsp;<span class="op" id="8074462">[</span><span class="op" id="8074463">]</span><span class="op" id="8074464">*</span><span class="ident" id="8074465">Bug3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074471">err</span>&nbsp;<span class="op" id="8074475">=</span>&nbsp;<span class="ident" id="8074477">NewDecoder</span><span class="op" id="8074487">(</span><span class="ident" id="8074488">b</span><span class="op" id="8074489">)</span><span class="op" id="8074490">.</span><span class="ident" id="8074491">Decode</span><span class="op" id="8074497">(</span><span class="op" id="8074498">&amp;</span><span class="ident" id="8074499">out</span><span class="op" id="8074502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074505">if</span>&nbsp;<span class="ident" id="8074508">err</span>&nbsp;<span class="op" id="8074512">!=</span>&nbsp;<span class="ident" id="8074515">nil</span>&nbsp;<span class="op" id="8074519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074523">t</span><span class="op" id="8074524">.</span><span class="ident" id="8074525">Fatal</span><span class="op" id="8074530">(</span><span class="string" id="8074531">&#34;decode:&#34;</span><span class="op" id="8074540">,</span>&nbsp;<span class="ident" id="8074542">err</span><span class="op" id="8074545">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8074548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074551">if</span>&nbsp;<span class="op" id="8074554">!</span><span class="ident" id="8074555">reflect</span><span class="op" id="8074562">.</span><span class="ident" id="8074563">DeepEqual</span><span class="op" id="8074572">(</span><span class="ident" id="8074573">in</span><span class="op" id="8074575">,</span>&nbsp;<span class="ident" id="8074577">out</span><span class="op" id="8074580">)</span>&nbsp;<span class="op" id="8074582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074586">t</span><span class="op" id="8074587">.</span><span class="ident" id="8074588">Fatalf</span><span class="op" id="8074594">(</span><span class="string" id="8074595">&#34;got&nbsp;%v;&nbsp;wanted&nbsp;%v&#34;</span><span class="op" id="8074614">,</span>&nbsp;<span class="ident" id="8074616">out</span><span class="op" id="8074619">,</span>&nbsp;<span class="ident" id="8074621">in</span><span class="op" id="8074623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8074626">}</span><br>
<span class="lineno"></span><span class="op" id="8074628">}</span><br>
<span class="lineno">805</span><br>
<span class="lineno"></span><span class="comment" id="8074631">//&nbsp;getDecEnginePtr&nbsp;cached&nbsp;engine&nbsp;for&nbsp;ut.base&nbsp;instead&nbsp;of&nbsp;ut.user&nbsp;so&nbsp;we&nbsp;passed</span><br>
<span class="lineno"></span><span class="comment" id="8074708">//&nbsp;a&nbsp;*map&nbsp;and&nbsp;then&nbsp;tried&nbsp;to&nbsp;reuse&nbsp;its&nbsp;engine&nbsp;to&nbsp;decode&nbsp;the&nbsp;inner&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="8074778">func</span>&nbsp;<span class="ident" id="8074783">TestPtrToMapOfMap</span><span class="op" id="8074800">(</span><span class="ident" id="8074801">t</span>&nbsp;<span class="op" id="8074803">*</span><span class="ident" id="8074804">testing</span><span class="op" id="8074811">.</span><span class="ident" id="8074812">T</span><span class="op" id="8074813">)</span>&nbsp;<span class="op" id="8074815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074818">Register</span><span class="op" id="8074826">(</span><span class="builtinfunc" id="8074827">make</span><span class="op" id="8074831">(</span><span class="keyword" id="8074832">map</span><span class="op" id="8074835">[</span><span class="builtintype" id="8074836">string</span><span class="op" id="8074842">]</span><span class="keyword" id="8074843">interface</span><span class="op" id="8074852">{</span><span class="op" id="8074853">}</span><span class="op" id="8074854">)</span><span class="op" id="8074855">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074858">subdata</span>&nbsp;<span class="op" id="8074866">:=</span>&nbsp;<span class="builtinfunc" id="8074869">make</span><span class="op" id="8074873">(</span><span class="keyword" id="8074874">map</span><span class="op" id="8074877">[</span><span class="builtintype" id="8074878">string</span><span class="op" id="8074884">]</span><span class="keyword" id="8074885">interface</span><span class="op" id="8074894">{</span><span class="op" id="8074895">}</span><span class="op" id="8074896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074899">subdata</span><span class="op" id="8074906">[</span><span class="string" id="8074907">&#34;bar&#34;</span><span class="op" id="8074912">]</span>&nbsp;<span class="op" id="8074914">=</span>&nbsp;<span class="string" id="8074916">&#34;baz&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074923">data</span>&nbsp;<span class="op" id="8074928">:=</span>&nbsp;<span class="builtinfunc" id="8074931">make</span><span class="op" id="8074935">(</span><span class="keyword" id="8074936">map</span><span class="op" id="8074939">[</span><span class="builtintype" id="8074940">string</span><span class="op" id="8074946">]</span><span class="keyword" id="8074947">interface</span><span class="op" id="8074956">{</span><span class="op" id="8074957">}</span><span class="op" id="8074958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074961">data</span><span class="op" id="8074965">[</span><span class="string" id="8074966">&#34;foo&#34;</span><span class="op" id="8074971">]</span>&nbsp;<span class="op" id="8074973">=</span>&nbsp;<span class="ident" id="8074975">subdata</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074985">b</span>&nbsp;<span class="op" id="8074987">:=</span>&nbsp;<span class="builtinfunc" id="8074990">new</span><span class="op" id="8074993">(</span><span class="ident" id="8074994">bytes</span><span class="op" id="8074999">.</span><span class="ident" id="8075000">Buffer</span><span class="op" id="8075006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075009">err</span>&nbsp;<span class="op" id="8075013">:=</span>&nbsp;<span class="ident" id="8075016">NewEncoder</span><span class="op" id="8075026">(</span><span class="ident" id="8075027">b</span><span class="op" id="8075028">)</span><span class="op" id="8075029">.</span><span class="ident" id="8075030">Encode</span><span class="op" id="8075036">(</span><span class="ident" id="8075037">data</span><span class="op" id="8075041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075044">if</span>&nbsp;<span class="ident" id="8075047">err</span>&nbsp;<span class="op" id="8075051">!=</span>&nbsp;<span class="ident" id="8075054">nil</span>&nbsp;<span class="op" id="8075058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075062">t</span><span class="op" id="8075063">.</span><span class="ident" id="8075064">Fatal</span><span class="op" id="8075069">(</span><span class="string" id="8075070">&#34;encode:&#34;</span><span class="op" id="8075079">,</span>&nbsp;<span class="ident" id="8075081">err</span><span class="op" id="8075084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8075087">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075090">var</span>&nbsp;<span class="ident" id="8075094">newData</span>&nbsp;<span class="keyword" id="8075102">map</span><span class="op" id="8075105">[</span><span class="builtintype" id="8075106">string</span><span class="op" id="8075112">]</span><span class="keyword" id="8075113">interface</span><span class="op" id="8075122">{</span><span class="op" id="8075123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075126">err</span>&nbsp;<span class="op" id="8075130">=</span>&nbsp;<span class="ident" id="8075132">NewDecoder</span><span class="op" id="8075142">(</span><span class="ident" id="8075143">b</span><span class="op" id="8075144">)</span><span class="op" id="8075145">.</span><span class="ident" id="8075146">Decode</span><span class="op" id="8075152">(</span><span class="op" id="8075153">&amp;</span><span class="ident" id="8075154">newData</span><span class="op" id="8075161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075164">if</span>&nbsp;<span class="ident" id="8075167">err</span>&nbsp;<span class="op" id="8075171">!=</span>&nbsp;<span class="ident" id="8075174">nil</span>&nbsp;<span class="op" id="8075178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075182">t</span><span class="op" id="8075183">.</span><span class="ident" id="8075184">Fatal</span><span class="op" id="8075189">(</span><span class="string" id="8075190">&#34;decode:&#34;</span><span class="op" id="8075199">,</span>&nbsp;<span class="ident" id="8075201">err</span><span class="op" id="8075204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8075207">}</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075210">if</span>&nbsp;<span class="op" id="8075213">!</span><span class="ident" id="8075214">reflect</span><span class="op" id="8075221">.</span><span class="ident" id="8075222">DeepEqual</span><span class="op" id="8075231">(</span><span class="ident" id="8075232">data</span><span class="op" id="8075236">,</span>&nbsp;<span class="ident" id="8075238">newData</span><span class="op" id="8075245">)</span>&nbsp;<span class="op" id="8075247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075251">t</span><span class="op" id="8075252">.</span><span class="ident" id="8075253">Fatalf</span><span class="op" id="8075259">(</span><span class="string" id="8075260">&#34;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8075280">,</span>&nbsp;<span class="ident" id="8075282">data</span><span class="op" id="8075286">,</span>&nbsp;<span class="ident" id="8075288">newData</span><span class="op" id="8075295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8075298">}</span><br>
<span class="lineno"></span><span class="op" id="8075300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">830</span><span class="comment" id="8075303">//&nbsp;A&nbsp;top-level&nbsp;nil&nbsp;pointer&nbsp;generates&nbsp;a&nbsp;panic&nbsp;with&nbsp;a&nbsp;helpful&nbsp;string-valued&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="8075386">func</span>&nbsp;<span class="ident" id="8075391">TestTopLevelNilPointer</span><span class="op" id="8075413">(</span><span class="ident" id="8075414">t</span>&nbsp;<span class="op" id="8075416">*</span><span class="ident" id="8075417">testing</span><span class="op" id="8075424">.</span><span class="ident" id="8075425">T</span><span class="op" id="8075426">)</span>&nbsp;<span class="op" id="8075428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075431">errMsg</span>&nbsp;<span class="op" id="8075438">:=</span>&nbsp;<span class="ident" id="8075441">topLevelNilPanic</span><span class="op" id="8075457">(</span><span class="ident" id="8075458">t</span><span class="op" id="8075459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075462">if</span>&nbsp;<span class="ident" id="8075465">errMsg</span>&nbsp;<span class="op" id="8075472">==</span>&nbsp;<span class="string" id="8075475">&#34;&#34;</span>&nbsp;<span class="op" id="8075478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075482">t</span><span class="op" id="8075483">.</span><span class="ident" id="8075484">Fatal</span><span class="op" id="8075489">(</span><span class="string" id="8075490">&#34;top-level&nbsp;nil&nbsp;pointer&nbsp;did&nbsp;not&nbsp;panic&#34;</span><span class="op" id="8075527">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8075530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075533">if</span>&nbsp;<span class="op" id="8075536">!</span><span class="ident" id="8075537">strings</span><span class="op" id="8075544">.</span><span class="ident" id="8075545">Contains</span><span class="op" id="8075553">(</span><span class="ident" id="8075554">errMsg</span><span class="op" id="8075560">,</span>&nbsp;<span class="string" id="8075562">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="8075575">)</span>&nbsp;<span class="op" id="8075577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075581">t</span><span class="op" id="8075582">.</span><span class="ident" id="8075583">Fatal</span><span class="op" id="8075588">(</span><span class="string" id="8075589">&#34;expected&nbsp;nil&nbsp;pointer&nbsp;error,&nbsp;got:&#34;</span><span class="op" id="8075623">,</span>&nbsp;<span class="ident" id="8075625">errMsg</span><span class="op" id="8075631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8075634">}</span><br>
<span class="lineno"></span><span class="op" id="8075636">}</span><br>
<span class="lineno">840</span><br>
<span class="lineno"></span><span class="keyword" id="8075639">func</span>&nbsp;<span class="ident" id="8075644">topLevelNilPanic</span><span class="op" id="8075660">(</span><span class="ident" id="8075661">t</span>&nbsp;<span class="op" id="8075663">*</span><span class="ident" id="8075664">testing</span><span class="op" id="8075671">.</span><span class="ident" id="8075672">T</span><span class="op" id="8075673">)</span>&nbsp;<span class="op" id="8075675">(</span><span class="ident" id="8075676">panicErr</span>&nbsp;<span class="builtintype" id="8075685">string</span><span class="op" id="8075691">)</span>&nbsp;<span class="op" id="8075693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075696">defer</span>&nbsp;<span class="keyword" id="8075702">func</span><span class="op" id="8075706">(</span><span class="op" id="8075707">)</span>&nbsp;<span class="op" id="8075709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075713">e</span>&nbsp;<span class="op" id="8075715">:=</span>&nbsp;<span class="builtinfunc" id="8075718">recover</span><span class="op" id="8075725">(</span><span class="op" id="8075726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075730">if</span>&nbsp;<span class="ident" id="8075733">err</span><span class="op" id="8075736">,</span>&nbsp;<span class="ident" id="8075738">ok</span>&nbsp;<span class="op" id="8075741">:=</span>&nbsp;<span class="ident" id="8075744">e</span><span class="op" id="8075745">.</span><span class="op" id="8075746">(</span><span class="builtintype" id="8075747">string</span><span class="op" id="8075753">)</span><span class="op" id="8075754">;</span>&nbsp;<span class="ident" id="8075756">ok</span>&nbsp;<span class="op" id="8075759">{</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075764">panicErr</span>&nbsp;<span class="op" id="8075773">=</span>&nbsp;<span class="ident" id="8075775">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8075781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8075784">}</span><span class="op" id="8075785">(</span><span class="op" id="8075786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075789">var</span>&nbsp;<span class="ident" id="8075793">ip</span>&nbsp;<span class="op" id="8075796">*</span><span class="builtintype" id="8075797">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075802">buf</span>&nbsp;<span class="op" id="8075806">:=</span>&nbsp;<span class="builtinfunc" id="8075809">new</span><span class="op" id="8075812">(</span><span class="ident" id="8075813">bytes</span><span class="op" id="8075818">.</span><span class="ident" id="8075819">Buffer</span><span class="op" id="8075825">)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075828">if</span>&nbsp;<span class="ident" id="8075831">err</span>&nbsp;<span class="op" id="8075835">:=</span>&nbsp;<span class="ident" id="8075838">NewEncoder</span><span class="op" id="8075848">(</span><span class="ident" id="8075849">buf</span><span class="op" id="8075852">)</span><span class="op" id="8075853">.</span><span class="ident" id="8075854">Encode</span><span class="op" id="8075860">(</span><span class="ident" id="8075861">ip</span><span class="op" id="8075863">)</span><span class="op" id="8075864">;</span>&nbsp;<span class="ident" id="8075866">err</span>&nbsp;<span class="op" id="8075870">!=</span>&nbsp;<span class="ident" id="8075873">nil</span>&nbsp;<span class="op" id="8075877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075881">t</span><span class="op" id="8075882">.</span><span class="ident" id="8075883">Fatal</span><span class="op" id="8075888">(</span><span class="string" id="8075889">&#34;error&nbsp;in&nbsp;encode:&#34;</span><span class="op" id="8075907">,</span>&nbsp;<span class="ident" id="8075909">err</span><span class="op" id="8075912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8075915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075918">return</span><br>
<span class="lineno"></span><span class="op" id="8075925">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span><span class="keyword" id="8075928">func</span>&nbsp;<span class="ident" id="8075933">TestNilPointerInsideInterface</span><span class="op" id="8075962">(</span><span class="ident" id="8075963">t</span>&nbsp;<span class="op" id="8075965">*</span><span class="ident" id="8075966">testing</span><span class="op" id="8075973">.</span><span class="ident" id="8075974">T</span><span class="op" id="8075975">)</span>&nbsp;<span class="op" id="8075977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075980">var</span>&nbsp;<span class="ident" id="8075984">ip</span>&nbsp;<span class="op" id="8075987">*</span><span class="builtintype" id="8075988">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075993">si</span>&nbsp;<span class="op" id="8075996">:=</span>&nbsp;<span class="keyword" id="8075999">struct</span>&nbsp;<span class="op" id="8076006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076010">I</span>&nbsp;<span class="keyword" id="8076012">interface</span><span class="op" id="8076021">{</span><span class="op" id="8076022">}</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8076025">}</span><span class="op" id="8076026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076030">I</span><span class="op" id="8076031">:</span>&nbsp;<span class="ident" id="8076033">ip</span><span class="op" id="8076035">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8076038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076041">buf</span>&nbsp;<span class="op" id="8076045">:=</span>&nbsp;<span class="builtinfunc" id="8076048">new</span><span class="op" id="8076051">(</span><span class="ident" id="8076052">bytes</span><span class="op" id="8076057">.</span><span class="ident" id="8076058">Buffer</span><span class="op" id="8076064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076067">err</span>&nbsp;<span class="op" id="8076071">:=</span>&nbsp;<span class="ident" id="8076074">NewEncoder</span><span class="op" id="8076084">(</span><span class="ident" id="8076085">buf</span><span class="op" id="8076088">)</span><span class="op" id="8076089">.</span><span class="ident" id="8076090">Encode</span><span class="op" id="8076096">(</span><span class="ident" id="8076097">si</span><span class="op" id="8076099">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8076102">if</span>&nbsp;<span class="ident" id="8076105">err</span>&nbsp;<span class="op" id="8076109">==</span>&nbsp;<span class="ident" id="8076112">nil</span>&nbsp;<span class="op" id="8076116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076120">t</span><span class="op" id="8076121">.</span><span class="ident" id="8076122">Fatal</span><span class="op" id="8076127">(</span><span class="string" id="8076128">&#34;expected&nbsp;error,&nbsp;got&nbsp;none&#34;</span><span class="op" id="8076154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8076157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076160">errMsg</span>&nbsp;<span class="op" id="8076167">:=</span>&nbsp;<span class="ident" id="8076170">err</span><span class="op" id="8076173">.</span><span class="ident" id="8076174">Error</span><span class="op" id="8076179">(</span><span class="op" id="8076180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8076183">if</span>&nbsp;<span class="op" id="8076186">!</span><span class="ident" id="8076187">strings</span><span class="op" id="8076194">.</span><span class="ident" id="8076195">Contains</span><span class="op" id="8076203">(</span><span class="ident" id="8076204">errMsg</span><span class="op" id="8076210">,</span>&nbsp;<span class="string" id="8076212">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="8076225">)</span>&nbsp;<span class="op" id="8076227">||</span>&nbsp;<span class="op" id="8076230">!</span><span class="ident" id="8076231">strings</span><span class="op" id="8076238">.</span><span class="ident" id="8076239">Contains</span><span class="op" id="8076247">(</span><span class="ident" id="8076248">errMsg</span><span class="op" id="8076254">,</span>&nbsp;<span class="string" id="8076256">&#34;interface&#34;</span><span class="op" id="8076267">)</span>&nbsp;<span class="op" id="8076269">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076273">t</span><span class="op" id="8076274">.</span><span class="ident" id="8076275">Fatal</span><span class="op" id="8076280">(</span><span class="string" id="8076281">&#34;expected&nbsp;error&nbsp;about&nbsp;nil&nbsp;pointer&nbsp;and&nbsp;interface,&nbsp;got:&#34;</span><span class="op" id="8076335">,</span>&nbsp;<span class="ident" id="8076337">errMsg</span><span class="op" id="8076343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8076346">}</span><br>
<span class="lineno"></span><span class="op" id="8076348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8076351">type</span>&nbsp;<span class="ident" id="8076356">Bug4Public</span>&nbsp;<span class="keyword" id="8076367">struct</span>&nbsp;<span class="op" id="8076374">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076377">Name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8076384">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076392">Secret</span>&nbsp;<span class="ident" id="8076399">Bug4Secret</span><br>
<span class="lineno"></span><span class="op" id="8076410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8076413">type</span>&nbsp;<span class="ident" id="8076418">Bug4Secret</span>&nbsp;<span class="keyword" id="8076429">struct</span>&nbsp;<span class="op" id="8076436">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076439">a</span>&nbsp;<span class="builtintype" id="8076441">int</span>&nbsp;<span class="comment" id="8076445">//&nbsp;error:&nbsp;no&nbsp;exported&nbsp;fields.</span><br>
<span class="lineno"></span><span class="op" id="8076475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8076478">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;failed&nbsp;compilation&nbsp;doesn&#39;t&nbsp;leave&nbsp;around&nbsp;an&nbsp;executable&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="8076556">//&nbsp;Issue&nbsp;3273.</span><br>
<span class="lineno">885</span><span class="keyword" id="8076571">func</span>&nbsp;<span class="ident" id="8076576">TestMutipleEncodingsOfBadType</span><span class="op" id="8076605">(</span><span class="ident" id="8076606">t</span>&nbsp;<span class="op" id="8076608">*</span><span class="ident" id="8076609">testing</span><span class="op" id="8076616">.</span><span class="ident" id="8076617">T</span><span class="op" id="8076618">)</span>&nbsp;<span class="op" id="8076620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076623">x</span>&nbsp;<span class="op" id="8076625">:=</span>&nbsp;<span class="ident" id="8076628">Bug4Public</span><span class="op" id="8076638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076642">Name</span><span class="op" id="8076646">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8076650">&#34;name&#34;</span><span class="op" id="8076656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076660">Secret</span><span class="op" id="8076666">:</span>&nbsp;<span class="ident" id="8076668">Bug4Secret</span><span class="op" id="8076678">{</span><span class="num" id="8076679">1</span><span class="op" id="8076680">}</span><span class="op" id="8076681">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8076684">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076687">buf</span>&nbsp;<span class="op" id="8076691">:=</span>&nbsp;<span class="builtinfunc" id="8076694">new</span><span class="op" id="8076697">(</span><span class="ident" id="8076698">bytes</span><span class="op" id="8076703">.</span><span class="ident" id="8076704">Buffer</span><span class="op" id="8076710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076713">enc</span>&nbsp;<span class="op" id="8076717">:=</span>&nbsp;<span class="ident" id="8076720">NewEncoder</span><span class="op" id="8076730">(</span><span class="ident" id="8076731">buf</span><span class="op" id="8076734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076737">err</span>&nbsp;<span class="op" id="8076741">:=</span>&nbsp;<span class="ident" id="8076744">enc</span><span class="op" id="8076747">.</span><span class="ident" id="8076748">Encode</span><span class="op" id="8076754">(</span><span class="ident" id="8076755">x</span><span class="op" id="8076756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8076759">if</span>&nbsp;<span class="ident" id="8076762">err</span>&nbsp;<span class="op" id="8076766">==</span>&nbsp;<span class="ident" id="8076769">nil</span>&nbsp;<span class="op" id="8076773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076777">t</span><span class="op" id="8076778">.</span><span class="ident" id="8076779">Fatal</span><span class="op" id="8076784">(</span><span class="string" id="8076785">&#34;first&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8076817">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8076820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076823">buf</span><span class="op" id="8076826">.</span><span class="ident" id="8076827">Reset</span><span class="op" id="8076832">(</span><span class="op" id="8076833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076836">enc</span>&nbsp;<span class="op" id="8076840">=</span>&nbsp;<span class="ident" id="8076842">NewEncoder</span><span class="op" id="8076852">(</span><span class="ident" id="8076853">buf</span><span class="op" id="8076856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076859">err</span>&nbsp;<span class="op" id="8076863">=</span>&nbsp;<span class="ident" id="8076865">enc</span><span class="op" id="8076868">.</span><span class="ident" id="8076869">Encode</span><span class="op" id="8076875">(</span><span class="ident" id="8076876">x</span><span class="op" id="8076877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8076880">if</span>&nbsp;<span class="ident" id="8076883">err</span>&nbsp;<span class="op" id="8076887">==</span>&nbsp;<span class="ident" id="8076890">nil</span>&nbsp;<span class="op" id="8076894">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076898">t</span><span class="op" id="8076899">.</span><span class="ident" id="8076900">Fatal</span><span class="op" id="8076905">(</span><span class="string" id="8076906">&#34;second&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8076939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8076942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8076945">if</span>&nbsp;<span class="op" id="8076948">!</span><span class="ident" id="8076949">strings</span><span class="op" id="8076956">.</span><span class="ident" id="8076957">Contains</span><span class="op" id="8076965">(</span><span class="ident" id="8076966">err</span><span class="op" id="8076969">.</span><span class="ident" id="8076970">Error</span><span class="op" id="8076975">(</span><span class="op" id="8076976">)</span><span class="op" id="8076977">,</span>&nbsp;<span class="string" id="8076979">&#34;no&nbsp;exported&nbsp;fields&#34;</span><span class="op" id="8076999">)</span>&nbsp;<span class="op" id="8077001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077005">t</span><span class="op" id="8077006">.</span><span class="ident" id="8077007">Errorf</span><span class="op" id="8077013">(</span><span class="string" id="8077014">&#34;expected&nbsp;error&nbsp;about&nbsp;no&nbsp;exported&nbsp;fields;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8077063">,</span>&nbsp;<span class="ident" id="8077065">err</span><span class="op" id="8077068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8077071">}</span><br>
<span class="lineno">905</span><span class="op" id="8077073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8077076">//&nbsp;There&nbsp;was&nbsp;an&nbsp;error&nbsp;check&nbsp;comparing&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8077147">//&nbsp;length&nbsp;of&nbsp;the&nbsp;slice&nbsp;being&nbsp;decoded.&nbsp;It&nbsp;was&nbsp;wrong&nbsp;because&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="8077215">//&nbsp;thing&nbsp;in&nbsp;the&nbsp;input&nbsp;might&nbsp;be&nbsp;a&nbsp;type&nbsp;definition,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to</span><br>
<span class="lineno">910</span><span class="comment" id="8077285">//&nbsp;an&nbsp;incorrect&nbsp;length&nbsp;check.&nbsp;&nbsp;This&nbsp;test&nbsp;reproduces&nbsp;the&nbsp;corner&nbsp;case.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8077355">type</span>&nbsp;<span class="ident" id="8077360">Z</span>&nbsp;<span class="keyword" id="8077362">struct</span>&nbsp;<span class="op" id="8077369">{</span><br>
<span class="lineno"></span><span class="op" id="8077371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="8077374">func</span>&nbsp;<span class="ident" id="8077379">Test29ElementSlice</span><span class="op" id="8077397">(</span><span class="ident" id="8077398">t</span>&nbsp;<span class="op" id="8077400">*</span><span class="ident" id="8077401">testing</span><span class="op" id="8077408">.</span><span class="ident" id="8077409">T</span><span class="op" id="8077410">)</span>&nbsp;<span class="op" id="8077412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077415">Register</span><span class="op" id="8077423">(</span><span class="ident" id="8077424">Z</span><span class="op" id="8077425">{</span><span class="op" id="8077426">}</span><span class="op" id="8077427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077430">src</span>&nbsp;<span class="op" id="8077434">:=</span>&nbsp;<span class="builtinfunc" id="8077437">make</span><span class="op" id="8077441">(</span><span class="op" id="8077442">[</span><span class="op" id="8077443">]</span><span class="keyword" id="8077444">interface</span><span class="op" id="8077453">{</span><span class="op" id="8077454">}</span><span class="op" id="8077455">,</span>&nbsp;<span class="num" id="8077457">100</span><span class="op" id="8077460">)</span>&nbsp;<span class="comment" id="8077462">//&nbsp;Size&nbsp;needs&nbsp;to&nbsp;be&nbsp;bigger&nbsp;than&nbsp;size&nbsp;of&nbsp;type&nbsp;definition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8077520">for</span>&nbsp;<span class="ident" id="8077524">i</span>&nbsp;<span class="op" id="8077526">:=</span>&nbsp;<span class="keyword" id="8077529">range</span>&nbsp;<span class="ident" id="8077535">src</span>&nbsp;<span class="op" id="8077539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077543">src</span><span class="op" id="8077546">[</span><span class="ident" id="8077547">i</span><span class="op" id="8077548">]</span>&nbsp;<span class="op" id="8077550">=</span>&nbsp;<span class="ident" id="8077552">Z</span><span class="op" id="8077553">{</span><span class="op" id="8077554">}</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8077557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077560">buf</span>&nbsp;<span class="op" id="8077564">:=</span>&nbsp;<span class="builtinfunc" id="8077567">new</span><span class="op" id="8077570">(</span><span class="ident" id="8077571">bytes</span><span class="op" id="8077576">.</span><span class="ident" id="8077577">Buffer</span><span class="op" id="8077583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077586">err</span>&nbsp;<span class="op" id="8077590">:=</span>&nbsp;<span class="ident" id="8077593">NewEncoder</span><span class="op" id="8077603">(</span><span class="ident" id="8077604">buf</span><span class="op" id="8077607">)</span><span class="op" id="8077608">.</span><span class="ident" id="8077609">Encode</span><span class="op" id="8077615">(</span><span class="ident" id="8077616">src</span><span class="op" id="8077619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8077622">if</span>&nbsp;<span class="ident" id="8077625">err</span>&nbsp;<span class="op" id="8077629">!=</span>&nbsp;<span class="ident" id="8077632">nil</span>&nbsp;<span class="op" id="8077636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077640">t</span><span class="op" id="8077641">.</span><span class="ident" id="8077642">Fatalf</span><span class="op" id="8077648">(</span><span class="string" id="8077649">&#34;encode:&nbsp;%v&#34;</span><span class="op" id="8077661">,</span>&nbsp;<span class="ident" id="8077663">err</span><span class="op" id="8077666">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8077670">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8077678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8077682">var</span>&nbsp;<span class="ident" id="8077686">dst</span>&nbsp;<span class="op" id="8077690">[</span><span class="op" id="8077691">]</span><span class="keyword" id="8077692">interface</span><span class="op" id="8077701">{</span><span class="op" id="8077702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077705">err</span>&nbsp;<span class="op" id="8077709">=</span>&nbsp;<span class="ident" id="8077711">NewDecoder</span><span class="op" id="8077721">(</span><span class="ident" id="8077722">buf</span><span class="op" id="8077725">)</span><span class="op" id="8077726">.</span><span class="ident" id="8077727">Decode</span><span class="op" id="8077733">(</span><span class="op" id="8077734">&amp;</span><span class="ident" id="8077735">dst</span><span class="op" id="8077738">)</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8077741">if</span>&nbsp;<span class="ident" id="8077744">err</span>&nbsp;<span class="op" id="8077748">!=</span>&nbsp;<span class="ident" id="8077751">nil</span>&nbsp;<span class="op" id="8077755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077759">t</span><span class="op" id="8077760">.</span><span class="ident" id="8077761">Errorf</span><span class="op" id="8077767">(</span><span class="string" id="8077768">&#34;decode:&nbsp;%v&#34;</span><span class="op" id="8077780">,</span>&nbsp;<span class="ident" id="8077782">err</span><span class="op" id="8077785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8077789">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8077797">}</span><br>
<span class="lineno"></span><span class="op" id="8077799">}</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span><span class="comment" id="8077802">//&nbsp;Don&#39;t&nbsp;crash,&nbsp;just&nbsp;give&nbsp;error&nbsp;when&nbsp;allocating&nbsp;a&nbsp;huge&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="8077864">//&nbsp;Issue&nbsp;8084.</span><br>
<span class="lineno"></span><span class="keyword" id="8077879">func</span>&nbsp;<span class="ident" id="8077884">TestErrorForHugeSlice</span><span class="op" id="8077905">(</span><span class="ident" id="8077906">t</span>&nbsp;<span class="op" id="8077908">*</span><span class="ident" id="8077909">testing</span><span class="op" id="8077916">.</span><span class="ident" id="8077917">T</span><span class="op" id="8077918">)</span>&nbsp;<span class="op" id="8077920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8077923">//&nbsp;Encode&nbsp;an&nbsp;int&nbsp;slice.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077948">buf</span>&nbsp;<span class="op" id="8077952">:=</span>&nbsp;<span class="builtinfunc" id="8077955">new</span><span class="op" id="8077958">(</span><span class="ident" id="8077959">bytes</span><span class="op" id="8077964">.</span><span class="ident" id="8077965">Buffer</span><span class="op" id="8077971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077974">slice</span>&nbsp;<span class="op" id="8077980">:=</span>&nbsp;<span class="op" id="8077983">[</span><span class="op" id="8077984">]</span><span class="builtintype" id="8077985">int</span><span class="op" id="8077988">{</span><span class="num" id="8077989">1</span><span class="op" id="8077990">,</span>&nbsp;<span class="num" id="8077992">1</span><span class="op" id="8077993">,</span>&nbsp;<span class="num" id="8077995">1</span><span class="op" id="8077996">,</span>&nbsp;<span class="num" id="8077998">1</span><span class="op" id="8077999">,</span>&nbsp;<span class="num" id="8078001">1</span><span class="op" id="8078002">,</span>&nbsp;<span class="num" id="8078004">1</span><span class="op" id="8078005">,</span>&nbsp;<span class="num" id="8078007">1</span><span class="op" id="8078008">,</span>&nbsp;<span class="num" id="8078010">1</span><span class="op" id="8078011">,</span>&nbsp;<span class="num" id="8078013">1</span><span class="op" id="8078014">,</span>&nbsp;<span class="num" id="8078016">1</span><span class="op" id="8078017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078020">err</span>&nbsp;<span class="op" id="8078024">:=</span>&nbsp;<span class="ident" id="8078027">NewEncoder</span><span class="op" id="8078037">(</span><span class="ident" id="8078038">buf</span><span class="op" id="8078041">)</span><span class="op" id="8078042">.</span><span class="ident" id="8078043">Encode</span><span class="op" id="8078049">(</span><span class="ident" id="8078050">slice</span><span class="op" id="8078055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8078058">if</span>&nbsp;<span class="ident" id="8078061">err</span>&nbsp;<span class="op" id="8078065">!=</span>&nbsp;<span class="ident" id="8078068">nil</span>&nbsp;<span class="op" id="8078072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078076">t</span><span class="op" id="8078077">.</span><span class="ident" id="8078078">Fatal</span><span class="op" id="8078083">(</span><span class="string" id="8078084">&#34;encode:&#34;</span><span class="op" id="8078093">,</span>&nbsp;<span class="ident" id="8078095">err</span><span class="op" id="8078098">)</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8078101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8078104">//&nbsp;Reach&nbsp;into&nbsp;the&nbsp;buffer&nbsp;and&nbsp;smash&nbsp;the&nbsp;count&nbsp;to&nbsp;make&nbsp;the&nbsp;encoded&nbsp;slice&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078187">buf</span><span class="op" id="8078190">.</span><span class="ident" id="8078191">Bytes</span><span class="op" id="8078196">(</span><span class="op" id="8078197">)</span><span class="op" id="8078198">[</span><span class="ident" id="8078199">buf</span><span class="op" id="8078202">.</span><span class="ident" id="8078203">Len</span><span class="op" id="8078206">(</span><span class="op" id="8078207">)</span><span class="op" id="8078208">-</span><span class="builtinfunc" id="8078209">len</span><span class="op" id="8078212">(</span><span class="ident" id="8078213">slice</span><span class="op" id="8078218">)</span><span class="op" id="8078219">-</span><span class="num" id="8078220">1</span><span class="op" id="8078221">]</span>&nbsp;<span class="op" id="8078223">=</span>&nbsp;<span class="num" id="8078225">0xfa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8078231">//&nbsp;Decode&nbsp;and&nbsp;see&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078257">err</span>&nbsp;<span class="op" id="8078261">=</span>&nbsp;<span class="ident" id="8078263">NewDecoder</span><span class="op" id="8078273">(</span><span class="ident" id="8078274">buf</span><span class="op" id="8078277">)</span><span class="op" id="8078278">.</span><span class="ident" id="8078279">Decode</span><span class="op" id="8078285">(</span><span class="op" id="8078286">&amp;</span><span class="ident" id="8078287">slice</span><span class="op" id="8078292">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8078295">if</span>&nbsp;<span class="ident" id="8078298">err</span>&nbsp;<span class="op" id="8078302">==</span>&nbsp;<span class="ident" id="8078305">nil</span>&nbsp;<span class="op" id="8078309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078313">t</span><span class="op" id="8078314">.</span><span class="ident" id="8078315">Fatal</span><span class="op" id="8078320">(</span><span class="string" id="8078321">&#34;decode:&nbsp;no&nbsp;error&#34;</span><span class="op" id="8078339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8078342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8078345">if</span>&nbsp;<span class="op" id="8078348">!</span><span class="ident" id="8078349">strings</span><span class="op" id="8078356">.</span><span class="ident" id="8078357">Contains</span><span class="op" id="8078365">(</span><span class="ident" id="8078366">err</span><span class="op" id="8078369">.</span><span class="ident" id="8078370">Error</span><span class="op" id="8078375">(</span><span class="op" id="8078376">)</span><span class="op" id="8078377">,</span>&nbsp;<span class="string" id="8078379">&#34;slice&nbsp;too&nbsp;big&#34;</span><span class="op" id="8078394">)</span>&nbsp;<span class="op" id="8078396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078400">t</span><span class="op" id="8078401">.</span><span class="ident" id="8078402">Fatal</span><span class="op" id="8078407">(</span><span class="string" id="8078408">&#34;decode:&nbsp;expected&nbsp;slice&nbsp;too&nbsp;big&nbsp;error,&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8078454">,</span>&nbsp;<span class="ident" id="8078456">err</span><span class="op" id="8078459">.</span><span class="ident" id="8078460">Error</span><span class="op" id="8078465">(</span><span class="op" id="8078466">)</span><span class="op" id="8078467">)</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8078470">}</span><br>
<span class="lineno"></span><span class="op" id="8078472">}</span>
</div>
</body>
</html>
