<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html" class="current">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3214587">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3214642">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3214696">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3214747">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3214812">//&nbsp;DNS&nbsp;client:&nbsp;see&nbsp;RFC&nbsp;1035.</span><br>
<span class="lineno"></span><span class="comment" id="3214841">//&nbsp;Has&nbsp;to&nbsp;be&nbsp;linked&nbsp;into&nbsp;package&nbsp;net&nbsp;for&nbsp;Dial.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="3214889">//&nbsp;TODO(rsc):</span><br>
<span class="lineno"></span><span class="comment" id="3214903">//&nbsp;&nbsp;&nbsp;&nbsp;Could&nbsp;potentially&nbsp;handle&nbsp;many&nbsp;outstanding&nbsp;lookups&nbsp;faster.</span><br>
<span class="lineno"></span><span class="comment" id="3214964">//&nbsp;&nbsp;&nbsp;&nbsp;Could&nbsp;have&nbsp;a&nbsp;small&nbsp;cache.</span><br>
<span class="lineno"></span><span class="comment" id="3214993">//&nbsp;&nbsp;&nbsp;&nbsp;Random&nbsp;UDP&nbsp;source&nbsp;port&nbsp;(net.Dial&nbsp;should&nbsp;do&nbsp;that&nbsp;for&nbsp;us).</span><br>
<span class="lineno"></span><span class="comment" id="3215053">//&nbsp;&nbsp;&nbsp;&nbsp;Random&nbsp;request&nbsp;IDs.</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3215077">package</span>&nbsp;<span class="ident" id="3215085">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3215090">import</span>&nbsp;<span class="op" id="3215097">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3215100">&#34;errors&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3215110">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3215116">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3215129">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3215135">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3215143">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="3215150">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3215153">//&nbsp;A&nbsp;dnsConn&nbsp;represents&nbsp;a&nbsp;DNS&nbsp;transport&nbsp;endpoint.</span><br>
<span class="lineno"></span><span class="keyword" id="3215203">type</span>&nbsp;<span class="ident" id="3215208">dnsConn</span>&nbsp;<span class="keyword" id="3215216">interface</span>&nbsp;<span class="op" id="3215226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3215229"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3215236">//&nbsp;readDNSResponse&nbsp;reads&nbsp;a&nbsp;DNS&nbsp;response&nbsp;message&nbsp;from&nbsp;the&nbsp;DNS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3215298">//&nbsp;transport&nbsp;endpoint&nbsp;and&nbsp;returns&nbsp;the&nbsp;received&nbsp;DNS&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3215359">//&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3215372">readDNSResponse</span><span class="op" id="3215387">(</span><span class="op" id="3215388">)</span>&nbsp;<span class="op" id="3215390">(</span><span class="op" id="3215391">*</span><span class="ident" id="3215392"><a href="/gostd/net/dnsmsg.go.html#3245872">dnsMsg</a></span><span class="op" id="3215398">,</span>&nbsp;<span class="builtintype" id="3215400">error</span><span class="op" id="3215405">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3215409">//&nbsp;writeDNSQuery&nbsp;writes&nbsp;a&nbsp;DNS&nbsp;query&nbsp;message&nbsp;to&nbsp;the&nbsp;DNS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3215465">//&nbsp;connection&nbsp;endpoint.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3215490">writeDNSQuery</span><span class="op" id="3215503">(</span><span class="op" id="3215504">*</span><span class="ident" id="3215505"><a href="/gostd/net/dnsmsg.go.html#3245872">dnsMsg</a></span><span class="op" id="3215511">)</span>&nbsp;<span class="builtintype" id="3215513">error</span><br>
<span class="lineno"></span><span class="op" id="3215519">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3215522">func</span>&nbsp;<span class="op" id="3215527">(</span><span class="ident" id="3215528">c</span>&nbsp;<span class="op" id="3215530">*</span><span class="ident" id="3215531"><a href="/gostd/net/udpsock_posix.go.html#3388176">UDPConn</a></span><span class="op" id="3215538">)</span>&nbsp;<span class="ident" id="3215540">readDNSResponse</span><span class="op" id="3215555">(</span><span class="op" id="3215556">)</span>&nbsp;<span class="op" id="3215558">(</span><span class="op" id="3215559">*</span><span class="ident" id="3215560"><a href="/gostd/net/dnsmsg.go.html#3245872">dnsMsg</a></span><span class="op" id="3215566">,</span>&nbsp;<span class="builtintype" id="3215568">error</span><span class="op" id="3215573">)</span>&nbsp;<span class="op" id="3215575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3215578">b</span>&nbsp;<span class="op" id="3215580">:=</span>&nbsp;<span class="builtinfunc" id="3215583">make</span><span class="op" id="3215587">(</span><span class="op" id="3215588">[</span><span class="op" id="3215589">]</span><span class="builtintype" id="3215590">byte</span><span class="op" id="3215594">,</span>&nbsp;<span class="num" id="3215596">512</span><span class="op" id="3215599">)</span>&nbsp;<span class="comment" id="3215601">//&nbsp;see&nbsp;RFC&nbsp;1035</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3215618">n</span><span class="op" id="3215619">,</span>&nbsp;<span class="ident" id="3215621">err</span>&nbsp;<span class="op" id="3215625">:=</span>&nbsp;<span class="ident" id="3215628"><a href="/gostd/net/dnsclient_unix.go.html#3215528">c</a></span><span class="op" id="3215629">.</span><span class="ident" id="3215630"><a href="/gostd/net/net.go.html#3336371">Read</a></span><span class="op" id="3215634">(</span><span class="ident" id="3215635"><a href="/gostd/net/dnsclient_unix.go.html#3215578">b</a></span><span class="op" id="3215636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3215639">if</span>&nbsp;<span class="ident" id="3215642"><a href="/gostd/net/dnsclient_unix.go.html#3215621">err</a></span>&nbsp;<span class="op" id="3215646">!=</span>&nbsp;<span class="builtintype" id="3215649">nil</span>&nbsp;<span class="op" id="3215653">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3215657">return</span>&nbsp;<span class="builtintype" id="3215664">nil</span><span class="op" id="3215667">,</span>&nbsp;<span class="ident" id="3215669"><a href="/gostd/net/dnsclient_unix.go.html#3215621">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3215674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3215677">msg</span>&nbsp;<span class="op" id="3215681">:=</span>&nbsp;<span class="op" id="3215684">&amp;</span><span class="ident" id="3215685"><a href="/gostd/net/dnsmsg.go.html#3245872">dnsMsg</a></span><span class="op" id="3215691">{</span><span class="op" id="3215692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3215695">if</span>&nbsp;<span class="op" id="3215698">!</span><span class="ident" id="3215699"><a href="/gostd/net/dnsclient_unix.go.html#3215677">msg</a></span><span class="op" id="3215702">.</span><span class="ident" id="3215703"><a href="/gostd/net/dnsmsg.go.html#3247295">Unpack</a></span><span class="op" id="3215709">(</span><span class="ident" id="3215710"><a href="/gostd/net/dnsclient_unix.go.html#3215578">b</a></span><span class="op" id="3215711">[</span><span class="op" id="3215712">:</span><span class="ident" id="3215713"><a href="/gostd/net/dnsclient_unix.go.html#3215618">n</a></span><span class="op" id="3215714">]</span><span class="op" id="3215715">)</span>&nbsp;<span class="op" id="3215717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3215721">return</span>&nbsp;<span class="builtintype" id="3215728">nil</span><span class="op" id="3215731">,</span>&nbsp;<span class="ident" id="3215733"><a href="/gostd/net/dnsclient_unix.go.html#3215100">errors</a></span><span class="op" id="3215739">.</span><span class="ident" id="3215740"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="3215743">(</span><span class="string" id="3215744">&#34;cannot&nbsp;unmarshal&nbsp;DNS&nbsp;message&#34;</span><span class="op" id="3215774">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3215777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3215780">return</span>&nbsp;<span class="ident" id="3215787"><a href="/gostd/net/dnsclient_unix.go.html#3215677">msg</a></span><span class="op" id="3215790">,</span>&nbsp;<span class="builtintype" id="3215792">nil</span><br>
<span class="lineno"></span><span class="op" id="3215796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3215799">func</span>&nbsp;<span class="op" id="3215804">(</span><span class="ident" id="3215805">c</span>&nbsp;<span class="op" id="3215807">*</span><span class="ident" id="3215808"><a href="/gostd/net/udpsock_posix.go.html#3388176">UDPConn</a></span><span class="op" id="3215815">)</span>&nbsp;<span class="ident" id="3215817">writeDNSQuery</span><span class="op" id="3215830">(</span><span class="ident" id="3215831">msg</span>&nbsp;<span class="op" id="3215835">*</span><span class="ident" id="3215836"><a href="/gostd/net/dnsmsg.go.html#3245872">dnsMsg</a></span><span class="op" id="3215842">)</span>&nbsp;<span class="builtintype" id="3215844">error</span>&nbsp;<span class="op" id="3215850">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3215853">b</span><span class="op" id="3215854">,</span>&nbsp;<span class="ident" id="3215856">ok</span>&nbsp;<span class="op" id="3215859">:=</span>&nbsp;<span class="ident" id="3215862"><a href="/gostd/net/dnsclient_unix.go.html#3215831">msg</a></span><span class="op" id="3215865">.</span><span class="ident" id="3215866"><a href="/gostd/net/dnsmsg.go.html#3245999">Pack</a></span><span class="op" id="3215870">(</span><span class="op" id="3215871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3215874">if</span>&nbsp;<span class="op" id="3215877">!</span><span class="ident" id="3215878"><a href="/gostd/net/dnsclient_unix.go.html#3215856">ok</a></span>&nbsp;<span class="op" id="3215881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3215885">return</span>&nbsp;<span class="ident" id="3215892"><a href="/gostd/net/dnsclient_unix.go.html#3215100">errors</a></span><span class="op" id="3215898">.</span><span class="ident" id="3215899"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="3215902">(</span><span class="string" id="3215903">&#34;cannot&nbsp;marshal&nbsp;DNS&nbsp;message&#34;</span><span class="op" id="3215931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3215934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3215937">if</span>&nbsp;<span class="ident" id="3215940">_</span><span class="op" id="3215941">,</span>&nbsp;<span class="ident" id="3215943">err</span>&nbsp;<span class="op" id="3215947">:=</span>&nbsp;<span class="ident" id="3215950"><a href="/gostd/net/dnsclient_unix.go.html#3215805">c</a></span><span class="op" id="3215951">.</span><span class="ident" id="3215952"><a href="/gostd/net/net.go.html#3336527">Write</a></span><span class="op" id="3215957">(</span><span class="ident" id="3215958"><a href="/gostd/net/dnsclient_unix.go.html#3215853">b</a></span><span class="op" id="3215959">)</span><span class="op" id="3215960">;</span>&nbsp;<span class="ident" id="3215962"><a href="/gostd/net/dnsclient_unix.go.html#3215943">err</a></span>&nbsp;<span class="op" id="3215966">!=</span>&nbsp;<span class="builtintype" id="3215969">nil</span>&nbsp;<span class="op" id="3215973">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3215977">return</span>&nbsp;<span class="ident" id="3215984"><a href="/gostd/net/dnsclient_unix.go.html#3215943">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3215989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3215992">return</span>&nbsp;<span class="builtintype" id="3215999">nil</span><br>
<span class="lineno"></span><span class="op" id="3216003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="3216006">func</span>&nbsp;<span class="op" id="3216011">(</span><span class="ident" id="3216012">c</span>&nbsp;<span class="op" id="3216014">*</span><span class="ident" id="3216015"><a href="/gostd/net/tcpsock_posix.go.html#3376101">TCPConn</a></span><span class="op" id="3216022">)</span>&nbsp;<span class="ident" id="3216024">readDNSResponse</span><span class="op" id="3216039">(</span><span class="op" id="3216040">)</span>&nbsp;<span class="op" id="3216042">(</span><span class="op" id="3216043">*</span><span class="ident" id="3216044"><a href="/gostd/net/dnsmsg.go.html#3245872">dnsMsg</a></span><span class="op" id="3216050">,</span>&nbsp;<span class="builtintype" id="3216052">error</span><span class="op" id="3216057">)</span>&nbsp;<span class="op" id="3216059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3216062">b</span>&nbsp;<span class="op" id="3216064">:=</span>&nbsp;<span class="builtinfunc" id="3216067">make</span><span class="op" id="3216071">(</span><span class="op" id="3216072">[</span><span class="op" id="3216073">]</span><span class="builtintype" id="3216074">byte</span><span class="op" id="3216078">,</span>&nbsp;<span class="num" id="3216080">1280</span><span class="op" id="3216084">)</span>&nbsp;<span class="comment" id="3216086">//&nbsp;1280&nbsp;is&nbsp;a&nbsp;reasonable&nbsp;initial&nbsp;size&nbsp;for&nbsp;IP&nbsp;over&nbsp;Ethernet,&nbsp;see&nbsp;RFC&nbsp;4035</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3216159">if</span>&nbsp;<span class="ident" id="3216162">_</span><span class="op" id="3216163">,</span>&nbsp;<span class="ident" id="3216165">err</span>&nbsp;<span class="op" id="3216169">:=</span>&nbsp;<span class="ident" id="3216172"><a href="/gostd/net/dnsclient_unix.go.html#3215110">io</a></span><span class="op" id="3216174">.</span><span class="ident" id="3216175"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="3216183">(</span><span class="ident" id="3216184"><a href="/gostd/net/dnsclient_unix.go.html#3216012">c</a></span><span class="op" id="3216185">,</span>&nbsp;<span class="ident" id="3216187"><a href="/gostd/net/dnsclient_unix.go.html#3216062">b</a></span><span class="op" id="3216188">[</span><span class="op" id="3216189">:</span><span class="num" id="3216190">2</span><span class="op" id="3216191">]</span><span class="op" id="3216192">)</span><span class="op" id="3216193">;</span>&nbsp;<span class="ident" id="3216195"><a href="/gostd/net/dnsclient_unix.go.html#3216165">err</a></span>&nbsp;<span class="op" id="3216199">!=</span>&nbsp;<span class="builtintype" id="3216202">nil</span>&nbsp;<span class="op" id="3216206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3216210">return</span>&nbsp;<span class="builtintype" id="3216217">nil</span><span class="op" id="3216220">,</span>&nbsp;<span class="ident" id="3216222"><a href="/gostd/net/dnsclient_unix.go.html#3216165">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3216227">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3216230">l</span>&nbsp;<span class="op" id="3216232">:=</span>&nbsp;<span class="builtintype" id="3216235">int</span><span class="op" id="3216238">(</span><span class="ident" id="3216239"><a href="/gostd/net/dnsclient_unix.go.html#3216062">b</a></span><span class="op" id="3216240">[</span><span class="num" id="3216241">0</span><span class="op" id="3216242">]</span><span class="op" id="3216243">)</span><span class="op" id="3216244">&lt;&lt;</span><span class="num" id="3216246">8</span>&nbsp;<span class="op" id="3216248">|</span>&nbsp;<span class="builtintype" id="3216250">int</span><span class="op" id="3216253">(</span><span class="ident" id="3216254"><a href="/gostd/net/dnsclient_unix.go.html#3216062">b</a></span><span class="op" id="3216255">[</span><span class="num" id="3216256">1</span><span class="op" id="3216257">]</span><span class="op" id="3216258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3216261">if</span>&nbsp;<span class="ident" id="3216264"><a href="/gostd/net/dnsclient_unix.go.html#3216230">l</a></span>&nbsp;<span class="op" id="3216266">&gt;</span>&nbsp;<span class="builtinfunc" id="3216268">len</span><span class="op" id="3216271">(</span><span class="ident" id="3216272"><a href="/gostd/net/dnsclient_unix.go.html#3216062">b</a></span><span class="op" id="3216273">)</span>&nbsp;<span class="op" id="3216275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3216279"><a href="/gostd/net/dnsclient_unix.go.html#3216062">b</a></span>&nbsp;<span class="op" id="3216281">=</span>&nbsp;<span class="builtinfunc" id="3216283">make</span><span class="op" id="3216287">(</span><span class="op" id="3216288">[</span><span class="op" id="3216289">]</span><span class="builtintype" id="3216290">byte</span><span class="op" id="3216294">,</span>&nbsp;<span class="ident" id="3216296"><a href="/gostd/net/dnsclient_unix.go.html#3216230">l</a></span><span class="op" id="3216297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3216300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3216303">n</span><span class="op" id="3216304">,</span>&nbsp;<span class="ident" id="3216306">err</span>&nbsp;<span class="op" id="3216310">:=</span>&nbsp;<span class="ident" id="3216313"><a href="/gostd/net/dnsclient_unix.go.html#3215110">io</a></span><span class="op" id="3216315">.</span><span class="ident" id="3216316"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="3216324">(</span><span class="ident" id="3216325"><a href="/gostd/net/dnsclient_unix.go.html#3216012">c</a></span><span class="op" id="3216326">,</span>&nbsp;<span class="ident" id="3216328"><a href="/gostd/net/dnsclient_unix.go.html#3216062">b</a></span><span class="op" id="3216329">[</span><span class="op" id="3216330">:</span><span class="ident" id="3216331"><a href="/gostd/net/dnsclient_unix.go.html#3216230">l</a></span><span class="op" id="3216332">]</span><span class="op" id="3216333">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3216336">if</span>&nbsp;<span class="ident" id="3216339"><a href="/gostd/net/dnsclient_unix.go.html#3216306">err</a></span>&nbsp;<span class="op" id="3216343">!=</span>&nbsp;<span class="builtintype" id="3216346">nil</span>&nbsp;<span class="op" id="3216350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3216354">return</span>&nbsp;<span class="builtintype" id="3216361">nil</span><span class="op" id="3216364">,</span>&nbsp;<span class="ident" id="3216366"><a href="/gostd/net/dnsclient_unix.go.html#3216306">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3216371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3216374">msg</span>&nbsp;<span class="op" id="3216378">:=</span>&nbsp;<span class="op" id="3216381">&amp;</span><span class="ident" id="3216382"><a href="/gostd/net/dnsmsg.go.html#3245872">dnsMsg</a></span><span class="op" id="3216388">{</span><span class="op" id="3216389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3216392">if</span>&nbsp;<span class="op" id="3216395">!</span><span class="ident" id="3216396"><a href="/gostd/net/dnsclient_unix.go.html#3216374">msg</a></span><span class="op" id="3216399">.</span><span class="ident" id="3216400"><a href="/gostd/net/dnsmsg.go.html#3247295">Unpack</a></span><span class="op" id="3216406">(</span><span class="ident" id="3216407"><a href="/gostd/net/dnsclient_unix.go.html#3216062">b</a></span><span class="op" id="3216408">[</span><span class="op" id="3216409">:</span><span class="ident" id="3216410"><a href="/gostd/net/dnsclient_unix.go.html#3216303">n</a></span><span class="op" id="3216411">]</span><span class="op" id="3216412">)</span>&nbsp;<span class="op" id="3216414">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3216418">return</span>&nbsp;<span class="builtintype" id="3216425">nil</span><span class="op" id="3216428">,</span>&nbsp;<span class="ident" id="3216430"><a href="/gostd/net/dnsclient_unix.go.html#3215100">errors</a></span><span class="op" id="3216436">.</span><span class="ident" id="3216437"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="3216440">(</span><span class="string" id="3216441">&#34;cannot&nbsp;unmarshal&nbsp;DNS&nbsp;message&#34;</span><span class="op" id="3216471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3216474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3216477">return</span>&nbsp;<span class="ident" id="3216484"><a href="/gostd/net/dnsclient_unix.go.html#3216374">msg</a></span><span class="op" id="3216487">,</span>&nbsp;<span class="builtintype" id="3216489">nil</span><br>
<span class="lineno"></span><span class="op" id="3216493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="3216496">func</span>&nbsp;<span class="op" id="3216501">(</span><span class="ident" id="3216502">c</span>&nbsp;<span class="op" id="3216504">*</span><span class="ident" id="3216505"><a href="/gostd/net/tcpsock_posix.go.html#3376101">TCPConn</a></span><span class="op" id="3216512">)</span>&nbsp;<span class="ident" id="3216514">writeDNSQuery</span><span class="op" id="3216527">(</span><span class="ident" id="3216528">msg</span>&nbsp;<span class="op" id="3216532">*</span><span class="ident" id="3216533"><a href="/gostd/net/dnsmsg.go.html#3245872">dnsMsg</a></span><span class="op" id="3216539">)</span>&nbsp;<span class="builtintype" id="3216541">error</span>&nbsp;<span class="op" id="3216547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3216550">b</span><span class="op" id="3216551">,</span>&nbsp;<span class="ident" id="3216553">ok</span>&nbsp;<span class="op" id="3216556">:=</span>&nbsp;<span class="ident" id="3216559"><a href="/gostd/net/dnsclient_unix.go.html#3216528">msg</a></span><span class="op" id="3216562">.</span><span class="ident" id="3216563"><a href="/gostd/net/dnsmsg.go.html#3245999">Pack</a></span><span class="op" id="3216567">(</span><span class="op" id="3216568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3216571">if</span>&nbsp;<span class="op" id="3216574">!</span><span class="ident" id="3216575"><a href="/gostd/net/dnsclient_unix.go.html#3216553">ok</a></span>&nbsp;<span class="op" id="3216578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3216582">return</span>&nbsp;<span class="ident" id="3216589"><a href="/gostd/net/dnsclient_unix.go.html#3215100">errors</a></span><span class="op" id="3216595">.</span><span class="ident" id="3216596"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="3216599">(</span><span class="string" id="3216600">&#34;cannot&nbsp;marshal&nbsp;DNS&nbsp;message&#34;</span><span class="op" id="3216628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3216631">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3216634">l</span>&nbsp;<span class="op" id="3216636">:=</span>&nbsp;<span class="builtintype" id="3216639">uint16</span><span class="op" id="3216645">(</span><span class="builtinfunc" id="3216646">len</span><span class="op" id="3216649">(</span><span class="ident" id="3216650"><a href="/gostd/net/dnsclient_unix.go.html#3216550">b</a></span><span class="op" id="3216651">)</span><span class="op" id="3216652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3216655"><a href="/gostd/net/dnsclient_unix.go.html#3216550">b</a></span>&nbsp;<span class="op" id="3216657">=</span>&nbsp;<span class="builtinfunc" id="3216659">append</span><span class="op" id="3216665">(</span><span class="op" id="3216666">[</span><span class="op" id="3216667">]</span><span class="builtintype" id="3216668">byte</span><span class="op" id="3216672">{</span><span class="builtintype" id="3216673">byte</span><span class="op" id="3216677">(</span><span class="ident" id="3216678"><a href="/gostd/net/dnsclient_unix.go.html#3216634">l</a></span>&nbsp;<span class="op" id="3216680">&gt;&gt;</span>&nbsp;<span class="num" id="3216683">8</span><span class="op" id="3216684">)</span><span class="op" id="3216685">,</span>&nbsp;<span class="builtintype" id="3216687">byte</span><span class="op" id="3216691">(</span><span class="ident" id="3216692"><a href="/gostd/net/dnsclient_unix.go.html#3216634">l</a></span><span class="op" id="3216693">)</span><span class="op" id="3216694">}</span><span class="op" id="3216695">,</span>&nbsp;<span class="ident" id="3216697"><a href="/gostd/net/dnsclient_unix.go.html#3216550">b</a></span><span class="op" id="3216698">...</span><span class="op" id="3216701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3216704">if</span>&nbsp;<span class="ident" id="3216707">_</span><span class="op" id="3216708">,</span>&nbsp;<span class="ident" id="3216710">err</span>&nbsp;<span class="op" id="3216714">:=</span>&nbsp;<span class="ident" id="3216717"><a href="/gostd/net/dnsclient_unix.go.html#3216502">c</a></span><span class="op" id="3216718">.</span><span class="ident" id="3216719"><a href="/gostd/net/net.go.html#3336527">Write</a></span><span class="op" id="3216724">(</span><span class="ident" id="3216725"><a href="/gostd/net/dnsclient_unix.go.html#3216550">b</a></span><span class="op" id="3216726">)</span><span class="op" id="3216727">;</span>&nbsp;<span class="ident" id="3216729"><a href="/gostd/net/dnsclient_unix.go.html#3216710">err</a></span>&nbsp;<span class="op" id="3216733">!=</span>&nbsp;<span class="builtintype" id="3216736">nil</span>&nbsp;<span class="op" id="3216740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3216744">return</span>&nbsp;<span class="ident" id="3216751"><a href="/gostd/net/dnsclient_unix.go.html#3216710">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3216756">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3216759">return</span>&nbsp;<span class="builtintype" id="3216766">nil</span><br>
<span class="lineno"></span><span class="op" id="3216770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3216773">func</span>&nbsp;<span class="op" id="3216778">(</span><span class="ident" id="3216779">d</span>&nbsp;<span class="op" id="3216781">*</span><span class="ident" id="3216782"><a href="/gostd/net/dial.go.html#3199756">Dialer</a></span><span class="op" id="3216788">)</span>&nbsp;<span class="ident" id="3216790">dialDNS</span><span class="op" id="3216797">(</span><span class="ident" id="3216798">network</span><span class="op" id="3216805">,</span>&nbsp;<span class="ident" id="3216807">server</span>&nbsp;<span class="builtintype" id="3216814">string</span><span class="op" id="3216820">)</span>&nbsp;<span class="op" id="3216822">(</span><span class="ident" id="3216823"><a href="/gostd/net/dnsclient_unix.go.html#3215208">dnsConn</a></span><span class="op" id="3216830">,</span>&nbsp;<span class="builtintype" id="3216832">error</span><span class="op" id="3216837">)</span>&nbsp;<span class="op" id="3216839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3216842">switch</span>&nbsp;<span class="ident" id="3216849"><a href="/gostd/net/dnsclient_unix.go.html#3216798">network</a></span>&nbsp;<span class="op" id="3216857">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3216860">case</span>&nbsp;<span class="string" id="3216865">&#34;tcp&#34;</span><span class="op" id="3216870">,</span>&nbsp;<span class="string" id="3216872">&#34;tcp4&#34;</span><span class="op" id="3216878">,</span>&nbsp;<span class="string" id="3216880">&#34;tcp6&#34;</span><span class="op" id="3216886">,</span>&nbsp;<span class="string" id="3216888">&#34;udp&#34;</span><span class="op" id="3216893">,</span>&nbsp;<span class="string" id="3216895">&#34;udp4&#34;</span><span class="op" id="3216901">,</span>&nbsp;<span class="string" id="3216903">&#34;udp6&#34;</span><span class="op" id="3216909">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3216912">default</span><span class="op" id="3216919">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3216923">return</span>&nbsp;<span class="builtintype" id="3216930">nil</span><span class="op" id="3216933">,</span>&nbsp;<span class="ident" id="3216935"><a href="/gostd/net/net.go.html#3342949">UnknownNetworkError</a></span><span class="op" id="3216954">(</span><span class="ident" id="3216955"><a href="/gostd/net/dnsclient_unix.go.html#3216798">network</a></span><span class="op" id="3216962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3216965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3216968">//&nbsp;Calling&nbsp;Dial&nbsp;here&nbsp;is&nbsp;scary&nbsp;--&nbsp;we&nbsp;have&nbsp;to&nbsp;be&nbsp;sure&nbsp;not&nbsp;to</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3217028">//&nbsp;dial&nbsp;a&nbsp;name&nbsp;that&nbsp;will&nbsp;require&nbsp;a&nbsp;DNS&nbsp;lookup,&nbsp;or&nbsp;Dial&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3217089">//&nbsp;call&nbsp;back&nbsp;here&nbsp;to&nbsp;translate&nbsp;it.&nbsp;The&nbsp;DNS&nbsp;config&nbsp;parser&nbsp;has</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3217151">//&nbsp;already&nbsp;checked&nbsp;that&nbsp;all&nbsp;the&nbsp;cfg.servers[i]&nbsp;are&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3217206">//&nbsp;addresses,&nbsp;which&nbsp;Dial&nbsp;will&nbsp;use&nbsp;without&nbsp;a&nbsp;DNS&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3217263">c</span><span class="op" id="3217264">,</span>&nbsp;<span class="ident" id="3217266">err</span>&nbsp;<span class="op" id="3217270">:=</span>&nbsp;<span class="ident" id="3217273"><a href="/gostd/net/dnsclient_unix.go.html#3216779">d</a></span><span class="op" id="3217274">.</span><span class="ident" id="3217275"><a href="/gostd/net/dial.go.html#3203959">Dial</a></span><span class="op" id="3217279">(</span><span class="ident" id="3217280"><a href="/gostd/net/dnsclient_unix.go.html#3216798">network</a></span><span class="op" id="3217287">,</span>&nbsp;<span class="ident" id="3217289"><a href="/gostd/net/dnsclient_unix.go.html#3216807">server</a></span><span class="op" id="3217295">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3217298">if</span>&nbsp;<span class="ident" id="3217301"><a href="/gostd/net/dnsclient_unix.go.html#3217266">err</a></span>&nbsp;<span class="op" id="3217305">!=</span>&nbsp;<span class="builtintype" id="3217308">nil</span>&nbsp;<span class="op" id="3217312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3217316">return</span>&nbsp;<span class="builtintype" id="3217323">nil</span><span class="op" id="3217326">,</span>&nbsp;<span class="ident" id="3217328"><a href="/gostd/net/dnsclient_unix.go.html#3217266">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3217333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3217336">switch</span>&nbsp;<span class="ident" id="3217343"><a href="/gostd/net/dnsclient_unix.go.html#3216798">network</a></span>&nbsp;<span class="op" id="3217351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3217354">case</span>&nbsp;<span class="string" id="3217359">&#34;tcp&#34;</span><span class="op" id="3217364">,</span>&nbsp;<span class="string" id="3217366">&#34;tcp4&#34;</span><span class="op" id="3217372">,</span>&nbsp;<span class="string" id="3217374">&#34;tcp6&#34;</span><span class="op" id="3217380">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3217384">return</span>&nbsp;<span class="ident" id="3217391"><a href="/gostd/net/dnsclient_unix.go.html#3217263">c</a></span><span class="op" id="3217392">.</span><span class="op" id="3217393">(</span><span class="op" id="3217394">*</span><span class="ident" id="3217395"><a href="/gostd/net/tcpsock_posix.go.html#3376101">TCPConn</a></span><span class="op" id="3217402">)</span><span class="op" id="3217403">,</span>&nbsp;<span class="builtintype" id="3217405">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3217410">case</span>&nbsp;<span class="string" id="3217415">&#34;udp&#34;</span><span class="op" id="3217420">,</span>&nbsp;<span class="string" id="3217422">&#34;udp4&#34;</span><span class="op" id="3217428">,</span>&nbsp;<span class="string" id="3217430">&#34;udp6&#34;</span><span class="op" id="3217436">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3217440">return</span>&nbsp;<span class="ident" id="3217447"><a href="/gostd/net/dnsclient_unix.go.html#3217263">c</a></span><span class="op" id="3217448">.</span><span class="op" id="3217449">(</span><span class="op" id="3217450">*</span><span class="ident" id="3217451"><a href="/gostd/net/udpsock_posix.go.html#3388176">UDPConn</a></span><span class="op" id="3217458">)</span><span class="op" id="3217459">,</span>&nbsp;<span class="builtintype" id="3217461">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3217466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3217469">panic</span><span class="op" id="3217474">(</span><span class="string" id="3217475">&#34;unreachable&#34;</span><span class="op" id="3217488">)</span><br>
<span class="lineno">120</span><span class="op" id="3217490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3217493">//&nbsp;exchange&nbsp;sends&nbsp;a&nbsp;query&nbsp;on&nbsp;the&nbsp;connection&nbsp;and&nbsp;hopes&nbsp;for&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span><span class="keyword" id="3217563">func</span>&nbsp;<span class="ident" id="3217568">exchange</span><span class="op" id="3217576">(</span><span class="ident" id="3217577">server</span><span class="op" id="3217583">,</span>&nbsp;<span class="ident" id="3217585">name</span>&nbsp;<span class="builtintype" id="3217590">string</span><span class="op" id="3217596">,</span>&nbsp;<span class="ident" id="3217598">qtype</span>&nbsp;<span class="builtintype" id="3217604">uint16</span><span class="op" id="3217610">,</span>&nbsp;<span class="ident" id="3217612">timeout</span>&nbsp;<span class="ident" id="3217620"><a href="/gostd/net/dnsclient_unix.go.html#3215143">time</a></span><span class="op" id="3217624">.</span><span class="ident" id="3217625"><a href="/gostd/time/time.go.html#2734212">Duration</a></span><span class="op" id="3217633">)</span>&nbsp;<span class="op" id="3217635">(</span><span class="op" id="3217636">*</span><span class="ident" id="3217637"><a href="/gostd/net/dnsmsg.go.html#3245872">dnsMsg</a></span><span class="op" id="3217643">,</span>&nbsp;<span class="builtintype" id="3217645">error</span><span class="op" id="3217650">)</span>&nbsp;<span class="op" id="3217652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3217655">d</span>&nbsp;<span class="op" id="3217657">:=</span>&nbsp;<span class="ident" id="3217660"><a href="/gostd/net/dial.go.html#3199756">Dialer</a></span><span class="op" id="3217666">{</span><span class="ident" id="3217667"><a href="/gostd/net/dial.go.html#3200103">Timeout</a></span><span class="op" id="3217674">:</span>&nbsp;<span class="ident" id="3217676"><a href="/gostd/net/dnsclient_unix.go.html#3217612">timeout</a></span><span class="op" id="3217683">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3217686">out</span>&nbsp;<span class="op" id="3217690">:=</span>&nbsp;<span class="ident" id="3217693"><a href="/gostd/net/dnsmsg.go.html#3245872">dnsMsg</a></span><span class="op" id="3217699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3217703"><a href="/gostd/net/dnsmsg.go.html#3245889">dnsMsgHdr</a></span><span class="op" id="3217712">:</span>&nbsp;<span class="ident" id="3217714"><a href="/gostd/net/dnsmsg.go.html#3245235">dnsMsgHdr</a></span><span class="op" id="3217723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3217728"><a href="/gostd/net/dnsmsg.go.html#3245386">recursion_desired</a></span><span class="op" id="3217745">:</span>&nbsp;<span class="builtintype" id="3217747">true</span><span class="op" id="3217751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3217755">}</span><span class="op" id="3217756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3217760"><a href="/gostd/net/dnsmsg.go.html#3245900">question</a></span><span class="op" id="3217768">:</span>&nbsp;<span class="op" id="3217770">[</span><span class="op" id="3217771">]</span><span class="ident" id="3217772"><a href="/gostd/net/dnsmsg.go.html#3230862">dnsQuestion</a></span><span class="op" id="3217783">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3217788">{</span><span class="ident" id="3217789"><a href="/gostd/net/dnsclient_unix.go.html#3217585">name</a></span><span class="op" id="3217793">,</span>&nbsp;<span class="ident" id="3217795"><a href="/gostd/net/dnsclient_unix.go.html#3217598">qtype</a></span><span class="op" id="3217800">,</span>&nbsp;<span class="ident" id="3217802"><a href="/gostd/net/dnsmsg.go.html#3229263">dnsClassINET</a></span><span class="op" id="3217814">}</span><span class="op" id="3217815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3217819">}</span><span class="op" id="3217820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3217823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3217826">for</span>&nbsp;<span class="ident" id="3217830">_</span><span class="op" id="3217831">,</span>&nbsp;<span class="ident" id="3217833">network</span>&nbsp;<span class="op" id="3217841">:=</span>&nbsp;<span class="keyword" id="3217844">range</span>&nbsp;<span class="op" id="3217850">[</span><span class="op" id="3217851">]</span><span class="builtintype" id="3217852">string</span><span class="op" id="3217858">{</span><span class="string" id="3217859">&#34;udp&#34;</span><span class="op" id="3217864">,</span>&nbsp;<span class="string" id="3217866">&#34;tcp&#34;</span><span class="op" id="3217871">}</span>&nbsp;<span class="op" id="3217873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3217877">c</span><span class="op" id="3217878">,</span>&nbsp;<span class="ident" id="3217880">err</span>&nbsp;<span class="op" id="3217884">:=</span>&nbsp;<span class="ident" id="3217887"><a href="/gostd/net/dnsclient_unix.go.html#3217655">d</a></span><span class="op" id="3217888">.</span><span class="ident" id="3217889"><a href="/gostd/net/dnsclient_unix.go.html#3216790">dialDNS</a></span><span class="op" id="3217896">(</span><span class="ident" id="3217897"><a href="/gostd/net/dnsclient_unix.go.html#3217833">network</a></span><span class="op" id="3217904">,</span>&nbsp;<span class="ident" id="3217906"><a href="/gostd/net/dnsclient_unix.go.html#3217577">server</a></span><span class="op" id="3217912">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3217916">if</span>&nbsp;<span class="ident" id="3217919"><a href="/gostd/net/dnsclient_unix.go.html#3217880">err</a></span>&nbsp;<span class="op" id="3217923">!=</span>&nbsp;<span class="builtintype" id="3217926">nil</span>&nbsp;<span class="op" id="3217930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3217935">return</span>&nbsp;<span class="builtintype" id="3217942">nil</span><span class="op" id="3217945">,</span>&nbsp;<span class="ident" id="3217947"><a href="/gostd/net/dnsclient_unix.go.html#3217880">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3217953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3217957">defer</span>&nbsp;<span class="ident" id="3217963"><a href="/gostd/net/dnsclient_unix.go.html#3217877">c</a></span><span class="op" id="3217964">.</span><span class="ident" id="3217965"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="3217970">(</span><span class="op" id="3217971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3217975">if</span>&nbsp;<span class="ident" id="3217978"><a href="/gostd/net/dnsclient_unix.go.html#3217612">timeout</a></span>&nbsp;<span class="op" id="3217986">&gt;</span>&nbsp;<span class="num" id="3217988">0</span>&nbsp;<span class="op" id="3217990">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3217995"><a href="/gostd/net/dnsclient_unix.go.html#3217877">c</a></span><span class="op" id="3217996">.</span><span class="ident" id="3217997"><a href="/gostd/net/net.go.html#3335726">SetDeadline</a></span><span class="op" id="3218008">(</span><span class="ident" id="3218009"><a href="/gostd/net/dnsclient_unix.go.html#3215143">time</a></span><span class="op" id="3218013">.</span><span class="ident" id="3218014"><a href="/gostd/time/time.go.html#2743088">Now</a></span><span class="op" id="3218017">(</span><span class="op" id="3218018">)</span><span class="op" id="3218019">.</span><span class="ident" id="3218020"><a href="/gostd/time/time.go.html#2738615">Add</a></span><span class="op" id="3218023">(</span><span class="ident" id="3218024"><a href="/gostd/net/dnsclient_unix.go.html#3217612">timeout</a></span><span class="op" id="3218031">)</span><span class="op" id="3218032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3218036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3218040"><a href="/gostd/net/dnsclient_unix.go.html#3217686">out</a></span><span class="op" id="3218043">.</span><span class="ident" id="3218044"><a href="/gostd/net/dnsmsg.go.html#3245255">id</a></span>&nbsp;<span class="op" id="3218047">=</span>&nbsp;<span class="builtintype" id="3218049">uint16</span><span class="op" id="3218055">(</span><span class="ident" id="3218056"><a href="/gostd/net/dnsclient_unix.go.html#3215116">rand</a></span><span class="op" id="3218060">.</span><span class="ident" id="3218061"><a href="/gostd/math/rand/rand.go.html#2926699">Int</a></span><span class="op" id="3218064">(</span><span class="op" id="3218065">)</span><span class="op" id="3218066">)</span>&nbsp;<span class="op" id="3218068">^</span>&nbsp;<span class="builtintype" id="3218070">uint16</span><span class="op" id="3218076">(</span><span class="ident" id="3218077"><a href="/gostd/net/dnsclient_unix.go.html#3215143">time</a></span><span class="op" id="3218081">.</span><span class="ident" id="3218082"><a href="/gostd/time/time.go.html#2743088">Now</a></span><span class="op" id="3218085">(</span><span class="op" id="3218086">)</span><span class="op" id="3218087">.</span><span class="ident" id="3218088"><a href="/gostd/time/time.go.html#2744495">UnixNano</a></span><span class="op" id="3218096">(</span><span class="op" id="3218097">)</span><span class="op" id="3218098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3218102">if</span>&nbsp;<span class="ident" id="3218105">err</span>&nbsp;<span class="op" id="3218109">:=</span>&nbsp;<span class="ident" id="3218112"><a href="/gostd/net/dnsclient_unix.go.html#3217877">c</a></span><span class="op" id="3218113">.</span><span class="ident" id="3218114"><a href="/gostd/net/dnsclient_unix.go.html#3215490">writeDNSQuery</a></span><span class="op" id="3218127">(</span><span class="op" id="3218128">&amp;</span><span class="ident" id="3218129"><a href="/gostd/net/dnsclient_unix.go.html#3217686">out</a></span><span class="op" id="3218132">)</span><span class="op" id="3218133">;</span>&nbsp;<span class="ident" id="3218135"><a href="/gostd/net/dnsclient_unix.go.html#3218105">err</a></span>&nbsp;<span class="op" id="3218139">!=</span>&nbsp;<span class="builtintype" id="3218142">nil</span>&nbsp;<span class="op" id="3218146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3218151">return</span>&nbsp;<span class="builtintype" id="3218158">nil</span><span class="op" id="3218161">,</span>&nbsp;<span class="ident" id="3218163"><a href="/gostd/net/dnsclient_unix.go.html#3218105">err</a></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3218169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3218173">in</span><span class="op" id="3218175">,</span>&nbsp;<span class="ident" id="3218177"><a href="/gostd/net/dnsclient_unix.go.html#3217880">err</a></span>&nbsp;<span class="op" id="3218181">:=</span>&nbsp;<span class="ident" id="3218184"><a href="/gostd/net/dnsclient_unix.go.html#3217877">c</a></span><span class="op" id="3218185">.</span><span class="ident" id="3218186"><a href="/gostd/net/dnsclient_unix.go.html#3215372">readDNSResponse</a></span><span class="op" id="3218201">(</span><span class="op" id="3218202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3218206">if</span>&nbsp;<span class="ident" id="3218209"><a href="/gostd/net/dnsclient_unix.go.html#3217880">err</a></span>&nbsp;<span class="op" id="3218213">!=</span>&nbsp;<span class="builtintype" id="3218216">nil</span>&nbsp;<span class="op" id="3218220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3218225">return</span>&nbsp;<span class="builtintype" id="3218232">nil</span><span class="op" id="3218235">,</span>&nbsp;<span class="ident" id="3218237"><a href="/gostd/net/dnsclient_unix.go.html#3217880">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3218243">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3218247">if</span>&nbsp;<span class="ident" id="3218250"><a href="/gostd/net/dnsclient_unix.go.html#3218173">in</a></span><span class="op" id="3218252">.</span><span class="ident" id="3218253"><a href="/gostd/net/dnsmsg.go.html#3245255">id</a></span>&nbsp;<span class="op" id="3218256">!=</span>&nbsp;<span class="ident" id="3218259"><a href="/gostd/net/dnsclient_unix.go.html#3217686">out</a></span><span class="op" id="3218262">.</span><span class="ident" id="3218263"><a href="/gostd/net/dnsmsg.go.html#3245255">id</a></span>&nbsp;<span class="op" id="3218266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3218271">return</span>&nbsp;<span class="builtintype" id="3218278">nil</span><span class="op" id="3218281">,</span>&nbsp;<span class="ident" id="3218283"><a href="/gostd/net/dnsclient_unix.go.html#3215100">errors</a></span><span class="op" id="3218289">.</span><span class="ident" id="3218290"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="3218293">(</span><span class="string" id="3218294">&#34;DNS&nbsp;message&nbsp;ID&nbsp;mismatch&#34;</span><span class="op" id="3218319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3218323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3218327">if</span>&nbsp;<span class="ident" id="3218330"><a href="/gostd/net/dnsclient_unix.go.html#3218173">in</a></span><span class="op" id="3218332">.</span><span class="ident" id="3218333"><a href="/gostd/net/dnsmsg.go.html#3245360">truncated</a></span>&nbsp;<span class="op" id="3218343">{</span>&nbsp;<span class="comment" id="3218345">//&nbsp;see&nbsp;RFC&nbsp;5966</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3218364">continue</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3218375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3218379">return</span>&nbsp;<span class="ident" id="3218386"><a href="/gostd/net/dnsclient_unix.go.html#3218173">in</a></span><span class="op" id="3218388">,</span>&nbsp;<span class="builtintype" id="3218390">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3218395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3218398">return</span>&nbsp;<span class="builtintype" id="3218405">nil</span><span class="op" id="3218408">,</span>&nbsp;<span class="ident" id="3218410"><a href="/gostd/net/dnsclient_unix.go.html#3215100">errors</a></span><span class="op" id="3218416">.</span><span class="ident" id="3218417"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="3218420">(</span><span class="string" id="3218421">&#34;no&nbsp;answer&nbsp;from&nbsp;DNS&nbsp;server&#34;</span><span class="op" id="3218448">)</span><br>
<span class="lineno"></span><span class="op" id="3218450">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="3218453">//&nbsp;Do&nbsp;a&nbsp;lookup&nbsp;for&nbsp;a&nbsp;single&nbsp;name,&nbsp;which&nbsp;must&nbsp;be&nbsp;rooted</span><br>
<span class="lineno"></span><span class="comment" id="3218508">//&nbsp;(otherwise&nbsp;answer&nbsp;will&nbsp;not&nbsp;find&nbsp;the&nbsp;answers).</span><br>
<span class="lineno"></span><span class="keyword" id="3218557">func</span>&nbsp;<span class="ident" id="3218562">tryOneName</span><span class="op" id="3218572">(</span><span class="ident" id="3218573">cfg</span>&nbsp;<span class="op" id="3218577">*</span><span class="ident" id="3218578"><a href="/gostd/net/dnsconfig_unix.go.html#3225531">dnsConfig</a></span><span class="op" id="3218587">,</span>&nbsp;<span class="ident" id="3218589">name</span>&nbsp;<span class="builtintype" id="3218594">string</span><span class="op" id="3218600">,</span>&nbsp;<span class="ident" id="3218602">qtype</span>&nbsp;<span class="builtintype" id="3218608">uint16</span><span class="op" id="3218614">)</span>&nbsp;<span class="op" id="3218616">(</span><span class="builtintype" id="3218617">string</span><span class="op" id="3218623">,</span>&nbsp;<span class="op" id="3218625">[</span><span class="op" id="3218626">]</span><span class="ident" id="3218627"><a href="/gostd/net/dnsmsg.go.html#3231784">dnsRR</a></span><span class="op" id="3218632">,</span>&nbsp;<span class="builtintype" id="3218634">error</span><span class="op" id="3218639">)</span>&nbsp;<span class="op" id="3218641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3218644">if</span>&nbsp;<span class="builtinfunc" id="3218647">len</span><span class="op" id="3218650">(</span><span class="ident" id="3218651"><a href="/gostd/net/dnsclient_unix.go.html#3218573">cfg</a></span><span class="op" id="3218654">.</span><span class="ident" id="3218655"><a href="/gostd/net/dnsconfig_unix.go.html#3225551">servers</a></span><span class="op" id="3218662">)</span>&nbsp;<span class="op" id="3218664">==</span>&nbsp;<span class="num" id="3218667">0</span>&nbsp;<span class="op" id="3218669">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3218673">return</span>&nbsp;<span class="string" id="3218680">&#34;&#34;</span><span class="op" id="3218682">,</span>&nbsp;<span class="builtintype" id="3218684">nil</span><span class="op" id="3218687">,</span>&nbsp;<span class="op" id="3218689">&amp;</span><span class="ident" id="3218690"><a href="/gostd/net/dnsclient.go.html#3208795">DNSError</a></span><span class="op" id="3218698">{</span><span class="ident" id="3218699"><a href="/gostd/net/dnsclient.go.html#3208814">Err</a></span><span class="op" id="3218702">:</span>&nbsp;<span class="string" id="3218704">&#34;no&nbsp;DNS&nbsp;servers&#34;</span><span class="op" id="3218720">,</span>&nbsp;<span class="ident" id="3218722"><a href="/gostd/net/dnsclient.go.html#3208860">Name</a></span><span class="op" id="3218726">:</span>&nbsp;<span class="ident" id="3218728"><a href="/gostd/net/dnsclient_unix.go.html#3218589">name</a></span><span class="op" id="3218732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3218735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3218738">if</span>&nbsp;<span class="builtinfunc" id="3218741">len</span><span class="op" id="3218744">(</span><span class="ident" id="3218745"><a href="/gostd/net/dnsclient_unix.go.html#3218589">name</a></span><span class="op" id="3218749">)</span>&nbsp;<span class="op" id="3218751">&gt;=</span>&nbsp;<span class="num" id="3218754">256</span>&nbsp;<span class="op" id="3218758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3218762">return</span>&nbsp;<span class="string" id="3218769">&#34;&#34;</span><span class="op" id="3218771">,</span>&nbsp;<span class="builtintype" id="3218773">nil</span><span class="op" id="3218776">,</span>&nbsp;<span class="op" id="3218778">&amp;</span><span class="ident" id="3218779"><a href="/gostd/net/dnsclient.go.html#3208795">DNSError</a></span><span class="op" id="3218787">{</span><span class="ident" id="3218788"><a href="/gostd/net/dnsclient.go.html#3208814">Err</a></span><span class="op" id="3218791">:</span>&nbsp;<span class="string" id="3218793">&#34;DNS&nbsp;name&nbsp;too&nbsp;long&#34;</span><span class="op" id="3218812">,</span>&nbsp;<span class="ident" id="3218814"><a href="/gostd/net/dnsclient.go.html#3208860">Name</a></span><span class="op" id="3218818">:</span>&nbsp;<span class="ident" id="3218820"><a href="/gostd/net/dnsclient_unix.go.html#3218589">name</a></span><span class="op" id="3218824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3218827">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3218830">timeout</span>&nbsp;<span class="op" id="3218838">:=</span>&nbsp;<span class="ident" id="3218841"><a href="/gostd/net/dnsclient_unix.go.html#3215143">time</a></span><span class="op" id="3218845">.</span><span class="ident" id="3218846"><a href="/gostd/time/time.go.html#2734212">Duration</a></span><span class="op" id="3218854">(</span><span class="ident" id="3218855"><a href="/gostd/net/dnsclient_unix.go.html#3218573">cfg</a></span><span class="op" id="3218858">.</span><span class="ident" id="3218859"><a href="/gostd/net/dnsconfig_unix.go.html#3225715">timeout</a></span><span class="op" id="3218866">)</span>&nbsp;<span class="op" id="3218868">*</span>&nbsp;<span class="ident" id="3218870"><a href="/gostd/net/dnsclient_unix.go.html#3215143">time</a></span><span class="op" id="3218874">.</span><span class="ident" id="3218875"><a href="/gostd/time/time.go.html#2734862">Second</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3218883">var</span>&nbsp;<span class="ident" id="3218887">lastErr</span>&nbsp;<span class="builtintype" id="3218895">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3218902">for</span>&nbsp;<span class="ident" id="3218906">i</span>&nbsp;<span class="op" id="3218908">:=</span>&nbsp;<span class="num" id="3218911">0</span><span class="op" id="3218912">;</span>&nbsp;<span class="ident" id="3218914"><a href="/gostd/net/dnsclient_unix.go.html#3218906">i</a></span>&nbsp;<span class="op" id="3218916">&lt;</span>&nbsp;<span class="ident" id="3218918"><a href="/gostd/net/dnsclient_unix.go.html#3218573">cfg</a></span><span class="op" id="3218921">.</span><span class="ident" id="3218922"><a href="/gostd/net/dnsconfig_unix.go.html#3225772">attempts</a></span><span class="op" id="3218930">;</span>&nbsp;<span class="ident" id="3218932"><a href="/gostd/net/dnsclient_unix.go.html#3218906">i</a></span><span class="op" id="3218933">++</span>&nbsp;<span class="op" id="3218936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3218940">for</span>&nbsp;<span class="ident" id="3218944">_</span><span class="op" id="3218945">,</span>&nbsp;<span class="ident" id="3218947">server</span>&nbsp;<span class="op" id="3218954">:=</span>&nbsp;<span class="keyword" id="3218957">range</span>&nbsp;<span class="ident" id="3218963"><a href="/gostd/net/dnsclient_unix.go.html#3218573">cfg</a></span><span class="op" id="3218966">.</span><span class="ident" id="3218967"><a href="/gostd/net/dnsconfig_unix.go.html#3225551">servers</a></span>&nbsp;<span class="op" id="3218975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3218980"><a href="/gostd/net/dnsclient_unix.go.html#3218947">server</a></span>&nbsp;<span class="op" id="3218987">=</span>&nbsp;<span class="ident" id="3218989"><a href="/gostd/net/ipsock.go.html#3315078">JoinHostPort</a></span><span class="op" id="3219001">(</span><span class="ident" id="3219002"><a href="/gostd/net/dnsclient_unix.go.html#3218947">server</a></span><span class="op" id="3219008">,</span>&nbsp;<span class="string" id="3219010">&#34;53&#34;</span><span class="op" id="3219014">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219019">msg</span><span class="op" id="3219022">,</span>&nbsp;<span class="ident" id="3219024">err</span>&nbsp;<span class="op" id="3219028">:=</span>&nbsp;<span class="ident" id="3219031"><a href="/gostd/net/dnsclient_unix.go.html#3217568">exchange</a></span><span class="op" id="3219039">(</span><span class="ident" id="3219040"><a href="/gostd/net/dnsclient_unix.go.html#3218947">server</a></span><span class="op" id="3219046">,</span>&nbsp;<span class="ident" id="3219048"><a href="/gostd/net/dnsclient_unix.go.html#3218589">name</a></span><span class="op" id="3219052">,</span>&nbsp;<span class="ident" id="3219054"><a href="/gostd/net/dnsclient_unix.go.html#3218602">qtype</a></span><span class="op" id="3219059">,</span>&nbsp;<span class="ident" id="3219061"><a href="/gostd/net/dnsclient_unix.go.html#3218830">timeout</a></span><span class="op" id="3219068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3219073">if</span>&nbsp;<span class="ident" id="3219076"><a href="/gostd/net/dnsclient_unix.go.html#3219024">err</a></span>&nbsp;<span class="op" id="3219080">!=</span>&nbsp;<span class="builtintype" id="3219083">nil</span>&nbsp;<span class="op" id="3219087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219093"><a href="/gostd/net/dnsclient_unix.go.html#3218887">lastErr</a></span>&nbsp;<span class="op" id="3219101">=</span>&nbsp;<span class="op" id="3219103">&amp;</span><span class="ident" id="3219104"><a href="/gostd/net/dnsclient.go.html#3208795">DNSError</a></span><span class="op" id="3219112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219119"><a href="/gostd/net/dnsclient.go.html#3208814">Err</a></span><span class="op" id="3219122">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219127"><a href="/gostd/net/dnsclient_unix.go.html#3219024">err</a></span><span class="op" id="3219130">.</span><span class="ident" id="3219131">Error</span><span class="op" id="3219136">(</span><span class="op" id="3219137">)</span><span class="op" id="3219138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219145"><a href="/gostd/net/dnsclient.go.html#3208860">Name</a></span><span class="op" id="3219149">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3219153"><a href="/gostd/net/dnsclient_unix.go.html#3218589">name</a></span><span class="op" id="3219157">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219164"><a href="/gostd/net/dnsclient.go.html#3208897">Server</a></span><span class="op" id="3219170">:</span>&nbsp;<span class="ident" id="3219172"><a href="/gostd/net/dnsclient_unix.go.html#3218947">server</a></span><span class="op" id="3219178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3219184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3219190">if</span>&nbsp;<span class="ident" id="3219193">nerr</span><span class="op" id="3219197">,</span>&nbsp;<span class="ident" id="3219199">ok</span>&nbsp;<span class="op" id="3219202">:=</span>&nbsp;<span class="ident" id="3219205"><a href="/gostd/net/dnsclient_unix.go.html#3219024">err</a></span><span class="op" id="3219208">.</span><span class="op" id="3219209">(</span><span class="ident" id="3219210"><a href="/gostd/net/net.go.html#3338570">Error</a></span><span class="op" id="3219215">)</span><span class="op" id="3219216">;</span>&nbsp;<span class="ident" id="3219218"><a href="/gostd/net/dnsclient_unix.go.html#3219199">ok</a></span>&nbsp;<span class="op" id="3219221">&amp;&amp;</span>&nbsp;<span class="ident" id="3219224"><a href="/gostd/net/dnsclient_unix.go.html#3219193">nerr</a></span><span class="op" id="3219228">.</span><span class="ident" id="3219229"><a href="/gostd/net/net.go.html#3338596">Timeout</a></span><span class="op" id="3219236">(</span><span class="op" id="3219237">)</span>&nbsp;<span class="op" id="3219239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219246"><a href="/gostd/net/dnsclient_unix.go.html#3218887">lastErr</a></span><span class="op" id="3219253">.</span><span class="op" id="3219254">(</span><span class="op" id="3219255">*</span><span class="ident" id="3219256"><a href="/gostd/net/dnsclient.go.html#3208795">DNSError</a></span><span class="op" id="3219264">)</span><span class="op" id="3219265">.</span><span class="ident" id="3219266"><a href="/gostd/net/dnsclient.go.html#3208930">IsTimeout</a></span>&nbsp;<span class="op" id="3219276">=</span>&nbsp;<span class="builtintype" id="3219278">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3219287">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3219293">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3219305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219310">cname</span><span class="op" id="3219315">,</span>&nbsp;<span class="ident" id="3219317">addrs</span><span class="op" id="3219322">,</span>&nbsp;<span class="ident" id="3219324"><a href="/gostd/net/dnsclient_unix.go.html#3219024">err</a></span>&nbsp;<span class="op" id="3219328">:=</span>&nbsp;<span class="ident" id="3219331"><a href="/gostd/net/dnsclient.go.html#3210274">answer</a></span><span class="op" id="3219337">(</span><span class="ident" id="3219338"><a href="/gostd/net/dnsclient_unix.go.html#3218589">name</a></span><span class="op" id="3219342">,</span>&nbsp;<span class="ident" id="3219344"><a href="/gostd/net/dnsclient_unix.go.html#3218947">server</a></span><span class="op" id="3219350">,</span>&nbsp;<span class="ident" id="3219352"><a href="/gostd/net/dnsclient_unix.go.html#3219019">msg</a></span><span class="op" id="3219355">,</span>&nbsp;<span class="ident" id="3219357"><a href="/gostd/net/dnsclient_unix.go.html#3218602">qtype</a></span><span class="op" id="3219362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3219367">if</span>&nbsp;<span class="ident" id="3219370"><a href="/gostd/net/dnsclient_unix.go.html#3219024">err</a></span>&nbsp;<span class="op" id="3219374">==</span>&nbsp;<span class="builtintype" id="3219377">nil</span>&nbsp;<span class="op" id="3219381">||</span>&nbsp;<span class="ident" id="3219384"><a href="/gostd/net/dnsclient_unix.go.html#3219024">err</a></span><span class="op" id="3219387">.</span><span class="op" id="3219388">(</span><span class="op" id="3219389">*</span><span class="ident" id="3219390"><a href="/gostd/net/dnsclient.go.html#3208795">DNSError</a></span><span class="op" id="3219398">)</span><span class="op" id="3219399">.</span><span class="ident" id="3219400"><a href="/gostd/net/dnsclient.go.html#3208814">Err</a></span>&nbsp;<span class="op" id="3219404">==</span>&nbsp;<span class="ident" id="3219407"><a href="/gostd/net/dnsclient.go.html#3209250">noSuchHost</a></span>&nbsp;<span class="op" id="3219418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3219424">return</span>&nbsp;<span class="ident" id="3219431"><a href="/gostd/net/dnsclient_unix.go.html#3219310">cname</a></span><span class="op" id="3219436">,</span>&nbsp;<span class="ident" id="3219438"><a href="/gostd/net/dnsclient_unix.go.html#3219317">addrs</a></span><span class="op" id="3219443">,</span>&nbsp;<span class="ident" id="3219445"><a href="/gostd/net/dnsclient_unix.go.html#3219024">err</a></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3219452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219457"><a href="/gostd/net/dnsclient_unix.go.html#3218887">lastErr</a></span>&nbsp;<span class="op" id="3219465">=</span>&nbsp;<span class="ident" id="3219467"><a href="/gostd/net/dnsclient_unix.go.html#3219024">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3219473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3219476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3219479">return</span>&nbsp;<span class="string" id="3219486">&#34;&#34;</span><span class="op" id="3219488">,</span>&nbsp;<span class="builtintype" id="3219490">nil</span><span class="op" id="3219493">,</span>&nbsp;<span class="ident" id="3219495"><a href="/gostd/net/dnsclient_unix.go.html#3218887">lastErr</a></span><br>
<span class="lineno">195</span><span class="op" id="3219503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3219506">func</span>&nbsp;<span class="ident" id="3219511">convertRR_A</span><span class="op" id="3219522">(</span><span class="ident" id="3219523">records</span>&nbsp;<span class="op" id="3219531">[</span><span class="op" id="3219532">]</span><span class="ident" id="3219533"><a href="/gostd/net/dnsmsg.go.html#3231784">dnsRR</a></span><span class="op" id="3219538">)</span>&nbsp;<span class="op" id="3219540">[</span><span class="op" id="3219541">]</span><span class="ident" id="3219542"><a href="/gostd/net/ip.go.html#3286271">IP</a></span>&nbsp;<span class="op" id="3219545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219548">addrs</span>&nbsp;<span class="op" id="3219554">:=</span>&nbsp;<span class="builtinfunc" id="3219557">make</span><span class="op" id="3219561">(</span><span class="op" id="3219562">[</span><span class="op" id="3219563">]</span><span class="ident" id="3219564"><a href="/gostd/net/ip.go.html#3286271">IP</a></span><span class="op" id="3219566">,</span>&nbsp;<span class="builtinfunc" id="3219568">len</span><span class="op" id="3219571">(</span><span class="ident" id="3219572"><a href="/gostd/net/dnsclient_unix.go.html#3219523">records</a></span><span class="op" id="3219579">)</span><span class="op" id="3219580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3219583">for</span>&nbsp;<span class="ident" id="3219587">i</span><span class="op" id="3219588">,</span>&nbsp;<span class="ident" id="3219590">rr</span>&nbsp;<span class="op" id="3219593">:=</span>&nbsp;<span class="keyword" id="3219596">range</span>&nbsp;<span class="ident" id="3219602"><a href="/gostd/net/dnsclient_unix.go.html#3219523">records</a></span>&nbsp;<span class="op" id="3219610">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219614">a</span>&nbsp;<span class="op" id="3219616">:=</span>&nbsp;<span class="ident" id="3219619"><a href="/gostd/net/dnsclient_unix.go.html#3219590">rr</a></span><span class="op" id="3219621">.</span><span class="op" id="3219622">(</span><span class="op" id="3219623">*</span><span class="ident" id="3219624"><a href="/gostd/net/dnsmsg.go.html#3235844">dnsRR_A</a></span><span class="op" id="3219631">)</span><span class="op" id="3219632">.</span><span class="ident" id="3219633"><a href="/gostd/net/dnsmsg.go.html#3235880">A</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219637"><a href="/gostd/net/dnsclient_unix.go.html#3219548">addrs</a></span><span class="op" id="3219642">[</span><span class="ident" id="3219643"><a href="/gostd/net/dnsclient_unix.go.html#3219587">i</a></span><span class="op" id="3219644">]</span>&nbsp;<span class="op" id="3219646">=</span>&nbsp;<span class="ident" id="3219648"><a href="/gostd/net/ip.go.html#3286541">IPv4</a></span><span class="op" id="3219652">(</span><span class="builtintype" id="3219653">byte</span><span class="op" id="3219657">(</span><span class="ident" id="3219658"><a href="/gostd/net/dnsclient_unix.go.html#3219614">a</a></span><span class="op" id="3219659">&gt;&gt;</span><span class="num" id="3219661">24</span><span class="op" id="3219663">)</span><span class="op" id="3219664">,</span>&nbsp;<span class="builtintype" id="3219666">byte</span><span class="op" id="3219670">(</span><span class="ident" id="3219671"><a href="/gostd/net/dnsclient_unix.go.html#3219614">a</a></span><span class="op" id="3219672">&gt;&gt;</span><span class="num" id="3219674">16</span><span class="op" id="3219676">)</span><span class="op" id="3219677">,</span>&nbsp;<span class="builtintype" id="3219679">byte</span><span class="op" id="3219683">(</span><span class="ident" id="3219684"><a href="/gostd/net/dnsclient_unix.go.html#3219614">a</a></span><span class="op" id="3219685">&gt;&gt;</span><span class="num" id="3219687">8</span><span class="op" id="3219688">)</span><span class="op" id="3219689">,</span>&nbsp;<span class="builtintype" id="3219691">byte</span><span class="op" id="3219695">(</span><span class="ident" id="3219696"><a href="/gostd/net/dnsclient_unix.go.html#3219614">a</a></span><span class="op" id="3219697">)</span><span class="op" id="3219698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3219701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3219704">return</span>&nbsp;<span class="ident" id="3219711"><a href="/gostd/net/dnsclient_unix.go.html#3219548">addrs</a></span><br>
<span class="lineno"></span><span class="op" id="3219717">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="keyword" id="3219720">func</span>&nbsp;<span class="ident" id="3219725">convertRR_AAAA</span><span class="op" id="3219739">(</span><span class="ident" id="3219740">records</span>&nbsp;<span class="op" id="3219748">[</span><span class="op" id="3219749">]</span><span class="ident" id="3219750"><a href="/gostd/net/dnsmsg.go.html#3231784">dnsRR</a></span><span class="op" id="3219755">)</span>&nbsp;<span class="op" id="3219757">[</span><span class="op" id="3219758">]</span><span class="ident" id="3219759"><a href="/gostd/net/ip.go.html#3286271">IP</a></span>&nbsp;<span class="op" id="3219762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219765">addrs</span>&nbsp;<span class="op" id="3219771">:=</span>&nbsp;<span class="builtinfunc" id="3219774">make</span><span class="op" id="3219778">(</span><span class="op" id="3219779">[</span><span class="op" id="3219780">]</span><span class="ident" id="3219781"><a href="/gostd/net/ip.go.html#3286271">IP</a></span><span class="op" id="3219783">,</span>&nbsp;<span class="builtinfunc" id="3219785">len</span><span class="op" id="3219788">(</span><span class="ident" id="3219789"><a href="/gostd/net/dnsclient_unix.go.html#3219740">records</a></span><span class="op" id="3219796">)</span><span class="op" id="3219797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3219800">for</span>&nbsp;<span class="ident" id="3219804">i</span><span class="op" id="3219805">,</span>&nbsp;<span class="ident" id="3219807">rr</span>&nbsp;<span class="op" id="3219810">:=</span>&nbsp;<span class="keyword" id="3219813">range</span>&nbsp;<span class="ident" id="3219819"><a href="/gostd/net/dnsclient_unix.go.html#3219740">records</a></span>&nbsp;<span class="op" id="3219827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219831">a</span>&nbsp;<span class="op" id="3219833">:=</span>&nbsp;<span class="builtinfunc" id="3219836">make</span><span class="op" id="3219840">(</span><span class="ident" id="3219841"><a href="/gostd/net/ip.go.html#3286271">IP</a></span><span class="op" id="3219843">,</span>&nbsp;<span class="ident" id="3219845"><a href="/gostd/net/ip.go.html#3285864">IPv6len</a></span><span class="op" id="3219852">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3219856">copy</span><span class="op" id="3219860">(</span><span class="ident" id="3219861"><a href="/gostd/net/dnsclient_unix.go.html#3219831">a</a></span><span class="op" id="3219862">,</span>&nbsp;<span class="ident" id="3219864"><a href="/gostd/net/dnsclient_unix.go.html#3219807">rr</a></span><span class="op" id="3219866">.</span><span class="op" id="3219867">(</span><span class="op" id="3219868">*</span><span class="ident" id="3219869"><a href="/gostd/net/dnsmsg.go.html#3236103">dnsRR_AAAA</a></span><span class="op" id="3219879">)</span><span class="op" id="3219880">.</span><span class="ident" id="3219881"><a href="/gostd/net/dnsmsg.go.html#3236143">AAAA</a></span><span class="op" id="3219885">[</span><span class="op" id="3219886">:</span><span class="op" id="3219887">]</span><span class="op" id="3219888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219892"><a href="/gostd/net/dnsclient_unix.go.html#3219765">addrs</a></span><span class="op" id="3219897">[</span><span class="ident" id="3219898"><a href="/gostd/net/dnsclient_unix.go.html#3219804">i</a></span><span class="op" id="3219899">]</span>&nbsp;<span class="op" id="3219901">=</span>&nbsp;<span class="ident" id="3219903"><a href="/gostd/net/dnsclient_unix.go.html#3219831">a</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3219906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3219909">return</span>&nbsp;<span class="ident" id="3219916"><a href="/gostd/net/dnsclient_unix.go.html#3219765">addrs</a></span><br>
<span class="lineno"></span><span class="op" id="3219922">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="3219925">var</span>&nbsp;<span class="ident" id="3219929">cfg</span>&nbsp;<span class="keyword" id="3219933">struct</span>&nbsp;<span class="op" id="3219940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219943">ch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3219953">chan</span>&nbsp;<span class="keyword" id="3219958">struct</span><span class="op" id="3219964">{</span><span class="op" id="3219965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219968">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3219978"><a href="/gostd/net/dnsclient_unix.go.html#3215135">sync</a></span><span class="op" id="3219982">.</span><span class="ident" id="3219983"><a href="/gostd/sync/rwmutex.go.html#1456076">RWMutex</a></span>&nbsp;<span class="comment" id="3219991">//&nbsp;protects&nbsp;dnsConfig&nbsp;and&nbsp;dnserr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3220025">dnsConfig</span>&nbsp;<span class="op" id="3220035">*</span><span class="ident" id="3220036"><a href="/gostd/net/dnsconfig_unix.go.html#3225531">dnsConfig</a></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3220047">dnserr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3220057">error</span><br>
<span class="lineno"></span><span class="op" id="3220063">}</span><br>
<span class="lineno"></span><span class="keyword" id="3220065">var</span>&nbsp;<span class="ident" id="3220069">onceLoadConfig</span>&nbsp;<span class="ident" id="3220084"><a href="/gostd/net/dnsclient_unix.go.html#3215135">sync</a></span><span class="op" id="3220088">.</span><span class="ident" id="3220089"><a href="/gostd/sync/once.go.html#1446221">Once</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3220095">//&nbsp;Assume&nbsp;dns&nbsp;config&nbsp;file&nbsp;is&nbsp;/etc/resolv.conf&nbsp;here</span><br>
<span class="lineno">225</span><span class="keyword" id="3220146">func</span>&nbsp;<span class="ident" id="3220151">loadDefaultConfig</span><span class="op" id="3220168">(</span><span class="op" id="3220169">)</span>&nbsp;<span class="op" id="3220171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3220174"><a href="/gostd/net/dnsclient_unix.go.html#3220233">loadConfig</a></span><span class="op" id="3220184">(</span><span class="string" id="3220185">&#34;/etc/resolv.conf&#34;</span><span class="op" id="3220203">,</span>&nbsp;<span class="num" id="3220205">5</span><span class="op" id="3220206">*</span><span class="ident" id="3220207"><a href="/gostd/net/dnsclient_unix.go.html#3215143">time</a></span><span class="op" id="3220211">.</span><span class="ident" id="3220212"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="3220218">,</span>&nbsp;<span class="builtintype" id="3220220">nil</span><span class="op" id="3220223">)</span><br>
<span class="lineno"></span><span class="op" id="3220225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3220228">func</span>&nbsp;<span class="ident" id="3220233">loadConfig</span><span class="op" id="3220243">(</span><span class="ident" id="3220244">resolvConfPath</span>&nbsp;<span class="builtintype" id="3220259">string</span><span class="op" id="3220265">,</span>&nbsp;<span class="ident" id="3220267">reloadTime</span>&nbsp;<span class="ident" id="3220278"><a href="/gostd/net/dnsclient_unix.go.html#3215143">time</a></span><span class="op" id="3220282">.</span><span class="ident" id="3220283"><a href="/gostd/time/time.go.html#2734212">Duration</a></span><span class="op" id="3220291">,</span>&nbsp;<span class="ident" id="3220293">quit</span>&nbsp;<span class="op" id="3220298">&lt;-</span><span class="keyword" id="3220300">chan</span>&nbsp;<span class="keyword" id="3220305">chan</span>&nbsp;<span class="keyword" id="3220310">struct</span><span class="op" id="3220316">{</span><span class="op" id="3220317">}</span><span class="op" id="3220318">)</span>&nbsp;<span class="op" id="3220320">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3220323">var</span>&nbsp;<span class="ident" id="3220327">mtime</span>&nbsp;<span class="ident" id="3220333"><a href="/gostd/net/dnsclient_unix.go.html#3215143">time</a></span><span class="op" id="3220337">.</span><span class="ident" id="3220338"><a href="/gostd/time/time.go.html#2722087">Time</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3220344"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3220347">.</span><span class="ident" id="3220348"><a href="/gostd/net/dnsclient_unix.go.html#3219943">ch</a></span>&nbsp;<span class="op" id="3220351">=</span>&nbsp;<span class="builtinfunc" id="3220353">make</span><span class="op" id="3220357">(</span><span class="keyword" id="3220358">chan</span>&nbsp;<span class="keyword" id="3220363">struct</span><span class="op" id="3220369">{</span><span class="op" id="3220370">}</span><span class="op" id="3220371">,</span>&nbsp;<span class="num" id="3220373">1</span><span class="op" id="3220374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3220377">if</span>&nbsp;<span class="ident" id="3220380">fi</span><span class="op" id="3220382">,</span>&nbsp;<span class="ident" id="3220384">err</span>&nbsp;<span class="op" id="3220388">:=</span>&nbsp;<span class="ident" id="3220391"><a href="/gostd/net/dnsclient_unix.go.html#3215129">os</a></span><span class="op" id="3220393">.</span><span class="ident" id="3220394"><a href="/gostd/os/file_unix.go.html#2455511">Stat</a></span><span class="op" id="3220398">(</span><span class="ident" id="3220399"><a href="/gostd/net/dnsclient_unix.go.html#3220244">resolvConfPath</a></span><span class="op" id="3220413">)</span><span class="op" id="3220414">;</span>&nbsp;<span class="ident" id="3220416"><a href="/gostd/net/dnsclient_unix.go.html#3220384">err</a></span>&nbsp;<span class="op" id="3220420">!=</span>&nbsp;<span class="builtintype" id="3220423">nil</span>&nbsp;<span class="op" id="3220427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3220431"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3220434">.</span><span class="ident" id="3220435"><a href="/gostd/net/dnsclient_unix.go.html#3220047">dnserr</a></span>&nbsp;<span class="op" id="3220442">=</span>&nbsp;<span class="ident" id="3220444"><a href="/gostd/net/dnsclient_unix.go.html#3220384">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3220449">}</span>&nbsp;<span class="keyword" id="3220451">else</span>&nbsp;<span class="op" id="3220456">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3220460"><a href="/gostd/net/dnsclient_unix.go.html#3220327">mtime</a></span>&nbsp;<span class="op" id="3220466">=</span>&nbsp;<span class="ident" id="3220468"><a href="/gostd/net/dnsclient_unix.go.html#3220380">fi</a></span><span class="op" id="3220470">.</span><span class="ident" id="3220471"><a href="/gostd/os/types.go.html#2472654">ModTime</a></span><span class="op" id="3220478">(</span><span class="op" id="3220479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3220483"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3220486">.</span><span class="ident" id="3220487"><a href="/gostd/net/dnsclient_unix.go.html#3220025">dnsConfig</a></span><span class="op" id="3220496">,</span>&nbsp;<span class="ident" id="3220498"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3220501">.</span><span class="ident" id="3220502"><a href="/gostd/net/dnsclient_unix.go.html#3220047">dnserr</a></span>&nbsp;<span class="op" id="3220509">=</span>&nbsp;<span class="ident" id="3220511"><a href="/gostd/net/dnsconfig_unix.go.html#3226047">dnsReadConfig</a></span><span class="op" id="3220524">(</span><span class="ident" id="3220525"><a href="/gostd/net/dnsclient_unix.go.html#3220244">resolvConfPath</a></span><span class="op" id="3220539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3220542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3220545">go</span>&nbsp;<span class="keyword" id="3220548">func</span><span class="op" id="3220552">(</span><span class="op" id="3220553">)</span>&nbsp;<span class="op" id="3220555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3220559">for</span>&nbsp;<span class="op" id="3220563">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3220568"><a href="/gostd/net/dnsclient_unix.go.html#3215143">time</a></span><span class="op" id="3220572">.</span><span class="ident" id="3220573"><a href="/gostd/time/sleep.go.html#2713940">Sleep</a></span><span class="op" id="3220578">(</span><span class="ident" id="3220579"><a href="/gostd/net/dnsclient_unix.go.html#3220267">reloadTime</a></span><span class="op" id="3220589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3220594">select</span>&nbsp;<span class="op" id="3220601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3220606">case</span>&nbsp;<span class="ident" id="3220611">qresp</span>&nbsp;<span class="op" id="3220617">:=</span>&nbsp;<span class="op" id="3220620">&lt;-</span><span class="ident" id="3220622"><a href="/gostd/net/dnsclient_unix.go.html#3220293">quit</a></span><span class="op" id="3220626">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3220632"><a href="/gostd/net/dnsclient_unix.go.html#3220611">qresp</a></span>&nbsp;<span class="op" id="3220638">&lt;-</span>&nbsp;<span class="keyword" id="3220641">struct</span><span class="op" id="3220647">{</span><span class="op" id="3220648">}</span><span class="op" id="3220649">{</span><span class="op" id="3220650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3220656">return</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3220666">case</span>&nbsp;<span class="op" id="3220671">&lt;-</span><span class="ident" id="3220673"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3220676">.</span><span class="ident" id="3220677"><a href="/gostd/net/dnsclient_unix.go.html#3219943">ch</a></span><span class="op" id="3220679">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3220684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3220690">//&nbsp;In&nbsp;case&nbsp;of&nbsp;error,&nbsp;we&nbsp;keep&nbsp;the&nbsp;previous&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3220742">fi</span><span class="op" id="3220744">,</span>&nbsp;<span class="ident" id="3220746">err</span>&nbsp;<span class="op" id="3220750">:=</span>&nbsp;<span class="ident" id="3220753"><a href="/gostd/net/dnsclient_unix.go.html#3215129">os</a></span><span class="op" id="3220755">.</span><span class="ident" id="3220756"><a href="/gostd/os/file_unix.go.html#2455511">Stat</a></span><span class="op" id="3220760">(</span><span class="ident" id="3220761"><a href="/gostd/net/dnsclient_unix.go.html#3220244">resolvConfPath</a></span><span class="op" id="3220775">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3220780">if</span>&nbsp;<span class="ident" id="3220783"><a href="/gostd/net/dnsclient_unix.go.html#3220746">err</a></span>&nbsp;<span class="op" id="3220787">!=</span>&nbsp;<span class="builtintype" id="3220790">nil</span>&nbsp;<span class="op" id="3220794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3220800">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3220812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3220817">//&nbsp;If&nbsp;the&nbsp;resolv.conf&nbsp;mtime&nbsp;didn&#39;t&nbsp;change,&nbsp;do&nbsp;not&nbsp;reload</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3220877">m</span>&nbsp;<span class="op" id="3220879">:=</span>&nbsp;<span class="ident" id="3220882"><a href="/gostd/net/dnsclient_unix.go.html#3220742">fi</a></span><span class="op" id="3220884">.</span><span class="ident" id="3220885"><a href="/gostd/os/types.go.html#2472654">ModTime</a></span><span class="op" id="3220892">(</span><span class="op" id="3220893">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3220898">if</span>&nbsp;<span class="ident" id="3220901"><a href="/gostd/net/dnsclient_unix.go.html#3220877">m</a></span><span class="op" id="3220902">.</span><span class="ident" id="3220903"><a href="/gostd/time/time.go.html#2723199">Equal</a></span><span class="op" id="3220908">(</span><span class="ident" id="3220909"><a href="/gostd/net/dnsclient_unix.go.html#3220327">mtime</a></span><span class="op" id="3220914">)</span>&nbsp;<span class="op" id="3220916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3220922">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3220934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3220939"><a href="/gostd/net/dnsclient_unix.go.html#3220327">mtime</a></span>&nbsp;<span class="op" id="3220945">=</span>&nbsp;<span class="ident" id="3220947"><a href="/gostd/net/dnsclient_unix.go.html#3220877">m</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3220952">//&nbsp;In&nbsp;case&nbsp;of&nbsp;error,&nbsp;we&nbsp;keep&nbsp;the&nbsp;previous&nbsp;config</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221004">ncfg</span><span class="op" id="3221008">,</span>&nbsp;<span class="ident" id="3221010"><a href="/gostd/net/dnsclient_unix.go.html#3220746">err</a></span>&nbsp;<span class="op" id="3221014">:=</span>&nbsp;<span class="ident" id="3221017"><a href="/gostd/net/dnsconfig_unix.go.html#3226047">dnsReadConfig</a></span><span class="op" id="3221030">(</span><span class="ident" id="3221031"><a href="/gostd/net/dnsclient_unix.go.html#3220244">resolvConfPath</a></span><span class="op" id="3221045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3221050">if</span>&nbsp;<span class="ident" id="3221053"><a href="/gostd/net/dnsclient_unix.go.html#3220746">err</a></span>&nbsp;<span class="op" id="3221057">!=</span>&nbsp;<span class="builtintype" id="3221060">nil</span>&nbsp;<span class="op" id="3221064">||</span>&nbsp;<span class="builtinfunc" id="3221067">len</span><span class="op" id="3221070">(</span><span class="ident" id="3221071"><a href="/gostd/net/dnsclient_unix.go.html#3221004">ncfg</a></span><span class="op" id="3221075">.</span><span class="ident" id="3221076"><a href="/gostd/net/dnsconfig_unix.go.html#3225551">servers</a></span><span class="op" id="3221083">)</span>&nbsp;<span class="op" id="3221085">==</span>&nbsp;<span class="num" id="3221088">0</span>&nbsp;<span class="op" id="3221090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3221096">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3221108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221113"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3221116">.</span><span class="ident" id="3221117"><a href="/gostd/net/dnsclient_unix.go.html#3219968">mu</a></span><span class="op" id="3221119">.</span><span class="ident" id="3221120"><a href="/gostd/sync/rwmutex.go.html#1457713">Lock</a></span><span class="op" id="3221124">(</span><span class="op" id="3221125">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221130"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3221133">.</span><span class="ident" id="3221134"><a href="/gostd/net/dnsclient_unix.go.html#3220025">dnsConfig</a></span>&nbsp;<span class="op" id="3221144">=</span>&nbsp;<span class="ident" id="3221146"><a href="/gostd/net/dnsclient_unix.go.html#3221004">ncfg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221154"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3221157">.</span><span class="ident" id="3221158"><a href="/gostd/net/dnsclient_unix.go.html#3220047">dnserr</a></span>&nbsp;<span class="op" id="3221165">=</span>&nbsp;<span class="builtintype" id="3221167">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221174"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3221177">.</span><span class="ident" id="3221178"><a href="/gostd/net/dnsclient_unix.go.html#3219968">mu</a></span><span class="op" id="3221180">.</span><span class="ident" id="3221181"><a href="/gostd/sync/rwmutex.go.html#1458554">Unlock</a></span><span class="op" id="3221187">(</span><span class="op" id="3221188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3221192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3221195">}</span><span class="op" id="3221196">(</span><span class="op" id="3221197">)</span><br>
<span class="lineno">270</span><span class="op" id="3221199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3221202">func</span>&nbsp;<span class="ident" id="3221207">lookup</span><span class="op" id="3221213">(</span><span class="ident" id="3221214">name</span>&nbsp;<span class="builtintype" id="3221219">string</span><span class="op" id="3221225">,</span>&nbsp;<span class="ident" id="3221227">qtype</span>&nbsp;<span class="builtintype" id="3221233">uint16</span><span class="op" id="3221239">)</span>&nbsp;<span class="op" id="3221241">(</span><span class="ident" id="3221242">cname</span>&nbsp;<span class="builtintype" id="3221248">string</span><span class="op" id="3221254">,</span>&nbsp;<span class="ident" id="3221256">addrs</span>&nbsp;<span class="op" id="3221262">[</span><span class="op" id="3221263">]</span><span class="ident" id="3221264"><a href="/gostd/net/dnsmsg.go.html#3231784">dnsRR</a></span><span class="op" id="3221269">,</span>&nbsp;<span class="ident" id="3221271">err</span>&nbsp;<span class="builtintype" id="3221275">error</span><span class="op" id="3221280">)</span>&nbsp;<span class="op" id="3221282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3221285">if</span>&nbsp;<span class="op" id="3221288">!</span><span class="ident" id="3221289"><a href="/gostd/net/dnsclient.go.html#3211880">isDomainName</a></span><span class="op" id="3221301">(</span><span class="ident" id="3221302"><a href="/gostd/net/dnsclient_unix.go.html#3221214">name</a></span><span class="op" id="3221306">)</span>&nbsp;<span class="op" id="3221308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3221312">return</span>&nbsp;<span class="ident" id="3221319"><a href="/gostd/net/dnsclient_unix.go.html#3221214">name</a></span><span class="op" id="3221323">,</span>&nbsp;<span class="builtintype" id="3221325">nil</span><span class="op" id="3221328">,</span>&nbsp;<span class="op" id="3221330">&amp;</span><span class="ident" id="3221331"><a href="/gostd/net/dnsclient.go.html#3208795">DNSError</a></span><span class="op" id="3221339">{</span><span class="ident" id="3221340"><a href="/gostd/net/dnsclient.go.html#3208814">Err</a></span><span class="op" id="3221343">:</span>&nbsp;<span class="string" id="3221345">&#34;invalid&nbsp;domain&nbsp;name&#34;</span><span class="op" id="3221366">,</span>&nbsp;<span class="ident" id="3221368"><a href="/gostd/net/dnsclient.go.html#3208860">Name</a></span><span class="op" id="3221372">:</span>&nbsp;<span class="ident" id="3221374"><a href="/gostd/net/dnsclient_unix.go.html#3221214">name</a></span><span class="op" id="3221378">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3221381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221384"><a href="/gostd/net/dnsclient_unix.go.html#3220069">onceLoadConfig</a></span><span class="op" id="3221398">.</span><span class="ident" id="3221399"><a href="/gostd/sync/once.go.html#1447110">Do</a></span><span class="op" id="3221401">(</span><span class="ident" id="3221402"><a href="/gostd/net/dnsclient_unix.go.html#3220151">loadDefaultConfig</a></span><span class="op" id="3221419">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3221423">select</span>&nbsp;<span class="op" id="3221430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3221433">case</span>&nbsp;<span class="ident" id="3221438"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3221441">.</span><span class="ident" id="3221442"><a href="/gostd/net/dnsclient_unix.go.html#3219943">ch</a></span>&nbsp;<span class="op" id="3221445">&lt;-</span>&nbsp;<span class="keyword" id="3221448">struct</span><span class="op" id="3221454">{</span><span class="op" id="3221455">}</span><span class="op" id="3221456">{</span><span class="op" id="3221457">}</span><span class="op" id="3221458">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3221461">default</span><span class="op" id="3221468">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3221471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221475"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3221478">.</span><span class="ident" id="3221479"><a href="/gostd/net/dnsclient_unix.go.html#3219968">mu</a></span><span class="op" id="3221481">.</span><span class="ident" id="3221482"><a href="/gostd/sync/rwmutex.go.html#1456490">RLock</a></span><span class="op" id="3221487">(</span><span class="op" id="3221488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3221491">defer</span>&nbsp;<span class="ident" id="3221497"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3221500">.</span><span class="ident" id="3221501"><a href="/gostd/net/dnsclient_unix.go.html#3219968">mu</a></span><span class="op" id="3221503">.</span><span class="ident" id="3221504"><a href="/gostd/sync/rwmutex.go.html#1456952">RUnlock</a></span><span class="op" id="3221511">(</span><span class="op" id="3221512">)</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3221516">if</span>&nbsp;<span class="ident" id="3221519"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3221522">.</span><span class="ident" id="3221523"><a href="/gostd/net/dnsclient_unix.go.html#3220047">dnserr</a></span>&nbsp;<span class="op" id="3221530">!=</span>&nbsp;<span class="builtintype" id="3221533">nil</span>&nbsp;<span class="op" id="3221537">||</span>&nbsp;<span class="ident" id="3221540"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3221543">.</span><span class="ident" id="3221544"><a href="/gostd/net/dnsclient_unix.go.html#3220025">dnsConfig</a></span>&nbsp;<span class="op" id="3221554">==</span>&nbsp;<span class="builtintype" id="3221557">nil</span>&nbsp;<span class="op" id="3221561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221565"><a href="/gostd/net/dnsclient_unix.go.html#3221271">err</a></span>&nbsp;<span class="op" id="3221569">=</span>&nbsp;<span class="ident" id="3221571"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3221574">.</span><span class="ident" id="3221575"><a href="/gostd/net/dnsclient_unix.go.html#3220047">dnserr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3221584">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3221592">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3221595">//&nbsp;If&nbsp;name&nbsp;is&nbsp;rooted&nbsp;(trailing&nbsp;dot)&nbsp;or&nbsp;has&nbsp;enough&nbsp;dots,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3221652">//&nbsp;try&nbsp;it&nbsp;by&nbsp;itself&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221680">rooted</span>&nbsp;<span class="op" id="3221687">:=</span>&nbsp;<span class="builtinfunc" id="3221690">len</span><span class="op" id="3221693">(</span><span class="ident" id="3221694"><a href="/gostd/net/dnsclient_unix.go.html#3221214">name</a></span><span class="op" id="3221698">)</span>&nbsp;<span class="op" id="3221700">&gt;</span>&nbsp;<span class="num" id="3221702">0</span>&nbsp;<span class="op" id="3221704">&amp;&amp;</span>&nbsp;<span class="ident" id="3221707"><a href="/gostd/net/dnsclient_unix.go.html#3221214">name</a></span><span class="op" id="3221711">[</span><span class="builtinfunc" id="3221712">len</span><span class="op" id="3221715">(</span><span class="ident" id="3221716"><a href="/gostd/net/dnsclient_unix.go.html#3221214">name</a></span><span class="op" id="3221720">)</span><span class="op" id="3221721">-</span><span class="num" id="3221722">1</span><span class="op" id="3221723">]</span>&nbsp;<span class="op" id="3221725">==</span>&nbsp;<span class="string" id="3221728">&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3221733">if</span>&nbsp;<span class="ident" id="3221736"><a href="/gostd/net/dnsclient_unix.go.html#3221680">rooted</a></span>&nbsp;<span class="op" id="3221743">||</span>&nbsp;<span class="ident" id="3221746"><a href="/gostd/net/parse.go.html#3348978">count</a></span><span class="op" id="3221751">(</span><span class="ident" id="3221752"><a href="/gostd/net/dnsclient_unix.go.html#3221214">name</a></span><span class="op" id="3221756">,</span>&nbsp;<span class="string" id="3221758">&#39;.&#39;</span><span class="op" id="3221761">)</span>&nbsp;<span class="op" id="3221763">&gt;=</span>&nbsp;<span class="ident" id="3221766"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3221769">.</span><span class="ident" id="3221770"><a href="/gostd/net/dnsclient_unix.go.html#3220025">dnsConfig</a></span><span class="op" id="3221779">.</span><span class="ident" id="3221780"><a href="/gostd/net/dnsconfig_unix.go.html#3225643">ndots</a></span>&nbsp;<span class="op" id="3221786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221790">rname</span>&nbsp;<span class="op" id="3221796">:=</span>&nbsp;<span class="ident" id="3221799"><a href="/gostd/net/dnsclient_unix.go.html#3221214">name</a></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3221806">if</span>&nbsp;<span class="op" id="3221809">!</span><span class="ident" id="3221810"><a href="/gostd/net/dnsclient_unix.go.html#3221680">rooted</a></span>&nbsp;<span class="op" id="3221817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221822"><a href="/gostd/net/dnsclient_unix.go.html#3221790">rname</a></span>&nbsp;<span class="op" id="3221828">+=</span>&nbsp;<span class="string" id="3221831">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3221837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3221841">//&nbsp;Can&nbsp;try&nbsp;as&nbsp;ordinary&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221872"><a href="/gostd/net/dnsclient_unix.go.html#3221242">cname</a></span><span class="op" id="3221877">,</span>&nbsp;<span class="ident" id="3221879"><a href="/gostd/net/dnsclient_unix.go.html#3221256">addrs</a></span><span class="op" id="3221884">,</span>&nbsp;<span class="ident" id="3221886"><a href="/gostd/net/dnsclient_unix.go.html#3221271">err</a></span>&nbsp;<span class="op" id="3221890">=</span>&nbsp;<span class="ident" id="3221892"><a href="/gostd/net/dnsclient_unix.go.html#3218562">tryOneName</a></span><span class="op" id="3221902">(</span><span class="ident" id="3221903"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3221906">.</span><span class="ident" id="3221907"><a href="/gostd/net/dnsclient_unix.go.html#3220025">dnsConfig</a></span><span class="op" id="3221916">,</span>&nbsp;<span class="ident" id="3221918"><a href="/gostd/net/dnsclient_unix.go.html#3221790">rname</a></span><span class="op" id="3221923">,</span>&nbsp;<span class="ident" id="3221925"><a href="/gostd/net/dnsclient_unix.go.html#3221227">qtype</a></span><span class="op" id="3221930">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3221934">if</span>&nbsp;<span class="ident" id="3221937"><a href="/gostd/net/dnsclient_unix.go.html#3221680">rooted</a></span>&nbsp;<span class="op" id="3221944">||</span>&nbsp;<span class="ident" id="3221947"><a href="/gostd/net/dnsclient_unix.go.html#3221271">err</a></span>&nbsp;<span class="op" id="3221951">==</span>&nbsp;<span class="builtintype" id="3221954">nil</span>&nbsp;<span class="op" id="3221958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3221963">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3221972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3221975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3221979">//&nbsp;Otherwise,&nbsp;try&nbsp;suffixes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3222008">for</span>&nbsp;<span class="ident" id="3222012">i</span>&nbsp;<span class="op" id="3222014">:=</span>&nbsp;<span class="num" id="3222017">0</span><span class="op" id="3222018">;</span>&nbsp;<span class="ident" id="3222020"><a href="/gostd/net/dnsclient_unix.go.html#3222012">i</a></span>&nbsp;<span class="op" id="3222022">&lt;</span>&nbsp;<span class="builtinfunc" id="3222024">len</span><span class="op" id="3222027">(</span><span class="ident" id="3222028"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3222031">.</span><span class="ident" id="3222032"><a href="/gostd/net/dnsclient_unix.go.html#3220025">dnsConfig</a></span><span class="op" id="3222041">.</span><span class="ident" id="3222042"><a href="/gostd/net/dnsconfig_unix.go.html#3225588">search</a></span><span class="op" id="3222048">)</span><span class="op" id="3222049">;</span>&nbsp;<span class="ident" id="3222051"><a href="/gostd/net/dnsclient_unix.go.html#3222012">i</a></span><span class="op" id="3222052">++</span>&nbsp;<span class="op" id="3222055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3222059">rname</span>&nbsp;<span class="op" id="3222065">:=</span>&nbsp;<span class="ident" id="3222068"><a href="/gostd/net/dnsclient_unix.go.html#3221214">name</a></span>&nbsp;<span class="op" id="3222073">+</span>&nbsp;<span class="string" id="3222075">&#34;.&#34;</span>&nbsp;<span class="op" id="3222079">+</span>&nbsp;<span class="ident" id="3222081"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3222084">.</span><span class="ident" id="3222085"><a href="/gostd/net/dnsclient_unix.go.html#3220025">dnsConfig</a></span><span class="op" id="3222094">.</span><span class="ident" id="3222095"><a href="/gostd/net/dnsconfig_unix.go.html#3225588">search</a></span><span class="op" id="3222101">[</span><span class="ident" id="3222102"><a href="/gostd/net/dnsclient_unix.go.html#3222012">i</a></span><span class="op" id="3222103">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3222107">if</span>&nbsp;<span class="ident" id="3222110"><a href="/gostd/net/dnsclient_unix.go.html#3222059">rname</a></span><span class="op" id="3222115">[</span><span class="builtinfunc" id="3222116">len</span><span class="op" id="3222119">(</span><span class="ident" id="3222120"><a href="/gostd/net/dnsclient_unix.go.html#3222059">rname</a></span><span class="op" id="3222125">)</span><span class="op" id="3222126">-</span><span class="num" id="3222127">1</span><span class="op" id="3222128">]</span>&nbsp;<span class="op" id="3222130">!=</span>&nbsp;<span class="string" id="3222133">&#39;.&#39;</span>&nbsp;<span class="op" id="3222137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3222142"><a href="/gostd/net/dnsclient_unix.go.html#3222059">rname</a></span>&nbsp;<span class="op" id="3222148">+=</span>&nbsp;<span class="string" id="3222151">&#34;.&#34;</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3222157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3222161"><a href="/gostd/net/dnsclient_unix.go.html#3221242">cname</a></span><span class="op" id="3222166">,</span>&nbsp;<span class="ident" id="3222168"><a href="/gostd/net/dnsclient_unix.go.html#3221256">addrs</a></span><span class="op" id="3222173">,</span>&nbsp;<span class="ident" id="3222175"><a href="/gostd/net/dnsclient_unix.go.html#3221271">err</a></span>&nbsp;<span class="op" id="3222179">=</span>&nbsp;<span class="ident" id="3222181"><a href="/gostd/net/dnsclient_unix.go.html#3218562">tryOneName</a></span><span class="op" id="3222191">(</span><span class="ident" id="3222192"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3222195">.</span><span class="ident" id="3222196"><a href="/gostd/net/dnsclient_unix.go.html#3220025">dnsConfig</a></span><span class="op" id="3222205">,</span>&nbsp;<span class="ident" id="3222207"><a href="/gostd/net/dnsclient_unix.go.html#3222059">rname</a></span><span class="op" id="3222212">,</span>&nbsp;<span class="ident" id="3222214"><a href="/gostd/net/dnsclient_unix.go.html#3221227">qtype</a></span><span class="op" id="3222219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3222223">if</span>&nbsp;<span class="ident" id="3222226"><a href="/gostd/net/dnsclient_unix.go.html#3221271">err</a></span>&nbsp;<span class="op" id="3222230">==</span>&nbsp;<span class="builtintype" id="3222233">nil</span>&nbsp;<span class="op" id="3222237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3222242">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3222251">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3222254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3222258">//&nbsp;Last&nbsp;ditch&nbsp;effort:&nbsp;try&nbsp;unsuffixed&nbsp;only&nbsp;if&nbsp;we&nbsp;haven&#39;t&nbsp;already,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3222324">//&nbsp;that&nbsp;is,&nbsp;name&nbsp;is&nbsp;not&nbsp;rooted&nbsp;and&nbsp;has&nbsp;less&nbsp;than&nbsp;ndots&nbsp;dots.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3222386">if</span>&nbsp;<span class="ident" id="3222389"><a href="/gostd/net/parse.go.html#3348978">count</a></span><span class="op" id="3222394">(</span><span class="ident" id="3222395"><a href="/gostd/net/dnsclient_unix.go.html#3221214">name</a></span><span class="op" id="3222399">,</span>&nbsp;<span class="string" id="3222401">&#39;.&#39;</span><span class="op" id="3222404">)</span>&nbsp;<span class="op" id="3222406">&lt;</span>&nbsp;<span class="ident" id="3222408"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3222411">.</span><span class="ident" id="3222412"><a href="/gostd/net/dnsclient_unix.go.html#3220025">dnsConfig</a></span><span class="op" id="3222421">.</span><span class="ident" id="3222422"><a href="/gostd/net/dnsconfig_unix.go.html#3225643">ndots</a></span>&nbsp;<span class="op" id="3222428">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3222432"><a href="/gostd/net/dnsclient_unix.go.html#3221242">cname</a></span><span class="op" id="3222437">,</span>&nbsp;<span class="ident" id="3222439"><a href="/gostd/net/dnsclient_unix.go.html#3221256">addrs</a></span><span class="op" id="3222444">,</span>&nbsp;<span class="ident" id="3222446"><a href="/gostd/net/dnsclient_unix.go.html#3221271">err</a></span>&nbsp;<span class="op" id="3222450">=</span>&nbsp;<span class="ident" id="3222452"><a href="/gostd/net/dnsclient_unix.go.html#3218562">tryOneName</a></span><span class="op" id="3222462">(</span><span class="ident" id="3222463"><a href="/gostd/net/dnsclient_unix.go.html#3219929">cfg</a></span><span class="op" id="3222466">.</span><span class="ident" id="3222467"><a href="/gostd/net/dnsclient_unix.go.html#3220025">dnsConfig</a></span><span class="op" id="3222476">,</span>&nbsp;<span class="ident" id="3222478"><a href="/gostd/net/dnsclient_unix.go.html#3221214">name</a></span><span class="op" id="3222482">+</span><span class="string" id="3222483">&#34;.&#34;</span><span class="op" id="3222486">,</span>&nbsp;<span class="ident" id="3222488"><a href="/gostd/net/dnsclient_unix.go.html#3221227">qtype</a></span><span class="op" id="3222493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3222497">if</span>&nbsp;<span class="ident" id="3222500"><a href="/gostd/net/dnsclient_unix.go.html#3221271">err</a></span>&nbsp;<span class="op" id="3222504">==</span>&nbsp;<span class="builtintype" id="3222507">nil</span>&nbsp;<span class="op" id="3222511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3222516">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3222525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3222528">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3222532">if</span>&nbsp;<span class="ident" id="3222535">e</span><span class="op" id="3222536">,</span>&nbsp;<span class="ident" id="3222538">ok</span>&nbsp;<span class="op" id="3222541">:=</span>&nbsp;<span class="ident" id="3222544"><a href="/gostd/net/dnsclient_unix.go.html#3221271">err</a></span><span class="op" id="3222547">.</span><span class="op" id="3222548">(</span><span class="op" id="3222549">*</span><span class="ident" id="3222550"><a href="/gostd/net/dnsclient.go.html#3208795">DNSError</a></span><span class="op" id="3222558">)</span><span class="op" id="3222559">;</span>&nbsp;<span class="ident" id="3222561"><a href="/gostd/net/dnsclient_unix.go.html#3222538">ok</a></span>&nbsp;<span class="op" id="3222564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3222568">//&nbsp;Show&nbsp;original&nbsp;name&nbsp;passed&nbsp;to&nbsp;lookup,&nbsp;not&nbsp;suffixed&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3222628">//&nbsp;In&nbsp;general&nbsp;we&nbsp;might&nbsp;have&nbsp;tried&nbsp;many&nbsp;suffixes;&nbsp;showing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3222687">//&nbsp;just&nbsp;one&nbsp;is&nbsp;misleading.&nbsp;See&nbsp;also&nbsp;golang.org/issue/6324.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3222748"><a href="/gostd/net/dnsclient_unix.go.html#3222535">e</a></span><span class="op" id="3222749">.</span><span class="ident" id="3222750"><a href="/gostd/net/dnsclient.go.html#3208860">Name</a></span>&nbsp;<span class="op" id="3222755">=</span>&nbsp;<span class="ident" id="3222757"><a href="/gostd/net/dnsclient_unix.go.html#3221214">name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3222763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3222766">return</span><br>
<span class="lineno"></span><span class="op" id="3222773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="3222776">//&nbsp;goLookupHost&nbsp;is&nbsp;the&nbsp;native&nbsp;Go&nbsp;implementation&nbsp;of&nbsp;LookupHost.</span><br>
<span class="lineno"></span><span class="comment" id="3222839">//&nbsp;Used&nbsp;only&nbsp;if&nbsp;cgoLookupHost&nbsp;refuses&nbsp;to&nbsp;handle&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="3222899">//&nbsp;(that&nbsp;is,&nbsp;only&nbsp;if&nbsp;cgoLookupHost&nbsp;is&nbsp;the&nbsp;stub&nbsp;in&nbsp;cgo_stub.go).</span><br>
<span class="lineno"></span><span class="comment" id="3222963">//&nbsp;Normally&nbsp;we&nbsp;let&nbsp;cgo&nbsp;use&nbsp;the&nbsp;C&nbsp;library&nbsp;resolver&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3223024">//&nbsp;depending&nbsp;on&nbsp;our&nbsp;lookup&nbsp;code,&nbsp;so&nbsp;that&nbsp;Go&nbsp;and&nbsp;C&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno">340</span><span class="comment" id="3223087">//&nbsp;answers.</span><br>
<span class="lineno"></span><span class="keyword" id="3223099">func</span>&nbsp;<span class="ident" id="3223104">goLookupHost</span><span class="op" id="3223116">(</span><span class="ident" id="3223117">name</span>&nbsp;<span class="builtintype" id="3223122">string</span><span class="op" id="3223128">)</span>&nbsp;<span class="op" id="3223130">(</span><span class="ident" id="3223131">addrs</span>&nbsp;<span class="op" id="3223137">[</span><span class="op" id="3223138">]</span><span class="builtintype" id="3223139">string</span><span class="op" id="3223145">,</span>&nbsp;<span class="ident" id="3223147">err</span>&nbsp;<span class="builtintype" id="3223151">error</span><span class="op" id="3223156">)</span>&nbsp;<span class="op" id="3223158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3223161">//&nbsp;Use&nbsp;entries&nbsp;from&nbsp;/etc/hosts&nbsp;if&nbsp;they&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3223208"><a href="/gostd/net/dnsclient_unix.go.html#3223131">addrs</a></span>&nbsp;<span class="op" id="3223214">=</span>&nbsp;<span class="ident" id="3223216"><a href="/gostd/net/hosts.go.html#3274263">lookupStaticHost</a></span><span class="op" id="3223232">(</span><span class="ident" id="3223233"><a href="/gostd/net/dnsclient_unix.go.html#3223117">name</a></span><span class="op" id="3223237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3223240">if</span>&nbsp;<span class="builtinfunc" id="3223243">len</span><span class="op" id="3223246">(</span><span class="ident" id="3223247"><a href="/gostd/net/dnsclient_unix.go.html#3223131">addrs</a></span><span class="op" id="3223252">)</span>&nbsp;<span class="op" id="3223254">&gt;</span>&nbsp;<span class="num" id="3223256">0</span>&nbsp;<span class="op" id="3223258">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3223262">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3223270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3223273">ips</span><span class="op" id="3223276">,</span>&nbsp;<span class="ident" id="3223278"><a href="/gostd/net/dnsclient_unix.go.html#3223147">err</a></span>&nbsp;<span class="op" id="3223282">:=</span>&nbsp;<span class="ident" id="3223285"><a href="/gostd/net/dnsclient_unix.go.html#3223765">goLookupIP</a></span><span class="op" id="3223295">(</span><span class="ident" id="3223296"><a href="/gostd/net/dnsclient_unix.go.html#3223117">name</a></span><span class="op" id="3223300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3223303">if</span>&nbsp;<span class="ident" id="3223306"><a href="/gostd/net/dnsclient_unix.go.html#3223147">err</a></span>&nbsp;<span class="op" id="3223310">!=</span>&nbsp;<span class="builtintype" id="3223313">nil</span>&nbsp;<span class="op" id="3223317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3223321">return</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3223329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3223332"><a href="/gostd/net/dnsclient_unix.go.html#3223131">addrs</a></span>&nbsp;<span class="op" id="3223338">=</span>&nbsp;<span class="builtinfunc" id="3223340">make</span><span class="op" id="3223344">(</span><span class="op" id="3223345">[</span><span class="op" id="3223346">]</span><span class="builtintype" id="3223347">string</span><span class="op" id="3223353">,</span>&nbsp;<span class="num" id="3223355">0</span><span class="op" id="3223356">,</span>&nbsp;<span class="builtinfunc" id="3223358">len</span><span class="op" id="3223361">(</span><span class="ident" id="3223362"><a href="/gostd/net/dnsclient_unix.go.html#3223273">ips</a></span><span class="op" id="3223365">)</span><span class="op" id="3223366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3223369">for</span>&nbsp;<span class="ident" id="3223373">_</span><span class="op" id="3223374">,</span>&nbsp;<span class="ident" id="3223376">ip</span>&nbsp;<span class="op" id="3223379">:=</span>&nbsp;<span class="keyword" id="3223382">range</span>&nbsp;<span class="ident" id="3223388"><a href="/gostd/net/dnsclient_unix.go.html#3223273">ips</a></span>&nbsp;<span class="op" id="3223392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3223396"><a href="/gostd/net/dnsclient_unix.go.html#3223131">addrs</a></span>&nbsp;<span class="op" id="3223402">=</span>&nbsp;<span class="builtinfunc" id="3223404">append</span><span class="op" id="3223410">(</span><span class="ident" id="3223411"><a href="/gostd/net/dnsclient_unix.go.html#3223131">addrs</a></span><span class="op" id="3223416">,</span>&nbsp;<span class="ident" id="3223418"><a href="/gostd/net/dnsclient_unix.go.html#3223376">ip</a></span><span class="op" id="3223420">.</span><span class="ident" id="3223421"><a href="/gostd/net/ip.go.html#3291839">String</a></span><span class="op" id="3223427">(</span><span class="op" id="3223428">)</span><span class="op" id="3223429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3223432">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3223435">return</span><br>
<span class="lineno"></span><span class="op" id="3223442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3223445">//&nbsp;goLookupIP&nbsp;is&nbsp;the&nbsp;native&nbsp;Go&nbsp;implementation&nbsp;of&nbsp;LookupIP.</span><br>
<span class="lineno"></span><span class="comment" id="3223504">//&nbsp;Used&nbsp;only&nbsp;if&nbsp;cgoLookupIP&nbsp;refuses&nbsp;to&nbsp;handle&nbsp;the&nbsp;request</span><br>
<span class="lineno">360</span><span class="comment" id="3223562">//&nbsp;(that&nbsp;is,&nbsp;only&nbsp;if&nbsp;cgoLookupIP&nbsp;is&nbsp;the&nbsp;stub&nbsp;in&nbsp;cgo_stub.go).</span><br>
<span class="lineno"></span><span class="comment" id="3223624">//&nbsp;Normally&nbsp;we&nbsp;let&nbsp;cgo&nbsp;use&nbsp;the&nbsp;C&nbsp;library&nbsp;resolver&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3223685">//&nbsp;depending&nbsp;on&nbsp;our&nbsp;lookup&nbsp;code,&nbsp;so&nbsp;that&nbsp;Go&nbsp;and&nbsp;C&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3223748">//&nbsp;answers.</span><br>
<span class="lineno"></span><span class="keyword" id="3223760">func</span>&nbsp;<span class="ident" id="3223765">goLookupIP</span><span class="op" id="3223775">(</span><span class="ident" id="3223776">name</span>&nbsp;<span class="builtintype" id="3223781">string</span><span class="op" id="3223787">)</span>&nbsp;<span class="op" id="3223789">(</span><span class="ident" id="3223790">addrs</span>&nbsp;<span class="op" id="3223796">[</span><span class="op" id="3223797">]</span><span class="ident" id="3223798"><a href="/gostd/net/ip.go.html#3286271">IP</a></span><span class="op" id="3223800">,</span>&nbsp;<span class="ident" id="3223802">err</span>&nbsp;<span class="builtintype" id="3223806">error</span><span class="op" id="3223811">)</span>&nbsp;<span class="op" id="3223813">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3223816">//&nbsp;Use&nbsp;entries&nbsp;from&nbsp;/etc/hosts&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3223861">haddrs</span>&nbsp;<span class="op" id="3223868">:=</span>&nbsp;<span class="ident" id="3223871"><a href="/gostd/net/hosts.go.html#3274263">lookupStaticHost</a></span><span class="op" id="3223887">(</span><span class="ident" id="3223888"><a href="/gostd/net/dnsclient_unix.go.html#3223776">name</a></span><span class="op" id="3223892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3223895">if</span>&nbsp;<span class="builtinfunc" id="3223898">len</span><span class="op" id="3223901">(</span><span class="ident" id="3223902"><a href="/gostd/net/dnsclient_unix.go.html#3223861">haddrs</a></span><span class="op" id="3223908">)</span>&nbsp;<span class="op" id="3223910">&gt;</span>&nbsp;<span class="num" id="3223912">0</span>&nbsp;<span class="op" id="3223914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3223918">for</span>&nbsp;<span class="ident" id="3223922">_</span><span class="op" id="3223923">,</span>&nbsp;<span class="ident" id="3223925">haddr</span>&nbsp;<span class="op" id="3223931">:=</span>&nbsp;<span class="keyword" id="3223934">range</span>&nbsp;<span class="ident" id="3223940"><a href="/gostd/net/dnsclient_unix.go.html#3223861">haddrs</a></span>&nbsp;<span class="op" id="3223947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3223952">if</span>&nbsp;<span class="ident" id="3223955">ip</span>&nbsp;<span class="op" id="3223958">:=</span>&nbsp;<span class="ident" id="3223961"><a href="/gostd/net/ip.go.html#3299857">ParseIP</a></span><span class="op" id="3223968">(</span><span class="ident" id="3223969"><a href="/gostd/net/dnsclient_unix.go.html#3223925">haddr</a></span><span class="op" id="3223974">)</span><span class="op" id="3223975">;</span>&nbsp;<span class="ident" id="3223977"><a href="/gostd/net/dnsclient_unix.go.html#3223955">ip</a></span>&nbsp;<span class="op" id="3223980">!=</span>&nbsp;<span class="builtintype" id="3223983">nil</span>&nbsp;<span class="op" id="3223987">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3223993"><a href="/gostd/net/dnsclient_unix.go.html#3223790">addrs</a></span>&nbsp;<span class="op" id="3223999">=</span>&nbsp;<span class="builtinfunc" id="3224001">append</span><span class="op" id="3224007">(</span><span class="ident" id="3224008"><a href="/gostd/net/dnsclient_unix.go.html#3223790">addrs</a></span><span class="op" id="3224013">,</span>&nbsp;<span class="ident" id="3224015"><a href="/gostd/net/dnsclient_unix.go.html#3223955">ip</a></span><span class="op" id="3224017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3224022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3224026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3224030">if</span>&nbsp;<span class="builtinfunc" id="3224033">len</span><span class="op" id="3224036">(</span><span class="ident" id="3224037"><a href="/gostd/net/dnsclient_unix.go.html#3223790">addrs</a></span><span class="op" id="3224042">)</span>&nbsp;<span class="op" id="3224044">&gt;</span>&nbsp;<span class="num" id="3224046">0</span>&nbsp;<span class="op" id="3224048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3224053">return</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3224062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3224065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3224068">type</span>&nbsp;<span class="ident" id="3224073">racer</span>&nbsp;<span class="keyword" id="3224079">struct</span>&nbsp;<span class="op" id="3224086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3224090">qtype</span>&nbsp;<span class="builtintype" id="3224096">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3224105">rrs</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3224111">[</span><span class="op" id="3224112">]</span><span class="ident" id="3224113"><a href="/gostd/net/dnsmsg.go.html#3231784">dnsRR</a></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3224121">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3224128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3224131">lane</span>&nbsp;<span class="op" id="3224136">:=</span>&nbsp;<span class="builtinfunc" id="3224139">make</span><span class="op" id="3224143">(</span><span class="keyword" id="3224144">chan</span>&nbsp;<span class="ident" id="3224149"><a href="/gostd/net/dnsclient_unix.go.html#3224073">racer</a></span><span class="op" id="3224154">,</span>&nbsp;<span class="num" id="3224156">1</span><span class="op" id="3224157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3224160">qtypes</span>&nbsp;<span class="op" id="3224167">:=</span>&nbsp;<span class="op" id="3224170">[</span><span class="op" id="3224171">...</span><span class="op" id="3224174">]</span><span class="builtintype" id="3224175">uint16</span><span class="op" id="3224181">{</span><span class="ident" id="3224182"><a href="/gostd/net/dnsmsg.go.html#3228786">dnsTypeA</a></span><span class="op" id="3224190">,</span>&nbsp;<span class="ident" id="3224192"><a href="/gostd/net/dnsmsg.go.html#3229081">dnsTypeAAAA</a></span><span class="op" id="3224203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3224206">for</span>&nbsp;<span class="ident" id="3224210">_</span><span class="op" id="3224211">,</span>&nbsp;<span class="ident" id="3224213">qtype</span>&nbsp;<span class="op" id="3224219">:=</span>&nbsp;<span class="keyword" id="3224222">range</span>&nbsp;<span class="ident" id="3224228"><a href="/gostd/net/dnsclient_unix.go.html#3224160">qtypes</a></span>&nbsp;<span class="op" id="3224235">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3224239">go</span>&nbsp;<span class="keyword" id="3224242">func</span><span class="op" id="3224246">(</span><span class="ident" id="3224247">qtype</span>&nbsp;<span class="builtintype" id="3224253">uint16</span><span class="op" id="3224259">)</span>&nbsp;<span class="op" id="3224261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3224266">_</span><span class="op" id="3224267">,</span>&nbsp;<span class="ident" id="3224269">rrs</span><span class="op" id="3224272">,</span>&nbsp;<span class="ident" id="3224274">err</span>&nbsp;<span class="op" id="3224278">:=</span>&nbsp;<span class="ident" id="3224281"><a href="/gostd/net/dnsclient_unix.go.html#3221207">lookup</a></span><span class="op" id="3224287">(</span><span class="ident" id="3224288"><a href="/gostd/net/dnsclient_unix.go.html#3223776">name</a></span><span class="op" id="3224292">,</span>&nbsp;<span class="ident" id="3224294"><a href="/gostd/net/dnsclient_unix.go.html#3224247">qtype</a></span><span class="op" id="3224299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3224304"><a href="/gostd/net/dnsclient_unix.go.html#3224131">lane</a></span>&nbsp;<span class="op" id="3224309">&lt;-</span>&nbsp;<span class="ident" id="3224312"><a href="/gostd/net/dnsclient_unix.go.html#3224073">racer</a></span><span class="op" id="3224317">{</span><span class="ident" id="3224318"><a href="/gostd/net/dnsclient_unix.go.html#3224247">qtype</a></span><span class="op" id="3224323">,</span>&nbsp;<span class="ident" id="3224325"><a href="/gostd/net/dnsclient_unix.go.html#3224269">rrs</a></span><span class="op" id="3224328">,</span>&nbsp;<span class="ident" id="3224330"><a href="/gostd/net/dnsclient_unix.go.html#3224274">err</a></span><span class="op" id="3224333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3224337">}</span><span class="op" id="3224338">(</span><span class="ident" id="3224339"><a href="/gostd/net/dnsclient_unix.go.html#3224213">qtype</a></span><span class="op" id="3224344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3224347">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3224350">var</span>&nbsp;<span class="ident" id="3224354">lastErr</span>&nbsp;<span class="builtintype" id="3224362">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3224369">for</span>&nbsp;<span class="keyword" id="3224373">range</span>&nbsp;<span class="ident" id="3224379"><a href="/gostd/net/dnsclient_unix.go.html#3224160">qtypes</a></span>&nbsp;<span class="op" id="3224386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3224390">racer</span>&nbsp;<span class="op" id="3224396">:=</span>&nbsp;<span class="op" id="3224399">&lt;-</span><span class="ident" id="3224401"><a href="/gostd/net/dnsclient_unix.go.html#3224131">lane</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3224408">if</span>&nbsp;<span class="ident" id="3224411"><a href="/gostd/net/dnsclient_unix.go.html#3224390">racer</a></span><span class="op" id="3224416">.</span><span class="builtintype" id="3224417"><a href="/gostd/net/dnsclient_unix.go.html#3224121">error</a></span>&nbsp;<span class="op" id="3224423">!=</span>&nbsp;<span class="builtintype" id="3224426">nil</span>&nbsp;<span class="op" id="3224430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3224435"><a href="/gostd/net/dnsclient_unix.go.html#3224354">lastErr</a></span>&nbsp;<span class="op" id="3224443">=</span>&nbsp;<span class="ident" id="3224445"><a href="/gostd/net/dnsclient_unix.go.html#3224390">racer</a></span><span class="op" id="3224450">.</span><span class="builtintype" id="3224451"><a href="/gostd/net/dnsclient_unix.go.html#3224121">error</a></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3224460">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3224471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3224475">switch</span>&nbsp;<span class="ident" id="3224482"><a href="/gostd/net/dnsclient_unix.go.html#3224390">racer</a></span><span class="op" id="3224487">.</span><span class="ident" id="3224488"><a href="/gostd/net/dnsclient_unix.go.html#3224090">qtype</a></span>&nbsp;<span class="op" id="3224494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3224498">case</span>&nbsp;<span class="ident" id="3224503"><a href="/gostd/net/dnsmsg.go.html#3228786">dnsTypeA</a></span><span class="op" id="3224511">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3224516"><a href="/gostd/net/dnsclient_unix.go.html#3223790">addrs</a></span>&nbsp;<span class="op" id="3224522">=</span>&nbsp;<span class="builtinfunc" id="3224524">append</span><span class="op" id="3224530">(</span><span class="ident" id="3224531"><a href="/gostd/net/dnsclient_unix.go.html#3223790">addrs</a></span><span class="op" id="3224536">,</span>&nbsp;<span class="ident" id="3224538"><a href="/gostd/net/dnsclient_unix.go.html#3219511">convertRR_A</a></span><span class="op" id="3224549">(</span><span class="ident" id="3224550"><a href="/gostd/net/dnsclient_unix.go.html#3224390">racer</a></span><span class="op" id="3224555">.</span><span class="ident" id="3224556"><a href="/gostd/net/dnsclient_unix.go.html#3224105">rrs</a></span><span class="op" id="3224559">)</span><span class="op" id="3224560">...</span><span class="op" id="3224563">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3224567">case</span>&nbsp;<span class="ident" id="3224572"><a href="/gostd/net/dnsmsg.go.html#3229081">dnsTypeAAAA</a></span><span class="op" id="3224583">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3224588"><a href="/gostd/net/dnsclient_unix.go.html#3223790">addrs</a></span>&nbsp;<span class="op" id="3224594">=</span>&nbsp;<span class="builtinfunc" id="3224596">append</span><span class="op" id="3224602">(</span><span class="ident" id="3224603"><a href="/gostd/net/dnsclient_unix.go.html#3223790">addrs</a></span><span class="op" id="3224608">,</span>&nbsp;<span class="ident" id="3224610"><a href="/gostd/net/dnsclient_unix.go.html#3219725">convertRR_AAAA</a></span><span class="op" id="3224624">(</span><span class="ident" id="3224625"><a href="/gostd/net/dnsclient_unix.go.html#3224390">racer</a></span><span class="op" id="3224630">.</span><span class="ident" id="3224631"><a href="/gostd/net/dnsclient_unix.go.html#3224105">rrs</a></span><span class="op" id="3224634">)</span><span class="op" id="3224635">...</span><span class="op" id="3224638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3224642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3224645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3224648">if</span>&nbsp;<span class="builtinfunc" id="3224651">len</span><span class="op" id="3224654">(</span><span class="ident" id="3224655"><a href="/gostd/net/dnsclient_unix.go.html#3223790">addrs</a></span><span class="op" id="3224660">)</span>&nbsp;<span class="op" id="3224662">==</span>&nbsp;<span class="num" id="3224665">0</span>&nbsp;<span class="op" id="3224667">&amp;&amp;</span>&nbsp;<span class="ident" id="3224670"><a href="/gostd/net/dnsclient_unix.go.html#3224354">lastErr</a></span>&nbsp;<span class="op" id="3224678">!=</span>&nbsp;<span class="builtintype" id="3224681">nil</span>&nbsp;<span class="op" id="3224685">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3224689">return</span>&nbsp;<span class="builtintype" id="3224696">nil</span><span class="op" id="3224699">,</span>&nbsp;<span class="ident" id="3224701"><a href="/gostd/net/dnsclient_unix.go.html#3224354">lastErr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3224710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3224713">return</span>&nbsp;<span class="ident" id="3224720"><a href="/gostd/net/dnsclient_unix.go.html#3223790">addrs</a></span><span class="op" id="3224725">,</span>&nbsp;<span class="builtintype" id="3224727">nil</span><br>
<span class="lineno"></span><span class="op" id="3224731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="3224734">//&nbsp;goLookupCNAME&nbsp;is&nbsp;the&nbsp;native&nbsp;Go&nbsp;implementation&nbsp;of&nbsp;LookupCNAME.</span><br>
<span class="lineno"></span><span class="comment" id="3224799">//&nbsp;Used&nbsp;only&nbsp;if&nbsp;cgoLookupCNAME&nbsp;refuses&nbsp;to&nbsp;handle&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="3224860">//&nbsp;(that&nbsp;is,&nbsp;only&nbsp;if&nbsp;cgoLookupCNAME&nbsp;is&nbsp;the&nbsp;stub&nbsp;in&nbsp;cgo_stub.go).</span><br>
<span class="lineno"></span><span class="comment" id="3224925">//&nbsp;Normally&nbsp;we&nbsp;let&nbsp;cgo&nbsp;use&nbsp;the&nbsp;C&nbsp;library&nbsp;resolver&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3224986">//&nbsp;depending&nbsp;on&nbsp;our&nbsp;lookup&nbsp;code,&nbsp;so&nbsp;that&nbsp;Go&nbsp;and&nbsp;C&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno">415</span><span class="comment" id="3225049">//&nbsp;answers.</span><br>
<span class="lineno"></span><span class="keyword" id="3225061">func</span>&nbsp;<span class="ident" id="3225066">goLookupCNAME</span><span class="op" id="3225079">(</span><span class="ident" id="3225080">name</span>&nbsp;<span class="builtintype" id="3225085">string</span><span class="op" id="3225091">)</span>&nbsp;<span class="op" id="3225093">(</span><span class="ident" id="3225094">cname</span>&nbsp;<span class="builtintype" id="3225100">string</span><span class="op" id="3225106">,</span>&nbsp;<span class="ident" id="3225108">err</span>&nbsp;<span class="builtintype" id="3225112">error</span><span class="op" id="3225117">)</span>&nbsp;<span class="op" id="3225119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3225122">_</span><span class="op" id="3225123">,</span>&nbsp;<span class="ident" id="3225125">rr</span><span class="op" id="3225127">,</span>&nbsp;<span class="ident" id="3225129"><a href="/gostd/net/dnsclient_unix.go.html#3225108">err</a></span>&nbsp;<span class="op" id="3225133">:=</span>&nbsp;<span class="ident" id="3225136"><a href="/gostd/net/dnsclient_unix.go.html#3221207">lookup</a></span><span class="op" id="3225142">(</span><span class="ident" id="3225143"><a href="/gostd/net/dnsclient_unix.go.html#3225080">name</a></span><span class="op" id="3225147">,</span>&nbsp;<span class="ident" id="3225149"><a href="/gostd/net/dnsmsg.go.html#3228858">dnsTypeCNAME</a></span><span class="op" id="3225161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3225164">if</span>&nbsp;<span class="ident" id="3225167"><a href="/gostd/net/dnsclient_unix.go.html#3225108">err</a></span>&nbsp;<span class="op" id="3225171">!=</span>&nbsp;<span class="builtintype" id="3225174">nil</span>&nbsp;<span class="op" id="3225178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3225182">return</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3225190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3225193"><a href="/gostd/net/dnsclient_unix.go.html#3225094">cname</a></span>&nbsp;<span class="op" id="3225199">=</span>&nbsp;<span class="ident" id="3225201"><a href="/gostd/net/dnsclient_unix.go.html#3225125">rr</a></span><span class="op" id="3225203">[</span><span class="num" id="3225204">0</span><span class="op" id="3225205">]</span><span class="op" id="3225206">.</span><span class="op" id="3225207">(</span><span class="op" id="3225208">*</span><span class="ident" id="3225209"><a href="/gostd/net/dnsmsg.go.html#3231894">dnsRR_CNAME</a></span><span class="op" id="3225220">)</span><span class="op" id="3225221">.</span><span class="ident" id="3225222"><a href="/gostd/net/dnsmsg.go.html#3231936">Cname</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3225229">return</span><br>
<span class="lineno"></span><span class="op" id="3225236">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
