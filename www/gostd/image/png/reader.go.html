<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5212525">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5212580">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5212634">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5212685">//&nbsp;Package&nbsp;png&nbsp;implements&nbsp;a&nbsp;PNG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5212744">//</span><br>
<span class="lineno"></span><span class="comment" id="5212747">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/TR/PNG/.</span><br>
<span class="lineno"></span><span class="keyword" id="5212805">package</span>&nbsp;<span class="ident" id="5212813">png</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5212818">import</span>&nbsp;<span class="op" id="5212825">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5212828">&#34;compress/zlib&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5212845">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5212864">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5212871">&#34;hash&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5212879">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5212893">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5212902">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5212917">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5212922">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5212925">//&nbsp;Color&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5212961">const</span>&nbsp;<span class="op" id="5212967">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5212970">ctGrayscale</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5212987">=</span>&nbsp;<span class="num" id="5212989">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5212992">ctTrueColor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213009">=</span>&nbsp;<span class="num" id="5213011">2</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213014">ctPaletted</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213031">=</span>&nbsp;<span class="num" id="5213033">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213036">ctGrayscaleAlpha</span>&nbsp;<span class="op" id="5213053">=</span>&nbsp;<span class="num" id="5213055">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213058">ctTrueColorAlpha</span>&nbsp;<span class="op" id="5213075">=</span>&nbsp;<span class="num" id="5213077">6</span><br>
<span class="lineno"></span><span class="op" id="5213079">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5213082">//&nbsp;A&nbsp;cb&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;color&nbsp;type&nbsp;and&nbsp;bit&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5213136">const</span>&nbsp;<span class="op" id="5213142">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213145">cbInvalid</span>&nbsp;<span class="op" id="5213155">=</span>&nbsp;<span class="ident" id="5213157">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213163">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213169">cbG2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213175">cbG4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213181">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213187">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213194">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213201">cbP1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213207">cbP2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213213">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213219">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213225">cbTCA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213233">cbG16</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213240">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213248">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213256">cbTCA16</span><br>
<span class="lineno"></span><span class="op" id="5213264">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5213267">//&nbsp;Filter&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5213304">const</span>&nbsp;<span class="op" id="5213310">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213313">ftNone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213323">=</span>&nbsp;<span class="num" id="5213325">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213328">ftSub</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213338">=</span>&nbsp;<span class="num" id="5213340">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213343">ftUp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213353">=</span>&nbsp;<span class="num" id="5213355">2</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213358">ftAverage</span>&nbsp;<span class="op" id="5213368">=</span>&nbsp;<span class="num" id="5213370">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213373">ftPaeth</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5213383">=</span>&nbsp;<span class="num" id="5213385">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213388">nFilter</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5213398">=</span>&nbsp;<span class="num" id="5213400">5</span><br>
<span class="lineno"></span><span class="op" id="5213402">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5213405">//&nbsp;Interlace&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5213424">const</span>&nbsp;<span class="op" id="5213430">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213433">itNone</span>&nbsp;&nbsp;<span class="op" id="5213441">=</span>&nbsp;<span class="num" id="5213443">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213446">itAdam7</span>&nbsp;<span class="op" id="5213454">=</span>&nbsp;<span class="num" id="5213456">1</span><br>
<span class="lineno"></span><span class="op" id="5213458">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="5213461">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;placement&nbsp;and&nbsp;size&nbsp;of&nbsp;a&nbsp;pass&nbsp;for&nbsp;Adam7&nbsp;interlacing.</span><br>
<span class="lineno"></span><span class="keyword" id="5213542">type</span>&nbsp;<span class="ident" id="5213547">interlaceScan</span>&nbsp;<span class="keyword" id="5213561">struct</span>&nbsp;<span class="op" id="5213568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213571">xFactor</span><span class="op" id="5213578">,</span>&nbsp;<span class="ident" id="5213580">yFactor</span><span class="op" id="5213587">,</span>&nbsp;<span class="ident" id="5213589">xOffset</span><span class="op" id="5213596">,</span>&nbsp;<span class="ident" id="5213598">yOffset</span>&nbsp;<span class="builtintype" id="5213606">int</span><br>
<span class="lineno"></span><span class="op" id="5213610">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="5213613">//&nbsp;interlacing&nbsp;defines&nbsp;Adam7&nbsp;interlacing,&nbsp;with&nbsp;7&nbsp;passes&nbsp;of&nbsp;reduced&nbsp;images.</span><br>
<span class="lineno"></span><span class="comment" id="5213688">//&nbsp;See&nbsp;http://www.w3.org/TR/PNG/#8Interlace</span><br>
<span class="lineno"></span><span class="keyword" id="5213732">var</span>&nbsp;<span class="ident" id="5213736">interlacing</span>&nbsp;<span class="op" id="5213748">=</span>&nbsp;<span class="op" id="5213750">[</span><span class="op" id="5213751">]</span><span class="ident" id="5213752">interlaceScan</span><span class="op" id="5213765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213768">{</span><span class="num" id="5213769">8</span><span class="op" id="5213770">,</span>&nbsp;<span class="num" id="5213772">8</span><span class="op" id="5213773">,</span>&nbsp;<span class="num" id="5213775">0</span><span class="op" id="5213776">,</span>&nbsp;<span class="num" id="5213778">0</span><span class="op" id="5213779">}</span><span class="op" id="5213780">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213783">{</span><span class="num" id="5213784">8</span><span class="op" id="5213785">,</span>&nbsp;<span class="num" id="5213787">8</span><span class="op" id="5213788">,</span>&nbsp;<span class="num" id="5213790">4</span><span class="op" id="5213791">,</span>&nbsp;<span class="num" id="5213793">0</span><span class="op" id="5213794">}</span><span class="op" id="5213795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213798">{</span><span class="num" id="5213799">4</span><span class="op" id="5213800">,</span>&nbsp;<span class="num" id="5213802">8</span><span class="op" id="5213803">,</span>&nbsp;<span class="num" id="5213805">0</span><span class="op" id="5213806">,</span>&nbsp;<span class="num" id="5213808">4</span><span class="op" id="5213809">}</span><span class="op" id="5213810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213813">{</span><span class="num" id="5213814">4</span><span class="op" id="5213815">,</span>&nbsp;<span class="num" id="5213817">4</span><span class="op" id="5213818">,</span>&nbsp;<span class="num" id="5213820">2</span><span class="op" id="5213821">,</span>&nbsp;<span class="num" id="5213823">0</span><span class="op" id="5213824">}</span><span class="op" id="5213825">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213828">{</span><span class="num" id="5213829">2</span><span class="op" id="5213830">,</span>&nbsp;<span class="num" id="5213832">4</span><span class="op" id="5213833">,</span>&nbsp;<span class="num" id="5213835">0</span><span class="op" id="5213836">,</span>&nbsp;<span class="num" id="5213838">2</span><span class="op" id="5213839">}</span><span class="op" id="5213840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213843">{</span><span class="num" id="5213844">2</span><span class="op" id="5213845">,</span>&nbsp;<span class="num" id="5213847">2</span><span class="op" id="5213848">,</span>&nbsp;<span class="num" id="5213850">1</span><span class="op" id="5213851">,</span>&nbsp;<span class="num" id="5213853">0</span><span class="op" id="5213854">}</span><span class="op" id="5213855">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213858">{</span><span class="num" id="5213859">1</span><span class="op" id="5213860">,</span>&nbsp;<span class="num" id="5213862">2</span><span class="op" id="5213863">,</span>&nbsp;<span class="num" id="5213865">0</span><span class="op" id="5213866">,</span>&nbsp;<span class="num" id="5213868">1</span><span class="op" id="5213869">}</span><span class="op" id="5213870">,</span><br>
<span class="lineno"></span><span class="op" id="5213872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5213875">//&nbsp;Decoding&nbsp;stage.</span><br>
<span class="lineno"></span><span class="comment" id="5213894">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;says&nbsp;that&nbsp;the&nbsp;IHDR,&nbsp;PLTE&nbsp;(if&nbsp;present),&nbsp;IDAT&nbsp;and&nbsp;IEND</span><br>
<span class="lineno">85</span><span class="comment" id="5213972">//&nbsp;chunks&nbsp;must&nbsp;appear&nbsp;in&nbsp;that&nbsp;order.&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;IDAT&nbsp;chunks,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5214048">//&nbsp;IDAT&nbsp;chunks&nbsp;must&nbsp;be&nbsp;sequential&nbsp;(i.e.&nbsp;they&nbsp;may&nbsp;not&nbsp;have&nbsp;any&nbsp;other&nbsp;chunks</span><br>
<span class="lineno"></span><span class="comment" id="5214123">//&nbsp;between&nbsp;them).</span><br>
<span class="lineno"></span><span class="comment" id="5214141">//&nbsp;http://www.w3.org/TR/PNG/#5ChunkOrdering</span><br>
<span class="lineno"></span><span class="keyword" id="5214185">const</span>&nbsp;<span class="op" id="5214191">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214194">dsStart</span>&nbsp;<span class="op" id="5214202">=</span>&nbsp;<span class="ident" id="5214204">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214210">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214222">dsSeenPLTE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214234">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214246">dsSeenIEND</span><br>
<span class="lineno">95</span><span class="op" id="5214257">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5214260">const</span>&nbsp;<span class="ident" id="5214266">pngHeader</span>&nbsp;<span class="op" id="5214276">=</span>&nbsp;<span class="string" id="5214278">&#34;\x89PNG\r\n\x1a\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5214299">type</span>&nbsp;<span class="ident" id="5214304">decoder</span>&nbsp;<span class="keyword" id="5214312">struct</span>&nbsp;<span class="op" id="5214319">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214322">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214336">io</span><span class="op" id="5214338">.</span><span class="ident" id="5214339">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214347">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214361">image</span><span class="op" id="5214366">.</span><span class="ident" id="5214367">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214374">crc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214388">hash</span><span class="op" id="5214392">.</span><span class="ident" id="5214393">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214401">width</span><span class="op" id="5214406">,</span>&nbsp;<span class="ident" id="5214408">height</span>&nbsp;<span class="builtintype" id="5214415">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214420">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5214434">int</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214439">palette</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214453">color</span><span class="op" id="5214458">.</span><span class="ident" id="5214459">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214468">cb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5214482">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214487">stage</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5214501">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214506">idatLength</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5214520">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214528">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5214542">[</span><span class="num" id="5214543">3</span>&nbsp;<span class="op" id="5214545">*</span>&nbsp;<span class="num" id="5214547">256</span><span class="op" id="5214550">]</span><span class="builtintype" id="5214551">byte</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214557">interlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5214571">int</span><br>
<span class="lineno"></span><span class="op" id="5214575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5214578">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;PNG.</span><br>
<span class="lineno"></span><span class="keyword" id="5214638">type</span>&nbsp;<span class="ident" id="5214643">FormatError</span>&nbsp;<span class="builtintype" id="5214655">string</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="5214663">func</span>&nbsp;<span class="op" id="5214668">(</span><span class="ident" id="5214669">e</span>&nbsp;<span class="ident" id="5214671">FormatError</span><span class="op" id="5214682">)</span>&nbsp;<span class="ident" id="5214684">Error</span><span class="op" id="5214689">(</span><span class="op" id="5214690">)</span>&nbsp;<span class="builtintype" id="5214692">string</span>&nbsp;<span class="op" id="5214699">{</span>&nbsp;<span class="keyword" id="5214701">return</span>&nbsp;<span class="string" id="5214708">&#34;png:&nbsp;invalid&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="5214732">+</span>&nbsp;<span class="builtintype" id="5214734">string</span><span class="op" id="5214740">(</span><span class="ident" id="5214741">e</span><span class="op" id="5214742">)</span>&nbsp;<span class="op" id="5214744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5214747">var</span>&nbsp;<span class="ident" id="5214751">chunkOrderError</span>&nbsp;<span class="op" id="5214767">=</span>&nbsp;<span class="ident" id="5214769">FormatError</span><span class="op" id="5214780">(</span><span class="string" id="5214781">&#34;chunk&nbsp;out&nbsp;of&nbsp;order&#34;</span><span class="op" id="5214801">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="5214804">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;PNG&nbsp;feature.</span><br>
<span class="lineno"></span><span class="keyword" id="5214894">type</span>&nbsp;<span class="ident" id="5214899">UnsupportedError</span>&nbsp;<span class="builtintype" id="5214916">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5214924">func</span>&nbsp;<span class="op" id="5214929">(</span><span class="ident" id="5214930">e</span>&nbsp;<span class="ident" id="5214932">UnsupportedError</span><span class="op" id="5214948">)</span>&nbsp;<span class="ident" id="5214950">Error</span><span class="op" id="5214955">(</span><span class="op" id="5214956">)</span>&nbsp;<span class="builtintype" id="5214958">string</span>&nbsp;<span class="op" id="5214965">{</span>&nbsp;<span class="keyword" id="5214967">return</span>&nbsp;<span class="string" id="5214974">&#34;png:&nbsp;unsupported&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="5215003">+</span>&nbsp;<span class="builtintype" id="5215005">string</span><span class="op" id="5215011">(</span><span class="ident" id="5215012">e</span><span class="op" id="5215013">)</span>&nbsp;<span class="op" id="5215015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="5215018">func</span>&nbsp;<span class="ident" id="5215023">min</span><span class="op" id="5215026">(</span><span class="ident" id="5215027">a</span><span class="op" id="5215028">,</span>&nbsp;<span class="ident" id="5215030">b</span>&nbsp;<span class="builtintype" id="5215032">int</span><span class="op" id="5215035">)</span>&nbsp;<span class="builtintype" id="5215037">int</span>&nbsp;<span class="op" id="5215041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215044">if</span>&nbsp;<span class="ident" id="5215047">a</span>&nbsp;<span class="op" id="5215049">&lt;</span>&nbsp;<span class="ident" id="5215051">b</span>&nbsp;<span class="op" id="5215053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215057">return</span>&nbsp;<span class="ident" id="5215064">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215070">return</span>&nbsp;<span class="ident" id="5215077">b</span><br>
<span class="lineno">130</span><span class="op" id="5215079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5215082">func</span>&nbsp;<span class="op" id="5215087">(</span><span class="ident" id="5215088">d</span>&nbsp;<span class="op" id="5215090">*</span><span class="ident" id="5215091">decoder</span><span class="op" id="5215098">)</span>&nbsp;<span class="ident" id="5215100">parseIHDR</span><span class="op" id="5215109">(</span><span class="ident" id="5215110">length</span>&nbsp;<span class="builtintype" id="5215117">uint32</span><span class="op" id="5215123">)</span>&nbsp;<span class="builtintype" id="5215125">error</span>&nbsp;<span class="op" id="5215131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215134">if</span>&nbsp;<span class="ident" id="5215137">length</span>&nbsp;<span class="op" id="5215144">!=</span>&nbsp;<span class="num" id="5215147">13</span>&nbsp;<span class="op" id="5215150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215154">return</span>&nbsp;<span class="ident" id="5215161">FormatError</span><span class="op" id="5215172">(</span><span class="string" id="5215173">&#34;bad&nbsp;IHDR&nbsp;length&#34;</span><span class="op" id="5215190">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215196">if</span>&nbsp;<span class="ident" id="5215199">_</span><span class="op" id="5215200">,</span>&nbsp;<span class="ident" id="5215202">err</span>&nbsp;<span class="op" id="5215206">:=</span>&nbsp;<span class="ident" id="5215209">io</span><span class="op" id="5215211">.</span><span class="ident" id="5215212">ReadFull</span><span class="op" id="5215220">(</span><span class="ident" id="5215221">d</span><span class="op" id="5215222">.</span><span class="ident" id="5215223">r</span><span class="op" id="5215224">,</span>&nbsp;<span class="ident" id="5215226">d</span><span class="op" id="5215227">.</span><span class="ident" id="5215228">tmp</span><span class="op" id="5215231">[</span><span class="op" id="5215232">:</span><span class="num" id="5215233">13</span><span class="op" id="5215235">]</span><span class="op" id="5215236">)</span><span class="op" id="5215237">;</span>&nbsp;<span class="ident" id="5215239">err</span>&nbsp;<span class="op" id="5215243">!=</span>&nbsp;<span class="builtintype" id="5215246">nil</span>&nbsp;<span class="op" id="5215250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215254">return</span>&nbsp;<span class="ident" id="5215261">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215269">d</span><span class="op" id="5215270">.</span><span class="ident" id="5215271">crc</span><span class="op" id="5215274">.</span><span class="ident" id="5215275">Write</span><span class="op" id="5215280">(</span><span class="ident" id="5215281">d</span><span class="op" id="5215282">.</span><span class="ident" id="5215283">tmp</span><span class="op" id="5215286">[</span><span class="op" id="5215287">:</span><span class="num" id="5215288">13</span><span class="op" id="5215290">]</span><span class="op" id="5215291">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215294">if</span>&nbsp;<span class="ident" id="5215297">d</span><span class="op" id="5215298">.</span><span class="ident" id="5215299">tmp</span><span class="op" id="5215302">[</span><span class="num" id="5215303">10</span><span class="op" id="5215305">]</span>&nbsp;<span class="op" id="5215307">!=</span>&nbsp;<span class="num" id="5215310">0</span>&nbsp;<span class="op" id="5215312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215316">return</span>&nbsp;<span class="ident" id="5215323">UnsupportedError</span><span class="op" id="5215339">(</span><span class="string" id="5215340">&#34;compression&nbsp;method&#34;</span><span class="op" id="5215360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215366">if</span>&nbsp;<span class="ident" id="5215369">d</span><span class="op" id="5215370">.</span><span class="ident" id="5215371">tmp</span><span class="op" id="5215374">[</span><span class="num" id="5215375">11</span><span class="op" id="5215377">]</span>&nbsp;<span class="op" id="5215379">!=</span>&nbsp;<span class="num" id="5215382">0</span>&nbsp;<span class="op" id="5215384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215388">return</span>&nbsp;<span class="ident" id="5215395">UnsupportedError</span><span class="op" id="5215411">(</span><span class="string" id="5215412">&#34;filter&nbsp;method&#34;</span><span class="op" id="5215427">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215433">if</span>&nbsp;<span class="ident" id="5215436">d</span><span class="op" id="5215437">.</span><span class="ident" id="5215438">tmp</span><span class="op" id="5215441">[</span><span class="num" id="5215442">12</span><span class="op" id="5215444">]</span>&nbsp;<span class="op" id="5215446">!=</span>&nbsp;<span class="ident" id="5215449">itNone</span>&nbsp;<span class="op" id="5215456">&amp;&amp;</span>&nbsp;<span class="ident" id="5215459">d</span><span class="op" id="5215460">.</span><span class="ident" id="5215461">tmp</span><span class="op" id="5215464">[</span><span class="num" id="5215465">12</span><span class="op" id="5215467">]</span>&nbsp;<span class="op" id="5215469">!=</span>&nbsp;<span class="ident" id="5215472">itAdam7</span>&nbsp;<span class="op" id="5215480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215484">return</span>&nbsp;<span class="ident" id="5215491">FormatError</span><span class="op" id="5215502">(</span><span class="string" id="5215503">&#34;invalid&nbsp;interlace&nbsp;method&#34;</span><span class="op" id="5215529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215535">d</span><span class="op" id="5215536">.</span><span class="ident" id="5215537">interlace</span>&nbsp;<span class="op" id="5215547">=</span>&nbsp;<span class="builtintype" id="5215549">int</span><span class="op" id="5215552">(</span><span class="ident" id="5215553">d</span><span class="op" id="5215554">.</span><span class="ident" id="5215555">tmp</span><span class="op" id="5215558">[</span><span class="num" id="5215559">12</span><span class="op" id="5215561">]</span><span class="op" id="5215562">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215565">w</span>&nbsp;<span class="op" id="5215567">:=</span>&nbsp;<span class="builtintype" id="5215570">int32</span><span class="op" id="5215575">(</span><span class="ident" id="5215576">binary</span><span class="op" id="5215582">.</span><span class="ident" id="5215583">BigEndian</span><span class="op" id="5215592">.</span><span class="ident" id="5215593">Uint32</span><span class="op" id="5215599">(</span><span class="ident" id="5215600">d</span><span class="op" id="5215601">.</span><span class="ident" id="5215602">tmp</span><span class="op" id="5215605">[</span><span class="num" id="5215606">0</span><span class="op" id="5215607">:</span><span class="num" id="5215608">4</span><span class="op" id="5215609">]</span><span class="op" id="5215610">)</span><span class="op" id="5215611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215614">h</span>&nbsp;<span class="op" id="5215616">:=</span>&nbsp;<span class="builtintype" id="5215619">int32</span><span class="op" id="5215624">(</span><span class="ident" id="5215625">binary</span><span class="op" id="5215631">.</span><span class="ident" id="5215632">BigEndian</span><span class="op" id="5215641">.</span><span class="ident" id="5215642">Uint32</span><span class="op" id="5215648">(</span><span class="ident" id="5215649">d</span><span class="op" id="5215650">.</span><span class="ident" id="5215651">tmp</span><span class="op" id="5215654">[</span><span class="num" id="5215655">4</span><span class="op" id="5215656">:</span><span class="num" id="5215657">8</span><span class="op" id="5215658">]</span><span class="op" id="5215659">)</span><span class="op" id="5215660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215663">if</span>&nbsp;<span class="ident" id="5215666">w</span>&nbsp;<span class="op" id="5215668">&lt;</span>&nbsp;<span class="num" id="5215670">0</span>&nbsp;<span class="op" id="5215672">||</span>&nbsp;<span class="ident" id="5215675">h</span>&nbsp;<span class="op" id="5215677">&lt;</span>&nbsp;<span class="num" id="5215679">0</span>&nbsp;<span class="op" id="5215681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215685">return</span>&nbsp;<span class="ident" id="5215692">FormatError</span><span class="op" id="5215703">(</span><span class="string" id="5215704">&#34;negative&nbsp;dimension&#34;</span><span class="op" id="5215724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215727">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215730">nPixels</span>&nbsp;<span class="op" id="5215738">:=</span>&nbsp;<span class="builtintype" id="5215741">int64</span><span class="op" id="5215746">(</span><span class="ident" id="5215747">w</span><span class="op" id="5215748">)</span>&nbsp;<span class="op" id="5215750">*</span>&nbsp;<span class="builtintype" id="5215752">int64</span><span class="op" id="5215757">(</span><span class="ident" id="5215758">h</span><span class="op" id="5215759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215762">if</span>&nbsp;<span class="ident" id="5215765">nPixels</span>&nbsp;<span class="op" id="5215773">!=</span>&nbsp;<span class="builtintype" id="5215776">int64</span><span class="op" id="5215781">(</span><span class="builtintype" id="5215782">int</span><span class="op" id="5215785">(</span><span class="ident" id="5215786">nPixels</span><span class="op" id="5215793">)</span><span class="op" id="5215794">)</span>&nbsp;<span class="op" id="5215796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215800">return</span>&nbsp;<span class="ident" id="5215807">UnsupportedError</span><span class="op" id="5215823">(</span><span class="string" id="5215824">&#34;dimension&nbsp;overflow&#34;</span><span class="op" id="5215844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215850">d</span><span class="op" id="5215851">.</span><span class="ident" id="5215852">cb</span>&nbsp;<span class="op" id="5215855">=</span>&nbsp;<span class="ident" id="5215857">cbInvalid</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215868">d</span><span class="op" id="5215869">.</span><span class="ident" id="5215870">depth</span>&nbsp;<span class="op" id="5215876">=</span>&nbsp;<span class="builtintype" id="5215878">int</span><span class="op" id="5215881">(</span><span class="ident" id="5215882">d</span><span class="op" id="5215883">.</span><span class="ident" id="5215884">tmp</span><span class="op" id="5215887">[</span><span class="num" id="5215888">8</span><span class="op" id="5215889">]</span><span class="op" id="5215890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215893">switch</span>&nbsp;<span class="ident" id="5215900">d</span><span class="op" id="5215901">.</span><span class="ident" id="5215902">depth</span>&nbsp;<span class="op" id="5215908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215911">case</span>&nbsp;<span class="num" id="5215916">1</span><span class="op" id="5215917">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215921">switch</span>&nbsp;<span class="ident" id="5215928">d</span><span class="op" id="5215929">.</span><span class="ident" id="5215930">tmp</span><span class="op" id="5215933">[</span><span class="num" id="5215934">9</span><span class="op" id="5215935">]</span>&nbsp;<span class="op" id="5215937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215941">case</span>&nbsp;<span class="ident" id="5215946">ctGrayscale</span><span class="op" id="5215957">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215962">d</span><span class="op" id="5215963">.</span><span class="ident" id="5215964">cb</span>&nbsp;<span class="op" id="5215967">=</span>&nbsp;<span class="ident" id="5215969">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215976">case</span>&nbsp;<span class="ident" id="5215981">ctPaletted</span><span class="op" id="5215991">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215996">d</span><span class="op" id="5215997">.</span><span class="ident" id="5215998">cb</span>&nbsp;<span class="op" id="5216001">=</span>&nbsp;<span class="ident" id="5216003">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216013">case</span>&nbsp;<span class="num" id="5216018">2</span><span class="op" id="5216019">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216023">switch</span>&nbsp;<span class="ident" id="5216030">d</span><span class="op" id="5216031">.</span><span class="ident" id="5216032">tmp</span><span class="op" id="5216035">[</span><span class="num" id="5216036">9</span><span class="op" id="5216037">]</span>&nbsp;<span class="op" id="5216039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216043">case</span>&nbsp;<span class="ident" id="5216048">ctGrayscale</span><span class="op" id="5216059">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216064">d</span><span class="op" id="5216065">.</span><span class="ident" id="5216066">cb</span>&nbsp;<span class="op" id="5216069">=</span>&nbsp;<span class="ident" id="5216071">cbG2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216078">case</span>&nbsp;<span class="ident" id="5216083">ctPaletted</span><span class="op" id="5216093">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216098">d</span><span class="op" id="5216099">.</span><span class="ident" id="5216100">cb</span>&nbsp;<span class="op" id="5216103">=</span>&nbsp;<span class="ident" id="5216105">cbP2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216115">case</span>&nbsp;<span class="num" id="5216120">4</span><span class="op" id="5216121">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216125">switch</span>&nbsp;<span class="ident" id="5216132">d</span><span class="op" id="5216133">.</span><span class="ident" id="5216134">tmp</span><span class="op" id="5216137">[</span><span class="num" id="5216138">9</span><span class="op" id="5216139">]</span>&nbsp;<span class="op" id="5216141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216145">case</span>&nbsp;<span class="ident" id="5216150">ctGrayscale</span><span class="op" id="5216161">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216166">d</span><span class="op" id="5216167">.</span><span class="ident" id="5216168">cb</span>&nbsp;<span class="op" id="5216171">=</span>&nbsp;<span class="ident" id="5216173">cbG4</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216180">case</span>&nbsp;<span class="ident" id="5216185">ctPaletted</span><span class="op" id="5216195">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216200">d</span><span class="op" id="5216201">.</span><span class="ident" id="5216202">cb</span>&nbsp;<span class="op" id="5216205">=</span>&nbsp;<span class="ident" id="5216207">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216217">case</span>&nbsp;<span class="num" id="5216222">8</span><span class="op" id="5216223">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216227">switch</span>&nbsp;<span class="ident" id="5216234">d</span><span class="op" id="5216235">.</span><span class="ident" id="5216236">tmp</span><span class="op" id="5216239">[</span><span class="num" id="5216240">9</span><span class="op" id="5216241">]</span>&nbsp;<span class="op" id="5216243">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216247">case</span>&nbsp;<span class="ident" id="5216252">ctGrayscale</span><span class="op" id="5216263">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216268">d</span><span class="op" id="5216269">.</span><span class="ident" id="5216270">cb</span>&nbsp;<span class="op" id="5216273">=</span>&nbsp;<span class="ident" id="5216275">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216282">case</span>&nbsp;<span class="ident" id="5216287">ctTrueColor</span><span class="op" id="5216298">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216303">d</span><span class="op" id="5216304">.</span><span class="ident" id="5216305">cb</span>&nbsp;<span class="op" id="5216308">=</span>&nbsp;<span class="ident" id="5216310">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216318">case</span>&nbsp;<span class="ident" id="5216323">ctPaletted</span><span class="op" id="5216333">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216338">d</span><span class="op" id="5216339">.</span><span class="ident" id="5216340">cb</span>&nbsp;<span class="op" id="5216343">=</span>&nbsp;<span class="ident" id="5216345">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216352">case</span>&nbsp;<span class="ident" id="5216357">ctGrayscaleAlpha</span><span class="op" id="5216373">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216378">d</span><span class="op" id="5216379">.</span><span class="ident" id="5216380">cb</span>&nbsp;<span class="op" id="5216383">=</span>&nbsp;<span class="ident" id="5216385">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216393">case</span>&nbsp;<span class="ident" id="5216398">ctTrueColorAlpha</span><span class="op" id="5216414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216419">d</span><span class="op" id="5216420">.</span><span class="ident" id="5216421">cb</span>&nbsp;<span class="op" id="5216424">=</span>&nbsp;<span class="ident" id="5216426">cbTCA8</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216438">case</span>&nbsp;<span class="num" id="5216443">16</span><span class="op" id="5216445">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216449">switch</span>&nbsp;<span class="ident" id="5216456">d</span><span class="op" id="5216457">.</span><span class="ident" id="5216458">tmp</span><span class="op" id="5216461">[</span><span class="num" id="5216462">9</span><span class="op" id="5216463">]</span>&nbsp;<span class="op" id="5216465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216469">case</span>&nbsp;<span class="ident" id="5216474">ctGrayscale</span><span class="op" id="5216485">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216490">d</span><span class="op" id="5216491">.</span><span class="ident" id="5216492">cb</span>&nbsp;<span class="op" id="5216495">=</span>&nbsp;<span class="ident" id="5216497">cbG16</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216505">case</span>&nbsp;<span class="ident" id="5216510">ctTrueColor</span><span class="op" id="5216521">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216526">d</span><span class="op" id="5216527">.</span><span class="ident" id="5216528">cb</span>&nbsp;<span class="op" id="5216531">=</span>&nbsp;<span class="ident" id="5216533">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216542">case</span>&nbsp;<span class="ident" id="5216547">ctGrayscaleAlpha</span><span class="op" id="5216563">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216568">d</span><span class="op" id="5216569">.</span><span class="ident" id="5216570">cb</span>&nbsp;<span class="op" id="5216573">=</span>&nbsp;<span class="ident" id="5216575">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216584">case</span>&nbsp;<span class="ident" id="5216589">ctTrueColorAlpha</span><span class="op" id="5216605">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216610">d</span><span class="op" id="5216611">.</span><span class="ident" id="5216612">cb</span>&nbsp;<span class="op" id="5216615">=</span>&nbsp;<span class="ident" id="5216617">cbTCA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216633">if</span>&nbsp;<span class="ident" id="5216636">d</span><span class="op" id="5216637">.</span><span class="ident" id="5216638">cb</span>&nbsp;<span class="op" id="5216641">==</span>&nbsp;<span class="ident" id="5216644">cbInvalid</span>&nbsp;<span class="op" id="5216654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216658">return</span>&nbsp;<span class="ident" id="5216665">UnsupportedError</span><span class="op" id="5216681">(</span><span class="ident" id="5216682">fmt</span><span class="op" id="5216685">.</span><span class="ident" id="5216686">Sprintf</span><span class="op" id="5216693">(</span><span class="string" id="5216694">&#34;bit&nbsp;depth&nbsp;%d,&nbsp;color&nbsp;type&nbsp;%d&#34;</span><span class="op" id="5216723">,</span>&nbsp;<span class="ident" id="5216725">d</span><span class="op" id="5216726">.</span><span class="ident" id="5216727">tmp</span><span class="op" id="5216730">[</span><span class="num" id="5216731">8</span><span class="op" id="5216732">]</span><span class="op" id="5216733">,</span>&nbsp;<span class="ident" id="5216735">d</span><span class="op" id="5216736">.</span><span class="ident" id="5216737">tmp</span><span class="op" id="5216740">[</span><span class="num" id="5216741">9</span><span class="op" id="5216742">]</span><span class="op" id="5216743">)</span><span class="op" id="5216744">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216750">d</span><span class="op" id="5216751">.</span><span class="ident" id="5216752">width</span><span class="op" id="5216757">,</span>&nbsp;<span class="ident" id="5216759">d</span><span class="op" id="5216760">.</span><span class="ident" id="5216761">height</span>&nbsp;<span class="op" id="5216768">=</span>&nbsp;<span class="builtintype" id="5216770">int</span><span class="op" id="5216773">(</span><span class="ident" id="5216774">w</span><span class="op" id="5216775">)</span><span class="op" id="5216776">,</span>&nbsp;<span class="builtintype" id="5216778">int</span><span class="op" id="5216781">(</span><span class="ident" id="5216782">h</span><span class="op" id="5216783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216786">return</span>&nbsp;<span class="ident" id="5216793">d</span><span class="op" id="5216794">.</span><span class="ident" id="5216795">verifyChecksum</span><span class="op" id="5216809">(</span><span class="op" id="5216810">)</span><br>
<span class="lineno"></span><span class="op" id="5216812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="5216815">func</span>&nbsp;<span class="op" id="5216820">(</span><span class="ident" id="5216821">d</span>&nbsp;<span class="op" id="5216823">*</span><span class="ident" id="5216824">decoder</span><span class="op" id="5216831">)</span>&nbsp;<span class="ident" id="5216833">parsePLTE</span><span class="op" id="5216842">(</span><span class="ident" id="5216843">length</span>&nbsp;<span class="builtintype" id="5216850">uint32</span><span class="op" id="5216856">)</span>&nbsp;<span class="builtintype" id="5216858">error</span>&nbsp;<span class="op" id="5216864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216867">np</span>&nbsp;<span class="op" id="5216870">:=</span>&nbsp;<span class="builtintype" id="5216873">int</span><span class="op" id="5216876">(</span><span class="ident" id="5216877">length</span>&nbsp;<span class="op" id="5216884">/</span>&nbsp;<span class="num" id="5216886">3</span><span class="op" id="5216887">)</span>&nbsp;<span class="comment" id="5216889">//&nbsp;The&nbsp;number&nbsp;of&nbsp;palette&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216924">if</span>&nbsp;<span class="ident" id="5216927">length</span><span class="op" id="5216933">%</span><span class="num" id="5216934">3</span>&nbsp;<span class="op" id="5216936">!=</span>&nbsp;<span class="num" id="5216939">0</span>&nbsp;<span class="op" id="5216941">||</span>&nbsp;<span class="ident" id="5216944">np</span>&nbsp;<span class="op" id="5216947">&lt;=</span>&nbsp;<span class="num" id="5216950">0</span>&nbsp;<span class="op" id="5216952">||</span>&nbsp;<span class="ident" id="5216955">np</span>&nbsp;<span class="op" id="5216958">&gt;</span>&nbsp;<span class="num" id="5216960">256</span>&nbsp;<span class="op" id="5216964">||</span>&nbsp;<span class="ident" id="5216967">np</span>&nbsp;<span class="op" id="5216970">&gt;</span>&nbsp;<span class="num" id="5216972">1</span><span class="op" id="5216973">&lt;&lt;</span><span class="builtintype" id="5216975">uint</span><span class="op" id="5216979">(</span><span class="ident" id="5216980">d</span><span class="op" id="5216981">.</span><span class="ident" id="5216982">depth</span><span class="op" id="5216987">)</span>&nbsp;<span class="op" id="5216989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216993">return</span>&nbsp;<span class="ident" id="5217000">FormatError</span><span class="op" id="5217011">(</span><span class="string" id="5217012">&#34;bad&nbsp;PLTE&nbsp;length&#34;</span><span class="op" id="5217029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5217032">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217035">n</span><span class="op" id="5217036">,</span>&nbsp;<span class="ident" id="5217038">err</span>&nbsp;<span class="op" id="5217042">:=</span>&nbsp;<span class="ident" id="5217045">io</span><span class="op" id="5217047">.</span><span class="ident" id="5217048">ReadFull</span><span class="op" id="5217056">(</span><span class="ident" id="5217057">d</span><span class="op" id="5217058">.</span><span class="ident" id="5217059">r</span><span class="op" id="5217060">,</span>&nbsp;<span class="ident" id="5217062">d</span><span class="op" id="5217063">.</span><span class="ident" id="5217064">tmp</span><span class="op" id="5217067">[</span><span class="op" id="5217068">:</span><span class="num" id="5217069">3</span><span class="op" id="5217070">*</span><span class="ident" id="5217071">np</span><span class="op" id="5217073">]</span><span class="op" id="5217074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217077">if</span>&nbsp;<span class="ident" id="5217080">err</span>&nbsp;<span class="op" id="5217084">!=</span>&nbsp;<span class="builtintype" id="5217087">nil</span>&nbsp;<span class="op" id="5217091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217095">return</span>&nbsp;<span class="ident" id="5217102">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5217107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217110">d</span><span class="op" id="5217111">.</span><span class="ident" id="5217112">crc</span><span class="op" id="5217115">.</span><span class="ident" id="5217116">Write</span><span class="op" id="5217121">(</span><span class="ident" id="5217122">d</span><span class="op" id="5217123">.</span><span class="ident" id="5217124">tmp</span><span class="op" id="5217127">[</span><span class="op" id="5217128">:</span><span class="ident" id="5217129">n</span><span class="op" id="5217130">]</span><span class="op" id="5217131">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217134">switch</span>&nbsp;<span class="ident" id="5217141">d</span><span class="op" id="5217142">.</span><span class="ident" id="5217143">cb</span>&nbsp;<span class="op" id="5217146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217149">case</span>&nbsp;<span class="ident" id="5217154">cbP1</span><span class="op" id="5217158">,</span>&nbsp;<span class="ident" id="5217160">cbP2</span><span class="op" id="5217164">,</span>&nbsp;<span class="ident" id="5217166">cbP4</span><span class="op" id="5217170">,</span>&nbsp;<span class="ident" id="5217172">cbP8</span><span class="op" id="5217176">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217180">d</span><span class="op" id="5217181">.</span><span class="ident" id="5217182">palette</span>&nbsp;<span class="op" id="5217190">=</span>&nbsp;<span class="builtinfunc" id="5217192">make</span><span class="op" id="5217196">(</span><span class="ident" id="5217197">color</span><span class="op" id="5217202">.</span><span class="ident" id="5217203">Palette</span><span class="op" id="5217210">,</span>&nbsp;<span class="num" id="5217212">256</span><span class="op" id="5217215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217219">for</span>&nbsp;<span class="ident" id="5217223">i</span>&nbsp;<span class="op" id="5217225">:=</span>&nbsp;<span class="num" id="5217228">0</span><span class="op" id="5217229">;</span>&nbsp;<span class="ident" id="5217231">i</span>&nbsp;<span class="op" id="5217233">&lt;</span>&nbsp;<span class="ident" id="5217235">np</span><span class="op" id="5217237">;</span>&nbsp;<span class="ident" id="5217239">i</span><span class="op" id="5217240">++</span>&nbsp;<span class="op" id="5217243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217248">d</span><span class="op" id="5217249">.</span><span class="ident" id="5217250">palette</span><span class="op" id="5217257">[</span><span class="ident" id="5217258">i</span><span class="op" id="5217259">]</span>&nbsp;<span class="op" id="5217261">=</span>&nbsp;<span class="ident" id="5217263">color</span><span class="op" id="5217268">.</span><span class="ident" id="5217269">RGBA</span><span class="op" id="5217273">{</span><span class="ident" id="5217274">d</span><span class="op" id="5217275">.</span><span class="ident" id="5217276">tmp</span><span class="op" id="5217279">[</span><span class="num" id="5217280">3</span><span class="op" id="5217281">*</span><span class="ident" id="5217282">i</span><span class="op" id="5217283">+</span><span class="num" id="5217284">0</span><span class="op" id="5217285">]</span><span class="op" id="5217286">,</span>&nbsp;<span class="ident" id="5217288">d</span><span class="op" id="5217289">.</span><span class="ident" id="5217290">tmp</span><span class="op" id="5217293">[</span><span class="num" id="5217294">3</span><span class="op" id="5217295">*</span><span class="ident" id="5217296">i</span><span class="op" id="5217297">+</span><span class="num" id="5217298">1</span><span class="op" id="5217299">]</span><span class="op" id="5217300">,</span>&nbsp;<span class="ident" id="5217302">d</span><span class="op" id="5217303">.</span><span class="ident" id="5217304">tmp</span><span class="op" id="5217307">[</span><span class="num" id="5217308">3</span><span class="op" id="5217309">*</span><span class="ident" id="5217310">i</span><span class="op" id="5217311">+</span><span class="num" id="5217312">2</span><span class="op" id="5217313">]</span><span class="op" id="5217314">,</span>&nbsp;<span class="num" id="5217316">0xff</span><span class="op" id="5217320">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5217324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217328">for</span>&nbsp;<span class="ident" id="5217332">i</span>&nbsp;<span class="op" id="5217334">:=</span>&nbsp;<span class="ident" id="5217337">np</span><span class="op" id="5217339">;</span>&nbsp;<span class="ident" id="5217341">i</span>&nbsp;<span class="op" id="5217343">&lt;</span>&nbsp;<span class="num" id="5217345">256</span><span class="op" id="5217348">;</span>&nbsp;<span class="ident" id="5217350">i</span><span class="op" id="5217351">++</span>&nbsp;<span class="op" id="5217354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5217359">//&nbsp;Initialize&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;palette&nbsp;to&nbsp;opaque&nbsp;black.&nbsp;The&nbsp;spec&nbsp;(section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5217435">//&nbsp;11.2.3)&nbsp;says&nbsp;that&nbsp;&#34;any&nbsp;out-of-range&nbsp;pixel&nbsp;value&nbsp;found&nbsp;in&nbsp;the&nbsp;image&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5217513">//&nbsp;is&nbsp;an&nbsp;error&#34;,&nbsp;but&nbsp;some&nbsp;real-world&nbsp;PNG&nbsp;files&nbsp;have&nbsp;out-of-range&nbsp;pixel</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5217587">//&nbsp;values.&nbsp;We&nbsp;fall&nbsp;back&nbsp;to&nbsp;opaque&nbsp;black,&nbsp;the&nbsp;same&nbsp;as&nbsp;libpng&nbsp;1.5.13;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5217658">//&nbsp;ImageMagick&nbsp;6.5.7&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217700">d</span><span class="op" id="5217701">.</span><span class="ident" id="5217702">palette</span><span class="op" id="5217709">[</span><span class="ident" id="5217710">i</span><span class="op" id="5217711">]</span>&nbsp;<span class="op" id="5217713">=</span>&nbsp;<span class="ident" id="5217715">color</span><span class="op" id="5217720">.</span><span class="ident" id="5217721">RGBA</span><span class="op" id="5217725">{</span><span class="num" id="5217726">0x00</span><span class="op" id="5217730">,</span>&nbsp;<span class="num" id="5217732">0x00</span><span class="op" id="5217736">,</span>&nbsp;<span class="num" id="5217738">0x00</span><span class="op" id="5217742">,</span>&nbsp;<span class="num" id="5217744">0xff</span><span class="op" id="5217748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5217752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217756">d</span><span class="op" id="5217757">.</span><span class="ident" id="5217758">palette</span>&nbsp;<span class="op" id="5217766">=</span>&nbsp;<span class="ident" id="5217768">d</span><span class="op" id="5217769">.</span><span class="ident" id="5217770">palette</span><span class="op" id="5217777">[</span><span class="op" id="5217778">:</span><span class="ident" id="5217779">np</span><span class="op" id="5217781">]</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217784">case</span>&nbsp;<span class="ident" id="5217789">cbTC8</span><span class="op" id="5217794">,</span>&nbsp;<span class="ident" id="5217796">cbTCA8</span><span class="op" id="5217802">,</span>&nbsp;<span class="ident" id="5217804">cbTC16</span><span class="op" id="5217810">,</span>&nbsp;<span class="ident" id="5217812">cbTCA16</span><span class="op" id="5217819">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5217823">//&nbsp;As&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec,&nbsp;a&nbsp;PLTE&nbsp;chunk&nbsp;is&nbsp;optional&nbsp;(and&nbsp;for&nbsp;practical&nbsp;purposes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5217903">//&nbsp;ignorable)&nbsp;for&nbsp;the&nbsp;ctTrueColor&nbsp;and&nbsp;ctTrueColorAlpha&nbsp;color&nbsp;types&nbsp;(section&nbsp;4.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217988">default</span><span class="op" id="5217995">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217999">return</span>&nbsp;<span class="ident" id="5218006">FormatError</span><span class="op" id="5218017">(</span><span class="string" id="5218018">&#34;PLTE,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="5218045">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5218048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218051">return</span>&nbsp;<span class="ident" id="5218058">d</span><span class="op" id="5218059">.</span><span class="ident" id="5218060">verifyChecksum</span><span class="op" id="5218074">(</span><span class="op" id="5218075">)</span><br>
<span class="lineno"></span><span class="op" id="5218077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5218080">func</span>&nbsp;<span class="op" id="5218085">(</span><span class="ident" id="5218086">d</span>&nbsp;<span class="op" id="5218088">*</span><span class="ident" id="5218089">decoder</span><span class="op" id="5218096">)</span>&nbsp;<span class="ident" id="5218098">parsetRNS</span><span class="op" id="5218107">(</span><span class="ident" id="5218108">length</span>&nbsp;<span class="builtintype" id="5218115">uint32</span><span class="op" id="5218121">)</span>&nbsp;<span class="builtintype" id="5218123">error</span>&nbsp;<span class="op" id="5218129">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218132">if</span>&nbsp;<span class="ident" id="5218135">length</span>&nbsp;<span class="op" id="5218142">&gt;</span>&nbsp;<span class="num" id="5218144">256</span>&nbsp;<span class="op" id="5218148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218152">return</span>&nbsp;<span class="ident" id="5218159">FormatError</span><span class="op" id="5218170">(</span><span class="string" id="5218171">&#34;bad&nbsp;tRNS&nbsp;length&#34;</span><span class="op" id="5218188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5218191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218194">n</span><span class="op" id="5218195">,</span>&nbsp;<span class="ident" id="5218197">err</span>&nbsp;<span class="op" id="5218201">:=</span>&nbsp;<span class="ident" id="5218204">io</span><span class="op" id="5218206">.</span><span class="ident" id="5218207">ReadFull</span><span class="op" id="5218215">(</span><span class="ident" id="5218216">d</span><span class="op" id="5218217">.</span><span class="ident" id="5218218">r</span><span class="op" id="5218219">,</span>&nbsp;<span class="ident" id="5218221">d</span><span class="op" id="5218222">.</span><span class="ident" id="5218223">tmp</span><span class="op" id="5218226">[</span><span class="op" id="5218227">:</span><span class="ident" id="5218228">length</span><span class="op" id="5218234">]</span><span class="op" id="5218235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218238">if</span>&nbsp;<span class="ident" id="5218241">err</span>&nbsp;<span class="op" id="5218245">!=</span>&nbsp;<span class="builtintype" id="5218248">nil</span>&nbsp;<span class="op" id="5218252">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218256">return</span>&nbsp;<span class="ident" id="5218263">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5218268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218271">d</span><span class="op" id="5218272">.</span><span class="ident" id="5218273">crc</span><span class="op" id="5218276">.</span><span class="ident" id="5218277">Write</span><span class="op" id="5218282">(</span><span class="ident" id="5218283">d</span><span class="op" id="5218284">.</span><span class="ident" id="5218285">tmp</span><span class="op" id="5218288">[</span><span class="op" id="5218289">:</span><span class="ident" id="5218290">n</span><span class="op" id="5218291">]</span><span class="op" id="5218292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218295">switch</span>&nbsp;<span class="ident" id="5218302">d</span><span class="op" id="5218303">.</span><span class="ident" id="5218304">cb</span>&nbsp;<span class="op" id="5218307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218310">case</span>&nbsp;<span class="ident" id="5218315">cbG8</span><span class="op" id="5218319">,</span>&nbsp;<span class="ident" id="5218321">cbG16</span><span class="op" id="5218326">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218330">return</span>&nbsp;<span class="ident" id="5218337">UnsupportedError</span><span class="op" id="5218353">(</span><span class="string" id="5218354">&#34;grayscale&nbsp;transparency&#34;</span><span class="op" id="5218378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218381">case</span>&nbsp;<span class="ident" id="5218386">cbTC8</span><span class="op" id="5218391">,</span>&nbsp;<span class="ident" id="5218393">cbTC16</span><span class="op" id="5218399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218403">return</span>&nbsp;<span class="ident" id="5218410">UnsupportedError</span><span class="op" id="5218426">(</span><span class="string" id="5218427">&#34;truecolor&nbsp;transparency&#34;</span><span class="op" id="5218451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218454">case</span>&nbsp;<span class="ident" id="5218459">cbP1</span><span class="op" id="5218463">,</span>&nbsp;<span class="ident" id="5218465">cbP2</span><span class="op" id="5218469">,</span>&nbsp;<span class="ident" id="5218471">cbP4</span><span class="op" id="5218475">,</span>&nbsp;<span class="ident" id="5218477">cbP8</span><span class="op" id="5218481">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218485">if</span>&nbsp;<span class="builtinfunc" id="5218488">len</span><span class="op" id="5218491">(</span><span class="ident" id="5218492">d</span><span class="op" id="5218493">.</span><span class="ident" id="5218494">palette</span><span class="op" id="5218501">)</span>&nbsp;<span class="op" id="5218503">&lt;</span>&nbsp;<span class="ident" id="5218505">n</span>&nbsp;<span class="op" id="5218507">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218512">d</span><span class="op" id="5218513">.</span><span class="ident" id="5218514">palette</span>&nbsp;<span class="op" id="5218522">=</span>&nbsp;<span class="ident" id="5218524">d</span><span class="op" id="5218525">.</span><span class="ident" id="5218526">palette</span><span class="op" id="5218533">[</span><span class="op" id="5218534">:</span><span class="ident" id="5218535">n</span><span class="op" id="5218536">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5218540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218544">for</span>&nbsp;<span class="ident" id="5218548">i</span>&nbsp;<span class="op" id="5218550">:=</span>&nbsp;<span class="num" id="5218553">0</span><span class="op" id="5218554">;</span>&nbsp;<span class="ident" id="5218556">i</span>&nbsp;<span class="op" id="5218558">&lt;</span>&nbsp;<span class="ident" id="5218560">n</span><span class="op" id="5218561">;</span>&nbsp;<span class="ident" id="5218563">i</span><span class="op" id="5218564">++</span>&nbsp;<span class="op" id="5218567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218572">rgba</span>&nbsp;<span class="op" id="5218577">:=</span>&nbsp;<span class="ident" id="5218580">d</span><span class="op" id="5218581">.</span><span class="ident" id="5218582">palette</span><span class="op" id="5218589">[</span><span class="ident" id="5218590">i</span><span class="op" id="5218591">]</span><span class="op" id="5218592">.</span><span class="op" id="5218593">(</span><span class="ident" id="5218594">color</span><span class="op" id="5218599">.</span><span class="ident" id="5218600">RGBA</span><span class="op" id="5218604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218609">d</span><span class="op" id="5218610">.</span><span class="ident" id="5218611">palette</span><span class="op" id="5218618">[</span><span class="ident" id="5218619">i</span><span class="op" id="5218620">]</span>&nbsp;<span class="op" id="5218622">=</span>&nbsp;<span class="ident" id="5218624">color</span><span class="op" id="5218629">.</span><span class="ident" id="5218630">NRGBA</span><span class="op" id="5218635">{</span><span class="ident" id="5218636">rgba</span><span class="op" id="5218640">.</span><span class="ident" id="5218641">R</span><span class="op" id="5218642">,</span>&nbsp;<span class="ident" id="5218644">rgba</span><span class="op" id="5218648">.</span><span class="ident" id="5218649">G</span><span class="op" id="5218650">,</span>&nbsp;<span class="ident" id="5218652">rgba</span><span class="op" id="5218656">.</span><span class="ident" id="5218657">B</span><span class="op" id="5218658">,</span>&nbsp;<span class="ident" id="5218660">d</span><span class="op" id="5218661">.</span><span class="ident" id="5218662">tmp</span><span class="op" id="5218665">[</span><span class="ident" id="5218666">i</span><span class="op" id="5218667">]</span><span class="op" id="5218668">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5218672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218675">case</span>&nbsp;<span class="ident" id="5218680">cbGA8</span><span class="op" id="5218685">,</span>&nbsp;<span class="ident" id="5218687">cbGA16</span><span class="op" id="5218693">,</span>&nbsp;<span class="ident" id="5218695">cbTCA8</span><span class="op" id="5218701">,</span>&nbsp;<span class="ident" id="5218703">cbTCA16</span><span class="op" id="5218710">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218714">return</span>&nbsp;<span class="ident" id="5218721">FormatError</span><span class="op" id="5218732">(</span><span class="string" id="5218733">&#34;tRNS,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="5218760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5218763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218766">return</span>&nbsp;<span class="ident" id="5218773">d</span><span class="op" id="5218774">.</span><span class="ident" id="5218775">verifyChecksum</span><span class="op" id="5218789">(</span><span class="op" id="5218790">)</span><br>
<span class="lineno">275</span><span class="op" id="5218792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5218795">//&nbsp;Read&nbsp;presents&nbsp;one&nbsp;or&nbsp;more&nbsp;IDAT&nbsp;chunks&nbsp;as&nbsp;one&nbsp;continuous&nbsp;stream&nbsp;(minus&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5218872">//&nbsp;intermediate&nbsp;chunk&nbsp;headers&nbsp;and&nbsp;footers).&nbsp;If&nbsp;the&nbsp;PNG&nbsp;data&nbsp;looked&nbsp;like:</span><br>
<span class="lineno"></span><span class="comment" id="5218945">//&nbsp;&nbsp;&nbsp;...&nbsp;len0&nbsp;IDAT&nbsp;xxx&nbsp;crc0&nbsp;len1&nbsp;IDAT&nbsp;yy&nbsp;crc1&nbsp;len2&nbsp;IEND&nbsp;crc2</span><br>
<span class="lineno">280</span><span class="comment" id="5219006">//&nbsp;then&nbsp;this&nbsp;reader&nbsp;presents&nbsp;xxxyy.&nbsp;For&nbsp;well-formed&nbsp;PNG&nbsp;data,&nbsp;the&nbsp;decoder&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="5219086">//&nbsp;immediately&nbsp;before&nbsp;the&nbsp;first&nbsp;Read&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5219166">//&nbsp;first&nbsp;IDAT&nbsp;and&nbsp;xxx,&nbsp;and&nbsp;the&nbsp;decoder&nbsp;state&nbsp;immediately&nbsp;after&nbsp;the&nbsp;last&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="5219243">//&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;yy&nbsp;and&nbsp;crc1.</span><br>
<span class="lineno"></span><span class="keyword" id="5219298">func</span>&nbsp;<span class="op" id="5219303">(</span><span class="ident" id="5219304">d</span>&nbsp;<span class="op" id="5219306">*</span><span class="ident" id="5219307">decoder</span><span class="op" id="5219314">)</span>&nbsp;<span class="ident" id="5219316">Read</span><span class="op" id="5219320">(</span><span class="ident" id="5219321">p</span>&nbsp;<span class="op" id="5219323">[</span><span class="op" id="5219324">]</span><span class="builtintype" id="5219325">byte</span><span class="op" id="5219329">)</span>&nbsp;<span class="op" id="5219331">(</span><span class="builtintype" id="5219332">int</span><span class="op" id="5219335">,</span>&nbsp;<span class="builtintype" id="5219337">error</span><span class="op" id="5219342">)</span>&nbsp;<span class="op" id="5219344">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219347">if</span>&nbsp;<span class="builtinfunc" id="5219350">len</span><span class="op" id="5219353">(</span><span class="ident" id="5219354">p</span><span class="op" id="5219355">)</span>&nbsp;<span class="op" id="5219357">==</span>&nbsp;<span class="num" id="5219360">0</span>&nbsp;<span class="op" id="5219362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219366">return</span>&nbsp;<span class="num" id="5219373">0</span><span class="op" id="5219374">,</span>&nbsp;<span class="builtintype" id="5219376">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5219381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219384">for</span>&nbsp;<span class="ident" id="5219388">d</span><span class="op" id="5219389">.</span><span class="ident" id="5219390">idatLength</span>&nbsp;<span class="op" id="5219401">==</span>&nbsp;<span class="num" id="5219404">0</span>&nbsp;<span class="op" id="5219406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5219410">//&nbsp;We&nbsp;have&nbsp;exhausted&nbsp;an&nbsp;IDAT&nbsp;chunk.&nbsp;Verify&nbsp;the&nbsp;checksum&nbsp;of&nbsp;that&nbsp;chunk.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219483">if</span>&nbsp;<span class="ident" id="5219486">err</span>&nbsp;<span class="op" id="5219490">:=</span>&nbsp;<span class="ident" id="5219493">d</span><span class="op" id="5219494">.</span><span class="ident" id="5219495">verifyChecksum</span><span class="op" id="5219509">(</span><span class="op" id="5219510">)</span><span class="op" id="5219511">;</span>&nbsp;<span class="ident" id="5219513">err</span>&nbsp;<span class="op" id="5219517">!=</span>&nbsp;<span class="builtintype" id="5219520">nil</span>&nbsp;<span class="op" id="5219524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219529">return</span>&nbsp;<span class="num" id="5219536">0</span><span class="op" id="5219537">,</span>&nbsp;<span class="ident" id="5219539">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5219545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5219549">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type&nbsp;of&nbsp;the&nbsp;next&nbsp;chunk,&nbsp;and&nbsp;check&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5219619">//&nbsp;it&nbsp;is&nbsp;an&nbsp;IDAT&nbsp;chunk.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219645">if</span>&nbsp;<span class="ident" id="5219648">_</span><span class="op" id="5219649">,</span>&nbsp;<span class="ident" id="5219651">err</span>&nbsp;<span class="op" id="5219655">:=</span>&nbsp;<span class="ident" id="5219658">io</span><span class="op" id="5219660">.</span><span class="ident" id="5219661">ReadFull</span><span class="op" id="5219669">(</span><span class="ident" id="5219670">d</span><span class="op" id="5219671">.</span><span class="ident" id="5219672">r</span><span class="op" id="5219673">,</span>&nbsp;<span class="ident" id="5219675">d</span><span class="op" id="5219676">.</span><span class="ident" id="5219677">tmp</span><span class="op" id="5219680">[</span><span class="op" id="5219681">:</span><span class="num" id="5219682">8</span><span class="op" id="5219683">]</span><span class="op" id="5219684">)</span><span class="op" id="5219685">;</span>&nbsp;<span class="ident" id="5219687">err</span>&nbsp;<span class="op" id="5219691">!=</span>&nbsp;<span class="builtintype" id="5219694">nil</span>&nbsp;<span class="op" id="5219698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219703">return</span>&nbsp;<span class="num" id="5219710">0</span><span class="op" id="5219711">,</span>&nbsp;<span class="ident" id="5219713">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5219719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219723">d</span><span class="op" id="5219724">.</span><span class="ident" id="5219725">idatLength</span>&nbsp;<span class="op" id="5219736">=</span>&nbsp;<span class="ident" id="5219738">binary</span><span class="op" id="5219744">.</span><span class="ident" id="5219745">BigEndian</span><span class="op" id="5219754">.</span><span class="ident" id="5219755">Uint32</span><span class="op" id="5219761">(</span><span class="ident" id="5219762">d</span><span class="op" id="5219763">.</span><span class="ident" id="5219764">tmp</span><span class="op" id="5219767">[</span><span class="op" id="5219768">:</span><span class="num" id="5219769">4</span><span class="op" id="5219770">]</span><span class="op" id="5219771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219775">if</span>&nbsp;<span class="builtintype" id="5219778">string</span><span class="op" id="5219784">(</span><span class="ident" id="5219785">d</span><span class="op" id="5219786">.</span><span class="ident" id="5219787">tmp</span><span class="op" id="5219790">[</span><span class="num" id="5219791">4</span><span class="op" id="5219792">:</span><span class="num" id="5219793">8</span><span class="op" id="5219794">]</span><span class="op" id="5219795">)</span>&nbsp;<span class="op" id="5219797">!=</span>&nbsp;<span class="string" id="5219800">&#34;IDAT&#34;</span>&nbsp;<span class="op" id="5219807">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219812">return</span>&nbsp;<span class="num" id="5219819">0</span><span class="op" id="5219820">,</span>&nbsp;<span class="ident" id="5219822">FormatError</span><span class="op" id="5219833">(</span><span class="string" id="5219834">&#34;not&nbsp;enough&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="5219857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5219861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219865">d</span><span class="op" id="5219866">.</span><span class="ident" id="5219867">crc</span><span class="op" id="5219870">.</span><span class="ident" id="5219871">Reset</span><span class="op" id="5219876">(</span><span class="op" id="5219877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219881">d</span><span class="op" id="5219882">.</span><span class="ident" id="5219883">crc</span><span class="op" id="5219886">.</span><span class="ident" id="5219887">Write</span><span class="op" id="5219892">(</span><span class="ident" id="5219893">d</span><span class="op" id="5219894">.</span><span class="ident" id="5219895">tmp</span><span class="op" id="5219898">[</span><span class="num" id="5219899">4</span><span class="op" id="5219900">:</span><span class="num" id="5219901">8</span><span class="op" id="5219902">]</span><span class="op" id="5219903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5219906">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219909">if</span>&nbsp;<span class="builtintype" id="5219912">int</span><span class="op" id="5219915">(</span><span class="ident" id="5219916">d</span><span class="op" id="5219917">.</span><span class="ident" id="5219918">idatLength</span><span class="op" id="5219928">)</span>&nbsp;<span class="op" id="5219930">&lt;</span>&nbsp;<span class="num" id="5219932">0</span>&nbsp;<span class="op" id="5219934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219938">return</span>&nbsp;<span class="num" id="5219945">0</span><span class="op" id="5219946">,</span>&nbsp;<span class="ident" id="5219948">UnsupportedError</span><span class="op" id="5219964">(</span><span class="string" id="5219965">&#34;IDAT&nbsp;chunk&nbsp;length&nbsp;overflow&#34;</span><span class="op" id="5219993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5219996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219999">n</span><span class="op" id="5220000">,</span>&nbsp;<span class="ident" id="5220002">err</span>&nbsp;<span class="op" id="5220006">:=</span>&nbsp;<span class="ident" id="5220009">d</span><span class="op" id="5220010">.</span><span class="ident" id="5220011">r</span><span class="op" id="5220012">.</span><span class="ident" id="5220013">Read</span><span class="op" id="5220017">(</span><span class="ident" id="5220018">p</span><span class="op" id="5220019">[</span><span class="op" id="5220020">:</span><span class="ident" id="5220021">min</span><span class="op" id="5220024">(</span><span class="builtinfunc" id="5220025">len</span><span class="op" id="5220028">(</span><span class="ident" id="5220029">p</span><span class="op" id="5220030">)</span><span class="op" id="5220031">,</span>&nbsp;<span class="builtintype" id="5220033">int</span><span class="op" id="5220036">(</span><span class="ident" id="5220037">d</span><span class="op" id="5220038">.</span><span class="ident" id="5220039">idatLength</span><span class="op" id="5220049">)</span><span class="op" id="5220050">)</span><span class="op" id="5220051">]</span><span class="op" id="5220052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220055">d</span><span class="op" id="5220056">.</span><span class="ident" id="5220057">crc</span><span class="op" id="5220060">.</span><span class="ident" id="5220061">Write</span><span class="op" id="5220066">(</span><span class="ident" id="5220067">p</span><span class="op" id="5220068">[</span><span class="op" id="5220069">:</span><span class="ident" id="5220070">n</span><span class="op" id="5220071">]</span><span class="op" id="5220072">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220075">d</span><span class="op" id="5220076">.</span><span class="ident" id="5220077">idatLength</span>&nbsp;<span class="op" id="5220088">-=</span>&nbsp;<span class="builtintype" id="5220091">uint32</span><span class="op" id="5220097">(</span><span class="ident" id="5220098">n</span><span class="op" id="5220099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220102">return</span>&nbsp;<span class="ident" id="5220109">n</span><span class="op" id="5220110">,</span>&nbsp;<span class="ident" id="5220112">err</span><br>
<span class="lineno"></span><span class="op" id="5220116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5220119">//&nbsp;decode&nbsp;decodes&nbsp;the&nbsp;IDAT&nbsp;data&nbsp;into&nbsp;an&nbsp;image.</span><br>
<span class="lineno">315</span><span class="keyword" id="5220166">func</span>&nbsp;<span class="op" id="5220171">(</span><span class="ident" id="5220172">d</span>&nbsp;<span class="op" id="5220174">*</span><span class="ident" id="5220175">decoder</span><span class="op" id="5220182">)</span>&nbsp;<span class="ident" id="5220184">decode</span><span class="op" id="5220190">(</span><span class="op" id="5220191">)</span>&nbsp;<span class="op" id="5220193">(</span><span class="ident" id="5220194">image</span><span class="op" id="5220199">.</span><span class="ident" id="5220200">Image</span><span class="op" id="5220205">,</span>&nbsp;<span class="builtintype" id="5220207">error</span><span class="op" id="5220212">)</span>&nbsp;<span class="op" id="5220214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220217">r</span><span class="op" id="5220218">,</span>&nbsp;<span class="ident" id="5220220">err</span>&nbsp;<span class="op" id="5220224">:=</span>&nbsp;<span class="ident" id="5220227">zlib</span><span class="op" id="5220231">.</span><span class="ident" id="5220232">NewReader</span><span class="op" id="5220241">(</span><span class="ident" id="5220242">d</span><span class="op" id="5220243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220246">if</span>&nbsp;<span class="ident" id="5220249">err</span>&nbsp;<span class="op" id="5220253">!=</span>&nbsp;<span class="builtintype" id="5220256">nil</span>&nbsp;<span class="op" id="5220260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220264">return</span>&nbsp;<span class="builtintype" id="5220271">nil</span><span class="op" id="5220274">,</span>&nbsp;<span class="ident" id="5220276">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5220281">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220284">defer</span>&nbsp;<span class="ident" id="5220290">r</span><span class="op" id="5220291">.</span><span class="ident" id="5220292">Close</span><span class="op" id="5220297">(</span><span class="op" id="5220298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220301">var</span>&nbsp;<span class="ident" id="5220305">img</span>&nbsp;<span class="ident" id="5220309">image</span><span class="op" id="5220314">.</span><span class="ident" id="5220315">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220322">if</span>&nbsp;<span class="ident" id="5220325">d</span><span class="op" id="5220326">.</span><span class="ident" id="5220327">interlace</span>&nbsp;<span class="op" id="5220337">==</span>&nbsp;<span class="ident" id="5220340">itNone</span>&nbsp;<span class="op" id="5220347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220351">img</span><span class="op" id="5220354">,</span>&nbsp;<span class="ident" id="5220356">err</span>&nbsp;<span class="op" id="5220360">=</span>&nbsp;<span class="ident" id="5220362">d</span><span class="op" id="5220363">.</span><span class="ident" id="5220364">readImagePass</span><span class="op" id="5220377">(</span><span class="ident" id="5220378">r</span><span class="op" id="5220379">,</span>&nbsp;<span class="num" id="5220381">0</span><span class="op" id="5220382">,</span>&nbsp;<span class="builtintype" id="5220384">false</span><span class="op" id="5220389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5220392">}</span>&nbsp;<span class="keyword" id="5220394">else</span>&nbsp;<span class="keyword" id="5220399">if</span>&nbsp;<span class="ident" id="5220402">d</span><span class="op" id="5220403">.</span><span class="ident" id="5220404">interlace</span>&nbsp;<span class="op" id="5220414">==</span>&nbsp;<span class="ident" id="5220417">itAdam7</span>&nbsp;<span class="op" id="5220425">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5220429">//&nbsp;Allocate&nbsp;a&nbsp;blank&nbsp;image&nbsp;of&nbsp;the&nbsp;full&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220475">img</span><span class="op" id="5220478">,</span>&nbsp;<span class="ident" id="5220480">err</span>&nbsp;<span class="op" id="5220484">=</span>&nbsp;<span class="ident" id="5220486">d</span><span class="op" id="5220487">.</span><span class="ident" id="5220488">readImagePass</span><span class="op" id="5220501">(</span><span class="builtintype" id="5220502">nil</span><span class="op" id="5220505">,</span>&nbsp;<span class="num" id="5220507">0</span><span class="op" id="5220508">,</span>&nbsp;<span class="builtintype" id="5220510">true</span><span class="op" id="5220514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220518">for</span>&nbsp;<span class="ident" id="5220522">pass</span>&nbsp;<span class="op" id="5220527">:=</span>&nbsp;<span class="num" id="5220530">0</span><span class="op" id="5220531">;</span>&nbsp;<span class="ident" id="5220533">pass</span>&nbsp;<span class="op" id="5220538">&lt;</span>&nbsp;<span class="num" id="5220540">7</span><span class="op" id="5220541">;</span>&nbsp;<span class="ident" id="5220543">pass</span><span class="op" id="5220547">++</span>&nbsp;<span class="op" id="5220550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220555">imagePass</span><span class="op" id="5220564">,</span>&nbsp;<span class="ident" id="5220566">err</span>&nbsp;<span class="op" id="5220570">:=</span>&nbsp;<span class="ident" id="5220573">d</span><span class="op" id="5220574">.</span><span class="ident" id="5220575">readImagePass</span><span class="op" id="5220588">(</span><span class="ident" id="5220589">r</span><span class="op" id="5220590">,</span>&nbsp;<span class="ident" id="5220592">pass</span><span class="op" id="5220596">,</span>&nbsp;<span class="builtintype" id="5220598">false</span><span class="op" id="5220603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220608">if</span>&nbsp;<span class="ident" id="5220611">err</span>&nbsp;<span class="op" id="5220615">!=</span>&nbsp;<span class="builtintype" id="5220618">nil</span>&nbsp;<span class="op" id="5220622">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220628">return</span>&nbsp;<span class="builtintype" id="5220635">nil</span><span class="op" id="5220638">,</span>&nbsp;<span class="ident" id="5220640">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5220647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220652">d</span><span class="op" id="5220653">.</span><span class="ident" id="5220654">mergePassInto</span><span class="op" id="5220667">(</span><span class="ident" id="5220668">img</span><span class="op" id="5220671">,</span>&nbsp;<span class="ident" id="5220673">imagePass</span><span class="op" id="5220682">,</span>&nbsp;<span class="ident" id="5220684">pass</span><span class="op" id="5220688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5220692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5220695">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5220699">//&nbsp;Check&nbsp;for&nbsp;EOF,&nbsp;to&nbsp;verify&nbsp;the&nbsp;zlib&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220747">n</span>&nbsp;<span class="op" id="5220749">:=</span>&nbsp;<span class="num" id="5220752">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220755">for</span>&nbsp;<span class="ident" id="5220759">i</span>&nbsp;<span class="op" id="5220761">:=</span>&nbsp;<span class="num" id="5220764">0</span><span class="op" id="5220765">;</span>&nbsp;<span class="ident" id="5220767">n</span>&nbsp;<span class="op" id="5220769">==</span>&nbsp;<span class="num" id="5220772">0</span>&nbsp;<span class="op" id="5220774">&amp;&amp;</span>&nbsp;<span class="ident" id="5220777">err</span>&nbsp;<span class="op" id="5220781">==</span>&nbsp;<span class="builtintype" id="5220784">nil</span><span class="op" id="5220787">;</span>&nbsp;<span class="ident" id="5220789">i</span><span class="op" id="5220790">++</span>&nbsp;<span class="op" id="5220793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220797">if</span>&nbsp;<span class="ident" id="5220800">i</span>&nbsp;<span class="op" id="5220802">==</span>&nbsp;<span class="num" id="5220805">100</span>&nbsp;<span class="op" id="5220809">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220814">return</span>&nbsp;<span class="builtintype" id="5220821">nil</span><span class="op" id="5220824">,</span>&nbsp;<span class="ident" id="5220826">io</span><span class="op" id="5220828">.</span><span class="ident" id="5220829">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5220845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220849">n</span><span class="op" id="5220850">,</span>&nbsp;<span class="ident" id="5220852">err</span>&nbsp;<span class="op" id="5220856">=</span>&nbsp;<span class="ident" id="5220858">r</span><span class="op" id="5220859">.</span><span class="ident" id="5220860">Read</span><span class="op" id="5220864">(</span><span class="ident" id="5220865">d</span><span class="op" id="5220866">.</span><span class="ident" id="5220867">tmp</span><span class="op" id="5220870">[</span><span class="op" id="5220871">:</span><span class="num" id="5220872">1</span><span class="op" id="5220873">]</span><span class="op" id="5220874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5220877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220880">if</span>&nbsp;<span class="ident" id="5220883">err</span>&nbsp;<span class="op" id="5220887">!=</span>&nbsp;<span class="builtintype" id="5220890">nil</span>&nbsp;<span class="op" id="5220894">&amp;&amp;</span>&nbsp;<span class="ident" id="5220897">err</span>&nbsp;<span class="op" id="5220901">!=</span>&nbsp;<span class="ident" id="5220904">io</span><span class="op" id="5220906">.</span><span class="ident" id="5220907">EOF</span>&nbsp;<span class="op" id="5220911">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220915">return</span>&nbsp;<span class="builtintype" id="5220922">nil</span><span class="op" id="5220925">,</span>&nbsp;<span class="ident" id="5220927">FormatError</span><span class="op" id="5220938">(</span><span class="ident" id="5220939">err</span><span class="op" id="5220942">.</span><span class="ident" id="5220943">Error</span><span class="op" id="5220948">(</span><span class="op" id="5220949">)</span><span class="op" id="5220950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5220953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220956">if</span>&nbsp;<span class="ident" id="5220959">n</span>&nbsp;<span class="op" id="5220961">!=</span>&nbsp;<span class="num" id="5220964">0</span>&nbsp;<span class="op" id="5220966">||</span>&nbsp;<span class="ident" id="5220969">d</span><span class="op" id="5220970">.</span><span class="ident" id="5220971">idatLength</span>&nbsp;<span class="op" id="5220982">!=</span>&nbsp;<span class="num" id="5220985">0</span>&nbsp;<span class="op" id="5220987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220991">return</span>&nbsp;<span class="builtintype" id="5220998">nil</span><span class="op" id="5221001">,</span>&nbsp;<span class="ident" id="5221003">FormatError</span><span class="op" id="5221014">(</span><span class="string" id="5221015">&#34;too&nbsp;much&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="5221036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221039">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221043">return</span>&nbsp;<span class="ident" id="5221050">img</span><span class="op" id="5221053">,</span>&nbsp;<span class="builtintype" id="5221055">nil</span><br>
<span class="lineno"></span><span class="op" id="5221059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5221062">//&nbsp;readImagePass&nbsp;reads&nbsp;a&nbsp;single&nbsp;image&nbsp;pass,&nbsp;sized&nbsp;according&nbsp;to&nbsp;the&nbsp;pass&nbsp;number.</span><br>
<span class="lineno">355</span><span class="keyword" id="5221142">func</span>&nbsp;<span class="op" id="5221147">(</span><span class="ident" id="5221148">d</span>&nbsp;<span class="op" id="5221150">*</span><span class="ident" id="5221151">decoder</span><span class="op" id="5221158">)</span>&nbsp;<span class="ident" id="5221160">readImagePass</span><span class="op" id="5221173">(</span><span class="ident" id="5221174">r</span>&nbsp;<span class="ident" id="5221176">io</span><span class="op" id="5221178">.</span><span class="ident" id="5221179">Reader</span><span class="op" id="5221185">,</span>&nbsp;<span class="ident" id="5221187">pass</span>&nbsp;<span class="builtintype" id="5221192">int</span><span class="op" id="5221195">,</span>&nbsp;<span class="ident" id="5221197">allocateOnly</span>&nbsp;<span class="builtintype" id="5221210">bool</span><span class="op" id="5221214">)</span>&nbsp;<span class="op" id="5221216">(</span><span class="ident" id="5221217">image</span><span class="op" id="5221222">.</span><span class="ident" id="5221223">Image</span><span class="op" id="5221228">,</span>&nbsp;<span class="builtintype" id="5221230">error</span><span class="op" id="5221235">)</span>&nbsp;<span class="op" id="5221237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221240">var</span>&nbsp;<span class="ident" id="5221244">bitsPerPixel</span>&nbsp;<span class="builtintype" id="5221257">int</span>&nbsp;<span class="op" id="5221261">=</span>&nbsp;<span class="num" id="5221263">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221266">pixOffset</span>&nbsp;<span class="op" id="5221276">:=</span>&nbsp;<span class="num" id="5221279">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221282">var</span>&nbsp;<span class="op" id="5221286">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221290">gray</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221299">*</span><span class="ident" id="5221300">image</span><span class="op" id="5221305">.</span><span class="ident" id="5221306">Gray</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221313">rgba</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221322">*</span><span class="ident" id="5221323">image</span><span class="op" id="5221328">.</span><span class="ident" id="5221329">RGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221336">paletted</span>&nbsp;<span class="op" id="5221345">*</span><span class="ident" id="5221346">image</span><span class="op" id="5221351">.</span><span class="ident" id="5221352">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221363">nrgba</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221372">*</span><span class="ident" id="5221373">image</span><span class="op" id="5221378">.</span><span class="ident" id="5221379">NRGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221387">gray16</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5221396">*</span><span class="ident" id="5221397">image</span><span class="op" id="5221402">.</span><span class="ident" id="5221403">Gray16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221412">rgba64</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5221421">*</span><span class="ident" id="5221422">image</span><span class="op" id="5221427">.</span><span class="ident" id="5221428">RGBA64</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221437">nrgba64</span>&nbsp;&nbsp;<span class="op" id="5221446">*</span><span class="ident" id="5221447">image</span><span class="op" id="5221452">.</span><span class="ident" id="5221453">NRGBA64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221463">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221472">image</span><span class="op" id="5221477">.</span><span class="ident" id="5221478">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221488">width</span><span class="op" id="5221493">,</span>&nbsp;<span class="ident" id="5221495">height</span>&nbsp;<span class="op" id="5221502">:=</span>&nbsp;<span class="ident" id="5221505">d</span><span class="op" id="5221506">.</span><span class="ident" id="5221507">width</span><span class="op" id="5221512">,</span>&nbsp;<span class="ident" id="5221514">d</span><span class="op" id="5221515">.</span><span class="ident" id="5221516">height</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221524">if</span>&nbsp;<span class="ident" id="5221527">d</span><span class="op" id="5221528">.</span><span class="ident" id="5221529">interlace</span>&nbsp;<span class="op" id="5221539">==</span>&nbsp;<span class="ident" id="5221542">itAdam7</span>&nbsp;<span class="op" id="5221550">&amp;&amp;</span>&nbsp;<span class="op" id="5221553">!</span><span class="ident" id="5221554">allocateOnly</span>&nbsp;<span class="op" id="5221567">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221571">p</span>&nbsp;<span class="op" id="5221573">:=</span>&nbsp;<span class="ident" id="5221576">interlacing</span><span class="op" id="5221587">[</span><span class="ident" id="5221588">pass</span><span class="op" id="5221592">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5221596">//&nbsp;Add&nbsp;the&nbsp;multiplication&nbsp;factor&nbsp;and&nbsp;subtract&nbsp;one,&nbsp;effectively&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221674">width</span>&nbsp;<span class="op" id="5221680">=</span>&nbsp;<span class="op" id="5221682">(</span><span class="ident" id="5221683">width</span>&nbsp;<span class="op" id="5221689">-</span>&nbsp;<span class="ident" id="5221691">p</span><span class="op" id="5221692">.</span><span class="ident" id="5221693">xOffset</span>&nbsp;<span class="op" id="5221701">+</span>&nbsp;<span class="ident" id="5221703">p</span><span class="op" id="5221704">.</span><span class="ident" id="5221705">xFactor</span>&nbsp;<span class="op" id="5221713">-</span>&nbsp;<span class="num" id="5221715">1</span><span class="op" id="5221716">)</span>&nbsp;<span class="op" id="5221718">/</span>&nbsp;<span class="ident" id="5221720">p</span><span class="op" id="5221721">.</span><span class="ident" id="5221722">xFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221732">height</span>&nbsp;<span class="op" id="5221739">=</span>&nbsp;<span class="op" id="5221741">(</span><span class="ident" id="5221742">height</span>&nbsp;<span class="op" id="5221749">-</span>&nbsp;<span class="ident" id="5221751">p</span><span class="op" id="5221752">.</span><span class="ident" id="5221753">yOffset</span>&nbsp;<span class="op" id="5221761">+</span>&nbsp;<span class="ident" id="5221763">p</span><span class="op" id="5221764">.</span><span class="ident" id="5221765">yFactor</span>&nbsp;<span class="op" id="5221773">-</span>&nbsp;<span class="num" id="5221775">1</span><span class="op" id="5221776">)</span>&nbsp;<span class="op" id="5221778">/</span>&nbsp;<span class="ident" id="5221780">p</span><span class="op" id="5221781">.</span><span class="ident" id="5221782">yFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221791">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221794">switch</span>&nbsp;<span class="ident" id="5221801">d</span><span class="op" id="5221802">.</span><span class="ident" id="5221803">cb</span>&nbsp;<span class="op" id="5221806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221809">case</span>&nbsp;<span class="ident" id="5221814">cbG1</span><span class="op" id="5221818">,</span>&nbsp;<span class="ident" id="5221820">cbG2</span><span class="op" id="5221824">,</span>&nbsp;<span class="ident" id="5221826">cbG4</span><span class="op" id="5221830">,</span>&nbsp;<span class="ident" id="5221832">cbG8</span><span class="op" id="5221836">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221840">bitsPerPixel</span>&nbsp;<span class="op" id="5221853">=</span>&nbsp;<span class="ident" id="5221855">d</span><span class="op" id="5221856">.</span><span class="ident" id="5221857">depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221865">gray</span>&nbsp;<span class="op" id="5221870">=</span>&nbsp;<span class="ident" id="5221872">image</span><span class="op" id="5221877">.</span><span class="ident" id="5221878">NewGray</span><span class="op" id="5221885">(</span><span class="ident" id="5221886">image</span><span class="op" id="5221891">.</span><span class="ident" id="5221892">Rect</span><span class="op" id="5221896">(</span><span class="num" id="5221897">0</span><span class="op" id="5221898">,</span>&nbsp;<span class="num" id="5221900">0</span><span class="op" id="5221901">,</span>&nbsp;<span class="ident" id="5221903">width</span><span class="op" id="5221908">,</span>&nbsp;<span class="ident" id="5221910">height</span><span class="op" id="5221916">)</span><span class="op" id="5221917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221921">img</span>&nbsp;<span class="op" id="5221925">=</span>&nbsp;<span class="ident" id="5221927">gray</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221933">case</span>&nbsp;<span class="ident" id="5221938">cbGA8</span><span class="op" id="5221943">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221947">bitsPerPixel</span>&nbsp;<span class="op" id="5221960">=</span>&nbsp;<span class="num" id="5221962">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221967">nrgba</span>&nbsp;<span class="op" id="5221973">=</span>&nbsp;<span class="ident" id="5221975">image</span><span class="op" id="5221980">.</span><span class="ident" id="5221981">NewNRGBA</span><span class="op" id="5221989">(</span><span class="ident" id="5221990">image</span><span class="op" id="5221995">.</span><span class="ident" id="5221996">Rect</span><span class="op" id="5222000">(</span><span class="num" id="5222001">0</span><span class="op" id="5222002">,</span>&nbsp;<span class="num" id="5222004">0</span><span class="op" id="5222005">,</span>&nbsp;<span class="ident" id="5222007">width</span><span class="op" id="5222012">,</span>&nbsp;<span class="ident" id="5222014">height</span><span class="op" id="5222020">)</span><span class="op" id="5222021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222025">img</span>&nbsp;<span class="op" id="5222029">=</span>&nbsp;<span class="ident" id="5222031">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222038">case</span>&nbsp;<span class="ident" id="5222043">cbTC8</span><span class="op" id="5222048">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222052">bitsPerPixel</span>&nbsp;<span class="op" id="5222065">=</span>&nbsp;<span class="num" id="5222067">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222072">rgba</span>&nbsp;<span class="op" id="5222077">=</span>&nbsp;<span class="ident" id="5222079">image</span><span class="op" id="5222084">.</span><span class="ident" id="5222085">NewRGBA</span><span class="op" id="5222092">(</span><span class="ident" id="5222093">image</span><span class="op" id="5222098">.</span><span class="ident" id="5222099">Rect</span><span class="op" id="5222103">(</span><span class="num" id="5222104">0</span><span class="op" id="5222105">,</span>&nbsp;<span class="num" id="5222107">0</span><span class="op" id="5222108">,</span>&nbsp;<span class="ident" id="5222110">width</span><span class="op" id="5222115">,</span>&nbsp;<span class="ident" id="5222117">height</span><span class="op" id="5222123">)</span><span class="op" id="5222124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222128">img</span>&nbsp;<span class="op" id="5222132">=</span>&nbsp;<span class="ident" id="5222134">rgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222140">case</span>&nbsp;<span class="ident" id="5222145">cbP1</span><span class="op" id="5222149">,</span>&nbsp;<span class="ident" id="5222151">cbP2</span><span class="op" id="5222155">,</span>&nbsp;<span class="ident" id="5222157">cbP4</span><span class="op" id="5222161">,</span>&nbsp;<span class="ident" id="5222163">cbP8</span><span class="op" id="5222167">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222171">bitsPerPixel</span>&nbsp;<span class="op" id="5222184">=</span>&nbsp;<span class="ident" id="5222186">d</span><span class="op" id="5222187">.</span><span class="ident" id="5222188">depth</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222196">paletted</span>&nbsp;<span class="op" id="5222205">=</span>&nbsp;<span class="ident" id="5222207">image</span><span class="op" id="5222212">.</span><span class="ident" id="5222213">NewPaletted</span><span class="op" id="5222224">(</span><span class="ident" id="5222225">image</span><span class="op" id="5222230">.</span><span class="ident" id="5222231">Rect</span><span class="op" id="5222235">(</span><span class="num" id="5222236">0</span><span class="op" id="5222237">,</span>&nbsp;<span class="num" id="5222239">0</span><span class="op" id="5222240">,</span>&nbsp;<span class="ident" id="5222242">width</span><span class="op" id="5222247">,</span>&nbsp;<span class="ident" id="5222249">height</span><span class="op" id="5222255">)</span><span class="op" id="5222256">,</span>&nbsp;<span class="ident" id="5222258">d</span><span class="op" id="5222259">.</span><span class="ident" id="5222260">palette</span><span class="op" id="5222267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222271">img</span>&nbsp;<span class="op" id="5222275">=</span>&nbsp;<span class="ident" id="5222277">paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222287">case</span>&nbsp;<span class="ident" id="5222292">cbTCA8</span><span class="op" id="5222298">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222302">bitsPerPixel</span>&nbsp;<span class="op" id="5222315">=</span>&nbsp;<span class="num" id="5222317">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222322">nrgba</span>&nbsp;<span class="op" id="5222328">=</span>&nbsp;<span class="ident" id="5222330">image</span><span class="op" id="5222335">.</span><span class="ident" id="5222336">NewNRGBA</span><span class="op" id="5222344">(</span><span class="ident" id="5222345">image</span><span class="op" id="5222350">.</span><span class="ident" id="5222351">Rect</span><span class="op" id="5222355">(</span><span class="num" id="5222356">0</span><span class="op" id="5222357">,</span>&nbsp;<span class="num" id="5222359">0</span><span class="op" id="5222360">,</span>&nbsp;<span class="ident" id="5222362">width</span><span class="op" id="5222367">,</span>&nbsp;<span class="ident" id="5222369">height</span><span class="op" id="5222375">)</span><span class="op" id="5222376">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222380">img</span>&nbsp;<span class="op" id="5222384">=</span>&nbsp;<span class="ident" id="5222386">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222393">case</span>&nbsp;<span class="ident" id="5222398">cbG16</span><span class="op" id="5222403">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222407">bitsPerPixel</span>&nbsp;<span class="op" id="5222420">=</span>&nbsp;<span class="num" id="5222422">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222427">gray16</span>&nbsp;<span class="op" id="5222434">=</span>&nbsp;<span class="ident" id="5222436">image</span><span class="op" id="5222441">.</span><span class="ident" id="5222442">NewGray16</span><span class="op" id="5222451">(</span><span class="ident" id="5222452">image</span><span class="op" id="5222457">.</span><span class="ident" id="5222458">Rect</span><span class="op" id="5222462">(</span><span class="num" id="5222463">0</span><span class="op" id="5222464">,</span>&nbsp;<span class="num" id="5222466">0</span><span class="op" id="5222467">,</span>&nbsp;<span class="ident" id="5222469">width</span><span class="op" id="5222474">,</span>&nbsp;<span class="ident" id="5222476">height</span><span class="op" id="5222482">)</span><span class="op" id="5222483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222487">img</span>&nbsp;<span class="op" id="5222491">=</span>&nbsp;<span class="ident" id="5222493">gray16</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222501">case</span>&nbsp;<span class="ident" id="5222506">cbGA16</span><span class="op" id="5222512">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222516">bitsPerPixel</span>&nbsp;<span class="op" id="5222529">=</span>&nbsp;<span class="num" id="5222531">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222536">nrgba64</span>&nbsp;<span class="op" id="5222544">=</span>&nbsp;<span class="ident" id="5222546">image</span><span class="op" id="5222551">.</span><span class="ident" id="5222552">NewNRGBA64</span><span class="op" id="5222562">(</span><span class="ident" id="5222563">image</span><span class="op" id="5222568">.</span><span class="ident" id="5222569">Rect</span><span class="op" id="5222573">(</span><span class="num" id="5222574">0</span><span class="op" id="5222575">,</span>&nbsp;<span class="num" id="5222577">0</span><span class="op" id="5222578">,</span>&nbsp;<span class="ident" id="5222580">width</span><span class="op" id="5222585">,</span>&nbsp;<span class="ident" id="5222587">height</span><span class="op" id="5222593">)</span><span class="op" id="5222594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222598">img</span>&nbsp;<span class="op" id="5222602">=</span>&nbsp;<span class="ident" id="5222604">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222613">case</span>&nbsp;<span class="ident" id="5222618">cbTC16</span><span class="op" id="5222624">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222628">bitsPerPixel</span>&nbsp;<span class="op" id="5222641">=</span>&nbsp;<span class="num" id="5222643">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222648">rgba64</span>&nbsp;<span class="op" id="5222655">=</span>&nbsp;<span class="ident" id="5222657">image</span><span class="op" id="5222662">.</span><span class="ident" id="5222663">NewRGBA64</span><span class="op" id="5222672">(</span><span class="ident" id="5222673">image</span><span class="op" id="5222678">.</span><span class="ident" id="5222679">Rect</span><span class="op" id="5222683">(</span><span class="num" id="5222684">0</span><span class="op" id="5222685">,</span>&nbsp;<span class="num" id="5222687">0</span><span class="op" id="5222688">,</span>&nbsp;<span class="ident" id="5222690">width</span><span class="op" id="5222695">,</span>&nbsp;<span class="ident" id="5222697">height</span><span class="op" id="5222703">)</span><span class="op" id="5222704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222708">img</span>&nbsp;<span class="op" id="5222712">=</span>&nbsp;<span class="ident" id="5222714">rgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222722">case</span>&nbsp;<span class="ident" id="5222727">cbTCA16</span><span class="op" id="5222734">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222738">bitsPerPixel</span>&nbsp;<span class="op" id="5222751">=</span>&nbsp;<span class="num" id="5222753">64</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222758">nrgba64</span>&nbsp;<span class="op" id="5222766">=</span>&nbsp;<span class="ident" id="5222768">image</span><span class="op" id="5222773">.</span><span class="ident" id="5222774">NewNRGBA64</span><span class="op" id="5222784">(</span><span class="ident" id="5222785">image</span><span class="op" id="5222790">.</span><span class="ident" id="5222791">Rect</span><span class="op" id="5222795">(</span><span class="num" id="5222796">0</span><span class="op" id="5222797">,</span>&nbsp;<span class="num" id="5222799">0</span><span class="op" id="5222800">,</span>&nbsp;<span class="ident" id="5222802">width</span><span class="op" id="5222807">,</span>&nbsp;<span class="ident" id="5222809">height</span><span class="op" id="5222815">)</span><span class="op" id="5222816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222820">img</span>&nbsp;<span class="op" id="5222824">=</span>&nbsp;<span class="ident" id="5222826">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5222835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222838">if</span>&nbsp;<span class="ident" id="5222841">allocateOnly</span>&nbsp;<span class="op" id="5222854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222858">return</span>&nbsp;<span class="ident" id="5222865">img</span><span class="op" id="5222868">,</span>&nbsp;<span class="builtintype" id="5222870">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5222875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222878">bytesPerPixel</span>&nbsp;<span class="op" id="5222892">:=</span>&nbsp;<span class="op" id="5222895">(</span><span class="ident" id="5222896">bitsPerPixel</span>&nbsp;<span class="op" id="5222909">+</span>&nbsp;<span class="num" id="5222911">7</span><span class="op" id="5222912">)</span>&nbsp;<span class="op" id="5222914">/</span>&nbsp;<span class="num" id="5222916">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5222920">//&nbsp;The&nbsp;+1&nbsp;is&nbsp;for&nbsp;the&nbsp;per-row&nbsp;filter&nbsp;type,&nbsp;which&nbsp;is&nbsp;at&nbsp;cr[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222982">rowSize</span>&nbsp;<span class="op" id="5222990">:=</span>&nbsp;<span class="num" id="5222993">1</span>&nbsp;<span class="op" id="5222995">+</span>&nbsp;<span class="op" id="5222997">(</span><span class="ident" id="5222998">bitsPerPixel</span><span class="op" id="5223010">*</span><span class="ident" id="5223011">width</span><span class="op" id="5223016">+</span><span class="num" id="5223017">7</span><span class="op" id="5223018">)</span><span class="op" id="5223019">/</span><span class="num" id="5223020">8</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5223023">//&nbsp;cr&nbsp;and&nbsp;pr&nbsp;are&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;current&nbsp;and&nbsp;previous&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223085">cr</span>&nbsp;<span class="op" id="5223088">:=</span>&nbsp;<span class="builtinfunc" id="5223091">make</span><span class="op" id="5223095">(</span><span class="op" id="5223096">[</span><span class="op" id="5223097">]</span><span class="builtintype" id="5223098">uint8</span><span class="op" id="5223103">,</span>&nbsp;<span class="ident" id="5223105">rowSize</span><span class="op" id="5223112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223115">pr</span>&nbsp;<span class="op" id="5223118">:=</span>&nbsp;<span class="builtinfunc" id="5223121">make</span><span class="op" id="5223125">(</span><span class="op" id="5223126">[</span><span class="op" id="5223127">]</span><span class="builtintype" id="5223128">uint8</span><span class="op" id="5223133">,</span>&nbsp;<span class="ident" id="5223135">rowSize</span><span class="op" id="5223142">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223146">for</span>&nbsp;<span class="ident" id="5223150">y</span>&nbsp;<span class="op" id="5223152">:=</span>&nbsp;<span class="num" id="5223155">0</span><span class="op" id="5223156">;</span>&nbsp;<span class="ident" id="5223158">y</span>&nbsp;<span class="op" id="5223160">&lt;</span>&nbsp;<span class="ident" id="5223162">height</span><span class="op" id="5223168">;</span>&nbsp;<span class="ident" id="5223170">y</span><span class="op" id="5223171">++</span>&nbsp;<span class="op" id="5223174">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5223178">//&nbsp;Read&nbsp;the&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223212">_</span><span class="op" id="5223213">,</span>&nbsp;<span class="ident" id="5223215">err</span>&nbsp;<span class="op" id="5223219">:=</span>&nbsp;<span class="ident" id="5223222">io</span><span class="op" id="5223224">.</span><span class="ident" id="5223225">ReadFull</span><span class="op" id="5223233">(</span><span class="ident" id="5223234">r</span><span class="op" id="5223235">,</span>&nbsp;<span class="ident" id="5223237">cr</span><span class="op" id="5223239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223243">if</span>&nbsp;<span class="ident" id="5223246">err</span>&nbsp;<span class="op" id="5223250">!=</span>&nbsp;<span class="builtintype" id="5223253">nil</span>&nbsp;<span class="op" id="5223257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223262">return</span>&nbsp;<span class="builtintype" id="5223269">nil</span><span class="op" id="5223272">,</span>&nbsp;<span class="ident" id="5223274">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5223280">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5223285">//&nbsp;Apply&nbsp;the&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223308">cdat</span>&nbsp;<span class="op" id="5223313">:=</span>&nbsp;<span class="ident" id="5223316">cr</span><span class="op" id="5223318">[</span><span class="num" id="5223319">1</span><span class="op" id="5223320">:</span><span class="op" id="5223321">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223325">pdat</span>&nbsp;<span class="op" id="5223330">:=</span>&nbsp;<span class="ident" id="5223333">pr</span><span class="op" id="5223335">[</span><span class="num" id="5223336">1</span><span class="op" id="5223337">:</span><span class="op" id="5223338">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223342">switch</span>&nbsp;<span class="ident" id="5223349">cr</span><span class="op" id="5223351">[</span><span class="num" id="5223352">0</span><span class="op" id="5223353">]</span>&nbsp;<span class="op" id="5223355">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223359">case</span>&nbsp;<span class="ident" id="5223364">ftNone</span><span class="op" id="5223370">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5223375">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223387">case</span>&nbsp;<span class="ident" id="5223392">ftSub</span><span class="op" id="5223397">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223402">for</span>&nbsp;<span class="ident" id="5223406">i</span>&nbsp;<span class="op" id="5223408">:=</span>&nbsp;<span class="ident" id="5223411">bytesPerPixel</span><span class="op" id="5223424">;</span>&nbsp;<span class="ident" id="5223426">i</span>&nbsp;<span class="op" id="5223428">&lt;</span>&nbsp;<span class="builtinfunc" id="5223430">len</span><span class="op" id="5223433">(</span><span class="ident" id="5223434">cdat</span><span class="op" id="5223438">)</span><span class="op" id="5223439">;</span>&nbsp;<span class="ident" id="5223441">i</span><span class="op" id="5223442">++</span>&nbsp;<span class="op" id="5223445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223451">cdat</span><span class="op" id="5223455">[</span><span class="ident" id="5223456">i</span><span class="op" id="5223457">]</span>&nbsp;<span class="op" id="5223459">+=</span>&nbsp;<span class="ident" id="5223462">cdat</span><span class="op" id="5223466">[</span><span class="ident" id="5223467">i</span><span class="op" id="5223468">-</span><span class="ident" id="5223469">bytesPerPixel</span><span class="op" id="5223482">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5223487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223491">case</span>&nbsp;<span class="ident" id="5223496">ftUp</span><span class="op" id="5223500">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223505">for</span>&nbsp;<span class="ident" id="5223509">i</span><span class="op" id="5223510">,</span>&nbsp;<span class="ident" id="5223512">p</span>&nbsp;<span class="op" id="5223514">:=</span>&nbsp;<span class="keyword" id="5223517">range</span>&nbsp;<span class="ident" id="5223523">pdat</span>&nbsp;<span class="op" id="5223528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223534">cdat</span><span class="op" id="5223538">[</span><span class="ident" id="5223539">i</span><span class="op" id="5223540">]</span>&nbsp;<span class="op" id="5223542">+=</span>&nbsp;<span class="ident" id="5223545">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5223550">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223554">case</span>&nbsp;<span class="ident" id="5223559">ftAverage</span><span class="op" id="5223568">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223573">for</span>&nbsp;<span class="ident" id="5223577">i</span>&nbsp;<span class="op" id="5223579">:=</span>&nbsp;<span class="num" id="5223582">0</span><span class="op" id="5223583">;</span>&nbsp;<span class="ident" id="5223585">i</span>&nbsp;<span class="op" id="5223587">&lt;</span>&nbsp;<span class="ident" id="5223589">bytesPerPixel</span><span class="op" id="5223602">;</span>&nbsp;<span class="ident" id="5223604">i</span><span class="op" id="5223605">++</span>&nbsp;<span class="op" id="5223608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223614">cdat</span><span class="op" id="5223618">[</span><span class="ident" id="5223619">i</span><span class="op" id="5223620">]</span>&nbsp;<span class="op" id="5223622">+=</span>&nbsp;<span class="ident" id="5223625">pdat</span><span class="op" id="5223629">[</span><span class="ident" id="5223630">i</span><span class="op" id="5223631">]</span>&nbsp;<span class="op" id="5223633">/</span>&nbsp;<span class="num" id="5223635">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5223640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223645">for</span>&nbsp;<span class="ident" id="5223649">i</span>&nbsp;<span class="op" id="5223651">:=</span>&nbsp;<span class="ident" id="5223654">bytesPerPixel</span><span class="op" id="5223667">;</span>&nbsp;<span class="ident" id="5223669">i</span>&nbsp;<span class="op" id="5223671">&lt;</span>&nbsp;<span class="builtinfunc" id="5223673">len</span><span class="op" id="5223676">(</span><span class="ident" id="5223677">cdat</span><span class="op" id="5223681">)</span><span class="op" id="5223682">;</span>&nbsp;<span class="ident" id="5223684">i</span><span class="op" id="5223685">++</span>&nbsp;<span class="op" id="5223688">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223694">cdat</span><span class="op" id="5223698">[</span><span class="ident" id="5223699">i</span><span class="op" id="5223700">]</span>&nbsp;<span class="op" id="5223702">+=</span>&nbsp;<span class="builtintype" id="5223705">uint8</span><span class="op" id="5223710">(</span><span class="op" id="5223711">(</span><span class="builtintype" id="5223712">int</span><span class="op" id="5223715">(</span><span class="ident" id="5223716">cdat</span><span class="op" id="5223720">[</span><span class="ident" id="5223721">i</span><span class="op" id="5223722">-</span><span class="ident" id="5223723">bytesPerPixel</span><span class="op" id="5223736">]</span><span class="op" id="5223737">)</span>&nbsp;<span class="op" id="5223739">+</span>&nbsp;<span class="builtintype" id="5223741">int</span><span class="op" id="5223744">(</span><span class="ident" id="5223745">pdat</span><span class="op" id="5223749">[</span><span class="ident" id="5223750">i</span><span class="op" id="5223751">]</span><span class="op" id="5223752">)</span><span class="op" id="5223753">)</span>&nbsp;<span class="op" id="5223755">/</span>&nbsp;<span class="num" id="5223757">2</span><span class="op" id="5223758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5223763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223767">case</span>&nbsp;<span class="ident" id="5223772">ftPaeth</span><span class="op" id="5223779">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223784">filterPaeth</span><span class="op" id="5223795">(</span><span class="ident" id="5223796">cdat</span><span class="op" id="5223800">,</span>&nbsp;<span class="ident" id="5223802">pdat</span><span class="op" id="5223806">,</span>&nbsp;<span class="ident" id="5223808">bytesPerPixel</span><span class="op" id="5223821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223825">default</span><span class="op" id="5223832">:</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223837">return</span>&nbsp;<span class="builtintype" id="5223844">nil</span><span class="op" id="5223847">,</span>&nbsp;<span class="ident" id="5223849">FormatError</span><span class="op" id="5223860">(</span><span class="string" id="5223861">&#34;bad&nbsp;filter&nbsp;type&#34;</span><span class="op" id="5223878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5223882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5223887">//&nbsp;Convert&nbsp;from&nbsp;bytes&nbsp;to&nbsp;colors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223922">switch</span>&nbsp;<span class="ident" id="5223929">d</span><span class="op" id="5223930">.</span><span class="ident" id="5223931">cb</span>&nbsp;<span class="op" id="5223934">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223938">case</span>&nbsp;<span class="ident" id="5223943">cbG1</span><span class="op" id="5223947">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223952">for</span>&nbsp;<span class="ident" id="5223956">x</span>&nbsp;<span class="op" id="5223958">:=</span>&nbsp;<span class="num" id="5223961">0</span><span class="op" id="5223962">;</span>&nbsp;<span class="ident" id="5223964">x</span>&nbsp;<span class="op" id="5223966">&lt;</span>&nbsp;<span class="ident" id="5223968">width</span><span class="op" id="5223973">;</span>&nbsp;<span class="ident" id="5223975">x</span>&nbsp;<span class="op" id="5223977">+=</span>&nbsp;<span class="num" id="5223980">8</span>&nbsp;<span class="op" id="5223982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223988">b</span>&nbsp;<span class="op" id="5223990">:=</span>&nbsp;<span class="ident" id="5223993">cdat</span><span class="op" id="5223997">[</span><span class="ident" id="5223998">x</span><span class="op" id="5223999">/</span><span class="num" id="5224000">8</span><span class="op" id="5224001">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224007">for</span>&nbsp;<span class="ident" id="5224011">x2</span>&nbsp;<span class="op" id="5224014">:=</span>&nbsp;<span class="num" id="5224017">0</span><span class="op" id="5224018">;</span>&nbsp;<span class="ident" id="5224020">x2</span>&nbsp;<span class="op" id="5224023">&lt;</span>&nbsp;<span class="num" id="5224025">8</span>&nbsp;<span class="op" id="5224027">&amp;&amp;</span>&nbsp;<span class="ident" id="5224030">x</span><span class="op" id="5224031">+</span><span class="ident" id="5224032">x2</span>&nbsp;<span class="op" id="5224035">&lt;</span>&nbsp;<span class="ident" id="5224037">width</span><span class="op" id="5224042">;</span>&nbsp;<span class="ident" id="5224044">x2</span><span class="op" id="5224046">++</span>&nbsp;<span class="op" id="5224049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224056">gray</span><span class="op" id="5224060">.</span><span class="ident" id="5224061">SetGray</span><span class="op" id="5224068">(</span><span class="ident" id="5224069">x</span><span class="op" id="5224070">+</span><span class="ident" id="5224071">x2</span><span class="op" id="5224073">,</span>&nbsp;<span class="ident" id="5224075">y</span><span class="op" id="5224076">,</span>&nbsp;<span class="ident" id="5224078">color</span><span class="op" id="5224083">.</span><span class="ident" id="5224084">Gray</span><span class="op" id="5224088">{</span><span class="op" id="5224089">(</span><span class="ident" id="5224090">b</span>&nbsp;<span class="op" id="5224092">&gt;&gt;</span>&nbsp;<span class="num" id="5224095">7</span><span class="op" id="5224096">)</span>&nbsp;<span class="op" id="5224098">*</span>&nbsp;<span class="num" id="5224100">0xff</span><span class="op" id="5224104">}</span><span class="op" id="5224105">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224112">b</span>&nbsp;<span class="op" id="5224114">&lt;&lt;=</span>&nbsp;<span class="num" id="5224118">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224133">case</span>&nbsp;<span class="ident" id="5224138">cbG2</span><span class="op" id="5224142">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224147">for</span>&nbsp;<span class="ident" id="5224151">x</span>&nbsp;<span class="op" id="5224153">:=</span>&nbsp;<span class="num" id="5224156">0</span><span class="op" id="5224157">;</span>&nbsp;<span class="ident" id="5224159">x</span>&nbsp;<span class="op" id="5224161">&lt;</span>&nbsp;<span class="ident" id="5224163">width</span><span class="op" id="5224168">;</span>&nbsp;<span class="ident" id="5224170">x</span>&nbsp;<span class="op" id="5224172">+=</span>&nbsp;<span class="num" id="5224175">4</span>&nbsp;<span class="op" id="5224177">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224183">b</span>&nbsp;<span class="op" id="5224185">:=</span>&nbsp;<span class="ident" id="5224188">cdat</span><span class="op" id="5224192">[</span><span class="ident" id="5224193">x</span><span class="op" id="5224194">/</span><span class="num" id="5224195">4</span><span class="op" id="5224196">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224202">for</span>&nbsp;<span class="ident" id="5224206">x2</span>&nbsp;<span class="op" id="5224209">:=</span>&nbsp;<span class="num" id="5224212">0</span><span class="op" id="5224213">;</span>&nbsp;<span class="ident" id="5224215">x2</span>&nbsp;<span class="op" id="5224218">&lt;</span>&nbsp;<span class="num" id="5224220">4</span>&nbsp;<span class="op" id="5224222">&amp;&amp;</span>&nbsp;<span class="ident" id="5224225">x</span><span class="op" id="5224226">+</span><span class="ident" id="5224227">x2</span>&nbsp;<span class="op" id="5224230">&lt;</span>&nbsp;<span class="ident" id="5224232">width</span><span class="op" id="5224237">;</span>&nbsp;<span class="ident" id="5224239">x2</span><span class="op" id="5224241">++</span>&nbsp;<span class="op" id="5224244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224251">gray</span><span class="op" id="5224255">.</span><span class="ident" id="5224256">SetGray</span><span class="op" id="5224263">(</span><span class="ident" id="5224264">x</span><span class="op" id="5224265">+</span><span class="ident" id="5224266">x2</span><span class="op" id="5224268">,</span>&nbsp;<span class="ident" id="5224270">y</span><span class="op" id="5224271">,</span>&nbsp;<span class="ident" id="5224273">color</span><span class="op" id="5224278">.</span><span class="ident" id="5224279">Gray</span><span class="op" id="5224283">{</span><span class="op" id="5224284">(</span><span class="ident" id="5224285">b</span>&nbsp;<span class="op" id="5224287">&gt;&gt;</span>&nbsp;<span class="num" id="5224290">6</span><span class="op" id="5224291">)</span>&nbsp;<span class="op" id="5224293">*</span>&nbsp;<span class="num" id="5224295">0x55</span><span class="op" id="5224299">}</span><span class="op" id="5224300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224307">b</span>&nbsp;<span class="op" id="5224309">&lt;&lt;=</span>&nbsp;<span class="num" id="5224313">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224319">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224328">case</span>&nbsp;<span class="ident" id="5224333">cbG4</span><span class="op" id="5224337">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224342">for</span>&nbsp;<span class="ident" id="5224346">x</span>&nbsp;<span class="op" id="5224348">:=</span>&nbsp;<span class="num" id="5224351">0</span><span class="op" id="5224352">;</span>&nbsp;<span class="ident" id="5224354">x</span>&nbsp;<span class="op" id="5224356">&lt;</span>&nbsp;<span class="ident" id="5224358">width</span><span class="op" id="5224363">;</span>&nbsp;<span class="ident" id="5224365">x</span>&nbsp;<span class="op" id="5224367">+=</span>&nbsp;<span class="num" id="5224370">2</span>&nbsp;<span class="op" id="5224372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224378">b</span>&nbsp;<span class="op" id="5224380">:=</span>&nbsp;<span class="ident" id="5224383">cdat</span><span class="op" id="5224387">[</span><span class="ident" id="5224388">x</span><span class="op" id="5224389">/</span><span class="num" id="5224390">2</span><span class="op" id="5224391">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224397">for</span>&nbsp;<span class="ident" id="5224401">x2</span>&nbsp;<span class="op" id="5224404">:=</span>&nbsp;<span class="num" id="5224407">0</span><span class="op" id="5224408">;</span>&nbsp;<span class="ident" id="5224410">x2</span>&nbsp;<span class="op" id="5224413">&lt;</span>&nbsp;<span class="num" id="5224415">2</span>&nbsp;<span class="op" id="5224417">&amp;&amp;</span>&nbsp;<span class="ident" id="5224420">x</span><span class="op" id="5224421">+</span><span class="ident" id="5224422">x2</span>&nbsp;<span class="op" id="5224425">&lt;</span>&nbsp;<span class="ident" id="5224427">width</span><span class="op" id="5224432">;</span>&nbsp;<span class="ident" id="5224434">x2</span><span class="op" id="5224436">++</span>&nbsp;<span class="op" id="5224439">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224446">gray</span><span class="op" id="5224450">.</span><span class="ident" id="5224451">SetGray</span><span class="op" id="5224458">(</span><span class="ident" id="5224459">x</span><span class="op" id="5224460">+</span><span class="ident" id="5224461">x2</span><span class="op" id="5224463">,</span>&nbsp;<span class="ident" id="5224465">y</span><span class="op" id="5224466">,</span>&nbsp;<span class="ident" id="5224468">color</span><span class="op" id="5224473">.</span><span class="ident" id="5224474">Gray</span><span class="op" id="5224478">{</span><span class="op" id="5224479">(</span><span class="ident" id="5224480">b</span>&nbsp;<span class="op" id="5224482">&gt;&gt;</span>&nbsp;<span class="num" id="5224485">4</span><span class="op" id="5224486">)</span>&nbsp;<span class="op" id="5224488">*</span>&nbsp;<span class="num" id="5224490">0x11</span><span class="op" id="5224494">}</span><span class="op" id="5224495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224502">b</span>&nbsp;<span class="op" id="5224504">&lt;&lt;=</span>&nbsp;<span class="num" id="5224508">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224523">case</span>&nbsp;<span class="ident" id="5224528">cbG8</span><span class="op" id="5224532">:</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5224537">copy</span><span class="op" id="5224541">(</span><span class="ident" id="5224542">gray</span><span class="op" id="5224546">.</span><span class="ident" id="5224547">Pix</span><span class="op" id="5224550">[</span><span class="ident" id="5224551">pixOffset</span><span class="op" id="5224560">:</span><span class="op" id="5224561">]</span><span class="op" id="5224562">,</span>&nbsp;<span class="ident" id="5224564">cdat</span><span class="op" id="5224568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224573">pixOffset</span>&nbsp;<span class="op" id="5224583">+=</span>&nbsp;<span class="ident" id="5224586">gray</span><span class="op" id="5224590">.</span><span class="ident" id="5224591">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224600">case</span>&nbsp;<span class="ident" id="5224605">cbGA8</span><span class="op" id="5224610">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224615">for</span>&nbsp;<span class="ident" id="5224619">x</span>&nbsp;<span class="op" id="5224621">:=</span>&nbsp;<span class="num" id="5224624">0</span><span class="op" id="5224625">;</span>&nbsp;<span class="ident" id="5224627">x</span>&nbsp;<span class="op" id="5224629">&lt;</span>&nbsp;<span class="ident" id="5224631">width</span><span class="op" id="5224636">;</span>&nbsp;<span class="ident" id="5224638">x</span><span class="op" id="5224639">++</span>&nbsp;<span class="op" id="5224642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224648">ycol</span>&nbsp;<span class="op" id="5224653">:=</span>&nbsp;<span class="ident" id="5224656">cdat</span><span class="op" id="5224660">[</span><span class="num" id="5224661">2</span><span class="op" id="5224662">*</span><span class="ident" id="5224663">x</span><span class="op" id="5224664">+</span><span class="num" id="5224665">0</span><span class="op" id="5224666">]</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224672">nrgba</span><span class="op" id="5224677">.</span><span class="ident" id="5224678">SetNRGBA</span><span class="op" id="5224686">(</span><span class="ident" id="5224687">x</span><span class="op" id="5224688">,</span>&nbsp;<span class="ident" id="5224690">y</span><span class="op" id="5224691">,</span>&nbsp;<span class="ident" id="5224693">color</span><span class="op" id="5224698">.</span><span class="ident" id="5224699">NRGBA</span><span class="op" id="5224704">{</span><span class="ident" id="5224705">ycol</span><span class="op" id="5224709">,</span>&nbsp;<span class="ident" id="5224711">ycol</span><span class="op" id="5224715">,</span>&nbsp;<span class="ident" id="5224717">ycol</span><span class="op" id="5224721">,</span>&nbsp;<span class="ident" id="5224723">cdat</span><span class="op" id="5224727">[</span><span class="num" id="5224728">2</span><span class="op" id="5224729">*</span><span class="ident" id="5224730">x</span><span class="op" id="5224731">+</span><span class="num" id="5224732">1</span><span class="op" id="5224733">]</span><span class="op" id="5224734">}</span><span class="op" id="5224735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224744">case</span>&nbsp;<span class="ident" id="5224749">cbTC8</span><span class="op" id="5224754">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224759">pix</span><span class="op" id="5224762">,</span>&nbsp;<span class="ident" id="5224764">i</span><span class="op" id="5224765">,</span>&nbsp;<span class="ident" id="5224767">j</span>&nbsp;<span class="op" id="5224769">:=</span>&nbsp;<span class="ident" id="5224772">rgba</span><span class="op" id="5224776">.</span><span class="ident" id="5224777">Pix</span><span class="op" id="5224780">,</span>&nbsp;<span class="ident" id="5224782">pixOffset</span><span class="op" id="5224791">,</span>&nbsp;<span class="num" id="5224793">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224798">for</span>&nbsp;<span class="ident" id="5224802">x</span>&nbsp;<span class="op" id="5224804">:=</span>&nbsp;<span class="num" id="5224807">0</span><span class="op" id="5224808">;</span>&nbsp;<span class="ident" id="5224810">x</span>&nbsp;<span class="op" id="5224812">&lt;</span>&nbsp;<span class="ident" id="5224814">width</span><span class="op" id="5224819">;</span>&nbsp;<span class="ident" id="5224821">x</span><span class="op" id="5224822">++</span>&nbsp;<span class="op" id="5224825">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224831">pix</span><span class="op" id="5224834">[</span><span class="ident" id="5224835">i</span><span class="op" id="5224836">+</span><span class="num" id="5224837">0</span><span class="op" id="5224838">]</span>&nbsp;<span class="op" id="5224840">=</span>&nbsp;<span class="ident" id="5224842">cdat</span><span class="op" id="5224846">[</span><span class="ident" id="5224847">j</span><span class="op" id="5224848">+</span><span class="num" id="5224849">0</span><span class="op" id="5224850">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224856">pix</span><span class="op" id="5224859">[</span><span class="ident" id="5224860">i</span><span class="op" id="5224861">+</span><span class="num" id="5224862">1</span><span class="op" id="5224863">]</span>&nbsp;<span class="op" id="5224865">=</span>&nbsp;<span class="ident" id="5224867">cdat</span><span class="op" id="5224871">[</span><span class="ident" id="5224872">j</span><span class="op" id="5224873">+</span><span class="num" id="5224874">1</span><span class="op" id="5224875">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224881">pix</span><span class="op" id="5224884">[</span><span class="ident" id="5224885">i</span><span class="op" id="5224886">+</span><span class="num" id="5224887">2</span><span class="op" id="5224888">]</span>&nbsp;<span class="op" id="5224890">=</span>&nbsp;<span class="ident" id="5224892">cdat</span><span class="op" id="5224896">[</span><span class="ident" id="5224897">j</span><span class="op" id="5224898">+</span><span class="num" id="5224899">2</span><span class="op" id="5224900">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224906">pix</span><span class="op" id="5224909">[</span><span class="ident" id="5224910">i</span><span class="op" id="5224911">+</span><span class="num" id="5224912">3</span><span class="op" id="5224913">]</span>&nbsp;<span class="op" id="5224915">=</span>&nbsp;<span class="num" id="5224917">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224926">i</span>&nbsp;<span class="op" id="5224928">+=</span>&nbsp;<span class="num" id="5224931">4</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224937">j</span>&nbsp;<span class="op" id="5224939">+=</span>&nbsp;<span class="num" id="5224942">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224952">pixOffset</span>&nbsp;<span class="op" id="5224962">+=</span>&nbsp;<span class="ident" id="5224965">rgba</span><span class="op" id="5224969">.</span><span class="ident" id="5224970">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224979">case</span>&nbsp;<span class="ident" id="5224984">cbP1</span><span class="op" id="5224988">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224993">for</span>&nbsp;<span class="ident" id="5224997">x</span>&nbsp;<span class="op" id="5224999">:=</span>&nbsp;<span class="num" id="5225002">0</span><span class="op" id="5225003">;</span>&nbsp;<span class="ident" id="5225005">x</span>&nbsp;<span class="op" id="5225007">&lt;</span>&nbsp;<span class="ident" id="5225009">width</span><span class="op" id="5225014">;</span>&nbsp;<span class="ident" id="5225016">x</span>&nbsp;<span class="op" id="5225018">+=</span>&nbsp;<span class="num" id="5225021">8</span>&nbsp;<span class="op" id="5225023">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225029">b</span>&nbsp;<span class="op" id="5225031">:=</span>&nbsp;<span class="ident" id="5225034">cdat</span><span class="op" id="5225038">[</span><span class="ident" id="5225039">x</span><span class="op" id="5225040">/</span><span class="num" id="5225041">8</span><span class="op" id="5225042">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225048">for</span>&nbsp;<span class="ident" id="5225052">x2</span>&nbsp;<span class="op" id="5225055">:=</span>&nbsp;<span class="num" id="5225058">0</span><span class="op" id="5225059">;</span>&nbsp;<span class="ident" id="5225061">x2</span>&nbsp;<span class="op" id="5225064">&lt;</span>&nbsp;<span class="num" id="5225066">8</span>&nbsp;<span class="op" id="5225068">&amp;&amp;</span>&nbsp;<span class="ident" id="5225071">x</span><span class="op" id="5225072">+</span><span class="ident" id="5225073">x2</span>&nbsp;<span class="op" id="5225076">&lt;</span>&nbsp;<span class="ident" id="5225078">width</span><span class="op" id="5225083">;</span>&nbsp;<span class="ident" id="5225085">x2</span><span class="op" id="5225087">++</span>&nbsp;<span class="op" id="5225090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225097">idx</span>&nbsp;<span class="op" id="5225101">:=</span>&nbsp;<span class="ident" id="5225104">b</span>&nbsp;<span class="op" id="5225106">&gt;&gt;</span>&nbsp;<span class="num" id="5225109">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225116">if</span>&nbsp;<span class="builtinfunc" id="5225119">len</span><span class="op" id="5225122">(</span><span class="ident" id="5225123">paletted</span><span class="op" id="5225131">.</span><span class="ident" id="5225132">Palette</span><span class="op" id="5225139">)</span>&nbsp;<span class="op" id="5225141">&lt;=</span>&nbsp;<span class="builtintype" id="5225144">int</span><span class="op" id="5225147">(</span><span class="ident" id="5225148">idx</span><span class="op" id="5225151">)</span>&nbsp;<span class="op" id="5225153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225161">paletted</span><span class="op" id="5225169">.</span><span class="ident" id="5225170">Palette</span>&nbsp;<span class="op" id="5225178">=</span>&nbsp;<span class="ident" id="5225180">paletted</span><span class="op" id="5225188">.</span><span class="ident" id="5225189">Palette</span><span class="op" id="5225196">[</span><span class="op" id="5225197">:</span><span class="builtintype" id="5225198">int</span><span class="op" id="5225201">(</span><span class="ident" id="5225202">idx</span><span class="op" id="5225205">)</span><span class="op" id="5225206">+</span><span class="num" id="5225207">1</span><span class="op" id="5225208">]</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225222">paletted</span><span class="op" id="5225230">.</span><span class="ident" id="5225231">SetColorIndex</span><span class="op" id="5225244">(</span><span class="ident" id="5225245">x</span><span class="op" id="5225246">+</span><span class="ident" id="5225247">x2</span><span class="op" id="5225249">,</span>&nbsp;<span class="ident" id="5225251">y</span><span class="op" id="5225252">,</span>&nbsp;<span class="ident" id="5225254">idx</span><span class="op" id="5225257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225264">b</span>&nbsp;<span class="op" id="5225266">&lt;&lt;=</span>&nbsp;<span class="num" id="5225270">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225281">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225285">case</span>&nbsp;<span class="ident" id="5225290">cbP2</span><span class="op" id="5225294">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225299">for</span>&nbsp;<span class="ident" id="5225303">x</span>&nbsp;<span class="op" id="5225305">:=</span>&nbsp;<span class="num" id="5225308">0</span><span class="op" id="5225309">;</span>&nbsp;<span class="ident" id="5225311">x</span>&nbsp;<span class="op" id="5225313">&lt;</span>&nbsp;<span class="ident" id="5225315">width</span><span class="op" id="5225320">;</span>&nbsp;<span class="ident" id="5225322">x</span>&nbsp;<span class="op" id="5225324">+=</span>&nbsp;<span class="num" id="5225327">4</span>&nbsp;<span class="op" id="5225329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225335">b</span>&nbsp;<span class="op" id="5225337">:=</span>&nbsp;<span class="ident" id="5225340">cdat</span><span class="op" id="5225344">[</span><span class="ident" id="5225345">x</span><span class="op" id="5225346">/</span><span class="num" id="5225347">4</span><span class="op" id="5225348">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225354">for</span>&nbsp;<span class="ident" id="5225358">x2</span>&nbsp;<span class="op" id="5225361">:=</span>&nbsp;<span class="num" id="5225364">0</span><span class="op" id="5225365">;</span>&nbsp;<span class="ident" id="5225367">x2</span>&nbsp;<span class="op" id="5225370">&lt;</span>&nbsp;<span class="num" id="5225372">4</span>&nbsp;<span class="op" id="5225374">&amp;&amp;</span>&nbsp;<span class="ident" id="5225377">x</span><span class="op" id="5225378">+</span><span class="ident" id="5225379">x2</span>&nbsp;<span class="op" id="5225382">&lt;</span>&nbsp;<span class="ident" id="5225384">width</span><span class="op" id="5225389">;</span>&nbsp;<span class="ident" id="5225391">x2</span><span class="op" id="5225393">++</span>&nbsp;<span class="op" id="5225396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225403">idx</span>&nbsp;<span class="op" id="5225407">:=</span>&nbsp;<span class="ident" id="5225410">b</span>&nbsp;<span class="op" id="5225412">&gt;&gt;</span>&nbsp;<span class="num" id="5225415">6</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225422">if</span>&nbsp;<span class="builtinfunc" id="5225425">len</span><span class="op" id="5225428">(</span><span class="ident" id="5225429">paletted</span><span class="op" id="5225437">.</span><span class="ident" id="5225438">Palette</span><span class="op" id="5225445">)</span>&nbsp;<span class="op" id="5225447">&lt;=</span>&nbsp;<span class="builtintype" id="5225450">int</span><span class="op" id="5225453">(</span><span class="ident" id="5225454">idx</span><span class="op" id="5225457">)</span>&nbsp;<span class="op" id="5225459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225467">paletted</span><span class="op" id="5225475">.</span><span class="ident" id="5225476">Palette</span>&nbsp;<span class="op" id="5225484">=</span>&nbsp;<span class="ident" id="5225486">paletted</span><span class="op" id="5225494">.</span><span class="ident" id="5225495">Palette</span><span class="op" id="5225502">[</span><span class="op" id="5225503">:</span><span class="builtintype" id="5225504">int</span><span class="op" id="5225507">(</span><span class="ident" id="5225508">idx</span><span class="op" id="5225511">)</span><span class="op" id="5225512">+</span><span class="num" id="5225513">1</span><span class="op" id="5225514">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225528">paletted</span><span class="op" id="5225536">.</span><span class="ident" id="5225537">SetColorIndex</span><span class="op" id="5225550">(</span><span class="ident" id="5225551">x</span><span class="op" id="5225552">+</span><span class="ident" id="5225553">x2</span><span class="op" id="5225555">,</span>&nbsp;<span class="ident" id="5225557">y</span><span class="op" id="5225558">,</span>&nbsp;<span class="ident" id="5225560">idx</span><span class="op" id="5225563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225570">b</span>&nbsp;<span class="op" id="5225572">&lt;&lt;=</span>&nbsp;<span class="num" id="5225576">2</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225591">case</span>&nbsp;<span class="ident" id="5225596">cbP4</span><span class="op" id="5225600">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225605">for</span>&nbsp;<span class="ident" id="5225609">x</span>&nbsp;<span class="op" id="5225611">:=</span>&nbsp;<span class="num" id="5225614">0</span><span class="op" id="5225615">;</span>&nbsp;<span class="ident" id="5225617">x</span>&nbsp;<span class="op" id="5225619">&lt;</span>&nbsp;<span class="ident" id="5225621">width</span><span class="op" id="5225626">;</span>&nbsp;<span class="ident" id="5225628">x</span>&nbsp;<span class="op" id="5225630">+=</span>&nbsp;<span class="num" id="5225633">2</span>&nbsp;<span class="op" id="5225635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225641">b</span>&nbsp;<span class="op" id="5225643">:=</span>&nbsp;<span class="ident" id="5225646">cdat</span><span class="op" id="5225650">[</span><span class="ident" id="5225651">x</span><span class="op" id="5225652">/</span><span class="num" id="5225653">2</span><span class="op" id="5225654">]</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225660">for</span>&nbsp;<span class="ident" id="5225664">x2</span>&nbsp;<span class="op" id="5225667">:=</span>&nbsp;<span class="num" id="5225670">0</span><span class="op" id="5225671">;</span>&nbsp;<span class="ident" id="5225673">x2</span>&nbsp;<span class="op" id="5225676">&lt;</span>&nbsp;<span class="num" id="5225678">2</span>&nbsp;<span class="op" id="5225680">&amp;&amp;</span>&nbsp;<span class="ident" id="5225683">x</span><span class="op" id="5225684">+</span><span class="ident" id="5225685">x2</span>&nbsp;<span class="op" id="5225688">&lt;</span>&nbsp;<span class="ident" id="5225690">width</span><span class="op" id="5225695">;</span>&nbsp;<span class="ident" id="5225697">x2</span><span class="op" id="5225699">++</span>&nbsp;<span class="op" id="5225702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225709">idx</span>&nbsp;<span class="op" id="5225713">:=</span>&nbsp;<span class="ident" id="5225716">b</span>&nbsp;<span class="op" id="5225718">&gt;&gt;</span>&nbsp;<span class="num" id="5225721">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225728">if</span>&nbsp;<span class="builtinfunc" id="5225731">len</span><span class="op" id="5225734">(</span><span class="ident" id="5225735">paletted</span><span class="op" id="5225743">.</span><span class="ident" id="5225744">Palette</span><span class="op" id="5225751">)</span>&nbsp;<span class="op" id="5225753">&lt;=</span>&nbsp;<span class="builtintype" id="5225756">int</span><span class="op" id="5225759">(</span><span class="ident" id="5225760">idx</span><span class="op" id="5225763">)</span>&nbsp;<span class="op" id="5225765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225773">paletted</span><span class="op" id="5225781">.</span><span class="ident" id="5225782">Palette</span>&nbsp;<span class="op" id="5225790">=</span>&nbsp;<span class="ident" id="5225792">paletted</span><span class="op" id="5225800">.</span><span class="ident" id="5225801">Palette</span><span class="op" id="5225808">[</span><span class="op" id="5225809">:</span><span class="builtintype" id="5225810">int</span><span class="op" id="5225813">(</span><span class="ident" id="5225814">idx</span><span class="op" id="5225817">)</span><span class="op" id="5225818">+</span><span class="num" id="5225819">1</span><span class="op" id="5225820">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225827">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225834">paletted</span><span class="op" id="5225842">.</span><span class="ident" id="5225843">SetColorIndex</span><span class="op" id="5225856">(</span><span class="ident" id="5225857">x</span><span class="op" id="5225858">+</span><span class="ident" id="5225859">x2</span><span class="op" id="5225861">,</span>&nbsp;<span class="ident" id="5225863">y</span><span class="op" id="5225864">,</span>&nbsp;<span class="ident" id="5225866">idx</span><span class="op" id="5225869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225876">b</span>&nbsp;<span class="op" id="5225878">&lt;&lt;=</span>&nbsp;<span class="num" id="5225882">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225897">case</span>&nbsp;<span class="ident" id="5225902">cbP8</span><span class="op" id="5225906">:</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225911">if</span>&nbsp;<span class="builtinfunc" id="5225914">len</span><span class="op" id="5225917">(</span><span class="ident" id="5225918">paletted</span><span class="op" id="5225926">.</span><span class="ident" id="5225927">Palette</span><span class="op" id="5225934">)</span>&nbsp;<span class="op" id="5225936">!=</span>&nbsp;<span class="num" id="5225939">255</span>&nbsp;<span class="op" id="5225943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225949">for</span>&nbsp;<span class="ident" id="5225953">x</span>&nbsp;<span class="op" id="5225955">:=</span>&nbsp;<span class="num" id="5225958">0</span><span class="op" id="5225959">;</span>&nbsp;<span class="ident" id="5225961">x</span>&nbsp;<span class="op" id="5225963">&lt;</span>&nbsp;<span class="ident" id="5225965">width</span><span class="op" id="5225970">;</span>&nbsp;<span class="ident" id="5225972">x</span><span class="op" id="5225973">++</span>&nbsp;<span class="op" id="5225976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225983">if</span>&nbsp;<span class="builtinfunc" id="5225986">len</span><span class="op" id="5225989">(</span><span class="ident" id="5225990">paletted</span><span class="op" id="5225998">.</span><span class="ident" id="5225999">Palette</span><span class="op" id="5226006">)</span>&nbsp;<span class="op" id="5226008">&lt;=</span>&nbsp;<span class="builtintype" id="5226011">int</span><span class="op" id="5226014">(</span><span class="ident" id="5226015">cdat</span><span class="op" id="5226019">[</span><span class="ident" id="5226020">x</span><span class="op" id="5226021">]</span><span class="op" id="5226022">)</span>&nbsp;<span class="op" id="5226024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226032">paletted</span><span class="op" id="5226040">.</span><span class="ident" id="5226041">Palette</span>&nbsp;<span class="op" id="5226049">=</span>&nbsp;<span class="ident" id="5226051">paletted</span><span class="op" id="5226059">.</span><span class="ident" id="5226060">Palette</span><span class="op" id="5226067">[</span><span class="op" id="5226068">:</span><span class="builtintype" id="5226069">int</span><span class="op" id="5226072">(</span><span class="ident" id="5226073">cdat</span><span class="op" id="5226077">[</span><span class="ident" id="5226078">x</span><span class="op" id="5226079">]</span><span class="op" id="5226080">)</span><span class="op" id="5226081">+</span><span class="num" id="5226082">1</span><span class="op" id="5226083">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226090">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5226106">copy</span><span class="op" id="5226110">(</span><span class="ident" id="5226111">paletted</span><span class="op" id="5226119">.</span><span class="ident" id="5226120">Pix</span><span class="op" id="5226123">[</span><span class="ident" id="5226124">pixOffset</span><span class="op" id="5226133">:</span><span class="op" id="5226134">]</span><span class="op" id="5226135">,</span>&nbsp;<span class="ident" id="5226137">cdat</span><span class="op" id="5226141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226146">pixOffset</span>&nbsp;<span class="op" id="5226156">+=</span>&nbsp;<span class="ident" id="5226159">paletted</span><span class="op" id="5226167">.</span><span class="ident" id="5226168">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226177">case</span>&nbsp;<span class="ident" id="5226182">cbTCA8</span><span class="op" id="5226188">:</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5226193">copy</span><span class="op" id="5226197">(</span><span class="ident" id="5226198">nrgba</span><span class="op" id="5226203">.</span><span class="ident" id="5226204">Pix</span><span class="op" id="5226207">[</span><span class="ident" id="5226208">pixOffset</span><span class="op" id="5226217">:</span><span class="op" id="5226218">]</span><span class="op" id="5226219">,</span>&nbsp;<span class="ident" id="5226221">cdat</span><span class="op" id="5226225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226230">pixOffset</span>&nbsp;<span class="op" id="5226240">+=</span>&nbsp;<span class="ident" id="5226243">nrgba</span><span class="op" id="5226248">.</span><span class="ident" id="5226249">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226258">case</span>&nbsp;<span class="ident" id="5226263">cbG16</span><span class="op" id="5226268">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226273">for</span>&nbsp;<span class="ident" id="5226277">x</span>&nbsp;<span class="op" id="5226279">:=</span>&nbsp;<span class="num" id="5226282">0</span><span class="op" id="5226283">;</span>&nbsp;<span class="ident" id="5226285">x</span>&nbsp;<span class="op" id="5226287">&lt;</span>&nbsp;<span class="ident" id="5226289">width</span><span class="op" id="5226294">;</span>&nbsp;<span class="ident" id="5226296">x</span><span class="op" id="5226297">++</span>&nbsp;<span class="op" id="5226300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226306">ycol</span>&nbsp;<span class="op" id="5226311">:=</span>&nbsp;<span class="builtintype" id="5226314">uint16</span><span class="op" id="5226320">(</span><span class="ident" id="5226321">cdat</span><span class="op" id="5226325">[</span><span class="num" id="5226326">2</span><span class="op" id="5226327">*</span><span class="ident" id="5226328">x</span><span class="op" id="5226329">+</span><span class="num" id="5226330">0</span><span class="op" id="5226331">]</span><span class="op" id="5226332">)</span><span class="op" id="5226333">&lt;&lt;</span><span class="num" id="5226335">8</span>&nbsp;<span class="op" id="5226337">|</span>&nbsp;<span class="builtintype" id="5226339">uint16</span><span class="op" id="5226345">(</span><span class="ident" id="5226346">cdat</span><span class="op" id="5226350">[</span><span class="num" id="5226351">2</span><span class="op" id="5226352">*</span><span class="ident" id="5226353">x</span><span class="op" id="5226354">+</span><span class="num" id="5226355">1</span><span class="op" id="5226356">]</span><span class="op" id="5226357">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226363">gray16</span><span class="op" id="5226369">.</span><span class="ident" id="5226370">SetGray16</span><span class="op" id="5226379">(</span><span class="ident" id="5226380">x</span><span class="op" id="5226381">,</span>&nbsp;<span class="ident" id="5226383">y</span><span class="op" id="5226384">,</span>&nbsp;<span class="ident" id="5226386">color</span><span class="op" id="5226391">.</span><span class="ident" id="5226392">Gray16</span><span class="op" id="5226398">{</span><span class="ident" id="5226399">ycol</span><span class="op" id="5226403">}</span><span class="op" id="5226404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226413">case</span>&nbsp;<span class="ident" id="5226418">cbGA16</span><span class="op" id="5226424">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226429">for</span>&nbsp;<span class="ident" id="5226433">x</span>&nbsp;<span class="op" id="5226435">:=</span>&nbsp;<span class="num" id="5226438">0</span><span class="op" id="5226439">;</span>&nbsp;<span class="ident" id="5226441">x</span>&nbsp;<span class="op" id="5226443">&lt;</span>&nbsp;<span class="ident" id="5226445">width</span><span class="op" id="5226450">;</span>&nbsp;<span class="ident" id="5226452">x</span><span class="op" id="5226453">++</span>&nbsp;<span class="op" id="5226456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226462">ycol</span>&nbsp;<span class="op" id="5226467">:=</span>&nbsp;<span class="builtintype" id="5226470">uint16</span><span class="op" id="5226476">(</span><span class="ident" id="5226477">cdat</span><span class="op" id="5226481">[</span><span class="num" id="5226482">4</span><span class="op" id="5226483">*</span><span class="ident" id="5226484">x</span><span class="op" id="5226485">+</span><span class="num" id="5226486">0</span><span class="op" id="5226487">]</span><span class="op" id="5226488">)</span><span class="op" id="5226489">&lt;&lt;</span><span class="num" id="5226491">8</span>&nbsp;<span class="op" id="5226493">|</span>&nbsp;<span class="builtintype" id="5226495">uint16</span><span class="op" id="5226501">(</span><span class="ident" id="5226502">cdat</span><span class="op" id="5226506">[</span><span class="num" id="5226507">4</span><span class="op" id="5226508">*</span><span class="ident" id="5226509">x</span><span class="op" id="5226510">+</span><span class="num" id="5226511">1</span><span class="op" id="5226512">]</span><span class="op" id="5226513">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226519">acol</span>&nbsp;<span class="op" id="5226524">:=</span>&nbsp;<span class="builtintype" id="5226527">uint16</span><span class="op" id="5226533">(</span><span class="ident" id="5226534">cdat</span><span class="op" id="5226538">[</span><span class="num" id="5226539">4</span><span class="op" id="5226540">*</span><span class="ident" id="5226541">x</span><span class="op" id="5226542">+</span><span class="num" id="5226543">2</span><span class="op" id="5226544">]</span><span class="op" id="5226545">)</span><span class="op" id="5226546">&lt;&lt;</span><span class="num" id="5226548">8</span>&nbsp;<span class="op" id="5226550">|</span>&nbsp;<span class="builtintype" id="5226552">uint16</span><span class="op" id="5226558">(</span><span class="ident" id="5226559">cdat</span><span class="op" id="5226563">[</span><span class="num" id="5226564">4</span><span class="op" id="5226565">*</span><span class="ident" id="5226566">x</span><span class="op" id="5226567">+</span><span class="num" id="5226568">3</span><span class="op" id="5226569">]</span><span class="op" id="5226570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226576">nrgba64</span><span class="op" id="5226583">.</span><span class="ident" id="5226584">SetNRGBA64</span><span class="op" id="5226594">(</span><span class="ident" id="5226595">x</span><span class="op" id="5226596">,</span>&nbsp;<span class="ident" id="5226598">y</span><span class="op" id="5226599">,</span>&nbsp;<span class="ident" id="5226601">color</span><span class="op" id="5226606">.</span><span class="ident" id="5226607">NRGBA64</span><span class="op" id="5226614">{</span><span class="ident" id="5226615">ycol</span><span class="op" id="5226619">,</span>&nbsp;<span class="ident" id="5226621">ycol</span><span class="op" id="5226625">,</span>&nbsp;<span class="ident" id="5226627">ycol</span><span class="op" id="5226631">,</span>&nbsp;<span class="ident" id="5226633">acol</span><span class="op" id="5226637">}</span><span class="op" id="5226638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226647">case</span>&nbsp;<span class="ident" id="5226652">cbTC16</span><span class="op" id="5226658">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226663">for</span>&nbsp;<span class="ident" id="5226667">x</span>&nbsp;<span class="op" id="5226669">:=</span>&nbsp;<span class="num" id="5226672">0</span><span class="op" id="5226673">;</span>&nbsp;<span class="ident" id="5226675">x</span>&nbsp;<span class="op" id="5226677">&lt;</span>&nbsp;<span class="ident" id="5226679">width</span><span class="op" id="5226684">;</span>&nbsp;<span class="ident" id="5226686">x</span><span class="op" id="5226687">++</span>&nbsp;<span class="op" id="5226690">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226696">rcol</span>&nbsp;<span class="op" id="5226701">:=</span>&nbsp;<span class="builtintype" id="5226704">uint16</span><span class="op" id="5226710">(</span><span class="ident" id="5226711">cdat</span><span class="op" id="5226715">[</span><span class="num" id="5226716">6</span><span class="op" id="5226717">*</span><span class="ident" id="5226718">x</span><span class="op" id="5226719">+</span><span class="num" id="5226720">0</span><span class="op" id="5226721">]</span><span class="op" id="5226722">)</span><span class="op" id="5226723">&lt;&lt;</span><span class="num" id="5226725">8</span>&nbsp;<span class="op" id="5226727">|</span>&nbsp;<span class="builtintype" id="5226729">uint16</span><span class="op" id="5226735">(</span><span class="ident" id="5226736">cdat</span><span class="op" id="5226740">[</span><span class="num" id="5226741">6</span><span class="op" id="5226742">*</span><span class="ident" id="5226743">x</span><span class="op" id="5226744">+</span><span class="num" id="5226745">1</span><span class="op" id="5226746">]</span><span class="op" id="5226747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226753">gcol</span>&nbsp;<span class="op" id="5226758">:=</span>&nbsp;<span class="builtintype" id="5226761">uint16</span><span class="op" id="5226767">(</span><span class="ident" id="5226768">cdat</span><span class="op" id="5226772">[</span><span class="num" id="5226773">6</span><span class="op" id="5226774">*</span><span class="ident" id="5226775">x</span><span class="op" id="5226776">+</span><span class="num" id="5226777">2</span><span class="op" id="5226778">]</span><span class="op" id="5226779">)</span><span class="op" id="5226780">&lt;&lt;</span><span class="num" id="5226782">8</span>&nbsp;<span class="op" id="5226784">|</span>&nbsp;<span class="builtintype" id="5226786">uint16</span><span class="op" id="5226792">(</span><span class="ident" id="5226793">cdat</span><span class="op" id="5226797">[</span><span class="num" id="5226798">6</span><span class="op" id="5226799">*</span><span class="ident" id="5226800">x</span><span class="op" id="5226801">+</span><span class="num" id="5226802">3</span><span class="op" id="5226803">]</span><span class="op" id="5226804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226810">bcol</span>&nbsp;<span class="op" id="5226815">:=</span>&nbsp;<span class="builtintype" id="5226818">uint16</span><span class="op" id="5226824">(</span><span class="ident" id="5226825">cdat</span><span class="op" id="5226829">[</span><span class="num" id="5226830">6</span><span class="op" id="5226831">*</span><span class="ident" id="5226832">x</span><span class="op" id="5226833">+</span><span class="num" id="5226834">4</span><span class="op" id="5226835">]</span><span class="op" id="5226836">)</span><span class="op" id="5226837">&lt;&lt;</span><span class="num" id="5226839">8</span>&nbsp;<span class="op" id="5226841">|</span>&nbsp;<span class="builtintype" id="5226843">uint16</span><span class="op" id="5226849">(</span><span class="ident" id="5226850">cdat</span><span class="op" id="5226854">[</span><span class="num" id="5226855">6</span><span class="op" id="5226856">*</span><span class="ident" id="5226857">x</span><span class="op" id="5226858">+</span><span class="num" id="5226859">5</span><span class="op" id="5226860">]</span><span class="op" id="5226861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226867">rgba64</span><span class="op" id="5226873">.</span><span class="ident" id="5226874">SetRGBA64</span><span class="op" id="5226883">(</span><span class="ident" id="5226884">x</span><span class="op" id="5226885">,</span>&nbsp;<span class="ident" id="5226887">y</span><span class="op" id="5226888">,</span>&nbsp;<span class="ident" id="5226890">color</span><span class="op" id="5226895">.</span><span class="ident" id="5226896">RGBA64</span><span class="op" id="5226902">{</span><span class="ident" id="5226903">rcol</span><span class="op" id="5226907">,</span>&nbsp;<span class="ident" id="5226909">gcol</span><span class="op" id="5226913">,</span>&nbsp;<span class="ident" id="5226915">bcol</span><span class="op" id="5226919">,</span>&nbsp;<span class="num" id="5226921">0xffff</span><span class="op" id="5226927">}</span><span class="op" id="5226928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226933">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226937">case</span>&nbsp;<span class="ident" id="5226942">cbTCA16</span><span class="op" id="5226949">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226954">for</span>&nbsp;<span class="ident" id="5226958">x</span>&nbsp;<span class="op" id="5226960">:=</span>&nbsp;<span class="num" id="5226963">0</span><span class="op" id="5226964">;</span>&nbsp;<span class="ident" id="5226966">x</span>&nbsp;<span class="op" id="5226968">&lt;</span>&nbsp;<span class="ident" id="5226970">width</span><span class="op" id="5226975">;</span>&nbsp;<span class="ident" id="5226977">x</span><span class="op" id="5226978">++</span>&nbsp;<span class="op" id="5226981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226987">rcol</span>&nbsp;<span class="op" id="5226992">:=</span>&nbsp;<span class="builtintype" id="5226995">uint16</span><span class="op" id="5227001">(</span><span class="ident" id="5227002">cdat</span><span class="op" id="5227006">[</span><span class="num" id="5227007">8</span><span class="op" id="5227008">*</span><span class="ident" id="5227009">x</span><span class="op" id="5227010">+</span><span class="num" id="5227011">0</span><span class="op" id="5227012">]</span><span class="op" id="5227013">)</span><span class="op" id="5227014">&lt;&lt;</span><span class="num" id="5227016">8</span>&nbsp;<span class="op" id="5227018">|</span>&nbsp;<span class="builtintype" id="5227020">uint16</span><span class="op" id="5227026">(</span><span class="ident" id="5227027">cdat</span><span class="op" id="5227031">[</span><span class="num" id="5227032">8</span><span class="op" id="5227033">*</span><span class="ident" id="5227034">x</span><span class="op" id="5227035">+</span><span class="num" id="5227036">1</span><span class="op" id="5227037">]</span><span class="op" id="5227038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227044">gcol</span>&nbsp;<span class="op" id="5227049">:=</span>&nbsp;<span class="builtintype" id="5227052">uint16</span><span class="op" id="5227058">(</span><span class="ident" id="5227059">cdat</span><span class="op" id="5227063">[</span><span class="num" id="5227064">8</span><span class="op" id="5227065">*</span><span class="ident" id="5227066">x</span><span class="op" id="5227067">+</span><span class="num" id="5227068">2</span><span class="op" id="5227069">]</span><span class="op" id="5227070">)</span><span class="op" id="5227071">&lt;&lt;</span><span class="num" id="5227073">8</span>&nbsp;<span class="op" id="5227075">|</span>&nbsp;<span class="builtintype" id="5227077">uint16</span><span class="op" id="5227083">(</span><span class="ident" id="5227084">cdat</span><span class="op" id="5227088">[</span><span class="num" id="5227089">8</span><span class="op" id="5227090">*</span><span class="ident" id="5227091">x</span><span class="op" id="5227092">+</span><span class="num" id="5227093">3</span><span class="op" id="5227094">]</span><span class="op" id="5227095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227101">bcol</span>&nbsp;<span class="op" id="5227106">:=</span>&nbsp;<span class="builtintype" id="5227109">uint16</span><span class="op" id="5227115">(</span><span class="ident" id="5227116">cdat</span><span class="op" id="5227120">[</span><span class="num" id="5227121">8</span><span class="op" id="5227122">*</span><span class="ident" id="5227123">x</span><span class="op" id="5227124">+</span><span class="num" id="5227125">4</span><span class="op" id="5227126">]</span><span class="op" id="5227127">)</span><span class="op" id="5227128">&lt;&lt;</span><span class="num" id="5227130">8</span>&nbsp;<span class="op" id="5227132">|</span>&nbsp;<span class="builtintype" id="5227134">uint16</span><span class="op" id="5227140">(</span><span class="ident" id="5227141">cdat</span><span class="op" id="5227145">[</span><span class="num" id="5227146">8</span><span class="op" id="5227147">*</span><span class="ident" id="5227148">x</span><span class="op" id="5227149">+</span><span class="num" id="5227150">5</span><span class="op" id="5227151">]</span><span class="op" id="5227152">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227158">acol</span>&nbsp;<span class="op" id="5227163">:=</span>&nbsp;<span class="builtintype" id="5227166">uint16</span><span class="op" id="5227172">(</span><span class="ident" id="5227173">cdat</span><span class="op" id="5227177">[</span><span class="num" id="5227178">8</span><span class="op" id="5227179">*</span><span class="ident" id="5227180">x</span><span class="op" id="5227181">+</span><span class="num" id="5227182">6</span><span class="op" id="5227183">]</span><span class="op" id="5227184">)</span><span class="op" id="5227185">&lt;&lt;</span><span class="num" id="5227187">8</span>&nbsp;<span class="op" id="5227189">|</span>&nbsp;<span class="builtintype" id="5227191">uint16</span><span class="op" id="5227197">(</span><span class="ident" id="5227198">cdat</span><span class="op" id="5227202">[</span><span class="num" id="5227203">8</span><span class="op" id="5227204">*</span><span class="ident" id="5227205">x</span><span class="op" id="5227206">+</span><span class="num" id="5227207">7</span><span class="op" id="5227208">]</span><span class="op" id="5227209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227215">nrgba64</span><span class="op" id="5227222">.</span><span class="ident" id="5227223">SetNRGBA64</span><span class="op" id="5227233">(</span><span class="ident" id="5227234">x</span><span class="op" id="5227235">,</span>&nbsp;<span class="ident" id="5227237">y</span><span class="op" id="5227238">,</span>&nbsp;<span class="ident" id="5227240">color</span><span class="op" id="5227245">.</span><span class="ident" id="5227246">NRGBA64</span><span class="op" id="5227253">{</span><span class="ident" id="5227254">rcol</span><span class="op" id="5227258">,</span>&nbsp;<span class="ident" id="5227260">gcol</span><span class="op" id="5227264">,</span>&nbsp;<span class="ident" id="5227266">bcol</span><span class="op" id="5227270">,</span>&nbsp;<span class="ident" id="5227272">acol</span><span class="op" id="5227276">}</span><span class="op" id="5227277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227291">//&nbsp;The&nbsp;current&nbsp;row&nbsp;for&nbsp;y&nbsp;is&nbsp;the&nbsp;previous&nbsp;row&nbsp;for&nbsp;y+1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227347">pr</span><span class="op" id="5227349">,</span>&nbsp;<span class="ident" id="5227351">cr</span>&nbsp;<span class="op" id="5227354">=</span>&nbsp;<span class="ident" id="5227356">cr</span><span class="op" id="5227358">,</span>&nbsp;<span class="ident" id="5227360">pr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227368">return</span>&nbsp;<span class="ident" id="5227375">img</span><span class="op" id="5227378">,</span>&nbsp;<span class="builtintype" id="5227380">nil</span><br>
<span class="lineno">585</span><span class="op" id="5227384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5227387">//&nbsp;mergePassInto&nbsp;merges&nbsp;a&nbsp;single&nbsp;pass&nbsp;into&nbsp;a&nbsp;full&nbsp;sized&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5227450">func</span>&nbsp;<span class="op" id="5227455">(</span><span class="ident" id="5227456">d</span>&nbsp;<span class="op" id="5227458">*</span><span class="ident" id="5227459">decoder</span><span class="op" id="5227466">)</span>&nbsp;<span class="ident" id="5227468">mergePassInto</span><span class="op" id="5227481">(</span><span class="ident" id="5227482">dst</span>&nbsp;<span class="ident" id="5227486">image</span><span class="op" id="5227491">.</span><span class="ident" id="5227492">Image</span><span class="op" id="5227497">,</span>&nbsp;<span class="ident" id="5227499">src</span>&nbsp;<span class="ident" id="5227503">image</span><span class="op" id="5227508">.</span><span class="ident" id="5227509">Image</span><span class="op" id="5227514">,</span>&nbsp;<span class="ident" id="5227516">pass</span>&nbsp;<span class="builtintype" id="5227521">int</span><span class="op" id="5227524">)</span>&nbsp;<span class="op" id="5227526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227529">p</span>&nbsp;<span class="op" id="5227531">:=</span>&nbsp;<span class="ident" id="5227534">interlacing</span><span class="op" id="5227545">[</span><span class="ident" id="5227546">pass</span><span class="op" id="5227550">]</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227553">var</span>&nbsp;<span class="op" id="5227557">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227561">srcPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227575">[</span><span class="op" id="5227576">]</span><span class="builtintype" id="5227577">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227585">dstPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227599">[</span><span class="op" id="5227600">]</span><span class="builtintype" id="5227601">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227609">stride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5227623">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227629">rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227643">image</span><span class="op" id="5227648">.</span><span class="ident" id="5227649">Rectangle</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227661">bytesPerPixel</span>&nbsp;<span class="builtintype" id="5227675">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227683">switch</span>&nbsp;<span class="ident" id="5227690">target</span>&nbsp;<span class="op" id="5227697">:=</span>&nbsp;<span class="ident" id="5227700">dst</span><span class="op" id="5227703">.</span><span class="op" id="5227704">(</span><span class="keyword" id="5227705">type</span><span class="op" id="5227709">)</span>&nbsp;<span class="op" id="5227711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227714">case</span>&nbsp;<span class="op" id="5227719">*</span><span class="ident" id="5227720">image</span><span class="op" id="5227725">.</span><span class="ident" id="5227726">Alpha</span><span class="op" id="5227731">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227735">srcPix</span>&nbsp;<span class="op" id="5227742">=</span>&nbsp;<span class="ident" id="5227744">src</span><span class="op" id="5227747">.</span><span class="op" id="5227748">(</span><span class="op" id="5227749">*</span><span class="ident" id="5227750">image</span><span class="op" id="5227755">.</span><span class="ident" id="5227756">Alpha</span><span class="op" id="5227761">)</span><span class="op" id="5227762">.</span><span class="ident" id="5227763">Pix</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227769">dstPix</span><span class="op" id="5227775">,</span>&nbsp;<span class="ident" id="5227777">stride</span><span class="op" id="5227783">,</span>&nbsp;<span class="ident" id="5227785">rect</span>&nbsp;<span class="op" id="5227790">=</span>&nbsp;<span class="ident" id="5227792">target</span><span class="op" id="5227798">.</span><span class="ident" id="5227799">Pix</span><span class="op" id="5227802">,</span>&nbsp;<span class="ident" id="5227804">target</span><span class="op" id="5227810">.</span><span class="ident" id="5227811">Stride</span><span class="op" id="5227817">,</span>&nbsp;<span class="ident" id="5227819">target</span><span class="op" id="5227825">.</span><span class="ident" id="5227826">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227833">bytesPerPixel</span>&nbsp;<span class="op" id="5227847">=</span>&nbsp;<span class="num" id="5227849">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227852">case</span>&nbsp;<span class="op" id="5227857">*</span><span class="ident" id="5227858">image</span><span class="op" id="5227863">.</span><span class="ident" id="5227864">Alpha16</span><span class="op" id="5227871">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227875">srcPix</span>&nbsp;<span class="op" id="5227882">=</span>&nbsp;<span class="ident" id="5227884">src</span><span class="op" id="5227887">.</span><span class="op" id="5227888">(</span><span class="op" id="5227889">*</span><span class="ident" id="5227890">image</span><span class="op" id="5227895">.</span><span class="ident" id="5227896">Alpha16</span><span class="op" id="5227903">)</span><span class="op" id="5227904">.</span><span class="ident" id="5227905">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227911">dstPix</span><span class="op" id="5227917">,</span>&nbsp;<span class="ident" id="5227919">stride</span><span class="op" id="5227925">,</span>&nbsp;<span class="ident" id="5227927">rect</span>&nbsp;<span class="op" id="5227932">=</span>&nbsp;<span class="ident" id="5227934">target</span><span class="op" id="5227940">.</span><span class="ident" id="5227941">Pix</span><span class="op" id="5227944">,</span>&nbsp;<span class="ident" id="5227946">target</span><span class="op" id="5227952">.</span><span class="ident" id="5227953">Stride</span><span class="op" id="5227959">,</span>&nbsp;<span class="ident" id="5227961">target</span><span class="op" id="5227967">.</span><span class="ident" id="5227968">Rect</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227975">bytesPerPixel</span>&nbsp;<span class="op" id="5227989">=</span>&nbsp;<span class="num" id="5227991">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227994">case</span>&nbsp;<span class="op" id="5227999">*</span><span class="ident" id="5228000">image</span><span class="op" id="5228005">.</span><span class="ident" id="5228006">Gray</span><span class="op" id="5228010">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228014">srcPix</span>&nbsp;<span class="op" id="5228021">=</span>&nbsp;<span class="ident" id="5228023">src</span><span class="op" id="5228026">.</span><span class="op" id="5228027">(</span><span class="op" id="5228028">*</span><span class="ident" id="5228029">image</span><span class="op" id="5228034">.</span><span class="ident" id="5228035">Gray</span><span class="op" id="5228039">)</span><span class="op" id="5228040">.</span><span class="ident" id="5228041">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228047">dstPix</span><span class="op" id="5228053">,</span>&nbsp;<span class="ident" id="5228055">stride</span><span class="op" id="5228061">,</span>&nbsp;<span class="ident" id="5228063">rect</span>&nbsp;<span class="op" id="5228068">=</span>&nbsp;<span class="ident" id="5228070">target</span><span class="op" id="5228076">.</span><span class="ident" id="5228077">Pix</span><span class="op" id="5228080">,</span>&nbsp;<span class="ident" id="5228082">target</span><span class="op" id="5228088">.</span><span class="ident" id="5228089">Stride</span><span class="op" id="5228095">,</span>&nbsp;<span class="ident" id="5228097">target</span><span class="op" id="5228103">.</span><span class="ident" id="5228104">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228111">bytesPerPixel</span>&nbsp;<span class="op" id="5228125">=</span>&nbsp;<span class="num" id="5228127">1</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228130">case</span>&nbsp;<span class="op" id="5228135">*</span><span class="ident" id="5228136">image</span><span class="op" id="5228141">.</span><span class="ident" id="5228142">Gray16</span><span class="op" id="5228148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228152">srcPix</span>&nbsp;<span class="op" id="5228159">=</span>&nbsp;<span class="ident" id="5228161">src</span><span class="op" id="5228164">.</span><span class="op" id="5228165">(</span><span class="op" id="5228166">*</span><span class="ident" id="5228167">image</span><span class="op" id="5228172">.</span><span class="ident" id="5228173">Gray16</span><span class="op" id="5228179">)</span><span class="op" id="5228180">.</span><span class="ident" id="5228181">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228187">dstPix</span><span class="op" id="5228193">,</span>&nbsp;<span class="ident" id="5228195">stride</span><span class="op" id="5228201">,</span>&nbsp;<span class="ident" id="5228203">rect</span>&nbsp;<span class="op" id="5228208">=</span>&nbsp;<span class="ident" id="5228210">target</span><span class="op" id="5228216">.</span><span class="ident" id="5228217">Pix</span><span class="op" id="5228220">,</span>&nbsp;<span class="ident" id="5228222">target</span><span class="op" id="5228228">.</span><span class="ident" id="5228229">Stride</span><span class="op" id="5228235">,</span>&nbsp;<span class="ident" id="5228237">target</span><span class="op" id="5228243">.</span><span class="ident" id="5228244">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228251">bytesPerPixel</span>&nbsp;<span class="op" id="5228265">=</span>&nbsp;<span class="num" id="5228267">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228270">case</span>&nbsp;<span class="op" id="5228275">*</span><span class="ident" id="5228276">image</span><span class="op" id="5228281">.</span><span class="ident" id="5228282">NRGBA</span><span class="op" id="5228287">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228291">srcPix</span>&nbsp;<span class="op" id="5228298">=</span>&nbsp;<span class="ident" id="5228300">src</span><span class="op" id="5228303">.</span><span class="op" id="5228304">(</span><span class="op" id="5228305">*</span><span class="ident" id="5228306">image</span><span class="op" id="5228311">.</span><span class="ident" id="5228312">NRGBA</span><span class="op" id="5228317">)</span><span class="op" id="5228318">.</span><span class="ident" id="5228319">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228325">dstPix</span><span class="op" id="5228331">,</span>&nbsp;<span class="ident" id="5228333">stride</span><span class="op" id="5228339">,</span>&nbsp;<span class="ident" id="5228341">rect</span>&nbsp;<span class="op" id="5228346">=</span>&nbsp;<span class="ident" id="5228348">target</span><span class="op" id="5228354">.</span><span class="ident" id="5228355">Pix</span><span class="op" id="5228358">,</span>&nbsp;<span class="ident" id="5228360">target</span><span class="op" id="5228366">.</span><span class="ident" id="5228367">Stride</span><span class="op" id="5228373">,</span>&nbsp;<span class="ident" id="5228375">target</span><span class="op" id="5228381">.</span><span class="ident" id="5228382">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228389">bytesPerPixel</span>&nbsp;<span class="op" id="5228403">=</span>&nbsp;<span class="num" id="5228405">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228408">case</span>&nbsp;<span class="op" id="5228413">*</span><span class="ident" id="5228414">image</span><span class="op" id="5228419">.</span><span class="ident" id="5228420">NRGBA64</span><span class="op" id="5228427">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228431">srcPix</span>&nbsp;<span class="op" id="5228438">=</span>&nbsp;<span class="ident" id="5228440">src</span><span class="op" id="5228443">.</span><span class="op" id="5228444">(</span><span class="op" id="5228445">*</span><span class="ident" id="5228446">image</span><span class="op" id="5228451">.</span><span class="ident" id="5228452">NRGBA64</span><span class="op" id="5228459">)</span><span class="op" id="5228460">.</span><span class="ident" id="5228461">Pix</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228467">dstPix</span><span class="op" id="5228473">,</span>&nbsp;<span class="ident" id="5228475">stride</span><span class="op" id="5228481">,</span>&nbsp;<span class="ident" id="5228483">rect</span>&nbsp;<span class="op" id="5228488">=</span>&nbsp;<span class="ident" id="5228490">target</span><span class="op" id="5228496">.</span><span class="ident" id="5228497">Pix</span><span class="op" id="5228500">,</span>&nbsp;<span class="ident" id="5228502">target</span><span class="op" id="5228508">.</span><span class="ident" id="5228509">Stride</span><span class="op" id="5228515">,</span>&nbsp;<span class="ident" id="5228517">target</span><span class="op" id="5228523">.</span><span class="ident" id="5228524">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228531">bytesPerPixel</span>&nbsp;<span class="op" id="5228545">=</span>&nbsp;<span class="num" id="5228547">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228550">case</span>&nbsp;<span class="op" id="5228555">*</span><span class="ident" id="5228556">image</span><span class="op" id="5228561">.</span><span class="ident" id="5228562">Paletted</span><span class="op" id="5228570">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228574">srcPix</span>&nbsp;<span class="op" id="5228581">=</span>&nbsp;<span class="ident" id="5228583">src</span><span class="op" id="5228586">.</span><span class="op" id="5228587">(</span><span class="op" id="5228588">*</span><span class="ident" id="5228589">image</span><span class="op" id="5228594">.</span><span class="ident" id="5228595">Paletted</span><span class="op" id="5228603">)</span><span class="op" id="5228604">.</span><span class="ident" id="5228605">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228611">dstPix</span><span class="op" id="5228617">,</span>&nbsp;<span class="ident" id="5228619">stride</span><span class="op" id="5228625">,</span>&nbsp;<span class="ident" id="5228627">rect</span>&nbsp;<span class="op" id="5228632">=</span>&nbsp;<span class="ident" id="5228634">target</span><span class="op" id="5228640">.</span><span class="ident" id="5228641">Pix</span><span class="op" id="5228644">,</span>&nbsp;<span class="ident" id="5228646">target</span><span class="op" id="5228652">.</span><span class="ident" id="5228653">Stride</span><span class="op" id="5228659">,</span>&nbsp;<span class="ident" id="5228661">target</span><span class="op" id="5228667">.</span><span class="ident" id="5228668">Rect</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228675">bytesPerPixel</span>&nbsp;<span class="op" id="5228689">=</span>&nbsp;<span class="num" id="5228691">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228694">case</span>&nbsp;<span class="op" id="5228699">*</span><span class="ident" id="5228700">image</span><span class="op" id="5228705">.</span><span class="ident" id="5228706">RGBA</span><span class="op" id="5228710">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228714">srcPix</span>&nbsp;<span class="op" id="5228721">=</span>&nbsp;<span class="ident" id="5228723">src</span><span class="op" id="5228726">.</span><span class="op" id="5228727">(</span><span class="op" id="5228728">*</span><span class="ident" id="5228729">image</span><span class="op" id="5228734">.</span><span class="ident" id="5228735">RGBA</span><span class="op" id="5228739">)</span><span class="op" id="5228740">.</span><span class="ident" id="5228741">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228747">dstPix</span><span class="op" id="5228753">,</span>&nbsp;<span class="ident" id="5228755">stride</span><span class="op" id="5228761">,</span>&nbsp;<span class="ident" id="5228763">rect</span>&nbsp;<span class="op" id="5228768">=</span>&nbsp;<span class="ident" id="5228770">target</span><span class="op" id="5228776">.</span><span class="ident" id="5228777">Pix</span><span class="op" id="5228780">,</span>&nbsp;<span class="ident" id="5228782">target</span><span class="op" id="5228788">.</span><span class="ident" id="5228789">Stride</span><span class="op" id="5228795">,</span>&nbsp;<span class="ident" id="5228797">target</span><span class="op" id="5228803">.</span><span class="ident" id="5228804">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228811">bytesPerPixel</span>&nbsp;<span class="op" id="5228825">=</span>&nbsp;<span class="num" id="5228827">4</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228830">case</span>&nbsp;<span class="op" id="5228835">*</span><span class="ident" id="5228836">image</span><span class="op" id="5228841">.</span><span class="ident" id="5228842">RGBA64</span><span class="op" id="5228848">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228852">srcPix</span>&nbsp;<span class="op" id="5228859">=</span>&nbsp;<span class="ident" id="5228861">src</span><span class="op" id="5228864">.</span><span class="op" id="5228865">(</span><span class="op" id="5228866">*</span><span class="ident" id="5228867">image</span><span class="op" id="5228872">.</span><span class="ident" id="5228873">RGBA64</span><span class="op" id="5228879">)</span><span class="op" id="5228880">.</span><span class="ident" id="5228881">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228887">dstPix</span><span class="op" id="5228893">,</span>&nbsp;<span class="ident" id="5228895">stride</span><span class="op" id="5228901">,</span>&nbsp;<span class="ident" id="5228903">rect</span>&nbsp;<span class="op" id="5228908">=</span>&nbsp;<span class="ident" id="5228910">target</span><span class="op" id="5228916">.</span><span class="ident" id="5228917">Pix</span><span class="op" id="5228920">,</span>&nbsp;<span class="ident" id="5228922">target</span><span class="op" id="5228928">.</span><span class="ident" id="5228929">Stride</span><span class="op" id="5228935">,</span>&nbsp;<span class="ident" id="5228937">target</span><span class="op" id="5228943">.</span><span class="ident" id="5228944">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228951">bytesPerPixel</span>&nbsp;<span class="op" id="5228965">=</span>&nbsp;<span class="num" id="5228967">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5228970">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228973">s</span><span class="op" id="5228974">,</span>&nbsp;<span class="ident" id="5228976">bounds</span>&nbsp;<span class="op" id="5228983">:=</span>&nbsp;<span class="num" id="5228986">0</span><span class="op" id="5228987">,</span>&nbsp;<span class="ident" id="5228989">src</span><span class="op" id="5228992">.</span><span class="ident" id="5228993">Bounds</span><span class="op" id="5228999">(</span><span class="op" id="5229000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229003">for</span>&nbsp;<span class="ident" id="5229007">y</span>&nbsp;<span class="op" id="5229009">:=</span>&nbsp;<span class="ident" id="5229012">bounds</span><span class="op" id="5229018">.</span><span class="ident" id="5229019">Min</span><span class="op" id="5229022">.</span><span class="ident" id="5229023">Y</span><span class="op" id="5229024">;</span>&nbsp;<span class="ident" id="5229026">y</span>&nbsp;<span class="op" id="5229028">&lt;</span>&nbsp;<span class="ident" id="5229030">bounds</span><span class="op" id="5229036">.</span><span class="ident" id="5229037">Max</span><span class="op" id="5229040">.</span><span class="ident" id="5229041">Y</span><span class="op" id="5229042">;</span>&nbsp;<span class="ident" id="5229044">y</span><span class="op" id="5229045">++</span>&nbsp;<span class="op" id="5229048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229052">dBase</span>&nbsp;<span class="op" id="5229058">:=</span>&nbsp;<span class="op" id="5229061">(</span><span class="ident" id="5229062">y</span><span class="op" id="5229063">*</span><span class="ident" id="5229064">p</span><span class="op" id="5229065">.</span><span class="ident" id="5229066">yFactor</span><span class="op" id="5229073">+</span><span class="ident" id="5229074">p</span><span class="op" id="5229075">.</span><span class="ident" id="5229076">yOffset</span><span class="op" id="5229083">-</span><span class="ident" id="5229084">rect</span><span class="op" id="5229088">.</span><span class="ident" id="5229089">Min</span><span class="op" id="5229092">.</span><span class="ident" id="5229093">Y</span><span class="op" id="5229094">)</span><span class="op" id="5229095">*</span><span class="ident" id="5229096">stride</span>&nbsp;<span class="op" id="5229103">+</span>&nbsp;<span class="op" id="5229105">(</span><span class="ident" id="5229106">p</span><span class="op" id="5229107">.</span><span class="ident" id="5229108">xOffset</span><span class="op" id="5229115">-</span><span class="ident" id="5229116">rect</span><span class="op" id="5229120">.</span><span class="ident" id="5229121">Min</span><span class="op" id="5229124">.</span><span class="ident" id="5229125">X</span><span class="op" id="5229126">)</span><span class="op" id="5229127">*</span><span class="ident" id="5229128">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229144">for</span>&nbsp;<span class="ident" id="5229148">x</span>&nbsp;<span class="op" id="5229150">:=</span>&nbsp;<span class="ident" id="5229153">bounds</span><span class="op" id="5229159">.</span><span class="ident" id="5229160">Min</span><span class="op" id="5229163">.</span><span class="ident" id="5229164">X</span><span class="op" id="5229165">;</span>&nbsp;<span class="ident" id="5229167">x</span>&nbsp;<span class="op" id="5229169">&lt;</span>&nbsp;<span class="ident" id="5229171">bounds</span><span class="op" id="5229177">.</span><span class="ident" id="5229178">Max</span><span class="op" id="5229181">.</span><span class="ident" id="5229182">X</span><span class="op" id="5229183">;</span>&nbsp;<span class="ident" id="5229185">x</span><span class="op" id="5229186">++</span>&nbsp;<span class="op" id="5229189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229194">d</span>&nbsp;<span class="op" id="5229196">:=</span>&nbsp;<span class="ident" id="5229199">dBase</span>&nbsp;<span class="op" id="5229205">+</span>&nbsp;<span class="ident" id="5229207">x</span><span class="op" id="5229208">*</span><span class="ident" id="5229209">p</span><span class="op" id="5229210">.</span><span class="ident" id="5229211">xFactor</span><span class="op" id="5229218">*</span><span class="ident" id="5229219">bytesPerPixel</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5229236">copy</span><span class="op" id="5229240">(</span><span class="ident" id="5229241">dstPix</span><span class="op" id="5229247">[</span><span class="ident" id="5229248">d</span><span class="op" id="5229249">:</span><span class="op" id="5229250">]</span><span class="op" id="5229251">,</span>&nbsp;<span class="ident" id="5229253">srcPix</span><span class="op" id="5229259">[</span><span class="ident" id="5229260">s</span><span class="op" id="5229261">:</span><span class="ident" id="5229262">s</span><span class="op" id="5229263">+</span><span class="ident" id="5229264">bytesPerPixel</span><span class="op" id="5229277">]</span><span class="op" id="5229278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229283">s</span>&nbsp;<span class="op" id="5229285">+=</span>&nbsp;<span class="ident" id="5229288">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229307">}</span><br>
<span class="lineno"></span><span class="op" id="5229309">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span><span class="keyword" id="5229312">func</span>&nbsp;<span class="op" id="5229317">(</span><span class="ident" id="5229318">d</span>&nbsp;<span class="op" id="5229320">*</span><span class="ident" id="5229321">decoder</span><span class="op" id="5229328">)</span>&nbsp;<span class="ident" id="5229330">parseIDAT</span><span class="op" id="5229339">(</span><span class="ident" id="5229340">length</span>&nbsp;<span class="builtintype" id="5229347">uint32</span><span class="op" id="5229353">)</span>&nbsp;<span class="op" id="5229355">(</span><span class="ident" id="5229356">err</span>&nbsp;<span class="builtintype" id="5229360">error</span><span class="op" id="5229365">)</span>&nbsp;<span class="op" id="5229367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229370">d</span><span class="op" id="5229371">.</span><span class="ident" id="5229372">idatLength</span>&nbsp;<span class="op" id="5229383">=</span>&nbsp;<span class="ident" id="5229385">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229393">d</span><span class="op" id="5229394">.</span><span class="ident" id="5229395">img</span><span class="op" id="5229398">,</span>&nbsp;<span class="ident" id="5229400">err</span>&nbsp;<span class="op" id="5229404">=</span>&nbsp;<span class="ident" id="5229406">d</span><span class="op" id="5229407">.</span><span class="ident" id="5229408">decode</span><span class="op" id="5229414">(</span><span class="op" id="5229415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229418">if</span>&nbsp;<span class="ident" id="5229421">err</span>&nbsp;<span class="op" id="5229425">!=</span>&nbsp;<span class="builtintype" id="5229428">nil</span>&nbsp;<span class="op" id="5229432">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229436">return</span>&nbsp;<span class="ident" id="5229443">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229451">return</span>&nbsp;<span class="ident" id="5229458">d</span><span class="op" id="5229459">.</span><span class="ident" id="5229460">verifyChecksum</span><span class="op" id="5229474">(</span><span class="op" id="5229475">)</span><br>
<span class="lineno"></span><span class="op" id="5229477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">655</span><span class="keyword" id="5229480">func</span>&nbsp;<span class="op" id="5229485">(</span><span class="ident" id="5229486">d</span>&nbsp;<span class="op" id="5229488">*</span><span class="ident" id="5229489">decoder</span><span class="op" id="5229496">)</span>&nbsp;<span class="ident" id="5229498">parseIEND</span><span class="op" id="5229507">(</span><span class="ident" id="5229508">length</span>&nbsp;<span class="builtintype" id="5229515">uint32</span><span class="op" id="5229521">)</span>&nbsp;<span class="builtintype" id="5229523">error</span>&nbsp;<span class="op" id="5229529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229532">if</span>&nbsp;<span class="ident" id="5229535">length</span>&nbsp;<span class="op" id="5229542">!=</span>&nbsp;<span class="num" id="5229545">0</span>&nbsp;<span class="op" id="5229547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229551">return</span>&nbsp;<span class="ident" id="5229558">FormatError</span><span class="op" id="5229569">(</span><span class="string" id="5229570">&#34;bad&nbsp;IEND&nbsp;length&#34;</span><span class="op" id="5229587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229593">return</span>&nbsp;<span class="ident" id="5229600">d</span><span class="op" id="5229601">.</span><span class="ident" id="5229602">verifyChecksum</span><span class="op" id="5229616">(</span><span class="op" id="5229617">)</span><br>
<span class="lineno">660</span><span class="op" id="5229619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5229622">func</span>&nbsp;<span class="op" id="5229627">(</span><span class="ident" id="5229628">d</span>&nbsp;<span class="op" id="5229630">*</span><span class="ident" id="5229631">decoder</span><span class="op" id="5229638">)</span>&nbsp;<span class="ident" id="5229640">parseChunk</span><span class="op" id="5229650">(</span><span class="op" id="5229651">)</span>&nbsp;<span class="builtintype" id="5229653">error</span>&nbsp;<span class="op" id="5229659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5229662">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229698">n</span><span class="op" id="5229699">,</span>&nbsp;<span class="ident" id="5229701">err</span>&nbsp;<span class="op" id="5229705">:=</span>&nbsp;<span class="ident" id="5229708">io</span><span class="op" id="5229710">.</span><span class="ident" id="5229711">ReadFull</span><span class="op" id="5229719">(</span><span class="ident" id="5229720">d</span><span class="op" id="5229721">.</span><span class="ident" id="5229722">r</span><span class="op" id="5229723">,</span>&nbsp;<span class="ident" id="5229725">d</span><span class="op" id="5229726">.</span><span class="ident" id="5229727">tmp</span><span class="op" id="5229730">[</span><span class="op" id="5229731">:</span><span class="num" id="5229732">8</span><span class="op" id="5229733">]</span><span class="op" id="5229734">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229737">if</span>&nbsp;<span class="ident" id="5229740">err</span>&nbsp;<span class="op" id="5229744">!=</span>&nbsp;<span class="builtintype" id="5229747">nil</span>&nbsp;<span class="op" id="5229751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229755">return</span>&nbsp;<span class="ident" id="5229762">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229770">length</span>&nbsp;<span class="op" id="5229777">:=</span>&nbsp;<span class="ident" id="5229780">binary</span><span class="op" id="5229786">.</span><span class="ident" id="5229787">BigEndian</span><span class="op" id="5229796">.</span><span class="ident" id="5229797">Uint32</span><span class="op" id="5229803">(</span><span class="ident" id="5229804">d</span><span class="op" id="5229805">.</span><span class="ident" id="5229806">tmp</span><span class="op" id="5229809">[</span><span class="op" id="5229810">:</span><span class="num" id="5229811">4</span><span class="op" id="5229812">]</span><span class="op" id="5229813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229816">d</span><span class="op" id="5229817">.</span><span class="ident" id="5229818">crc</span><span class="op" id="5229821">.</span><span class="ident" id="5229822">Reset</span><span class="op" id="5229827">(</span><span class="op" id="5229828">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229831">d</span><span class="op" id="5229832">.</span><span class="ident" id="5229833">crc</span><span class="op" id="5229836">.</span><span class="ident" id="5229837">Write</span><span class="op" id="5229842">(</span><span class="ident" id="5229843">d</span><span class="op" id="5229844">.</span><span class="ident" id="5229845">tmp</span><span class="op" id="5229848">[</span><span class="num" id="5229849">4</span><span class="op" id="5229850">:</span><span class="num" id="5229851">8</span><span class="op" id="5229852">]</span><span class="op" id="5229853">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5229857">//&nbsp;Read&nbsp;the&nbsp;chunk&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229882">switch</span>&nbsp;<span class="builtintype" id="5229889">string</span><span class="op" id="5229895">(</span><span class="ident" id="5229896">d</span><span class="op" id="5229897">.</span><span class="ident" id="5229898">tmp</span><span class="op" id="5229901">[</span><span class="num" id="5229902">4</span><span class="op" id="5229903">:</span><span class="num" id="5229904">8</span><span class="op" id="5229905">]</span><span class="op" id="5229906">)</span>&nbsp;<span class="op" id="5229908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229911">case</span>&nbsp;<span class="string" id="5229916">&#34;IHDR&#34;</span><span class="op" id="5229922">:</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229926">if</span>&nbsp;<span class="ident" id="5229929">d</span><span class="op" id="5229930">.</span><span class="ident" id="5229931">stage</span>&nbsp;<span class="op" id="5229937">!=</span>&nbsp;<span class="ident" id="5229940">dsStart</span>&nbsp;<span class="op" id="5229948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229953">return</span>&nbsp;<span class="ident" id="5229960">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229982">d</span><span class="op" id="5229983">.</span><span class="ident" id="5229984">stage</span>&nbsp;<span class="op" id="5229990">=</span>&nbsp;<span class="ident" id="5229992">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230005">return</span>&nbsp;<span class="ident" id="5230012">d</span><span class="op" id="5230013">.</span><span class="ident" id="5230014">parseIHDR</span><span class="op" id="5230023">(</span><span class="ident" id="5230024">length</span><span class="op" id="5230030">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230033">case</span>&nbsp;<span class="string" id="5230038">&#34;PLTE&#34;</span><span class="op" id="5230044">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230048">if</span>&nbsp;<span class="ident" id="5230051">d</span><span class="op" id="5230052">.</span><span class="ident" id="5230053">stage</span>&nbsp;<span class="op" id="5230059">!=</span>&nbsp;<span class="ident" id="5230062">dsSeenIHDR</span>&nbsp;<span class="op" id="5230073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230078">return</span>&nbsp;<span class="ident" id="5230085">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5230103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230107">d</span><span class="op" id="5230108">.</span><span class="ident" id="5230109">stage</span>&nbsp;<span class="op" id="5230115">=</span>&nbsp;<span class="ident" id="5230117">dsSeenPLTE</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230130">return</span>&nbsp;<span class="ident" id="5230137">d</span><span class="op" id="5230138">.</span><span class="ident" id="5230139">parsePLTE</span><span class="op" id="5230148">(</span><span class="ident" id="5230149">length</span><span class="op" id="5230155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230158">case</span>&nbsp;<span class="string" id="5230163">&#34;tRNS&#34;</span><span class="op" id="5230169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230173">if</span>&nbsp;<span class="ident" id="5230176">d</span><span class="op" id="5230177">.</span><span class="ident" id="5230178">stage</span>&nbsp;<span class="op" id="5230184">!=</span>&nbsp;<span class="ident" id="5230187">dsSeenPLTE</span>&nbsp;<span class="op" id="5230198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230203">return</span>&nbsp;<span class="ident" id="5230210">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5230228">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230232">return</span>&nbsp;<span class="ident" id="5230239">d</span><span class="op" id="5230240">.</span><span class="ident" id="5230241">parsetRNS</span><span class="op" id="5230250">(</span><span class="ident" id="5230251">length</span><span class="op" id="5230257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230260">case</span>&nbsp;<span class="string" id="5230265">&#34;IDAT&#34;</span><span class="op" id="5230271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230275">if</span>&nbsp;<span class="ident" id="5230278">d</span><span class="op" id="5230279">.</span><span class="ident" id="5230280">stage</span>&nbsp;<span class="op" id="5230286">&lt;</span>&nbsp;<span class="ident" id="5230288">dsSeenIHDR</span>&nbsp;<span class="op" id="5230299">||</span>&nbsp;<span class="ident" id="5230302">d</span><span class="op" id="5230303">.</span><span class="ident" id="5230304">stage</span>&nbsp;<span class="op" id="5230310">&gt;</span>&nbsp;<span class="ident" id="5230312">dsSeenIDAT</span>&nbsp;<span class="op" id="5230323">||</span>&nbsp;<span class="op" id="5230326">(</span><span class="ident" id="5230327">d</span><span class="op" id="5230328">.</span><span class="ident" id="5230329">cb</span>&nbsp;<span class="op" id="5230332">==</span>&nbsp;<span class="ident" id="5230335">cbP8</span>&nbsp;<span class="op" id="5230340">&amp;&amp;</span>&nbsp;<span class="ident" id="5230343">d</span><span class="op" id="5230344">.</span><span class="ident" id="5230345">stage</span>&nbsp;<span class="op" id="5230351">==</span>&nbsp;<span class="ident" id="5230354">dsSeenIHDR</span><span class="op" id="5230364">)</span>&nbsp;<span class="op" id="5230366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230371">return</span>&nbsp;<span class="ident" id="5230378">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5230396">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230400">d</span><span class="op" id="5230401">.</span><span class="ident" id="5230402">stage</span>&nbsp;<span class="op" id="5230408">=</span>&nbsp;<span class="ident" id="5230410">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230423">return</span>&nbsp;<span class="ident" id="5230430">d</span><span class="op" id="5230431">.</span><span class="ident" id="5230432">parseIDAT</span><span class="op" id="5230441">(</span><span class="ident" id="5230442">length</span><span class="op" id="5230448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230451">case</span>&nbsp;<span class="string" id="5230456">&#34;IEND&#34;</span><span class="op" id="5230462">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230466">if</span>&nbsp;<span class="ident" id="5230469">d</span><span class="op" id="5230470">.</span><span class="ident" id="5230471">stage</span>&nbsp;<span class="op" id="5230477">!=</span>&nbsp;<span class="ident" id="5230480">dsSeenIDAT</span>&nbsp;<span class="op" id="5230491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230496">return</span>&nbsp;<span class="ident" id="5230503">chunkOrderError</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5230521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230525">d</span><span class="op" id="5230526">.</span><span class="ident" id="5230527">stage</span>&nbsp;<span class="op" id="5230533">=</span>&nbsp;<span class="ident" id="5230535">dsSeenIEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230548">return</span>&nbsp;<span class="ident" id="5230555">d</span><span class="op" id="5230556">.</span><span class="ident" id="5230557">parseIEND</span><span class="op" id="5230566">(</span><span class="ident" id="5230567">length</span><span class="op" id="5230573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5230576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5230579">//&nbsp;Ignore&nbsp;this&nbsp;chunk&nbsp;(of&nbsp;a&nbsp;known&nbsp;length).</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230622">var</span>&nbsp;<span class="ident" id="5230626">ignored</span>&nbsp;<span class="op" id="5230634">[</span><span class="num" id="5230635">4096</span><span class="op" id="5230639">]</span><span class="builtintype" id="5230640">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230646">for</span>&nbsp;<span class="ident" id="5230650">length</span>&nbsp;<span class="op" id="5230657">&gt;</span>&nbsp;<span class="num" id="5230659">0</span>&nbsp;<span class="op" id="5230661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230665">n</span><span class="op" id="5230666">,</span>&nbsp;<span class="ident" id="5230668">err</span>&nbsp;<span class="op" id="5230672">=</span>&nbsp;<span class="ident" id="5230674">io</span><span class="op" id="5230676">.</span><span class="ident" id="5230677">ReadFull</span><span class="op" id="5230685">(</span><span class="ident" id="5230686">d</span><span class="op" id="5230687">.</span><span class="ident" id="5230688">r</span><span class="op" id="5230689">,</span>&nbsp;<span class="ident" id="5230691">ignored</span><span class="op" id="5230698">[</span><span class="op" id="5230699">:</span><span class="ident" id="5230700">min</span><span class="op" id="5230703">(</span><span class="builtinfunc" id="5230704">len</span><span class="op" id="5230707">(</span><span class="ident" id="5230708">ignored</span><span class="op" id="5230715">)</span><span class="op" id="5230716">,</span>&nbsp;<span class="builtintype" id="5230718">int</span><span class="op" id="5230721">(</span><span class="ident" id="5230722">length</span><span class="op" id="5230728">)</span><span class="op" id="5230729">)</span><span class="op" id="5230730">]</span><span class="op" id="5230731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230735">if</span>&nbsp;<span class="ident" id="5230738">err</span>&nbsp;<span class="op" id="5230742">!=</span>&nbsp;<span class="builtintype" id="5230745">nil</span>&nbsp;<span class="op" id="5230749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230754">return</span>&nbsp;<span class="ident" id="5230761">err</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5230767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230771">d</span><span class="op" id="5230772">.</span><span class="ident" id="5230773">crc</span><span class="op" id="5230776">.</span><span class="ident" id="5230777">Write</span><span class="op" id="5230782">(</span><span class="ident" id="5230783">ignored</span><span class="op" id="5230790">[</span><span class="op" id="5230791">:</span><span class="ident" id="5230792">n</span><span class="op" id="5230793">]</span><span class="op" id="5230794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230798">length</span>&nbsp;<span class="op" id="5230805">-=</span>&nbsp;<span class="builtintype" id="5230808">uint32</span><span class="op" id="5230814">(</span><span class="ident" id="5230815">n</span><span class="op" id="5230816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5230819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230822">return</span>&nbsp;<span class="ident" id="5230829">d</span><span class="op" id="5230830">.</span><span class="ident" id="5230831">verifyChecksum</span><span class="op" id="5230845">(</span><span class="op" id="5230846">)</span><br>
<span class="lineno">715</span><span class="op" id="5230848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5230851">func</span>&nbsp;<span class="op" id="5230856">(</span><span class="ident" id="5230857">d</span>&nbsp;<span class="op" id="5230859">*</span><span class="ident" id="5230860">decoder</span><span class="op" id="5230867">)</span>&nbsp;<span class="ident" id="5230869">verifyChecksum</span><span class="op" id="5230883">(</span><span class="op" id="5230884">)</span>&nbsp;<span class="builtintype" id="5230886">error</span>&nbsp;<span class="op" id="5230892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230895">if</span>&nbsp;<span class="ident" id="5230898">_</span><span class="op" id="5230899">,</span>&nbsp;<span class="ident" id="5230901">err</span>&nbsp;<span class="op" id="5230905">:=</span>&nbsp;<span class="ident" id="5230908">io</span><span class="op" id="5230910">.</span><span class="ident" id="5230911">ReadFull</span><span class="op" id="5230919">(</span><span class="ident" id="5230920">d</span><span class="op" id="5230921">.</span><span class="ident" id="5230922">r</span><span class="op" id="5230923">,</span>&nbsp;<span class="ident" id="5230925">d</span><span class="op" id="5230926">.</span><span class="ident" id="5230927">tmp</span><span class="op" id="5230930">[</span><span class="op" id="5230931">:</span><span class="num" id="5230932">4</span><span class="op" id="5230933">]</span><span class="op" id="5230934">)</span><span class="op" id="5230935">;</span>&nbsp;<span class="ident" id="5230937">err</span>&nbsp;<span class="op" id="5230941">!=</span>&nbsp;<span class="builtintype" id="5230944">nil</span>&nbsp;<span class="op" id="5230948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230952">return</span>&nbsp;<span class="ident" id="5230959">err</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5230964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230967">if</span>&nbsp;<span class="ident" id="5230970">binary</span><span class="op" id="5230976">.</span><span class="ident" id="5230977">BigEndian</span><span class="op" id="5230986">.</span><span class="ident" id="5230987">Uint32</span><span class="op" id="5230993">(</span><span class="ident" id="5230994">d</span><span class="op" id="5230995">.</span><span class="ident" id="5230996">tmp</span><span class="op" id="5230999">[</span><span class="op" id="5231000">:</span><span class="num" id="5231001">4</span><span class="op" id="5231002">]</span><span class="op" id="5231003">)</span>&nbsp;<span class="op" id="5231005">!=</span>&nbsp;<span class="ident" id="5231008">d</span><span class="op" id="5231009">.</span><span class="ident" id="5231010">crc</span><span class="op" id="5231013">.</span><span class="ident" id="5231014">Sum32</span><span class="op" id="5231019">(</span><span class="op" id="5231020">)</span>&nbsp;<span class="op" id="5231022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231026">return</span>&nbsp;<span class="ident" id="5231033">FormatError</span><span class="op" id="5231044">(</span><span class="string" id="5231045">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="5231063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231069">return</span>&nbsp;<span class="builtintype" id="5231076">nil</span><br>
<span class="lineno">725</span><span class="op" id="5231080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5231083">func</span>&nbsp;<span class="op" id="5231088">(</span><span class="ident" id="5231089">d</span>&nbsp;<span class="op" id="5231091">*</span><span class="ident" id="5231092">decoder</span><span class="op" id="5231099">)</span>&nbsp;<span class="ident" id="5231101">checkHeader</span><span class="op" id="5231112">(</span><span class="op" id="5231113">)</span>&nbsp;<span class="builtintype" id="5231115">error</span>&nbsp;<span class="op" id="5231121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231124">_</span><span class="op" id="5231125">,</span>&nbsp;<span class="ident" id="5231127">err</span>&nbsp;<span class="op" id="5231131">:=</span>&nbsp;<span class="ident" id="5231134">io</span><span class="op" id="5231136">.</span><span class="ident" id="5231137">ReadFull</span><span class="op" id="5231145">(</span><span class="ident" id="5231146">d</span><span class="op" id="5231147">.</span><span class="ident" id="5231148">r</span><span class="op" id="5231149">,</span>&nbsp;<span class="ident" id="5231151">d</span><span class="op" id="5231152">.</span><span class="ident" id="5231153">tmp</span><span class="op" id="5231156">[</span><span class="op" id="5231157">:</span><span class="builtinfunc" id="5231158">len</span><span class="op" id="5231161">(</span><span class="ident" id="5231162">pngHeader</span><span class="op" id="5231171">)</span><span class="op" id="5231172">]</span><span class="op" id="5231173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231176">if</span>&nbsp;<span class="ident" id="5231179">err</span>&nbsp;<span class="op" id="5231183">!=</span>&nbsp;<span class="builtintype" id="5231186">nil</span>&nbsp;<span class="op" id="5231190">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231194">return</span>&nbsp;<span class="ident" id="5231201">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231209">if</span>&nbsp;<span class="builtintype" id="5231212">string</span><span class="op" id="5231218">(</span><span class="ident" id="5231219">d</span><span class="op" id="5231220">.</span><span class="ident" id="5231221">tmp</span><span class="op" id="5231224">[</span><span class="op" id="5231225">:</span><span class="builtinfunc" id="5231226">len</span><span class="op" id="5231229">(</span><span class="ident" id="5231230">pngHeader</span><span class="op" id="5231239">)</span><span class="op" id="5231240">]</span><span class="op" id="5231241">)</span>&nbsp;<span class="op" id="5231243">!=</span>&nbsp;<span class="ident" id="5231246">pngHeader</span>&nbsp;<span class="op" id="5231256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231260">return</span>&nbsp;<span class="ident" id="5231267">FormatError</span><span class="op" id="5231278">(</span><span class="string" id="5231279">&#34;not&nbsp;a&nbsp;PNG&nbsp;file&#34;</span><span class="op" id="5231295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231298">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231301">return</span>&nbsp;<span class="builtintype" id="5231308">nil</span><br>
<span class="lineno"></span><span class="op" id="5231312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5231315">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;PNG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="comment" id="5231384">//&nbsp;The&nbsp;type&nbsp;of&nbsp;Image&nbsp;returned&nbsp;depends&nbsp;on&nbsp;the&nbsp;PNG&nbsp;contents.</span><br>
<span class="lineno">740</span><span class="keyword" id="5231443">func</span>&nbsp;<span class="ident" id="5231448">Decode</span><span class="op" id="5231454">(</span><span class="ident" id="5231455">r</span>&nbsp;<span class="ident" id="5231457">io</span><span class="op" id="5231459">.</span><span class="ident" id="5231460">Reader</span><span class="op" id="5231466">)</span>&nbsp;<span class="op" id="5231468">(</span><span class="ident" id="5231469">image</span><span class="op" id="5231474">.</span><span class="ident" id="5231475">Image</span><span class="op" id="5231480">,</span>&nbsp;<span class="builtintype" id="5231482">error</span><span class="op" id="5231487">)</span>&nbsp;<span class="op" id="5231489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231492">d</span>&nbsp;<span class="op" id="5231494">:=</span>&nbsp;<span class="op" id="5231497">&amp;</span><span class="ident" id="5231498">decoder</span><span class="op" id="5231505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231509">r</span><span class="op" id="5231510">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5231514">r</span><span class="op" id="5231515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231519">crc</span><span class="op" id="5231522">:</span>&nbsp;<span class="ident" id="5231524">crc32</span><span class="op" id="5231529">.</span><span class="ident" id="5231530">NewIEEE</span><span class="op" id="5231537">(</span><span class="op" id="5231538">)</span><span class="op" id="5231539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231542">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231545">if</span>&nbsp;<span class="ident" id="5231548">err</span>&nbsp;<span class="op" id="5231552">:=</span>&nbsp;<span class="ident" id="5231555">d</span><span class="op" id="5231556">.</span><span class="ident" id="5231557">checkHeader</span><span class="op" id="5231568">(</span><span class="op" id="5231569">)</span><span class="op" id="5231570">;</span>&nbsp;<span class="ident" id="5231572">err</span>&nbsp;<span class="op" id="5231576">!=</span>&nbsp;<span class="builtintype" id="5231579">nil</span>&nbsp;<span class="op" id="5231583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231587">if</span>&nbsp;<span class="ident" id="5231590">err</span>&nbsp;<span class="op" id="5231594">==</span>&nbsp;<span class="ident" id="5231597">io</span><span class="op" id="5231599">.</span><span class="ident" id="5231600">EOF</span>&nbsp;<span class="op" id="5231604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231609">err</span>&nbsp;<span class="op" id="5231613">=</span>&nbsp;<span class="ident" id="5231615">io</span><span class="op" id="5231617">.</span><span class="ident" id="5231618">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231641">return</span>&nbsp;<span class="builtintype" id="5231648">nil</span><span class="op" id="5231651">,</span>&nbsp;<span class="ident" id="5231653">err</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231661">for</span>&nbsp;<span class="ident" id="5231665">d</span><span class="op" id="5231666">.</span><span class="ident" id="5231667">stage</span>&nbsp;<span class="op" id="5231673">!=</span>&nbsp;<span class="ident" id="5231676">dsSeenIEND</span>&nbsp;<span class="op" id="5231687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231691">if</span>&nbsp;<span class="ident" id="5231694">err</span>&nbsp;<span class="op" id="5231698">:=</span>&nbsp;<span class="ident" id="5231701">d</span><span class="op" id="5231702">.</span><span class="ident" id="5231703">parseChunk</span><span class="op" id="5231713">(</span><span class="op" id="5231714">)</span><span class="op" id="5231715">;</span>&nbsp;<span class="ident" id="5231717">err</span>&nbsp;<span class="op" id="5231721">!=</span>&nbsp;<span class="builtintype" id="5231724">nil</span>&nbsp;<span class="op" id="5231728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231733">if</span>&nbsp;<span class="ident" id="5231736">err</span>&nbsp;<span class="op" id="5231740">==</span>&nbsp;<span class="ident" id="5231743">io</span><span class="op" id="5231745">.</span><span class="ident" id="5231746">EOF</span>&nbsp;<span class="op" id="5231750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231756">err</span>&nbsp;<span class="op" id="5231760">=</span>&nbsp;<span class="ident" id="5231762">io</span><span class="op" id="5231764">.</span><span class="ident" id="5231765">ErrUnexpectedEOF</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231790">return</span>&nbsp;<span class="builtintype" id="5231797">nil</span><span class="op" id="5231800">,</span>&nbsp;<span class="ident" id="5231802">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231814">return</span>&nbsp;<span class="ident" id="5231821">d</span><span class="op" id="5231822">.</span><span class="ident" id="5231823">img</span><span class="op" id="5231826">,</span>&nbsp;<span class="builtintype" id="5231828">nil</span><br>
<span class="lineno">760</span><span class="op" id="5231832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5231835">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;PNG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5231913">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5231943">func</span>&nbsp;<span class="ident" id="5231948">DecodeConfig</span><span class="op" id="5231960">(</span><span class="ident" id="5231961">r</span>&nbsp;<span class="ident" id="5231963">io</span><span class="op" id="5231965">.</span><span class="ident" id="5231966">Reader</span><span class="op" id="5231972">)</span>&nbsp;<span class="op" id="5231974">(</span><span class="ident" id="5231975">image</span><span class="op" id="5231980">.</span><span class="ident" id="5231981">Config</span><span class="op" id="5231987">,</span>&nbsp;<span class="builtintype" id="5231989">error</span><span class="op" id="5231994">)</span>&nbsp;<span class="op" id="5231996">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231999">d</span>&nbsp;<span class="op" id="5232001">:=</span>&nbsp;<span class="op" id="5232004">&amp;</span><span class="ident" id="5232005">decoder</span><span class="op" id="5232012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232016">r</span><span class="op" id="5232017">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5232021">r</span><span class="op" id="5232022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232026">crc</span><span class="op" id="5232029">:</span>&nbsp;<span class="ident" id="5232031">crc32</span><span class="op" id="5232036">.</span><span class="ident" id="5232037">NewIEEE</span><span class="op" id="5232044">(</span><span class="op" id="5232045">)</span><span class="op" id="5232046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232052">if</span>&nbsp;<span class="ident" id="5232055">err</span>&nbsp;<span class="op" id="5232059">:=</span>&nbsp;<span class="ident" id="5232062">d</span><span class="op" id="5232063">.</span><span class="ident" id="5232064">checkHeader</span><span class="op" id="5232075">(</span><span class="op" id="5232076">)</span><span class="op" id="5232077">;</span>&nbsp;<span class="ident" id="5232079">err</span>&nbsp;<span class="op" id="5232083">!=</span>&nbsp;<span class="builtintype" id="5232086">nil</span>&nbsp;<span class="op" id="5232090">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232094">if</span>&nbsp;<span class="ident" id="5232097">err</span>&nbsp;<span class="op" id="5232101">==</span>&nbsp;<span class="ident" id="5232104">io</span><span class="op" id="5232106">.</span><span class="ident" id="5232107">EOF</span>&nbsp;<span class="op" id="5232111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232116">err</span>&nbsp;<span class="op" id="5232120">=</span>&nbsp;<span class="ident" id="5232122">io</span><span class="op" id="5232124">.</span><span class="ident" id="5232125">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232148">return</span>&nbsp;<span class="ident" id="5232155">image</span><span class="op" id="5232160">.</span><span class="ident" id="5232161">Config</span><span class="op" id="5232167">{</span><span class="op" id="5232168">}</span><span class="op" id="5232169">,</span>&nbsp;<span class="ident" id="5232171">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232176">}</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232179">for</span>&nbsp;<span class="op" id="5232183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232187">if</span>&nbsp;<span class="ident" id="5232190">err</span>&nbsp;<span class="op" id="5232194">:=</span>&nbsp;<span class="ident" id="5232197">d</span><span class="op" id="5232198">.</span><span class="ident" id="5232199">parseChunk</span><span class="op" id="5232209">(</span><span class="op" id="5232210">)</span><span class="op" id="5232211">;</span>&nbsp;<span class="ident" id="5232213">err</span>&nbsp;<span class="op" id="5232217">!=</span>&nbsp;<span class="builtintype" id="5232220">nil</span>&nbsp;<span class="op" id="5232224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232229">if</span>&nbsp;<span class="ident" id="5232232">err</span>&nbsp;<span class="op" id="5232236">==</span>&nbsp;<span class="ident" id="5232239">io</span><span class="op" id="5232241">.</span><span class="ident" id="5232242">EOF</span>&nbsp;<span class="op" id="5232246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232252">err</span>&nbsp;<span class="op" id="5232256">=</span>&nbsp;<span class="ident" id="5232258">io</span><span class="op" id="5232260">.</span><span class="ident" id="5232261">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232281">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232286">return</span>&nbsp;<span class="ident" id="5232293">image</span><span class="op" id="5232298">.</span><span class="ident" id="5232299">Config</span><span class="op" id="5232305">{</span><span class="op" id="5232306">}</span><span class="op" id="5232307">,</span>&nbsp;<span class="ident" id="5232309">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232319">paletted</span>&nbsp;<span class="op" id="5232328">:=</span>&nbsp;<span class="ident" id="5232331">d</span><span class="op" id="5232332">.</span><span class="ident" id="5232333">cb</span>&nbsp;<span class="op" id="5232336">==</span>&nbsp;<span class="ident" id="5232339">cbP8</span>&nbsp;<span class="op" id="5232344">||</span>&nbsp;<span class="ident" id="5232347">d</span><span class="op" id="5232348">.</span><span class="ident" id="5232349">cb</span>&nbsp;<span class="op" id="5232352">==</span>&nbsp;<span class="ident" id="5232355">cbP4</span>&nbsp;<span class="op" id="5232360">||</span>&nbsp;<span class="ident" id="5232363">d</span><span class="op" id="5232364">.</span><span class="ident" id="5232365">cb</span>&nbsp;<span class="op" id="5232368">==</span>&nbsp;<span class="ident" id="5232371">cbP2</span>&nbsp;<span class="op" id="5232376">||</span>&nbsp;<span class="ident" id="5232379">d</span><span class="op" id="5232380">.</span><span class="ident" id="5232381">cb</span>&nbsp;<span class="op" id="5232384">==</span>&nbsp;<span class="ident" id="5232387">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232394">if</span>&nbsp;<span class="ident" id="5232397">d</span><span class="op" id="5232398">.</span><span class="ident" id="5232399">stage</span>&nbsp;<span class="op" id="5232405">==</span>&nbsp;<span class="ident" id="5232408">dsSeenIHDR</span>&nbsp;<span class="op" id="5232419">&amp;&amp;</span>&nbsp;<span class="op" id="5232422">!</span><span class="ident" id="5232423">paletted</span>&nbsp;<span class="op" id="5232432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232437">break</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232449">if</span>&nbsp;<span class="ident" id="5232452">d</span><span class="op" id="5232453">.</span><span class="ident" id="5232454">stage</span>&nbsp;<span class="op" id="5232460">==</span>&nbsp;<span class="ident" id="5232463">dsSeenPLTE</span>&nbsp;<span class="op" id="5232474">&amp;&amp;</span>&nbsp;<span class="ident" id="5232477">paletted</span>&nbsp;<span class="op" id="5232486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232491">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232502">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232505">var</span>&nbsp;<span class="ident" id="5232509">cm</span>&nbsp;<span class="ident" id="5232512">color</span><span class="op" id="5232517">.</span><span class="ident" id="5232518">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232525">switch</span>&nbsp;<span class="ident" id="5232532">d</span><span class="op" id="5232533">.</span><span class="ident" id="5232534">cb</span>&nbsp;<span class="op" id="5232537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232540">case</span>&nbsp;<span class="ident" id="5232545">cbG1</span><span class="op" id="5232549">,</span>&nbsp;<span class="ident" id="5232551">cbG2</span><span class="op" id="5232555">,</span>&nbsp;<span class="ident" id="5232557">cbG4</span><span class="op" id="5232561">,</span>&nbsp;<span class="ident" id="5232563">cbG8</span><span class="op" id="5232567">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232571">cm</span>&nbsp;<span class="op" id="5232574">=</span>&nbsp;<span class="ident" id="5232576">color</span><span class="op" id="5232581">.</span><span class="ident" id="5232582">GrayModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232593">case</span>&nbsp;<span class="ident" id="5232598">cbGA8</span><span class="op" id="5232603">:</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232607">cm</span>&nbsp;<span class="op" id="5232610">=</span>&nbsp;<span class="ident" id="5232612">color</span><span class="op" id="5232617">.</span><span class="ident" id="5232618">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232630">case</span>&nbsp;<span class="ident" id="5232635">cbTC8</span><span class="op" id="5232640">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232644">cm</span>&nbsp;<span class="op" id="5232647">=</span>&nbsp;<span class="ident" id="5232649">color</span><span class="op" id="5232654">.</span><span class="ident" id="5232655">RGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232666">case</span>&nbsp;<span class="ident" id="5232671">cbP1</span><span class="op" id="5232675">,</span>&nbsp;<span class="ident" id="5232677">cbP2</span><span class="op" id="5232681">,</span>&nbsp;<span class="ident" id="5232683">cbP4</span><span class="op" id="5232687">,</span>&nbsp;<span class="ident" id="5232689">cbP8</span><span class="op" id="5232693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232697">cm</span>&nbsp;<span class="op" id="5232700">=</span>&nbsp;<span class="ident" id="5232702">d</span><span class="op" id="5232703">.</span><span class="ident" id="5232704">palette</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232713">case</span>&nbsp;<span class="ident" id="5232718">cbTCA8</span><span class="op" id="5232724">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232728">cm</span>&nbsp;<span class="op" id="5232731">=</span>&nbsp;<span class="ident" id="5232733">color</span><span class="op" id="5232738">.</span><span class="ident" id="5232739">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232751">case</span>&nbsp;<span class="ident" id="5232756">cbG16</span><span class="op" id="5232761">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232765">cm</span>&nbsp;<span class="op" id="5232768">=</span>&nbsp;<span class="ident" id="5232770">color</span><span class="op" id="5232775">.</span><span class="ident" id="5232776">Gray16Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232789">case</span>&nbsp;<span class="ident" id="5232794">cbGA16</span><span class="op" id="5232800">:</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232804">cm</span>&nbsp;<span class="op" id="5232807">=</span>&nbsp;<span class="ident" id="5232809">color</span><span class="op" id="5232814">.</span><span class="ident" id="5232815">NRGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232829">case</span>&nbsp;<span class="ident" id="5232834">cbTC16</span><span class="op" id="5232840">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232844">cm</span>&nbsp;<span class="op" id="5232847">=</span>&nbsp;<span class="ident" id="5232849">color</span><span class="op" id="5232854">.</span><span class="ident" id="5232855">RGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232868">case</span>&nbsp;<span class="ident" id="5232873">cbTCA16</span><span class="op" id="5232880">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232884">cm</span>&nbsp;<span class="op" id="5232887">=</span>&nbsp;<span class="ident" id="5232889">color</span><span class="op" id="5232894">.</span><span class="ident" id="5232895">NRGBA64Model</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232912">return</span>&nbsp;<span class="ident" id="5232919">image</span><span class="op" id="5232924">.</span><span class="ident" id="5232925">Config</span><span class="op" id="5232931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232935">ColorModel</span><span class="op" id="5232945">:</span>&nbsp;<span class="ident" id="5232947">cm</span><span class="op" id="5232949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232953">Width</span><span class="op" id="5232958">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232965">d</span><span class="op" id="5232966">.</span><span class="ident" id="5232967">width</span><span class="op" id="5232972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232976">Height</span><span class="op" id="5232982">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232988">d</span><span class="op" id="5232989">.</span><span class="ident" id="5232990">height</span><span class="op" id="5232996">,</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232999">}</span><span class="op" id="5233000">,</span>&nbsp;<span class="builtintype" id="5233002">nil</span><br>
<span class="lineno"></span><span class="op" id="5233006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5233009">func</span>&nbsp;<span class="ident" id="5233014">init</span><span class="op" id="5233018">(</span><span class="op" id="5233019">)</span>&nbsp;<span class="op" id="5233021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233024">image</span><span class="op" id="5233029">.</span><span class="ident" id="5233030">RegisterFormat</span><span class="op" id="5233044">(</span><span class="string" id="5233045">&#34;png&#34;</span><span class="op" id="5233050">,</span>&nbsp;<span class="ident" id="5233052">pngHeader</span><span class="op" id="5233061">,</span>&nbsp;<span class="ident" id="5233063">Decode</span><span class="op" id="5233069">,</span>&nbsp;<span class="ident" id="5233071">DecodeConfig</span><span class="op" id="5233083">)</span><br>
<span class="lineno">820</span><span class="op" id="5233085">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
