<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>internal/syscall</h2>
<ul>
<li><a href="/gostd/internal/syscall/getrandom_linux.go.html">getrandom_linux.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3861437">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3861493">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3861547">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3861598">package</span>&nbsp;<span class="ident" id="3861606">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3861615">import</span>&nbsp;<span class="op" id="3861622">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3861625">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3861636">&#34;sync/atomic&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3861651">stdsyscall</span>&nbsp;<span class="string" id="3861662">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3861673">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="3861682">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3861685">var</span>&nbsp;<span class="ident" id="3861689">randomTrap</span>&nbsp;<span class="op" id="3861700">=</span>&nbsp;<span class="keyword" id="3861702">map</span><span class="op" id="3861705">[</span><span class="builtintype" id="3861706">string</span><span class="op" id="3861712">]</span><span class="builtintype" id="3861713">uintptr</span><span class="op" id="3861720">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3861723">&#34;386&#34;</span><span class="op" id="3861728">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="3861732">355</span><span class="op" id="3861735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3861738">&#34;amd64&#34;</span><span class="op" id="3861745">:</span>&nbsp;<span class="num" id="3861747">318</span><span class="op" id="3861750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3861753">&#34;arm&#34;</span><span class="op" id="3861758">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="3861762">384</span><span class="op" id="3861765">,</span><br>
<span class="lineno"></span><span class="op" id="3861767">}</span><span class="op" id="3861768">[</span><span class="ident" id="3861769">runtime</span><span class="op" id="3861776">.</span><span class="ident" id="3861777">GOARCH</span><span class="op" id="3861783">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3861786">var</span>&nbsp;<span class="ident" id="3861790">randomUnsupported</span>&nbsp;<span class="builtintype" id="3861808">int32</span>&nbsp;<span class="comment" id="3861814">//&nbsp;atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3861825">//&nbsp;GetRandomFlag&nbsp;is&nbsp;a&nbsp;flag&nbsp;supported&nbsp;by&nbsp;the&nbsp;getrandom&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="3861892">type</span>&nbsp;<span class="ident" id="3861897">GetRandomFlag</span>&nbsp;<span class="builtintype" id="3861911">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3861920">const</span>&nbsp;<span class="op" id="3861926">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3861929">//&nbsp;GRND_NONBLOCK&nbsp;means&nbsp;return&nbsp;EAGAIN&nbsp;rather&nbsp;than&nbsp;blocking.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3861989">GRND_NONBLOCK</span>&nbsp;<span class="ident" id="3862003">GetRandomFlag</span>&nbsp;<span class="op" id="3862017">=</span>&nbsp;<span class="num" id="3862019">0x0001</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3862028">//&nbsp;GRND_RANDOM&nbsp;means&nbsp;use&nbsp;the&nbsp;/dev/random&nbsp;pool&nbsp;instead&nbsp;of&nbsp;/dev/urandom.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862100">GRND_RANDOM</span>&nbsp;<span class="ident" id="3862112">GetRandomFlag</span>&nbsp;<span class="op" id="3862126">=</span>&nbsp;<span class="num" id="3862128">0x0002</span><br>
<span class="lineno"></span><span class="op" id="3862135">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3862138">//&nbsp;GetRandom&nbsp;calls&nbsp;the&nbsp;Linux&nbsp;getrandom&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="3862190">//&nbsp;See&nbsp;https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=c6e9d6f38894798696f23c8084ca7edbf16ee895</span><br>
<span class="lineno">35</span><span class="keyword" id="3862313">func</span>&nbsp;<span class="ident" id="3862318">GetRandom</span><span class="op" id="3862327">(</span><span class="ident" id="3862328">p</span>&nbsp;<span class="op" id="3862330">[</span><span class="op" id="3862331">]</span><span class="builtintype" id="3862332">byte</span><span class="op" id="3862336">,</span>&nbsp;<span class="ident" id="3862338">flags</span>&nbsp;<span class="ident" id="3862344">GetRandomFlag</span><span class="op" id="3862357">)</span>&nbsp;<span class="op" id="3862359">(</span><span class="ident" id="3862360">n</span>&nbsp;<span class="builtintype" id="3862362">int</span><span class="op" id="3862365">,</span>&nbsp;<span class="ident" id="3862367">err</span>&nbsp;<span class="builtintype" id="3862371">error</span><span class="op" id="3862376">)</span>&nbsp;<span class="op" id="3862378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862381">if</span>&nbsp;<span class="ident" id="3862384">randomTrap</span>&nbsp;<span class="op" id="3862395">==</span>&nbsp;<span class="num" id="3862398">0</span>&nbsp;<span class="op" id="3862400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862404">return</span>&nbsp;<span class="num" id="3862411">0</span><span class="op" id="3862412">,</span>&nbsp;<span class="ident" id="3862414">stdsyscall</span><span class="op" id="3862424">.</span><span class="ident" id="3862425">ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3862433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862436">if</span>&nbsp;<span class="builtinfunc" id="3862439">len</span><span class="op" id="3862442">(</span><span class="ident" id="3862443">p</span><span class="op" id="3862444">)</span>&nbsp;<span class="op" id="3862446">==</span>&nbsp;<span class="num" id="3862449">0</span>&nbsp;<span class="op" id="3862451">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862455">return</span>&nbsp;<span class="num" id="3862462">0</span><span class="op" id="3862463">,</span>&nbsp;<span class="ident" id="3862465">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3862470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862473">if</span>&nbsp;<span class="ident" id="3862476">atomic</span><span class="op" id="3862482">.</span><span class="ident" id="3862483">LoadInt32</span><span class="op" id="3862492">(</span><span class="op" id="3862493">&amp;</span><span class="ident" id="3862494">randomUnsupported</span><span class="op" id="3862511">)</span>&nbsp;<span class="op" id="3862513">!=</span>&nbsp;<span class="num" id="3862516">0</span>&nbsp;<span class="op" id="3862518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862522">return</span>&nbsp;<span class="num" id="3862529">0</span><span class="op" id="3862530">,</span>&nbsp;<span class="ident" id="3862532">stdsyscall</span><span class="op" id="3862542">.</span><span class="ident" id="3862543">ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3862551">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862554">r1</span><span class="op" id="3862556">,</span>&nbsp;<span class="ident" id="3862558">_</span><span class="op" id="3862559">,</span>&nbsp;<span class="ident" id="3862561">errno</span>&nbsp;<span class="op" id="3862567">:=</span>&nbsp;<span class="ident" id="3862570">stdsyscall</span><span class="op" id="3862580">.</span><span class="ident" id="3862581">Syscall</span><span class="op" id="3862588">(</span><span class="ident" id="3862589">randomTrap</span><span class="op" id="3862599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3862603">uintptr</span><span class="op" id="3862610">(</span><span class="ident" id="3862611">unsafe</span><span class="op" id="3862617">.</span><span class="ident" id="3862618">Pointer</span><span class="op" id="3862625">(</span><span class="op" id="3862626">&amp;</span><span class="ident" id="3862627">p</span><span class="op" id="3862628">[</span><span class="num" id="3862629">0</span><span class="op" id="3862630">]</span><span class="op" id="3862631">)</span><span class="op" id="3862632">)</span><span class="op" id="3862633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3862637">uintptr</span><span class="op" id="3862644">(</span><span class="builtinfunc" id="3862645">len</span><span class="op" id="3862648">(</span><span class="ident" id="3862649">p</span><span class="op" id="3862650">)</span><span class="op" id="3862651">)</span><span class="op" id="3862652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3862656">uintptr</span><span class="op" id="3862663">(</span><span class="ident" id="3862664">flags</span><span class="op" id="3862669">)</span><span class="op" id="3862670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862673">if</span>&nbsp;<span class="ident" id="3862676">errno</span>&nbsp;<span class="op" id="3862682">!=</span>&nbsp;<span class="num" id="3862685">0</span>&nbsp;<span class="op" id="3862687">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862691">if</span>&nbsp;<span class="ident" id="3862694">errno</span>&nbsp;<span class="op" id="3862700">==</span>&nbsp;<span class="ident" id="3862703">stdsyscall</span><span class="op" id="3862713">.</span><span class="ident" id="3862714">ENOSYS</span>&nbsp;<span class="op" id="3862721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862726">atomic</span><span class="op" id="3862732">.</span><span class="ident" id="3862733">StoreInt32</span><span class="op" id="3862743">(</span><span class="op" id="3862744">&amp;</span><span class="ident" id="3862745">randomUnsupported</span><span class="op" id="3862762">,</span>&nbsp;<span class="num" id="3862764">1</span><span class="op" id="3862765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3862769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862773">return</span>&nbsp;<span class="num" id="3862780">0</span><span class="op" id="3862781">,</span>&nbsp;<span class="ident" id="3862783">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3862790">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862793">return</span>&nbsp;<span class="builtintype" id="3862800">int</span><span class="op" id="3862803">(</span><span class="ident" id="3862804">r1</span><span class="op" id="3862806">)</span><span class="op" id="3862807">,</span>&nbsp;<span class="ident" id="3862809">nil</span><br>
<span class="lineno"></span><span class="op" id="3862813">}</span>
</div>
</body>
</html>
