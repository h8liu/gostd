<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3943079">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3943134">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3943188">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3943239">//&nbsp;Package&nbsp;subtle&nbsp;implements&nbsp;functions&nbsp;that&nbsp;are&nbsp;often&nbsp;useful&nbsp;in&nbsp;cryptographic</span><br>
<span class="lineno"></span><span class="comment" id="3943317">//&nbsp;code&nbsp;but&nbsp;require&nbsp;careful&nbsp;thought&nbsp;to&nbsp;use&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="keyword" id="3943371">package</span>&nbsp;<span class="ident" id="3943379">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3943387">//&nbsp;ConstantTimeCompare&nbsp;returns&nbsp;1&nbsp;iff&nbsp;the&nbsp;two&nbsp;slices,&nbsp;x</span><br>
<span class="lineno">10</span><span class="comment" id="3943442">//&nbsp;and&nbsp;y,&nbsp;have&nbsp;equal&nbsp;contents.&nbsp;The&nbsp;time&nbsp;taken&nbsp;is&nbsp;a&nbsp;function&nbsp;of&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3943519">//&nbsp;the&nbsp;slices&nbsp;and&nbsp;is&nbsp;independent&nbsp;of&nbsp;the&nbsp;contents.</span><br>
<span class="lineno"></span><span class="keyword" id="3943569">func</span>&nbsp;<span class="ident" id="3943574">ConstantTimeCompare</span><span class="op" id="3943593">(</span><span class="ident" id="3943594">x</span><span class="op" id="3943595">,</span>&nbsp;<span class="ident" id="3943597">y</span>&nbsp;<span class="op" id="3943599">[</span><span class="op" id="3943600">]</span><span class="builtintype" id="3943601">byte</span><span class="op" id="3943605">)</span>&nbsp;<span class="builtintype" id="3943607">int</span>&nbsp;<span class="op" id="3943611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3943614">if</span>&nbsp;<span class="builtinfunc" id="3943617">len</span><span class="op" id="3943620">(</span><span class="ident" id="3943621">x</span><span class="op" id="3943622">)</span>&nbsp;<span class="op" id="3943624">!=</span>&nbsp;<span class="builtinfunc" id="3943627">len</span><span class="op" id="3943630">(</span><span class="ident" id="3943631">y</span><span class="op" id="3943632">)</span>&nbsp;<span class="op" id="3943634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3943638">return</span>&nbsp;<span class="num" id="3943645">0</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3943648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3943652">var</span>&nbsp;<span class="ident" id="3943656">v</span>&nbsp;<span class="builtintype" id="3943658">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3943665">for</span>&nbsp;<span class="ident" id="3943669">i</span>&nbsp;<span class="op" id="3943671">:=</span>&nbsp;<span class="num" id="3943674">0</span><span class="op" id="3943675">;</span>&nbsp;<span class="ident" id="3943677">i</span>&nbsp;<span class="op" id="3943679">&lt;</span>&nbsp;<span class="builtinfunc" id="3943681">len</span><span class="op" id="3943684">(</span><span class="ident" id="3943685">x</span><span class="op" id="3943686">)</span><span class="op" id="3943687">;</span>&nbsp;<span class="ident" id="3943689">i</span><span class="op" id="3943690">++</span>&nbsp;<span class="op" id="3943693">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943697">v</span>&nbsp;<span class="op" id="3943699">|=</span>&nbsp;<span class="ident" id="3943702">x</span><span class="op" id="3943703">[</span><span class="ident" id="3943704">i</span><span class="op" id="3943705">]</span>&nbsp;<span class="op" id="3943707">^</span>&nbsp;<span class="ident" id="3943709">y</span><span class="op" id="3943710">[</span><span class="ident" id="3943711">i</span><span class="op" id="3943712">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3943715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3943719">return</span>&nbsp;<span class="ident" id="3943726">ConstantTimeByteEq</span><span class="op" id="3943744">(</span><span class="ident" id="3943745">v</span><span class="op" id="3943746">,</span>&nbsp;<span class="num" id="3943748">0</span><span class="op" id="3943749">)</span><br>
<span class="lineno"></span><span class="op" id="3943751">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3943754">//&nbsp;ConstantTimeSelect&nbsp;returns&nbsp;x&nbsp;if&nbsp;v&nbsp;is&nbsp;1&nbsp;and&nbsp;y&nbsp;if&nbsp;v&nbsp;is&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3943813">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3943870">func</span>&nbsp;<span class="ident" id="3943875">ConstantTimeSelect</span><span class="op" id="3943893">(</span><span class="ident" id="3943894">v</span><span class="op" id="3943895">,</span>&nbsp;<span class="ident" id="3943897">x</span><span class="op" id="3943898">,</span>&nbsp;<span class="ident" id="3943900">y</span>&nbsp;<span class="builtintype" id="3943902">int</span><span class="op" id="3943905">)</span>&nbsp;<span class="builtintype" id="3943907">int</span>&nbsp;<span class="op" id="3943911">{</span>&nbsp;<span class="keyword" id="3943913">return</span>&nbsp;<span class="op" id="3943920">^</span><span class="op" id="3943921">(</span><span class="ident" id="3943922">v</span><span class="op" id="3943923">-</span><span class="num" id="3943924">1</span><span class="op" id="3943925">)</span><span class="op" id="3943926">&amp;</span><span class="ident" id="3943927">x</span>&nbsp;<span class="op" id="3943929">|</span>&nbsp;<span class="op" id="3943931">(</span><span class="ident" id="3943932">v</span><span class="op" id="3943933">-</span><span class="num" id="3943934">1</span><span class="op" id="3943935">)</span><span class="op" id="3943936">&amp;</span><span class="ident" id="3943937">y</span>&nbsp;<span class="op" id="3943939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3943942">//&nbsp;ConstantTimeByteEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3944001">func</span>&nbsp;<span class="ident" id="3944006">ConstantTimeByteEq</span><span class="op" id="3944024">(</span><span class="ident" id="3944025">x</span><span class="op" id="3944026">,</span>&nbsp;<span class="ident" id="3944028">y</span>&nbsp;<span class="builtintype" id="3944030">uint8</span><span class="op" id="3944035">)</span>&nbsp;<span class="builtintype" id="3944037">int</span>&nbsp;<span class="op" id="3944041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944044">z</span>&nbsp;<span class="op" id="3944046">:=</span>&nbsp;<span class="op" id="3944049">^</span><span class="op" id="3944050">(</span><span class="ident" id="3944051">x</span>&nbsp;<span class="op" id="3944053">^</span>&nbsp;<span class="ident" id="3944055">y</span><span class="op" id="3944056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944059">z</span>&nbsp;<span class="op" id="3944061">&amp;=</span>&nbsp;<span class="ident" id="3944064">z</span>&nbsp;<span class="op" id="3944066">&gt;&gt;</span>&nbsp;<span class="num" id="3944069">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944072">z</span>&nbsp;<span class="op" id="3944074">&amp;=</span>&nbsp;<span class="ident" id="3944077">z</span>&nbsp;<span class="op" id="3944079">&gt;&gt;</span>&nbsp;<span class="num" id="3944082">2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944085">z</span>&nbsp;<span class="op" id="3944087">&amp;=</span>&nbsp;<span class="ident" id="3944090">z</span>&nbsp;<span class="op" id="3944092">&gt;&gt;</span>&nbsp;<span class="num" id="3944095">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944099">return</span>&nbsp;<span class="builtintype" id="3944106">int</span><span class="op" id="3944109">(</span><span class="ident" id="3944110">z</span><span class="op" id="3944111">)</span><br>
<span class="lineno"></span><span class="op" id="3944113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="3944116">//&nbsp;ConstantTimeEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3944171">func</span>&nbsp;<span class="ident" id="3944176">ConstantTimeEq</span><span class="op" id="3944190">(</span><span class="ident" id="3944191">x</span><span class="op" id="3944192">,</span>&nbsp;<span class="ident" id="3944194">y</span>&nbsp;<span class="builtintype" id="3944196">int32</span><span class="op" id="3944201">)</span>&nbsp;<span class="builtintype" id="3944203">int</span>&nbsp;<span class="op" id="3944207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944210">z</span>&nbsp;<span class="op" id="3944212">:=</span>&nbsp;<span class="op" id="3944215">^</span><span class="op" id="3944216">(</span><span class="ident" id="3944217">x</span>&nbsp;<span class="op" id="3944219">^</span>&nbsp;<span class="ident" id="3944221">y</span><span class="op" id="3944222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944225">z</span>&nbsp;<span class="op" id="3944227">&amp;=</span>&nbsp;<span class="ident" id="3944230">z</span>&nbsp;<span class="op" id="3944232">&gt;&gt;</span>&nbsp;<span class="num" id="3944235">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944239">z</span>&nbsp;<span class="op" id="3944241">&amp;=</span>&nbsp;<span class="ident" id="3944244">z</span>&nbsp;<span class="op" id="3944246">&gt;&gt;</span>&nbsp;<span class="num" id="3944249">8</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944252">z</span>&nbsp;<span class="op" id="3944254">&amp;=</span>&nbsp;<span class="ident" id="3944257">z</span>&nbsp;<span class="op" id="3944259">&gt;&gt;</span>&nbsp;<span class="num" id="3944262">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944265">z</span>&nbsp;<span class="op" id="3944267">&amp;=</span>&nbsp;<span class="ident" id="3944270">z</span>&nbsp;<span class="op" id="3944272">&gt;&gt;</span>&nbsp;<span class="num" id="3944275">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944278">z</span>&nbsp;<span class="op" id="3944280">&amp;=</span>&nbsp;<span class="ident" id="3944283">z</span>&nbsp;<span class="op" id="3944285">&gt;&gt;</span>&nbsp;<span class="num" id="3944288">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944292">return</span>&nbsp;<span class="builtintype" id="3944299">int</span><span class="op" id="3944302">(</span><span class="ident" id="3944303">z</span>&nbsp;<span class="op" id="3944305">&amp;</span>&nbsp;<span class="num" id="3944307">1</span><span class="op" id="3944308">)</span><br>
<span class="lineno">50</span><span class="op" id="3944310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3944313">//&nbsp;ConstantTimeCopy&nbsp;copies&nbsp;the&nbsp;contents&nbsp;of&nbsp;y&nbsp;into&nbsp;x&nbsp;(a&nbsp;slice&nbsp;of&nbsp;equal&nbsp;length)</span><br>
<span class="lineno"></span><span class="comment" id="3944391">//&nbsp;if&nbsp;v&nbsp;==&nbsp;1.&nbsp;If&nbsp;v&nbsp;==&nbsp;0,&nbsp;x&nbsp;is&nbsp;left&nbsp;unchanged.&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v</span><br>
<span class="lineno"></span><span class="comment" id="3944468">//&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno">55</span><span class="keyword" id="3944494">func</span>&nbsp;<span class="ident" id="3944499">ConstantTimeCopy</span><span class="op" id="3944515">(</span><span class="ident" id="3944516">v</span>&nbsp;<span class="builtintype" id="3944518">int</span><span class="op" id="3944521">,</span>&nbsp;<span class="ident" id="3944523">x</span><span class="op" id="3944524">,</span>&nbsp;<span class="ident" id="3944526">y</span>&nbsp;<span class="op" id="3944528">[</span><span class="op" id="3944529">]</span><span class="builtintype" id="3944530">byte</span><span class="op" id="3944534">)</span>&nbsp;<span class="op" id="3944536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944539">if</span>&nbsp;<span class="builtinfunc" id="3944542">len</span><span class="op" id="3944545">(</span><span class="ident" id="3944546">x</span><span class="op" id="3944547">)</span>&nbsp;<span class="op" id="3944549">!=</span>&nbsp;<span class="builtinfunc" id="3944552">len</span><span class="op" id="3944555">(</span><span class="ident" id="3944556">y</span><span class="op" id="3944557">)</span>&nbsp;<span class="op" id="3944559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3944563">panic</span><span class="op" id="3944568">(</span><span class="string" id="3944569">&#34;subtle:&nbsp;slices&nbsp;have&nbsp;different&nbsp;lengths&#34;</span><span class="op" id="3944608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3944611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944615">xmask</span>&nbsp;<span class="op" id="3944621">:=</span>&nbsp;<span class="builtintype" id="3944624">byte</span><span class="op" id="3944628">(</span><span class="ident" id="3944629">v</span>&nbsp;<span class="op" id="3944631">-</span>&nbsp;<span class="num" id="3944633">1</span><span class="op" id="3944634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944637">ymask</span>&nbsp;<span class="op" id="3944643">:=</span>&nbsp;<span class="builtintype" id="3944646">byte</span><span class="op" id="3944650">(</span><span class="op" id="3944651">^</span><span class="op" id="3944652">(</span><span class="ident" id="3944653">v</span>&nbsp;<span class="op" id="3944655">-</span>&nbsp;<span class="num" id="3944657">1</span><span class="op" id="3944658">)</span><span class="op" id="3944659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944662">for</span>&nbsp;<span class="ident" id="3944666">i</span>&nbsp;<span class="op" id="3944668">:=</span>&nbsp;<span class="num" id="3944671">0</span><span class="op" id="3944672">;</span>&nbsp;<span class="ident" id="3944674">i</span>&nbsp;<span class="op" id="3944676">&lt;</span>&nbsp;<span class="builtinfunc" id="3944678">len</span><span class="op" id="3944681">(</span><span class="ident" id="3944682">x</span><span class="op" id="3944683">)</span><span class="op" id="3944684">;</span>&nbsp;<span class="ident" id="3944686">i</span><span class="op" id="3944687">++</span>&nbsp;<span class="op" id="3944690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944694">x</span><span class="op" id="3944695">[</span><span class="ident" id="3944696">i</span><span class="op" id="3944697">]</span>&nbsp;<span class="op" id="3944699">=</span>&nbsp;<span class="ident" id="3944701">x</span><span class="op" id="3944702">[</span><span class="ident" id="3944703">i</span><span class="op" id="3944704">]</span><span class="op" id="3944705">&amp;</span><span class="ident" id="3944706">xmask</span>&nbsp;<span class="op" id="3944712">|</span>&nbsp;<span class="ident" id="3944714">y</span><span class="op" id="3944715">[</span><span class="ident" id="3944716">i</span><span class="op" id="3944717">]</span><span class="op" id="3944718">&amp;</span><span class="ident" id="3944719">ymask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3944726">}</span><br>
<span class="lineno">65</span><span class="op" id="3944728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3944731">//&nbsp;ConstantTimeLessOrEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;&lt;=&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3944792">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;x&nbsp;or&nbsp;y&nbsp;are&nbsp;negative&nbsp;or&nbsp;&gt;&nbsp;2**31&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3944860">func</span>&nbsp;<span class="ident" id="3944865">ConstantTimeLessOrEq</span><span class="op" id="3944885">(</span><span class="ident" id="3944886">x</span><span class="op" id="3944887">,</span>&nbsp;<span class="ident" id="3944889">y</span>&nbsp;<span class="builtintype" id="3944891">int</span><span class="op" id="3944894">)</span>&nbsp;<span class="builtintype" id="3944896">int</span>&nbsp;<span class="op" id="3944900">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944903">x32</span>&nbsp;<span class="op" id="3944907">:=</span>&nbsp;<span class="builtintype" id="3944910">int32</span><span class="op" id="3944915">(</span><span class="ident" id="3944916">x</span><span class="op" id="3944917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944920">y32</span>&nbsp;<span class="op" id="3944924">:=</span>&nbsp;<span class="builtintype" id="3944927">int32</span><span class="op" id="3944932">(</span><span class="ident" id="3944933">y</span><span class="op" id="3944934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944937">return</span>&nbsp;<span class="builtintype" id="3944944">int</span><span class="op" id="3944947">(</span><span class="op" id="3944948">(</span><span class="op" id="3944949">(</span><span class="ident" id="3944950">x32</span>&nbsp;<span class="op" id="3944954">-</span>&nbsp;<span class="ident" id="3944956">y32</span>&nbsp;<span class="op" id="3944960">-</span>&nbsp;<span class="num" id="3944962">1</span><span class="op" id="3944963">)</span>&nbsp;<span class="op" id="3944965">&gt;&gt;</span>&nbsp;<span class="num" id="3944968">31</span><span class="op" id="3944970">)</span>&nbsp;<span class="op" id="3944972">&amp;</span>&nbsp;<span class="num" id="3944974">1</span><span class="op" id="3944975">)</span><br>
<span class="lineno"></span><span class="op" id="3944977">}</span>
</div>
</body>
</html>
