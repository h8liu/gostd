<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>hash/crc32</h2>
<ul>
<li><a href="/gostd/hash/crc32/crc32.go.html">crc32.go</a></li>
<li><a href="/gostd/hash/crc32/crc32_amd64x.go.html">crc32_amd64x.go</a></li>
<li><a href="/gostd/hash/crc32/crc32_test.go.html">crc32_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4699712">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4699767">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4699821">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4699872">//&nbsp;Package&nbsp;crc32&nbsp;implements&nbsp;the&nbsp;32-bit&nbsp;cyclic&nbsp;redundancy&nbsp;check,&nbsp;or&nbsp;CRC-32,</span><br>
<span class="lineno"></span><span class="comment" id="4699947">//&nbsp;checksum.&nbsp;See&nbsp;http://en.wikipedia.org/wiki/Cyclic_redundancy_check&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4700021">//&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="4700037">package</span>&nbsp;<span class="ident" id="4700045">crc32</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4700052">import</span>&nbsp;<span class="op" id="4700059">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4700062">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4700070">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="4700077">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4700080">//&nbsp;The&nbsp;size&nbsp;of&nbsp;a&nbsp;CRC-32&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4700123">const</span>&nbsp;<span class="ident" id="4700129">Size</span>&nbsp;<span class="op" id="4700134">=</span>&nbsp;<span class="num" id="4700136">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4700139">//&nbsp;Predefined&nbsp;polynomials.</span><br>
<span class="lineno"></span><span class="keyword" id="4700166">const</span>&nbsp;<span class="op" id="4700172">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4700175">//&nbsp;IEEE&nbsp;is&nbsp;by&nbsp;far&nbsp;and&nbsp;away&nbsp;the&nbsp;most&nbsp;common&nbsp;CRC-32&nbsp;polynomial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4700238">//&nbsp;Used&nbsp;by&nbsp;ethernet&nbsp;(IEEE&nbsp;802.3),&nbsp;v.42,&nbsp;fddi,&nbsp;gzip,&nbsp;zip,&nbsp;png,&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700305">IEEE</span>&nbsp;<span class="op" id="4700310">=</span>&nbsp;<span class="num" id="4700312">0xedb88320</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4700325">//&nbsp;Castagnoli&#39;s&nbsp;polynomial,&nbsp;used&nbsp;in&nbsp;iSCSI.</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4700369">//&nbsp;Has&nbsp;better&nbsp;error&nbsp;detection&nbsp;characteristics&nbsp;than&nbsp;IEEE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4700427">//&nbsp;http://dx.doi.org/10.1109/26.231911</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700467">Castagnoli</span>&nbsp;<span class="op" id="4700478">=</span>&nbsp;<span class="num" id="4700480">0x82f63b78</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4700493">//&nbsp;Koopman&#39;s&nbsp;polynomial.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4700519">//&nbsp;Also&nbsp;has&nbsp;better&nbsp;error&nbsp;detection&nbsp;characteristics&nbsp;than&nbsp;IEEE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4700582">//&nbsp;http://dx.doi.org/10.1109/DSN.2002.1028931</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700629">Koopman</span>&nbsp;<span class="op" id="4700637">=</span>&nbsp;<span class="num" id="4700639">0xeb31d82e</span><br>
<span class="lineno"></span><span class="op" id="4700650">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4700653">//&nbsp;Table&nbsp;is&nbsp;a&nbsp;256-word&nbsp;table&nbsp;representing&nbsp;the&nbsp;polynomial&nbsp;for&nbsp;efficient&nbsp;processing.</span><br>
<span class="lineno"></span><span class="keyword" id="4700736">type</span>&nbsp;<span class="ident" id="4700741">Table</span>&nbsp;<span class="op" id="4700747">[</span><span class="num" id="4700748">256</span><span class="op" id="4700751">]</span><span class="builtintype" id="4700752">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4700760">//&nbsp;castagnoliTable&nbsp;points&nbsp;to&nbsp;a&nbsp;lazily&nbsp;initialized&nbsp;Table&nbsp;for&nbsp;the&nbsp;Castagnoli</span><br>
<span class="lineno"></span><span class="comment" id="4700835">//&nbsp;polynomial.&nbsp;MakeTable&nbsp;will&nbsp;always&nbsp;return&nbsp;this&nbsp;value&nbsp;when&nbsp;asked&nbsp;to&nbsp;make&nbsp;a</span><br>
<span class="lineno">40</span><span class="comment" id="4700911">//&nbsp;Castagnoli&nbsp;table&nbsp;so&nbsp;we&nbsp;can&nbsp;compare&nbsp;against&nbsp;it&nbsp;to&nbsp;find&nbsp;when&nbsp;the&nbsp;caller&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4700987">//&nbsp;using&nbsp;this&nbsp;polynomial.</span><br>
<span class="lineno"></span><span class="keyword" id="4701013">var</span>&nbsp;<span class="ident" id="4701017">castagnoliTable</span>&nbsp;<span class="op" id="4701033">*</span><span class="ident" id="4701034">Table</span><br>
<span class="lineno"></span><span class="keyword" id="4701040">var</span>&nbsp;<span class="ident" id="4701044">castagnoliOnce</span>&nbsp;<span class="ident" id="4701059">sync</span><span class="op" id="4701063">.</span><span class="ident" id="4701064">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4701070">func</span>&nbsp;<span class="ident" id="4701075">castagnoliInit</span><span class="op" id="4701089">(</span><span class="op" id="4701090">)</span>&nbsp;<span class="op" id="4701092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701095">castagnoliTable</span>&nbsp;<span class="op" id="4701111">=</span>&nbsp;<span class="ident" id="4701113">makeTable</span><span class="op" id="4701122">(</span><span class="ident" id="4701123">Castagnoli</span><span class="op" id="4701133">)</span><br>
<span class="lineno"></span><span class="op" id="4701135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4701138">//&nbsp;IEEETable&nbsp;is&nbsp;the&nbsp;table&nbsp;for&nbsp;the&nbsp;IEEE&nbsp;polynomial.</span><br>
<span class="lineno">50</span><span class="keyword" id="4701189">var</span>&nbsp;<span class="ident" id="4701193">IEEETable</span>&nbsp;<span class="op" id="4701203">=</span>&nbsp;<span class="ident" id="4701205">makeTable</span><span class="op" id="4701214">(</span><span class="ident" id="4701215">IEEE</span><span class="op" id="4701219">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4701222">//&nbsp;MakeTable&nbsp;returns&nbsp;the&nbsp;Table&nbsp;constructed&nbsp;from&nbsp;the&nbsp;specified&nbsp;polynomial.</span><br>
<span class="lineno"></span><span class="keyword" id="4701296">func</span>&nbsp;<span class="ident" id="4701301">MakeTable</span><span class="op" id="4701310">(</span><span class="ident" id="4701311">poly</span>&nbsp;<span class="builtintype" id="4701316">uint32</span><span class="op" id="4701322">)</span>&nbsp;<span class="op" id="4701324">*</span><span class="ident" id="4701325">Table</span>&nbsp;<span class="op" id="4701331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701334">switch</span>&nbsp;<span class="ident" id="4701341">poly</span>&nbsp;<span class="op" id="4701346">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701349">case</span>&nbsp;<span class="ident" id="4701354">IEEE</span><span class="op" id="4701358">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701362">return</span>&nbsp;<span class="ident" id="4701369">IEEETable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701380">case</span>&nbsp;<span class="ident" id="4701385">Castagnoli</span><span class="op" id="4701395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701399">castagnoliOnce</span><span class="op" id="4701413">.</span><span class="ident" id="4701414">Do</span><span class="op" id="4701416">(</span><span class="ident" id="4701417">castagnoliInit</span><span class="op" id="4701431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701435">return</span>&nbsp;<span class="ident" id="4701442">castagnoliTable</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4701459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701462">return</span>&nbsp;<span class="ident" id="4701469">makeTable</span><span class="op" id="4701478">(</span><span class="ident" id="4701479">poly</span><span class="op" id="4701483">)</span><br>
<span class="lineno"></span><span class="op" id="4701485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4701488">//&nbsp;makeTable&nbsp;returns&nbsp;the&nbsp;Table&nbsp;constructed&nbsp;from&nbsp;the&nbsp;specified&nbsp;polynomial.</span><br>
<span class="lineno">65</span><span class="keyword" id="4701562">func</span>&nbsp;<span class="ident" id="4701567">makeTable</span><span class="op" id="4701576">(</span><span class="ident" id="4701577">poly</span>&nbsp;<span class="builtintype" id="4701582">uint32</span><span class="op" id="4701588">)</span>&nbsp;<span class="op" id="4701590">*</span><span class="ident" id="4701591">Table</span>&nbsp;<span class="op" id="4701597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701600">t</span>&nbsp;<span class="op" id="4701602">:=</span>&nbsp;<span class="builtinfunc" id="4701605">new</span><span class="op" id="4701608">(</span><span class="ident" id="4701609">Table</span><span class="op" id="4701614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701617">for</span>&nbsp;<span class="ident" id="4701621">i</span>&nbsp;<span class="op" id="4701623">:=</span>&nbsp;<span class="num" id="4701626">0</span><span class="op" id="4701627">;</span>&nbsp;<span class="ident" id="4701629">i</span>&nbsp;<span class="op" id="4701631">&lt;</span>&nbsp;<span class="num" id="4701633">256</span><span class="op" id="4701636">;</span>&nbsp;<span class="ident" id="4701638">i</span><span class="op" id="4701639">++</span>&nbsp;<span class="op" id="4701642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701646">crc</span>&nbsp;<span class="op" id="4701650">:=</span>&nbsp;<span class="builtintype" id="4701653">uint32</span><span class="op" id="4701659">(</span><span class="ident" id="4701660">i</span><span class="op" id="4701661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701665">for</span>&nbsp;<span class="ident" id="4701669">j</span>&nbsp;<span class="op" id="4701671">:=</span>&nbsp;<span class="num" id="4701674">0</span><span class="op" id="4701675">;</span>&nbsp;<span class="ident" id="4701677">j</span>&nbsp;<span class="op" id="4701679">&lt;</span>&nbsp;<span class="num" id="4701681">8</span><span class="op" id="4701682">;</span>&nbsp;<span class="ident" id="4701684">j</span><span class="op" id="4701685">++</span>&nbsp;<span class="op" id="4701688">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701693">if</span>&nbsp;<span class="ident" id="4701696">crc</span><span class="op" id="4701699">&amp;</span><span class="num" id="4701700">1</span>&nbsp;<span class="op" id="4701702">==</span>&nbsp;<span class="num" id="4701705">1</span>&nbsp;<span class="op" id="4701707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701713">crc</span>&nbsp;<span class="op" id="4701717">=</span>&nbsp;<span class="op" id="4701719">(</span><span class="ident" id="4701720">crc</span>&nbsp;<span class="op" id="4701724">&gt;&gt;</span>&nbsp;<span class="num" id="4701727">1</span><span class="op" id="4701728">)</span>&nbsp;<span class="op" id="4701730">^</span>&nbsp;<span class="ident" id="4701732">poly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4701740">}</span>&nbsp;<span class="keyword" id="4701742">else</span>&nbsp;<span class="op" id="4701747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701753">crc</span>&nbsp;<span class="op" id="4701757">&gt;&gt;=</span>&nbsp;<span class="num" id="4701761">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4701766">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4701770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701774">t</span><span class="op" id="4701775">[</span><span class="ident" id="4701776">i</span><span class="op" id="4701777">]</span>&nbsp;<span class="op" id="4701779">=</span>&nbsp;<span class="ident" id="4701781">crc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4701786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701789">return</span>&nbsp;<span class="ident" id="4701796">t</span><br>
<span class="lineno"></span><span class="op" id="4701798">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="4701801">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4701860">type</span>&nbsp;<span class="ident" id="4701865">digest</span>&nbsp;<span class="keyword" id="4701872">struct</span>&nbsp;<span class="op" id="4701879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701882">crc</span>&nbsp;<span class="builtintype" id="4701886">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701894">tab</span>&nbsp;<span class="op" id="4701898">*</span><span class="ident" id="4701899">Table</span><br>
<span class="lineno">85</span><span class="op" id="4701905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4701908">//&nbsp;New&nbsp;creates&nbsp;a&nbsp;new&nbsp;hash.Hash32&nbsp;computing&nbsp;the&nbsp;CRC-32&nbsp;checksum</span><br>
<span class="lineno"></span><span class="comment" id="4701971">//&nbsp;using&nbsp;the&nbsp;polynomial&nbsp;represented&nbsp;by&nbsp;the&nbsp;Table.</span><br>
<span class="lineno"></span><span class="keyword" id="4702021">func</span>&nbsp;<span class="ident" id="4702026">New</span><span class="op" id="4702029">(</span><span class="ident" id="4702030">tab</span>&nbsp;<span class="op" id="4702034">*</span><span class="ident" id="4702035">Table</span><span class="op" id="4702040">)</span>&nbsp;<span class="ident" id="4702042">hash</span><span class="op" id="4702046">.</span><span class="ident" id="4702047">Hash32</span>&nbsp;<span class="op" id="4702054">{</span>&nbsp;<span class="keyword" id="4702056">return</span>&nbsp;<span class="op" id="4702063">&amp;</span><span class="ident" id="4702064">digest</span><span class="op" id="4702070">{</span><span class="num" id="4702071">0</span><span class="op" id="4702072">,</span>&nbsp;<span class="ident" id="4702074">tab</span><span class="op" id="4702077">}</span>&nbsp;<span class="op" id="4702079">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="4702082">//&nbsp;NewIEEE&nbsp;creates&nbsp;a&nbsp;new&nbsp;hash.Hash32&nbsp;computing&nbsp;the&nbsp;CRC-32&nbsp;checksum</span><br>
<span class="lineno"></span><span class="comment" id="4702149">//&nbsp;using&nbsp;the&nbsp;IEEE&nbsp;polynomial.</span><br>
<span class="lineno"></span><span class="keyword" id="4702179">func</span>&nbsp;<span class="ident" id="4702184">NewIEEE</span><span class="op" id="4702191">(</span><span class="op" id="4702192">)</span>&nbsp;<span class="ident" id="4702194">hash</span><span class="op" id="4702198">.</span><span class="ident" id="4702199">Hash32</span>&nbsp;<span class="op" id="4702206">{</span>&nbsp;<span class="keyword" id="4702208">return</span>&nbsp;<span class="ident" id="4702215">New</span><span class="op" id="4702218">(</span><span class="ident" id="4702219">IEEETable</span><span class="op" id="4702228">)</span>&nbsp;<span class="op" id="4702230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4702233">func</span>&nbsp;<span class="op" id="4702238">(</span><span class="ident" id="4702239">d</span>&nbsp;<span class="op" id="4702241">*</span><span class="ident" id="4702242">digest</span><span class="op" id="4702248">)</span>&nbsp;<span class="ident" id="4702250">Size</span><span class="op" id="4702254">(</span><span class="op" id="4702255">)</span>&nbsp;<span class="builtintype" id="4702257">int</span>&nbsp;<span class="op" id="4702261">{</span>&nbsp;<span class="keyword" id="4702263">return</span>&nbsp;<span class="ident" id="4702270">Size</span>&nbsp;<span class="op" id="4702275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4702278">func</span>&nbsp;<span class="op" id="4702283">(</span><span class="ident" id="4702284">d</span>&nbsp;<span class="op" id="4702286">*</span><span class="ident" id="4702287">digest</span><span class="op" id="4702293">)</span>&nbsp;<span class="ident" id="4702295">BlockSize</span><span class="op" id="4702304">(</span><span class="op" id="4702305">)</span>&nbsp;<span class="builtintype" id="4702307">int</span>&nbsp;<span class="op" id="4702311">{</span>&nbsp;<span class="keyword" id="4702313">return</span>&nbsp;<span class="num" id="4702320">1</span>&nbsp;<span class="op" id="4702322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4702325">func</span>&nbsp;<span class="op" id="4702330">(</span><span class="ident" id="4702331">d</span>&nbsp;<span class="op" id="4702333">*</span><span class="ident" id="4702334">digest</span><span class="op" id="4702340">)</span>&nbsp;<span class="ident" id="4702342">Reset</span><span class="op" id="4702347">(</span><span class="op" id="4702348">)</span>&nbsp;<span class="op" id="4702350">{</span>&nbsp;<span class="ident" id="4702352">d</span><span class="op" id="4702353">.</span><span class="ident" id="4702354">crc</span>&nbsp;<span class="op" id="4702358">=</span>&nbsp;<span class="num" id="4702360">0</span>&nbsp;<span class="op" id="4702362">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="4702365">func</span>&nbsp;<span class="ident" id="4702370">update</span><span class="op" id="4702376">(</span><span class="ident" id="4702377">crc</span>&nbsp;<span class="builtintype" id="4702381">uint32</span><span class="op" id="4702387">,</span>&nbsp;<span class="ident" id="4702389">tab</span>&nbsp;<span class="op" id="4702393">*</span><span class="ident" id="4702394">Table</span><span class="op" id="4702399">,</span>&nbsp;<span class="ident" id="4702401">p</span>&nbsp;<span class="op" id="4702403">[</span><span class="op" id="4702404">]</span><span class="builtintype" id="4702405">byte</span><span class="op" id="4702409">)</span>&nbsp;<span class="builtintype" id="4702411">uint32</span>&nbsp;<span class="op" id="4702418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702421">crc</span>&nbsp;<span class="op" id="4702425">=</span>&nbsp;<span class="op" id="4702427">^</span><span class="ident" id="4702428">crc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702433">for</span>&nbsp;<span class="ident" id="4702437">_</span><span class="op" id="4702438">,</span>&nbsp;<span class="ident" id="4702440">v</span>&nbsp;<span class="op" id="4702442">:=</span>&nbsp;<span class="keyword" id="4702445">range</span>&nbsp;<span class="ident" id="4702451">p</span>&nbsp;<span class="op" id="4702453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702457">crc</span>&nbsp;<span class="op" id="4702461">=</span>&nbsp;<span class="ident" id="4702463">tab</span><span class="op" id="4702466">[</span><span class="builtintype" id="4702467">byte</span><span class="op" id="4702471">(</span><span class="ident" id="4702472">crc</span><span class="op" id="4702475">)</span><span class="op" id="4702476">^</span><span class="ident" id="4702477">v</span><span class="op" id="4702478">]</span>&nbsp;<span class="op" id="4702480">^</span>&nbsp;<span class="op" id="4702482">(</span><span class="ident" id="4702483">crc</span>&nbsp;<span class="op" id="4702487">&gt;&gt;</span>&nbsp;<span class="num" id="4702490">8</span><span class="op" id="4702491">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4702494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702497">return</span>&nbsp;<span class="op" id="4702504">^</span><span class="ident" id="4702505">crc</span><br>
<span class="lineno"></span><span class="op" id="4702509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4702512">//&nbsp;Update&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;adding&nbsp;the&nbsp;bytes&nbsp;in&nbsp;p&nbsp;to&nbsp;the&nbsp;crc.</span><br>
<span class="lineno">110</span><span class="keyword" id="4702578">func</span>&nbsp;<span class="ident" id="4702583">Update</span><span class="op" id="4702589">(</span><span class="ident" id="4702590">crc</span>&nbsp;<span class="builtintype" id="4702594">uint32</span><span class="op" id="4702600">,</span>&nbsp;<span class="ident" id="4702602">tab</span>&nbsp;<span class="op" id="4702606">*</span><span class="ident" id="4702607">Table</span><span class="op" id="4702612">,</span>&nbsp;<span class="ident" id="4702614">p</span>&nbsp;<span class="op" id="4702616">[</span><span class="op" id="4702617">]</span><span class="builtintype" id="4702618">byte</span><span class="op" id="4702622">)</span>&nbsp;<span class="builtintype" id="4702624">uint32</span>&nbsp;<span class="op" id="4702631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702634">if</span>&nbsp;<span class="ident" id="4702637">tab</span>&nbsp;<span class="op" id="4702641">==</span>&nbsp;<span class="ident" id="4702644">castagnoliTable</span>&nbsp;<span class="op" id="4702660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702664">return</span>&nbsp;<span class="ident" id="4702671">updateCastagnoli</span><span class="op" id="4702687">(</span><span class="ident" id="4702688">crc</span><span class="op" id="4702691">,</span>&nbsp;<span class="ident" id="4702693">p</span><span class="op" id="4702694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4702697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702700">return</span>&nbsp;<span class="ident" id="4702707">update</span><span class="op" id="4702713">(</span><span class="ident" id="4702714">crc</span><span class="op" id="4702717">,</span>&nbsp;<span class="ident" id="4702719">tab</span><span class="op" id="4702722">,</span>&nbsp;<span class="ident" id="4702724">p</span><span class="op" id="4702725">)</span><br>
<span class="lineno">115</span><span class="op" id="4702727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4702730">func</span>&nbsp;<span class="op" id="4702735">(</span><span class="ident" id="4702736">d</span>&nbsp;<span class="op" id="4702738">*</span><span class="ident" id="4702739">digest</span><span class="op" id="4702745">)</span>&nbsp;<span class="ident" id="4702747">Write</span><span class="op" id="4702752">(</span><span class="ident" id="4702753">p</span>&nbsp;<span class="op" id="4702755">[</span><span class="op" id="4702756">]</span><span class="builtintype" id="4702757">byte</span><span class="op" id="4702761">)</span>&nbsp;<span class="op" id="4702763">(</span><span class="ident" id="4702764">n</span>&nbsp;<span class="builtintype" id="4702766">int</span><span class="op" id="4702769">,</span>&nbsp;<span class="ident" id="4702771">err</span>&nbsp;<span class="builtintype" id="4702775">error</span><span class="op" id="4702780">)</span>&nbsp;<span class="op" id="4702782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702785">d</span><span class="op" id="4702786">.</span><span class="ident" id="4702787">crc</span>&nbsp;<span class="op" id="4702791">=</span>&nbsp;<span class="ident" id="4702793">Update</span><span class="op" id="4702799">(</span><span class="ident" id="4702800">d</span><span class="op" id="4702801">.</span><span class="ident" id="4702802">crc</span><span class="op" id="4702805">,</span>&nbsp;<span class="ident" id="4702807">d</span><span class="op" id="4702808">.</span><span class="ident" id="4702809">tab</span><span class="op" id="4702812">,</span>&nbsp;<span class="ident" id="4702814">p</span><span class="op" id="4702815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702818">return</span>&nbsp;<span class="builtinfunc" id="4702825">len</span><span class="op" id="4702828">(</span><span class="ident" id="4702829">p</span><span class="op" id="4702830">)</span><span class="op" id="4702831">,</span>&nbsp;<span class="ident" id="4702833">nil</span><br>
<span class="lineno">120</span><span class="op" id="4702837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4702840">func</span>&nbsp;<span class="op" id="4702845">(</span><span class="ident" id="4702846">d</span>&nbsp;<span class="op" id="4702848">*</span><span class="ident" id="4702849">digest</span><span class="op" id="4702855">)</span>&nbsp;<span class="ident" id="4702857">Sum32</span><span class="op" id="4702862">(</span><span class="op" id="4702863">)</span>&nbsp;<span class="builtintype" id="4702865">uint32</span>&nbsp;<span class="op" id="4702872">{</span>&nbsp;<span class="keyword" id="4702874">return</span>&nbsp;<span class="ident" id="4702881">d</span><span class="op" id="4702882">.</span><span class="ident" id="4702883">crc</span>&nbsp;<span class="op" id="4702887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4702890">func</span>&nbsp;<span class="op" id="4702895">(</span><span class="ident" id="4702896">d</span>&nbsp;<span class="op" id="4702898">*</span><span class="ident" id="4702899">digest</span><span class="op" id="4702905">)</span>&nbsp;<span class="ident" id="4702907">Sum</span><span class="op" id="4702910">(</span><span class="ident" id="4702911">in</span>&nbsp;<span class="op" id="4702914">[</span><span class="op" id="4702915">]</span><span class="builtintype" id="4702916">byte</span><span class="op" id="4702920">)</span>&nbsp;<span class="op" id="4702922">[</span><span class="op" id="4702923">]</span><span class="builtintype" id="4702924">byte</span>&nbsp;<span class="op" id="4702929">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702932">s</span>&nbsp;<span class="op" id="4702934">:=</span>&nbsp;<span class="ident" id="4702937">d</span><span class="op" id="4702938">.</span><span class="ident" id="4702939">Sum32</span><span class="op" id="4702944">(</span><span class="op" id="4702945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702948">return</span>&nbsp;<span class="builtinfunc" id="4702955">append</span><span class="op" id="4702961">(</span><span class="ident" id="4702962">in</span><span class="op" id="4702964">,</span>&nbsp;<span class="builtintype" id="4702966">byte</span><span class="op" id="4702970">(</span><span class="ident" id="4702971">s</span><span class="op" id="4702972">&gt;&gt;</span><span class="num" id="4702974">24</span><span class="op" id="4702976">)</span><span class="op" id="4702977">,</span>&nbsp;<span class="builtintype" id="4702979">byte</span><span class="op" id="4702983">(</span><span class="ident" id="4702984">s</span><span class="op" id="4702985">&gt;&gt;</span><span class="num" id="4702987">16</span><span class="op" id="4702989">)</span><span class="op" id="4702990">,</span>&nbsp;<span class="builtintype" id="4702992">byte</span><span class="op" id="4702996">(</span><span class="ident" id="4702997">s</span><span class="op" id="4702998">&gt;&gt;</span><span class="num" id="4703000">8</span><span class="op" id="4703001">)</span><span class="op" id="4703002">,</span>&nbsp;<span class="builtintype" id="4703004">byte</span><span class="op" id="4703008">(</span><span class="ident" id="4703009">s</span><span class="op" id="4703010">)</span><span class="op" id="4703011">)</span><br>
<span class="lineno"></span><span class="op" id="4703013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4703016">//&nbsp;Checksum&nbsp;returns&nbsp;the&nbsp;CRC-32&nbsp;checksum&nbsp;of&nbsp;data</span><br>
<span class="lineno">130</span><span class="comment" id="4703064">//&nbsp;using&nbsp;the&nbsp;polynomial&nbsp;represented&nbsp;by&nbsp;the&nbsp;Table.</span><br>
<span class="lineno"></span><span class="keyword" id="4703114">func</span>&nbsp;<span class="ident" id="4703119">Checksum</span><span class="op" id="4703127">(</span><span class="ident" id="4703128">data</span>&nbsp;<span class="op" id="4703133">[</span><span class="op" id="4703134">]</span><span class="builtintype" id="4703135">byte</span><span class="op" id="4703139">,</span>&nbsp;<span class="ident" id="4703141">tab</span>&nbsp;<span class="op" id="4703145">*</span><span class="ident" id="4703146">Table</span><span class="op" id="4703151">)</span>&nbsp;<span class="builtintype" id="4703153">uint32</span>&nbsp;<span class="op" id="4703160">{</span>&nbsp;<span class="keyword" id="4703162">return</span>&nbsp;<span class="ident" id="4703169">Update</span><span class="op" id="4703175">(</span><span class="num" id="4703176">0</span><span class="op" id="4703177">,</span>&nbsp;<span class="ident" id="4703179">tab</span><span class="op" id="4703182">,</span>&nbsp;<span class="ident" id="4703184">data</span><span class="op" id="4703188">)</span>&nbsp;<span class="op" id="4703190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4703193">//&nbsp;ChecksumIEEE&nbsp;returns&nbsp;the&nbsp;CRC-32&nbsp;checksum&nbsp;of&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="4703245">//&nbsp;using&nbsp;the&nbsp;IEEE&nbsp;polynomial.</span><br>
<span class="lineno">135</span><span class="keyword" id="4703275">func</span>&nbsp;<span class="ident" id="4703280">ChecksumIEEE</span><span class="op" id="4703292">(</span><span class="ident" id="4703293">data</span>&nbsp;<span class="op" id="4703298">[</span><span class="op" id="4703299">]</span><span class="builtintype" id="4703300">byte</span><span class="op" id="4703304">)</span>&nbsp;<span class="builtintype" id="4703306">uint32</span>&nbsp;<span class="op" id="4703313">{</span>&nbsp;<span class="keyword" id="4703315">return</span>&nbsp;<span class="ident" id="4703322">update</span><span class="op" id="4703328">(</span><span class="num" id="4703329">0</span><span class="op" id="4703330">,</span>&nbsp;<span class="ident" id="4703332">IEEETable</span><span class="op" id="4703341">,</span>&nbsp;<span class="ident" id="4703343">data</span><span class="op" id="4703347">)</span>&nbsp;<span class="op" id="4703349">}</span>
</div>
</body>
</html>
