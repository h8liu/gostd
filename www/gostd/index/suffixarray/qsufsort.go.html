<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html" class="current">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5811074">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5811129">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5811183">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5811234">//&nbsp;This&nbsp;algorithm&nbsp;is&nbsp;based&nbsp;on&nbsp;&#34;Faster&nbsp;Suffix&nbsp;Sorting&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5811288">//&nbsp;&nbsp;&nbsp;by&nbsp;N.&nbsp;Jesper&nbsp;Larsson&nbsp;and&nbsp;Kunihiko&nbsp;Sadakane</span><br>
<span class="lineno"></span><span class="comment" id="5811336">//&nbsp;paper:&nbsp;http://www.larsson.dogma.net/ssrev-tr.pdf</span><br>
<span class="lineno"></span><span class="comment" id="5811388">//&nbsp;code:&nbsp;&nbsp;http://www.larsson.dogma.net/qsufsort.c</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="5811439">//&nbsp;This&nbsp;algorithm&nbsp;computes&nbsp;the&nbsp;suffix&nbsp;array&nbsp;sa&nbsp;by&nbsp;computing&nbsp;its&nbsp;inverse.</span><br>
<span class="lineno"></span><span class="comment" id="5811512">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;in&nbsp;sa&nbsp;are&nbsp;labeled&nbsp;as&nbsp;sorted&nbsp;groups&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5811584">//&nbsp;unsorted&nbsp;groups.&nbsp;For&nbsp;a&nbsp;given&nbsp;pass&nbsp;of&nbsp;the&nbsp;sorter,&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;ordered</span><br>
<span class="lineno"></span><span class="comment" id="5811661">//&nbsp;up&nbsp;to&nbsp;their&nbsp;first&nbsp;h&nbsp;characters,&nbsp;and&nbsp;sa&nbsp;is&nbsp;h-ordered.&nbsp;Suffixes&nbsp;in&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="5811735">//&nbsp;final&nbsp;positions&nbsp;and&nbsp;unambiguously&nbsp;sorted&nbsp;in&nbsp;h-order&nbsp;are&nbsp;in&nbsp;a&nbsp;sorted&nbsp;group.</span><br>
<span class="lineno">15</span><span class="comment" id="5811813">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;with&nbsp;identical&nbsp;first&nbsp;h&nbsp;characters&nbsp;are&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5811888">//&nbsp;unsorted&nbsp;group.&nbsp;In&nbsp;each&nbsp;pass&nbsp;of&nbsp;the&nbsp;algorithm,&nbsp;unsorted&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span><span class="comment" id="5811965">//&nbsp;according&nbsp;to&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;their&nbsp;following&nbsp;suffix.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5812026">//&nbsp;In&nbsp;the&nbsp;implementation,&nbsp;if&nbsp;sa[i]&nbsp;is&nbsp;negative,&nbsp;it&nbsp;indicates&nbsp;that&nbsp;i&nbsp;is</span><br>
<span class="lineno">20</span><span class="comment" id="5812097">//&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;a&nbsp;sorted&nbsp;group&nbsp;of&nbsp;length&nbsp;-sa[i],&nbsp;and&nbsp;can&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="comment" id="5812174">//&nbsp;An&nbsp;unsorted&nbsp;group&nbsp;sa[i:k]&nbsp;is&nbsp;given&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;the&nbsp;index&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5812249">//&nbsp;last&nbsp;element,&nbsp;k-1.&nbsp;The&nbsp;group&nbsp;numbers&nbsp;are&nbsp;stored&nbsp;in&nbsp;the&nbsp;inverse&nbsp;slice&nbsp;(inv),</span><br>
<span class="lineno"></span><span class="comment" id="5812328">//&nbsp;and&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted,&nbsp;this&nbsp;slice&nbsp;is&nbsp;the&nbsp;inverse&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5812404">package</span>&nbsp;<span class="ident" id="5812412">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5812425">import</span>&nbsp;<span class="string" id="5812432">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5812440">func</span>&nbsp;<span class="ident" id="5812445">qsufsort</span><span class="op" id="5812453">(</span><span class="ident" id="5812454">data</span>&nbsp;<span class="op" id="5812459">[</span><span class="op" id="5812460">]</span><span class="builtintype" id="5812461">byte</span><span class="op" id="5812465">)</span>&nbsp;<span class="op" id="5812467">[</span><span class="op" id="5812468">]</span><span class="builtintype" id="5812469">int</span>&nbsp;<span class="op" id="5812473">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5812476">//&nbsp;initial&nbsp;sorting&nbsp;by&nbsp;first&nbsp;byte&nbsp;of&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5812520">sa</span>&nbsp;<span class="op" id="5812523">:=</span>&nbsp;<span class="ident" id="5812526">sortedByFirstByte</span><span class="op" id="5812543">(</span><span class="ident" id="5812544">data</span><span class="op" id="5812548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5812551">if</span>&nbsp;<span class="builtinfunc" id="5812554">len</span><span class="op" id="5812557">(</span><span class="ident" id="5812558">sa</span><span class="op" id="5812560">)</span>&nbsp;<span class="op" id="5812562">&lt;</span>&nbsp;<span class="num" id="5812564">2</span>&nbsp;<span class="op" id="5812566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5812570">return</span>&nbsp;<span class="ident" id="5812577">sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5812581">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5812584">//&nbsp;initialize&nbsp;the&nbsp;group&nbsp;lookup&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5812622">//&nbsp;this&nbsp;becomes&nbsp;the&nbsp;inverse&nbsp;of&nbsp;the&nbsp;suffix&nbsp;array&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5812698">inv</span>&nbsp;<span class="op" id="5812702">:=</span>&nbsp;<span class="ident" id="5812705">initGroups</span><span class="op" id="5812715">(</span><span class="ident" id="5812716">sa</span><span class="op" id="5812718">,</span>&nbsp;<span class="ident" id="5812720">data</span><span class="op" id="5812724">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5812728">//&nbsp;the&nbsp;index&nbsp;starts&nbsp;1-ordered</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5812759">sufSortable</span>&nbsp;<span class="op" id="5812771">:=</span>&nbsp;<span class="op" id="5812774">&amp;</span><span class="ident" id="5812775">suffixSortable</span><span class="op" id="5812789">{</span><span class="ident" id="5812790">sa</span><span class="op" id="5812792">:</span>&nbsp;<span class="ident" id="5812794">sa</span><span class="op" id="5812796">,</span>&nbsp;<span class="ident" id="5812798">inv</span><span class="op" id="5812801">:</span>&nbsp;<span class="ident" id="5812803">inv</span><span class="op" id="5812806">,</span>&nbsp;<span class="ident" id="5812808">h</span><span class="op" id="5812809">:</span>&nbsp;<span class="num" id="5812811">1</span><span class="op" id="5812812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5812816">for</span>&nbsp;<span class="ident" id="5812820">sa</span><span class="op" id="5812822">[</span><span class="num" id="5812823">0</span><span class="op" id="5812824">]</span>&nbsp;<span class="op" id="5812826">&gt;</span>&nbsp;<span class="op" id="5812828">-</span><span class="builtinfunc" id="5812829">len</span><span class="op" id="5812832">(</span><span class="ident" id="5812833">sa</span><span class="op" id="5812835">)</span>&nbsp;<span class="op" id="5812837">{</span>&nbsp;<span class="comment" id="5812839">//&nbsp;until&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;one&nbsp;big&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5812888">//&nbsp;The&nbsp;suffixes&nbsp;are&nbsp;h-ordered,&nbsp;make&nbsp;them&nbsp;2*h-ordered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5812943">pi</span>&nbsp;<span class="op" id="5812946">:=</span>&nbsp;<span class="num" id="5812949">0</span>&nbsp;<span class="comment" id="5812951">//&nbsp;pi&nbsp;is&nbsp;first&nbsp;position&nbsp;of&nbsp;first&nbsp;group</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5812992">sl</span>&nbsp;<span class="op" id="5812995">:=</span>&nbsp;<span class="num" id="5812998">0</span>&nbsp;<span class="comment" id="5813000">//&nbsp;sl&nbsp;is&nbsp;negated&nbsp;length&nbsp;of&nbsp;sorted&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5813043">for</span>&nbsp;<span class="ident" id="5813047">pi</span>&nbsp;<span class="op" id="5813050">&lt;</span>&nbsp;<span class="builtinfunc" id="5813052">len</span><span class="op" id="5813055">(</span><span class="ident" id="5813056">sa</span><span class="op" id="5813058">)</span>&nbsp;<span class="op" id="5813060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5813065">if</span>&nbsp;<span class="ident" id="5813068">s</span>&nbsp;<span class="op" id="5813070">:=</span>&nbsp;<span class="ident" id="5813073">sa</span><span class="op" id="5813075">[</span><span class="ident" id="5813076">pi</span><span class="op" id="5813078">]</span><span class="op" id="5813079">;</span>&nbsp;<span class="ident" id="5813081">s</span>&nbsp;<span class="op" id="5813083">&lt;</span>&nbsp;<span class="num" id="5813085">0</span>&nbsp;<span class="op" id="5813087">{</span>&nbsp;<span class="comment" id="5813089">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5813122">pi</span>&nbsp;<span class="op" id="5813125">-=</span>&nbsp;<span class="ident" id="5813128">s</span>&nbsp;<span class="comment" id="5813130">//&nbsp;skip&nbsp;over&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5813160">sl</span>&nbsp;<span class="op" id="5813163">+=</span>&nbsp;<span class="ident" id="5813166">s</span>&nbsp;<span class="comment" id="5813168">//&nbsp;add&nbsp;negated&nbsp;length&nbsp;to&nbsp;sl</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5813199">}</span>&nbsp;<span class="keyword" id="5813201">else</span>&nbsp;<span class="op" id="5813206">{</span>&nbsp;<span class="comment" id="5813208">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5813243">if</span>&nbsp;<span class="ident" id="5813246">sl</span>&nbsp;<span class="op" id="5813249">!=</span>&nbsp;<span class="num" id="5813252">0</span>&nbsp;<span class="op" id="5813254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5813261">sa</span><span class="op" id="5813263">[</span><span class="ident" id="5813264">pi</span><span class="op" id="5813266">+</span><span class="ident" id="5813267">sl</span><span class="op" id="5813269">]</span>&nbsp;<span class="op" id="5813271">=</span>&nbsp;<span class="ident" id="5813273">sl</span>&nbsp;<span class="comment" id="5813276">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;before&nbsp;pi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5813316">sl</span>&nbsp;<span class="op" id="5813319">=</span>&nbsp;<span class="num" id="5813321">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5813327">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5813333">pk</span>&nbsp;<span class="op" id="5813336">:=</span>&nbsp;<span class="ident" id="5813339">inv</span><span class="op" id="5813342">[</span><span class="ident" id="5813343">s</span><span class="op" id="5813344">]</span>&nbsp;<span class="op" id="5813346">+</span>&nbsp;<span class="num" id="5813348">1</span>&nbsp;<span class="comment" id="5813350">//&nbsp;pk-1&nbsp;is&nbsp;last&nbsp;position&nbsp;of&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5813397">sufSortable</span><span class="op" id="5813408">.</span><span class="ident" id="5813409">sa</span>&nbsp;<span class="op" id="5813412">=</span>&nbsp;<span class="ident" id="5813414">sa</span><span class="op" id="5813416">[</span><span class="ident" id="5813417">pi</span><span class="op" id="5813419">:</span><span class="ident" id="5813420">pk</span><span class="op" id="5813422">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5813428">sort</span><span class="op" id="5813432">.</span><span class="ident" id="5813433">Sort</span><span class="op" id="5813437">(</span><span class="ident" id="5813438">sufSortable</span><span class="op" id="5813449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5813455">sufSortable</span><span class="op" id="5813466">.</span><span class="ident" id="5813467">updateGroups</span><span class="op" id="5813479">(</span><span class="ident" id="5813480">pi</span><span class="op" id="5813482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5813488">pi</span>&nbsp;<span class="op" id="5813491">=</span>&nbsp;<span class="ident" id="5813493">pk</span>&nbsp;<span class="comment" id="5813496">//&nbsp;next&nbsp;group</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5813513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5813517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5813521">if</span>&nbsp;<span class="ident" id="5813524">sl</span>&nbsp;<span class="op" id="5813527">!=</span>&nbsp;<span class="num" id="5813530">0</span>&nbsp;<span class="op" id="5813532">{</span>&nbsp;<span class="comment" id="5813534">//&nbsp;if&nbsp;the&nbsp;array&nbsp;ends&nbsp;with&nbsp;a&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5813578">sa</span><span class="op" id="5813580">[</span><span class="ident" id="5813581">pi</span><span class="op" id="5813583">+</span><span class="ident" id="5813584">sl</span><span class="op" id="5813586">]</span>&nbsp;<span class="op" id="5813588">=</span>&nbsp;<span class="ident" id="5813590">sl</span>&nbsp;<span class="comment" id="5813593">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;at&nbsp;end&nbsp;of&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5813633">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5813638">sufSortable</span><span class="op" id="5813649">.</span><span class="ident" id="5813650">h</span>&nbsp;<span class="op" id="5813652">*=</span>&nbsp;<span class="num" id="5813655">2</span>&nbsp;<span class="comment" id="5813657">//&nbsp;double&nbsp;sorted&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5813681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5813685">for</span>&nbsp;<span class="ident" id="5813689">i</span>&nbsp;<span class="op" id="5813691">:=</span>&nbsp;<span class="keyword" id="5813694">range</span>&nbsp;<span class="ident" id="5813700">sa</span>&nbsp;<span class="op" id="5813703">{</span>&nbsp;<span class="comment" id="5813705">//&nbsp;reconstruct&nbsp;suffix&nbsp;array&nbsp;from&nbsp;inverse</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5813748">sa</span><span class="op" id="5813750">[</span><span class="ident" id="5813751">inv</span><span class="op" id="5813754">[</span><span class="ident" id="5813755">i</span><span class="op" id="5813756">]</span><span class="op" id="5813757">]</span>&nbsp;<span class="op" id="5813759">=</span>&nbsp;<span class="ident" id="5813761">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5813764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5813767">return</span>&nbsp;<span class="ident" id="5813774">sa</span><br>
<span class="lineno"></span><span class="op" id="5813777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5813780">func</span>&nbsp;<span class="ident" id="5813785">sortedByFirstByte</span><span class="op" id="5813802">(</span><span class="ident" id="5813803">data</span>&nbsp;<span class="op" id="5813808">[</span><span class="op" id="5813809">]</span><span class="builtintype" id="5813810">byte</span><span class="op" id="5813814">)</span>&nbsp;<span class="op" id="5813816">[</span><span class="op" id="5813817">]</span><span class="builtintype" id="5813818">int</span>&nbsp;<span class="op" id="5813822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5813825">//&nbsp;total&nbsp;byte&nbsp;counts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5813847">var</span>&nbsp;<span class="ident" id="5813851">count</span>&nbsp;<span class="op" id="5813857">[</span><span class="num" id="5813858">256</span><span class="op" id="5813861">]</span><span class="builtintype" id="5813862">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5813867">for</span>&nbsp;<span class="ident" id="5813871">_</span><span class="op" id="5813872">,</span>&nbsp;<span class="ident" id="5813874">b</span>&nbsp;<span class="op" id="5813876">:=</span>&nbsp;<span class="keyword" id="5813879">range</span>&nbsp;<span class="ident" id="5813885">data</span>&nbsp;<span class="op" id="5813890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5813894">count</span><span class="op" id="5813899">[</span><span class="ident" id="5813900">b</span><span class="op" id="5813901">]</span><span class="op" id="5813902">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5813906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5813909">//&nbsp;make&nbsp;count[b]&nbsp;equal&nbsp;index&nbsp;of&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;sorted&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5813980">sum</span>&nbsp;<span class="op" id="5813984">:=</span>&nbsp;<span class="num" id="5813987">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5813990">for</span>&nbsp;<span class="ident" id="5813994">b</span>&nbsp;<span class="op" id="5813996">:=</span>&nbsp;<span class="keyword" id="5813999">range</span>&nbsp;<span class="ident" id="5814005">count</span>&nbsp;<span class="op" id="5814011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814015">count</span><span class="op" id="5814020">[</span><span class="ident" id="5814021">b</span><span class="op" id="5814022">]</span><span class="op" id="5814023">,</span>&nbsp;<span class="ident" id="5814025">sum</span>&nbsp;<span class="op" id="5814029">=</span>&nbsp;<span class="ident" id="5814031">sum</span><span class="op" id="5814034">,</span>&nbsp;<span class="ident" id="5814036">count</span><span class="op" id="5814041">[</span><span class="ident" id="5814042">b</span><span class="op" id="5814043">]</span><span class="op" id="5814044">+</span><span class="ident" id="5814045">sum</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5814050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5814053">//&nbsp;iterate&nbsp;through&nbsp;bytes,&nbsp;placing&nbsp;index&nbsp;into&nbsp;the&nbsp;correct&nbsp;spot&nbsp;in&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814122">sa</span>&nbsp;<span class="op" id="5814125">:=</span>&nbsp;<span class="builtinfunc" id="5814128">make</span><span class="op" id="5814132">(</span><span class="op" id="5814133">[</span><span class="op" id="5814134">]</span><span class="builtintype" id="5814135">int</span><span class="op" id="5814138">,</span>&nbsp;<span class="builtinfunc" id="5814140">len</span><span class="op" id="5814143">(</span><span class="ident" id="5814144">data</span><span class="op" id="5814148">)</span><span class="op" id="5814149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5814152">for</span>&nbsp;<span class="ident" id="5814156">i</span><span class="op" id="5814157">,</span>&nbsp;<span class="ident" id="5814159">b</span>&nbsp;<span class="op" id="5814161">:=</span>&nbsp;<span class="keyword" id="5814164">range</span>&nbsp;<span class="ident" id="5814170">data</span>&nbsp;<span class="op" id="5814175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814179">sa</span><span class="op" id="5814181">[</span><span class="ident" id="5814182">count</span><span class="op" id="5814187">[</span><span class="ident" id="5814188">b</span><span class="op" id="5814189">]</span><span class="op" id="5814190">]</span>&nbsp;<span class="op" id="5814192">=</span>&nbsp;<span class="ident" id="5814194">i</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814198">count</span><span class="op" id="5814203">[</span><span class="ident" id="5814204">b</span><span class="op" id="5814205">]</span><span class="op" id="5814206">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5814210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5814213">return</span>&nbsp;<span class="ident" id="5814220">sa</span><br>
<span class="lineno"></span><span class="op" id="5814223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5814226">func</span>&nbsp;<span class="ident" id="5814231">initGroups</span><span class="op" id="5814241">(</span><span class="ident" id="5814242">sa</span>&nbsp;<span class="op" id="5814245">[</span><span class="op" id="5814246">]</span><span class="builtintype" id="5814247">int</span><span class="op" id="5814250">,</span>&nbsp;<span class="ident" id="5814252">data</span>&nbsp;<span class="op" id="5814257">[</span><span class="op" id="5814258">]</span><span class="builtintype" id="5814259">byte</span><span class="op" id="5814263">)</span>&nbsp;<span class="op" id="5814265">[</span><span class="op" id="5814266">]</span><span class="builtintype" id="5814267">int</span>&nbsp;<span class="op" id="5814271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5814274">//&nbsp;label&nbsp;contiguous&nbsp;same-letter&nbsp;groups&nbsp;with&nbsp;the&nbsp;same&nbsp;group&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814341">inv</span>&nbsp;<span class="op" id="5814345">:=</span>&nbsp;<span class="builtinfunc" id="5814348">make</span><span class="op" id="5814352">(</span><span class="op" id="5814353">[</span><span class="op" id="5814354">]</span><span class="builtintype" id="5814355">int</span><span class="op" id="5814358">,</span>&nbsp;<span class="builtinfunc" id="5814360">len</span><span class="op" id="5814363">(</span><span class="ident" id="5814364">data</span><span class="op" id="5814368">)</span><span class="op" id="5814369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814372">prevGroup</span>&nbsp;<span class="op" id="5814382">:=</span>&nbsp;<span class="builtinfunc" id="5814385">len</span><span class="op" id="5814388">(</span><span class="ident" id="5814389">sa</span><span class="op" id="5814391">)</span>&nbsp;<span class="op" id="5814393">-</span>&nbsp;<span class="num" id="5814395">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814398">groupByte</span>&nbsp;<span class="op" id="5814408">:=</span>&nbsp;<span class="ident" id="5814411">data</span><span class="op" id="5814415">[</span><span class="ident" id="5814416">sa</span><span class="op" id="5814418">[</span><span class="ident" id="5814419">prevGroup</span><span class="op" id="5814428">]</span><span class="op" id="5814429">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5814432">for</span>&nbsp;<span class="ident" id="5814436">i</span>&nbsp;<span class="op" id="5814438">:=</span>&nbsp;<span class="builtinfunc" id="5814441">len</span><span class="op" id="5814444">(</span><span class="ident" id="5814445">sa</span><span class="op" id="5814447">)</span>&nbsp;<span class="op" id="5814449">-</span>&nbsp;<span class="num" id="5814451">1</span><span class="op" id="5814452">;</span>&nbsp;<span class="ident" id="5814454">i</span>&nbsp;<span class="op" id="5814456">&gt;=</span>&nbsp;<span class="num" id="5814459">0</span><span class="op" id="5814460">;</span>&nbsp;<span class="ident" id="5814462">i</span><span class="op" id="5814463">--</span>&nbsp;<span class="op" id="5814466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5814470">if</span>&nbsp;<span class="ident" id="5814473">b</span>&nbsp;<span class="op" id="5814475">:=</span>&nbsp;<span class="ident" id="5814478">data</span><span class="op" id="5814482">[</span><span class="ident" id="5814483">sa</span><span class="op" id="5814485">[</span><span class="ident" id="5814486">i</span><span class="op" id="5814487">]</span><span class="op" id="5814488">]</span><span class="op" id="5814489">;</span>&nbsp;<span class="ident" id="5814491">b</span>&nbsp;<span class="op" id="5814493">&lt;</span>&nbsp;<span class="ident" id="5814495">groupByte</span>&nbsp;<span class="op" id="5814505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5814510">if</span>&nbsp;<span class="ident" id="5814513">prevGroup</span>&nbsp;<span class="op" id="5814523">==</span>&nbsp;<span class="ident" id="5814526">i</span><span class="op" id="5814527">+</span><span class="num" id="5814528">1</span>&nbsp;<span class="op" id="5814530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814536">sa</span><span class="op" id="5814538">[</span><span class="ident" id="5814539">i</span><span class="op" id="5814540">+</span><span class="num" id="5814541">1</span><span class="op" id="5814542">]</span>&nbsp;<span class="op" id="5814544">=</span>&nbsp;<span class="op" id="5814546">-</span><span class="num" id="5814547">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5814552">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814557">groupByte</span>&nbsp;<span class="op" id="5814567">=</span>&nbsp;<span class="ident" id="5814569">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814574">prevGroup</span>&nbsp;<span class="op" id="5814584">=</span>&nbsp;<span class="ident" id="5814586">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5814590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814594">inv</span><span class="op" id="5814597">[</span><span class="ident" id="5814598">sa</span><span class="op" id="5814600">[</span><span class="ident" id="5814601">i</span><span class="op" id="5814602">]</span><span class="op" id="5814603">]</span>&nbsp;<span class="op" id="5814605">=</span>&nbsp;<span class="ident" id="5814607">prevGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5814619">if</span>&nbsp;<span class="ident" id="5814622">prevGroup</span>&nbsp;<span class="op" id="5814632">==</span>&nbsp;<span class="num" id="5814635">0</span>&nbsp;<span class="op" id="5814637">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814642">sa</span><span class="op" id="5814644">[</span><span class="num" id="5814645">0</span><span class="op" id="5814646">]</span>&nbsp;<span class="op" id="5814648">=</span>&nbsp;<span class="op" id="5814650">-</span><span class="num" id="5814651">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5814655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5814658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5814661">//&nbsp;Separate&nbsp;out&nbsp;the&nbsp;final&nbsp;suffix&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;its&nbsp;group.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5814722">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;to&nbsp;ensure&nbsp;the&nbsp;suffix&nbsp;&#34;a&#34;&nbsp;is&nbsp;before&nbsp;&#34;aba&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5814785">//&nbsp;when&nbsp;using&nbsp;a&nbsp;potentially&nbsp;unstable&nbsp;sort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814829">lastByte</span>&nbsp;<span class="op" id="5814838">:=</span>&nbsp;<span class="ident" id="5814841">data</span><span class="op" id="5814845">[</span><span class="builtinfunc" id="5814846">len</span><span class="op" id="5814849">(</span><span class="ident" id="5814850">data</span><span class="op" id="5814854">)</span><span class="op" id="5814855">-</span><span class="num" id="5814856">1</span><span class="op" id="5814857">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814860">s</span>&nbsp;<span class="op" id="5814862">:=</span>&nbsp;<span class="op" id="5814865">-</span><span class="num" id="5814866">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5814869">for</span>&nbsp;<span class="ident" id="5814873">i</span>&nbsp;<span class="op" id="5814875">:=</span>&nbsp;<span class="keyword" id="5814878">range</span>&nbsp;<span class="ident" id="5814884">sa</span>&nbsp;<span class="op" id="5814887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5814891">if</span>&nbsp;<span class="ident" id="5814894">sa</span><span class="op" id="5814896">[</span><span class="ident" id="5814897">i</span><span class="op" id="5814898">]</span>&nbsp;<span class="op" id="5814900">&gt;=</span>&nbsp;<span class="num" id="5814903">0</span>&nbsp;<span class="op" id="5814905">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5814910">if</span>&nbsp;<span class="ident" id="5814913">data</span><span class="op" id="5814917">[</span><span class="ident" id="5814918">sa</span><span class="op" id="5814920">[</span><span class="ident" id="5814921">i</span><span class="op" id="5814922">]</span><span class="op" id="5814923">]</span>&nbsp;<span class="op" id="5814925">==</span>&nbsp;<span class="ident" id="5814928">lastByte</span>&nbsp;<span class="op" id="5814937">&amp;&amp;</span>&nbsp;<span class="ident" id="5814940">s</span>&nbsp;<span class="op" id="5814942">==</span>&nbsp;<span class="op" id="5814945">-</span><span class="num" id="5814946">1</span>&nbsp;<span class="op" id="5814948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814954">s</span>&nbsp;<span class="op" id="5814956">=</span>&nbsp;<span class="ident" id="5814958">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5814963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5814968">if</span>&nbsp;<span class="ident" id="5814971">sa</span><span class="op" id="5814973">[</span><span class="ident" id="5814974">i</span><span class="op" id="5814975">]</span>&nbsp;<span class="op" id="5814977">==</span>&nbsp;<span class="builtinfunc" id="5814980">len</span><span class="op" id="5814983">(</span><span class="ident" id="5814984">sa</span><span class="op" id="5814986">)</span><span class="op" id="5814987">-</span><span class="num" id="5814988">1</span>&nbsp;<span class="op" id="5814990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5814996">sa</span><span class="op" id="5814998">[</span><span class="ident" id="5814999">i</span><span class="op" id="5815000">]</span><span class="op" id="5815001">,</span>&nbsp;<span class="ident" id="5815003">sa</span><span class="op" id="5815005">[</span><span class="ident" id="5815006">s</span><span class="op" id="5815007">]</span>&nbsp;<span class="op" id="5815009">=</span>&nbsp;<span class="ident" id="5815011">sa</span><span class="op" id="5815013">[</span><span class="ident" id="5815014">s</span><span class="op" id="5815015">]</span><span class="op" id="5815016">,</span>&nbsp;<span class="ident" id="5815018">sa</span><span class="op" id="5815020">[</span><span class="ident" id="5815021">i</span><span class="op" id="5815022">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815028">inv</span><span class="op" id="5815031">[</span><span class="ident" id="5815032">sa</span><span class="op" id="5815034">[</span><span class="ident" id="5815035">s</span><span class="op" id="5815036">]</span><span class="op" id="5815037">]</span>&nbsp;<span class="op" id="5815039">=</span>&nbsp;<span class="ident" id="5815041">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815047">sa</span><span class="op" id="5815049">[</span><span class="ident" id="5815050">s</span><span class="op" id="5815051">]</span>&nbsp;<span class="op" id="5815053">=</span>&nbsp;<span class="op" id="5815055">-</span><span class="num" id="5815056">1</span>&nbsp;<span class="comment" id="5815058">//&nbsp;mark&nbsp;it&nbsp;as&nbsp;an&nbsp;isolated&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5815101">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5815110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5815114">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5815117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5815120">return</span>&nbsp;<span class="ident" id="5815127">inv</span><br>
<span class="lineno"></span><span class="op" id="5815131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5815134">type</span>&nbsp;<span class="ident" id="5815139">suffixSortable</span>&nbsp;<span class="keyword" id="5815154">struct</span>&nbsp;<span class="op" id="5815161">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815164">sa</span>&nbsp;&nbsp;<span class="op" id="5815168">[</span><span class="op" id="5815169">]</span><span class="builtintype" id="5815170">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815175">inv</span>&nbsp;<span class="op" id="5815179">[</span><span class="op" id="5815180">]</span><span class="builtintype" id="5815181">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815186">h</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5815190">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815195">buf</span>&nbsp;<span class="op" id="5815199">[</span><span class="op" id="5815200">]</span><span class="builtintype" id="5815201">int</span>&nbsp;<span class="comment" id="5815205">//&nbsp;common&nbsp;scratch&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="5815229">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="5815232">func</span>&nbsp;<span class="op" id="5815237">(</span><span class="ident" id="5815238">x</span>&nbsp;<span class="op" id="5815240">*</span><span class="ident" id="5815241">suffixSortable</span><span class="op" id="5815255">)</span>&nbsp;<span class="ident" id="5815257">Len</span><span class="op" id="5815260">(</span><span class="op" id="5815261">)</span>&nbsp;<span class="builtintype" id="5815263">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5815277">{</span>&nbsp;<span class="keyword" id="5815279">return</span>&nbsp;<span class="builtinfunc" id="5815286">len</span><span class="op" id="5815289">(</span><span class="ident" id="5815290">x</span><span class="op" id="5815291">.</span><span class="ident" id="5815292">sa</span><span class="op" id="5815294">)</span>&nbsp;<span class="op" id="5815296">}</span><br>
<span class="lineno"></span><span class="keyword" id="5815298">func</span>&nbsp;<span class="op" id="5815303">(</span><span class="ident" id="5815304">x</span>&nbsp;<span class="op" id="5815306">*</span><span class="ident" id="5815307">suffixSortable</span><span class="op" id="5815321">)</span>&nbsp;<span class="ident" id="5815323">Less</span><span class="op" id="5815327">(</span><span class="ident" id="5815328">i</span><span class="op" id="5815329">,</span>&nbsp;<span class="ident" id="5815331">j</span>&nbsp;<span class="builtintype" id="5815333">int</span><span class="op" id="5815336">)</span>&nbsp;<span class="builtintype" id="5815338">bool</span>&nbsp;<span class="op" id="5815343">{</span>&nbsp;<span class="keyword" id="5815345">return</span>&nbsp;<span class="ident" id="5815352">x</span><span class="op" id="5815353">.</span><span class="ident" id="5815354">inv</span><span class="op" id="5815357">[</span><span class="ident" id="5815358">x</span><span class="op" id="5815359">.</span><span class="ident" id="5815360">sa</span><span class="op" id="5815362">[</span><span class="ident" id="5815363">i</span><span class="op" id="5815364">]</span><span class="op" id="5815365">+</span><span class="ident" id="5815366">x</span><span class="op" id="5815367">.</span><span class="ident" id="5815368">h</span><span class="op" id="5815369">]</span>&nbsp;<span class="op" id="5815371">&lt;</span>&nbsp;<span class="ident" id="5815373">x</span><span class="op" id="5815374">.</span><span class="ident" id="5815375">inv</span><span class="op" id="5815378">[</span><span class="ident" id="5815379">x</span><span class="op" id="5815380">.</span><span class="ident" id="5815381">sa</span><span class="op" id="5815383">[</span><span class="ident" id="5815384">j</span><span class="op" id="5815385">]</span><span class="op" id="5815386">+</span><span class="ident" id="5815387">x</span><span class="op" id="5815388">.</span><span class="ident" id="5815389">h</span><span class="op" id="5815390">]</span>&nbsp;<span class="op" id="5815392">}</span><br>
<span class="lineno"></span><span class="keyword" id="5815394">func</span>&nbsp;<span class="op" id="5815399">(</span><span class="ident" id="5815400">x</span>&nbsp;<span class="op" id="5815402">*</span><span class="ident" id="5815403">suffixSortable</span><span class="op" id="5815417">)</span>&nbsp;<span class="ident" id="5815419">Swap</span><span class="op" id="5815423">(</span><span class="ident" id="5815424">i</span><span class="op" id="5815425">,</span>&nbsp;<span class="ident" id="5815427">j</span>&nbsp;<span class="builtintype" id="5815429">int</span><span class="op" id="5815432">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5815439">{</span>&nbsp;<span class="ident" id="5815441">x</span><span class="op" id="5815442">.</span><span class="ident" id="5815443">sa</span><span class="op" id="5815445">[</span><span class="ident" id="5815446">i</span><span class="op" id="5815447">]</span><span class="op" id="5815448">,</span>&nbsp;<span class="ident" id="5815450">x</span><span class="op" id="5815451">.</span><span class="ident" id="5815452">sa</span><span class="op" id="5815454">[</span><span class="ident" id="5815455">j</span><span class="op" id="5815456">]</span>&nbsp;<span class="op" id="5815458">=</span>&nbsp;<span class="ident" id="5815460">x</span><span class="op" id="5815461">.</span><span class="ident" id="5815462">sa</span><span class="op" id="5815464">[</span><span class="ident" id="5815465">j</span><span class="op" id="5815466">]</span><span class="op" id="5815467">,</span>&nbsp;<span class="ident" id="5815469">x</span><span class="op" id="5815470">.</span><span class="ident" id="5815471">sa</span><span class="op" id="5815473">[</span><span class="ident" id="5815474">i</span><span class="op" id="5815475">]</span>&nbsp;<span class="op" id="5815477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="5815480">func</span>&nbsp;<span class="op" id="5815485">(</span><span class="ident" id="5815486">x</span>&nbsp;<span class="op" id="5815488">*</span><span class="ident" id="5815489">suffixSortable</span><span class="op" id="5815503">)</span>&nbsp;<span class="ident" id="5815505">updateGroups</span><span class="op" id="5815517">(</span><span class="ident" id="5815518">offset</span>&nbsp;<span class="builtintype" id="5815525">int</span><span class="op" id="5815528">)</span>&nbsp;<span class="op" id="5815530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815533">bounds</span>&nbsp;<span class="op" id="5815540">:=</span>&nbsp;<span class="ident" id="5815543">x</span><span class="op" id="5815544">.</span><span class="ident" id="5815545">buf</span><span class="op" id="5815548">[</span><span class="num" id="5815549">0</span><span class="op" id="5815550">:</span><span class="num" id="5815551">0</span><span class="op" id="5815552">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815555">group</span>&nbsp;<span class="op" id="5815561">:=</span>&nbsp;<span class="ident" id="5815564">x</span><span class="op" id="5815565">.</span><span class="ident" id="5815566">inv</span><span class="op" id="5815569">[</span><span class="ident" id="5815570">x</span><span class="op" id="5815571">.</span><span class="ident" id="5815572">sa</span><span class="op" id="5815574">[</span><span class="num" id="5815575">0</span><span class="op" id="5815576">]</span><span class="op" id="5815577">+</span><span class="ident" id="5815578">x</span><span class="op" id="5815579">.</span><span class="ident" id="5815580">h</span><span class="op" id="5815581">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5815584">for</span>&nbsp;<span class="ident" id="5815588">i</span>&nbsp;<span class="op" id="5815590">:=</span>&nbsp;<span class="num" id="5815593">1</span><span class="op" id="5815594">;</span>&nbsp;<span class="ident" id="5815596">i</span>&nbsp;<span class="op" id="5815598">&lt;</span>&nbsp;<span class="builtinfunc" id="5815600">len</span><span class="op" id="5815603">(</span><span class="ident" id="5815604">x</span><span class="op" id="5815605">.</span><span class="ident" id="5815606">sa</span><span class="op" id="5815608">)</span><span class="op" id="5815609">;</span>&nbsp;<span class="ident" id="5815611">i</span><span class="op" id="5815612">++</span>&nbsp;<span class="op" id="5815615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5815619">if</span>&nbsp;<span class="ident" id="5815622">g</span>&nbsp;<span class="op" id="5815624">:=</span>&nbsp;<span class="ident" id="5815627">x</span><span class="op" id="5815628">.</span><span class="ident" id="5815629">inv</span><span class="op" id="5815632">[</span><span class="ident" id="5815633">x</span><span class="op" id="5815634">.</span><span class="ident" id="5815635">sa</span><span class="op" id="5815637">[</span><span class="ident" id="5815638">i</span><span class="op" id="5815639">]</span><span class="op" id="5815640">+</span><span class="ident" id="5815641">x</span><span class="op" id="5815642">.</span><span class="ident" id="5815643">h</span><span class="op" id="5815644">]</span><span class="op" id="5815645">;</span>&nbsp;<span class="ident" id="5815647">g</span>&nbsp;<span class="op" id="5815649">&gt;</span>&nbsp;<span class="ident" id="5815651">group</span>&nbsp;<span class="op" id="5815657">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815662">bounds</span>&nbsp;<span class="op" id="5815669">=</span>&nbsp;<span class="builtinfunc" id="5815671">append</span><span class="op" id="5815677">(</span><span class="ident" id="5815678">bounds</span><span class="op" id="5815684">,</span>&nbsp;<span class="ident" id="5815686">i</span><span class="op" id="5815687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815692">group</span>&nbsp;<span class="op" id="5815698">=</span>&nbsp;<span class="ident" id="5815700">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5815704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5815707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815710">bounds</span>&nbsp;<span class="op" id="5815717">=</span>&nbsp;<span class="builtinfunc" id="5815719">append</span><span class="op" id="5815725">(</span><span class="ident" id="5815726">bounds</span><span class="op" id="5815732">,</span>&nbsp;<span class="builtinfunc" id="5815734">len</span><span class="op" id="5815737">(</span><span class="ident" id="5815738">x</span><span class="op" id="5815739">.</span><span class="ident" id="5815740">sa</span><span class="op" id="5815742">)</span><span class="op" id="5815743">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815746">x</span><span class="op" id="5815747">.</span><span class="ident" id="5815748">buf</span>&nbsp;<span class="op" id="5815752">=</span>&nbsp;<span class="ident" id="5815754">bounds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5815763">//&nbsp;update&nbsp;the&nbsp;group&nbsp;numberings&nbsp;after&nbsp;all&nbsp;new&nbsp;groups&nbsp;are&nbsp;determined</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815831">prev</span>&nbsp;<span class="op" id="5815836">:=</span>&nbsp;<span class="num" id="5815839">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5815842">for</span>&nbsp;<span class="ident" id="5815846">_</span><span class="op" id="5815847">,</span>&nbsp;<span class="ident" id="5815849">b</span>&nbsp;<span class="op" id="5815851">:=</span>&nbsp;<span class="keyword" id="5815854">range</span>&nbsp;<span class="ident" id="5815860">bounds</span>&nbsp;<span class="op" id="5815867">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5815871">for</span>&nbsp;<span class="ident" id="5815875">i</span>&nbsp;<span class="op" id="5815877">:=</span>&nbsp;<span class="ident" id="5815880">prev</span><span class="op" id="5815884">;</span>&nbsp;<span class="ident" id="5815886">i</span>&nbsp;<span class="op" id="5815888">&lt;</span>&nbsp;<span class="ident" id="5815890">b</span><span class="op" id="5815891">;</span>&nbsp;<span class="ident" id="5815893">i</span><span class="op" id="5815894">++</span>&nbsp;<span class="op" id="5815897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815902">x</span><span class="op" id="5815903">.</span><span class="ident" id="5815904">inv</span><span class="op" id="5815907">[</span><span class="ident" id="5815908">x</span><span class="op" id="5815909">.</span><span class="ident" id="5815910">sa</span><span class="op" id="5815912">[</span><span class="ident" id="5815913">i</span><span class="op" id="5815914">]</span><span class="op" id="5815915">]</span>&nbsp;<span class="op" id="5815917">=</span>&nbsp;<span class="ident" id="5815919">offset</span>&nbsp;<span class="op" id="5815926">+</span>&nbsp;<span class="ident" id="5815928">b</span>&nbsp;<span class="op" id="5815930">-</span>&nbsp;<span class="num" id="5815932">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5815936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5815940">if</span>&nbsp;<span class="ident" id="5815943">b</span><span class="op" id="5815944">-</span><span class="ident" id="5815945">prev</span>&nbsp;<span class="op" id="5815950">==</span>&nbsp;<span class="num" id="5815953">1</span>&nbsp;<span class="op" id="5815955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815960">x</span><span class="op" id="5815961">.</span><span class="ident" id="5815962">sa</span><span class="op" id="5815964">[</span><span class="ident" id="5815965">prev</span><span class="op" id="5815969">]</span>&nbsp;<span class="op" id="5815971">=</span>&nbsp;<span class="op" id="5815973">-</span><span class="num" id="5815974">1</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5815978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815982">prev</span>&nbsp;<span class="op" id="5815987">=</span>&nbsp;<span class="ident" id="5815989">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5815992">}</span><br>
<span class="lineno"></span><span class="op" id="5815994">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
