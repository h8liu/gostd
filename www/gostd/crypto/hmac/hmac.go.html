<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/hmac</h2>
<ul>
<li><a href="/gostd/crypto/hmac/hmac.go.html">hmac.go</a></li>
<li><a href="/gostd/crypto/hmac/hmac_test.go.html">hmac_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4230589">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4230644">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4230698">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4230749">/*<br>
<span class="lineno"></span>Package&nbsp;hmac&nbsp;implements&nbsp;the&nbsp;Keyed-Hash&nbsp;Message&nbsp;Authentication&nbsp;Code&nbsp;(HMAC)&nbsp;as<br>
<span class="lineno"></span>defined&nbsp;in&nbsp;U.S.&nbsp;Federal&nbsp;Information&nbsp;Processing&nbsp;Standards&nbsp;Publication&nbsp;198.<br>
<span class="lineno"></span>An&nbsp;HMAC&nbsp;is&nbsp;a&nbsp;cryptographic&nbsp;hash&nbsp;that&nbsp;uses&nbsp;a&nbsp;key&nbsp;to&nbsp;sign&nbsp;a&nbsp;message.<br>
<span class="lineno"></span>The&nbsp;receiver&nbsp;verifies&nbsp;the&nbsp;hash&nbsp;by&nbsp;recomputing&nbsp;it&nbsp;using&nbsp;the&nbsp;same&nbsp;key.<br>
<span class="lineno">10</span><br>
<span class="lineno"></span>Receivers&nbsp;should&nbsp;be&nbsp;careful&nbsp;to&nbsp;use&nbsp;Equal&nbsp;to&nbsp;compare&nbsp;MACs&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid<br>
<span class="lineno"></span>timing&nbsp;side-channels:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;CheckMAC&nbsp;returns&nbsp;true&nbsp;if&nbsp;messageMAC&nbsp;is&nbsp;a&nbsp;valid&nbsp;HMAC&nbsp;tag&nbsp;for&nbsp;message.<br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;CheckMAC(message,&nbsp;messageMAC,&nbsp;key&nbsp;[]byte)&nbsp;bool&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspmac&nbsp;:=&nbsp;hmac.New(sha256.New,&nbsp;key)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspmac.Write(message)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspexpectedMAC&nbsp;:=&nbsp;mac.Sum(nil)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;hmac.Equal(messageMAC,&nbsp;expectedMAC)<br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="4231403">package</span>&nbsp;<span class="ident" id="4231411">hmac</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4231417">import</span>&nbsp;<span class="op" id="4231424">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4231427">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4231444">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4231451">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4231454">//&nbsp;FIPS&nbsp;198:</span><br>
<span class="lineno">30</span><span class="comment" id="4231467">//&nbsp;http://csrc.nist.gov/publications/fips/fips198/fips-198a.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4231532">//&nbsp;key&nbsp;is&nbsp;zero&nbsp;padded&nbsp;to&nbsp;the&nbsp;block&nbsp;size&nbsp;of&nbsp;the&nbsp;hash&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4231593">//&nbsp;ipad&nbsp;=&nbsp;0x36&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno"></span><span class="comment" id="4231637">//&nbsp;opad&nbsp;=&nbsp;0x5c&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno">35</span><span class="comment" id="4231681">//&nbsp;hmac&nbsp;=&nbsp;H([key&nbsp;^&nbsp;opad]&nbsp;H([key&nbsp;^&nbsp;ipad]&nbsp;text))</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4231729">type</span>&nbsp;<span class="ident" id="4231734">hmac</span>&nbsp;<span class="keyword" id="4231739">struct</span>&nbsp;<span class="op" id="4231746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231749">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4231762">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231767">blocksize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4231780">int</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231785">key</span><span class="op" id="4231788">,</span>&nbsp;<span class="ident" id="4231790">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4231798">[</span><span class="op" id="4231799">]</span><span class="builtintype" id="4231800">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231806">outer</span><span class="op" id="4231811">,</span>&nbsp;<span class="ident" id="4231813">inner</span>&nbsp;<span class="ident" id="4231819">hash</span><span class="op" id="4231823">.</span><span class="ident" id="4231824">Hash</span><br>
<span class="lineno"></span><span class="op" id="4231829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4231832">func</span>&nbsp;<span class="op" id="4231837">(</span><span class="ident" id="4231838">h</span>&nbsp;<span class="op" id="4231840">*</span><span class="ident" id="4231841">hmac</span><span class="op" id="4231845">)</span>&nbsp;<span class="ident" id="4231847">tmpPad</span><span class="op" id="4231853">(</span><span class="ident" id="4231854">xor</span>&nbsp;<span class="builtintype" id="4231858">byte</span><span class="op" id="4231862">)</span>&nbsp;<span class="op" id="4231864">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231867">for</span>&nbsp;<span class="ident" id="4231871">i</span><span class="op" id="4231872">,</span>&nbsp;<span class="ident" id="4231874">k</span>&nbsp;<span class="op" id="4231876">:=</span>&nbsp;<span class="keyword" id="4231879">range</span>&nbsp;<span class="ident" id="4231885">h</span><span class="op" id="4231886">.</span><span class="ident" id="4231887">key</span>&nbsp;<span class="op" id="4231891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231895">h</span><span class="op" id="4231896">.</span><span class="ident" id="4231897">tmp</span><span class="op" id="4231900">[</span><span class="ident" id="4231901">i</span><span class="op" id="4231902">]</span>&nbsp;<span class="op" id="4231904">=</span>&nbsp;<span class="ident" id="4231906">xor</span>&nbsp;<span class="op" id="4231910">^</span>&nbsp;<span class="ident" id="4231912">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4231915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231918">for</span>&nbsp;<span class="ident" id="4231922">i</span>&nbsp;<span class="op" id="4231924">:=</span>&nbsp;<span class="builtinfunc" id="4231927">len</span><span class="op" id="4231930">(</span><span class="ident" id="4231931">h</span><span class="op" id="4231932">.</span><span class="ident" id="4231933">key</span><span class="op" id="4231936">)</span><span class="op" id="4231937">;</span>&nbsp;<span class="ident" id="4231939">i</span>&nbsp;<span class="op" id="4231941">&lt;</span>&nbsp;<span class="ident" id="4231943">h</span><span class="op" id="4231944">.</span><span class="ident" id="4231945">blocksize</span><span class="op" id="4231954">;</span>&nbsp;<span class="ident" id="4231956">i</span><span class="op" id="4231957">++</span>&nbsp;<span class="op" id="4231960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231964">h</span><span class="op" id="4231965">.</span><span class="ident" id="4231966">tmp</span><span class="op" id="4231969">[</span><span class="ident" id="4231970">i</span><span class="op" id="4231971">]</span>&nbsp;<span class="op" id="4231973">=</span>&nbsp;<span class="ident" id="4231975">xor</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4231980">}</span><br>
<span class="lineno"></span><span class="op" id="4231982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4231985">func</span>&nbsp;<span class="op" id="4231990">(</span><span class="ident" id="4231991">h</span>&nbsp;<span class="op" id="4231993">*</span><span class="ident" id="4231994">hmac</span><span class="op" id="4231998">)</span>&nbsp;<span class="ident" id="4232000">Sum</span><span class="op" id="4232003">(</span><span class="ident" id="4232004">in</span>&nbsp;<span class="op" id="4232007">[</span><span class="op" id="4232008">]</span><span class="builtintype" id="4232009">byte</span><span class="op" id="4232013">)</span>&nbsp;<span class="op" id="4232015">[</span><span class="op" id="4232016">]</span><span class="builtintype" id="4232017">byte</span>&nbsp;<span class="op" id="4232022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232025">origLen</span>&nbsp;<span class="op" id="4232033">:=</span>&nbsp;<span class="builtinfunc" id="4232036">len</span><span class="op" id="4232039">(</span><span class="ident" id="4232040">in</span><span class="op" id="4232042">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232045">in</span>&nbsp;<span class="op" id="4232048">=</span>&nbsp;<span class="ident" id="4232050">h</span><span class="op" id="4232051">.</span><span class="ident" id="4232052">inner</span><span class="op" id="4232057">.</span><span class="ident" id="4232058">Sum</span><span class="op" id="4232061">(</span><span class="ident" id="4232062">in</span><span class="op" id="4232064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232067">h</span><span class="op" id="4232068">.</span><span class="ident" id="4232069">tmpPad</span><span class="op" id="4232075">(</span><span class="num" id="4232076">0x5c</span><span class="op" id="4232080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4232083">copy</span><span class="op" id="4232087">(</span><span class="ident" id="4232088">h</span><span class="op" id="4232089">.</span><span class="ident" id="4232090">tmp</span><span class="op" id="4232093">[</span><span class="ident" id="4232094">h</span><span class="op" id="4232095">.</span><span class="ident" id="4232096">blocksize</span><span class="op" id="4232105">:</span><span class="op" id="4232106">]</span><span class="op" id="4232107">,</span>&nbsp;<span class="ident" id="4232109">in</span><span class="op" id="4232111">[</span><span class="ident" id="4232112">origLen</span><span class="op" id="4232119">:</span><span class="op" id="4232120">]</span><span class="op" id="4232121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232124">h</span><span class="op" id="4232125">.</span><span class="ident" id="4232126">outer</span><span class="op" id="4232131">.</span><span class="ident" id="4232132">Reset</span><span class="op" id="4232137">(</span><span class="op" id="4232138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232141">h</span><span class="op" id="4232142">.</span><span class="ident" id="4232143">outer</span><span class="op" id="4232148">.</span><span class="ident" id="4232149">Write</span><span class="op" id="4232154">(</span><span class="ident" id="4232155">h</span><span class="op" id="4232156">.</span><span class="ident" id="4232157">tmp</span><span class="op" id="4232160">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4232163">return</span>&nbsp;<span class="ident" id="4232170">h</span><span class="op" id="4232171">.</span><span class="ident" id="4232172">outer</span><span class="op" id="4232177">.</span><span class="ident" id="4232178">Sum</span><span class="op" id="4232181">(</span><span class="ident" id="4232182">in</span><span class="op" id="4232184">[</span><span class="op" id="4232185">:</span><span class="ident" id="4232186">origLen</span><span class="op" id="4232193">]</span><span class="op" id="4232194">)</span><br>
<span class="lineno"></span><span class="op" id="4232196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4232199">func</span>&nbsp;<span class="op" id="4232204">(</span><span class="ident" id="4232205">h</span>&nbsp;<span class="op" id="4232207">*</span><span class="ident" id="4232208">hmac</span><span class="op" id="4232212">)</span>&nbsp;<span class="ident" id="4232214">Write</span><span class="op" id="4232219">(</span><span class="ident" id="4232220">p</span>&nbsp;<span class="op" id="4232222">[</span><span class="op" id="4232223">]</span><span class="builtintype" id="4232224">byte</span><span class="op" id="4232228">)</span>&nbsp;<span class="op" id="4232230">(</span><span class="ident" id="4232231">n</span>&nbsp;<span class="builtintype" id="4232233">int</span><span class="op" id="4232236">,</span>&nbsp;<span class="ident" id="4232238">err</span>&nbsp;<span class="builtintype" id="4232242">error</span><span class="op" id="4232247">)</span>&nbsp;<span class="op" id="4232249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4232252">return</span>&nbsp;<span class="ident" id="4232259">h</span><span class="op" id="4232260">.</span><span class="ident" id="4232261">inner</span><span class="op" id="4232266">.</span><span class="ident" id="4232267">Write</span><span class="op" id="4232272">(</span><span class="ident" id="4232273">p</span><span class="op" id="4232274">)</span><br>
<span class="lineno">65</span><span class="op" id="4232276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4232279">func</span>&nbsp;<span class="op" id="4232284">(</span><span class="ident" id="4232285">h</span>&nbsp;<span class="op" id="4232287">*</span><span class="ident" id="4232288">hmac</span><span class="op" id="4232292">)</span>&nbsp;<span class="ident" id="4232294">Size</span><span class="op" id="4232298">(</span><span class="op" id="4232299">)</span>&nbsp;<span class="builtintype" id="4232301">int</span>&nbsp;<span class="op" id="4232305">{</span>&nbsp;<span class="keyword" id="4232307">return</span>&nbsp;<span class="ident" id="4232314">h</span><span class="op" id="4232315">.</span><span class="ident" id="4232316">size</span>&nbsp;<span class="op" id="4232321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4232324">func</span>&nbsp;<span class="op" id="4232329">(</span><span class="ident" id="4232330">h</span>&nbsp;<span class="op" id="4232332">*</span><span class="ident" id="4232333">hmac</span><span class="op" id="4232337">)</span>&nbsp;<span class="ident" id="4232339">BlockSize</span><span class="op" id="4232348">(</span><span class="op" id="4232349">)</span>&nbsp;<span class="builtintype" id="4232351">int</span>&nbsp;<span class="op" id="4232355">{</span>&nbsp;<span class="keyword" id="4232357">return</span>&nbsp;<span class="ident" id="4232364">h</span><span class="op" id="4232365">.</span><span class="ident" id="4232366">blocksize</span>&nbsp;<span class="op" id="4232376">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4232379">func</span>&nbsp;<span class="op" id="4232384">(</span><span class="ident" id="4232385">h</span>&nbsp;<span class="op" id="4232387">*</span><span class="ident" id="4232388">hmac</span><span class="op" id="4232392">)</span>&nbsp;<span class="ident" id="4232394">Reset</span><span class="op" id="4232399">(</span><span class="op" id="4232400">)</span>&nbsp;<span class="op" id="4232402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232405">h</span><span class="op" id="4232406">.</span><span class="ident" id="4232407">inner</span><span class="op" id="4232412">.</span><span class="ident" id="4232413">Reset</span><span class="op" id="4232418">(</span><span class="op" id="4232419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232422">h</span><span class="op" id="4232423">.</span><span class="ident" id="4232424">tmpPad</span><span class="op" id="4232430">(</span><span class="num" id="4232431">0x36</span><span class="op" id="4232435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232438">h</span><span class="op" id="4232439">.</span><span class="ident" id="4232440">inner</span><span class="op" id="4232445">.</span><span class="ident" id="4232446">Write</span><span class="op" id="4232451">(</span><span class="ident" id="4232452">h</span><span class="op" id="4232453">.</span><span class="ident" id="4232454">tmp</span><span class="op" id="4232457">[</span><span class="op" id="4232458">:</span><span class="ident" id="4232459">h</span><span class="op" id="4232460">.</span><span class="ident" id="4232461">blocksize</span><span class="op" id="4232470">]</span><span class="op" id="4232471">)</span><br>
<span class="lineno">75</span><span class="op" id="4232473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4232476">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;HMAC&nbsp;hash&nbsp;using&nbsp;the&nbsp;given&nbsp;hash.Hash&nbsp;type&nbsp;and&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4232547">func</span>&nbsp;<span class="ident" id="4232552">New</span><span class="op" id="4232555">(</span><span class="ident" id="4232556">h</span>&nbsp;<span class="keyword" id="4232558">func</span><span class="op" id="4232562">(</span><span class="op" id="4232563">)</span>&nbsp;<span class="ident" id="4232565">hash</span><span class="op" id="4232569">.</span><span class="ident" id="4232570">Hash</span><span class="op" id="4232574">,</span>&nbsp;<span class="ident" id="4232576">key</span>&nbsp;<span class="op" id="4232580">[</span><span class="op" id="4232581">]</span><span class="builtintype" id="4232582">byte</span><span class="op" id="4232586">)</span>&nbsp;<span class="ident" id="4232588">hash</span><span class="op" id="4232592">.</span><span class="ident" id="4232593">Hash</span>&nbsp;<span class="op" id="4232598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232601">hm</span>&nbsp;<span class="op" id="4232604">:=</span>&nbsp;<span class="builtinfunc" id="4232607">new</span><span class="op" id="4232610">(</span><span class="ident" id="4232611">hmac</span><span class="op" id="4232615">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232618">hm</span><span class="op" id="4232620">.</span><span class="ident" id="4232621">outer</span>&nbsp;<span class="op" id="4232627">=</span>&nbsp;<span class="ident" id="4232629">h</span><span class="op" id="4232630">(</span><span class="op" id="4232631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232634">hm</span><span class="op" id="4232636">.</span><span class="ident" id="4232637">inner</span>&nbsp;<span class="op" id="4232643">=</span>&nbsp;<span class="ident" id="4232645">h</span><span class="op" id="4232646">(</span><span class="op" id="4232647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232650">hm</span><span class="op" id="4232652">.</span><span class="ident" id="4232653">size</span>&nbsp;<span class="op" id="4232658">=</span>&nbsp;<span class="ident" id="4232660">hm</span><span class="op" id="4232662">.</span><span class="ident" id="4232663">inner</span><span class="op" id="4232668">.</span><span class="ident" id="4232669">Size</span><span class="op" id="4232673">(</span><span class="op" id="4232674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232677">hm</span><span class="op" id="4232679">.</span><span class="ident" id="4232680">blocksize</span>&nbsp;<span class="op" id="4232690">=</span>&nbsp;<span class="ident" id="4232692">hm</span><span class="op" id="4232694">.</span><span class="ident" id="4232695">inner</span><span class="op" id="4232700">.</span><span class="ident" id="4232701">BlockSize</span><span class="op" id="4232710">(</span><span class="op" id="4232711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232714">hm</span><span class="op" id="4232716">.</span><span class="ident" id="4232717">tmp</span>&nbsp;<span class="op" id="4232721">=</span>&nbsp;<span class="builtinfunc" id="4232723">make</span><span class="op" id="4232727">(</span><span class="op" id="4232728">[</span><span class="op" id="4232729">]</span><span class="builtintype" id="4232730">byte</span><span class="op" id="4232734">,</span>&nbsp;<span class="ident" id="4232736">hm</span><span class="op" id="4232738">.</span><span class="ident" id="4232739">blocksize</span><span class="op" id="4232748">+</span><span class="ident" id="4232749">hm</span><span class="op" id="4232751">.</span><span class="ident" id="4232752">size</span><span class="op" id="4232756">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4232759">if</span>&nbsp;<span class="builtinfunc" id="4232762">len</span><span class="op" id="4232765">(</span><span class="ident" id="4232766">key</span><span class="op" id="4232769">)</span>&nbsp;<span class="op" id="4232771">&gt;</span>&nbsp;<span class="ident" id="4232773">hm</span><span class="op" id="4232775">.</span><span class="ident" id="4232776">blocksize</span>&nbsp;<span class="op" id="4232786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4232790">//&nbsp;If&nbsp;key&nbsp;is&nbsp;too&nbsp;big,&nbsp;hash&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232823">hm</span><span class="op" id="4232825">.</span><span class="ident" id="4232826">outer</span><span class="op" id="4232831">.</span><span class="ident" id="4232832">Write</span><span class="op" id="4232837">(</span><span class="ident" id="4232838">key</span><span class="op" id="4232841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232845">key</span>&nbsp;<span class="op" id="4232849">=</span>&nbsp;<span class="ident" id="4232851">hm</span><span class="op" id="4232853">.</span><span class="ident" id="4232854">outer</span><span class="op" id="4232859">.</span><span class="ident" id="4232860">Sum</span><span class="op" id="4232863">(</span><span class="ident" id="4232864">nil</span><span class="op" id="4232867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4232870">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232873">hm</span><span class="op" id="4232875">.</span><span class="ident" id="4232876">key</span>&nbsp;<span class="op" id="4232880">=</span>&nbsp;<span class="builtinfunc" id="4232882">make</span><span class="op" id="4232886">(</span><span class="op" id="4232887">[</span><span class="op" id="4232888">]</span><span class="builtintype" id="4232889">byte</span><span class="op" id="4232893">,</span>&nbsp;<span class="builtinfunc" id="4232895">len</span><span class="op" id="4232898">(</span><span class="ident" id="4232899">key</span><span class="op" id="4232902">)</span><span class="op" id="4232903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4232906">copy</span><span class="op" id="4232910">(</span><span class="ident" id="4232911">hm</span><span class="op" id="4232913">.</span><span class="ident" id="4232914">key</span><span class="op" id="4232917">,</span>&nbsp;<span class="ident" id="4232919">key</span><span class="op" id="4232922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232925">hm</span><span class="op" id="4232927">.</span><span class="ident" id="4232928">Reset</span><span class="op" id="4232933">(</span><span class="op" id="4232934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4232937">return</span>&nbsp;<span class="ident" id="4232944">hm</span><br>
<span class="lineno"></span><span class="op" id="4232947">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="4232950">//&nbsp;Equal&nbsp;compares&nbsp;two&nbsp;MACs&nbsp;for&nbsp;equality&nbsp;without&nbsp;leaking&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="4233026">func</span>&nbsp;<span class="ident" id="4233031">Equal</span><span class="op" id="4233036">(</span><span class="ident" id="4233037">mac1</span><span class="op" id="4233041">,</span>&nbsp;<span class="ident" id="4233043">mac2</span>&nbsp;<span class="op" id="4233048">[</span><span class="op" id="4233049">]</span><span class="builtintype" id="4233050">byte</span><span class="op" id="4233054">)</span>&nbsp;<span class="builtintype" id="4233056">bool</span>&nbsp;<span class="op" id="4233061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4233064">//&nbsp;We&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;constant&nbsp;time&nbsp;if&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MACs&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4233133">//&nbsp;different&nbsp;as&nbsp;that&nbsp;suggests&nbsp;that&nbsp;a&nbsp;completely&nbsp;different&nbsp;hash&nbsp;function</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4233206">//&nbsp;was&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233220">return</span>&nbsp;<span class="builtinfunc" id="4233227">len</span><span class="op" id="4233230">(</span><span class="ident" id="4233231">mac1</span><span class="op" id="4233235">)</span>&nbsp;<span class="op" id="4233237">==</span>&nbsp;<span class="builtinfunc" id="4233240">len</span><span class="op" id="4233243">(</span><span class="ident" id="4233244">mac2</span><span class="op" id="4233248">)</span>&nbsp;<span class="op" id="4233250">&amp;&amp;</span>&nbsp;<span class="ident" id="4233253">subtle</span><span class="op" id="4233259">.</span><span class="ident" id="4233260">ConstantTimeCompare</span><span class="op" id="4233279">(</span><span class="ident" id="4233280">mac1</span><span class="op" id="4233284">,</span>&nbsp;<span class="ident" id="4233286">mac2</span><span class="op" id="4233290">)</span>&nbsp;<span class="op" id="4233292">==</span>&nbsp;<span class="num" id="4233295">1</span><br>
<span class="lineno"></span><span class="op" id="4233297">}</span>
</div>
</body>
</html>
