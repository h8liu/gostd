<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io/ioutil</h2>
<ul>
<li><a href="/gostd/io/ioutil/ioutil.go.html">ioutil.go</a></li>
<li><a href="/gostd/io/ioutil/ioutil_test.go.html">ioutil_test.go</a></li>
<li><a href="/gostd/io/ioutil/tempfile.go.html">tempfile.go</a></li>
<li><a href="/gostd/io/ioutil/tempfile_test.go.html" class="current">tempfile_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7344255">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7344310">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7344364">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7344415">package</span>&nbsp;<span class="ident" id="7344423">ioutil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7344431">import</span>&nbsp;<span class="op" id="7344438">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7344441">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7344447">&#34;path/filepath&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7344464">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7344474">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7344484">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7344487">func</span>&nbsp;<span class="ident" id="7344492">TestTempFile</span><span class="op" id="7344504">(</span><span class="ident" id="7344505">t</span>&nbsp;<span class="op" id="7344507">*</span><span class="ident" id="7344508">testing</span><span class="op" id="7344515">.</span><span class="ident" id="7344516">T</span><span class="op" id="7344517">)</span>&nbsp;<span class="op" id="7344519">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7344522">f</span><span class="op" id="7344523">,</span>&nbsp;<span class="ident" id="7344525">err</span>&nbsp;<span class="op" id="7344529">:=</span>&nbsp;<span class="ident" id="7344532">TempFile</span><span class="op" id="7344540">(</span><span class="string" id="7344541">&#34;/_not_exists_&#34;</span><span class="op" id="7344556">,</span>&nbsp;<span class="string" id="7344558">&#34;foo&#34;</span><span class="op" id="7344563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7344566">if</span>&nbsp;<span class="ident" id="7344569">f</span>&nbsp;<span class="op" id="7344571">!=</span>&nbsp;<span class="ident" id="7344574">nil</span>&nbsp;<span class="op" id="7344578">||</span>&nbsp;<span class="ident" id="7344581">err</span>&nbsp;<span class="op" id="7344585">==</span>&nbsp;<span class="ident" id="7344588">nil</span>&nbsp;<span class="op" id="7344592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7344596">t</span><span class="op" id="7344597">.</span><span class="ident" id="7344598">Errorf</span><span class="op" id="7344604">(</span><span class="string" id="7344605">&#34;TempFile(`/_not_exists_`,&nbsp;`foo`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7344648">,</span>&nbsp;<span class="ident" id="7344650">f</span><span class="op" id="7344651">,</span>&nbsp;<span class="ident" id="7344653">err</span><span class="op" id="7344656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7344659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7344663">dir</span>&nbsp;<span class="op" id="7344667">:=</span>&nbsp;<span class="ident" id="7344670">os</span><span class="op" id="7344672">.</span><span class="ident" id="7344673">TempDir</span><span class="op" id="7344680">(</span><span class="op" id="7344681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7344684">f</span><span class="op" id="7344685">,</span>&nbsp;<span class="ident" id="7344687">err</span>&nbsp;<span class="op" id="7344691">=</span>&nbsp;<span class="ident" id="7344693">TempFile</span><span class="op" id="7344701">(</span><span class="ident" id="7344702">dir</span><span class="op" id="7344705">,</span>&nbsp;<span class="string" id="7344707">&#34;ioutil_test&#34;</span><span class="op" id="7344720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7344723">if</span>&nbsp;<span class="ident" id="7344726">f</span>&nbsp;<span class="op" id="7344728">==</span>&nbsp;<span class="ident" id="7344731">nil</span>&nbsp;<span class="op" id="7344735">||</span>&nbsp;<span class="ident" id="7344738">err</span>&nbsp;<span class="op" id="7344742">!=</span>&nbsp;<span class="ident" id="7344745">nil</span>&nbsp;<span class="op" id="7344749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7344753">t</span><span class="op" id="7344754">.</span><span class="ident" id="7344755">Errorf</span><span class="op" id="7344761">(</span><span class="string" id="7344762">&#34;TempFile(dir,&nbsp;`ioutil_test`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7344801">,</span>&nbsp;<span class="ident" id="7344803">f</span><span class="op" id="7344804">,</span>&nbsp;<span class="ident" id="7344806">err</span><span class="op" id="7344809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7344812">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7344815">if</span>&nbsp;<span class="ident" id="7344818">f</span>&nbsp;<span class="op" id="7344820">!=</span>&nbsp;<span class="ident" id="7344823">nil</span>&nbsp;<span class="op" id="7344827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7344831">f</span><span class="op" id="7344832">.</span><span class="ident" id="7344833">Close</span><span class="op" id="7344838">(</span><span class="op" id="7344839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7344843">os</span><span class="op" id="7344845">.</span><span class="ident" id="7344846">Remove</span><span class="op" id="7344852">(</span><span class="ident" id="7344853">f</span><span class="op" id="7344854">.</span><span class="ident" id="7344855">Name</span><span class="op" id="7344859">(</span><span class="op" id="7344860">)</span><span class="op" id="7344861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7344865">re</span>&nbsp;<span class="op" id="7344868">:=</span>&nbsp;<span class="ident" id="7344871">regexp</span><span class="op" id="7344877">.</span><span class="ident" id="7344878">MustCompile</span><span class="op" id="7344889">(</span><span class="string" id="7344890">&#34;^&#34;</span>&nbsp;<span class="op" id="7344894">+</span>&nbsp;<span class="ident" id="7344896">regexp</span><span class="op" id="7344902">.</span><span class="ident" id="7344903">QuoteMeta</span><span class="op" id="7344912">(</span><span class="ident" id="7344913">filepath</span><span class="op" id="7344921">.</span><span class="ident" id="7344922">Join</span><span class="op" id="7344926">(</span><span class="ident" id="7344927">dir</span><span class="op" id="7344930">,</span>&nbsp;<span class="string" id="7344932">&#34;ioutil_test&#34;</span><span class="op" id="7344945">)</span><span class="op" id="7344946">)</span>&nbsp;<span class="op" id="7344948">+</span>&nbsp;<span class="string" id="7344950">&#34;[0-9]+$&#34;</span><span class="op" id="7344959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7344963">if</span>&nbsp;<span class="op" id="7344966">!</span><span class="ident" id="7344967">re</span><span class="op" id="7344969">.</span><span class="ident" id="7344970">MatchString</span><span class="op" id="7344981">(</span><span class="ident" id="7344982">f</span><span class="op" id="7344983">.</span><span class="ident" id="7344984">Name</span><span class="op" id="7344988">(</span><span class="op" id="7344989">)</span><span class="op" id="7344990">)</span>&nbsp;<span class="op" id="7344992">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7344997">t</span><span class="op" id="7344998">.</span><span class="ident" id="7344999">Errorf</span><span class="op" id="7345005">(</span><span class="string" id="7345006">&#34;TempFile(`&#34;</span><span class="op" id="7345018">+</span><span class="ident" id="7345019">dir</span><span class="op" id="7345022">+</span><span class="string" id="7345023">&#34;`,&nbsp;`ioutil_test`)&nbsp;created&nbsp;bad&nbsp;name&nbsp;%s&#34;</span><span class="op" id="7345062">,</span>&nbsp;<span class="ident" id="7345064">f</span><span class="op" id="7345065">.</span><span class="ident" id="7345066">Name</span><span class="op" id="7345070">(</span><span class="op" id="7345071">)</span><span class="op" id="7345072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7345076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7345079">}</span><br>
<span class="lineno"></span><span class="op" id="7345081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="7345084">func</span>&nbsp;<span class="ident" id="7345089">TestTempDir</span><span class="op" id="7345100">(</span><span class="ident" id="7345101">t</span>&nbsp;<span class="op" id="7345103">*</span><span class="ident" id="7345104">testing</span><span class="op" id="7345111">.</span><span class="ident" id="7345112">T</span><span class="op" id="7345113">)</span>&nbsp;<span class="op" id="7345115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345118">name</span><span class="op" id="7345122">,</span>&nbsp;<span class="ident" id="7345124">err</span>&nbsp;<span class="op" id="7345128">:=</span>&nbsp;<span class="ident" id="7345131">TempDir</span><span class="op" id="7345138">(</span><span class="string" id="7345139">&#34;/_not_exists_&#34;</span><span class="op" id="7345154">,</span>&nbsp;<span class="string" id="7345156">&#34;foo&#34;</span><span class="op" id="7345161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7345164">if</span>&nbsp;<span class="ident" id="7345167">name</span>&nbsp;<span class="op" id="7345172">!=</span>&nbsp;<span class="string" id="7345175">&#34;&#34;</span>&nbsp;<span class="op" id="7345178">||</span>&nbsp;<span class="ident" id="7345181">err</span>&nbsp;<span class="op" id="7345185">==</span>&nbsp;<span class="ident" id="7345188">nil</span>&nbsp;<span class="op" id="7345192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345196">t</span><span class="op" id="7345197">.</span><span class="ident" id="7345198">Errorf</span><span class="op" id="7345204">(</span><span class="string" id="7345205">&#34;TempDir(`/_not_exists_`,&nbsp;`foo`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7345247">,</span>&nbsp;<span class="ident" id="7345249">name</span><span class="op" id="7345253">,</span>&nbsp;<span class="ident" id="7345255">err</span><span class="op" id="7345258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7345261">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345265">dir</span>&nbsp;<span class="op" id="7345269">:=</span>&nbsp;<span class="ident" id="7345272">os</span><span class="op" id="7345274">.</span><span class="ident" id="7345275">TempDir</span><span class="op" id="7345282">(</span><span class="op" id="7345283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345286">name</span><span class="op" id="7345290">,</span>&nbsp;<span class="ident" id="7345292">err</span>&nbsp;<span class="op" id="7345296">=</span>&nbsp;<span class="ident" id="7345298">TempDir</span><span class="op" id="7345305">(</span><span class="ident" id="7345306">dir</span><span class="op" id="7345309">,</span>&nbsp;<span class="string" id="7345311">&#34;ioutil_test&#34;</span><span class="op" id="7345324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7345327">if</span>&nbsp;<span class="ident" id="7345330">name</span>&nbsp;<span class="op" id="7345335">==</span>&nbsp;<span class="string" id="7345338">&#34;&#34;</span>&nbsp;<span class="op" id="7345341">||</span>&nbsp;<span class="ident" id="7345344">err</span>&nbsp;<span class="op" id="7345348">!=</span>&nbsp;<span class="ident" id="7345351">nil</span>&nbsp;<span class="op" id="7345355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345359">t</span><span class="op" id="7345360">.</span><span class="ident" id="7345361">Errorf</span><span class="op" id="7345367">(</span><span class="string" id="7345368">&#34;TempDir(dir,&nbsp;`ioutil_test`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7345406">,</span>&nbsp;<span class="ident" id="7345408">name</span><span class="op" id="7345412">,</span>&nbsp;<span class="ident" id="7345414">err</span><span class="op" id="7345417">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7345420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7345423">if</span>&nbsp;<span class="ident" id="7345426">name</span>&nbsp;<span class="op" id="7345431">!=</span>&nbsp;<span class="string" id="7345434">&#34;&#34;</span>&nbsp;<span class="op" id="7345437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345441">os</span><span class="op" id="7345443">.</span><span class="ident" id="7345444">Remove</span><span class="op" id="7345450">(</span><span class="ident" id="7345451">name</span><span class="op" id="7345455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345459">re</span>&nbsp;<span class="op" id="7345462">:=</span>&nbsp;<span class="ident" id="7345465">regexp</span><span class="op" id="7345471">.</span><span class="ident" id="7345472">MustCompile</span><span class="op" id="7345483">(</span><span class="string" id="7345484">&#34;^&#34;</span>&nbsp;<span class="op" id="7345488">+</span>&nbsp;<span class="ident" id="7345490">regexp</span><span class="op" id="7345496">.</span><span class="ident" id="7345497">QuoteMeta</span><span class="op" id="7345506">(</span><span class="ident" id="7345507">filepath</span><span class="op" id="7345515">.</span><span class="ident" id="7345516">Join</span><span class="op" id="7345520">(</span><span class="ident" id="7345521">dir</span><span class="op" id="7345524">,</span>&nbsp;<span class="string" id="7345526">&#34;ioutil_test&#34;</span><span class="op" id="7345539">)</span><span class="op" id="7345540">)</span>&nbsp;<span class="op" id="7345542">+</span>&nbsp;<span class="string" id="7345544">&#34;[0-9]+$&#34;</span><span class="op" id="7345553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7345557">if</span>&nbsp;<span class="op" id="7345560">!</span><span class="ident" id="7345561">re</span><span class="op" id="7345563">.</span><span class="ident" id="7345564">MatchString</span><span class="op" id="7345575">(</span><span class="ident" id="7345576">name</span><span class="op" id="7345580">)</span>&nbsp;<span class="op" id="7345582">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345587">t</span><span class="op" id="7345588">.</span><span class="ident" id="7345589">Errorf</span><span class="op" id="7345595">(</span><span class="string" id="7345596">&#34;TempDir(`&#34;</span><span class="op" id="7345607">+</span><span class="ident" id="7345608">dir</span><span class="op" id="7345611">+</span><span class="string" id="7345612">&#34;`,&nbsp;`ioutil_test`)&nbsp;created&nbsp;bad&nbsp;name&nbsp;%s&#34;</span><span class="op" id="7345651">,</span>&nbsp;<span class="ident" id="7345653">name</span><span class="op" id="7345657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7345661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7345664">}</span><br>
<span class="lineno"></span><span class="op" id="7345666">}</span>
</div>
</body>
</html>
