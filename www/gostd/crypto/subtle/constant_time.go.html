<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html" class="current">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2962411">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2962466">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2962520">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2962571">//&nbsp;Package&nbsp;subtle&nbsp;implements&nbsp;functions&nbsp;that&nbsp;are&nbsp;often&nbsp;useful&nbsp;in&nbsp;cryptographic</span><br>
<span class="lineno"></span><span class="comment" id="2962649">//&nbsp;code&nbsp;but&nbsp;require&nbsp;careful&nbsp;thought&nbsp;to&nbsp;use&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="keyword" id="2962703">package</span>&nbsp;<span class="ident" id="2962711">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2962719">//&nbsp;ConstantTimeCompare&nbsp;returns&nbsp;1&nbsp;iff&nbsp;the&nbsp;two&nbsp;slices,&nbsp;x</span><br>
<span class="lineno">10</span><span class="comment" id="2962774">//&nbsp;and&nbsp;y,&nbsp;have&nbsp;equal&nbsp;contents.&nbsp;The&nbsp;time&nbsp;taken&nbsp;is&nbsp;a&nbsp;function&nbsp;of&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2962851">//&nbsp;the&nbsp;slices&nbsp;and&nbsp;is&nbsp;independent&nbsp;of&nbsp;the&nbsp;contents.</span><br>
<span class="lineno"></span><span class="keyword" id="2962901">func</span>&nbsp;<span class="ident" id="2962906">ConstantTimeCompare</span><span class="op" id="2962925">(</span><span class="ident" id="2962926">x</span><span class="op" id="2962927">,</span>&nbsp;<span class="ident" id="2962929">y</span>&nbsp;<span class="op" id="2962931">[</span><span class="op" id="2962932">]</span><span class="builtintype" id="2962933">byte</span><span class="op" id="2962937">)</span>&nbsp;<span class="builtintype" id="2962939">int</span>&nbsp;<span class="op" id="2962943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2962946">if</span>&nbsp;<span class="builtinfunc" id="2962949">len</span><span class="op" id="2962952">(</span><span class="ident" id="2962953">x</span><span class="op" id="2962954">)</span>&nbsp;<span class="op" id="2962956">!=</span>&nbsp;<span class="builtinfunc" id="2962959">len</span><span class="op" id="2962962">(</span><span class="ident" id="2962963">y</span><span class="op" id="2962964">)</span>&nbsp;<span class="op" id="2962966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2962970">return</span>&nbsp;<span class="num" id="2962977">0</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2962980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2962984">var</span>&nbsp;<span class="ident" id="2962988">v</span>&nbsp;<span class="builtintype" id="2962990">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2962997">for</span>&nbsp;<span class="ident" id="2963001">i</span>&nbsp;<span class="op" id="2963003">:=</span>&nbsp;<span class="num" id="2963006">0</span><span class="op" id="2963007">;</span>&nbsp;<span class="ident" id="2963009">i</span>&nbsp;<span class="op" id="2963011">&lt;</span>&nbsp;<span class="builtinfunc" id="2963013">len</span><span class="op" id="2963016">(</span><span class="ident" id="2963017">x</span><span class="op" id="2963018">)</span><span class="op" id="2963019">;</span>&nbsp;<span class="ident" id="2963021">i</span><span class="op" id="2963022">++</span>&nbsp;<span class="op" id="2963025">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2963029">v</span>&nbsp;<span class="op" id="2963031">|=</span>&nbsp;<span class="ident" id="2963034">x</span><span class="op" id="2963035">[</span><span class="ident" id="2963036">i</span><span class="op" id="2963037">]</span>&nbsp;<span class="op" id="2963039">^</span>&nbsp;<span class="ident" id="2963041">y</span><span class="op" id="2963042">[</span><span class="ident" id="2963043">i</span><span class="op" id="2963044">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2963047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2963051">return</span>&nbsp;<span class="ident" id="2963058">ConstantTimeByteEq</span><span class="op" id="2963076">(</span><span class="ident" id="2963077">v</span><span class="op" id="2963078">,</span>&nbsp;<span class="num" id="2963080">0</span><span class="op" id="2963081">)</span><br>
<span class="lineno"></span><span class="op" id="2963083">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="2963086">//&nbsp;ConstantTimeSelect&nbsp;returns&nbsp;x&nbsp;if&nbsp;v&nbsp;is&nbsp;1&nbsp;and&nbsp;y&nbsp;if&nbsp;v&nbsp;is&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="2963145">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="2963202">func</span>&nbsp;<span class="ident" id="2963207">ConstantTimeSelect</span><span class="op" id="2963225">(</span><span class="ident" id="2963226">v</span><span class="op" id="2963227">,</span>&nbsp;<span class="ident" id="2963229">x</span><span class="op" id="2963230">,</span>&nbsp;<span class="ident" id="2963232">y</span>&nbsp;<span class="builtintype" id="2963234">int</span><span class="op" id="2963237">)</span>&nbsp;<span class="builtintype" id="2963239">int</span>&nbsp;<span class="op" id="2963243">{</span>&nbsp;<span class="keyword" id="2963245">return</span>&nbsp;<span class="op" id="2963252">^</span><span class="op" id="2963253">(</span><span class="ident" id="2963254">v</span><span class="op" id="2963255">-</span><span class="num" id="2963256">1</span><span class="op" id="2963257">)</span><span class="op" id="2963258">&amp;</span><span class="ident" id="2963259">x</span>&nbsp;<span class="op" id="2963261">|</span>&nbsp;<span class="op" id="2963263">(</span><span class="ident" id="2963264">v</span><span class="op" id="2963265">-</span><span class="num" id="2963266">1</span><span class="op" id="2963267">)</span><span class="op" id="2963268">&amp;</span><span class="ident" id="2963269">y</span>&nbsp;<span class="op" id="2963271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2963274">//&nbsp;ConstantTimeByteEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="2963333">func</span>&nbsp;<span class="ident" id="2963338">ConstantTimeByteEq</span><span class="op" id="2963356">(</span><span class="ident" id="2963357">x</span><span class="op" id="2963358">,</span>&nbsp;<span class="ident" id="2963360">y</span>&nbsp;<span class="builtintype" id="2963362">uint8</span><span class="op" id="2963367">)</span>&nbsp;<span class="builtintype" id="2963369">int</span>&nbsp;<span class="op" id="2963373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2963376">z</span>&nbsp;<span class="op" id="2963378">:=</span>&nbsp;<span class="op" id="2963381">^</span><span class="op" id="2963382">(</span><span class="ident" id="2963383">x</span>&nbsp;<span class="op" id="2963385">^</span>&nbsp;<span class="ident" id="2963387">y</span><span class="op" id="2963388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2963391">z</span>&nbsp;<span class="op" id="2963393">&amp;=</span>&nbsp;<span class="ident" id="2963396">z</span>&nbsp;<span class="op" id="2963398">&gt;&gt;</span>&nbsp;<span class="num" id="2963401">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2963404">z</span>&nbsp;<span class="op" id="2963406">&amp;=</span>&nbsp;<span class="ident" id="2963409">z</span>&nbsp;<span class="op" id="2963411">&gt;&gt;</span>&nbsp;<span class="num" id="2963414">2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2963417">z</span>&nbsp;<span class="op" id="2963419">&amp;=</span>&nbsp;<span class="ident" id="2963422">z</span>&nbsp;<span class="op" id="2963424">&gt;&gt;</span>&nbsp;<span class="num" id="2963427">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2963431">return</span>&nbsp;<span class="builtintype" id="2963438">int</span><span class="op" id="2963441">(</span><span class="ident" id="2963442">z</span><span class="op" id="2963443">)</span><br>
<span class="lineno"></span><span class="op" id="2963445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2963448">//&nbsp;ConstantTimeEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="2963503">func</span>&nbsp;<span class="ident" id="2963508">ConstantTimeEq</span><span class="op" id="2963522">(</span><span class="ident" id="2963523">x</span><span class="op" id="2963524">,</span>&nbsp;<span class="ident" id="2963526">y</span>&nbsp;<span class="builtintype" id="2963528">int32</span><span class="op" id="2963533">)</span>&nbsp;<span class="builtintype" id="2963535">int</span>&nbsp;<span class="op" id="2963539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2963542">z</span>&nbsp;<span class="op" id="2963544">:=</span>&nbsp;<span class="op" id="2963547">^</span><span class="op" id="2963548">(</span><span class="ident" id="2963549">x</span>&nbsp;<span class="op" id="2963551">^</span>&nbsp;<span class="ident" id="2963553">y</span><span class="op" id="2963554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2963557">z</span>&nbsp;<span class="op" id="2963559">&amp;=</span>&nbsp;<span class="ident" id="2963562">z</span>&nbsp;<span class="op" id="2963564">&gt;&gt;</span>&nbsp;<span class="num" id="2963567">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2963571">z</span>&nbsp;<span class="op" id="2963573">&amp;=</span>&nbsp;<span class="ident" id="2963576">z</span>&nbsp;<span class="op" id="2963578">&gt;&gt;</span>&nbsp;<span class="num" id="2963581">8</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2963584">z</span>&nbsp;<span class="op" id="2963586">&amp;=</span>&nbsp;<span class="ident" id="2963589">z</span>&nbsp;<span class="op" id="2963591">&gt;&gt;</span>&nbsp;<span class="num" id="2963594">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2963597">z</span>&nbsp;<span class="op" id="2963599">&amp;=</span>&nbsp;<span class="ident" id="2963602">z</span>&nbsp;<span class="op" id="2963604">&gt;&gt;</span>&nbsp;<span class="num" id="2963607">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2963610">z</span>&nbsp;<span class="op" id="2963612">&amp;=</span>&nbsp;<span class="ident" id="2963615">z</span>&nbsp;<span class="op" id="2963617">&gt;&gt;</span>&nbsp;<span class="num" id="2963620">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2963624">return</span>&nbsp;<span class="builtintype" id="2963631">int</span><span class="op" id="2963634">(</span><span class="ident" id="2963635">z</span>&nbsp;<span class="op" id="2963637">&amp;</span>&nbsp;<span class="num" id="2963639">1</span><span class="op" id="2963640">)</span><br>
<span class="lineno">50</span><span class="op" id="2963642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2963645">//&nbsp;ConstantTimeCopy&nbsp;copies&nbsp;the&nbsp;contents&nbsp;of&nbsp;y&nbsp;into&nbsp;x&nbsp;(a&nbsp;slice&nbsp;of&nbsp;equal&nbsp;length)</span><br>
<span class="lineno"></span><span class="comment" id="2963723">//&nbsp;if&nbsp;v&nbsp;==&nbsp;1.&nbsp;If&nbsp;v&nbsp;==&nbsp;0,&nbsp;x&nbsp;is&nbsp;left&nbsp;unchanged.&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v</span><br>
<span class="lineno"></span><span class="comment" id="2963800">//&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno">55</span><span class="keyword" id="2963826">func</span>&nbsp;<span class="ident" id="2963831">ConstantTimeCopy</span><span class="op" id="2963847">(</span><span class="ident" id="2963848">v</span>&nbsp;<span class="builtintype" id="2963850">int</span><span class="op" id="2963853">,</span>&nbsp;<span class="ident" id="2963855">x</span><span class="op" id="2963856">,</span>&nbsp;<span class="ident" id="2963858">y</span>&nbsp;<span class="op" id="2963860">[</span><span class="op" id="2963861">]</span><span class="builtintype" id="2963862">byte</span><span class="op" id="2963866">)</span>&nbsp;<span class="op" id="2963868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2963871">if</span>&nbsp;<span class="builtinfunc" id="2963874">len</span><span class="op" id="2963877">(</span><span class="ident" id="2963878">x</span><span class="op" id="2963879">)</span>&nbsp;<span class="op" id="2963881">!=</span>&nbsp;<span class="builtinfunc" id="2963884">len</span><span class="op" id="2963887">(</span><span class="ident" id="2963888">y</span><span class="op" id="2963889">)</span>&nbsp;<span class="op" id="2963891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2963895">panic</span><span class="op" id="2963900">(</span><span class="string" id="2963901">&#34;subtle:&nbsp;slices&nbsp;have&nbsp;different&nbsp;lengths&#34;</span><span class="op" id="2963940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2963943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2963947">xmask</span>&nbsp;<span class="op" id="2963953">:=</span>&nbsp;<span class="builtintype" id="2963956">byte</span><span class="op" id="2963960">(</span><span class="ident" id="2963961">v</span>&nbsp;<span class="op" id="2963963">-</span>&nbsp;<span class="num" id="2963965">1</span><span class="op" id="2963966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2963969">ymask</span>&nbsp;<span class="op" id="2963975">:=</span>&nbsp;<span class="builtintype" id="2963978">byte</span><span class="op" id="2963982">(</span><span class="op" id="2963983">^</span><span class="op" id="2963984">(</span><span class="ident" id="2963985">v</span>&nbsp;<span class="op" id="2963987">-</span>&nbsp;<span class="num" id="2963989">1</span><span class="op" id="2963990">)</span><span class="op" id="2963991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2963994">for</span>&nbsp;<span class="ident" id="2963998">i</span>&nbsp;<span class="op" id="2964000">:=</span>&nbsp;<span class="num" id="2964003">0</span><span class="op" id="2964004">;</span>&nbsp;<span class="ident" id="2964006">i</span>&nbsp;<span class="op" id="2964008">&lt;</span>&nbsp;<span class="builtinfunc" id="2964010">len</span><span class="op" id="2964013">(</span><span class="ident" id="2964014">x</span><span class="op" id="2964015">)</span><span class="op" id="2964016">;</span>&nbsp;<span class="ident" id="2964018">i</span><span class="op" id="2964019">++</span>&nbsp;<span class="op" id="2964022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2964026">x</span><span class="op" id="2964027">[</span><span class="ident" id="2964028">i</span><span class="op" id="2964029">]</span>&nbsp;<span class="op" id="2964031">=</span>&nbsp;<span class="ident" id="2964033">x</span><span class="op" id="2964034">[</span><span class="ident" id="2964035">i</span><span class="op" id="2964036">]</span><span class="op" id="2964037">&amp;</span><span class="ident" id="2964038">xmask</span>&nbsp;<span class="op" id="2964044">|</span>&nbsp;<span class="ident" id="2964046">y</span><span class="op" id="2964047">[</span><span class="ident" id="2964048">i</span><span class="op" id="2964049">]</span><span class="op" id="2964050">&amp;</span><span class="ident" id="2964051">ymask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2964058">}</span><br>
<span class="lineno">65</span><span class="op" id="2964060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2964063">//&nbsp;ConstantTimeLessOrEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;&lt;=&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="2964124">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;x&nbsp;or&nbsp;y&nbsp;are&nbsp;negative&nbsp;or&nbsp;&gt;&nbsp;2**31&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="2964192">func</span>&nbsp;<span class="ident" id="2964197">ConstantTimeLessOrEq</span><span class="op" id="2964217">(</span><span class="ident" id="2964218">x</span><span class="op" id="2964219">,</span>&nbsp;<span class="ident" id="2964221">y</span>&nbsp;<span class="builtintype" id="2964223">int</span><span class="op" id="2964226">)</span>&nbsp;<span class="builtintype" id="2964228">int</span>&nbsp;<span class="op" id="2964232">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2964235">x32</span>&nbsp;<span class="op" id="2964239">:=</span>&nbsp;<span class="builtintype" id="2964242">int32</span><span class="op" id="2964247">(</span><span class="ident" id="2964248">x</span><span class="op" id="2964249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2964252">y32</span>&nbsp;<span class="op" id="2964256">:=</span>&nbsp;<span class="builtintype" id="2964259">int32</span><span class="op" id="2964264">(</span><span class="ident" id="2964265">y</span><span class="op" id="2964266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2964269">return</span>&nbsp;<span class="builtintype" id="2964276">int</span><span class="op" id="2964279">(</span><span class="op" id="2964280">(</span><span class="op" id="2964281">(</span><span class="ident" id="2964282">x32</span>&nbsp;<span class="op" id="2964286">-</span>&nbsp;<span class="ident" id="2964288">y32</span>&nbsp;<span class="op" id="2964292">-</span>&nbsp;<span class="num" id="2964294">1</span><span class="op" id="2964295">)</span>&nbsp;<span class="op" id="2964297">&gt;&gt;</span>&nbsp;<span class="num" id="2964300">31</span><span class="op" id="2964302">)</span>&nbsp;<span class="op" id="2964304">&amp;</span>&nbsp;<span class="num" id="2964306">1</span><span class="op" id="2964307">)</span><br>
<span class="lineno"></span><span class="op" id="2964309">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
