<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bytes</h2>
<ul>
<li><a href="/gostd/bytes/buffer.go.html" class="current">buffer.go</a></li>
<li><a href="/gostd/bytes/buffer_test.go.html">buffer_test.go</a></li>
<li><a href="/gostd/bytes/bytes.go.html">bytes.go</a></li>
<li><a href="/gostd/bytes/bytes_decl.go.html">bytes_decl.go</a></li>
<li><a href="/gostd/bytes/bytes_test.go.html">bytes_test.go</a></li>
<li><a href="/gostd/bytes/compare_test.go.html">compare_test.go</a></li>
<li><a href="/gostd/bytes/equal_test.go.html">equal_test.go</a></li>
<li><a href="/gostd/bytes/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bytes/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bytes/reader.go.html">reader.go</a></li>
<li><a href="/gostd/bytes/reader_test.go.html">reader_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1329532">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1329587">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1329641">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1329692">package</span>&nbsp;<span class="ident" id="1329700">bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1329707">//&nbsp;Simple&nbsp;byte&nbsp;buffer&nbsp;for&nbsp;marshaling&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1329751">import</span>&nbsp;<span class="op" id="1329758">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1329761">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1329771">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1329777">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="1329792">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1329795">//&nbsp;A&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;variable-sized&nbsp;buffer&nbsp;of&nbsp;bytes&nbsp;with&nbsp;Read&nbsp;and&nbsp;Write&nbsp;methods.</span><br>
<span class="lineno"></span><span class="comment" id="1329872">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Buffer&nbsp;is&nbsp;an&nbsp;empty&nbsp;buffer&nbsp;ready&nbsp;to&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="1329934">type</span>&nbsp;<span class="ident" id="1329939">Buffer</span>&nbsp;<span class="keyword" id="1329946">struct</span>&nbsp;<span class="op" id="1329953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1329956">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1329966">[</span><span class="op" id="1329967">]</span><span class="builtintype" id="1329968">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1329984">//&nbsp;contents&nbsp;are&nbsp;the&nbsp;bytes&nbsp;buf[off&nbsp;:&nbsp;len(buf)]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1330031">off</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1330041">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330059">//&nbsp;read&nbsp;at&nbsp;&amp;buf[off],&nbsp;write&nbsp;at&nbsp;&amp;buf[len(buf)]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1330106">runeBytes</span>&nbsp;<span class="op" id="1330116">[</span><span class="ident" id="1330117">utf8</span><span class="op" id="1330121">.</span><span class="ident" id="1330122">UTFMax</span><span class="op" id="1330128">]</span><span class="builtintype" id="1330129">byte</span>&nbsp;<span class="comment" id="1330134">//&nbsp;avoid&nbsp;allocation&nbsp;of&nbsp;slice&nbsp;on&nbsp;each&nbsp;WriteByte&nbsp;or&nbsp;Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1330190">bootstrap</span>&nbsp;<span class="op" id="1330200">[</span><span class="num" id="1330201">64</span><span class="op" id="1330203">]</span><span class="builtintype" id="1330204">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330218">//&nbsp;memory&nbsp;to&nbsp;hold&nbsp;first&nbsp;slice;&nbsp;helps&nbsp;small&nbsp;buffers&nbsp;(Printf)&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1330297">lastRead</span>&nbsp;&nbsp;<span class="ident" id="1330307">readOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330325">//&nbsp;last&nbsp;read&nbsp;operation,&nbsp;so&nbsp;that&nbsp;Unread*&nbsp;can&nbsp;work&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="op" id="1330385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1330388">//&nbsp;The&nbsp;readOp&nbsp;constants&nbsp;describe&nbsp;the&nbsp;last&nbsp;action&nbsp;performed&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="1330450">//&nbsp;the&nbsp;buffer,&nbsp;so&nbsp;that&nbsp;UnreadRune&nbsp;and&nbsp;UnreadByte&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="1330503">//&nbsp;check&nbsp;for&nbsp;invalid&nbsp;usage.</span><br>
<span class="lineno"></span><span class="keyword" id="1330531">type</span>&nbsp;<span class="ident" id="1330536">readOp</span>&nbsp;<span class="builtintype" id="1330543">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="1330548">const</span>&nbsp;<span class="op" id="1330554">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1330557">opInvalid</span>&nbsp;&nbsp;<span class="ident" id="1330568">readOp</span>&nbsp;<span class="op" id="1330575">=</span>&nbsp;<span class="ident" id="1330577">iota</span>&nbsp;<span class="comment" id="1330582">//&nbsp;Non-read&nbsp;operation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1330606">opReadRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330631">//&nbsp;Read&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1330646">opRead</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330671">//&nbsp;Any&nbsp;other&nbsp;read&nbsp;operation.</span><br>
<span class="lineno"></span><span class="op" id="1330700">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1330703">//&nbsp;ErrTooLarge&nbsp;is&nbsp;passed&nbsp;to&nbsp;panic&nbsp;if&nbsp;memory&nbsp;cannot&nbsp;be&nbsp;allocated&nbsp;to&nbsp;store&nbsp;data&nbsp;in&nbsp;a&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1330794">var</span>&nbsp;<span class="ident" id="1330798">ErrTooLarge</span>&nbsp;<span class="op" id="1330810">=</span>&nbsp;<span class="ident" id="1330812">errors</span><span class="op" id="1330818">.</span><span class="ident" id="1330819">New</span><span class="op" id="1330822">(</span><span class="string" id="1330823">&#34;bytes.Buffer:&nbsp;too&nbsp;large&#34;</span><span class="op" id="1330848">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1330851">//&nbsp;Bytes&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno">40</span><span class="comment" id="1330929">//&nbsp;len(b.Bytes())&nbsp;==&nbsp;b.Len().&nbsp;&nbsp;If&nbsp;the&nbsp;caller&nbsp;changes&nbsp;the&nbsp;contents&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1331002">//&nbsp;returned&nbsp;slice,&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;buffer&nbsp;will&nbsp;change&nbsp;provided&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="1331075">//&nbsp;are&nbsp;no&nbsp;intervening&nbsp;method&nbsp;calls&nbsp;on&nbsp;the&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1331125">func</span>&nbsp;<span class="op" id="1331130">(</span><span class="ident" id="1331131">b</span>&nbsp;<span class="op" id="1331133">*</span><span class="ident" id="1331134">Buffer</span><span class="op" id="1331140">)</span>&nbsp;<span class="ident" id="1331142">Bytes</span><span class="op" id="1331147">(</span><span class="op" id="1331148">)</span>&nbsp;<span class="op" id="1331150">[</span><span class="op" id="1331151">]</span><span class="builtintype" id="1331152">byte</span>&nbsp;<span class="op" id="1331157">{</span>&nbsp;<span class="keyword" id="1331159">return</span>&nbsp;<span class="ident" id="1331166">b</span><span class="op" id="1331167">.</span><span class="ident" id="1331168">buf</span><span class="op" id="1331171">[</span><span class="ident" id="1331172">b</span><span class="op" id="1331173">.</span><span class="ident" id="1331174">off</span><span class="op" id="1331177">:</span><span class="op" id="1331178">]</span>&nbsp;<span class="op" id="1331180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="1331183">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="1331250">//&nbsp;as&nbsp;a&nbsp;string.&nbsp;&nbsp;If&nbsp;the&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;it&nbsp;returns&nbsp;&#34;&lt;nil&gt;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="1331319">func</span>&nbsp;<span class="op" id="1331324">(</span><span class="ident" id="1331325">b</span>&nbsp;<span class="op" id="1331327">*</span><span class="ident" id="1331328">Buffer</span><span class="op" id="1331334">)</span>&nbsp;<span class="ident" id="1331336">String</span><span class="op" id="1331342">(</span><span class="op" id="1331343">)</span>&nbsp;<span class="builtintype" id="1331345">string</span>&nbsp;<span class="op" id="1331352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331355">if</span>&nbsp;<span class="ident" id="1331358">b</span>&nbsp;<span class="op" id="1331360">==</span>&nbsp;<span class="ident" id="1331363">nil</span>&nbsp;<span class="op" id="1331367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1331371">//&nbsp;Special&nbsp;case,&nbsp;useful&nbsp;in&nbsp;debugging.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331411">return</span>&nbsp;<span class="string" id="1331418">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1331427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331430">return</span>&nbsp;<span class="builtintype" id="1331437">string</span><span class="op" id="1331443">(</span><span class="ident" id="1331444">b</span><span class="op" id="1331445">.</span><span class="ident" id="1331446">buf</span><span class="op" id="1331449">[</span><span class="ident" id="1331450">b</span><span class="op" id="1331451">.</span><span class="ident" id="1331452">off</span><span class="op" id="1331455">:</span><span class="op" id="1331456">]</span><span class="op" id="1331457">)</span><br>
<span class="lineno"></span><span class="op" id="1331459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1331462">//&nbsp;Len&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno"></span><span class="comment" id="1331534">//&nbsp;b.Len()&nbsp;==&nbsp;len(b.Bytes()).</span><br>
<span class="lineno"></span><span class="keyword" id="1331564">func</span>&nbsp;<span class="op" id="1331569">(</span><span class="ident" id="1331570">b</span>&nbsp;<span class="op" id="1331572">*</span><span class="ident" id="1331573">Buffer</span><span class="op" id="1331579">)</span>&nbsp;<span class="ident" id="1331581">Len</span><span class="op" id="1331584">(</span><span class="op" id="1331585">)</span>&nbsp;<span class="builtintype" id="1331587">int</span>&nbsp;<span class="op" id="1331591">{</span>&nbsp;<span class="keyword" id="1331593">return</span>&nbsp;<span class="builtinfunc" id="1331600">len</span><span class="op" id="1331603">(</span><span class="ident" id="1331604">b</span><span class="op" id="1331605">.</span><span class="ident" id="1331606">buf</span><span class="op" id="1331609">)</span>&nbsp;<span class="op" id="1331611">-</span>&nbsp;<span class="ident" id="1331613">b</span><span class="op" id="1331614">.</span><span class="ident" id="1331615">off</span>&nbsp;<span class="op" id="1331619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1331622">//&nbsp;Truncate&nbsp;discards&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;n&nbsp;unread&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">60</span><span class="comment" id="1331693">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;n&nbsp;is&nbsp;negative&nbsp;or&nbsp;greater&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1331765">func</span>&nbsp;<span class="op" id="1331770">(</span><span class="ident" id="1331771">b</span>&nbsp;<span class="op" id="1331773">*</span><span class="ident" id="1331774">Buffer</span><span class="op" id="1331780">)</span>&nbsp;<span class="ident" id="1331782">Truncate</span><span class="op" id="1331790">(</span><span class="ident" id="1331791">n</span>&nbsp;<span class="builtintype" id="1331793">int</span><span class="op" id="1331796">)</span>&nbsp;<span class="op" id="1331798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331801">b</span><span class="op" id="1331802">.</span><span class="ident" id="1331803">lastRead</span>&nbsp;<span class="op" id="1331812">=</span>&nbsp;<span class="ident" id="1331814">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331825">switch</span>&nbsp;<span class="op" id="1331832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331835">case</span>&nbsp;<span class="ident" id="1331840">n</span>&nbsp;<span class="op" id="1331842">&lt;</span>&nbsp;<span class="num" id="1331844">0</span>&nbsp;<span class="op" id="1331846">||</span>&nbsp;<span class="ident" id="1331849">n</span>&nbsp;<span class="op" id="1331851">&gt;</span>&nbsp;<span class="ident" id="1331853">b</span><span class="op" id="1331854">.</span><span class="ident" id="1331855">Len</span><span class="op" id="1331858">(</span><span class="op" id="1331859">)</span><span class="op" id="1331860">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1331864">panic</span><span class="op" id="1331869">(</span><span class="string" id="1331870">&#34;bytes.Buffer:&nbsp;truncation&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1331909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331912">case</span>&nbsp;<span class="ident" id="1331917">n</span>&nbsp;<span class="op" id="1331919">==</span>&nbsp;<span class="num" id="1331922">0</span><span class="op" id="1331923">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1331927">//&nbsp;Reuse&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331952">b</span><span class="op" id="1331953">.</span><span class="ident" id="1331954">off</span>&nbsp;<span class="op" id="1331958">=</span>&nbsp;<span class="num" id="1331960">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1331963">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331966">b</span><span class="op" id="1331967">.</span><span class="ident" id="1331968">buf</span>&nbsp;<span class="op" id="1331972">=</span>&nbsp;<span class="ident" id="1331974">b</span><span class="op" id="1331975">.</span><span class="ident" id="1331976">buf</span><span class="op" id="1331979">[</span><span class="num" id="1331980">0</span>&nbsp;<span class="op" id="1331982">:</span>&nbsp;<span class="ident" id="1331984">b</span><span class="op" id="1331985">.</span><span class="ident" id="1331986">off</span><span class="op" id="1331989">+</span><span class="ident" id="1331990">n</span><span class="op" id="1331991">]</span><br>
<span class="lineno"></span><span class="op" id="1331993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1331996">//&nbsp;Reset&nbsp;resets&nbsp;the&nbsp;buffer&nbsp;so&nbsp;it&nbsp;has&nbsp;no&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="1332045">//&nbsp;b.Reset()&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;b.Truncate(0).</span><br>
<span class="lineno">75</span><span class="keyword" id="1332088">func</span>&nbsp;<span class="op" id="1332093">(</span><span class="ident" id="1332094">b</span>&nbsp;<span class="op" id="1332096">*</span><span class="ident" id="1332097">Buffer</span><span class="op" id="1332103">)</span>&nbsp;<span class="ident" id="1332105">Reset</span><span class="op" id="1332110">(</span><span class="op" id="1332111">)</span>&nbsp;<span class="op" id="1332113">{</span>&nbsp;<span class="ident" id="1332115">b</span><span class="op" id="1332116">.</span><span class="ident" id="1332117">Truncate</span><span class="op" id="1332125">(</span><span class="num" id="1332126">0</span><span class="op" id="1332127">)</span>&nbsp;<span class="op" id="1332129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1332132">//&nbsp;grow&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for&nbsp;n&nbsp;more&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1332194">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;where&nbsp;bytes&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="1332249">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">80</span><span class="keyword" id="1332309">func</span>&nbsp;<span class="op" id="1332314">(</span><span class="ident" id="1332315">b</span>&nbsp;<span class="op" id="1332317">*</span><span class="ident" id="1332318">Buffer</span><span class="op" id="1332324">)</span>&nbsp;<span class="ident" id="1332326">grow</span><span class="op" id="1332330">(</span><span class="ident" id="1332331">n</span>&nbsp;<span class="builtintype" id="1332333">int</span><span class="op" id="1332336">)</span>&nbsp;<span class="builtintype" id="1332338">int</span>&nbsp;<span class="op" id="1332342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332345">m</span>&nbsp;<span class="op" id="1332347">:=</span>&nbsp;<span class="ident" id="1332350">b</span><span class="op" id="1332351">.</span><span class="ident" id="1332352">Len</span><span class="op" id="1332355">(</span><span class="op" id="1332356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1332359">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1332407">if</span>&nbsp;<span class="ident" id="1332410">m</span>&nbsp;<span class="op" id="1332412">==</span>&nbsp;<span class="num" id="1332415">0</span>&nbsp;<span class="op" id="1332417">&amp;&amp;</span>&nbsp;<span class="ident" id="1332420">b</span><span class="op" id="1332421">.</span><span class="ident" id="1332422">off</span>&nbsp;<span class="op" id="1332426">!=</span>&nbsp;<span class="num" id="1332429">0</span>&nbsp;<span class="op" id="1332431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332435">b</span><span class="op" id="1332436">.</span><span class="ident" id="1332437">Truncate</span><span class="op" id="1332445">(</span><span class="num" id="1332446">0</span><span class="op" id="1332447">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1332450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1332453">if</span>&nbsp;<span class="builtinfunc" id="1332456">len</span><span class="op" id="1332459">(</span><span class="ident" id="1332460">b</span><span class="op" id="1332461">.</span><span class="ident" id="1332462">buf</span><span class="op" id="1332465">)</span><span class="op" id="1332466">+</span><span class="ident" id="1332467">n</span>&nbsp;<span class="op" id="1332469">&gt;</span>&nbsp;<span class="builtinfunc" id="1332471">cap</span><span class="op" id="1332474">(</span><span class="ident" id="1332475">b</span><span class="op" id="1332476">.</span><span class="ident" id="1332477">buf</span><span class="op" id="1332480">)</span>&nbsp;<span class="op" id="1332482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1332486">var</span>&nbsp;<span class="ident" id="1332490">buf</span>&nbsp;<span class="op" id="1332494">[</span><span class="op" id="1332495">]</span><span class="builtintype" id="1332496">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1332503">if</span>&nbsp;<span class="ident" id="1332506">b</span><span class="op" id="1332507">.</span><span class="ident" id="1332508">buf</span>&nbsp;<span class="op" id="1332512">==</span>&nbsp;<span class="ident" id="1332515">nil</span>&nbsp;<span class="op" id="1332519">&amp;&amp;</span>&nbsp;<span class="ident" id="1332522">n</span>&nbsp;<span class="op" id="1332524">&lt;=</span>&nbsp;<span class="builtinfunc" id="1332527">len</span><span class="op" id="1332530">(</span><span class="ident" id="1332531">b</span><span class="op" id="1332532">.</span><span class="ident" id="1332533">bootstrap</span><span class="op" id="1332542">)</span>&nbsp;<span class="op" id="1332544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332549">buf</span>&nbsp;<span class="op" id="1332553">=</span>&nbsp;<span class="ident" id="1332555">b</span><span class="op" id="1332556">.</span><span class="ident" id="1332557">bootstrap</span><span class="op" id="1332566">[</span><span class="num" id="1332567">0</span><span class="op" id="1332568">:</span><span class="op" id="1332569">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1332573">}</span>&nbsp;<span class="keyword" id="1332575">else</span>&nbsp;<span class="keyword" id="1332580">if</span>&nbsp;<span class="ident" id="1332583">m</span><span class="op" id="1332584">+</span><span class="ident" id="1332585">n</span>&nbsp;<span class="op" id="1332587">&lt;=</span>&nbsp;<span class="builtinfunc" id="1332590">cap</span><span class="op" id="1332593">(</span><span class="ident" id="1332594">b</span><span class="op" id="1332595">.</span><span class="ident" id="1332596">buf</span><span class="op" id="1332599">)</span><span class="op" id="1332600">/</span><span class="num" id="1332601">2</span>&nbsp;<span class="op" id="1332603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1332608">//&nbsp;We&nbsp;can&nbsp;slide&nbsp;things&nbsp;down&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1332667">//&nbsp;slice.&nbsp;We&nbsp;only&nbsp;need&nbsp;m+n&nbsp;&lt;=&nbsp;cap(b.buf)&nbsp;to&nbsp;slide,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1332725">//&nbsp;we&nbsp;instead&nbsp;let&nbsp;capacity&nbsp;get&nbsp;twice&nbsp;as&nbsp;large&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1332780">//&nbsp;don&#39;t&nbsp;spend&nbsp;all&nbsp;our&nbsp;time&nbsp;copying.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1332820">copy</span><span class="op" id="1332824">(</span><span class="ident" id="1332825">b</span><span class="op" id="1332826">.</span><span class="ident" id="1332827">buf</span><span class="op" id="1332830">[</span><span class="op" id="1332831">:</span><span class="op" id="1332832">]</span><span class="op" id="1332833">,</span>&nbsp;<span class="ident" id="1332835">b</span><span class="op" id="1332836">.</span><span class="ident" id="1332837">buf</span><span class="op" id="1332840">[</span><span class="ident" id="1332841">b</span><span class="op" id="1332842">.</span><span class="ident" id="1332843">off</span><span class="op" id="1332846">:</span><span class="op" id="1332847">]</span><span class="op" id="1332848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332853">buf</span>&nbsp;<span class="op" id="1332857">=</span>&nbsp;<span class="ident" id="1332859">b</span><span class="op" id="1332860">.</span><span class="ident" id="1332861">buf</span><span class="op" id="1332864">[</span><span class="op" id="1332865">:</span><span class="ident" id="1332866">m</span><span class="op" id="1332867">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1332871">}</span>&nbsp;<span class="keyword" id="1332873">else</span>&nbsp;<span class="op" id="1332878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1332883">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;anywhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332915">buf</span>&nbsp;<span class="op" id="1332919">=</span>&nbsp;<span class="ident" id="1332921">makeSlice</span><span class="op" id="1332930">(</span><span class="num" id="1332931">2</span><span class="op" id="1332932">*</span><span class="builtinfunc" id="1332933">cap</span><span class="op" id="1332936">(</span><span class="ident" id="1332937">b</span><span class="op" id="1332938">.</span><span class="ident" id="1332939">buf</span><span class="op" id="1332942">)</span>&nbsp;<span class="op" id="1332944">+</span>&nbsp;<span class="ident" id="1332946">n</span><span class="op" id="1332947">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1332952">copy</span><span class="op" id="1332956">(</span><span class="ident" id="1332957">buf</span><span class="op" id="1332960">,</span>&nbsp;<span class="ident" id="1332962">b</span><span class="op" id="1332963">.</span><span class="ident" id="1332964">buf</span><span class="op" id="1332967">[</span><span class="ident" id="1332968">b</span><span class="op" id="1332969">.</span><span class="ident" id="1332970">off</span><span class="op" id="1332973">:</span><span class="op" id="1332974">]</span><span class="op" id="1332975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1332979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332983">b</span><span class="op" id="1332984">.</span><span class="ident" id="1332985">buf</span>&nbsp;<span class="op" id="1332989">=</span>&nbsp;<span class="ident" id="1332991">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332997">b</span><span class="op" id="1332998">.</span><span class="ident" id="1332999">off</span>&nbsp;<span class="op" id="1333003">=</span>&nbsp;<span class="num" id="1333005">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1333008">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333011">b</span><span class="op" id="1333012">.</span><span class="ident" id="1333013">buf</span>&nbsp;<span class="op" id="1333017">=</span>&nbsp;<span class="ident" id="1333019">b</span><span class="op" id="1333020">.</span><span class="ident" id="1333021">buf</span><span class="op" id="1333024">[</span><span class="num" id="1333025">0</span>&nbsp;<span class="op" id="1333027">:</span>&nbsp;<span class="ident" id="1333029">b</span><span class="op" id="1333030">.</span><span class="ident" id="1333031">off</span><span class="op" id="1333034">+</span><span class="ident" id="1333035">m</span><span class="op" id="1333036">+</span><span class="ident" id="1333037">n</span><span class="op" id="1333038">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333041">return</span>&nbsp;<span class="ident" id="1333048">b</span><span class="op" id="1333049">.</span><span class="ident" id="1333050">off</span>&nbsp;<span class="op" id="1333054">+</span>&nbsp;<span class="ident" id="1333056">m</span><br>
<span class="lineno"></span><span class="op" id="1333058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1333061">//&nbsp;Grow&nbsp;grows&nbsp;the&nbsp;buffer&#39;s&nbsp;capacity,&nbsp;if&nbsp;necessary,&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for</span><br>
<span class="lineno">110</span><span class="comment" id="1333135">//&nbsp;another&nbsp;n&nbsp;bytes.&nbsp;After&nbsp;Grow(n),&nbsp;at&nbsp;least&nbsp;n&nbsp;bytes&nbsp;can&nbsp;be&nbsp;written&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1333209">//&nbsp;buffer&nbsp;without&nbsp;another&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="1333247">//&nbsp;If&nbsp;n&nbsp;is&nbsp;negative,&nbsp;Grow&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="comment" id="1333285">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1333345">func</span>&nbsp;<span class="op" id="1333350">(</span><span class="ident" id="1333351">b</span>&nbsp;<span class="op" id="1333353">*</span><span class="ident" id="1333354">Buffer</span><span class="op" id="1333360">)</span>&nbsp;<span class="ident" id="1333362">Grow</span><span class="op" id="1333366">(</span><span class="ident" id="1333367">n</span>&nbsp;<span class="builtintype" id="1333369">int</span><span class="op" id="1333372">)</span>&nbsp;<span class="op" id="1333374">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333377">if</span>&nbsp;<span class="ident" id="1333380">n</span>&nbsp;<span class="op" id="1333382">&lt;</span>&nbsp;<span class="num" id="1333384">0</span>&nbsp;<span class="op" id="1333386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1333390">panic</span><span class="op" id="1333395">(</span><span class="string" id="1333396">&#34;bytes.Buffer.Grow:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="1333431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1333434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333437">m</span>&nbsp;<span class="op" id="1333439">:=</span>&nbsp;<span class="ident" id="1333442">b</span><span class="op" id="1333443">.</span><span class="ident" id="1333444">grow</span><span class="op" id="1333448">(</span><span class="ident" id="1333449">n</span><span class="op" id="1333450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333453">b</span><span class="op" id="1333454">.</span><span class="ident" id="1333455">buf</span>&nbsp;<span class="op" id="1333459">=</span>&nbsp;<span class="ident" id="1333461">b</span><span class="op" id="1333462">.</span><span class="ident" id="1333463">buf</span><span class="op" id="1333466">[</span><span class="num" id="1333467">0</span><span class="op" id="1333468">:</span><span class="ident" id="1333469">m</span><span class="op" id="1333470">]</span><br>
<span class="lineno">120</span><span class="op" id="1333472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1333475">//&nbsp;Write&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1333547">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;p;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1333623">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;Write&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">125</span><span class="keyword" id="1333687">func</span>&nbsp;<span class="op" id="1333692">(</span><span class="ident" id="1333693">b</span>&nbsp;<span class="op" id="1333695">*</span><span class="ident" id="1333696">Buffer</span><span class="op" id="1333702">)</span>&nbsp;<span class="ident" id="1333704">Write</span><span class="op" id="1333709">(</span><span class="ident" id="1333710">p</span>&nbsp;<span class="op" id="1333712">[</span><span class="op" id="1333713">]</span><span class="builtintype" id="1333714">byte</span><span class="op" id="1333718">)</span>&nbsp;<span class="op" id="1333720">(</span><span class="ident" id="1333721">n</span>&nbsp;<span class="builtintype" id="1333723">int</span><span class="op" id="1333726">,</span>&nbsp;<span class="ident" id="1333728">err</span>&nbsp;<span class="builtintype" id="1333732">error</span><span class="op" id="1333737">)</span>&nbsp;<span class="op" id="1333739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333742">b</span><span class="op" id="1333743">.</span><span class="ident" id="1333744">lastRead</span>&nbsp;<span class="op" id="1333753">=</span>&nbsp;<span class="ident" id="1333755">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333766">m</span>&nbsp;<span class="op" id="1333768">:=</span>&nbsp;<span class="ident" id="1333771">b</span><span class="op" id="1333772">.</span><span class="ident" id="1333773">grow</span><span class="op" id="1333777">(</span><span class="builtinfunc" id="1333778">len</span><span class="op" id="1333781">(</span><span class="ident" id="1333782">p</span><span class="op" id="1333783">)</span><span class="op" id="1333784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333787">return</span>&nbsp;<span class="builtinfunc" id="1333794">copy</span><span class="op" id="1333798">(</span><span class="ident" id="1333799">b</span><span class="op" id="1333800">.</span><span class="ident" id="1333801">buf</span><span class="op" id="1333804">[</span><span class="ident" id="1333805">m</span><span class="op" id="1333806">:</span><span class="op" id="1333807">]</span><span class="op" id="1333808">,</span>&nbsp;<span class="ident" id="1333810">p</span><span class="op" id="1333811">)</span><span class="op" id="1333812">,</span>&nbsp;<span class="ident" id="1333814">nil</span><br>
<span class="lineno"></span><span class="op" id="1333818">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1333821">//&nbsp;WriteString&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;s&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1333899">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;s;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1333975">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteString&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1334045">func</span>&nbsp;<span class="op" id="1334050">(</span><span class="ident" id="1334051">b</span>&nbsp;<span class="op" id="1334053">*</span><span class="ident" id="1334054">Buffer</span><span class="op" id="1334060">)</span>&nbsp;<span class="ident" id="1334062">WriteString</span><span class="op" id="1334073">(</span><span class="ident" id="1334074">s</span>&nbsp;<span class="builtintype" id="1334076">string</span><span class="op" id="1334082">)</span>&nbsp;<span class="op" id="1334084">(</span><span class="ident" id="1334085">n</span>&nbsp;<span class="builtintype" id="1334087">int</span><span class="op" id="1334090">,</span>&nbsp;<span class="ident" id="1334092">err</span>&nbsp;<span class="builtintype" id="1334096">error</span><span class="op" id="1334101">)</span>&nbsp;<span class="op" id="1334103">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334106">b</span><span class="op" id="1334107">.</span><span class="ident" id="1334108">lastRead</span>&nbsp;<span class="op" id="1334117">=</span>&nbsp;<span class="ident" id="1334119">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334130">m</span>&nbsp;<span class="op" id="1334132">:=</span>&nbsp;<span class="ident" id="1334135">b</span><span class="op" id="1334136">.</span><span class="ident" id="1334137">grow</span><span class="op" id="1334141">(</span><span class="builtinfunc" id="1334142">len</span><span class="op" id="1334145">(</span><span class="ident" id="1334146">s</span><span class="op" id="1334147">)</span><span class="op" id="1334148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334151">return</span>&nbsp;<span class="builtinfunc" id="1334158">copy</span><span class="op" id="1334162">(</span><span class="ident" id="1334163">b</span><span class="op" id="1334164">.</span><span class="ident" id="1334165">buf</span><span class="op" id="1334168">[</span><span class="ident" id="1334169">m</span><span class="op" id="1334170">:</span><span class="op" id="1334171">]</span><span class="op" id="1334172">,</span>&nbsp;<span class="ident" id="1334174">s</span><span class="op" id="1334175">)</span><span class="op" id="1334176">,</span>&nbsp;<span class="ident" id="1334178">nil</span><br>
<span class="lineno"></span><span class="op" id="1334182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1334185">//&nbsp;MinRead&nbsp;is&nbsp;the&nbsp;minimum&nbsp;slice&nbsp;size&nbsp;passed&nbsp;to&nbsp;a&nbsp;Read&nbsp;call&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1334247">//&nbsp;Buffer.ReadFrom.&nbsp;&nbsp;As&nbsp;long&nbsp;as&nbsp;the&nbsp;Buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;MinRead&nbsp;bytes&nbsp;beyond</span><br>
<span class="lineno"></span><span class="comment" id="1334324">//&nbsp;what&nbsp;is&nbsp;required&nbsp;to&nbsp;hold&nbsp;the&nbsp;contents&nbsp;of&nbsp;r,&nbsp;ReadFrom&nbsp;will&nbsp;not&nbsp;grow&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1334398">//&nbsp;underlying&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1334420">const</span>&nbsp;<span class="ident" id="1334426">MinRead</span>&nbsp;<span class="op" id="1334434">=</span>&nbsp;<span class="num" id="1334436">512</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1334441">//&nbsp;ReadFrom&nbsp;reads&nbsp;data&nbsp;from&nbsp;r&nbsp;until&nbsp;EOF&nbsp;and&nbsp;appends&nbsp;it&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing</span><br>
<span class="lineno"></span><span class="comment" id="1334519">//&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="1334596">//&nbsp;error&nbsp;except&nbsp;io.EOF&nbsp;encountered&nbsp;during&nbsp;the&nbsp;read&nbsp;is&nbsp;also&nbsp;returned.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1334672">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;ReadFrom&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">150</span><span class="keyword" id="1334739">func</span>&nbsp;<span class="op" id="1334744">(</span><span class="ident" id="1334745">b</span>&nbsp;<span class="op" id="1334747">*</span><span class="ident" id="1334748">Buffer</span><span class="op" id="1334754">)</span>&nbsp;<span class="ident" id="1334756">ReadFrom</span><span class="op" id="1334764">(</span><span class="ident" id="1334765">r</span>&nbsp;<span class="ident" id="1334767">io</span><span class="op" id="1334769">.</span><span class="ident" id="1334770">Reader</span><span class="op" id="1334776">)</span>&nbsp;<span class="op" id="1334778">(</span><span class="ident" id="1334779">n</span>&nbsp;<span class="ident" id="1334781">int64</span><span class="op" id="1334786">,</span>&nbsp;<span class="ident" id="1334788">err</span>&nbsp;<span class="builtintype" id="1334792">error</span><span class="op" id="1334797">)</span>&nbsp;<span class="op" id="1334799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334802">b</span><span class="op" id="1334803">.</span><span class="ident" id="1334804">lastRead</span>&nbsp;<span class="op" id="1334813">=</span>&nbsp;<span class="ident" id="1334815">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1334826">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334874">if</span>&nbsp;<span class="ident" id="1334877">b</span><span class="op" id="1334878">.</span><span class="ident" id="1334879">off</span>&nbsp;<span class="op" id="1334883">&gt;=</span>&nbsp;<span class="builtinfunc" id="1334886">len</span><span class="op" id="1334889">(</span><span class="ident" id="1334890">b</span><span class="op" id="1334891">.</span><span class="ident" id="1334892">buf</span><span class="op" id="1334895">)</span>&nbsp;<span class="op" id="1334897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334901">b</span><span class="op" id="1334902">.</span><span class="ident" id="1334903">Truncate</span><span class="op" id="1334911">(</span><span class="num" id="1334912">0</span><span class="op" id="1334913">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334919">for</span>&nbsp;<span class="op" id="1334923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334927">if</span>&nbsp;<span class="ident" id="1334930">free</span>&nbsp;<span class="op" id="1334935">:=</span>&nbsp;<span class="builtinfunc" id="1334938">cap</span><span class="op" id="1334941">(</span><span class="ident" id="1334942">b</span><span class="op" id="1334943">.</span><span class="ident" id="1334944">buf</span><span class="op" id="1334947">)</span>&nbsp;<span class="op" id="1334949">-</span>&nbsp;<span class="builtinfunc" id="1334951">len</span><span class="op" id="1334954">(</span><span class="ident" id="1334955">b</span><span class="op" id="1334956">.</span><span class="ident" id="1334957">buf</span><span class="op" id="1334960">)</span><span class="op" id="1334961">;</span>&nbsp;<span class="ident" id="1334963">free</span>&nbsp;<span class="op" id="1334968">&lt;</span>&nbsp;<span class="ident" id="1334970">MinRead</span>&nbsp;<span class="op" id="1334978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1334983">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;at&nbsp;end</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335013">newBuf</span>&nbsp;<span class="op" id="1335020">:=</span>&nbsp;<span class="ident" id="1335023">b</span><span class="op" id="1335024">.</span><span class="ident" id="1335025">buf</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335032">if</span>&nbsp;<span class="ident" id="1335035">b</span><span class="op" id="1335036">.</span><span class="ident" id="1335037">off</span><span class="op" id="1335040">+</span><span class="ident" id="1335041">free</span>&nbsp;<span class="op" id="1335046">&lt;</span>&nbsp;<span class="ident" id="1335048">MinRead</span>&nbsp;<span class="op" id="1335056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1335062">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;using&nbsp;beginning&nbsp;of&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1335113">//&nbsp;double&nbsp;buffer&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335143">newBuf</span>&nbsp;<span class="op" id="1335150">=</span>&nbsp;<span class="ident" id="1335152">makeSlice</span><span class="op" id="1335161">(</span><span class="num" id="1335162">2</span><span class="op" id="1335163">*</span><span class="builtinfunc" id="1335164">cap</span><span class="op" id="1335167">(</span><span class="ident" id="1335168">b</span><span class="op" id="1335169">.</span><span class="ident" id="1335170">buf</span><span class="op" id="1335173">)</span>&nbsp;<span class="op" id="1335175">+</span>&nbsp;<span class="ident" id="1335177">MinRead</span><span class="op" id="1335184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335189">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1335194">copy</span><span class="op" id="1335198">(</span><span class="ident" id="1335199">newBuf</span><span class="op" id="1335205">,</span>&nbsp;<span class="ident" id="1335207">b</span><span class="op" id="1335208">.</span><span class="ident" id="1335209">buf</span><span class="op" id="1335212">[</span><span class="ident" id="1335213">b</span><span class="op" id="1335214">.</span><span class="ident" id="1335215">off</span><span class="op" id="1335218">:</span><span class="op" id="1335219">]</span><span class="op" id="1335220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335225">b</span><span class="op" id="1335226">.</span><span class="ident" id="1335227">buf</span>&nbsp;<span class="op" id="1335231">=</span>&nbsp;<span class="ident" id="1335233">newBuf</span><span class="op" id="1335239">[</span><span class="op" id="1335240">:</span><span class="builtinfunc" id="1335241">len</span><span class="op" id="1335244">(</span><span class="ident" id="1335245">b</span><span class="op" id="1335246">.</span><span class="ident" id="1335247">buf</span><span class="op" id="1335250">)</span><span class="op" id="1335251">-</span><span class="ident" id="1335252">b</span><span class="op" id="1335253">.</span><span class="ident" id="1335254">off</span><span class="op" id="1335257">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335262">b</span><span class="op" id="1335263">.</span><span class="ident" id="1335264">off</span>&nbsp;<span class="op" id="1335268">=</span>&nbsp;<span class="num" id="1335270">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335278">m</span><span class="op" id="1335279">,</span>&nbsp;<span class="ident" id="1335281">e</span>&nbsp;<span class="op" id="1335283">:=</span>&nbsp;<span class="ident" id="1335286">r</span><span class="op" id="1335287">.</span><span class="ident" id="1335288">Read</span><span class="op" id="1335292">(</span><span class="ident" id="1335293">b</span><span class="op" id="1335294">.</span><span class="ident" id="1335295">buf</span><span class="op" id="1335298">[</span><span class="builtinfunc" id="1335299">len</span><span class="op" id="1335302">(</span><span class="ident" id="1335303">b</span><span class="op" id="1335304">.</span><span class="ident" id="1335305">buf</span><span class="op" id="1335308">)</span><span class="op" id="1335309">:</span><span class="builtinfunc" id="1335310">cap</span><span class="op" id="1335313">(</span><span class="ident" id="1335314">b</span><span class="op" id="1335315">.</span><span class="ident" id="1335316">buf</span><span class="op" id="1335319">)</span><span class="op" id="1335320">]</span><span class="op" id="1335321">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335325">b</span><span class="op" id="1335326">.</span><span class="ident" id="1335327">buf</span>&nbsp;<span class="op" id="1335331">=</span>&nbsp;<span class="ident" id="1335333">b</span><span class="op" id="1335334">.</span><span class="ident" id="1335335">buf</span><span class="op" id="1335338">[</span><span class="num" id="1335339">0</span>&nbsp;<span class="op" id="1335341">:</span>&nbsp;<span class="builtinfunc" id="1335343">len</span><span class="op" id="1335346">(</span><span class="ident" id="1335347">b</span><span class="op" id="1335348">.</span><span class="ident" id="1335349">buf</span><span class="op" id="1335352">)</span><span class="op" id="1335353">+</span><span class="ident" id="1335354">m</span><span class="op" id="1335355">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335359">n</span>&nbsp;<span class="op" id="1335361">+=</span>&nbsp;<span class="ident" id="1335364">int64</span><span class="op" id="1335369">(</span><span class="ident" id="1335370">m</span><span class="op" id="1335371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335375">if</span>&nbsp;<span class="ident" id="1335378">e</span>&nbsp;<span class="op" id="1335380">==</span>&nbsp;<span class="ident" id="1335383">io</span><span class="op" id="1335385">.</span><span class="ident" id="1335386">EOF</span>&nbsp;<span class="op" id="1335390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335395">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335403">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335407">if</span>&nbsp;<span class="ident" id="1335410">e</span>&nbsp;<span class="op" id="1335412">!=</span>&nbsp;<span class="ident" id="1335415">nil</span>&nbsp;<span class="op" id="1335419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335424">return</span>&nbsp;<span class="ident" id="1335431">n</span><span class="op" id="1335432">,</span>&nbsp;<span class="ident" id="1335434">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335444">return</span>&nbsp;<span class="ident" id="1335451">n</span><span class="op" id="1335452">,</span>&nbsp;<span class="ident" id="1335454">nil</span>&nbsp;<span class="comment" id="1335458">//&nbsp;err&nbsp;is&nbsp;EOF,&nbsp;so&nbsp;return&nbsp;nil&nbsp;explicitly</span><br>
<span class="lineno">180</span><span class="op" id="1335498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1335501">//&nbsp;makeSlice&nbsp;allocates&nbsp;a&nbsp;slice&nbsp;of&nbsp;size&nbsp;n.&nbsp;If&nbsp;the&nbsp;allocation&nbsp;fails,&nbsp;it&nbsp;panics</span><br>
<span class="lineno"></span><span class="comment" id="1335578">//&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1335599">func</span>&nbsp;<span class="ident" id="1335604">makeSlice</span><span class="op" id="1335613">(</span><span class="ident" id="1335614">n</span>&nbsp;<span class="builtintype" id="1335616">int</span><span class="op" id="1335619">)</span>&nbsp;<span class="op" id="1335621">[</span><span class="op" id="1335622">]</span><span class="builtintype" id="1335623">byte</span>&nbsp;<span class="op" id="1335628">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1335631">//&nbsp;If&nbsp;the&nbsp;make&nbsp;fails,&nbsp;give&nbsp;a&nbsp;known&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335674">defer</span>&nbsp;<span class="keyword" id="1335680">func</span><span class="op" id="1335684">(</span><span class="op" id="1335685">)</span>&nbsp;<span class="op" id="1335687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335691">if</span>&nbsp;<span class="builtinfunc" id="1335694">recover</span><span class="op" id="1335701">(</span><span class="op" id="1335702">)</span>&nbsp;<span class="op" id="1335704">!=</span>&nbsp;<span class="ident" id="1335707">nil</span>&nbsp;<span class="op" id="1335711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1335716">panic</span><span class="op" id="1335721">(</span><span class="ident" id="1335722">ErrTooLarge</span><span class="op" id="1335733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335737">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335740">}</span><span class="op" id="1335741">(</span><span class="op" id="1335742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335745">return</span>&nbsp;<span class="builtinfunc" id="1335752">make</span><span class="op" id="1335756">(</span><span class="op" id="1335757">[</span><span class="op" id="1335758">]</span><span class="builtintype" id="1335759">byte</span><span class="op" id="1335763">,</span>&nbsp;<span class="ident" id="1335765">n</span><span class="op" id="1335766">)</span><br>
<span class="lineno"></span><span class="op" id="1335768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1335771">//&nbsp;WriteTo&nbsp;writes&nbsp;data&nbsp;to&nbsp;w&nbsp;until&nbsp;the&nbsp;buffer&nbsp;is&nbsp;drained&nbsp;or&nbsp;an&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno">195</span><span class="comment" id="1335847">//&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written;&nbsp;it&nbsp;always&nbsp;fits&nbsp;into&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="1335924">//&nbsp;int,&nbsp;but&nbsp;it&nbsp;is&nbsp;int64&nbsp;to&nbsp;match&nbsp;the&nbsp;io.WriterTo&nbsp;interface.&nbsp;Any&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="1335994">//&nbsp;encountered&nbsp;during&nbsp;the&nbsp;write&nbsp;is&nbsp;also&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="1336044">func</span>&nbsp;<span class="op" id="1336049">(</span><span class="ident" id="1336050">b</span>&nbsp;<span class="op" id="1336052">*</span><span class="ident" id="1336053">Buffer</span><span class="op" id="1336059">)</span>&nbsp;<span class="ident" id="1336061">WriteTo</span><span class="op" id="1336068">(</span><span class="ident" id="1336069">w</span>&nbsp;<span class="ident" id="1336071">io</span><span class="op" id="1336073">.</span><span class="ident" id="1336074">Writer</span><span class="op" id="1336080">)</span>&nbsp;<span class="op" id="1336082">(</span><span class="ident" id="1336083">n</span>&nbsp;<span class="ident" id="1336085">int64</span><span class="op" id="1336090">,</span>&nbsp;<span class="ident" id="1336092">err</span>&nbsp;<span class="builtintype" id="1336096">error</span><span class="op" id="1336101">)</span>&nbsp;<span class="op" id="1336103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336106">b</span><span class="op" id="1336107">.</span><span class="ident" id="1336108">lastRead</span>&nbsp;<span class="op" id="1336117">=</span>&nbsp;<span class="ident" id="1336119">opInvalid</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336130">if</span>&nbsp;<span class="ident" id="1336133">b</span><span class="op" id="1336134">.</span><span class="ident" id="1336135">off</span>&nbsp;<span class="op" id="1336139">&lt;</span>&nbsp;<span class="builtinfunc" id="1336141">len</span><span class="op" id="1336144">(</span><span class="ident" id="1336145">b</span><span class="op" id="1336146">.</span><span class="ident" id="1336147">buf</span><span class="op" id="1336150">)</span>&nbsp;<span class="op" id="1336152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336156">nBytes</span>&nbsp;<span class="op" id="1336163">:=</span>&nbsp;<span class="ident" id="1336166">b</span><span class="op" id="1336167">.</span><span class="ident" id="1336168">Len</span><span class="op" id="1336171">(</span><span class="op" id="1336172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336176">m</span><span class="op" id="1336177">,</span>&nbsp;<span class="ident" id="1336179">e</span>&nbsp;<span class="op" id="1336181">:=</span>&nbsp;<span class="ident" id="1336184">w</span><span class="op" id="1336185">.</span><span class="ident" id="1336186">Write</span><span class="op" id="1336191">(</span><span class="ident" id="1336192">b</span><span class="op" id="1336193">.</span><span class="ident" id="1336194">buf</span><span class="op" id="1336197">[</span><span class="ident" id="1336198">b</span><span class="op" id="1336199">.</span><span class="ident" id="1336200">off</span><span class="op" id="1336203">:</span><span class="op" id="1336204">]</span><span class="op" id="1336205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336209">if</span>&nbsp;<span class="ident" id="1336212">m</span>&nbsp;<span class="op" id="1336214">&gt;</span>&nbsp;<span class="ident" id="1336216">nBytes</span>&nbsp;<span class="op" id="1336223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1336228">panic</span><span class="op" id="1336233">(</span><span class="string" id="1336234">&#34;bytes.Buffer.WriteTo:&nbsp;invalid&nbsp;Write&nbsp;count&#34;</span><span class="op" id="1336277">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1336281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336285">b</span><span class="op" id="1336286">.</span><span class="ident" id="1336287">off</span>&nbsp;<span class="op" id="1336291">+=</span>&nbsp;<span class="ident" id="1336294">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336298">n</span>&nbsp;<span class="op" id="1336300">=</span>&nbsp;<span class="ident" id="1336302">int64</span><span class="op" id="1336307">(</span><span class="ident" id="1336308">m</span><span class="op" id="1336309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336313">if</span>&nbsp;<span class="ident" id="1336316">e</span>&nbsp;<span class="op" id="1336318">!=</span>&nbsp;<span class="ident" id="1336321">nil</span>&nbsp;<span class="op" id="1336325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336330">return</span>&nbsp;<span class="ident" id="1336337">n</span><span class="op" id="1336338">,</span>&nbsp;<span class="ident" id="1336340">e</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1336344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1336348">//&nbsp;all&nbsp;bytes&nbsp;should&nbsp;have&nbsp;been&nbsp;written,&nbsp;by&nbsp;definition&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1336406">//&nbsp;Write&nbsp;method&nbsp;in&nbsp;io.Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336437">if</span>&nbsp;<span class="ident" id="1336440">m</span>&nbsp;<span class="op" id="1336442">!=</span>&nbsp;<span class="ident" id="1336445">nBytes</span>&nbsp;<span class="op" id="1336452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336457">return</span>&nbsp;<span class="ident" id="1336464">n</span><span class="op" id="1336465">,</span>&nbsp;<span class="ident" id="1336467">io</span><span class="op" id="1336469">.</span><span class="ident" id="1336470">ErrShortWrite</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1336486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1336489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1336492">//&nbsp;Buffer&nbsp;is&nbsp;now&nbsp;empty;&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336524">b</span><span class="op" id="1336525">.</span><span class="ident" id="1336526">Truncate</span><span class="op" id="1336534">(</span><span class="num" id="1336535">0</span><span class="op" id="1336536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336539">return</span><br>
<span class="lineno">220</span><span class="op" id="1336546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1336549">//&nbsp;WriteByte&nbsp;appends&nbsp;the&nbsp;byte&nbsp;c&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="comment" id="1336626">//&nbsp;The&nbsp;returned&nbsp;error&nbsp;is&nbsp;always&nbsp;nil,&nbsp;but&nbsp;is&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1336703">//&nbsp;WriteByte.&nbsp;If&nbsp;the&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteByte&nbsp;will&nbsp;panic&nbsp;with</span><br>
<span class="lineno">225</span><span class="comment" id="1336776">//&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1336792">func</span>&nbsp;<span class="op" id="1336797">(</span><span class="ident" id="1336798">b</span>&nbsp;<span class="op" id="1336800">*</span><span class="ident" id="1336801">Buffer</span><span class="op" id="1336807">)</span>&nbsp;<span class="ident" id="1336809">WriteByte</span><span class="op" id="1336818">(</span><span class="ident" id="1336819">c</span>&nbsp;<span class="builtintype" id="1336821">byte</span><span class="op" id="1336825">)</span>&nbsp;<span class="builtintype" id="1336827">error</span>&nbsp;<span class="op" id="1336833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336836">b</span><span class="op" id="1336837">.</span><span class="ident" id="1336838">lastRead</span>&nbsp;<span class="op" id="1336847">=</span>&nbsp;<span class="ident" id="1336849">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336860">m</span>&nbsp;<span class="op" id="1336862">:=</span>&nbsp;<span class="ident" id="1336865">b</span><span class="op" id="1336866">.</span><span class="ident" id="1336867">grow</span><span class="op" id="1336871">(</span><span class="num" id="1336872">1</span><span class="op" id="1336873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336876">b</span><span class="op" id="1336877">.</span><span class="ident" id="1336878">buf</span><span class="op" id="1336881">[</span><span class="ident" id="1336882">m</span><span class="op" id="1336883">]</span>&nbsp;<span class="op" id="1336885">=</span>&nbsp;<span class="ident" id="1336887">c</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336890">return</span>&nbsp;<span class="ident" id="1336897">nil</span><br>
<span class="lineno"></span><span class="op" id="1336901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1336904">//&nbsp;WriteRune&nbsp;appends&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1336975">//&nbsp;buffer,&nbsp;returning&nbsp;its&nbsp;length&nbsp;and&nbsp;an&nbsp;error,&nbsp;which&nbsp;is&nbsp;always&nbsp;nil&nbsp;but&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="1337048">//&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s&nbsp;WriteRune.&nbsp;The&nbsp;buffer&nbsp;is&nbsp;grown&nbsp;as&nbsp;needed;</span><br>
<span class="lineno"></span><span class="comment" id="1337126">//&nbsp;if&nbsp;it&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteRune&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1337193">func</span>&nbsp;<span class="op" id="1337198">(</span><span class="ident" id="1337199">b</span>&nbsp;<span class="op" id="1337201">*</span><span class="ident" id="1337202">Buffer</span><span class="op" id="1337208">)</span>&nbsp;<span class="ident" id="1337210">WriteRune</span><span class="op" id="1337219">(</span><span class="ident" id="1337220">r</span>&nbsp;<span class="builtintype" id="1337222">rune</span><span class="op" id="1337226">)</span>&nbsp;<span class="op" id="1337228">(</span><span class="ident" id="1337229">n</span>&nbsp;<span class="builtintype" id="1337231">int</span><span class="op" id="1337234">,</span>&nbsp;<span class="ident" id="1337236">err</span>&nbsp;<span class="builtintype" id="1337240">error</span><span class="op" id="1337245">)</span>&nbsp;<span class="op" id="1337247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337250">if</span>&nbsp;<span class="ident" id="1337253">r</span>&nbsp;<span class="op" id="1337255">&lt;</span>&nbsp;<span class="ident" id="1337257">utf8</span><span class="op" id="1337261">.</span><span class="ident" id="1337262">RuneSelf</span>&nbsp;<span class="op" id="1337271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337275">b</span><span class="op" id="1337276">.</span><span class="ident" id="1337277">WriteByte</span><span class="op" id="1337286">(</span><span class="builtintype" id="1337287">byte</span><span class="op" id="1337291">(</span><span class="ident" id="1337292">r</span><span class="op" id="1337293">)</span><span class="op" id="1337294">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337298">return</span>&nbsp;<span class="num" id="1337305">1</span><span class="op" id="1337306">,</span>&nbsp;<span class="ident" id="1337308">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337316">n</span>&nbsp;<span class="op" id="1337318">=</span>&nbsp;<span class="ident" id="1337320">utf8</span><span class="op" id="1337324">.</span><span class="ident" id="1337325">EncodeRune</span><span class="op" id="1337335">(</span><span class="ident" id="1337336">b</span><span class="op" id="1337337">.</span><span class="ident" id="1337338">runeBytes</span><span class="op" id="1337347">[</span><span class="num" id="1337348">0</span><span class="op" id="1337349">:</span><span class="op" id="1337350">]</span><span class="op" id="1337351">,</span>&nbsp;<span class="ident" id="1337353">r</span><span class="op" id="1337354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337357">b</span><span class="op" id="1337358">.</span><span class="ident" id="1337359">Write</span><span class="op" id="1337364">(</span><span class="ident" id="1337365">b</span><span class="op" id="1337366">.</span><span class="ident" id="1337367">runeBytes</span><span class="op" id="1337376">[</span><span class="num" id="1337377">0</span><span class="op" id="1337378">:</span><span class="ident" id="1337379">n</span><span class="op" id="1337380">]</span><span class="op" id="1337381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337384">return</span>&nbsp;<span class="ident" id="1337391">n</span><span class="op" id="1337392">,</span>&nbsp;<span class="ident" id="1337394">nil</span><br>
<span class="lineno">245</span><span class="op" id="1337398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1337401">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;next&nbsp;len(p)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer&nbsp;or&nbsp;until&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="1337473">//&nbsp;is&nbsp;drained.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1337545">//&nbsp;buffer&nbsp;has&nbsp;no&nbsp;data&nbsp;to&nbsp;return,&nbsp;err&nbsp;is&nbsp;io.EOF&nbsp;(unless&nbsp;len(p)&nbsp;is&nbsp;zero);</span><br>
<span class="lineno">250</span><span class="comment" id="1337617">//&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="1337641">func</span>&nbsp;<span class="op" id="1337646">(</span><span class="ident" id="1337647">b</span>&nbsp;<span class="op" id="1337649">*</span><span class="ident" id="1337650">Buffer</span><span class="op" id="1337656">)</span>&nbsp;<span class="ident" id="1337658">Read</span><span class="op" id="1337662">(</span><span class="ident" id="1337663">p</span>&nbsp;<span class="op" id="1337665">[</span><span class="op" id="1337666">]</span><span class="builtintype" id="1337667">byte</span><span class="op" id="1337671">)</span>&nbsp;<span class="op" id="1337673">(</span><span class="ident" id="1337674">n</span>&nbsp;<span class="builtintype" id="1337676">int</span><span class="op" id="1337679">,</span>&nbsp;<span class="ident" id="1337681">err</span>&nbsp;<span class="builtintype" id="1337685">error</span><span class="op" id="1337690">)</span>&nbsp;<span class="op" id="1337692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337695">b</span><span class="op" id="1337696">.</span><span class="ident" id="1337697">lastRead</span>&nbsp;<span class="op" id="1337706">=</span>&nbsp;<span class="ident" id="1337708">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337719">if</span>&nbsp;<span class="ident" id="1337722">b</span><span class="op" id="1337723">.</span><span class="ident" id="1337724">off</span>&nbsp;<span class="op" id="1337728">&gt;=</span>&nbsp;<span class="builtinfunc" id="1337731">len</span><span class="op" id="1337734">(</span><span class="ident" id="1337735">b</span><span class="op" id="1337736">.</span><span class="ident" id="1337737">buf</span><span class="op" id="1337740">)</span>&nbsp;<span class="op" id="1337742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1337746">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337792">b</span><span class="op" id="1337793">.</span><span class="ident" id="1337794">Truncate</span><span class="op" id="1337802">(</span><span class="num" id="1337803">0</span><span class="op" id="1337804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337808">if</span>&nbsp;<span class="builtinfunc" id="1337811">len</span><span class="op" id="1337814">(</span><span class="ident" id="1337815">p</span><span class="op" id="1337816">)</span>&nbsp;<span class="op" id="1337818">==</span>&nbsp;<span class="num" id="1337821">0</span>&nbsp;<span class="op" id="1337823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337828">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337841">return</span>&nbsp;<span class="num" id="1337848">0</span><span class="op" id="1337849">,</span>&nbsp;<span class="ident" id="1337851">io</span><span class="op" id="1337853">.</span><span class="ident" id="1337854">EOF</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337862">n</span>&nbsp;<span class="op" id="1337864">=</span>&nbsp;<span class="builtinfunc" id="1337866">copy</span><span class="op" id="1337870">(</span><span class="ident" id="1337871">p</span><span class="op" id="1337872">,</span>&nbsp;<span class="ident" id="1337874">b</span><span class="op" id="1337875">.</span><span class="ident" id="1337876">buf</span><span class="op" id="1337879">[</span><span class="ident" id="1337880">b</span><span class="op" id="1337881">.</span><span class="ident" id="1337882">off</span><span class="op" id="1337885">:</span><span class="op" id="1337886">]</span><span class="op" id="1337887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337890">b</span><span class="op" id="1337891">.</span><span class="ident" id="1337892">off</span>&nbsp;<span class="op" id="1337896">+=</span>&nbsp;<span class="ident" id="1337899">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337902">if</span>&nbsp;<span class="ident" id="1337905">n</span>&nbsp;<span class="op" id="1337907">&gt;</span>&nbsp;<span class="num" id="1337909">0</span>&nbsp;<span class="op" id="1337911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337915">b</span><span class="op" id="1337916">.</span><span class="ident" id="1337917">lastRead</span>&nbsp;<span class="op" id="1337926">=</span>&nbsp;<span class="ident" id="1337928">opRead</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337939">return</span><br>
<span class="lineno"></span><span class="op" id="1337946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1337949">//&nbsp;Next&nbsp;returns&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer,</span><br>
<span class="lineno">270</span><span class="comment" id="1338018">//&nbsp;advancing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;if&nbsp;the&nbsp;bytes&nbsp;had&nbsp;been&nbsp;returned&nbsp;by&nbsp;Read.</span><br>
<span class="lineno"></span><span class="comment" id="1338085">//&nbsp;If&nbsp;there&nbsp;are&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;Next&nbsp;returns&nbsp;the&nbsp;entire&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1338167">//&nbsp;The&nbsp;slice&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;read&nbsp;or&nbsp;write&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="1338241">func</span>&nbsp;<span class="op" id="1338246">(</span><span class="ident" id="1338247">b</span>&nbsp;<span class="op" id="1338249">*</span><span class="ident" id="1338250">Buffer</span><span class="op" id="1338256">)</span>&nbsp;<span class="ident" id="1338258">Next</span><span class="op" id="1338262">(</span><span class="ident" id="1338263">n</span>&nbsp;<span class="builtintype" id="1338265">int</span><span class="op" id="1338268">)</span>&nbsp;<span class="op" id="1338270">[</span><span class="op" id="1338271">]</span><span class="builtintype" id="1338272">byte</span>&nbsp;<span class="op" id="1338277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338280">b</span><span class="op" id="1338281">.</span><span class="ident" id="1338282">lastRead</span>&nbsp;<span class="op" id="1338291">=</span>&nbsp;<span class="ident" id="1338293">opInvalid</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338304">m</span>&nbsp;<span class="op" id="1338306">:=</span>&nbsp;<span class="ident" id="1338309">b</span><span class="op" id="1338310">.</span><span class="ident" id="1338311">Len</span><span class="op" id="1338314">(</span><span class="op" id="1338315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338318">if</span>&nbsp;<span class="ident" id="1338321">n</span>&nbsp;<span class="op" id="1338323">&gt;</span>&nbsp;<span class="ident" id="1338325">m</span>&nbsp;<span class="op" id="1338327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338331">n</span>&nbsp;<span class="op" id="1338333">=</span>&nbsp;<span class="ident" id="1338335">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1338338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338341">data</span>&nbsp;<span class="op" id="1338346">:=</span>&nbsp;<span class="ident" id="1338349">b</span><span class="op" id="1338350">.</span><span class="ident" id="1338351">buf</span><span class="op" id="1338354">[</span><span class="ident" id="1338355">b</span><span class="op" id="1338356">.</span><span class="ident" id="1338357">off</span>&nbsp;<span class="op" id="1338361">:</span>&nbsp;<span class="ident" id="1338363">b</span><span class="op" id="1338364">.</span><span class="ident" id="1338365">off</span><span class="op" id="1338368">+</span><span class="ident" id="1338369">n</span><span class="op" id="1338370">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338373">b</span><span class="op" id="1338374">.</span><span class="ident" id="1338375">off</span>&nbsp;<span class="op" id="1338379">+=</span>&nbsp;<span class="ident" id="1338382">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338385">if</span>&nbsp;<span class="ident" id="1338388">n</span>&nbsp;<span class="op" id="1338390">&gt;</span>&nbsp;<span class="num" id="1338392">0</span>&nbsp;<span class="op" id="1338394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338398">b</span><span class="op" id="1338399">.</span><span class="ident" id="1338400">lastRead</span>&nbsp;<span class="op" id="1338409">=</span>&nbsp;<span class="ident" id="1338411">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1338419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338422">return</span>&nbsp;<span class="ident" id="1338429">data</span><br>
<span class="lineno">285</span><span class="op" id="1338434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1338437">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1338498">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;it&nbsp;returns&nbsp;error&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1338551">func</span>&nbsp;<span class="op" id="1338556">(</span><span class="ident" id="1338557">b</span>&nbsp;<span class="op" id="1338559">*</span><span class="ident" id="1338560">Buffer</span><span class="op" id="1338566">)</span>&nbsp;<span class="ident" id="1338568">ReadByte</span><span class="op" id="1338576">(</span><span class="op" id="1338577">)</span>&nbsp;<span class="op" id="1338579">(</span><span class="ident" id="1338580">c</span>&nbsp;<span class="builtintype" id="1338582">byte</span><span class="op" id="1338586">,</span>&nbsp;<span class="ident" id="1338588">err</span>&nbsp;<span class="builtintype" id="1338592">error</span><span class="op" id="1338597">)</span>&nbsp;<span class="op" id="1338599">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338602">b</span><span class="op" id="1338603">.</span><span class="ident" id="1338604">lastRead</span>&nbsp;<span class="op" id="1338613">=</span>&nbsp;<span class="ident" id="1338615">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338626">if</span>&nbsp;<span class="ident" id="1338629">b</span><span class="op" id="1338630">.</span><span class="ident" id="1338631">off</span>&nbsp;<span class="op" id="1338635">&gt;=</span>&nbsp;<span class="builtinfunc" id="1338638">len</span><span class="op" id="1338641">(</span><span class="ident" id="1338642">b</span><span class="op" id="1338643">.</span><span class="ident" id="1338644">buf</span><span class="op" id="1338647">)</span>&nbsp;<span class="op" id="1338649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1338653">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338699">b</span><span class="op" id="1338700">.</span><span class="ident" id="1338701">Truncate</span><span class="op" id="1338709">(</span><span class="num" id="1338710">0</span><span class="op" id="1338711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338715">return</span>&nbsp;<span class="num" id="1338722">0</span><span class="op" id="1338723">,</span>&nbsp;<span class="ident" id="1338725">io</span><span class="op" id="1338727">.</span><span class="ident" id="1338728">EOF</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1338733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338736">c</span>&nbsp;<span class="op" id="1338738">=</span>&nbsp;<span class="ident" id="1338740">b</span><span class="op" id="1338741">.</span><span class="ident" id="1338742">buf</span><span class="op" id="1338745">[</span><span class="ident" id="1338746">b</span><span class="op" id="1338747">.</span><span class="ident" id="1338748">off</span><span class="op" id="1338751">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338754">b</span><span class="op" id="1338755">.</span><span class="ident" id="1338756">off</span><span class="op" id="1338759">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338763">b</span><span class="op" id="1338764">.</span><span class="ident" id="1338765">lastRead</span>&nbsp;<span class="op" id="1338774">=</span>&nbsp;<span class="ident" id="1338776">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338784">return</span>&nbsp;<span class="ident" id="1338791">c</span><span class="op" id="1338792">,</span>&nbsp;<span class="ident" id="1338794">nil</span><br>
<span class="lineno">300</span><span class="op" id="1338798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1338801">//&nbsp;ReadRune&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;UTF-8-encoded</span><br>
<span class="lineno"></span><span class="comment" id="1338854">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1338893">//&nbsp;If&nbsp;no&nbsp;bytes&nbsp;are&nbsp;available,&nbsp;the&nbsp;error&nbsp;returned&nbsp;is&nbsp;io.EOF.</span><br>
<span class="lineno">305</span><span class="comment" id="1338953">//&nbsp;If&nbsp;the&nbsp;bytes&nbsp;are&nbsp;an&nbsp;erroneous&nbsp;UTF-8&nbsp;encoding,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1339005">//&nbsp;consumes&nbsp;one&nbsp;byte&nbsp;and&nbsp;returns&nbsp;U+FFFD,&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="1339049">func</span>&nbsp;<span class="op" id="1339054">(</span><span class="ident" id="1339055">b</span>&nbsp;<span class="op" id="1339057">*</span><span class="ident" id="1339058">Buffer</span><span class="op" id="1339064">)</span>&nbsp;<span class="ident" id="1339066">ReadRune</span><span class="op" id="1339074">(</span><span class="op" id="1339075">)</span>&nbsp;<span class="op" id="1339077">(</span><span class="ident" id="1339078">r</span>&nbsp;<span class="builtintype" id="1339080">rune</span><span class="op" id="1339084">,</span>&nbsp;<span class="ident" id="1339086">size</span>&nbsp;<span class="builtintype" id="1339091">int</span><span class="op" id="1339094">,</span>&nbsp;<span class="ident" id="1339096">err</span>&nbsp;<span class="builtintype" id="1339100">error</span><span class="op" id="1339105">)</span>&nbsp;<span class="op" id="1339107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339110">b</span><span class="op" id="1339111">.</span><span class="ident" id="1339112">lastRead</span>&nbsp;<span class="op" id="1339121">=</span>&nbsp;<span class="ident" id="1339123">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339134">if</span>&nbsp;<span class="ident" id="1339137">b</span><span class="op" id="1339138">.</span><span class="ident" id="1339139">off</span>&nbsp;<span class="op" id="1339143">&gt;=</span>&nbsp;<span class="builtinfunc" id="1339146">len</span><span class="op" id="1339149">(</span><span class="ident" id="1339150">b</span><span class="op" id="1339151">.</span><span class="ident" id="1339152">buf</span><span class="op" id="1339155">)</span>&nbsp;<span class="op" id="1339157">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1339161">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339207">b</span><span class="op" id="1339208">.</span><span class="ident" id="1339209">Truncate</span><span class="op" id="1339217">(</span><span class="num" id="1339218">0</span><span class="op" id="1339219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339223">return</span>&nbsp;<span class="num" id="1339230">0</span><span class="op" id="1339231">,</span>&nbsp;<span class="num" id="1339233">0</span><span class="op" id="1339234">,</span>&nbsp;<span class="ident" id="1339236">io</span><span class="op" id="1339238">.</span><span class="ident" id="1339239">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339247">b</span><span class="op" id="1339248">.</span><span class="ident" id="1339249">lastRead</span>&nbsp;<span class="op" id="1339258">=</span>&nbsp;<span class="ident" id="1339260">opReadRune</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339272">c</span>&nbsp;<span class="op" id="1339274">:=</span>&nbsp;<span class="ident" id="1339277">b</span><span class="op" id="1339278">.</span><span class="ident" id="1339279">buf</span><span class="op" id="1339282">[</span><span class="ident" id="1339283">b</span><span class="op" id="1339284">.</span><span class="ident" id="1339285">off</span><span class="op" id="1339288">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339291">if</span>&nbsp;<span class="ident" id="1339294">c</span>&nbsp;<span class="op" id="1339296">&lt;</span>&nbsp;<span class="ident" id="1339298">utf8</span><span class="op" id="1339302">.</span><span class="ident" id="1339303">RuneSelf</span>&nbsp;<span class="op" id="1339312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339316">b</span><span class="op" id="1339317">.</span><span class="ident" id="1339318">off</span><span class="op" id="1339321">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339326">return</span>&nbsp;<span class="builtintype" id="1339333">rune</span><span class="op" id="1339337">(</span><span class="ident" id="1339338">c</span><span class="op" id="1339339">)</span><span class="op" id="1339340">,</span>&nbsp;<span class="num" id="1339342">1</span><span class="op" id="1339343">,</span>&nbsp;<span class="ident" id="1339345">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339350">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339353">r</span><span class="op" id="1339354">,</span>&nbsp;<span class="ident" id="1339356">n</span>&nbsp;<span class="op" id="1339358">:=</span>&nbsp;<span class="ident" id="1339361">utf8</span><span class="op" id="1339365">.</span><span class="ident" id="1339366">DecodeRune</span><span class="op" id="1339376">(</span><span class="ident" id="1339377">b</span><span class="op" id="1339378">.</span><span class="ident" id="1339379">buf</span><span class="op" id="1339382">[</span><span class="ident" id="1339383">b</span><span class="op" id="1339384">.</span><span class="ident" id="1339385">off</span><span class="op" id="1339388">:</span><span class="op" id="1339389">]</span><span class="op" id="1339390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339393">b</span><span class="op" id="1339394">.</span><span class="ident" id="1339395">off</span>&nbsp;<span class="op" id="1339399">+=</span>&nbsp;<span class="ident" id="1339402">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339405">return</span>&nbsp;<span class="ident" id="1339412">r</span><span class="op" id="1339413">,</span>&nbsp;<span class="ident" id="1339415">n</span><span class="op" id="1339416">,</span>&nbsp;<span class="ident" id="1339418">nil</span><br>
<span class="lineno"></span><span class="op" id="1339422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="comment" id="1339425">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune&nbsp;returned&nbsp;by&nbsp;ReadRune.</span><br>
<span class="lineno"></span><span class="comment" id="1339483">//&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;or&nbsp;write&nbsp;operation&nbsp;on&nbsp;the&nbsp;buffer&nbsp;was</span><br>
<span class="lineno"></span><span class="comment" id="1339547">//&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this&nbsp;regard</span><br>
<span class="lineno"></span><span class="comment" id="1339612">//&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="1339679">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno">330</span><span class="keyword" id="1339708">func</span>&nbsp;<span class="op" id="1339713">(</span><span class="ident" id="1339714">b</span>&nbsp;<span class="op" id="1339716">*</span><span class="ident" id="1339717">Buffer</span><span class="op" id="1339723">)</span>&nbsp;<span class="ident" id="1339725">UnreadRune</span><span class="op" id="1339735">(</span><span class="op" id="1339736">)</span>&nbsp;<span class="builtintype" id="1339738">error</span>&nbsp;<span class="op" id="1339744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339747">if</span>&nbsp;<span class="ident" id="1339750">b</span><span class="op" id="1339751">.</span><span class="ident" id="1339752">lastRead</span>&nbsp;<span class="op" id="1339761">!=</span>&nbsp;<span class="ident" id="1339764">opReadRune</span>&nbsp;<span class="op" id="1339775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339779">return</span>&nbsp;<span class="ident" id="1339786">errors</span><span class="op" id="1339792">.</span><span class="ident" id="1339793">New</span><span class="op" id="1339796">(</span><span class="string" id="1339797">&#34;bytes.Buffer:&nbsp;UnreadRune:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;ReadRune&#34;</span><span class="op" id="1339860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339866">b</span><span class="op" id="1339867">.</span><span class="ident" id="1339868">lastRead</span>&nbsp;<span class="op" id="1339877">=</span>&nbsp;<span class="ident" id="1339879">opInvalid</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339890">if</span>&nbsp;<span class="ident" id="1339893">b</span><span class="op" id="1339894">.</span><span class="ident" id="1339895">off</span>&nbsp;<span class="op" id="1339899">&gt;</span>&nbsp;<span class="num" id="1339901">0</span>&nbsp;<span class="op" id="1339903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339907">_</span><span class="op" id="1339908">,</span>&nbsp;<span class="ident" id="1339910">n</span>&nbsp;<span class="op" id="1339912">:=</span>&nbsp;<span class="ident" id="1339915">utf8</span><span class="op" id="1339919">.</span><span class="ident" id="1339920">DecodeLastRune</span><span class="op" id="1339934">(</span><span class="ident" id="1339935">b</span><span class="op" id="1339936">.</span><span class="ident" id="1339937">buf</span><span class="op" id="1339940">[</span><span class="num" id="1339941">0</span><span class="op" id="1339942">:</span><span class="ident" id="1339943">b</span><span class="op" id="1339944">.</span><span class="ident" id="1339945">off</span><span class="op" id="1339948">]</span><span class="op" id="1339949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339953">b</span><span class="op" id="1339954">.</span><span class="ident" id="1339955">off</span>&nbsp;<span class="op" id="1339959">-=</span>&nbsp;<span class="ident" id="1339962">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339968">return</span>&nbsp;<span class="ident" id="1339975">nil</span><br>
<span class="lineno">340</span><span class="op" id="1339979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1339982">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte&nbsp;returned&nbsp;by&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span><span class="comment" id="1340046">//&nbsp;read&nbsp;operation.&nbsp;&nbsp;If&nbsp;write&nbsp;has&nbsp;happened&nbsp;since&nbsp;the&nbsp;last&nbsp;read,&nbsp;UnreadByte</span><br>
<span class="lineno"></span><span class="comment" id="1340120">//&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">345</span><span class="keyword" id="1340141">func</span>&nbsp;<span class="op" id="1340146">(</span><span class="ident" id="1340147">b</span>&nbsp;<span class="op" id="1340149">*</span><span class="ident" id="1340150">Buffer</span><span class="op" id="1340156">)</span>&nbsp;<span class="ident" id="1340158">UnreadByte</span><span class="op" id="1340168">(</span><span class="op" id="1340169">)</span>&nbsp;<span class="builtintype" id="1340171">error</span>&nbsp;<span class="op" id="1340177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340180">if</span>&nbsp;<span class="ident" id="1340183">b</span><span class="op" id="1340184">.</span><span class="ident" id="1340185">lastRead</span>&nbsp;<span class="op" id="1340194">!=</span>&nbsp;<span class="ident" id="1340197">opReadRune</span>&nbsp;<span class="op" id="1340208">&amp;&amp;</span>&nbsp;<span class="ident" id="1340211">b</span><span class="op" id="1340212">.</span><span class="ident" id="1340213">lastRead</span>&nbsp;<span class="op" id="1340222">!=</span>&nbsp;<span class="ident" id="1340225">opRead</span>&nbsp;<span class="op" id="1340232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340236">return</span>&nbsp;<span class="ident" id="1340243">errors</span><span class="op" id="1340249">.</span><span class="ident" id="1340250">New</span><span class="op" id="1340253">(</span><span class="string" id="1340254">&#34;bytes.Buffer:&nbsp;UnreadByte:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;a&nbsp;read&#34;</span><span class="op" id="1340315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340321">b</span><span class="op" id="1340322">.</span><span class="ident" id="1340323">lastRead</span>&nbsp;<span class="op" id="1340332">=</span>&nbsp;<span class="ident" id="1340334">opInvalid</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340345">if</span>&nbsp;<span class="ident" id="1340348">b</span><span class="op" id="1340349">.</span><span class="ident" id="1340350">off</span>&nbsp;<span class="op" id="1340354">&gt;</span>&nbsp;<span class="num" id="1340356">0</span>&nbsp;<span class="op" id="1340358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340362">b</span><span class="op" id="1340363">.</span><span class="ident" id="1340364">off</span><span class="op" id="1340367">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340374">return</span>&nbsp;<span class="ident" id="1340381">nil</span><br>
<span class="lineno"></span><span class="op" id="1340385">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="1340388">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="1340457">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="1340533">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1340597">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">360</span><span class="comment" id="1340679">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1340760">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="keyword" id="1340770">func</span>&nbsp;<span class="op" id="1340775">(</span><span class="ident" id="1340776">b</span>&nbsp;<span class="op" id="1340778">*</span><span class="ident" id="1340779">Buffer</span><span class="op" id="1340785">)</span>&nbsp;<span class="ident" id="1340787">ReadBytes</span><span class="op" id="1340796">(</span><span class="ident" id="1340797">delim</span>&nbsp;<span class="builtintype" id="1340803">byte</span><span class="op" id="1340807">)</span>&nbsp;<span class="op" id="1340809">(</span><span class="ident" id="1340810">line</span>&nbsp;<span class="op" id="1340815">[</span><span class="op" id="1340816">]</span><span class="builtintype" id="1340817">byte</span><span class="op" id="1340821">,</span>&nbsp;<span class="ident" id="1340823">err</span>&nbsp;<span class="builtintype" id="1340827">error</span><span class="op" id="1340832">)</span>&nbsp;<span class="op" id="1340834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340837">slice</span><span class="op" id="1340842">,</span>&nbsp;<span class="ident" id="1340844">err</span>&nbsp;<span class="op" id="1340848">:=</span>&nbsp;<span class="ident" id="1340851">b</span><span class="op" id="1340852">.</span><span class="ident" id="1340853">readSlice</span><span class="op" id="1340862">(</span><span class="ident" id="1340863">delim</span><span class="op" id="1340868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1340871">//&nbsp;return&nbsp;a&nbsp;copy&nbsp;of&nbsp;slice.&nbsp;The&nbsp;buffer&#39;s&nbsp;backing&nbsp;array&nbsp;may</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1340930">//&nbsp;be&nbsp;overwritten&nbsp;by&nbsp;later&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340965">line</span>&nbsp;<span class="op" id="1340970">=</span>&nbsp;<span class="builtinfunc" id="1340972">append</span><span class="op" id="1340978">(</span><span class="ident" id="1340979">line</span><span class="op" id="1340983">,</span>&nbsp;<span class="ident" id="1340985">slice</span><span class="op" id="1340990">...</span><span class="op" id="1340993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340996">return</span><br>
<span class="lineno"></span><span class="op" id="1341003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="comment" id="1341006">//&nbsp;readSlice&nbsp;is&nbsp;like&nbsp;ReadBytes&nbsp;but&nbsp;returns&nbsp;a&nbsp;reference&nbsp;to&nbsp;internal&nbsp;buffer&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="1341086">func</span>&nbsp;<span class="op" id="1341091">(</span><span class="ident" id="1341092">b</span>&nbsp;<span class="op" id="1341094">*</span><span class="ident" id="1341095">Buffer</span><span class="op" id="1341101">)</span>&nbsp;<span class="ident" id="1341103">readSlice</span><span class="op" id="1341112">(</span><span class="ident" id="1341113">delim</span>&nbsp;<span class="builtintype" id="1341119">byte</span><span class="op" id="1341123">)</span>&nbsp;<span class="op" id="1341125">(</span><span class="ident" id="1341126">line</span>&nbsp;<span class="op" id="1341131">[</span><span class="op" id="1341132">]</span><span class="builtintype" id="1341133">byte</span><span class="op" id="1341137">,</span>&nbsp;<span class="ident" id="1341139">err</span>&nbsp;<span class="builtintype" id="1341143">error</span><span class="op" id="1341148">)</span>&nbsp;<span class="op" id="1341150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341153">i</span>&nbsp;<span class="op" id="1341155">:=</span>&nbsp;<span class="ident" id="1341158">IndexByte</span><span class="op" id="1341167">(</span><span class="ident" id="1341168">b</span><span class="op" id="1341169">.</span><span class="ident" id="1341170">buf</span><span class="op" id="1341173">[</span><span class="ident" id="1341174">b</span><span class="op" id="1341175">.</span><span class="ident" id="1341176">off</span><span class="op" id="1341179">:</span><span class="op" id="1341180">]</span><span class="op" id="1341181">,</span>&nbsp;<span class="ident" id="1341183">delim</span><span class="op" id="1341188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341191">end</span>&nbsp;<span class="op" id="1341195">:=</span>&nbsp;<span class="ident" id="1341198">b</span><span class="op" id="1341199">.</span><span class="ident" id="1341200">off</span>&nbsp;<span class="op" id="1341204">+</span>&nbsp;<span class="ident" id="1341206">i</span>&nbsp;<span class="op" id="1341208">+</span>&nbsp;<span class="num" id="1341210">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341213">if</span>&nbsp;<span class="ident" id="1341216">i</span>&nbsp;<span class="op" id="1341218">&lt;</span>&nbsp;<span class="num" id="1341220">0</span>&nbsp;<span class="op" id="1341222">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341226">end</span>&nbsp;<span class="op" id="1341230">=</span>&nbsp;<span class="builtinfunc" id="1341232">len</span><span class="op" id="1341235">(</span><span class="ident" id="1341236">b</span><span class="op" id="1341237">.</span><span class="ident" id="1341238">buf</span><span class="op" id="1341241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341245">err</span>&nbsp;<span class="op" id="1341249">=</span>&nbsp;<span class="ident" id="1341251">io</span><span class="op" id="1341253">.</span><span class="ident" id="1341254">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341262">line</span>&nbsp;<span class="op" id="1341267">=</span>&nbsp;<span class="ident" id="1341269">b</span><span class="op" id="1341270">.</span><span class="ident" id="1341271">buf</span><span class="op" id="1341274">[</span><span class="ident" id="1341275">b</span><span class="op" id="1341276">.</span><span class="ident" id="1341277">off</span><span class="op" id="1341280">:</span><span class="ident" id="1341281">end</span><span class="op" id="1341284">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341287">b</span><span class="op" id="1341288">.</span><span class="ident" id="1341289">off</span>&nbsp;<span class="op" id="1341293">=</span>&nbsp;<span class="ident" id="1341295">end</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341300">b</span><span class="op" id="1341301">.</span><span class="ident" id="1341302">lastRead</span>&nbsp;<span class="op" id="1341311">=</span>&nbsp;<span class="ident" id="1341313">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341321">return</span>&nbsp;<span class="ident" id="1341328">line</span><span class="op" id="1341332">,</span>&nbsp;<span class="ident" id="1341334">err</span><br>
<span class="lineno"></span><span class="op" id="1341338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1341341">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno">385</span><span class="comment" id="1341411">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="1341488">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1341553">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="1341635">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="1341714">//&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">390</span><span class="keyword" id="1341727">func</span>&nbsp;<span class="op" id="1341732">(</span><span class="ident" id="1341733">b</span>&nbsp;<span class="op" id="1341735">*</span><span class="ident" id="1341736">Buffer</span><span class="op" id="1341742">)</span>&nbsp;<span class="ident" id="1341744">ReadString</span><span class="op" id="1341754">(</span><span class="ident" id="1341755">delim</span>&nbsp;<span class="builtintype" id="1341761">byte</span><span class="op" id="1341765">)</span>&nbsp;<span class="op" id="1341767">(</span><span class="ident" id="1341768">line</span>&nbsp;<span class="builtintype" id="1341773">string</span><span class="op" id="1341779">,</span>&nbsp;<span class="ident" id="1341781">err</span>&nbsp;<span class="builtintype" id="1341785">error</span><span class="op" id="1341790">)</span>&nbsp;<span class="op" id="1341792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341795">slice</span><span class="op" id="1341800">,</span>&nbsp;<span class="ident" id="1341802">err</span>&nbsp;<span class="op" id="1341806">:=</span>&nbsp;<span class="ident" id="1341809">b</span><span class="op" id="1341810">.</span><span class="ident" id="1341811">readSlice</span><span class="op" id="1341820">(</span><span class="ident" id="1341821">delim</span><span class="op" id="1341826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341829">return</span>&nbsp;<span class="builtintype" id="1341836">string</span><span class="op" id="1341842">(</span><span class="ident" id="1341843">slice</span><span class="op" id="1341848">)</span><span class="op" id="1341849">,</span>&nbsp;<span class="ident" id="1341851">err</span><br>
<span class="lineno"></span><span class="op" id="1341855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span><span class="comment" id="1341858">//&nbsp;NewBuffer&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;buf&nbsp;as&nbsp;its&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="1341933">//&nbsp;contents.&nbsp;&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;Buffer&nbsp;to&nbsp;read&nbsp;existing&nbsp;data.&nbsp;&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="1342009">//&nbsp;can&nbsp;also&nbsp;be&nbsp;used&nbsp;to&nbsp;size&nbsp;the&nbsp;internal&nbsp;buffer&nbsp;for&nbsp;writing.&nbsp;To&nbsp;do&nbsp;that,</span><br>
<span class="lineno"></span><span class="comment" id="1342082">//&nbsp;buf&nbsp;should&nbsp;have&nbsp;the&nbsp;desired&nbsp;capacity&nbsp;but&nbsp;a&nbsp;length&nbsp;of&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="1342144">//</span><br>
<span class="lineno">400</span><span class="comment" id="1342147">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1342218">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1342256">func</span>&nbsp;<span class="ident" id="1342261">NewBuffer</span><span class="op" id="1342270">(</span><span class="ident" id="1342271">buf</span>&nbsp;<span class="op" id="1342275">[</span><span class="op" id="1342276">]</span><span class="builtintype" id="1342277">byte</span><span class="op" id="1342281">)</span>&nbsp;<span class="op" id="1342283">*</span><span class="ident" id="1342284">Buffer</span>&nbsp;<span class="op" id="1342291">{</span>&nbsp;<span class="keyword" id="1342293">return</span>&nbsp;<span class="op" id="1342300">&amp;</span><span class="ident" id="1342301">Buffer</span><span class="op" id="1342307">{</span><span class="ident" id="1342308">buf</span><span class="op" id="1342311">:</span>&nbsp;<span class="ident" id="1342313">buf</span><span class="op" id="1342316">}</span>&nbsp;<span class="op" id="1342318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1342321">//&nbsp;NewBufferString&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;string&nbsp;s&nbsp;as&nbsp;its</span><br>
<span class="lineno">405</span><span class="comment" id="1342399">//&nbsp;initial&nbsp;contents.&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;buffer&nbsp;to&nbsp;read&nbsp;an&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="1342475">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="1342486">//</span><br>
<span class="lineno"></span><span class="comment" id="1342489">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1342560">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno">410</span><span class="keyword" id="1342598">func</span>&nbsp;<span class="ident" id="1342603">NewBufferString</span><span class="op" id="1342618">(</span><span class="ident" id="1342619">s</span>&nbsp;<span class="builtintype" id="1342621">string</span><span class="op" id="1342627">)</span>&nbsp;<span class="op" id="1342629">*</span><span class="ident" id="1342630">Buffer</span>&nbsp;<span class="op" id="1342637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1342640">return</span>&nbsp;<span class="op" id="1342647">&amp;</span><span class="ident" id="1342648">Buffer</span><span class="op" id="1342654">{</span><span class="ident" id="1342655">buf</span><span class="op" id="1342658">:</span>&nbsp;<span class="op" id="1342660">[</span><span class="op" id="1342661">]</span><span class="builtintype" id="1342662">byte</span><span class="op" id="1342666">(</span><span class="ident" id="1342667">s</span><span class="op" id="1342668">)</span><span class="op" id="1342669">}</span><br>
<span class="lineno"></span><span class="op" id="1342671">}</span>
</div>
</body>
</html>
