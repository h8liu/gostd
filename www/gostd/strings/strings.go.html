<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2816867">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2816922">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2816976">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2817027">//&nbsp;Package&nbsp;strings&nbsp;implements&nbsp;simple&nbsp;functions&nbsp;to&nbsp;manipulate&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="2817097">package</span>&nbsp;<span class="ident" id="2817105">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2817114">import</span>&nbsp;<span class="op" id="2817121">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2817124">&#34;unicode&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2817135">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2817150">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2817153">//&nbsp;explode&nbsp;splits&nbsp;s&nbsp;into&nbsp;an&nbsp;array&nbsp;of&nbsp;UTF-8&nbsp;sequences,&nbsp;one&nbsp;per&nbsp;Unicode&nbsp;character&nbsp;(still&nbsp;strings)&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;n&nbsp;(n&nbsp;&lt;&nbsp;0&nbsp;means&nbsp;no&nbsp;limit).</span><br>
<span class="lineno"></span><span class="comment" id="2817294">//&nbsp;Invalid&nbsp;UTF-8&nbsp;sequences&nbsp;become&nbsp;correct&nbsp;encodings&nbsp;of&nbsp;U+FFF8.</span><br>
<span class="lineno">15</span><span class="keyword" id="2817357">func</span>&nbsp;<span class="ident" id="2817362">explode</span><span class="op" id="2817369">(</span><span class="ident" id="2817370">s</span>&nbsp;<span class="builtintype" id="2817372">string</span><span class="op" id="2817378">,</span>&nbsp;<span class="ident" id="2817380">n</span>&nbsp;<span class="builtintype" id="2817382">int</span><span class="op" id="2817385">)</span>&nbsp;<span class="op" id="2817387">[</span><span class="op" id="2817388">]</span><span class="builtintype" id="2817389">string</span>&nbsp;<span class="op" id="2817396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2817399">if</span>&nbsp;<span class="ident" id="2817402">n</span>&nbsp;<span class="op" id="2817404">==</span>&nbsp;<span class="num" id="2817407">0</span>&nbsp;<span class="op" id="2817409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2817413">return</span>&nbsp;<span class="ident" id="2817420">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2817425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2817428">l</span>&nbsp;<span class="op" id="2817430">:=</span>&nbsp;<span class="ident" id="2817433">utf8</span><span class="op" id="2817437">.</span><span class="ident" id="2817438">RuneCountInString</span><span class="op" id="2817455">(</span><span class="ident" id="2817456">s</span><span class="op" id="2817457">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2817460">if</span>&nbsp;<span class="ident" id="2817463">n</span>&nbsp;<span class="op" id="2817465">&lt;=</span>&nbsp;<span class="num" id="2817468">0</span>&nbsp;<span class="op" id="2817470">||</span>&nbsp;<span class="ident" id="2817473">n</span>&nbsp;<span class="op" id="2817475">&gt;</span>&nbsp;<span class="ident" id="2817477">l</span>&nbsp;<span class="op" id="2817479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2817483">n</span>&nbsp;<span class="op" id="2817485">=</span>&nbsp;<span class="ident" id="2817487">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2817490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2817493">a</span>&nbsp;<span class="op" id="2817495">:=</span>&nbsp;<span class="builtinfunc" id="2817498">make</span><span class="op" id="2817502">(</span><span class="op" id="2817503">[</span><span class="op" id="2817504">]</span><span class="builtintype" id="2817505">string</span><span class="op" id="2817511">,</span>&nbsp;<span class="ident" id="2817513">n</span><span class="op" id="2817514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2817517">var</span>&nbsp;<span class="ident" id="2817521">size</span>&nbsp;<span class="builtintype" id="2817526">int</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2817531">var</span>&nbsp;<span class="ident" id="2817535">ch</span>&nbsp;<span class="builtintype" id="2817538">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2817544">i</span><span class="op" id="2817545">,</span>&nbsp;<span class="ident" id="2817547">cur</span>&nbsp;<span class="op" id="2817551">:=</span>&nbsp;<span class="num" id="2817554">0</span><span class="op" id="2817555">,</span>&nbsp;<span class="num" id="2817557">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2817560">for</span>&nbsp;<span class="op" id="2817564">;</span>&nbsp;<span class="ident" id="2817566">i</span><span class="op" id="2817567">+</span><span class="num" id="2817568">1</span>&nbsp;<span class="op" id="2817570">&lt;</span>&nbsp;<span class="ident" id="2817572">n</span><span class="op" id="2817573">;</span>&nbsp;<span class="ident" id="2817575">i</span><span class="op" id="2817576">++</span>&nbsp;<span class="op" id="2817579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2817583">ch</span><span class="op" id="2817585">,</span>&nbsp;<span class="ident" id="2817587">size</span>&nbsp;<span class="op" id="2817592">=</span>&nbsp;<span class="ident" id="2817594">utf8</span><span class="op" id="2817598">.</span><span class="ident" id="2817599">DecodeRuneInString</span><span class="op" id="2817617">(</span><span class="ident" id="2817618">s</span><span class="op" id="2817619">[</span><span class="ident" id="2817620">cur</span><span class="op" id="2817623">:</span><span class="op" id="2817624">]</span><span class="op" id="2817625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2817629">if</span>&nbsp;<span class="ident" id="2817632">ch</span>&nbsp;<span class="op" id="2817635">==</span>&nbsp;<span class="ident" id="2817638">utf8</span><span class="op" id="2817642">.</span><span class="ident" id="2817643">RuneError</span>&nbsp;<span class="op" id="2817653">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2817658">a</span><span class="op" id="2817659">[</span><span class="ident" id="2817660">i</span><span class="op" id="2817661">]</span>&nbsp;<span class="op" id="2817663">=</span>&nbsp;<span class="builtintype" id="2817665">string</span><span class="op" id="2817671">(</span><span class="ident" id="2817672">utf8</span><span class="op" id="2817676">.</span><span class="ident" id="2817677">RuneError</span><span class="op" id="2817686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2817690">}</span>&nbsp;<span class="keyword" id="2817692">else</span>&nbsp;<span class="op" id="2817697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2817702">a</span><span class="op" id="2817703">[</span><span class="ident" id="2817704">i</span><span class="op" id="2817705">]</span>&nbsp;<span class="op" id="2817707">=</span>&nbsp;<span class="ident" id="2817709">s</span><span class="op" id="2817710">[</span><span class="ident" id="2817711">cur</span>&nbsp;<span class="op" id="2817715">:</span>&nbsp;<span class="ident" id="2817717">cur</span><span class="op" id="2817720">+</span><span class="ident" id="2817721">size</span><span class="op" id="2817725">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2817729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2817733">cur</span>&nbsp;<span class="op" id="2817737">+=</span>&nbsp;<span class="ident" id="2817740">size</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2817746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2817749">//&nbsp;add&nbsp;the&nbsp;rest,&nbsp;if&nbsp;there&nbsp;is&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2817783">if</span>&nbsp;<span class="ident" id="2817786">cur</span>&nbsp;<span class="op" id="2817790">&lt;</span>&nbsp;<span class="builtinfunc" id="2817792">len</span><span class="op" id="2817795">(</span><span class="ident" id="2817796">s</span><span class="op" id="2817797">)</span>&nbsp;<span class="op" id="2817799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2817803">a</span><span class="op" id="2817804">[</span><span class="ident" id="2817805">i</span><span class="op" id="2817806">]</span>&nbsp;<span class="op" id="2817808">=</span>&nbsp;<span class="ident" id="2817810">s</span><span class="op" id="2817811">[</span><span class="ident" id="2817812">cur</span><span class="op" id="2817815">:</span><span class="op" id="2817816">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2817819">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2817822">return</span>&nbsp;<span class="ident" id="2817829">a</span><br>
<span class="lineno"></span><span class="op" id="2817831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2817834">//&nbsp;primeRK&nbsp;is&nbsp;the&nbsp;prime&nbsp;base&nbsp;used&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="2817893">const</span>&nbsp;<span class="ident" id="2817899">primeRK</span>&nbsp;<span class="op" id="2817907">=</span>&nbsp;<span class="num" id="2817909">16777619</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2817919">//&nbsp;hashStr&nbsp;returns&nbsp;the&nbsp;hash&nbsp;and&nbsp;the&nbsp;appropriate&nbsp;multiplicative</span><br>
<span class="lineno"></span><span class="comment" id="2817982">//&nbsp;factor&nbsp;for&nbsp;use&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="2818025">func</span>&nbsp;<span class="ident" id="2818030">hashStr</span><span class="op" id="2818037">(</span><span class="ident" id="2818038">sep</span>&nbsp;<span class="builtintype" id="2818042">string</span><span class="op" id="2818048">)</span>&nbsp;<span class="op" id="2818050">(</span><span class="builtintype" id="2818051">uint32</span><span class="op" id="2818057">,</span>&nbsp;<span class="builtintype" id="2818059">uint32</span><span class="op" id="2818065">)</span>&nbsp;<span class="op" id="2818067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2818070">hash</span>&nbsp;<span class="op" id="2818075">:=</span>&nbsp;<span class="builtintype" id="2818078">uint32</span><span class="op" id="2818084">(</span><span class="num" id="2818085">0</span><span class="op" id="2818086">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2818089">for</span>&nbsp;<span class="ident" id="2818093">i</span>&nbsp;<span class="op" id="2818095">:=</span>&nbsp;<span class="num" id="2818098">0</span><span class="op" id="2818099">;</span>&nbsp;<span class="ident" id="2818101">i</span>&nbsp;<span class="op" id="2818103">&lt;</span>&nbsp;<span class="builtinfunc" id="2818105">len</span><span class="op" id="2818108">(</span><span class="ident" id="2818109">sep</span><span class="op" id="2818112">)</span><span class="op" id="2818113">;</span>&nbsp;<span class="ident" id="2818115">i</span><span class="op" id="2818116">++</span>&nbsp;<span class="op" id="2818119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2818123">hash</span>&nbsp;<span class="op" id="2818128">=</span>&nbsp;<span class="ident" id="2818130">hash</span><span class="op" id="2818134">*</span><span class="ident" id="2818135">primeRK</span>&nbsp;<span class="op" id="2818143">+</span>&nbsp;<span class="builtintype" id="2818145">uint32</span><span class="op" id="2818151">(</span><span class="ident" id="2818152">sep</span><span class="op" id="2818155">[</span><span class="ident" id="2818156">i</span><span class="op" id="2818157">]</span><span class="op" id="2818158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2818161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2818164">var</span>&nbsp;<span class="ident" id="2818168">pow</span><span class="op" id="2818171">,</span>&nbsp;<span class="ident" id="2818173">sq</span>&nbsp;<span class="builtintype" id="2818176">uint32</span>&nbsp;<span class="op" id="2818183">=</span>&nbsp;<span class="num" id="2818185">1</span><span class="op" id="2818186">,</span>&nbsp;<span class="ident" id="2818188">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2818197">for</span>&nbsp;<span class="ident" id="2818201">i</span>&nbsp;<span class="op" id="2818203">:=</span>&nbsp;<span class="builtinfunc" id="2818206">len</span><span class="op" id="2818209">(</span><span class="ident" id="2818210">sep</span><span class="op" id="2818213">)</span><span class="op" id="2818214">;</span>&nbsp;<span class="ident" id="2818216">i</span>&nbsp;<span class="op" id="2818218">&gt;</span>&nbsp;<span class="num" id="2818220">0</span><span class="op" id="2818221">;</span>&nbsp;<span class="ident" id="2818223">i</span>&nbsp;<span class="op" id="2818225">&gt;&gt;=</span>&nbsp;<span class="num" id="2818229">1</span>&nbsp;<span class="op" id="2818231">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2818235">if</span>&nbsp;<span class="ident" id="2818238">i</span><span class="op" id="2818239">&amp;</span><span class="num" id="2818240">1</span>&nbsp;<span class="op" id="2818242">!=</span>&nbsp;<span class="num" id="2818245">0</span>&nbsp;<span class="op" id="2818247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2818252">pow</span>&nbsp;<span class="op" id="2818256">*=</span>&nbsp;<span class="ident" id="2818259">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2818264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2818268">sq</span>&nbsp;<span class="op" id="2818271">*=</span>&nbsp;<span class="ident" id="2818274">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2818278">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2818281">return</span>&nbsp;<span class="ident" id="2818288">hash</span><span class="op" id="2818292">,</span>&nbsp;<span class="ident" id="2818294">pow</span><br>
<span class="lineno"></span><span class="op" id="2818298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2818301">//&nbsp;hashStrRev&nbsp;returns&nbsp;the&nbsp;hash&nbsp;of&nbsp;the&nbsp;reverse&nbsp;of&nbsp;sep&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2818362">//&nbsp;appropriate&nbsp;multiplicative&nbsp;factor&nbsp;for&nbsp;use&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno">65</span><span class="keyword" id="2818432">func</span>&nbsp;<span class="ident" id="2818437">hashStrRev</span><span class="op" id="2818447">(</span><span class="ident" id="2818448">sep</span>&nbsp;<span class="builtintype" id="2818452">string</span><span class="op" id="2818458">)</span>&nbsp;<span class="op" id="2818460">(</span><span class="builtintype" id="2818461">uint32</span><span class="op" id="2818467">,</span>&nbsp;<span class="builtintype" id="2818469">uint32</span><span class="op" id="2818475">)</span>&nbsp;<span class="op" id="2818477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2818480">hash</span>&nbsp;<span class="op" id="2818485">:=</span>&nbsp;<span class="builtintype" id="2818488">uint32</span><span class="op" id="2818494">(</span><span class="num" id="2818495">0</span><span class="op" id="2818496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2818499">for</span>&nbsp;<span class="ident" id="2818503">i</span>&nbsp;<span class="op" id="2818505">:=</span>&nbsp;<span class="builtinfunc" id="2818508">len</span><span class="op" id="2818511">(</span><span class="ident" id="2818512">sep</span><span class="op" id="2818515">)</span>&nbsp;<span class="op" id="2818517">-</span>&nbsp;<span class="num" id="2818519">1</span><span class="op" id="2818520">;</span>&nbsp;<span class="ident" id="2818522">i</span>&nbsp;<span class="op" id="2818524">&gt;=</span>&nbsp;<span class="num" id="2818527">0</span><span class="op" id="2818528">;</span>&nbsp;<span class="ident" id="2818530">i</span><span class="op" id="2818531">--</span>&nbsp;<span class="op" id="2818534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2818538">hash</span>&nbsp;<span class="op" id="2818543">=</span>&nbsp;<span class="ident" id="2818545">hash</span><span class="op" id="2818549">*</span><span class="ident" id="2818550">primeRK</span>&nbsp;<span class="op" id="2818558">+</span>&nbsp;<span class="builtintype" id="2818560">uint32</span><span class="op" id="2818566">(</span><span class="ident" id="2818567">sep</span><span class="op" id="2818570">[</span><span class="ident" id="2818571">i</span><span class="op" id="2818572">]</span><span class="op" id="2818573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2818576">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2818579">var</span>&nbsp;<span class="ident" id="2818583">pow</span><span class="op" id="2818586">,</span>&nbsp;<span class="ident" id="2818588">sq</span>&nbsp;<span class="builtintype" id="2818591">uint32</span>&nbsp;<span class="op" id="2818598">=</span>&nbsp;<span class="num" id="2818600">1</span><span class="op" id="2818601">,</span>&nbsp;<span class="ident" id="2818603">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2818612">for</span>&nbsp;<span class="ident" id="2818616">i</span>&nbsp;<span class="op" id="2818618">:=</span>&nbsp;<span class="builtinfunc" id="2818621">len</span><span class="op" id="2818624">(</span><span class="ident" id="2818625">sep</span><span class="op" id="2818628">)</span><span class="op" id="2818629">;</span>&nbsp;<span class="ident" id="2818631">i</span>&nbsp;<span class="op" id="2818633">&gt;</span>&nbsp;<span class="num" id="2818635">0</span><span class="op" id="2818636">;</span>&nbsp;<span class="ident" id="2818638">i</span>&nbsp;<span class="op" id="2818640">&gt;&gt;=</span>&nbsp;<span class="num" id="2818644">1</span>&nbsp;<span class="op" id="2818646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2818650">if</span>&nbsp;<span class="ident" id="2818653">i</span><span class="op" id="2818654">&amp;</span><span class="num" id="2818655">1</span>&nbsp;<span class="op" id="2818657">!=</span>&nbsp;<span class="num" id="2818660">0</span>&nbsp;<span class="op" id="2818662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2818667">pow</span>&nbsp;<span class="op" id="2818671">*=</span>&nbsp;<span class="ident" id="2818674">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2818679">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2818683">sq</span>&nbsp;<span class="op" id="2818686">*=</span>&nbsp;<span class="ident" id="2818689">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2818693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2818696">return</span>&nbsp;<span class="ident" id="2818703">hash</span><span class="op" id="2818707">,</span>&nbsp;<span class="ident" id="2818709">pow</span><br>
<span class="lineno"></span><span class="op" id="2818713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2818716">//&nbsp;Count&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;sep&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2818785">func</span>&nbsp;<span class="ident" id="2818790">Count</span><span class="op" id="2818795">(</span><span class="ident" id="2818796">s</span><span class="op" id="2818797">,</span>&nbsp;<span class="ident" id="2818799">sep</span>&nbsp;<span class="builtintype" id="2818803">string</span><span class="op" id="2818809">)</span>&nbsp;<span class="builtintype" id="2818811">int</span>&nbsp;<span class="op" id="2818815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2818818">n</span>&nbsp;<span class="op" id="2818820">:=</span>&nbsp;<span class="num" id="2818823">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2818826">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2818844">switch</span>&nbsp;<span class="op" id="2818851">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2818854">case</span>&nbsp;<span class="builtinfunc" id="2818859">len</span><span class="op" id="2818862">(</span><span class="ident" id="2818863">sep</span><span class="op" id="2818866">)</span>&nbsp;<span class="op" id="2818868">==</span>&nbsp;<span class="num" id="2818871">0</span><span class="op" id="2818872">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2818876">return</span>&nbsp;<span class="ident" id="2818883">utf8</span><span class="op" id="2818887">.</span><span class="ident" id="2818888">RuneCountInString</span><span class="op" id="2818905">(</span><span class="ident" id="2818906">s</span><span class="op" id="2818907">)</span>&nbsp;<span class="op" id="2818909">+</span>&nbsp;<span class="num" id="2818911">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2818914">case</span>&nbsp;<span class="builtinfunc" id="2818919">len</span><span class="op" id="2818922">(</span><span class="ident" id="2818923">sep</span><span class="op" id="2818926">)</span>&nbsp;<span class="op" id="2818928">==</span>&nbsp;<span class="num" id="2818931">1</span><span class="op" id="2818932">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2818936">//&nbsp;special&nbsp;case&nbsp;worth&nbsp;making&nbsp;fast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2818972">c</span>&nbsp;<span class="op" id="2818974">:=</span>&nbsp;<span class="ident" id="2818977">sep</span><span class="op" id="2818980">[</span><span class="num" id="2818981">0</span><span class="op" id="2818982">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2818986">for</span>&nbsp;<span class="ident" id="2818990">i</span>&nbsp;<span class="op" id="2818992">:=</span>&nbsp;<span class="num" id="2818995">0</span><span class="op" id="2818996">;</span>&nbsp;<span class="ident" id="2818998">i</span>&nbsp;<span class="op" id="2819000">&lt;</span>&nbsp;<span class="builtinfunc" id="2819002">len</span><span class="op" id="2819005">(</span><span class="ident" id="2819006">s</span><span class="op" id="2819007">)</span><span class="op" id="2819008">;</span>&nbsp;<span class="ident" id="2819010">i</span><span class="op" id="2819011">++</span>&nbsp;<span class="op" id="2819014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2819019">if</span>&nbsp;<span class="ident" id="2819022">s</span><span class="op" id="2819023">[</span><span class="ident" id="2819024">i</span><span class="op" id="2819025">]</span>&nbsp;<span class="op" id="2819027">==</span>&nbsp;<span class="ident" id="2819030">c</span>&nbsp;<span class="op" id="2819032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819038">n</span><span class="op" id="2819039">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2819045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2819049">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2819053">return</span>&nbsp;<span class="ident" id="2819060">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2819063">case</span>&nbsp;<span class="builtinfunc" id="2819068">len</span><span class="op" id="2819071">(</span><span class="ident" id="2819072">sep</span><span class="op" id="2819075">)</span>&nbsp;<span class="op" id="2819077">&gt;</span>&nbsp;<span class="builtinfunc" id="2819079">len</span><span class="op" id="2819082">(</span><span class="ident" id="2819083">s</span><span class="op" id="2819084">)</span><span class="op" id="2819085">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2819089">return</span>&nbsp;<span class="num" id="2819096">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2819099">case</span>&nbsp;<span class="builtinfunc" id="2819104">len</span><span class="op" id="2819107">(</span><span class="ident" id="2819108">sep</span><span class="op" id="2819111">)</span>&nbsp;<span class="op" id="2819113">==</span>&nbsp;<span class="builtinfunc" id="2819116">len</span><span class="op" id="2819119">(</span><span class="ident" id="2819120">s</span><span class="op" id="2819121">)</span><span class="op" id="2819122">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2819126">if</span>&nbsp;<span class="ident" id="2819129">sep</span>&nbsp;<span class="op" id="2819133">==</span>&nbsp;<span class="ident" id="2819136">s</span>&nbsp;<span class="op" id="2819138">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2819143">return</span>&nbsp;<span class="num" id="2819150">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2819154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2819158">return</span>&nbsp;<span class="num" id="2819165">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2819168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2819171">//&nbsp;Rabin-Karp&nbsp;search</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819193">hashsep</span><span class="op" id="2819200">,</span>&nbsp;<span class="ident" id="2819202">pow</span>&nbsp;<span class="op" id="2819206">:=</span>&nbsp;<span class="ident" id="2819209">hashStr</span><span class="op" id="2819216">(</span><span class="ident" id="2819217">sep</span><span class="op" id="2819220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819223">h</span>&nbsp;<span class="op" id="2819225">:=</span>&nbsp;<span class="builtintype" id="2819228">uint32</span><span class="op" id="2819234">(</span><span class="num" id="2819235">0</span><span class="op" id="2819236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2819239">for</span>&nbsp;<span class="ident" id="2819243">i</span>&nbsp;<span class="op" id="2819245">:=</span>&nbsp;<span class="num" id="2819248">0</span><span class="op" id="2819249">;</span>&nbsp;<span class="ident" id="2819251">i</span>&nbsp;<span class="op" id="2819253">&lt;</span>&nbsp;<span class="builtinfunc" id="2819255">len</span><span class="op" id="2819258">(</span><span class="ident" id="2819259">sep</span><span class="op" id="2819262">)</span><span class="op" id="2819263">;</span>&nbsp;<span class="ident" id="2819265">i</span><span class="op" id="2819266">++</span>&nbsp;<span class="op" id="2819269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819273">h</span>&nbsp;<span class="op" id="2819275">=</span>&nbsp;<span class="ident" id="2819277">h</span><span class="op" id="2819278">*</span><span class="ident" id="2819279">primeRK</span>&nbsp;<span class="op" id="2819287">+</span>&nbsp;<span class="builtintype" id="2819289">uint32</span><span class="op" id="2819295">(</span><span class="ident" id="2819296">s</span><span class="op" id="2819297">[</span><span class="ident" id="2819298">i</span><span class="op" id="2819299">]</span><span class="op" id="2819300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2819303">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819306">lastmatch</span>&nbsp;<span class="op" id="2819316">:=</span>&nbsp;<span class="num" id="2819319">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2819322">if</span>&nbsp;<span class="ident" id="2819325">h</span>&nbsp;<span class="op" id="2819327">==</span>&nbsp;<span class="ident" id="2819330">hashsep</span>&nbsp;<span class="op" id="2819338">&amp;&amp;</span>&nbsp;<span class="ident" id="2819341">s</span><span class="op" id="2819342">[</span><span class="op" id="2819343">:</span><span class="builtinfunc" id="2819344">len</span><span class="op" id="2819347">(</span><span class="ident" id="2819348">sep</span><span class="op" id="2819351">)</span><span class="op" id="2819352">]</span>&nbsp;<span class="op" id="2819354">==</span>&nbsp;<span class="ident" id="2819357">sep</span>&nbsp;<span class="op" id="2819361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819365">n</span><span class="op" id="2819366">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819371">lastmatch</span>&nbsp;<span class="op" id="2819381">=</span>&nbsp;<span class="builtinfunc" id="2819383">len</span><span class="op" id="2819386">(</span><span class="ident" id="2819387">sep</span><span class="op" id="2819390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2819393">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2819396">for</span>&nbsp;<span class="ident" id="2819400">i</span>&nbsp;<span class="op" id="2819402">:=</span>&nbsp;<span class="builtinfunc" id="2819405">len</span><span class="op" id="2819408">(</span><span class="ident" id="2819409">sep</span><span class="op" id="2819412">)</span><span class="op" id="2819413">;</span>&nbsp;<span class="ident" id="2819415">i</span>&nbsp;<span class="op" id="2819417">&lt;</span>&nbsp;<span class="builtinfunc" id="2819419">len</span><span class="op" id="2819422">(</span><span class="ident" id="2819423">s</span><span class="op" id="2819424">)</span><span class="op" id="2819425">;</span>&nbsp;<span class="op" id="2819427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819431">h</span>&nbsp;<span class="op" id="2819433">*=</span>&nbsp;<span class="ident" id="2819436">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819446">h</span>&nbsp;<span class="op" id="2819448">+=</span>&nbsp;<span class="builtintype" id="2819451">uint32</span><span class="op" id="2819457">(</span><span class="ident" id="2819458">s</span><span class="op" id="2819459">[</span><span class="ident" id="2819460">i</span><span class="op" id="2819461">]</span><span class="op" id="2819462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819466">h</span>&nbsp;<span class="op" id="2819468">-=</span>&nbsp;<span class="ident" id="2819471">pow</span>&nbsp;<span class="op" id="2819475">*</span>&nbsp;<span class="builtintype" id="2819477">uint32</span><span class="op" id="2819483">(</span><span class="ident" id="2819484">s</span><span class="op" id="2819485">[</span><span class="ident" id="2819486">i</span><span class="op" id="2819487">-</span><span class="builtinfunc" id="2819488">len</span><span class="op" id="2819491">(</span><span class="ident" id="2819492">sep</span><span class="op" id="2819495">)</span><span class="op" id="2819496">]</span><span class="op" id="2819497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819501">i</span><span class="op" id="2819502">++</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2819507">if</span>&nbsp;<span class="ident" id="2819510">h</span>&nbsp;<span class="op" id="2819512">==</span>&nbsp;<span class="ident" id="2819515">hashsep</span>&nbsp;<span class="op" id="2819523">&amp;&amp;</span>&nbsp;<span class="ident" id="2819526">lastmatch</span>&nbsp;<span class="op" id="2819536">&lt;=</span>&nbsp;<span class="ident" id="2819539">i</span><span class="op" id="2819540">-</span><span class="builtinfunc" id="2819541">len</span><span class="op" id="2819544">(</span><span class="ident" id="2819545">sep</span><span class="op" id="2819548">)</span>&nbsp;<span class="op" id="2819550">&amp;&amp;</span>&nbsp;<span class="ident" id="2819553">s</span><span class="op" id="2819554">[</span><span class="ident" id="2819555">i</span><span class="op" id="2819556">-</span><span class="builtinfunc" id="2819557">len</span><span class="op" id="2819560">(</span><span class="ident" id="2819561">sep</span><span class="op" id="2819564">)</span><span class="op" id="2819565">:</span><span class="ident" id="2819566">i</span><span class="op" id="2819567">]</span>&nbsp;<span class="op" id="2819569">==</span>&nbsp;<span class="ident" id="2819572">sep</span>&nbsp;<span class="op" id="2819576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819581">n</span><span class="op" id="2819582">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2819588">lastmatch</span>&nbsp;<span class="op" id="2819598">=</span>&nbsp;<span class="ident" id="2819600">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2819604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2819607">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2819610">return</span>&nbsp;<span class="ident" id="2819617">n</span><br>
<span class="lineno"></span><span class="op" id="2819619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2819622">//&nbsp;Contains&nbsp;returns&nbsp;true&nbsp;if&nbsp;substr&nbsp;is&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2819670">func</span>&nbsp;<span class="ident" id="2819675">Contains</span><span class="op" id="2819683">(</span><span class="ident" id="2819684">s</span><span class="op" id="2819685">,</span>&nbsp;<span class="ident" id="2819687">substr</span>&nbsp;<span class="builtintype" id="2819694">string</span><span class="op" id="2819700">)</span>&nbsp;<span class="builtintype" id="2819702">bool</span>&nbsp;<span class="op" id="2819707">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2819710">return</span>&nbsp;<span class="ident" id="2819717">Index</span><span class="op" id="2819722">(</span><span class="ident" id="2819723">s</span><span class="op" id="2819724">,</span>&nbsp;<span class="ident" id="2819726">substr</span><span class="op" id="2819732">)</span>&nbsp;<span class="op" id="2819734">&gt;=</span>&nbsp;<span class="num" id="2819737">0</span><br>
<span class="lineno"></span><span class="op" id="2819739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2819742">//&nbsp;ContainsAny&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;in&nbsp;chars&nbsp;are&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2819820">func</span>&nbsp;<span class="ident" id="2819825">ContainsAny</span><span class="op" id="2819836">(</span><span class="ident" id="2819837">s</span><span class="op" id="2819838">,</span>&nbsp;<span class="ident" id="2819840">chars</span>&nbsp;<span class="builtintype" id="2819846">string</span><span class="op" id="2819852">)</span>&nbsp;<span class="builtintype" id="2819854">bool</span>&nbsp;<span class="op" id="2819859">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2819862">return</span>&nbsp;<span class="ident" id="2819869">IndexAny</span><span class="op" id="2819877">(</span><span class="ident" id="2819878">s</span><span class="op" id="2819879">,</span>&nbsp;<span class="ident" id="2819881">chars</span><span class="op" id="2819886">)</span>&nbsp;<span class="op" id="2819888">&gt;=</span>&nbsp;<span class="num" id="2819891">0</span><br>
<span class="lineno"></span><span class="op" id="2819893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2819896">//&nbsp;ContainsRune&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;is&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2819966">func</span>&nbsp;<span class="ident" id="2819971">ContainsRune</span><span class="op" id="2819983">(</span><span class="ident" id="2819984">s</span>&nbsp;<span class="builtintype" id="2819986">string</span><span class="op" id="2819992">,</span>&nbsp;<span class="ident" id="2819994">r</span>&nbsp;<span class="builtintype" id="2819996">rune</span><span class="op" id="2820000">)</span>&nbsp;<span class="builtintype" id="2820002">bool</span>&nbsp;<span class="op" id="2820007">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820010">return</span>&nbsp;<span class="ident" id="2820017">IndexRune</span><span class="op" id="2820026">(</span><span class="ident" id="2820027">s</span><span class="op" id="2820028">,</span>&nbsp;<span class="ident" id="2820030">r</span><span class="op" id="2820031">)</span>&nbsp;<span class="op" id="2820033">&gt;=</span>&nbsp;<span class="num" id="2820036">0</span><br>
<span class="lineno"></span><span class="op" id="2820038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2820041">//&nbsp;Index&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2820137">func</span>&nbsp;<span class="ident" id="2820142">Index</span><span class="op" id="2820147">(</span><span class="ident" id="2820148">s</span><span class="op" id="2820149">,</span>&nbsp;<span class="ident" id="2820151">sep</span>&nbsp;<span class="builtintype" id="2820155">string</span><span class="op" id="2820161">)</span>&nbsp;<span class="builtintype" id="2820163">int</span>&nbsp;<span class="op" id="2820167">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2820170">n</span>&nbsp;<span class="op" id="2820172">:=</span>&nbsp;<span class="builtinfunc" id="2820175">len</span><span class="op" id="2820178">(</span><span class="ident" id="2820179">sep</span><span class="op" id="2820182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820185">switch</span>&nbsp;<span class="op" id="2820192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820195">case</span>&nbsp;<span class="ident" id="2820200">n</span>&nbsp;<span class="op" id="2820202">==</span>&nbsp;<span class="num" id="2820205">0</span><span class="op" id="2820206">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820210">return</span>&nbsp;<span class="num" id="2820217">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820220">case</span>&nbsp;<span class="ident" id="2820225">n</span>&nbsp;<span class="op" id="2820227">==</span>&nbsp;<span class="num" id="2820230">1</span><span class="op" id="2820231">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820235">return</span>&nbsp;<span class="ident" id="2820242">IndexByte</span><span class="op" id="2820251">(</span><span class="ident" id="2820252">s</span><span class="op" id="2820253">,</span>&nbsp;<span class="ident" id="2820255">sep</span><span class="op" id="2820258">[</span><span class="num" id="2820259">0</span><span class="op" id="2820260">]</span><span class="op" id="2820261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820264">case</span>&nbsp;<span class="ident" id="2820269">n</span>&nbsp;<span class="op" id="2820271">==</span>&nbsp;<span class="builtinfunc" id="2820274">len</span><span class="op" id="2820277">(</span><span class="ident" id="2820278">s</span><span class="op" id="2820279">)</span><span class="op" id="2820280">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820284">if</span>&nbsp;<span class="ident" id="2820287">sep</span>&nbsp;<span class="op" id="2820291">==</span>&nbsp;<span class="ident" id="2820294">s</span>&nbsp;<span class="op" id="2820296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820301">return</span>&nbsp;<span class="num" id="2820308">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2820312">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820316">return</span>&nbsp;<span class="op" id="2820323">-</span><span class="num" id="2820324">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820327">case</span>&nbsp;<span class="ident" id="2820332">n</span>&nbsp;<span class="op" id="2820334">&gt;</span>&nbsp;<span class="builtinfunc" id="2820336">len</span><span class="op" id="2820339">(</span><span class="ident" id="2820340">s</span><span class="op" id="2820341">)</span><span class="op" id="2820342">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820346">return</span>&nbsp;<span class="op" id="2820353">-</span><span class="num" id="2820354">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2820357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2820360">//&nbsp;Rabin-Karp&nbsp;search</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2820382">hashsep</span><span class="op" id="2820389">,</span>&nbsp;<span class="ident" id="2820391">pow</span>&nbsp;<span class="op" id="2820395">:=</span>&nbsp;<span class="ident" id="2820398">hashStr</span><span class="op" id="2820405">(</span><span class="ident" id="2820406">sep</span><span class="op" id="2820409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820412">var</span>&nbsp;<span class="ident" id="2820416">h</span>&nbsp;<span class="builtintype" id="2820418">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820426">for</span>&nbsp;<span class="ident" id="2820430">i</span>&nbsp;<span class="op" id="2820432">:=</span>&nbsp;<span class="num" id="2820435">0</span><span class="op" id="2820436">;</span>&nbsp;<span class="ident" id="2820438">i</span>&nbsp;<span class="op" id="2820440">&lt;</span>&nbsp;<span class="ident" id="2820442">n</span><span class="op" id="2820443">;</span>&nbsp;<span class="ident" id="2820445">i</span><span class="op" id="2820446">++</span>&nbsp;<span class="op" id="2820449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2820453">h</span>&nbsp;<span class="op" id="2820455">=</span>&nbsp;<span class="ident" id="2820457">h</span><span class="op" id="2820458">*</span><span class="ident" id="2820459">primeRK</span>&nbsp;<span class="op" id="2820467">+</span>&nbsp;<span class="builtintype" id="2820469">uint32</span><span class="op" id="2820475">(</span><span class="ident" id="2820476">s</span><span class="op" id="2820477">[</span><span class="ident" id="2820478">i</span><span class="op" id="2820479">]</span><span class="op" id="2820480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2820483">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820486">if</span>&nbsp;<span class="ident" id="2820489">h</span>&nbsp;<span class="op" id="2820491">==</span>&nbsp;<span class="ident" id="2820494">hashsep</span>&nbsp;<span class="op" id="2820502">&amp;&amp;</span>&nbsp;<span class="ident" id="2820505">s</span><span class="op" id="2820506">[</span><span class="op" id="2820507">:</span><span class="ident" id="2820508">n</span><span class="op" id="2820509">]</span>&nbsp;<span class="op" id="2820511">==</span>&nbsp;<span class="ident" id="2820514">sep</span>&nbsp;<span class="op" id="2820518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820522">return</span>&nbsp;<span class="num" id="2820529">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2820532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820535">for</span>&nbsp;<span class="ident" id="2820539">i</span>&nbsp;<span class="op" id="2820541">:=</span>&nbsp;<span class="ident" id="2820544">n</span><span class="op" id="2820545">;</span>&nbsp;<span class="ident" id="2820547">i</span>&nbsp;<span class="op" id="2820549">&lt;</span>&nbsp;<span class="builtinfunc" id="2820551">len</span><span class="op" id="2820554">(</span><span class="ident" id="2820555">s</span><span class="op" id="2820556">)</span><span class="op" id="2820557">;</span>&nbsp;<span class="op" id="2820559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2820563">h</span>&nbsp;<span class="op" id="2820565">*=</span>&nbsp;<span class="ident" id="2820568">primeRK</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2820578">h</span>&nbsp;<span class="op" id="2820580">+=</span>&nbsp;<span class="builtintype" id="2820583">uint32</span><span class="op" id="2820589">(</span><span class="ident" id="2820590">s</span><span class="op" id="2820591">[</span><span class="ident" id="2820592">i</span><span class="op" id="2820593">]</span><span class="op" id="2820594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2820598">h</span>&nbsp;<span class="op" id="2820600">-=</span>&nbsp;<span class="ident" id="2820603">pow</span>&nbsp;<span class="op" id="2820607">*</span>&nbsp;<span class="builtintype" id="2820609">uint32</span><span class="op" id="2820615">(</span><span class="ident" id="2820616">s</span><span class="op" id="2820617">[</span><span class="ident" id="2820618">i</span><span class="op" id="2820619">-</span><span class="ident" id="2820620">n</span><span class="op" id="2820621">]</span><span class="op" id="2820622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2820626">i</span><span class="op" id="2820627">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820632">if</span>&nbsp;<span class="ident" id="2820635">h</span>&nbsp;<span class="op" id="2820637">==</span>&nbsp;<span class="ident" id="2820640">hashsep</span>&nbsp;<span class="op" id="2820648">&amp;&amp;</span>&nbsp;<span class="ident" id="2820651">s</span><span class="op" id="2820652">[</span><span class="ident" id="2820653">i</span><span class="op" id="2820654">-</span><span class="ident" id="2820655">n</span><span class="op" id="2820656">:</span><span class="ident" id="2820657">i</span><span class="op" id="2820658">]</span>&nbsp;<span class="op" id="2820660">==</span>&nbsp;<span class="ident" id="2820663">sep</span>&nbsp;<span class="op" id="2820667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820672">return</span>&nbsp;<span class="ident" id="2820679">i</span>&nbsp;<span class="op" id="2820681">-</span>&nbsp;<span class="ident" id="2820683">n</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2820687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2820690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820693">return</span>&nbsp;<span class="op" id="2820700">-</span><span class="num" id="2820701">1</span><br>
<span class="lineno"></span><span class="op" id="2820703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="2820706">//&nbsp;LastIndex&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2820805">func</span>&nbsp;<span class="ident" id="2820810">LastIndex</span><span class="op" id="2820819">(</span><span class="ident" id="2820820">s</span><span class="op" id="2820821">,</span>&nbsp;<span class="ident" id="2820823">sep</span>&nbsp;<span class="builtintype" id="2820827">string</span><span class="op" id="2820833">)</span>&nbsp;<span class="builtintype" id="2820835">int</span>&nbsp;<span class="op" id="2820839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2820842">n</span>&nbsp;<span class="op" id="2820844">:=</span>&nbsp;<span class="builtinfunc" id="2820847">len</span><span class="op" id="2820850">(</span><span class="ident" id="2820851">sep</span><span class="op" id="2820854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820857">switch</span>&nbsp;<span class="op" id="2820864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820867">case</span>&nbsp;<span class="ident" id="2820872">n</span>&nbsp;<span class="op" id="2820874">==</span>&nbsp;<span class="num" id="2820877">0</span><span class="op" id="2820878">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820882">return</span>&nbsp;<span class="builtinfunc" id="2820889">len</span><span class="op" id="2820892">(</span><span class="ident" id="2820893">s</span><span class="op" id="2820894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820897">case</span>&nbsp;<span class="ident" id="2820902">n</span>&nbsp;<span class="op" id="2820904">==</span>&nbsp;<span class="num" id="2820907">1</span><span class="op" id="2820908">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2820912">//&nbsp;special&nbsp;case&nbsp;worth&nbsp;making&nbsp;fast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2820948">c</span>&nbsp;<span class="op" id="2820950">:=</span>&nbsp;<span class="ident" id="2820953">sep</span><span class="op" id="2820956">[</span><span class="num" id="2820957">0</span><span class="op" id="2820958">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2820962">for</span>&nbsp;<span class="ident" id="2820966">i</span>&nbsp;<span class="op" id="2820968">:=</span>&nbsp;<span class="builtinfunc" id="2820971">len</span><span class="op" id="2820974">(</span><span class="ident" id="2820975">s</span><span class="op" id="2820976">)</span>&nbsp;<span class="op" id="2820978">-</span>&nbsp;<span class="num" id="2820980">1</span><span class="op" id="2820981">;</span>&nbsp;<span class="ident" id="2820983">i</span>&nbsp;<span class="op" id="2820985">&gt;=</span>&nbsp;<span class="num" id="2820988">0</span><span class="op" id="2820989">;</span>&nbsp;<span class="ident" id="2820991">i</span><span class="op" id="2820992">--</span>&nbsp;<span class="op" id="2820995">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821000">if</span>&nbsp;<span class="ident" id="2821003">s</span><span class="op" id="2821004">[</span><span class="ident" id="2821005">i</span><span class="op" id="2821006">]</span>&nbsp;<span class="op" id="2821008">==</span>&nbsp;<span class="ident" id="2821011">c</span>&nbsp;<span class="op" id="2821013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821019">return</span>&nbsp;<span class="ident" id="2821026">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2821031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2821035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821039">return</span>&nbsp;<span class="op" id="2821046">-</span><span class="num" id="2821047">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821050">case</span>&nbsp;<span class="ident" id="2821055">n</span>&nbsp;<span class="op" id="2821057">==</span>&nbsp;<span class="builtinfunc" id="2821060">len</span><span class="op" id="2821063">(</span><span class="ident" id="2821064">s</span><span class="op" id="2821065">)</span><span class="op" id="2821066">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821070">if</span>&nbsp;<span class="ident" id="2821073">sep</span>&nbsp;<span class="op" id="2821077">==</span>&nbsp;<span class="ident" id="2821080">s</span>&nbsp;<span class="op" id="2821082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821087">return</span>&nbsp;<span class="num" id="2821094">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2821098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821102">return</span>&nbsp;<span class="op" id="2821109">-</span><span class="num" id="2821110">1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821113">case</span>&nbsp;<span class="ident" id="2821118">n</span>&nbsp;<span class="op" id="2821120">&gt;</span>&nbsp;<span class="builtinfunc" id="2821122">len</span><span class="op" id="2821125">(</span><span class="ident" id="2821126">s</span><span class="op" id="2821127">)</span><span class="op" id="2821128">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821132">return</span>&nbsp;<span class="op" id="2821139">-</span><span class="num" id="2821140">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2821143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2821146">//&nbsp;Rabin-Karp&nbsp;search&nbsp;from&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821195">hashsep</span><span class="op" id="2821202">,</span>&nbsp;<span class="ident" id="2821204">pow</span>&nbsp;<span class="op" id="2821208">:=</span>&nbsp;<span class="ident" id="2821211">hashStrRev</span><span class="op" id="2821221">(</span><span class="ident" id="2821222">sep</span><span class="op" id="2821225">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821228">last</span>&nbsp;<span class="op" id="2821233">:=</span>&nbsp;<span class="builtinfunc" id="2821236">len</span><span class="op" id="2821239">(</span><span class="ident" id="2821240">s</span><span class="op" id="2821241">)</span>&nbsp;<span class="op" id="2821243">-</span>&nbsp;<span class="ident" id="2821245">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821248">var</span>&nbsp;<span class="ident" id="2821252">h</span>&nbsp;<span class="builtintype" id="2821254">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821262">for</span>&nbsp;<span class="ident" id="2821266">i</span>&nbsp;<span class="op" id="2821268">:=</span>&nbsp;<span class="builtinfunc" id="2821271">len</span><span class="op" id="2821274">(</span><span class="ident" id="2821275">s</span><span class="op" id="2821276">)</span>&nbsp;<span class="op" id="2821278">-</span>&nbsp;<span class="num" id="2821280">1</span><span class="op" id="2821281">;</span>&nbsp;<span class="ident" id="2821283">i</span>&nbsp;<span class="op" id="2821285">&gt;=</span>&nbsp;<span class="ident" id="2821288">last</span><span class="op" id="2821292">;</span>&nbsp;<span class="ident" id="2821294">i</span><span class="op" id="2821295">--</span>&nbsp;<span class="op" id="2821298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821302">h</span>&nbsp;<span class="op" id="2821304">=</span>&nbsp;<span class="ident" id="2821306">h</span><span class="op" id="2821307">*</span><span class="ident" id="2821308">primeRK</span>&nbsp;<span class="op" id="2821316">+</span>&nbsp;<span class="builtintype" id="2821318">uint32</span><span class="op" id="2821324">(</span><span class="ident" id="2821325">s</span><span class="op" id="2821326">[</span><span class="ident" id="2821327">i</span><span class="op" id="2821328">]</span><span class="op" id="2821329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2821332">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821335">if</span>&nbsp;<span class="ident" id="2821338">h</span>&nbsp;<span class="op" id="2821340">==</span>&nbsp;<span class="ident" id="2821343">hashsep</span>&nbsp;<span class="op" id="2821351">&amp;&amp;</span>&nbsp;<span class="ident" id="2821354">s</span><span class="op" id="2821355">[</span><span class="ident" id="2821356">last</span><span class="op" id="2821360">:</span><span class="op" id="2821361">]</span>&nbsp;<span class="op" id="2821363">==</span>&nbsp;<span class="ident" id="2821366">sep</span>&nbsp;<span class="op" id="2821370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821374">return</span>&nbsp;<span class="ident" id="2821381">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2821387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821390">for</span>&nbsp;<span class="ident" id="2821394">i</span>&nbsp;<span class="op" id="2821396">:=</span>&nbsp;<span class="ident" id="2821399">last</span>&nbsp;<span class="op" id="2821404">-</span>&nbsp;<span class="num" id="2821406">1</span><span class="op" id="2821407">;</span>&nbsp;<span class="ident" id="2821409">i</span>&nbsp;<span class="op" id="2821411">&gt;=</span>&nbsp;<span class="num" id="2821414">0</span><span class="op" id="2821415">;</span>&nbsp;<span class="ident" id="2821417">i</span><span class="op" id="2821418">--</span>&nbsp;<span class="op" id="2821421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821425">h</span>&nbsp;<span class="op" id="2821427">*=</span>&nbsp;<span class="ident" id="2821430">primeRK</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821440">h</span>&nbsp;<span class="op" id="2821442">+=</span>&nbsp;<span class="builtintype" id="2821445">uint32</span><span class="op" id="2821451">(</span><span class="ident" id="2821452">s</span><span class="op" id="2821453">[</span><span class="ident" id="2821454">i</span><span class="op" id="2821455">]</span><span class="op" id="2821456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2821460">h</span>&nbsp;<span class="op" id="2821462">-=</span>&nbsp;<span class="ident" id="2821465">pow</span>&nbsp;<span class="op" id="2821469">*</span>&nbsp;<span class="builtintype" id="2821471">uint32</span><span class="op" id="2821477">(</span><span class="ident" id="2821478">s</span><span class="op" id="2821479">[</span><span class="ident" id="2821480">i</span><span class="op" id="2821481">+</span><span class="ident" id="2821482">n</span><span class="op" id="2821483">]</span><span class="op" id="2821484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821488">if</span>&nbsp;<span class="ident" id="2821491">h</span>&nbsp;<span class="op" id="2821493">==</span>&nbsp;<span class="ident" id="2821496">hashsep</span>&nbsp;<span class="op" id="2821504">&amp;&amp;</span>&nbsp;<span class="ident" id="2821507">s</span><span class="op" id="2821508">[</span><span class="ident" id="2821509">i</span><span class="op" id="2821510">:</span><span class="ident" id="2821511">i</span><span class="op" id="2821512">+</span><span class="ident" id="2821513">n</span><span class="op" id="2821514">]</span>&nbsp;<span class="op" id="2821516">==</span>&nbsp;<span class="ident" id="2821519">sep</span>&nbsp;<span class="op" id="2821523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821528">return</span>&nbsp;<span class="ident" id="2821535">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2821539">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2821542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821545">return</span>&nbsp;<span class="op" id="2821552">-</span><span class="num" id="2821553">1</span><br>
<span class="lineno"></span><span class="op" id="2821555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2821558">//&nbsp;IndexRune&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno">225</span><span class="comment" id="2821637">//&nbsp;r,&nbsp;or&nbsp;-1&nbsp;if&nbsp;rune&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2821678">func</span>&nbsp;<span class="ident" id="2821683">IndexRune</span><span class="op" id="2821692">(</span><span class="ident" id="2821693">s</span>&nbsp;<span class="builtintype" id="2821695">string</span><span class="op" id="2821701">,</span>&nbsp;<span class="ident" id="2821703">r</span>&nbsp;<span class="builtintype" id="2821705">rune</span><span class="op" id="2821709">)</span>&nbsp;<span class="builtintype" id="2821711">int</span>&nbsp;<span class="op" id="2821715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821718">switch</span>&nbsp;<span class="op" id="2821725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821728">case</span>&nbsp;<span class="ident" id="2821733">r</span>&nbsp;<span class="op" id="2821735">&lt;</span>&nbsp;<span class="ident" id="2821737">utf8</span><span class="op" id="2821741">.</span><span class="ident" id="2821742">RuneSelf</span><span class="op" id="2821750">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821754">return</span>&nbsp;<span class="ident" id="2821761">IndexByte</span><span class="op" id="2821770">(</span><span class="ident" id="2821771">s</span><span class="op" id="2821772">,</span>&nbsp;<span class="builtintype" id="2821774">byte</span><span class="op" id="2821778">(</span><span class="ident" id="2821779">r</span><span class="op" id="2821780">)</span><span class="op" id="2821781">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821784">default</span><span class="op" id="2821791">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821795">for</span>&nbsp;<span class="ident" id="2821799">i</span><span class="op" id="2821800">,</span>&nbsp;<span class="ident" id="2821802">c</span>&nbsp;<span class="op" id="2821804">:=</span>&nbsp;<span class="keyword" id="2821807">range</span>&nbsp;<span class="ident" id="2821813">s</span>&nbsp;<span class="op" id="2821815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821820">if</span>&nbsp;<span class="ident" id="2821823">c</span>&nbsp;<span class="op" id="2821825">==</span>&nbsp;<span class="ident" id="2821828">r</span>&nbsp;<span class="op" id="2821830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821836">return</span>&nbsp;<span class="ident" id="2821843">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2821848">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2821852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2821855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2821858">return</span>&nbsp;<span class="op" id="2821865">-</span><span class="num" id="2821866">1</span><br>
<span class="lineno"></span><span class="op" id="2821868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="2821871">//&nbsp;IndexAny&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;any&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno"></span><span class="comment" id="2821949">//&nbsp;from&nbsp;chars&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;no&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;chars&nbsp;is&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2822028">func</span>&nbsp;<span class="ident" id="2822033">IndexAny</span><span class="op" id="2822041">(</span><span class="ident" id="2822042">s</span><span class="op" id="2822043">,</span>&nbsp;<span class="ident" id="2822045">chars</span>&nbsp;<span class="builtintype" id="2822051">string</span><span class="op" id="2822057">)</span>&nbsp;<span class="builtintype" id="2822059">int</span>&nbsp;<span class="op" id="2822063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822066">if</span>&nbsp;<span class="builtinfunc" id="2822069">len</span><span class="op" id="2822072">(</span><span class="ident" id="2822073">chars</span><span class="op" id="2822078">)</span>&nbsp;<span class="op" id="2822080">&gt;</span>&nbsp;<span class="num" id="2822082">0</span>&nbsp;<span class="op" id="2822084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822088">for</span>&nbsp;<span class="ident" id="2822092">i</span><span class="op" id="2822093">,</span>&nbsp;<span class="ident" id="2822095">c</span>&nbsp;<span class="op" id="2822097">:=</span>&nbsp;<span class="keyword" id="2822100">range</span>&nbsp;<span class="ident" id="2822106">s</span>&nbsp;<span class="op" id="2822108">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822113">for</span>&nbsp;<span class="ident" id="2822117">_</span><span class="op" id="2822118">,</span>&nbsp;<span class="ident" id="2822120">m</span>&nbsp;<span class="op" id="2822122">:=</span>&nbsp;<span class="keyword" id="2822125">range</span>&nbsp;<span class="ident" id="2822131">chars</span>&nbsp;<span class="op" id="2822137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822143">if</span>&nbsp;<span class="ident" id="2822146">c</span>&nbsp;<span class="op" id="2822148">==</span>&nbsp;<span class="ident" id="2822151">m</span>&nbsp;<span class="op" id="2822153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822160">return</span>&nbsp;<span class="ident" id="2822167">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2822173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2822178">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2822182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2822185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822188">return</span>&nbsp;<span class="op" id="2822195">-</span><span class="num" id="2822196">1</span><br>
<span class="lineno"></span><span class="op" id="2822198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="2822201">//&nbsp;LastIndexAny&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;any&nbsp;Unicode&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="2822276">//&nbsp;point&nbsp;from&nbsp;chars&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;no&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;chars&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2822347">//&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2822364">func</span>&nbsp;<span class="ident" id="2822369">LastIndexAny</span><span class="op" id="2822381">(</span><span class="ident" id="2822382">s</span><span class="op" id="2822383">,</span>&nbsp;<span class="ident" id="2822385">chars</span>&nbsp;<span class="builtintype" id="2822391">string</span><span class="op" id="2822397">)</span>&nbsp;<span class="builtintype" id="2822399">int</span>&nbsp;<span class="op" id="2822403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822406">if</span>&nbsp;<span class="builtinfunc" id="2822409">len</span><span class="op" id="2822412">(</span><span class="ident" id="2822413">chars</span><span class="op" id="2822418">)</span>&nbsp;<span class="op" id="2822420">&gt;</span>&nbsp;<span class="num" id="2822422">0</span>&nbsp;<span class="op" id="2822424">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822428">for</span>&nbsp;<span class="ident" id="2822432">i</span>&nbsp;<span class="op" id="2822434">:=</span>&nbsp;<span class="builtinfunc" id="2822437">len</span><span class="op" id="2822440">(</span><span class="ident" id="2822441">s</span><span class="op" id="2822442">)</span><span class="op" id="2822443">;</span>&nbsp;<span class="ident" id="2822445">i</span>&nbsp;<span class="op" id="2822447">&gt;</span>&nbsp;<span class="num" id="2822449">0</span><span class="op" id="2822450">;</span>&nbsp;<span class="op" id="2822452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2822457">rune</span><span class="op" id="2822461">,</span>&nbsp;<span class="ident" id="2822463">size</span>&nbsp;<span class="op" id="2822468">:=</span>&nbsp;<span class="ident" id="2822471">utf8</span><span class="op" id="2822475">.</span><span class="ident" id="2822476">DecodeLastRuneInString</span><span class="op" id="2822498">(</span><span class="ident" id="2822499">s</span><span class="op" id="2822500">[</span><span class="num" id="2822501">0</span><span class="op" id="2822502">:</span><span class="ident" id="2822503">i</span><span class="op" id="2822504">]</span><span class="op" id="2822505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2822510">i</span>&nbsp;<span class="op" id="2822512">-=</span>&nbsp;<span class="ident" id="2822515">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822523">for</span>&nbsp;<span class="ident" id="2822527">_</span><span class="op" id="2822528">,</span>&nbsp;<span class="ident" id="2822530">m</span>&nbsp;<span class="op" id="2822532">:=</span>&nbsp;<span class="keyword" id="2822535">range</span>&nbsp;<span class="ident" id="2822541">chars</span>&nbsp;<span class="op" id="2822547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822553">if</span>&nbsp;<span class="builtintype" id="2822556">rune</span>&nbsp;<span class="op" id="2822561">==</span>&nbsp;<span class="ident" id="2822564">m</span>&nbsp;<span class="op" id="2822566">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822573">return</span>&nbsp;<span class="ident" id="2822580">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2822586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2822591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2822595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2822598">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822601">return</span>&nbsp;<span class="op" id="2822608">-</span><span class="num" id="2822609">1</span><br>
<span class="lineno"></span><span class="op" id="2822611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2822614">//&nbsp;Generic&nbsp;split:&nbsp;splits&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep,</span><br>
<span class="lineno"></span><span class="comment" id="2822667">//&nbsp;including&nbsp;sepSave&nbsp;bytes&nbsp;of&nbsp;sep&nbsp;in&nbsp;the&nbsp;subarrays.</span><br>
<span class="lineno">275</span><span class="keyword" id="2822719">func</span>&nbsp;<span class="ident" id="2822724">genSplit</span><span class="op" id="2822732">(</span><span class="ident" id="2822733">s</span><span class="op" id="2822734">,</span>&nbsp;<span class="ident" id="2822736">sep</span>&nbsp;<span class="builtintype" id="2822740">string</span><span class="op" id="2822746">,</span>&nbsp;<span class="ident" id="2822748">sepSave</span><span class="op" id="2822755">,</span>&nbsp;<span class="ident" id="2822757">n</span>&nbsp;<span class="builtintype" id="2822759">int</span><span class="op" id="2822762">)</span>&nbsp;<span class="op" id="2822764">[</span><span class="op" id="2822765">]</span><span class="builtintype" id="2822766">string</span>&nbsp;<span class="op" id="2822773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822776">if</span>&nbsp;<span class="ident" id="2822779">n</span>&nbsp;<span class="op" id="2822781">==</span>&nbsp;<span class="num" id="2822784">0</span>&nbsp;<span class="op" id="2822786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822790">return</span>&nbsp;<span class="ident" id="2822797">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2822802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822805">if</span>&nbsp;<span class="ident" id="2822808">sep</span>&nbsp;<span class="op" id="2822812">==</span>&nbsp;<span class="string" id="2822815">&#34;&#34;</span>&nbsp;<span class="op" id="2822818">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822822">return</span>&nbsp;<span class="ident" id="2822829">explode</span><span class="op" id="2822836">(</span><span class="ident" id="2822837">s</span><span class="op" id="2822838">,</span>&nbsp;<span class="ident" id="2822840">n</span><span class="op" id="2822841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2822844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822847">if</span>&nbsp;<span class="ident" id="2822850">n</span>&nbsp;<span class="op" id="2822852">&lt;</span>&nbsp;<span class="num" id="2822854">0</span>&nbsp;<span class="op" id="2822856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2822860">n</span>&nbsp;<span class="op" id="2822862">=</span>&nbsp;<span class="ident" id="2822864">Count</span><span class="op" id="2822869">(</span><span class="ident" id="2822870">s</span><span class="op" id="2822871">,</span>&nbsp;<span class="ident" id="2822873">sep</span><span class="op" id="2822876">)</span>&nbsp;<span class="op" id="2822878">+</span>&nbsp;<span class="num" id="2822880">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2822883">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2822886">c</span>&nbsp;<span class="op" id="2822888">:=</span>&nbsp;<span class="ident" id="2822891">sep</span><span class="op" id="2822894">[</span><span class="num" id="2822895">0</span><span class="op" id="2822896">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2822899">start</span>&nbsp;<span class="op" id="2822905">:=</span>&nbsp;<span class="num" id="2822908">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2822911">a</span>&nbsp;<span class="op" id="2822913">:=</span>&nbsp;<span class="builtinfunc" id="2822916">make</span><span class="op" id="2822920">(</span><span class="op" id="2822921">[</span><span class="op" id="2822922">]</span><span class="builtintype" id="2822923">string</span><span class="op" id="2822929">,</span>&nbsp;<span class="ident" id="2822931">n</span><span class="op" id="2822932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2822935">na</span>&nbsp;<span class="op" id="2822938">:=</span>&nbsp;<span class="num" id="2822941">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822944">for</span>&nbsp;<span class="ident" id="2822948">i</span>&nbsp;<span class="op" id="2822950">:=</span>&nbsp;<span class="num" id="2822953">0</span><span class="op" id="2822954">;</span>&nbsp;<span class="ident" id="2822956">i</span><span class="op" id="2822957">+</span><span class="builtinfunc" id="2822958">len</span><span class="op" id="2822961">(</span><span class="ident" id="2822962">sep</span><span class="op" id="2822965">)</span>&nbsp;<span class="op" id="2822967">&lt;=</span>&nbsp;<span class="builtinfunc" id="2822970">len</span><span class="op" id="2822973">(</span><span class="ident" id="2822974">s</span><span class="op" id="2822975">)</span>&nbsp;<span class="op" id="2822977">&amp;&amp;</span>&nbsp;<span class="ident" id="2822980">na</span><span class="op" id="2822982">+</span><span class="num" id="2822983">1</span>&nbsp;<span class="op" id="2822985">&lt;</span>&nbsp;<span class="ident" id="2822987">n</span><span class="op" id="2822988">;</span>&nbsp;<span class="ident" id="2822990">i</span><span class="op" id="2822991">++</span>&nbsp;<span class="op" id="2822994">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2822998">if</span>&nbsp;<span class="ident" id="2823001">s</span><span class="op" id="2823002">[</span><span class="ident" id="2823003">i</span><span class="op" id="2823004">]</span>&nbsp;<span class="op" id="2823006">==</span>&nbsp;<span class="ident" id="2823009">c</span>&nbsp;<span class="op" id="2823011">&amp;&amp;</span>&nbsp;<span class="op" id="2823014">(</span><span class="builtinfunc" id="2823015">len</span><span class="op" id="2823018">(</span><span class="ident" id="2823019">sep</span><span class="op" id="2823022">)</span>&nbsp;<span class="op" id="2823024">==</span>&nbsp;<span class="num" id="2823027">1</span>&nbsp;<span class="op" id="2823029">||</span>&nbsp;<span class="ident" id="2823032">s</span><span class="op" id="2823033">[</span><span class="ident" id="2823034">i</span><span class="op" id="2823035">:</span><span class="ident" id="2823036">i</span><span class="op" id="2823037">+</span><span class="builtinfunc" id="2823038">len</span><span class="op" id="2823041">(</span><span class="ident" id="2823042">sep</span><span class="op" id="2823045">)</span><span class="op" id="2823046">]</span>&nbsp;<span class="op" id="2823048">==</span>&nbsp;<span class="ident" id="2823051">sep</span><span class="op" id="2823054">)</span>&nbsp;<span class="op" id="2823056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2823061">a</span><span class="op" id="2823062">[</span><span class="ident" id="2823063">na</span><span class="op" id="2823065">]</span>&nbsp;<span class="op" id="2823067">=</span>&nbsp;<span class="ident" id="2823069">s</span><span class="op" id="2823070">[</span><span class="ident" id="2823071">start</span>&nbsp;<span class="op" id="2823077">:</span>&nbsp;<span class="ident" id="2823079">i</span><span class="op" id="2823080">+</span><span class="ident" id="2823081">sepSave</span><span class="op" id="2823088">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2823093">na</span><span class="op" id="2823095">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2823101">start</span>&nbsp;<span class="op" id="2823107">=</span>&nbsp;<span class="ident" id="2823109">i</span>&nbsp;<span class="op" id="2823111">+</span>&nbsp;<span class="builtinfunc" id="2823113">len</span><span class="op" id="2823116">(</span><span class="ident" id="2823117">sep</span><span class="op" id="2823120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2823125">i</span>&nbsp;<span class="op" id="2823127">+=</span>&nbsp;<span class="builtinfunc" id="2823130">len</span><span class="op" id="2823133">(</span><span class="ident" id="2823134">sep</span><span class="op" id="2823137">)</span>&nbsp;<span class="op" id="2823139">-</span>&nbsp;<span class="num" id="2823141">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2823145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2823148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2823151">a</span><span class="op" id="2823152">[</span><span class="ident" id="2823153">na</span><span class="op" id="2823155">]</span>&nbsp;<span class="op" id="2823157">=</span>&nbsp;<span class="ident" id="2823159">s</span><span class="op" id="2823160">[</span><span class="ident" id="2823161">start</span><span class="op" id="2823166">:</span><span class="op" id="2823167">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2823170">return</span>&nbsp;<span class="ident" id="2823177">a</span><span class="op" id="2823178">[</span><span class="num" id="2823179">0</span>&nbsp;<span class="op" id="2823181">:</span>&nbsp;<span class="ident" id="2823183">na</span><span class="op" id="2823185">+</span><span class="num" id="2823186">1</span><span class="op" id="2823187">]</span><br>
<span class="lineno"></span><span class="op" id="2823189">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="2823192">//&nbsp;SplitN&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2823267">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2823311">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2823372">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno">305</span><span class="comment" id="2823432">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="2823516">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="2823565">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="2823592">func</span>&nbsp;<span class="ident" id="2823597">SplitN</span><span class="op" id="2823603">(</span><span class="ident" id="2823604">s</span><span class="op" id="2823605">,</span>&nbsp;<span class="ident" id="2823607">sep</span>&nbsp;<span class="builtintype" id="2823611">string</span><span class="op" id="2823617">,</span>&nbsp;<span class="ident" id="2823619">n</span>&nbsp;<span class="builtintype" id="2823621">int</span><span class="op" id="2823624">)</span>&nbsp;<span class="op" id="2823626">[</span><span class="op" id="2823627">]</span><span class="builtintype" id="2823628">string</span>&nbsp;<span class="op" id="2823635">{</span>&nbsp;<span class="keyword" id="2823637">return</span>&nbsp;<span class="ident" id="2823644">genSplit</span><span class="op" id="2823652">(</span><span class="ident" id="2823653">s</span><span class="op" id="2823654">,</span>&nbsp;<span class="ident" id="2823656">sep</span><span class="op" id="2823659">,</span>&nbsp;<span class="num" id="2823661">0</span><span class="op" id="2823662">,</span>&nbsp;<span class="ident" id="2823664">n</span><span class="op" id="2823665">)</span>&nbsp;<span class="op" id="2823667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="2823670">//&nbsp;SplitAfterN&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2823741">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;substrings.</span><br>
<span class="lineno"></span><span class="comment" id="2823781">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfterN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2823847">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno"></span><span class="comment" id="2823907">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno">315</span><span class="comment" id="2823991">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="2824040">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="2824067">func</span>&nbsp;<span class="ident" id="2824072">SplitAfterN</span><span class="op" id="2824083">(</span><span class="ident" id="2824084">s</span><span class="op" id="2824085">,</span>&nbsp;<span class="ident" id="2824087">sep</span>&nbsp;<span class="builtintype" id="2824091">string</span><span class="op" id="2824097">,</span>&nbsp;<span class="ident" id="2824099">n</span>&nbsp;<span class="builtintype" id="2824101">int</span><span class="op" id="2824104">)</span>&nbsp;<span class="op" id="2824106">[</span><span class="op" id="2824107">]</span><span class="builtintype" id="2824108">string</span>&nbsp;<span class="op" id="2824115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2824118">return</span>&nbsp;<span class="ident" id="2824125">genSplit</span><span class="op" id="2824133">(</span><span class="ident" id="2824134">s</span><span class="op" id="2824135">,</span>&nbsp;<span class="ident" id="2824137">sep</span><span class="op" id="2824140">,</span>&nbsp;<span class="builtinfunc" id="2824142">len</span><span class="op" id="2824145">(</span><span class="ident" id="2824146">sep</span><span class="op" id="2824149">)</span><span class="op" id="2824150">,</span>&nbsp;<span class="ident" id="2824152">n</span><span class="op" id="2824153">)</span><br>
<span class="lineno"></span><span class="op" id="2824155">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2824158">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2824236">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2824280">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;Split&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2824340">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno">325</span><span class="keyword" id="2824390">func</span>&nbsp;<span class="ident" id="2824395">Split</span><span class="op" id="2824400">(</span><span class="ident" id="2824401">s</span><span class="op" id="2824402">,</span>&nbsp;<span class="ident" id="2824404">sep</span>&nbsp;<span class="builtintype" id="2824408">string</span><span class="op" id="2824414">)</span>&nbsp;<span class="op" id="2824416">[</span><span class="op" id="2824417">]</span><span class="builtintype" id="2824418">string</span>&nbsp;<span class="op" id="2824425">{</span>&nbsp;<span class="keyword" id="2824427">return</span>&nbsp;<span class="ident" id="2824434">genSplit</span><span class="op" id="2824442">(</span><span class="ident" id="2824443">s</span><span class="op" id="2824444">,</span>&nbsp;<span class="ident" id="2824446">sep</span><span class="op" id="2824449">,</span>&nbsp;<span class="num" id="2824451">0</span><span class="op" id="2824452">,</span>&nbsp;<span class="op" id="2824454">-</span><span class="num" id="2824455">1</span><span class="op" id="2824456">)</span>&nbsp;<span class="op" id="2824458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2824461">//&nbsp;SplitAfter&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;substrings&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2824535">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;substrings.</span><br>
<span class="lineno"></span><span class="comment" id="2824575">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfter&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno">330</span><span class="comment" id="2824640">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitAfterN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2824695">func</span>&nbsp;<span class="ident" id="2824700">SplitAfter</span><span class="op" id="2824710">(</span><span class="ident" id="2824711">s</span><span class="op" id="2824712">,</span>&nbsp;<span class="ident" id="2824714">sep</span>&nbsp;<span class="builtintype" id="2824718">string</span><span class="op" id="2824724">)</span>&nbsp;<span class="op" id="2824726">[</span><span class="op" id="2824727">]</span><span class="builtintype" id="2824728">string</span>&nbsp;<span class="op" id="2824735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2824738">return</span>&nbsp;<span class="ident" id="2824745">genSplit</span><span class="op" id="2824753">(</span><span class="ident" id="2824754">s</span><span class="op" id="2824755">,</span>&nbsp;<span class="ident" id="2824757">sep</span><span class="op" id="2824760">,</span>&nbsp;<span class="builtinfunc" id="2824762">len</span><span class="op" id="2824765">(</span><span class="ident" id="2824766">sep</span><span class="op" id="2824769">)</span><span class="op" id="2824770">,</span>&nbsp;<span class="op" id="2824772">-</span><span class="num" id="2824773">1</span><span class="op" id="2824774">)</span><br>
<span class="lineno"></span><span class="op" id="2824776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="2824779">//&nbsp;Fields&nbsp;splits&nbsp;the&nbsp;string&nbsp;s&nbsp;around&nbsp;each&nbsp;instance&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;consecutive&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="2824869">//&nbsp;characters,&nbsp;as&nbsp;defined&nbsp;by&nbsp;unicode.IsSpace,&nbsp;returning&nbsp;an&nbsp;array&nbsp;of&nbsp;substrings&nbsp;of&nbsp;s&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2824959">//&nbsp;empty&nbsp;list&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="2825005">func</span>&nbsp;<span class="ident" id="2825010">Fields</span><span class="op" id="2825016">(</span><span class="ident" id="2825017">s</span>&nbsp;<span class="builtintype" id="2825019">string</span><span class="op" id="2825025">)</span>&nbsp;<span class="op" id="2825027">[</span><span class="op" id="2825028">]</span><span class="builtintype" id="2825029">string</span>&nbsp;<span class="op" id="2825036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2825039">return</span>&nbsp;<span class="ident" id="2825046">FieldsFunc</span><span class="op" id="2825056">(</span><span class="ident" id="2825057">s</span><span class="op" id="2825058">,</span>&nbsp;<span class="ident" id="2825060">unicode</span><span class="op" id="2825067">.</span><span class="ident" id="2825068">IsSpace</span><span class="op" id="2825075">)</span><br>
<span class="lineno">340</span><span class="op" id="2825077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2825080">//&nbsp;FieldsFunc&nbsp;splits&nbsp;the&nbsp;string&nbsp;s&nbsp;at&nbsp;each&nbsp;run&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)</span><br>
<span class="lineno"></span><span class="comment" id="2825167">//&nbsp;and&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;slices&nbsp;of&nbsp;s.&nbsp;If&nbsp;all&nbsp;code&nbsp;points&nbsp;in&nbsp;s&nbsp;satisfy&nbsp;f(c)&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2825251">//&nbsp;string&nbsp;is&nbsp;empty,&nbsp;an&nbsp;empty&nbsp;slice&nbsp;is&nbsp;returned.</span><br>
<span class="lineno">345</span><span class="comment" id="2825299">//&nbsp;FieldsFunc&nbsp;makes&nbsp;no&nbsp;guarantees&nbsp;about&nbsp;the&nbsp;order&nbsp;in&nbsp;which&nbsp;it&nbsp;calls&nbsp;f(c).</span><br>
<span class="lineno"></span><span class="comment" id="2825373">//&nbsp;If&nbsp;f&nbsp;does&nbsp;not&nbsp;return&nbsp;consistent&nbsp;results&nbsp;for&nbsp;a&nbsp;given&nbsp;c,&nbsp;FieldsFunc&nbsp;may&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="2825453">func</span>&nbsp;<span class="ident" id="2825458">FieldsFunc</span><span class="op" id="2825468">(</span><span class="ident" id="2825469">s</span>&nbsp;<span class="builtintype" id="2825471">string</span><span class="op" id="2825477">,</span>&nbsp;<span class="ident" id="2825479">f</span>&nbsp;<span class="keyword" id="2825481">func</span><span class="op" id="2825485">(</span><span class="builtintype" id="2825486">rune</span><span class="op" id="2825490">)</span>&nbsp;<span class="builtintype" id="2825492">bool</span><span class="op" id="2825496">)</span>&nbsp;<span class="op" id="2825498">[</span><span class="op" id="2825499">]</span><span class="builtintype" id="2825500">string</span>&nbsp;<span class="op" id="2825507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2825510">//&nbsp;First&nbsp;count&nbsp;the&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825538">n</span>&nbsp;<span class="op" id="2825540">:=</span>&nbsp;<span class="num" id="2825543">0</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825546">inField</span>&nbsp;<span class="op" id="2825554">:=</span>&nbsp;<span class="builtintype" id="2825557">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2825564">for</span>&nbsp;<span class="ident" id="2825568">_</span><span class="op" id="2825569">,</span>&nbsp;<span class="builtintype" id="2825571">rune</span>&nbsp;<span class="op" id="2825576">:=</span>&nbsp;<span class="keyword" id="2825579">range</span>&nbsp;<span class="ident" id="2825585">s</span>&nbsp;<span class="op" id="2825587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825591">wasInField</span>&nbsp;<span class="op" id="2825602">:=</span>&nbsp;<span class="ident" id="2825605">inField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825615">inField</span>&nbsp;<span class="op" id="2825623">=</span>&nbsp;<span class="op" id="2825625">!</span><span class="ident" id="2825626">f</span><span class="op" id="2825627">(</span><span class="builtintype" id="2825628">rune</span><span class="op" id="2825632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2825636">if</span>&nbsp;<span class="ident" id="2825639">inField</span>&nbsp;<span class="op" id="2825647">&amp;&amp;</span>&nbsp;<span class="op" id="2825650">!</span><span class="ident" id="2825651">wasInField</span>&nbsp;<span class="op" id="2825662">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825667">n</span><span class="op" id="2825668">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2825673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2825676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2825680">//&nbsp;Now&nbsp;create&nbsp;them.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825701">a</span>&nbsp;<span class="op" id="2825703">:=</span>&nbsp;<span class="builtinfunc" id="2825706">make</span><span class="op" id="2825710">(</span><span class="op" id="2825711">[</span><span class="op" id="2825712">]</span><span class="builtintype" id="2825713">string</span><span class="op" id="2825719">,</span>&nbsp;<span class="ident" id="2825721">n</span><span class="op" id="2825722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825725">na</span>&nbsp;<span class="op" id="2825728">:=</span>&nbsp;<span class="num" id="2825731">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825734">fieldStart</span>&nbsp;<span class="op" id="2825745">:=</span>&nbsp;<span class="op" id="2825748">-</span><span class="num" id="2825749">1</span>&nbsp;<span class="comment" id="2825751">//&nbsp;Set&nbsp;to&nbsp;-1&nbsp;when&nbsp;looking&nbsp;for&nbsp;start&nbsp;of&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2825798">for</span>&nbsp;<span class="ident" id="2825802">i</span><span class="op" id="2825803">,</span>&nbsp;<span class="builtintype" id="2825805">rune</span>&nbsp;<span class="op" id="2825810">:=</span>&nbsp;<span class="keyword" id="2825813">range</span>&nbsp;<span class="ident" id="2825819">s</span>&nbsp;<span class="op" id="2825821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2825825">if</span>&nbsp;<span class="ident" id="2825828">f</span><span class="op" id="2825829">(</span><span class="builtintype" id="2825830">rune</span><span class="op" id="2825834">)</span>&nbsp;<span class="op" id="2825836">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2825841">if</span>&nbsp;<span class="ident" id="2825844">fieldStart</span>&nbsp;<span class="op" id="2825855">&gt;=</span>&nbsp;<span class="num" id="2825858">0</span>&nbsp;<span class="op" id="2825860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825866">a</span><span class="op" id="2825867">[</span><span class="ident" id="2825868">na</span><span class="op" id="2825870">]</span>&nbsp;<span class="op" id="2825872">=</span>&nbsp;<span class="ident" id="2825874">s</span><span class="op" id="2825875">[</span><span class="ident" id="2825876">fieldStart</span><span class="op" id="2825886">:</span><span class="ident" id="2825887">i</span><span class="op" id="2825888">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825894">na</span><span class="op" id="2825896">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825903">fieldStart</span>&nbsp;<span class="op" id="2825914">=</span>&nbsp;<span class="op" id="2825916">-</span><span class="num" id="2825917">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2825922">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2825926">}</span>&nbsp;<span class="keyword" id="2825928">else</span>&nbsp;<span class="keyword" id="2825933">if</span>&nbsp;<span class="ident" id="2825936">fieldStart</span>&nbsp;<span class="op" id="2825947">==</span>&nbsp;<span class="op" id="2825950">-</span><span class="num" id="2825951">1</span>&nbsp;<span class="op" id="2825953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2825958">fieldStart</span>&nbsp;<span class="op" id="2825969">=</span>&nbsp;<span class="ident" id="2825971">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2825975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2825978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2825981">if</span>&nbsp;<span class="ident" id="2825984">fieldStart</span>&nbsp;<span class="op" id="2825995">&gt;=</span>&nbsp;<span class="num" id="2825998">0</span>&nbsp;<span class="op" id="2826000">{</span>&nbsp;<span class="comment" id="2826002">//&nbsp;Last&nbsp;field&nbsp;might&nbsp;end&nbsp;at&nbsp;EOF.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2826036">a</span><span class="op" id="2826037">[</span><span class="ident" id="2826038">na</span><span class="op" id="2826040">]</span>&nbsp;<span class="op" id="2826042">=</span>&nbsp;<span class="ident" id="2826044">s</span><span class="op" id="2826045">[</span><span class="ident" id="2826046">fieldStart</span><span class="op" id="2826056">:</span><span class="op" id="2826057">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2826060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2826063">return</span>&nbsp;<span class="ident" id="2826070">a</span><br>
<span class="lineno"></span><span class="op" id="2826072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="comment" id="2826075">//&nbsp;Join&nbsp;concatenates&nbsp;the&nbsp;elements&nbsp;of&nbsp;a&nbsp;to&nbsp;create&nbsp;a&nbsp;single&nbsp;string.&nbsp;&nbsp;&nbsp;The&nbsp;separator&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2826164">//&nbsp;sep&nbsp;is&nbsp;placed&nbsp;between&nbsp;elements&nbsp;in&nbsp;the&nbsp;resulting&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2826223">func</span>&nbsp;<span class="ident" id="2826228">Join</span><span class="op" id="2826232">(</span><span class="ident" id="2826233">a</span>&nbsp;<span class="op" id="2826235">[</span><span class="op" id="2826236">]</span><span class="builtintype" id="2826237">string</span><span class="op" id="2826243">,</span>&nbsp;<span class="ident" id="2826245">sep</span>&nbsp;<span class="builtintype" id="2826249">string</span><span class="op" id="2826255">)</span>&nbsp;<span class="builtintype" id="2826257">string</span>&nbsp;<span class="op" id="2826264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2826267">if</span>&nbsp;<span class="builtinfunc" id="2826270">len</span><span class="op" id="2826273">(</span><span class="ident" id="2826274">a</span><span class="op" id="2826275">)</span>&nbsp;<span class="op" id="2826277">==</span>&nbsp;<span class="num" id="2826280">0</span>&nbsp;<span class="op" id="2826282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2826286">return</span>&nbsp;<span class="string" id="2826293">&#34;&#34;</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2826297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2826300">if</span>&nbsp;<span class="builtinfunc" id="2826303">len</span><span class="op" id="2826306">(</span><span class="ident" id="2826307">a</span><span class="op" id="2826308">)</span>&nbsp;<span class="op" id="2826310">==</span>&nbsp;<span class="num" id="2826313">1</span>&nbsp;<span class="op" id="2826315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2826319">return</span>&nbsp;<span class="ident" id="2826326">a</span><span class="op" id="2826327">[</span><span class="num" id="2826328">0</span><span class="op" id="2826329">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2826332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2826335">n</span>&nbsp;<span class="op" id="2826337">:=</span>&nbsp;<span class="builtinfunc" id="2826340">len</span><span class="op" id="2826343">(</span><span class="ident" id="2826344">sep</span><span class="op" id="2826347">)</span>&nbsp;<span class="op" id="2826349">*</span>&nbsp;<span class="op" id="2826351">(</span><span class="builtinfunc" id="2826352">len</span><span class="op" id="2826355">(</span><span class="ident" id="2826356">a</span><span class="op" id="2826357">)</span>&nbsp;<span class="op" id="2826359">-</span>&nbsp;<span class="num" id="2826361">1</span><span class="op" id="2826362">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2826365">for</span>&nbsp;<span class="ident" id="2826369">i</span>&nbsp;<span class="op" id="2826371">:=</span>&nbsp;<span class="num" id="2826374">0</span><span class="op" id="2826375">;</span>&nbsp;<span class="ident" id="2826377">i</span>&nbsp;<span class="op" id="2826379">&lt;</span>&nbsp;<span class="builtinfunc" id="2826381">len</span><span class="op" id="2826384">(</span><span class="ident" id="2826385">a</span><span class="op" id="2826386">)</span><span class="op" id="2826387">;</span>&nbsp;<span class="ident" id="2826389">i</span><span class="op" id="2826390">++</span>&nbsp;<span class="op" id="2826393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2826397">n</span>&nbsp;<span class="op" id="2826399">+=</span>&nbsp;<span class="builtinfunc" id="2826402">len</span><span class="op" id="2826405">(</span><span class="ident" id="2826406">a</span><span class="op" id="2826407">[</span><span class="ident" id="2826408">i</span><span class="op" id="2826409">]</span><span class="op" id="2826410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2826413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2826417">b</span>&nbsp;<span class="op" id="2826419">:=</span>&nbsp;<span class="builtinfunc" id="2826422">make</span><span class="op" id="2826426">(</span><span class="op" id="2826427">[</span><span class="op" id="2826428">]</span><span class="builtintype" id="2826429">byte</span><span class="op" id="2826433">,</span>&nbsp;<span class="ident" id="2826435">n</span><span class="op" id="2826436">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2826439">bp</span>&nbsp;<span class="op" id="2826442">:=</span>&nbsp;<span class="builtinfunc" id="2826445">copy</span><span class="op" id="2826449">(</span><span class="ident" id="2826450">b</span><span class="op" id="2826451">,</span>&nbsp;<span class="ident" id="2826453">a</span><span class="op" id="2826454">[</span><span class="num" id="2826455">0</span><span class="op" id="2826456">]</span><span class="op" id="2826457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2826460">for</span>&nbsp;<span class="ident" id="2826464">_</span><span class="op" id="2826465">,</span>&nbsp;<span class="ident" id="2826467">s</span>&nbsp;<span class="op" id="2826469">:=</span>&nbsp;<span class="keyword" id="2826472">range</span>&nbsp;<span class="ident" id="2826478">a</span><span class="op" id="2826479">[</span><span class="num" id="2826480">1</span><span class="op" id="2826481">:</span><span class="op" id="2826482">]</span>&nbsp;<span class="op" id="2826484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2826488">bp</span>&nbsp;<span class="op" id="2826491">+=</span>&nbsp;<span class="builtinfunc" id="2826494">copy</span><span class="op" id="2826498">(</span><span class="ident" id="2826499">b</span><span class="op" id="2826500">[</span><span class="ident" id="2826501">bp</span><span class="op" id="2826503">:</span><span class="op" id="2826504">]</span><span class="op" id="2826505">,</span>&nbsp;<span class="ident" id="2826507">sep</span><span class="op" id="2826510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2826514">bp</span>&nbsp;<span class="op" id="2826517">+=</span>&nbsp;<span class="builtinfunc" id="2826520">copy</span><span class="op" id="2826524">(</span><span class="ident" id="2826525">b</span><span class="op" id="2826526">[</span><span class="ident" id="2826527">bp</span><span class="op" id="2826529">:</span><span class="op" id="2826530">]</span><span class="op" id="2826531">,</span>&nbsp;<span class="ident" id="2826533">s</span><span class="op" id="2826534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2826537">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2826540">return</span>&nbsp;<span class="builtintype" id="2826547">string</span><span class="op" id="2826553">(</span><span class="ident" id="2826554">b</span><span class="op" id="2826555">)</span><br>
<span class="lineno"></span><span class="op" id="2826557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2826560">//&nbsp;HasPrefix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;begins&nbsp;with&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="2826620">func</span>&nbsp;<span class="ident" id="2826625">HasPrefix</span><span class="op" id="2826634">(</span><span class="ident" id="2826635">s</span><span class="op" id="2826636">,</span>&nbsp;<span class="ident" id="2826638">prefix</span>&nbsp;<span class="builtintype" id="2826645">string</span><span class="op" id="2826651">)</span>&nbsp;<span class="builtintype" id="2826653">bool</span>&nbsp;<span class="op" id="2826658">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2826661">return</span>&nbsp;<span class="builtinfunc" id="2826668">len</span><span class="op" id="2826671">(</span><span class="ident" id="2826672">s</span><span class="op" id="2826673">)</span>&nbsp;<span class="op" id="2826675">&gt;=</span>&nbsp;<span class="builtinfunc" id="2826678">len</span><span class="op" id="2826681">(</span><span class="ident" id="2826682">prefix</span><span class="op" id="2826688">)</span>&nbsp;<span class="op" id="2826690">&amp;&amp;</span>&nbsp;<span class="ident" id="2826693">s</span><span class="op" id="2826694">[</span><span class="num" id="2826695">0</span><span class="op" id="2826696">:</span><span class="builtinfunc" id="2826697">len</span><span class="op" id="2826700">(</span><span class="ident" id="2826701">prefix</span><span class="op" id="2826707">)</span><span class="op" id="2826708">]</span>&nbsp;<span class="op" id="2826710">==</span>&nbsp;<span class="ident" id="2826713">prefix</span><br>
<span class="lineno"></span><span class="op" id="2826720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2826723">//&nbsp;HasSuffix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;ends&nbsp;with&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="2826781">func</span>&nbsp;<span class="ident" id="2826786">HasSuffix</span><span class="op" id="2826795">(</span><span class="ident" id="2826796">s</span><span class="op" id="2826797">,</span>&nbsp;<span class="ident" id="2826799">suffix</span>&nbsp;<span class="builtintype" id="2826806">string</span><span class="op" id="2826812">)</span>&nbsp;<span class="builtintype" id="2826814">bool</span>&nbsp;<span class="op" id="2826819">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2826822">return</span>&nbsp;<span class="builtinfunc" id="2826829">len</span><span class="op" id="2826832">(</span><span class="ident" id="2826833">s</span><span class="op" id="2826834">)</span>&nbsp;<span class="op" id="2826836">&gt;=</span>&nbsp;<span class="builtinfunc" id="2826839">len</span><span class="op" id="2826842">(</span><span class="ident" id="2826843">suffix</span><span class="op" id="2826849">)</span>&nbsp;<span class="op" id="2826851">&amp;&amp;</span>&nbsp;<span class="ident" id="2826854">s</span><span class="op" id="2826855">[</span><span class="builtinfunc" id="2826856">len</span><span class="op" id="2826859">(</span><span class="ident" id="2826860">s</span><span class="op" id="2826861">)</span><span class="op" id="2826862">-</span><span class="builtinfunc" id="2826863">len</span><span class="op" id="2826866">(</span><span class="ident" id="2826867">suffix</span><span class="op" id="2826873">)</span><span class="op" id="2826874">:</span><span class="op" id="2826875">]</span>&nbsp;<span class="op" id="2826877">==</span>&nbsp;<span class="ident" id="2826880">suffix</span><br>
<span class="lineno"></span><span class="op" id="2826887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2826890">//&nbsp;Map&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;its&nbsp;characters&nbsp;modified</span><br>
<span class="lineno"></span><span class="comment" id="2826961">//&nbsp;according&nbsp;to&nbsp;the&nbsp;mapping&nbsp;function.&nbsp;If&nbsp;mapping&nbsp;returns&nbsp;a&nbsp;negative&nbsp;value,&nbsp;the&nbsp;character&nbsp;is</span><br>
<span class="lineno">415</span><span class="comment" id="2827053">//&nbsp;dropped&nbsp;from&nbsp;the&nbsp;string&nbsp;with&nbsp;no&nbsp;replacement.</span><br>
<span class="lineno"></span><span class="keyword" id="2827101">func</span>&nbsp;<span class="ident" id="2827106">Map</span><span class="op" id="2827109">(</span><span class="ident" id="2827110">mapping</span>&nbsp;<span class="keyword" id="2827118">func</span><span class="op" id="2827122">(</span><span class="builtintype" id="2827123">rune</span><span class="op" id="2827127">)</span>&nbsp;<span class="builtintype" id="2827129">rune</span><span class="op" id="2827133">,</span>&nbsp;<span class="ident" id="2827135">s</span>&nbsp;<span class="builtintype" id="2827137">string</span><span class="op" id="2827143">)</span>&nbsp;<span class="builtintype" id="2827145">string</span>&nbsp;<span class="op" id="2827152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2827155">//&nbsp;In&nbsp;the&nbsp;worst&nbsp;case,&nbsp;the&nbsp;string&nbsp;can&nbsp;grow&nbsp;when&nbsp;mapped,&nbsp;making</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2827218">//&nbsp;things&nbsp;unpleasant.&nbsp;&nbsp;But&nbsp;it&#39;s&nbsp;so&nbsp;rare&nbsp;we&nbsp;barge&nbsp;in&nbsp;assuming&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2827285">//&nbsp;fine.&nbsp;&nbsp;It&nbsp;could&nbsp;also&nbsp;shrink&nbsp;but&nbsp;that&nbsp;falls&nbsp;out&nbsp;naturally.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2827347">maxbytes</span>&nbsp;<span class="op" id="2827356">:=</span>&nbsp;<span class="builtinfunc" id="2827359">len</span><span class="op" id="2827362">(</span><span class="ident" id="2827363">s</span><span class="op" id="2827364">)</span>&nbsp;<span class="comment" id="2827366">//&nbsp;length&nbsp;of&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2827382">nbytes</span>&nbsp;<span class="op" id="2827389">:=</span>&nbsp;<span class="num" id="2827392">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2827401">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;encoded&nbsp;in&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2827434">//&nbsp;The&nbsp;output&nbsp;buffer&nbsp;b&nbsp;is&nbsp;initialized&nbsp;on&nbsp;demand,&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2827494">//&nbsp;time&nbsp;a&nbsp;character&nbsp;differs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2827524">var</span>&nbsp;<span class="ident" id="2827528">b</span>&nbsp;<span class="op" id="2827530">[</span><span class="op" id="2827531">]</span><span class="builtintype" id="2827532">byte</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2827539">for</span>&nbsp;<span class="ident" id="2827543">i</span><span class="op" id="2827544">,</span>&nbsp;<span class="ident" id="2827546">c</span>&nbsp;<span class="op" id="2827548">:=</span>&nbsp;<span class="keyword" id="2827551">range</span>&nbsp;<span class="ident" id="2827557">s</span>&nbsp;<span class="op" id="2827559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2827563">r</span>&nbsp;<span class="op" id="2827565">:=</span>&nbsp;<span class="ident" id="2827568">mapping</span><span class="op" id="2827575">(</span><span class="ident" id="2827576">c</span><span class="op" id="2827577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2827581">if</span>&nbsp;<span class="ident" id="2827584">b</span>&nbsp;<span class="op" id="2827586">==</span>&nbsp;<span class="ident" id="2827589">nil</span>&nbsp;<span class="op" id="2827593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2827598">if</span>&nbsp;<span class="ident" id="2827601">r</span>&nbsp;<span class="op" id="2827603">==</span>&nbsp;<span class="ident" id="2827606">c</span>&nbsp;<span class="op" id="2827608">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2827614">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2827626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2827631">b</span>&nbsp;<span class="op" id="2827633">=</span>&nbsp;<span class="builtinfunc" id="2827635">make</span><span class="op" id="2827639">(</span><span class="op" id="2827640">[</span><span class="op" id="2827641">]</span><span class="builtintype" id="2827642">byte</span><span class="op" id="2827646">,</span>&nbsp;<span class="ident" id="2827648">maxbytes</span><span class="op" id="2827656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2827661">nbytes</span>&nbsp;<span class="op" id="2827668">=</span>&nbsp;<span class="builtinfunc" id="2827670">copy</span><span class="op" id="2827674">(</span><span class="ident" id="2827675">b</span><span class="op" id="2827676">,</span>&nbsp;<span class="ident" id="2827678">s</span><span class="op" id="2827679">[</span><span class="op" id="2827680">:</span><span class="ident" id="2827681">i</span><span class="op" id="2827682">]</span><span class="op" id="2827683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2827687">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2827691">if</span>&nbsp;<span class="ident" id="2827694">r</span>&nbsp;<span class="op" id="2827696">&gt;=</span>&nbsp;<span class="num" id="2827699">0</span>&nbsp;<span class="op" id="2827701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2827706">wid</span>&nbsp;<span class="op" id="2827710">:=</span>&nbsp;<span class="num" id="2827713">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2827718">if</span>&nbsp;<span class="ident" id="2827721">r</span>&nbsp;<span class="op" id="2827723">&gt;=</span>&nbsp;<span class="ident" id="2827726">utf8</span><span class="op" id="2827730">.</span><span class="ident" id="2827731">RuneSelf</span>&nbsp;<span class="op" id="2827740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2827746">wid</span>&nbsp;<span class="op" id="2827750">=</span>&nbsp;<span class="ident" id="2827752">utf8</span><span class="op" id="2827756">.</span><span class="ident" id="2827757">RuneLen</span><span class="op" id="2827764">(</span><span class="ident" id="2827765">r</span><span class="op" id="2827766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2827771">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2827776">if</span>&nbsp;<span class="ident" id="2827779">nbytes</span><span class="op" id="2827785">+</span><span class="ident" id="2827786">wid</span>&nbsp;<span class="op" id="2827790">&gt;</span>&nbsp;<span class="ident" id="2827792">maxbytes</span>&nbsp;<span class="op" id="2827801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2827807">//&nbsp;Grow&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2827831">maxbytes</span>&nbsp;<span class="op" id="2827840">=</span>&nbsp;<span class="ident" id="2827842">maxbytes</span><span class="op" id="2827850">*</span><span class="num" id="2827851">2</span>&nbsp;<span class="op" id="2827853">+</span>&nbsp;<span class="ident" id="2827855">utf8</span><span class="op" id="2827859">.</span><span class="ident" id="2827860">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2827871">nb</span>&nbsp;<span class="op" id="2827874">:=</span>&nbsp;<span class="builtinfunc" id="2827877">make</span><span class="op" id="2827881">(</span><span class="op" id="2827882">[</span><span class="op" id="2827883">]</span><span class="builtintype" id="2827884">byte</span><span class="op" id="2827888">,</span>&nbsp;<span class="ident" id="2827890">maxbytes</span><span class="op" id="2827898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2827904">copy</span><span class="op" id="2827908">(</span><span class="ident" id="2827909">nb</span><span class="op" id="2827911">,</span>&nbsp;<span class="ident" id="2827913">b</span><span class="op" id="2827914">[</span><span class="num" id="2827915">0</span><span class="op" id="2827916">:</span><span class="ident" id="2827917">nbytes</span><span class="op" id="2827923">]</span><span class="op" id="2827924">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2827930">b</span>&nbsp;<span class="op" id="2827932">=</span>&nbsp;<span class="ident" id="2827934">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2827940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2827945">nbytes</span>&nbsp;<span class="op" id="2827952">+=</span>&nbsp;<span class="ident" id="2827955">utf8</span><span class="op" id="2827959">.</span><span class="ident" id="2827960">EncodeRune</span><span class="op" id="2827970">(</span><span class="ident" id="2827971">b</span><span class="op" id="2827972">[</span><span class="ident" id="2827973">nbytes</span><span class="op" id="2827979">:</span><span class="ident" id="2827980">maxbytes</span><span class="op" id="2827988">]</span><span class="op" id="2827989">,</span>&nbsp;<span class="ident" id="2827991">r</span><span class="op" id="2827992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2827996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2827999">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2828002">if</span>&nbsp;<span class="ident" id="2828005">b</span>&nbsp;<span class="op" id="2828007">==</span>&nbsp;<span class="ident" id="2828010">nil</span>&nbsp;<span class="op" id="2828014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2828018">return</span>&nbsp;<span class="ident" id="2828025">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2828028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2828031">return</span>&nbsp;<span class="builtintype" id="2828038">string</span><span class="op" id="2828044">(</span><span class="ident" id="2828045">b</span><span class="op" id="2828046">[</span><span class="num" id="2828047">0</span><span class="op" id="2828048">:</span><span class="ident" id="2828049">nbytes</span><span class="op" id="2828055">]</span><span class="op" id="2828056">)</span><br>
<span class="lineno"></span><span class="op" id="2828058">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="2828061">//&nbsp;Repeat&nbsp;returns&nbsp;a&nbsp;new&nbsp;string&nbsp;consisting&nbsp;of&nbsp;count&nbsp;copies&nbsp;of&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2828136">func</span>&nbsp;<span class="ident" id="2828141">Repeat</span><span class="op" id="2828147">(</span><span class="ident" id="2828148">s</span>&nbsp;<span class="builtintype" id="2828150">string</span><span class="op" id="2828156">,</span>&nbsp;<span class="ident" id="2828158">count</span>&nbsp;<span class="builtintype" id="2828164">int</span><span class="op" id="2828167">)</span>&nbsp;<span class="builtintype" id="2828169">string</span>&nbsp;<span class="op" id="2828176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2828179">b</span>&nbsp;<span class="op" id="2828181">:=</span>&nbsp;<span class="builtinfunc" id="2828184">make</span><span class="op" id="2828188">(</span><span class="op" id="2828189">[</span><span class="op" id="2828190">]</span><span class="builtintype" id="2828191">byte</span><span class="op" id="2828195">,</span>&nbsp;<span class="builtinfunc" id="2828197">len</span><span class="op" id="2828200">(</span><span class="ident" id="2828201">s</span><span class="op" id="2828202">)</span><span class="op" id="2828203">*</span><span class="ident" id="2828204">count</span><span class="op" id="2828209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2828212">bp</span>&nbsp;<span class="op" id="2828215">:=</span>&nbsp;<span class="builtinfunc" id="2828218">copy</span><span class="op" id="2828222">(</span><span class="ident" id="2828223">b</span><span class="op" id="2828224">,</span>&nbsp;<span class="ident" id="2828226">s</span><span class="op" id="2828227">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2828230">for</span>&nbsp;<span class="ident" id="2828234">bp</span>&nbsp;<span class="op" id="2828237">&lt;</span>&nbsp;<span class="builtinfunc" id="2828239">len</span><span class="op" id="2828242">(</span><span class="ident" id="2828243">b</span><span class="op" id="2828244">)</span>&nbsp;<span class="op" id="2828246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2828250">copy</span><span class="op" id="2828254">(</span><span class="ident" id="2828255">b</span><span class="op" id="2828256">[</span><span class="ident" id="2828257">bp</span><span class="op" id="2828259">:</span><span class="op" id="2828260">]</span><span class="op" id="2828261">,</span>&nbsp;<span class="ident" id="2828263">b</span><span class="op" id="2828264">[</span><span class="op" id="2828265">:</span><span class="ident" id="2828266">bp</span><span class="op" id="2828268">]</span><span class="op" id="2828269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2828273">bp</span>&nbsp;<span class="op" id="2828276">*=</span>&nbsp;<span class="num" id="2828279">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2828282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2828285">return</span>&nbsp;<span class="builtintype" id="2828292">string</span><span class="op" id="2828298">(</span><span class="ident" id="2828299">b</span><span class="op" id="2828300">)</span><br>
<span class="lineno">465</span><span class="op" id="2828302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2828305">//&nbsp;ToUpper&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;upper&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2828400">func</span>&nbsp;<span class="ident" id="2828405">ToUpper</span><span class="op" id="2828412">(</span><span class="ident" id="2828413">s</span>&nbsp;<span class="builtintype" id="2828415">string</span><span class="op" id="2828421">)</span>&nbsp;<span class="builtintype" id="2828423">string</span>&nbsp;<span class="op" id="2828430">{</span>&nbsp;<span class="keyword" id="2828432">return</span>&nbsp;<span class="ident" id="2828439">Map</span><span class="op" id="2828442">(</span><span class="ident" id="2828443">unicode</span><span class="op" id="2828450">.</span><span class="ident" id="2828451">ToUpper</span><span class="op" id="2828458">,</span>&nbsp;<span class="ident" id="2828460">s</span><span class="op" id="2828461">)</span>&nbsp;<span class="op" id="2828463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="2828466">//&nbsp;ToLower&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2828561">func</span>&nbsp;<span class="ident" id="2828566">ToLower</span><span class="op" id="2828573">(</span><span class="ident" id="2828574">s</span>&nbsp;<span class="builtintype" id="2828576">string</span><span class="op" id="2828582">)</span>&nbsp;<span class="builtintype" id="2828584">string</span>&nbsp;<span class="op" id="2828591">{</span>&nbsp;<span class="keyword" id="2828593">return</span>&nbsp;<span class="ident" id="2828600">Map</span><span class="op" id="2828603">(</span><span class="ident" id="2828604">unicode</span><span class="op" id="2828611">.</span><span class="ident" id="2828612">ToLower</span><span class="op" id="2828619">,</span>&nbsp;<span class="ident" id="2828621">s</span><span class="op" id="2828622">)</span>&nbsp;<span class="op" id="2828624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2828627">//&nbsp;ToTitle&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2828722">func</span>&nbsp;<span class="ident" id="2828727">ToTitle</span><span class="op" id="2828734">(</span><span class="ident" id="2828735">s</span>&nbsp;<span class="builtintype" id="2828737">string</span><span class="op" id="2828743">)</span>&nbsp;<span class="builtintype" id="2828745">string</span>&nbsp;<span class="op" id="2828752">{</span>&nbsp;<span class="keyword" id="2828754">return</span>&nbsp;<span class="ident" id="2828761">Map</span><span class="op" id="2828764">(</span><span class="ident" id="2828765">unicode</span><span class="op" id="2828772">.</span><span class="ident" id="2828773">ToTitle</span><span class="op" id="2828780">,</span>&nbsp;<span class="ident" id="2828782">s</span><span class="op" id="2828783">)</span>&nbsp;<span class="op" id="2828785">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="2828788">//&nbsp;ToUpperSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2828878">//&nbsp;upper&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2828938">func</span>&nbsp;<span class="ident" id="2828943">ToUpperSpecial</span><span class="op" id="2828957">(</span><span class="ident" id="2828958">_case</span>&nbsp;<span class="ident" id="2828964">unicode</span><span class="op" id="2828971">.</span><span class="ident" id="2828972">SpecialCase</span><span class="op" id="2828983">,</span>&nbsp;<span class="ident" id="2828985">s</span>&nbsp;<span class="builtintype" id="2828987">string</span><span class="op" id="2828993">)</span>&nbsp;<span class="builtintype" id="2828995">string</span>&nbsp;<span class="op" id="2829002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2829005">return</span>&nbsp;<span class="ident" id="2829012">Map</span><span class="op" id="2829015">(</span><span class="keyword" id="2829016">func</span><span class="op" id="2829020">(</span><span class="ident" id="2829021">r</span>&nbsp;<span class="builtintype" id="2829023">rune</span><span class="op" id="2829027">)</span>&nbsp;<span class="builtintype" id="2829029">rune</span>&nbsp;<span class="op" id="2829034">{</span>&nbsp;<span class="keyword" id="2829036">return</span>&nbsp;<span class="ident" id="2829043">_case</span><span class="op" id="2829048">.</span><span class="ident" id="2829049">ToUpper</span><span class="op" id="2829056">(</span><span class="ident" id="2829057">r</span><span class="op" id="2829058">)</span>&nbsp;<span class="op" id="2829060">}</span><span class="op" id="2829061">,</span>&nbsp;<span class="ident" id="2829063">s</span><span class="op" id="2829064">)</span><br>
<span class="lineno">480</span><span class="op" id="2829066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2829069">//&nbsp;ToLowerSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2829159">//&nbsp;lower&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2829219">func</span>&nbsp;<span class="ident" id="2829224">ToLowerSpecial</span><span class="op" id="2829238">(</span><span class="ident" id="2829239">_case</span>&nbsp;<span class="ident" id="2829245">unicode</span><span class="op" id="2829252">.</span><span class="ident" id="2829253">SpecialCase</span><span class="op" id="2829264">,</span>&nbsp;<span class="ident" id="2829266">s</span>&nbsp;<span class="builtintype" id="2829268">string</span><span class="op" id="2829274">)</span>&nbsp;<span class="builtintype" id="2829276">string</span>&nbsp;<span class="op" id="2829283">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2829286">return</span>&nbsp;<span class="ident" id="2829293">Map</span><span class="op" id="2829296">(</span><span class="keyword" id="2829297">func</span><span class="op" id="2829301">(</span><span class="ident" id="2829302">r</span>&nbsp;<span class="builtintype" id="2829304">rune</span><span class="op" id="2829308">)</span>&nbsp;<span class="builtintype" id="2829310">rune</span>&nbsp;<span class="op" id="2829315">{</span>&nbsp;<span class="keyword" id="2829317">return</span>&nbsp;<span class="ident" id="2829324">_case</span><span class="op" id="2829329">.</span><span class="ident" id="2829330">ToLower</span><span class="op" id="2829337">(</span><span class="ident" id="2829338">r</span><span class="op" id="2829339">)</span>&nbsp;<span class="op" id="2829341">}</span><span class="op" id="2829342">,</span>&nbsp;<span class="ident" id="2829344">s</span><span class="op" id="2829345">)</span><br>
<span class="lineno"></span><span class="op" id="2829347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2829350">//&nbsp;ToTitleSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2829440">//&nbsp;title&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno">490</span><span class="keyword" id="2829500">func</span>&nbsp;<span class="ident" id="2829505">ToTitleSpecial</span><span class="op" id="2829519">(</span><span class="ident" id="2829520">_case</span>&nbsp;<span class="ident" id="2829526">unicode</span><span class="op" id="2829533">.</span><span class="ident" id="2829534">SpecialCase</span><span class="op" id="2829545">,</span>&nbsp;<span class="ident" id="2829547">s</span>&nbsp;<span class="builtintype" id="2829549">string</span><span class="op" id="2829555">)</span>&nbsp;<span class="builtintype" id="2829557">string</span>&nbsp;<span class="op" id="2829564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2829567">return</span>&nbsp;<span class="ident" id="2829574">Map</span><span class="op" id="2829577">(</span><span class="keyword" id="2829578">func</span><span class="op" id="2829582">(</span><span class="ident" id="2829583">r</span>&nbsp;<span class="builtintype" id="2829585">rune</span><span class="op" id="2829589">)</span>&nbsp;<span class="builtintype" id="2829591">rune</span>&nbsp;<span class="op" id="2829596">{</span>&nbsp;<span class="keyword" id="2829598">return</span>&nbsp;<span class="ident" id="2829605">_case</span><span class="op" id="2829610">.</span><span class="ident" id="2829611">ToTitle</span><span class="op" id="2829618">(</span><span class="ident" id="2829619">r</span><span class="op" id="2829620">)</span>&nbsp;<span class="op" id="2829622">}</span><span class="op" id="2829623">,</span>&nbsp;<span class="ident" id="2829625">s</span><span class="op" id="2829626">)</span><br>
<span class="lineno"></span><span class="op" id="2829628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2829631">//&nbsp;isSeparator&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;could&nbsp;mark&nbsp;a&nbsp;word&nbsp;boundary.</span><br>
<span class="lineno">495</span><span class="comment" id="2829699">//&nbsp;TODO:&nbsp;update&nbsp;when&nbsp;package&nbsp;unicode&nbsp;captures&nbsp;more&nbsp;of&nbsp;the&nbsp;properties.</span><br>
<span class="lineno"></span><span class="keyword" id="2829769">func</span>&nbsp;<span class="ident" id="2829774">isSeparator</span><span class="op" id="2829785">(</span><span class="ident" id="2829786">r</span>&nbsp;<span class="builtintype" id="2829788">rune</span><span class="op" id="2829792">)</span>&nbsp;<span class="builtintype" id="2829794">bool</span>&nbsp;<span class="op" id="2829799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2829802">//&nbsp;ASCII&nbsp;alphanumerics&nbsp;and&nbsp;underscore&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2829860">if</span>&nbsp;<span class="ident" id="2829863">r</span>&nbsp;<span class="op" id="2829865">&lt;=</span>&nbsp;<span class="num" id="2829868">0x7F</span>&nbsp;<span class="op" id="2829873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2829877">switch</span>&nbsp;<span class="op" id="2829884">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2829888">case</span>&nbsp;<span class="string" id="2829893">&#39;0&#39;</span>&nbsp;<span class="op" id="2829897">&lt;=</span>&nbsp;<span class="ident" id="2829900">r</span>&nbsp;<span class="op" id="2829902">&amp;&amp;</span>&nbsp;<span class="ident" id="2829905">r</span>&nbsp;<span class="op" id="2829907">&lt;=</span>&nbsp;<span class="string" id="2829910">&#39;9&#39;</span><span class="op" id="2829913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2829918">return</span>&nbsp;<span class="builtintype" id="2829925">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2829933">case</span>&nbsp;<span class="string" id="2829938">&#39;a&#39;</span>&nbsp;<span class="op" id="2829942">&lt;=</span>&nbsp;<span class="ident" id="2829945">r</span>&nbsp;<span class="op" id="2829947">&amp;&amp;</span>&nbsp;<span class="ident" id="2829950">r</span>&nbsp;<span class="op" id="2829952">&lt;=</span>&nbsp;<span class="string" id="2829955">&#39;z&#39;</span><span class="op" id="2829958">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2829963">return</span>&nbsp;<span class="builtintype" id="2829970">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2829978">case</span>&nbsp;<span class="string" id="2829983">&#39;A&#39;</span>&nbsp;<span class="op" id="2829987">&lt;=</span>&nbsp;<span class="ident" id="2829990">r</span>&nbsp;<span class="op" id="2829992">&amp;&amp;</span>&nbsp;<span class="ident" id="2829995">r</span>&nbsp;<span class="op" id="2829997">&lt;=</span>&nbsp;<span class="string" id="2830000">&#39;Z&#39;</span><span class="op" id="2830003">:</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830008">return</span>&nbsp;<span class="builtintype" id="2830015">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830023">case</span>&nbsp;<span class="ident" id="2830028">r</span>&nbsp;<span class="op" id="2830030">==</span>&nbsp;<span class="string" id="2830033">&#39;_&#39;</span><span class="op" id="2830036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830041">return</span>&nbsp;<span class="builtintype" id="2830048">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2830056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830060">return</span>&nbsp;<span class="builtintype" id="2830067">true</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2830073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2830076">//&nbsp;Letters&nbsp;and&nbsp;digits&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830118">if</span>&nbsp;<span class="ident" id="2830121">unicode</span><span class="op" id="2830128">.</span><span class="ident" id="2830129">IsLetter</span><span class="op" id="2830137">(</span><span class="ident" id="2830138">r</span><span class="op" id="2830139">)</span>&nbsp;<span class="op" id="2830141">||</span>&nbsp;<span class="ident" id="2830144">unicode</span><span class="op" id="2830151">.</span><span class="ident" id="2830152">IsDigit</span><span class="op" id="2830159">(</span><span class="ident" id="2830160">r</span><span class="op" id="2830161">)</span>&nbsp;<span class="op" id="2830163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830167">return</span>&nbsp;<span class="builtintype" id="2830174">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2830181">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2830184">//&nbsp;Otherwise,&nbsp;all&nbsp;we&nbsp;can&nbsp;do&nbsp;for&nbsp;now&nbsp;is&nbsp;treat&nbsp;spaces&nbsp;as&nbsp;separators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830252">return</span>&nbsp;<span class="ident" id="2830259">unicode</span><span class="op" id="2830266">.</span><span class="ident" id="2830267">IsSpace</span><span class="op" id="2830274">(</span><span class="ident" id="2830275">r</span><span class="op" id="2830276">)</span><br>
<span class="lineno"></span><span class="op" id="2830278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2830281">//&nbsp;Title&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;that&nbsp;begin&nbsp;words</span><br>
<span class="lineno">520</span><span class="comment" id="2830363">//&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="comment" id="2830394">//</span><br>
<span class="lineno"></span><span class="comment" id="2830397">//&nbsp;BUG:&nbsp;The&nbsp;rule&nbsp;Title&nbsp;uses&nbsp;for&nbsp;word&nbsp;boundaries&nbsp;does&nbsp;not&nbsp;handle&nbsp;Unicode&nbsp;punctuation&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2830491">func</span>&nbsp;<span class="ident" id="2830496">Title</span><span class="op" id="2830501">(</span><span class="ident" id="2830502">s</span>&nbsp;<span class="builtintype" id="2830504">string</span><span class="op" id="2830510">)</span>&nbsp;<span class="builtintype" id="2830512">string</span>&nbsp;<span class="op" id="2830519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2830522">//&nbsp;Use&nbsp;a&nbsp;closure&nbsp;here&nbsp;to&nbsp;remember&nbsp;state.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2830564">//&nbsp;Hackish&nbsp;but&nbsp;effective.&nbsp;Depends&nbsp;on&nbsp;Map&nbsp;scanning&nbsp;in&nbsp;order&nbsp;and&nbsp;calling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2830636">//&nbsp;the&nbsp;closure&nbsp;once&nbsp;per&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2830667">prev</span>&nbsp;<span class="op" id="2830672">:=</span>&nbsp;<span class="string" id="2830675">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830680">return</span>&nbsp;<span class="ident" id="2830687">Map</span><span class="op" id="2830690">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830694">func</span><span class="op" id="2830698">(</span><span class="ident" id="2830699">r</span>&nbsp;<span class="builtintype" id="2830701">rune</span><span class="op" id="2830705">)</span>&nbsp;<span class="builtintype" id="2830707">rune</span>&nbsp;<span class="op" id="2830712">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830717">if</span>&nbsp;<span class="ident" id="2830720">isSeparator</span><span class="op" id="2830731">(</span><span class="ident" id="2830732">prev</span><span class="op" id="2830736">)</span>&nbsp;<span class="op" id="2830738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2830744">prev</span>&nbsp;<span class="op" id="2830749">=</span>&nbsp;<span class="ident" id="2830751">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830757">return</span>&nbsp;<span class="ident" id="2830764">unicode</span><span class="op" id="2830771">.</span><span class="ident" id="2830772">ToTitle</span><span class="op" id="2830779">(</span><span class="ident" id="2830780">r</span><span class="op" id="2830781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2830786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2830791">prev</span>&nbsp;<span class="op" id="2830796">=</span>&nbsp;<span class="ident" id="2830798">r</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2830803">return</span>&nbsp;<span class="ident" id="2830810">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2830814">}</span><span class="op" id="2830815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2830819">s</span><span class="op" id="2830820">)</span><br>
<span class="lineno"></span><span class="op" id="2830822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="2830825">//&nbsp;TrimLeftFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2830890">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2830940">func</span>&nbsp;<span class="ident" id="2830945">TrimLeftFunc</span><span class="op" id="2830957">(</span><span class="ident" id="2830958">s</span>&nbsp;<span class="builtintype" id="2830960">string</span><span class="op" id="2830966">,</span>&nbsp;<span class="ident" id="2830968">f</span>&nbsp;<span class="keyword" id="2830970">func</span><span class="op" id="2830974">(</span><span class="builtintype" id="2830975">rune</span><span class="op" id="2830979">)</span>&nbsp;<span class="builtintype" id="2830981">bool</span><span class="op" id="2830985">)</span>&nbsp;<span class="builtintype" id="2830987">string</span>&nbsp;<span class="op" id="2830994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2830997">i</span>&nbsp;<span class="op" id="2830999">:=</span>&nbsp;<span class="ident" id="2831002">indexFunc</span><span class="op" id="2831011">(</span><span class="ident" id="2831012">s</span><span class="op" id="2831013">,</span>&nbsp;<span class="ident" id="2831015">f</span><span class="op" id="2831016">,</span>&nbsp;<span class="builtintype" id="2831018">false</span><span class="op" id="2831023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2831026">if</span>&nbsp;<span class="ident" id="2831029">i</span>&nbsp;<span class="op" id="2831031">==</span>&nbsp;<span class="op" id="2831034">-</span><span class="num" id="2831035">1</span>&nbsp;<span class="op" id="2831037">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2831041">return</span>&nbsp;<span class="string" id="2831048">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2831052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2831055">return</span>&nbsp;<span class="ident" id="2831062">s</span><span class="op" id="2831063">[</span><span class="ident" id="2831064">i</span><span class="op" id="2831065">:</span><span class="op" id="2831066">]</span><br>
<span class="lineno"></span><span class="op" id="2831068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">550</span><span class="comment" id="2831071">//&nbsp;TrimRightFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2831138">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2831188">func</span>&nbsp;<span class="ident" id="2831193">TrimRightFunc</span><span class="op" id="2831206">(</span><span class="ident" id="2831207">s</span>&nbsp;<span class="builtintype" id="2831209">string</span><span class="op" id="2831215">,</span>&nbsp;<span class="ident" id="2831217">f</span>&nbsp;<span class="keyword" id="2831219">func</span><span class="op" id="2831223">(</span><span class="builtintype" id="2831224">rune</span><span class="op" id="2831228">)</span>&nbsp;<span class="builtintype" id="2831230">bool</span><span class="op" id="2831234">)</span>&nbsp;<span class="builtintype" id="2831236">string</span>&nbsp;<span class="op" id="2831243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2831246">i</span>&nbsp;<span class="op" id="2831248">:=</span>&nbsp;<span class="ident" id="2831251">lastIndexFunc</span><span class="op" id="2831264">(</span><span class="ident" id="2831265">s</span><span class="op" id="2831266">,</span>&nbsp;<span class="ident" id="2831268">f</span><span class="op" id="2831269">,</span>&nbsp;<span class="builtintype" id="2831271">false</span><span class="op" id="2831276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2831279">if</span>&nbsp;<span class="ident" id="2831282">i</span>&nbsp;<span class="op" id="2831284">&gt;=</span>&nbsp;<span class="num" id="2831287">0</span>&nbsp;<span class="op" id="2831289">&amp;&amp;</span>&nbsp;<span class="ident" id="2831292">s</span><span class="op" id="2831293">[</span><span class="ident" id="2831294">i</span><span class="op" id="2831295">]</span>&nbsp;<span class="op" id="2831297">&gt;=</span>&nbsp;<span class="ident" id="2831300">utf8</span><span class="op" id="2831304">.</span><span class="ident" id="2831305">RuneSelf</span>&nbsp;<span class="op" id="2831314">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2831318">_</span><span class="op" id="2831319">,</span>&nbsp;<span class="ident" id="2831321">wid</span>&nbsp;<span class="op" id="2831325">:=</span>&nbsp;<span class="ident" id="2831328">utf8</span><span class="op" id="2831332">.</span><span class="ident" id="2831333">DecodeRuneInString</span><span class="op" id="2831351">(</span><span class="ident" id="2831352">s</span><span class="op" id="2831353">[</span><span class="ident" id="2831354">i</span><span class="op" id="2831355">:</span><span class="op" id="2831356">]</span><span class="op" id="2831357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2831361">i</span>&nbsp;<span class="op" id="2831363">+=</span>&nbsp;<span class="ident" id="2831366">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2831371">}</span>&nbsp;<span class="keyword" id="2831373">else</span>&nbsp;<span class="op" id="2831378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2831382">i</span><span class="op" id="2831383">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2831387">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2831390">return</span>&nbsp;<span class="ident" id="2831397">s</span><span class="op" id="2831398">[</span><span class="num" id="2831399">0</span><span class="op" id="2831400">:</span><span class="ident" id="2831401">i</span><span class="op" id="2831402">]</span><br>
<span class="lineno"></span><span class="op" id="2831404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2831407">//&nbsp;TrimFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2831468">//&nbsp;and&nbsp;trailing&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno">565</span><span class="keyword" id="2831531">func</span>&nbsp;<span class="ident" id="2831536">TrimFunc</span><span class="op" id="2831544">(</span><span class="ident" id="2831545">s</span>&nbsp;<span class="builtintype" id="2831547">string</span><span class="op" id="2831553">,</span>&nbsp;<span class="ident" id="2831555">f</span>&nbsp;<span class="keyword" id="2831557">func</span><span class="op" id="2831561">(</span><span class="builtintype" id="2831562">rune</span><span class="op" id="2831566">)</span>&nbsp;<span class="builtintype" id="2831568">bool</span><span class="op" id="2831572">)</span>&nbsp;<span class="builtintype" id="2831574">string</span>&nbsp;<span class="op" id="2831581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2831584">return</span>&nbsp;<span class="ident" id="2831591">TrimRightFunc</span><span class="op" id="2831604">(</span><span class="ident" id="2831605">TrimLeftFunc</span><span class="op" id="2831617">(</span><span class="ident" id="2831618">s</span><span class="op" id="2831619">,</span>&nbsp;<span class="ident" id="2831621">f</span><span class="op" id="2831622">)</span><span class="op" id="2831623">,</span>&nbsp;<span class="ident" id="2831625">f</span><span class="op" id="2831626">)</span><br>
<span class="lineno"></span><span class="op" id="2831628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2831631">//&nbsp;IndexFunc&nbsp;returns&nbsp;the&nbsp;index&nbsp;into&nbsp;s&nbsp;of&nbsp;the&nbsp;first&nbsp;Unicode</span><br>
<span class="lineno">570</span><span class="comment" id="2831690">//&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2831739">func</span>&nbsp;<span class="ident" id="2831744">IndexFunc</span><span class="op" id="2831753">(</span><span class="ident" id="2831754">s</span>&nbsp;<span class="builtintype" id="2831756">string</span><span class="op" id="2831762">,</span>&nbsp;<span class="ident" id="2831764">f</span>&nbsp;<span class="keyword" id="2831766">func</span><span class="op" id="2831770">(</span><span class="builtintype" id="2831771">rune</span><span class="op" id="2831775">)</span>&nbsp;<span class="builtintype" id="2831777">bool</span><span class="op" id="2831781">)</span>&nbsp;<span class="builtintype" id="2831783">int</span>&nbsp;<span class="op" id="2831787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2831790">return</span>&nbsp;<span class="ident" id="2831797">indexFunc</span><span class="op" id="2831806">(</span><span class="ident" id="2831807">s</span><span class="op" id="2831808">,</span>&nbsp;<span class="ident" id="2831810">f</span><span class="op" id="2831811">,</span>&nbsp;<span class="builtintype" id="2831813">true</span><span class="op" id="2831817">)</span><br>
<span class="lineno"></span><span class="op" id="2831819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span><span class="comment" id="2831822">//&nbsp;LastIndexFunc&nbsp;returns&nbsp;the&nbsp;index&nbsp;into&nbsp;s&nbsp;of&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span><span class="comment" id="2831876">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2831933">func</span>&nbsp;<span class="ident" id="2831938">LastIndexFunc</span><span class="op" id="2831951">(</span><span class="ident" id="2831952">s</span>&nbsp;<span class="builtintype" id="2831954">string</span><span class="op" id="2831960">,</span>&nbsp;<span class="ident" id="2831962">f</span>&nbsp;<span class="keyword" id="2831964">func</span><span class="op" id="2831968">(</span><span class="builtintype" id="2831969">rune</span><span class="op" id="2831973">)</span>&nbsp;<span class="builtintype" id="2831975">bool</span><span class="op" id="2831979">)</span>&nbsp;<span class="builtintype" id="2831981">int</span>&nbsp;<span class="op" id="2831985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2831988">return</span>&nbsp;<span class="ident" id="2831995">lastIndexFunc</span><span class="op" id="2832008">(</span><span class="ident" id="2832009">s</span><span class="op" id="2832010">,</span>&nbsp;<span class="ident" id="2832012">f</span><span class="op" id="2832013">,</span>&nbsp;<span class="builtintype" id="2832015">true</span><span class="op" id="2832019">)</span><br>
<span class="lineno"></span><span class="op" id="2832021">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span><span class="comment" id="2832024">//&nbsp;indexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;IndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2832077">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2832133">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2832146">func</span>&nbsp;<span class="ident" id="2832151">indexFunc</span><span class="op" id="2832160">(</span><span class="ident" id="2832161">s</span>&nbsp;<span class="builtintype" id="2832163">string</span><span class="op" id="2832169">,</span>&nbsp;<span class="ident" id="2832171">f</span>&nbsp;<span class="keyword" id="2832173">func</span><span class="op" id="2832177">(</span><span class="builtintype" id="2832178">rune</span><span class="op" id="2832182">)</span>&nbsp;<span class="builtintype" id="2832184">bool</span><span class="op" id="2832188">,</span>&nbsp;<span class="ident" id="2832190">truth</span>&nbsp;<span class="builtintype" id="2832196">bool</span><span class="op" id="2832200">)</span>&nbsp;<span class="builtintype" id="2832202">int</span>&nbsp;<span class="op" id="2832206">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2832209">start</span>&nbsp;<span class="op" id="2832215">:=</span>&nbsp;<span class="num" id="2832218">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832221">for</span>&nbsp;<span class="ident" id="2832225">start</span>&nbsp;<span class="op" id="2832231">&lt;</span>&nbsp;<span class="builtinfunc" id="2832233">len</span><span class="op" id="2832236">(</span><span class="ident" id="2832237">s</span><span class="op" id="2832238">)</span>&nbsp;<span class="op" id="2832240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2832244">wid</span>&nbsp;<span class="op" id="2832248">:=</span>&nbsp;<span class="num" id="2832251">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2832255">r</span>&nbsp;<span class="op" id="2832257">:=</span>&nbsp;<span class="builtintype" id="2832260">rune</span><span class="op" id="2832264">(</span><span class="ident" id="2832265">s</span><span class="op" id="2832266">[</span><span class="ident" id="2832267">start</span><span class="op" id="2832272">]</span><span class="op" id="2832273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832277">if</span>&nbsp;<span class="ident" id="2832280">r</span>&nbsp;<span class="op" id="2832282">&gt;=</span>&nbsp;<span class="ident" id="2832285">utf8</span><span class="op" id="2832289">.</span><span class="ident" id="2832290">RuneSelf</span>&nbsp;<span class="op" id="2832299">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2832304">r</span><span class="op" id="2832305">,</span>&nbsp;<span class="ident" id="2832307">wid</span>&nbsp;<span class="op" id="2832311">=</span>&nbsp;<span class="ident" id="2832313">utf8</span><span class="op" id="2832317">.</span><span class="ident" id="2832318">DecodeRuneInString</span><span class="op" id="2832336">(</span><span class="ident" id="2832337">s</span><span class="op" id="2832338">[</span><span class="ident" id="2832339">start</span><span class="op" id="2832344">:</span><span class="op" id="2832345">]</span><span class="op" id="2832346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2832350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832354">if</span>&nbsp;<span class="ident" id="2832357">f</span><span class="op" id="2832358">(</span><span class="ident" id="2832359">r</span><span class="op" id="2832360">)</span>&nbsp;<span class="op" id="2832362">==</span>&nbsp;<span class="ident" id="2832365">truth</span>&nbsp;<span class="op" id="2832371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832376">return</span>&nbsp;<span class="ident" id="2832383">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2832391">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2832395">start</span>&nbsp;<span class="op" id="2832401">+=</span>&nbsp;<span class="ident" id="2832404">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2832409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832412">return</span>&nbsp;<span class="op" id="2832419">-</span><span class="num" id="2832420">1</span><br>
<span class="lineno"></span><span class="op" id="2832422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="2832425">//&nbsp;lastIndexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;LastIndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2832486">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2832542">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2832555">func</span>&nbsp;<span class="ident" id="2832560">lastIndexFunc</span><span class="op" id="2832573">(</span><span class="ident" id="2832574">s</span>&nbsp;<span class="builtintype" id="2832576">string</span><span class="op" id="2832582">,</span>&nbsp;<span class="ident" id="2832584">f</span>&nbsp;<span class="keyword" id="2832586">func</span><span class="op" id="2832590">(</span><span class="builtintype" id="2832591">rune</span><span class="op" id="2832595">)</span>&nbsp;<span class="builtintype" id="2832597">bool</span><span class="op" id="2832601">,</span>&nbsp;<span class="ident" id="2832603">truth</span>&nbsp;<span class="builtintype" id="2832609">bool</span><span class="op" id="2832613">)</span>&nbsp;<span class="builtintype" id="2832615">int</span>&nbsp;<span class="op" id="2832619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832622">for</span>&nbsp;<span class="ident" id="2832626">i</span>&nbsp;<span class="op" id="2832628">:=</span>&nbsp;<span class="builtinfunc" id="2832631">len</span><span class="op" id="2832634">(</span><span class="ident" id="2832635">s</span><span class="op" id="2832636">)</span><span class="op" id="2832637">;</span>&nbsp;<span class="ident" id="2832639">i</span>&nbsp;<span class="op" id="2832641">&gt;</span>&nbsp;<span class="num" id="2832643">0</span><span class="op" id="2832644">;</span>&nbsp;<span class="op" id="2832646">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2832650">r</span><span class="op" id="2832651">,</span>&nbsp;<span class="ident" id="2832653">size</span>&nbsp;<span class="op" id="2832658">:=</span>&nbsp;<span class="ident" id="2832661">utf8</span><span class="op" id="2832665">.</span><span class="ident" id="2832666">DecodeLastRuneInString</span><span class="op" id="2832688">(</span><span class="ident" id="2832689">s</span><span class="op" id="2832690">[</span><span class="num" id="2832691">0</span><span class="op" id="2832692">:</span><span class="ident" id="2832693">i</span><span class="op" id="2832694">]</span><span class="op" id="2832695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2832699">i</span>&nbsp;<span class="op" id="2832701">-=</span>&nbsp;<span class="ident" id="2832704">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832711">if</span>&nbsp;<span class="ident" id="2832714">f</span><span class="op" id="2832715">(</span><span class="ident" id="2832716">r</span><span class="op" id="2832717">)</span>&nbsp;<span class="op" id="2832719">==</span>&nbsp;<span class="ident" id="2832722">truth</span>&nbsp;<span class="op" id="2832728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832733">return</span>&nbsp;<span class="ident" id="2832740">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2832744">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2832747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832750">return</span>&nbsp;<span class="op" id="2832757">-</span><span class="num" id="2832758">1</span><br>
<span class="lineno"></span><span class="op" id="2832760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2832763">func</span>&nbsp;<span class="ident" id="2832768">makeCutsetFunc</span><span class="op" id="2832782">(</span><span class="ident" id="2832783">cutset</span>&nbsp;<span class="builtintype" id="2832790">string</span><span class="op" id="2832796">)</span>&nbsp;<span class="keyword" id="2832798">func</span><span class="op" id="2832802">(</span><span class="builtintype" id="2832803">rune</span><span class="op" id="2832807">)</span>&nbsp;<span class="builtintype" id="2832809">bool</span>&nbsp;<span class="op" id="2832814">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2832817">return</span>&nbsp;<span class="keyword" id="2832824">func</span><span class="op" id="2832828">(</span><span class="ident" id="2832829">r</span>&nbsp;<span class="builtintype" id="2832831">rune</span><span class="op" id="2832835">)</span>&nbsp;<span class="builtintype" id="2832837">bool</span>&nbsp;<span class="op" id="2832842">{</span>&nbsp;<span class="keyword" id="2832844">return</span>&nbsp;<span class="ident" id="2832851">IndexRune</span><span class="op" id="2832860">(</span><span class="ident" id="2832861">cutset</span><span class="op" id="2832867">,</span>&nbsp;<span class="ident" id="2832869">r</span><span class="op" id="2832870">)</span>&nbsp;<span class="op" id="2832872">&gt;=</span>&nbsp;<span class="num" id="2832875">0</span>&nbsp;<span class="op" id="2832877">}</span><br>
<span class="lineno"></span><span class="op" id="2832879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2832882">//&nbsp;Trim&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2832943">//&nbsp;trailing&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno">620</span><span class="keyword" id="2833004">func</span>&nbsp;<span class="ident" id="2833009">Trim</span><span class="op" id="2833013">(</span><span class="ident" id="2833014">s</span>&nbsp;<span class="builtintype" id="2833016">string</span><span class="op" id="2833022">,</span>&nbsp;<span class="ident" id="2833024">cutset</span>&nbsp;<span class="builtintype" id="2833031">string</span><span class="op" id="2833037">)</span>&nbsp;<span class="builtintype" id="2833039">string</span>&nbsp;<span class="op" id="2833046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2833049">if</span>&nbsp;<span class="ident" id="2833052">s</span>&nbsp;<span class="op" id="2833054">==</span>&nbsp;<span class="string" id="2833057">&#34;&#34;</span>&nbsp;<span class="op" id="2833060">||</span>&nbsp;<span class="ident" id="2833063">cutset</span>&nbsp;<span class="op" id="2833070">==</span>&nbsp;<span class="string" id="2833073">&#34;&#34;</span>&nbsp;<span class="op" id="2833076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2833080">return</span>&nbsp;<span class="ident" id="2833087">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2833090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2833093">return</span>&nbsp;<span class="ident" id="2833100">TrimFunc</span><span class="op" id="2833108">(</span><span class="ident" id="2833109">s</span><span class="op" id="2833110">,</span>&nbsp;<span class="ident" id="2833112">makeCutsetFunc</span><span class="op" id="2833126">(</span><span class="ident" id="2833127">cutset</span><span class="op" id="2833133">)</span><span class="op" id="2833134">)</span><br>
<span class="lineno">625</span><span class="op" id="2833136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2833139">//&nbsp;TrimLeft&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2833200">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2833252">func</span>&nbsp;<span class="ident" id="2833257">TrimLeft</span><span class="op" id="2833265">(</span><span class="ident" id="2833266">s</span>&nbsp;<span class="builtintype" id="2833268">string</span><span class="op" id="2833274">,</span>&nbsp;<span class="ident" id="2833276">cutset</span>&nbsp;<span class="builtintype" id="2833283">string</span><span class="op" id="2833289">)</span>&nbsp;<span class="builtintype" id="2833291">string</span>&nbsp;<span class="op" id="2833298">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2833301">if</span>&nbsp;<span class="ident" id="2833304">s</span>&nbsp;<span class="op" id="2833306">==</span>&nbsp;<span class="string" id="2833309">&#34;&#34;</span>&nbsp;<span class="op" id="2833312">||</span>&nbsp;<span class="ident" id="2833315">cutset</span>&nbsp;<span class="op" id="2833322">==</span>&nbsp;<span class="string" id="2833325">&#34;&#34;</span>&nbsp;<span class="op" id="2833328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2833332">return</span>&nbsp;<span class="ident" id="2833339">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2833342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2833345">return</span>&nbsp;<span class="ident" id="2833352">TrimLeftFunc</span><span class="op" id="2833364">(</span><span class="ident" id="2833365">s</span><span class="op" id="2833366">,</span>&nbsp;<span class="ident" id="2833368">makeCutsetFunc</span><span class="op" id="2833382">(</span><span class="ident" id="2833383">cutset</span><span class="op" id="2833389">)</span><span class="op" id="2833390">)</span><br>
<span class="lineno"></span><span class="op" id="2833392">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span><span class="comment" id="2833395">//&nbsp;TrimRight&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s,&nbsp;with&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2833459">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2833511">func</span>&nbsp;<span class="ident" id="2833516">TrimRight</span><span class="op" id="2833525">(</span><span class="ident" id="2833526">s</span>&nbsp;<span class="builtintype" id="2833528">string</span><span class="op" id="2833534">,</span>&nbsp;<span class="ident" id="2833536">cutset</span>&nbsp;<span class="builtintype" id="2833543">string</span><span class="op" id="2833549">)</span>&nbsp;<span class="builtintype" id="2833551">string</span>&nbsp;<span class="op" id="2833558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2833561">if</span>&nbsp;<span class="ident" id="2833564">s</span>&nbsp;<span class="op" id="2833566">==</span>&nbsp;<span class="string" id="2833569">&#34;&#34;</span>&nbsp;<span class="op" id="2833572">||</span>&nbsp;<span class="ident" id="2833575">cutset</span>&nbsp;<span class="op" id="2833582">==</span>&nbsp;<span class="string" id="2833585">&#34;&#34;</span>&nbsp;<span class="op" id="2833588">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2833592">return</span>&nbsp;<span class="ident" id="2833599">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2833602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2833605">return</span>&nbsp;<span class="ident" id="2833612">TrimRightFunc</span><span class="op" id="2833625">(</span><span class="ident" id="2833626">s</span><span class="op" id="2833627">,</span>&nbsp;<span class="ident" id="2833629">makeCutsetFunc</span><span class="op" id="2833643">(</span><span class="ident" id="2833644">cutset</span><span class="op" id="2833650">)</span><span class="op" id="2833651">)</span><br>
<span class="lineno"></span><span class="op" id="2833653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span><span class="comment" id="2833656">//&nbsp;TrimSpace&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s,&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2833719">//&nbsp;and&nbsp;trailing&nbsp;white&nbsp;space&nbsp;removed,&nbsp;as&nbsp;defined&nbsp;by&nbsp;Unicode.</span><br>
<span class="lineno"></span><span class="keyword" id="2833779">func</span>&nbsp;<span class="ident" id="2833784">TrimSpace</span><span class="op" id="2833793">(</span><span class="ident" id="2833794">s</span>&nbsp;<span class="builtintype" id="2833796">string</span><span class="op" id="2833802">)</span>&nbsp;<span class="builtintype" id="2833804">string</span>&nbsp;<span class="op" id="2833811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2833814">return</span>&nbsp;<span class="ident" id="2833821">TrimFunc</span><span class="op" id="2833829">(</span><span class="ident" id="2833830">s</span><span class="op" id="2833831">,</span>&nbsp;<span class="ident" id="2833833">unicode</span><span class="op" id="2833840">.</span><span class="ident" id="2833841">IsSpace</span><span class="op" id="2833848">)</span><br>
<span class="lineno"></span><span class="op" id="2833850">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span><span class="comment" id="2833853">//&nbsp;TrimPrefix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;leading&nbsp;prefix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2833921">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;start&nbsp;with&nbsp;prefix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2833981">func</span>&nbsp;<span class="ident" id="2833986">TrimPrefix</span><span class="op" id="2833996">(</span><span class="ident" id="2833997">s</span><span class="op" id="2833998">,</span>&nbsp;<span class="ident" id="2834000">prefix</span>&nbsp;<span class="builtintype" id="2834007">string</span><span class="op" id="2834013">)</span>&nbsp;<span class="builtintype" id="2834015">string</span>&nbsp;<span class="op" id="2834022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2834025">if</span>&nbsp;<span class="ident" id="2834028">HasPrefix</span><span class="op" id="2834037">(</span><span class="ident" id="2834038">s</span><span class="op" id="2834039">,</span>&nbsp;<span class="ident" id="2834041">prefix</span><span class="op" id="2834047">)</span>&nbsp;<span class="op" id="2834049">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2834053">return</span>&nbsp;<span class="ident" id="2834060">s</span><span class="op" id="2834061">[</span><span class="builtinfunc" id="2834062">len</span><span class="op" id="2834065">(</span><span class="ident" id="2834066">prefix</span><span class="op" id="2834072">)</span><span class="op" id="2834073">:</span><span class="op" id="2834074">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2834077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2834080">return</span>&nbsp;<span class="ident" id="2834087">s</span><br>
<span class="lineno"></span><span class="op" id="2834089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="2834092">//&nbsp;TrimSuffix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;trailing&nbsp;suffix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2834161">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;end&nbsp;with&nbsp;suffix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2834219">func</span>&nbsp;<span class="ident" id="2834224">TrimSuffix</span><span class="op" id="2834234">(</span><span class="ident" id="2834235">s</span><span class="op" id="2834236">,</span>&nbsp;<span class="ident" id="2834238">suffix</span>&nbsp;<span class="builtintype" id="2834245">string</span><span class="op" id="2834251">)</span>&nbsp;<span class="builtintype" id="2834253">string</span>&nbsp;<span class="op" id="2834260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2834263">if</span>&nbsp;<span class="ident" id="2834266">HasSuffix</span><span class="op" id="2834275">(</span><span class="ident" id="2834276">s</span><span class="op" id="2834277">,</span>&nbsp;<span class="ident" id="2834279">suffix</span><span class="op" id="2834285">)</span>&nbsp;<span class="op" id="2834287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2834291">return</span>&nbsp;<span class="ident" id="2834298">s</span><span class="op" id="2834299">[</span><span class="op" id="2834300">:</span><span class="builtinfunc" id="2834301">len</span><span class="op" id="2834304">(</span><span class="ident" id="2834305">s</span><span class="op" id="2834306">)</span><span class="op" id="2834307">-</span><span class="builtinfunc" id="2834308">len</span><span class="op" id="2834311">(</span><span class="ident" id="2834312">suffix</span><span class="op" id="2834318">)</span><span class="op" id="2834319">]</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2834322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2834325">return</span>&nbsp;<span class="ident" id="2834332">s</span><br>
<span class="lineno"></span><span class="op" id="2834334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2834337">//&nbsp;Replace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;the&nbsp;first&nbsp;n</span><br>
<span class="lineno">670</span><span class="comment" id="2834396">//&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;old&nbsp;replaced&nbsp;by&nbsp;new.</span><br>
<span class="lineno"></span><span class="comment" id="2834449">//&nbsp;If&nbsp;old&nbsp;is&nbsp;empty,&nbsp;it&nbsp;matches&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2834511">//&nbsp;and&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence,&nbsp;yielding&nbsp;up&nbsp;to&nbsp;k+1&nbsp;replacements</span><br>
<span class="lineno"></span><span class="comment" id="2834577">//&nbsp;for&nbsp;a&nbsp;k-rune&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2834601">//&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;there&nbsp;is&nbsp;no&nbsp;limit&nbsp;on&nbsp;the&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno">675</span><span class="keyword" id="2834663">func</span>&nbsp;<span class="ident" id="2834668">Replace</span><span class="op" id="2834675">(</span><span class="ident" id="2834676">s</span><span class="op" id="2834677">,</span>&nbsp;<span class="ident" id="2834679">old</span><span class="op" id="2834682">,</span>&nbsp;<span class="builtinfunc" id="2834684">new</span>&nbsp;<span class="builtintype" id="2834688">string</span><span class="op" id="2834694">,</span>&nbsp;<span class="ident" id="2834696">n</span>&nbsp;<span class="builtintype" id="2834698">int</span><span class="op" id="2834701">)</span>&nbsp;<span class="builtintype" id="2834703">string</span>&nbsp;<span class="op" id="2834710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2834713">if</span>&nbsp;<span class="ident" id="2834716">old</span>&nbsp;<span class="op" id="2834720">==</span>&nbsp;<span class="builtinfunc" id="2834723">new</span>&nbsp;<span class="op" id="2834727">||</span>&nbsp;<span class="ident" id="2834730">n</span>&nbsp;<span class="op" id="2834732">==</span>&nbsp;<span class="num" id="2834735">0</span>&nbsp;<span class="op" id="2834737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2834741">return</span>&nbsp;<span class="ident" id="2834748">s</span>&nbsp;<span class="comment" id="2834750">//&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2834771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2834775">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2834811">if</span>&nbsp;<span class="ident" id="2834814">m</span>&nbsp;<span class="op" id="2834816">:=</span>&nbsp;<span class="ident" id="2834819">Count</span><span class="op" id="2834824">(</span><span class="ident" id="2834825">s</span><span class="op" id="2834826">,</span>&nbsp;<span class="ident" id="2834828">old</span><span class="op" id="2834831">)</span><span class="op" id="2834832">;</span>&nbsp;<span class="ident" id="2834834">m</span>&nbsp;<span class="op" id="2834836">==</span>&nbsp;<span class="num" id="2834839">0</span>&nbsp;<span class="op" id="2834841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2834845">return</span>&nbsp;<span class="ident" id="2834852">s</span>&nbsp;<span class="comment" id="2834854">//&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2834875">}</span>&nbsp;<span class="keyword" id="2834877">else</span>&nbsp;<span class="keyword" id="2834882">if</span>&nbsp;<span class="ident" id="2834885">n</span>&nbsp;<span class="op" id="2834887">&lt;</span>&nbsp;<span class="num" id="2834889">0</span>&nbsp;<span class="op" id="2834891">||</span>&nbsp;<span class="ident" id="2834894">m</span>&nbsp;<span class="op" id="2834896">&lt;</span>&nbsp;<span class="ident" id="2834898">n</span>&nbsp;<span class="op" id="2834900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2834904">n</span>&nbsp;<span class="op" id="2834906">=</span>&nbsp;<span class="ident" id="2834908">m</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2834911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2834915">//&nbsp;Apply&nbsp;replacements&nbsp;to&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2834949">t</span>&nbsp;<span class="op" id="2834951">:=</span>&nbsp;<span class="builtinfunc" id="2834954">make</span><span class="op" id="2834958">(</span><span class="op" id="2834959">[</span><span class="op" id="2834960">]</span><span class="builtintype" id="2834961">byte</span><span class="op" id="2834965">,</span>&nbsp;<span class="builtinfunc" id="2834967">len</span><span class="op" id="2834970">(</span><span class="ident" id="2834971">s</span><span class="op" id="2834972">)</span><span class="op" id="2834973">+</span><span class="ident" id="2834974">n</span><span class="op" id="2834975">*</span><span class="op" id="2834976">(</span><span class="builtinfunc" id="2834977">len</span><span class="op" id="2834980">(</span><span class="builtinfunc" id="2834981">new</span><span class="op" id="2834984">)</span><span class="op" id="2834985">-</span><span class="builtinfunc" id="2834986">len</span><span class="op" id="2834989">(</span><span class="ident" id="2834990">old</span><span class="op" id="2834993">)</span><span class="op" id="2834994">)</span><span class="op" id="2834995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2834998">w</span>&nbsp;<span class="op" id="2835000">:=</span>&nbsp;<span class="num" id="2835003">0</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835006">start</span>&nbsp;<span class="op" id="2835012">:=</span>&nbsp;<span class="num" id="2835015">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835018">for</span>&nbsp;<span class="ident" id="2835022">i</span>&nbsp;<span class="op" id="2835024">:=</span>&nbsp;<span class="num" id="2835027">0</span><span class="op" id="2835028">;</span>&nbsp;<span class="ident" id="2835030">i</span>&nbsp;<span class="op" id="2835032">&lt;</span>&nbsp;<span class="ident" id="2835034">n</span><span class="op" id="2835035">;</span>&nbsp;<span class="ident" id="2835037">i</span><span class="op" id="2835038">++</span>&nbsp;<span class="op" id="2835041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835045">j</span>&nbsp;<span class="op" id="2835047">:=</span>&nbsp;<span class="ident" id="2835050">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835058">if</span>&nbsp;<span class="builtinfunc" id="2835061">len</span><span class="op" id="2835064">(</span><span class="ident" id="2835065">old</span><span class="op" id="2835068">)</span>&nbsp;<span class="op" id="2835070">==</span>&nbsp;<span class="num" id="2835073">0</span>&nbsp;<span class="op" id="2835075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835080">if</span>&nbsp;<span class="ident" id="2835083">i</span>&nbsp;<span class="op" id="2835085">&gt;</span>&nbsp;<span class="num" id="2835087">0</span>&nbsp;<span class="op" id="2835089">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835095">_</span><span class="op" id="2835096">,</span>&nbsp;<span class="ident" id="2835098">wid</span>&nbsp;<span class="op" id="2835102">:=</span>&nbsp;<span class="ident" id="2835105">utf8</span><span class="op" id="2835109">.</span><span class="ident" id="2835110">DecodeRuneInString</span><span class="op" id="2835128">(</span><span class="ident" id="2835129">s</span><span class="op" id="2835130">[</span><span class="ident" id="2835131">start</span><span class="op" id="2835136">:</span><span class="op" id="2835137">]</span><span class="op" id="2835138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835144">j</span>&nbsp;<span class="op" id="2835146">+=</span>&nbsp;<span class="ident" id="2835149">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2835156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2835160">}</span>&nbsp;<span class="keyword" id="2835162">else</span>&nbsp;<span class="op" id="2835167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835172">j</span>&nbsp;<span class="op" id="2835174">+=</span>&nbsp;<span class="ident" id="2835177">Index</span><span class="op" id="2835182">(</span><span class="ident" id="2835183">s</span><span class="op" id="2835184">[</span><span class="ident" id="2835185">start</span><span class="op" id="2835190">:</span><span class="op" id="2835191">]</span><span class="op" id="2835192">,</span>&nbsp;<span class="ident" id="2835194">old</span><span class="op" id="2835197">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2835201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835205">w</span>&nbsp;<span class="op" id="2835207">+=</span>&nbsp;<span class="builtinfunc" id="2835210">copy</span><span class="op" id="2835214">(</span><span class="ident" id="2835215">t</span><span class="op" id="2835216">[</span><span class="ident" id="2835217">w</span><span class="op" id="2835218">:</span><span class="op" id="2835219">]</span><span class="op" id="2835220">,</span>&nbsp;<span class="ident" id="2835222">s</span><span class="op" id="2835223">[</span><span class="ident" id="2835224">start</span><span class="op" id="2835229">:</span><span class="ident" id="2835230">j</span><span class="op" id="2835231">]</span><span class="op" id="2835232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835236">w</span>&nbsp;<span class="op" id="2835238">+=</span>&nbsp;<span class="builtinfunc" id="2835241">copy</span><span class="op" id="2835245">(</span><span class="ident" id="2835246">t</span><span class="op" id="2835247">[</span><span class="ident" id="2835248">w</span><span class="op" id="2835249">:</span><span class="op" id="2835250">]</span><span class="op" id="2835251">,</span>&nbsp;<span class="builtinfunc" id="2835253">new</span><span class="op" id="2835256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835260">start</span>&nbsp;<span class="op" id="2835266">=</span>&nbsp;<span class="ident" id="2835268">j</span>&nbsp;<span class="op" id="2835270">+</span>&nbsp;<span class="builtinfunc" id="2835272">len</span><span class="op" id="2835275">(</span><span class="ident" id="2835276">old</span><span class="op" id="2835279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2835282">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835285">w</span>&nbsp;<span class="op" id="2835287">+=</span>&nbsp;<span class="builtinfunc" id="2835290">copy</span><span class="op" id="2835294">(</span><span class="ident" id="2835295">t</span><span class="op" id="2835296">[</span><span class="ident" id="2835297">w</span><span class="op" id="2835298">:</span><span class="op" id="2835299">]</span><span class="op" id="2835300">,</span>&nbsp;<span class="ident" id="2835302">s</span><span class="op" id="2835303">[</span><span class="ident" id="2835304">start</span><span class="op" id="2835309">:</span><span class="op" id="2835310">]</span><span class="op" id="2835311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835314">return</span>&nbsp;<span class="builtintype" id="2835321">string</span><span class="op" id="2835327">(</span><span class="ident" id="2835328">t</span><span class="op" id="2835329">[</span><span class="num" id="2835330">0</span><span class="op" id="2835331">:</span><span class="ident" id="2835332">w</span><span class="op" id="2835333">]</span><span class="op" id="2835334">)</span><br>
<span class="lineno"></span><span class="op" id="2835336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2835339">//&nbsp;EqualFold&nbsp;reports&nbsp;whether&nbsp;s&nbsp;and&nbsp;t,&nbsp;interpreted&nbsp;as&nbsp;UTF-8&nbsp;strings,</span><br>
<span class="lineno">710</span><span class="comment" id="2835407">//&nbsp;are&nbsp;equal&nbsp;under&nbsp;Unicode&nbsp;case-folding.</span><br>
<span class="lineno"></span><span class="keyword" id="2835448">func</span>&nbsp;<span class="ident" id="2835453">EqualFold</span><span class="op" id="2835462">(</span><span class="ident" id="2835463">s</span><span class="op" id="2835464">,</span>&nbsp;<span class="ident" id="2835466">t</span>&nbsp;<span class="builtintype" id="2835468">string</span><span class="op" id="2835474">)</span>&nbsp;<span class="builtintype" id="2835476">bool</span>&nbsp;<span class="op" id="2835481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835484">for</span>&nbsp;<span class="ident" id="2835488">s</span>&nbsp;<span class="op" id="2835490">!=</span>&nbsp;<span class="string" id="2835493">&#34;&#34;</span>&nbsp;<span class="op" id="2835496">&amp;&amp;</span>&nbsp;<span class="ident" id="2835499">t</span>&nbsp;<span class="op" id="2835501">!=</span>&nbsp;<span class="string" id="2835504">&#34;&#34;</span>&nbsp;<span class="op" id="2835507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2835511">//&nbsp;Extract&nbsp;first&nbsp;rune&nbsp;from&nbsp;each&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835553">var</span>&nbsp;<span class="ident" id="2835557">sr</span><span class="op" id="2835559">,</span>&nbsp;<span class="ident" id="2835561">tr</span>&nbsp;<span class="builtintype" id="2835564">rune</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835571">if</span>&nbsp;<span class="ident" id="2835574">s</span><span class="op" id="2835575">[</span><span class="num" id="2835576">0</span><span class="op" id="2835577">]</span>&nbsp;<span class="op" id="2835579">&lt;</span>&nbsp;<span class="ident" id="2835581">utf8</span><span class="op" id="2835585">.</span><span class="ident" id="2835586">RuneSelf</span>&nbsp;<span class="op" id="2835595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835600">sr</span><span class="op" id="2835602">,</span>&nbsp;<span class="ident" id="2835604">s</span>&nbsp;<span class="op" id="2835606">=</span>&nbsp;<span class="builtintype" id="2835608">rune</span><span class="op" id="2835612">(</span><span class="ident" id="2835613">s</span><span class="op" id="2835614">[</span><span class="num" id="2835615">0</span><span class="op" id="2835616">]</span><span class="op" id="2835617">)</span><span class="op" id="2835618">,</span>&nbsp;<span class="ident" id="2835620">s</span><span class="op" id="2835621">[</span><span class="num" id="2835622">1</span><span class="op" id="2835623">:</span><span class="op" id="2835624">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2835628">}</span>&nbsp;<span class="keyword" id="2835630">else</span>&nbsp;<span class="op" id="2835635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835640">r</span><span class="op" id="2835641">,</span>&nbsp;<span class="ident" id="2835643">size</span>&nbsp;<span class="op" id="2835648">:=</span>&nbsp;<span class="ident" id="2835651">utf8</span><span class="op" id="2835655">.</span><span class="ident" id="2835656">DecodeRuneInString</span><span class="op" id="2835674">(</span><span class="ident" id="2835675">s</span><span class="op" id="2835676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835681">sr</span><span class="op" id="2835683">,</span>&nbsp;<span class="ident" id="2835685">s</span>&nbsp;<span class="op" id="2835687">=</span>&nbsp;<span class="ident" id="2835689">r</span><span class="op" id="2835690">,</span>&nbsp;<span class="ident" id="2835692">s</span><span class="op" id="2835693">[</span><span class="ident" id="2835694">size</span><span class="op" id="2835698">:</span><span class="op" id="2835699">]</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2835703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835707">if</span>&nbsp;<span class="ident" id="2835710">t</span><span class="op" id="2835711">[</span><span class="num" id="2835712">0</span><span class="op" id="2835713">]</span>&nbsp;<span class="op" id="2835715">&lt;</span>&nbsp;<span class="ident" id="2835717">utf8</span><span class="op" id="2835721">.</span><span class="ident" id="2835722">RuneSelf</span>&nbsp;<span class="op" id="2835731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835736">tr</span><span class="op" id="2835738">,</span>&nbsp;<span class="ident" id="2835740">t</span>&nbsp;<span class="op" id="2835742">=</span>&nbsp;<span class="builtintype" id="2835744">rune</span><span class="op" id="2835748">(</span><span class="ident" id="2835749">t</span><span class="op" id="2835750">[</span><span class="num" id="2835751">0</span><span class="op" id="2835752">]</span><span class="op" id="2835753">)</span><span class="op" id="2835754">,</span>&nbsp;<span class="ident" id="2835756">t</span><span class="op" id="2835757">[</span><span class="num" id="2835758">1</span><span class="op" id="2835759">:</span><span class="op" id="2835760">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2835764">}</span>&nbsp;<span class="keyword" id="2835766">else</span>&nbsp;<span class="op" id="2835771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835776">r</span><span class="op" id="2835777">,</span>&nbsp;<span class="ident" id="2835779">size</span>&nbsp;<span class="op" id="2835784">:=</span>&nbsp;<span class="ident" id="2835787">utf8</span><span class="op" id="2835791">.</span><span class="ident" id="2835792">DecodeRuneInString</span><span class="op" id="2835810">(</span><span class="ident" id="2835811">t</span><span class="op" id="2835812">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835817">tr</span><span class="op" id="2835819">,</span>&nbsp;<span class="ident" id="2835821">t</span>&nbsp;<span class="op" id="2835823">=</span>&nbsp;<span class="ident" id="2835825">r</span><span class="op" id="2835826">,</span>&nbsp;<span class="ident" id="2835828">t</span><span class="op" id="2835829">[</span><span class="ident" id="2835830">size</span><span class="op" id="2835834">:</span><span class="op" id="2835835">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2835839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2835844">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;keep&nbsp;going;&nbsp;if&nbsp;not,&nbsp;return&nbsp;false.</span><br>
<span class="lineno"></span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2835899">//&nbsp;Easy&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835915">if</span>&nbsp;<span class="ident" id="2835918">tr</span>&nbsp;<span class="op" id="2835921">==</span>&nbsp;<span class="ident" id="2835924">sr</span>&nbsp;<span class="op" id="2835927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835932">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2835943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2835948">//&nbsp;Make&nbsp;sr&nbsp;&lt;&nbsp;tr&nbsp;to&nbsp;simplify&nbsp;what&nbsp;follows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835992">if</span>&nbsp;<span class="ident" id="2835995">tr</span>&nbsp;<span class="op" id="2835998">&lt;</span>&nbsp;<span class="ident" id="2836000">sr</span>&nbsp;<span class="op" id="2836003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2836008">tr</span><span class="op" id="2836010">,</span>&nbsp;<span class="ident" id="2836012">sr</span>&nbsp;<span class="op" id="2836015">=</span>&nbsp;<span class="ident" id="2836017">sr</span><span class="op" id="2836019">,</span>&nbsp;<span class="ident" id="2836021">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2836026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2836030">//&nbsp;Fast&nbsp;check&nbsp;for&nbsp;ASCII.</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836057">if</span>&nbsp;<span class="ident" id="2836060">tr</span>&nbsp;<span class="op" id="2836063">&lt;</span>&nbsp;<span class="ident" id="2836065">utf8</span><span class="op" id="2836069">.</span><span class="ident" id="2836070">RuneSelf</span>&nbsp;<span class="op" id="2836079">&amp;&amp;</span>&nbsp;<span class="string" id="2836082">&#39;A&#39;</span>&nbsp;<span class="op" id="2836086">&lt;=</span>&nbsp;<span class="ident" id="2836089">sr</span>&nbsp;<span class="op" id="2836092">&amp;&amp;</span>&nbsp;<span class="ident" id="2836095">sr</span>&nbsp;<span class="op" id="2836098">&lt;=</span>&nbsp;<span class="string" id="2836101">&#39;Z&#39;</span>&nbsp;<span class="op" id="2836105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2836110">//&nbsp;ASCII,&nbsp;and&nbsp;sr&nbsp;is&nbsp;upper&nbsp;case.&nbsp;&nbsp;tr&nbsp;must&nbsp;be&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836169">if</span>&nbsp;<span class="ident" id="2836172">tr</span>&nbsp;<span class="op" id="2836175">==</span>&nbsp;<span class="ident" id="2836178">sr</span><span class="op" id="2836180">+</span><span class="string" id="2836181">&#39;a&#39;</span><span class="op" id="2836184">-</span><span class="string" id="2836185">&#39;A&#39;</span>&nbsp;<span class="op" id="2836189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836195">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2836207">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836212">return</span>&nbsp;<span class="builtintype" id="2836219">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2836227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2836232">//&nbsp;General&nbsp;case.&nbsp;&nbsp;SimpleFold(x)&nbsp;returns&nbsp;the&nbsp;next&nbsp;equivalent&nbsp;rune&nbsp;&gt;&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2836303">//&nbsp;or&nbsp;wraps&nbsp;around&nbsp;to&nbsp;smaller&nbsp;values.</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2836343">r</span>&nbsp;<span class="op" id="2836345">:=</span>&nbsp;<span class="ident" id="2836348">unicode</span><span class="op" id="2836355">.</span><span class="ident" id="2836356">SimpleFold</span><span class="op" id="2836366">(</span><span class="ident" id="2836367">sr</span><span class="op" id="2836369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836373">for</span>&nbsp;<span class="ident" id="2836377">r</span>&nbsp;<span class="op" id="2836379">!=</span>&nbsp;<span class="ident" id="2836382">sr</span>&nbsp;<span class="op" id="2836385">&amp;&amp;</span>&nbsp;<span class="ident" id="2836388">r</span>&nbsp;<span class="op" id="2836390">&lt;</span>&nbsp;<span class="ident" id="2836392">tr</span>&nbsp;<span class="op" id="2836395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2836400">r</span>&nbsp;<span class="op" id="2836402">=</span>&nbsp;<span class="ident" id="2836404">unicode</span><span class="op" id="2836411">.</span><span class="ident" id="2836412">SimpleFold</span><span class="op" id="2836422">(</span><span class="ident" id="2836423">r</span><span class="op" id="2836424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2836428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836432">if</span>&nbsp;<span class="ident" id="2836435">r</span>&nbsp;<span class="op" id="2836437">==</span>&nbsp;<span class="ident" id="2836440">tr</span>&nbsp;<span class="op" id="2836443">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836448">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2836459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836463">return</span>&nbsp;<span class="builtintype" id="2836470">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2836477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2836481">//&nbsp;One&nbsp;string&nbsp;is&nbsp;empty.&nbsp;&nbsp;Are&nbsp;both?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836517">return</span>&nbsp;<span class="ident" id="2836524">s</span>&nbsp;<span class="op" id="2836526">==</span>&nbsp;<span class="ident" id="2836529">t</span><br>
<span class="lineno"></span><span class="op" id="2836531">}</span>
</div>
</body>
</html>
