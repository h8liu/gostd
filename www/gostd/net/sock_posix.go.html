<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html" class="current">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3837128">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3837184">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3837238">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3837289">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3837367">package</span>&nbsp;<span class="ident" id="3837375">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3837380">import</span>&nbsp;<span class="op" id="3837387">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3837390">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3837396">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3837407">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3837414">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3837417">//&nbsp;A&nbsp;sockaddr&nbsp;represents&nbsp;a&nbsp;TCP,&nbsp;UDP,&nbsp;IP&nbsp;or&nbsp;Unix&nbsp;network&nbsp;endpoint</span><br>
<span class="lineno"></span><span class="comment" id="3837482">//&nbsp;address&nbsp;that&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall.Sockaddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3837540">type</span>&nbsp;<span class="ident" id="3837545">sockaddr</span>&nbsp;<span class="keyword" id="3837554">interface</span>&nbsp;<span class="op" id="3837564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837567">Addr</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837574">netaddr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3837584">//&nbsp;family&nbsp;returns&nbsp;the&nbsp;platform-dependent&nbsp;address&nbsp;family</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3837641">//&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837657">family</span><span class="op" id="3837663">(</span><span class="op" id="3837664">)</span>&nbsp;<span class="builtintype" id="3837666">int</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3837672">//&nbsp;isWildcard&nbsp;reports&nbsp;whether&nbsp;the&nbsp;address&nbsp;is&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3837729">//&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837742">isWildcard</span><span class="op" id="3837752">(</span><span class="op" id="3837753">)</span>&nbsp;<span class="builtintype" id="3837755">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3837762">//&nbsp;sockaddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3837820">//&nbsp;sockaddr&nbsp;type&nbsp;that&nbsp;implements&nbsp;syscall.Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3837871">//&nbsp;interface.&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3837933">//&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837942">sockaddr</span><span class="op" id="3837950">(</span><span class="ident" id="3837951">family</span>&nbsp;<span class="builtintype" id="3837958">int</span><span class="op" id="3837961">)</span>&nbsp;<span class="op" id="3837963">(</span><span class="ident" id="3837964">syscall</span><span class="op" id="3837971">.</span><span class="ident" id="3837972">Sockaddr</span><span class="op" id="3837980">,</span>&nbsp;<span class="builtintype" id="3837982">error</span><span class="op" id="3837987">)</span><br>
<span class="lineno">35</span><span class="op" id="3837989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3837992">//&nbsp;socket&nbsp;returns&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;that&nbsp;is&nbsp;ready&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3838054">//&nbsp;asynchronous&nbsp;I/O&nbsp;using&nbsp;the&nbsp;network&nbsp;poller.</span><br>
<span class="lineno"></span><span class="keyword" id="3838100">func</span>&nbsp;<span class="ident" id="3838105">socket</span><span class="op" id="3838111">(</span><span class="ident" id="3838112">net</span>&nbsp;<span class="builtintype" id="3838116">string</span><span class="op" id="3838122">,</span>&nbsp;<span class="ident" id="3838124">family</span><span class="op" id="3838130">,</span>&nbsp;<span class="ident" id="3838132">sotype</span><span class="op" id="3838138">,</span>&nbsp;<span class="ident" id="3838140">proto</span>&nbsp;<span class="builtintype" id="3838146">int</span><span class="op" id="3838149">,</span>&nbsp;<span class="ident" id="3838151">ipv6only</span>&nbsp;<span class="builtintype" id="3838160">bool</span><span class="op" id="3838164">,</span>&nbsp;<span class="ident" id="3838166">laddr</span><span class="op" id="3838171">,</span>&nbsp;<span class="ident" id="3838173">raddr</span>&nbsp;<span class="ident" id="3838179">sockaddr</span><span class="op" id="3838187">,</span>&nbsp;<span class="ident" id="3838189">deadline</span>&nbsp;<span class="ident" id="3838198">time</span><span class="op" id="3838202">.</span><span class="ident" id="3838203">Time</span><span class="op" id="3838207">)</span>&nbsp;<span class="op" id="3838209">(</span><span class="ident" id="3838210">fd</span>&nbsp;<span class="op" id="3838213">*</span><span class="ident" id="3838214">netFD</span><span class="op" id="3838219">,</span>&nbsp;<span class="ident" id="3838221">err</span>&nbsp;<span class="builtintype" id="3838225">error</span><span class="op" id="3838230">)</span>&nbsp;<span class="op" id="3838232">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838235">s</span><span class="op" id="3838236">,</span>&nbsp;<span class="ident" id="3838238">err</span>&nbsp;<span class="op" id="3838242">:=</span>&nbsp;<span class="ident" id="3838245">sysSocket</span><span class="op" id="3838254">(</span><span class="ident" id="3838255">family</span><span class="op" id="3838261">,</span>&nbsp;<span class="ident" id="3838263">sotype</span><span class="op" id="3838269">,</span>&nbsp;<span class="ident" id="3838271">proto</span><span class="op" id="3838276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838279">if</span>&nbsp;<span class="ident" id="3838282">err</span>&nbsp;<span class="op" id="3838286">!=</span>&nbsp;<span class="builtintype" id="3838289">nil</span>&nbsp;<span class="op" id="3838293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838297">return</span>&nbsp;<span class="builtintype" id="3838304">nil</span><span class="op" id="3838307">,</span>&nbsp;<span class="ident" id="3838309">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3838314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838317">if</span>&nbsp;<span class="ident" id="3838320">err</span>&nbsp;<span class="op" id="3838324">=</span>&nbsp;<span class="ident" id="3838326">setDefaultSockopts</span><span class="op" id="3838344">(</span><span class="ident" id="3838345">s</span><span class="op" id="3838346">,</span>&nbsp;<span class="ident" id="3838348">family</span><span class="op" id="3838354">,</span>&nbsp;<span class="ident" id="3838356">sotype</span><span class="op" id="3838362">,</span>&nbsp;<span class="ident" id="3838364">ipv6only</span><span class="op" id="3838372">)</span><span class="op" id="3838373">;</span>&nbsp;<span class="ident" id="3838375">err</span>&nbsp;<span class="op" id="3838379">!=</span>&nbsp;<span class="builtintype" id="3838382">nil</span>&nbsp;<span class="op" id="3838386">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838390">closesocket</span><span class="op" id="3838401">(</span><span class="ident" id="3838402">s</span><span class="op" id="3838403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838407">return</span>&nbsp;<span class="builtintype" id="3838414">nil</span><span class="op" id="3838417">,</span>&nbsp;<span class="ident" id="3838419">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3838424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838427">if</span>&nbsp;<span class="ident" id="3838430">fd</span><span class="op" id="3838432">,</span>&nbsp;<span class="ident" id="3838434">err</span>&nbsp;<span class="op" id="3838438">=</span>&nbsp;<span class="ident" id="3838440">newFD</span><span class="op" id="3838445">(</span><span class="ident" id="3838446">s</span><span class="op" id="3838447">,</span>&nbsp;<span class="ident" id="3838449">family</span><span class="op" id="3838455">,</span>&nbsp;<span class="ident" id="3838457">sotype</span><span class="op" id="3838463">,</span>&nbsp;<span class="ident" id="3838465">net</span><span class="op" id="3838468">)</span><span class="op" id="3838469">;</span>&nbsp;<span class="ident" id="3838471">err</span>&nbsp;<span class="op" id="3838475">!=</span>&nbsp;<span class="builtintype" id="3838478">nil</span>&nbsp;<span class="op" id="3838482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838486">closesocket</span><span class="op" id="3838497">(</span><span class="ident" id="3838498">s</span><span class="op" id="3838499">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838503">return</span>&nbsp;<span class="builtintype" id="3838510">nil</span><span class="op" id="3838513">,</span>&nbsp;<span class="ident" id="3838515">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3838520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3838524">//&nbsp;This&nbsp;function&nbsp;makes&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3838582">//&nbsp;following&nbsp;applications:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3838610">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3838614">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;passive&nbsp;stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3838667">//&nbsp;&nbsp;&nbsp;connenction,&nbsp;known&nbsp;as&nbsp;a&nbsp;stream&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3838713">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3838717">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;destination-unspecific</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3838778">//&nbsp;&nbsp;&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a&nbsp;datagram&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3838834">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3838838">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;an&nbsp;active&nbsp;stream&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3838896">//&nbsp;&nbsp;&nbsp;destination-specific&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3838955">//&nbsp;&nbsp;&nbsp;dialer</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3838968">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3838972">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;the&nbsp;other&nbsp;connection,&nbsp;such</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3839035">//&nbsp;&nbsp;&nbsp;as&nbsp;talking&nbsp;to&nbsp;the&nbsp;protocol&nbsp;stack&nbsp;inside&nbsp;the&nbsp;kernel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3839092">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3839096">//&nbsp;For&nbsp;stream&nbsp;and&nbsp;datagram&nbsp;listeners,&nbsp;they&nbsp;will&nbsp;only&nbsp;require</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3839158">//&nbsp;named&nbsp;sockets,&nbsp;so&nbsp;we&nbsp;can&nbsp;assume&nbsp;that&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3839219">//&nbsp;from&nbsp;stream&nbsp;or&nbsp;datagram&nbsp;listeners&nbsp;when&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3839283">//&nbsp;raddr&nbsp;is&nbsp;nil.&nbsp;Otherwise&nbsp;we&nbsp;assume&nbsp;it&#39;s&nbsp;just&nbsp;for&nbsp;dialers&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3839346">//&nbsp;the&nbsp;other&nbsp;connection&nbsp;holders.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839381">if</span>&nbsp;<span class="ident" id="3839384">laddr</span>&nbsp;<span class="op" id="3839390">!=</span>&nbsp;<span class="builtintype" id="3839393">nil</span>&nbsp;<span class="op" id="3839397">&amp;&amp;</span>&nbsp;<span class="ident" id="3839400">raddr</span>&nbsp;<span class="op" id="3839406">==</span>&nbsp;<span class="builtintype" id="3839409">nil</span>&nbsp;<span class="op" id="3839413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839417">switch</span>&nbsp;<span class="ident" id="3839424">sotype</span>&nbsp;<span class="op" id="3839431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839435">case</span>&nbsp;<span class="ident" id="3839440">syscall</span><span class="op" id="3839447">.</span><span class="ident" id="3839448">SOCK_STREAM</span><span class="op" id="3839459">,</span>&nbsp;<span class="ident" id="3839461">syscall</span><span class="op" id="3839468">.</span><span class="ident" id="3839469">SOCK_SEQPACKET</span><span class="op" id="3839483">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839488">if</span>&nbsp;<span class="ident" id="3839491">err</span>&nbsp;<span class="op" id="3839495">:=</span>&nbsp;<span class="ident" id="3839498">fd</span><span class="op" id="3839500">.</span><span class="ident" id="3839501">listenStream</span><span class="op" id="3839513">(</span><span class="ident" id="3839514">laddr</span><span class="op" id="3839519">,</span>&nbsp;<span class="ident" id="3839521">listenerBacklog</span><span class="op" id="3839536">)</span><span class="op" id="3839537">;</span>&nbsp;<span class="ident" id="3839539">err</span>&nbsp;<span class="op" id="3839543">!=</span>&nbsp;<span class="builtintype" id="3839546">nil</span>&nbsp;<span class="op" id="3839550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3839556">fd</span><span class="op" id="3839558">.</span><span class="ident" id="3839559">Close</span><span class="op" id="3839564">(</span><span class="op" id="3839565">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839571">return</span>&nbsp;<span class="builtintype" id="3839578">nil</span><span class="op" id="3839581">,</span>&nbsp;<span class="ident" id="3839583">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3839590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839595">return</span>&nbsp;<span class="ident" id="3839602">fd</span><span class="op" id="3839604">,</span>&nbsp;<span class="builtintype" id="3839606">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839612">case</span>&nbsp;<span class="ident" id="3839617">syscall</span><span class="op" id="3839624">.</span><span class="ident" id="3839625">SOCK_DGRAM</span><span class="op" id="3839635">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839640">if</span>&nbsp;<span class="ident" id="3839643">err</span>&nbsp;<span class="op" id="3839647">:=</span>&nbsp;<span class="ident" id="3839650">fd</span><span class="op" id="3839652">.</span><span class="ident" id="3839653">listenDatagram</span><span class="op" id="3839667">(</span><span class="ident" id="3839668">laddr</span><span class="op" id="3839673">)</span><span class="op" id="3839674">;</span>&nbsp;<span class="ident" id="3839676">err</span>&nbsp;<span class="op" id="3839680">!=</span>&nbsp;<span class="builtintype" id="3839683">nil</span>&nbsp;<span class="op" id="3839687">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3839693">fd</span><span class="op" id="3839695">.</span><span class="ident" id="3839696">Close</span><span class="op" id="3839701">(</span><span class="op" id="3839702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839708">return</span>&nbsp;<span class="builtintype" id="3839715">nil</span><span class="op" id="3839718">,</span>&nbsp;<span class="ident" id="3839720">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3839727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839732">return</span>&nbsp;<span class="ident" id="3839739">fd</span><span class="op" id="3839741">,</span>&nbsp;<span class="builtintype" id="3839743">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3839749">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3839752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839755">if</span>&nbsp;<span class="ident" id="3839758">err</span>&nbsp;<span class="op" id="3839762">:=</span>&nbsp;<span class="ident" id="3839765">fd</span><span class="op" id="3839767">.</span><span class="ident" id="3839768">dial</span><span class="op" id="3839772">(</span><span class="ident" id="3839773">laddr</span><span class="op" id="3839778">,</span>&nbsp;<span class="ident" id="3839780">raddr</span><span class="op" id="3839785">,</span>&nbsp;<span class="ident" id="3839787">deadline</span><span class="op" id="3839795">)</span><span class="op" id="3839796">;</span>&nbsp;<span class="ident" id="3839798">err</span>&nbsp;<span class="op" id="3839802">!=</span>&nbsp;<span class="builtintype" id="3839805">nil</span>&nbsp;<span class="op" id="3839809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3839813">fd</span><span class="op" id="3839815">.</span><span class="ident" id="3839816">Close</span><span class="op" id="3839821">(</span><span class="op" id="3839822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839826">return</span>&nbsp;<span class="builtintype" id="3839833">nil</span><span class="op" id="3839836">,</span>&nbsp;<span class="ident" id="3839838">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3839843">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839846">return</span>&nbsp;<span class="ident" id="3839853">fd</span><span class="op" id="3839855">,</span>&nbsp;<span class="builtintype" id="3839857">nil</span><br>
<span class="lineno"></span><span class="op" id="3839861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3839864">func</span>&nbsp;<span class="op" id="3839869">(</span><span class="ident" id="3839870">fd</span>&nbsp;<span class="op" id="3839873">*</span><span class="ident" id="3839874">netFD</span><span class="op" id="3839879">)</span>&nbsp;<span class="ident" id="3839881">addrFunc</span><span class="op" id="3839889">(</span><span class="op" id="3839890">)</span>&nbsp;<span class="keyword" id="3839892">func</span><span class="op" id="3839896">(</span><span class="ident" id="3839897">syscall</span><span class="op" id="3839904">.</span><span class="ident" id="3839905">Sockaddr</span><span class="op" id="3839913">)</span>&nbsp;<span class="ident" id="3839915">Addr</span>&nbsp;<span class="op" id="3839920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839923">switch</span>&nbsp;<span class="ident" id="3839930">fd</span><span class="op" id="3839932">.</span><span class="ident" id="3839933">family</span>&nbsp;<span class="op" id="3839940">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839943">case</span>&nbsp;<span class="ident" id="3839948">syscall</span><span class="op" id="3839955">.</span><span class="ident" id="3839956">AF_INET</span><span class="op" id="3839963">,</span>&nbsp;<span class="ident" id="3839965">syscall</span><span class="op" id="3839972">.</span><span class="ident" id="3839973">AF_INET6</span><span class="op" id="3839981">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839985">switch</span>&nbsp;<span class="ident" id="3839992">fd</span><span class="op" id="3839994">.</span><span class="ident" id="3839995">sotype</span>&nbsp;<span class="op" id="3840002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840006">case</span>&nbsp;<span class="ident" id="3840011">syscall</span><span class="op" id="3840018">.</span><span class="ident" id="3840019">SOCK_STREAM</span><span class="op" id="3840030">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840035">return</span>&nbsp;<span class="ident" id="3840042">sockaddrToTCP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840058">case</span>&nbsp;<span class="ident" id="3840063">syscall</span><span class="op" id="3840070">.</span><span class="ident" id="3840071">SOCK_DGRAM</span><span class="op" id="3840081">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840086">return</span>&nbsp;<span class="ident" id="3840093">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840109">case</span>&nbsp;<span class="ident" id="3840114">syscall</span><span class="op" id="3840121">.</span><span class="ident" id="3840122">SOCK_RAW</span><span class="op" id="3840130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840135">return</span>&nbsp;<span class="ident" id="3840142">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3840157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840160">case</span>&nbsp;<span class="ident" id="3840165">syscall</span><span class="op" id="3840172">.</span><span class="ident" id="3840173">AF_UNIX</span><span class="op" id="3840180">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840184">switch</span>&nbsp;<span class="ident" id="3840191">fd</span><span class="op" id="3840193">.</span><span class="ident" id="3840194">sotype</span>&nbsp;<span class="op" id="3840201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840205">case</span>&nbsp;<span class="ident" id="3840210">syscall</span><span class="op" id="3840217">.</span><span class="ident" id="3840218">SOCK_STREAM</span><span class="op" id="3840229">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840234">return</span>&nbsp;<span class="ident" id="3840241">sockaddrToUnix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840258">case</span>&nbsp;<span class="ident" id="3840263">syscall</span><span class="op" id="3840270">.</span><span class="ident" id="3840271">SOCK_DGRAM</span><span class="op" id="3840281">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840286">return</span>&nbsp;<span class="ident" id="3840293">sockaddrToUnixgram</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840314">case</span>&nbsp;<span class="ident" id="3840319">syscall</span><span class="op" id="3840326">.</span><span class="ident" id="3840327">SOCK_SEQPACKET</span><span class="op" id="3840341">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840346">return</span>&nbsp;<span class="ident" id="3840353">sockaddrToUnixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3840376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3840379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840382">return</span>&nbsp;<span class="keyword" id="3840389">func</span><span class="op" id="3840393">(</span><span class="ident" id="3840394">syscall</span><span class="op" id="3840401">.</span><span class="ident" id="3840402">Sockaddr</span><span class="op" id="3840410">)</span>&nbsp;<span class="ident" id="3840412">Addr</span>&nbsp;<span class="op" id="3840417">{</span>&nbsp;<span class="keyword" id="3840419">return</span>&nbsp;<span class="builtintype" id="3840426">nil</span>&nbsp;<span class="op" id="3840430">}</span><br>
<span class="lineno">120</span><span class="op" id="3840432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3840435">func</span>&nbsp;<span class="op" id="3840440">(</span><span class="ident" id="3840441">fd</span>&nbsp;<span class="op" id="3840444">*</span><span class="ident" id="3840445">netFD</span><span class="op" id="3840450">)</span>&nbsp;<span class="ident" id="3840452">dial</span><span class="op" id="3840456">(</span><span class="ident" id="3840457">laddr</span><span class="op" id="3840462">,</span>&nbsp;<span class="ident" id="3840464">raddr</span>&nbsp;<span class="ident" id="3840470">sockaddr</span><span class="op" id="3840478">,</span>&nbsp;<span class="ident" id="3840480">deadline</span>&nbsp;<span class="ident" id="3840489">time</span><span class="op" id="3840493">.</span><span class="ident" id="3840494">Time</span><span class="op" id="3840498">)</span>&nbsp;<span class="builtintype" id="3840500">error</span>&nbsp;<span class="op" id="3840506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840509">var</span>&nbsp;<span class="ident" id="3840513">err</span>&nbsp;<span class="builtintype" id="3840517">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840524">var</span>&nbsp;<span class="ident" id="3840528">lsa</span>&nbsp;<span class="ident" id="3840532">syscall</span><span class="op" id="3840539">.</span><span class="ident" id="3840540">Sockaddr</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840550">if</span>&nbsp;<span class="ident" id="3840553">laddr</span>&nbsp;<span class="op" id="3840559">!=</span>&nbsp;<span class="builtintype" id="3840562">nil</span>&nbsp;<span class="op" id="3840566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840570">if</span>&nbsp;<span class="ident" id="3840573">lsa</span><span class="op" id="3840576">,</span>&nbsp;<span class="ident" id="3840578">err</span>&nbsp;<span class="op" id="3840582">=</span>&nbsp;<span class="ident" id="3840584">laddr</span><span class="op" id="3840589">.</span><span class="ident" id="3840590">sockaddr</span><span class="op" id="3840598">(</span><span class="ident" id="3840599">fd</span><span class="op" id="3840601">.</span><span class="ident" id="3840602">family</span><span class="op" id="3840608">)</span><span class="op" id="3840609">;</span>&nbsp;<span class="ident" id="3840611">err</span>&nbsp;<span class="op" id="3840615">!=</span>&nbsp;<span class="builtintype" id="3840618">nil</span>&nbsp;<span class="op" id="3840622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840627">return</span>&nbsp;<span class="ident" id="3840634">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3840640">}</span>&nbsp;<span class="keyword" id="3840642">else</span>&nbsp;<span class="keyword" id="3840647">if</span>&nbsp;<span class="ident" id="3840650">lsa</span>&nbsp;<span class="op" id="3840654">!=</span>&nbsp;<span class="builtintype" id="3840657">nil</span>&nbsp;<span class="op" id="3840661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840666">if</span>&nbsp;<span class="ident" id="3840669">err</span>&nbsp;<span class="op" id="3840673">:=</span>&nbsp;<span class="ident" id="3840676">syscall</span><span class="op" id="3840683">.</span><span class="ident" id="3840684">Bind</span><span class="op" id="3840688">(</span><span class="ident" id="3840689">fd</span><span class="op" id="3840691">.</span><span class="ident" id="3840692">sysfd</span><span class="op" id="3840697">,</span>&nbsp;<span class="ident" id="3840699">lsa</span><span class="op" id="3840702">)</span><span class="op" id="3840703">;</span>&nbsp;<span class="ident" id="3840705">err</span>&nbsp;<span class="op" id="3840709">!=</span>&nbsp;<span class="builtintype" id="3840712">nil</span>&nbsp;<span class="op" id="3840716">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840722">return</span>&nbsp;<span class="ident" id="3840729">os</span><span class="op" id="3840731">.</span><span class="ident" id="3840732">NewSyscallError</span><span class="op" id="3840747">(</span><span class="string" id="3840748">&#34;bind&#34;</span><span class="op" id="3840754">,</span>&nbsp;<span class="ident" id="3840756">err</span><span class="op" id="3840759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3840764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3840768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3840771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840774">var</span>&nbsp;<span class="ident" id="3840778">rsa</span>&nbsp;<span class="ident" id="3840782">syscall</span><span class="op" id="3840789">.</span><span class="ident" id="3840790">Sockaddr</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840800">if</span>&nbsp;<span class="ident" id="3840803">raddr</span>&nbsp;<span class="op" id="3840809">!=</span>&nbsp;<span class="builtintype" id="3840812">nil</span>&nbsp;<span class="op" id="3840816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840820">if</span>&nbsp;<span class="ident" id="3840823">rsa</span><span class="op" id="3840826">,</span>&nbsp;<span class="ident" id="3840828">err</span>&nbsp;<span class="op" id="3840832">=</span>&nbsp;<span class="ident" id="3840834">raddr</span><span class="op" id="3840839">.</span><span class="ident" id="3840840">sockaddr</span><span class="op" id="3840848">(</span><span class="ident" id="3840849">fd</span><span class="op" id="3840851">.</span><span class="ident" id="3840852">family</span><span class="op" id="3840858">)</span><span class="op" id="3840859">;</span>&nbsp;<span class="ident" id="3840861">err</span>&nbsp;<span class="op" id="3840865">!=</span>&nbsp;<span class="builtintype" id="3840868">nil</span>&nbsp;<span class="op" id="3840872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840877">return</span>&nbsp;<span class="ident" id="3840884">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3840890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840894">if</span>&nbsp;<span class="ident" id="3840897">err</span>&nbsp;<span class="op" id="3840901">:=</span>&nbsp;<span class="ident" id="3840904">fd</span><span class="op" id="3840906">.</span><span class="ident" id="3840907">connect</span><span class="op" id="3840914">(</span><span class="ident" id="3840915">lsa</span><span class="op" id="3840918">,</span>&nbsp;<span class="ident" id="3840920">rsa</span><span class="op" id="3840923">,</span>&nbsp;<span class="ident" id="3840925">deadline</span><span class="op" id="3840933">)</span><span class="op" id="3840934">;</span>&nbsp;<span class="ident" id="3840936">err</span>&nbsp;<span class="op" id="3840940">!=</span>&nbsp;<span class="builtintype" id="3840943">nil</span>&nbsp;<span class="op" id="3840947">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840952">return</span>&nbsp;<span class="ident" id="3840959">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3840965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3840969">fd</span><span class="op" id="3840971">.</span><span class="ident" id="3840972">isConnected</span>&nbsp;<span class="op" id="3840984">=</span>&nbsp;<span class="builtintype" id="3840986">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3840992">}</span>&nbsp;<span class="keyword" id="3840994">else</span>&nbsp;<span class="op" id="3840999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841003">if</span>&nbsp;<span class="ident" id="3841006">err</span>&nbsp;<span class="op" id="3841010">:=</span>&nbsp;<span class="ident" id="3841013">fd</span><span class="op" id="3841015">.</span><span class="ident" id="3841016">init</span><span class="op" id="3841020">(</span><span class="op" id="3841021">)</span><span class="op" id="3841022">;</span>&nbsp;<span class="ident" id="3841024">err</span>&nbsp;<span class="op" id="3841028">!=</span>&nbsp;<span class="builtintype" id="3841031">nil</span>&nbsp;<span class="op" id="3841035">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841040">return</span>&nbsp;<span class="ident" id="3841047">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3841053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3841056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3841059">lsa</span><span class="op" id="3841062">,</span>&nbsp;<span class="ident" id="3841064">_</span>&nbsp;<span class="op" id="3841066">=</span>&nbsp;<span class="ident" id="3841068">syscall</span><span class="op" id="3841075">.</span><span class="ident" id="3841076">Getsockname</span><span class="op" id="3841087">(</span><span class="ident" id="3841088">fd</span><span class="op" id="3841090">.</span><span class="ident" id="3841091">sysfd</span><span class="op" id="3841096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841099">if</span>&nbsp;<span class="ident" id="3841102">rsa</span><span class="op" id="3841105">,</span>&nbsp;<span class="ident" id="3841107">_</span>&nbsp;<span class="op" id="3841109">=</span>&nbsp;<span class="ident" id="3841111">syscall</span><span class="op" id="3841118">.</span><span class="ident" id="3841119">Getpeername</span><span class="op" id="3841130">(</span><span class="ident" id="3841131">fd</span><span class="op" id="3841133">.</span><span class="ident" id="3841134">sysfd</span><span class="op" id="3841139">)</span><span class="op" id="3841140">;</span>&nbsp;<span class="ident" id="3841142">rsa</span>&nbsp;<span class="op" id="3841146">!=</span>&nbsp;<span class="builtintype" id="3841149">nil</span>&nbsp;<span class="op" id="3841153">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3841157">fd</span><span class="op" id="3841159">.</span><span class="ident" id="3841160">setAddr</span><span class="op" id="3841167">(</span><span class="ident" id="3841168">fd</span><span class="op" id="3841170">.</span><span class="ident" id="3841171">addrFunc</span><span class="op" id="3841179">(</span><span class="op" id="3841180">)</span><span class="op" id="3841181">(</span><span class="ident" id="3841182">lsa</span><span class="op" id="3841185">)</span><span class="op" id="3841186">,</span>&nbsp;<span class="ident" id="3841188">fd</span><span class="op" id="3841190">.</span><span class="ident" id="3841191">addrFunc</span><span class="op" id="3841199">(</span><span class="op" id="3841200">)</span><span class="op" id="3841201">(</span><span class="ident" id="3841202">rsa</span><span class="op" id="3841205">)</span><span class="op" id="3841206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3841209">}</span>&nbsp;<span class="keyword" id="3841211">else</span>&nbsp;<span class="op" id="3841216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3841220">fd</span><span class="op" id="3841222">.</span><span class="ident" id="3841223">setAddr</span><span class="op" id="3841230">(</span><span class="ident" id="3841231">fd</span><span class="op" id="3841233">.</span><span class="ident" id="3841234">addrFunc</span><span class="op" id="3841242">(</span><span class="op" id="3841243">)</span><span class="op" id="3841244">(</span><span class="ident" id="3841245">lsa</span><span class="op" id="3841248">)</span><span class="op" id="3841249">,</span>&nbsp;<span class="ident" id="3841251">raddr</span><span class="op" id="3841256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3841259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841262">return</span>&nbsp;<span class="builtintype" id="3841269">nil</span><br>
<span class="lineno">155</span><span class="op" id="3841273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3841276">func</span>&nbsp;<span class="op" id="3841281">(</span><span class="ident" id="3841282">fd</span>&nbsp;<span class="op" id="3841285">*</span><span class="ident" id="3841286">netFD</span><span class="op" id="3841291">)</span>&nbsp;<span class="ident" id="3841293">listenStream</span><span class="op" id="3841305">(</span><span class="ident" id="3841306">laddr</span>&nbsp;<span class="ident" id="3841312">sockaddr</span><span class="op" id="3841320">,</span>&nbsp;<span class="ident" id="3841322">backlog</span>&nbsp;<span class="builtintype" id="3841330">int</span><span class="op" id="3841333">)</span>&nbsp;<span class="builtintype" id="3841335">error</span>&nbsp;<span class="op" id="3841341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841344">if</span>&nbsp;<span class="ident" id="3841347">err</span>&nbsp;<span class="op" id="3841351">:=</span>&nbsp;<span class="ident" id="3841354">setDefaultListenerSockopts</span><span class="op" id="3841380">(</span><span class="ident" id="3841381">fd</span><span class="op" id="3841383">.</span><span class="ident" id="3841384">sysfd</span><span class="op" id="3841389">)</span><span class="op" id="3841390">;</span>&nbsp;<span class="ident" id="3841392">err</span>&nbsp;<span class="op" id="3841396">!=</span>&nbsp;<span class="builtintype" id="3841399">nil</span>&nbsp;<span class="op" id="3841403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841407">return</span>&nbsp;<span class="ident" id="3841414">err</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3841419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841422">if</span>&nbsp;<span class="ident" id="3841425">lsa</span><span class="op" id="3841428">,</span>&nbsp;<span class="ident" id="3841430">err</span>&nbsp;<span class="op" id="3841434">:=</span>&nbsp;<span class="ident" id="3841437">laddr</span><span class="op" id="3841442">.</span><span class="ident" id="3841443">sockaddr</span><span class="op" id="3841451">(</span><span class="ident" id="3841452">fd</span><span class="op" id="3841454">.</span><span class="ident" id="3841455">family</span><span class="op" id="3841461">)</span><span class="op" id="3841462">;</span>&nbsp;<span class="ident" id="3841464">err</span>&nbsp;<span class="op" id="3841468">!=</span>&nbsp;<span class="builtintype" id="3841471">nil</span>&nbsp;<span class="op" id="3841475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841479">return</span>&nbsp;<span class="ident" id="3841486">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3841491">}</span>&nbsp;<span class="keyword" id="3841493">else</span>&nbsp;<span class="keyword" id="3841498">if</span>&nbsp;<span class="ident" id="3841501">lsa</span>&nbsp;<span class="op" id="3841505">!=</span>&nbsp;<span class="builtintype" id="3841508">nil</span>&nbsp;<span class="op" id="3841512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841516">if</span>&nbsp;<span class="ident" id="3841519">err</span>&nbsp;<span class="op" id="3841523">:=</span>&nbsp;<span class="ident" id="3841526">syscall</span><span class="op" id="3841533">.</span><span class="ident" id="3841534">Bind</span><span class="op" id="3841538">(</span><span class="ident" id="3841539">fd</span><span class="op" id="3841541">.</span><span class="ident" id="3841542">sysfd</span><span class="op" id="3841547">,</span>&nbsp;<span class="ident" id="3841549">lsa</span><span class="op" id="3841552">)</span><span class="op" id="3841553">;</span>&nbsp;<span class="ident" id="3841555">err</span>&nbsp;<span class="op" id="3841559">!=</span>&nbsp;<span class="builtintype" id="3841562">nil</span>&nbsp;<span class="op" id="3841566">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841571">return</span>&nbsp;<span class="ident" id="3841578">os</span><span class="op" id="3841580">.</span><span class="ident" id="3841581">NewSyscallError</span><span class="op" id="3841596">(</span><span class="string" id="3841597">&#34;bind&#34;</span><span class="op" id="3841603">,</span>&nbsp;<span class="ident" id="3841605">err</span><span class="op" id="3841608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3841612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3841615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841618">if</span>&nbsp;<span class="ident" id="3841621">err</span>&nbsp;<span class="op" id="3841625">:=</span>&nbsp;<span class="ident" id="3841628">syscall</span><span class="op" id="3841635">.</span><span class="ident" id="3841636">Listen</span><span class="op" id="3841642">(</span><span class="ident" id="3841643">fd</span><span class="op" id="3841645">.</span><span class="ident" id="3841646">sysfd</span><span class="op" id="3841651">,</span>&nbsp;<span class="ident" id="3841653">backlog</span><span class="op" id="3841660">)</span><span class="op" id="3841661">;</span>&nbsp;<span class="ident" id="3841663">err</span>&nbsp;<span class="op" id="3841667">!=</span>&nbsp;<span class="builtintype" id="3841670">nil</span>&nbsp;<span class="op" id="3841674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841678">return</span>&nbsp;<span class="ident" id="3841685">os</span><span class="op" id="3841687">.</span><span class="ident" id="3841688">NewSyscallError</span><span class="op" id="3841703">(</span><span class="string" id="3841704">&#34;listen&#34;</span><span class="op" id="3841712">,</span>&nbsp;<span class="ident" id="3841714">err</span><span class="op" id="3841717">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3841720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841723">if</span>&nbsp;<span class="ident" id="3841726">err</span>&nbsp;<span class="op" id="3841730">:=</span>&nbsp;<span class="ident" id="3841733">fd</span><span class="op" id="3841735">.</span><span class="ident" id="3841736">init</span><span class="op" id="3841740">(</span><span class="op" id="3841741">)</span><span class="op" id="3841742">;</span>&nbsp;<span class="ident" id="3841744">err</span>&nbsp;<span class="op" id="3841748">!=</span>&nbsp;<span class="builtintype" id="3841751">nil</span>&nbsp;<span class="op" id="3841755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841759">return</span>&nbsp;<span class="ident" id="3841766">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3841771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3841774">lsa</span><span class="op" id="3841777">,</span>&nbsp;<span class="ident" id="3841779">_</span>&nbsp;<span class="op" id="3841781">:=</span>&nbsp;<span class="ident" id="3841784">syscall</span><span class="op" id="3841791">.</span><span class="ident" id="3841792">Getsockname</span><span class="op" id="3841803">(</span><span class="ident" id="3841804">fd</span><span class="op" id="3841806">.</span><span class="ident" id="3841807">sysfd</span><span class="op" id="3841812">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3841815">fd</span><span class="op" id="3841817">.</span><span class="ident" id="3841818">setAddr</span><span class="op" id="3841825">(</span><span class="ident" id="3841826">fd</span><span class="op" id="3841828">.</span><span class="ident" id="3841829">addrFunc</span><span class="op" id="3841837">(</span><span class="op" id="3841838">)</span><span class="op" id="3841839">(</span><span class="ident" id="3841840">lsa</span><span class="op" id="3841843">)</span><span class="op" id="3841844">,</span>&nbsp;<span class="builtintype" id="3841846">nil</span><span class="op" id="3841849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841852">return</span>&nbsp;<span class="builtintype" id="3841859">nil</span><br>
<span class="lineno"></span><span class="op" id="3841863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3841866">func</span>&nbsp;<span class="op" id="3841871">(</span><span class="ident" id="3841872">fd</span>&nbsp;<span class="op" id="3841875">*</span><span class="ident" id="3841876">netFD</span><span class="op" id="3841881">)</span>&nbsp;<span class="ident" id="3841883">listenDatagram</span><span class="op" id="3841897">(</span><span class="ident" id="3841898">laddr</span>&nbsp;<span class="ident" id="3841904">sockaddr</span><span class="op" id="3841912">)</span>&nbsp;<span class="builtintype" id="3841914">error</span>&nbsp;<span class="op" id="3841920">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841923">switch</span>&nbsp;<span class="ident" id="3841930">addr</span>&nbsp;<span class="op" id="3841935">:=</span>&nbsp;<span class="ident" id="3841938">laddr</span><span class="op" id="3841943">.</span><span class="op" id="3841944">(</span><span class="keyword" id="3841945">type</span><span class="op" id="3841949">)</span>&nbsp;<span class="op" id="3841951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841954">case</span>&nbsp;<span class="op" id="3841959">*</span><span class="ident" id="3841960">UDPAddr</span><span class="op" id="3841967">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3841971">//&nbsp;We&nbsp;provide&nbsp;a&nbsp;socket&nbsp;that&nbsp;listens&nbsp;to&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3842023">//&nbsp;address&nbsp;with&nbsp;reusable&nbsp;UDP&nbsp;port&nbsp;when&nbsp;the&nbsp;given&nbsp;laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3842080">//&nbsp;is&nbsp;an&nbsp;appropriate&nbsp;UDP&nbsp;multicast&nbsp;address&nbsp;prefix.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3842133">//&nbsp;This&nbsp;makes&nbsp;it&nbsp;possible&nbsp;for&nbsp;a&nbsp;single&nbsp;UDP&nbsp;listener&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3842190">//&nbsp;join&nbsp;multiple&nbsp;different&nbsp;group&nbsp;addresses,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3842240">//&nbsp;multiple&nbsp;UDP&nbsp;listeners&nbsp;that&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;UDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3842296">//&nbsp;port&nbsp;to&nbsp;join&nbsp;the&nbsp;same&nbsp;group&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842338">if</span>&nbsp;<span class="ident" id="3842341">addr</span><span class="op" id="3842345">.</span><span class="ident" id="3842346">IP</span>&nbsp;<span class="op" id="3842349">!=</span>&nbsp;<span class="builtintype" id="3842352">nil</span>&nbsp;<span class="op" id="3842356">&amp;&amp;</span>&nbsp;<span class="ident" id="3842359">addr</span><span class="op" id="3842363">.</span><span class="ident" id="3842364">IP</span><span class="op" id="3842366">.</span><span class="ident" id="3842367">IsMulticast</span><span class="op" id="3842378">(</span><span class="op" id="3842379">)</span>&nbsp;<span class="op" id="3842381">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842386">if</span>&nbsp;<span class="ident" id="3842389">err</span>&nbsp;<span class="op" id="3842393">:=</span>&nbsp;<span class="ident" id="3842396">setDefaultMulticastSockopts</span><span class="op" id="3842423">(</span><span class="ident" id="3842424">fd</span><span class="op" id="3842426">.</span><span class="ident" id="3842427">sysfd</span><span class="op" id="3842432">)</span><span class="op" id="3842433">;</span>&nbsp;<span class="ident" id="3842435">err</span>&nbsp;<span class="op" id="3842439">!=</span>&nbsp;<span class="builtintype" id="3842442">nil</span>&nbsp;<span class="op" id="3842446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842452">return</span>&nbsp;<span class="ident" id="3842459">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3842471">addr</span>&nbsp;<span class="op" id="3842476">:=</span>&nbsp;<span class="op" id="3842479">*</span><span class="ident" id="3842480">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842488">switch</span>&nbsp;<span class="ident" id="3842495">fd</span><span class="op" id="3842497">.</span><span class="ident" id="3842498">family</span>&nbsp;<span class="op" id="3842505">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842510">case</span>&nbsp;<span class="ident" id="3842515">syscall</span><span class="op" id="3842522">.</span><span class="ident" id="3842523">AF_INET</span><span class="op" id="3842530">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3842536">addr</span><span class="op" id="3842540">.</span><span class="ident" id="3842541">IP</span>&nbsp;<span class="op" id="3842544">=</span>&nbsp;<span class="ident" id="3842546">IPv4zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842558">case</span>&nbsp;<span class="ident" id="3842563">syscall</span><span class="op" id="3842570">.</span><span class="ident" id="3842571">AF_INET6</span><span class="op" id="3842579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3842585">addr</span><span class="op" id="3842589">.</span><span class="ident" id="3842590">IP</span>&nbsp;<span class="op" id="3842593">=</span>&nbsp;<span class="ident" id="3842595">IPv6unspecified</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842614">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3842619">laddr</span>&nbsp;<span class="op" id="3842625">=</span>&nbsp;<span class="op" id="3842627">&amp;</span><span class="ident" id="3842628">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842641">if</span>&nbsp;<span class="ident" id="3842644">lsa</span><span class="op" id="3842647">,</span>&nbsp;<span class="ident" id="3842649">err</span>&nbsp;<span class="op" id="3842653">:=</span>&nbsp;<span class="ident" id="3842656">laddr</span><span class="op" id="3842661">.</span><span class="ident" id="3842662">sockaddr</span><span class="op" id="3842670">(</span><span class="ident" id="3842671">fd</span><span class="op" id="3842673">.</span><span class="ident" id="3842674">family</span><span class="op" id="3842680">)</span><span class="op" id="3842681">;</span>&nbsp;<span class="ident" id="3842683">err</span>&nbsp;<span class="op" id="3842687">!=</span>&nbsp;<span class="builtintype" id="3842690">nil</span>&nbsp;<span class="op" id="3842694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842698">return</span>&nbsp;<span class="ident" id="3842705">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842710">}</span>&nbsp;<span class="keyword" id="3842712">else</span>&nbsp;<span class="keyword" id="3842717">if</span>&nbsp;<span class="ident" id="3842720">lsa</span>&nbsp;<span class="op" id="3842724">!=</span>&nbsp;<span class="builtintype" id="3842727">nil</span>&nbsp;<span class="op" id="3842731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842735">if</span>&nbsp;<span class="ident" id="3842738">err</span>&nbsp;<span class="op" id="3842742">:=</span>&nbsp;<span class="ident" id="3842745">syscall</span><span class="op" id="3842752">.</span><span class="ident" id="3842753">Bind</span><span class="op" id="3842757">(</span><span class="ident" id="3842758">fd</span><span class="op" id="3842760">.</span><span class="ident" id="3842761">sysfd</span><span class="op" id="3842766">,</span>&nbsp;<span class="ident" id="3842768">lsa</span><span class="op" id="3842771">)</span><span class="op" id="3842772">;</span>&nbsp;<span class="ident" id="3842774">err</span>&nbsp;<span class="op" id="3842778">!=</span>&nbsp;<span class="builtintype" id="3842781">nil</span>&nbsp;<span class="op" id="3842785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842790">return</span>&nbsp;<span class="ident" id="3842797">os</span><span class="op" id="3842799">.</span><span class="ident" id="3842800">NewSyscallError</span><span class="op" id="3842815">(</span><span class="string" id="3842816">&#34;bind&#34;</span><span class="op" id="3842822">,</span>&nbsp;<span class="ident" id="3842824">err</span><span class="op" id="3842827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842834">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842837">if</span>&nbsp;<span class="ident" id="3842840">err</span>&nbsp;<span class="op" id="3842844">:=</span>&nbsp;<span class="ident" id="3842847">fd</span><span class="op" id="3842849">.</span><span class="ident" id="3842850">init</span><span class="op" id="3842854">(</span><span class="op" id="3842855">)</span><span class="op" id="3842856">;</span>&nbsp;<span class="ident" id="3842858">err</span>&nbsp;<span class="op" id="3842862">!=</span>&nbsp;<span class="builtintype" id="3842865">nil</span>&nbsp;<span class="op" id="3842869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842873">return</span>&nbsp;<span class="ident" id="3842880">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3842888">lsa</span><span class="op" id="3842891">,</span>&nbsp;<span class="ident" id="3842893">_</span>&nbsp;<span class="op" id="3842895">:=</span>&nbsp;<span class="ident" id="3842898">syscall</span><span class="op" id="3842905">.</span><span class="ident" id="3842906">Getsockname</span><span class="op" id="3842917">(</span><span class="ident" id="3842918">fd</span><span class="op" id="3842920">.</span><span class="ident" id="3842921">sysfd</span><span class="op" id="3842926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3842929">fd</span><span class="op" id="3842931">.</span><span class="ident" id="3842932">setAddr</span><span class="op" id="3842939">(</span><span class="ident" id="3842940">fd</span><span class="op" id="3842942">.</span><span class="ident" id="3842943">addrFunc</span><span class="op" id="3842951">(</span><span class="op" id="3842952">)</span><span class="op" id="3842953">(</span><span class="ident" id="3842954">lsa</span><span class="op" id="3842957">)</span><span class="op" id="3842958">,</span>&nbsp;<span class="builtintype" id="3842960">nil</span><span class="op" id="3842963">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842966">return</span>&nbsp;<span class="builtintype" id="3842973">nil</span><br>
<span class="lineno"></span><span class="op" id="3842977">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
