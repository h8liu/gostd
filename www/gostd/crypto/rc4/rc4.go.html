<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rc4</h2>
<ul>
<li><a href="/gostd/crypto/rc4/rc4.go.html" class="current">rc4.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_asm.go.html">rc4_asm.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_test.go.html">rc4_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3890473">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3890528">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3890582">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3890633">//&nbsp;Package&nbsp;rc4&nbsp;implements&nbsp;RC4&nbsp;encryption,&nbsp;as&nbsp;defined&nbsp;in&nbsp;Bruce&nbsp;Schneier&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3890706">//&nbsp;Applied&nbsp;Cryptography.</span><br>
<span class="lineno"></span><span class="keyword" id="3890731">package</span>&nbsp;<span class="ident" id="3890739">rc4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3890744">//&nbsp;BUG(agl):&nbsp;RC4&nbsp;is&nbsp;in&nbsp;common&nbsp;use&nbsp;but&nbsp;has&nbsp;design&nbsp;weaknesses&nbsp;that&nbsp;make</span><br>
<span class="lineno">10</span><span class="comment" id="3890814">//&nbsp;it&nbsp;a&nbsp;poor&nbsp;choice&nbsp;for&nbsp;new&nbsp;protocols.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3890854">import</span>&nbsp;<span class="string" id="3890861">&#34;strconv&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3890872">//&nbsp;A&nbsp;Cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;RC4&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno">15</span><span class="keyword" id="3890930">type</span>&nbsp;<span class="ident" id="3890935">Cipher</span>&nbsp;<span class="keyword" id="3890942">struct</span>&nbsp;<span class="op" id="3890949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3890952">s</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3890957">[</span><span class="num" id="3890958">256</span><span class="op" id="3890961">]</span><span class="builtintype" id="3890962">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3890970">i</span><span class="op" id="3890971">,</span>&nbsp;<span class="ident" id="3890973">j</span>&nbsp;<span class="builtintype" id="3890975">uint8</span><br>
<span class="lineno"></span><span class="op" id="3890981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3890984">type</span>&nbsp;<span class="ident" id="3890989">KeySizeError</span>&nbsp;<span class="builtintype" id="3891002">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3891007">func</span>&nbsp;<span class="op" id="3891012">(</span><span class="ident" id="3891013">k</span>&nbsp;<span class="ident" id="3891015">KeySizeError</span><span class="op" id="3891027">)</span>&nbsp;<span class="ident" id="3891029">Error</span><span class="op" id="3891034">(</span><span class="op" id="3891035">)</span>&nbsp;<span class="builtintype" id="3891037">string</span>&nbsp;<span class="op" id="3891044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3891047">return</span>&nbsp;<span class="string" id="3891054">&#34;crypto/rc4:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="3891086">+</span>&nbsp;<span class="ident" id="3891088">strconv</span><span class="op" id="3891095">.</span><span class="ident" id="3891096">Itoa</span><span class="op" id="3891100">(</span><span class="builtintype" id="3891101">int</span><span class="op" id="3891104">(</span><span class="ident" id="3891105">k</span><span class="op" id="3891106">)</span><span class="op" id="3891107">)</span><br>
<span class="lineno"></span><span class="op" id="3891109">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3891112">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;Cipher.&nbsp;&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3891191">//&nbsp;RC4&nbsp;key,&nbsp;at&nbsp;least&nbsp;1&nbsp;byte&nbsp;and&nbsp;at&nbsp;most&nbsp;256&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3891242">func</span>&nbsp;<span class="ident" id="3891247">NewCipher</span><span class="op" id="3891256">(</span><span class="ident" id="3891257">key</span>&nbsp;<span class="op" id="3891261">[</span><span class="op" id="3891262">]</span><span class="builtintype" id="3891263">byte</span><span class="op" id="3891267">)</span>&nbsp;<span class="op" id="3891269">(</span><span class="op" id="3891270">*</span><span class="ident" id="3891271">Cipher</span><span class="op" id="3891277">,</span>&nbsp;<span class="builtintype" id="3891279">error</span><span class="op" id="3891284">)</span>&nbsp;<span class="op" id="3891286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3891289">k</span>&nbsp;<span class="op" id="3891291">:=</span>&nbsp;<span class="builtinfunc" id="3891294">len</span><span class="op" id="3891297">(</span><span class="ident" id="3891298">key</span><span class="op" id="3891301">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3891304">if</span>&nbsp;<span class="ident" id="3891307">k</span>&nbsp;<span class="op" id="3891309">&lt;</span>&nbsp;<span class="num" id="3891311">1</span>&nbsp;<span class="op" id="3891313">||</span>&nbsp;<span class="ident" id="3891316">k</span>&nbsp;<span class="op" id="3891318">&gt;</span>&nbsp;<span class="num" id="3891320">256</span>&nbsp;<span class="op" id="3891324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3891328">return</span>&nbsp;<span class="builtintype" id="3891335">nil</span><span class="op" id="3891338">,</span>&nbsp;<span class="ident" id="3891340">KeySizeError</span><span class="op" id="3891352">(</span><span class="ident" id="3891353">k</span><span class="op" id="3891354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3891357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3891360">var</span>&nbsp;<span class="ident" id="3891364">c</span>&nbsp;<span class="ident" id="3891366">Cipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3891374">for</span>&nbsp;<span class="ident" id="3891378">i</span>&nbsp;<span class="op" id="3891380">:=</span>&nbsp;<span class="num" id="3891383">0</span><span class="op" id="3891384">;</span>&nbsp;<span class="ident" id="3891386">i</span>&nbsp;<span class="op" id="3891388">&lt;</span>&nbsp;<span class="num" id="3891390">256</span><span class="op" id="3891393">;</span>&nbsp;<span class="ident" id="3891395">i</span><span class="op" id="3891396">++</span>&nbsp;<span class="op" id="3891399">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3891403">c</span><span class="op" id="3891404">.</span><span class="ident" id="3891405">s</span><span class="op" id="3891406">[</span><span class="ident" id="3891407">i</span><span class="op" id="3891408">]</span>&nbsp;<span class="op" id="3891410">=</span>&nbsp;<span class="builtintype" id="3891412">uint32</span><span class="op" id="3891418">(</span><span class="ident" id="3891419">i</span><span class="op" id="3891420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3891423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3891426">var</span>&nbsp;<span class="ident" id="3891430">j</span>&nbsp;<span class="builtintype" id="3891432">uint8</span>&nbsp;<span class="op" id="3891438">=</span>&nbsp;<span class="num" id="3891440">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3891443">for</span>&nbsp;<span class="ident" id="3891447">i</span>&nbsp;<span class="op" id="3891449">:=</span>&nbsp;<span class="num" id="3891452">0</span><span class="op" id="3891453">;</span>&nbsp;<span class="ident" id="3891455">i</span>&nbsp;<span class="op" id="3891457">&lt;</span>&nbsp;<span class="num" id="3891459">256</span><span class="op" id="3891462">;</span>&nbsp;<span class="ident" id="3891464">i</span><span class="op" id="3891465">++</span>&nbsp;<span class="op" id="3891468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3891472">j</span>&nbsp;<span class="op" id="3891474">+=</span>&nbsp;<span class="builtintype" id="3891477">uint8</span><span class="op" id="3891482">(</span><span class="ident" id="3891483">c</span><span class="op" id="3891484">.</span><span class="ident" id="3891485">s</span><span class="op" id="3891486">[</span><span class="ident" id="3891487">i</span><span class="op" id="3891488">]</span><span class="op" id="3891489">)</span>&nbsp;<span class="op" id="3891491">+</span>&nbsp;<span class="ident" id="3891493">key</span><span class="op" id="3891496">[</span><span class="ident" id="3891497">i</span><span class="op" id="3891498">%</span><span class="ident" id="3891499">k</span><span class="op" id="3891500">]</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3891504">c</span><span class="op" id="3891505">.</span><span class="ident" id="3891506">s</span><span class="op" id="3891507">[</span><span class="ident" id="3891508">i</span><span class="op" id="3891509">]</span><span class="op" id="3891510">,</span>&nbsp;<span class="ident" id="3891512">c</span><span class="op" id="3891513">.</span><span class="ident" id="3891514">s</span><span class="op" id="3891515">[</span><span class="ident" id="3891516">j</span><span class="op" id="3891517">]</span>&nbsp;<span class="op" id="3891519">=</span>&nbsp;<span class="ident" id="3891521">c</span><span class="op" id="3891522">.</span><span class="ident" id="3891523">s</span><span class="op" id="3891524">[</span><span class="ident" id="3891525">j</span><span class="op" id="3891526">]</span><span class="op" id="3891527">,</span>&nbsp;<span class="ident" id="3891529">c</span><span class="op" id="3891530">.</span><span class="ident" id="3891531">s</span><span class="op" id="3891532">[</span><span class="ident" id="3891533">i</span><span class="op" id="3891534">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3891537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3891540">return</span>&nbsp;<span class="op" id="3891547">&amp;</span><span class="ident" id="3891548">c</span><span class="op" id="3891549">,</span>&nbsp;<span class="builtintype" id="3891551">nil</span><br>
<span class="lineno"></span><span class="op" id="3891555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="3891558">//&nbsp;Reset&nbsp;zeros&nbsp;the&nbsp;key&nbsp;data&nbsp;so&nbsp;that&nbsp;it&nbsp;will&nbsp;no&nbsp;longer&nbsp;appear&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3891626">//&nbsp;process&#39;s&nbsp;memory.</span><br>
<span class="lineno"></span><span class="keyword" id="3891647">func</span>&nbsp;<span class="op" id="3891652">(</span><span class="ident" id="3891653">c</span>&nbsp;<span class="op" id="3891655">*</span><span class="ident" id="3891656">Cipher</span><span class="op" id="3891662">)</span>&nbsp;<span class="ident" id="3891664">Reset</span><span class="op" id="3891669">(</span><span class="op" id="3891670">)</span>&nbsp;<span class="op" id="3891672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3891675">for</span>&nbsp;<span class="ident" id="3891679">i</span>&nbsp;<span class="op" id="3891681">:=</span>&nbsp;<span class="keyword" id="3891684">range</span>&nbsp;<span class="ident" id="3891690">c</span><span class="op" id="3891691">.</span><span class="ident" id="3891692">s</span>&nbsp;<span class="op" id="3891694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3891698">c</span><span class="op" id="3891699">.</span><span class="ident" id="3891700">s</span><span class="op" id="3891701">[</span><span class="ident" id="3891702">i</span><span class="op" id="3891703">]</span>&nbsp;<span class="op" id="3891705">=</span>&nbsp;<span class="num" id="3891707">0</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3891710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3891713">c</span><span class="op" id="3891714">.</span><span class="ident" id="3891715">i</span><span class="op" id="3891716">,</span>&nbsp;<span class="ident" id="3891718">c</span><span class="op" id="3891719">.</span><span class="ident" id="3891720">j</span>&nbsp;<span class="op" id="3891722">=</span>&nbsp;<span class="num" id="3891724">0</span><span class="op" id="3891725">,</span>&nbsp;<span class="num" id="3891727">0</span><br>
<span class="lineno"></span><span class="op" id="3891729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3891732">//&nbsp;xorKeyStreamGeneric&nbsp;sets&nbsp;dst&nbsp;to&nbsp;the&nbsp;result&nbsp;of&nbsp;XORing&nbsp;src&nbsp;with&nbsp;the</span><br>
<span class="lineno">55</span><span class="comment" id="3891801">//&nbsp;key&nbsp;stream.&nbsp;&nbsp;Dst&nbsp;and&nbsp;src&nbsp;may&nbsp;be&nbsp;the&nbsp;same&nbsp;slice&nbsp;but&nbsp;otherwise&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="3891872">//&nbsp;not&nbsp;overlap.</span><br>
<span class="lineno"></span><span class="comment" id="3891888">//</span><br>
<span class="lineno"></span><span class="comment" id="3891891">//&nbsp;This&nbsp;is&nbsp;the&nbsp;pure&nbsp;Go&nbsp;version.&nbsp;rc4_{amd64,386,arm}*&nbsp;contain&nbsp;assembly</span><br>
<span class="lineno"></span><span class="comment" id="3891961">//&nbsp;implementations.&nbsp;This&nbsp;is&nbsp;here&nbsp;for&nbsp;tests&nbsp;and&nbsp;to&nbsp;prevent&nbsp;bitrot.</span><br>
<span class="lineno">60</span><span class="keyword" id="3892027">func</span>&nbsp;<span class="op" id="3892032">(</span><span class="ident" id="3892033">c</span>&nbsp;<span class="op" id="3892035">*</span><span class="ident" id="3892036">Cipher</span><span class="op" id="3892042">)</span>&nbsp;<span class="ident" id="3892044">xorKeyStreamGeneric</span><span class="op" id="3892063">(</span><span class="ident" id="3892064">dst</span><span class="op" id="3892067">,</span>&nbsp;<span class="ident" id="3892069">src</span>&nbsp;<span class="op" id="3892073">[</span><span class="op" id="3892074">]</span><span class="builtintype" id="3892075">byte</span><span class="op" id="3892079">)</span>&nbsp;<span class="op" id="3892081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3892084">i</span><span class="op" id="3892085">,</span>&nbsp;<span class="ident" id="3892087">j</span>&nbsp;<span class="op" id="3892089">:=</span>&nbsp;<span class="ident" id="3892092">c</span><span class="op" id="3892093">.</span><span class="ident" id="3892094">i</span><span class="op" id="3892095">,</span>&nbsp;<span class="ident" id="3892097">c</span><span class="op" id="3892098">.</span><span class="ident" id="3892099">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3892102">for</span>&nbsp;<span class="ident" id="3892106">k</span><span class="op" id="3892107">,</span>&nbsp;<span class="ident" id="3892109">v</span>&nbsp;<span class="op" id="3892111">:=</span>&nbsp;<span class="keyword" id="3892114">range</span>&nbsp;<span class="ident" id="3892120">src</span>&nbsp;<span class="op" id="3892124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3892128">i</span>&nbsp;<span class="op" id="3892130">+=</span>&nbsp;<span class="num" id="3892133">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3892137">j</span>&nbsp;<span class="op" id="3892139">+=</span>&nbsp;<span class="builtintype" id="3892142">uint8</span><span class="op" id="3892147">(</span><span class="ident" id="3892148">c</span><span class="op" id="3892149">.</span><span class="ident" id="3892150">s</span><span class="op" id="3892151">[</span><span class="ident" id="3892152">i</span><span class="op" id="3892153">]</span><span class="op" id="3892154">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3892158">c</span><span class="op" id="3892159">.</span><span class="ident" id="3892160">s</span><span class="op" id="3892161">[</span><span class="ident" id="3892162">i</span><span class="op" id="3892163">]</span><span class="op" id="3892164">,</span>&nbsp;<span class="ident" id="3892166">c</span><span class="op" id="3892167">.</span><span class="ident" id="3892168">s</span><span class="op" id="3892169">[</span><span class="ident" id="3892170">j</span><span class="op" id="3892171">]</span>&nbsp;<span class="op" id="3892173">=</span>&nbsp;<span class="ident" id="3892175">c</span><span class="op" id="3892176">.</span><span class="ident" id="3892177">s</span><span class="op" id="3892178">[</span><span class="ident" id="3892179">j</span><span class="op" id="3892180">]</span><span class="op" id="3892181">,</span>&nbsp;<span class="ident" id="3892183">c</span><span class="op" id="3892184">.</span><span class="ident" id="3892185">s</span><span class="op" id="3892186">[</span><span class="ident" id="3892187">i</span><span class="op" id="3892188">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3892192">dst</span><span class="op" id="3892195">[</span><span class="ident" id="3892196">k</span><span class="op" id="3892197">]</span>&nbsp;<span class="op" id="3892199">=</span>&nbsp;<span class="ident" id="3892201">v</span>&nbsp;<span class="op" id="3892203">^</span>&nbsp;<span class="builtintype" id="3892205">uint8</span><span class="op" id="3892210">(</span><span class="ident" id="3892211">c</span><span class="op" id="3892212">.</span><span class="ident" id="3892213">s</span><span class="op" id="3892214">[</span><span class="builtintype" id="3892215">uint8</span><span class="op" id="3892220">(</span><span class="ident" id="3892221">c</span><span class="op" id="3892222">.</span><span class="ident" id="3892223">s</span><span class="op" id="3892224">[</span><span class="ident" id="3892225">i</span><span class="op" id="3892226">]</span><span class="op" id="3892227">+</span><span class="ident" id="3892228">c</span><span class="op" id="3892229">.</span><span class="ident" id="3892230">s</span><span class="op" id="3892231">[</span><span class="ident" id="3892232">j</span><span class="op" id="3892233">]</span><span class="op" id="3892234">)</span><span class="op" id="3892235">]</span><span class="op" id="3892236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3892239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3892242">c</span><span class="op" id="3892243">.</span><span class="ident" id="3892244">i</span><span class="op" id="3892245">,</span>&nbsp;<span class="ident" id="3892247">c</span><span class="op" id="3892248">.</span><span class="ident" id="3892249">j</span>&nbsp;<span class="op" id="3892251">=</span>&nbsp;<span class="ident" id="3892253">i</span><span class="op" id="3892254">,</span>&nbsp;<span class="ident" id="3892256">j</span><br>
<span class="lineno"></span><span class="op" id="3892258">}</span>
</div>
</body>
</html>
