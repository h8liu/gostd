<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/exec</h2>
<ul>
<li><a href="/gostd/os/exec/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/exec/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/os/exec/lp_test.go.html">lp_test.go</a></li>
<li><a href="/gostd/os/exec/lp_unix.go.html">lp_unix.go</a></li>
<li><a href="/gostd/os/exec/lp_unix_test.go.html" class="current">lp_unix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7917809">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7917865">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7917919">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7917970">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7918035">package</span>&nbsp;<span class="ident" id="7918043">exec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7918049">import</span>&nbsp;<span class="op" id="7918056">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7918059">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7918072">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7918078">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7918088">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7918091">func</span>&nbsp;<span class="ident" id="7918096">TestLookPathUnixEmptyPath</span><span class="op" id="7918121">(</span><span class="ident" id="7918122">t</span>&nbsp;<span class="op" id="7918124">*</span><span class="ident" id="7918125">testing</span><span class="op" id="7918132">.</span><span class="ident" id="7918133">T</span><span class="op" id="7918134">)</span>&nbsp;<span class="op" id="7918136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918139">tmp</span><span class="op" id="7918142">,</span>&nbsp;<span class="ident" id="7918144">err</span>&nbsp;<span class="op" id="7918148">:=</span>&nbsp;<span class="ident" id="7918151">ioutil</span><span class="op" id="7918157">.</span><span class="ident" id="7918158">TempDir</span><span class="op" id="7918165">(</span><span class="string" id="7918166">&#34;&#34;</span><span class="op" id="7918168">,</span>&nbsp;<span class="string" id="7918170">&#34;TestLookPathUnixEmptyPath&#34;</span><span class="op" id="7918197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918200">if</span>&nbsp;<span class="ident" id="7918203">err</span>&nbsp;<span class="op" id="7918207">!=</span>&nbsp;<span class="ident" id="7918210">nil</span>&nbsp;<span class="op" id="7918214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918218">t</span><span class="op" id="7918219">.</span><span class="ident" id="7918220">Fatal</span><span class="op" id="7918225">(</span><span class="string" id="7918226">&#34;TempDir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7918244">,</span>&nbsp;<span class="ident" id="7918246">err</span><span class="op" id="7918249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918252">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918255">defer</span>&nbsp;<span class="ident" id="7918261">os</span><span class="op" id="7918263">.</span><span class="ident" id="7918264">RemoveAll</span><span class="op" id="7918273">(</span><span class="ident" id="7918274">tmp</span><span class="op" id="7918277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918280">wd</span><span class="op" id="7918282">,</span>&nbsp;<span class="ident" id="7918284">err</span>&nbsp;<span class="op" id="7918288">:=</span>&nbsp;<span class="ident" id="7918291">os</span><span class="op" id="7918293">.</span><span class="ident" id="7918294">Getwd</span><span class="op" id="7918299">(</span><span class="op" id="7918300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918303">if</span>&nbsp;<span class="ident" id="7918306">err</span>&nbsp;<span class="op" id="7918310">!=</span>&nbsp;<span class="ident" id="7918313">nil</span>&nbsp;<span class="op" id="7918317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918321">t</span><span class="op" id="7918322">.</span><span class="ident" id="7918323">Fatal</span><span class="op" id="7918328">(</span><span class="string" id="7918329">&#34;Getwd&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7918345">,</span>&nbsp;<span class="ident" id="7918347">err</span><span class="op" id="7918350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918353">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918356">err</span>&nbsp;<span class="op" id="7918360">=</span>&nbsp;<span class="ident" id="7918362">os</span><span class="op" id="7918364">.</span><span class="ident" id="7918365">Chdir</span><span class="op" id="7918370">(</span><span class="ident" id="7918371">tmp</span><span class="op" id="7918374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918377">if</span>&nbsp;<span class="ident" id="7918380">err</span>&nbsp;<span class="op" id="7918384">!=</span>&nbsp;<span class="ident" id="7918387">nil</span>&nbsp;<span class="op" id="7918391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918395">t</span><span class="op" id="7918396">.</span><span class="ident" id="7918397">Fatal</span><span class="op" id="7918402">(</span><span class="string" id="7918403">&#34;Chdir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7918419">,</span>&nbsp;<span class="ident" id="7918421">err</span><span class="op" id="7918424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918430">defer</span>&nbsp;<span class="ident" id="7918436">os</span><span class="op" id="7918438">.</span><span class="ident" id="7918439">Chdir</span><span class="op" id="7918444">(</span><span class="ident" id="7918445">wd</span><span class="op" id="7918447">)</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918451">f</span><span class="op" id="7918452">,</span>&nbsp;<span class="ident" id="7918454">err</span>&nbsp;<span class="op" id="7918458">:=</span>&nbsp;<span class="ident" id="7918461">os</span><span class="op" id="7918463">.</span><span class="ident" id="7918464">OpenFile</span><span class="op" id="7918472">(</span><span class="string" id="7918473">&#34;exec_me&#34;</span><span class="op" id="7918482">,</span>&nbsp;<span class="ident" id="7918484">os</span><span class="op" id="7918486">.</span><span class="ident" id="7918487">O_CREATE</span><span class="op" id="7918495">|</span><span class="ident" id="7918496">os</span><span class="op" id="7918498">.</span><span class="ident" id="7918499">O_EXCL</span><span class="op" id="7918505">,</span>&nbsp;<span class="num" id="7918507">0700</span><span class="op" id="7918511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918514">if</span>&nbsp;<span class="ident" id="7918517">err</span>&nbsp;<span class="op" id="7918521">!=</span>&nbsp;<span class="ident" id="7918524">nil</span>&nbsp;<span class="op" id="7918528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918532">t</span><span class="op" id="7918533">.</span><span class="ident" id="7918534">Fatal</span><span class="op" id="7918539">(</span><span class="string" id="7918540">&#34;OpenFile&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7918559">,</span>&nbsp;<span class="ident" id="7918561">err</span><span class="op" id="7918564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918567">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918570">err</span>&nbsp;<span class="op" id="7918574">=</span>&nbsp;<span class="ident" id="7918576">f</span><span class="op" id="7918577">.</span><span class="ident" id="7918578">Close</span><span class="op" id="7918583">(</span><span class="op" id="7918584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918587">if</span>&nbsp;<span class="ident" id="7918590">err</span>&nbsp;<span class="op" id="7918594">!=</span>&nbsp;<span class="ident" id="7918597">nil</span>&nbsp;<span class="op" id="7918601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918605">t</span><span class="op" id="7918606">.</span><span class="ident" id="7918607">Fatal</span><span class="op" id="7918612">(</span><span class="string" id="7918613">&#34;Close&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7918629">,</span>&nbsp;<span class="ident" id="7918631">err</span><span class="op" id="7918634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918641">pathenv</span>&nbsp;<span class="op" id="7918649">:=</span>&nbsp;<span class="ident" id="7918652">os</span><span class="op" id="7918654">.</span><span class="ident" id="7918655">Getenv</span><span class="op" id="7918661">(</span><span class="string" id="7918662">&#34;PATH&#34;</span><span class="op" id="7918668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918671">defer</span>&nbsp;<span class="ident" id="7918677">os</span><span class="op" id="7918679">.</span><span class="ident" id="7918680">Setenv</span><span class="op" id="7918686">(</span><span class="string" id="7918687">&#34;PATH&#34;</span><span class="op" id="7918693">,</span>&nbsp;<span class="ident" id="7918695">pathenv</span><span class="op" id="7918702">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918706">err</span>&nbsp;<span class="op" id="7918710">=</span>&nbsp;<span class="ident" id="7918712">os</span><span class="op" id="7918714">.</span><span class="ident" id="7918715">Setenv</span><span class="op" id="7918721">(</span><span class="string" id="7918722">&#34;PATH&#34;</span><span class="op" id="7918728">,</span>&nbsp;<span class="string" id="7918730">&#34;&#34;</span><span class="op" id="7918732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918735">if</span>&nbsp;<span class="ident" id="7918738">err</span>&nbsp;<span class="op" id="7918742">!=</span>&nbsp;<span class="ident" id="7918745">nil</span>&nbsp;<span class="op" id="7918749">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918753">t</span><span class="op" id="7918754">.</span><span class="ident" id="7918755">Fatal</span><span class="op" id="7918760">(</span><span class="string" id="7918761">&#34;Setenv&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7918778">,</span>&nbsp;<span class="ident" id="7918780">err</span><span class="op" id="7918783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918790">path</span><span class="op" id="7918794">,</span>&nbsp;<span class="ident" id="7918796">err</span>&nbsp;<span class="op" id="7918800">:=</span>&nbsp;<span class="ident" id="7918803">LookPath</span><span class="op" id="7918811">(</span><span class="string" id="7918812">&#34;exec_me&#34;</span><span class="op" id="7918821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918824">if</span>&nbsp;<span class="ident" id="7918827">err</span>&nbsp;<span class="op" id="7918831">==</span>&nbsp;<span class="ident" id="7918834">nil</span>&nbsp;<span class="op" id="7918838">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918842">t</span><span class="op" id="7918843">.</span><span class="ident" id="7918844">Fatal</span><span class="op" id="7918849">(</span><span class="string" id="7918850">&#34;LookPath&nbsp;found&nbsp;exec_me&nbsp;in&nbsp;empty&nbsp;$PATH&#34;</span><span class="op" id="7918889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918895">if</span>&nbsp;<span class="ident" id="7918898">path</span>&nbsp;<span class="op" id="7918903">!=</span>&nbsp;<span class="string" id="7918906">&#34;&#34;</span>&nbsp;<span class="op" id="7918909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918913">t</span><span class="op" id="7918914">.</span><span class="ident" id="7918915">Fatalf</span><span class="op" id="7918921">(</span><span class="string" id="7918922">&#34;LookPath&nbsp;path&nbsp;==&nbsp;%q&nbsp;when&nbsp;err&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="7918959">,</span>&nbsp;<span class="ident" id="7918961">path</span><span class="op" id="7918965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918968">}</span><br>
<span class="lineno">55</span><span class="op" id="7918970">}</span>
</div>
</body>
</html>
