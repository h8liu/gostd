<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html" class="current">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3079022">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3079077">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3079131">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3079182">//&nbsp;Read&nbsp;static&nbsp;host/IP&nbsp;entries&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3079231">package</span>&nbsp;<span class="ident" id="3079239">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3079244">import</span>&nbsp;<span class="op" id="3079251">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3079254">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3079262">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3079269">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3079272">const</span>&nbsp;<span class="ident" id="3079278">cacheMaxAge</span>&nbsp;<span class="op" id="3079290">=</span>&nbsp;<span class="num" id="3079292">5</span>&nbsp;<span class="op" id="3079294">*</span>&nbsp;<span class="ident" id="3079296">time</span><span class="op" id="3079300">.</span><span class="ident" id="3079301">Minute</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3079309">//&nbsp;hostsPath&nbsp;points&nbsp;to&nbsp;the&nbsp;file&nbsp;with&nbsp;static&nbsp;IP/address&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="3079373">var</span>&nbsp;<span class="ident" id="3079377">hostsPath</span>&nbsp;<span class="op" id="3079387">=</span>&nbsp;<span class="string" id="3079389">&#34;/etc/hosts&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3079403">//&nbsp;Simple&nbsp;cache.</span><br>
<span class="lineno">20</span><span class="keyword" id="3079420">var</span>&nbsp;<span class="ident" id="3079424">hosts</span>&nbsp;<span class="keyword" id="3079430">struct</span>&nbsp;<span class="op" id="3079437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3079440">sync</span><span class="op" id="3079444">.</span><span class="ident" id="3079445">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3079452">byName</span>&nbsp;<span class="keyword" id="3079459">map</span><span class="op" id="3079462">[</span><span class="builtintype" id="3079463">string</span><span class="op" id="3079469">]</span><span class="op" id="3079470">[</span><span class="op" id="3079471">]</span><span class="builtintype" id="3079472">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3079480">byAddr</span>&nbsp;<span class="keyword" id="3079487">map</span><span class="op" id="3079490">[</span><span class="builtintype" id="3079491">string</span><span class="op" id="3079497">]</span><span class="op" id="3079498">[</span><span class="op" id="3079499">]</span><span class="builtintype" id="3079500">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3079508">expire</span>&nbsp;<span class="ident" id="3079515">time</span><span class="op" id="3079519">.</span><span class="ident" id="3079520">Time</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3079526">path</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3079533">string</span><br>
<span class="lineno"></span><span class="op" id="3079540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3079543">func</span>&nbsp;<span class="ident" id="3079548">readHosts</span><span class="op" id="3079557">(</span><span class="op" id="3079558">)</span>&nbsp;<span class="op" id="3079560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3079563">now</span>&nbsp;<span class="op" id="3079567">:=</span>&nbsp;<span class="ident" id="3079570">time</span><span class="op" id="3079574">.</span><span class="ident" id="3079575">Now</span><span class="op" id="3079578">(</span><span class="op" id="3079579">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3079582">hp</span>&nbsp;<span class="op" id="3079585">:=</span>&nbsp;<span class="ident" id="3079588">hostsPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3079599">if</span>&nbsp;<span class="builtinfunc" id="3079602">len</span><span class="op" id="3079605">(</span><span class="ident" id="3079606">hosts</span><span class="op" id="3079611">.</span><span class="ident" id="3079612">byName</span><span class="op" id="3079618">)</span>&nbsp;<span class="op" id="3079620">==</span>&nbsp;<span class="num" id="3079623">0</span>&nbsp;<span class="op" id="3079625">||</span>&nbsp;<span class="ident" id="3079628">now</span><span class="op" id="3079631">.</span><span class="ident" id="3079632">After</span><span class="op" id="3079637">(</span><span class="ident" id="3079638">hosts</span><span class="op" id="3079643">.</span><span class="ident" id="3079644">expire</span><span class="op" id="3079650">)</span>&nbsp;<span class="op" id="3079652">||</span>&nbsp;<span class="ident" id="3079655">hosts</span><span class="op" id="3079660">.</span><span class="ident" id="3079661">path</span>&nbsp;<span class="op" id="3079666">!=</span>&nbsp;<span class="ident" id="3079669">hp</span>&nbsp;<span class="op" id="3079672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3079676">hs</span>&nbsp;<span class="op" id="3079679">:=</span>&nbsp;<span class="builtinfunc" id="3079682">make</span><span class="op" id="3079686">(</span><span class="keyword" id="3079687">map</span><span class="op" id="3079690">[</span><span class="builtintype" id="3079691">string</span><span class="op" id="3079697">]</span><span class="op" id="3079698">[</span><span class="op" id="3079699">]</span><span class="builtintype" id="3079700">string</span><span class="op" id="3079706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3079710">is</span>&nbsp;<span class="op" id="3079713">:=</span>&nbsp;<span class="builtinfunc" id="3079716">make</span><span class="op" id="3079720">(</span><span class="keyword" id="3079721">map</span><span class="op" id="3079724">[</span><span class="builtintype" id="3079725">string</span><span class="op" id="3079731">]</span><span class="op" id="3079732">[</span><span class="op" id="3079733">]</span><span class="builtintype" id="3079734">string</span><span class="op" id="3079740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3079744">var</span>&nbsp;<span class="ident" id="3079748">file</span>&nbsp;<span class="op" id="3079753">*</span><span class="ident" id="3079754">file</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3079761">if</span>&nbsp;<span class="ident" id="3079764">file</span><span class="op" id="3079768">,</span>&nbsp;<span class="ident" id="3079770">_</span>&nbsp;<span class="op" id="3079772">=</span>&nbsp;<span class="ident" id="3079774">open</span><span class="op" id="3079778">(</span><span class="ident" id="3079779">hp</span><span class="op" id="3079781">)</span><span class="op" id="3079782">;</span>&nbsp;<span class="ident" id="3079784">file</span>&nbsp;<span class="op" id="3079789">==</span>&nbsp;<span class="ident" id="3079792">nil</span>&nbsp;<span class="op" id="3079796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3079801">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3079810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3079814">for</span>&nbsp;<span class="ident" id="3079818">line</span><span class="op" id="3079822">,</span>&nbsp;<span class="ident" id="3079824">ok</span>&nbsp;<span class="op" id="3079827">:=</span>&nbsp;<span class="ident" id="3079830">file</span><span class="op" id="3079834">.</span><span class="ident" id="3079835">readLine</span><span class="op" id="3079843">(</span><span class="op" id="3079844">)</span><span class="op" id="3079845">;</span>&nbsp;<span class="ident" id="3079847">ok</span><span class="op" id="3079849">;</span>&nbsp;<span class="ident" id="3079851">line</span><span class="op" id="3079855">,</span>&nbsp;<span class="ident" id="3079857">ok</span>&nbsp;<span class="op" id="3079860">=</span>&nbsp;<span class="ident" id="3079862">file</span><span class="op" id="3079866">.</span><span class="ident" id="3079867">readLine</span><span class="op" id="3079875">(</span><span class="op" id="3079876">)</span>&nbsp;<span class="op" id="3079878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3079883">if</span>&nbsp;<span class="ident" id="3079886">i</span>&nbsp;<span class="op" id="3079888">:=</span>&nbsp;<span class="ident" id="3079891">byteIndex</span><span class="op" id="3079900">(</span><span class="ident" id="3079901">line</span><span class="op" id="3079905">,</span>&nbsp;<span class="string" id="3079907">&#39;#&#39;</span><span class="op" id="3079910">)</span><span class="op" id="3079911">;</span>&nbsp;<span class="ident" id="3079913">i</span>&nbsp;<span class="op" id="3079915">&gt;=</span>&nbsp;<span class="num" id="3079918">0</span>&nbsp;<span class="op" id="3079920">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3079926">//&nbsp;Discard&nbsp;comments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3079951">line</span>&nbsp;<span class="op" id="3079956">=</span>&nbsp;<span class="ident" id="3079958">line</span><span class="op" id="3079962">[</span><span class="num" id="3079963">0</span><span class="op" id="3079964">:</span><span class="ident" id="3079965">i</span><span class="op" id="3079966">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3079971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3079976">f</span>&nbsp;<span class="op" id="3079978">:=</span>&nbsp;<span class="ident" id="3079981">getFields</span><span class="op" id="3079990">(</span><span class="ident" id="3079991">line</span><span class="op" id="3079995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3080000">if</span>&nbsp;<span class="builtinfunc" id="3080003">len</span><span class="op" id="3080006">(</span><span class="ident" id="3080007">f</span><span class="op" id="3080008">)</span>&nbsp;<span class="op" id="3080010">&lt;</span>&nbsp;<span class="num" id="3080012">2</span>&nbsp;<span class="op" id="3080014">||</span>&nbsp;<span class="ident" id="3080017">ParseIP</span><span class="op" id="3080024">(</span><span class="ident" id="3080025">f</span><span class="op" id="3080026">[</span><span class="num" id="3080027">0</span><span class="op" id="3080028">]</span><span class="op" id="3080029">)</span>&nbsp;<span class="op" id="3080031">==</span>&nbsp;<span class="ident" id="3080034">nil</span>&nbsp;<span class="op" id="3080038">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3080044">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3080056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3080061">for</span>&nbsp;<span class="ident" id="3080065">i</span>&nbsp;<span class="op" id="3080067">:=</span>&nbsp;<span class="num" id="3080070">1</span><span class="op" id="3080071">;</span>&nbsp;<span class="ident" id="3080073">i</span>&nbsp;<span class="op" id="3080075">&lt;</span>&nbsp;<span class="builtinfunc" id="3080077">len</span><span class="op" id="3080080">(</span><span class="ident" id="3080081">f</span><span class="op" id="3080082">)</span><span class="op" id="3080083">;</span>&nbsp;<span class="ident" id="3080085">i</span><span class="op" id="3080086">++</span>&nbsp;<span class="op" id="3080089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3080095">h</span>&nbsp;<span class="op" id="3080097">:=</span>&nbsp;<span class="ident" id="3080100">f</span><span class="op" id="3080101">[</span><span class="ident" id="3080102">i</span><span class="op" id="3080103">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3080109">hs</span><span class="op" id="3080111">[</span><span class="ident" id="3080112">h</span><span class="op" id="3080113">]</span>&nbsp;<span class="op" id="3080115">=</span>&nbsp;<span class="builtinfunc" id="3080117">append</span><span class="op" id="3080123">(</span><span class="ident" id="3080124">hs</span><span class="op" id="3080126">[</span><span class="ident" id="3080127">h</span><span class="op" id="3080128">]</span><span class="op" id="3080129">,</span>&nbsp;<span class="ident" id="3080131">f</span><span class="op" id="3080132">[</span><span class="num" id="3080133">0</span><span class="op" id="3080134">]</span><span class="op" id="3080135">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3080141">is</span><span class="op" id="3080143">[</span><span class="ident" id="3080144">f</span><span class="op" id="3080145">[</span><span class="num" id="3080146">0</span><span class="op" id="3080147">]</span><span class="op" id="3080148">]</span>&nbsp;<span class="op" id="3080150">=</span>&nbsp;<span class="builtinfunc" id="3080152">append</span><span class="op" id="3080158">(</span><span class="ident" id="3080159">is</span><span class="op" id="3080161">[</span><span class="ident" id="3080162">f</span><span class="op" id="3080163">[</span><span class="num" id="3080164">0</span><span class="op" id="3080165">]</span><span class="op" id="3080166">]</span><span class="op" id="3080167">,</span>&nbsp;<span class="ident" id="3080169">h</span><span class="op" id="3080170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3080175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3080179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3080183">//&nbsp;Update&nbsp;the&nbsp;data&nbsp;cache.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3080211">hosts</span><span class="op" id="3080216">.</span><span class="ident" id="3080217">expire</span>&nbsp;<span class="op" id="3080224">=</span>&nbsp;<span class="ident" id="3080226">now</span><span class="op" id="3080229">.</span><span class="ident" id="3080230">Add</span><span class="op" id="3080233">(</span><span class="ident" id="3080234">cacheMaxAge</span><span class="op" id="3080245">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3080249">hosts</span><span class="op" id="3080254">.</span><span class="ident" id="3080255">path</span>&nbsp;<span class="op" id="3080260">=</span>&nbsp;<span class="ident" id="3080262">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3080267">hosts</span><span class="op" id="3080272">.</span><span class="ident" id="3080273">byName</span>&nbsp;<span class="op" id="3080280">=</span>&nbsp;<span class="ident" id="3080282">hs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3080287">hosts</span><span class="op" id="3080292">.</span><span class="ident" id="3080293">byAddr</span>&nbsp;<span class="op" id="3080300">=</span>&nbsp;<span class="ident" id="3080302">is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3080307">file</span><span class="op" id="3080311">.</span><span class="builtinfunc" id="3080312">close</span><span class="op" id="3080317">(</span><span class="op" id="3080318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3080321">}</span><br>
<span class="lineno">60</span><span class="op" id="3080323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3080326">//&nbsp;lookupStaticHost&nbsp;looks&nbsp;up&nbsp;the&nbsp;addresses&nbsp;for&nbsp;the&nbsp;given&nbsp;host&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3080405">func</span>&nbsp;<span class="ident" id="3080410">lookupStaticHost</span><span class="op" id="3080426">(</span><span class="ident" id="3080427">host</span>&nbsp;<span class="builtintype" id="3080432">string</span><span class="op" id="3080438">)</span>&nbsp;<span class="op" id="3080440">[</span><span class="op" id="3080441">]</span><span class="builtintype" id="3080442">string</span>&nbsp;<span class="op" id="3080449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3080452">hosts</span><span class="op" id="3080457">.</span><span class="ident" id="3080458">Lock</span><span class="op" id="3080462">(</span><span class="op" id="3080463">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3080466">defer</span>&nbsp;<span class="ident" id="3080472">hosts</span><span class="op" id="3080477">.</span><span class="ident" id="3080478">Unlock</span><span class="op" id="3080484">(</span><span class="op" id="3080485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3080488">readHosts</span><span class="op" id="3080497">(</span><span class="op" id="3080498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3080501">if</span>&nbsp;<span class="builtinfunc" id="3080504">len</span><span class="op" id="3080507">(</span><span class="ident" id="3080508">hosts</span><span class="op" id="3080513">.</span><span class="ident" id="3080514">byName</span><span class="op" id="3080520">)</span>&nbsp;<span class="op" id="3080522">!=</span>&nbsp;<span class="num" id="3080525">0</span>&nbsp;<span class="op" id="3080527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3080531">if</span>&nbsp;<span class="ident" id="3080534">ips</span><span class="op" id="3080537">,</span>&nbsp;<span class="ident" id="3080539">ok</span>&nbsp;<span class="op" id="3080542">:=</span>&nbsp;<span class="ident" id="3080545">hosts</span><span class="op" id="3080550">.</span><span class="ident" id="3080551">byName</span><span class="op" id="3080557">[</span><span class="ident" id="3080558">host</span><span class="op" id="3080562">]</span><span class="op" id="3080563">;</span>&nbsp;<span class="ident" id="3080565">ok</span>&nbsp;<span class="op" id="3080568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3080573">return</span>&nbsp;<span class="ident" id="3080580">ips</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3080586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3080589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3080592">return</span>&nbsp;<span class="ident" id="3080599">nil</span><br>
<span class="lineno"></span><span class="op" id="3080603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="3080606">//&nbsp;lookupStaticAddr&nbsp;looks&nbsp;up&nbsp;the&nbsp;hosts&nbsp;for&nbsp;the&nbsp;given&nbsp;address&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3080684">func</span>&nbsp;<span class="ident" id="3080689">lookupStaticAddr</span><span class="op" id="3080705">(</span><span class="ident" id="3080706">addr</span>&nbsp;<span class="builtintype" id="3080711">string</span><span class="op" id="3080717">)</span>&nbsp;<span class="op" id="3080719">[</span><span class="op" id="3080720">]</span><span class="builtintype" id="3080721">string</span>&nbsp;<span class="op" id="3080728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3080731">hosts</span><span class="op" id="3080736">.</span><span class="ident" id="3080737">Lock</span><span class="op" id="3080741">(</span><span class="op" id="3080742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3080745">defer</span>&nbsp;<span class="ident" id="3080751">hosts</span><span class="op" id="3080756">.</span><span class="ident" id="3080757">Unlock</span><span class="op" id="3080763">(</span><span class="op" id="3080764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3080767">readHosts</span><span class="op" id="3080776">(</span><span class="op" id="3080777">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3080780">if</span>&nbsp;<span class="builtinfunc" id="3080783">len</span><span class="op" id="3080786">(</span><span class="ident" id="3080787">hosts</span><span class="op" id="3080792">.</span><span class="ident" id="3080793">byAddr</span><span class="op" id="3080799">)</span>&nbsp;<span class="op" id="3080801">!=</span>&nbsp;<span class="num" id="3080804">0</span>&nbsp;<span class="op" id="3080806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3080810">if</span>&nbsp;<span class="ident" id="3080813">hosts</span><span class="op" id="3080818">,</span>&nbsp;<span class="ident" id="3080820">ok</span>&nbsp;<span class="op" id="3080823">:=</span>&nbsp;<span class="ident" id="3080826">hosts</span><span class="op" id="3080831">.</span><span class="ident" id="3080832">byAddr</span><span class="op" id="3080838">[</span><span class="ident" id="3080839">addr</span><span class="op" id="3080843">]</span><span class="op" id="3080844">;</span>&nbsp;<span class="ident" id="3080846">ok</span>&nbsp;<span class="op" id="3080849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3080854">return</span>&nbsp;<span class="ident" id="3080861">hosts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3080869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3080872">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3080875">return</span>&nbsp;<span class="ident" id="3080882">nil</span><br>
<span class="lineno"></span><span class="op" id="3080886">}</span>
</div>
</body>
</html>
