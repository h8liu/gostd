<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2063810">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2063865">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2063919">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2063970">package</span>&nbsp;<span class="ident" id="2063978">math</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2063984">//&nbsp;The&nbsp;original&nbsp;C&nbsp;code,&nbsp;the&nbsp;long&nbsp;comment,&nbsp;and&nbsp;the&nbsp;constants</span><br>
<span class="lineno"></span><span class="comment" id="2064044">//&nbsp;below&nbsp;are&nbsp;from&nbsp;FreeBSD&#39;s&nbsp;/usr/src/lib/msun/src/s_log1p.c</span><br>
<span class="lineno"></span><span class="comment" id="2064104">//&nbsp;and&nbsp;came&nbsp;with&nbsp;this&nbsp;notice.&nbsp;&nbsp;The&nbsp;go&nbsp;code&nbsp;is&nbsp;a&nbsp;simplified</span><br>
<span class="lineno">10</span><span class="comment" id="2064163">//&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="2064193">//</span><br>
<span class="lineno"></span><span class="comment" id="2064196">//&nbsp;====================================================</span><br>
<span class="lineno"></span><span class="comment" id="2064252">//&nbsp;Copyright&nbsp;(C)&nbsp;1993&nbsp;by&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2064321">//</span><br>
<span class="lineno">15</span><span class="comment" id="2064324">//&nbsp;Developed&nbsp;at&nbsp;SunPro,&nbsp;a&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;business.</span><br>
<span class="lineno"></span><span class="comment" id="2064383">//&nbsp;Permission&nbsp;to&nbsp;use,&nbsp;copy,&nbsp;modify,&nbsp;and&nbsp;distribute&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="2064439">//&nbsp;software&nbsp;is&nbsp;freely&nbsp;granted,&nbsp;provided&nbsp;that&nbsp;this&nbsp;notice</span><br>
<span class="lineno"></span><span class="comment" id="2064496">//&nbsp;is&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="comment" id="2064513">//&nbsp;====================================================</span><br>
<span class="lineno">20</span><span class="comment" id="2064569">//</span><br>
<span class="lineno"></span><span class="comment" id="2064572">//</span><br>
<span class="lineno"></span><span class="comment" id="2064575">//&nbsp;double&nbsp;log1p(double&nbsp;x)</span><br>
<span class="lineno"></span><span class="comment" id="2064601">//</span><br>
<span class="lineno"></span><span class="comment" id="2064604">//&nbsp;Method&nbsp;:</span><br>
<span class="lineno">25</span><span class="comment" id="2064616">//&nbsp;&nbsp;&nbsp;1.&nbsp;Argument&nbsp;Reduction:&nbsp;find&nbsp;k&nbsp;and&nbsp;f&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2064667">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1+x&nbsp;=&nbsp;2**k&nbsp;*&nbsp;(1+f),</span><br>
<span class="lineno"></span><span class="comment" id="2064711">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;&nbsp;sqrt(2)/2&nbsp;&lt;&nbsp;1+f&nbsp;&lt;&nbsp;sqrt(2)&nbsp;.</span><br>
<span class="lineno"></span><span class="comment" id="2064757">//</span><br>
<span class="lineno"></span><span class="comment" id="2064760">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Note.&nbsp;If&nbsp;k=0,&nbsp;then&nbsp;f=x&nbsp;is&nbsp;exact.&nbsp;However,&nbsp;if&nbsp;k!=0,&nbsp;then&nbsp;f</span><br>
<span class="lineno">30</span><span class="comment" id="2064826">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;may&nbsp;not&nbsp;be&nbsp;representable&nbsp;exactly.&nbsp;In&nbsp;that&nbsp;case,&nbsp;a&nbsp;correction</span><br>
<span class="lineno"></span><span class="comment" id="2064895">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;term&nbsp;is&nbsp;need.&nbsp;Let&nbsp;u=1+x&nbsp;rounded.&nbsp;Let&nbsp;c&nbsp;=&nbsp;(1+x)-u,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="2064958">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log(1+x)&nbsp;-&nbsp;log(u)&nbsp;~&nbsp;c/u.&nbsp;Thus,&nbsp;we&nbsp;proceed&nbsp;to&nbsp;compute&nbsp;log(u),</span><br>
<span class="lineno"></span><span class="comment" id="2065027">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;add&nbsp;back&nbsp;the&nbsp;correction&nbsp;term&nbsp;c/u.</span><br>
<span class="lineno"></span><span class="comment" id="2065073">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Note:&nbsp;when&nbsp;x&nbsp;&gt;&nbsp;2**53,&nbsp;one&nbsp;can&nbsp;simply&nbsp;return&nbsp;log(x))</span><br>
<span class="lineno">35</span><span class="comment" id="2065134">//</span><br>
<span class="lineno"></span><span class="comment" id="2065137">//&nbsp;&nbsp;&nbsp;2.&nbsp;Approximation&nbsp;of&nbsp;log1p(f).</span><br>
<span class="lineno"></span><span class="comment" id="2065172">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Let&nbsp;s&nbsp;=&nbsp;f/(2+f)&nbsp;;&nbsp;based&nbsp;on&nbsp;log(1+f)&nbsp;=&nbsp;log(1+s)&nbsp;-&nbsp;log(1-s)</span><br>
<span class="lineno"></span><span class="comment" id="2065238">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2s&nbsp;+&nbsp;2/3&nbsp;s**3&nbsp;+&nbsp;2/5&nbsp;s**5&nbsp;+&nbsp;.....,</span><br>
<span class="lineno"></span><span class="comment" id="2065291">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2s&nbsp;+&nbsp;s*R</span><br>
<span class="lineno">40</span><span class="comment" id="2065319">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;use&nbsp;a&nbsp;special&nbsp;Reme&nbsp;algorithm&nbsp;on&nbsp;[0,0.1716]&nbsp;to&nbsp;generate</span><br>
<span class="lineno"></span><span class="comment" id="2065385">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;polynomial&nbsp;of&nbsp;degree&nbsp;14&nbsp;to&nbsp;approximate&nbsp;R&nbsp;The&nbsp;maximum&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="2065454">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;this&nbsp;polynomial&nbsp;approximation&nbsp;is&nbsp;bounded&nbsp;by&nbsp;2**-58.45.&nbsp;In</span><br>
<span class="lineno"></span><span class="comment" id="2065523">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;other&nbsp;words,</span><br>
<span class="lineno"></span><span class="comment" id="2065544">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;14</span><br>
<span class="lineno">45</span><span class="comment" id="2065615">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R(z)&nbsp;~&nbsp;Lp1*s&nbsp;+Lp2*s&nbsp;+Lp3*s&nbsp;+Lp4*s&nbsp;+Lp5*s&nbsp;&nbsp;+Lp6*s&nbsp;&nbsp;+Lp7*s</span><br>
<span class="lineno"></span><span class="comment" id="2065684">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(the&nbsp;values&nbsp;of&nbsp;Lp1&nbsp;to&nbsp;Lp7&nbsp;are&nbsp;listed&nbsp;in&nbsp;the&nbsp;program)</span><br>
<span class="lineno"></span><span class="comment" id="2065745">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2065757">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-58.45</span><br>
<span class="lineno"></span><span class="comment" id="2065812">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Lp1*s&nbsp;+...+Lp7*s&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;R(z)&nbsp;|&nbsp;&lt;=&nbsp;2</span><br>
<span class="lineno">50</span><span class="comment" id="2065861">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="2065905">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Note&nbsp;that&nbsp;2s&nbsp;=&nbsp;f&nbsp;-&nbsp;s*f&nbsp;=&nbsp;f&nbsp;-&nbsp;hfsq&nbsp;+&nbsp;s*hfsq,&nbsp;where&nbsp;hfsq&nbsp;=&nbsp;f*f/2.</span><br>
<span class="lineno"></span><span class="comment" id="2065977">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In&nbsp;order&nbsp;to&nbsp;guarantee&nbsp;error&nbsp;in&nbsp;log&nbsp;below&nbsp;1ulp,&nbsp;we&nbsp;compute&nbsp;log</span><br>
<span class="lineno"></span><span class="comment" id="2066047">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2066058">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log1p(f)&nbsp;=&nbsp;f&nbsp;-&nbsp;(hfsq&nbsp;-&nbsp;s*(hfsq+R)).</span><br>
<span class="lineno">55</span><span class="comment" id="2066110">//</span><br>
<span class="lineno"></span><span class="comment" id="2066113">//&nbsp;&nbsp;&nbsp;3.&nbsp;Finally,&nbsp;log1p(x)&nbsp;=&nbsp;k*ln2&nbsp;+&nbsp;log1p(f).</span><br>
<span class="lineno"></span><span class="comment" id="2066159">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;k*ln2_hi+(f-(hfsq-(s*(hfsq+R)+k*ln2_lo)))</span><br>
<span class="lineno"></span><span class="comment" id="2066229">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;ln2&nbsp;is&nbsp;split&nbsp;into&nbsp;two&nbsp;floating&nbsp;point&nbsp;number:</span><br>
<span class="lineno"></span><span class="comment" id="2066287">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ln2_hi&nbsp;+&nbsp;ln2_lo,</span><br>
<span class="lineno">60</span><span class="comment" id="2066325">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;n*ln2_hi&nbsp;is&nbsp;always&nbsp;exact&nbsp;for&nbsp;|n|&nbsp;&lt;&nbsp;2000.</span><br>
<span class="lineno"></span><span class="comment" id="2066380">//</span><br>
<span class="lineno"></span><span class="comment" id="2066383">//&nbsp;Special&nbsp;cases:</span><br>
<span class="lineno"></span><span class="comment" id="2066401">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log1p(x)&nbsp;is&nbsp;NaN&nbsp;with&nbsp;signal&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;-1&nbsp;(including&nbsp;-INF)&nbsp;;</span><br>
<span class="lineno"></span><span class="comment" id="2066466">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log1p(+INF)&nbsp;is&nbsp;+INF;&nbsp;log1p(-1)&nbsp;is&nbsp;-INF&nbsp;with&nbsp;signal;</span><br>
<span class="lineno">65</span><span class="comment" id="2066526">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log1p(NaN)&nbsp;is&nbsp;that&nbsp;NaN&nbsp;with&nbsp;no&nbsp;signal.</span><br>
<span class="lineno"></span><span class="comment" id="2066573">//</span><br>
<span class="lineno"></span><span class="comment" id="2066576">//&nbsp;Accuracy:</span><br>
<span class="lineno"></span><span class="comment" id="2066589">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;an&nbsp;error&nbsp;analysis,&nbsp;the&nbsp;error&nbsp;is&nbsp;always&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="2066659">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;ulp&nbsp;(unit&nbsp;in&nbsp;the&nbsp;last&nbsp;place).</span><br>
<span class="lineno">70</span><span class="comment" id="2066699">//</span><br>
<span class="lineno"></span><span class="comment" id="2066702">//&nbsp;Constants:</span><br>
<span class="lineno"></span><span class="comment" id="2066716">//&nbsp;The&nbsp;hexadecimal&nbsp;values&nbsp;are&nbsp;the&nbsp;intended&nbsp;ones&nbsp;for&nbsp;the&nbsp;following</span><br>
<span class="lineno"></span><span class="comment" id="2066782">//&nbsp;constants.&nbsp;The&nbsp;decimal&nbsp;values&nbsp;may&nbsp;be&nbsp;used,&nbsp;provided&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2066846">//&nbsp;compiler&nbsp;will&nbsp;convert&nbsp;from&nbsp;decimal&nbsp;to&nbsp;binary&nbsp;accurately&nbsp;enough</span><br>
<span class="lineno">75</span><span class="comment" id="2066912">//&nbsp;to&nbsp;produce&nbsp;the&nbsp;hexadecimal&nbsp;values&nbsp;shown.</span><br>
<span class="lineno"></span><span class="comment" id="2066956">//</span><br>
<span class="lineno"></span><span class="comment" id="2066959">//&nbsp;Note:&nbsp;Assuming&nbsp;log()&nbsp;return&nbsp;accurate&nbsp;answer,&nbsp;the&nbsp;following</span><br>
<span class="lineno"></span><span class="comment" id="2067021">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;algorithm&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;compute&nbsp;log1p(x)&nbsp;to&nbsp;within&nbsp;a&nbsp;few&nbsp;ULP:</span><br>
<span class="lineno"></span><span class="comment" id="2067093">//</span><br>
<span class="lineno">80</span><span class="comment" id="2067096">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u&nbsp;=&nbsp;1+x;</span><br>
<span class="lineno"></span><span class="comment" id="2067121">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(u==1.0)&nbsp;return&nbsp;x&nbsp;;&nbsp;else</span><br>
<span class="lineno"></span><span class="comment" id="2067164">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;log(u)*(x/(u-1.0));</span><br>
<span class="lineno"></span><span class="comment" id="2067218">//</span><br>
<span class="lineno"></span><span class="comment" id="2067221">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;See&nbsp;HP-15C&nbsp;Advanced&nbsp;Functions&nbsp;Handbook,&nbsp;p.193.</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="2067278">//&nbsp;Log1p&nbsp;returns&nbsp;the&nbsp;natural&nbsp;logarithm&nbsp;of&nbsp;1&nbsp;plus&nbsp;its&nbsp;argument&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="2067343">//&nbsp;It&nbsp;is&nbsp;more&nbsp;accurate&nbsp;than&nbsp;Log(1&nbsp;+&nbsp;x)&nbsp;when&nbsp;x&nbsp;is&nbsp;near&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="2067403">//</span><br>
<span class="lineno"></span><span class="comment" id="2067406">//&nbsp;Special&nbsp;cases&nbsp;are:</span><br>
<span class="lineno">90</span><span class="comment" id="2067428">//&nbsp;&nbsp;&nbsp;&nbspLog1p(+Inf)&nbsp;=&nbsp;+Inf</span><br>
<span class="lineno"></span><span class="comment" id="2067450">//&nbsp;&nbsp;&nbsp;&nbspLog1p(±0)&nbsp;=&nbsp;±0</span><br>
<span class="lineno"></span><span class="comment" id="2067470">//&nbsp;&nbsp;&nbsp;&nbspLog1p(-1)&nbsp;=&nbsp;-Inf</span><br>
<span class="lineno"></span><span class="comment" id="2067490">//&nbsp;&nbsp;&nbsp;&nbspLog1p(x&nbsp;&lt;&nbsp;-1)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="comment" id="2067513">//&nbsp;&nbsp;&nbsp;&nbspLog1p(NaN)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno">95</span><span class="keyword" id="2067533">func</span>&nbsp;<span class="ident" id="2067538">Log1p</span><span class="op" id="2067543">(</span><span class="ident" id="2067544">x</span>&nbsp;<span class="builtintype" id="2067546">float64</span><span class="op" id="2067553">)</span>&nbsp;<span class="builtintype" id="2067555">float64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2067564">func</span>&nbsp;<span class="ident" id="2067569">log1p</span><span class="op" id="2067574">(</span><span class="ident" id="2067575">x</span>&nbsp;<span class="builtintype" id="2067577">float64</span><span class="op" id="2067584">)</span>&nbsp;<span class="builtintype" id="2067586">float64</span>&nbsp;<span class="op" id="2067594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067597">const</span>&nbsp;<span class="op" id="2067603">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067607">Sqrt2M1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2067619">=</span>&nbsp;<span class="num" id="2067621">4.142135623730950488017e-01</span>&nbsp;&nbsp;<span class="comment" id="2067650">//&nbsp;Sqrt(2)-1&nbsp;=&nbsp;0x3fda827999fcef34</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067686">Sqrt2HalfM1</span>&nbsp;<span class="op" id="2067698">=</span>&nbsp;<span class="op" id="2067700">-</span><span class="num" id="2067701">2.928932188134524755992e-01</span>&nbsp;<span class="comment" id="2067729">//&nbsp;Sqrt(2)/2-1&nbsp;=&nbsp;0xbfd2bec333018866</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067767">Small</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2067779">=</span>&nbsp;<span class="num" id="2067781">1.0</span>&nbsp;<span class="op" id="2067785">/</span>&nbsp;<span class="op" id="2067787">(</span><span class="num" id="2067788">1</span>&nbsp;<span class="op" id="2067790">&lt;&lt;</span>&nbsp;<span class="num" id="2067793">29</span><span class="op" id="2067795">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2067810">//&nbsp;2**-29&nbsp;=&nbsp;0x3e20000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067843">Tiny</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2067855">=</span>&nbsp;<span class="num" id="2067857">1.0</span>&nbsp;<span class="op" id="2067861">/</span>&nbsp;<span class="op" id="2067863">(</span><span class="num" id="2067864">1</span>&nbsp;<span class="op" id="2067866">&lt;&lt;</span>&nbsp;<span class="num" id="2067869">54</span><span class="op" id="2067871">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2067886">//&nbsp;2**-54</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067898">Two53</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2067910">=</span>&nbsp;<span class="num" id="2067912">1</span>&nbsp;<span class="op" id="2067914">&lt;&lt;</span>&nbsp;<span class="num" id="2067917">53</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2067941">//&nbsp;2**53</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067952">Ln2Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2067964">=</span>&nbsp;<span class="num" id="2067966">6.93147180369123816490e-01</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="2067995">//&nbsp;3fe62e42fee00000</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068017">Ln2Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2068029">=</span>&nbsp;<span class="num" id="2068031">1.90821492927058770002e-10</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="2068060">//&nbsp;3dea39ef35793c76</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068082">Lp1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2068094">=</span>&nbsp;<span class="num" id="2068096">6.666666666666735130e-01</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2068125">//&nbsp;3FE5555555555593</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068147">Lp2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2068159">=</span>&nbsp;<span class="num" id="2068161">3.999999999940941908e-01</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2068190">//&nbsp;3FD999999997FA04</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068212">Lp3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2068224">=</span>&nbsp;<span class="num" id="2068226">2.857142874366239149e-01</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2068255">//&nbsp;3FD2492494229359</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068277">Lp4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2068289">=</span>&nbsp;<span class="num" id="2068291">2.222219843214978396e-01</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2068320">//&nbsp;3FCC71C51D8E78AF</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068342">Lp5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2068354">=</span>&nbsp;<span class="num" id="2068356">1.818357216161805012e-01</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2068385">//&nbsp;3FC7466496CB03DE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068407">Lp6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2068419">=</span>&nbsp;<span class="num" id="2068421">1.531383769920937332e-01</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2068450">//&nbsp;3FC39A09D078C69F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068472">Lp7</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2068484">=</span>&nbsp;<span class="num" id="2068486">1.479819860511658591e-01</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2068515">//&nbsp;3FC2F112DF3E5244</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2068536">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2068540">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068558">switch</span>&nbsp;<span class="op" id="2068565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068568">case</span>&nbsp;<span class="ident" id="2068573">x</span>&nbsp;<span class="op" id="2068575">&lt;</span>&nbsp;<span class="op" id="2068577">-</span><span class="num" id="2068578">1</span>&nbsp;<span class="op" id="2068580">||</span>&nbsp;<span class="ident" id="2068583">IsNaN</span><span class="op" id="2068588">(</span><span class="ident" id="2068589">x</span><span class="op" id="2068590">)</span><span class="op" id="2068591">:</span>&nbsp;<span class="comment" id="2068593">//&nbsp;includes&nbsp;-Inf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068612">return</span>&nbsp;<span class="ident" id="2068619">NaN</span><span class="op" id="2068622">(</span><span class="op" id="2068623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068626">case</span>&nbsp;<span class="ident" id="2068631">x</span>&nbsp;<span class="op" id="2068633">==</span>&nbsp;<span class="op" id="2068636">-</span><span class="num" id="2068637">1</span><span class="op" id="2068638">:</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068642">return</span>&nbsp;<span class="ident" id="2068649">Inf</span><span class="op" id="2068652">(</span><span class="op" id="2068653">-</span><span class="num" id="2068654">1</span><span class="op" id="2068655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068658">case</span>&nbsp;<span class="ident" id="2068663">IsInf</span><span class="op" id="2068668">(</span><span class="ident" id="2068669">x</span><span class="op" id="2068670">,</span>&nbsp;<span class="num" id="2068672">1</span><span class="op" id="2068673">)</span><span class="op" id="2068674">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068678">return</span>&nbsp;<span class="ident" id="2068685">Inf</span><span class="op" id="2068688">(</span><span class="num" id="2068689">1</span><span class="op" id="2068690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2068693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068697">absx</span>&nbsp;<span class="op" id="2068702">:=</span>&nbsp;<span class="ident" id="2068705">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068708">if</span>&nbsp;<span class="ident" id="2068711">absx</span>&nbsp;<span class="op" id="2068716">&lt;</span>&nbsp;<span class="num" id="2068718">0</span>&nbsp;<span class="op" id="2068720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068724">absx</span>&nbsp;<span class="op" id="2068729">=</span>&nbsp;<span class="op" id="2068731">-</span><span class="ident" id="2068732">absx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2068738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068742">var</span>&nbsp;<span class="ident" id="2068746">f</span>&nbsp;<span class="builtintype" id="2068748">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068757">var</span>&nbsp;<span class="ident" id="2068761">iu</span>&nbsp;<span class="ident" id="2068764">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068772">k</span>&nbsp;<span class="op" id="2068774">:=</span>&nbsp;<span class="num" id="2068777">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068780">if</span>&nbsp;<span class="ident" id="2068783">absx</span>&nbsp;<span class="op" id="2068788">&lt;</span>&nbsp;<span class="ident" id="2068790">Sqrt2M1</span>&nbsp;<span class="op" id="2068798">{</span>&nbsp;<span class="comment" id="2068800">//&nbsp;&nbsp;|x|&nbsp;&lt;&nbsp;Sqrt(2)-1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068822">if</span>&nbsp;<span class="ident" id="2068825">absx</span>&nbsp;<span class="op" id="2068830">&lt;</span>&nbsp;<span class="ident" id="2068832">Small</span>&nbsp;<span class="op" id="2068838">{</span>&nbsp;<span class="comment" id="2068840">//&nbsp;|x|&nbsp;&lt;&nbsp;2**-29</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068859">if</span>&nbsp;<span class="ident" id="2068862">absx</span>&nbsp;<span class="op" id="2068867">&lt;</span>&nbsp;<span class="ident" id="2068869">Tiny</span>&nbsp;<span class="op" id="2068874">{</span>&nbsp;<span class="comment" id="2068876">//&nbsp;|x|&nbsp;&lt;&nbsp;2**-54</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068896">return</span>&nbsp;<span class="ident" id="2068903">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2068908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068913">return</span>&nbsp;<span class="ident" id="2068920">x</span>&nbsp;<span class="op" id="2068922">-</span>&nbsp;<span class="ident" id="2068924">x</span><span class="op" id="2068925">*</span><span class="ident" id="2068926">x</span><span class="op" id="2068927">*</span><span class="num" id="2068928">0.5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2068934">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068938">if</span>&nbsp;<span class="ident" id="2068941">x</span>&nbsp;<span class="op" id="2068943">&gt;</span>&nbsp;<span class="ident" id="2068945">Sqrt2HalfM1</span>&nbsp;<span class="op" id="2068957">{</span>&nbsp;<span class="comment" id="2068959">//&nbsp;Sqrt(2)/2-1&nbsp;&lt;&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2068981">//&nbsp;(Sqrt(2)/2-1)&nbsp;&lt;&nbsp;x&nbsp;&lt;&nbsp;(Sqrt(2)-1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069019">k</span>&nbsp;<span class="op" id="2069021">=</span>&nbsp;<span class="num" id="2069023">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069028">f</span>&nbsp;<span class="op" id="2069030">=</span>&nbsp;<span class="ident" id="2069032">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069037">iu</span>&nbsp;<span class="op" id="2069040">=</span>&nbsp;<span class="num" id="2069042">1</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069052">var</span>&nbsp;<span class="ident" id="2069056">c</span>&nbsp;<span class="builtintype" id="2069058">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069067">if</span>&nbsp;<span class="ident" id="2069070">k</span>&nbsp;<span class="op" id="2069072">!=</span>&nbsp;<span class="num" id="2069075">0</span>&nbsp;<span class="op" id="2069077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069081">var</span>&nbsp;<span class="ident" id="2069085">u</span>&nbsp;<span class="builtintype" id="2069087">float64</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069097">if</span>&nbsp;<span class="ident" id="2069100">absx</span>&nbsp;<span class="op" id="2069105">&lt;</span>&nbsp;<span class="ident" id="2069107">Two53</span>&nbsp;<span class="op" id="2069113">{</span>&nbsp;<span class="comment" id="2069115">//&nbsp;1&lt;&lt;53</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069127">u</span>&nbsp;<span class="op" id="2069129">=</span>&nbsp;<span class="num" id="2069131">1.0</span>&nbsp;<span class="op" id="2069135">+</span>&nbsp;<span class="ident" id="2069137">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069142">iu</span>&nbsp;<span class="op" id="2069145">=</span>&nbsp;<span class="ident" id="2069147">Float64bits</span><span class="op" id="2069158">(</span><span class="ident" id="2069159">u</span><span class="op" id="2069160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069165">k</span>&nbsp;<span class="op" id="2069167">=</span>&nbsp;<span class="builtintype" id="2069169">int</span><span class="op" id="2069172">(</span><span class="op" id="2069173">(</span><span class="ident" id="2069174">iu</span>&nbsp;<span class="op" id="2069177">&gt;&gt;</span>&nbsp;<span class="num" id="2069180">52</span><span class="op" id="2069182">)</span>&nbsp;<span class="op" id="2069184">-</span>&nbsp;<span class="num" id="2069186">1023</span><span class="op" id="2069190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069195">if</span>&nbsp;<span class="ident" id="2069198">k</span>&nbsp;<span class="op" id="2069200">&gt;</span>&nbsp;<span class="num" id="2069202">0</span>&nbsp;<span class="op" id="2069204">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069210">c</span>&nbsp;<span class="op" id="2069212">=</span>&nbsp;<span class="num" id="2069214">1.0</span>&nbsp;<span class="op" id="2069218">-</span>&nbsp;<span class="op" id="2069220">(</span><span class="ident" id="2069221">u</span>&nbsp;<span class="op" id="2069223">-</span>&nbsp;<span class="ident" id="2069225">x</span><span class="op" id="2069226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069231">}</span>&nbsp;<span class="keyword" id="2069233">else</span>&nbsp;<span class="op" id="2069238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069244">c</span>&nbsp;<span class="op" id="2069246">=</span>&nbsp;<span class="ident" id="2069248">x</span>&nbsp;<span class="op" id="2069250">-</span>&nbsp;<span class="op" id="2069252">(</span><span class="ident" id="2069253">u</span>&nbsp;<span class="op" id="2069255">-</span>&nbsp;<span class="num" id="2069257">1.0</span><span class="op" id="2069260">)</span>&nbsp;<span class="comment" id="2069262">//&nbsp;correction&nbsp;term</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069285">c</span>&nbsp;<span class="op" id="2069287">/=</span>&nbsp;<span class="ident" id="2069290">u</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069295">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069299">}</span>&nbsp;<span class="keyword" id="2069301">else</span>&nbsp;<span class="op" id="2069306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069311">u</span>&nbsp;<span class="op" id="2069313">=</span>&nbsp;<span class="ident" id="2069315">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069320">iu</span>&nbsp;<span class="op" id="2069323">=</span>&nbsp;<span class="ident" id="2069325">Float64bits</span><span class="op" id="2069336">(</span><span class="ident" id="2069337">u</span><span class="op" id="2069338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069343">k</span>&nbsp;<span class="op" id="2069345">=</span>&nbsp;<span class="builtintype" id="2069347">int</span><span class="op" id="2069350">(</span><span class="op" id="2069351">(</span><span class="ident" id="2069352">iu</span>&nbsp;<span class="op" id="2069355">&gt;&gt;</span>&nbsp;<span class="num" id="2069358">52</span><span class="op" id="2069360">)</span>&nbsp;<span class="op" id="2069362">-</span>&nbsp;<span class="num" id="2069364">1023</span><span class="op" id="2069368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069373">c</span>&nbsp;<span class="op" id="2069375">=</span>&nbsp;<span class="num" id="2069377">0</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069385">iu</span>&nbsp;<span class="op" id="2069388">&amp;=</span>&nbsp;<span class="num" id="2069391">0x000fffffffffffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069412">if</span>&nbsp;<span class="ident" id="2069415">iu</span>&nbsp;<span class="op" id="2069418">&lt;</span>&nbsp;<span class="num" id="2069420">0x0006a09e667f3bcd</span>&nbsp;<span class="op" id="2069439">{</span>&nbsp;<span class="comment" id="2069441">//&nbsp;mantissa&nbsp;of&nbsp;Sqrt(2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069467">u</span>&nbsp;<span class="op" id="2069469">=</span>&nbsp;<span class="ident" id="2069471">Float64frombits</span><span class="op" id="2069486">(</span><span class="ident" id="2069487">iu</span>&nbsp;<span class="op" id="2069490">|</span>&nbsp;<span class="num" id="2069492">0x3ff0000000000000</span><span class="op" id="2069510">)</span>&nbsp;<span class="comment" id="2069512">//&nbsp;normalize&nbsp;u</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069529">}</span>&nbsp;<span class="keyword" id="2069531">else</span>&nbsp;<span class="op" id="2069536">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069541">k</span>&nbsp;<span class="op" id="2069543">+=</span>&nbsp;<span class="num" id="2069546">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069551">u</span>&nbsp;<span class="op" id="2069553">=</span>&nbsp;<span class="ident" id="2069555">Float64frombits</span><span class="op" id="2069570">(</span><span class="ident" id="2069571">iu</span>&nbsp;<span class="op" id="2069574">|</span>&nbsp;<span class="num" id="2069576">0x3fe0000000000000</span><span class="op" id="2069594">)</span>&nbsp;<span class="comment" id="2069596">//&nbsp;normalize&nbsp;u/2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069616">iu</span>&nbsp;<span class="op" id="2069619">=</span>&nbsp;<span class="op" id="2069621">(</span><span class="num" id="2069622">0x0010000000000000</span>&nbsp;<span class="op" id="2069641">-</span>&nbsp;<span class="ident" id="2069643">iu</span><span class="op" id="2069645">)</span>&nbsp;<span class="op" id="2069647">&gt;&gt;</span>&nbsp;<span class="num" id="2069650">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069658">f</span>&nbsp;<span class="op" id="2069660">=</span>&nbsp;<span class="ident" id="2069662">u</span>&nbsp;<span class="op" id="2069664">-</span>&nbsp;<span class="num" id="2069666">1.0</span>&nbsp;<span class="comment" id="2069670">//&nbsp;Sqrt(2)/2&nbsp;&lt;&nbsp;u&nbsp;&lt;&nbsp;Sqrt(2)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069701">hfsq</span>&nbsp;<span class="op" id="2069706">:=</span>&nbsp;<span class="num" id="2069709">0.5</span>&nbsp;<span class="op" id="2069713">*</span>&nbsp;<span class="ident" id="2069715">f</span>&nbsp;<span class="op" id="2069717">*</span>&nbsp;<span class="ident" id="2069719">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069722">var</span>&nbsp;<span class="ident" id="2069726">s</span><span class="op" id="2069727">,</span>&nbsp;<span class="ident" id="2069729">R</span><span class="op" id="2069730">,</span>&nbsp;<span class="ident" id="2069732">z</span>&nbsp;<span class="builtintype" id="2069734">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069743">if</span>&nbsp;<span class="ident" id="2069746">iu</span>&nbsp;<span class="op" id="2069749">==</span>&nbsp;<span class="num" id="2069752">0</span>&nbsp;<span class="op" id="2069754">{</span>&nbsp;<span class="comment" id="2069756">//&nbsp;|f|&nbsp;&lt;&nbsp;2**-20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069774">if</span>&nbsp;<span class="ident" id="2069777">f</span>&nbsp;<span class="op" id="2069779">==</span>&nbsp;<span class="num" id="2069782">0</span>&nbsp;<span class="op" id="2069784">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069789">if</span>&nbsp;<span class="ident" id="2069792">k</span>&nbsp;<span class="op" id="2069794">==</span>&nbsp;<span class="num" id="2069797">0</span>&nbsp;<span class="op" id="2069799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069805">return</span>&nbsp;<span class="num" id="2069812">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069817">}</span>&nbsp;<span class="keyword" id="2069819">else</span>&nbsp;<span class="op" id="2069824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069830">c</span>&nbsp;<span class="op" id="2069832">+=</span>&nbsp;<span class="builtintype" id="2069835">float64</span><span class="op" id="2069842">(</span><span class="ident" id="2069843">k</span><span class="op" id="2069844">)</span>&nbsp;<span class="op" id="2069846">*</span>&nbsp;<span class="ident" id="2069848">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069858">return</span>&nbsp;<span class="builtintype" id="2069865">float64</span><span class="op" id="2069872">(</span><span class="ident" id="2069873">k</span><span class="op" id="2069874">)</span><span class="op" id="2069875">*</span><span class="ident" id="2069876">Ln2Hi</span>&nbsp;<span class="op" id="2069882">+</span>&nbsp;<span class="ident" id="2069884">c</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069897">R</span>&nbsp;<span class="op" id="2069899">=</span>&nbsp;<span class="ident" id="2069901">hfsq</span>&nbsp;<span class="op" id="2069906">*</span>&nbsp;<span class="op" id="2069908">(</span><span class="num" id="2069909">1.0</span>&nbsp;<span class="op" id="2069913">-</span>&nbsp;<span class="num" id="2069915">0.66666666666666666</span><span class="op" id="2069934">*</span><span class="ident" id="2069935">f</span><span class="op" id="2069936">)</span>&nbsp;<span class="comment" id="2069938">//&nbsp;avoid&nbsp;division</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069958">if</span>&nbsp;<span class="ident" id="2069961">k</span>&nbsp;<span class="op" id="2069963">==</span>&nbsp;<span class="num" id="2069966">0</span>&nbsp;<span class="op" id="2069968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069973">return</span>&nbsp;<span class="ident" id="2069980">f</span>&nbsp;<span class="op" id="2069982">-</span>&nbsp;<span class="ident" id="2069984">R</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069992">return</span>&nbsp;<span class="builtintype" id="2069999">float64</span><span class="op" id="2070006">(</span><span class="ident" id="2070007">k</span><span class="op" id="2070008">)</span><span class="op" id="2070009">*</span><span class="ident" id="2070010">Ln2Hi</span>&nbsp;<span class="op" id="2070016">-</span>&nbsp;<span class="op" id="2070018">(</span><span class="op" id="2070019">(</span><span class="ident" id="2070020">R</span>&nbsp;<span class="op" id="2070022">-</span>&nbsp;<span class="op" id="2070024">(</span><span class="builtintype" id="2070025">float64</span><span class="op" id="2070032">(</span><span class="ident" id="2070033">k</span><span class="op" id="2070034">)</span><span class="op" id="2070035">*</span><span class="ident" id="2070036">Ln2Lo</span>&nbsp;<span class="op" id="2070042">+</span>&nbsp;<span class="ident" id="2070044">c</span><span class="op" id="2070045">)</span><span class="op" id="2070046">)</span>&nbsp;<span class="op" id="2070048">-</span>&nbsp;<span class="ident" id="2070050">f</span><span class="op" id="2070051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2070054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2070057">s</span>&nbsp;<span class="op" id="2070059">=</span>&nbsp;<span class="ident" id="2070061">f</span>&nbsp;<span class="op" id="2070063">/</span>&nbsp;<span class="op" id="2070065">(</span><span class="num" id="2070066">2.0</span>&nbsp;<span class="op" id="2070070">+</span>&nbsp;<span class="ident" id="2070072">f</span><span class="op" id="2070073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2070076">z</span>&nbsp;<span class="op" id="2070078">=</span>&nbsp;<span class="ident" id="2070080">s</span>&nbsp;<span class="op" id="2070082">*</span>&nbsp;<span class="ident" id="2070084">s</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2070087">R</span>&nbsp;<span class="op" id="2070089">=</span>&nbsp;<span class="ident" id="2070091">z</span>&nbsp;<span class="op" id="2070093">*</span>&nbsp;<span class="op" id="2070095">(</span><span class="ident" id="2070096">Lp1</span>&nbsp;<span class="op" id="2070100">+</span>&nbsp;<span class="ident" id="2070102">z</span><span class="op" id="2070103">*</span><span class="op" id="2070104">(</span><span class="ident" id="2070105">Lp2</span><span class="op" id="2070108">+</span><span class="ident" id="2070109">z</span><span class="op" id="2070110">*</span><span class="op" id="2070111">(</span><span class="ident" id="2070112">Lp3</span><span class="op" id="2070115">+</span><span class="ident" id="2070116">z</span><span class="op" id="2070117">*</span><span class="op" id="2070118">(</span><span class="ident" id="2070119">Lp4</span><span class="op" id="2070122">+</span><span class="ident" id="2070123">z</span><span class="op" id="2070124">*</span><span class="op" id="2070125">(</span><span class="ident" id="2070126">Lp5</span><span class="op" id="2070129">+</span><span class="ident" id="2070130">z</span><span class="op" id="2070131">*</span><span class="op" id="2070132">(</span><span class="ident" id="2070133">Lp6</span><span class="op" id="2070136">+</span><span class="ident" id="2070137">z</span><span class="op" id="2070138">*</span><span class="ident" id="2070139">Lp7</span><span class="op" id="2070142">)</span><span class="op" id="2070143">)</span><span class="op" id="2070144">)</span><span class="op" id="2070145">)</span><span class="op" id="2070146">)</span><span class="op" id="2070147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070150">if</span>&nbsp;<span class="ident" id="2070153">k</span>&nbsp;<span class="op" id="2070155">==</span>&nbsp;<span class="num" id="2070158">0</span>&nbsp;<span class="op" id="2070160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070164">return</span>&nbsp;<span class="ident" id="2070171">f</span>&nbsp;<span class="op" id="2070173">-</span>&nbsp;<span class="op" id="2070175">(</span><span class="ident" id="2070176">hfsq</span>&nbsp;<span class="op" id="2070181">-</span>&nbsp;<span class="ident" id="2070183">s</span><span class="op" id="2070184">*</span><span class="op" id="2070185">(</span><span class="ident" id="2070186">hfsq</span><span class="op" id="2070190">+</span><span class="ident" id="2070191">R</span><span class="op" id="2070192">)</span><span class="op" id="2070193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2070196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2070199">return</span>&nbsp;<span class="builtintype" id="2070206">float64</span><span class="op" id="2070213">(</span><span class="ident" id="2070214">k</span><span class="op" id="2070215">)</span><span class="op" id="2070216">*</span><span class="ident" id="2070217">Ln2Hi</span>&nbsp;<span class="op" id="2070223">-</span>&nbsp;<span class="op" id="2070225">(</span><span class="op" id="2070226">(</span><span class="ident" id="2070227">hfsq</span>&nbsp;<span class="op" id="2070232">-</span>&nbsp;<span class="op" id="2070234">(</span><span class="ident" id="2070235">s</span><span class="op" id="2070236">*</span><span class="op" id="2070237">(</span><span class="ident" id="2070238">hfsq</span><span class="op" id="2070242">+</span><span class="ident" id="2070243">R</span><span class="op" id="2070244">)</span>&nbsp;<span class="op" id="2070246">+</span>&nbsp;<span class="op" id="2070248">(</span><span class="builtintype" id="2070249">float64</span><span class="op" id="2070256">(</span><span class="ident" id="2070257">k</span><span class="op" id="2070258">)</span><span class="op" id="2070259">*</span><span class="ident" id="2070260">Ln2Lo</span>&nbsp;<span class="op" id="2070266">+</span>&nbsp;<span class="ident" id="2070268">c</span><span class="op" id="2070269">)</span><span class="op" id="2070270">)</span><span class="op" id="2070271">)</span>&nbsp;<span class="op" id="2070273">-</span>&nbsp;<span class="ident" id="2070275">f</span><span class="op" id="2070276">)</span><br>
<span class="lineno">200</span><span class="op" id="2070278">}</span>
</div>
</body>
</html>
