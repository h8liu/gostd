<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3053544">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3053600">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3053654">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3053705">//&nbsp;Internet&nbsp;protocol&nbsp;family&nbsp;sockets</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3053742">package</span>&nbsp;<span class="ident" id="3053750">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3053755">import</span>&nbsp;<span class="op" id="3053762">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3053765">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3053775">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3053782">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3053785">var</span>&nbsp;<span class="op" id="3053789">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3053792">//&nbsp;supportsIPv4&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3053852">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053882">supportsIPv4</span>&nbsp;<span class="builtintype" id="3053895">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3053902">//&nbsp;supportsIPv6&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv6</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3053962">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053992">supportsIPv6</span>&nbsp;<span class="builtintype" id="3054005">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3054012">//&nbsp;supportsIPv4map&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3054070">//&nbsp;mapping&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;inside&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;at&nbsp;transport</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3054134">//&nbsp;layer&nbsp;protocols.&nbsp;&nbsp;See&nbsp;RFC&nbsp;4291,&nbsp;RFC&nbsp;4038&nbsp;and&nbsp;RFC&nbsp;3493.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054193">supportsIPv4map</span>&nbsp;<span class="builtintype" id="3054209">bool</span><br>
<span class="lineno"></span><span class="op" id="3054214">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3054217">func</span>&nbsp;<span class="ident" id="3054222">init</span><span class="op" id="3054226">(</span><span class="op" id="3054227">)</span>&nbsp;<span class="op" id="3054229">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054232">sysInit</span><span class="op" id="3054239">(</span><span class="op" id="3054240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054243">supportsIPv4</span>&nbsp;<span class="op" id="3054256">=</span>&nbsp;<span class="ident" id="3054258">probeIPv4Stack</span><span class="op" id="3054272">(</span><span class="op" id="3054273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054276">supportsIPv6</span><span class="op" id="3054288">,</span>&nbsp;<span class="ident" id="3054290">supportsIPv4map</span>&nbsp;<span class="op" id="3054306">=</span>&nbsp;<span class="ident" id="3054308">probeIPv6Stack</span><span class="op" id="3054322">(</span><span class="op" id="3054323">)</span><br>
<span class="lineno"></span><span class="op" id="3054325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3054328">//&nbsp;A&nbsp;netaddr&nbsp;represents&nbsp;a&nbsp;network&nbsp;endpoint&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3054392">//&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3054423">type</span>&nbsp;<span class="ident" id="3054428">netaddr</span>&nbsp;<span class="keyword" id="3054436">interface</span>&nbsp;<span class="op" id="3054446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3054449">//&nbsp;toAddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;represented&nbsp;in&nbsp;Addr&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3054511">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is&nbsp;nil.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054567">toAddr</span><span class="op" id="3054573">(</span><span class="op" id="3054574">)</span>&nbsp;<span class="ident" id="3054576">Addr</span><br>
<span class="lineno"></span><span class="op" id="3054581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3054584">//&nbsp;An&nbsp;addrList&nbsp;represents&nbsp;a&nbsp;list&nbsp;of&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3054648">type</span>&nbsp;<span class="ident" id="3054653">addrList</span>&nbsp;<span class="op" id="3054662">[</span><span class="op" id="3054663">]</span><span class="ident" id="3054664">netaddr</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3054673">func</span>&nbsp;<span class="op" id="3054678">(</span><span class="ident" id="3054679">al</span>&nbsp;<span class="ident" id="3054682">addrList</span><span class="op" id="3054690">)</span>&nbsp;<span class="ident" id="3054692">toAddr</span><span class="op" id="3054698">(</span><span class="op" id="3054699">)</span>&nbsp;<span class="ident" id="3054701">Addr</span>&nbsp;<span class="op" id="3054706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3054709">switch</span>&nbsp;<span class="builtinfunc" id="3054716">len</span><span class="op" id="3054719">(</span><span class="ident" id="3054720">al</span><span class="op" id="3054722">)</span>&nbsp;<span class="op" id="3054724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3054727">case</span>&nbsp;<span class="num" id="3054732">0</span><span class="op" id="3054733">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3054737">return</span>&nbsp;<span class="ident" id="3054744">nil</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3054749">case</span>&nbsp;<span class="num" id="3054754">1</span><span class="op" id="3054755">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3054759">return</span>&nbsp;<span class="ident" id="3054766">al</span><span class="op" id="3054768">[</span><span class="num" id="3054769">0</span><span class="op" id="3054770">]</span><span class="op" id="3054771">.</span><span class="ident" id="3054772">toAddr</span><span class="op" id="3054778">(</span><span class="op" id="3054779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3054782">default</span><span class="op" id="3054789">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3054793">//&nbsp;For&nbsp;now,&nbsp;we&#39;ll&nbsp;roughly&nbsp;pick&nbsp;first&nbsp;one&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3054844">//&nbsp;considering&nbsp;dealing&nbsp;with&nbsp;any&nbsp;preferences&nbsp;such&nbsp;as</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3054898">//&nbsp;DNS&nbsp;TTL,&nbsp;transport&nbsp;path&nbsp;quality,&nbsp;network&nbsp;routing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3054952">//&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3054970">return</span>&nbsp;<span class="ident" id="3054977">al</span><span class="op" id="3054979">[</span><span class="num" id="3054980">0</span><span class="op" id="3054981">]</span><span class="op" id="3054982">.</span><span class="ident" id="3054983">toAddr</span><span class="op" id="3054989">(</span><span class="op" id="3054990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3054993">}</span><br>
<span class="lineno"></span><span class="op" id="3054995">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3054998">var</span>&nbsp;<span class="ident" id="3055002">errNoSuitableAddress</span>&nbsp;<span class="op" id="3055023">=</span>&nbsp;<span class="ident" id="3055025">errors</span><span class="op" id="3055031">.</span><span class="ident" id="3055032">New</span><span class="op" id="3055035">(</span><span class="string" id="3055036">&#34;no&nbsp;suitable&nbsp;address&nbsp;found&#34;</span><span class="op" id="3055063">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3055066">//&nbsp;firstFavoriteAddr&nbsp;returns&nbsp;an&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3055134">//&nbsp;implement&nbsp;the&nbsp;netaddr&nbsp;interface.&nbsp;Known&nbsp;filters&nbsp;are&nbsp;nil,&nbsp;ipv4only</span><br>
<span class="lineno">65</span><span class="comment" id="3055202">//&nbsp;and&nbsp;ipv6only.&nbsp;It&nbsp;returns&nbsp;any&nbsp;address&nbsp;when&nbsp;filter&nbsp;is&nbsp;nil.&nbsp;The&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="3055273">//&nbsp;contains&nbsp;at&nbsp;least&nbsp;one&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3055325">func</span>&nbsp;<span class="ident" id="3055330">firstFavoriteAddr</span><span class="op" id="3055347">(</span><span class="ident" id="3055348">filter</span>&nbsp;<span class="keyword" id="3055355">func</span><span class="op" id="3055359">(</span><span class="ident" id="3055360">IP</span><span class="op" id="3055362">)</span>&nbsp;<span class="ident" id="3055364">IP</span><span class="op" id="3055366">,</span>&nbsp;<span class="ident" id="3055368">ips</span>&nbsp;<span class="op" id="3055372">[</span><span class="op" id="3055373">]</span><span class="ident" id="3055374">IP</span><span class="op" id="3055376">,</span>&nbsp;<span class="ident" id="3055378">inetaddr</span>&nbsp;<span class="keyword" id="3055387">func</span><span class="op" id="3055391">(</span><span class="ident" id="3055392">IP</span><span class="op" id="3055394">)</span>&nbsp;<span class="ident" id="3055396">netaddr</span><span class="op" id="3055403">)</span>&nbsp;<span class="op" id="3055405">(</span><span class="ident" id="3055406">netaddr</span><span class="op" id="3055413">,</span>&nbsp;<span class="builtintype" id="3055415">error</span><span class="op" id="3055420">)</span>&nbsp;<span class="op" id="3055422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055425">if</span>&nbsp;<span class="ident" id="3055428">filter</span>&nbsp;<span class="op" id="3055435">!=</span>&nbsp;<span class="ident" id="3055438">nil</span>&nbsp;<span class="op" id="3055442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055446">return</span>&nbsp;<span class="ident" id="3055453">firstSupportedAddr</span><span class="op" id="3055471">(</span><span class="ident" id="3055472">filter</span><span class="op" id="3055478">,</span>&nbsp;<span class="ident" id="3055480">ips</span><span class="op" id="3055483">,</span>&nbsp;<span class="ident" id="3055485">inetaddr</span><span class="op" id="3055493">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055499">var</span>&nbsp;<span class="op" id="3055503">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055507">ipv4</span><span class="op" id="3055511">,</span>&nbsp;<span class="ident" id="3055513">ipv6</span><span class="op" id="3055517">,</span>&nbsp;<span class="ident" id="3055519">swap</span>&nbsp;<span class="builtintype" id="3055524">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055531">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3055548">addrList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055558">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055561">for</span>&nbsp;<span class="ident" id="3055565">_</span><span class="op" id="3055566">,</span>&nbsp;<span class="ident" id="3055568">ip</span>&nbsp;<span class="op" id="3055571">:=</span>&nbsp;<span class="keyword" id="3055574">range</span>&nbsp;<span class="ident" id="3055580">ips</span>&nbsp;<span class="op" id="3055584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3055588">//&nbsp;We&#39;ll&nbsp;take&nbsp;any&nbsp;IP&nbsp;address,&nbsp;but&nbsp;since&nbsp;the&nbsp;dialing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3055642">//&nbsp;code&nbsp;does&nbsp;not&nbsp;yet&nbsp;try&nbsp;multiple&nbsp;addresses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3055688">//&nbsp;effectively,&nbsp;prefer&nbsp;to&nbsp;use&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3055739">//&nbsp;possible.&nbsp;This&nbsp;is&nbsp;especially&nbsp;relevant&nbsp;if&nbsp;localhost</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3055795">//&nbsp;resolves&nbsp;to&nbsp;[ipv6-localhost,&nbsp;ipv4-localhost].&nbsp;Too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3055850">//&nbsp;much&nbsp;code&nbsp;assumes&nbsp;localhost&nbsp;==&nbsp;ipv4-localhost.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055902">if</span>&nbsp;<span class="ident" id="3055905">ip4</span>&nbsp;<span class="op" id="3055909">:=</span>&nbsp;<span class="ident" id="3055912">ipv4only</span><span class="op" id="3055920">(</span><span class="ident" id="3055921">ip</span><span class="op" id="3055923">)</span><span class="op" id="3055924">;</span>&nbsp;<span class="ident" id="3055926">ip4</span>&nbsp;<span class="op" id="3055930">!=</span>&nbsp;<span class="ident" id="3055933">nil</span>&nbsp;<span class="op" id="3055937">&amp;&amp;</span>&nbsp;<span class="op" id="3055940">!</span><span class="ident" id="3055941">ipv4</span>&nbsp;<span class="op" id="3055946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055951">list</span>&nbsp;<span class="op" id="3055956">=</span>&nbsp;<span class="builtinfunc" id="3055958">append</span><span class="op" id="3055964">(</span><span class="ident" id="3055965">list</span><span class="op" id="3055969">,</span>&nbsp;<span class="ident" id="3055971">inetaddr</span><span class="op" id="3055979">(</span><span class="ident" id="3055980">ip4</span><span class="op" id="3055983">)</span><span class="op" id="3055984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055989">ipv4</span>&nbsp;<span class="op" id="3055994">=</span>&nbsp;<span class="builtintype" id="3055996">true</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056004">if</span>&nbsp;<span class="ident" id="3056007">ipv6</span>&nbsp;<span class="op" id="3056012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056018">swap</span>&nbsp;<span class="op" id="3056023">=</span>&nbsp;<span class="builtintype" id="3056025">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056037">}</span>&nbsp;<span class="keyword" id="3056039">else</span>&nbsp;<span class="keyword" id="3056044">if</span>&nbsp;<span class="ident" id="3056047">ip6</span>&nbsp;<span class="op" id="3056051">:=</span>&nbsp;<span class="ident" id="3056054">ipv6only</span><span class="op" id="3056062">(</span><span class="ident" id="3056063">ip</span><span class="op" id="3056065">)</span><span class="op" id="3056066">;</span>&nbsp;<span class="ident" id="3056068">ip6</span>&nbsp;<span class="op" id="3056072">!=</span>&nbsp;<span class="ident" id="3056075">nil</span>&nbsp;<span class="op" id="3056079">&amp;&amp;</span>&nbsp;<span class="op" id="3056082">!</span><span class="ident" id="3056083">ipv6</span>&nbsp;<span class="op" id="3056088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056093">list</span>&nbsp;<span class="op" id="3056098">=</span>&nbsp;<span class="builtinfunc" id="3056100">append</span><span class="op" id="3056106">(</span><span class="ident" id="3056107">list</span><span class="op" id="3056111">,</span>&nbsp;<span class="ident" id="3056113">inetaddr</span><span class="op" id="3056121">(</span><span class="ident" id="3056122">ip6</span><span class="op" id="3056125">)</span><span class="op" id="3056126">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056131">ipv6</span>&nbsp;<span class="op" id="3056136">=</span>&nbsp;<span class="builtintype" id="3056138">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056149">if</span>&nbsp;<span class="ident" id="3056152">ipv4</span>&nbsp;<span class="op" id="3056157">&amp;&amp;</span>&nbsp;<span class="ident" id="3056160">ipv6</span>&nbsp;<span class="op" id="3056165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056170">if</span>&nbsp;<span class="ident" id="3056173">swap</span>&nbsp;<span class="op" id="3056178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056184">list</span><span class="op" id="3056188">[</span><span class="num" id="3056189">0</span><span class="op" id="3056190">]</span><span class="op" id="3056191">,</span>&nbsp;<span class="ident" id="3056193">list</span><span class="op" id="3056197">[</span><span class="num" id="3056198">1</span><span class="op" id="3056199">]</span>&nbsp;<span class="op" id="3056201">=</span>&nbsp;<span class="ident" id="3056203">list</span><span class="op" id="3056207">[</span><span class="num" id="3056208">1</span><span class="op" id="3056209">]</span><span class="op" id="3056210">,</span>&nbsp;<span class="ident" id="3056212">list</span><span class="op" id="3056216">[</span><span class="num" id="3056217">0</span><span class="op" id="3056218">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056228">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056242">switch</span>&nbsp;<span class="builtinfunc" id="3056249">len</span><span class="op" id="3056252">(</span><span class="ident" id="3056253">list</span><span class="op" id="3056257">)</span>&nbsp;<span class="op" id="3056259">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056262">case</span>&nbsp;<span class="num" id="3056267">0</span><span class="op" id="3056268">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056272">return</span>&nbsp;<span class="ident" id="3056279">nil</span><span class="op" id="3056282">,</span>&nbsp;<span class="ident" id="3056284">errNoSuitableAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056306">case</span>&nbsp;<span class="num" id="3056311">1</span><span class="op" id="3056312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056316">return</span>&nbsp;<span class="ident" id="3056323">list</span><span class="op" id="3056327">[</span><span class="num" id="3056328">0</span><span class="op" id="3056329">]</span><span class="op" id="3056330">,</span>&nbsp;<span class="ident" id="3056332">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056337">default</span><span class="op" id="3056344">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056348">return</span>&nbsp;<span class="ident" id="3056355">list</span><span class="op" id="3056359">,</span>&nbsp;<span class="ident" id="3056361">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056366">}</span><br>
<span class="lineno"></span><span class="op" id="3056368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3056371">func</span>&nbsp;<span class="ident" id="3056376">firstSupportedAddr</span><span class="op" id="3056394">(</span><span class="ident" id="3056395">filter</span>&nbsp;<span class="keyword" id="3056402">func</span><span class="op" id="3056406">(</span><span class="ident" id="3056407">IP</span><span class="op" id="3056409">)</span>&nbsp;<span class="ident" id="3056411">IP</span><span class="op" id="3056413">,</span>&nbsp;<span class="ident" id="3056415">ips</span>&nbsp;<span class="op" id="3056419">[</span><span class="op" id="3056420">]</span><span class="ident" id="3056421">IP</span><span class="op" id="3056423">,</span>&nbsp;<span class="ident" id="3056425">inetaddr</span>&nbsp;<span class="keyword" id="3056434">func</span><span class="op" id="3056438">(</span><span class="ident" id="3056439">IP</span><span class="op" id="3056441">)</span>&nbsp;<span class="ident" id="3056443">netaddr</span><span class="op" id="3056450">)</span>&nbsp;<span class="op" id="3056452">(</span><span class="ident" id="3056453">netaddr</span><span class="op" id="3056460">,</span>&nbsp;<span class="builtintype" id="3056462">error</span><span class="op" id="3056467">)</span>&nbsp;<span class="op" id="3056469">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056472">for</span>&nbsp;<span class="ident" id="3056476">_</span><span class="op" id="3056477">,</span>&nbsp;<span class="ident" id="3056479">ip</span>&nbsp;<span class="op" id="3056482">:=</span>&nbsp;<span class="keyword" id="3056485">range</span>&nbsp;<span class="ident" id="3056491">ips</span>&nbsp;<span class="op" id="3056495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056499">if</span>&nbsp;<span class="ident" id="3056502">ip</span>&nbsp;<span class="op" id="3056505">:=</span>&nbsp;<span class="ident" id="3056508">filter</span><span class="op" id="3056514">(</span><span class="ident" id="3056515">ip</span><span class="op" id="3056517">)</span><span class="op" id="3056518">;</span>&nbsp;<span class="ident" id="3056520">ip</span>&nbsp;<span class="op" id="3056523">!=</span>&nbsp;<span class="ident" id="3056526">nil</span>&nbsp;<span class="op" id="3056530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056535">return</span>&nbsp;<span class="ident" id="3056542">inetaddr</span><span class="op" id="3056550">(</span><span class="ident" id="3056551">ip</span><span class="op" id="3056553">)</span><span class="op" id="3056554">,</span>&nbsp;<span class="ident" id="3056556">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056565">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056568">return</span>&nbsp;<span class="ident" id="3056575">nil</span><span class="op" id="3056578">,</span>&nbsp;<span class="ident" id="3056580">errNoSuitableAddress</span><br>
<span class="lineno"></span><span class="op" id="3056601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3056604">//&nbsp;ipv4only&nbsp;returns&nbsp;IPv4&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3056673">//&nbsp;IPv4&nbsp;addressing&nbsp;modes.&nbsp;If&nbsp;ip&nbsp;is&nbsp;an&nbsp;IPv4&nbsp;address,&nbsp;ipv4only&nbsp;returns&nbsp;ip.</span><br>
<span class="lineno">120</span><span class="comment" id="3056746">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3056775">func</span>&nbsp;<span class="ident" id="3056780">ipv4only</span><span class="op" id="3056788">(</span><span class="ident" id="3056789">ip</span>&nbsp;<span class="ident" id="3056792">IP</span><span class="op" id="3056794">)</span>&nbsp;<span class="ident" id="3056796">IP</span>&nbsp;<span class="op" id="3056799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056802">if</span>&nbsp;<span class="ident" id="3056805">supportsIPv4</span>&nbsp;<span class="op" id="3056818">&amp;&amp;</span>&nbsp;<span class="ident" id="3056821">ip</span><span class="op" id="3056823">.</span><span class="ident" id="3056824">To4</span><span class="op" id="3056827">(</span><span class="op" id="3056828">)</span>&nbsp;<span class="op" id="3056830">!=</span>&nbsp;<span class="ident" id="3056833">nil</span>&nbsp;<span class="op" id="3056837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056841">return</span>&nbsp;<span class="ident" id="3056848">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056852">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056855">return</span>&nbsp;<span class="ident" id="3056862">nil</span><br>
<span class="lineno"></span><span class="op" id="3056866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3056869">//&nbsp;ipv6only&nbsp;returns&nbsp;IPv6&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3056938">//&nbsp;IPv6&nbsp;addressing&nbsp;modes.&nbsp;&nbsp;It&nbsp;returns&nbsp;IPv4-mapped&nbsp;IPv6&nbsp;addresses&nbsp;as</span><br>
<span class="lineno">130</span><span class="comment" id="3057006">//&nbsp;nils&nbsp;and&nbsp;returns&nbsp;other&nbsp;IPv6&nbsp;address&nbsp;types&nbsp;as&nbsp;IPv6&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3057070">func</span>&nbsp;<span class="ident" id="3057075">ipv6only</span><span class="op" id="3057083">(</span><span class="ident" id="3057084">ip</span>&nbsp;<span class="ident" id="3057087">IP</span><span class="op" id="3057089">)</span>&nbsp;<span class="ident" id="3057091">IP</span>&nbsp;<span class="op" id="3057094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057097">if</span>&nbsp;<span class="ident" id="3057100">supportsIPv6</span>&nbsp;<span class="op" id="3057113">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3057116">len</span><span class="op" id="3057119">(</span><span class="ident" id="3057120">ip</span><span class="op" id="3057122">)</span>&nbsp;<span class="op" id="3057124">==</span>&nbsp;<span class="ident" id="3057127">IPv6len</span>&nbsp;<span class="op" id="3057135">&amp;&amp;</span>&nbsp;<span class="ident" id="3057138">ip</span><span class="op" id="3057140">.</span><span class="ident" id="3057141">To4</span><span class="op" id="3057144">(</span><span class="op" id="3057145">)</span>&nbsp;<span class="op" id="3057147">==</span>&nbsp;<span class="ident" id="3057150">nil</span>&nbsp;<span class="op" id="3057154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057158">return</span>&nbsp;<span class="ident" id="3057165">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057169">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057172">return</span>&nbsp;<span class="ident" id="3057179">nil</span><br>
<span class="lineno"></span><span class="op" id="3057183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3057186">//&nbsp;SplitHostPort&nbsp;splits&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3057253">//&nbsp;&#34;[host]:port&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:port&#34;&nbsp;into&nbsp;host&nbsp;or</span><br>
<span class="lineno">140</span><span class="comment" id="3057310">//&nbsp;ipv6-host%zone&nbsp;and&nbsp;port.&nbsp;&nbsp;A&nbsp;literal&nbsp;address&nbsp;or&nbsp;host&nbsp;name&nbsp;for&nbsp;IPv6</span><br>
<span class="lineno"></span><span class="comment" id="3057379">//&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;square&nbsp;brackets,&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3057437">//&nbsp;&#34;[ipv6-host]:http&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3057485">func</span>&nbsp;<span class="ident" id="3057490">SplitHostPort</span><span class="op" id="3057503">(</span><span class="ident" id="3057504">hostport</span>&nbsp;<span class="builtintype" id="3057513">string</span><span class="op" id="3057519">)</span>&nbsp;<span class="op" id="3057521">(</span><span class="ident" id="3057522">host</span><span class="op" id="3057526">,</span>&nbsp;<span class="ident" id="3057528">port</span>&nbsp;<span class="builtintype" id="3057533">string</span><span class="op" id="3057539">,</span>&nbsp;<span class="ident" id="3057541">err</span>&nbsp;<span class="builtintype" id="3057545">error</span><span class="op" id="3057550">)</span>&nbsp;<span class="op" id="3057552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057555">j</span><span class="op" id="3057556">,</span>&nbsp;<span class="ident" id="3057558">k</span>&nbsp;<span class="op" id="3057560">:=</span>&nbsp;<span class="num" id="3057563">0</span><span class="op" id="3057564">,</span>&nbsp;<span class="num" id="3057566">0</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3057570">//&nbsp;The&nbsp;port&nbsp;starts&nbsp;after&nbsp;the&nbsp;last&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057612">i</span>&nbsp;<span class="op" id="3057614">:=</span>&nbsp;<span class="ident" id="3057617">last</span><span class="op" id="3057621">(</span><span class="ident" id="3057622">hostport</span><span class="op" id="3057630">,</span>&nbsp;<span class="string" id="3057632">&#39;:&#39;</span><span class="op" id="3057635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057638">if</span>&nbsp;<span class="ident" id="3057641">i</span>&nbsp;<span class="op" id="3057643">&lt;</span>&nbsp;<span class="num" id="3057645">0</span>&nbsp;<span class="op" id="3057647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057651">goto</span>&nbsp;<span class="ident" id="3057656">missingPort</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057673">if</span>&nbsp;<span class="ident" id="3057676">hostport</span><span class="op" id="3057684">[</span><span class="num" id="3057685">0</span><span class="op" id="3057686">]</span>&nbsp;<span class="op" id="3057688">==</span>&nbsp;<span class="string" id="3057691">&#39;[&#39;</span>&nbsp;<span class="op" id="3057695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3057699">//&nbsp;Expect&nbsp;the&nbsp;first&nbsp;&#39;]&#39;&nbsp;just&nbsp;before&nbsp;the&nbsp;last&nbsp;&#39;:&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057751">end</span>&nbsp;<span class="op" id="3057755">:=</span>&nbsp;<span class="ident" id="3057758">byteIndex</span><span class="op" id="3057767">(</span><span class="ident" id="3057768">hostport</span><span class="op" id="3057776">,</span>&nbsp;<span class="string" id="3057778">&#39;]&#39;</span><span class="op" id="3057781">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057785">if</span>&nbsp;<span class="ident" id="3057788">end</span>&nbsp;<span class="op" id="3057792">&lt;</span>&nbsp;<span class="num" id="3057794">0</span>&nbsp;<span class="op" id="3057796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057801">err</span>&nbsp;<span class="op" id="3057805">=</span>&nbsp;<span class="op" id="3057807">&amp;</span><span class="ident" id="3057808">AddrError</span><span class="op" id="3057817">{</span><span class="string" id="3057818">&#34;missing&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3057842">,</span>&nbsp;<span class="ident" id="3057844">hostport</span><span class="op" id="3057852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057857">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057870">switch</span>&nbsp;<span class="ident" id="3057877">end</span>&nbsp;<span class="op" id="3057881">+</span>&nbsp;<span class="num" id="3057883">1</span>&nbsp;<span class="op" id="3057885">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057889">case</span>&nbsp;<span class="builtinfunc" id="3057894">len</span><span class="op" id="3057897">(</span><span class="ident" id="3057898">hostport</span><span class="op" id="3057906">)</span><span class="op" id="3057907">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3057912">//&nbsp;There&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;:&#39;&nbsp;behind&nbsp;the&nbsp;&#39;]&#39;&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057959">goto</span>&nbsp;<span class="ident" id="3057964">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057978">case</span>&nbsp;<span class="ident" id="3057983">i</span><span class="op" id="3057984">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3057989">//&nbsp;The&nbsp;expected&nbsp;result.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058015">default</span><span class="op" id="3058022">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3058027">//&nbsp;Either&nbsp;&#39;]&#39;&nbsp;isn&#39;t&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;or&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3058080">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon&nbsp;that&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058132">if</span>&nbsp;<span class="ident" id="3058135">hostport</span><span class="op" id="3058143">[</span><span class="ident" id="3058144">end</span><span class="op" id="3058147">+</span><span class="num" id="3058148">1</span><span class="op" id="3058149">]</span>&nbsp;<span class="op" id="3058151">==</span>&nbsp;<span class="string" id="3058154">&#39;:&#39;</span>&nbsp;<span class="op" id="3058158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058164">goto</span>&nbsp;<span class="ident" id="3058169">tooManyColons</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3058186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058191">goto</span>&nbsp;<span class="ident" id="3058196">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3058210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058214">host</span>&nbsp;<span class="op" id="3058219">=</span>&nbsp;<span class="ident" id="3058221">hostport</span><span class="op" id="3058229">[</span><span class="num" id="3058230">1</span><span class="op" id="3058231">:</span><span class="ident" id="3058232">end</span><span class="op" id="3058235">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058239">j</span><span class="op" id="3058240">,</span>&nbsp;<span class="ident" id="3058242">k</span>&nbsp;<span class="op" id="3058244">=</span>&nbsp;<span class="num" id="3058246">1</span><span class="op" id="3058247">,</span>&nbsp;<span class="ident" id="3058249">end</span><span class="op" id="3058252">+</span><span class="num" id="3058253">1</span>&nbsp;<span class="comment" id="3058255">//&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;[&#39;&nbsp;resp.&nbsp;&#39;]&#39;&nbsp;before&nbsp;these&nbsp;positions</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3058313">}</span>&nbsp;<span class="keyword" id="3058315">else</span>&nbsp;<span class="op" id="3058320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058324">host</span>&nbsp;<span class="op" id="3058329">=</span>&nbsp;<span class="ident" id="3058331">hostport</span><span class="op" id="3058339">[</span><span class="op" id="3058340">:</span><span class="ident" id="3058341">i</span><span class="op" id="3058342">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058346">if</span>&nbsp;<span class="ident" id="3058349">byteIndex</span><span class="op" id="3058358">(</span><span class="ident" id="3058359">host</span><span class="op" id="3058363">,</span>&nbsp;<span class="string" id="3058365">&#39;:&#39;</span><span class="op" id="3058368">)</span>&nbsp;<span class="op" id="3058370">&gt;=</span>&nbsp;<span class="num" id="3058373">0</span>&nbsp;<span class="op" id="3058375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058380">goto</span>&nbsp;<span class="ident" id="3058385">tooManyColons</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3058401">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058405">if</span>&nbsp;<span class="ident" id="3058408">byteIndex</span><span class="op" id="3058417">(</span><span class="ident" id="3058418">host</span><span class="op" id="3058422">,</span>&nbsp;<span class="string" id="3058424">&#39;%&#39;</span><span class="op" id="3058427">)</span>&nbsp;<span class="op" id="3058429">&gt;=</span>&nbsp;<span class="num" id="3058432">0</span>&nbsp;<span class="op" id="3058434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058439">goto</span>&nbsp;<span class="ident" id="3058444">missingBrackets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3058462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3058465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058468">if</span>&nbsp;<span class="ident" id="3058471">byteIndex</span><span class="op" id="3058480">(</span><span class="ident" id="3058481">hostport</span><span class="op" id="3058489">[</span><span class="ident" id="3058490">j</span><span class="op" id="3058491">:</span><span class="op" id="3058492">]</span><span class="op" id="3058493">,</span>&nbsp;<span class="string" id="3058495">&#39;[&#39;</span><span class="op" id="3058498">)</span>&nbsp;<span class="op" id="3058500">&gt;=</span>&nbsp;<span class="num" id="3058503">0</span>&nbsp;<span class="op" id="3058505">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058509">err</span>&nbsp;<span class="op" id="3058513">=</span>&nbsp;<span class="op" id="3058515">&amp;</span><span class="ident" id="3058516">AddrError</span><span class="op" id="3058525">{</span><span class="string" id="3058526">&#34;unexpected&nbsp;&#39;[&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3058553">,</span>&nbsp;<span class="ident" id="3058555">hostport</span><span class="op" id="3058563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058567">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3058575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058578">if</span>&nbsp;<span class="ident" id="3058581">byteIndex</span><span class="op" id="3058590">(</span><span class="ident" id="3058591">hostport</span><span class="op" id="3058599">[</span><span class="ident" id="3058600">k</span><span class="op" id="3058601">:</span><span class="op" id="3058602">]</span><span class="op" id="3058603">,</span>&nbsp;<span class="string" id="3058605">&#39;]&#39;</span><span class="op" id="3058608">)</span>&nbsp;<span class="op" id="3058610">&gt;=</span>&nbsp;<span class="num" id="3058613">0</span>&nbsp;<span class="op" id="3058615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058619">err</span>&nbsp;<span class="op" id="3058623">=</span>&nbsp;<span class="op" id="3058625">&amp;</span><span class="ident" id="3058626">AddrError</span><span class="op" id="3058635">{</span><span class="string" id="3058636">&#34;unexpected&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3058663">,</span>&nbsp;<span class="ident" id="3058665">hostport</span><span class="op" id="3058673">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058677">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3058685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058689">port</span>&nbsp;<span class="op" id="3058694">=</span>&nbsp;<span class="ident" id="3058696">hostport</span><span class="op" id="3058704">[</span><span class="ident" id="3058705">i</span><span class="op" id="3058706">+</span><span class="num" id="3058707">1</span><span class="op" id="3058708">:</span><span class="op" id="3058709">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058712">return</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="ident" id="3058720">missingPort</span><span class="op" id="3058731">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058734">err</span>&nbsp;<span class="op" id="3058738">=</span>&nbsp;<span class="op" id="3058740">&amp;</span><span class="ident" id="3058741">AddrError</span><span class="op" id="3058750">{</span><span class="string" id="3058751">&#34;missing&nbsp;port&nbsp;in&nbsp;address&#34;</span><span class="op" id="3058776">,</span>&nbsp;<span class="ident" id="3058778">hostport</span><span class="op" id="3058786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058789">return</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="ident" id="3058797">tooManyColons</span><span class="op" id="3058810">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058813">err</span>&nbsp;<span class="op" id="3058817">=</span>&nbsp;<span class="op" id="3058819">&amp;</span><span class="ident" id="3058820">AddrError</span><span class="op" id="3058829">{</span><span class="string" id="3058830">&#34;too&nbsp;many&nbsp;colons&nbsp;in&nbsp;address&#34;</span><span class="op" id="3058858">,</span>&nbsp;<span class="ident" id="3058860">hostport</span><span class="op" id="3058868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058871">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3058879">missingBrackets</span><span class="op" id="3058894">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058897">err</span>&nbsp;<span class="op" id="3058901">=</span>&nbsp;<span class="op" id="3058903">&amp;</span><span class="ident" id="3058904">AddrError</span><span class="op" id="3058913">{</span><span class="string" id="3058914">&#34;missing&nbsp;brackets&nbsp;in&nbsp;address&#34;</span><span class="op" id="3058943">,</span>&nbsp;<span class="ident" id="3058945">hostport</span><span class="op" id="3058953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058956">return</span><br>
<span class="lineno"></span><span class="op" id="3058963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3058966">func</span>&nbsp;<span class="ident" id="3058971">splitHostZone</span><span class="op" id="3058984">(</span><span class="ident" id="3058985">s</span>&nbsp;<span class="builtintype" id="3058987">string</span><span class="op" id="3058993">)</span>&nbsp;<span class="op" id="3058995">(</span><span class="ident" id="3058996">host</span><span class="op" id="3059000">,</span>&nbsp;<span class="ident" id="3059002">zone</span>&nbsp;<span class="builtintype" id="3059007">string</span><span class="op" id="3059013">)</span>&nbsp;<span class="op" id="3059015">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3059018">//&nbsp;The&nbsp;IPv6&nbsp;scoped&nbsp;addressing&nbsp;zone&nbsp;identifier&nbsp;starts&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3059082">//&nbsp;last&nbsp;percent&nbsp;sign.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059105">if</span>&nbsp;<span class="ident" id="3059108">i</span>&nbsp;<span class="op" id="3059110">:=</span>&nbsp;<span class="ident" id="3059113">last</span><span class="op" id="3059117">(</span><span class="ident" id="3059118">s</span><span class="op" id="3059119">,</span>&nbsp;<span class="string" id="3059121">&#39;%&#39;</span><span class="op" id="3059124">)</span><span class="op" id="3059125">;</span>&nbsp;<span class="ident" id="3059127">i</span>&nbsp;<span class="op" id="3059129">&gt;</span>&nbsp;<span class="num" id="3059131">0</span>&nbsp;<span class="op" id="3059133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059137">host</span><span class="op" id="3059141">,</span>&nbsp;<span class="ident" id="3059143">zone</span>&nbsp;<span class="op" id="3059148">=</span>&nbsp;<span class="ident" id="3059150">s</span><span class="op" id="3059151">[</span><span class="op" id="3059152">:</span><span class="ident" id="3059153">i</span><span class="op" id="3059154">]</span><span class="op" id="3059155">,</span>&nbsp;<span class="ident" id="3059157">s</span><span class="op" id="3059158">[</span><span class="ident" id="3059159">i</span><span class="op" id="3059160">+</span><span class="num" id="3059161">1</span><span class="op" id="3059162">:</span><span class="op" id="3059163">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059166">}</span>&nbsp;<span class="keyword" id="3059168">else</span>&nbsp;<span class="op" id="3059173">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059177">host</span>&nbsp;<span class="op" id="3059182">=</span>&nbsp;<span class="ident" id="3059184">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059190">return</span><br>
<span class="lineno"></span><span class="op" id="3059197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="3059200">//&nbsp;JoinHostPort&nbsp;combines&nbsp;host&nbsp;and&nbsp;port&nbsp;into&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3059269">//&nbsp;form&nbsp;&#34;host:port&#34;&nbsp;or,&nbsp;if&nbsp;host&nbsp;contains&nbsp;a&nbsp;colon&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,</span><br>
<span class="lineno"></span><span class="comment" id="3059337">//&nbsp;&#34;[host]:port&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3059355">func</span>&nbsp;<span class="ident" id="3059360">JoinHostPort</span><span class="op" id="3059372">(</span><span class="ident" id="3059373">host</span><span class="op" id="3059377">,</span>&nbsp;<span class="ident" id="3059379">port</span>&nbsp;<span class="builtintype" id="3059384">string</span><span class="op" id="3059390">)</span>&nbsp;<span class="builtintype" id="3059392">string</span>&nbsp;<span class="op" id="3059399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3059402">//&nbsp;If&nbsp;host&nbsp;has&nbsp;colons&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,&nbsp;have&nbsp;to&nbsp;bracket&nbsp;it.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059464">if</span>&nbsp;<span class="ident" id="3059467">byteIndex</span><span class="op" id="3059476">(</span><span class="ident" id="3059477">host</span><span class="op" id="3059481">,</span>&nbsp;<span class="string" id="3059483">&#39;:&#39;</span><span class="op" id="3059486">)</span>&nbsp;<span class="op" id="3059488">&gt;=</span>&nbsp;<span class="num" id="3059491">0</span>&nbsp;<span class="op" id="3059493">||</span>&nbsp;<span class="ident" id="3059496">byteIndex</span><span class="op" id="3059505">(</span><span class="ident" id="3059506">host</span><span class="op" id="3059510">,</span>&nbsp;<span class="string" id="3059512">&#39;%&#39;</span><span class="op" id="3059515">)</span>&nbsp;<span class="op" id="3059517">&gt;=</span>&nbsp;<span class="num" id="3059520">0</span>&nbsp;<span class="op" id="3059522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059526">return</span>&nbsp;<span class="string" id="3059533">&#34;[&#34;</span>&nbsp;<span class="op" id="3059537">+</span>&nbsp;<span class="ident" id="3059539">host</span>&nbsp;<span class="op" id="3059544">+</span>&nbsp;<span class="string" id="3059546">&#34;]:&#34;</span>&nbsp;<span class="op" id="3059551">+</span>&nbsp;<span class="ident" id="3059553">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059562">return</span>&nbsp;<span class="ident" id="3059569">host</span>&nbsp;<span class="op" id="3059574">+</span>&nbsp;<span class="string" id="3059576">&#34;:&#34;</span>&nbsp;<span class="op" id="3059580">+</span>&nbsp;<span class="ident" id="3059582">port</span><br>
<span class="lineno"></span><span class="op" id="3059587">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3059590">//&nbsp;resolveInternetAddr&nbsp;resolves&nbsp;addr&nbsp;that&nbsp;is&nbsp;either&nbsp;a&nbsp;literal&nbsp;IP</span><br>
<span class="lineno"></span><span class="comment" id="3059655">//&nbsp;address&nbsp;or&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;returns&nbsp;an&nbsp;internet&nbsp;protocol&nbsp;family</span><br>
<span class="lineno"></span><span class="comment" id="3059720">//&nbsp;address.&nbsp;It&nbsp;returns&nbsp;a&nbsp;list&nbsp;that&nbsp;contains&nbsp;a&nbsp;pair&nbsp;of&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3059784">//&nbsp;address&nbsp;family&nbsp;addresses&nbsp;when&nbsp;addr&nbsp;is&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;the&nbsp;name&nbsp;has</span><br>
<span class="lineno">235</span><span class="comment" id="3059853">//&nbsp;multiple&nbsp;address&nbsp;family&nbsp;records.&nbsp;The&nbsp;result&nbsp;contains&nbsp;at&nbsp;least&nbsp;one</span><br>
<span class="lineno"></span><span class="comment" id="3059922">//&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3059952">func</span>&nbsp;<span class="ident" id="3059957">resolveInternetAddr</span><span class="op" id="3059976">(</span><span class="ident" id="3059977">net</span><span class="op" id="3059980">,</span>&nbsp;<span class="ident" id="3059982">addr</span>&nbsp;<span class="builtintype" id="3059987">string</span><span class="op" id="3059993">,</span>&nbsp;<span class="ident" id="3059995">deadline</span>&nbsp;<span class="ident" id="3060004">time</span><span class="op" id="3060008">.</span><span class="ident" id="3060009">Time</span><span class="op" id="3060013">)</span>&nbsp;<span class="op" id="3060015">(</span><span class="ident" id="3060016">netaddr</span><span class="op" id="3060023">,</span>&nbsp;<span class="builtintype" id="3060025">error</span><span class="op" id="3060030">)</span>&nbsp;<span class="op" id="3060032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060035">var</span>&nbsp;<span class="op" id="3060039">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060043">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3060060">error</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060068">host</span><span class="op" id="3060072">,</span>&nbsp;<span class="ident" id="3060074">port</span><span class="op" id="3060078">,</span>&nbsp;<span class="ident" id="3060080">zone</span>&nbsp;<span class="builtintype" id="3060085">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060094">portnum</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3060111">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060119">switch</span>&nbsp;<span class="ident" id="3060126">net</span>&nbsp;<span class="op" id="3060130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060133">case</span>&nbsp;<span class="string" id="3060138">&#34;tcp&#34;</span><span class="op" id="3060143">,</span>&nbsp;<span class="string" id="3060145">&#34;tcp4&#34;</span><span class="op" id="3060151">,</span>&nbsp;<span class="string" id="3060153">&#34;tcp6&#34;</span><span class="op" id="3060159">,</span>&nbsp;<span class="string" id="3060161">&#34;udp&#34;</span><span class="op" id="3060166">,</span>&nbsp;<span class="string" id="3060168">&#34;udp4&#34;</span><span class="op" id="3060174">,</span>&nbsp;<span class="string" id="3060176">&#34;udp6&#34;</span><span class="op" id="3060182">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060186">if</span>&nbsp;<span class="ident" id="3060189">addr</span>&nbsp;<span class="op" id="3060194">!=</span>&nbsp;<span class="string" id="3060197">&#34;&#34;</span>&nbsp;<span class="op" id="3060200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060205">if</span>&nbsp;<span class="ident" id="3060208">host</span><span class="op" id="3060212">,</span>&nbsp;<span class="ident" id="3060214">port</span><span class="op" id="3060218">,</span>&nbsp;<span class="ident" id="3060220">err</span>&nbsp;<span class="op" id="3060224">=</span>&nbsp;<span class="ident" id="3060226">SplitHostPort</span><span class="op" id="3060239">(</span><span class="ident" id="3060240">addr</span><span class="op" id="3060244">)</span><span class="op" id="3060245">;</span>&nbsp;<span class="ident" id="3060247">err</span>&nbsp;<span class="op" id="3060251">!=</span>&nbsp;<span class="ident" id="3060254">nil</span>&nbsp;<span class="op" id="3060258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060264">return</span>&nbsp;<span class="ident" id="3060271">nil</span><span class="op" id="3060274">,</span>&nbsp;<span class="ident" id="3060276">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060288">if</span>&nbsp;<span class="ident" id="3060291">portnum</span><span class="op" id="3060298">,</span>&nbsp;<span class="ident" id="3060300">err</span>&nbsp;<span class="op" id="3060304">=</span>&nbsp;<span class="ident" id="3060306">parsePort</span><span class="op" id="3060315">(</span><span class="ident" id="3060316">net</span><span class="op" id="3060319">,</span>&nbsp;<span class="ident" id="3060321">port</span><span class="op" id="3060325">)</span><span class="op" id="3060326">;</span>&nbsp;<span class="ident" id="3060328">err</span>&nbsp;<span class="op" id="3060332">!=</span>&nbsp;<span class="ident" id="3060335">nil</span>&nbsp;<span class="op" id="3060339">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060345">return</span>&nbsp;<span class="ident" id="3060352">nil</span><span class="op" id="3060355">,</span>&nbsp;<span class="ident" id="3060357">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060371">case</span>&nbsp;<span class="string" id="3060376">&#34;ip&#34;</span><span class="op" id="3060380">,</span>&nbsp;<span class="string" id="3060382">&#34;ip4&#34;</span><span class="op" id="3060387">,</span>&nbsp;<span class="string" id="3060389">&#34;ip6&#34;</span><span class="op" id="3060394">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060398">if</span>&nbsp;<span class="ident" id="3060401">addr</span>&nbsp;<span class="op" id="3060406">!=</span>&nbsp;<span class="string" id="3060409">&#34;&#34;</span>&nbsp;<span class="op" id="3060412">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060417">host</span>&nbsp;<span class="op" id="3060422">=</span>&nbsp;<span class="ident" id="3060424">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060434">default</span><span class="op" id="3060441">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060445">return</span>&nbsp;<span class="ident" id="3060452">nil</span><span class="op" id="3060455">,</span>&nbsp;<span class="ident" id="3060457">UnknownNetworkError</span><span class="op" id="3060476">(</span><span class="ident" id="3060477">net</span><span class="op" id="3060480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060483">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060486">inetaddr</span>&nbsp;<span class="op" id="3060495">:=</span>&nbsp;<span class="keyword" id="3060498">func</span><span class="op" id="3060502">(</span><span class="ident" id="3060503">ip</span>&nbsp;<span class="ident" id="3060506">IP</span><span class="op" id="3060508">)</span>&nbsp;<span class="ident" id="3060510">netaddr</span>&nbsp;<span class="op" id="3060518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060522">switch</span>&nbsp;<span class="ident" id="3060529">net</span>&nbsp;<span class="op" id="3060533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060537">case</span>&nbsp;<span class="string" id="3060542">&#34;tcp&#34;</span><span class="op" id="3060547">,</span>&nbsp;<span class="string" id="3060549">&#34;tcp4&#34;</span><span class="op" id="3060555">,</span>&nbsp;<span class="string" id="3060557">&#34;tcp6&#34;</span><span class="op" id="3060563">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060568">return</span>&nbsp;<span class="op" id="3060575">&amp;</span><span class="ident" id="3060576">TCPAddr</span><span class="op" id="3060583">{</span><span class="ident" id="3060584">IP</span><span class="op" id="3060586">:</span>&nbsp;<span class="ident" id="3060588">ip</span><span class="op" id="3060590">,</span>&nbsp;<span class="ident" id="3060592">Port</span><span class="op" id="3060596">:</span>&nbsp;<span class="ident" id="3060598">portnum</span><span class="op" id="3060605">,</span>&nbsp;<span class="ident" id="3060607">Zone</span><span class="op" id="3060611">:</span>&nbsp;<span class="ident" id="3060613">zone</span><span class="op" id="3060617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060621">case</span>&nbsp;<span class="string" id="3060626">&#34;udp&#34;</span><span class="op" id="3060631">,</span>&nbsp;<span class="string" id="3060633">&#34;udp4&#34;</span><span class="op" id="3060639">,</span>&nbsp;<span class="string" id="3060641">&#34;udp6&#34;</span><span class="op" id="3060647">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060652">return</span>&nbsp;<span class="op" id="3060659">&amp;</span><span class="ident" id="3060660">UDPAddr</span><span class="op" id="3060667">{</span><span class="ident" id="3060668">IP</span><span class="op" id="3060670">:</span>&nbsp;<span class="ident" id="3060672">ip</span><span class="op" id="3060674">,</span>&nbsp;<span class="ident" id="3060676">Port</span><span class="op" id="3060680">:</span>&nbsp;<span class="ident" id="3060682">portnum</span><span class="op" id="3060689">,</span>&nbsp;<span class="ident" id="3060691">Zone</span><span class="op" id="3060695">:</span>&nbsp;<span class="ident" id="3060697">zone</span><span class="op" id="3060701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060705">case</span>&nbsp;<span class="string" id="3060710">&#34;ip&#34;</span><span class="op" id="3060714">,</span>&nbsp;<span class="string" id="3060716">&#34;ip4&#34;</span><span class="op" id="3060721">,</span>&nbsp;<span class="string" id="3060723">&#34;ip6&#34;</span><span class="op" id="3060728">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060733">return</span>&nbsp;<span class="op" id="3060740">&amp;</span><span class="ident" id="3060741">IPAddr</span><span class="op" id="3060747">{</span><span class="ident" id="3060748">IP</span><span class="op" id="3060750">:</span>&nbsp;<span class="ident" id="3060752">ip</span><span class="op" id="3060754">,</span>&nbsp;<span class="ident" id="3060756">Zone</span><span class="op" id="3060760">:</span>&nbsp;<span class="ident" id="3060762">zone</span><span class="op" id="3060766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060770">default</span><span class="op" id="3060777">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3060782">panic</span><span class="op" id="3060787">(</span><span class="string" id="3060788">&#34;unexpected&nbsp;network:&nbsp;&#34;</span>&nbsp;<span class="op" id="3060811">+</span>&nbsp;<span class="ident" id="3060813">net</span><span class="op" id="3060816">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060826">if</span>&nbsp;<span class="ident" id="3060829">host</span>&nbsp;<span class="op" id="3060834">==</span>&nbsp;<span class="string" id="3060837">&#34;&#34;</span>&nbsp;<span class="op" id="3060840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060844">return</span>&nbsp;<span class="ident" id="3060851">inetaddr</span><span class="op" id="3060859">(</span><span class="ident" id="3060860">nil</span><span class="op" id="3060863">)</span><span class="op" id="3060864">,</span>&nbsp;<span class="ident" id="3060866">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060871">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3060874">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060907">var</span>&nbsp;<span class="ident" id="3060911">ip</span>&nbsp;<span class="ident" id="3060914">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060918">if</span>&nbsp;<span class="ident" id="3060921">ip</span>&nbsp;<span class="op" id="3060924">=</span>&nbsp;<span class="ident" id="3060926">parseIPv4</span><span class="op" id="3060935">(</span><span class="ident" id="3060936">host</span><span class="op" id="3060940">)</span><span class="op" id="3060941">;</span>&nbsp;<span class="ident" id="3060943">ip</span>&nbsp;<span class="op" id="3060946">!=</span>&nbsp;<span class="ident" id="3060949">nil</span>&nbsp;<span class="op" id="3060953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060957">return</span>&nbsp;<span class="ident" id="3060964">inetaddr</span><span class="op" id="3060972">(</span><span class="ident" id="3060973">ip</span><span class="op" id="3060975">)</span><span class="op" id="3060976">,</span>&nbsp;<span class="ident" id="3060978">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060983">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060986">if</span>&nbsp;<span class="ident" id="3060989">ip</span><span class="op" id="3060991">,</span>&nbsp;<span class="ident" id="3060993">zone</span>&nbsp;<span class="op" id="3060998">=</span>&nbsp;<span class="ident" id="3061000">parseIPv6</span><span class="op" id="3061009">(</span><span class="ident" id="3061010">host</span><span class="op" id="3061014">,</span>&nbsp;<span class="builtintype" id="3061016">true</span><span class="op" id="3061020">)</span><span class="op" id="3061021">;</span>&nbsp;<span class="ident" id="3061023">ip</span>&nbsp;<span class="op" id="3061026">!=</span>&nbsp;<span class="ident" id="3061029">nil</span>&nbsp;<span class="op" id="3061033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061037">return</span>&nbsp;<span class="ident" id="3061044">inetaddr</span><span class="op" id="3061052">(</span><span class="ident" id="3061053">ip</span><span class="op" id="3061055">)</span><span class="op" id="3061056">,</span>&nbsp;<span class="ident" id="3061058">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3061066">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;DNS&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061089">host</span><span class="op" id="3061093">,</span>&nbsp;<span class="ident" id="3061095">zone</span>&nbsp;<span class="op" id="3061100">=</span>&nbsp;<span class="ident" id="3061102">splitHostZone</span><span class="op" id="3061115">(</span><span class="ident" id="3061116">host</span><span class="op" id="3061120">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061123">ips</span><span class="op" id="3061126">,</span>&nbsp;<span class="ident" id="3061128">err</span>&nbsp;<span class="op" id="3061132">:=</span>&nbsp;<span class="ident" id="3061135">lookupIPDeadline</span><span class="op" id="3061151">(</span><span class="ident" id="3061152">host</span><span class="op" id="3061156">,</span>&nbsp;<span class="ident" id="3061158">deadline</span><span class="op" id="3061166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061169">if</span>&nbsp;<span class="ident" id="3061172">err</span>&nbsp;<span class="op" id="3061176">!=</span>&nbsp;<span class="ident" id="3061179">nil</span>&nbsp;<span class="op" id="3061183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061187">return</span>&nbsp;<span class="ident" id="3061194">nil</span><span class="op" id="3061197">,</span>&nbsp;<span class="ident" id="3061199">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061207">var</span>&nbsp;<span class="ident" id="3061211">filter</span>&nbsp;<span class="keyword" id="3061218">func</span><span class="op" id="3061222">(</span><span class="ident" id="3061223">IP</span><span class="op" id="3061225">)</span>&nbsp;<span class="ident" id="3061227">IP</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061231">if</span>&nbsp;<span class="ident" id="3061234">net</span>&nbsp;<span class="op" id="3061238">!=</span>&nbsp;<span class="string" id="3061241">&#34;&#34;</span>&nbsp;<span class="op" id="3061244">&amp;&amp;</span>&nbsp;<span class="ident" id="3061247">net</span><span class="op" id="3061250">[</span><span class="builtinfunc" id="3061251">len</span><span class="op" id="3061254">(</span><span class="ident" id="3061255">net</span><span class="op" id="3061258">)</span><span class="op" id="3061259">-</span><span class="num" id="3061260">1</span><span class="op" id="3061261">]</span>&nbsp;<span class="op" id="3061263">==</span>&nbsp;<span class="string" id="3061266">&#39;4&#39;</span>&nbsp;<span class="op" id="3061270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061274">filter</span>&nbsp;<span class="op" id="3061281">=</span>&nbsp;<span class="ident" id="3061283">ipv4only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061296">if</span>&nbsp;<span class="ident" id="3061299">net</span>&nbsp;<span class="op" id="3061303">!=</span>&nbsp;<span class="string" id="3061306">&#34;&#34;</span>&nbsp;<span class="op" id="3061309">&amp;&amp;</span>&nbsp;<span class="ident" id="3061312">net</span><span class="op" id="3061315">[</span><span class="builtinfunc" id="3061316">len</span><span class="op" id="3061319">(</span><span class="ident" id="3061320">net</span><span class="op" id="3061323">)</span><span class="op" id="3061324">-</span><span class="num" id="3061325">1</span><span class="op" id="3061326">]</span>&nbsp;<span class="op" id="3061328">==</span>&nbsp;<span class="string" id="3061331">&#39;6&#39;</span>&nbsp;<span class="op" id="3061335">||</span>&nbsp;<span class="ident" id="3061338">zone</span>&nbsp;<span class="op" id="3061343">!=</span>&nbsp;<span class="string" id="3061346">&#34;&#34;</span>&nbsp;<span class="op" id="3061349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061353">filter</span>&nbsp;<span class="op" id="3061360">=</span>&nbsp;<span class="ident" id="3061362">ipv6only</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061375">return</span>&nbsp;<span class="ident" id="3061382">firstFavoriteAddr</span><span class="op" id="3061399">(</span><span class="ident" id="3061400">filter</span><span class="op" id="3061406">,</span>&nbsp;<span class="ident" id="3061408">ips</span><span class="op" id="3061411">,</span>&nbsp;<span class="ident" id="3061413">inetaddr</span><span class="op" id="3061421">)</span><br>
<span class="lineno"></span><span class="op" id="3061423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3061426">func</span>&nbsp;<span class="ident" id="3061431">zoneToString</span><span class="op" id="3061443">(</span><span class="ident" id="3061444">zone</span>&nbsp;<span class="builtintype" id="3061449">int</span><span class="op" id="3061452">)</span>&nbsp;<span class="builtintype" id="3061454">string</span>&nbsp;<span class="op" id="3061461">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061464">if</span>&nbsp;<span class="ident" id="3061467">zone</span>&nbsp;<span class="op" id="3061472">==</span>&nbsp;<span class="num" id="3061475">0</span>&nbsp;<span class="op" id="3061477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061481">return</span>&nbsp;<span class="string" id="3061488">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061495">if</span>&nbsp;<span class="ident" id="3061498">ifi</span><span class="op" id="3061501">,</span>&nbsp;<span class="ident" id="3061503">err</span>&nbsp;<span class="op" id="3061507">:=</span>&nbsp;<span class="ident" id="3061510">InterfaceByIndex</span><span class="op" id="3061526">(</span><span class="ident" id="3061527">zone</span><span class="op" id="3061531">)</span><span class="op" id="3061532">;</span>&nbsp;<span class="ident" id="3061534">err</span>&nbsp;<span class="op" id="3061538">==</span>&nbsp;<span class="ident" id="3061541">nil</span>&nbsp;<span class="op" id="3061545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061549">return</span>&nbsp;<span class="ident" id="3061556">ifi</span><span class="op" id="3061559">.</span><span class="ident" id="3061560">Name</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061569">return</span>&nbsp;<span class="ident" id="3061576">itod</span><span class="op" id="3061580">(</span><span class="builtintype" id="3061581">uint</span><span class="op" id="3061585">(</span><span class="ident" id="3061586">zone</span><span class="op" id="3061590">)</span><span class="op" id="3061591">)</span><br>
<span class="lineno"></span><span class="op" id="3061593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3061596">func</span>&nbsp;<span class="ident" id="3061601">zoneToInt</span><span class="op" id="3061610">(</span><span class="ident" id="3061611">zone</span>&nbsp;<span class="builtintype" id="3061616">string</span><span class="op" id="3061622">)</span>&nbsp;<span class="builtintype" id="3061624">int</span>&nbsp;<span class="op" id="3061628">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061631">if</span>&nbsp;<span class="ident" id="3061634">zone</span>&nbsp;<span class="op" id="3061639">==</span>&nbsp;<span class="string" id="3061642">&#34;&#34;</span>&nbsp;<span class="op" id="3061645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061649">return</span>&nbsp;<span class="num" id="3061656">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061662">if</span>&nbsp;<span class="ident" id="3061665">ifi</span><span class="op" id="3061668">,</span>&nbsp;<span class="ident" id="3061670">err</span>&nbsp;<span class="op" id="3061674">:=</span>&nbsp;<span class="ident" id="3061677">InterfaceByName</span><span class="op" id="3061692">(</span><span class="ident" id="3061693">zone</span><span class="op" id="3061697">)</span><span class="op" id="3061698">;</span>&nbsp;<span class="ident" id="3061700">err</span>&nbsp;<span class="op" id="3061704">==</span>&nbsp;<span class="ident" id="3061707">nil</span>&nbsp;<span class="op" id="3061711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061715">return</span>&nbsp;<span class="ident" id="3061722">ifi</span><span class="op" id="3061725">.</span><span class="ident" id="3061726">Index</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061736">n</span><span class="op" id="3061737">,</span>&nbsp;<span class="ident" id="3061739">_</span><span class="op" id="3061740">,</span>&nbsp;<span class="ident" id="3061742">_</span>&nbsp;<span class="op" id="3061744">:=</span>&nbsp;<span class="ident" id="3061747">dtoi</span><span class="op" id="3061751">(</span><span class="ident" id="3061752">zone</span><span class="op" id="3061756">,</span>&nbsp;<span class="num" id="3061758">0</span><span class="op" id="3061759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061762">return</span>&nbsp;<span class="ident" id="3061769">n</span><br>
<span class="lineno"></span><span class="op" id="3061771">}</span>
</div>
</body>
</html>
