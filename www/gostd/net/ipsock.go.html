<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4100703">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4100759">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4100813">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4100864">//&nbsp;Internet&nbsp;protocol&nbsp;family&nbsp;sockets</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4100901">package</span>&nbsp;<span class="ident" id="4100909">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4100914">import</span>&nbsp;<span class="op" id="4100921">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4100924">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4100934">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4100941">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4100944">var</span>&nbsp;<span class="op" id="4100948">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4100951">//&nbsp;supportsIPv4&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4101011">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101041">supportsIPv4</span>&nbsp;<span class="builtintype" id="4101054">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4101061">//&nbsp;supportsIPv6&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv6</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4101121">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101151">supportsIPv6</span>&nbsp;<span class="builtintype" id="4101164">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4101171">//&nbsp;supportsIPv4map&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4101229">//&nbsp;mapping&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;inside&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;at&nbsp;transport</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4101293">//&nbsp;layer&nbsp;protocols.&nbsp;&nbsp;See&nbsp;RFC&nbsp;4291,&nbsp;RFC&nbsp;4038&nbsp;and&nbsp;RFC&nbsp;3493.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101352">supportsIPv4map</span>&nbsp;<span class="builtintype" id="4101368">bool</span><br>
<span class="lineno"></span><span class="op" id="4101373">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4101376">func</span>&nbsp;<span class="ident" id="4101381">init</span><span class="op" id="4101385">(</span><span class="op" id="4101386">)</span>&nbsp;<span class="op" id="4101388">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101391">sysInit</span><span class="op" id="4101398">(</span><span class="op" id="4101399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101402">supportsIPv4</span>&nbsp;<span class="op" id="4101415">=</span>&nbsp;<span class="ident" id="4101417">probeIPv4Stack</span><span class="op" id="4101431">(</span><span class="op" id="4101432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101435">supportsIPv6</span><span class="op" id="4101447">,</span>&nbsp;<span class="ident" id="4101449">supportsIPv4map</span>&nbsp;<span class="op" id="4101465">=</span>&nbsp;<span class="ident" id="4101467">probeIPv6Stack</span><span class="op" id="4101481">(</span><span class="op" id="4101482">)</span><br>
<span class="lineno"></span><span class="op" id="4101484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4101487">//&nbsp;A&nbsp;netaddr&nbsp;represents&nbsp;a&nbsp;network&nbsp;endpoint&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4101551">//&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="4101582">type</span>&nbsp;<span class="ident" id="4101587">netaddr</span>&nbsp;<span class="keyword" id="4101595">interface</span>&nbsp;<span class="op" id="4101605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4101608">//&nbsp;toAddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;represented&nbsp;in&nbsp;Addr&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4101670">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is&nbsp;nil.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101726">toAddr</span><span class="op" id="4101732">(</span><span class="op" id="4101733">)</span>&nbsp;<span class="ident" id="4101735">Addr</span><br>
<span class="lineno"></span><span class="op" id="4101740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4101743">//&nbsp;An&nbsp;addrList&nbsp;represents&nbsp;a&nbsp;list&nbsp;of&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="4101807">type</span>&nbsp;<span class="ident" id="4101812">addrList</span>&nbsp;<span class="op" id="4101821">[</span><span class="op" id="4101822">]</span><span class="ident" id="4101823">netaddr</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="4101832">func</span>&nbsp;<span class="op" id="4101837">(</span><span class="ident" id="4101838">al</span>&nbsp;<span class="ident" id="4101841">addrList</span><span class="op" id="4101849">)</span>&nbsp;<span class="ident" id="4101851">toAddr</span><span class="op" id="4101857">(</span><span class="op" id="4101858">)</span>&nbsp;<span class="ident" id="4101860">Addr</span>&nbsp;<span class="op" id="4101865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101868">switch</span>&nbsp;<span class="builtinfunc" id="4101875">len</span><span class="op" id="4101878">(</span><span class="ident" id="4101879">al</span><span class="op" id="4101881">)</span>&nbsp;<span class="op" id="4101883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101886">case</span>&nbsp;<span class="num" id="4101891">0</span><span class="op" id="4101892">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101896">return</span>&nbsp;<span class="ident" id="4101903">nil</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101908">case</span>&nbsp;<span class="num" id="4101913">1</span><span class="op" id="4101914">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101918">return</span>&nbsp;<span class="ident" id="4101925">al</span><span class="op" id="4101927">[</span><span class="num" id="4101928">0</span><span class="op" id="4101929">]</span><span class="op" id="4101930">.</span><span class="ident" id="4101931">toAddr</span><span class="op" id="4101937">(</span><span class="op" id="4101938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101941">default</span><span class="op" id="4101948">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4101952">//&nbsp;For&nbsp;now,&nbsp;we&#39;ll&nbsp;roughly&nbsp;pick&nbsp;first&nbsp;one&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4102003">//&nbsp;considering&nbsp;dealing&nbsp;with&nbsp;any&nbsp;preferences&nbsp;such&nbsp;as</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4102057">//&nbsp;DNS&nbsp;TTL,&nbsp;transport&nbsp;path&nbsp;quality,&nbsp;network&nbsp;routing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4102111">//&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102129">return</span>&nbsp;<span class="ident" id="4102136">al</span><span class="op" id="4102138">[</span><span class="num" id="4102139">0</span><span class="op" id="4102140">]</span><span class="op" id="4102141">.</span><span class="ident" id="4102142">toAddr</span><span class="op" id="4102148">(</span><span class="op" id="4102149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4102152">}</span><br>
<span class="lineno"></span><span class="op" id="4102154">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="4102157">var</span>&nbsp;<span class="ident" id="4102161">errNoSuitableAddress</span>&nbsp;<span class="op" id="4102182">=</span>&nbsp;<span class="ident" id="4102184">errors</span><span class="op" id="4102190">.</span><span class="ident" id="4102191">New</span><span class="op" id="4102194">(</span><span class="string" id="4102195">&#34;no&nbsp;suitable&nbsp;address&nbsp;found&#34;</span><span class="op" id="4102222">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4102225">//&nbsp;firstFavoriteAddr&nbsp;returns&nbsp;an&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4102293">//&nbsp;implement&nbsp;the&nbsp;netaddr&nbsp;interface.&nbsp;Known&nbsp;filters&nbsp;are&nbsp;nil,&nbsp;ipv4only</span><br>
<span class="lineno">65</span><span class="comment" id="4102361">//&nbsp;and&nbsp;ipv6only.&nbsp;It&nbsp;returns&nbsp;any&nbsp;address&nbsp;when&nbsp;filter&nbsp;is&nbsp;nil.&nbsp;The&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="4102432">//&nbsp;contains&nbsp;at&nbsp;least&nbsp;one&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4102484">func</span>&nbsp;<span class="ident" id="4102489">firstFavoriteAddr</span><span class="op" id="4102506">(</span><span class="ident" id="4102507">filter</span>&nbsp;<span class="keyword" id="4102514">func</span><span class="op" id="4102518">(</span><span class="ident" id="4102519">IP</span><span class="op" id="4102521">)</span>&nbsp;<span class="ident" id="4102523">IP</span><span class="op" id="4102525">,</span>&nbsp;<span class="ident" id="4102527">ips</span>&nbsp;<span class="op" id="4102531">[</span><span class="op" id="4102532">]</span><span class="ident" id="4102533">IP</span><span class="op" id="4102535">,</span>&nbsp;<span class="ident" id="4102537">inetaddr</span>&nbsp;<span class="keyword" id="4102546">func</span><span class="op" id="4102550">(</span><span class="ident" id="4102551">IP</span><span class="op" id="4102553">)</span>&nbsp;<span class="ident" id="4102555">netaddr</span><span class="op" id="4102562">)</span>&nbsp;<span class="op" id="4102564">(</span><span class="ident" id="4102565">netaddr</span><span class="op" id="4102572">,</span>&nbsp;<span class="builtintype" id="4102574">error</span><span class="op" id="4102579">)</span>&nbsp;<span class="op" id="4102581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102584">if</span>&nbsp;<span class="ident" id="4102587">filter</span>&nbsp;<span class="op" id="4102594">!=</span>&nbsp;<span class="ident" id="4102597">nil</span>&nbsp;<span class="op" id="4102601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102605">return</span>&nbsp;<span class="ident" id="4102612">firstSupportedAddr</span><span class="op" id="4102630">(</span><span class="ident" id="4102631">filter</span><span class="op" id="4102637">,</span>&nbsp;<span class="ident" id="4102639">ips</span><span class="op" id="4102642">,</span>&nbsp;<span class="ident" id="4102644">inetaddr</span><span class="op" id="4102652">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4102655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102658">var</span>&nbsp;<span class="op" id="4102662">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102666">ipv4</span><span class="op" id="4102670">,</span>&nbsp;<span class="ident" id="4102672">ipv6</span><span class="op" id="4102676">,</span>&nbsp;<span class="ident" id="4102678">swap</span>&nbsp;<span class="builtintype" id="4102683">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102690">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4102707">addrList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4102717">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102720">for</span>&nbsp;<span class="ident" id="4102724">_</span><span class="op" id="4102725">,</span>&nbsp;<span class="ident" id="4102727">ip</span>&nbsp;<span class="op" id="4102730">:=</span>&nbsp;<span class="keyword" id="4102733">range</span>&nbsp;<span class="ident" id="4102739">ips</span>&nbsp;<span class="op" id="4102743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4102747">//&nbsp;We&#39;ll&nbsp;take&nbsp;any&nbsp;IP&nbsp;address,&nbsp;but&nbsp;since&nbsp;the&nbsp;dialing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4102801">//&nbsp;code&nbsp;does&nbsp;not&nbsp;yet&nbsp;try&nbsp;multiple&nbsp;addresses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4102847">//&nbsp;effectively,&nbsp;prefer&nbsp;to&nbsp;use&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4102898">//&nbsp;possible.&nbsp;This&nbsp;is&nbsp;especially&nbsp;relevant&nbsp;if&nbsp;localhost</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4102954">//&nbsp;resolves&nbsp;to&nbsp;[ipv6-localhost,&nbsp;ipv4-localhost].&nbsp;Too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4103009">//&nbsp;much&nbsp;code&nbsp;assumes&nbsp;localhost&nbsp;==&nbsp;ipv4-localhost.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103061">if</span>&nbsp;<span class="ident" id="4103064">ip4</span>&nbsp;<span class="op" id="4103068">:=</span>&nbsp;<span class="ident" id="4103071">ipv4only</span><span class="op" id="4103079">(</span><span class="ident" id="4103080">ip</span><span class="op" id="4103082">)</span><span class="op" id="4103083">;</span>&nbsp;<span class="ident" id="4103085">ip4</span>&nbsp;<span class="op" id="4103089">!=</span>&nbsp;<span class="ident" id="4103092">nil</span>&nbsp;<span class="op" id="4103096">&amp;&amp;</span>&nbsp;<span class="op" id="4103099">!</span><span class="ident" id="4103100">ipv4</span>&nbsp;<span class="op" id="4103105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103110">list</span>&nbsp;<span class="op" id="4103115">=</span>&nbsp;<span class="builtinfunc" id="4103117">append</span><span class="op" id="4103123">(</span><span class="ident" id="4103124">list</span><span class="op" id="4103128">,</span>&nbsp;<span class="ident" id="4103130">inetaddr</span><span class="op" id="4103138">(</span><span class="ident" id="4103139">ip4</span><span class="op" id="4103142">)</span><span class="op" id="4103143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103148">ipv4</span>&nbsp;<span class="op" id="4103153">=</span>&nbsp;<span class="builtintype" id="4103155">true</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103163">if</span>&nbsp;<span class="ident" id="4103166">ipv6</span>&nbsp;<span class="op" id="4103171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103177">swap</span>&nbsp;<span class="op" id="4103182">=</span>&nbsp;<span class="builtintype" id="4103184">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4103192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4103196">}</span>&nbsp;<span class="keyword" id="4103198">else</span>&nbsp;<span class="keyword" id="4103203">if</span>&nbsp;<span class="ident" id="4103206">ip6</span>&nbsp;<span class="op" id="4103210">:=</span>&nbsp;<span class="ident" id="4103213">ipv6only</span><span class="op" id="4103221">(</span><span class="ident" id="4103222">ip</span><span class="op" id="4103224">)</span><span class="op" id="4103225">;</span>&nbsp;<span class="ident" id="4103227">ip6</span>&nbsp;<span class="op" id="4103231">!=</span>&nbsp;<span class="ident" id="4103234">nil</span>&nbsp;<span class="op" id="4103238">&amp;&amp;</span>&nbsp;<span class="op" id="4103241">!</span><span class="ident" id="4103242">ipv6</span>&nbsp;<span class="op" id="4103247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103252">list</span>&nbsp;<span class="op" id="4103257">=</span>&nbsp;<span class="builtinfunc" id="4103259">append</span><span class="op" id="4103265">(</span><span class="ident" id="4103266">list</span><span class="op" id="4103270">,</span>&nbsp;<span class="ident" id="4103272">inetaddr</span><span class="op" id="4103280">(</span><span class="ident" id="4103281">ip6</span><span class="op" id="4103284">)</span><span class="op" id="4103285">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103290">ipv6</span>&nbsp;<span class="op" id="4103295">=</span>&nbsp;<span class="builtintype" id="4103297">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4103304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103308">if</span>&nbsp;<span class="ident" id="4103311">ipv4</span>&nbsp;<span class="op" id="4103316">&amp;&amp;</span>&nbsp;<span class="ident" id="4103319">ipv6</span>&nbsp;<span class="op" id="4103324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103329">if</span>&nbsp;<span class="ident" id="4103332">swap</span>&nbsp;<span class="op" id="4103337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103343">list</span><span class="op" id="4103347">[</span><span class="num" id="4103348">0</span><span class="op" id="4103349">]</span><span class="op" id="4103350">,</span>&nbsp;<span class="ident" id="4103352">list</span><span class="op" id="4103356">[</span><span class="num" id="4103357">1</span><span class="op" id="4103358">]</span>&nbsp;<span class="op" id="4103360">=</span>&nbsp;<span class="ident" id="4103362">list</span><span class="op" id="4103366">[</span><span class="num" id="4103367">1</span><span class="op" id="4103368">]</span><span class="op" id="4103369">,</span>&nbsp;<span class="ident" id="4103371">list</span><span class="op" id="4103375">[</span><span class="num" id="4103376">0</span><span class="op" id="4103377">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4103382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103387">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4103395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4103398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103401">switch</span>&nbsp;<span class="builtinfunc" id="4103408">len</span><span class="op" id="4103411">(</span><span class="ident" id="4103412">list</span><span class="op" id="4103416">)</span>&nbsp;<span class="op" id="4103418">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103421">case</span>&nbsp;<span class="num" id="4103426">0</span><span class="op" id="4103427">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103431">return</span>&nbsp;<span class="ident" id="4103438">nil</span><span class="op" id="4103441">,</span>&nbsp;<span class="ident" id="4103443">errNoSuitableAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103465">case</span>&nbsp;<span class="num" id="4103470">1</span><span class="op" id="4103471">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103475">return</span>&nbsp;<span class="ident" id="4103482">list</span><span class="op" id="4103486">[</span><span class="num" id="4103487">0</span><span class="op" id="4103488">]</span><span class="op" id="4103489">,</span>&nbsp;<span class="ident" id="4103491">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103496">default</span><span class="op" id="4103503">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103507">return</span>&nbsp;<span class="ident" id="4103514">list</span><span class="op" id="4103518">,</span>&nbsp;<span class="ident" id="4103520">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4103525">}</span><br>
<span class="lineno"></span><span class="op" id="4103527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4103530">func</span>&nbsp;<span class="ident" id="4103535">firstSupportedAddr</span><span class="op" id="4103553">(</span><span class="ident" id="4103554">filter</span>&nbsp;<span class="keyword" id="4103561">func</span><span class="op" id="4103565">(</span><span class="ident" id="4103566">IP</span><span class="op" id="4103568">)</span>&nbsp;<span class="ident" id="4103570">IP</span><span class="op" id="4103572">,</span>&nbsp;<span class="ident" id="4103574">ips</span>&nbsp;<span class="op" id="4103578">[</span><span class="op" id="4103579">]</span><span class="ident" id="4103580">IP</span><span class="op" id="4103582">,</span>&nbsp;<span class="ident" id="4103584">inetaddr</span>&nbsp;<span class="keyword" id="4103593">func</span><span class="op" id="4103597">(</span><span class="ident" id="4103598">IP</span><span class="op" id="4103600">)</span>&nbsp;<span class="ident" id="4103602">netaddr</span><span class="op" id="4103609">)</span>&nbsp;<span class="op" id="4103611">(</span><span class="ident" id="4103612">netaddr</span><span class="op" id="4103619">,</span>&nbsp;<span class="builtintype" id="4103621">error</span><span class="op" id="4103626">)</span>&nbsp;<span class="op" id="4103628">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103631">for</span>&nbsp;<span class="ident" id="4103635">_</span><span class="op" id="4103636">,</span>&nbsp;<span class="ident" id="4103638">ip</span>&nbsp;<span class="op" id="4103641">:=</span>&nbsp;<span class="keyword" id="4103644">range</span>&nbsp;<span class="ident" id="4103650">ips</span>&nbsp;<span class="op" id="4103654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103658">if</span>&nbsp;<span class="ident" id="4103661">ip</span>&nbsp;<span class="op" id="4103664">:=</span>&nbsp;<span class="ident" id="4103667">filter</span><span class="op" id="4103673">(</span><span class="ident" id="4103674">ip</span><span class="op" id="4103676">)</span><span class="op" id="4103677">;</span>&nbsp;<span class="ident" id="4103679">ip</span>&nbsp;<span class="op" id="4103682">!=</span>&nbsp;<span class="ident" id="4103685">nil</span>&nbsp;<span class="op" id="4103689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103694">return</span>&nbsp;<span class="ident" id="4103701">inetaddr</span><span class="op" id="4103709">(</span><span class="ident" id="4103710">ip</span><span class="op" id="4103712">)</span><span class="op" id="4103713">,</span>&nbsp;<span class="ident" id="4103715">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4103721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4103724">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103727">return</span>&nbsp;<span class="ident" id="4103734">nil</span><span class="op" id="4103737">,</span>&nbsp;<span class="ident" id="4103739">errNoSuitableAddress</span><br>
<span class="lineno"></span><span class="op" id="4103760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4103763">//&nbsp;ipv4only&nbsp;returns&nbsp;IPv4&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4103832">//&nbsp;IPv4&nbsp;addressing&nbsp;modes.&nbsp;If&nbsp;ip&nbsp;is&nbsp;an&nbsp;IPv4&nbsp;address,&nbsp;ipv4only&nbsp;returns&nbsp;ip.</span><br>
<span class="lineno">120</span><span class="comment" id="4103905">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4103934">func</span>&nbsp;<span class="ident" id="4103939">ipv4only</span><span class="op" id="4103947">(</span><span class="ident" id="4103948">ip</span>&nbsp;<span class="ident" id="4103951">IP</span><span class="op" id="4103953">)</span>&nbsp;<span class="ident" id="4103955">IP</span>&nbsp;<span class="op" id="4103958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103961">if</span>&nbsp;<span class="ident" id="4103964">supportsIPv4</span>&nbsp;<span class="op" id="4103977">&amp;&amp;</span>&nbsp;<span class="ident" id="4103980">ip</span><span class="op" id="4103982">.</span><span class="ident" id="4103983">To4</span><span class="op" id="4103986">(</span><span class="op" id="4103987">)</span>&nbsp;<span class="op" id="4103989">!=</span>&nbsp;<span class="ident" id="4103992">nil</span>&nbsp;<span class="op" id="4103996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104000">return</span>&nbsp;<span class="ident" id="4104007">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4104011">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104014">return</span>&nbsp;<span class="ident" id="4104021">nil</span><br>
<span class="lineno"></span><span class="op" id="4104025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4104028">//&nbsp;ipv6only&nbsp;returns&nbsp;IPv6&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4104097">//&nbsp;IPv6&nbsp;addressing&nbsp;modes.&nbsp;&nbsp;It&nbsp;returns&nbsp;IPv4-mapped&nbsp;IPv6&nbsp;addresses&nbsp;as</span><br>
<span class="lineno">130</span><span class="comment" id="4104165">//&nbsp;nils&nbsp;and&nbsp;returns&nbsp;other&nbsp;IPv6&nbsp;address&nbsp;types&nbsp;as&nbsp;IPv6&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="4104229">func</span>&nbsp;<span class="ident" id="4104234">ipv6only</span><span class="op" id="4104242">(</span><span class="ident" id="4104243">ip</span>&nbsp;<span class="ident" id="4104246">IP</span><span class="op" id="4104248">)</span>&nbsp;<span class="ident" id="4104250">IP</span>&nbsp;<span class="op" id="4104253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104256">if</span>&nbsp;<span class="ident" id="4104259">supportsIPv6</span>&nbsp;<span class="op" id="4104272">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4104275">len</span><span class="op" id="4104278">(</span><span class="ident" id="4104279">ip</span><span class="op" id="4104281">)</span>&nbsp;<span class="op" id="4104283">==</span>&nbsp;<span class="ident" id="4104286">IPv6len</span>&nbsp;<span class="op" id="4104294">&amp;&amp;</span>&nbsp;<span class="ident" id="4104297">ip</span><span class="op" id="4104299">.</span><span class="ident" id="4104300">To4</span><span class="op" id="4104303">(</span><span class="op" id="4104304">)</span>&nbsp;<span class="op" id="4104306">==</span>&nbsp;<span class="ident" id="4104309">nil</span>&nbsp;<span class="op" id="4104313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104317">return</span>&nbsp;<span class="ident" id="4104324">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4104328">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104331">return</span>&nbsp;<span class="ident" id="4104338">nil</span><br>
<span class="lineno"></span><span class="op" id="4104342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4104345">//&nbsp;SplitHostPort&nbsp;splits&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4104412">//&nbsp;&#34;[host]:port&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:port&#34;&nbsp;into&nbsp;host&nbsp;or</span><br>
<span class="lineno">140</span><span class="comment" id="4104469">//&nbsp;ipv6-host%zone&nbsp;and&nbsp;port.&nbsp;&nbsp;A&nbsp;literal&nbsp;address&nbsp;or&nbsp;host&nbsp;name&nbsp;for&nbsp;IPv6</span><br>
<span class="lineno"></span><span class="comment" id="4104538">//&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;square&nbsp;brackets,&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4104596">//&nbsp;&#34;[ipv6-host]:http&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4104644">func</span>&nbsp;<span class="ident" id="4104649">SplitHostPort</span><span class="op" id="4104662">(</span><span class="ident" id="4104663">hostport</span>&nbsp;<span class="builtintype" id="4104672">string</span><span class="op" id="4104678">)</span>&nbsp;<span class="op" id="4104680">(</span><span class="ident" id="4104681">host</span><span class="op" id="4104685">,</span>&nbsp;<span class="ident" id="4104687">port</span>&nbsp;<span class="builtintype" id="4104692">string</span><span class="op" id="4104698">,</span>&nbsp;<span class="ident" id="4104700">err</span>&nbsp;<span class="builtintype" id="4104704">error</span><span class="op" id="4104709">)</span>&nbsp;<span class="op" id="4104711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104714">j</span><span class="op" id="4104715">,</span>&nbsp;<span class="ident" id="4104717">k</span>&nbsp;<span class="op" id="4104719">:=</span>&nbsp;<span class="num" id="4104722">0</span><span class="op" id="4104723">,</span>&nbsp;<span class="num" id="4104725">0</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4104729">//&nbsp;The&nbsp;port&nbsp;starts&nbsp;after&nbsp;the&nbsp;last&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104771">i</span>&nbsp;<span class="op" id="4104773">:=</span>&nbsp;<span class="ident" id="4104776">last</span><span class="op" id="4104780">(</span><span class="ident" id="4104781">hostport</span><span class="op" id="4104789">,</span>&nbsp;<span class="string" id="4104791">&#39;:&#39;</span><span class="op" id="4104794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104797">if</span>&nbsp;<span class="ident" id="4104800">i</span>&nbsp;<span class="op" id="4104802">&lt;</span>&nbsp;<span class="num" id="4104804">0</span>&nbsp;<span class="op" id="4104806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104810">goto</span>&nbsp;<span class="ident" id="4104815">missingPort</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4104828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104832">if</span>&nbsp;<span class="ident" id="4104835">hostport</span><span class="op" id="4104843">[</span><span class="num" id="4104844">0</span><span class="op" id="4104845">]</span>&nbsp;<span class="op" id="4104847">==</span>&nbsp;<span class="string" id="4104850">&#39;[&#39;</span>&nbsp;<span class="op" id="4104854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4104858">//&nbsp;Expect&nbsp;the&nbsp;first&nbsp;&#39;]&#39;&nbsp;just&nbsp;before&nbsp;the&nbsp;last&nbsp;&#39;:&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104910">end</span>&nbsp;<span class="op" id="4104914">:=</span>&nbsp;<span class="ident" id="4104917">byteIndex</span><span class="op" id="4104926">(</span><span class="ident" id="4104927">hostport</span><span class="op" id="4104935">,</span>&nbsp;<span class="string" id="4104937">&#39;]&#39;</span><span class="op" id="4104940">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104944">if</span>&nbsp;<span class="ident" id="4104947">end</span>&nbsp;<span class="op" id="4104951">&lt;</span>&nbsp;<span class="num" id="4104953">0</span>&nbsp;<span class="op" id="4104955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104960">err</span>&nbsp;<span class="op" id="4104964">=</span>&nbsp;<span class="op" id="4104966">&amp;</span><span class="ident" id="4104967">AddrError</span><span class="op" id="4104976">{</span><span class="string" id="4104977">&#34;missing&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="4105001">,</span>&nbsp;<span class="ident" id="4105003">hostport</span><span class="op" id="4105011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105016">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4105025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105029">switch</span>&nbsp;<span class="ident" id="4105036">end</span>&nbsp;<span class="op" id="4105040">+</span>&nbsp;<span class="num" id="4105042">1</span>&nbsp;<span class="op" id="4105044">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105048">case</span>&nbsp;<span class="builtinfunc" id="4105053">len</span><span class="op" id="4105056">(</span><span class="ident" id="4105057">hostport</span><span class="op" id="4105065">)</span><span class="op" id="4105066">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4105071">//&nbsp;There&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;:&#39;&nbsp;behind&nbsp;the&nbsp;&#39;]&#39;&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105118">goto</span>&nbsp;<span class="ident" id="4105123">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105137">case</span>&nbsp;<span class="ident" id="4105142">i</span><span class="op" id="4105143">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4105148">//&nbsp;The&nbsp;expected&nbsp;result.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105174">default</span><span class="op" id="4105181">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4105186">//&nbsp;Either&nbsp;&#39;]&#39;&nbsp;isn&#39;t&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;or&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4105239">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon&nbsp;that&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105291">if</span>&nbsp;<span class="ident" id="4105294">hostport</span><span class="op" id="4105302">[</span><span class="ident" id="4105303">end</span><span class="op" id="4105306">+</span><span class="num" id="4105307">1</span><span class="op" id="4105308">]</span>&nbsp;<span class="op" id="4105310">==</span>&nbsp;<span class="string" id="4105313">&#39;:&#39;</span>&nbsp;<span class="op" id="4105317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105323">goto</span>&nbsp;<span class="ident" id="4105328">tooManyColons</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4105345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105350">goto</span>&nbsp;<span class="ident" id="4105355">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4105369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105373">host</span>&nbsp;<span class="op" id="4105378">=</span>&nbsp;<span class="ident" id="4105380">hostport</span><span class="op" id="4105388">[</span><span class="num" id="4105389">1</span><span class="op" id="4105390">:</span><span class="ident" id="4105391">end</span><span class="op" id="4105394">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105398">j</span><span class="op" id="4105399">,</span>&nbsp;<span class="ident" id="4105401">k</span>&nbsp;<span class="op" id="4105403">=</span>&nbsp;<span class="num" id="4105405">1</span><span class="op" id="4105406">,</span>&nbsp;<span class="ident" id="4105408">end</span><span class="op" id="4105411">+</span><span class="num" id="4105412">1</span>&nbsp;<span class="comment" id="4105414">//&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;[&#39;&nbsp;resp.&nbsp;&#39;]&#39;&nbsp;before&nbsp;these&nbsp;positions</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4105472">}</span>&nbsp;<span class="keyword" id="4105474">else</span>&nbsp;<span class="op" id="4105479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105483">host</span>&nbsp;<span class="op" id="4105488">=</span>&nbsp;<span class="ident" id="4105490">hostport</span><span class="op" id="4105498">[</span><span class="op" id="4105499">:</span><span class="ident" id="4105500">i</span><span class="op" id="4105501">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105505">if</span>&nbsp;<span class="ident" id="4105508">byteIndex</span><span class="op" id="4105517">(</span><span class="ident" id="4105518">host</span><span class="op" id="4105522">,</span>&nbsp;<span class="string" id="4105524">&#39;:&#39;</span><span class="op" id="4105527">)</span>&nbsp;<span class="op" id="4105529">&gt;=</span>&nbsp;<span class="num" id="4105532">0</span>&nbsp;<span class="op" id="4105534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105539">goto</span>&nbsp;<span class="ident" id="4105544">tooManyColons</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4105560">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105564">if</span>&nbsp;<span class="ident" id="4105567">byteIndex</span><span class="op" id="4105576">(</span><span class="ident" id="4105577">host</span><span class="op" id="4105581">,</span>&nbsp;<span class="string" id="4105583">&#39;%&#39;</span><span class="op" id="4105586">)</span>&nbsp;<span class="op" id="4105588">&gt;=</span>&nbsp;<span class="num" id="4105591">0</span>&nbsp;<span class="op" id="4105593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105598">goto</span>&nbsp;<span class="ident" id="4105603">missingBrackets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4105621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4105624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105627">if</span>&nbsp;<span class="ident" id="4105630">byteIndex</span><span class="op" id="4105639">(</span><span class="ident" id="4105640">hostport</span><span class="op" id="4105648">[</span><span class="ident" id="4105649">j</span><span class="op" id="4105650">:</span><span class="op" id="4105651">]</span><span class="op" id="4105652">,</span>&nbsp;<span class="string" id="4105654">&#39;[&#39;</span><span class="op" id="4105657">)</span>&nbsp;<span class="op" id="4105659">&gt;=</span>&nbsp;<span class="num" id="4105662">0</span>&nbsp;<span class="op" id="4105664">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105668">err</span>&nbsp;<span class="op" id="4105672">=</span>&nbsp;<span class="op" id="4105674">&amp;</span><span class="ident" id="4105675">AddrError</span><span class="op" id="4105684">{</span><span class="string" id="4105685">&#34;unexpected&nbsp;&#39;[&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="4105712">,</span>&nbsp;<span class="ident" id="4105714">hostport</span><span class="op" id="4105722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105726">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4105734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105737">if</span>&nbsp;<span class="ident" id="4105740">byteIndex</span><span class="op" id="4105749">(</span><span class="ident" id="4105750">hostport</span><span class="op" id="4105758">[</span><span class="ident" id="4105759">k</span><span class="op" id="4105760">:</span><span class="op" id="4105761">]</span><span class="op" id="4105762">,</span>&nbsp;<span class="string" id="4105764">&#39;]&#39;</span><span class="op" id="4105767">)</span>&nbsp;<span class="op" id="4105769">&gt;=</span>&nbsp;<span class="num" id="4105772">0</span>&nbsp;<span class="op" id="4105774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105778">err</span>&nbsp;<span class="op" id="4105782">=</span>&nbsp;<span class="op" id="4105784">&amp;</span><span class="ident" id="4105785">AddrError</span><span class="op" id="4105794">{</span><span class="string" id="4105795">&#34;unexpected&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="4105822">,</span>&nbsp;<span class="ident" id="4105824">hostport</span><span class="op" id="4105832">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105836">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4105844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105848">port</span>&nbsp;<span class="op" id="4105853">=</span>&nbsp;<span class="ident" id="4105855">hostport</span><span class="op" id="4105863">[</span><span class="ident" id="4105864">i</span><span class="op" id="4105865">+</span><span class="num" id="4105866">1</span><span class="op" id="4105867">:</span><span class="op" id="4105868">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105871">return</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="ident" id="4105879">missingPort</span><span class="op" id="4105890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105893">err</span>&nbsp;<span class="op" id="4105897">=</span>&nbsp;<span class="op" id="4105899">&amp;</span><span class="ident" id="4105900">AddrError</span><span class="op" id="4105909">{</span><span class="string" id="4105910">&#34;missing&nbsp;port&nbsp;in&nbsp;address&#34;</span><span class="op" id="4105935">,</span>&nbsp;<span class="ident" id="4105937">hostport</span><span class="op" id="4105945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105948">return</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="ident" id="4105956">tooManyColons</span><span class="op" id="4105969">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105972">err</span>&nbsp;<span class="op" id="4105976">=</span>&nbsp;<span class="op" id="4105978">&amp;</span><span class="ident" id="4105979">AddrError</span><span class="op" id="4105988">{</span><span class="string" id="4105989">&#34;too&nbsp;many&nbsp;colons&nbsp;in&nbsp;address&#34;</span><span class="op" id="4106017">,</span>&nbsp;<span class="ident" id="4106019">hostport</span><span class="op" id="4106027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106030">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4106038">missingBrackets</span><span class="op" id="4106053">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106056">err</span>&nbsp;<span class="op" id="4106060">=</span>&nbsp;<span class="op" id="4106062">&amp;</span><span class="ident" id="4106063">AddrError</span><span class="op" id="4106072">{</span><span class="string" id="4106073">&#34;missing&nbsp;brackets&nbsp;in&nbsp;address&#34;</span><span class="op" id="4106102">,</span>&nbsp;<span class="ident" id="4106104">hostport</span><span class="op" id="4106112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106115">return</span><br>
<span class="lineno"></span><span class="op" id="4106122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4106125">func</span>&nbsp;<span class="ident" id="4106130">splitHostZone</span><span class="op" id="4106143">(</span><span class="ident" id="4106144">s</span>&nbsp;<span class="builtintype" id="4106146">string</span><span class="op" id="4106152">)</span>&nbsp;<span class="op" id="4106154">(</span><span class="ident" id="4106155">host</span><span class="op" id="4106159">,</span>&nbsp;<span class="ident" id="4106161">zone</span>&nbsp;<span class="builtintype" id="4106166">string</span><span class="op" id="4106172">)</span>&nbsp;<span class="op" id="4106174">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4106177">//&nbsp;The&nbsp;IPv6&nbsp;scoped&nbsp;addressing&nbsp;zone&nbsp;identifier&nbsp;starts&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4106241">//&nbsp;last&nbsp;percent&nbsp;sign.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106264">if</span>&nbsp;<span class="ident" id="4106267">i</span>&nbsp;<span class="op" id="4106269">:=</span>&nbsp;<span class="ident" id="4106272">last</span><span class="op" id="4106276">(</span><span class="ident" id="4106277">s</span><span class="op" id="4106278">,</span>&nbsp;<span class="string" id="4106280">&#39;%&#39;</span><span class="op" id="4106283">)</span><span class="op" id="4106284">;</span>&nbsp;<span class="ident" id="4106286">i</span>&nbsp;<span class="op" id="4106288">&gt;</span>&nbsp;<span class="num" id="4106290">0</span>&nbsp;<span class="op" id="4106292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106296">host</span><span class="op" id="4106300">,</span>&nbsp;<span class="ident" id="4106302">zone</span>&nbsp;<span class="op" id="4106307">=</span>&nbsp;<span class="ident" id="4106309">s</span><span class="op" id="4106310">[</span><span class="op" id="4106311">:</span><span class="ident" id="4106312">i</span><span class="op" id="4106313">]</span><span class="op" id="4106314">,</span>&nbsp;<span class="ident" id="4106316">s</span><span class="op" id="4106317">[</span><span class="ident" id="4106318">i</span><span class="op" id="4106319">+</span><span class="num" id="4106320">1</span><span class="op" id="4106321">:</span><span class="op" id="4106322">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106325">}</span>&nbsp;<span class="keyword" id="4106327">else</span>&nbsp;<span class="op" id="4106332">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106336">host</span>&nbsp;<span class="op" id="4106341">=</span>&nbsp;<span class="ident" id="4106343">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106349">return</span><br>
<span class="lineno"></span><span class="op" id="4106356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="4106359">//&nbsp;JoinHostPort&nbsp;combines&nbsp;host&nbsp;and&nbsp;port&nbsp;into&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4106428">//&nbsp;form&nbsp;&#34;host:port&#34;&nbsp;or,&nbsp;if&nbsp;host&nbsp;contains&nbsp;a&nbsp;colon&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,</span><br>
<span class="lineno"></span><span class="comment" id="4106496">//&nbsp;&#34;[host]:port&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4106514">func</span>&nbsp;<span class="ident" id="4106519">JoinHostPort</span><span class="op" id="4106531">(</span><span class="ident" id="4106532">host</span><span class="op" id="4106536">,</span>&nbsp;<span class="ident" id="4106538">port</span>&nbsp;<span class="builtintype" id="4106543">string</span><span class="op" id="4106549">)</span>&nbsp;<span class="builtintype" id="4106551">string</span>&nbsp;<span class="op" id="4106558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4106561">//&nbsp;If&nbsp;host&nbsp;has&nbsp;colons&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,&nbsp;have&nbsp;to&nbsp;bracket&nbsp;it.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106623">if</span>&nbsp;<span class="ident" id="4106626">byteIndex</span><span class="op" id="4106635">(</span><span class="ident" id="4106636">host</span><span class="op" id="4106640">,</span>&nbsp;<span class="string" id="4106642">&#39;:&#39;</span><span class="op" id="4106645">)</span>&nbsp;<span class="op" id="4106647">&gt;=</span>&nbsp;<span class="num" id="4106650">0</span>&nbsp;<span class="op" id="4106652">||</span>&nbsp;<span class="ident" id="4106655">byteIndex</span><span class="op" id="4106664">(</span><span class="ident" id="4106665">host</span><span class="op" id="4106669">,</span>&nbsp;<span class="string" id="4106671">&#39;%&#39;</span><span class="op" id="4106674">)</span>&nbsp;<span class="op" id="4106676">&gt;=</span>&nbsp;<span class="num" id="4106679">0</span>&nbsp;<span class="op" id="4106681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106685">return</span>&nbsp;<span class="string" id="4106692">&#34;[&#34;</span>&nbsp;<span class="op" id="4106696">+</span>&nbsp;<span class="ident" id="4106698">host</span>&nbsp;<span class="op" id="4106703">+</span>&nbsp;<span class="string" id="4106705">&#34;]:&#34;</span>&nbsp;<span class="op" id="4106710">+</span>&nbsp;<span class="ident" id="4106712">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106721">return</span>&nbsp;<span class="ident" id="4106728">host</span>&nbsp;<span class="op" id="4106733">+</span>&nbsp;<span class="string" id="4106735">&#34;:&#34;</span>&nbsp;<span class="op" id="4106739">+</span>&nbsp;<span class="ident" id="4106741">port</span><br>
<span class="lineno"></span><span class="op" id="4106746">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="4106749">//&nbsp;resolveInternetAddr&nbsp;resolves&nbsp;addr&nbsp;that&nbsp;is&nbsp;either&nbsp;a&nbsp;literal&nbsp;IP</span><br>
<span class="lineno"></span><span class="comment" id="4106814">//&nbsp;address&nbsp;or&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;returns&nbsp;an&nbsp;internet&nbsp;protocol&nbsp;family</span><br>
<span class="lineno"></span><span class="comment" id="4106879">//&nbsp;address.&nbsp;It&nbsp;returns&nbsp;a&nbsp;list&nbsp;that&nbsp;contains&nbsp;a&nbsp;pair&nbsp;of&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="4106943">//&nbsp;address&nbsp;family&nbsp;addresses&nbsp;when&nbsp;addr&nbsp;is&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;the&nbsp;name&nbsp;has</span><br>
<span class="lineno">235</span><span class="comment" id="4107012">//&nbsp;multiple&nbsp;address&nbsp;family&nbsp;records.&nbsp;The&nbsp;result&nbsp;contains&nbsp;at&nbsp;least&nbsp;one</span><br>
<span class="lineno"></span><span class="comment" id="4107081">//&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4107111">func</span>&nbsp;<span class="ident" id="4107116">resolveInternetAddr</span><span class="op" id="4107135">(</span><span class="ident" id="4107136">net</span><span class="op" id="4107139">,</span>&nbsp;<span class="ident" id="4107141">addr</span>&nbsp;<span class="builtintype" id="4107146">string</span><span class="op" id="4107152">,</span>&nbsp;<span class="ident" id="4107154">deadline</span>&nbsp;<span class="ident" id="4107163">time</span><span class="op" id="4107167">.</span><span class="ident" id="4107168">Time</span><span class="op" id="4107172">)</span>&nbsp;<span class="op" id="4107174">(</span><span class="ident" id="4107175">netaddr</span><span class="op" id="4107182">,</span>&nbsp;<span class="builtintype" id="4107184">error</span><span class="op" id="4107189">)</span>&nbsp;<span class="op" id="4107191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107194">var</span>&nbsp;<span class="op" id="4107198">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107202">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4107219">error</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107227">host</span><span class="op" id="4107231">,</span>&nbsp;<span class="ident" id="4107233">port</span><span class="op" id="4107237">,</span>&nbsp;<span class="ident" id="4107239">zone</span>&nbsp;<span class="builtintype" id="4107244">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107253">portnum</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4107270">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107278">switch</span>&nbsp;<span class="ident" id="4107285">net</span>&nbsp;<span class="op" id="4107289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107292">case</span>&nbsp;<span class="string" id="4107297">&#34;tcp&#34;</span><span class="op" id="4107302">,</span>&nbsp;<span class="string" id="4107304">&#34;tcp4&#34;</span><span class="op" id="4107310">,</span>&nbsp;<span class="string" id="4107312">&#34;tcp6&#34;</span><span class="op" id="4107318">,</span>&nbsp;<span class="string" id="4107320">&#34;udp&#34;</span><span class="op" id="4107325">,</span>&nbsp;<span class="string" id="4107327">&#34;udp4&#34;</span><span class="op" id="4107333">,</span>&nbsp;<span class="string" id="4107335">&#34;udp6&#34;</span><span class="op" id="4107341">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107345">if</span>&nbsp;<span class="ident" id="4107348">addr</span>&nbsp;<span class="op" id="4107353">!=</span>&nbsp;<span class="string" id="4107356">&#34;&#34;</span>&nbsp;<span class="op" id="4107359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107364">if</span>&nbsp;<span class="ident" id="4107367">host</span><span class="op" id="4107371">,</span>&nbsp;<span class="ident" id="4107373">port</span><span class="op" id="4107377">,</span>&nbsp;<span class="ident" id="4107379">err</span>&nbsp;<span class="op" id="4107383">=</span>&nbsp;<span class="ident" id="4107385">SplitHostPort</span><span class="op" id="4107398">(</span><span class="ident" id="4107399">addr</span><span class="op" id="4107403">)</span><span class="op" id="4107404">;</span>&nbsp;<span class="ident" id="4107406">err</span>&nbsp;<span class="op" id="4107410">!=</span>&nbsp;<span class="ident" id="4107413">nil</span>&nbsp;<span class="op" id="4107417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107423">return</span>&nbsp;<span class="ident" id="4107430">nil</span><span class="op" id="4107433">,</span>&nbsp;<span class="ident" id="4107435">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107447">if</span>&nbsp;<span class="ident" id="4107450">portnum</span><span class="op" id="4107457">,</span>&nbsp;<span class="ident" id="4107459">err</span>&nbsp;<span class="op" id="4107463">=</span>&nbsp;<span class="ident" id="4107465">parsePort</span><span class="op" id="4107474">(</span><span class="ident" id="4107475">net</span><span class="op" id="4107478">,</span>&nbsp;<span class="ident" id="4107480">port</span><span class="op" id="4107484">)</span><span class="op" id="4107485">;</span>&nbsp;<span class="ident" id="4107487">err</span>&nbsp;<span class="op" id="4107491">!=</span>&nbsp;<span class="ident" id="4107494">nil</span>&nbsp;<span class="op" id="4107498">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107504">return</span>&nbsp;<span class="ident" id="4107511">nil</span><span class="op" id="4107514">,</span>&nbsp;<span class="ident" id="4107516">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107530">case</span>&nbsp;<span class="string" id="4107535">&#34;ip&#34;</span><span class="op" id="4107539">,</span>&nbsp;<span class="string" id="4107541">&#34;ip4&#34;</span><span class="op" id="4107546">,</span>&nbsp;<span class="string" id="4107548">&#34;ip6&#34;</span><span class="op" id="4107553">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107557">if</span>&nbsp;<span class="ident" id="4107560">addr</span>&nbsp;<span class="op" id="4107565">!=</span>&nbsp;<span class="string" id="4107568">&#34;&#34;</span>&nbsp;<span class="op" id="4107571">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107576">host</span>&nbsp;<span class="op" id="4107581">=</span>&nbsp;<span class="ident" id="4107583">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107593">default</span><span class="op" id="4107600">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107604">return</span>&nbsp;<span class="ident" id="4107611">nil</span><span class="op" id="4107614">,</span>&nbsp;<span class="ident" id="4107616">UnknownNetworkError</span><span class="op" id="4107635">(</span><span class="ident" id="4107636">net</span><span class="op" id="4107639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107642">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107645">inetaddr</span>&nbsp;<span class="op" id="4107654">:=</span>&nbsp;<span class="keyword" id="4107657">func</span><span class="op" id="4107661">(</span><span class="ident" id="4107662">ip</span>&nbsp;<span class="ident" id="4107665">IP</span><span class="op" id="4107667">)</span>&nbsp;<span class="ident" id="4107669">netaddr</span>&nbsp;<span class="op" id="4107677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107681">switch</span>&nbsp;<span class="ident" id="4107688">net</span>&nbsp;<span class="op" id="4107692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107696">case</span>&nbsp;<span class="string" id="4107701">&#34;tcp&#34;</span><span class="op" id="4107706">,</span>&nbsp;<span class="string" id="4107708">&#34;tcp4&#34;</span><span class="op" id="4107714">,</span>&nbsp;<span class="string" id="4107716">&#34;tcp6&#34;</span><span class="op" id="4107722">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107727">return</span>&nbsp;<span class="op" id="4107734">&amp;</span><span class="ident" id="4107735">TCPAddr</span><span class="op" id="4107742">{</span><span class="ident" id="4107743">IP</span><span class="op" id="4107745">:</span>&nbsp;<span class="ident" id="4107747">ip</span><span class="op" id="4107749">,</span>&nbsp;<span class="ident" id="4107751">Port</span><span class="op" id="4107755">:</span>&nbsp;<span class="ident" id="4107757">portnum</span><span class="op" id="4107764">,</span>&nbsp;<span class="ident" id="4107766">Zone</span><span class="op" id="4107770">:</span>&nbsp;<span class="ident" id="4107772">zone</span><span class="op" id="4107776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107780">case</span>&nbsp;<span class="string" id="4107785">&#34;udp&#34;</span><span class="op" id="4107790">,</span>&nbsp;<span class="string" id="4107792">&#34;udp4&#34;</span><span class="op" id="4107798">,</span>&nbsp;<span class="string" id="4107800">&#34;udp6&#34;</span><span class="op" id="4107806">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107811">return</span>&nbsp;<span class="op" id="4107818">&amp;</span><span class="ident" id="4107819">UDPAddr</span><span class="op" id="4107826">{</span><span class="ident" id="4107827">IP</span><span class="op" id="4107829">:</span>&nbsp;<span class="ident" id="4107831">ip</span><span class="op" id="4107833">,</span>&nbsp;<span class="ident" id="4107835">Port</span><span class="op" id="4107839">:</span>&nbsp;<span class="ident" id="4107841">portnum</span><span class="op" id="4107848">,</span>&nbsp;<span class="ident" id="4107850">Zone</span><span class="op" id="4107854">:</span>&nbsp;<span class="ident" id="4107856">zone</span><span class="op" id="4107860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107864">case</span>&nbsp;<span class="string" id="4107869">&#34;ip&#34;</span><span class="op" id="4107873">,</span>&nbsp;<span class="string" id="4107875">&#34;ip4&#34;</span><span class="op" id="4107880">,</span>&nbsp;<span class="string" id="4107882">&#34;ip6&#34;</span><span class="op" id="4107887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107892">return</span>&nbsp;<span class="op" id="4107899">&amp;</span><span class="ident" id="4107900">IPAddr</span><span class="op" id="4107906">{</span><span class="ident" id="4107907">IP</span><span class="op" id="4107909">:</span>&nbsp;<span class="ident" id="4107911">ip</span><span class="op" id="4107913">,</span>&nbsp;<span class="ident" id="4107915">Zone</span><span class="op" id="4107919">:</span>&nbsp;<span class="ident" id="4107921">zone</span><span class="op" id="4107925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107929">default</span><span class="op" id="4107936">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4107941">panic</span><span class="op" id="4107946">(</span><span class="string" id="4107947">&#34;unexpected&nbsp;network:&nbsp;&#34;</span>&nbsp;<span class="op" id="4107970">+</span>&nbsp;<span class="ident" id="4107972">net</span><span class="op" id="4107975">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107985">if</span>&nbsp;<span class="ident" id="4107988">host</span>&nbsp;<span class="op" id="4107993">==</span>&nbsp;<span class="string" id="4107996">&#34;&#34;</span>&nbsp;<span class="op" id="4107999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108003">return</span>&nbsp;<span class="ident" id="4108010">inetaddr</span><span class="op" id="4108018">(</span><span class="ident" id="4108019">nil</span><span class="op" id="4108022">)</span><span class="op" id="4108023">,</span>&nbsp;<span class="ident" id="4108025">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108030">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108033">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108066">var</span>&nbsp;<span class="ident" id="4108070">ip</span>&nbsp;<span class="ident" id="4108073">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108077">if</span>&nbsp;<span class="ident" id="4108080">ip</span>&nbsp;<span class="op" id="4108083">=</span>&nbsp;<span class="ident" id="4108085">parseIPv4</span><span class="op" id="4108094">(</span><span class="ident" id="4108095">host</span><span class="op" id="4108099">)</span><span class="op" id="4108100">;</span>&nbsp;<span class="ident" id="4108102">ip</span>&nbsp;<span class="op" id="4108105">!=</span>&nbsp;<span class="ident" id="4108108">nil</span>&nbsp;<span class="op" id="4108112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108116">return</span>&nbsp;<span class="ident" id="4108123">inetaddr</span><span class="op" id="4108131">(</span><span class="ident" id="4108132">ip</span><span class="op" id="4108134">)</span><span class="op" id="4108135">,</span>&nbsp;<span class="ident" id="4108137">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108142">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108145">if</span>&nbsp;<span class="ident" id="4108148">ip</span><span class="op" id="4108150">,</span>&nbsp;<span class="ident" id="4108152">zone</span>&nbsp;<span class="op" id="4108157">=</span>&nbsp;<span class="ident" id="4108159">parseIPv6</span><span class="op" id="4108168">(</span><span class="ident" id="4108169">host</span><span class="op" id="4108173">,</span>&nbsp;<span class="builtintype" id="4108175">true</span><span class="op" id="4108179">)</span><span class="op" id="4108180">;</span>&nbsp;<span class="ident" id="4108182">ip</span>&nbsp;<span class="op" id="4108185">!=</span>&nbsp;<span class="ident" id="4108188">nil</span>&nbsp;<span class="op" id="4108192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108196">return</span>&nbsp;<span class="ident" id="4108203">inetaddr</span><span class="op" id="4108211">(</span><span class="ident" id="4108212">ip</span><span class="op" id="4108214">)</span><span class="op" id="4108215">,</span>&nbsp;<span class="ident" id="4108217">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108225">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;DNS&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108248">host</span><span class="op" id="4108252">,</span>&nbsp;<span class="ident" id="4108254">zone</span>&nbsp;<span class="op" id="4108259">=</span>&nbsp;<span class="ident" id="4108261">splitHostZone</span><span class="op" id="4108274">(</span><span class="ident" id="4108275">host</span><span class="op" id="4108279">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108282">ips</span><span class="op" id="4108285">,</span>&nbsp;<span class="ident" id="4108287">err</span>&nbsp;<span class="op" id="4108291">:=</span>&nbsp;<span class="ident" id="4108294">lookupIPDeadline</span><span class="op" id="4108310">(</span><span class="ident" id="4108311">host</span><span class="op" id="4108315">,</span>&nbsp;<span class="ident" id="4108317">deadline</span><span class="op" id="4108325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108328">if</span>&nbsp;<span class="ident" id="4108331">err</span>&nbsp;<span class="op" id="4108335">!=</span>&nbsp;<span class="ident" id="4108338">nil</span>&nbsp;<span class="op" id="4108342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108346">return</span>&nbsp;<span class="ident" id="4108353">nil</span><span class="op" id="4108356">,</span>&nbsp;<span class="ident" id="4108358">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108366">var</span>&nbsp;<span class="ident" id="4108370">filter</span>&nbsp;<span class="keyword" id="4108377">func</span><span class="op" id="4108381">(</span><span class="ident" id="4108382">IP</span><span class="op" id="4108384">)</span>&nbsp;<span class="ident" id="4108386">IP</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108390">if</span>&nbsp;<span class="ident" id="4108393">net</span>&nbsp;<span class="op" id="4108397">!=</span>&nbsp;<span class="string" id="4108400">&#34;&#34;</span>&nbsp;<span class="op" id="4108403">&amp;&amp;</span>&nbsp;<span class="ident" id="4108406">net</span><span class="op" id="4108409">[</span><span class="builtinfunc" id="4108410">len</span><span class="op" id="4108413">(</span><span class="ident" id="4108414">net</span><span class="op" id="4108417">)</span><span class="op" id="4108418">-</span><span class="num" id="4108419">1</span><span class="op" id="4108420">]</span>&nbsp;<span class="op" id="4108422">==</span>&nbsp;<span class="string" id="4108425">&#39;4&#39;</span>&nbsp;<span class="op" id="4108429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108433">filter</span>&nbsp;<span class="op" id="4108440">=</span>&nbsp;<span class="ident" id="4108442">ipv4only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108455">if</span>&nbsp;<span class="ident" id="4108458">net</span>&nbsp;<span class="op" id="4108462">!=</span>&nbsp;<span class="string" id="4108465">&#34;&#34;</span>&nbsp;<span class="op" id="4108468">&amp;&amp;</span>&nbsp;<span class="ident" id="4108471">net</span><span class="op" id="4108474">[</span><span class="builtinfunc" id="4108475">len</span><span class="op" id="4108478">(</span><span class="ident" id="4108479">net</span><span class="op" id="4108482">)</span><span class="op" id="4108483">-</span><span class="num" id="4108484">1</span><span class="op" id="4108485">]</span>&nbsp;<span class="op" id="4108487">==</span>&nbsp;<span class="string" id="4108490">&#39;6&#39;</span>&nbsp;<span class="op" id="4108494">||</span>&nbsp;<span class="ident" id="4108497">zone</span>&nbsp;<span class="op" id="4108502">!=</span>&nbsp;<span class="string" id="4108505">&#34;&#34;</span>&nbsp;<span class="op" id="4108508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108512">filter</span>&nbsp;<span class="op" id="4108519">=</span>&nbsp;<span class="ident" id="4108521">ipv6only</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108534">return</span>&nbsp;<span class="ident" id="4108541">firstFavoriteAddr</span><span class="op" id="4108558">(</span><span class="ident" id="4108559">filter</span><span class="op" id="4108565">,</span>&nbsp;<span class="ident" id="4108567">ips</span><span class="op" id="4108570">,</span>&nbsp;<span class="ident" id="4108572">inetaddr</span><span class="op" id="4108580">)</span><br>
<span class="lineno"></span><span class="op" id="4108582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4108585">func</span>&nbsp;<span class="ident" id="4108590">zoneToString</span><span class="op" id="4108602">(</span><span class="ident" id="4108603">zone</span>&nbsp;<span class="builtintype" id="4108608">int</span><span class="op" id="4108611">)</span>&nbsp;<span class="builtintype" id="4108613">string</span>&nbsp;<span class="op" id="4108620">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108623">if</span>&nbsp;<span class="ident" id="4108626">zone</span>&nbsp;<span class="op" id="4108631">==</span>&nbsp;<span class="num" id="4108634">0</span>&nbsp;<span class="op" id="4108636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108640">return</span>&nbsp;<span class="string" id="4108647">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108654">if</span>&nbsp;<span class="ident" id="4108657">ifi</span><span class="op" id="4108660">,</span>&nbsp;<span class="ident" id="4108662">err</span>&nbsp;<span class="op" id="4108666">:=</span>&nbsp;<span class="ident" id="4108669">InterfaceByIndex</span><span class="op" id="4108685">(</span><span class="ident" id="4108686">zone</span><span class="op" id="4108690">)</span><span class="op" id="4108691">;</span>&nbsp;<span class="ident" id="4108693">err</span>&nbsp;<span class="op" id="4108697">==</span>&nbsp;<span class="ident" id="4108700">nil</span>&nbsp;<span class="op" id="4108704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108708">return</span>&nbsp;<span class="ident" id="4108715">ifi</span><span class="op" id="4108718">.</span><span class="ident" id="4108719">Name</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108728">return</span>&nbsp;<span class="ident" id="4108735">itod</span><span class="op" id="4108739">(</span><span class="builtintype" id="4108740">uint</span><span class="op" id="4108744">(</span><span class="ident" id="4108745">zone</span><span class="op" id="4108749">)</span><span class="op" id="4108750">)</span><br>
<span class="lineno"></span><span class="op" id="4108752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4108755">func</span>&nbsp;<span class="ident" id="4108760">zoneToInt</span><span class="op" id="4108769">(</span><span class="ident" id="4108770">zone</span>&nbsp;<span class="builtintype" id="4108775">string</span><span class="op" id="4108781">)</span>&nbsp;<span class="builtintype" id="4108783">int</span>&nbsp;<span class="op" id="4108787">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108790">if</span>&nbsp;<span class="ident" id="4108793">zone</span>&nbsp;<span class="op" id="4108798">==</span>&nbsp;<span class="string" id="4108801">&#34;&#34;</span>&nbsp;<span class="op" id="4108804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108808">return</span>&nbsp;<span class="num" id="4108815">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108821">if</span>&nbsp;<span class="ident" id="4108824">ifi</span><span class="op" id="4108827">,</span>&nbsp;<span class="ident" id="4108829">err</span>&nbsp;<span class="op" id="4108833">:=</span>&nbsp;<span class="ident" id="4108836">InterfaceByName</span><span class="op" id="4108851">(</span><span class="ident" id="4108852">zone</span><span class="op" id="4108856">)</span><span class="op" id="4108857">;</span>&nbsp;<span class="ident" id="4108859">err</span>&nbsp;<span class="op" id="4108863">==</span>&nbsp;<span class="ident" id="4108866">nil</span>&nbsp;<span class="op" id="4108870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108874">return</span>&nbsp;<span class="ident" id="4108881">ifi</span><span class="op" id="4108884">.</span><span class="ident" id="4108885">Index</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108895">n</span><span class="op" id="4108896">,</span>&nbsp;<span class="ident" id="4108898">_</span><span class="op" id="4108899">,</span>&nbsp;<span class="ident" id="4108901">_</span>&nbsp;<span class="op" id="4108903">:=</span>&nbsp;<span class="ident" id="4108906">dtoi</span><span class="op" id="4108910">(</span><span class="ident" id="4108911">zone</span><span class="op" id="4108915">,</span>&nbsp;<span class="num" id="4108917">0</span><span class="op" id="4108918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108921">return</span>&nbsp;<span class="ident" id="4108928">n</span><br>
<span class="lineno"></span><span class="op" id="4108930">}</span>
</div>
</body>
</html>
