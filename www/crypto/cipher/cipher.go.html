<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3840478">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3840533">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3840587">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3840638">//&nbsp;Package&nbsp;cipher&nbsp;implements&nbsp;standard&nbsp;block&nbsp;cipher&nbsp;modes&nbsp;that&nbsp;can&nbsp;be&nbsp;wrapped</span><br>
<span class="lineno"></span><span class="comment" id="3840715">//&nbsp;around&nbsp;low-level&nbsp;block&nbsp;cipher&nbsp;implementations.</span><br>
<span class="lineno"></span><span class="comment" id="3840765">//&nbsp;See&nbsp;http://csrc.nist.gov/groups/ST/toolkit/BCM/current_modes.html</span><br>
<span class="lineno"></span><span class="comment" id="3840834">//&nbsp;and&nbsp;NIST&nbsp;Special&nbsp;Publication&nbsp;800-38A.</span><br>
<span class="lineno"></span><span class="keyword" id="3840875">package</span>&nbsp;<span class="ident" id="3840883">cipher</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="3840891">//&nbsp;A&nbsp;Block&nbsp;represents&nbsp;an&nbsp;implementation&nbsp;of&nbsp;block&nbsp;cipher</span><br>
<span class="lineno"></span><span class="comment" id="3840947">//&nbsp;using&nbsp;a&nbsp;given&nbsp;key.&nbsp;&nbsp;It&nbsp;provides&nbsp;the&nbsp;capability&nbsp;to&nbsp;encrypt</span><br>
<span class="lineno"></span><span class="comment" id="3841008">//&nbsp;or&nbsp;decrypt&nbsp;individual&nbsp;blocks.&nbsp;&nbsp;The&nbsp;mode&nbsp;implementations</span><br>
<span class="lineno"></span><span class="comment" id="3841067">//&nbsp;extend&nbsp;that&nbsp;capability&nbsp;to&nbsp;streams&nbsp;of&nbsp;blocks.</span><br>
<span class="lineno">15</span><span class="keyword" id="3841115">type</span>&nbsp;<span class="ident" id="3841120">Block</span>&nbsp;<span class="keyword" id="3841126">interface</span>&nbsp;<span class="op" id="3841136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3841139">//&nbsp;BlockSize&nbsp;returns&nbsp;the&nbsp;cipher&#39;s&nbsp;block&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3841186">BlockSize</span><span class="op" id="3841195">(</span><span class="op" id="3841196">)</span>&nbsp;<span class="builtintype" id="3841198">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3841204">//&nbsp;Encrypt&nbsp;encrypts&nbsp;the&nbsp;first&nbsp;block&nbsp;in&nbsp;src&nbsp;into&nbsp;dst.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3841258">//&nbsp;Dst&nbsp;and&nbsp;src&nbsp;may&nbsp;point&nbsp;at&nbsp;the&nbsp;same&nbsp;memory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3841304">Encrypt</span><span class="op" id="3841311">(</span><span class="ident" id="3841312">dst</span><span class="op" id="3841315">,</span>&nbsp;<span class="ident" id="3841317">src</span>&nbsp;<span class="op" id="3841321">[</span><span class="op" id="3841322">]</span><span class="builtintype" id="3841323">byte</span><span class="op" id="3841327">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3841331">//&nbsp;Decrypt&nbsp;decrypts&nbsp;the&nbsp;first&nbsp;block&nbsp;in&nbsp;src&nbsp;into&nbsp;dst.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3841385">//&nbsp;Dst&nbsp;and&nbsp;src&nbsp;may&nbsp;point&nbsp;at&nbsp;the&nbsp;same&nbsp;memory.</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3841431">Decrypt</span><span class="op" id="3841438">(</span><span class="ident" id="3841439">dst</span><span class="op" id="3841442">,</span>&nbsp;<span class="ident" id="3841444">src</span>&nbsp;<span class="op" id="3841448">[</span><span class="op" id="3841449">]</span><span class="builtintype" id="3841450">byte</span><span class="op" id="3841454">)</span><br>
<span class="lineno"></span><span class="op" id="3841456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3841459">//&nbsp;A&nbsp;Stream&nbsp;represents&nbsp;a&nbsp;stream&nbsp;cipher.</span><br>
<span class="lineno"></span><span class="keyword" id="3841499">type</span>&nbsp;<span class="ident" id="3841504">Stream</span>&nbsp;<span class="keyword" id="3841511">interface</span>&nbsp;<span class="op" id="3841521">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3841524">//&nbsp;XORKeyStream&nbsp;XORs&nbsp;each&nbsp;byte&nbsp;in&nbsp;the&nbsp;given&nbsp;slice&nbsp;with&nbsp;a&nbsp;byte&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3841596">//&nbsp;cipher&#39;s&nbsp;key&nbsp;stream.&nbsp;Dst&nbsp;and&nbsp;src&nbsp;may&nbsp;point&nbsp;to&nbsp;the&nbsp;same&nbsp;memory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3841663">XORKeyStream</span><span class="op" id="3841675">(</span><span class="ident" id="3841676">dst</span><span class="op" id="3841679">,</span>&nbsp;<span class="ident" id="3841681">src</span>&nbsp;<span class="op" id="3841685">[</span><span class="op" id="3841686">]</span><span class="builtintype" id="3841687">byte</span><span class="op" id="3841691">)</span><br>
<span class="lineno"></span><span class="op" id="3841693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3841696">//&nbsp;A&nbsp;BlockMode&nbsp;represents&nbsp;a&nbsp;block&nbsp;cipher&nbsp;running&nbsp;in&nbsp;a&nbsp;block-based&nbsp;mode&nbsp;(CBC,</span><br>
<span class="lineno"></span><span class="comment" id="3841773">//&nbsp;ECB&nbsp;etc).</span><br>
<span class="lineno"></span><span class="keyword" id="3841786">type</span>&nbsp;<span class="ident" id="3841791">BlockMode</span>&nbsp;<span class="keyword" id="3841801">interface</span>&nbsp;<span class="op" id="3841811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3841814">//&nbsp;BlockSize&nbsp;returns&nbsp;the&nbsp;mode&#39;s&nbsp;block&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3841859">BlockSize</span><span class="op" id="3841868">(</span><span class="op" id="3841869">)</span>&nbsp;<span class="builtintype" id="3841871">int</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3841877">//&nbsp;CryptBlocks&nbsp;encrypts&nbsp;or&nbsp;decrypts&nbsp;a&nbsp;number&nbsp;of&nbsp;blocks.&nbsp;The&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3841948">//&nbsp;src&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;the&nbsp;block&nbsp;size.&nbsp;Dst&nbsp;and&nbsp;src&nbsp;may&nbsp;point&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3842019">//&nbsp;the&nbsp;same&nbsp;memory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842040">CryptBlocks</span><span class="op" id="3842051">(</span><span class="ident" id="3842052">dst</span><span class="op" id="3842055">,</span>&nbsp;<span class="ident" id="3842057">src</span>&nbsp;<span class="op" id="3842061">[</span><span class="op" id="3842062">]</span><span class="builtintype" id="3842063">byte</span><span class="op" id="3842067">)</span><br>
<span class="lineno">45</span><span class="op" id="3842069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3842072">//&nbsp;Utility&nbsp;routines</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3842093">func</span>&nbsp;<span class="ident" id="3842098">dup</span><span class="op" id="3842101">(</span><span class="ident" id="3842102">p</span>&nbsp;<span class="op" id="3842104">[</span><span class="op" id="3842105">]</span><span class="builtintype" id="3842106">byte</span><span class="op" id="3842110">)</span>&nbsp;<span class="op" id="3842112">[</span><span class="op" id="3842113">]</span><span class="builtintype" id="3842114">byte</span>&nbsp;<span class="op" id="3842119">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842122">q</span>&nbsp;<span class="op" id="3842124">:=</span>&nbsp;<span class="builtinfunc" id="3842127">make</span><span class="op" id="3842131">(</span><span class="op" id="3842132">[</span><span class="op" id="3842133">]</span><span class="builtintype" id="3842134">byte</span><span class="op" id="3842138">,</span>&nbsp;<span class="builtinfunc" id="3842140">len</span><span class="op" id="3842143">(</span><span class="ident" id="3842144">p</span><span class="op" id="3842145">)</span><span class="op" id="3842146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3842149">copy</span><span class="op" id="3842153">(</span><span class="ident" id="3842154">q</span><span class="op" id="3842155">,</span>&nbsp;<span class="ident" id="3842157">p</span><span class="op" id="3842158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3842161">return</span>&nbsp;<span class="ident" id="3842168">q</span><br>
<span class="lineno"></span><span class="op" id="3842170">}</span>
</div>
</body>
</html>
