<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime</h2>
<ul>
<li><a href="/gostd/mime/grammar.go.html">grammar.go</a></li>
<li><a href="/gostd/mime/mediatype.go.html" class="current">mediatype.go</a></li>
<li><a href="/gostd/mime/mediatype_test.go.html">mediatype_test.go</a></li>
<li><a href="/gostd/mime/type.go.html">type.go</a></li>
<li><a href="/gostd/mime/type_test.go.html">type_test.go</a></li>
<li><a href="/gostd/mime/type_unix.go.html">type_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1330364">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1330419">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1330473">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1330524">package</span>&nbsp;<span class="ident" id="1330532">mime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1330538">import</span>&nbsp;<span class="op" id="1330545">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1330548">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1330557">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1330567">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1330574">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1330582">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1330593">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="1330603">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="1330606">//&nbsp;FormatMediaType&nbsp;serializes&nbsp;mediatype&nbsp;t&nbsp;and&nbsp;the&nbsp;parameters</span><br>
<span class="lineno"></span><span class="comment" id="1330667">//&nbsp;param&nbsp;as&nbsp;a&nbsp;media&nbsp;type&nbsp;conforming&nbsp;to&nbsp;RFC&nbsp;2045&nbsp;and&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="1330729">//&nbsp;The&nbsp;type&nbsp;and&nbsp;parameter&nbsp;names&nbsp;are&nbsp;written&nbsp;in&nbsp;lower-case.</span><br>
<span class="lineno"></span><span class="comment" id="1330788">//&nbsp;When&nbsp;any&nbsp;of&nbsp;the&nbsp;arguments&nbsp;result&nbsp;in&nbsp;a&nbsp;standard&nbsp;violation&nbsp;then</span><br>
<span class="lineno">20</span><span class="comment" id="1330853">//&nbsp;FormatMediaType&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1330898">func</span>&nbsp;<span class="ident" id="1330903">FormatMediaType</span><span class="op" id="1330918">(</span><span class="ident" id="1330919">t</span>&nbsp;<span class="builtintype" id="1330921">string</span><span class="op" id="1330927">,</span>&nbsp;<span class="ident" id="1330929">param</span>&nbsp;<span class="keyword" id="1330935">map</span><span class="op" id="1330938">[</span><span class="builtintype" id="1330939">string</span><span class="op" id="1330945">]</span><span class="builtintype" id="1330946">string</span><span class="op" id="1330952">)</span>&nbsp;<span class="builtintype" id="1330954">string</span>&nbsp;<span class="op" id="1330961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1330964">slash</span>&nbsp;<span class="op" id="1330970">:=</span>&nbsp;<span class="ident" id="1330973">strings</span><span class="op" id="1330980">.</span><span class="ident" id="1330981">Index</span><span class="op" id="1330986">(</span><span class="ident" id="1330987">t</span><span class="op" id="1330988">,</span>&nbsp;<span class="string" id="1330990">&#34;/&#34;</span><span class="op" id="1330993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1330996">if</span>&nbsp;<span class="ident" id="1330999">slash</span>&nbsp;<span class="op" id="1331005">==</span>&nbsp;<span class="op" id="1331008">-</span><span class="num" id="1331009">1</span>&nbsp;<span class="op" id="1331011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331015">return</span>&nbsp;<span class="string" id="1331022">&#34;&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1331026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331029">major</span><span class="op" id="1331034">,</span>&nbsp;<span class="ident" id="1331036">sub</span>&nbsp;<span class="op" id="1331040">:=</span>&nbsp;<span class="ident" id="1331043">t</span><span class="op" id="1331044">[</span><span class="op" id="1331045">:</span><span class="ident" id="1331046">slash</span><span class="op" id="1331051">]</span><span class="op" id="1331052">,</span>&nbsp;<span class="ident" id="1331054">t</span><span class="op" id="1331055">[</span><span class="ident" id="1331056">slash</span><span class="op" id="1331061">+</span><span class="num" id="1331062">1</span><span class="op" id="1331063">:</span><span class="op" id="1331064">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331067">if</span>&nbsp;<span class="op" id="1331070">!</span><span class="ident" id="1331071">isToken</span><span class="op" id="1331078">(</span><span class="ident" id="1331079">major</span><span class="op" id="1331084">)</span>&nbsp;<span class="op" id="1331086">||</span>&nbsp;<span class="op" id="1331089">!</span><span class="ident" id="1331090">isToken</span><span class="op" id="1331097">(</span><span class="ident" id="1331098">sub</span><span class="op" id="1331101">)</span>&nbsp;<span class="op" id="1331103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331107">return</span>&nbsp;<span class="string" id="1331114">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1331118">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331121">var</span>&nbsp;<span class="ident" id="1331125">b</span>&nbsp;<span class="ident" id="1331127">bytes</span><span class="op" id="1331132">.</span><span class="ident" id="1331133">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331141">b</span><span class="op" id="1331142">.</span><span class="ident" id="1331143">WriteString</span><span class="op" id="1331154">(</span><span class="ident" id="1331155">strings</span><span class="op" id="1331162">.</span><span class="ident" id="1331163">ToLower</span><span class="op" id="1331170">(</span><span class="ident" id="1331171">major</span><span class="op" id="1331176">)</span><span class="op" id="1331177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331180">b</span><span class="op" id="1331181">.</span><span class="ident" id="1331182">WriteByte</span><span class="op" id="1331191">(</span><span class="string" id="1331192">&#39;/&#39;</span><span class="op" id="1331195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331198">b</span><span class="op" id="1331199">.</span><span class="ident" id="1331200">WriteString</span><span class="op" id="1331211">(</span><span class="ident" id="1331212">strings</span><span class="op" id="1331219">.</span><span class="ident" id="1331220">ToLower</span><span class="op" id="1331227">(</span><span class="ident" id="1331228">sub</span><span class="op" id="1331231">)</span><span class="op" id="1331232">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331236">attrs</span>&nbsp;<span class="op" id="1331242">:=</span>&nbsp;<span class="builtinfunc" id="1331245">make</span><span class="op" id="1331249">(</span><span class="op" id="1331250">[</span><span class="op" id="1331251">]</span><span class="builtintype" id="1331252">string</span><span class="op" id="1331258">,</span>&nbsp;<span class="num" id="1331260">0</span><span class="op" id="1331261">,</span>&nbsp;<span class="builtinfunc" id="1331263">len</span><span class="op" id="1331266">(</span><span class="ident" id="1331267">param</span><span class="op" id="1331272">)</span><span class="op" id="1331273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331276">for</span>&nbsp;<span class="ident" id="1331280">a</span>&nbsp;<span class="op" id="1331282">:=</span>&nbsp;<span class="keyword" id="1331285">range</span>&nbsp;<span class="ident" id="1331291">param</span>&nbsp;<span class="op" id="1331297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331301">attrs</span>&nbsp;<span class="op" id="1331307">=</span>&nbsp;<span class="builtinfunc" id="1331309">append</span><span class="op" id="1331315">(</span><span class="ident" id="1331316">attrs</span><span class="op" id="1331321">,</span>&nbsp;<span class="ident" id="1331323">a</span><span class="op" id="1331324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1331327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331330">sort</span><span class="op" id="1331334">.</span><span class="ident" id="1331335">Strings</span><span class="op" id="1331342">(</span><span class="ident" id="1331343">attrs</span><span class="op" id="1331348">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331352">for</span>&nbsp;<span class="ident" id="1331356">_</span><span class="op" id="1331357">,</span>&nbsp;<span class="ident" id="1331359">attribute</span>&nbsp;<span class="op" id="1331369">:=</span>&nbsp;<span class="keyword" id="1331372">range</span>&nbsp;<span class="ident" id="1331378">attrs</span>&nbsp;<span class="op" id="1331384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331388">value</span>&nbsp;<span class="op" id="1331394">:=</span>&nbsp;<span class="ident" id="1331397">param</span><span class="op" id="1331402">[</span><span class="ident" id="1331403">attribute</span><span class="op" id="1331412">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331416">b</span><span class="op" id="1331417">.</span><span class="ident" id="1331418">WriteByte</span><span class="op" id="1331427">(</span><span class="string" id="1331428">&#39;;&#39;</span><span class="op" id="1331431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331435">b</span><span class="op" id="1331436">.</span><span class="ident" id="1331437">WriteByte</span><span class="op" id="1331446">(</span><span class="string" id="1331447">&#39;&nbsp;&#39;</span><span class="op" id="1331450">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331454">if</span>&nbsp;<span class="op" id="1331457">!</span><span class="ident" id="1331458">isToken</span><span class="op" id="1331465">(</span><span class="ident" id="1331466">attribute</span><span class="op" id="1331475">)</span>&nbsp;<span class="op" id="1331477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331482">return</span>&nbsp;<span class="string" id="1331489">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1331494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331498">b</span><span class="op" id="1331499">.</span><span class="ident" id="1331500">WriteString</span><span class="op" id="1331511">(</span><span class="ident" id="1331512">strings</span><span class="op" id="1331519">.</span><span class="ident" id="1331520">ToLower</span><span class="op" id="1331527">(</span><span class="ident" id="1331528">attribute</span><span class="op" id="1331537">)</span><span class="op" id="1331538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331542">b</span><span class="op" id="1331543">.</span><span class="ident" id="1331544">WriteByte</span><span class="op" id="1331553">(</span><span class="string" id="1331554">&#39;=&#39;</span><span class="op" id="1331557">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331561">if</span>&nbsp;<span class="ident" id="1331564">isToken</span><span class="op" id="1331571">(</span><span class="ident" id="1331572">value</span><span class="op" id="1331577">)</span>&nbsp;<span class="op" id="1331579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331584">b</span><span class="op" id="1331585">.</span><span class="ident" id="1331586">WriteString</span><span class="op" id="1331597">(</span><span class="ident" id="1331598">value</span><span class="op" id="1331603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331608">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1331619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331624">b</span><span class="op" id="1331625">.</span><span class="ident" id="1331626">WriteByte</span><span class="op" id="1331635">(</span><span class="string" id="1331636">&#39;&#34;&#39;</span><span class="op" id="1331639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331643">offset</span>&nbsp;<span class="op" id="1331650">:=</span>&nbsp;<span class="num" id="1331653">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331657">for</span>&nbsp;<span class="ident" id="1331661">index</span><span class="op" id="1331666">,</span>&nbsp;<span class="ident" id="1331668">character</span>&nbsp;<span class="op" id="1331678">:=</span>&nbsp;<span class="keyword" id="1331681">range</span>&nbsp;<span class="ident" id="1331687">value</span>&nbsp;<span class="op" id="1331693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331698">if</span>&nbsp;<span class="ident" id="1331701">character</span>&nbsp;<span class="op" id="1331711">==</span>&nbsp;<span class="string" id="1331714">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="1331718">||</span>&nbsp;<span class="ident" id="1331721">character</span>&nbsp;<span class="op" id="1331731">==</span>&nbsp;<span class="string" id="1331734">&#39;\\&#39;</span>&nbsp;<span class="op" id="1331739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331745">b</span><span class="op" id="1331746">.</span><span class="ident" id="1331747">WriteString</span><span class="op" id="1331758">(</span><span class="ident" id="1331759">value</span><span class="op" id="1331764">[</span><span class="ident" id="1331765">offset</span><span class="op" id="1331771">:</span><span class="ident" id="1331772">index</span><span class="op" id="1331777">]</span><span class="op" id="1331778">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331784">offset</span>&nbsp;<span class="op" id="1331791">=</span>&nbsp;<span class="ident" id="1331793">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331803">b</span><span class="op" id="1331804">.</span><span class="ident" id="1331805">WriteByte</span><span class="op" id="1331814">(</span><span class="string" id="1331815">&#39;\\&#39;</span><span class="op" id="1331819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1331824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331829">if</span>&nbsp;<span class="ident" id="1331832">character</span><span class="op" id="1331841">&amp;</span><span class="num" id="1331842">0x80</span>&nbsp;<span class="op" id="1331847">!=</span>&nbsp;<span class="num" id="1331850">0</span>&nbsp;<span class="op" id="1331852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331858">return</span>&nbsp;<span class="string" id="1331865">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1331871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1331875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331879">b</span><span class="op" id="1331880">.</span><span class="ident" id="1331881">WriteString</span><span class="op" id="1331892">(</span><span class="ident" id="1331893">value</span><span class="op" id="1331898">[</span><span class="ident" id="1331899">offset</span><span class="op" id="1331905">:</span><span class="op" id="1331906">]</span><span class="op" id="1331907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331911">b</span><span class="op" id="1331912">.</span><span class="ident" id="1331913">WriteByte</span><span class="op" id="1331922">(</span><span class="string" id="1331923">&#39;&#34;&#39;</span><span class="op" id="1331926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1331929">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331932">return</span>&nbsp;<span class="ident" id="1331939">b</span><span class="op" id="1331940">.</span><span class="ident" id="1331941">String</span><span class="op" id="1331947">(</span><span class="op" id="1331948">)</span><br>
<span class="lineno"></span><span class="op" id="1331950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1331953">func</span>&nbsp;<span class="ident" id="1331958">checkMediaTypeDisposition</span><span class="op" id="1331983">(</span><span class="ident" id="1331984">s</span>&nbsp;<span class="builtintype" id="1331986">string</span><span class="op" id="1331992">)</span>&nbsp;<span class="builtintype" id="1331994">error</span>&nbsp;<span class="op" id="1332000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332003">typ</span><span class="op" id="1332006">,</span>&nbsp;<span class="ident" id="1332008">rest</span>&nbsp;<span class="op" id="1332013">:=</span>&nbsp;<span class="ident" id="1332016">consumeToken</span><span class="op" id="1332028">(</span><span class="ident" id="1332029">s</span><span class="op" id="1332030">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1332033">if</span>&nbsp;<span class="ident" id="1332036">typ</span>&nbsp;<span class="op" id="1332040">==</span>&nbsp;<span class="string" id="1332043">&#34;&#34;</span>&nbsp;<span class="op" id="1332046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1332050">return</span>&nbsp;<span class="ident" id="1332057">errors</span><span class="op" id="1332063">.</span><span class="ident" id="1332064">New</span><span class="op" id="1332067">(</span><span class="string" id="1332068">&#34;mime:&nbsp;no&nbsp;media&nbsp;type&#34;</span><span class="op" id="1332089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1332092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1332095">if</span>&nbsp;<span class="ident" id="1332098">rest</span>&nbsp;<span class="op" id="1332103">==</span>&nbsp;<span class="string" id="1332106">&#34;&#34;</span>&nbsp;<span class="op" id="1332109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1332113">return</span>&nbsp;<span class="builtintype" id="1332120">nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1332125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1332128">if</span>&nbsp;<span class="op" id="1332131">!</span><span class="ident" id="1332132">strings</span><span class="op" id="1332139">.</span><span class="ident" id="1332140">HasPrefix</span><span class="op" id="1332149">(</span><span class="ident" id="1332150">rest</span><span class="op" id="1332154">,</span>&nbsp;<span class="string" id="1332156">&#34;/&#34;</span><span class="op" id="1332159">)</span>&nbsp;<span class="op" id="1332161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1332165">return</span>&nbsp;<span class="ident" id="1332172">errors</span><span class="op" id="1332178">.</span><span class="ident" id="1332179">New</span><span class="op" id="1332182">(</span><span class="string" id="1332183">&#34;mime:&nbsp;expected&nbsp;slash&nbsp;after&nbsp;first&nbsp;token&#34;</span><span class="op" id="1332223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1332226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332229">subtype</span><span class="op" id="1332236">,</span>&nbsp;<span class="ident" id="1332238">rest</span>&nbsp;<span class="op" id="1332243">:=</span>&nbsp;<span class="ident" id="1332246">consumeToken</span><span class="op" id="1332258">(</span><span class="ident" id="1332259">rest</span><span class="op" id="1332263">[</span><span class="num" id="1332264">1</span><span class="op" id="1332265">:</span><span class="op" id="1332266">]</span><span class="op" id="1332267">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1332270">if</span>&nbsp;<span class="ident" id="1332273">subtype</span>&nbsp;<span class="op" id="1332281">==</span>&nbsp;<span class="string" id="1332284">&#34;&#34;</span>&nbsp;<span class="op" id="1332287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1332291">return</span>&nbsp;<span class="ident" id="1332298">errors</span><span class="op" id="1332304">.</span><span class="ident" id="1332305">New</span><span class="op" id="1332308">(</span><span class="string" id="1332309">&#34;mime:&nbsp;expected&nbsp;token&nbsp;after&nbsp;slash&#34;</span><span class="op" id="1332343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1332346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1332349">if</span>&nbsp;<span class="ident" id="1332352">rest</span>&nbsp;<span class="op" id="1332357">!=</span>&nbsp;<span class="string" id="1332360">&#34;&#34;</span>&nbsp;<span class="op" id="1332363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1332367">return</span>&nbsp;<span class="ident" id="1332374">errors</span><span class="op" id="1332380">.</span><span class="ident" id="1332381">New</span><span class="op" id="1332384">(</span><span class="string" id="1332385">&#34;mime:&nbsp;unexpected&nbsp;content&nbsp;after&nbsp;media&nbsp;subtype&#34;</span><span class="op" id="1332431">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1332434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1332437">return</span>&nbsp;<span class="builtintype" id="1332444">nil</span><br>
<span class="lineno"></span><span class="op" id="1332448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1332451">//&nbsp;ParseMediaType&nbsp;parses&nbsp;a&nbsp;media&nbsp;type&nbsp;value&nbsp;and&nbsp;any&nbsp;optional</span><br>
<span class="lineno">95</span><span class="comment" id="1332512">//&nbsp;parameters,&nbsp;per&nbsp;RFC&nbsp;1521.&nbsp;&nbsp;Media&nbsp;types&nbsp;are&nbsp;the&nbsp;values&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1332572">//&nbsp;Content-Type&nbsp;and&nbsp;Content-Disposition&nbsp;headers&nbsp;(RFC&nbsp;2183).</span><br>
<span class="lineno"></span><span class="comment" id="1332632">//&nbsp;On&nbsp;success,&nbsp;ParseMediaType&nbsp;returns&nbsp;the&nbsp;media&nbsp;type&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="1332695">//&nbsp;to&nbsp;lowercase&nbsp;and&nbsp;trimmed&nbsp;of&nbsp;white&nbsp;space&nbsp;and&nbsp;a&nbsp;non-nil&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="1332757">//&nbsp;The&nbsp;returned&nbsp;map,&nbsp;params,&nbsp;maps&nbsp;from&nbsp;the&nbsp;lowercase</span><br>
<span class="lineno">100</span><span class="comment" id="1332810">//&nbsp;attribute&nbsp;to&nbsp;the&nbsp;attribute&nbsp;value&nbsp;with&nbsp;its&nbsp;case&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="keyword" id="1332871">func</span>&nbsp;<span class="ident" id="1332876">ParseMediaType</span><span class="op" id="1332890">(</span><span class="ident" id="1332891">v</span>&nbsp;<span class="builtintype" id="1332893">string</span><span class="op" id="1332899">)</span>&nbsp;<span class="op" id="1332901">(</span><span class="ident" id="1332902">mediatype</span>&nbsp;<span class="builtintype" id="1332912">string</span><span class="op" id="1332918">,</span>&nbsp;<span class="ident" id="1332920">params</span>&nbsp;<span class="keyword" id="1332927">map</span><span class="op" id="1332930">[</span><span class="builtintype" id="1332931">string</span><span class="op" id="1332937">]</span><span class="builtintype" id="1332938">string</span><span class="op" id="1332944">,</span>&nbsp;<span class="ident" id="1332946">err</span>&nbsp;<span class="builtintype" id="1332950">error</span><span class="op" id="1332955">)</span>&nbsp;<span class="op" id="1332957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332960">i</span>&nbsp;<span class="op" id="1332962">:=</span>&nbsp;<span class="ident" id="1332965">strings</span><span class="op" id="1332972">.</span><span class="ident" id="1332973">Index</span><span class="op" id="1332978">(</span><span class="ident" id="1332979">v</span><span class="op" id="1332980">,</span>&nbsp;<span class="string" id="1332982">&#34;;&#34;</span><span class="op" id="1332985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1332988">if</span>&nbsp;<span class="ident" id="1332991">i</span>&nbsp;<span class="op" id="1332993">==</span>&nbsp;<span class="op" id="1332996">-</span><span class="num" id="1332997">1</span>&nbsp;<span class="op" id="1332999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333003">i</span>&nbsp;<span class="op" id="1333005">=</span>&nbsp;<span class="builtinfunc" id="1333007">len</span><span class="op" id="1333010">(</span><span class="ident" id="1333011">v</span><span class="op" id="1333012">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1333015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333018">mediatype</span>&nbsp;<span class="op" id="1333028">=</span>&nbsp;<span class="ident" id="1333030">strings</span><span class="op" id="1333037">.</span><span class="ident" id="1333038">TrimSpace</span><span class="op" id="1333047">(</span><span class="ident" id="1333048">strings</span><span class="op" id="1333055">.</span><span class="ident" id="1333056">ToLower</span><span class="op" id="1333063">(</span><span class="ident" id="1333064">v</span><span class="op" id="1333065">[</span><span class="num" id="1333066">0</span><span class="op" id="1333067">:</span><span class="ident" id="1333068">i</span><span class="op" id="1333069">]</span><span class="op" id="1333070">)</span><span class="op" id="1333071">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333075">err</span>&nbsp;<span class="op" id="1333079">=</span>&nbsp;<span class="ident" id="1333081">checkMediaTypeDisposition</span><span class="op" id="1333106">(</span><span class="ident" id="1333107">mediatype</span><span class="op" id="1333116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333119">if</span>&nbsp;<span class="ident" id="1333122">err</span>&nbsp;<span class="op" id="1333126">!=</span>&nbsp;<span class="builtintype" id="1333129">nil</span>&nbsp;<span class="op" id="1333133">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333137">return</span>&nbsp;<span class="string" id="1333144">&#34;&#34;</span><span class="op" id="1333146">,</span>&nbsp;<span class="builtintype" id="1333148">nil</span><span class="op" id="1333151">,</span>&nbsp;<span class="ident" id="1333153">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1333158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333162">params</span>&nbsp;<span class="op" id="1333169">=</span>&nbsp;<span class="builtinfunc" id="1333171">make</span><span class="op" id="1333175">(</span><span class="keyword" id="1333176">map</span><span class="op" id="1333179">[</span><span class="builtintype" id="1333180">string</span><span class="op" id="1333186">]</span><span class="builtintype" id="1333187">string</span><span class="op" id="1333193">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1333197">//&nbsp;Map&nbsp;of&nbsp;base&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1333255">//&nbsp;for&nbsp;parameters&nbsp;containing&nbsp;a&nbsp;&#39;*&#39;&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1333302">//&nbsp;Lazily&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333326">var</span>&nbsp;<span class="ident" id="1333330">continuation</span>&nbsp;<span class="keyword" id="1333343">map</span><span class="op" id="1333346">[</span><span class="builtintype" id="1333347">string</span><span class="op" id="1333353">]</span><span class="keyword" id="1333354">map</span><span class="op" id="1333357">[</span><span class="builtintype" id="1333358">string</span><span class="op" id="1333364">]</span><span class="builtintype" id="1333365">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333374">v</span>&nbsp;<span class="op" id="1333376">=</span>&nbsp;<span class="ident" id="1333378">v</span><span class="op" id="1333379">[</span><span class="ident" id="1333380">i</span><span class="op" id="1333381">:</span><span class="op" id="1333382">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333385">for</span>&nbsp;<span class="builtinfunc" id="1333389">len</span><span class="op" id="1333392">(</span><span class="ident" id="1333393">v</span><span class="op" id="1333394">)</span>&nbsp;<span class="op" id="1333396">&gt;</span>&nbsp;<span class="num" id="1333398">0</span>&nbsp;<span class="op" id="1333400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333404">v</span>&nbsp;<span class="op" id="1333406">=</span>&nbsp;<span class="ident" id="1333408">strings</span><span class="op" id="1333415">.</span><span class="ident" id="1333416">TrimLeftFunc</span><span class="op" id="1333428">(</span><span class="ident" id="1333429">v</span><span class="op" id="1333430">,</span>&nbsp;<span class="ident" id="1333432">unicode</span><span class="op" id="1333439">.</span><span class="ident" id="1333440">IsSpace</span><span class="op" id="1333447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333451">if</span>&nbsp;<span class="builtinfunc" id="1333454">len</span><span class="op" id="1333457">(</span><span class="ident" id="1333458">v</span><span class="op" id="1333459">)</span>&nbsp;<span class="op" id="1333461">==</span>&nbsp;<span class="num" id="1333464">0</span>&nbsp;<span class="op" id="1333466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333471">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1333479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333483">key</span><span class="op" id="1333486">,</span>&nbsp;<span class="ident" id="1333488">value</span><span class="op" id="1333493">,</span>&nbsp;<span class="ident" id="1333495">rest</span>&nbsp;<span class="op" id="1333500">:=</span>&nbsp;<span class="ident" id="1333503">consumeMediaParam</span><span class="op" id="1333520">(</span><span class="ident" id="1333521">v</span><span class="op" id="1333522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333526">if</span>&nbsp;<span class="ident" id="1333529">key</span>&nbsp;<span class="op" id="1333533">==</span>&nbsp;<span class="string" id="1333536">&#34;&#34;</span>&nbsp;<span class="op" id="1333539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333544">if</span>&nbsp;<span class="ident" id="1333547">strings</span><span class="op" id="1333554">.</span><span class="ident" id="1333555">TrimSpace</span><span class="op" id="1333564">(</span><span class="ident" id="1333565">rest</span><span class="op" id="1333569">)</span>&nbsp;<span class="op" id="1333571">==</span>&nbsp;<span class="string" id="1333574">&#34;;&#34;</span>&nbsp;<span class="op" id="1333578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1333584">//&nbsp;Ignore&nbsp;trailing&nbsp;semicolons.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1333619">//&nbsp;Not&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333640">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1333650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1333655">//&nbsp;Parse&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333674">return</span>&nbsp;<span class="string" id="1333681">&#34;&#34;</span><span class="op" id="1333683">,</span>&nbsp;<span class="builtintype" id="1333685">nil</span><span class="op" id="1333688">,</span>&nbsp;<span class="ident" id="1333690">errors</span><span class="op" id="1333696">.</span><span class="ident" id="1333697">New</span><span class="op" id="1333700">(</span><span class="string" id="1333701">&#34;mime:&nbsp;invalid&nbsp;media&nbsp;parameter&#34;</span><span class="op" id="1333732">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1333736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333741">pmap</span>&nbsp;<span class="op" id="1333746">:=</span>&nbsp;<span class="ident" id="1333749">params</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333758">if</span>&nbsp;<span class="ident" id="1333761">idx</span>&nbsp;<span class="op" id="1333765">:=</span>&nbsp;<span class="ident" id="1333768">strings</span><span class="op" id="1333775">.</span><span class="ident" id="1333776">Index</span><span class="op" id="1333781">(</span><span class="ident" id="1333782">key</span><span class="op" id="1333785">,</span>&nbsp;<span class="string" id="1333787">&#34;*&#34;</span><span class="op" id="1333790">)</span><span class="op" id="1333791">;</span>&nbsp;<span class="ident" id="1333793">idx</span>&nbsp;<span class="op" id="1333797">!=</span>&nbsp;<span class="op" id="1333800">-</span><span class="num" id="1333801">1</span>&nbsp;<span class="op" id="1333803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333808">baseName</span>&nbsp;<span class="op" id="1333817">:=</span>&nbsp;<span class="ident" id="1333820">key</span><span class="op" id="1333823">[</span><span class="op" id="1333824">:</span><span class="ident" id="1333825">idx</span><span class="op" id="1333828">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333833">if</span>&nbsp;<span class="ident" id="1333836">continuation</span>&nbsp;<span class="op" id="1333849">==</span>&nbsp;<span class="builtintype" id="1333852">nil</span>&nbsp;<span class="op" id="1333856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333862">continuation</span>&nbsp;<span class="op" id="1333875">=</span>&nbsp;<span class="builtinfunc" id="1333877">make</span><span class="op" id="1333881">(</span><span class="keyword" id="1333882">map</span><span class="op" id="1333885">[</span><span class="builtintype" id="1333886">string</span><span class="op" id="1333892">]</span><span class="keyword" id="1333893">map</span><span class="op" id="1333896">[</span><span class="builtintype" id="1333897">string</span><span class="op" id="1333903">]</span><span class="builtintype" id="1333904">string</span><span class="op" id="1333910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1333915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333920">var</span>&nbsp;<span class="ident" id="1333924">ok</span>&nbsp;<span class="builtintype" id="1333927">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333935">if</span>&nbsp;<span class="ident" id="1333938">pmap</span><span class="op" id="1333942">,</span>&nbsp;<span class="ident" id="1333944">ok</span>&nbsp;<span class="op" id="1333947">=</span>&nbsp;<span class="ident" id="1333949">continuation</span><span class="op" id="1333961">[</span><span class="ident" id="1333962">baseName</span><span class="op" id="1333970">]</span><span class="op" id="1333971">;</span>&nbsp;<span class="op" id="1333973">!</span><span class="ident" id="1333974">ok</span>&nbsp;<span class="op" id="1333977">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333983">continuation</span><span class="op" id="1333995">[</span><span class="ident" id="1333996">baseName</span><span class="op" id="1334004">]</span>&nbsp;<span class="op" id="1334006">=</span>&nbsp;<span class="builtinfunc" id="1334008">make</span><span class="op" id="1334012">(</span><span class="keyword" id="1334013">map</span><span class="op" id="1334016">[</span><span class="builtintype" id="1334017">string</span><span class="op" id="1334023">]</span><span class="builtintype" id="1334024">string</span><span class="op" id="1334030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334036">pmap</span>&nbsp;<span class="op" id="1334041">=</span>&nbsp;<span class="ident" id="1334043">continuation</span><span class="op" id="1334055">[</span><span class="ident" id="1334056">baseName</span><span class="op" id="1334064">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334077">if</span>&nbsp;<span class="ident" id="1334080">_</span><span class="op" id="1334081">,</span>&nbsp;<span class="ident" id="1334083">exists</span>&nbsp;<span class="op" id="1334090">:=</span>&nbsp;<span class="ident" id="1334093">pmap</span><span class="op" id="1334097">[</span><span class="ident" id="1334098">key</span><span class="op" id="1334101">]</span><span class="op" id="1334102">;</span>&nbsp;<span class="ident" id="1334104">exists</span>&nbsp;<span class="op" id="1334111">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1334116">//&nbsp;Duplicate&nbsp;parameter&nbsp;name&nbsp;is&nbsp;bogus.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334157">return</span>&nbsp;<span class="string" id="1334164">&#34;&#34;</span><span class="op" id="1334166">,</span>&nbsp;<span class="builtintype" id="1334168">nil</span><span class="op" id="1334171">,</span>&nbsp;<span class="ident" id="1334173">errors</span><span class="op" id="1334179">.</span><span class="ident" id="1334180">New</span><span class="op" id="1334183">(</span><span class="string" id="1334184">&#34;mime:&nbsp;duplicate&nbsp;parameter&nbsp;name&#34;</span><span class="op" id="1334216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334224">pmap</span><span class="op" id="1334228">[</span><span class="ident" id="1334229">key</span><span class="op" id="1334232">]</span>&nbsp;<span class="op" id="1334234">=</span>&nbsp;<span class="ident" id="1334236">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334244">v</span>&nbsp;<span class="op" id="1334246">=</span>&nbsp;<span class="ident" id="1334248">rest</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1334258">//&nbsp;Stitch&nbsp;together&nbsp;any&nbsp;continuations&nbsp;or&nbsp;things&nbsp;with&nbsp;stars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1334317">//&nbsp;(i.e.&nbsp;RFC&nbsp;2231&nbsp;things&nbsp;with&nbsp;stars:&nbsp;&#34;foo*0&#34;&nbsp;or&nbsp;&#34;foo*&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334374">var</span>&nbsp;<span class="ident" id="1334378">buf</span>&nbsp;<span class="ident" id="1334382">bytes</span><span class="op" id="1334387">.</span><span class="ident" id="1334388">Buffer</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334396">for</span>&nbsp;<span class="ident" id="1334400">key</span><span class="op" id="1334403">,</span>&nbsp;<span class="ident" id="1334405">pieceMap</span>&nbsp;<span class="op" id="1334414">:=</span>&nbsp;<span class="keyword" id="1334417">range</span>&nbsp;<span class="ident" id="1334423">continuation</span>&nbsp;<span class="op" id="1334436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334440">singlePartKey</span>&nbsp;<span class="op" id="1334454">:=</span>&nbsp;<span class="ident" id="1334457">key</span>&nbsp;<span class="op" id="1334461">+</span>&nbsp;<span class="string" id="1334463">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334469">if</span>&nbsp;<span class="ident" id="1334472">v</span><span class="op" id="1334473">,</span>&nbsp;<span class="ident" id="1334475">ok</span>&nbsp;<span class="op" id="1334478">:=</span>&nbsp;<span class="ident" id="1334481">pieceMap</span><span class="op" id="1334489">[</span><span class="ident" id="1334490">singlePartKey</span><span class="op" id="1334503">]</span><span class="op" id="1334504">;</span>&nbsp;<span class="ident" id="1334506">ok</span>&nbsp;<span class="op" id="1334509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334514">decv</span>&nbsp;<span class="op" id="1334519">:=</span>&nbsp;<span class="ident" id="1334522">decode2231Enc</span><span class="op" id="1334535">(</span><span class="ident" id="1334536">v</span><span class="op" id="1334537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334542">params</span><span class="op" id="1334548">[</span><span class="ident" id="1334549">key</span><span class="op" id="1334552">]</span>&nbsp;<span class="op" id="1334554">=</span>&nbsp;<span class="ident" id="1334556">decv</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334564">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334580">buf</span><span class="op" id="1334583">.</span><span class="ident" id="1334584">Reset</span><span class="op" id="1334589">(</span><span class="op" id="1334590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334594">valid</span>&nbsp;<span class="op" id="1334600">:=</span>&nbsp;<span class="builtintype" id="1334603">false</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334611">for</span>&nbsp;<span class="ident" id="1334615">n</span>&nbsp;<span class="op" id="1334617">:=</span>&nbsp;<span class="num" id="1334620">0</span><span class="op" id="1334621">;</span>&nbsp;<span class="op" id="1334623">;</span>&nbsp;<span class="ident" id="1334625">n</span><span class="op" id="1334626">++</span>&nbsp;<span class="op" id="1334629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334634">simplePart</span>&nbsp;<span class="op" id="1334645">:=</span>&nbsp;<span class="ident" id="1334648">fmt</span><span class="op" id="1334651">.</span><span class="ident" id="1334652">Sprintf</span><span class="op" id="1334659">(</span><span class="string" id="1334660">&#34;%s*%d&#34;</span><span class="op" id="1334667">,</span>&nbsp;<span class="ident" id="1334669">key</span><span class="op" id="1334672">,</span>&nbsp;<span class="ident" id="1334674">n</span><span class="op" id="1334675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334680">if</span>&nbsp;<span class="ident" id="1334683">v</span><span class="op" id="1334684">,</span>&nbsp;<span class="ident" id="1334686">ok</span>&nbsp;<span class="op" id="1334689">:=</span>&nbsp;<span class="ident" id="1334692">pieceMap</span><span class="op" id="1334700">[</span><span class="ident" id="1334701">simplePart</span><span class="op" id="1334711">]</span><span class="op" id="1334712">;</span>&nbsp;<span class="ident" id="1334714">ok</span>&nbsp;<span class="op" id="1334717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334723">valid</span>&nbsp;<span class="op" id="1334729">=</span>&nbsp;<span class="builtintype" id="1334731">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334740">buf</span><span class="op" id="1334743">.</span><span class="ident" id="1334744">WriteString</span><span class="op" id="1334755">(</span><span class="ident" id="1334756">v</span><span class="op" id="1334757">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334763">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334780">encodedPart</span>&nbsp;<span class="op" id="1334792">:=</span>&nbsp;<span class="ident" id="1334795">simplePart</span>&nbsp;<span class="op" id="1334806">+</span>&nbsp;<span class="string" id="1334808">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334815">if</span>&nbsp;<span class="ident" id="1334818">v</span><span class="op" id="1334819">,</span>&nbsp;<span class="ident" id="1334821">ok</span>&nbsp;<span class="op" id="1334824">:=</span>&nbsp;<span class="ident" id="1334827">pieceMap</span><span class="op" id="1334835">[</span><span class="ident" id="1334836">encodedPart</span><span class="op" id="1334847">]</span><span class="op" id="1334848">;</span>&nbsp;<span class="ident" id="1334850">ok</span>&nbsp;<span class="op" id="1334853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334859">valid</span>&nbsp;<span class="op" id="1334865">=</span>&nbsp;<span class="builtintype" id="1334867">true</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334876">if</span>&nbsp;<span class="ident" id="1334879">n</span>&nbsp;<span class="op" id="1334881">==</span>&nbsp;<span class="num" id="1334884">0</span>&nbsp;<span class="op" id="1334886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334893">buf</span><span class="op" id="1334896">.</span><span class="ident" id="1334897">WriteString</span><span class="op" id="1334908">(</span><span class="ident" id="1334909">decode2231Enc</span><span class="op" id="1334922">(</span><span class="ident" id="1334923">v</span><span class="op" id="1334924">)</span><span class="op" id="1334925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334931">}</span>&nbsp;<span class="keyword" id="1334933">else</span>&nbsp;<span class="op" id="1334938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334945">decv</span><span class="op" id="1334949">,</span>&nbsp;<span class="ident" id="1334951">_</span>&nbsp;<span class="op" id="1334953">:=</span>&nbsp;<span class="ident" id="1334956">percentHexUnescape</span><span class="op" id="1334974">(</span><span class="ident" id="1334975">v</span><span class="op" id="1334976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334983">buf</span><span class="op" id="1334986">.</span><span class="ident" id="1334987">WriteString</span><span class="op" id="1334998">(</span><span class="ident" id="1334999">decv</span><span class="op" id="1335003">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335014">}</span>&nbsp;<span class="keyword" id="1335016">else</span>&nbsp;<span class="op" id="1335021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335027">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335040">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335044">if</span>&nbsp;<span class="ident" id="1335047">valid</span>&nbsp;<span class="op" id="1335053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335058">params</span><span class="op" id="1335064">[</span><span class="ident" id="1335065">key</span><span class="op" id="1335068">]</span>&nbsp;<span class="op" id="1335070">=</span>&nbsp;<span class="ident" id="1335072">buf</span><span class="op" id="1335075">.</span><span class="ident" id="1335076">String</span><span class="op" id="1335082">(</span><span class="op" id="1335083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335094">return</span><br>
<span class="lineno"></span><span class="op" id="1335101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1335104">func</span>&nbsp;<span class="ident" id="1335109">decode2231Enc</span><span class="op" id="1335122">(</span><span class="ident" id="1335123">v</span>&nbsp;<span class="builtintype" id="1335125">string</span><span class="op" id="1335131">)</span>&nbsp;<span class="builtintype" id="1335133">string</span>&nbsp;<span class="op" id="1335140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335143">sv</span>&nbsp;<span class="op" id="1335146">:=</span>&nbsp;<span class="ident" id="1335149">strings</span><span class="op" id="1335156">.</span><span class="ident" id="1335157">SplitN</span><span class="op" id="1335163">(</span><span class="ident" id="1335164">v</span><span class="op" id="1335165">,</span>&nbsp;<span class="string" id="1335167">&#34;&#39;&#34;</span><span class="op" id="1335170">,</span>&nbsp;<span class="num" id="1335172">3</span><span class="op" id="1335173">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335176">if</span>&nbsp;<span class="builtinfunc" id="1335179">len</span><span class="op" id="1335182">(</span><span class="ident" id="1335183">sv</span><span class="op" id="1335185">)</span>&nbsp;<span class="op" id="1335187">!=</span>&nbsp;<span class="num" id="1335190">3</span>&nbsp;<span class="op" id="1335192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335196">return</span>&nbsp;<span class="string" id="1335203">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1335210">//&nbsp;TODO:&nbsp;ignoring&nbsp;lang&nbsp;in&nbsp;sv[1]&nbsp;for&nbsp;now.&nbsp;If&nbsp;anybody&nbsp;needs&nbsp;it&nbsp;we&#39;ll</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1335278">//&nbsp;need&nbsp;to&nbsp;decide&nbsp;how&nbsp;to&nbsp;expose&nbsp;it&nbsp;in&nbsp;the&nbsp;API.&nbsp;But&nbsp;I&#39;m&nbsp;not&nbsp;sure</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1335343">//&nbsp;anybody&nbsp;uses&nbsp;it&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335376">charset</span>&nbsp;<span class="op" id="1335384">:=</span>&nbsp;<span class="ident" id="1335387">strings</span><span class="op" id="1335394">.</span><span class="ident" id="1335395">ToLower</span><span class="op" id="1335402">(</span><span class="ident" id="1335403">sv</span><span class="op" id="1335405">[</span><span class="num" id="1335406">0</span><span class="op" id="1335407">]</span><span class="op" id="1335408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335411">if</span>&nbsp;<span class="ident" id="1335414">charset</span>&nbsp;<span class="op" id="1335422">!=</span>&nbsp;<span class="string" id="1335425">&#34;us-ascii&#34;</span>&nbsp;<span class="op" id="1335436">&amp;&amp;</span>&nbsp;<span class="ident" id="1335439">charset</span>&nbsp;<span class="op" id="1335447">!=</span>&nbsp;<span class="string" id="1335450">&#34;utf-8&#34;</span>&nbsp;<span class="op" id="1335458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1335462">//&nbsp;TODO:&nbsp;unsupported&nbsp;encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335494">return</span>&nbsp;<span class="string" id="1335501">&#34;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335508">encv</span><span class="op" id="1335512">,</span>&nbsp;<span class="ident" id="1335514">_</span>&nbsp;<span class="op" id="1335516">:=</span>&nbsp;<span class="ident" id="1335519">percentHexUnescape</span><span class="op" id="1335537">(</span><span class="ident" id="1335538">sv</span><span class="op" id="1335540">[</span><span class="num" id="1335541">2</span><span class="op" id="1335542">]</span><span class="op" id="1335543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335546">return</span>&nbsp;<span class="ident" id="1335553">encv</span><br>
<span class="lineno"></span><span class="op" id="1335558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="1335561">func</span>&nbsp;<span class="ident" id="1335566">isNotTokenChar</span><span class="op" id="1335580">(</span><span class="ident" id="1335581">r</span>&nbsp;<span class="builtintype" id="1335583">rune</span><span class="op" id="1335587">)</span>&nbsp;<span class="builtintype" id="1335589">bool</span>&nbsp;<span class="op" id="1335594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335597">return</span>&nbsp;<span class="op" id="1335604">!</span><span class="ident" id="1335605">isTokenChar</span><span class="op" id="1335616">(</span><span class="ident" id="1335617">r</span><span class="op" id="1335618">)</span><br>
<span class="lineno"></span><span class="op" id="1335620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1335623">//&nbsp;consumeToken&nbsp;consumes&nbsp;a&nbsp;token&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;provided</span><br>
<span class="lineno">220</span><span class="comment" id="1335687">//&nbsp;string,&nbsp;per&nbsp;RFC&nbsp;2045&nbsp;section&nbsp;5.1&nbsp;(referenced&nbsp;from&nbsp;2183),&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="1335758">//&nbsp;the&nbsp;token&nbsp;consumed&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;Returns&nbsp;(&#34;&#34;,&nbsp;v)&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="1335828">//&nbsp;failure&nbsp;to&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="1335874">func</span>&nbsp;<span class="ident" id="1335879">consumeToken</span><span class="op" id="1335891">(</span><span class="ident" id="1335892">v</span>&nbsp;<span class="builtintype" id="1335894">string</span><span class="op" id="1335900">)</span>&nbsp;<span class="op" id="1335902">(</span><span class="ident" id="1335903">token</span><span class="op" id="1335908">,</span>&nbsp;<span class="ident" id="1335910">rest</span>&nbsp;<span class="builtintype" id="1335915">string</span><span class="op" id="1335921">)</span>&nbsp;<span class="op" id="1335923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335926">notPos</span>&nbsp;<span class="op" id="1335933">:=</span>&nbsp;<span class="ident" id="1335936">strings</span><span class="op" id="1335943">.</span><span class="ident" id="1335944">IndexFunc</span><span class="op" id="1335953">(</span><span class="ident" id="1335954">v</span><span class="op" id="1335955">,</span>&nbsp;<span class="ident" id="1335957">isNotTokenChar</span><span class="op" id="1335971">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335974">if</span>&nbsp;<span class="ident" id="1335977">notPos</span>&nbsp;<span class="op" id="1335984">==</span>&nbsp;<span class="op" id="1335987">-</span><span class="num" id="1335988">1</span>&nbsp;<span class="op" id="1335990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335994">return</span>&nbsp;<span class="ident" id="1336001">v</span><span class="op" id="1336002">,</span>&nbsp;<span class="string" id="1336004">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1336008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336011">if</span>&nbsp;<span class="ident" id="1336014">notPos</span>&nbsp;<span class="op" id="1336021">==</span>&nbsp;<span class="num" id="1336024">0</span>&nbsp;<span class="op" id="1336026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336030">return</span>&nbsp;<span class="string" id="1336037">&#34;&#34;</span><span class="op" id="1336039">,</span>&nbsp;<span class="ident" id="1336041">v</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1336044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336047">return</span>&nbsp;<span class="ident" id="1336054">v</span><span class="op" id="1336055">[</span><span class="num" id="1336056">0</span><span class="op" id="1336057">:</span><span class="ident" id="1336058">notPos</span><span class="op" id="1336064">]</span><span class="op" id="1336065">,</span>&nbsp;<span class="ident" id="1336067">v</span><span class="op" id="1336068">[</span><span class="ident" id="1336069">notPos</span><span class="op" id="1336075">:</span><span class="op" id="1336076">]</span><br>
<span class="lineno"></span><span class="op" id="1336078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1336081">//&nbsp;consumeValue&nbsp;consumes&nbsp;a&nbsp;&#34;value&#34;&nbsp;per&nbsp;RFC&nbsp;2045,&nbsp;where&nbsp;a&nbsp;value&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="1336147">//&nbsp;either&nbsp;a&nbsp;&#39;token&#39;&nbsp;or&nbsp;a&nbsp;&#39;quoted-string&#39;.&nbsp;&nbsp;On&nbsp;success,&nbsp;consumeValue</span><br>
<span class="lineno"></span><span class="comment" id="1336215">//&nbsp;returns&nbsp;the&nbsp;value&nbsp;consumed&nbsp;(and&nbsp;de-quoted/escaped,&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1336274">//&nbsp;quoted-string)&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;On&nbsp;failure,&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="1336341">//&nbsp;(&#34;&#34;,&nbsp;v).</span><br>
<span class="lineno"></span><span class="keyword" id="1336353">func</span>&nbsp;<span class="ident" id="1336358">consumeValue</span><span class="op" id="1336370">(</span><span class="ident" id="1336371">v</span>&nbsp;<span class="builtintype" id="1336373">string</span><span class="op" id="1336379">)</span>&nbsp;<span class="op" id="1336381">(</span><span class="ident" id="1336382">value</span><span class="op" id="1336387">,</span>&nbsp;<span class="ident" id="1336389">rest</span>&nbsp;<span class="builtintype" id="1336394">string</span><span class="op" id="1336400">)</span>&nbsp;<span class="op" id="1336402">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336405">if</span>&nbsp;<span class="op" id="1336408">!</span><span class="ident" id="1336409">strings</span><span class="op" id="1336416">.</span><span class="ident" id="1336417">HasPrefix</span><span class="op" id="1336426">(</span><span class="ident" id="1336427">v</span><span class="op" id="1336428">,</span>&nbsp;<span class="string" id="1336430">`&#34;`</span><span class="op" id="1336433">)</span>&nbsp;<span class="op" id="1336435">&amp;&amp;</span>&nbsp;<span class="op" id="1336438">!</span><span class="ident" id="1336439">strings</span><span class="op" id="1336446">.</span><span class="ident" id="1336447">HasPrefix</span><span class="op" id="1336456">(</span><span class="ident" id="1336457">v</span><span class="op" id="1336458">,</span>&nbsp;<span class="string" id="1336460">`&#39;`</span><span class="op" id="1336463">)</span>&nbsp;<span class="op" id="1336465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336469">return</span>&nbsp;<span class="ident" id="1336476">consumeToken</span><span class="op" id="1336488">(</span><span class="ident" id="1336489">v</span><span class="op" id="1336490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1336493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336497">leadQuote</span>&nbsp;<span class="op" id="1336507">:=</span>&nbsp;<span class="builtintype" id="1336510">rune</span><span class="op" id="1336514">(</span><span class="ident" id="1336515">v</span><span class="op" id="1336516">[</span><span class="num" id="1336517">0</span><span class="op" id="1336518">]</span><span class="op" id="1336519">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1336523">//&nbsp;parse&nbsp;a&nbsp;quoted-string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336549">rest</span>&nbsp;<span class="op" id="1336554">=</span>&nbsp;<span class="ident" id="1336556">v</span><span class="op" id="1336557">[</span><span class="num" id="1336558">1</span><span class="op" id="1336559">:</span><span class="op" id="1336560">]</span>&nbsp;<span class="comment" id="1336562">//&nbsp;consume&nbsp;the&nbsp;leading&nbsp;quote</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336592">buffer</span>&nbsp;<span class="op" id="1336599">:=</span>&nbsp;<span class="builtinfunc" id="1336602">new</span><span class="op" id="1336605">(</span><span class="ident" id="1336606">bytes</span><span class="op" id="1336611">.</span><span class="ident" id="1336612">Buffer</span><span class="op" id="1336618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336621">var</span>&nbsp;<span class="ident" id="1336625">idx</span>&nbsp;<span class="builtintype" id="1336629">int</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336634">var</span>&nbsp;<span class="ident" id="1336638">r</span>&nbsp;<span class="builtintype" id="1336640">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336646">var</span>&nbsp;<span class="ident" id="1336650">nextIsLiteral</span>&nbsp;<span class="builtintype" id="1336664">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336670">for</span>&nbsp;<span class="ident" id="1336674">idx</span><span class="op" id="1336677">,</span>&nbsp;<span class="ident" id="1336679">r</span>&nbsp;<span class="op" id="1336681">=</span>&nbsp;<span class="keyword" id="1336683">range</span>&nbsp;<span class="ident" id="1336689">rest</span>&nbsp;<span class="op" id="1336694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336698">switch</span>&nbsp;<span class="op" id="1336705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336709">case</span>&nbsp;<span class="ident" id="1336714">nextIsLiteral</span><span class="op" id="1336727">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336732">buffer</span><span class="op" id="1336738">.</span><span class="ident" id="1336739">WriteRune</span><span class="op" id="1336748">(</span><span class="ident" id="1336749">r</span><span class="op" id="1336750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336755">nextIsLiteral</span>&nbsp;<span class="op" id="1336769">=</span>&nbsp;<span class="builtintype" id="1336771">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336779">case</span>&nbsp;<span class="ident" id="1336784">r</span>&nbsp;<span class="op" id="1336786">==</span>&nbsp;<span class="ident" id="1336789">leadQuote</span><span class="op" id="1336798">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336803">return</span>&nbsp;<span class="ident" id="1336810">buffer</span><span class="op" id="1336816">.</span><span class="ident" id="1336817">String</span><span class="op" id="1336823">(</span><span class="op" id="1336824">)</span><span class="op" id="1336825">,</span>&nbsp;<span class="ident" id="1336827">rest</span><span class="op" id="1336831">[</span><span class="ident" id="1336832">idx</span><span class="op" id="1336835">+</span><span class="num" id="1336836">1</span><span class="op" id="1336837">:</span><span class="op" id="1336838">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336842">case</span>&nbsp;<span class="ident" id="1336847">r</span>&nbsp;<span class="op" id="1336849">==</span>&nbsp;<span class="string" id="1336852">&#39;\\&#39;</span><span class="op" id="1336856">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336861">nextIsLiteral</span>&nbsp;<span class="op" id="1336875">=</span>&nbsp;<span class="builtintype" id="1336877">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336884">case</span>&nbsp;<span class="ident" id="1336889">r</span>&nbsp;<span class="op" id="1336891">!=</span>&nbsp;<span class="string" id="1336894">&#39;\r&#39;</span>&nbsp;<span class="op" id="1336899">&amp;&amp;</span>&nbsp;<span class="ident" id="1336902">r</span>&nbsp;<span class="op" id="1336904">!=</span>&nbsp;<span class="string" id="1336907">&#39;\n&#39;</span><span class="op" id="1336911">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336916">buffer</span><span class="op" id="1336922">.</span><span class="ident" id="1336923">WriteRune</span><span class="op" id="1336932">(</span><span class="ident" id="1336933">r</span><span class="op" id="1336934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336938">default</span><span class="op" id="1336945">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336950">return</span>&nbsp;<span class="string" id="1336957">&#34;&#34;</span><span class="op" id="1336959">,</span>&nbsp;<span class="ident" id="1336961">v</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1336965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1336968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336971">return</span>&nbsp;<span class="string" id="1336978">&#34;&#34;</span><span class="op" id="1336980">,</span>&nbsp;<span class="ident" id="1336982">v</span><br>
<span class="lineno"></span><span class="op" id="1336984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="1336987">func</span>&nbsp;<span class="ident" id="1336992">consumeMediaParam</span><span class="op" id="1337009">(</span><span class="ident" id="1337010">v</span>&nbsp;<span class="builtintype" id="1337012">string</span><span class="op" id="1337018">)</span>&nbsp;<span class="op" id="1337020">(</span><span class="ident" id="1337021">param</span><span class="op" id="1337026">,</span>&nbsp;<span class="ident" id="1337028">value</span><span class="op" id="1337033">,</span>&nbsp;<span class="ident" id="1337035">rest</span>&nbsp;<span class="builtintype" id="1337040">string</span><span class="op" id="1337046">)</span>&nbsp;<span class="op" id="1337048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337051">rest</span>&nbsp;<span class="op" id="1337056">=</span>&nbsp;<span class="ident" id="1337058">strings</span><span class="op" id="1337065">.</span><span class="ident" id="1337066">TrimLeftFunc</span><span class="op" id="1337078">(</span><span class="ident" id="1337079">v</span><span class="op" id="1337080">,</span>&nbsp;<span class="ident" id="1337082">unicode</span><span class="op" id="1337089">.</span><span class="ident" id="1337090">IsSpace</span><span class="op" id="1337097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337100">if</span>&nbsp;<span class="op" id="1337103">!</span><span class="ident" id="1337104">strings</span><span class="op" id="1337111">.</span><span class="ident" id="1337112">HasPrefix</span><span class="op" id="1337121">(</span><span class="ident" id="1337122">rest</span><span class="op" id="1337126">,</span>&nbsp;<span class="string" id="1337128">&#34;;&#34;</span><span class="op" id="1337131">)</span>&nbsp;<span class="op" id="1337133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337137">return</span>&nbsp;<span class="string" id="1337144">&#34;&#34;</span><span class="op" id="1337146">,</span>&nbsp;<span class="string" id="1337148">&#34;&#34;</span><span class="op" id="1337150">,</span>&nbsp;<span class="ident" id="1337152">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337155">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337159">rest</span>&nbsp;<span class="op" id="1337164">=</span>&nbsp;<span class="ident" id="1337166">rest</span><span class="op" id="1337170">[</span><span class="num" id="1337171">1</span><span class="op" id="1337172">:</span><span class="op" id="1337173">]</span>&nbsp;<span class="comment" id="1337175">//&nbsp;consume&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337197">rest</span>&nbsp;<span class="op" id="1337202">=</span>&nbsp;<span class="ident" id="1337204">strings</span><span class="op" id="1337211">.</span><span class="ident" id="1337212">TrimLeftFunc</span><span class="op" id="1337224">(</span><span class="ident" id="1337225">rest</span><span class="op" id="1337229">,</span>&nbsp;<span class="ident" id="1337231">unicode</span><span class="op" id="1337238">.</span><span class="ident" id="1337239">IsSpace</span><span class="op" id="1337246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337249">param</span><span class="op" id="1337254">,</span>&nbsp;<span class="ident" id="1337256">rest</span>&nbsp;<span class="op" id="1337261">=</span>&nbsp;<span class="ident" id="1337263">consumeToken</span><span class="op" id="1337275">(</span><span class="ident" id="1337276">rest</span><span class="op" id="1337280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337283">param</span>&nbsp;<span class="op" id="1337289">=</span>&nbsp;<span class="ident" id="1337291">strings</span><span class="op" id="1337298">.</span><span class="ident" id="1337299">ToLower</span><span class="op" id="1337306">(</span><span class="ident" id="1337307">param</span><span class="op" id="1337312">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337315">if</span>&nbsp;<span class="ident" id="1337318">param</span>&nbsp;<span class="op" id="1337324">==</span>&nbsp;<span class="string" id="1337327">&#34;&#34;</span>&nbsp;<span class="op" id="1337330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337334">return</span>&nbsp;<span class="string" id="1337341">&#34;&#34;</span><span class="op" id="1337343">,</span>&nbsp;<span class="string" id="1337345">&#34;&#34;</span><span class="op" id="1337347">,</span>&nbsp;<span class="ident" id="1337349">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337356">rest</span>&nbsp;<span class="op" id="1337361">=</span>&nbsp;<span class="ident" id="1337363">strings</span><span class="op" id="1337370">.</span><span class="ident" id="1337371">TrimLeftFunc</span><span class="op" id="1337383">(</span><span class="ident" id="1337384">rest</span><span class="op" id="1337388">,</span>&nbsp;<span class="ident" id="1337390">unicode</span><span class="op" id="1337397">.</span><span class="ident" id="1337398">IsSpace</span><span class="op" id="1337405">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337408">if</span>&nbsp;<span class="op" id="1337411">!</span><span class="ident" id="1337412">strings</span><span class="op" id="1337419">.</span><span class="ident" id="1337420">HasPrefix</span><span class="op" id="1337429">(</span><span class="ident" id="1337430">rest</span><span class="op" id="1337434">,</span>&nbsp;<span class="string" id="1337436">&#34;=&#34;</span><span class="op" id="1337439">)</span>&nbsp;<span class="op" id="1337441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337445">return</span>&nbsp;<span class="string" id="1337452">&#34;&#34;</span><span class="op" id="1337454">,</span>&nbsp;<span class="string" id="1337456">&#34;&#34;</span><span class="op" id="1337458">,</span>&nbsp;<span class="ident" id="1337460">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337466">rest</span>&nbsp;<span class="op" id="1337471">=</span>&nbsp;<span class="ident" id="1337473">rest</span><span class="op" id="1337477">[</span><span class="num" id="1337478">1</span><span class="op" id="1337479">:</span><span class="op" id="1337480">]</span>&nbsp;<span class="comment" id="1337482">//&nbsp;consume&nbsp;equals&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337506">rest</span>&nbsp;<span class="op" id="1337511">=</span>&nbsp;<span class="ident" id="1337513">strings</span><span class="op" id="1337520">.</span><span class="ident" id="1337521">TrimLeftFunc</span><span class="op" id="1337533">(</span><span class="ident" id="1337534">rest</span><span class="op" id="1337538">,</span>&nbsp;<span class="ident" id="1337540">unicode</span><span class="op" id="1337547">.</span><span class="ident" id="1337548">IsSpace</span><span class="op" id="1337555">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337558">value</span><span class="op" id="1337563">,</span>&nbsp;<span class="ident" id="1337565">rest</span>&nbsp;<span class="op" id="1337570">=</span>&nbsp;<span class="ident" id="1337572">consumeValue</span><span class="op" id="1337584">(</span><span class="ident" id="1337585">rest</span><span class="op" id="1337589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337592">if</span>&nbsp;<span class="ident" id="1337595">value</span>&nbsp;<span class="op" id="1337601">==</span>&nbsp;<span class="string" id="1337604">&#34;&#34;</span>&nbsp;<span class="op" id="1337607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337611">return</span>&nbsp;<span class="string" id="1337618">&#34;&#34;</span><span class="op" id="1337620">,</span>&nbsp;<span class="string" id="1337622">&#34;&#34;</span><span class="op" id="1337624">,</span>&nbsp;<span class="ident" id="1337626">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337632">return</span>&nbsp;<span class="ident" id="1337639">param</span><span class="op" id="1337644">,</span>&nbsp;<span class="ident" id="1337646">value</span><span class="op" id="1337651">,</span>&nbsp;<span class="ident" id="1337653">rest</span><br>
<span class="lineno">295</span><span class="op" id="1337658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1337661">func</span>&nbsp;<span class="ident" id="1337666">percentHexUnescape</span><span class="op" id="1337684">(</span><span class="ident" id="1337685">s</span>&nbsp;<span class="builtintype" id="1337687">string</span><span class="op" id="1337693">)</span>&nbsp;<span class="op" id="1337695">(</span><span class="builtintype" id="1337696">string</span><span class="op" id="1337702">,</span>&nbsp;<span class="builtintype" id="1337704">error</span><span class="op" id="1337709">)</span>&nbsp;<span class="op" id="1337711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1337714">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337759">percents</span>&nbsp;<span class="op" id="1337768">:=</span>&nbsp;<span class="num" id="1337771">0</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337774">for</span>&nbsp;<span class="ident" id="1337778">i</span>&nbsp;<span class="op" id="1337780">:=</span>&nbsp;<span class="num" id="1337783">0</span><span class="op" id="1337784">;</span>&nbsp;<span class="ident" id="1337786">i</span>&nbsp;<span class="op" id="1337788">&lt;</span>&nbsp;<span class="builtinfunc" id="1337790">len</span><span class="op" id="1337793">(</span><span class="ident" id="1337794">s</span><span class="op" id="1337795">)</span><span class="op" id="1337796">;</span>&nbsp;<span class="op" id="1337798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337802">if</span>&nbsp;<span class="ident" id="1337805">s</span><span class="op" id="1337806">[</span><span class="ident" id="1337807">i</span><span class="op" id="1337808">]</span>&nbsp;<span class="op" id="1337810">!=</span>&nbsp;<span class="string" id="1337813">&#39;%&#39;</span>&nbsp;<span class="op" id="1337817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337822">i</span><span class="op" id="1337823">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337829">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337840">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337844">percents</span><span class="op" id="1337852">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337857">if</span>&nbsp;<span class="ident" id="1337860">i</span><span class="op" id="1337861">+</span><span class="num" id="1337862">2</span>&nbsp;<span class="op" id="1337864">&gt;=</span>&nbsp;<span class="builtinfunc" id="1337867">len</span><span class="op" id="1337870">(</span><span class="ident" id="1337871">s</span><span class="op" id="1337872">)</span>&nbsp;<span class="op" id="1337874">||</span>&nbsp;<span class="op" id="1337877">!</span><span class="ident" id="1337878">ishex</span><span class="op" id="1337883">(</span><span class="ident" id="1337884">s</span><span class="op" id="1337885">[</span><span class="ident" id="1337886">i</span><span class="op" id="1337887">+</span><span class="num" id="1337888">1</span><span class="op" id="1337889">]</span><span class="op" id="1337890">)</span>&nbsp;<span class="op" id="1337892">||</span>&nbsp;<span class="op" id="1337895">!</span><span class="ident" id="1337896">ishex</span><span class="op" id="1337901">(</span><span class="ident" id="1337902">s</span><span class="op" id="1337903">[</span><span class="ident" id="1337904">i</span><span class="op" id="1337905">+</span><span class="num" id="1337906">2</span><span class="op" id="1337907">]</span><span class="op" id="1337908">)</span>&nbsp;<span class="op" id="1337910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337915">s</span>&nbsp;<span class="op" id="1337917">=</span>&nbsp;<span class="ident" id="1337919">s</span><span class="op" id="1337920">[</span><span class="ident" id="1337921">i</span><span class="op" id="1337922">:</span><span class="op" id="1337923">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337928">if</span>&nbsp;<span class="builtinfunc" id="1337931">len</span><span class="op" id="1337934">(</span><span class="ident" id="1337935">s</span><span class="op" id="1337936">)</span>&nbsp;<span class="op" id="1337938">&gt;</span>&nbsp;<span class="num" id="1337940">3</span>&nbsp;<span class="op" id="1337942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337948">s</span>&nbsp;<span class="op" id="1337950">=</span>&nbsp;<span class="ident" id="1337952">s</span><span class="op" id="1337953">[</span><span class="num" id="1337954">0</span><span class="op" id="1337955">:</span><span class="num" id="1337956">3</span><span class="op" id="1337957">]</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337967">return</span>&nbsp;<span class="string" id="1337974">&#34;&#34;</span><span class="op" id="1337976">,</span>&nbsp;<span class="ident" id="1337978">fmt</span><span class="op" id="1337981">.</span><span class="ident" id="1337982">Errorf</span><span class="op" id="1337988">(</span><span class="string" id="1337989">&#34;mime:&nbsp;bogus&nbsp;characters&nbsp;after&nbsp;%%:&nbsp;%q&#34;</span><span class="op" id="1338026">,</span>&nbsp;<span class="ident" id="1338028">s</span><span class="op" id="1338029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1338033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338037">i</span>&nbsp;<span class="op" id="1338039">+=</span>&nbsp;<span class="num" id="1338042">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1338045">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338048">if</span>&nbsp;<span class="ident" id="1338051">percents</span>&nbsp;<span class="op" id="1338060">==</span>&nbsp;<span class="num" id="1338063">0</span>&nbsp;<span class="op" id="1338065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338069">return</span>&nbsp;<span class="ident" id="1338076">s</span><span class="op" id="1338077">,</span>&nbsp;<span class="builtintype" id="1338079">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1338084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338088">t</span>&nbsp;<span class="op" id="1338090">:=</span>&nbsp;<span class="builtinfunc" id="1338093">make</span><span class="op" id="1338097">(</span><span class="op" id="1338098">[</span><span class="op" id="1338099">]</span><span class="builtintype" id="1338100">byte</span><span class="op" id="1338104">,</span>&nbsp;<span class="builtinfunc" id="1338106">len</span><span class="op" id="1338109">(</span><span class="ident" id="1338110">s</span><span class="op" id="1338111">)</span><span class="op" id="1338112">-</span><span class="num" id="1338113">2</span><span class="op" id="1338114">*</span><span class="ident" id="1338115">percents</span><span class="op" id="1338123">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338126">j</span>&nbsp;<span class="op" id="1338128">:=</span>&nbsp;<span class="num" id="1338131">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338134">for</span>&nbsp;<span class="ident" id="1338138">i</span>&nbsp;<span class="op" id="1338140">:=</span>&nbsp;<span class="num" id="1338143">0</span><span class="op" id="1338144">;</span>&nbsp;<span class="ident" id="1338146">i</span>&nbsp;<span class="op" id="1338148">&lt;</span>&nbsp;<span class="builtinfunc" id="1338150">len</span><span class="op" id="1338153">(</span><span class="ident" id="1338154">s</span><span class="op" id="1338155">)</span><span class="op" id="1338156">;</span>&nbsp;<span class="op" id="1338158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338162">switch</span>&nbsp;<span class="ident" id="1338169">s</span><span class="op" id="1338170">[</span><span class="ident" id="1338171">i</span><span class="op" id="1338172">]</span>&nbsp;<span class="op" id="1338174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338178">case</span>&nbsp;<span class="string" id="1338183">&#39;%&#39;</span><span class="op" id="1338186">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338191">t</span><span class="op" id="1338192">[</span><span class="ident" id="1338193">j</span><span class="op" id="1338194">]</span>&nbsp;<span class="op" id="1338196">=</span>&nbsp;<span class="ident" id="1338198">unhex</span><span class="op" id="1338203">(</span><span class="ident" id="1338204">s</span><span class="op" id="1338205">[</span><span class="ident" id="1338206">i</span><span class="op" id="1338207">+</span><span class="num" id="1338208">1</span><span class="op" id="1338209">]</span><span class="op" id="1338210">)</span><span class="op" id="1338211">&lt;&lt;</span><span class="num" id="1338213">4</span>&nbsp;<span class="op" id="1338215">|</span>&nbsp;<span class="ident" id="1338217">unhex</span><span class="op" id="1338222">(</span><span class="ident" id="1338223">s</span><span class="op" id="1338224">[</span><span class="ident" id="1338225">i</span><span class="op" id="1338226">+</span><span class="num" id="1338227">2</span><span class="op" id="1338228">]</span><span class="op" id="1338229">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338234">j</span><span class="op" id="1338235">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338241">i</span>&nbsp;<span class="op" id="1338243">+=</span>&nbsp;<span class="num" id="1338246">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338250">default</span><span class="op" id="1338257">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338262">t</span><span class="op" id="1338263">[</span><span class="ident" id="1338264">j</span><span class="op" id="1338265">]</span>&nbsp;<span class="op" id="1338267">=</span>&nbsp;<span class="ident" id="1338269">s</span><span class="op" id="1338270">[</span><span class="ident" id="1338271">i</span><span class="op" id="1338272">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338277">j</span><span class="op" id="1338278">++</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338284">i</span><span class="op" id="1338285">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1338290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1338293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338296">return</span>&nbsp;<span class="builtintype" id="1338303">string</span><span class="op" id="1338309">(</span><span class="ident" id="1338310">t</span><span class="op" id="1338311">)</span><span class="op" id="1338312">,</span>&nbsp;<span class="builtintype" id="1338314">nil</span><br>
<span class="lineno"></span><span class="op" id="1338318">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="keyword" id="1338321">func</span>&nbsp;<span class="ident" id="1338326">ishex</span><span class="op" id="1338331">(</span><span class="ident" id="1338332">c</span>&nbsp;<span class="builtintype" id="1338334">byte</span><span class="op" id="1338338">)</span>&nbsp;<span class="builtintype" id="1338340">bool</span>&nbsp;<span class="op" id="1338345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338348">switch</span>&nbsp;<span class="op" id="1338355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338358">case</span>&nbsp;<span class="string" id="1338363">&#39;0&#39;</span>&nbsp;<span class="op" id="1338367">&lt;=</span>&nbsp;<span class="ident" id="1338370">c</span>&nbsp;<span class="op" id="1338372">&amp;&amp;</span>&nbsp;<span class="ident" id="1338375">c</span>&nbsp;<span class="op" id="1338377">&lt;=</span>&nbsp;<span class="string" id="1338380">&#39;9&#39;</span><span class="op" id="1338383">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338387">return</span>&nbsp;<span class="builtintype" id="1338394">true</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338400">case</span>&nbsp;<span class="string" id="1338405">&#39;a&#39;</span>&nbsp;<span class="op" id="1338409">&lt;=</span>&nbsp;<span class="ident" id="1338412">c</span>&nbsp;<span class="op" id="1338414">&amp;&amp;</span>&nbsp;<span class="ident" id="1338417">c</span>&nbsp;<span class="op" id="1338419">&lt;=</span>&nbsp;<span class="string" id="1338422">&#39;f&#39;</span><span class="op" id="1338425">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338429">return</span>&nbsp;<span class="builtintype" id="1338436">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338442">case</span>&nbsp;<span class="string" id="1338447">&#39;A&#39;</span>&nbsp;<span class="op" id="1338451">&lt;=</span>&nbsp;<span class="ident" id="1338454">c</span>&nbsp;<span class="op" id="1338456">&amp;&amp;</span>&nbsp;<span class="ident" id="1338459">c</span>&nbsp;<span class="op" id="1338461">&lt;=</span>&nbsp;<span class="string" id="1338464">&#39;F&#39;</span><span class="op" id="1338467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338471">return</span>&nbsp;<span class="builtintype" id="1338478">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1338484">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338487">return</span>&nbsp;<span class="builtintype" id="1338494">false</span><br>
<span class="lineno"></span><span class="op" id="1338500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1338503">func</span>&nbsp;<span class="ident" id="1338508">unhex</span><span class="op" id="1338513">(</span><span class="ident" id="1338514">c</span>&nbsp;<span class="builtintype" id="1338516">byte</span><span class="op" id="1338520">)</span>&nbsp;<span class="builtintype" id="1338522">byte</span>&nbsp;<span class="op" id="1338527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338530">switch</span>&nbsp;<span class="op" id="1338537">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338540">case</span>&nbsp;<span class="string" id="1338545">&#39;0&#39;</span>&nbsp;<span class="op" id="1338549">&lt;=</span>&nbsp;<span class="ident" id="1338552">c</span>&nbsp;<span class="op" id="1338554">&amp;&amp;</span>&nbsp;<span class="ident" id="1338557">c</span>&nbsp;<span class="op" id="1338559">&lt;=</span>&nbsp;<span class="string" id="1338562">&#39;9&#39;</span><span class="op" id="1338565">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338569">return</span>&nbsp;<span class="ident" id="1338576">c</span>&nbsp;<span class="op" id="1338578">-</span>&nbsp;<span class="string" id="1338580">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338585">case</span>&nbsp;<span class="string" id="1338590">&#39;a&#39;</span>&nbsp;<span class="op" id="1338594">&lt;=</span>&nbsp;<span class="ident" id="1338597">c</span>&nbsp;<span class="op" id="1338599">&amp;&amp;</span>&nbsp;<span class="ident" id="1338602">c</span>&nbsp;<span class="op" id="1338604">&lt;=</span>&nbsp;<span class="string" id="1338607">&#39;f&#39;</span><span class="op" id="1338610">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338614">return</span>&nbsp;<span class="ident" id="1338621">c</span>&nbsp;<span class="op" id="1338623">-</span>&nbsp;<span class="string" id="1338625">&#39;a&#39;</span>&nbsp;<span class="op" id="1338629">+</span>&nbsp;<span class="num" id="1338631">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338635">case</span>&nbsp;<span class="string" id="1338640">&#39;A&#39;</span>&nbsp;<span class="op" id="1338644">&lt;=</span>&nbsp;<span class="ident" id="1338647">c</span>&nbsp;<span class="op" id="1338649">&amp;&amp;</span>&nbsp;<span class="ident" id="1338652">c</span>&nbsp;<span class="op" id="1338654">&lt;=</span>&nbsp;<span class="string" id="1338657">&#39;F&#39;</span><span class="op" id="1338660">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338664">return</span>&nbsp;<span class="ident" id="1338671">c</span>&nbsp;<span class="op" id="1338673">-</span>&nbsp;<span class="string" id="1338675">&#39;A&#39;</span>&nbsp;<span class="op" id="1338679">+</span>&nbsp;<span class="num" id="1338681">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1338685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338688">return</span>&nbsp;<span class="num" id="1338695">0</span><br>
<span class="lineno"></span><span class="op" id="1338697">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
