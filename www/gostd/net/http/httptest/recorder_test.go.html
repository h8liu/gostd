<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6489874">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6489929">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6489983">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6490034">package</span>&nbsp;<span class="ident" id="6490042">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6490052">import</span>&nbsp;<span class="op" id="6490059">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6490062">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6490069">&#34;net/http&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6490081">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6490091">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6490094">func</span>&nbsp;<span class="ident" id="6490099">TestRecorder</span><span class="op" id="6490111">(</span><span class="ident" id="6490112">t</span>&nbsp;<span class="op" id="6490114">*</span><span class="ident" id="6490115">testing</span><span class="op" id="6490122">.</span><span class="ident" id="6490123">T</span><span class="op" id="6490124">)</span>&nbsp;<span class="op" id="6490126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6490129">type</span>&nbsp;<span class="ident" id="6490134">checkFunc</span>&nbsp;<span class="keyword" id="6490144">func</span><span class="op" id="6490148">(</span><span class="op" id="6490149">*</span><span class="ident" id="6490150">ResponseRecorder</span><span class="op" id="6490166">)</span>&nbsp;<span class="builtintype" id="6490168">error</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6490175">check</span>&nbsp;<span class="op" id="6490181">:=</span>&nbsp;<span class="keyword" id="6490184">func</span><span class="op" id="6490188">(</span><span class="ident" id="6490189">fns</span>&nbsp;<span class="op" id="6490193">...</span><span class="ident" id="6490196">checkFunc</span><span class="op" id="6490205">)</span>&nbsp;<span class="op" id="6490207">[</span><span class="op" id="6490208">]</span><span class="ident" id="6490209">checkFunc</span>&nbsp;<span class="op" id="6490219">{</span>&nbsp;<span class="keyword" id="6490221">return</span>&nbsp;<span class="ident" id="6490228">fns</span>&nbsp;<span class="op" id="6490232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6490236">hasStatus</span>&nbsp;<span class="op" id="6490246">:=</span>&nbsp;<span class="keyword" id="6490249">func</span><span class="op" id="6490253">(</span><span class="ident" id="6490254">wantCode</span>&nbsp;<span class="builtintype" id="6490263">int</span><span class="op" id="6490266">)</span>&nbsp;<span class="ident" id="6490268">checkFunc</span>&nbsp;<span class="op" id="6490278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6490282">return</span>&nbsp;<span class="keyword" id="6490289">func</span><span class="op" id="6490293">(</span><span class="ident" id="6490294">rec</span>&nbsp;<span class="op" id="6490298">*</span><span class="ident" id="6490299">ResponseRecorder</span><span class="op" id="6490315">)</span>&nbsp;<span class="builtintype" id="6490317">error</span>&nbsp;<span class="op" id="6490323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6490328">if</span>&nbsp;<span class="ident" id="6490331">rec</span><span class="op" id="6490334">.</span><span class="ident" id="6490335">Code</span>&nbsp;<span class="op" id="6490340">!=</span>&nbsp;<span class="ident" id="6490343">wantCode</span>&nbsp;<span class="op" id="6490352">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6490358">return</span>&nbsp;<span class="ident" id="6490365">fmt</span><span class="op" id="6490368">.</span><span class="ident" id="6490369">Errorf</span><span class="op" id="6490375">(</span><span class="string" id="6490376">&#34;Status&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6490398">,</span>&nbsp;<span class="ident" id="6490400">rec</span><span class="op" id="6490403">.</span><span class="ident" id="6490404">Code</span><span class="op" id="6490408">,</span>&nbsp;<span class="ident" id="6490410">wantCode</span><span class="op" id="6490418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6490423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6490428">return</span>&nbsp;<span class="ident" id="6490435">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6490441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6490444">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6490447">hasContents</span>&nbsp;<span class="op" id="6490459">:=</span>&nbsp;<span class="keyword" id="6490462">func</span><span class="op" id="6490466">(</span><span class="ident" id="6490467">want</span>&nbsp;<span class="builtintype" id="6490472">string</span><span class="op" id="6490478">)</span>&nbsp;<span class="ident" id="6490480">checkFunc</span>&nbsp;<span class="op" id="6490490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6490494">return</span>&nbsp;<span class="keyword" id="6490501">func</span><span class="op" id="6490505">(</span><span class="ident" id="6490506">rec</span>&nbsp;<span class="op" id="6490510">*</span><span class="ident" id="6490511">ResponseRecorder</span><span class="op" id="6490527">)</span>&nbsp;<span class="builtintype" id="6490529">error</span>&nbsp;<span class="op" id="6490535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6490540">if</span>&nbsp;<span class="ident" id="6490543">rec</span><span class="op" id="6490546">.</span><span class="ident" id="6490547">Body</span><span class="op" id="6490551">.</span><span class="ident" id="6490552">String</span><span class="op" id="6490558">(</span><span class="op" id="6490559">)</span>&nbsp;<span class="op" id="6490561">!=</span>&nbsp;<span class="ident" id="6490564">want</span>&nbsp;<span class="op" id="6490569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6490575">return</span>&nbsp;<span class="ident" id="6490582">fmt</span><span class="op" id="6490585">.</span><span class="ident" id="6490586">Errorf</span><span class="op" id="6490592">(</span><span class="string" id="6490593">&#34;wrote&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6490614">,</span>&nbsp;<span class="ident" id="6490616">rec</span><span class="op" id="6490619">.</span><span class="ident" id="6490620">Body</span><span class="op" id="6490624">.</span><span class="ident" id="6490625">String</span><span class="op" id="6490631">(</span><span class="op" id="6490632">)</span><span class="op" id="6490633">,</span>&nbsp;<span class="ident" id="6490635">want</span><span class="op" id="6490639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6490644">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6490649">return</span>&nbsp;<span class="ident" id="6490656">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6490662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6490665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6490668">hasFlush</span>&nbsp;<span class="op" id="6490677">:=</span>&nbsp;<span class="keyword" id="6490680">func</span><span class="op" id="6490684">(</span><span class="ident" id="6490685">want</span>&nbsp;<span class="builtintype" id="6490690">bool</span><span class="op" id="6490694">)</span>&nbsp;<span class="ident" id="6490696">checkFunc</span>&nbsp;<span class="op" id="6490706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6490710">return</span>&nbsp;<span class="keyword" id="6490717">func</span><span class="op" id="6490721">(</span><span class="ident" id="6490722">rec</span>&nbsp;<span class="op" id="6490726">*</span><span class="ident" id="6490727">ResponseRecorder</span><span class="op" id="6490743">)</span>&nbsp;<span class="builtintype" id="6490745">error</span>&nbsp;<span class="op" id="6490751">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6490756">if</span>&nbsp;<span class="ident" id="6490759">rec</span><span class="op" id="6490762">.</span><span class="ident" id="6490763">Flushed</span>&nbsp;<span class="op" id="6490771">!=</span>&nbsp;<span class="ident" id="6490774">want</span>&nbsp;<span class="op" id="6490779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6490785">return</span>&nbsp;<span class="ident" id="6490792">fmt</span><span class="op" id="6490795">.</span><span class="ident" id="6490796">Errorf</span><span class="op" id="6490802">(</span><span class="string" id="6490803">&#34;Flushed&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6490826">,</span>&nbsp;<span class="ident" id="6490828">rec</span><span class="op" id="6490831">.</span><span class="ident" id="6490832">Flushed</span><span class="op" id="6490839">,</span>&nbsp;<span class="ident" id="6490841">want</span><span class="op" id="6490845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6490850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6490855">return</span>&nbsp;<span class="ident" id="6490862">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6490868">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6490871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6490875">tests</span>&nbsp;<span class="op" id="6490881">:=</span>&nbsp;<span class="op" id="6490884">[</span><span class="op" id="6490885">]</span><span class="keyword" id="6490886">struct</span>&nbsp;<span class="op" id="6490893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6490897">name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6490904">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6490913">h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6490920">func</span><span class="op" id="6490924">(</span><span class="ident" id="6490925">w</span>&nbsp;<span class="ident" id="6490927">http</span><span class="op" id="6490931">.</span><span class="ident" id="6490932">ResponseWriter</span><span class="op" id="6490946">,</span>&nbsp;<span class="ident" id="6490948">r</span>&nbsp;<span class="op" id="6490950">*</span><span class="ident" id="6490951">http</span><span class="op" id="6490955">.</span><span class="ident" id="6490956">Request</span><span class="op" id="6490963">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6490967">checks</span>&nbsp;<span class="op" id="6490974">[</span><span class="op" id="6490975">]</span><span class="ident" id="6490976">checkFunc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6490987">}</span><span class="op" id="6490988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6490992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6490997">&#34;200&nbsp;default&#34;</span><span class="op" id="6491010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6491015">func</span><span class="op" id="6491019">(</span><span class="ident" id="6491020">w</span>&nbsp;<span class="ident" id="6491022">http</span><span class="op" id="6491026">.</span><span class="ident" id="6491027">ResponseWriter</span><span class="op" id="6491041">,</span>&nbsp;<span class="ident" id="6491043">r</span>&nbsp;<span class="op" id="6491045">*</span><span class="ident" id="6491046">http</span><span class="op" id="6491050">.</span><span class="ident" id="6491051">Request</span><span class="op" id="6491058">)</span>&nbsp;<span class="op" id="6491060">{</span><span class="op" id="6491061">}</span><span class="op" id="6491062">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491067">check</span><span class="op" id="6491072">(</span><span class="ident" id="6491073">hasStatus</span><span class="op" id="6491082">(</span><span class="num" id="6491083">200</span><span class="op" id="6491086">)</span><span class="op" id="6491087">,</span>&nbsp;<span class="ident" id="6491089">hasContents</span><span class="op" id="6491100">(</span><span class="string" id="6491101">&#34;&#34;</span><span class="op" id="6491103">)</span><span class="op" id="6491104">)</span><span class="op" id="6491105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6491109">}</span><span class="op" id="6491110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6491114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6491119">&#34;first&nbsp;code&nbsp;only&#34;</span><span class="op" id="6491136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6491141">func</span><span class="op" id="6491145">(</span><span class="ident" id="6491146">w</span>&nbsp;<span class="ident" id="6491148">http</span><span class="op" id="6491152">.</span><span class="ident" id="6491153">ResponseWriter</span><span class="op" id="6491167">,</span>&nbsp;<span class="ident" id="6491169">r</span>&nbsp;<span class="op" id="6491171">*</span><span class="ident" id="6491172">http</span><span class="op" id="6491176">.</span><span class="ident" id="6491177">Request</span><span class="op" id="6491184">)</span>&nbsp;<span class="op" id="6491186">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491192">w</span><span class="op" id="6491193">.</span><span class="ident" id="6491194">WriteHeader</span><span class="op" id="6491205">(</span><span class="num" id="6491206">201</span><span class="op" id="6491209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491215">w</span><span class="op" id="6491216">.</span><span class="ident" id="6491217">WriteHeader</span><span class="op" id="6491228">(</span><span class="num" id="6491229">202</span><span class="op" id="6491232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491238">w</span><span class="op" id="6491239">.</span><span class="ident" id="6491240">Write</span><span class="op" id="6491245">(</span><span class="op" id="6491246">[</span><span class="op" id="6491247">]</span><span class="builtintype" id="6491248">byte</span><span class="op" id="6491252">(</span><span class="string" id="6491253">&#34;hi&#34;</span><span class="op" id="6491257">)</span><span class="op" id="6491258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6491263">}</span><span class="op" id="6491264">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491269">check</span><span class="op" id="6491274">(</span><span class="ident" id="6491275">hasStatus</span><span class="op" id="6491284">(</span><span class="num" id="6491285">201</span><span class="op" id="6491288">)</span><span class="op" id="6491289">,</span>&nbsp;<span class="ident" id="6491291">hasContents</span><span class="op" id="6491302">(</span><span class="string" id="6491303">&#34;hi&#34;</span><span class="op" id="6491307">)</span><span class="op" id="6491308">)</span><span class="op" id="6491309">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6491313">}</span><span class="op" id="6491314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6491318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6491323">&#34;write&nbsp;sends&nbsp;200&#34;</span><span class="op" id="6491340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6491345">func</span><span class="op" id="6491349">(</span><span class="ident" id="6491350">w</span>&nbsp;<span class="ident" id="6491352">http</span><span class="op" id="6491356">.</span><span class="ident" id="6491357">ResponseWriter</span><span class="op" id="6491371">,</span>&nbsp;<span class="ident" id="6491373">r</span>&nbsp;<span class="op" id="6491375">*</span><span class="ident" id="6491376">http</span><span class="op" id="6491380">.</span><span class="ident" id="6491381">Request</span><span class="op" id="6491388">)</span>&nbsp;<span class="op" id="6491390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491396">w</span><span class="op" id="6491397">.</span><span class="ident" id="6491398">Write</span><span class="op" id="6491403">(</span><span class="op" id="6491404">[</span><span class="op" id="6491405">]</span><span class="builtintype" id="6491406">byte</span><span class="op" id="6491410">(</span><span class="string" id="6491411">&#34;hi&nbsp;first&#34;</span><span class="op" id="6491421">)</span><span class="op" id="6491422">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491428">w</span><span class="op" id="6491429">.</span><span class="ident" id="6491430">WriteHeader</span><span class="op" id="6491441">(</span><span class="num" id="6491442">201</span><span class="op" id="6491445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491451">w</span><span class="op" id="6491452">.</span><span class="ident" id="6491453">WriteHeader</span><span class="op" id="6491464">(</span><span class="num" id="6491465">202</span><span class="op" id="6491468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6491473">}</span><span class="op" id="6491474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491479">check</span><span class="op" id="6491484">(</span><span class="ident" id="6491485">hasStatus</span><span class="op" id="6491494">(</span><span class="num" id="6491495">200</span><span class="op" id="6491498">)</span><span class="op" id="6491499">,</span>&nbsp;<span class="ident" id="6491501">hasContents</span><span class="op" id="6491512">(</span><span class="string" id="6491513">&#34;hi&nbsp;first&#34;</span><span class="op" id="6491523">)</span><span class="op" id="6491524">,</span>&nbsp;<span class="ident" id="6491526">hasFlush</span><span class="op" id="6491534">(</span><span class="builtintype" id="6491535">false</span><span class="op" id="6491540">)</span><span class="op" id="6491541">)</span><span class="op" id="6491542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6491546">}</span><span class="op" id="6491547">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6491551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6491556">&#34;flush&#34;</span><span class="op" id="6491563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6491568">func</span><span class="op" id="6491572">(</span><span class="ident" id="6491573">w</span>&nbsp;<span class="ident" id="6491575">http</span><span class="op" id="6491579">.</span><span class="ident" id="6491580">ResponseWriter</span><span class="op" id="6491594">,</span>&nbsp;<span class="ident" id="6491596">r</span>&nbsp;<span class="op" id="6491598">*</span><span class="ident" id="6491599">http</span><span class="op" id="6491603">.</span><span class="ident" id="6491604">Request</span><span class="op" id="6491611">)</span>&nbsp;<span class="op" id="6491613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491619">w</span><span class="op" id="6491620">.</span><span class="op" id="6491621">(</span><span class="ident" id="6491622">http</span><span class="op" id="6491626">.</span><span class="ident" id="6491627">Flusher</span><span class="op" id="6491634">)</span><span class="op" id="6491635">.</span><span class="ident" id="6491636">Flush</span><span class="op" id="6491641">(</span><span class="op" id="6491642">)</span>&nbsp;<span class="comment" id="6491644">//&nbsp;also&nbsp;sends&nbsp;a&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491668">w</span><span class="op" id="6491669">.</span><span class="ident" id="6491670">WriteHeader</span><span class="op" id="6491681">(</span><span class="num" id="6491682">201</span><span class="op" id="6491685">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6491690">}</span><span class="op" id="6491691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491696">check</span><span class="op" id="6491701">(</span><span class="ident" id="6491702">hasStatus</span><span class="op" id="6491711">(</span><span class="num" id="6491712">200</span><span class="op" id="6491715">)</span><span class="op" id="6491716">,</span>&nbsp;<span class="ident" id="6491718">hasFlush</span><span class="op" id="6491726">(</span><span class="builtintype" id="6491727">true</span><span class="op" id="6491731">)</span><span class="op" id="6491732">)</span><span class="op" id="6491733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6491737">}</span><span class="op" id="6491738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6491741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491744">r</span><span class="op" id="6491745">,</span>&nbsp;<span class="ident" id="6491747">_</span>&nbsp;<span class="op" id="6491749">:=</span>&nbsp;<span class="ident" id="6491752">http</span><span class="op" id="6491756">.</span><span class="ident" id="6491757">NewRequest</span><span class="op" id="6491767">(</span><span class="string" id="6491768">&#34;GET&#34;</span><span class="op" id="6491773">,</span>&nbsp;<span class="string" id="6491775">&#34;http://foo.com/&#34;</span><span class="op" id="6491792">,</span>&nbsp;<span class="ident" id="6491794">nil</span><span class="op" id="6491797">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6491800">for</span>&nbsp;<span class="ident" id="6491804">_</span><span class="op" id="6491805">,</span>&nbsp;<span class="ident" id="6491807">tt</span>&nbsp;<span class="op" id="6491810">:=</span>&nbsp;<span class="keyword" id="6491813">range</span>&nbsp;<span class="ident" id="6491819">tests</span>&nbsp;<span class="op" id="6491825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491829">h</span>&nbsp;<span class="op" id="6491831">:=</span>&nbsp;<span class="ident" id="6491834">http</span><span class="op" id="6491838">.</span><span class="ident" id="6491839">HandlerFunc</span><span class="op" id="6491850">(</span><span class="ident" id="6491851">tt</span><span class="op" id="6491853">.</span><span class="ident" id="6491854">h</span><span class="op" id="6491855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491859">rec</span>&nbsp;<span class="op" id="6491863">:=</span>&nbsp;<span class="ident" id="6491866">NewRecorder</span><span class="op" id="6491877">(</span><span class="op" id="6491878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491882">h</span><span class="op" id="6491883">.</span><span class="ident" id="6491884">ServeHTTP</span><span class="op" id="6491893">(</span><span class="ident" id="6491894">rec</span><span class="op" id="6491897">,</span>&nbsp;<span class="ident" id="6491899">r</span><span class="op" id="6491900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6491904">for</span>&nbsp;<span class="ident" id="6491908">_</span><span class="op" id="6491909">,</span>&nbsp;<span class="ident" id="6491911">check</span>&nbsp;<span class="op" id="6491917">:=</span>&nbsp;<span class="keyword" id="6491920">range</span>&nbsp;<span class="ident" id="6491926">tt</span><span class="op" id="6491928">.</span><span class="ident" id="6491929">checks</span>&nbsp;<span class="op" id="6491936">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6491941">if</span>&nbsp;<span class="ident" id="6491944">err</span>&nbsp;<span class="op" id="6491948">:=</span>&nbsp;<span class="ident" id="6491951">check</span><span class="op" id="6491956">(</span><span class="ident" id="6491957">rec</span><span class="op" id="6491960">)</span><span class="op" id="6491961">;</span>&nbsp;<span class="ident" id="6491963">err</span>&nbsp;<span class="op" id="6491967">!=</span>&nbsp;<span class="ident" id="6491970">nil</span>&nbsp;<span class="op" id="6491974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491980">t</span><span class="op" id="6491981">.</span><span class="ident" id="6491982">Errorf</span><span class="op" id="6491988">(</span><span class="string" id="6491989">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="6491997">,</span>&nbsp;<span class="ident" id="6491999">tt</span><span class="op" id="6492001">.</span><span class="ident" id="6492002">name</span><span class="op" id="6492006">,</span>&nbsp;<span class="ident" id="6492008">err</span><span class="op" id="6492011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6492016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6492020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6492023">}</span><br>
<span class="lineno">90</span><span class="op" id="6492025">}</span>
</div>
</body>
</html>
