<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7172748">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7172803">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7172857">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7172908">package</span>&nbsp;<span class="ident" id="7172916">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7172921">import</span>&nbsp;<span class="op" id="7172928">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7172931">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7172940">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7172956">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7172965">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7172980">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7172991">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7173001">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7173004">//&nbsp;header,&nbsp;palette&nbsp;and&nbsp;trailer&nbsp;are&nbsp;parts&nbsp;of&nbsp;a&nbsp;valid&nbsp;2x1&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="7173071">const</span>&nbsp;<span class="op" id="7173077">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173080">headerStr</span>&nbsp;<span class="op" id="7173090">=</span>&nbsp;<span class="string" id="7173092">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="7173101">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7173105">&#34;\x02\x00\x01\x00&#34;</span>&nbsp;<span class="op" id="7173124">+</span>&nbsp;<span class="comment" id="7173126">//&nbsp;width=2,&nbsp;height=1</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7173149">&#34;\x80\x00\x00&#34;</span>&nbsp;<span class="comment" id="7173164">//&nbsp;headerFields=(a&nbsp;color&nbsp;map&nbsp;of&nbsp;2&nbsp;pixels),&nbsp;backgroundIndex,&nbsp;aspect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173232">paletteStr</span>&nbsp;<span class="op" id="7173243">=</span>&nbsp;<span class="string" id="7173245">&#34;\x10\x20\x30\x40\x50\x60&#34;</span>&nbsp;<span class="comment" id="7173272">//&nbsp;the&nbsp;color&nbsp;map,&nbsp;also&nbsp;known&nbsp;as&nbsp;a&nbsp;palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173315">trailerStr</span>&nbsp;<span class="op" id="7173326">=</span>&nbsp;<span class="string" id="7173328">&#34;\x3b&#34;</span><br>
<span class="lineno"></span><span class="op" id="7173335">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="7173338">//&nbsp;lzwEncode&nbsp;returns&nbsp;an&nbsp;LZW&nbsp;encoding&nbsp;(with&nbsp;2-bit&nbsp;literals)&nbsp;of&nbsp;n&nbsp;zeroes.</span><br>
<span class="lineno"></span><span class="keyword" id="7173410">func</span>&nbsp;<span class="ident" id="7173415">lzwEncode</span><span class="op" id="7173424">(</span><span class="ident" id="7173425">n</span>&nbsp;<span class="builtintype" id="7173427">int</span><span class="op" id="7173430">)</span>&nbsp;<span class="op" id="7173432">[</span><span class="op" id="7173433">]</span><span class="builtintype" id="7173434">byte</span>&nbsp;<span class="op" id="7173439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173442">b</span>&nbsp;<span class="op" id="7173444">:=</span>&nbsp;<span class="op" id="7173447">&amp;</span><span class="ident" id="7173448">bytes</span><span class="op" id="7173453">.</span><span class="ident" id="7173454">Buffer</span><span class="op" id="7173460">{</span><span class="op" id="7173461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173464">w</span>&nbsp;<span class="op" id="7173466">:=</span>&nbsp;<span class="ident" id="7173469">lzw</span><span class="op" id="7173472">.</span><span class="ident" id="7173473">NewWriter</span><span class="op" id="7173482">(</span><span class="ident" id="7173483">b</span><span class="op" id="7173484">,</span>&nbsp;<span class="ident" id="7173486">lzw</span><span class="op" id="7173489">.</span><span class="ident" id="7173490">LSB</span><span class="op" id="7173493">,</span>&nbsp;<span class="num" id="7173495">2</span><span class="op" id="7173496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173499">w</span><span class="op" id="7173500">.</span><span class="ident" id="7173501">Write</span><span class="op" id="7173506">(</span><span class="builtinfunc" id="7173507">make</span><span class="op" id="7173511">(</span><span class="op" id="7173512">[</span><span class="op" id="7173513">]</span><span class="builtintype" id="7173514">byte</span><span class="op" id="7173518">,</span>&nbsp;<span class="ident" id="7173520">n</span><span class="op" id="7173521">)</span><span class="op" id="7173522">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173525">w</span><span class="op" id="7173526">.</span><span class="ident" id="7173527">Close</span><span class="op" id="7173532">(</span><span class="op" id="7173533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173536">return</span>&nbsp;<span class="ident" id="7173543">b</span><span class="op" id="7173544">.</span><span class="ident" id="7173545">Bytes</span><span class="op" id="7173550">(</span><span class="op" id="7173551">)</span><br>
<span class="lineno"></span><span class="op" id="7173553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7173556">func</span>&nbsp;<span class="ident" id="7173561">TestDecode</span><span class="op" id="7173571">(</span><span class="ident" id="7173572">t</span>&nbsp;<span class="op" id="7173574">*</span><span class="ident" id="7173575">testing</span><span class="op" id="7173582">.</span><span class="ident" id="7173583">T</span><span class="op" id="7173584">)</span>&nbsp;<span class="op" id="7173586">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173589">testCases</span>&nbsp;<span class="op" id="7173599">:=</span>&nbsp;<span class="op" id="7173602">[</span><span class="op" id="7173603">]</span><span class="keyword" id="7173604">struct</span>&nbsp;<span class="op" id="7173611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173615">nPix</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7173623">int</span>&nbsp;&nbsp;<span class="comment" id="7173628">//&nbsp;The&nbsp;number&nbsp;of&nbsp;pixels&nbsp;in&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173673">extra</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7173681">bool</span>&nbsp;<span class="comment" id="7173686">//&nbsp;Whether&nbsp;to&nbsp;write&nbsp;an&nbsp;extra&nbsp;block&nbsp;after&nbsp;the&nbsp;LZW-encoded&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173751">wantErr</span>&nbsp;<span class="builtintype" id="7173759">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173766">}</span><span class="op" id="7173767">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173771">{</span><span class="num" id="7173772">0</span><span class="op" id="7173773">,</span>&nbsp;<span class="builtintype" id="7173775">false</span><span class="op" id="7173780">,</span>&nbsp;<span class="ident" id="7173782">errNotEnough</span><span class="op" id="7173794">}</span><span class="op" id="7173795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173799">{</span><span class="num" id="7173800">1</span><span class="op" id="7173801">,</span>&nbsp;<span class="builtintype" id="7173803">false</span><span class="op" id="7173808">,</span>&nbsp;<span class="ident" id="7173810">errNotEnough</span><span class="op" id="7173822">}</span><span class="op" id="7173823">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173827">{</span><span class="num" id="7173828">2</span><span class="op" id="7173829">,</span>&nbsp;<span class="builtintype" id="7173831">false</span><span class="op" id="7173836">,</span>&nbsp;<span class="ident" id="7173838">nil</span><span class="op" id="7173841">}</span><span class="op" id="7173842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173846">{</span><span class="num" id="7173847">2</span><span class="op" id="7173848">,</span>&nbsp;<span class="builtintype" id="7173850">true</span><span class="op" id="7173854">,</span>&nbsp;<span class="ident" id="7173856">errTooMuch</span><span class="op" id="7173866">}</span><span class="op" id="7173867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173871">{</span><span class="num" id="7173872">3</span><span class="op" id="7173873">,</span>&nbsp;<span class="builtintype" id="7173875">false</span><span class="op" id="7173880">,</span>&nbsp;<span class="ident" id="7173882">errTooMuch</span><span class="op" id="7173892">}</span><span class="op" id="7173893">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173899">for</span>&nbsp;<span class="ident" id="7173903">_</span><span class="op" id="7173904">,</span>&nbsp;<span class="ident" id="7173906">tc</span>&nbsp;<span class="op" id="7173909">:=</span>&nbsp;<span class="keyword" id="7173912">range</span>&nbsp;<span class="ident" id="7173918">testCases</span>&nbsp;<span class="op" id="7173928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173932">b</span>&nbsp;<span class="op" id="7173934">:=</span>&nbsp;<span class="op" id="7173937">&amp;</span><span class="ident" id="7173938">bytes</span><span class="op" id="7173943">.</span><span class="ident" id="7173944">Buffer</span><span class="op" id="7173950">{</span><span class="op" id="7173951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173955">b</span><span class="op" id="7173956">.</span><span class="ident" id="7173957">WriteString</span><span class="op" id="7173968">(</span><span class="ident" id="7173969">headerStr</span><span class="op" id="7173978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173982">b</span><span class="op" id="7173983">.</span><span class="ident" id="7173984">WriteString</span><span class="op" id="7173995">(</span><span class="ident" id="7173996">paletteStr</span><span class="op" id="7174006">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7174010">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1&nbsp;but&nbsp;tc.nPix&nbsp;pixels.&nbsp;If&nbsp;tc.nPix&nbsp;!=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7174082">//&nbsp;then&nbsp;this&nbsp;should&nbsp;result&nbsp;in&nbsp;an&nbsp;invalid&nbsp;GIF&nbsp;image.&nbsp;First,&nbsp;write&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7174151">//&nbsp;magic&nbsp;0x2c&nbsp;(image&nbsp;descriptor)&nbsp;byte,&nbsp;bounds=(0,0)-(2,1),&nbsp;a&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7174220">//&nbsp;byte,&nbsp;and&nbsp;2-bit&nbsp;LZW&nbsp;literals.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174255">b</span><span class="op" id="7174256">.</span><span class="ident" id="7174257">WriteString</span><span class="op" id="7174268">(</span><span class="string" id="7174269">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7174315">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174319">if</span>&nbsp;<span class="ident" id="7174322">tc</span><span class="op" id="7174324">.</span><span class="ident" id="7174325">nPix</span>&nbsp;<span class="op" id="7174330">&gt;</span>&nbsp;<span class="num" id="7174332">0</span>&nbsp;<span class="op" id="7174334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174339">enc</span>&nbsp;<span class="op" id="7174343">:=</span>&nbsp;<span class="ident" id="7174346">lzwEncode</span><span class="op" id="7174355">(</span><span class="ident" id="7174356">tc</span><span class="op" id="7174358">.</span><span class="ident" id="7174359">nPix</span><span class="op" id="7174363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174368">if</span>&nbsp;<span class="builtinfunc" id="7174371">len</span><span class="op" id="7174374">(</span><span class="ident" id="7174375">enc</span><span class="op" id="7174378">)</span>&nbsp;<span class="op" id="7174380">&gt;</span>&nbsp;<span class="num" id="7174382">0xff</span>&nbsp;<span class="op" id="7174387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174393">t</span><span class="op" id="7174394">.</span><span class="ident" id="7174395">Errorf</span><span class="op" id="7174401">(</span><span class="string" id="7174402">&#34;nPix=%d,&nbsp;extra=%t:&nbsp;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="7174456">,</span>&nbsp;<span class="ident" id="7174458">tc</span><span class="op" id="7174460">.</span><span class="ident" id="7174461">nPix</span><span class="op" id="7174465">,</span>&nbsp;<span class="ident" id="7174467">tc</span><span class="op" id="7174469">.</span><span class="ident" id="7174470">extra</span><span class="op" id="7174475">,</span>&nbsp;<span class="builtinfunc" id="7174477">len</span><span class="op" id="7174480">(</span><span class="ident" id="7174481">enc</span><span class="op" id="7174484">)</span><span class="op" id="7174485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174491">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174508">b</span><span class="op" id="7174509">.</span><span class="ident" id="7174510">WriteByte</span><span class="op" id="7174519">(</span><span class="builtintype" id="7174520">byte</span><span class="op" id="7174524">(</span><span class="builtinfunc" id="7174525">len</span><span class="op" id="7174528">(</span><span class="ident" id="7174529">enc</span><span class="op" id="7174532">)</span><span class="op" id="7174533">)</span><span class="op" id="7174534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174539">b</span><span class="op" id="7174540">.</span><span class="ident" id="7174541">Write</span><span class="op" id="7174546">(</span><span class="ident" id="7174547">enc</span><span class="op" id="7174550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174558">if</span>&nbsp;<span class="ident" id="7174561">tc</span><span class="op" id="7174563">.</span><span class="ident" id="7174564">extra</span>&nbsp;<span class="op" id="7174570">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174575">b</span><span class="op" id="7174576">.</span><span class="ident" id="7174577">WriteString</span><span class="op" id="7174588">(</span><span class="string" id="7174589">&#34;\x01\x02&#34;</span><span class="op" id="7174599">)</span>&nbsp;<span class="comment" id="7174601">//&nbsp;A&nbsp;1-byte&nbsp;payload&nbsp;with&nbsp;an&nbsp;0x02&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174646">b</span><span class="op" id="7174647">.</span><span class="ident" id="7174648">WriteByte</span><span class="op" id="7174657">(</span><span class="num" id="7174658">0x00</span><span class="op" id="7174662">)</span>&nbsp;<span class="comment" id="7174664">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174721">b</span><span class="op" id="7174722">.</span><span class="ident" id="7174723">WriteString</span><span class="op" id="7174734">(</span><span class="ident" id="7174735">trailerStr</span><span class="op" id="7174745">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174750">got</span><span class="op" id="7174753">,</span>&nbsp;<span class="ident" id="7174755">err</span>&nbsp;<span class="op" id="7174759">:=</span>&nbsp;<span class="ident" id="7174762">Decode</span><span class="op" id="7174768">(</span><span class="ident" id="7174769">b</span><span class="op" id="7174770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174774">if</span>&nbsp;<span class="ident" id="7174777">err</span>&nbsp;<span class="op" id="7174781">!=</span>&nbsp;<span class="ident" id="7174784">tc</span><span class="op" id="7174786">.</span><span class="ident" id="7174787">wantErr</span>&nbsp;<span class="op" id="7174795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174800">t</span><span class="op" id="7174801">.</span><span class="ident" id="7174802">Errorf</span><span class="op" id="7174808">(</span><span class="string" id="7174809">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7174846">,</span>&nbsp;<span class="ident" id="7174848">tc</span><span class="op" id="7174850">.</span><span class="ident" id="7174851">nPix</span><span class="op" id="7174855">,</span>&nbsp;<span class="ident" id="7174857">tc</span><span class="op" id="7174859">.</span><span class="ident" id="7174860">extra</span><span class="op" id="7174865">,</span>&nbsp;<span class="ident" id="7174867">err</span><span class="op" id="7174870">,</span>&nbsp;<span class="ident" id="7174872">tc</span><span class="op" id="7174874">.</span><span class="ident" id="7174875">wantErr</span><span class="op" id="7174882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174891">if</span>&nbsp;<span class="ident" id="7174894">tc</span><span class="op" id="7174896">.</span><span class="ident" id="7174897">wantErr</span>&nbsp;<span class="op" id="7174905">!=</span>&nbsp;<span class="ident" id="7174908">nil</span>&nbsp;<span class="op" id="7174912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174917">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174932">want</span>&nbsp;<span class="op" id="7174937">:=</span>&nbsp;<span class="op" id="7174940">&amp;</span><span class="ident" id="7174941">image</span><span class="op" id="7174946">.</span><span class="ident" id="7174947">Paletted</span><span class="op" id="7174955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174960">Pix</span><span class="op" id="7174963">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7174968">[</span><span class="op" id="7174969">]</span><span class="builtintype" id="7174970">uint8</span><span class="op" id="7174975">{</span><span class="num" id="7174976">0</span><span class="op" id="7174977">,</span>&nbsp;<span class="num" id="7174979">0</span><span class="op" id="7174980">}</span><span class="op" id="7174981">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174986">Stride</span><span class="op" id="7174992">:</span>&nbsp;<span class="num" id="7174994">2</span><span class="op" id="7174995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175000">Rect</span><span class="op" id="7175004">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7175008">image</span><span class="op" id="7175013">.</span><span class="ident" id="7175014">Rect</span><span class="op" id="7175018">(</span><span class="num" id="7175019">0</span><span class="op" id="7175020">,</span>&nbsp;<span class="num" id="7175022">0</span><span class="op" id="7175023">,</span>&nbsp;<span class="num" id="7175025">2</span><span class="op" id="7175026">,</span>&nbsp;<span class="num" id="7175028">1</span><span class="op" id="7175029">)</span><span class="op" id="7175030">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175035">Palette</span><span class="op" id="7175042">:</span>&nbsp;<span class="ident" id="7175044">color</span><span class="op" id="7175049">.</span><span class="ident" id="7175050">Palette</span><span class="op" id="7175057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175063">color</span><span class="op" id="7175068">.</span><span class="ident" id="7175069">RGBA</span><span class="op" id="7175073">{</span><span class="num" id="7175074">0x10</span><span class="op" id="7175078">,</span>&nbsp;<span class="num" id="7175080">0x20</span><span class="op" id="7175084">,</span>&nbsp;<span class="num" id="7175086">0x30</span><span class="op" id="7175090">,</span>&nbsp;<span class="num" id="7175092">0xff</span><span class="op" id="7175096">}</span><span class="op" id="7175097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175103">color</span><span class="op" id="7175108">.</span><span class="ident" id="7175109">RGBA</span><span class="op" id="7175113">{</span><span class="num" id="7175114">0x40</span><span class="op" id="7175118">,</span>&nbsp;<span class="num" id="7175120">0x50</span><span class="op" id="7175124">,</span>&nbsp;<span class="num" id="7175126">0x60</span><span class="op" id="7175130">,</span>&nbsp;<span class="num" id="7175132">0xff</span><span class="op" id="7175136">}</span><span class="op" id="7175137">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175142">}</span><span class="op" id="7175143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175151">if</span>&nbsp;<span class="op" id="7175154">!</span><span class="ident" id="7175155">reflect</span><span class="op" id="7175162">.</span><span class="ident" id="7175163">DeepEqual</span><span class="op" id="7175172">(</span><span class="ident" id="7175173">got</span><span class="op" id="7175176">,</span>&nbsp;<span class="ident" id="7175178">want</span><span class="op" id="7175182">)</span>&nbsp;<span class="op" id="7175184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175189">t</span><span class="op" id="7175190">.</span><span class="ident" id="7175191">Errorf</span><span class="op" id="7175197">(</span><span class="string" id="7175198">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7175235">,</span>&nbsp;<span class="ident" id="7175237">tc</span><span class="op" id="7175239">.</span><span class="ident" id="7175240">nPix</span><span class="op" id="7175244">,</span>&nbsp;<span class="ident" id="7175246">tc</span><span class="op" id="7175248">.</span><span class="ident" id="7175249">extra</span><span class="op" id="7175254">,</span>&nbsp;<span class="ident" id="7175256">got</span><span class="op" id="7175259">,</span>&nbsp;<span class="ident" id="7175261">want</span><span class="op" id="7175265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175269">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175272">}</span><br>
<span class="lineno"></span><span class="op" id="7175274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7175277">func</span>&nbsp;<span class="ident" id="7175282">TestTransparentIndex</span><span class="op" id="7175302">(</span><span class="ident" id="7175303">t</span>&nbsp;<span class="op" id="7175305">*</span><span class="ident" id="7175306">testing</span><span class="op" id="7175313">.</span><span class="ident" id="7175314">T</span><span class="op" id="7175315">)</span>&nbsp;<span class="op" id="7175317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175320">b</span>&nbsp;<span class="op" id="7175322">:=</span>&nbsp;<span class="op" id="7175325">&amp;</span><span class="ident" id="7175326">bytes</span><span class="op" id="7175331">.</span><span class="ident" id="7175332">Buffer</span><span class="op" id="7175338">{</span><span class="op" id="7175339">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175342">b</span><span class="op" id="7175343">.</span><span class="ident" id="7175344">WriteString</span><span class="op" id="7175355">(</span><span class="ident" id="7175356">headerStr</span><span class="op" id="7175365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175368">b</span><span class="op" id="7175369">.</span><span class="ident" id="7175370">WriteString</span><span class="op" id="7175381">(</span><span class="ident" id="7175382">paletteStr</span><span class="op" id="7175392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175395">for</span>&nbsp;<span class="ident" id="7175399">transparentIndex</span>&nbsp;<span class="op" id="7175416">:=</span>&nbsp;<span class="num" id="7175419">0</span><span class="op" id="7175420">;</span>&nbsp;<span class="ident" id="7175422">transparentIndex</span>&nbsp;<span class="op" id="7175439">&lt;</span>&nbsp;<span class="num" id="7175441">3</span><span class="op" id="7175442">;</span>&nbsp;<span class="ident" id="7175444">transparentIndex</span><span class="op" id="7175460">++</span>&nbsp;<span class="op" id="7175463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175467">if</span>&nbsp;<span class="ident" id="7175470">transparentIndex</span>&nbsp;<span class="op" id="7175487">&lt;</span>&nbsp;<span class="num" id="7175489">2</span>&nbsp;<span class="op" id="7175491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7175496">//&nbsp;Write&nbsp;the&nbsp;graphic&nbsp;control&nbsp;for&nbsp;the&nbsp;transparent&nbsp;index.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175555">b</span><span class="op" id="7175556">.</span><span class="ident" id="7175557">WriteString</span><span class="op" id="7175568">(</span><span class="string" id="7175569">&#34;\x21\xf9\x00\x01\x00\x00&#34;</span><span class="op" id="7175595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175600">b</span><span class="op" id="7175601">.</span><span class="ident" id="7175602">WriteByte</span><span class="op" id="7175611">(</span><span class="builtintype" id="7175612">byte</span><span class="op" id="7175616">(</span><span class="ident" id="7175617">transparentIndex</span><span class="op" id="7175633">)</span><span class="op" id="7175634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175639">b</span><span class="op" id="7175640">.</span><span class="ident" id="7175641">WriteByte</span><span class="op" id="7175650">(</span><span class="num" id="7175651">0</span><span class="op" id="7175652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7175660">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1,&nbsp;as&nbsp;per&nbsp;TestDecode.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175716">b</span><span class="op" id="7175717">.</span><span class="ident" id="7175718">WriteString</span><span class="op" id="7175729">(</span><span class="string" id="7175730">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7175776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175780">enc</span>&nbsp;<span class="op" id="7175784">:=</span>&nbsp;<span class="ident" id="7175787">lzwEncode</span><span class="op" id="7175796">(</span><span class="num" id="7175797">2</span><span class="op" id="7175798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175802">if</span>&nbsp;<span class="builtinfunc" id="7175805">len</span><span class="op" id="7175808">(</span><span class="ident" id="7175809">enc</span><span class="op" id="7175812">)</span>&nbsp;<span class="op" id="7175814">&gt;</span>&nbsp;<span class="num" id="7175816">0xff</span>&nbsp;<span class="op" id="7175821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175826">t</span><span class="op" id="7175827">.</span><span class="ident" id="7175828">Fatalf</span><span class="op" id="7175834">(</span><span class="string" id="7175835">&#34;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="7175870">,</span>&nbsp;<span class="builtinfunc" id="7175872">len</span><span class="op" id="7175875">(</span><span class="ident" id="7175876">enc</span><span class="op" id="7175879">)</span><span class="op" id="7175880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175884">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175888">b</span><span class="op" id="7175889">.</span><span class="ident" id="7175890">WriteByte</span><span class="op" id="7175899">(</span><span class="builtintype" id="7175900">byte</span><span class="op" id="7175904">(</span><span class="builtinfunc" id="7175905">len</span><span class="op" id="7175908">(</span><span class="ident" id="7175909">enc</span><span class="op" id="7175912">)</span><span class="op" id="7175913">)</span><span class="op" id="7175914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175918">b</span><span class="op" id="7175919">.</span><span class="ident" id="7175920">Write</span><span class="op" id="7175925">(</span><span class="ident" id="7175926">enc</span><span class="op" id="7175929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175933">b</span><span class="op" id="7175934">.</span><span class="ident" id="7175935">WriteByte</span><span class="op" id="7175944">(</span><span class="num" id="7175945">0x00</span><span class="op" id="7175949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175955">b</span><span class="op" id="7175956">.</span><span class="ident" id="7175957">WriteString</span><span class="op" id="7175968">(</span><span class="ident" id="7175969">trailerStr</span><span class="op" id="7175979">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175983">g</span><span class="op" id="7175984">,</span>&nbsp;<span class="ident" id="7175986">err</span>&nbsp;<span class="op" id="7175990">:=</span>&nbsp;<span class="ident" id="7175993">DecodeAll</span><span class="op" id="7176002">(</span><span class="ident" id="7176003">b</span><span class="op" id="7176004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176007">if</span>&nbsp;<span class="ident" id="7176010">err</span>&nbsp;<span class="op" id="7176014">!=</span>&nbsp;<span class="ident" id="7176017">nil</span>&nbsp;<span class="op" id="7176021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176025">t</span><span class="op" id="7176026">.</span><span class="ident" id="7176027">Fatalf</span><span class="op" id="7176033">(</span><span class="string" id="7176034">&#34;DecodeAll:&nbsp;%v&#34;</span><span class="op" id="7176049">,</span>&nbsp;<span class="ident" id="7176051">err</span><span class="op" id="7176054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176057">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176060">c0</span>&nbsp;<span class="op" id="7176063">:=</span>&nbsp;<span class="ident" id="7176066">color</span><span class="op" id="7176071">.</span><span class="ident" id="7176072">RGBA</span><span class="op" id="7176076">{</span><span class="ident" id="7176077">paletteStr</span><span class="op" id="7176087">[</span><span class="num" id="7176088">0</span><span class="op" id="7176089">]</span><span class="op" id="7176090">,</span>&nbsp;<span class="ident" id="7176092">paletteStr</span><span class="op" id="7176102">[</span><span class="num" id="7176103">1</span><span class="op" id="7176104">]</span><span class="op" id="7176105">,</span>&nbsp;<span class="ident" id="7176107">paletteStr</span><span class="op" id="7176117">[</span><span class="num" id="7176118">2</span><span class="op" id="7176119">]</span><span class="op" id="7176120">,</span>&nbsp;<span class="num" id="7176122">0xff</span><span class="op" id="7176126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176129">c1</span>&nbsp;<span class="op" id="7176132">:=</span>&nbsp;<span class="ident" id="7176135">color</span><span class="op" id="7176140">.</span><span class="ident" id="7176141">RGBA</span><span class="op" id="7176145">{</span><span class="ident" id="7176146">paletteStr</span><span class="op" id="7176156">[</span><span class="num" id="7176157">3</span><span class="op" id="7176158">]</span><span class="op" id="7176159">,</span>&nbsp;<span class="ident" id="7176161">paletteStr</span><span class="op" id="7176171">[</span><span class="num" id="7176172">4</span><span class="op" id="7176173">]</span><span class="op" id="7176174">,</span>&nbsp;<span class="ident" id="7176176">paletteStr</span><span class="op" id="7176186">[</span><span class="num" id="7176187">5</span><span class="op" id="7176188">]</span><span class="op" id="7176189">,</span>&nbsp;<span class="num" id="7176191">0xff</span><span class="op" id="7176195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176198">cz</span>&nbsp;<span class="op" id="7176201">:=</span>&nbsp;<span class="ident" id="7176204">color</span><span class="op" id="7176209">.</span><span class="ident" id="7176210">RGBA</span><span class="op" id="7176214">{</span><span class="op" id="7176215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176218">wants</span>&nbsp;<span class="op" id="7176224">:=</span>&nbsp;<span class="op" id="7176227">[</span><span class="op" id="7176228">]</span><span class="ident" id="7176229">color</span><span class="op" id="7176234">.</span><span class="ident" id="7176235">Palette</span><span class="op" id="7176242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176246">{</span><span class="ident" id="7176247">cz</span><span class="op" id="7176249">,</span>&nbsp;<span class="ident" id="7176251">c1</span><span class="op" id="7176253">}</span><span class="op" id="7176254">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176258">{</span><span class="ident" id="7176259">c0</span><span class="op" id="7176261">,</span>&nbsp;<span class="ident" id="7176263">cz</span><span class="op" id="7176265">}</span><span class="op" id="7176266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176270">{</span><span class="ident" id="7176271">c0</span><span class="op" id="7176273">,</span>&nbsp;<span class="ident" id="7176275">c1</span><span class="op" id="7176277">}</span><span class="op" id="7176278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176284">if</span>&nbsp;<span class="builtinfunc" id="7176287">len</span><span class="op" id="7176290">(</span><span class="ident" id="7176291">g</span><span class="op" id="7176292">.</span><span class="ident" id="7176293">Image</span><span class="op" id="7176298">)</span>&nbsp;<span class="op" id="7176300">!=</span>&nbsp;<span class="builtinfunc" id="7176303">len</span><span class="op" id="7176306">(</span><span class="ident" id="7176307">wants</span><span class="op" id="7176312">)</span>&nbsp;<span class="op" id="7176314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176318">t</span><span class="op" id="7176319">.</span><span class="ident" id="7176320">Fatalf</span><span class="op" id="7176326">(</span><span class="string" id="7176327">&#34;got&nbsp;%d&nbsp;images,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7176351">,</span>&nbsp;<span class="builtinfunc" id="7176353">len</span><span class="op" id="7176356">(</span><span class="ident" id="7176357">g</span><span class="op" id="7176358">.</span><span class="ident" id="7176359">Image</span><span class="op" id="7176364">)</span><span class="op" id="7176365">,</span>&nbsp;<span class="builtinfunc" id="7176367">len</span><span class="op" id="7176370">(</span><span class="ident" id="7176371">wants</span><span class="op" id="7176376">)</span><span class="op" id="7176377">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176383">for</span>&nbsp;<span class="ident" id="7176387">i</span><span class="op" id="7176388">,</span>&nbsp;<span class="ident" id="7176390">want</span>&nbsp;<span class="op" id="7176395">:=</span>&nbsp;<span class="keyword" id="7176398">range</span>&nbsp;<span class="ident" id="7176404">wants</span>&nbsp;<span class="op" id="7176410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176414">got</span>&nbsp;<span class="op" id="7176418">:=</span>&nbsp;<span class="ident" id="7176421">g</span><span class="op" id="7176422">.</span><span class="ident" id="7176423">Image</span><span class="op" id="7176428">[</span><span class="ident" id="7176429">i</span><span class="op" id="7176430">]</span><span class="op" id="7176431">.</span><span class="ident" id="7176432">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176442">if</span>&nbsp;<span class="op" id="7176445">!</span><span class="ident" id="7176446">reflect</span><span class="op" id="7176453">.</span><span class="ident" id="7176454">DeepEqual</span><span class="op" id="7176463">(</span><span class="ident" id="7176464">got</span><span class="op" id="7176467">,</span>&nbsp;<span class="ident" id="7176469">want</span><span class="op" id="7176473">)</span>&nbsp;<span class="op" id="7176475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176480">t</span><span class="op" id="7176481">.</span><span class="ident" id="7176482">Errorf</span><span class="op" id="7176488">(</span><span class="string" id="7176489">&#34;palette&nbsp;#%d:\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7176521">,</span>&nbsp;<span class="ident" id="7176523">i</span><span class="op" id="7176524">,</span>&nbsp;<span class="ident" id="7176526">got</span><span class="op" id="7176529">,</span>&nbsp;<span class="ident" id="7176531">want</span><span class="op" id="7176535">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176542">}</span><br>
<span class="lineno"></span><span class="op" id="7176544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7176547">//&nbsp;testGIF&nbsp;is&nbsp;a&nbsp;simple&nbsp;GIF&nbsp;that&nbsp;we&nbsp;can&nbsp;modify&nbsp;to&nbsp;test&nbsp;different&nbsp;scenarios.</span><br>
<span class="lineno">140</span><span class="keyword" id="7176622">var</span>&nbsp;<span class="ident" id="7176626">testGIF</span>&nbsp;<span class="op" id="7176634">=</span>&nbsp;<span class="op" id="7176636">[</span><span class="op" id="7176637">]</span><span class="builtintype" id="7176638">byte</span><span class="op" id="7176642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7176645">&#39;G&#39;</span><span class="op" id="7176648">,</span>&nbsp;<span class="string" id="7176650">&#39;I&#39;</span><span class="op" id="7176653">,</span>&nbsp;<span class="string" id="7176655">&#39;F&#39;</span><span class="op" id="7176658">,</span>&nbsp;<span class="string" id="7176660">&#39;8&#39;</span><span class="op" id="7176663">,</span>&nbsp;<span class="string" id="7176665">&#39;9&#39;</span><span class="op" id="7176668">,</span>&nbsp;<span class="string" id="7176670">&#39;a&#39;</span><span class="op" id="7176673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7176676">1</span><span class="op" id="7176677">,</span>&nbsp;<span class="num" id="7176679">0</span><span class="op" id="7176680">,</span>&nbsp;<span class="num" id="7176682">1</span><span class="op" id="7176683">,</span>&nbsp;<span class="num" id="7176685">0</span><span class="op" id="7176686">,</span>&nbsp;<span class="comment" id="7176688">//&nbsp;w=1,&nbsp;h=1&nbsp;(6)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7176705">128</span><span class="op" id="7176708">,</span>&nbsp;<span class="num" id="7176710">0</span><span class="op" id="7176711">,</span>&nbsp;<span class="num" id="7176713">0</span><span class="op" id="7176714">,</span>&nbsp;<span class="comment" id="7176716">//&nbsp;headerFields,&nbsp;bg,&nbsp;aspect&nbsp;(10)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7176750">0</span><span class="op" id="7176751">,</span>&nbsp;<span class="num" id="7176753">0</span><span class="op" id="7176754">,</span>&nbsp;<span class="num" id="7176756">0</span><span class="op" id="7176757">,</span>&nbsp;<span class="num" id="7176759">1</span><span class="op" id="7176760">,</span>&nbsp;<span class="num" id="7176762">1</span><span class="op" id="7176763">,</span>&nbsp;<span class="num" id="7176765">1</span><span class="op" id="7176766">,</span>&nbsp;<span class="comment" id="7176768">//&nbsp;color&nbsp;map&nbsp;and&nbsp;graphics&nbsp;control&nbsp;(13)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7176808">0x21</span><span class="op" id="7176812">,</span>&nbsp;<span class="num" id="7176814">0xf9</span><span class="op" id="7176818">,</span>&nbsp;<span class="num" id="7176820">0x04</span><span class="op" id="7176824">,</span>&nbsp;<span class="num" id="7176826">0x00</span><span class="op" id="7176830">,</span>&nbsp;<span class="num" id="7176832">0x00</span><span class="op" id="7176836">,</span>&nbsp;<span class="num" id="7176838">0x00</span><span class="op" id="7176842">,</span>&nbsp;<span class="num" id="7176844">0xff</span><span class="op" id="7176848">,</span>&nbsp;<span class="num" id="7176850">0x00</span><span class="op" id="7176854">,</span>&nbsp;<span class="comment" id="7176856">//&nbsp;(19)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7176865">//&nbsp;frame&nbsp;1&nbsp;(0,0&nbsp;-&nbsp;1,1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7176889">0x2c</span><span class="op" id="7176893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7176896">0x00</span><span class="op" id="7176900">,</span>&nbsp;<span class="num" id="7176902">0x00</span><span class="op" id="7176906">,</span>&nbsp;<span class="num" id="7176908">0x00</span><span class="op" id="7176912">,</span>&nbsp;<span class="num" id="7176914">0x00</span><span class="op" id="7176918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7176921">0x01</span><span class="op" id="7176925">,</span>&nbsp;<span class="num" id="7176927">0x00</span><span class="op" id="7176931">,</span>&nbsp;<span class="num" id="7176933">0x01</span><span class="op" id="7176937">,</span>&nbsp;<span class="num" id="7176939">0x00</span><span class="op" id="7176943">,</span>&nbsp;<span class="comment" id="7176945">//&nbsp;(32)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7176954">0x00</span><span class="op" id="7176958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7176961">0x02</span><span class="op" id="7176965">,</span>&nbsp;<span class="num" id="7176967">0x02</span><span class="op" id="7176971">,</span>&nbsp;<span class="num" id="7176973">0x4c</span><span class="op" id="7176977">,</span>&nbsp;<span class="num" id="7176979">0x01</span><span class="op" id="7176983">,</span>&nbsp;<span class="num" id="7176985">0x00</span><span class="op" id="7176989">,</span>&nbsp;<span class="comment" id="7176991">//&nbsp;lzw&nbsp;pixels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7177006">//&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7177018">0x3b</span><span class="op" id="7177022">,</span><br>
<span class="lineno"></span><span class="op" id="7177024">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="7177027">func</span>&nbsp;<span class="ident" id="7177032">try</span><span class="op" id="7177035">(</span><span class="ident" id="7177036">t</span>&nbsp;<span class="op" id="7177038">*</span><span class="ident" id="7177039">testing</span><span class="op" id="7177046">.</span><span class="ident" id="7177047">T</span><span class="op" id="7177048">,</span>&nbsp;<span class="ident" id="7177050">b</span>&nbsp;<span class="op" id="7177052">[</span><span class="op" id="7177053">]</span><span class="builtintype" id="7177054">byte</span><span class="op" id="7177058">,</span>&nbsp;<span class="ident" id="7177060">want</span>&nbsp;<span class="builtintype" id="7177065">string</span><span class="op" id="7177071">)</span>&nbsp;<span class="op" id="7177073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177076">_</span><span class="op" id="7177077">,</span>&nbsp;<span class="ident" id="7177079">err</span>&nbsp;<span class="op" id="7177083">:=</span>&nbsp;<span class="ident" id="7177086">DecodeAll</span><span class="op" id="7177095">(</span><span class="ident" id="7177096">bytes</span><span class="op" id="7177101">.</span><span class="ident" id="7177102">NewReader</span><span class="op" id="7177111">(</span><span class="ident" id="7177112">b</span><span class="op" id="7177113">)</span><span class="op" id="7177114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177117">var</span>&nbsp;<span class="ident" id="7177121">got</span>&nbsp;<span class="builtintype" id="7177125">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177133">if</span>&nbsp;<span class="ident" id="7177136">err</span>&nbsp;<span class="op" id="7177140">!=</span>&nbsp;<span class="ident" id="7177143">nil</span>&nbsp;<span class="op" id="7177147">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177151">got</span>&nbsp;<span class="op" id="7177155">=</span>&nbsp;<span class="ident" id="7177157">err</span><span class="op" id="7177160">.</span><span class="ident" id="7177161">Error</span><span class="op" id="7177166">(</span><span class="op" id="7177167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177173">if</span>&nbsp;<span class="ident" id="7177176">got</span>&nbsp;<span class="op" id="7177180">!=</span>&nbsp;<span class="ident" id="7177183">want</span>&nbsp;<span class="op" id="7177188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177192">t</span><span class="op" id="7177193">.</span><span class="ident" id="7177194">Fatalf</span><span class="op" id="7177200">(</span><span class="string" id="7177201">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7177218">,</span>&nbsp;<span class="ident" id="7177220">got</span><span class="op" id="7177223">,</span>&nbsp;<span class="ident" id="7177225">want</span><span class="op" id="7177229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177232">}</span><br>
<span class="lineno">165</span><span class="op" id="7177234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7177237">func</span>&nbsp;<span class="ident" id="7177242">TestBounds</span><span class="op" id="7177252">(</span><span class="ident" id="7177253">t</span>&nbsp;<span class="op" id="7177255">*</span><span class="ident" id="7177256">testing</span><span class="op" id="7177263">.</span><span class="ident" id="7177264">T</span><span class="op" id="7177265">)</span>&nbsp;<span class="op" id="7177267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7177270">//&nbsp;Make&nbsp;a&nbsp;local&nbsp;copy&nbsp;of&nbsp;testGIF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177304">gif</span>&nbsp;<span class="op" id="7177308">:=</span>&nbsp;<span class="builtinfunc" id="7177311">make</span><span class="op" id="7177315">(</span><span class="op" id="7177316">[</span><span class="op" id="7177317">]</span><span class="builtintype" id="7177318">byte</span><span class="op" id="7177322">,</span>&nbsp;<span class="builtinfunc" id="7177324">len</span><span class="op" id="7177327">(</span><span class="ident" id="7177328">testGIF</span><span class="op" id="7177335">)</span><span class="op" id="7177336">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7177339">copy</span><span class="op" id="7177343">(</span><span class="ident" id="7177344">gif</span><span class="op" id="7177347">,</span>&nbsp;<span class="ident" id="7177349">testGIF</span><span class="op" id="7177356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7177359">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;big,&nbsp;just&nbsp;by&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177401">gif</span><span class="op" id="7177404">[</span><span class="num" id="7177405">32</span><span class="op" id="7177407">]</span>&nbsp;<span class="op" id="7177409">=</span>&nbsp;<span class="num" id="7177411">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177414">want</span>&nbsp;<span class="op" id="7177419">:=</span>&nbsp;<span class="string" id="7177422">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177468">try</span><span class="op" id="7177471">(</span><span class="ident" id="7177472">t</span><span class="op" id="7177473">,</span>&nbsp;<span class="ident" id="7177475">gif</span><span class="op" id="7177478">,</span>&nbsp;<span class="ident" id="7177480">want</span><span class="op" id="7177484">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7177488">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;small;&nbsp;does&nbsp;not&nbsp;trigger&nbsp;bounds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7177543">//&nbsp;check,&nbsp;but&nbsp;now&nbsp;there&#39;s&nbsp;too&nbsp;much&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177585">gif</span><span class="op" id="7177588">[</span><span class="num" id="7177589">32</span><span class="op" id="7177591">]</span>&nbsp;<span class="op" id="7177593">=</span>&nbsp;<span class="num" id="7177595">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177598">want</span>&nbsp;<span class="op" id="7177603">=</span>&nbsp;<span class="string" id="7177605">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177633">try</span><span class="op" id="7177636">(</span><span class="ident" id="7177637">t</span><span class="op" id="7177638">,</span>&nbsp;<span class="ident" id="7177640">gif</span><span class="op" id="7177643">,</span>&nbsp;<span class="ident" id="7177645">want</span><span class="op" id="7177649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177652">gif</span><span class="op" id="7177655">[</span><span class="num" id="7177656">32</span><span class="op" id="7177658">]</span>&nbsp;<span class="op" id="7177660">=</span>&nbsp;<span class="num" id="7177662">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7177666">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;really&nbsp;big,&nbsp;expect&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177715">want</span>&nbsp;<span class="op" id="7177720">=</span>&nbsp;<span class="string" id="7177722">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177768">for</span>&nbsp;<span class="ident" id="7177772">i</span>&nbsp;<span class="op" id="7177774">:=</span>&nbsp;<span class="num" id="7177777">0</span><span class="op" id="7177778">;</span>&nbsp;<span class="ident" id="7177780">i</span>&nbsp;<span class="op" id="7177782">&lt;</span>&nbsp;<span class="num" id="7177784">4</span><span class="op" id="7177785">;</span>&nbsp;<span class="ident" id="7177787">i</span><span class="op" id="7177788">++</span>&nbsp;<span class="op" id="7177791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177795">gif</span><span class="op" id="7177798">[</span><span class="num" id="7177799">32</span><span class="op" id="7177801">+</span><span class="ident" id="7177802">i</span><span class="op" id="7177803">]</span>&nbsp;<span class="op" id="7177805">=</span>&nbsp;<span class="num" id="7177807">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177816">try</span><span class="op" id="7177819">(</span><span class="ident" id="7177820">t</span><span class="op" id="7177821">,</span>&nbsp;<span class="ident" id="7177823">gif</span><span class="op" id="7177826">,</span>&nbsp;<span class="ident" id="7177828">want</span><span class="op" id="7177832">)</span><br>
<span class="lineno"></span><span class="op" id="7177834">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="7177837">func</span>&nbsp;<span class="ident" id="7177842">TestNoPalette</span><span class="op" id="7177855">(</span><span class="ident" id="7177856">t</span>&nbsp;<span class="op" id="7177858">*</span><span class="ident" id="7177859">testing</span><span class="op" id="7177866">.</span><span class="ident" id="7177867">T</span><span class="op" id="7177868">)</span>&nbsp;<span class="op" id="7177870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177873">b</span>&nbsp;<span class="op" id="7177875">:=</span>&nbsp;<span class="op" id="7177878">&amp;</span><span class="ident" id="7177879">bytes</span><span class="op" id="7177884">.</span><span class="ident" id="7177885">Buffer</span><span class="op" id="7177891">{</span><span class="op" id="7177892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7177896">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;no&nbsp;palette,&nbsp;so&nbsp;any&nbsp;pixel&nbsp;at&nbsp;all</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7177955">//&nbsp;will&nbsp;be&nbsp;invalid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177976">b</span><span class="op" id="7177977">.</span><span class="ident" id="7177978">WriteString</span><span class="op" id="7177989">(</span><span class="ident" id="7177990">headerStr</span><span class="op" id="7177999">[</span><span class="op" id="7178000">:</span><span class="builtinfunc" id="7178001">len</span><span class="op" id="7178004">(</span><span class="ident" id="7178005">headerStr</span><span class="op" id="7178014">)</span><span class="op" id="7178015">-</span><span class="num" id="7178016">3</span><span class="op" id="7178017">]</span><span class="op" id="7178018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178021">b</span><span class="op" id="7178022">.</span><span class="ident" id="7178023">WriteString</span><span class="op" id="7178034">(</span><span class="string" id="7178035">&#34;\x00\x00\x00&#34;</span><span class="op" id="7178049">)</span>&nbsp;<span class="comment" id="7178051">//&nbsp;No&nbsp;global&nbsp;palette.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7178075">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178120">b</span><span class="op" id="7178121">.</span><span class="ident" id="7178122">WriteString</span><span class="op" id="7178133">(</span><span class="string" id="7178134">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7178180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7178184">//&nbsp;Encode&nbsp;the&nbsp;pixels:&nbsp;neither&nbsp;is&nbsp;in&nbsp;range,&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178257">pix</span>&nbsp;<span class="op" id="7178261">:=</span>&nbsp;<span class="op" id="7178264">[</span><span class="op" id="7178265">]</span><span class="builtintype" id="7178266">byte</span><span class="op" id="7178270">{</span><span class="num" id="7178271">0</span><span class="op" id="7178272">,</span>&nbsp;<span class="num" id="7178274">128</span><span class="op" id="7178277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178280">enc</span>&nbsp;<span class="op" id="7178284">:=</span>&nbsp;<span class="op" id="7178287">&amp;</span><span class="ident" id="7178288">bytes</span><span class="op" id="7178293">.</span><span class="ident" id="7178294">Buffer</span><span class="op" id="7178300">{</span><span class="op" id="7178301">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178304">w</span>&nbsp;<span class="op" id="7178306">:=</span>&nbsp;<span class="ident" id="7178309">lzw</span><span class="op" id="7178312">.</span><span class="ident" id="7178313">NewWriter</span><span class="op" id="7178322">(</span><span class="ident" id="7178323">enc</span><span class="op" id="7178326">,</span>&nbsp;<span class="ident" id="7178328">lzw</span><span class="op" id="7178331">.</span><span class="ident" id="7178332">LSB</span><span class="op" id="7178335">,</span>&nbsp;<span class="num" id="7178337">2</span><span class="op" id="7178338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178341">w</span><span class="op" id="7178342">.</span><span class="ident" id="7178343">Write</span><span class="op" id="7178348">(</span><span class="ident" id="7178349">pix</span><span class="op" id="7178352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178355">w</span><span class="op" id="7178356">.</span><span class="ident" id="7178357">Close</span><span class="op" id="7178362">(</span><span class="op" id="7178363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178366">b</span><span class="op" id="7178367">.</span><span class="ident" id="7178368">WriteByte</span><span class="op" id="7178377">(</span><span class="builtintype" id="7178378">byte</span><span class="op" id="7178382">(</span><span class="builtinfunc" id="7178383">len</span><span class="op" id="7178386">(</span><span class="ident" id="7178387">enc</span><span class="op" id="7178390">.</span><span class="ident" id="7178391">Bytes</span><span class="op" id="7178396">(</span><span class="op" id="7178397">)</span><span class="op" id="7178398">)</span><span class="op" id="7178399">)</span><span class="op" id="7178400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178403">b</span><span class="op" id="7178404">.</span><span class="ident" id="7178405">Write</span><span class="op" id="7178410">(</span><span class="ident" id="7178411">enc</span><span class="op" id="7178414">.</span><span class="ident" id="7178415">Bytes</span><span class="op" id="7178420">(</span><span class="op" id="7178421">)</span><span class="op" id="7178422">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178425">b</span><span class="op" id="7178426">.</span><span class="ident" id="7178427">WriteByte</span><span class="op" id="7178436">(</span><span class="num" id="7178437">0x00</span><span class="op" id="7178441">)</span>&nbsp;<span class="comment" id="7178443">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178500">b</span><span class="op" id="7178501">.</span><span class="ident" id="7178502">WriteString</span><span class="op" id="7178513">(</span><span class="ident" id="7178514">trailerStr</span><span class="op" id="7178524">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178528">try</span><span class="op" id="7178531">(</span><span class="ident" id="7178532">t</span><span class="op" id="7178533">,</span>&nbsp;<span class="ident" id="7178535">b</span><span class="op" id="7178536">.</span><span class="ident" id="7178537">Bytes</span><span class="op" id="7178542">(</span><span class="op" id="7178543">)</span><span class="op" id="7178544">,</span>&nbsp;<span class="string" id="7178546">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="7178572">)</span><br>
<span class="lineno">215</span><span class="op" id="7178574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7178577">func</span>&nbsp;<span class="ident" id="7178582">TestPixelOutsidePaletteRange</span><span class="op" id="7178610">(</span><span class="ident" id="7178611">t</span>&nbsp;<span class="op" id="7178613">*</span><span class="ident" id="7178614">testing</span><span class="op" id="7178621">.</span><span class="ident" id="7178622">T</span><span class="op" id="7178623">)</span>&nbsp;<span class="op" id="7178625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7178628">for</span>&nbsp;<span class="ident" id="7178632">_</span><span class="op" id="7178633">,</span>&nbsp;<span class="ident" id="7178635">pval</span>&nbsp;<span class="op" id="7178640">:=</span>&nbsp;<span class="keyword" id="7178643">range</span>&nbsp;<span class="op" id="7178649">[</span><span class="op" id="7178650">]</span><span class="builtintype" id="7178651">byte</span><span class="op" id="7178655">{</span><span class="num" id="7178656">0</span><span class="op" id="7178657">,</span>&nbsp;<span class="num" id="7178659">1</span><span class="op" id="7178660">,</span>&nbsp;<span class="num" id="7178662">2</span><span class="op" id="7178663">,</span>&nbsp;<span class="num" id="7178665">3</span><span class="op" id="7178666">,</span>&nbsp;<span class="num" id="7178668">255</span><span class="op" id="7178671">}</span>&nbsp;<span class="op" id="7178673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178677">b</span>&nbsp;<span class="op" id="7178679">:=</span>&nbsp;<span class="op" id="7178682">&amp;</span><span class="ident" id="7178683">bytes</span><span class="op" id="7178688">.</span><span class="ident" id="7178689">Buffer</span><span class="op" id="7178695">{</span><span class="op" id="7178696">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7178701">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;a&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178748">b</span><span class="op" id="7178749">.</span><span class="ident" id="7178750">WriteString</span><span class="op" id="7178761">(</span><span class="ident" id="7178762">headerStr</span><span class="op" id="7178771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178775">b</span><span class="op" id="7178776">.</span><span class="ident" id="7178777">WriteString</span><span class="op" id="7178788">(</span><span class="ident" id="7178789">paletteStr</span><span class="op" id="7178799">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7178804">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178850">b</span><span class="op" id="7178851">.</span><span class="ident" id="7178852">WriteString</span><span class="op" id="7178863">(</span><span class="string" id="7178864">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7178910">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7178915">//&nbsp;Encode&nbsp;the&nbsp;pixels;&nbsp;some&nbsp;pvals&nbsp;trigger&nbsp;the&nbsp;expected&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178978">pix</span>&nbsp;<span class="op" id="7178982">:=</span>&nbsp;<span class="op" id="7178985">[</span><span class="op" id="7178986">]</span><span class="builtintype" id="7178987">byte</span><span class="op" id="7178991">{</span><span class="ident" id="7178992">pval</span><span class="op" id="7178996">,</span>&nbsp;<span class="ident" id="7178998">pval</span><span class="op" id="7179002">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179006">enc</span>&nbsp;<span class="op" id="7179010">:=</span>&nbsp;<span class="op" id="7179013">&amp;</span><span class="ident" id="7179014">bytes</span><span class="op" id="7179019">.</span><span class="ident" id="7179020">Buffer</span><span class="op" id="7179026">{</span><span class="op" id="7179027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179031">w</span>&nbsp;<span class="op" id="7179033">:=</span>&nbsp;<span class="ident" id="7179036">lzw</span><span class="op" id="7179039">.</span><span class="ident" id="7179040">NewWriter</span><span class="op" id="7179049">(</span><span class="ident" id="7179050">enc</span><span class="op" id="7179053">,</span>&nbsp;<span class="ident" id="7179055">lzw</span><span class="op" id="7179058">.</span><span class="ident" id="7179059">LSB</span><span class="op" id="7179062">,</span>&nbsp;<span class="num" id="7179064">2</span><span class="op" id="7179065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179069">w</span><span class="op" id="7179070">.</span><span class="ident" id="7179071">Write</span><span class="op" id="7179076">(</span><span class="ident" id="7179077">pix</span><span class="op" id="7179080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179084">w</span><span class="op" id="7179085">.</span><span class="ident" id="7179086">Close</span><span class="op" id="7179091">(</span><span class="op" id="7179092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179096">b</span><span class="op" id="7179097">.</span><span class="ident" id="7179098">WriteByte</span><span class="op" id="7179107">(</span><span class="builtintype" id="7179108">byte</span><span class="op" id="7179112">(</span><span class="builtinfunc" id="7179113">len</span><span class="op" id="7179116">(</span><span class="ident" id="7179117">enc</span><span class="op" id="7179120">.</span><span class="ident" id="7179121">Bytes</span><span class="op" id="7179126">(</span><span class="op" id="7179127">)</span><span class="op" id="7179128">)</span><span class="op" id="7179129">)</span><span class="op" id="7179130">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179134">b</span><span class="op" id="7179135">.</span><span class="ident" id="7179136">Write</span><span class="op" id="7179141">(</span><span class="ident" id="7179142">enc</span><span class="op" id="7179145">.</span><span class="ident" id="7179146">Bytes</span><span class="op" id="7179151">(</span><span class="op" id="7179152">)</span><span class="op" id="7179153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179157">b</span><span class="op" id="7179158">.</span><span class="ident" id="7179159">WriteByte</span><span class="op" id="7179168">(</span><span class="num" id="7179169">0x00</span><span class="op" id="7179173">)</span>&nbsp;<span class="comment" id="7179175">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179233">b</span><span class="op" id="7179234">.</span><span class="ident" id="7179235">WriteString</span><span class="op" id="7179246">(</span><span class="ident" id="7179247">trailerStr</span><span class="op" id="7179257">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7179262">//&nbsp;No&nbsp;error&nbsp;expected,&nbsp;unless&nbsp;the&nbsp;pixels&nbsp;are&nbsp;beyond&nbsp;the&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179336">want</span>&nbsp;<span class="op" id="7179341">:=</span>&nbsp;<span class="string" id="7179344">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7179349">if</span>&nbsp;<span class="ident" id="7179352">pval</span>&nbsp;<span class="op" id="7179357">&gt;=</span>&nbsp;<span class="num" id="7179360">2</span>&nbsp;<span class="op" id="7179362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179367">want</span>&nbsp;<span class="op" id="7179372">=</span>&nbsp;<span class="string" id="7179374">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7179403">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179407">try</span><span class="op" id="7179410">(</span><span class="ident" id="7179411">t</span><span class="op" id="7179412">,</span>&nbsp;<span class="ident" id="7179414">b</span><span class="op" id="7179415">.</span><span class="ident" id="7179416">Bytes</span><span class="op" id="7179421">(</span><span class="op" id="7179422">)</span><span class="op" id="7179423">,</span>&nbsp;<span class="ident" id="7179425">want</span><span class="op" id="7179429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7179432">}</span><br>
<span class="lineno"></span><span class="op" id="7179434">}</span>
</div>
</body>
</html>
