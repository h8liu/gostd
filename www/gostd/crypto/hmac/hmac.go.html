<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/hmac</h2>
<ul>
<li><a href="/gostd/crypto/hmac/hmac.go.html" class="current">hmac.go</a></li>
<li><a href="/gostd/crypto/hmac/hmac_test.go.html">hmac_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4333270">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4333325">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4333379">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4333430">/*<br>
<span class="lineno"></span>Package&nbsp;hmac&nbsp;implements&nbsp;the&nbsp;Keyed-Hash&nbsp;Message&nbsp;Authentication&nbsp;Code&nbsp;(HMAC)&nbsp;as<br>
<span class="lineno"></span>defined&nbsp;in&nbsp;U.S.&nbsp;Federal&nbsp;Information&nbsp;Processing&nbsp;Standards&nbsp;Publication&nbsp;198.<br>
<span class="lineno"></span>An&nbsp;HMAC&nbsp;is&nbsp;a&nbsp;cryptographic&nbsp;hash&nbsp;that&nbsp;uses&nbsp;a&nbsp;key&nbsp;to&nbsp;sign&nbsp;a&nbsp;message.<br>
<span class="lineno"></span>The&nbsp;receiver&nbsp;verifies&nbsp;the&nbsp;hash&nbsp;by&nbsp;recomputing&nbsp;it&nbsp;using&nbsp;the&nbsp;same&nbsp;key.<br>
<span class="lineno">10</span><br>
<span class="lineno"></span>Receivers&nbsp;should&nbsp;be&nbsp;careful&nbsp;to&nbsp;use&nbsp;Equal&nbsp;to&nbsp;compare&nbsp;MACs&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid<br>
<span class="lineno"></span>timing&nbsp;side-channels:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;CheckMAC&nbsp;returns&nbsp;true&nbsp;if&nbsp;messageMAC&nbsp;is&nbsp;a&nbsp;valid&nbsp;HMAC&nbsp;tag&nbsp;for&nbsp;message.<br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;CheckMAC(message,&nbsp;messageMAC,&nbsp;key&nbsp;[]byte)&nbsp;bool&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mac&nbsp;:=&nbsp;hmac.New(sha256.New,&nbsp;key)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mac.Write(message)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expectedMAC&nbsp;:=&nbsp;mac.Sum(nil)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;hmac.Equal(messageMAC,&nbsp;expectedMAC)<br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="4334084">package</span>&nbsp;<span class="ident" id="4334092">hmac</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4334098">import</span>&nbsp;<span class="op" id="4334105">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4334108">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4334125">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4334132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4334135">//&nbsp;FIPS&nbsp;198:</span><br>
<span class="lineno">30</span><span class="comment" id="4334148">//&nbsp;http://csrc.nist.gov/publications/fips/fips198/fips-198a.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4334213">//&nbsp;key&nbsp;is&nbsp;zero&nbsp;padded&nbsp;to&nbsp;the&nbsp;block&nbsp;size&nbsp;of&nbsp;the&nbsp;hash&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4334274">//&nbsp;ipad&nbsp;=&nbsp;0x36&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno"></span><span class="comment" id="4334318">//&nbsp;opad&nbsp;=&nbsp;0x5c&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno">35</span><span class="comment" id="4334362">//&nbsp;hmac&nbsp;=&nbsp;H([key&nbsp;^&nbsp;opad]&nbsp;H([key&nbsp;^&nbsp;ipad]&nbsp;text))</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4334410">type</span>&nbsp;<span class="ident" id="4334415">hmac</span>&nbsp;<span class="keyword" id="4334420">struct</span>&nbsp;<span class="op" id="4334427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4334430">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4334443">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4334448">blocksize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4334461">int</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4334466">key</span><span class="op" id="4334469">,</span>&nbsp;<span class="ident" id="4334471">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4334479">[</span><span class="op" id="4334480">]</span><span class="builtintype" id="4334481">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4334487">outer</span><span class="op" id="4334492">,</span>&nbsp;<span class="ident" id="4334494">inner</span>&nbsp;<span class="ident" id="4334500">hash</span><span class="op" id="4334504">.</span><span class="ident" id="4334505">Hash</span><br>
<span class="lineno"></span><span class="op" id="4334510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4334513">func</span>&nbsp;<span class="op" id="4334518">(</span><span class="ident" id="4334519">h</span>&nbsp;<span class="op" id="4334521">*</span><span class="ident" id="4334522">hmac</span><span class="op" id="4334526">)</span>&nbsp;<span class="ident" id="4334528">tmpPad</span><span class="op" id="4334534">(</span><span class="ident" id="4334535">xor</span>&nbsp;<span class="builtintype" id="4334539">byte</span><span class="op" id="4334543">)</span>&nbsp;<span class="op" id="4334545">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4334548">for</span>&nbsp;<span class="ident" id="4334552">i</span><span class="op" id="4334553">,</span>&nbsp;<span class="ident" id="4334555">k</span>&nbsp;<span class="op" id="4334557">:=</span>&nbsp;<span class="keyword" id="4334560">range</span>&nbsp;<span class="ident" id="4334566">h</span><span class="op" id="4334567">.</span><span class="ident" id="4334568">key</span>&nbsp;<span class="op" id="4334572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4334576">h</span><span class="op" id="4334577">.</span><span class="ident" id="4334578">tmp</span><span class="op" id="4334581">[</span><span class="ident" id="4334582">i</span><span class="op" id="4334583">]</span>&nbsp;<span class="op" id="4334585">=</span>&nbsp;<span class="ident" id="4334587">xor</span>&nbsp;<span class="op" id="4334591">^</span>&nbsp;<span class="ident" id="4334593">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4334596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4334599">for</span>&nbsp;<span class="ident" id="4334603">i</span>&nbsp;<span class="op" id="4334605">:=</span>&nbsp;<span class="builtinfunc" id="4334608">len</span><span class="op" id="4334611">(</span><span class="ident" id="4334612">h</span><span class="op" id="4334613">.</span><span class="ident" id="4334614">key</span><span class="op" id="4334617">)</span><span class="op" id="4334618">;</span>&nbsp;<span class="ident" id="4334620">i</span>&nbsp;<span class="op" id="4334622">&lt;</span>&nbsp;<span class="ident" id="4334624">h</span><span class="op" id="4334625">.</span><span class="ident" id="4334626">blocksize</span><span class="op" id="4334635">;</span>&nbsp;<span class="ident" id="4334637">i</span><span class="op" id="4334638">++</span>&nbsp;<span class="op" id="4334641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4334645">h</span><span class="op" id="4334646">.</span><span class="ident" id="4334647">tmp</span><span class="op" id="4334650">[</span><span class="ident" id="4334651">i</span><span class="op" id="4334652">]</span>&nbsp;<span class="op" id="4334654">=</span>&nbsp;<span class="ident" id="4334656">xor</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4334661">}</span><br>
<span class="lineno"></span><span class="op" id="4334663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4334666">func</span>&nbsp;<span class="op" id="4334671">(</span><span class="ident" id="4334672">h</span>&nbsp;<span class="op" id="4334674">*</span><span class="ident" id="4334675">hmac</span><span class="op" id="4334679">)</span>&nbsp;<span class="ident" id="4334681">Sum</span><span class="op" id="4334684">(</span><span class="ident" id="4334685">in</span>&nbsp;<span class="op" id="4334688">[</span><span class="op" id="4334689">]</span><span class="builtintype" id="4334690">byte</span><span class="op" id="4334694">)</span>&nbsp;<span class="op" id="4334696">[</span><span class="op" id="4334697">]</span><span class="builtintype" id="4334698">byte</span>&nbsp;<span class="op" id="4334703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4334706">origLen</span>&nbsp;<span class="op" id="4334714">:=</span>&nbsp;<span class="builtinfunc" id="4334717">len</span><span class="op" id="4334720">(</span><span class="ident" id="4334721">in</span><span class="op" id="4334723">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4334726">in</span>&nbsp;<span class="op" id="4334729">=</span>&nbsp;<span class="ident" id="4334731">h</span><span class="op" id="4334732">.</span><span class="ident" id="4334733">inner</span><span class="op" id="4334738">.</span><span class="ident" id="4334739">Sum</span><span class="op" id="4334742">(</span><span class="ident" id="4334743">in</span><span class="op" id="4334745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4334748">h</span><span class="op" id="4334749">.</span><span class="ident" id="4334750">tmpPad</span><span class="op" id="4334756">(</span><span class="num" id="4334757">0x5c</span><span class="op" id="4334761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4334764">copy</span><span class="op" id="4334768">(</span><span class="ident" id="4334769">h</span><span class="op" id="4334770">.</span><span class="ident" id="4334771">tmp</span><span class="op" id="4334774">[</span><span class="ident" id="4334775">h</span><span class="op" id="4334776">.</span><span class="ident" id="4334777">blocksize</span><span class="op" id="4334786">:</span><span class="op" id="4334787">]</span><span class="op" id="4334788">,</span>&nbsp;<span class="ident" id="4334790">in</span><span class="op" id="4334792">[</span><span class="ident" id="4334793">origLen</span><span class="op" id="4334800">:</span><span class="op" id="4334801">]</span><span class="op" id="4334802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4334805">h</span><span class="op" id="4334806">.</span><span class="ident" id="4334807">outer</span><span class="op" id="4334812">.</span><span class="ident" id="4334813">Reset</span><span class="op" id="4334818">(</span><span class="op" id="4334819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4334822">h</span><span class="op" id="4334823">.</span><span class="ident" id="4334824">outer</span><span class="op" id="4334829">.</span><span class="ident" id="4334830">Write</span><span class="op" id="4334835">(</span><span class="ident" id="4334836">h</span><span class="op" id="4334837">.</span><span class="ident" id="4334838">tmp</span><span class="op" id="4334841">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4334844">return</span>&nbsp;<span class="ident" id="4334851">h</span><span class="op" id="4334852">.</span><span class="ident" id="4334853">outer</span><span class="op" id="4334858">.</span><span class="ident" id="4334859">Sum</span><span class="op" id="4334862">(</span><span class="ident" id="4334863">in</span><span class="op" id="4334865">[</span><span class="op" id="4334866">:</span><span class="ident" id="4334867">origLen</span><span class="op" id="4334874">]</span><span class="op" id="4334875">)</span><br>
<span class="lineno"></span><span class="op" id="4334877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4334880">func</span>&nbsp;<span class="op" id="4334885">(</span><span class="ident" id="4334886">h</span>&nbsp;<span class="op" id="4334888">*</span><span class="ident" id="4334889">hmac</span><span class="op" id="4334893">)</span>&nbsp;<span class="ident" id="4334895">Write</span><span class="op" id="4334900">(</span><span class="ident" id="4334901">p</span>&nbsp;<span class="op" id="4334903">[</span><span class="op" id="4334904">]</span><span class="builtintype" id="4334905">byte</span><span class="op" id="4334909">)</span>&nbsp;<span class="op" id="4334911">(</span><span class="ident" id="4334912">n</span>&nbsp;<span class="builtintype" id="4334914">int</span><span class="op" id="4334917">,</span>&nbsp;<span class="ident" id="4334919">err</span>&nbsp;<span class="builtintype" id="4334923">error</span><span class="op" id="4334928">)</span>&nbsp;<span class="op" id="4334930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4334933">return</span>&nbsp;<span class="ident" id="4334940">h</span><span class="op" id="4334941">.</span><span class="ident" id="4334942">inner</span><span class="op" id="4334947">.</span><span class="ident" id="4334948">Write</span><span class="op" id="4334953">(</span><span class="ident" id="4334954">p</span><span class="op" id="4334955">)</span><br>
<span class="lineno">65</span><span class="op" id="4334957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4334960">func</span>&nbsp;<span class="op" id="4334965">(</span><span class="ident" id="4334966">h</span>&nbsp;<span class="op" id="4334968">*</span><span class="ident" id="4334969">hmac</span><span class="op" id="4334973">)</span>&nbsp;<span class="ident" id="4334975">Size</span><span class="op" id="4334979">(</span><span class="op" id="4334980">)</span>&nbsp;<span class="builtintype" id="4334982">int</span>&nbsp;<span class="op" id="4334986">{</span>&nbsp;<span class="keyword" id="4334988">return</span>&nbsp;<span class="ident" id="4334995">h</span><span class="op" id="4334996">.</span><span class="ident" id="4334997">size</span>&nbsp;<span class="op" id="4335002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4335005">func</span>&nbsp;<span class="op" id="4335010">(</span><span class="ident" id="4335011">h</span>&nbsp;<span class="op" id="4335013">*</span><span class="ident" id="4335014">hmac</span><span class="op" id="4335018">)</span>&nbsp;<span class="ident" id="4335020">BlockSize</span><span class="op" id="4335029">(</span><span class="op" id="4335030">)</span>&nbsp;<span class="builtintype" id="4335032">int</span>&nbsp;<span class="op" id="4335036">{</span>&nbsp;<span class="keyword" id="4335038">return</span>&nbsp;<span class="ident" id="4335045">h</span><span class="op" id="4335046">.</span><span class="ident" id="4335047">blocksize</span>&nbsp;<span class="op" id="4335057">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4335060">func</span>&nbsp;<span class="op" id="4335065">(</span><span class="ident" id="4335066">h</span>&nbsp;<span class="op" id="4335068">*</span><span class="ident" id="4335069">hmac</span><span class="op" id="4335073">)</span>&nbsp;<span class="ident" id="4335075">Reset</span><span class="op" id="4335080">(</span><span class="op" id="4335081">)</span>&nbsp;<span class="op" id="4335083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4335086">h</span><span class="op" id="4335087">.</span><span class="ident" id="4335088">inner</span><span class="op" id="4335093">.</span><span class="ident" id="4335094">Reset</span><span class="op" id="4335099">(</span><span class="op" id="4335100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4335103">h</span><span class="op" id="4335104">.</span><span class="ident" id="4335105">tmpPad</span><span class="op" id="4335111">(</span><span class="num" id="4335112">0x36</span><span class="op" id="4335116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4335119">h</span><span class="op" id="4335120">.</span><span class="ident" id="4335121">inner</span><span class="op" id="4335126">.</span><span class="ident" id="4335127">Write</span><span class="op" id="4335132">(</span><span class="ident" id="4335133">h</span><span class="op" id="4335134">.</span><span class="ident" id="4335135">tmp</span><span class="op" id="4335138">[</span><span class="op" id="4335139">:</span><span class="ident" id="4335140">h</span><span class="op" id="4335141">.</span><span class="ident" id="4335142">blocksize</span><span class="op" id="4335151">]</span><span class="op" id="4335152">)</span><br>
<span class="lineno">75</span><span class="op" id="4335154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4335157">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;HMAC&nbsp;hash&nbsp;using&nbsp;the&nbsp;given&nbsp;hash.Hash&nbsp;type&nbsp;and&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4335228">func</span>&nbsp;<span class="ident" id="4335233">New</span><span class="op" id="4335236">(</span><span class="ident" id="4335237">h</span>&nbsp;<span class="keyword" id="4335239">func</span><span class="op" id="4335243">(</span><span class="op" id="4335244">)</span>&nbsp;<span class="ident" id="4335246">hash</span><span class="op" id="4335250">.</span><span class="ident" id="4335251">Hash</span><span class="op" id="4335255">,</span>&nbsp;<span class="ident" id="4335257">key</span>&nbsp;<span class="op" id="4335261">[</span><span class="op" id="4335262">]</span><span class="builtintype" id="4335263">byte</span><span class="op" id="4335267">)</span>&nbsp;<span class="ident" id="4335269">hash</span><span class="op" id="4335273">.</span><span class="ident" id="4335274">Hash</span>&nbsp;<span class="op" id="4335279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4335282">hm</span>&nbsp;<span class="op" id="4335285">:=</span>&nbsp;<span class="builtinfunc" id="4335288">new</span><span class="op" id="4335291">(</span><span class="ident" id="4335292">hmac</span><span class="op" id="4335296">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4335299">hm</span><span class="op" id="4335301">.</span><span class="ident" id="4335302">outer</span>&nbsp;<span class="op" id="4335308">=</span>&nbsp;<span class="ident" id="4335310">h</span><span class="op" id="4335311">(</span><span class="op" id="4335312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4335315">hm</span><span class="op" id="4335317">.</span><span class="ident" id="4335318">inner</span>&nbsp;<span class="op" id="4335324">=</span>&nbsp;<span class="ident" id="4335326">h</span><span class="op" id="4335327">(</span><span class="op" id="4335328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4335331">hm</span><span class="op" id="4335333">.</span><span class="ident" id="4335334">size</span>&nbsp;<span class="op" id="4335339">=</span>&nbsp;<span class="ident" id="4335341">hm</span><span class="op" id="4335343">.</span><span class="ident" id="4335344">inner</span><span class="op" id="4335349">.</span><span class="ident" id="4335350">Size</span><span class="op" id="4335354">(</span><span class="op" id="4335355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4335358">hm</span><span class="op" id="4335360">.</span><span class="ident" id="4335361">blocksize</span>&nbsp;<span class="op" id="4335371">=</span>&nbsp;<span class="ident" id="4335373">hm</span><span class="op" id="4335375">.</span><span class="ident" id="4335376">inner</span><span class="op" id="4335381">.</span><span class="ident" id="4335382">BlockSize</span><span class="op" id="4335391">(</span><span class="op" id="4335392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4335395">hm</span><span class="op" id="4335397">.</span><span class="ident" id="4335398">tmp</span>&nbsp;<span class="op" id="4335402">=</span>&nbsp;<span class="builtinfunc" id="4335404">make</span><span class="op" id="4335408">(</span><span class="op" id="4335409">[</span><span class="op" id="4335410">]</span><span class="builtintype" id="4335411">byte</span><span class="op" id="4335415">,</span>&nbsp;<span class="ident" id="4335417">hm</span><span class="op" id="4335419">.</span><span class="ident" id="4335420">blocksize</span><span class="op" id="4335429">+</span><span class="ident" id="4335430">hm</span><span class="op" id="4335432">.</span><span class="ident" id="4335433">size</span><span class="op" id="4335437">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4335440">if</span>&nbsp;<span class="builtinfunc" id="4335443">len</span><span class="op" id="4335446">(</span><span class="ident" id="4335447">key</span><span class="op" id="4335450">)</span>&nbsp;<span class="op" id="4335452">&gt;</span>&nbsp;<span class="ident" id="4335454">hm</span><span class="op" id="4335456">.</span><span class="ident" id="4335457">blocksize</span>&nbsp;<span class="op" id="4335467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335471">//&nbsp;If&nbsp;key&nbsp;is&nbsp;too&nbsp;big,&nbsp;hash&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4335504">hm</span><span class="op" id="4335506">.</span><span class="ident" id="4335507">outer</span><span class="op" id="4335512">.</span><span class="ident" id="4335513">Write</span><span class="op" id="4335518">(</span><span class="ident" id="4335519">key</span><span class="op" id="4335522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4335526">key</span>&nbsp;<span class="op" id="4335530">=</span>&nbsp;<span class="ident" id="4335532">hm</span><span class="op" id="4335534">.</span><span class="ident" id="4335535">outer</span><span class="op" id="4335540">.</span><span class="ident" id="4335541">Sum</span><span class="op" id="4335544">(</span><span class="builtintype" id="4335545">nil</span><span class="op" id="4335548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4335551">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4335554">hm</span><span class="op" id="4335556">.</span><span class="ident" id="4335557">key</span>&nbsp;<span class="op" id="4335561">=</span>&nbsp;<span class="builtinfunc" id="4335563">make</span><span class="op" id="4335567">(</span><span class="op" id="4335568">[</span><span class="op" id="4335569">]</span><span class="builtintype" id="4335570">byte</span><span class="op" id="4335574">,</span>&nbsp;<span class="builtinfunc" id="4335576">len</span><span class="op" id="4335579">(</span><span class="ident" id="4335580">key</span><span class="op" id="4335583">)</span><span class="op" id="4335584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4335587">copy</span><span class="op" id="4335591">(</span><span class="ident" id="4335592">hm</span><span class="op" id="4335594">.</span><span class="ident" id="4335595">key</span><span class="op" id="4335598">,</span>&nbsp;<span class="ident" id="4335600">key</span><span class="op" id="4335603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4335606">hm</span><span class="op" id="4335608">.</span><span class="ident" id="4335609">Reset</span><span class="op" id="4335614">(</span><span class="op" id="4335615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4335618">return</span>&nbsp;<span class="ident" id="4335625">hm</span><br>
<span class="lineno"></span><span class="op" id="4335628">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="4335631">//&nbsp;Equal&nbsp;compares&nbsp;two&nbsp;MACs&nbsp;for&nbsp;equality&nbsp;without&nbsp;leaking&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="4335707">func</span>&nbsp;<span class="ident" id="4335712">Equal</span><span class="op" id="4335717">(</span><span class="ident" id="4335718">mac1</span><span class="op" id="4335722">,</span>&nbsp;<span class="ident" id="4335724">mac2</span>&nbsp;<span class="op" id="4335729">[</span><span class="op" id="4335730">]</span><span class="builtintype" id="4335731">byte</span><span class="op" id="4335735">)</span>&nbsp;<span class="builtintype" id="4335737">bool</span>&nbsp;<span class="op" id="4335742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335745">//&nbsp;We&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;constant&nbsp;time&nbsp;if&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MACs&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335814">//&nbsp;different&nbsp;as&nbsp;that&nbsp;suggests&nbsp;that&nbsp;a&nbsp;completely&nbsp;different&nbsp;hash&nbsp;function</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335887">//&nbsp;was&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4335901">return</span>&nbsp;<span class="builtinfunc" id="4335908">len</span><span class="op" id="4335911">(</span><span class="ident" id="4335912">mac1</span><span class="op" id="4335916">)</span>&nbsp;<span class="op" id="4335918">==</span>&nbsp;<span class="builtinfunc" id="4335921">len</span><span class="op" id="4335924">(</span><span class="ident" id="4335925">mac2</span><span class="op" id="4335929">)</span>&nbsp;<span class="op" id="4335931">&amp;&amp;</span>&nbsp;<span class="ident" id="4335934">subtle</span><span class="op" id="4335940">.</span><span class="ident" id="4335941">ConstantTimeCompare</span><span class="op" id="4335960">(</span><span class="ident" id="4335961">mac1</span><span class="op" id="4335965">,</span>&nbsp;<span class="ident" id="4335967">mac2</span><span class="op" id="4335971">)</span>&nbsp;<span class="op" id="4335973">==</span>&nbsp;<span class="num" id="4335976">1</span><br>
<span class="lineno"></span><span class="op" id="4335978">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
