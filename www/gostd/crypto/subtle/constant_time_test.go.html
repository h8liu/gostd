<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html" class="current">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8351572">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8351627">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8351681">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8351732">package</span>&nbsp;<span class="ident" id="8351740">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8351748">import</span>&nbsp;<span class="op" id="8351755">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8351758">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8351769">&#34;testing/quick&#34;</span><br>
<span class="lineno">10</span><span class="op" id="8351785">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8351788">type</span>&nbsp;<span class="ident" id="8351793">TestConstantTimeCompareStruct</span>&nbsp;<span class="keyword" id="8351823">struct</span>&nbsp;<span class="op" id="8351830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8351833">a</span><span class="op" id="8351834">,</span>&nbsp;<span class="ident" id="8351836">b</span>&nbsp;<span class="op" id="8351838">[</span><span class="op" id="8351839">]</span><span class="builtintype" id="8351840">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8351846">out</span>&nbsp;&nbsp;<span class="builtintype" id="8351851">int</span><br>
<span class="lineno">15</span><span class="op" id="8351855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8351858">var</span>&nbsp;<span class="ident" id="8351862">testConstantTimeCompareData</span>&nbsp;<span class="op" id="8351890">=</span>&nbsp;<span class="op" id="8351892">[</span><span class="op" id="8351893">]</span><span class="ident" id="8351894">TestConstantTimeCompareStruct</span><span class="op" id="8351923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8351926">{</span><span class="op" id="8351927">[</span><span class="op" id="8351928">]</span><span class="builtintype" id="8351929">byte</span><span class="op" id="8351933">{</span><span class="op" id="8351934">}</span><span class="op" id="8351935">,</span>&nbsp;<span class="op" id="8351937">[</span><span class="op" id="8351938">]</span><span class="builtintype" id="8351939">byte</span><span class="op" id="8351943">{</span><span class="op" id="8351944">}</span><span class="op" id="8351945">,</span>&nbsp;<span class="num" id="8351947">1</span><span class="op" id="8351948">}</span><span class="op" id="8351949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8351952">{</span><span class="op" id="8351953">[</span><span class="op" id="8351954">]</span><span class="builtintype" id="8351955">byte</span><span class="op" id="8351959">{</span><span class="num" id="8351960">0x11</span><span class="op" id="8351964">}</span><span class="op" id="8351965">,</span>&nbsp;<span class="op" id="8351967">[</span><span class="op" id="8351968">]</span><span class="builtintype" id="8351969">byte</span><span class="op" id="8351973">{</span><span class="num" id="8351974">0x11</span><span class="op" id="8351978">}</span><span class="op" id="8351979">,</span>&nbsp;<span class="num" id="8351981">1</span><span class="op" id="8351982">}</span><span class="op" id="8351983">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8351986">{</span><span class="op" id="8351987">[</span><span class="op" id="8351988">]</span><span class="builtintype" id="8351989">byte</span><span class="op" id="8351993">{</span><span class="num" id="8351994">0x12</span><span class="op" id="8351998">}</span><span class="op" id="8351999">,</span>&nbsp;<span class="op" id="8352001">[</span><span class="op" id="8352002">]</span><span class="builtintype" id="8352003">byte</span><span class="op" id="8352007">{</span><span class="num" id="8352008">0x11</span><span class="op" id="8352012">}</span><span class="op" id="8352013">,</span>&nbsp;<span class="num" id="8352015">0</span><span class="op" id="8352016">}</span><span class="op" id="8352017">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8352020">{</span><span class="op" id="8352021">[</span><span class="op" id="8352022">]</span><span class="builtintype" id="8352023">byte</span><span class="op" id="8352027">{</span><span class="num" id="8352028">0x11</span><span class="op" id="8352032">}</span><span class="op" id="8352033">,</span>&nbsp;<span class="op" id="8352035">[</span><span class="op" id="8352036">]</span><span class="builtintype" id="8352037">byte</span><span class="op" id="8352041">{</span><span class="num" id="8352042">0x11</span><span class="op" id="8352046">,</span>&nbsp;<span class="num" id="8352048">0x12</span><span class="op" id="8352052">}</span><span class="op" id="8352053">,</span>&nbsp;<span class="num" id="8352055">0</span><span class="op" id="8352056">}</span><span class="op" id="8352057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8352060">{</span><span class="op" id="8352061">[</span><span class="op" id="8352062">]</span><span class="builtintype" id="8352063">byte</span><span class="op" id="8352067">{</span><span class="num" id="8352068">0x11</span><span class="op" id="8352072">,</span>&nbsp;<span class="num" id="8352074">0x12</span><span class="op" id="8352078">}</span><span class="op" id="8352079">,</span>&nbsp;<span class="op" id="8352081">[</span><span class="op" id="8352082">]</span><span class="builtintype" id="8352083">byte</span><span class="op" id="8352087">{</span><span class="num" id="8352088">0x11</span><span class="op" id="8352092">}</span><span class="op" id="8352093">,</span>&nbsp;<span class="num" id="8352095">0</span><span class="op" id="8352096">}</span><span class="op" id="8352097">,</span><br>
<span class="lineno"></span><span class="op" id="8352099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8352102">func</span>&nbsp;<span class="ident" id="8352107">TestConstantTimeCompare</span><span class="op" id="8352130">(</span><span class="ident" id="8352131">t</span>&nbsp;<span class="op" id="8352133">*</span><span class="ident" id="8352134">testing</span><span class="op" id="8352141">.</span><span class="ident" id="8352142">T</span><span class="op" id="8352143">)</span>&nbsp;<span class="op" id="8352145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8352148">for</span>&nbsp;<span class="ident" id="8352152">i</span><span class="op" id="8352153">,</span>&nbsp;<span class="ident" id="8352155">test</span>&nbsp;<span class="op" id="8352160">:=</span>&nbsp;<span class="keyword" id="8352163">range</span>&nbsp;<span class="ident" id="8352169">testConstantTimeCompareData</span>&nbsp;<span class="op" id="8352197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8352201">if</span>&nbsp;<span class="ident" id="8352204">r</span>&nbsp;<span class="op" id="8352206">:=</span>&nbsp;<span class="ident" id="8352209">ConstantTimeCompare</span><span class="op" id="8352228">(</span><span class="ident" id="8352229">test</span><span class="op" id="8352233">.</span><span class="ident" id="8352234">a</span><span class="op" id="8352235">,</span>&nbsp;<span class="ident" id="8352237">test</span><span class="op" id="8352241">.</span><span class="ident" id="8352242">b</span><span class="op" id="8352243">)</span><span class="op" id="8352244">;</span>&nbsp;<span class="ident" id="8352246">r</span>&nbsp;<span class="op" id="8352248">!=</span>&nbsp;<span class="ident" id="8352251">test</span><span class="op" id="8352255">.</span><span class="ident" id="8352256">out</span>&nbsp;<span class="op" id="8352260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8352265">t</span><span class="op" id="8352266">.</span><span class="ident" id="8352267">Errorf</span><span class="op" id="8352273">(</span><span class="string" id="8352274">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="8352308">,</span>&nbsp;<span class="ident" id="8352310">i</span><span class="op" id="8352311">,</span>&nbsp;<span class="ident" id="8352313">r</span><span class="op" id="8352314">,</span>&nbsp;<span class="ident" id="8352316">test</span><span class="op" id="8352320">.</span><span class="ident" id="8352321">out</span><span class="op" id="8352324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8352328">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8352331">}</span><br>
<span class="lineno"></span><span class="op" id="8352333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8352336">type</span>&nbsp;<span class="ident" id="8352341">TestConstantTimeByteEqStruct</span>&nbsp;<span class="keyword" id="8352370">struct</span>&nbsp;<span class="op" id="8352377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8352380">a</span><span class="op" id="8352381">,</span>&nbsp;<span class="ident" id="8352383">b</span>&nbsp;<span class="builtintype" id="8352385">uint8</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8352392">out</span>&nbsp;&nbsp;<span class="builtintype" id="8352397">int</span><br>
<span class="lineno"></span><span class="op" id="8352401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8352404">var</span>&nbsp;<span class="ident" id="8352408">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="8352435">=</span>&nbsp;<span class="op" id="8352437">[</span><span class="op" id="8352438">]</span><span class="ident" id="8352439">TestConstantTimeByteEqStruct</span><span class="op" id="8352467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8352470">{</span><span class="num" id="8352471">0</span><span class="op" id="8352472">,</span>&nbsp;<span class="num" id="8352474">0</span><span class="op" id="8352475">,</span>&nbsp;<span class="num" id="8352477">1</span><span class="op" id="8352478">}</span><span class="op" id="8352479">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8352482">{</span><span class="num" id="8352483">0</span><span class="op" id="8352484">,</span>&nbsp;<span class="num" id="8352486">1</span><span class="op" id="8352487">,</span>&nbsp;<span class="num" id="8352489">0</span><span class="op" id="8352490">}</span><span class="op" id="8352491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8352494">{</span><span class="num" id="8352495">1</span><span class="op" id="8352496">,</span>&nbsp;<span class="num" id="8352498">0</span><span class="op" id="8352499">,</span>&nbsp;<span class="num" id="8352501">0</span><span class="op" id="8352502">}</span><span class="op" id="8352503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8352506">{</span><span class="num" id="8352507">0xff</span><span class="op" id="8352511">,</span>&nbsp;<span class="num" id="8352513">0xff</span><span class="op" id="8352517">,</span>&nbsp;<span class="num" id="8352519">1</span><span class="op" id="8352520">}</span><span class="op" id="8352521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8352524">{</span><span class="num" id="8352525">0xff</span><span class="op" id="8352529">,</span>&nbsp;<span class="num" id="8352531">0xfe</span><span class="op" id="8352535">,</span>&nbsp;<span class="num" id="8352537">0</span><span class="op" id="8352538">}</span><span class="op" id="8352539">,</span><br>
<span class="lineno"></span><span class="op" id="8352541">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8352544">func</span>&nbsp;<span class="ident" id="8352549">byteEq</span><span class="op" id="8352555">(</span><span class="ident" id="8352556">a</span><span class="op" id="8352557">,</span>&nbsp;<span class="ident" id="8352559">b</span>&nbsp;<span class="builtintype" id="8352561">uint8</span><span class="op" id="8352566">)</span>&nbsp;<span class="builtintype" id="8352568">int</span>&nbsp;<span class="op" id="8352572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8352575">if</span>&nbsp;<span class="ident" id="8352578">a</span>&nbsp;<span class="op" id="8352580">==</span>&nbsp;<span class="ident" id="8352583">b</span>&nbsp;<span class="op" id="8352585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8352589">return</span>&nbsp;<span class="num" id="8352596">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8352599">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8352602">return</span>&nbsp;<span class="num" id="8352609">0</span><br>
<span class="lineno"></span><span class="op" id="8352611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8352614">func</span>&nbsp;<span class="ident" id="8352619">TestConstantTimeByteEq</span><span class="op" id="8352641">(</span><span class="ident" id="8352642">t</span>&nbsp;<span class="op" id="8352644">*</span><span class="ident" id="8352645">testing</span><span class="op" id="8352652">.</span><span class="ident" id="8352653">T</span><span class="op" id="8352654">)</span>&nbsp;<span class="op" id="8352656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8352659">for</span>&nbsp;<span class="ident" id="8352663">i</span><span class="op" id="8352664">,</span>&nbsp;<span class="ident" id="8352666">test</span>&nbsp;<span class="op" id="8352671">:=</span>&nbsp;<span class="keyword" id="8352674">range</span>&nbsp;<span class="ident" id="8352680">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="8352707">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8352711">if</span>&nbsp;<span class="ident" id="8352714">r</span>&nbsp;<span class="op" id="8352716">:=</span>&nbsp;<span class="ident" id="8352719">ConstantTimeByteEq</span><span class="op" id="8352737">(</span><span class="ident" id="8352738">test</span><span class="op" id="8352742">.</span><span class="ident" id="8352743">a</span><span class="op" id="8352744">,</span>&nbsp;<span class="ident" id="8352746">test</span><span class="op" id="8352750">.</span><span class="ident" id="8352751">b</span><span class="op" id="8352752">)</span><span class="op" id="8352753">;</span>&nbsp;<span class="ident" id="8352755">r</span>&nbsp;<span class="op" id="8352757">!=</span>&nbsp;<span class="ident" id="8352760">test</span><span class="op" id="8352764">.</span><span class="ident" id="8352765">out</span>&nbsp;<span class="op" id="8352769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8352774">t</span><span class="op" id="8352775">.</span><span class="ident" id="8352776">Errorf</span><span class="op" id="8352782">(</span><span class="string" id="8352783">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="8352817">,</span>&nbsp;<span class="ident" id="8352819">i</span><span class="op" id="8352820">,</span>&nbsp;<span class="ident" id="8352822">r</span><span class="op" id="8352823">,</span>&nbsp;<span class="ident" id="8352825">test</span><span class="op" id="8352829">.</span><span class="ident" id="8352830">out</span><span class="op" id="8352833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8352837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8352840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8352843">err</span>&nbsp;<span class="op" id="8352847">:=</span>&nbsp;<span class="ident" id="8352850">quick</span><span class="op" id="8352855">.</span><span class="ident" id="8352856">CheckEqual</span><span class="op" id="8352866">(</span><span class="ident" id="8352867">ConstantTimeByteEq</span><span class="op" id="8352885">,</span>&nbsp;<span class="ident" id="8352887">byteEq</span><span class="op" id="8352893">,</span>&nbsp;<span class="builtintype" id="8352895">nil</span><span class="op" id="8352898">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8352901">if</span>&nbsp;<span class="ident" id="8352904">err</span>&nbsp;<span class="op" id="8352908">!=</span>&nbsp;<span class="builtintype" id="8352911">nil</span>&nbsp;<span class="op" id="8352915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8352919">t</span><span class="op" id="8352920">.</span><span class="ident" id="8352921">Error</span><span class="op" id="8352926">(</span><span class="ident" id="8352927">err</span><span class="op" id="8352930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8352933">}</span><br>
<span class="lineno"></span><span class="op" id="8352935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="8352938">func</span>&nbsp;<span class="ident" id="8352943">eq</span><span class="op" id="8352945">(</span><span class="ident" id="8352946">a</span><span class="op" id="8352947">,</span>&nbsp;<span class="ident" id="8352949">b</span>&nbsp;<span class="builtintype" id="8352951">int32</span><span class="op" id="8352956">)</span>&nbsp;<span class="builtintype" id="8352958">int</span>&nbsp;<span class="op" id="8352962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8352965">if</span>&nbsp;<span class="ident" id="8352968">a</span>&nbsp;<span class="op" id="8352970">==</span>&nbsp;<span class="ident" id="8352973">b</span>&nbsp;<span class="op" id="8352975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8352979">return</span>&nbsp;<span class="num" id="8352986">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8352989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8352992">return</span>&nbsp;<span class="num" id="8352999">0</span><br>
<span class="lineno">70</span><span class="op" id="8353001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8353004">func</span>&nbsp;<span class="ident" id="8353009">TestConstantTimeEq</span><span class="op" id="8353027">(</span><span class="ident" id="8353028">t</span>&nbsp;<span class="op" id="8353030">*</span><span class="ident" id="8353031">testing</span><span class="op" id="8353038">.</span><span class="ident" id="8353039">T</span><span class="op" id="8353040">)</span>&nbsp;<span class="op" id="8353042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8353045">err</span>&nbsp;<span class="op" id="8353049">:=</span>&nbsp;<span class="ident" id="8353052">quick</span><span class="op" id="8353057">.</span><span class="ident" id="8353058">CheckEqual</span><span class="op" id="8353068">(</span><span class="ident" id="8353069">ConstantTimeEq</span><span class="op" id="8353083">,</span>&nbsp;<span class="ident" id="8353085">eq</span><span class="op" id="8353087">,</span>&nbsp;<span class="builtintype" id="8353089">nil</span><span class="op" id="8353092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8353095">if</span>&nbsp;<span class="ident" id="8353098">err</span>&nbsp;<span class="op" id="8353102">!=</span>&nbsp;<span class="builtintype" id="8353105">nil</span>&nbsp;<span class="op" id="8353109">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8353113">t</span><span class="op" id="8353114">.</span><span class="ident" id="8353115">Error</span><span class="op" id="8353120">(</span><span class="ident" id="8353121">err</span><span class="op" id="8353124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8353127">}</span><br>
<span class="lineno"></span><span class="op" id="8353129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8353132">func</span>&nbsp;<span class="ident" id="8353137">makeCopy</span><span class="op" id="8353145">(</span><span class="ident" id="8353146">v</span>&nbsp;<span class="builtintype" id="8353148">int</span><span class="op" id="8353151">,</span>&nbsp;<span class="ident" id="8353153">x</span><span class="op" id="8353154">,</span>&nbsp;<span class="ident" id="8353156">y</span>&nbsp;<span class="op" id="8353158">[</span><span class="op" id="8353159">]</span><span class="builtintype" id="8353160">byte</span><span class="op" id="8353164">)</span>&nbsp;<span class="op" id="8353166">[</span><span class="op" id="8353167">]</span><span class="builtintype" id="8353168">byte</span>&nbsp;<span class="op" id="8353173">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8353176">if</span>&nbsp;<span class="builtinfunc" id="8353179">len</span><span class="op" id="8353182">(</span><span class="ident" id="8353183">x</span><span class="op" id="8353184">)</span>&nbsp;<span class="op" id="8353186">&gt;</span>&nbsp;<span class="builtinfunc" id="8353188">len</span><span class="op" id="8353191">(</span><span class="ident" id="8353192">y</span><span class="op" id="8353193">)</span>&nbsp;<span class="op" id="8353195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8353199">x</span>&nbsp;<span class="op" id="8353201">=</span>&nbsp;<span class="ident" id="8353203">x</span><span class="op" id="8353204">[</span><span class="num" id="8353205">0</span><span class="op" id="8353206">:</span><span class="builtinfunc" id="8353207">len</span><span class="op" id="8353210">(</span><span class="ident" id="8353211">y</span><span class="op" id="8353212">)</span><span class="op" id="8353213">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8353216">}</span>&nbsp;<span class="keyword" id="8353218">else</span>&nbsp;<span class="op" id="8353223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8353227">y</span>&nbsp;<span class="op" id="8353229">=</span>&nbsp;<span class="ident" id="8353231">y</span><span class="op" id="8353232">[</span><span class="num" id="8353233">0</span><span class="op" id="8353234">:</span><span class="builtinfunc" id="8353235">len</span><span class="op" id="8353238">(</span><span class="ident" id="8353239">x</span><span class="op" id="8353240">)</span><span class="op" id="8353241">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8353244">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8353247">if</span>&nbsp;<span class="ident" id="8353250">v</span>&nbsp;<span class="op" id="8353252">==</span>&nbsp;<span class="num" id="8353255">1</span>&nbsp;<span class="op" id="8353257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8353261">copy</span><span class="op" id="8353265">(</span><span class="ident" id="8353266">x</span><span class="op" id="8353267">,</span>&nbsp;<span class="ident" id="8353269">y</span><span class="op" id="8353270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8353273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8353276">return</span>&nbsp;<span class="ident" id="8353283">x</span><br>
<span class="lineno"></span><span class="op" id="8353285">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="8353288">func</span>&nbsp;<span class="ident" id="8353293">constantTimeCopyWrapper</span><span class="op" id="8353316">(</span><span class="ident" id="8353317">v</span>&nbsp;<span class="builtintype" id="8353319">int</span><span class="op" id="8353322">,</span>&nbsp;<span class="ident" id="8353324">x</span><span class="op" id="8353325">,</span>&nbsp;<span class="ident" id="8353327">y</span>&nbsp;<span class="op" id="8353329">[</span><span class="op" id="8353330">]</span><span class="builtintype" id="8353331">byte</span><span class="op" id="8353335">)</span>&nbsp;<span class="op" id="8353337">[</span><span class="op" id="8353338">]</span><span class="builtintype" id="8353339">byte</span>&nbsp;<span class="op" id="8353344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8353347">if</span>&nbsp;<span class="builtinfunc" id="8353350">len</span><span class="op" id="8353353">(</span><span class="ident" id="8353354">x</span><span class="op" id="8353355">)</span>&nbsp;<span class="op" id="8353357">&gt;</span>&nbsp;<span class="builtinfunc" id="8353359">len</span><span class="op" id="8353362">(</span><span class="ident" id="8353363">y</span><span class="op" id="8353364">)</span>&nbsp;<span class="op" id="8353366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8353370">x</span>&nbsp;<span class="op" id="8353372">=</span>&nbsp;<span class="ident" id="8353374">x</span><span class="op" id="8353375">[</span><span class="num" id="8353376">0</span><span class="op" id="8353377">:</span><span class="builtinfunc" id="8353378">len</span><span class="op" id="8353381">(</span><span class="ident" id="8353382">y</span><span class="op" id="8353383">)</span><span class="op" id="8353384">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8353387">}</span>&nbsp;<span class="keyword" id="8353389">else</span>&nbsp;<span class="op" id="8353394">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8353398">y</span>&nbsp;<span class="op" id="8353400">=</span>&nbsp;<span class="ident" id="8353402">y</span><span class="op" id="8353403">[</span><span class="num" id="8353404">0</span><span class="op" id="8353405">:</span><span class="builtinfunc" id="8353406">len</span><span class="op" id="8353409">(</span><span class="ident" id="8353410">x</span><span class="op" id="8353411">)</span><span class="op" id="8353412">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8353415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8353418">v</span>&nbsp;<span class="op" id="8353420">&amp;=</span>&nbsp;<span class="num" id="8353423">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8353426">ConstantTimeCopy</span><span class="op" id="8353442">(</span><span class="ident" id="8353443">v</span><span class="op" id="8353444">,</span>&nbsp;<span class="ident" id="8353446">x</span><span class="op" id="8353447">,</span>&nbsp;<span class="ident" id="8353449">y</span><span class="op" id="8353450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8353453">return</span>&nbsp;<span class="ident" id="8353460">x</span><br>
<span class="lineno">100</span><span class="op" id="8353462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8353465">func</span>&nbsp;<span class="ident" id="8353470">TestConstantTimeCopy</span><span class="op" id="8353490">(</span><span class="ident" id="8353491">t</span>&nbsp;<span class="op" id="8353493">*</span><span class="ident" id="8353494">testing</span><span class="op" id="8353501">.</span><span class="ident" id="8353502">T</span><span class="op" id="8353503">)</span>&nbsp;<span class="op" id="8353505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8353508">err</span>&nbsp;<span class="op" id="8353512">:=</span>&nbsp;<span class="ident" id="8353515">quick</span><span class="op" id="8353520">.</span><span class="ident" id="8353521">CheckEqual</span><span class="op" id="8353531">(</span><span class="ident" id="8353532">constantTimeCopyWrapper</span><span class="op" id="8353555">,</span>&nbsp;<span class="ident" id="8353557">makeCopy</span><span class="op" id="8353565">,</span>&nbsp;<span class="builtintype" id="8353567">nil</span><span class="op" id="8353570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8353573">if</span>&nbsp;<span class="ident" id="8353576">err</span>&nbsp;<span class="op" id="8353580">!=</span>&nbsp;<span class="builtintype" id="8353583">nil</span>&nbsp;<span class="op" id="8353587">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8353591">t</span><span class="op" id="8353592">.</span><span class="ident" id="8353593">Error</span><span class="op" id="8353598">(</span><span class="ident" id="8353599">err</span><span class="op" id="8353602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8353605">}</span><br>
<span class="lineno"></span><span class="op" id="8353607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8353610">var</span>&nbsp;<span class="ident" id="8353614">lessOrEqTests</span>&nbsp;<span class="op" id="8353628">=</span>&nbsp;<span class="op" id="8353630">[</span><span class="op" id="8353631">]</span><span class="keyword" id="8353632">struct</span>&nbsp;<span class="op" id="8353639">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8353642">x</span><span class="op" id="8353643">,</span>&nbsp;<span class="ident" id="8353645">y</span><span class="op" id="8353646">,</span>&nbsp;<span class="ident" id="8353648">result</span>&nbsp;<span class="builtintype" id="8353655">int</span><br>
<span class="lineno"></span><span class="op" id="8353659">}</span><span class="op" id="8353660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8353663">{</span><span class="num" id="8353664">0</span><span class="op" id="8353665">,</span>&nbsp;<span class="num" id="8353667">0</span><span class="op" id="8353668">,</span>&nbsp;<span class="num" id="8353670">1</span><span class="op" id="8353671">}</span><span class="op" id="8353672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8353675">{</span><span class="num" id="8353676">1</span><span class="op" id="8353677">,</span>&nbsp;<span class="num" id="8353679">0</span><span class="op" id="8353680">,</span>&nbsp;<span class="num" id="8353682">0</span><span class="op" id="8353683">}</span><span class="op" id="8353684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8353687">{</span><span class="num" id="8353688">0</span><span class="op" id="8353689">,</span>&nbsp;<span class="num" id="8353691">1</span><span class="op" id="8353692">,</span>&nbsp;<span class="num" id="8353694">1</span><span class="op" id="8353695">}</span><span class="op" id="8353696">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8353699">{</span><span class="num" id="8353700">10</span><span class="op" id="8353702">,</span>&nbsp;<span class="num" id="8353704">20</span><span class="op" id="8353706">,</span>&nbsp;<span class="num" id="8353708">1</span><span class="op" id="8353709">}</span><span class="op" id="8353710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8353713">{</span><span class="num" id="8353714">20</span><span class="op" id="8353716">,</span>&nbsp;<span class="num" id="8353718">10</span><span class="op" id="8353720">,</span>&nbsp;<span class="num" id="8353722">0</span><span class="op" id="8353723">}</span><span class="op" id="8353724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8353727">{</span><span class="num" id="8353728">10</span><span class="op" id="8353730">,</span>&nbsp;<span class="num" id="8353732">10</span><span class="op" id="8353734">,</span>&nbsp;<span class="num" id="8353736">1</span><span class="op" id="8353737">}</span><span class="op" id="8353738">,</span><br>
<span class="lineno"></span><span class="op" id="8353740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8353743">func</span>&nbsp;<span class="ident" id="8353748">TestConstantTimeLessOrEq</span><span class="op" id="8353772">(</span><span class="ident" id="8353773">t</span>&nbsp;<span class="op" id="8353775">*</span><span class="ident" id="8353776">testing</span><span class="op" id="8353783">.</span><span class="ident" id="8353784">T</span><span class="op" id="8353785">)</span>&nbsp;<span class="op" id="8353787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8353790">for</span>&nbsp;<span class="ident" id="8353794">i</span><span class="op" id="8353795">,</span>&nbsp;<span class="ident" id="8353797">test</span>&nbsp;<span class="op" id="8353802">:=</span>&nbsp;<span class="keyword" id="8353805">range</span>&nbsp;<span class="ident" id="8353811">lessOrEqTests</span>&nbsp;<span class="op" id="8353825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8353829">result</span>&nbsp;<span class="op" id="8353836">:=</span>&nbsp;<span class="ident" id="8353839">ConstantTimeLessOrEq</span><span class="op" id="8353859">(</span><span class="ident" id="8353860">test</span><span class="op" id="8353864">.</span><span class="ident" id="8353865">x</span><span class="op" id="8353866">,</span>&nbsp;<span class="ident" id="8353868">test</span><span class="op" id="8353872">.</span><span class="ident" id="8353873">y</span><span class="op" id="8353874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8353878">if</span>&nbsp;<span class="ident" id="8353881">result</span>&nbsp;<span class="op" id="8353888">!=</span>&nbsp;<span class="ident" id="8353891">test</span><span class="op" id="8353895">.</span><span class="ident" id="8353896">result</span>&nbsp;<span class="op" id="8353903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8353908">t</span><span class="op" id="8353909">.</span><span class="ident" id="8353910">Errorf</span><span class="op" id="8353916">(</span><span class="string" id="8353917">&#34;#%d:&nbsp;%d&nbsp;&lt;=&nbsp;%d&nbsp;gave&nbsp;%d,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8353953">,</span>&nbsp;<span class="ident" id="8353955">i</span><span class="op" id="8353956">,</span>&nbsp;<span class="ident" id="8353958">test</span><span class="op" id="8353962">.</span><span class="ident" id="8353963">x</span><span class="op" id="8353964">,</span>&nbsp;<span class="ident" id="8353966">test</span><span class="op" id="8353970">.</span><span class="ident" id="8353971">y</span><span class="op" id="8353972">,</span>&nbsp;<span class="ident" id="8353974">result</span><span class="op" id="8353980">,</span>&nbsp;<span class="ident" id="8353982">test</span><span class="op" id="8353986">.</span><span class="ident" id="8353987">result</span><span class="op" id="8353993">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8353997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8354000">}</span><br>
<span class="lineno"></span><span class="op" id="8354002">}</span>
</div>
</body>
</html>
