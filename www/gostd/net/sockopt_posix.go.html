<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3284344">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3284400">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3284454">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3284505">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3284578">package</span>&nbsp;<span class="ident" id="3284586">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3284591">import</span>&nbsp;<span class="op" id="3284598">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3284601">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3284607">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="3284617">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3284620">//&nbsp;Boolean&nbsp;to&nbsp;int.</span><br>
<span class="lineno">15</span><span class="keyword" id="3284639">func</span>&nbsp;<span class="ident" id="3284644">boolint</span><span class="op" id="3284651">(</span><span class="ident" id="3284652">b</span>&nbsp;<span class="builtintype" id="3284654">bool</span><span class="op" id="3284658">)</span>&nbsp;<span class="builtintype" id="3284660">int</span>&nbsp;<span class="op" id="3284664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284667">if</span>&nbsp;<span class="ident" id="3284670">b</span>&nbsp;<span class="op" id="3284672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284676">return</span>&nbsp;<span class="num" id="3284683">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3284686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284689">return</span>&nbsp;<span class="num" id="3284696">0</span><br>
<span class="lineno">20</span><span class="op" id="3284698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3284701">func</span>&nbsp;<span class="ident" id="3284706">ipv4AddrToInterface</span><span class="op" id="3284725">(</span><span class="ident" id="3284726">ip</span>&nbsp;<span class="ident" id="3284729">IP</span><span class="op" id="3284731">)</span>&nbsp;<span class="op" id="3284733">(</span><span class="op" id="3284734">*</span><span class="ident" id="3284735">Interface</span><span class="op" id="3284744">,</span>&nbsp;<span class="builtintype" id="3284746">error</span><span class="op" id="3284751">)</span>&nbsp;<span class="op" id="3284753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284756">ift</span><span class="op" id="3284759">,</span>&nbsp;<span class="ident" id="3284761">err</span>&nbsp;<span class="op" id="3284765">:=</span>&nbsp;<span class="ident" id="3284768">Interfaces</span><span class="op" id="3284778">(</span><span class="op" id="3284779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284782">if</span>&nbsp;<span class="ident" id="3284785">err</span>&nbsp;<span class="op" id="3284789">!=</span>&nbsp;<span class="ident" id="3284792">nil</span>&nbsp;<span class="op" id="3284796">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284800">return</span>&nbsp;<span class="ident" id="3284807">nil</span><span class="op" id="3284810">,</span>&nbsp;<span class="ident" id="3284812">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3284817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284820">for</span>&nbsp;<span class="ident" id="3284824">_</span><span class="op" id="3284825">,</span>&nbsp;<span class="ident" id="3284827">ifi</span>&nbsp;<span class="op" id="3284831">:=</span>&nbsp;<span class="keyword" id="3284834">range</span>&nbsp;<span class="ident" id="3284840">ift</span>&nbsp;<span class="op" id="3284844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284848">ifat</span><span class="op" id="3284852">,</span>&nbsp;<span class="ident" id="3284854">err</span>&nbsp;<span class="op" id="3284858">:=</span>&nbsp;<span class="ident" id="3284861">ifi</span><span class="op" id="3284864">.</span><span class="ident" id="3284865">Addrs</span><span class="op" id="3284870">(</span><span class="op" id="3284871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284875">if</span>&nbsp;<span class="ident" id="3284878">err</span>&nbsp;<span class="op" id="3284882">!=</span>&nbsp;<span class="ident" id="3284885">nil</span>&nbsp;<span class="op" id="3284889">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284894">return</span>&nbsp;<span class="ident" id="3284901">nil</span><span class="op" id="3284904">,</span>&nbsp;<span class="ident" id="3284906">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3284912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284916">for</span>&nbsp;<span class="ident" id="3284920">_</span><span class="op" id="3284921">,</span>&nbsp;<span class="ident" id="3284923">ifa</span>&nbsp;<span class="op" id="3284927">:=</span>&nbsp;<span class="keyword" id="3284930">range</span>&nbsp;<span class="ident" id="3284936">ifat</span>&nbsp;<span class="op" id="3284941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284946">switch</span>&nbsp;<span class="ident" id="3284953">v</span>&nbsp;<span class="op" id="3284955">:=</span>&nbsp;<span class="ident" id="3284958">ifa</span><span class="op" id="3284961">.</span><span class="op" id="3284962">(</span><span class="keyword" id="3284963">type</span><span class="op" id="3284967">)</span>&nbsp;<span class="op" id="3284969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284974">case</span>&nbsp;<span class="op" id="3284979">*</span><span class="ident" id="3284980">IPAddr</span><span class="op" id="3284986">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284992">if</span>&nbsp;<span class="ident" id="3284995">ip</span><span class="op" id="3284997">.</span><span class="ident" id="3284998">Equal</span><span class="op" id="3285003">(</span><span class="ident" id="3285004">v</span><span class="op" id="3285005">.</span><span class="ident" id="3285006">IP</span><span class="op" id="3285008">)</span>&nbsp;<span class="op" id="3285010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285017">return</span>&nbsp;<span class="op" id="3285024">&amp;</span><span class="ident" id="3285025">ifi</span><span class="op" id="3285028">,</span>&nbsp;<span class="ident" id="3285030">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285043">case</span>&nbsp;<span class="op" id="3285048">*</span><span class="ident" id="3285049">IPNet</span><span class="op" id="3285054">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285060">if</span>&nbsp;<span class="ident" id="3285063">ip</span><span class="op" id="3285065">.</span><span class="ident" id="3285066">Equal</span><span class="op" id="3285071">(</span><span class="ident" id="3285072">v</span><span class="op" id="3285073">.</span><span class="ident" id="3285074">IP</span><span class="op" id="3285076">)</span>&nbsp;<span class="op" id="3285078">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285085">return</span>&nbsp;<span class="op" id="3285092">&amp;</span><span class="ident" id="3285093">ifi</span><span class="op" id="3285096">,</span>&nbsp;<span class="ident" id="3285098">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285118">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285121">if</span>&nbsp;<span class="ident" id="3285124">ip</span><span class="op" id="3285126">.</span><span class="ident" id="3285127">Equal</span><span class="op" id="3285132">(</span><span class="ident" id="3285133">IPv4zero</span><span class="op" id="3285141">)</span>&nbsp;<span class="op" id="3285143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285147">return</span>&nbsp;<span class="ident" id="3285154">nil</span><span class="op" id="3285157">,</span>&nbsp;<span class="ident" id="3285159">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285167">return</span>&nbsp;<span class="ident" id="3285174">nil</span><span class="op" id="3285177">,</span>&nbsp;<span class="ident" id="3285179">errNoSuchInterface</span><br>
<span class="lineno"></span><span class="op" id="3285198">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="3285201">func</span>&nbsp;<span class="ident" id="3285206">interfaceToIPv4Addr</span><span class="op" id="3285225">(</span><span class="ident" id="3285226">ifi</span>&nbsp;<span class="op" id="3285230">*</span><span class="ident" id="3285231">Interface</span><span class="op" id="3285240">)</span>&nbsp;<span class="op" id="3285242">(</span><span class="ident" id="3285243">IP</span><span class="op" id="3285245">,</span>&nbsp;<span class="builtintype" id="3285247">error</span><span class="op" id="3285252">)</span>&nbsp;<span class="op" id="3285254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285257">if</span>&nbsp;<span class="ident" id="3285260">ifi</span>&nbsp;<span class="op" id="3285264">==</span>&nbsp;<span class="ident" id="3285267">nil</span>&nbsp;<span class="op" id="3285271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285275">return</span>&nbsp;<span class="ident" id="3285282">IPv4zero</span><span class="op" id="3285290">,</span>&nbsp;<span class="ident" id="3285292">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285297">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3285300">ifat</span><span class="op" id="3285304">,</span>&nbsp;<span class="ident" id="3285306">err</span>&nbsp;<span class="op" id="3285310">:=</span>&nbsp;<span class="ident" id="3285313">ifi</span><span class="op" id="3285316">.</span><span class="ident" id="3285317">Addrs</span><span class="op" id="3285322">(</span><span class="op" id="3285323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285326">if</span>&nbsp;<span class="ident" id="3285329">err</span>&nbsp;<span class="op" id="3285333">!=</span>&nbsp;<span class="ident" id="3285336">nil</span>&nbsp;<span class="op" id="3285340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285344">return</span>&nbsp;<span class="ident" id="3285351">nil</span><span class="op" id="3285354">,</span>&nbsp;<span class="ident" id="3285356">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285364">for</span>&nbsp;<span class="ident" id="3285368">_</span><span class="op" id="3285369">,</span>&nbsp;<span class="ident" id="3285371">ifa</span>&nbsp;<span class="op" id="3285375">:=</span>&nbsp;<span class="keyword" id="3285378">range</span>&nbsp;<span class="ident" id="3285384">ifat</span>&nbsp;<span class="op" id="3285389">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285393">switch</span>&nbsp;<span class="ident" id="3285400">v</span>&nbsp;<span class="op" id="3285402">:=</span>&nbsp;<span class="ident" id="3285405">ifa</span><span class="op" id="3285408">.</span><span class="op" id="3285409">(</span><span class="keyword" id="3285410">type</span><span class="op" id="3285414">)</span>&nbsp;<span class="op" id="3285416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285420">case</span>&nbsp;<span class="op" id="3285425">*</span><span class="ident" id="3285426">IPAddr</span><span class="op" id="3285432">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285437">if</span>&nbsp;<span class="ident" id="3285440">v</span><span class="op" id="3285441">.</span><span class="ident" id="3285442">IP</span><span class="op" id="3285444">.</span><span class="ident" id="3285445">To4</span><span class="op" id="3285448">(</span><span class="op" id="3285449">)</span>&nbsp;<span class="op" id="3285451">!=</span>&nbsp;<span class="ident" id="3285454">nil</span>&nbsp;<span class="op" id="3285458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285464">return</span>&nbsp;<span class="ident" id="3285471">v</span><span class="op" id="3285472">.</span><span class="ident" id="3285473">IP</span><span class="op" id="3285475">,</span>&nbsp;<span class="ident" id="3285477">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285484">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285488">case</span>&nbsp;<span class="op" id="3285493">*</span><span class="ident" id="3285494">IPNet</span><span class="op" id="3285499">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285504">if</span>&nbsp;<span class="ident" id="3285507">v</span><span class="op" id="3285508">.</span><span class="ident" id="3285509">IP</span><span class="op" id="3285511">.</span><span class="ident" id="3285512">To4</span><span class="op" id="3285515">(</span><span class="op" id="3285516">)</span>&nbsp;<span class="op" id="3285518">!=</span>&nbsp;<span class="ident" id="3285521">nil</span>&nbsp;<span class="op" id="3285525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285531">return</span>&nbsp;<span class="ident" id="3285538">v</span><span class="op" id="3285539">.</span><span class="ident" id="3285540">IP</span><span class="op" id="3285542">,</span>&nbsp;<span class="ident" id="3285544">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285555">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285561">return</span>&nbsp;<span class="ident" id="3285568">nil</span><span class="op" id="3285571">,</span>&nbsp;<span class="ident" id="3285573">errNoSuchInterface</span><br>
<span class="lineno"></span><span class="op" id="3285592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3285595">func</span>&nbsp;<span class="ident" id="3285600">setIPv4MreqToInterface</span><span class="op" id="3285622">(</span><span class="ident" id="3285623">mreq</span>&nbsp;<span class="op" id="3285628">*</span><span class="ident" id="3285629">syscall</span><span class="op" id="3285636">.</span><span class="ident" id="3285637">IPMreq</span><span class="op" id="3285643">,</span>&nbsp;<span class="ident" id="3285645">ifi</span>&nbsp;<span class="op" id="3285649">*</span><span class="ident" id="3285650">Interface</span><span class="op" id="3285659">)</span>&nbsp;<span class="builtintype" id="3285661">error</span>&nbsp;<span class="op" id="3285667">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285670">if</span>&nbsp;<span class="ident" id="3285673">ifi</span>&nbsp;<span class="op" id="3285677">==</span>&nbsp;<span class="ident" id="3285680">nil</span>&nbsp;<span class="op" id="3285684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285688">return</span>&nbsp;<span class="ident" id="3285695">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3285703">ifat</span><span class="op" id="3285707">,</span>&nbsp;<span class="ident" id="3285709">err</span>&nbsp;<span class="op" id="3285713">:=</span>&nbsp;<span class="ident" id="3285716">ifi</span><span class="op" id="3285719">.</span><span class="ident" id="3285720">Addrs</span><span class="op" id="3285725">(</span><span class="op" id="3285726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285729">if</span>&nbsp;<span class="ident" id="3285732">err</span>&nbsp;<span class="op" id="3285736">!=</span>&nbsp;<span class="ident" id="3285739">nil</span>&nbsp;<span class="op" id="3285743">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285747">return</span>&nbsp;<span class="ident" id="3285754">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285762">for</span>&nbsp;<span class="ident" id="3285766">_</span><span class="op" id="3285767">,</span>&nbsp;<span class="ident" id="3285769">ifa</span>&nbsp;<span class="op" id="3285773">:=</span>&nbsp;<span class="keyword" id="3285776">range</span>&nbsp;<span class="ident" id="3285782">ifat</span>&nbsp;<span class="op" id="3285787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285791">switch</span>&nbsp;<span class="ident" id="3285798">v</span>&nbsp;<span class="op" id="3285800">:=</span>&nbsp;<span class="ident" id="3285803">ifa</span><span class="op" id="3285806">.</span><span class="op" id="3285807">(</span><span class="keyword" id="3285808">type</span><span class="op" id="3285812">)</span>&nbsp;<span class="op" id="3285814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285818">case</span>&nbsp;<span class="op" id="3285823">*</span><span class="ident" id="3285824">IPAddr</span><span class="op" id="3285830">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285835">if</span>&nbsp;<span class="ident" id="3285838">a</span>&nbsp;<span class="op" id="3285840">:=</span>&nbsp;<span class="ident" id="3285843">v</span><span class="op" id="3285844">.</span><span class="ident" id="3285845">IP</span><span class="op" id="3285847">.</span><span class="ident" id="3285848">To4</span><span class="op" id="3285851">(</span><span class="op" id="3285852">)</span><span class="op" id="3285853">;</span>&nbsp;<span class="ident" id="3285855">a</span>&nbsp;<span class="op" id="3285857">!=</span>&nbsp;<span class="ident" id="3285860">nil</span>&nbsp;<span class="op" id="3285864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3285870">copy</span><span class="op" id="3285874">(</span><span class="ident" id="3285875">mreq</span><span class="op" id="3285879">.</span><span class="ident" id="3285880">Interface</span><span class="op" id="3285889">[</span><span class="op" id="3285890">:</span><span class="op" id="3285891">]</span><span class="op" id="3285892">,</span>&nbsp;<span class="ident" id="3285894">a</span><span class="op" id="3285895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285901">goto</span>&nbsp;<span class="ident" id="3285906">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285918">case</span>&nbsp;<span class="op" id="3285923">*</span><span class="ident" id="3285924">IPNet</span><span class="op" id="3285929">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285934">if</span>&nbsp;<span class="ident" id="3285937">a</span>&nbsp;<span class="op" id="3285939">:=</span>&nbsp;<span class="ident" id="3285942">v</span><span class="op" id="3285943">.</span><span class="ident" id="3285944">IP</span><span class="op" id="3285946">.</span><span class="ident" id="3285947">To4</span><span class="op" id="3285950">(</span><span class="op" id="3285951">)</span><span class="op" id="3285952">;</span>&nbsp;<span class="ident" id="3285954">a</span>&nbsp;<span class="op" id="3285956">!=</span>&nbsp;<span class="ident" id="3285959">nil</span>&nbsp;<span class="op" id="3285963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3285969">copy</span><span class="op" id="3285973">(</span><span class="ident" id="3285974">mreq</span><span class="op" id="3285978">.</span><span class="ident" id="3285979">Interface</span><span class="op" id="3285988">[</span><span class="op" id="3285989">:</span><span class="op" id="3285990">]</span><span class="op" id="3285991">,</span>&nbsp;<span class="ident" id="3285993">a</span><span class="op" id="3285994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286000">goto</span>&nbsp;<span class="ident" id="3286005">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3286013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3286017">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3286020">}</span><br>
<span class="lineno"></span><span class="ident" id="3286022">done</span><span class="op" id="3286026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286029">if</span>&nbsp;<span class="ident" id="3286032">bytesEqual</span><span class="op" id="3286042">(</span><span class="ident" id="3286043">mreq</span><span class="op" id="3286047">.</span><span class="ident" id="3286048">Multiaddr</span><span class="op" id="3286057">[</span><span class="op" id="3286058">:</span><span class="op" id="3286059">]</span><span class="op" id="3286060">,</span>&nbsp;<span class="ident" id="3286062">IPv4zero</span><span class="op" id="3286070">.</span><span class="ident" id="3286071">To4</span><span class="op" id="3286074">(</span><span class="op" id="3286075">)</span><span class="op" id="3286076">)</span>&nbsp;<span class="op" id="3286078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286082">return</span>&nbsp;<span class="ident" id="3286089">errNoSuchMulticastInterface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3286118">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286121">return</span>&nbsp;<span class="ident" id="3286128">nil</span><br>
<span class="lineno"></span><span class="op" id="3286132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3286135">func</span>&nbsp;<span class="ident" id="3286140">setReadBuffer</span><span class="op" id="3286153">(</span><span class="ident" id="3286154">fd</span>&nbsp;<span class="op" id="3286157">*</span><span class="ident" id="3286158">netFD</span><span class="op" id="3286163">,</span>&nbsp;<span class="ident" id="3286165">bytes</span>&nbsp;<span class="builtintype" id="3286171">int</span><span class="op" id="3286174">)</span>&nbsp;<span class="builtintype" id="3286176">error</span>&nbsp;<span class="op" id="3286182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286185">if</span>&nbsp;<span class="ident" id="3286188">err</span>&nbsp;<span class="op" id="3286192">:=</span>&nbsp;<span class="ident" id="3286195">fd</span><span class="op" id="3286197">.</span><span class="ident" id="3286198">incref</span><span class="op" id="3286204">(</span><span class="op" id="3286205">)</span><span class="op" id="3286206">;</span>&nbsp;<span class="ident" id="3286208">err</span>&nbsp;<span class="op" id="3286212">!=</span>&nbsp;<span class="ident" id="3286215">nil</span>&nbsp;<span class="op" id="3286219">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286223">return</span>&nbsp;<span class="ident" id="3286230">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3286235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286238">defer</span>&nbsp;<span class="ident" id="3286244">fd</span><span class="op" id="3286246">.</span><span class="ident" id="3286247">decref</span><span class="op" id="3286253">(</span><span class="op" id="3286254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286257">return</span>&nbsp;<span class="ident" id="3286264">os</span><span class="op" id="3286266">.</span><span class="ident" id="3286267">NewSyscallError</span><span class="op" id="3286282">(</span><span class="string" id="3286283">&#34;setsockopt&#34;</span><span class="op" id="3286295">,</span>&nbsp;<span class="ident" id="3286297">syscall</span><span class="op" id="3286304">.</span><span class="ident" id="3286305">SetsockoptInt</span><span class="op" id="3286318">(</span><span class="ident" id="3286319">fd</span><span class="op" id="3286321">.</span><span class="ident" id="3286322">sysfd</span><span class="op" id="3286327">,</span>&nbsp;<span class="ident" id="3286329">syscall</span><span class="op" id="3286336">.</span><span class="ident" id="3286337">SOL_SOCKET</span><span class="op" id="3286347">,</span>&nbsp;<span class="ident" id="3286349">syscall</span><span class="op" id="3286356">.</span><span class="ident" id="3286357">SO_RCVBUF</span><span class="op" id="3286366">,</span>&nbsp;<span class="ident" id="3286368">bytes</span><span class="op" id="3286373">)</span><span class="op" id="3286374">)</span><br>
<span class="lineno"></span><span class="op" id="3286376">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="3286379">func</span>&nbsp;<span class="ident" id="3286384">setWriteBuffer</span><span class="op" id="3286398">(</span><span class="ident" id="3286399">fd</span>&nbsp;<span class="op" id="3286402">*</span><span class="ident" id="3286403">netFD</span><span class="op" id="3286408">,</span>&nbsp;<span class="ident" id="3286410">bytes</span>&nbsp;<span class="builtintype" id="3286416">int</span><span class="op" id="3286419">)</span>&nbsp;<span class="builtintype" id="3286421">error</span>&nbsp;<span class="op" id="3286427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286430">if</span>&nbsp;<span class="ident" id="3286433">err</span>&nbsp;<span class="op" id="3286437">:=</span>&nbsp;<span class="ident" id="3286440">fd</span><span class="op" id="3286442">.</span><span class="ident" id="3286443">incref</span><span class="op" id="3286449">(</span><span class="op" id="3286450">)</span><span class="op" id="3286451">;</span>&nbsp;<span class="ident" id="3286453">err</span>&nbsp;<span class="op" id="3286457">!=</span>&nbsp;<span class="ident" id="3286460">nil</span>&nbsp;<span class="op" id="3286464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286468">return</span>&nbsp;<span class="ident" id="3286475">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3286480">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286483">defer</span>&nbsp;<span class="ident" id="3286489">fd</span><span class="op" id="3286491">.</span><span class="ident" id="3286492">decref</span><span class="op" id="3286498">(</span><span class="op" id="3286499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286502">return</span>&nbsp;<span class="ident" id="3286509">os</span><span class="op" id="3286511">.</span><span class="ident" id="3286512">NewSyscallError</span><span class="op" id="3286527">(</span><span class="string" id="3286528">&#34;setsockopt&#34;</span><span class="op" id="3286540">,</span>&nbsp;<span class="ident" id="3286542">syscall</span><span class="op" id="3286549">.</span><span class="ident" id="3286550">SetsockoptInt</span><span class="op" id="3286563">(</span><span class="ident" id="3286564">fd</span><span class="op" id="3286566">.</span><span class="ident" id="3286567">sysfd</span><span class="op" id="3286572">,</span>&nbsp;<span class="ident" id="3286574">syscall</span><span class="op" id="3286581">.</span><span class="ident" id="3286582">SOL_SOCKET</span><span class="op" id="3286592">,</span>&nbsp;<span class="ident" id="3286594">syscall</span><span class="op" id="3286601">.</span><span class="ident" id="3286602">SO_SNDBUF</span><span class="op" id="3286611">,</span>&nbsp;<span class="ident" id="3286613">bytes</span><span class="op" id="3286618">)</span><span class="op" id="3286619">)</span><br>
<span class="lineno"></span><span class="op" id="3286621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3286624">func</span>&nbsp;<span class="ident" id="3286629">setKeepAlive</span><span class="op" id="3286641">(</span><span class="ident" id="3286642">fd</span>&nbsp;<span class="op" id="3286645">*</span><span class="ident" id="3286646">netFD</span><span class="op" id="3286651">,</span>&nbsp;<span class="ident" id="3286653">keepalive</span>&nbsp;<span class="builtintype" id="3286663">bool</span><span class="op" id="3286667">)</span>&nbsp;<span class="builtintype" id="3286669">error</span>&nbsp;<span class="op" id="3286675">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286678">if</span>&nbsp;<span class="ident" id="3286681">err</span>&nbsp;<span class="op" id="3286685">:=</span>&nbsp;<span class="ident" id="3286688">fd</span><span class="op" id="3286690">.</span><span class="ident" id="3286691">incref</span><span class="op" id="3286697">(</span><span class="op" id="3286698">)</span><span class="op" id="3286699">;</span>&nbsp;<span class="ident" id="3286701">err</span>&nbsp;<span class="op" id="3286705">!=</span>&nbsp;<span class="ident" id="3286708">nil</span>&nbsp;<span class="op" id="3286712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286716">return</span>&nbsp;<span class="ident" id="3286723">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3286728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286731">defer</span>&nbsp;<span class="ident" id="3286737">fd</span><span class="op" id="3286739">.</span><span class="ident" id="3286740">decref</span><span class="op" id="3286746">(</span><span class="op" id="3286747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286750">return</span>&nbsp;<span class="ident" id="3286757">os</span><span class="op" id="3286759">.</span><span class="ident" id="3286760">NewSyscallError</span><span class="op" id="3286775">(</span><span class="string" id="3286776">&#34;setsockopt&#34;</span><span class="op" id="3286788">,</span>&nbsp;<span class="ident" id="3286790">syscall</span><span class="op" id="3286797">.</span><span class="ident" id="3286798">SetsockoptInt</span><span class="op" id="3286811">(</span><span class="ident" id="3286812">fd</span><span class="op" id="3286814">.</span><span class="ident" id="3286815">sysfd</span><span class="op" id="3286820">,</span>&nbsp;<span class="ident" id="3286822">syscall</span><span class="op" id="3286829">.</span><span class="ident" id="3286830">SOL_SOCKET</span><span class="op" id="3286840">,</span>&nbsp;<span class="ident" id="3286842">syscall</span><span class="op" id="3286849">.</span><span class="ident" id="3286850">SO_KEEPALIVE</span><span class="op" id="3286862">,</span>&nbsp;<span class="ident" id="3286864">boolint</span><span class="op" id="3286871">(</span><span class="ident" id="3286872">keepalive</span><span class="op" id="3286881">)</span><span class="op" id="3286882">)</span><span class="op" id="3286883">)</span><br>
<span class="lineno">125</span><span class="op" id="3286885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3286888">func</span>&nbsp;<span class="ident" id="3286893">setLinger</span><span class="op" id="3286902">(</span><span class="ident" id="3286903">fd</span>&nbsp;<span class="op" id="3286906">*</span><span class="ident" id="3286907">netFD</span><span class="op" id="3286912">,</span>&nbsp;<span class="ident" id="3286914">sec</span>&nbsp;<span class="builtintype" id="3286918">int</span><span class="op" id="3286921">)</span>&nbsp;<span class="builtintype" id="3286923">error</span>&nbsp;<span class="op" id="3286929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286932">var</span>&nbsp;<span class="ident" id="3286936">l</span>&nbsp;<span class="ident" id="3286938">syscall</span><span class="op" id="3286945">.</span><span class="ident" id="3286946">Linger</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286954">if</span>&nbsp;<span class="ident" id="3286957">sec</span>&nbsp;<span class="op" id="3286961">&gt;=</span>&nbsp;<span class="num" id="3286964">0</span>&nbsp;<span class="op" id="3286966">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3286970">l</span><span class="op" id="3286971">.</span><span class="ident" id="3286972">Onoff</span>&nbsp;<span class="op" id="3286978">=</span>&nbsp;<span class="num" id="3286980">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3286984">l</span><span class="op" id="3286985">.</span><span class="ident" id="3286986">Linger</span>&nbsp;<span class="op" id="3286993">=</span>&nbsp;<span class="builtintype" id="3286995">int32</span><span class="op" id="3287000">(</span><span class="ident" id="3287001">sec</span><span class="op" id="3287004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3287007">}</span>&nbsp;<span class="keyword" id="3287009">else</span>&nbsp;<span class="op" id="3287014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3287018">l</span><span class="op" id="3287019">.</span><span class="ident" id="3287020">Onoff</span>&nbsp;<span class="op" id="3287026">=</span>&nbsp;<span class="num" id="3287028">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3287032">l</span><span class="op" id="3287033">.</span><span class="ident" id="3287034">Linger</span>&nbsp;<span class="op" id="3287041">=</span>&nbsp;<span class="num" id="3287043">0</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3287046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287049">if</span>&nbsp;<span class="ident" id="3287052">err</span>&nbsp;<span class="op" id="3287056">:=</span>&nbsp;<span class="ident" id="3287059">fd</span><span class="op" id="3287061">.</span><span class="ident" id="3287062">incref</span><span class="op" id="3287068">(</span><span class="op" id="3287069">)</span><span class="op" id="3287070">;</span>&nbsp;<span class="ident" id="3287072">err</span>&nbsp;<span class="op" id="3287076">!=</span>&nbsp;<span class="ident" id="3287079">nil</span>&nbsp;<span class="op" id="3287083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287087">return</span>&nbsp;<span class="ident" id="3287094">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3287099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287102">defer</span>&nbsp;<span class="ident" id="3287108">fd</span><span class="op" id="3287110">.</span><span class="ident" id="3287111">decref</span><span class="op" id="3287117">(</span><span class="op" id="3287118">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287121">return</span>&nbsp;<span class="ident" id="3287128">os</span><span class="op" id="3287130">.</span><span class="ident" id="3287131">NewSyscallError</span><span class="op" id="3287146">(</span><span class="string" id="3287147">&#34;setsockopt&#34;</span><span class="op" id="3287159">,</span>&nbsp;<span class="ident" id="3287161">syscall</span><span class="op" id="3287168">.</span><span class="ident" id="3287169">SetsockoptLinger</span><span class="op" id="3287185">(</span><span class="ident" id="3287186">fd</span><span class="op" id="3287188">.</span><span class="ident" id="3287189">sysfd</span><span class="op" id="3287194">,</span>&nbsp;<span class="ident" id="3287196">syscall</span><span class="op" id="3287203">.</span><span class="ident" id="3287204">SOL_SOCKET</span><span class="op" id="3287214">,</span>&nbsp;<span class="ident" id="3287216">syscall</span><span class="op" id="3287223">.</span><span class="ident" id="3287224">SO_LINGER</span><span class="op" id="3287233">,</span>&nbsp;<span class="op" id="3287235">&amp;</span><span class="ident" id="3287236">l</span><span class="op" id="3287237">)</span><span class="op" id="3287238">)</span><br>
<span class="lineno"></span><span class="op" id="3287240">}</span>
</div>
</body>
</html>
