<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4959255">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4959310">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4959364">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4959415">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;the&nbsp;exported&nbsp;entry&nbsp;points&nbsp;for&nbsp;invoking&nbsp;the&nbsp;parser.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4959489">package</span>&nbsp;<span class="ident" id="4959497">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4959505">import</span>&nbsp;<span class="op" id="4959512">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4959515">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4959524">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4959534">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4959544">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4959556">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4959562">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4959575">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4959581">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4959598">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4959608">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4959611">//&nbsp;If&nbsp;src&nbsp;!=&nbsp;nil,&nbsp;readSource&nbsp;converts&nbsp;src&nbsp;to&nbsp;a&nbsp;[]byte&nbsp;if&nbsp;possible;</span><br>
<span class="lineno"></span><span class="comment" id="4959678">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.&nbsp;If&nbsp;src&nbsp;==&nbsp;nil,&nbsp;readSource&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4959746">//&nbsp;the&nbsp;result&nbsp;of&nbsp;reading&nbsp;the&nbsp;file&nbsp;specified&nbsp;by&nbsp;filename.</span><br>
<span class="lineno"></span><span class="comment" id="4959803">//</span><br>
<span class="lineno">25</span><span class="keyword" id="4959806">func</span>&nbsp;<span class="ident" id="4959811">readSource</span><span class="op" id="4959821">(</span><span class="ident" id="4959822">filename</span>&nbsp;<span class="builtintype" id="4959831">string</span><span class="op" id="4959837">,</span>&nbsp;<span class="ident" id="4959839">src</span>&nbsp;<span class="keyword" id="4959843">interface</span><span class="op" id="4959852">{</span><span class="op" id="4959853">}</span><span class="op" id="4959854">)</span>&nbsp;<span class="op" id="4959856">(</span><span class="op" id="4959857">[</span><span class="op" id="4959858">]</span><span class="builtintype" id="4959859">byte</span><span class="op" id="4959863">,</span>&nbsp;<span class="builtintype" id="4959865">error</span><span class="op" id="4959870">)</span>&nbsp;<span class="op" id="4959872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959875">if</span>&nbsp;<span class="ident" id="4959878">src</span>&nbsp;<span class="op" id="4959882">!=</span>&nbsp;<span class="ident" id="4959885">nil</span>&nbsp;<span class="op" id="4959889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959893">switch</span>&nbsp;<span class="ident" id="4959900">s</span>&nbsp;<span class="op" id="4959902">:=</span>&nbsp;<span class="ident" id="4959905">src</span><span class="op" id="4959908">.</span><span class="op" id="4959909">(</span><span class="keyword" id="4959910">type</span><span class="op" id="4959914">)</span>&nbsp;<span class="op" id="4959916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959920">case</span>&nbsp;<span class="builtintype" id="4959925">string</span><span class="op" id="4959931">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959936">return</span>&nbsp;<span class="op" id="4959943">[</span><span class="op" id="4959944">]</span><span class="builtintype" id="4959945">byte</span><span class="op" id="4959949">(</span><span class="ident" id="4959950">s</span><span class="op" id="4959951">)</span><span class="op" id="4959952">,</span>&nbsp;<span class="ident" id="4959954">nil</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959960">case</span>&nbsp;<span class="op" id="4959965">[</span><span class="op" id="4959966">]</span><span class="builtintype" id="4959967">byte</span><span class="op" id="4959971">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959976">return</span>&nbsp;<span class="ident" id="4959983">s</span><span class="op" id="4959984">,</span>&nbsp;<span class="ident" id="4959986">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959992">case</span>&nbsp;<span class="op" id="4959997">*</span><span class="ident" id="4959998">bytes</span><span class="op" id="4960003">.</span><span class="ident" id="4960004">Buffer</span><span class="op" id="4960010">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4960015">//&nbsp;is&nbsp;io.Reader,&nbsp;but&nbsp;src&nbsp;is&nbsp;already&nbsp;available&nbsp;in&nbsp;[]byte&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960079">if</span>&nbsp;<span class="ident" id="4960082">s</span>&nbsp;<span class="op" id="4960084">!=</span>&nbsp;<span class="ident" id="4960087">nil</span>&nbsp;<span class="op" id="4960091">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960097">return</span>&nbsp;<span class="ident" id="4960104">s</span><span class="op" id="4960105">.</span><span class="ident" id="4960106">Bytes</span><span class="op" id="4960111">(</span><span class="op" id="4960112">)</span><span class="op" id="4960113">,</span>&nbsp;<span class="ident" id="4960115">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960126">case</span>&nbsp;<span class="ident" id="4960131">io</span><span class="op" id="4960133">.</span><span class="ident" id="4960134">Reader</span><span class="op" id="4960140">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960145">var</span>&nbsp;<span class="ident" id="4960149">buf</span>&nbsp;<span class="ident" id="4960153">bytes</span><span class="op" id="4960158">.</span><span class="ident" id="4960159">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960169">if</span>&nbsp;<span class="ident" id="4960172">_</span><span class="op" id="4960173">,</span>&nbsp;<span class="ident" id="4960175">err</span>&nbsp;<span class="op" id="4960179">:=</span>&nbsp;<span class="ident" id="4960182">io</span><span class="op" id="4960184">.</span><span class="ident" id="4960185">Copy</span><span class="op" id="4960189">(</span><span class="op" id="4960190">&amp;</span><span class="ident" id="4960191">buf</span><span class="op" id="4960194">,</span>&nbsp;<span class="ident" id="4960196">s</span><span class="op" id="4960197">)</span><span class="op" id="4960198">;</span>&nbsp;<span class="ident" id="4960200">err</span>&nbsp;<span class="op" id="4960204">!=</span>&nbsp;<span class="ident" id="4960207">nil</span>&nbsp;<span class="op" id="4960211">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960217">return</span>&nbsp;<span class="ident" id="4960224">nil</span><span class="op" id="4960227">,</span>&nbsp;<span class="ident" id="4960229">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960241">return</span>&nbsp;<span class="ident" id="4960248">buf</span><span class="op" id="4960251">.</span><span class="ident" id="4960252">Bytes</span><span class="op" id="4960257">(</span><span class="op" id="4960258">)</span><span class="op" id="4960259">,</span>&nbsp;<span class="ident" id="4960261">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960271">return</span>&nbsp;<span class="ident" id="4960278">nil</span><span class="op" id="4960281">,</span>&nbsp;<span class="ident" id="4960283">errors</span><span class="op" id="4960289">.</span><span class="ident" id="4960290">New</span><span class="op" id="4960293">(</span><span class="string" id="4960294">&#34;invalid&nbsp;source&#34;</span><span class="op" id="4960310">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960316">return</span>&nbsp;<span class="ident" id="4960323">ioutil</span><span class="op" id="4960329">.</span><span class="ident" id="4960330">ReadFile</span><span class="op" id="4960338">(</span><span class="ident" id="4960339">filename</span><span class="op" id="4960347">)</span><br>
<span class="lineno"></span><span class="op" id="4960349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4960352">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).</span><br>
<span class="lineno">50</span><span class="comment" id="4960394">//&nbsp;They&nbsp;control&nbsp;the&nbsp;amount&nbsp;of&nbsp;source&nbsp;code&nbsp;parsed&nbsp;and&nbsp;other&nbsp;optional</span><br>
<span class="lineno"></span><span class="comment" id="4960462">//&nbsp;parser&nbsp;functionality.</span><br>
<span class="lineno"></span><span class="comment" id="4960487">//</span><br>
<span class="lineno"></span><span class="keyword" id="4960490">type</span>&nbsp;<span class="ident" id="4960495">Mode</span>&nbsp;<span class="builtintype" id="4960500">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4960506">const</span>&nbsp;<span class="op" id="4960512">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960515">PackageClauseOnly</span>&nbsp;<span class="ident" id="4960533">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4960550">=</span>&nbsp;<span class="num" id="4960552">1</span>&nbsp;<span class="op" id="4960554">&lt;&lt;</span>&nbsp;<span class="ident" id="4960557">iota</span>&nbsp;<span class="comment" id="4960562">//&nbsp;stop&nbsp;parsing&nbsp;after&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960600">ImportsOnly</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4960647">//&nbsp;stop&nbsp;parsing&nbsp;after&nbsp;import&nbsp;declarations</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960690">ParseComments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4960737">//&nbsp;parse&nbsp;comments&nbsp;and&nbsp;add&nbsp;them&nbsp;to&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960776">Trace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4960823">//&nbsp;print&nbsp;a&nbsp;trace&nbsp;of&nbsp;parsed&nbsp;productions</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960863">DeclarationErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4960910">//&nbsp;report&nbsp;declaration&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960940">SpuriousErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4960987">//&nbsp;same&nbsp;as&nbsp;AllErrors,&nbsp;for&nbsp;backward-compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961037">AllErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4961055">=</span>&nbsp;<span class="ident" id="4961057">SpuriousErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4961084">//&nbsp;report&nbsp;all&nbsp;errors&nbsp;(not&nbsp;just&nbsp;the&nbsp;first&nbsp;10&nbsp;on&nbsp;different&nbsp;lines)</span><br>
<span class="lineno"></span><span class="op" id="4961148">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4961151">//&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;source&nbsp;code&nbsp;of&nbsp;a&nbsp;single&nbsp;Go&nbsp;source&nbsp;file&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4961226">//&nbsp;the&nbsp;corresponding&nbsp;ast.File&nbsp;node.&nbsp;The&nbsp;source&nbsp;code&nbsp;may&nbsp;be&nbsp;provided&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="4961298">//&nbsp;the&nbsp;filename&nbsp;of&nbsp;the&nbsp;source&nbsp;file,&nbsp;or&nbsp;via&nbsp;the&nbsp;src&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="4961360">//</span><br>
<span class="lineno"></span><span class="comment" id="4961363">//&nbsp;If&nbsp;src&nbsp;!=&nbsp;nil,&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;source&nbsp;from&nbsp;src&nbsp;and&nbsp;the&nbsp;filename&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="4961438">//&nbsp;only&nbsp;used&nbsp;when&nbsp;recording&nbsp;position&nbsp;information.&nbsp;The&nbsp;type&nbsp;of&nbsp;the&nbsp;argument</span><br>
<span class="lineno"></span><span class="comment" id="4961513">//&nbsp;for&nbsp;the&nbsp;src&nbsp;parameter&nbsp;must&nbsp;be&nbsp;string,&nbsp;[]byte,&nbsp;or&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="4961576">//&nbsp;If&nbsp;src&nbsp;==&nbsp;nil,&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;file&nbsp;specified&nbsp;by&nbsp;filename.</span><br>
<span class="lineno"></span><span class="comment" id="4961643">//</span><br>
<span class="lineno"></span><span class="comment" id="4961646">//&nbsp;The&nbsp;mode&nbsp;parameter&nbsp;controls&nbsp;the&nbsp;amount&nbsp;of&nbsp;source&nbsp;text&nbsp;parsed&nbsp;and&nbsp;other</span><br>
<span class="lineno">75</span><span class="comment" id="4961720">//&nbsp;optional&nbsp;parser&nbsp;functionality.&nbsp;Position&nbsp;information&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4961794">//&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno"></span><span class="comment" id="4961812">//</span><br>
<span class="lineno"></span><span class="comment" id="4961815">//&nbsp;If&nbsp;the&nbsp;source&nbsp;couldn&#39;t&nbsp;be&nbsp;read,&nbsp;the&nbsp;returned&nbsp;AST&nbsp;is&nbsp;nil&nbsp;and&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4961888">//&nbsp;indicates&nbsp;the&nbsp;specific&nbsp;failure.&nbsp;If&nbsp;the&nbsp;source&nbsp;was&nbsp;read&nbsp;but&nbsp;syntax</span><br>
<span class="lineno">80</span><span class="comment" id="4961957">//&nbsp;errors&nbsp;were&nbsp;found,&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;partial&nbsp;AST&nbsp;(with&nbsp;ast.Bad*&nbsp;nodes</span><br>
<span class="lineno"></span><span class="comment" id="4962028">//&nbsp;representing&nbsp;the&nbsp;fragments&nbsp;of&nbsp;erroneous&nbsp;source&nbsp;code).&nbsp;Multiple&nbsp;errors</span><br>
<span class="lineno"></span><span class="comment" id="4962101">//&nbsp;are&nbsp;returned&nbsp;via&nbsp;a&nbsp;scanner.ErrorList&nbsp;which&nbsp;is&nbsp;sorted&nbsp;by&nbsp;file&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="4962175">//</span><br>
<span class="lineno"></span><span class="keyword" id="4962178">func</span>&nbsp;<span class="ident" id="4962183">ParseFile</span><span class="op" id="4962192">(</span><span class="ident" id="4962193">fset</span>&nbsp;<span class="op" id="4962198">*</span><span class="ident" id="4962199">token</span><span class="op" id="4962204">.</span><span class="ident" id="4962205">FileSet</span><span class="op" id="4962212">,</span>&nbsp;<span class="ident" id="4962214">filename</span>&nbsp;<span class="builtintype" id="4962223">string</span><span class="op" id="4962229">,</span>&nbsp;<span class="ident" id="4962231">src</span>&nbsp;<span class="keyword" id="4962235">interface</span><span class="op" id="4962244">{</span><span class="op" id="4962245">}</span><span class="op" id="4962246">,</span>&nbsp;<span class="ident" id="4962248">mode</span>&nbsp;<span class="ident" id="4962253">Mode</span><span class="op" id="4962257">)</span>&nbsp;<span class="op" id="4962259">(</span><span class="ident" id="4962260">f</span>&nbsp;<span class="op" id="4962262">*</span><span class="ident" id="4962263">ast</span><span class="op" id="4962266">.</span><span class="ident" id="4962267">File</span><span class="op" id="4962271">,</span>&nbsp;<span class="ident" id="4962273">err</span>&nbsp;<span class="builtintype" id="4962277">error</span><span class="op" id="4962282">)</span>&nbsp;<span class="op" id="4962284">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4962287">//&nbsp;get&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962302">text</span><span class="op" id="4962306">,</span>&nbsp;<span class="ident" id="4962308">err</span>&nbsp;<span class="op" id="4962312">:=</span>&nbsp;<span class="ident" id="4962315">readSource</span><span class="op" id="4962325">(</span><span class="ident" id="4962326">filename</span><span class="op" id="4962334">,</span>&nbsp;<span class="ident" id="4962336">src</span><span class="op" id="4962339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962342">if</span>&nbsp;<span class="ident" id="4962345">err</span>&nbsp;<span class="op" id="4962349">!=</span>&nbsp;<span class="ident" id="4962352">nil</span>&nbsp;<span class="op" id="4962356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962360">return</span>&nbsp;<span class="ident" id="4962367">nil</span><span class="op" id="4962370">,</span>&nbsp;<span class="ident" id="4962372">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962377">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962381">var</span>&nbsp;<span class="ident" id="4962385">p</span>&nbsp;<span class="ident" id="4962387">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962395">defer</span>&nbsp;<span class="keyword" id="4962401">func</span><span class="op" id="4962405">(</span><span class="op" id="4962406">)</span>&nbsp;<span class="op" id="4962408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962412">if</span>&nbsp;<span class="ident" id="4962415">e</span>&nbsp;<span class="op" id="4962417">:=</span>&nbsp;<span class="builtinfunc" id="4962420">recover</span><span class="op" id="4962427">(</span><span class="op" id="4962428">)</span><span class="op" id="4962429">;</span>&nbsp;<span class="ident" id="4962431">e</span>&nbsp;<span class="op" id="4962433">!=</span>&nbsp;<span class="ident" id="4962436">nil</span>&nbsp;<span class="op" id="4962440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962445">_</span>&nbsp;<span class="op" id="4962447">=</span>&nbsp;<span class="ident" id="4962449">e</span><span class="op" id="4962450">.</span><span class="op" id="4962451">(</span><span class="ident" id="4962452">bailout</span><span class="op" id="4962459">)</span>&nbsp;<span class="comment" id="4962461">//&nbsp;re-panics&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;bailout</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4962503">//&nbsp;set&nbsp;result&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962526">if</span>&nbsp;<span class="ident" id="4962529">f</span>&nbsp;<span class="op" id="4962531">==</span>&nbsp;<span class="ident" id="4962534">nil</span>&nbsp;<span class="op" id="4962538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4962543">//&nbsp;source&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;Go&nbsp;source&nbsp;file&nbsp;-&nbsp;satisfy</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4962596">//&nbsp;ParseFile&nbsp;API&nbsp;and&nbsp;return&nbsp;a&nbsp;valid&nbsp;(but)&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4962647">//&nbsp;*ast.File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962663">f</span>&nbsp;<span class="op" id="4962665">=</span>&nbsp;<span class="op" id="4962667">&amp;</span><span class="ident" id="4962668">ast</span><span class="op" id="4962671">.</span><span class="ident" id="4962672">File</span><span class="op" id="4962676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962682">Name</span><span class="op" id="4962686">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="4962689">new</span><span class="op" id="4962692">(</span><span class="ident" id="4962693">ast</span><span class="op" id="4962696">.</span><span class="ident" id="4962697">Ident</span><span class="op" id="4962702">)</span><span class="op" id="4962703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962709">Scope</span><span class="op" id="4962714">:</span>&nbsp;<span class="ident" id="4962716">ast</span><span class="op" id="4962719">.</span><span class="ident" id="4962720">NewScope</span><span class="op" id="4962728">(</span><span class="ident" id="4962729">nil</span><span class="op" id="4962732">)</span><span class="op" id="4962733">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962747">p</span><span class="op" id="4962748">.</span><span class="ident" id="4962749">errors</span><span class="op" id="4962755">.</span><span class="ident" id="4962756">Sort</span><span class="op" id="4962760">(</span><span class="op" id="4962761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962765">err</span>&nbsp;<span class="op" id="4962769">=</span>&nbsp;<span class="ident" id="4962771">p</span><span class="op" id="4962772">.</span><span class="ident" id="4962773">errors</span><span class="op" id="4962779">.</span><span class="ident" id="4962780">Err</span><span class="op" id="4962783">(</span><span class="op" id="4962784">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962787">}</span><span class="op" id="4962788">(</span><span class="op" id="4962789">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4962793">//&nbsp;parse&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962810">p</span><span class="op" id="4962811">.</span><span class="ident" id="4962812">init</span><span class="op" id="4962816">(</span><span class="ident" id="4962817">fset</span><span class="op" id="4962821">,</span>&nbsp;<span class="ident" id="4962823">filename</span><span class="op" id="4962831">,</span>&nbsp;<span class="ident" id="4962833">text</span><span class="op" id="4962837">,</span>&nbsp;<span class="ident" id="4962839">mode</span><span class="op" id="4962843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962846">f</span>&nbsp;<span class="op" id="4962848">=</span>&nbsp;<span class="ident" id="4962850">p</span><span class="op" id="4962851">.</span><span class="ident" id="4962852">parseFile</span><span class="op" id="4962861">(</span><span class="op" id="4962862">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962866">return</span><br>
<span class="lineno"></span><span class="op" id="4962873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4962876">//&nbsp;ParseDir&nbsp;calls&nbsp;ParseFile&nbsp;for&nbsp;all&nbsp;files&nbsp;with&nbsp;names&nbsp;ending&nbsp;in&nbsp;&#34;.go&#34;&nbsp;in&nbsp;the</span><br>
<span class="lineno">120</span><span class="comment" id="4962952">//&nbsp;directory&nbsp;specified&nbsp;by&nbsp;path&nbsp;and&nbsp;returns&nbsp;a&nbsp;map&nbsp;of&nbsp;package&nbsp;name&nbsp;-&gt;&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4963028">//&nbsp;AST&nbsp;with&nbsp;all&nbsp;the&nbsp;packages&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="4963064">//</span><br>
<span class="lineno"></span><span class="comment" id="4963067">//&nbsp;If&nbsp;filter&nbsp;!=&nbsp;nil,&nbsp;only&nbsp;the&nbsp;files&nbsp;with&nbsp;os.FileInfo&nbsp;entries&nbsp;passing&nbsp;through</span><br>
<span class="lineno"></span><span class="comment" id="4963144">//&nbsp;the&nbsp;filter&nbsp;(and&nbsp;ending&nbsp;in&nbsp;&#34;.go&#34;)&nbsp;are&nbsp;considered.&nbsp;The&nbsp;mode&nbsp;bits&nbsp;are&nbsp;passed</span><br>
<span class="lineno">125</span><span class="comment" id="4963221">//&nbsp;to&nbsp;ParseFile&nbsp;unchanged.&nbsp;Position&nbsp;information&nbsp;is&nbsp;recorded&nbsp;in&nbsp;fset.</span><br>
<span class="lineno"></span><span class="comment" id="4963290">//</span><br>
<span class="lineno"></span><span class="comment" id="4963293">//&nbsp;If&nbsp;the&nbsp;directory&nbsp;couldn&#39;t&nbsp;be&nbsp;read,&nbsp;a&nbsp;nil&nbsp;map&nbsp;and&nbsp;the&nbsp;respective&nbsp;error&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4963370">//&nbsp;returned.&nbsp;If&nbsp;a&nbsp;parse&nbsp;error&nbsp;occurred,&nbsp;a&nbsp;non-nil&nbsp;but&nbsp;incomplete&nbsp;map&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4963447">//&nbsp;first&nbsp;error&nbsp;encountered&nbsp;are&nbsp;returned.</span><br>
<span class="lineno">130</span><span class="comment" id="4963488">//</span><br>
<span class="lineno"></span><span class="keyword" id="4963491">func</span>&nbsp;<span class="ident" id="4963496">ParseDir</span><span class="op" id="4963504">(</span><span class="ident" id="4963505">fset</span>&nbsp;<span class="op" id="4963510">*</span><span class="ident" id="4963511">token</span><span class="op" id="4963516">.</span><span class="ident" id="4963517">FileSet</span><span class="op" id="4963524">,</span>&nbsp;<span class="ident" id="4963526">path</span>&nbsp;<span class="builtintype" id="4963531">string</span><span class="op" id="4963537">,</span>&nbsp;<span class="ident" id="4963539">filter</span>&nbsp;<span class="keyword" id="4963546">func</span><span class="op" id="4963550">(</span><span class="ident" id="4963551">os</span><span class="op" id="4963553">.</span><span class="ident" id="4963554">FileInfo</span><span class="op" id="4963562">)</span>&nbsp;<span class="builtintype" id="4963564">bool</span><span class="op" id="4963568">,</span>&nbsp;<span class="ident" id="4963570">mode</span>&nbsp;<span class="ident" id="4963575">Mode</span><span class="op" id="4963579">)</span>&nbsp;<span class="op" id="4963581">(</span><span class="ident" id="4963582">pkgs</span>&nbsp;<span class="keyword" id="4963587">map</span><span class="op" id="4963590">[</span><span class="builtintype" id="4963591">string</span><span class="op" id="4963597">]</span><span class="op" id="4963598">*</span><span class="ident" id="4963599">ast</span><span class="op" id="4963602">.</span><span class="ident" id="4963603">Package</span><span class="op" id="4963610">,</span>&nbsp;<span class="ident" id="4963612">first</span>&nbsp;<span class="builtintype" id="4963618">error</span><span class="op" id="4963623">)</span>&nbsp;<span class="op" id="4963625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963628">fd</span><span class="op" id="4963630">,</span>&nbsp;<span class="ident" id="4963632">err</span>&nbsp;<span class="op" id="4963636">:=</span>&nbsp;<span class="ident" id="4963639">os</span><span class="op" id="4963641">.</span><span class="ident" id="4963642">Open</span><span class="op" id="4963646">(</span><span class="ident" id="4963647">path</span><span class="op" id="4963651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963654">if</span>&nbsp;<span class="ident" id="4963657">err</span>&nbsp;<span class="op" id="4963661">!=</span>&nbsp;<span class="ident" id="4963664">nil</span>&nbsp;<span class="op" id="4963668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963672">return</span>&nbsp;<span class="ident" id="4963679">nil</span><span class="op" id="4963682">,</span>&nbsp;<span class="ident" id="4963684">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4963689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963692">defer</span>&nbsp;<span class="ident" id="4963698">fd</span><span class="op" id="4963700">.</span><span class="ident" id="4963701">Close</span><span class="op" id="4963706">(</span><span class="op" id="4963707">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963711">list</span><span class="op" id="4963715">,</span>&nbsp;<span class="ident" id="4963717">err</span>&nbsp;<span class="op" id="4963721">:=</span>&nbsp;<span class="ident" id="4963724">fd</span><span class="op" id="4963726">.</span><span class="ident" id="4963727">Readdir</span><span class="op" id="4963734">(</span><span class="op" id="4963735">-</span><span class="num" id="4963736">1</span><span class="op" id="4963737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963740">if</span>&nbsp;<span class="ident" id="4963743">err</span>&nbsp;<span class="op" id="4963747">!=</span>&nbsp;<span class="ident" id="4963750">nil</span>&nbsp;<span class="op" id="4963754">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963758">return</span>&nbsp;<span class="ident" id="4963765">nil</span><span class="op" id="4963768">,</span>&nbsp;<span class="ident" id="4963770">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4963775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963779">pkgs</span>&nbsp;<span class="op" id="4963784">=</span>&nbsp;<span class="builtinfunc" id="4963786">make</span><span class="op" id="4963790">(</span><span class="keyword" id="4963791">map</span><span class="op" id="4963794">[</span><span class="builtintype" id="4963795">string</span><span class="op" id="4963801">]</span><span class="op" id="4963802">*</span><span class="ident" id="4963803">ast</span><span class="op" id="4963806">.</span><span class="ident" id="4963807">Package</span><span class="op" id="4963814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963817">for</span>&nbsp;<span class="ident" id="4963821">_</span><span class="op" id="4963822">,</span>&nbsp;<span class="ident" id="4963824">d</span>&nbsp;<span class="op" id="4963826">:=</span>&nbsp;<span class="keyword" id="4963829">range</span>&nbsp;<span class="ident" id="4963835">list</span>&nbsp;<span class="op" id="4963840">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963844">if</span>&nbsp;<span class="ident" id="4963847">strings</span><span class="op" id="4963854">.</span><span class="ident" id="4963855">HasSuffix</span><span class="op" id="4963864">(</span><span class="ident" id="4963865">d</span><span class="op" id="4963866">.</span><span class="ident" id="4963867">Name</span><span class="op" id="4963871">(</span><span class="op" id="4963872">)</span><span class="op" id="4963873">,</span>&nbsp;<span class="string" id="4963875">&#34;.go&#34;</span><span class="op" id="4963880">)</span>&nbsp;<span class="op" id="4963882">&amp;&amp;</span>&nbsp;<span class="op" id="4963885">(</span><span class="ident" id="4963886">filter</span>&nbsp;<span class="op" id="4963893">==</span>&nbsp;<span class="ident" id="4963896">nil</span>&nbsp;<span class="op" id="4963900">||</span>&nbsp;<span class="ident" id="4963903">filter</span><span class="op" id="4963909">(</span><span class="ident" id="4963910">d</span><span class="op" id="4963911">)</span><span class="op" id="4963912">)</span>&nbsp;<span class="op" id="4963914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963919">filename</span>&nbsp;<span class="op" id="4963928">:=</span>&nbsp;<span class="ident" id="4963931">filepath</span><span class="op" id="4963939">.</span><span class="ident" id="4963940">Join</span><span class="op" id="4963944">(</span><span class="ident" id="4963945">path</span><span class="op" id="4963949">,</span>&nbsp;<span class="ident" id="4963951">d</span><span class="op" id="4963952">.</span><span class="ident" id="4963953">Name</span><span class="op" id="4963957">(</span><span class="op" id="4963958">)</span><span class="op" id="4963959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963964">if</span>&nbsp;<span class="ident" id="4963967">src</span><span class="op" id="4963970">,</span>&nbsp;<span class="ident" id="4963972">err</span>&nbsp;<span class="op" id="4963976">:=</span>&nbsp;<span class="ident" id="4963979">ParseFile</span><span class="op" id="4963988">(</span><span class="ident" id="4963989">fset</span><span class="op" id="4963993">,</span>&nbsp;<span class="ident" id="4963995">filename</span><span class="op" id="4964003">,</span>&nbsp;<span class="ident" id="4964005">nil</span><span class="op" id="4964008">,</span>&nbsp;<span class="ident" id="4964010">mode</span><span class="op" id="4964014">)</span><span class="op" id="4964015">;</span>&nbsp;<span class="ident" id="4964017">err</span>&nbsp;<span class="op" id="4964021">==</span>&nbsp;<span class="ident" id="4964024">nil</span>&nbsp;<span class="op" id="4964028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964034">name</span>&nbsp;<span class="op" id="4964039">:=</span>&nbsp;<span class="ident" id="4964042">src</span><span class="op" id="4964045">.</span><span class="ident" id="4964046">Name</span><span class="op" id="4964050">.</span><span class="ident" id="4964051">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964060">pkg</span><span class="op" id="4964063">,</span>&nbsp;<span class="ident" id="4964065">found</span>&nbsp;<span class="op" id="4964071">:=</span>&nbsp;<span class="ident" id="4964074">pkgs</span><span class="op" id="4964078">[</span><span class="ident" id="4964079">name</span><span class="op" id="4964083">]</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964089">if</span>&nbsp;<span class="op" id="4964092">!</span><span class="ident" id="4964093">found</span>&nbsp;<span class="op" id="4964099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964106">pkg</span>&nbsp;<span class="op" id="4964110">=</span>&nbsp;<span class="op" id="4964112">&amp;</span><span class="ident" id="4964113">ast</span><span class="op" id="4964116">.</span><span class="ident" id="4964117">Package</span><span class="op" id="4964124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964132">Name</span><span class="op" id="4964136">:</span>&nbsp;&nbsp;<span class="ident" id="4964139">name</span><span class="op" id="4964143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964151">Files</span><span class="op" id="4964156">:</span>&nbsp;<span class="builtinfunc" id="4964158">make</span><span class="op" id="4964162">(</span><span class="keyword" id="4964163">map</span><span class="op" id="4964166">[</span><span class="builtintype" id="4964167">string</span><span class="op" id="4964173">]</span><span class="op" id="4964174">*</span><span class="ident" id="4964175">ast</span><span class="op" id="4964178">.</span><span class="ident" id="4964179">File</span><span class="op" id="4964183">)</span><span class="op" id="4964184">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964191">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964198">pkgs</span><span class="op" id="4964202">[</span><span class="ident" id="4964203">name</span><span class="op" id="4964207">]</span>&nbsp;<span class="op" id="4964209">=</span>&nbsp;<span class="ident" id="4964211">pkg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964225">pkg</span><span class="op" id="4964228">.</span><span class="ident" id="4964229">Files</span><span class="op" id="4964234">[</span><span class="ident" id="4964235">filename</span><span class="op" id="4964243">]</span>&nbsp;<span class="op" id="4964245">=</span>&nbsp;<span class="ident" id="4964247">src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964254">}</span>&nbsp;<span class="keyword" id="4964256">else</span>&nbsp;<span class="keyword" id="4964261">if</span>&nbsp;<span class="ident" id="4964264">first</span>&nbsp;<span class="op" id="4964270">==</span>&nbsp;<span class="ident" id="4964273">nil</span>&nbsp;<span class="op" id="4964277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964283">first</span>&nbsp;<span class="op" id="4964289">=</span>&nbsp;<span class="ident" id="4964291">err</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964309">return</span><br>
<span class="lineno">165</span><span class="op" id="4964316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4964319">//&nbsp;ParseExpr&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;for&nbsp;obtaining&nbsp;the&nbsp;AST&nbsp;of&nbsp;an&nbsp;expression&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="4964400">//&nbsp;The&nbsp;position&nbsp;information&nbsp;recorded&nbsp;in&nbsp;the&nbsp;AST&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;filename&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4964480">//&nbsp;in&nbsp;error&nbsp;messages&nbsp;is&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno">170</span><span class="comment" id="4964522">//</span><br>
<span class="lineno"></span><span class="keyword" id="4964525">func</span>&nbsp;<span class="ident" id="4964530">ParseExpr</span><span class="op" id="4964539">(</span><span class="ident" id="4964540">x</span>&nbsp;<span class="builtintype" id="4964542">string</span><span class="op" id="4964548">)</span>&nbsp;<span class="op" id="4964550">(</span><span class="ident" id="4964551">ast</span><span class="op" id="4964554">.</span><span class="ident" id="4964555">Expr</span><span class="op" id="4964559">,</span>&nbsp;<span class="builtintype" id="4964561">error</span><span class="op" id="4964566">)</span>&nbsp;<span class="op" id="4964568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964571">var</span>&nbsp;<span class="ident" id="4964575">p</span>&nbsp;<span class="ident" id="4964577">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964585">p</span><span class="op" id="4964586">.</span><span class="ident" id="4964587">init</span><span class="op" id="4964591">(</span><span class="ident" id="4964592">token</span><span class="op" id="4964597">.</span><span class="ident" id="4964598">NewFileSet</span><span class="op" id="4964608">(</span><span class="op" id="4964609">)</span><span class="op" id="4964610">,</span>&nbsp;<span class="string" id="4964612">&#34;&#34;</span><span class="op" id="4964614">,</span>&nbsp;<span class="op" id="4964616">[</span><span class="op" id="4964617">]</span><span class="builtintype" id="4964618">byte</span><span class="op" id="4964622">(</span><span class="ident" id="4964623">x</span><span class="op" id="4964624">)</span><span class="op" id="4964625">,</span>&nbsp;<span class="num" id="4964627">0</span><span class="op" id="4964628">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4964632">//&nbsp;Set&nbsp;up&nbsp;pkg-level&nbsp;scopes&nbsp;to&nbsp;avoid&nbsp;nil-pointer&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4964689">//&nbsp;This&nbsp;is&nbsp;not&nbsp;needed&nbsp;for&nbsp;a&nbsp;correct&nbsp;expression&nbsp;x&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4964746">//&nbsp;parser&nbsp;will&nbsp;be&nbsp;ok&nbsp;with&nbsp;a&nbsp;nil&nbsp;topScope,&nbsp;but&nbsp;be&nbsp;cautious</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4964805">//&nbsp;in&nbsp;case&nbsp;of&nbsp;an&nbsp;erroneous&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964836">p</span><span class="op" id="4964837">.</span><span class="ident" id="4964838">openScope</span><span class="op" id="4964847">(</span><span class="op" id="4964848">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964851">p</span><span class="op" id="4964852">.</span><span class="ident" id="4964853">pkgScope</span>&nbsp;<span class="op" id="4964862">=</span>&nbsp;<span class="ident" id="4964864">p</span><span class="op" id="4964865">.</span><span class="ident" id="4964866">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964876">e</span>&nbsp;<span class="op" id="4964878">:=</span>&nbsp;<span class="ident" id="4964881">p</span><span class="op" id="4964882">.</span><span class="ident" id="4964883">parseRhsOrType</span><span class="op" id="4964897">(</span><span class="op" id="4964898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964901">p</span><span class="op" id="4964902">.</span><span class="ident" id="4964903">closeScope</span><span class="op" id="4964913">(</span><span class="op" id="4964914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964917">assert</span><span class="op" id="4964923">(</span><span class="ident" id="4964924">p</span><span class="op" id="4964925">.</span><span class="ident" id="4964926">topScope</span>&nbsp;<span class="op" id="4964935">==</span>&nbsp;<span class="ident" id="4964938">nil</span><span class="op" id="4964941">,</span>&nbsp;<span class="string" id="4964943">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="4964962">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4964966">//&nbsp;If&nbsp;a&nbsp;semicolon&nbsp;was&nbsp;inserted,&nbsp;consume&nbsp;it;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4965011">//&nbsp;report&nbsp;an&nbsp;error&nbsp;if&nbsp;there&#39;s&nbsp;more&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965055">if</span>&nbsp;<span class="ident" id="4965058">p</span><span class="op" id="4965059">.</span><span class="ident" id="4965060">tok</span>&nbsp;<span class="op" id="4965064">==</span>&nbsp;<span class="ident" id="4965067">token</span><span class="op" id="4965072">.</span><span class="ident" id="4965073">SEMICOLON</span>&nbsp;<span class="op" id="4965083">&amp;&amp;</span>&nbsp;<span class="ident" id="4965086">p</span><span class="op" id="4965087">.</span><span class="ident" id="4965088">lit</span>&nbsp;<span class="op" id="4965092">==</span>&nbsp;<span class="string" id="4965095">&#34;\n&#34;</span>&nbsp;<span class="op" id="4965100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965104">p</span><span class="op" id="4965105">.</span><span class="ident" id="4965106">next</span><span class="op" id="4965110">(</span><span class="op" id="4965111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4965114">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965117">p</span><span class="op" id="4965118">.</span><span class="ident" id="4965119">expect</span><span class="op" id="4965125">(</span><span class="ident" id="4965126">token</span><span class="op" id="4965131">.</span><span class="ident" id="4965132">EOF</span><span class="op" id="4965135">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965139">if</span>&nbsp;<span class="ident" id="4965142">p</span><span class="op" id="4965143">.</span><span class="ident" id="4965144">errors</span><span class="op" id="4965150">.</span><span class="ident" id="4965151">Len</span><span class="op" id="4965154">(</span><span class="op" id="4965155">)</span>&nbsp;<span class="op" id="4965157">&gt;</span>&nbsp;<span class="num" id="4965159">0</span>&nbsp;<span class="op" id="4965161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965165">p</span><span class="op" id="4965166">.</span><span class="ident" id="4965167">errors</span><span class="op" id="4965173">.</span><span class="ident" id="4965174">Sort</span><span class="op" id="4965178">(</span><span class="op" id="4965179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965183">return</span>&nbsp;<span class="ident" id="4965190">nil</span><span class="op" id="4965193">,</span>&nbsp;<span class="ident" id="4965195">p</span><span class="op" id="4965196">.</span><span class="ident" id="4965197">errors</span><span class="op" id="4965203">.</span><span class="ident" id="4965204">Err</span><span class="op" id="4965207">(</span><span class="op" id="4965208">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4965211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965215">return</span>&nbsp;<span class="ident" id="4965222">e</span><span class="op" id="4965223">,</span>&nbsp;<span class="ident" id="4965225">nil</span><br>
<span class="lineno"></span><span class="op" id="4965229">}</span>
</div>
</body>
</html>
