<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4930663">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4930719">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4930773">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4930824">package</span>&nbsp;<span class="ident" id="4930832">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4930838">import</span>&nbsp;<span class="string" id="4930845">&#34;bytes&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4930854">//&nbsp;Compact&nbsp;appends&nbsp;to&nbsp;dst&nbsp;the&nbsp;JSON-encoded&nbsp;src&nbsp;with</span><br>
<span class="lineno">10</span><span class="comment" id="4930906">//&nbsp;insignificant&nbsp;space&nbsp;characters&nbsp;elided.</span><br>
<span class="lineno"></span><span class="keyword" id="4930948">func</span>&nbsp;<span class="ident" id="4930953">Compact</span><span class="op" id="4930960">(</span><span class="ident" id="4930961">dst</span>&nbsp;<span class="op" id="4930965">*</span><span class="ident" id="4930966">bytes</span><span class="op" id="4930971">.</span><span class="ident" id="4930972">Buffer</span><span class="op" id="4930978">,</span>&nbsp;<span class="ident" id="4930980">src</span>&nbsp;<span class="op" id="4930984">[</span><span class="op" id="4930985">]</span><span class="builtintype" id="4930986">byte</span><span class="op" id="4930990">)</span>&nbsp;<span class="builtintype" id="4930992">error</span>&nbsp;<span class="op" id="4930998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4931001">return</span>&nbsp;<span class="ident" id="4931008">compact</span><span class="op" id="4931015">(</span><span class="ident" id="4931016">dst</span><span class="op" id="4931019">,</span>&nbsp;<span class="ident" id="4931021">src</span><span class="op" id="4931024">,</span>&nbsp;<span class="builtintype" id="4931026">false</span><span class="op" id="4931031">)</span><br>
<span class="lineno"></span><span class="op" id="4931033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4931036">func</span>&nbsp;<span class="ident" id="4931041">compact</span><span class="op" id="4931048">(</span><span class="ident" id="4931049">dst</span>&nbsp;<span class="op" id="4931053">*</span><span class="ident" id="4931054">bytes</span><span class="op" id="4931059">.</span><span class="ident" id="4931060">Buffer</span><span class="op" id="4931066">,</span>&nbsp;<span class="ident" id="4931068">src</span>&nbsp;<span class="op" id="4931072">[</span><span class="op" id="4931073">]</span><span class="builtintype" id="4931074">byte</span><span class="op" id="4931078">,</span>&nbsp;<span class="ident" id="4931080">escape</span>&nbsp;<span class="builtintype" id="4931087">bool</span><span class="op" id="4931091">)</span>&nbsp;<span class="builtintype" id="4931093">error</span>&nbsp;<span class="op" id="4931099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4931102">origLen</span>&nbsp;<span class="op" id="4931110">:=</span>&nbsp;<span class="ident" id="4931113">dst</span><span class="op" id="4931116">.</span><span class="ident" id="4931117">Len</span><span class="op" id="4931120">(</span><span class="op" id="4931121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4931124">var</span>&nbsp;<span class="ident" id="4931128">scan</span>&nbsp;<span class="ident" id="4931133">scanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4931142">scan</span><span class="op" id="4931146">.</span><span class="ident" id="4931147">reset</span><span class="op" id="4931152">(</span><span class="op" id="4931153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4931156">start</span>&nbsp;<span class="op" id="4931162">:=</span>&nbsp;<span class="num" id="4931165">0</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4931168">for</span>&nbsp;<span class="ident" id="4931172">i</span><span class="op" id="4931173">,</span>&nbsp;<span class="ident" id="4931175">c</span>&nbsp;<span class="op" id="4931177">:=</span>&nbsp;<span class="keyword" id="4931180">range</span>&nbsp;<span class="ident" id="4931186">src</span>&nbsp;<span class="op" id="4931190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4931194">if</span>&nbsp;<span class="ident" id="4931197">escape</span>&nbsp;<span class="op" id="4931204">&amp;&amp;</span>&nbsp;<span class="op" id="4931207">(</span><span class="ident" id="4931208">c</span>&nbsp;<span class="op" id="4931210">==</span>&nbsp;<span class="string" id="4931213">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4931217">||</span>&nbsp;<span class="ident" id="4931220">c</span>&nbsp;<span class="op" id="4931222">==</span>&nbsp;<span class="string" id="4931225">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="4931229">||</span>&nbsp;<span class="ident" id="4931232">c</span>&nbsp;<span class="op" id="4931234">==</span>&nbsp;<span class="string" id="4931237">&#39;&amp;&#39;</span><span class="op" id="4931240">)</span>&nbsp;<span class="op" id="4931242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4931247">if</span>&nbsp;<span class="ident" id="4931250">start</span>&nbsp;<span class="op" id="4931256">&lt;</span>&nbsp;<span class="ident" id="4931258">i</span>&nbsp;<span class="op" id="4931260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4931266">dst</span><span class="op" id="4931269">.</span><span class="ident" id="4931270">Write</span><span class="op" id="4931275">(</span><span class="ident" id="4931276">src</span><span class="op" id="4931279">[</span><span class="ident" id="4931280">start</span><span class="op" id="4931285">:</span><span class="ident" id="4931286">i</span><span class="op" id="4931287">]</span><span class="op" id="4931288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4931293">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4931298">dst</span><span class="op" id="4931301">.</span><span class="ident" id="4931302">WriteString</span><span class="op" id="4931313">(</span><span class="string" id="4931314">`\u00`</span><span class="op" id="4931320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4931325">dst</span><span class="op" id="4931328">.</span><span class="ident" id="4931329">WriteByte</span><span class="op" id="4931338">(</span><span class="ident" id="4931339">hex</span><span class="op" id="4931342">[</span><span class="ident" id="4931343">c</span><span class="op" id="4931344">&gt;&gt;</span><span class="num" id="4931346">4</span><span class="op" id="4931347">]</span><span class="op" id="4931348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4931353">dst</span><span class="op" id="4931356">.</span><span class="ident" id="4931357">WriteByte</span><span class="op" id="4931366">(</span><span class="ident" id="4931367">hex</span><span class="op" id="4931370">[</span><span class="ident" id="4931371">c</span><span class="op" id="4931372">&amp;</span><span class="num" id="4931373">0xF</span><span class="op" id="4931376">]</span><span class="op" id="4931377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4931382">start</span>&nbsp;<span class="op" id="4931388">=</span>&nbsp;<span class="ident" id="4931390">i</span>&nbsp;<span class="op" id="4931392">+</span>&nbsp;<span class="num" id="4931394">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4931398">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4931402">//&nbsp;Convert&nbsp;U+2028&nbsp;and&nbsp;U+2029&nbsp;(E2&nbsp;80&nbsp;A8&nbsp;and&nbsp;E2&nbsp;80&nbsp;A9).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4931458">if</span>&nbsp;<span class="ident" id="4931461">c</span>&nbsp;<span class="op" id="4931463">==</span>&nbsp;<span class="num" id="4931466">0xE2</span>&nbsp;<span class="op" id="4931471">&amp;&amp;</span>&nbsp;<span class="ident" id="4931474">i</span><span class="op" id="4931475">+</span><span class="num" id="4931476">2</span>&nbsp;<span class="op" id="4931478">&lt;</span>&nbsp;<span class="builtinfunc" id="4931480">len</span><span class="op" id="4931483">(</span><span class="ident" id="4931484">src</span><span class="op" id="4931487">)</span>&nbsp;<span class="op" id="4931489">&amp;&amp;</span>&nbsp;<span class="ident" id="4931492">src</span><span class="op" id="4931495">[</span><span class="ident" id="4931496">i</span><span class="op" id="4931497">+</span><span class="num" id="4931498">1</span><span class="op" id="4931499">]</span>&nbsp;<span class="op" id="4931501">==</span>&nbsp;<span class="num" id="4931504">0x80</span>&nbsp;<span class="op" id="4931509">&amp;&amp;</span>&nbsp;<span class="ident" id="4931512">src</span><span class="op" id="4931515">[</span><span class="ident" id="4931516">i</span><span class="op" id="4931517">+</span><span class="num" id="4931518">2</span><span class="op" id="4931519">]</span><span class="op" id="4931520">&amp;^</span><span class="num" id="4931522">1</span>&nbsp;<span class="op" id="4931524">==</span>&nbsp;<span class="num" id="4931527">0xA8</span>&nbsp;<span class="op" id="4931532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4931537">if</span>&nbsp;<span class="ident" id="4931540">start</span>&nbsp;<span class="op" id="4931546">&lt;</span>&nbsp;<span class="ident" id="4931548">i</span>&nbsp;<span class="op" id="4931550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4931556">dst</span><span class="op" id="4931559">.</span><span class="ident" id="4931560">Write</span><span class="op" id="4931565">(</span><span class="ident" id="4931566">src</span><span class="op" id="4931569">[</span><span class="ident" id="4931570">start</span><span class="op" id="4931575">:</span><span class="ident" id="4931576">i</span><span class="op" id="4931577">]</span><span class="op" id="4931578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4931583">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4931588">dst</span><span class="op" id="4931591">.</span><span class="ident" id="4931592">WriteString</span><span class="op" id="4931603">(</span><span class="string" id="4931604">`\u202`</span><span class="op" id="4931611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4931616">dst</span><span class="op" id="4931619">.</span><span class="ident" id="4931620">WriteByte</span><span class="op" id="4931629">(</span><span class="ident" id="4931630">hex</span><span class="op" id="4931633">[</span><span class="ident" id="4931634">src</span><span class="op" id="4931637">[</span><span class="ident" id="4931638">i</span><span class="op" id="4931639">+</span><span class="num" id="4931640">2</span><span class="op" id="4931641">]</span><span class="op" id="4931642">&amp;</span><span class="num" id="4931643">0xF</span><span class="op" id="4931646">]</span><span class="op" id="4931647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4931652">start</span>&nbsp;<span class="op" id="4931658">=</span>&nbsp;<span class="ident" id="4931660">i</span>&nbsp;<span class="op" id="4931662">+</span>&nbsp;<span class="num" id="4931664">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4931668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4931672">v</span>&nbsp;<span class="op" id="4931674">:=</span>&nbsp;<span class="ident" id="4931677">scan</span><span class="op" id="4931681">.</span><span class="ident" id="4931682">step</span><span class="op" id="4931686">(</span><span class="op" id="4931687">&amp;</span><span class="ident" id="4931688">scan</span><span class="op" id="4931692">,</span>&nbsp;<span class="builtintype" id="4931694">int</span><span class="op" id="4931697">(</span><span class="ident" id="4931698">c</span><span class="op" id="4931699">)</span><span class="op" id="4931700">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4931704">if</span>&nbsp;<span class="ident" id="4931707">v</span>&nbsp;<span class="op" id="4931709">&gt;=</span>&nbsp;<span class="ident" id="4931712">scanSkipSpace</span>&nbsp;<span class="op" id="4931726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4931731">if</span>&nbsp;<span class="ident" id="4931734">v</span>&nbsp;<span class="op" id="4931736">==</span>&nbsp;<span class="ident" id="4931739">scanError</span>&nbsp;<span class="op" id="4931749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4931755">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4931764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4931769">if</span>&nbsp;<span class="ident" id="4931772">start</span>&nbsp;<span class="op" id="4931778">&lt;</span>&nbsp;<span class="ident" id="4931780">i</span>&nbsp;<span class="op" id="4931782">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4931788">dst</span><span class="op" id="4931791">.</span><span class="ident" id="4931792">Write</span><span class="op" id="4931797">(</span><span class="ident" id="4931798">src</span><span class="op" id="4931801">[</span><span class="ident" id="4931802">start</span><span class="op" id="4931807">:</span><span class="ident" id="4931808">i</span><span class="op" id="4931809">]</span><span class="op" id="4931810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4931815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4931820">start</span>&nbsp;<span class="op" id="4931826">=</span>&nbsp;<span class="ident" id="4931828">i</span>&nbsp;<span class="op" id="4931830">+</span>&nbsp;<span class="num" id="4931832">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4931836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4931839">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4931842">if</span>&nbsp;<span class="ident" id="4931845">scan</span><span class="op" id="4931849">.</span><span class="ident" id="4931850">eof</span><span class="op" id="4931853">(</span><span class="op" id="4931854">)</span>&nbsp;<span class="op" id="4931856">==</span>&nbsp;<span class="ident" id="4931859">scanError</span>&nbsp;<span class="op" id="4931869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4931873">dst</span><span class="op" id="4931876">.</span><span class="ident" id="4931877">Truncate</span><span class="op" id="4931885">(</span><span class="ident" id="4931886">origLen</span><span class="op" id="4931893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4931897">return</span>&nbsp;<span class="ident" id="4931904">scan</span><span class="op" id="4931908">.</span><span class="ident" id="4931909">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4931914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4931917">if</span>&nbsp;<span class="ident" id="4931920">start</span>&nbsp;<span class="op" id="4931926">&lt;</span>&nbsp;<span class="builtinfunc" id="4931928">len</span><span class="op" id="4931931">(</span><span class="ident" id="4931932">src</span><span class="op" id="4931935">)</span>&nbsp;<span class="op" id="4931937">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4931941">dst</span><span class="op" id="4931944">.</span><span class="ident" id="4931945">Write</span><span class="op" id="4931950">(</span><span class="ident" id="4931951">src</span><span class="op" id="4931954">[</span><span class="ident" id="4931955">start</span><span class="op" id="4931960">:</span><span class="op" id="4931961">]</span><span class="op" id="4931962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4931965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4931968">return</span>&nbsp;<span class="ident" id="4931975">nil</span><br>
<span class="lineno"></span><span class="op" id="4931979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="4931982">func</span>&nbsp;<span class="ident" id="4931987">newline</span><span class="op" id="4931994">(</span><span class="ident" id="4931995">dst</span>&nbsp;<span class="op" id="4931999">*</span><span class="ident" id="4932000">bytes</span><span class="op" id="4932005">.</span><span class="ident" id="4932006">Buffer</span><span class="op" id="4932012">,</span>&nbsp;<span class="ident" id="4932014">prefix</span><span class="op" id="4932020">,</span>&nbsp;<span class="ident" id="4932022">indent</span>&nbsp;<span class="builtintype" id="4932029">string</span><span class="op" id="4932035">,</span>&nbsp;<span class="ident" id="4932037">depth</span>&nbsp;<span class="builtintype" id="4932043">int</span><span class="op" id="4932046">)</span>&nbsp;<span class="op" id="4932048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4932051">dst</span><span class="op" id="4932054">.</span><span class="ident" id="4932055">WriteByte</span><span class="op" id="4932064">(</span><span class="string" id="4932065">&#39;\n&#39;</span><span class="op" id="4932069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4932072">dst</span><span class="op" id="4932075">.</span><span class="ident" id="4932076">WriteString</span><span class="op" id="4932087">(</span><span class="ident" id="4932088">prefix</span><span class="op" id="4932094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4932097">for</span>&nbsp;<span class="ident" id="4932101">i</span>&nbsp;<span class="op" id="4932103">:=</span>&nbsp;<span class="num" id="4932106">0</span><span class="op" id="4932107">;</span>&nbsp;<span class="ident" id="4932109">i</span>&nbsp;<span class="op" id="4932111">&lt;</span>&nbsp;<span class="ident" id="4932113">depth</span><span class="op" id="4932118">;</span>&nbsp;<span class="ident" id="4932120">i</span><span class="op" id="4932121">++</span>&nbsp;<span class="op" id="4932124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4932128">dst</span><span class="op" id="4932131">.</span><span class="ident" id="4932132">WriteString</span><span class="op" id="4932143">(</span><span class="ident" id="4932144">indent</span><span class="op" id="4932150">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4932153">}</span><br>
<span class="lineno"></span><span class="op" id="4932155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4932158">//&nbsp;Indent&nbsp;appends&nbsp;to&nbsp;dst&nbsp;an&nbsp;indented&nbsp;form&nbsp;of&nbsp;the&nbsp;JSON-encoded&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="4932225">//&nbsp;Each&nbsp;element&nbsp;in&nbsp;a&nbsp;JSON&nbsp;object&nbsp;or&nbsp;array&nbsp;begins&nbsp;on&nbsp;a&nbsp;new,</span><br>
<span class="lineno">70</span><span class="comment" id="4932284">//&nbsp;indented&nbsp;line&nbsp;beginning&nbsp;with&nbsp;prefix&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="4932347">//&nbsp;copies&nbsp;of&nbsp;indent&nbsp;according&nbsp;to&nbsp;the&nbsp;indentation&nbsp;nesting.</span><br>
<span class="lineno"></span><span class="comment" id="4932405">//&nbsp;The&nbsp;data&nbsp;appended&nbsp;to&nbsp;dst&nbsp;does&nbsp;not&nbsp;begin&nbsp;with&nbsp;the&nbsp;prefix&nbsp;nor</span><br>
<span class="lineno"></span><span class="comment" id="4932468">//&nbsp;any&nbsp;indentation,&nbsp;and&nbsp;has&nbsp;no&nbsp;trailing&nbsp;newline,&nbsp;to&nbsp;make&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4932528">//&nbsp;easier&nbsp;to&nbsp;embed&nbsp;inside&nbsp;other&nbsp;formatted&nbsp;JSON&nbsp;data.</span><br>
<span class="lineno">75</span><span class="keyword" id="4932581">func</span>&nbsp;<span class="ident" id="4932586">Indent</span><span class="op" id="4932592">(</span><span class="ident" id="4932593">dst</span>&nbsp;<span class="op" id="4932597">*</span><span class="ident" id="4932598">bytes</span><span class="op" id="4932603">.</span><span class="ident" id="4932604">Buffer</span><span class="op" id="4932610">,</span>&nbsp;<span class="ident" id="4932612">src</span>&nbsp;<span class="op" id="4932616">[</span><span class="op" id="4932617">]</span><span class="builtintype" id="4932618">byte</span><span class="op" id="4932622">,</span>&nbsp;<span class="ident" id="4932624">prefix</span><span class="op" id="4932630">,</span>&nbsp;<span class="ident" id="4932632">indent</span>&nbsp;<span class="builtintype" id="4932639">string</span><span class="op" id="4932645">)</span>&nbsp;<span class="builtintype" id="4932647">error</span>&nbsp;<span class="op" id="4932653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4932656">origLen</span>&nbsp;<span class="op" id="4932664">:=</span>&nbsp;<span class="ident" id="4932667">dst</span><span class="op" id="4932670">.</span><span class="ident" id="4932671">Len</span><span class="op" id="4932674">(</span><span class="op" id="4932675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4932678">var</span>&nbsp;<span class="ident" id="4932682">scan</span>&nbsp;<span class="ident" id="4932687">scanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4932696">scan</span><span class="op" id="4932700">.</span><span class="ident" id="4932701">reset</span><span class="op" id="4932706">(</span><span class="op" id="4932707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4932710">needIndent</span>&nbsp;<span class="op" id="4932721">:=</span>&nbsp;<span class="builtintype" id="4932724">false</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4932731">depth</span>&nbsp;<span class="op" id="4932737">:=</span>&nbsp;<span class="num" id="4932740">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4932743">for</span>&nbsp;<span class="ident" id="4932747">_</span><span class="op" id="4932748">,</span>&nbsp;<span class="ident" id="4932750">c</span>&nbsp;<span class="op" id="4932752">:=</span>&nbsp;<span class="keyword" id="4932755">range</span>&nbsp;<span class="ident" id="4932761">src</span>&nbsp;<span class="op" id="4932765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4932769">scan</span><span class="op" id="4932773">.</span><span class="ident" id="4932774">bytes</span><span class="op" id="4932779">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4932784">v</span>&nbsp;<span class="op" id="4932786">:=</span>&nbsp;<span class="ident" id="4932789">scan</span><span class="op" id="4932793">.</span><span class="ident" id="4932794">step</span><span class="op" id="4932798">(</span><span class="op" id="4932799">&amp;</span><span class="ident" id="4932800">scan</span><span class="op" id="4932804">,</span>&nbsp;<span class="builtintype" id="4932806">int</span><span class="op" id="4932809">(</span><span class="ident" id="4932810">c</span><span class="op" id="4932811">)</span><span class="op" id="4932812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4932816">if</span>&nbsp;<span class="ident" id="4932819">v</span>&nbsp;<span class="op" id="4932821">==</span>&nbsp;<span class="ident" id="4932824">scanSkipSpace</span>&nbsp;<span class="op" id="4932838">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4932843">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4932854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4932858">if</span>&nbsp;<span class="ident" id="4932861">v</span>&nbsp;<span class="op" id="4932863">==</span>&nbsp;<span class="ident" id="4932866">scanError</span>&nbsp;<span class="op" id="4932876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4932881">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4932889">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4932893">if</span>&nbsp;<span class="ident" id="4932896">needIndent</span>&nbsp;<span class="op" id="4932907">&amp;&amp;</span>&nbsp;<span class="ident" id="4932910">v</span>&nbsp;<span class="op" id="4932912">!=</span>&nbsp;<span class="ident" id="4932915">scanEndObject</span>&nbsp;<span class="op" id="4932929">&amp;&amp;</span>&nbsp;<span class="ident" id="4932932">v</span>&nbsp;<span class="op" id="4932934">!=</span>&nbsp;<span class="ident" id="4932937">scanEndArray</span>&nbsp;<span class="op" id="4932950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4932955">needIndent</span>&nbsp;<span class="op" id="4932966">=</span>&nbsp;<span class="builtintype" id="4932968">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4932977">depth</span><span class="op" id="4932982">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4932988">newline</span><span class="op" id="4932995">(</span><span class="ident" id="4932996">dst</span><span class="op" id="4932999">,</span>&nbsp;<span class="ident" id="4933001">prefix</span><span class="op" id="4933007">,</span>&nbsp;<span class="ident" id="4933009">indent</span><span class="op" id="4933015">,</span>&nbsp;<span class="ident" id="4933017">depth</span><span class="op" id="4933022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4933026">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4933031">//&nbsp;Emit&nbsp;semantically&nbsp;uninteresting&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4933074">//&nbsp;(in&nbsp;particular,&nbsp;punctuation&nbsp;in&nbsp;strings)&nbsp;unmodified.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4933131">if</span>&nbsp;<span class="ident" id="4933134">v</span>&nbsp;<span class="op" id="4933136">==</span>&nbsp;<span class="ident" id="4933139">scanContinue</span>&nbsp;<span class="op" id="4933152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4933157">dst</span><span class="op" id="4933160">.</span><span class="ident" id="4933161">WriteByte</span><span class="op" id="4933170">(</span><span class="ident" id="4933171">c</span><span class="op" id="4933172">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4933177">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4933188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4933193">//&nbsp;Add&nbsp;spacing&nbsp;around&nbsp;real&nbsp;punctuation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4933235">switch</span>&nbsp;<span class="ident" id="4933242">c</span>&nbsp;<span class="op" id="4933244">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4933248">case</span>&nbsp;<span class="string" id="4933253">&#39;{&#39;</span><span class="op" id="4933256">,</span>&nbsp;<span class="string" id="4933258">&#39;[&#39;</span><span class="op" id="4933261">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4933266">//&nbsp;delay&nbsp;indent&nbsp;so&nbsp;that&nbsp;empty&nbsp;object&nbsp;and&nbsp;array&nbsp;are&nbsp;formatted&nbsp;as&nbsp;{}&nbsp;and&nbsp;[].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4933344">needIndent</span>&nbsp;<span class="op" id="4933355">=</span>&nbsp;<span class="builtintype" id="4933357">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4933365">dst</span><span class="op" id="4933368">.</span><span class="ident" id="4933369">WriteByte</span><span class="op" id="4933378">(</span><span class="ident" id="4933379">c</span><span class="op" id="4933380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4933385">case</span>&nbsp;<span class="string" id="4933390">&#39;,&#39;</span><span class="op" id="4933393">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4933398">dst</span><span class="op" id="4933401">.</span><span class="ident" id="4933402">WriteByte</span><span class="op" id="4933411">(</span><span class="ident" id="4933412">c</span><span class="op" id="4933413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4933418">newline</span><span class="op" id="4933425">(</span><span class="ident" id="4933426">dst</span><span class="op" id="4933429">,</span>&nbsp;<span class="ident" id="4933431">prefix</span><span class="op" id="4933437">,</span>&nbsp;<span class="ident" id="4933439">indent</span><span class="op" id="4933445">,</span>&nbsp;<span class="ident" id="4933447">depth</span><span class="op" id="4933452">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4933457">case</span>&nbsp;<span class="string" id="4933462">&#39;:&#39;</span><span class="op" id="4933465">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4933470">dst</span><span class="op" id="4933473">.</span><span class="ident" id="4933474">WriteByte</span><span class="op" id="4933483">(</span><span class="ident" id="4933484">c</span><span class="op" id="4933485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4933490">dst</span><span class="op" id="4933493">.</span><span class="ident" id="4933494">WriteByte</span><span class="op" id="4933503">(</span><span class="string" id="4933504">&#39;&nbsp;&#39;</span><span class="op" id="4933507">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4933512">case</span>&nbsp;<span class="string" id="4933517">&#39;}&#39;</span><span class="op" id="4933520">,</span>&nbsp;<span class="string" id="4933522">&#39;]&#39;</span><span class="op" id="4933525">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4933530">if</span>&nbsp;<span class="ident" id="4933533">needIndent</span>&nbsp;<span class="op" id="4933544">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4933550">//&nbsp;suppress&nbsp;indent&nbsp;in&nbsp;empty&nbsp;object/array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4933595">needIndent</span>&nbsp;<span class="op" id="4933606">=</span>&nbsp;<span class="builtintype" id="4933608">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4933617">}</span>&nbsp;<span class="keyword" id="4933619">else</span>&nbsp;<span class="op" id="4933624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4933630">depth</span><span class="op" id="4933635">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4933642">newline</span><span class="op" id="4933649">(</span><span class="ident" id="4933650">dst</span><span class="op" id="4933653">,</span>&nbsp;<span class="ident" id="4933655">prefix</span><span class="op" id="4933661">,</span>&nbsp;<span class="ident" id="4933663">indent</span><span class="op" id="4933669">,</span>&nbsp;<span class="ident" id="4933671">depth</span><span class="op" id="4933676">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4933681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4933686">dst</span><span class="op" id="4933689">.</span><span class="ident" id="4933690">WriteByte</span><span class="op" id="4933699">(</span><span class="ident" id="4933700">c</span><span class="op" id="4933701">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4933706">default</span><span class="op" id="4933713">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4933718">dst</span><span class="op" id="4933721">.</span><span class="ident" id="4933722">WriteByte</span><span class="op" id="4933731">(</span><span class="ident" id="4933732">c</span><span class="op" id="4933733">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4933737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4933740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4933743">if</span>&nbsp;<span class="ident" id="4933746">scan</span><span class="op" id="4933750">.</span><span class="ident" id="4933751">eof</span><span class="op" id="4933754">(</span><span class="op" id="4933755">)</span>&nbsp;<span class="op" id="4933757">==</span>&nbsp;<span class="ident" id="4933760">scanError</span>&nbsp;<span class="op" id="4933770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4933774">dst</span><span class="op" id="4933777">.</span><span class="ident" id="4933778">Truncate</span><span class="op" id="4933786">(</span><span class="ident" id="4933787">origLen</span><span class="op" id="4933794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4933798">return</span>&nbsp;<span class="ident" id="4933805">scan</span><span class="op" id="4933809">.</span><span class="ident" id="4933810">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4933815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4933818">return</span>&nbsp;<span class="ident" id="4933825">nil</span><br>
<span class="lineno"></span><span class="op" id="4933829">}</span>
</div>
</body>
</html>
