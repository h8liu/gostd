<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1384968">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1385024">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1385078">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1385129">//&nbsp;Package&nbsp;atomic&nbsp;provides&nbsp;low-level&nbsp;atomic&nbsp;memory&nbsp;primitives</span><br>
<span class="lineno"></span><span class="comment" id="1385191">//&nbsp;useful&nbsp;for&nbsp;implementing&nbsp;synchronization&nbsp;algorithms.</span><br>
<span class="lineno"></span><span class="comment" id="1385246">//</span><br>
<span class="lineno"></span><span class="comment" id="1385249">//&nbsp;These&nbsp;functions&nbsp;require&nbsp;great&nbsp;care&nbsp;to&nbsp;be&nbsp;used&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="comment" id="1385309">//&nbsp;Except&nbsp;for&nbsp;special,&nbsp;low-level&nbsp;applications,&nbsp;synchronization&nbsp;is&nbsp;better</span><br>
<span class="lineno">10</span><span class="comment" id="1385382">//&nbsp;done&nbsp;with&nbsp;channels&nbsp;or&nbsp;the&nbsp;facilities&nbsp;of&nbsp;the&nbsp;sync&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="1385443">//&nbsp;Share&nbsp;memory&nbsp;by&nbsp;communicating;</span><br>
<span class="lineno"></span><span class="comment" id="1385477">//&nbsp;don&#39;t&nbsp;communicate&nbsp;by&nbsp;sharing&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1385517">//</span><br>
<span class="lineno"></span><span class="comment" id="1385520">//&nbsp;The&nbsp;swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;SwapT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno">15</span><span class="comment" id="1385593">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1385611">//</span><br>
<span class="lineno"></span><span class="comment" id="1385614">//&nbsp;&nbsp;&nbsp;&nbspold&nbsp;=&nbsp;*addr</span><br>
<span class="lineno"></span><span class="comment" id="1385629">//&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1385644">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;old</span><br>
<span class="lineno">20</span><span class="comment" id="1385658">//</span><br>
<span class="lineno"></span><span class="comment" id="1385661">//&nbsp;The&nbsp;compare-and-swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;CompareAndSwapT</span><br>
<span class="lineno"></span><span class="comment" id="1385731">//&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1385774">//</span><br>
<span class="lineno"></span><span class="comment" id="1385777">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;*addr&nbsp;==&nbsp;old&nbsp;{</span><br>
<span class="lineno">25</span><span class="comment" id="1385798">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1385814">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="1385830">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1385835">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;false</span><br>
<span class="lineno"></span><span class="comment" id="1385851">//</span><br>
<span class="lineno">30</span><span class="comment" id="1385854">//&nbsp;The&nbsp;add&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;AddT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno"></span><span class="comment" id="1385925">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1385943">//</span><br>
<span class="lineno"></span><span class="comment" id="1385946">//&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;+=&nbsp;delta</span><br>
<span class="lineno"></span><span class="comment" id="1385964">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;*addr</span><br>
<span class="lineno">35</span><span class="comment" id="1385980">//</span><br>
<span class="lineno"></span><span class="comment" id="1385983">//&nbsp;The&nbsp;load&nbsp;and&nbsp;store&nbsp;operations,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;LoadT&nbsp;and&nbsp;StoreT</span><br>
<span class="lineno"></span><span class="comment" id="1386053">//&nbsp;functions,&nbsp;are&nbsp;the&nbsp;atomic&nbsp;equivalents&nbsp;of&nbsp;&#34;return&nbsp;*addr&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1386116">//&nbsp;&#34;*addr&nbsp;=&nbsp;val&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1386134">//</span><br>
<span class="lineno">40</span><span class="keyword" id="1386137">package</span>&nbsp;<span class="ident" id="1386145">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1386153">import</span>&nbsp;<span class="op" id="1386160">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1386163">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1386172">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1386175">//&nbsp;BUG(rsc):&nbsp;On&nbsp;x86-32,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;Pentium&nbsp;MMX.</span><br>
<span class="lineno"></span><span class="comment" id="1386273">//</span><br>
<span class="lineno"></span><span class="comment" id="1386276">//&nbsp;On&nbsp;non-Linux&nbsp;ARM,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;ARMv6k&nbsp;core.</span><br>
<span class="lineno"></span><span class="comment" id="1386371">//</span><br>
<span class="lineno">50</span><span class="comment" id="1386374">//&nbsp;On&nbsp;both&nbsp;ARM&nbsp;and&nbsp;x86-32,&nbsp;it&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;arrange&nbsp;for&nbsp;64-bit</span><br>
<span class="lineno"></span><span class="comment" id="1386457">//&nbsp;alignment&nbsp;of&nbsp;64-bit&nbsp;words&nbsp;accessed&nbsp;atomically.&nbsp;The&nbsp;first&nbsp;word&nbsp;in&nbsp;a&nbsp;global</span><br>
<span class="lineno"></span><span class="comment" id="1386534">//&nbsp;variable&nbsp;or&nbsp;in&nbsp;an&nbsp;allocated&nbsp;struct&nbsp;or&nbsp;slice&nbsp;can&nbsp;be&nbsp;relied&nbsp;upon&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1386606">//&nbsp;64-bit&nbsp;aligned.</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1386626">//&nbsp;SwapInt32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1386710">func</span>&nbsp;<span class="ident" id="1386715">SwapInt32</span><span class="op" id="1386724">(</span><span class="ident" id="1386725">addr</span>&nbsp;<span class="op" id="1386730">*</span><span class="builtintype" id="1386731">int32</span><span class="op" id="1386736">,</span>&nbsp;<span class="builtinfunc" id="1386738">new</span>&nbsp;<span class="builtintype" id="1386742">int32</span><span class="op" id="1386747">)</span>&nbsp;<span class="op" id="1386749">(</span><span class="ident" id="1386750">old</span>&nbsp;<span class="builtintype" id="1386754">int32</span><span class="op" id="1386759">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1386762">//&nbsp;SwapInt64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1386846">func</span>&nbsp;<span class="ident" id="1386851">SwapInt64</span><span class="op" id="1386860">(</span><span class="ident" id="1386861">addr</span>&nbsp;<span class="op" id="1386866">*</span><span class="ident" id="1386867">int64</span><span class="op" id="1386872">,</span>&nbsp;<span class="builtinfunc" id="1386874">new</span>&nbsp;<span class="ident" id="1386878">int64</span><span class="op" id="1386883">)</span>&nbsp;<span class="op" id="1386885">(</span><span class="ident" id="1386886">old</span>&nbsp;<span class="ident" id="1386890">int64</span><span class="op" id="1386895">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="1386898">//&nbsp;SwapUint32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1386983">func</span>&nbsp;<span class="ident" id="1386988">SwapUint32</span><span class="op" id="1386998">(</span><span class="ident" id="1386999">addr</span>&nbsp;<span class="op" id="1387004">*</span><span class="builtintype" id="1387005">uint32</span><span class="op" id="1387011">,</span>&nbsp;<span class="builtinfunc" id="1387013">new</span>&nbsp;<span class="builtintype" id="1387017">uint32</span><span class="op" id="1387023">)</span>&nbsp;<span class="op" id="1387025">(</span><span class="ident" id="1387026">old</span>&nbsp;<span class="builtintype" id="1387030">uint32</span><span class="op" id="1387036">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1387039">//&nbsp;SwapUint64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno">65</span><span class="keyword" id="1387124">func</span>&nbsp;<span class="ident" id="1387129">SwapUint64</span><span class="op" id="1387139">(</span><span class="ident" id="1387140">addr</span>&nbsp;<span class="op" id="1387145">*</span><span class="ident" id="1387146">uint64</span><span class="op" id="1387152">,</span>&nbsp;<span class="builtinfunc" id="1387154">new</span>&nbsp;<span class="ident" id="1387158">uint64</span><span class="op" id="1387164">)</span>&nbsp;<span class="op" id="1387166">(</span><span class="ident" id="1387167">old</span>&nbsp;<span class="ident" id="1387171">uint64</span><span class="op" id="1387177">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1387180">//&nbsp;SwapUintptr&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1387266">func</span>&nbsp;<span class="ident" id="1387271">SwapUintptr</span><span class="op" id="1387282">(</span><span class="ident" id="1387283">addr</span>&nbsp;<span class="op" id="1387288">*</span><span class="builtintype" id="1387289">uintptr</span><span class="op" id="1387296">,</span>&nbsp;<span class="builtinfunc" id="1387298">new</span>&nbsp;<span class="builtintype" id="1387302">uintptr</span><span class="op" id="1387309">)</span>&nbsp;<span class="op" id="1387311">(</span><span class="ident" id="1387312">old</span>&nbsp;<span class="builtintype" id="1387316">uintptr</span><span class="op" id="1387323">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="1387326">//&nbsp;SwapPointer&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1387412">func</span>&nbsp;<span class="ident" id="1387417">SwapPointer</span><span class="op" id="1387428">(</span><span class="ident" id="1387429">addr</span>&nbsp;<span class="op" id="1387434">*</span><span class="ident" id="1387435">unsafe</span><span class="op" id="1387441">.</span><span class="ident" id="1387442">Pointer</span><span class="op" id="1387449">,</span>&nbsp;<span class="builtinfunc" id="1387451">new</span>&nbsp;<span class="ident" id="1387455">unsafe</span><span class="op" id="1387461">.</span><span class="ident" id="1387462">Pointer</span><span class="op" id="1387469">)</span>&nbsp;<span class="op" id="1387471">(</span><span class="ident" id="1387472">old</span>&nbsp;<span class="ident" id="1387476">unsafe</span><span class="op" id="1387482">.</span><span class="ident" id="1387483">Pointer</span><span class="op" id="1387490">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1387493">//&nbsp;CompareAndSwapInt32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int32&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1387576">func</span>&nbsp;<span class="ident" id="1387581">CompareAndSwapInt32</span><span class="op" id="1387600">(</span><span class="ident" id="1387601">addr</span>&nbsp;<span class="op" id="1387606">*</span><span class="builtintype" id="1387607">int32</span><span class="op" id="1387612">,</span>&nbsp;<span class="ident" id="1387614">old</span><span class="op" id="1387617">,</span>&nbsp;<span class="builtinfunc" id="1387619">new</span>&nbsp;<span class="builtintype" id="1387623">int32</span><span class="op" id="1387628">)</span>&nbsp;<span class="op" id="1387630">(</span><span class="ident" id="1387631">swapped</span>&nbsp;<span class="builtintype" id="1387639">bool</span><span class="op" id="1387643">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="1387646">//&nbsp;CompareAndSwapInt64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1387729">func</span>&nbsp;<span class="ident" id="1387734">CompareAndSwapInt64</span><span class="op" id="1387753">(</span><span class="ident" id="1387754">addr</span>&nbsp;<span class="op" id="1387759">*</span><span class="ident" id="1387760">int64</span><span class="op" id="1387765">,</span>&nbsp;<span class="ident" id="1387767">old</span><span class="op" id="1387770">,</span>&nbsp;<span class="builtinfunc" id="1387772">new</span>&nbsp;<span class="ident" id="1387776">int64</span><span class="op" id="1387781">)</span>&nbsp;<span class="op" id="1387783">(</span><span class="ident" id="1387784">swapped</span>&nbsp;<span class="builtintype" id="1387792">bool</span><span class="op" id="1387796">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1387799">//&nbsp;CompareAndSwapUint32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint32&nbsp;value.</span><br>
<span class="lineno">80</span><span class="keyword" id="1387883">func</span>&nbsp;<span class="ident" id="1387888">CompareAndSwapUint32</span><span class="op" id="1387908">(</span><span class="ident" id="1387909">addr</span>&nbsp;<span class="op" id="1387914">*</span><span class="builtintype" id="1387915">uint32</span><span class="op" id="1387921">,</span>&nbsp;<span class="ident" id="1387923">old</span><span class="op" id="1387926">,</span>&nbsp;<span class="builtinfunc" id="1387928">new</span>&nbsp;<span class="builtintype" id="1387932">uint32</span><span class="op" id="1387938">)</span>&nbsp;<span class="op" id="1387940">(</span><span class="ident" id="1387941">swapped</span>&nbsp;<span class="builtintype" id="1387949">bool</span><span class="op" id="1387953">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1387956">//&nbsp;CompareAndSwapUint64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1388040">func</span>&nbsp;<span class="ident" id="1388045">CompareAndSwapUint64</span><span class="op" id="1388065">(</span><span class="ident" id="1388066">addr</span>&nbsp;<span class="op" id="1388071">*</span><span class="ident" id="1388072">uint64</span><span class="op" id="1388078">,</span>&nbsp;<span class="ident" id="1388080">old</span><span class="op" id="1388083">,</span>&nbsp;<span class="builtinfunc" id="1388085">new</span>&nbsp;<span class="ident" id="1388089">uint64</span><span class="op" id="1388095">)</span>&nbsp;<span class="op" id="1388097">(</span><span class="ident" id="1388098">swapped</span>&nbsp;<span class="builtintype" id="1388106">bool</span><span class="op" id="1388110">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1388113">//&nbsp;CompareAndSwapUintptr&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uintptr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1388199">func</span>&nbsp;<span class="ident" id="1388204">CompareAndSwapUintptr</span><span class="op" id="1388225">(</span><span class="ident" id="1388226">addr</span>&nbsp;<span class="op" id="1388231">*</span><span class="builtintype" id="1388232">uintptr</span><span class="op" id="1388239">,</span>&nbsp;<span class="ident" id="1388241">old</span><span class="op" id="1388244">,</span>&nbsp;<span class="builtinfunc" id="1388246">new</span>&nbsp;<span class="builtintype" id="1388250">uintptr</span><span class="op" id="1388257">)</span>&nbsp;<span class="op" id="1388259">(</span><span class="ident" id="1388260">swapped</span>&nbsp;<span class="builtintype" id="1388268">bool</span><span class="op" id="1388272">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1388275">//&nbsp;CompareAndSwapPointer&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;unsafe.Pointer&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1388368">func</span>&nbsp;<span class="ident" id="1388373">CompareAndSwapPointer</span><span class="op" id="1388394">(</span><span class="ident" id="1388395">addr</span>&nbsp;<span class="op" id="1388400">*</span><span class="ident" id="1388401">unsafe</span><span class="op" id="1388407">.</span><span class="ident" id="1388408">Pointer</span><span class="op" id="1388415">,</span>&nbsp;<span class="ident" id="1388417">old</span><span class="op" id="1388420">,</span>&nbsp;<span class="builtinfunc" id="1388422">new</span>&nbsp;<span class="ident" id="1388426">unsafe</span><span class="op" id="1388432">.</span><span class="ident" id="1388433">Pointer</span><span class="op" id="1388440">)</span>&nbsp;<span class="op" id="1388442">(</span><span class="ident" id="1388443">swapped</span>&nbsp;<span class="builtintype" id="1388451">bool</span><span class="op" id="1388455">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="1388458">//&nbsp;AddInt32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1388528">func</span>&nbsp;<span class="ident" id="1388533">AddInt32</span><span class="op" id="1388541">(</span><span class="ident" id="1388542">addr</span>&nbsp;<span class="op" id="1388547">*</span><span class="builtintype" id="1388548">int32</span><span class="op" id="1388553">,</span>&nbsp;<span class="ident" id="1388555">delta</span>&nbsp;<span class="builtintype" id="1388561">int32</span><span class="op" id="1388566">)</span>&nbsp;<span class="op" id="1388568">(</span><span class="builtinfunc" id="1388569">new</span>&nbsp;<span class="builtintype" id="1388573">int32</span><span class="op" id="1388578">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1388581">//&nbsp;AddUint32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">95</span><span class="comment" id="1388652">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1388742">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(0)).</span><br>
<span class="lineno"></span><span class="keyword" id="1388806">func</span>&nbsp;<span class="ident" id="1388811">AddUint32</span><span class="op" id="1388820">(</span><span class="ident" id="1388821">addr</span>&nbsp;<span class="op" id="1388826">*</span><span class="builtintype" id="1388827">uint32</span><span class="op" id="1388833">,</span>&nbsp;<span class="ident" id="1388835">delta</span>&nbsp;<span class="builtintype" id="1388841">uint32</span><span class="op" id="1388847">)</span>&nbsp;<span class="op" id="1388849">(</span><span class="builtinfunc" id="1388850">new</span>&nbsp;<span class="builtintype" id="1388854">uint32</span><span class="op" id="1388860">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1388863">//&nbsp;AddInt64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">100</span><span class="keyword" id="1388933">func</span>&nbsp;<span class="ident" id="1388938">AddInt64</span><span class="op" id="1388946">(</span><span class="ident" id="1388947">addr</span>&nbsp;<span class="op" id="1388952">*</span><span class="ident" id="1388953">int64</span><span class="op" id="1388958">,</span>&nbsp;<span class="ident" id="1388960">delta</span>&nbsp;<span class="ident" id="1388966">int64</span><span class="op" id="1388971">)</span>&nbsp;<span class="op" id="1388973">(</span><span class="builtinfunc" id="1388974">new</span>&nbsp;<span class="ident" id="1388978">int64</span><span class="op" id="1388983">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1388986">//&nbsp;AddUint64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1389057">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1389147">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(0)).</span><br>
<span class="lineno">105</span><span class="keyword" id="1389211">func</span>&nbsp;<span class="ident" id="1389216">AddUint64</span><span class="op" id="1389225">(</span><span class="ident" id="1389226">addr</span>&nbsp;<span class="op" id="1389231">*</span><span class="ident" id="1389232">uint64</span><span class="op" id="1389238">,</span>&nbsp;<span class="ident" id="1389240">delta</span>&nbsp;<span class="ident" id="1389246">uint64</span><span class="op" id="1389252">)</span>&nbsp;<span class="op" id="1389254">(</span><span class="builtinfunc" id="1389255">new</span>&nbsp;<span class="ident" id="1389259">uint64</span><span class="op" id="1389265">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1389268">//&nbsp;AddUintptr&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1389340">func</span>&nbsp;<span class="ident" id="1389345">AddUintptr</span><span class="op" id="1389355">(</span><span class="ident" id="1389356">addr</span>&nbsp;<span class="op" id="1389361">*</span><span class="builtintype" id="1389362">uintptr</span><span class="op" id="1389369">,</span>&nbsp;<span class="ident" id="1389371">delta</span>&nbsp;<span class="builtintype" id="1389377">uintptr</span><span class="op" id="1389384">)</span>&nbsp;<span class="op" id="1389386">(</span><span class="builtinfunc" id="1389387">new</span>&nbsp;<span class="builtintype" id="1389391">uintptr</span><span class="op" id="1389398">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1389401">//&nbsp;LoadInt32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1389438">func</span>&nbsp;<span class="ident" id="1389443">LoadInt32</span><span class="op" id="1389452">(</span><span class="ident" id="1389453">addr</span>&nbsp;<span class="op" id="1389458">*</span><span class="builtintype" id="1389459">int32</span><span class="op" id="1389464">)</span>&nbsp;<span class="op" id="1389466">(</span><span class="ident" id="1389467">val</span>&nbsp;<span class="builtintype" id="1389471">int32</span><span class="op" id="1389476">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1389479">//&nbsp;LoadInt64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1389516">func</span>&nbsp;<span class="ident" id="1389521">LoadInt64</span><span class="op" id="1389530">(</span><span class="ident" id="1389531">addr</span>&nbsp;<span class="op" id="1389536">*</span><span class="ident" id="1389537">int64</span><span class="op" id="1389542">)</span>&nbsp;<span class="op" id="1389544">(</span><span class="ident" id="1389545">val</span>&nbsp;<span class="ident" id="1389549">int64</span><span class="op" id="1389554">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1389557">//&nbsp;LoadUint32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1389595">func</span>&nbsp;<span class="ident" id="1389600">LoadUint32</span><span class="op" id="1389610">(</span><span class="ident" id="1389611">addr</span>&nbsp;<span class="op" id="1389616">*</span><span class="builtintype" id="1389617">uint32</span><span class="op" id="1389623">)</span>&nbsp;<span class="op" id="1389625">(</span><span class="ident" id="1389626">val</span>&nbsp;<span class="builtintype" id="1389630">uint32</span><span class="op" id="1389636">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1389639">//&nbsp;LoadUint64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno">120</span><span class="keyword" id="1389677">func</span>&nbsp;<span class="ident" id="1389682">LoadUint64</span><span class="op" id="1389692">(</span><span class="ident" id="1389693">addr</span>&nbsp;<span class="op" id="1389698">*</span><span class="ident" id="1389699">uint64</span><span class="op" id="1389705">)</span>&nbsp;<span class="op" id="1389707">(</span><span class="ident" id="1389708">val</span>&nbsp;<span class="ident" id="1389712">uint64</span><span class="op" id="1389718">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1389721">//&nbsp;LoadUintptr&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1389760">func</span>&nbsp;<span class="ident" id="1389765">LoadUintptr</span><span class="op" id="1389776">(</span><span class="ident" id="1389777">addr</span>&nbsp;<span class="op" id="1389782">*</span><span class="builtintype" id="1389783">uintptr</span><span class="op" id="1389790">)</span>&nbsp;<span class="op" id="1389792">(</span><span class="ident" id="1389793">val</span>&nbsp;<span class="builtintype" id="1389797">uintptr</span><span class="op" id="1389804">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="1389807">//&nbsp;LoadPointer&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1389846">func</span>&nbsp;<span class="ident" id="1389851">LoadPointer</span><span class="op" id="1389862">(</span><span class="ident" id="1389863">addr</span>&nbsp;<span class="op" id="1389868">*</span><span class="ident" id="1389869">unsafe</span><span class="op" id="1389875">.</span><span class="ident" id="1389876">Pointer</span><span class="op" id="1389883">)</span>&nbsp;<span class="op" id="1389885">(</span><span class="ident" id="1389886">val</span>&nbsp;<span class="ident" id="1389890">unsafe</span><span class="op" id="1389896">.</span><span class="ident" id="1389897">Pointer</span><span class="op" id="1389904">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1389907">//&nbsp;StoreInt32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1389955">func</span>&nbsp;<span class="ident" id="1389960">StoreInt32</span><span class="op" id="1389970">(</span><span class="ident" id="1389971">addr</span>&nbsp;<span class="op" id="1389976">*</span><span class="builtintype" id="1389977">int32</span><span class="op" id="1389982">,</span>&nbsp;<span class="ident" id="1389984">val</span>&nbsp;<span class="builtintype" id="1389988">int32</span><span class="op" id="1389993">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1389996">//&nbsp;StoreInt64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1390044">func</span>&nbsp;<span class="ident" id="1390049">StoreInt64</span><span class="op" id="1390059">(</span><span class="ident" id="1390060">addr</span>&nbsp;<span class="op" id="1390065">*</span><span class="ident" id="1390066">int64</span><span class="op" id="1390071">,</span>&nbsp;<span class="ident" id="1390073">val</span>&nbsp;<span class="ident" id="1390077">int64</span><span class="op" id="1390082">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1390085">//&nbsp;StoreUint32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno">135</span><span class="keyword" id="1390134">func</span>&nbsp;<span class="ident" id="1390139">StoreUint32</span><span class="op" id="1390150">(</span><span class="ident" id="1390151">addr</span>&nbsp;<span class="op" id="1390156">*</span><span class="builtintype" id="1390157">uint32</span><span class="op" id="1390163">,</span>&nbsp;<span class="ident" id="1390165">val</span>&nbsp;<span class="builtintype" id="1390169">uint32</span><span class="op" id="1390175">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1390178">//&nbsp;StoreUint64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1390227">func</span>&nbsp;<span class="ident" id="1390232">StoreUint64</span><span class="op" id="1390243">(</span><span class="ident" id="1390244">addr</span>&nbsp;<span class="op" id="1390249">*</span><span class="ident" id="1390250">uint64</span><span class="op" id="1390256">,</span>&nbsp;<span class="ident" id="1390258">val</span>&nbsp;<span class="ident" id="1390262">uint64</span><span class="op" id="1390268">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1390271">//&nbsp;StoreUintptr&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1390321">func</span>&nbsp;<span class="ident" id="1390326">StoreUintptr</span><span class="op" id="1390338">(</span><span class="ident" id="1390339">addr</span>&nbsp;<span class="op" id="1390344">*</span><span class="builtintype" id="1390345">uintptr</span><span class="op" id="1390352">,</span>&nbsp;<span class="ident" id="1390354">val</span>&nbsp;<span class="builtintype" id="1390358">uintptr</span><span class="op" id="1390365">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1390368">//&nbsp;StorePointer&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1390418">func</span>&nbsp;<span class="ident" id="1390423">StorePointer</span><span class="op" id="1390435">(</span><span class="ident" id="1390436">addr</span>&nbsp;<span class="op" id="1390441">*</span><span class="ident" id="1390442">unsafe</span><span class="op" id="1390448">.</span><span class="ident" id="1390449">Pointer</span><span class="op" id="1390456">,</span>&nbsp;<span class="ident" id="1390458">val</span>&nbsp;<span class="ident" id="1390462">unsafe</span><span class="op" id="1390468">.</span><span class="ident" id="1390469">Pointer</span><span class="op" id="1390476">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1390479">//&nbsp;Helper&nbsp;for&nbsp;ARM.&nbsp;&nbsp;Linker&nbsp;will&nbsp;discard&nbsp;on&nbsp;other&nbsp;systems</span><br>
<span class="lineno"></span><span class="keyword" id="1390536">func</span>&nbsp;<span class="ident" id="1390541">panic64</span><span class="op" id="1390548">(</span><span class="op" id="1390549">)</span>&nbsp;<span class="op" id="1390551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1390554">panic</span><span class="op" id="1390559">(</span><span class="string" id="1390560">&#34;sync/atomic:&nbsp;broken&nbsp;64-bit&nbsp;atomic&nbsp;operations&nbsp;(buggy&nbsp;QEMU)&#34;</span><span class="op" id="1390619">)</span><br>
<span class="lineno"></span><span class="op" id="1390621">}</span>
</div>
</body>
</html>
