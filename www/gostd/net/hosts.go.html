<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html" class="current">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3749171">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3749226">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3749280">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3749331">//&nbsp;Read&nbsp;static&nbsp;host/IP&nbsp;entries&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3749380">package</span>&nbsp;<span class="ident" id="3749388">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3749393">import</span>&nbsp;<span class="op" id="3749400">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3749403">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3749411">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3749418">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3749421">const</span>&nbsp;<span class="ident" id="3749427">cacheMaxAge</span>&nbsp;<span class="op" id="3749439">=</span>&nbsp;<span class="num" id="3749441">5</span>&nbsp;<span class="op" id="3749443">*</span>&nbsp;<span class="ident" id="3749445">time</span><span class="op" id="3749449">.</span><span class="ident" id="3749450">Minute</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3749458">//&nbsp;hostsPath&nbsp;points&nbsp;to&nbsp;the&nbsp;file&nbsp;with&nbsp;static&nbsp;IP/address&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="3749522">var</span>&nbsp;<span class="ident" id="3749526">hostsPath</span>&nbsp;<span class="op" id="3749536">=</span>&nbsp;<span class="string" id="3749538">&#34;/etc/hosts&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3749552">//&nbsp;Simple&nbsp;cache.</span><br>
<span class="lineno">20</span><span class="keyword" id="3749569">var</span>&nbsp;<span class="ident" id="3749573">hosts</span>&nbsp;<span class="keyword" id="3749579">struct</span>&nbsp;<span class="op" id="3749586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749589">sync</span><span class="op" id="3749593">.</span><span class="ident" id="3749594">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749601">byName</span>&nbsp;<span class="keyword" id="3749608">map</span><span class="op" id="3749611">[</span><span class="builtintype" id="3749612">string</span><span class="op" id="3749618">]</span><span class="op" id="3749619">[</span><span class="op" id="3749620">]</span><span class="builtintype" id="3749621">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749629">byAddr</span>&nbsp;<span class="keyword" id="3749636">map</span><span class="op" id="3749639">[</span><span class="builtintype" id="3749640">string</span><span class="op" id="3749646">]</span><span class="op" id="3749647">[</span><span class="op" id="3749648">]</span><span class="builtintype" id="3749649">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749657">expire</span>&nbsp;<span class="ident" id="3749664">time</span><span class="op" id="3749668">.</span><span class="ident" id="3749669">Time</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749675">path</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3749682">string</span><br>
<span class="lineno"></span><span class="op" id="3749689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3749692">func</span>&nbsp;<span class="ident" id="3749697">readHosts</span><span class="op" id="3749706">(</span><span class="op" id="3749707">)</span>&nbsp;<span class="op" id="3749709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749712">now</span>&nbsp;<span class="op" id="3749716">:=</span>&nbsp;<span class="ident" id="3749719">time</span><span class="op" id="3749723">.</span><span class="ident" id="3749724">Now</span><span class="op" id="3749727">(</span><span class="op" id="3749728">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749731">hp</span>&nbsp;<span class="op" id="3749734">:=</span>&nbsp;<span class="ident" id="3749737">hostsPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749748">if</span>&nbsp;<span class="builtinfunc" id="3749751">len</span><span class="op" id="3749754">(</span><span class="ident" id="3749755">hosts</span><span class="op" id="3749760">.</span><span class="ident" id="3749761">byName</span><span class="op" id="3749767">)</span>&nbsp;<span class="op" id="3749769">==</span>&nbsp;<span class="num" id="3749772">0</span>&nbsp;<span class="op" id="3749774">||</span>&nbsp;<span class="ident" id="3749777">now</span><span class="op" id="3749780">.</span><span class="ident" id="3749781">After</span><span class="op" id="3749786">(</span><span class="ident" id="3749787">hosts</span><span class="op" id="3749792">.</span><span class="ident" id="3749793">expire</span><span class="op" id="3749799">)</span>&nbsp;<span class="op" id="3749801">||</span>&nbsp;<span class="ident" id="3749804">hosts</span><span class="op" id="3749809">.</span><span class="ident" id="3749810">path</span>&nbsp;<span class="op" id="3749815">!=</span>&nbsp;<span class="ident" id="3749818">hp</span>&nbsp;<span class="op" id="3749821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749825">hs</span>&nbsp;<span class="op" id="3749828">:=</span>&nbsp;<span class="builtinfunc" id="3749831">make</span><span class="op" id="3749835">(</span><span class="keyword" id="3749836">map</span><span class="op" id="3749839">[</span><span class="builtintype" id="3749840">string</span><span class="op" id="3749846">]</span><span class="op" id="3749847">[</span><span class="op" id="3749848">]</span><span class="builtintype" id="3749849">string</span><span class="op" id="3749855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749859">is</span>&nbsp;<span class="op" id="3749862">:=</span>&nbsp;<span class="builtinfunc" id="3749865">make</span><span class="op" id="3749869">(</span><span class="keyword" id="3749870">map</span><span class="op" id="3749873">[</span><span class="builtintype" id="3749874">string</span><span class="op" id="3749880">]</span><span class="op" id="3749881">[</span><span class="op" id="3749882">]</span><span class="builtintype" id="3749883">string</span><span class="op" id="3749889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749893">var</span>&nbsp;<span class="ident" id="3749897">file</span>&nbsp;<span class="op" id="3749902">*</span><span class="ident" id="3749903">file</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749910">if</span>&nbsp;<span class="ident" id="3749913">file</span><span class="op" id="3749917">,</span>&nbsp;<span class="ident" id="3749919">_</span>&nbsp;<span class="op" id="3749921">=</span>&nbsp;<span class="ident" id="3749923">open</span><span class="op" id="3749927">(</span><span class="ident" id="3749928">hp</span><span class="op" id="3749930">)</span><span class="op" id="3749931">;</span>&nbsp;<span class="ident" id="3749933">file</span>&nbsp;<span class="op" id="3749938">==</span>&nbsp;<span class="builtintype" id="3749941">nil</span>&nbsp;<span class="op" id="3749945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749950">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3749959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749963">for</span>&nbsp;<span class="ident" id="3749967">line</span><span class="op" id="3749971">,</span>&nbsp;<span class="ident" id="3749973">ok</span>&nbsp;<span class="op" id="3749976">:=</span>&nbsp;<span class="ident" id="3749979">file</span><span class="op" id="3749983">.</span><span class="ident" id="3749984">readLine</span><span class="op" id="3749992">(</span><span class="op" id="3749993">)</span><span class="op" id="3749994">;</span>&nbsp;<span class="ident" id="3749996">ok</span><span class="op" id="3749998">;</span>&nbsp;<span class="ident" id="3750000">line</span><span class="op" id="3750004">,</span>&nbsp;<span class="ident" id="3750006">ok</span>&nbsp;<span class="op" id="3750009">=</span>&nbsp;<span class="ident" id="3750011">file</span><span class="op" id="3750015">.</span><span class="ident" id="3750016">readLine</span><span class="op" id="3750024">(</span><span class="op" id="3750025">)</span>&nbsp;<span class="op" id="3750027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750032">if</span>&nbsp;<span class="ident" id="3750035">i</span>&nbsp;<span class="op" id="3750037">:=</span>&nbsp;<span class="ident" id="3750040">byteIndex</span><span class="op" id="3750049">(</span><span class="ident" id="3750050">line</span><span class="op" id="3750054">,</span>&nbsp;<span class="string" id="3750056">&#39;#&#39;</span><span class="op" id="3750059">)</span><span class="op" id="3750060">;</span>&nbsp;<span class="ident" id="3750062">i</span>&nbsp;<span class="op" id="3750064">&gt;=</span>&nbsp;<span class="num" id="3750067">0</span>&nbsp;<span class="op" id="3750069">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3750075">//&nbsp;Discard&nbsp;comments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750100">line</span>&nbsp;<span class="op" id="3750105">=</span>&nbsp;<span class="ident" id="3750107">line</span><span class="op" id="3750111">[</span><span class="num" id="3750112">0</span><span class="op" id="3750113">:</span><span class="ident" id="3750114">i</span><span class="op" id="3750115">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3750120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750125">f</span>&nbsp;<span class="op" id="3750127">:=</span>&nbsp;<span class="ident" id="3750130">getFields</span><span class="op" id="3750139">(</span><span class="ident" id="3750140">line</span><span class="op" id="3750144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750149">if</span>&nbsp;<span class="builtinfunc" id="3750152">len</span><span class="op" id="3750155">(</span><span class="ident" id="3750156">f</span><span class="op" id="3750157">)</span>&nbsp;<span class="op" id="3750159">&lt;</span>&nbsp;<span class="num" id="3750161">2</span>&nbsp;<span class="op" id="3750163">||</span>&nbsp;<span class="ident" id="3750166">ParseIP</span><span class="op" id="3750173">(</span><span class="ident" id="3750174">f</span><span class="op" id="3750175">[</span><span class="num" id="3750176">0</span><span class="op" id="3750177">]</span><span class="op" id="3750178">)</span>&nbsp;<span class="op" id="3750180">==</span>&nbsp;<span class="builtintype" id="3750183">nil</span>&nbsp;<span class="op" id="3750187">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750193">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3750205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750210">for</span>&nbsp;<span class="ident" id="3750214">i</span>&nbsp;<span class="op" id="3750216">:=</span>&nbsp;<span class="num" id="3750219">1</span><span class="op" id="3750220">;</span>&nbsp;<span class="ident" id="3750222">i</span>&nbsp;<span class="op" id="3750224">&lt;</span>&nbsp;<span class="builtinfunc" id="3750226">len</span><span class="op" id="3750229">(</span><span class="ident" id="3750230">f</span><span class="op" id="3750231">)</span><span class="op" id="3750232">;</span>&nbsp;<span class="ident" id="3750234">i</span><span class="op" id="3750235">++</span>&nbsp;<span class="op" id="3750238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750244">h</span>&nbsp;<span class="op" id="3750246">:=</span>&nbsp;<span class="ident" id="3750249">f</span><span class="op" id="3750250">[</span><span class="ident" id="3750251">i</span><span class="op" id="3750252">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750258">hs</span><span class="op" id="3750260">[</span><span class="ident" id="3750261">h</span><span class="op" id="3750262">]</span>&nbsp;<span class="op" id="3750264">=</span>&nbsp;<span class="builtinfunc" id="3750266">append</span><span class="op" id="3750272">(</span><span class="ident" id="3750273">hs</span><span class="op" id="3750275">[</span><span class="ident" id="3750276">h</span><span class="op" id="3750277">]</span><span class="op" id="3750278">,</span>&nbsp;<span class="ident" id="3750280">f</span><span class="op" id="3750281">[</span><span class="num" id="3750282">0</span><span class="op" id="3750283">]</span><span class="op" id="3750284">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750290">is</span><span class="op" id="3750292">[</span><span class="ident" id="3750293">f</span><span class="op" id="3750294">[</span><span class="num" id="3750295">0</span><span class="op" id="3750296">]</span><span class="op" id="3750297">]</span>&nbsp;<span class="op" id="3750299">=</span>&nbsp;<span class="builtinfunc" id="3750301">append</span><span class="op" id="3750307">(</span><span class="ident" id="3750308">is</span><span class="op" id="3750310">[</span><span class="ident" id="3750311">f</span><span class="op" id="3750312">[</span><span class="num" id="3750313">0</span><span class="op" id="3750314">]</span><span class="op" id="3750315">]</span><span class="op" id="3750316">,</span>&nbsp;<span class="ident" id="3750318">h</span><span class="op" id="3750319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3750324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3750328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3750332">//&nbsp;Update&nbsp;the&nbsp;data&nbsp;cache.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750360">hosts</span><span class="op" id="3750365">.</span><span class="ident" id="3750366">expire</span>&nbsp;<span class="op" id="3750373">=</span>&nbsp;<span class="ident" id="3750375">now</span><span class="op" id="3750378">.</span><span class="ident" id="3750379">Add</span><span class="op" id="3750382">(</span><span class="ident" id="3750383">cacheMaxAge</span><span class="op" id="3750394">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750398">hosts</span><span class="op" id="3750403">.</span><span class="ident" id="3750404">path</span>&nbsp;<span class="op" id="3750409">=</span>&nbsp;<span class="ident" id="3750411">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750416">hosts</span><span class="op" id="3750421">.</span><span class="ident" id="3750422">byName</span>&nbsp;<span class="op" id="3750429">=</span>&nbsp;<span class="ident" id="3750431">hs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750436">hosts</span><span class="op" id="3750441">.</span><span class="ident" id="3750442">byAddr</span>&nbsp;<span class="op" id="3750449">=</span>&nbsp;<span class="ident" id="3750451">is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750456">file</span><span class="op" id="3750460">.</span><span class="builtinfunc" id="3750461">close</span><span class="op" id="3750466">(</span><span class="op" id="3750467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3750470">}</span><br>
<span class="lineno">60</span><span class="op" id="3750472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3750475">//&nbsp;lookupStaticHost&nbsp;looks&nbsp;up&nbsp;the&nbsp;addresses&nbsp;for&nbsp;the&nbsp;given&nbsp;host&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3750554">func</span>&nbsp;<span class="ident" id="3750559">lookupStaticHost</span><span class="op" id="3750575">(</span><span class="ident" id="3750576">host</span>&nbsp;<span class="builtintype" id="3750581">string</span><span class="op" id="3750587">)</span>&nbsp;<span class="op" id="3750589">[</span><span class="op" id="3750590">]</span><span class="builtintype" id="3750591">string</span>&nbsp;<span class="op" id="3750598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750601">hosts</span><span class="op" id="3750606">.</span><span class="ident" id="3750607">Lock</span><span class="op" id="3750611">(</span><span class="op" id="3750612">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750615">defer</span>&nbsp;<span class="ident" id="3750621">hosts</span><span class="op" id="3750626">.</span><span class="ident" id="3750627">Unlock</span><span class="op" id="3750633">(</span><span class="op" id="3750634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750637">readHosts</span><span class="op" id="3750646">(</span><span class="op" id="3750647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750650">if</span>&nbsp;<span class="builtinfunc" id="3750653">len</span><span class="op" id="3750656">(</span><span class="ident" id="3750657">hosts</span><span class="op" id="3750662">.</span><span class="ident" id="3750663">byName</span><span class="op" id="3750669">)</span>&nbsp;<span class="op" id="3750671">!=</span>&nbsp;<span class="num" id="3750674">0</span>&nbsp;<span class="op" id="3750676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750680">if</span>&nbsp;<span class="ident" id="3750683">ips</span><span class="op" id="3750686">,</span>&nbsp;<span class="ident" id="3750688">ok</span>&nbsp;<span class="op" id="3750691">:=</span>&nbsp;<span class="ident" id="3750694">hosts</span><span class="op" id="3750699">.</span><span class="ident" id="3750700">byName</span><span class="op" id="3750706">[</span><span class="ident" id="3750707">host</span><span class="op" id="3750711">]</span><span class="op" id="3750712">;</span>&nbsp;<span class="ident" id="3750714">ok</span>&nbsp;<span class="op" id="3750717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750722">return</span>&nbsp;<span class="ident" id="3750729">ips</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3750735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3750738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750741">return</span>&nbsp;<span class="builtintype" id="3750748">nil</span><br>
<span class="lineno"></span><span class="op" id="3750752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="3750755">//&nbsp;lookupStaticAddr&nbsp;looks&nbsp;up&nbsp;the&nbsp;hosts&nbsp;for&nbsp;the&nbsp;given&nbsp;address&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3750833">func</span>&nbsp;<span class="ident" id="3750838">lookupStaticAddr</span><span class="op" id="3750854">(</span><span class="ident" id="3750855">addr</span>&nbsp;<span class="builtintype" id="3750860">string</span><span class="op" id="3750866">)</span>&nbsp;<span class="op" id="3750868">[</span><span class="op" id="3750869">]</span><span class="builtintype" id="3750870">string</span>&nbsp;<span class="op" id="3750877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750880">hosts</span><span class="op" id="3750885">.</span><span class="ident" id="3750886">Lock</span><span class="op" id="3750890">(</span><span class="op" id="3750891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750894">defer</span>&nbsp;<span class="ident" id="3750900">hosts</span><span class="op" id="3750905">.</span><span class="ident" id="3750906">Unlock</span><span class="op" id="3750912">(</span><span class="op" id="3750913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750916">readHosts</span><span class="op" id="3750925">(</span><span class="op" id="3750926">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750929">if</span>&nbsp;<span class="builtinfunc" id="3750932">len</span><span class="op" id="3750935">(</span><span class="ident" id="3750936">hosts</span><span class="op" id="3750941">.</span><span class="ident" id="3750942">byAddr</span><span class="op" id="3750948">)</span>&nbsp;<span class="op" id="3750950">!=</span>&nbsp;<span class="num" id="3750953">0</span>&nbsp;<span class="op" id="3750955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3750959">if</span>&nbsp;<span class="ident" id="3750962">hosts</span><span class="op" id="3750967">,</span>&nbsp;<span class="ident" id="3750969">ok</span>&nbsp;<span class="op" id="3750972">:=</span>&nbsp;<span class="ident" id="3750975">hosts</span><span class="op" id="3750980">.</span><span class="ident" id="3750981">byAddr</span><span class="op" id="3750987">[</span><span class="ident" id="3750988">addr</span><span class="op" id="3750992">]</span><span class="op" id="3750993">;</span>&nbsp;<span class="ident" id="3750995">ok</span>&nbsp;<span class="op" id="3750998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3751003">return</span>&nbsp;<span class="ident" id="3751010">hosts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3751018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3751021">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3751024">return</span>&nbsp;<span class="builtintype" id="3751031">nil</span><br>
<span class="lineno"></span><span class="op" id="3751035">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
