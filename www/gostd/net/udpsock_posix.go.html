<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html" class="current">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4190059">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4190115">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4190169">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4190220">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4190298">package</span>&nbsp;<span class="ident" id="4190306">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4190311">import</span>&nbsp;<span class="op" id="4190318">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4190321">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4190332">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4190339">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4190342">func</span>&nbsp;<span class="ident" id="4190347">sockaddrToUDP</span><span class="op" id="4190360">(</span><span class="ident" id="4190361">sa</span>&nbsp;<span class="ident" id="4190364">syscall</span><span class="op" id="4190371">.</span><span class="ident" id="4190372">Sockaddr</span><span class="op" id="4190380">)</span>&nbsp;<span class="ident" id="4190382">Addr</span>&nbsp;<span class="op" id="4190387">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190390">switch</span>&nbsp;<span class="ident" id="4190397">sa</span>&nbsp;<span class="op" id="4190400">:=</span>&nbsp;<span class="ident" id="4190403">sa</span><span class="op" id="4190405">.</span><span class="op" id="4190406">(</span><span class="keyword" id="4190407">type</span><span class="op" id="4190411">)</span>&nbsp;<span class="op" id="4190413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190416">case</span>&nbsp;<span class="op" id="4190421">*</span><span class="ident" id="4190422">syscall</span><span class="op" id="4190429">.</span><span class="ident" id="4190430">SockaddrInet4</span><span class="op" id="4190443">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190447">return</span>&nbsp;<span class="op" id="4190454">&amp;</span><span class="ident" id="4190455">UDPAddr</span><span class="op" id="4190462">{</span><span class="ident" id="4190463">IP</span><span class="op" id="4190465">:</span>&nbsp;<span class="ident" id="4190467">sa</span><span class="op" id="4190469">.</span><span class="ident" id="4190470">Addr</span><span class="op" id="4190474">[</span><span class="num" id="4190475">0</span><span class="op" id="4190476">:</span><span class="op" id="4190477">]</span><span class="op" id="4190478">,</span>&nbsp;<span class="ident" id="4190480">Port</span><span class="op" id="4190484">:</span>&nbsp;<span class="ident" id="4190486">sa</span><span class="op" id="4190488">.</span><span class="ident" id="4190489">Port</span><span class="op" id="4190493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190496">case</span>&nbsp;<span class="op" id="4190501">*</span><span class="ident" id="4190502">syscall</span><span class="op" id="4190509">.</span><span class="ident" id="4190510">SockaddrInet6</span><span class="op" id="4190523">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190527">return</span>&nbsp;<span class="op" id="4190534">&amp;</span><span class="ident" id="4190535">UDPAddr</span><span class="op" id="4190542">{</span><span class="ident" id="4190543">IP</span><span class="op" id="4190545">:</span>&nbsp;<span class="ident" id="4190547">sa</span><span class="op" id="4190549">.</span><span class="ident" id="4190550">Addr</span><span class="op" id="4190554">[</span><span class="num" id="4190555">0</span><span class="op" id="4190556">:</span><span class="op" id="4190557">]</span><span class="op" id="4190558">,</span>&nbsp;<span class="ident" id="4190560">Port</span><span class="op" id="4190564">:</span>&nbsp;<span class="ident" id="4190566">sa</span><span class="op" id="4190568">.</span><span class="ident" id="4190569">Port</span><span class="op" id="4190573">,</span>&nbsp;<span class="ident" id="4190575">Zone</span><span class="op" id="4190579">:</span>&nbsp;<span class="ident" id="4190581">zoneToString</span><span class="op" id="4190593">(</span><span class="builtintype" id="4190594">int</span><span class="op" id="4190597">(</span><span class="ident" id="4190598">sa</span><span class="op" id="4190600">.</span><span class="ident" id="4190601">ZoneId</span><span class="op" id="4190607">)</span><span class="op" id="4190608">)</span><span class="op" id="4190609">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190615">return</span>&nbsp;<span class="ident" id="4190622">nil</span><br>
<span class="lineno"></span><span class="op" id="4190626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4190629">func</span>&nbsp;<span class="op" id="4190634">(</span><span class="ident" id="4190635">a</span>&nbsp;<span class="op" id="4190637">*</span><span class="ident" id="4190638">UDPAddr</span><span class="op" id="4190645">)</span>&nbsp;<span class="ident" id="4190647">family</span><span class="op" id="4190653">(</span><span class="op" id="4190654">)</span>&nbsp;<span class="builtintype" id="4190656">int</span>&nbsp;<span class="op" id="4190660">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190663">if</span>&nbsp;<span class="ident" id="4190666">a</span>&nbsp;<span class="op" id="4190668">==</span>&nbsp;<span class="ident" id="4190671">nil</span>&nbsp;<span class="op" id="4190675">||</span>&nbsp;<span class="builtinfunc" id="4190678">len</span><span class="op" id="4190681">(</span><span class="ident" id="4190682">a</span><span class="op" id="4190683">.</span><span class="ident" id="4190684">IP</span><span class="op" id="4190686">)</span>&nbsp;<span class="op" id="4190688">&lt;=</span>&nbsp;<span class="ident" id="4190691">IPv4len</span>&nbsp;<span class="op" id="4190699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190703">return</span>&nbsp;<span class="ident" id="4190710">syscall</span><span class="op" id="4190717">.</span><span class="ident" id="4190718">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190730">if</span>&nbsp;<span class="ident" id="4190733">a</span><span class="op" id="4190734">.</span><span class="ident" id="4190735">IP</span><span class="op" id="4190737">.</span><span class="ident" id="4190738">To4</span><span class="op" id="4190741">(</span><span class="op" id="4190742">)</span>&nbsp;<span class="op" id="4190744">!=</span>&nbsp;<span class="ident" id="4190747">nil</span>&nbsp;<span class="op" id="4190751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190755">return</span>&nbsp;<span class="ident" id="4190762">syscall</span><span class="op" id="4190769">.</span><span class="ident" id="4190770">AF_INET</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190782">return</span>&nbsp;<span class="ident" id="4190789">syscall</span><span class="op" id="4190796">.</span><span class="ident" id="4190797">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="4190806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4190809">func</span>&nbsp;<span class="op" id="4190814">(</span><span class="ident" id="4190815">a</span>&nbsp;<span class="op" id="4190817">*</span><span class="ident" id="4190818">UDPAddr</span><span class="op" id="4190825">)</span>&nbsp;<span class="ident" id="4190827">isWildcard</span><span class="op" id="4190837">(</span><span class="op" id="4190838">)</span>&nbsp;<span class="builtintype" id="4190840">bool</span>&nbsp;<span class="op" id="4190845">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190848">if</span>&nbsp;<span class="ident" id="4190851">a</span>&nbsp;<span class="op" id="4190853">==</span>&nbsp;<span class="ident" id="4190856">nil</span>&nbsp;<span class="op" id="4190860">||</span>&nbsp;<span class="ident" id="4190863">a</span><span class="op" id="4190864">.</span><span class="ident" id="4190865">IP</span>&nbsp;<span class="op" id="4190868">==</span>&nbsp;<span class="ident" id="4190871">nil</span>&nbsp;<span class="op" id="4190875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190879">return</span>&nbsp;<span class="builtintype" id="4190886">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190895">return</span>&nbsp;<span class="ident" id="4190902">a</span><span class="op" id="4190903">.</span><span class="ident" id="4190904">IP</span><span class="op" id="4190906">.</span><span class="ident" id="4190907">IsUnspecified</span><span class="op" id="4190920">(</span><span class="op" id="4190921">)</span><br>
<span class="lineno"></span><span class="op" id="4190923">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="4190926">func</span>&nbsp;<span class="op" id="4190931">(</span><span class="ident" id="4190932">a</span>&nbsp;<span class="op" id="4190934">*</span><span class="ident" id="4190935">UDPAddr</span><span class="op" id="4190942">)</span>&nbsp;<span class="ident" id="4190944">sockaddr</span><span class="op" id="4190952">(</span><span class="ident" id="4190953">family</span>&nbsp;<span class="builtintype" id="4190960">int</span><span class="op" id="4190963">)</span>&nbsp;<span class="op" id="4190965">(</span><span class="ident" id="4190966">syscall</span><span class="op" id="4190973">.</span><span class="ident" id="4190974">Sockaddr</span><span class="op" id="4190982">,</span>&nbsp;<span class="builtintype" id="4190984">error</span><span class="op" id="4190989">)</span>&nbsp;<span class="op" id="4190991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190994">if</span>&nbsp;<span class="ident" id="4190997">a</span>&nbsp;<span class="op" id="4190999">==</span>&nbsp;<span class="ident" id="4191002">nil</span>&nbsp;<span class="op" id="4191006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191010">return</span>&nbsp;<span class="ident" id="4191017">nil</span><span class="op" id="4191020">,</span>&nbsp;<span class="ident" id="4191022">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4191027">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191030">return</span>&nbsp;<span class="ident" id="4191037">ipToSockaddr</span><span class="op" id="4191049">(</span><span class="ident" id="4191050">family</span><span class="op" id="4191056">,</span>&nbsp;<span class="ident" id="4191058">a</span><span class="op" id="4191059">.</span><span class="ident" id="4191060">IP</span><span class="op" id="4191062">,</span>&nbsp;<span class="ident" id="4191064">a</span><span class="op" id="4191065">.</span><span class="ident" id="4191066">Port</span><span class="op" id="4191070">,</span>&nbsp;<span class="ident" id="4191072">a</span><span class="op" id="4191073">.</span><span class="ident" id="4191074">Zone</span><span class="op" id="4191078">)</span><br>
<span class="lineno"></span><span class="op" id="4191080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4191083">//&nbsp;UDPConn&nbsp;is&nbsp;the&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;and&nbsp;PacketConn&nbsp;interfaces</span><br>
<span class="lineno"></span><span class="comment" id="4191154">//&nbsp;for&nbsp;UDP&nbsp;network&nbsp;connections.</span><br>
<span class="lineno">50</span><span class="keyword" id="4191186">type</span>&nbsp;<span class="ident" id="4191191">UDPConn</span>&nbsp;<span class="keyword" id="4191199">struct</span>&nbsp;<span class="op" id="4191206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191209">conn</span><br>
<span class="lineno"></span><span class="op" id="4191214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4191217">func</span>&nbsp;<span class="ident" id="4191222">newUDPConn</span><span class="op" id="4191232">(</span><span class="ident" id="4191233">fd</span>&nbsp;<span class="op" id="4191236">*</span><span class="ident" id="4191237">netFD</span><span class="op" id="4191242">)</span>&nbsp;<span class="op" id="4191244">*</span><span class="ident" id="4191245">UDPConn</span>&nbsp;<span class="op" id="4191253">{</span>&nbsp;<span class="keyword" id="4191255">return</span>&nbsp;<span class="op" id="4191262">&amp;</span><span class="ident" id="4191263">UDPConn</span><span class="op" id="4191270">{</span><span class="ident" id="4191271">conn</span><span class="op" id="4191275">{</span><span class="ident" id="4191276">fd</span><span class="op" id="4191278">}</span><span class="op" id="4191279">}</span>&nbsp;<span class="op" id="4191281">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4191284">//&nbsp;ReadFromUDP&nbsp;reads&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="4191354">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;return&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="4191425">//&nbsp;that&nbsp;was&nbsp;on&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="4191452">//</span><br>
<span class="lineno">60</span><span class="comment" id="4191455">//&nbsp;ReadFromUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="4191519">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4191586">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="4191606">func</span>&nbsp;<span class="op" id="4191611">(</span><span class="ident" id="4191612">c</span>&nbsp;<span class="op" id="4191614">*</span><span class="ident" id="4191615">UDPConn</span><span class="op" id="4191622">)</span>&nbsp;<span class="ident" id="4191624">ReadFromUDP</span><span class="op" id="4191635">(</span><span class="ident" id="4191636">b</span>&nbsp;<span class="op" id="4191638">[</span><span class="op" id="4191639">]</span><span class="builtintype" id="4191640">byte</span><span class="op" id="4191644">)</span>&nbsp;<span class="op" id="4191646">(</span><span class="ident" id="4191647">n</span>&nbsp;<span class="builtintype" id="4191649">int</span><span class="op" id="4191652">,</span>&nbsp;<span class="ident" id="4191654">addr</span>&nbsp;<span class="op" id="4191659">*</span><span class="ident" id="4191660">UDPAddr</span><span class="op" id="4191667">,</span>&nbsp;<span class="ident" id="4191669">err</span>&nbsp;<span class="builtintype" id="4191673">error</span><span class="op" id="4191678">)</span>&nbsp;<span class="op" id="4191680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191683">if</span>&nbsp;<span class="op" id="4191686">!</span><span class="ident" id="4191687">c</span><span class="op" id="4191688">.</span><span class="ident" id="4191689">ok</span><span class="op" id="4191691">(</span><span class="op" id="4191692">)</span>&nbsp;<span class="op" id="4191694">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191698">return</span>&nbsp;<span class="num" id="4191705">0</span><span class="op" id="4191706">,</span>&nbsp;<span class="ident" id="4191708">nil</span><span class="op" id="4191711">,</span>&nbsp;<span class="ident" id="4191713">syscall</span><span class="op" id="4191720">.</span><span class="ident" id="4191721">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4191729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191732">n</span><span class="op" id="4191733">,</span>&nbsp;<span class="ident" id="4191735">sa</span><span class="op" id="4191737">,</span>&nbsp;<span class="ident" id="4191739">err</span>&nbsp;<span class="op" id="4191743">:=</span>&nbsp;<span class="ident" id="4191746">c</span><span class="op" id="4191747">.</span><span class="ident" id="4191748">fd</span><span class="op" id="4191750">.</span><span class="ident" id="4191751">readFrom</span><span class="op" id="4191759">(</span><span class="ident" id="4191760">b</span><span class="op" id="4191761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191764">switch</span>&nbsp;<span class="ident" id="4191771">sa</span>&nbsp;<span class="op" id="4191774">:=</span>&nbsp;<span class="ident" id="4191777">sa</span><span class="op" id="4191779">.</span><span class="op" id="4191780">(</span><span class="keyword" id="4191781">type</span><span class="op" id="4191785">)</span>&nbsp;<span class="op" id="4191787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191790">case</span>&nbsp;<span class="op" id="4191795">*</span><span class="ident" id="4191796">syscall</span><span class="op" id="4191803">.</span><span class="ident" id="4191804">SockaddrInet4</span><span class="op" id="4191817">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191821">addr</span>&nbsp;<span class="op" id="4191826">=</span>&nbsp;<span class="op" id="4191828">&amp;</span><span class="ident" id="4191829">UDPAddr</span><span class="op" id="4191836">{</span><span class="ident" id="4191837">IP</span><span class="op" id="4191839">:</span>&nbsp;<span class="ident" id="4191841">sa</span><span class="op" id="4191843">.</span><span class="ident" id="4191844">Addr</span><span class="op" id="4191848">[</span><span class="num" id="4191849">0</span><span class="op" id="4191850">:</span><span class="op" id="4191851">]</span><span class="op" id="4191852">,</span>&nbsp;<span class="ident" id="4191854">Port</span><span class="op" id="4191858">:</span>&nbsp;<span class="ident" id="4191860">sa</span><span class="op" id="4191862">.</span><span class="ident" id="4191863">Port</span><span class="op" id="4191867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191870">case</span>&nbsp;<span class="op" id="4191875">*</span><span class="ident" id="4191876">syscall</span><span class="op" id="4191883">.</span><span class="ident" id="4191884">SockaddrInet6</span><span class="op" id="4191897">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191901">addr</span>&nbsp;<span class="op" id="4191906">=</span>&nbsp;<span class="op" id="4191908">&amp;</span><span class="ident" id="4191909">UDPAddr</span><span class="op" id="4191916">{</span><span class="ident" id="4191917">IP</span><span class="op" id="4191919">:</span>&nbsp;<span class="ident" id="4191921">sa</span><span class="op" id="4191923">.</span><span class="ident" id="4191924">Addr</span><span class="op" id="4191928">[</span><span class="num" id="4191929">0</span><span class="op" id="4191930">:</span><span class="op" id="4191931">]</span><span class="op" id="4191932">,</span>&nbsp;<span class="ident" id="4191934">Port</span><span class="op" id="4191938">:</span>&nbsp;<span class="ident" id="4191940">sa</span><span class="op" id="4191942">.</span><span class="ident" id="4191943">Port</span><span class="op" id="4191947">,</span>&nbsp;<span class="ident" id="4191949">Zone</span><span class="op" id="4191953">:</span>&nbsp;<span class="ident" id="4191955">zoneToString</span><span class="op" id="4191967">(</span><span class="builtintype" id="4191968">int</span><span class="op" id="4191971">(</span><span class="ident" id="4191972">sa</span><span class="op" id="4191974">.</span><span class="ident" id="4191975">ZoneId</span><span class="op" id="4191981">)</span><span class="op" id="4191982">)</span><span class="op" id="4191983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4191986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191989">return</span><br>
<span class="lineno">75</span><span class="op" id="4191996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4191999">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="4192054">func</span>&nbsp;<span class="op" id="4192059">(</span><span class="ident" id="4192060">c</span>&nbsp;<span class="op" id="4192062">*</span><span class="ident" id="4192063">UDPConn</span><span class="op" id="4192070">)</span>&nbsp;<span class="ident" id="4192072">ReadFrom</span><span class="op" id="4192080">(</span><span class="ident" id="4192081">b</span>&nbsp;<span class="op" id="4192083">[</span><span class="op" id="4192084">]</span><span class="builtintype" id="4192085">byte</span><span class="op" id="4192089">)</span>&nbsp;<span class="op" id="4192091">(</span><span class="builtintype" id="4192092">int</span><span class="op" id="4192095">,</span>&nbsp;<span class="ident" id="4192097">Addr</span><span class="op" id="4192101">,</span>&nbsp;<span class="builtintype" id="4192103">error</span><span class="op" id="4192108">)</span>&nbsp;<span class="op" id="4192110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192113">if</span>&nbsp;<span class="op" id="4192116">!</span><span class="ident" id="4192117">c</span><span class="op" id="4192118">.</span><span class="ident" id="4192119">ok</span><span class="op" id="4192121">(</span><span class="op" id="4192122">)</span>&nbsp;<span class="op" id="4192124">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192128">return</span>&nbsp;<span class="num" id="4192135">0</span><span class="op" id="4192136">,</span>&nbsp;<span class="ident" id="4192138">nil</span><span class="op" id="4192141">,</span>&nbsp;<span class="ident" id="4192143">syscall</span><span class="op" id="4192150">.</span><span class="ident" id="4192151">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192162">n</span><span class="op" id="4192163">,</span>&nbsp;<span class="ident" id="4192165">addr</span><span class="op" id="4192169">,</span>&nbsp;<span class="ident" id="4192171">err</span>&nbsp;<span class="op" id="4192175">:=</span>&nbsp;<span class="ident" id="4192178">c</span><span class="op" id="4192179">.</span><span class="ident" id="4192180">ReadFromUDP</span><span class="op" id="4192191">(</span><span class="ident" id="4192192">b</span><span class="op" id="4192193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192196">return</span>&nbsp;<span class="ident" id="4192203">n</span><span class="op" id="4192204">,</span>&nbsp;<span class="ident" id="4192206">addr</span><span class="op" id="4192210">.</span><span class="ident" id="4192211">toAddr</span><span class="op" id="4192217">(</span><span class="op" id="4192218">)</span><span class="op" id="4192219">,</span>&nbsp;<span class="ident" id="4192221">err</span><br>
<span class="lineno"></span><span class="op" id="4192225">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4192228">//&nbsp;ReadMsgUDP&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4192296">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="4192364">//&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4192432">//&nbsp;flags&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno">90</span><span class="comment" id="4192499">//&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="4192510">func</span>&nbsp;<span class="op" id="4192515">(</span><span class="ident" id="4192516">c</span>&nbsp;<span class="op" id="4192518">*</span><span class="ident" id="4192519">UDPConn</span><span class="op" id="4192526">)</span>&nbsp;<span class="ident" id="4192528">ReadMsgUDP</span><span class="op" id="4192538">(</span><span class="ident" id="4192539">b</span><span class="op" id="4192540">,</span>&nbsp;<span class="ident" id="4192542">oob</span>&nbsp;<span class="op" id="4192546">[</span><span class="op" id="4192547">]</span><span class="builtintype" id="4192548">byte</span><span class="op" id="4192552">)</span>&nbsp;<span class="op" id="4192554">(</span><span class="ident" id="4192555">n</span><span class="op" id="4192556">,</span>&nbsp;<span class="ident" id="4192558">oobn</span><span class="op" id="4192562">,</span>&nbsp;<span class="ident" id="4192564">flags</span>&nbsp;<span class="builtintype" id="4192570">int</span><span class="op" id="4192573">,</span>&nbsp;<span class="ident" id="4192575">addr</span>&nbsp;<span class="op" id="4192580">*</span><span class="ident" id="4192581">UDPAddr</span><span class="op" id="4192588">,</span>&nbsp;<span class="ident" id="4192590">err</span>&nbsp;<span class="builtintype" id="4192594">error</span><span class="op" id="4192599">)</span>&nbsp;<span class="op" id="4192601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192604">if</span>&nbsp;<span class="op" id="4192607">!</span><span class="ident" id="4192608">c</span><span class="op" id="4192609">.</span><span class="ident" id="4192610">ok</span><span class="op" id="4192612">(</span><span class="op" id="4192613">)</span>&nbsp;<span class="op" id="4192615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192619">return</span>&nbsp;<span class="num" id="4192626">0</span><span class="op" id="4192627">,</span>&nbsp;<span class="num" id="4192629">0</span><span class="op" id="4192630">,</span>&nbsp;<span class="num" id="4192632">0</span><span class="op" id="4192633">,</span>&nbsp;<span class="ident" id="4192635">nil</span><span class="op" id="4192638">,</span>&nbsp;<span class="ident" id="4192640">syscall</span><span class="op" id="4192647">.</span><span class="ident" id="4192648">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192656">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192659">var</span>&nbsp;<span class="ident" id="4192663">sa</span>&nbsp;<span class="ident" id="4192666">syscall</span><span class="op" id="4192673">.</span><span class="ident" id="4192674">Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192684">n</span><span class="op" id="4192685">,</span>&nbsp;<span class="ident" id="4192687">oobn</span><span class="op" id="4192691">,</span>&nbsp;<span class="ident" id="4192693">flags</span><span class="op" id="4192698">,</span>&nbsp;<span class="ident" id="4192700">sa</span><span class="op" id="4192702">,</span>&nbsp;<span class="ident" id="4192704">err</span>&nbsp;<span class="op" id="4192708">=</span>&nbsp;<span class="ident" id="4192710">c</span><span class="op" id="4192711">.</span><span class="ident" id="4192712">fd</span><span class="op" id="4192714">.</span><span class="ident" id="4192715">readMsg</span><span class="op" id="4192722">(</span><span class="ident" id="4192723">b</span><span class="op" id="4192724">,</span>&nbsp;<span class="ident" id="4192726">oob</span><span class="op" id="4192729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192732">switch</span>&nbsp;<span class="ident" id="4192739">sa</span>&nbsp;<span class="op" id="4192742">:=</span>&nbsp;<span class="ident" id="4192745">sa</span><span class="op" id="4192747">.</span><span class="op" id="4192748">(</span><span class="keyword" id="4192749">type</span><span class="op" id="4192753">)</span>&nbsp;<span class="op" id="4192755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192758">case</span>&nbsp;<span class="op" id="4192763">*</span><span class="ident" id="4192764">syscall</span><span class="op" id="4192771">.</span><span class="ident" id="4192772">SockaddrInet4</span><span class="op" id="4192785">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192789">addr</span>&nbsp;<span class="op" id="4192794">=</span>&nbsp;<span class="op" id="4192796">&amp;</span><span class="ident" id="4192797">UDPAddr</span><span class="op" id="4192804">{</span><span class="ident" id="4192805">IP</span><span class="op" id="4192807">:</span>&nbsp;<span class="ident" id="4192809">sa</span><span class="op" id="4192811">.</span><span class="ident" id="4192812">Addr</span><span class="op" id="4192816">[</span><span class="num" id="4192817">0</span><span class="op" id="4192818">:</span><span class="op" id="4192819">]</span><span class="op" id="4192820">,</span>&nbsp;<span class="ident" id="4192822">Port</span><span class="op" id="4192826">:</span>&nbsp;<span class="ident" id="4192828">sa</span><span class="op" id="4192830">.</span><span class="ident" id="4192831">Port</span><span class="op" id="4192835">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192838">case</span>&nbsp;<span class="op" id="4192843">*</span><span class="ident" id="4192844">syscall</span><span class="op" id="4192851">.</span><span class="ident" id="4192852">SockaddrInet6</span><span class="op" id="4192865">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192869">addr</span>&nbsp;<span class="op" id="4192874">=</span>&nbsp;<span class="op" id="4192876">&amp;</span><span class="ident" id="4192877">UDPAddr</span><span class="op" id="4192884">{</span><span class="ident" id="4192885">IP</span><span class="op" id="4192887">:</span>&nbsp;<span class="ident" id="4192889">sa</span><span class="op" id="4192891">.</span><span class="ident" id="4192892">Addr</span><span class="op" id="4192896">[</span><span class="num" id="4192897">0</span><span class="op" id="4192898">:</span><span class="op" id="4192899">]</span><span class="op" id="4192900">,</span>&nbsp;<span class="ident" id="4192902">Port</span><span class="op" id="4192906">:</span>&nbsp;<span class="ident" id="4192908">sa</span><span class="op" id="4192910">.</span><span class="ident" id="4192911">Port</span><span class="op" id="4192915">,</span>&nbsp;<span class="ident" id="4192917">Zone</span><span class="op" id="4192921">:</span>&nbsp;<span class="ident" id="4192923">zoneToString</span><span class="op" id="4192935">(</span><span class="builtintype" id="4192936">int</span><span class="op" id="4192939">(</span><span class="ident" id="4192940">sa</span><span class="op" id="4192942">.</span><span class="ident" id="4192943">ZoneId</span><span class="op" id="4192949">)</span><span class="op" id="4192950">)</span><span class="op" id="4192951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192957">return</span><br>
<span class="lineno"></span><span class="op" id="4192964">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="4192967">//&nbsp;WriteToUDP&nbsp;writes&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="4193036">//&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="4193047">//</span><br>
<span class="lineno"></span><span class="comment" id="4193050">//&nbsp;WriteToUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">110</span><span class="comment" id="4193113">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4193180">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="4193249">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="4193262">func</span>&nbsp;<span class="op" id="4193267">(</span><span class="ident" id="4193268">c</span>&nbsp;<span class="op" id="4193270">*</span><span class="ident" id="4193271">UDPConn</span><span class="op" id="4193278">)</span>&nbsp;<span class="ident" id="4193280">WriteToUDP</span><span class="op" id="4193290">(</span><span class="ident" id="4193291">b</span>&nbsp;<span class="op" id="4193293">[</span><span class="op" id="4193294">]</span><span class="builtintype" id="4193295">byte</span><span class="op" id="4193299">,</span>&nbsp;<span class="ident" id="4193301">addr</span>&nbsp;<span class="op" id="4193306">*</span><span class="ident" id="4193307">UDPAddr</span><span class="op" id="4193314">)</span>&nbsp;<span class="op" id="4193316">(</span><span class="builtintype" id="4193317">int</span><span class="op" id="4193320">,</span>&nbsp;<span class="builtintype" id="4193322">error</span><span class="op" id="4193327">)</span>&nbsp;<span class="op" id="4193329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193332">if</span>&nbsp;<span class="op" id="4193335">!</span><span class="ident" id="4193336">c</span><span class="op" id="4193337">.</span><span class="ident" id="4193338">ok</span><span class="op" id="4193340">(</span><span class="op" id="4193341">)</span>&nbsp;<span class="op" id="4193343">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193347">return</span>&nbsp;<span class="num" id="4193354">0</span><span class="op" id="4193355">,</span>&nbsp;<span class="ident" id="4193357">syscall</span><span class="op" id="4193364">.</span><span class="ident" id="4193365">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193376">if</span>&nbsp;<span class="ident" id="4193379">c</span><span class="op" id="4193380">.</span><span class="ident" id="4193381">fd</span><span class="op" id="4193383">.</span><span class="ident" id="4193384">isConnected</span>&nbsp;<span class="op" id="4193396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193400">return</span>&nbsp;<span class="num" id="4193407">0</span><span class="op" id="4193408">,</span>&nbsp;<span class="op" id="4193410">&amp;</span><span class="ident" id="4193411">OpError</span><span class="op" id="4193418">{</span><span class="string" id="4193419">&#34;write&#34;</span><span class="op" id="4193426">,</span>&nbsp;<span class="ident" id="4193428">c</span><span class="op" id="4193429">.</span><span class="ident" id="4193430">fd</span><span class="op" id="4193432">.</span><span class="ident" id="4193433">net</span><span class="op" id="4193436">,</span>&nbsp;<span class="ident" id="4193438">addr</span><span class="op" id="4193442">,</span>&nbsp;<span class="ident" id="4193444">ErrWriteToConnected</span><span class="op" id="4193463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193466">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193469">if</span>&nbsp;<span class="ident" id="4193472">addr</span>&nbsp;<span class="op" id="4193477">==</span>&nbsp;<span class="ident" id="4193480">nil</span>&nbsp;<span class="op" id="4193484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193488">return</span>&nbsp;<span class="num" id="4193495">0</span><span class="op" id="4193496">,</span>&nbsp;<span class="op" id="4193498">&amp;</span><span class="ident" id="4193499">OpError</span><span class="op" id="4193506">{</span><span class="ident" id="4193507">Op</span><span class="op" id="4193509">:</span>&nbsp;<span class="string" id="4193511">&#34;write&#34;</span><span class="op" id="4193518">,</span>&nbsp;<span class="ident" id="4193520">Net</span><span class="op" id="4193523">:</span>&nbsp;<span class="ident" id="4193525">c</span><span class="op" id="4193526">.</span><span class="ident" id="4193527">fd</span><span class="op" id="4193529">.</span><span class="ident" id="4193530">net</span><span class="op" id="4193533">,</span>&nbsp;<span class="ident" id="4193535">Addr</span><span class="op" id="4193539">:</span>&nbsp;<span class="ident" id="4193541">nil</span><span class="op" id="4193544">,</span>&nbsp;<span class="ident" id="4193546">Err</span><span class="op" id="4193549">:</span>&nbsp;<span class="ident" id="4193551">errMissingAddress</span><span class="op" id="4193568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193574">sa</span><span class="op" id="4193576">,</span>&nbsp;<span class="ident" id="4193578">err</span>&nbsp;<span class="op" id="4193582">:=</span>&nbsp;<span class="ident" id="4193585">addr</span><span class="op" id="4193589">.</span><span class="ident" id="4193590">sockaddr</span><span class="op" id="4193598">(</span><span class="ident" id="4193599">c</span><span class="op" id="4193600">.</span><span class="ident" id="4193601">fd</span><span class="op" id="4193603">.</span><span class="ident" id="4193604">family</span><span class="op" id="4193610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193613">if</span>&nbsp;<span class="ident" id="4193616">err</span>&nbsp;<span class="op" id="4193620">!=</span>&nbsp;<span class="ident" id="4193623">nil</span>&nbsp;<span class="op" id="4193627">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193631">return</span>&nbsp;<span class="num" id="4193638">0</span><span class="op" id="4193639">,</span>&nbsp;<span class="op" id="4193641">&amp;</span><span class="ident" id="4193642">OpError</span><span class="op" id="4193649">{</span><span class="string" id="4193650">&#34;write&#34;</span><span class="op" id="4193657">,</span>&nbsp;<span class="ident" id="4193659">c</span><span class="op" id="4193660">.</span><span class="ident" id="4193661">fd</span><span class="op" id="4193663">.</span><span class="ident" id="4193664">net</span><span class="op" id="4193667">,</span>&nbsp;<span class="ident" id="4193669">addr</span><span class="op" id="4193673">,</span>&nbsp;<span class="ident" id="4193675">err</span><span class="op" id="4193678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193684">return</span>&nbsp;<span class="ident" id="4193691">c</span><span class="op" id="4193692">.</span><span class="ident" id="4193693">fd</span><span class="op" id="4193695">.</span><span class="ident" id="4193696">writeTo</span><span class="op" id="4193703">(</span><span class="ident" id="4193704">b</span><span class="op" id="4193705">,</span>&nbsp;<span class="ident" id="4193707">sa</span><span class="op" id="4193709">)</span><br>
<span class="lineno"></span><span class="op" id="4193711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="4193714">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="4193767">func</span>&nbsp;<span class="op" id="4193772">(</span><span class="ident" id="4193773">c</span>&nbsp;<span class="op" id="4193775">*</span><span class="ident" id="4193776">UDPConn</span><span class="op" id="4193783">)</span>&nbsp;<span class="ident" id="4193785">WriteTo</span><span class="op" id="4193792">(</span><span class="ident" id="4193793">b</span>&nbsp;<span class="op" id="4193795">[</span><span class="op" id="4193796">]</span><span class="builtintype" id="4193797">byte</span><span class="op" id="4193801">,</span>&nbsp;<span class="ident" id="4193803">addr</span>&nbsp;<span class="ident" id="4193808">Addr</span><span class="op" id="4193812">)</span>&nbsp;<span class="op" id="4193814">(</span><span class="builtintype" id="4193815">int</span><span class="op" id="4193818">,</span>&nbsp;<span class="builtintype" id="4193820">error</span><span class="op" id="4193825">)</span>&nbsp;<span class="op" id="4193827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193830">if</span>&nbsp;<span class="op" id="4193833">!</span><span class="ident" id="4193834">c</span><span class="op" id="4193835">.</span><span class="ident" id="4193836">ok</span><span class="op" id="4193838">(</span><span class="op" id="4193839">)</span>&nbsp;<span class="op" id="4193841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193845">return</span>&nbsp;<span class="num" id="4193852">0</span><span class="op" id="4193853">,</span>&nbsp;<span class="ident" id="4193855">syscall</span><span class="op" id="4193862">.</span><span class="ident" id="4193863">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193871">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193874">a</span><span class="op" id="4193875">,</span>&nbsp;<span class="ident" id="4193877">ok</span>&nbsp;<span class="op" id="4193880">:=</span>&nbsp;<span class="ident" id="4193883">addr</span><span class="op" id="4193887">.</span><span class="op" id="4193888">(</span><span class="op" id="4193889">*</span><span class="ident" id="4193890">UDPAddr</span><span class="op" id="4193897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193900">if</span>&nbsp;<span class="op" id="4193903">!</span><span class="ident" id="4193904">ok</span>&nbsp;<span class="op" id="4193907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193911">return</span>&nbsp;<span class="num" id="4193918">0</span><span class="op" id="4193919">,</span>&nbsp;<span class="op" id="4193921">&amp;</span><span class="ident" id="4193922">OpError</span><span class="op" id="4193929">{</span><span class="string" id="4193930">&#34;write&#34;</span><span class="op" id="4193937">,</span>&nbsp;<span class="ident" id="4193939">c</span><span class="op" id="4193940">.</span><span class="ident" id="4193941">fd</span><span class="op" id="4193943">.</span><span class="ident" id="4193944">net</span><span class="op" id="4193947">,</span>&nbsp;<span class="ident" id="4193949">addr</span><span class="op" id="4193953">,</span>&nbsp;<span class="ident" id="4193955">syscall</span><span class="op" id="4193962">.</span><span class="ident" id="4193963">EINVAL</span><span class="op" id="4193969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193975">return</span>&nbsp;<span class="ident" id="4193982">c</span><span class="op" id="4193983">.</span><span class="ident" id="4193984">WriteToUDP</span><span class="op" id="4193994">(</span><span class="ident" id="4193995">b</span><span class="op" id="4193996">,</span>&nbsp;<span class="ident" id="4193998">a</span><span class="op" id="4193999">)</span><br>
<span class="lineno">140</span><span class="op" id="4194001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4194004">//&nbsp;WriteMsgUDP&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4194075">//&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4194142">//&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">145</span><span class="keyword" id="4194194">func</span>&nbsp;<span class="op" id="4194199">(</span><span class="ident" id="4194200">c</span>&nbsp;<span class="op" id="4194202">*</span><span class="ident" id="4194203">UDPConn</span><span class="op" id="4194210">)</span>&nbsp;<span class="ident" id="4194212">WriteMsgUDP</span><span class="op" id="4194223">(</span><span class="ident" id="4194224">b</span><span class="op" id="4194225">,</span>&nbsp;<span class="ident" id="4194227">oob</span>&nbsp;<span class="op" id="4194231">[</span><span class="op" id="4194232">]</span><span class="builtintype" id="4194233">byte</span><span class="op" id="4194237">,</span>&nbsp;<span class="ident" id="4194239">addr</span>&nbsp;<span class="op" id="4194244">*</span><span class="ident" id="4194245">UDPAddr</span><span class="op" id="4194252">)</span>&nbsp;<span class="op" id="4194254">(</span><span class="ident" id="4194255">n</span><span class="op" id="4194256">,</span>&nbsp;<span class="ident" id="4194258">oobn</span>&nbsp;<span class="builtintype" id="4194263">int</span><span class="op" id="4194266">,</span>&nbsp;<span class="ident" id="4194268">err</span>&nbsp;<span class="builtintype" id="4194272">error</span><span class="op" id="4194277">)</span>&nbsp;<span class="op" id="4194279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194282">if</span>&nbsp;<span class="op" id="4194285">!</span><span class="ident" id="4194286">c</span><span class="op" id="4194287">.</span><span class="ident" id="4194288">ok</span><span class="op" id="4194290">(</span><span class="op" id="4194291">)</span>&nbsp;<span class="op" id="4194293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194297">return</span>&nbsp;<span class="num" id="4194304">0</span><span class="op" id="4194305">,</span>&nbsp;<span class="num" id="4194307">0</span><span class="op" id="4194308">,</span>&nbsp;<span class="ident" id="4194310">syscall</span><span class="op" id="4194317">.</span><span class="ident" id="4194318">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4194326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194329">if</span>&nbsp;<span class="ident" id="4194332">c</span><span class="op" id="4194333">.</span><span class="ident" id="4194334">fd</span><span class="op" id="4194336">.</span><span class="ident" id="4194337">isConnected</span>&nbsp;<span class="op" id="4194349">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194353">return</span>&nbsp;<span class="num" id="4194360">0</span><span class="op" id="4194361">,</span>&nbsp;<span class="num" id="4194363">0</span><span class="op" id="4194364">,</span>&nbsp;<span class="op" id="4194366">&amp;</span><span class="ident" id="4194367">OpError</span><span class="op" id="4194374">{</span><span class="string" id="4194375">&#34;write&#34;</span><span class="op" id="4194382">,</span>&nbsp;<span class="ident" id="4194384">c</span><span class="op" id="4194385">.</span><span class="ident" id="4194386">fd</span><span class="op" id="4194388">.</span><span class="ident" id="4194389">net</span><span class="op" id="4194392">,</span>&nbsp;<span class="ident" id="4194394">addr</span><span class="op" id="4194398">,</span>&nbsp;<span class="ident" id="4194400">ErrWriteToConnected</span><span class="op" id="4194419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4194422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194425">if</span>&nbsp;<span class="ident" id="4194428">addr</span>&nbsp;<span class="op" id="4194433">==</span>&nbsp;<span class="ident" id="4194436">nil</span>&nbsp;<span class="op" id="4194440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194444">return</span>&nbsp;<span class="num" id="4194451">0</span><span class="op" id="4194452">,</span>&nbsp;<span class="num" id="4194454">0</span><span class="op" id="4194455">,</span>&nbsp;<span class="op" id="4194457">&amp;</span><span class="ident" id="4194458">OpError</span><span class="op" id="4194465">{</span><span class="ident" id="4194466">Op</span><span class="op" id="4194468">:</span>&nbsp;<span class="string" id="4194470">&#34;write&#34;</span><span class="op" id="4194477">,</span>&nbsp;<span class="ident" id="4194479">Net</span><span class="op" id="4194482">:</span>&nbsp;<span class="ident" id="4194484">c</span><span class="op" id="4194485">.</span><span class="ident" id="4194486">fd</span><span class="op" id="4194488">.</span><span class="ident" id="4194489">net</span><span class="op" id="4194492">,</span>&nbsp;<span class="ident" id="4194494">Addr</span><span class="op" id="4194498">:</span>&nbsp;<span class="ident" id="4194500">nil</span><span class="op" id="4194503">,</span>&nbsp;<span class="ident" id="4194505">Err</span><span class="op" id="4194508">:</span>&nbsp;<span class="ident" id="4194510">errMissingAddress</span><span class="op" id="4194527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4194530">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4194533">sa</span><span class="op" id="4194535">,</span>&nbsp;<span class="ident" id="4194537">err</span>&nbsp;<span class="op" id="4194541">:=</span>&nbsp;<span class="ident" id="4194544">addr</span><span class="op" id="4194548">.</span><span class="ident" id="4194549">sockaddr</span><span class="op" id="4194557">(</span><span class="ident" id="4194558">c</span><span class="op" id="4194559">.</span><span class="ident" id="4194560">fd</span><span class="op" id="4194562">.</span><span class="ident" id="4194563">family</span><span class="op" id="4194569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194572">if</span>&nbsp;<span class="ident" id="4194575">err</span>&nbsp;<span class="op" id="4194579">!=</span>&nbsp;<span class="ident" id="4194582">nil</span>&nbsp;<span class="op" id="4194586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194590">return</span>&nbsp;<span class="num" id="4194597">0</span><span class="op" id="4194598">,</span>&nbsp;<span class="num" id="4194600">0</span><span class="op" id="4194601">,</span>&nbsp;<span class="op" id="4194603">&amp;</span><span class="ident" id="4194604">OpError</span><span class="op" id="4194611">{</span><span class="string" id="4194612">&#34;write&#34;</span><span class="op" id="4194619">,</span>&nbsp;<span class="ident" id="4194621">c</span><span class="op" id="4194622">.</span><span class="ident" id="4194623">fd</span><span class="op" id="4194625">.</span><span class="ident" id="4194626">net</span><span class="op" id="4194629">,</span>&nbsp;<span class="ident" id="4194631">addr</span><span class="op" id="4194635">,</span>&nbsp;<span class="ident" id="4194637">err</span><span class="op" id="4194640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4194643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194646">return</span>&nbsp;<span class="ident" id="4194653">c</span><span class="op" id="4194654">.</span><span class="ident" id="4194655">fd</span><span class="op" id="4194657">.</span><span class="ident" id="4194658">writeMsg</span><span class="op" id="4194666">(</span><span class="ident" id="4194667">b</span><span class="op" id="4194668">,</span>&nbsp;<span class="ident" id="4194670">oob</span><span class="op" id="4194673">,</span>&nbsp;<span class="ident" id="4194675">sa</span><span class="op" id="4194677">)</span><br>
<span class="lineno">160</span><span class="op" id="4194679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4194682">//&nbsp;DialUDP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="4194750">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil,&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4194821">//&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno">165</span><span class="keyword" id="4194870">func</span>&nbsp;<span class="ident" id="4194875">DialUDP</span><span class="op" id="4194882">(</span><span class="ident" id="4194883">net</span>&nbsp;<span class="builtintype" id="4194887">string</span><span class="op" id="4194893">,</span>&nbsp;<span class="ident" id="4194895">laddr</span><span class="op" id="4194900">,</span>&nbsp;<span class="ident" id="4194902">raddr</span>&nbsp;<span class="op" id="4194908">*</span><span class="ident" id="4194909">UDPAddr</span><span class="op" id="4194916">)</span>&nbsp;<span class="op" id="4194918">(</span><span class="op" id="4194919">*</span><span class="ident" id="4194920">UDPConn</span><span class="op" id="4194927">,</span>&nbsp;<span class="builtintype" id="4194929">error</span><span class="op" id="4194934">)</span>&nbsp;<span class="op" id="4194936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194939">switch</span>&nbsp;<span class="ident" id="4194946">net</span>&nbsp;<span class="op" id="4194950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194953">case</span>&nbsp;<span class="string" id="4194958">&#34;udp&#34;</span><span class="op" id="4194963">,</span>&nbsp;<span class="string" id="4194965">&#34;udp4&#34;</span><span class="op" id="4194971">,</span>&nbsp;<span class="string" id="4194973">&#34;udp6&#34;</span><span class="op" id="4194979">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194982">default</span><span class="op" id="4194989">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194993">return</span>&nbsp;<span class="ident" id="4195000">nil</span><span class="op" id="4195003">,</span>&nbsp;<span class="op" id="4195005">&amp;</span><span class="ident" id="4195006">OpError</span><span class="op" id="4195013">{</span><span class="ident" id="4195014">Op</span><span class="op" id="4195016">:</span>&nbsp;<span class="string" id="4195018">&#34;dial&#34;</span><span class="op" id="4195024">,</span>&nbsp;<span class="ident" id="4195026">Net</span><span class="op" id="4195029">:</span>&nbsp;<span class="ident" id="4195031">net</span><span class="op" id="4195034">,</span>&nbsp;<span class="ident" id="4195036">Addr</span><span class="op" id="4195040">:</span>&nbsp;<span class="ident" id="4195042">raddr</span><span class="op" id="4195047">,</span>&nbsp;<span class="ident" id="4195049">Err</span><span class="op" id="4195052">:</span>&nbsp;<span class="ident" id="4195054">UnknownNetworkError</span><span class="op" id="4195073">(</span><span class="ident" id="4195074">net</span><span class="op" id="4195077">)</span><span class="op" id="4195078">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195084">if</span>&nbsp;<span class="ident" id="4195087">raddr</span>&nbsp;<span class="op" id="4195093">==</span>&nbsp;<span class="ident" id="4195096">nil</span>&nbsp;<span class="op" id="4195100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195104">return</span>&nbsp;<span class="ident" id="4195111">nil</span><span class="op" id="4195114">,</span>&nbsp;<span class="op" id="4195116">&amp;</span><span class="ident" id="4195117">OpError</span><span class="op" id="4195124">{</span><span class="ident" id="4195125">Op</span><span class="op" id="4195127">:</span>&nbsp;<span class="string" id="4195129">&#34;dial&#34;</span><span class="op" id="4195135">,</span>&nbsp;<span class="ident" id="4195137">Net</span><span class="op" id="4195140">:</span>&nbsp;<span class="ident" id="4195142">net</span><span class="op" id="4195145">,</span>&nbsp;<span class="ident" id="4195147">Addr</span><span class="op" id="4195151">:</span>&nbsp;<span class="ident" id="4195153">nil</span><span class="op" id="4195156">,</span>&nbsp;<span class="ident" id="4195158">Err</span><span class="op" id="4195161">:</span>&nbsp;<span class="ident" id="4195163">errMissingAddress</span><span class="op" id="4195180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195186">return</span>&nbsp;<span class="ident" id="4195193">dialUDP</span><span class="op" id="4195200">(</span><span class="ident" id="4195201">net</span><span class="op" id="4195204">,</span>&nbsp;<span class="ident" id="4195206">laddr</span><span class="op" id="4195211">,</span>&nbsp;<span class="ident" id="4195213">raddr</span><span class="op" id="4195218">,</span>&nbsp;<span class="ident" id="4195220">noDeadline</span><span class="op" id="4195230">)</span><br>
<span class="lineno">175</span><span class="op" id="4195232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4195235">func</span>&nbsp;<span class="ident" id="4195240">dialUDP</span><span class="op" id="4195247">(</span><span class="ident" id="4195248">net</span>&nbsp;<span class="builtintype" id="4195252">string</span><span class="op" id="4195258">,</span>&nbsp;<span class="ident" id="4195260">laddr</span><span class="op" id="4195265">,</span>&nbsp;<span class="ident" id="4195267">raddr</span>&nbsp;<span class="op" id="4195273">*</span><span class="ident" id="4195274">UDPAddr</span><span class="op" id="4195281">,</span>&nbsp;<span class="ident" id="4195283">deadline</span>&nbsp;<span class="ident" id="4195292">time</span><span class="op" id="4195296">.</span><span class="ident" id="4195297">Time</span><span class="op" id="4195301">)</span>&nbsp;<span class="op" id="4195303">(</span><span class="op" id="4195304">*</span><span class="ident" id="4195305">UDPConn</span><span class="op" id="4195312">,</span>&nbsp;<span class="builtintype" id="4195314">error</span><span class="op" id="4195319">)</span>&nbsp;<span class="op" id="4195321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195324">fd</span><span class="op" id="4195326">,</span>&nbsp;<span class="ident" id="4195328">err</span>&nbsp;<span class="op" id="4195332">:=</span>&nbsp;<span class="ident" id="4195335">internetSocket</span><span class="op" id="4195349">(</span><span class="ident" id="4195350">net</span><span class="op" id="4195353">,</span>&nbsp;<span class="ident" id="4195355">laddr</span><span class="op" id="4195360">,</span>&nbsp;<span class="ident" id="4195362">raddr</span><span class="op" id="4195367">,</span>&nbsp;<span class="ident" id="4195369">deadline</span><span class="op" id="4195377">,</span>&nbsp;<span class="ident" id="4195379">syscall</span><span class="op" id="4195386">.</span><span class="ident" id="4195387">SOCK_DGRAM</span><span class="op" id="4195397">,</span>&nbsp;<span class="num" id="4195399">0</span><span class="op" id="4195400">,</span>&nbsp;<span class="string" id="4195402">&#34;dial&#34;</span><span class="op" id="4195408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195411">if</span>&nbsp;<span class="ident" id="4195414">err</span>&nbsp;<span class="op" id="4195418">!=</span>&nbsp;<span class="ident" id="4195421">nil</span>&nbsp;<span class="op" id="4195425">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195429">return</span>&nbsp;<span class="ident" id="4195436">nil</span><span class="op" id="4195439">,</span>&nbsp;<span class="op" id="4195441">&amp;</span><span class="ident" id="4195442">OpError</span><span class="op" id="4195449">{</span><span class="ident" id="4195450">Op</span><span class="op" id="4195452">:</span>&nbsp;<span class="string" id="4195454">&#34;dial&#34;</span><span class="op" id="4195460">,</span>&nbsp;<span class="ident" id="4195462">Net</span><span class="op" id="4195465">:</span>&nbsp;<span class="ident" id="4195467">net</span><span class="op" id="4195470">,</span>&nbsp;<span class="ident" id="4195472">Addr</span><span class="op" id="4195476">:</span>&nbsp;<span class="ident" id="4195478">raddr</span><span class="op" id="4195483">,</span>&nbsp;<span class="ident" id="4195485">Err</span><span class="op" id="4195488">:</span>&nbsp;<span class="ident" id="4195490">err</span><span class="op" id="4195493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195499">return</span>&nbsp;<span class="ident" id="4195506">newUDPConn</span><span class="op" id="4195516">(</span><span class="ident" id="4195517">fd</span><span class="op" id="4195519">)</span><span class="op" id="4195520">,</span>&nbsp;<span class="ident" id="4195522">nil</span><br>
<span class="lineno"></span><span class="op" id="4195526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="4195529">//&nbsp;ListenUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;UDP&nbsp;packets&nbsp;addressed&nbsp;to&nbsp;the&nbsp;local</span><br>
<span class="lineno"></span><span class="comment" id="4195598">//&nbsp;address&nbsp;laddr.&nbsp;&nbsp;Net&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="4195669">//&nbsp;a&nbsp;port&nbsp;of&nbsp;0,&nbsp;ListenUDP&nbsp;will&nbsp;choose&nbsp;an&nbsp;available&nbsp;port.</span><br>
<span class="lineno"></span><span class="comment" id="4195726">//&nbsp;The&nbsp;LocalAddr&nbsp;method&nbsp;of&nbsp;the&nbsp;returned&nbsp;UDPConn&nbsp;can&nbsp;be&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4195789">//&nbsp;discover&nbsp;the&nbsp;port.&nbsp;&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo</span><br>
<span class="lineno">190</span><span class="comment" id="4195859">//&nbsp;methods&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;UDP&nbsp;packets&nbsp;with&nbsp;per-packet</span><br>
<span class="lineno"></span><span class="comment" id="4195930">//&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="4195945">func</span>&nbsp;<span class="ident" id="4195950">ListenUDP</span><span class="op" id="4195959">(</span><span class="ident" id="4195960">net</span>&nbsp;<span class="builtintype" id="4195964">string</span><span class="op" id="4195970">,</span>&nbsp;<span class="ident" id="4195972">laddr</span>&nbsp;<span class="op" id="4195978">*</span><span class="ident" id="4195979">UDPAddr</span><span class="op" id="4195986">)</span>&nbsp;<span class="op" id="4195988">(</span><span class="op" id="4195989">*</span><span class="ident" id="4195990">UDPConn</span><span class="op" id="4195997">,</span>&nbsp;<span class="builtintype" id="4195999">error</span><span class="op" id="4196004">)</span>&nbsp;<span class="op" id="4196006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196009">switch</span>&nbsp;<span class="ident" id="4196016">net</span>&nbsp;<span class="op" id="4196020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196023">case</span>&nbsp;<span class="string" id="4196028">&#34;udp&#34;</span><span class="op" id="4196033">,</span>&nbsp;<span class="string" id="4196035">&#34;udp4&#34;</span><span class="op" id="4196041">,</span>&nbsp;<span class="string" id="4196043">&#34;udp6&#34;</span><span class="op" id="4196049">:</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196052">default</span><span class="op" id="4196059">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196063">return</span>&nbsp;<span class="ident" id="4196070">nil</span><span class="op" id="4196073">,</span>&nbsp;<span class="op" id="4196075">&amp;</span><span class="ident" id="4196076">OpError</span><span class="op" id="4196083">{</span><span class="ident" id="4196084">Op</span><span class="op" id="4196086">:</span>&nbsp;<span class="string" id="4196088">&#34;listen&#34;</span><span class="op" id="4196096">,</span>&nbsp;<span class="ident" id="4196098">Net</span><span class="op" id="4196101">:</span>&nbsp;<span class="ident" id="4196103">net</span><span class="op" id="4196106">,</span>&nbsp;<span class="ident" id="4196108">Addr</span><span class="op" id="4196112">:</span>&nbsp;<span class="ident" id="4196114">laddr</span><span class="op" id="4196119">,</span>&nbsp;<span class="ident" id="4196121">Err</span><span class="op" id="4196124">:</span>&nbsp;<span class="ident" id="4196126">UnknownNetworkError</span><span class="op" id="4196145">(</span><span class="ident" id="4196146">net</span><span class="op" id="4196149">)</span><span class="op" id="4196150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4196153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196156">if</span>&nbsp;<span class="ident" id="4196159">laddr</span>&nbsp;<span class="op" id="4196165">==</span>&nbsp;<span class="ident" id="4196168">nil</span>&nbsp;<span class="op" id="4196172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4196176">laddr</span>&nbsp;<span class="op" id="4196182">=</span>&nbsp;<span class="op" id="4196184">&amp;</span><span class="ident" id="4196185">UDPAddr</span><span class="op" id="4196192">{</span><span class="op" id="4196193">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4196196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4196199">fd</span><span class="op" id="4196201">,</span>&nbsp;<span class="ident" id="4196203">err</span>&nbsp;<span class="op" id="4196207">:=</span>&nbsp;<span class="ident" id="4196210">internetSocket</span><span class="op" id="4196224">(</span><span class="ident" id="4196225">net</span><span class="op" id="4196228">,</span>&nbsp;<span class="ident" id="4196230">laddr</span><span class="op" id="4196235">,</span>&nbsp;<span class="ident" id="4196237">nil</span><span class="op" id="4196240">,</span>&nbsp;<span class="ident" id="4196242">noDeadline</span><span class="op" id="4196252">,</span>&nbsp;<span class="ident" id="4196254">syscall</span><span class="op" id="4196261">.</span><span class="ident" id="4196262">SOCK_DGRAM</span><span class="op" id="4196272">,</span>&nbsp;<span class="num" id="4196274">0</span><span class="op" id="4196275">,</span>&nbsp;<span class="string" id="4196277">&#34;listen&#34;</span><span class="op" id="4196285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196288">if</span>&nbsp;<span class="ident" id="4196291">err</span>&nbsp;<span class="op" id="4196295">!=</span>&nbsp;<span class="ident" id="4196298">nil</span>&nbsp;<span class="op" id="4196302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196306">return</span>&nbsp;<span class="ident" id="4196313">nil</span><span class="op" id="4196316">,</span>&nbsp;<span class="op" id="4196318">&amp;</span><span class="ident" id="4196319">OpError</span><span class="op" id="4196326">{</span><span class="ident" id="4196327">Op</span><span class="op" id="4196329">:</span>&nbsp;<span class="string" id="4196331">&#34;listen&#34;</span><span class="op" id="4196339">,</span>&nbsp;<span class="ident" id="4196341">Net</span><span class="op" id="4196344">:</span>&nbsp;<span class="ident" id="4196346">net</span><span class="op" id="4196349">,</span>&nbsp;<span class="ident" id="4196351">Addr</span><span class="op" id="4196355">:</span>&nbsp;<span class="ident" id="4196357">laddr</span><span class="op" id="4196362">,</span>&nbsp;<span class="ident" id="4196364">Err</span><span class="op" id="4196367">:</span>&nbsp;<span class="ident" id="4196369">err</span><span class="op" id="4196372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4196375">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196378">return</span>&nbsp;<span class="ident" id="4196385">newUDPConn</span><span class="op" id="4196395">(</span><span class="ident" id="4196396">fd</span><span class="op" id="4196398">)</span><span class="op" id="4196399">,</span>&nbsp;<span class="ident" id="4196401">nil</span><br>
<span class="lineno"></span><span class="op" id="4196405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4196408">//&nbsp;ListenMulticastUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;multicast&nbsp;UDP&nbsp;packets</span><br>
<span class="lineno"></span><span class="comment" id="4196473">//&nbsp;addressed&nbsp;to&nbsp;the&nbsp;group&nbsp;address&nbsp;gaddr&nbsp;on&nbsp;ifi,&nbsp;which&nbsp;specifies&nbsp;the</span><br>
<span class="lineno">210</span><span class="comment" id="4196541">//&nbsp;interface&nbsp;to&nbsp;join.&nbsp;&nbsp;ListenMulticastUDP&nbsp;uses&nbsp;default&nbsp;multicast</span><br>
<span class="lineno"></span><span class="comment" id="4196606">//&nbsp;interface&nbsp;if&nbsp;ifi&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4196634">func</span>&nbsp;<span class="ident" id="4196639">ListenMulticastUDP</span><span class="op" id="4196657">(</span><span class="ident" id="4196658">net</span>&nbsp;<span class="builtintype" id="4196662">string</span><span class="op" id="4196668">,</span>&nbsp;<span class="ident" id="4196670">ifi</span>&nbsp;<span class="op" id="4196674">*</span><span class="ident" id="4196675">Interface</span><span class="op" id="4196684">,</span>&nbsp;<span class="ident" id="4196686">gaddr</span>&nbsp;<span class="op" id="4196692">*</span><span class="ident" id="4196693">UDPAddr</span><span class="op" id="4196700">)</span>&nbsp;<span class="op" id="4196702">(</span><span class="op" id="4196703">*</span><span class="ident" id="4196704">UDPConn</span><span class="op" id="4196711">,</span>&nbsp;<span class="builtintype" id="4196713">error</span><span class="op" id="4196718">)</span>&nbsp;<span class="op" id="4196720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196723">switch</span>&nbsp;<span class="ident" id="4196730">net</span>&nbsp;<span class="op" id="4196734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196737">case</span>&nbsp;<span class="string" id="4196742">&#34;udp&#34;</span><span class="op" id="4196747">,</span>&nbsp;<span class="string" id="4196749">&#34;udp4&#34;</span><span class="op" id="4196755">,</span>&nbsp;<span class="string" id="4196757">&#34;udp6&#34;</span><span class="op" id="4196763">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196766">default</span><span class="op" id="4196773">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196777">return</span>&nbsp;<span class="ident" id="4196784">nil</span><span class="op" id="4196787">,</span>&nbsp;<span class="op" id="4196789">&amp;</span><span class="ident" id="4196790">OpError</span><span class="op" id="4196797">{</span><span class="ident" id="4196798">Op</span><span class="op" id="4196800">:</span>&nbsp;<span class="string" id="4196802">&#34;listen&#34;</span><span class="op" id="4196810">,</span>&nbsp;<span class="ident" id="4196812">Net</span><span class="op" id="4196815">:</span>&nbsp;<span class="ident" id="4196817">net</span><span class="op" id="4196820">,</span>&nbsp;<span class="ident" id="4196822">Addr</span><span class="op" id="4196826">:</span>&nbsp;<span class="ident" id="4196828">gaddr</span><span class="op" id="4196833">,</span>&nbsp;<span class="ident" id="4196835">Err</span><span class="op" id="4196838">:</span>&nbsp;<span class="ident" id="4196840">UnknownNetworkError</span><span class="op" id="4196859">(</span><span class="ident" id="4196860">net</span><span class="op" id="4196863">)</span><span class="op" id="4196864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4196867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196870">if</span>&nbsp;<span class="ident" id="4196873">gaddr</span>&nbsp;<span class="op" id="4196879">==</span>&nbsp;<span class="ident" id="4196882">nil</span>&nbsp;<span class="op" id="4196886">||</span>&nbsp;<span class="ident" id="4196889">gaddr</span><span class="op" id="4196894">.</span><span class="ident" id="4196895">IP</span>&nbsp;<span class="op" id="4196898">==</span>&nbsp;<span class="ident" id="4196901">nil</span>&nbsp;<span class="op" id="4196905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196909">return</span>&nbsp;<span class="ident" id="4196916">nil</span><span class="op" id="4196919">,</span>&nbsp;<span class="op" id="4196921">&amp;</span><span class="ident" id="4196922">OpError</span><span class="op" id="4196929">{</span><span class="ident" id="4196930">Op</span><span class="op" id="4196932">:</span>&nbsp;<span class="string" id="4196934">&#34;listen&#34;</span><span class="op" id="4196942">,</span>&nbsp;<span class="ident" id="4196944">Net</span><span class="op" id="4196947">:</span>&nbsp;<span class="ident" id="4196949">net</span><span class="op" id="4196952">,</span>&nbsp;<span class="ident" id="4196954">Addr</span><span class="op" id="4196958">:</span>&nbsp;<span class="ident" id="4196960">nil</span><span class="op" id="4196963">,</span>&nbsp;<span class="ident" id="4196965">Err</span><span class="op" id="4196968">:</span>&nbsp;<span class="ident" id="4196970">errMissingAddress</span><span class="op" id="4196987">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4196990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4196993">fd</span><span class="op" id="4196995">,</span>&nbsp;<span class="ident" id="4196997">err</span>&nbsp;<span class="op" id="4197001">:=</span>&nbsp;<span class="ident" id="4197004">internetSocket</span><span class="op" id="4197018">(</span><span class="ident" id="4197019">net</span><span class="op" id="4197022">,</span>&nbsp;<span class="ident" id="4197024">gaddr</span><span class="op" id="4197029">,</span>&nbsp;<span class="ident" id="4197031">nil</span><span class="op" id="4197034">,</span>&nbsp;<span class="ident" id="4197036">noDeadline</span><span class="op" id="4197046">,</span>&nbsp;<span class="ident" id="4197048">syscall</span><span class="op" id="4197055">.</span><span class="ident" id="4197056">SOCK_DGRAM</span><span class="op" id="4197066">,</span>&nbsp;<span class="num" id="4197068">0</span><span class="op" id="4197069">,</span>&nbsp;<span class="string" id="4197071">&#34;listen&#34;</span><span class="op" id="4197079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197082">if</span>&nbsp;<span class="ident" id="4197085">err</span>&nbsp;<span class="op" id="4197089">!=</span>&nbsp;<span class="ident" id="4197092">nil</span>&nbsp;<span class="op" id="4197096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197100">return</span>&nbsp;<span class="ident" id="4197107">nil</span><span class="op" id="4197110">,</span>&nbsp;<span class="op" id="4197112">&amp;</span><span class="ident" id="4197113">OpError</span><span class="op" id="4197120">{</span><span class="ident" id="4197121">Op</span><span class="op" id="4197123">:</span>&nbsp;<span class="string" id="4197125">&#34;listen&#34;</span><span class="op" id="4197133">,</span>&nbsp;<span class="ident" id="4197135">Net</span><span class="op" id="4197138">:</span>&nbsp;<span class="ident" id="4197140">net</span><span class="op" id="4197143">,</span>&nbsp;<span class="ident" id="4197145">Addr</span><span class="op" id="4197149">:</span>&nbsp;<span class="ident" id="4197151">gaddr</span><span class="op" id="4197156">,</span>&nbsp;<span class="ident" id="4197158">Err</span><span class="op" id="4197161">:</span>&nbsp;<span class="ident" id="4197163">err</span><span class="op" id="4197166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4197169">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197172">c</span>&nbsp;<span class="op" id="4197174">:=</span>&nbsp;<span class="ident" id="4197177">newUDPConn</span><span class="op" id="4197187">(</span><span class="ident" id="4197188">fd</span><span class="op" id="4197190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197193">if</span>&nbsp;<span class="ident" id="4197196">ip4</span>&nbsp;<span class="op" id="4197200">:=</span>&nbsp;<span class="ident" id="4197203">gaddr</span><span class="op" id="4197208">.</span><span class="ident" id="4197209">IP</span><span class="op" id="4197211">.</span><span class="ident" id="4197212">To4</span><span class="op" id="4197215">(</span><span class="op" id="4197216">)</span><span class="op" id="4197217">;</span>&nbsp;<span class="ident" id="4197219">ip4</span>&nbsp;<span class="op" id="4197223">!=</span>&nbsp;<span class="ident" id="4197226">nil</span>&nbsp;<span class="op" id="4197230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197234">if</span>&nbsp;<span class="ident" id="4197237">err</span>&nbsp;<span class="op" id="4197241">:=</span>&nbsp;<span class="ident" id="4197244">listenIPv4MulticastUDP</span><span class="op" id="4197266">(</span><span class="ident" id="4197267">c</span><span class="op" id="4197268">,</span>&nbsp;<span class="ident" id="4197270">ifi</span><span class="op" id="4197273">,</span>&nbsp;<span class="ident" id="4197275">ip4</span><span class="op" id="4197278">)</span><span class="op" id="4197279">;</span>&nbsp;<span class="ident" id="4197281">err</span>&nbsp;<span class="op" id="4197285">!=</span>&nbsp;<span class="ident" id="4197288">nil</span>&nbsp;<span class="op" id="4197292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197297">c</span><span class="op" id="4197298">.</span><span class="ident" id="4197299">Close</span><span class="op" id="4197304">(</span><span class="op" id="4197305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197310">return</span>&nbsp;<span class="ident" id="4197317">nil</span><span class="op" id="4197320">,</span>&nbsp;<span class="op" id="4197322">&amp;</span><span class="ident" id="4197323">OpError</span><span class="op" id="4197330">{</span><span class="ident" id="4197331">Op</span><span class="op" id="4197333">:</span>&nbsp;<span class="string" id="4197335">&#34;listen&#34;</span><span class="op" id="4197343">,</span>&nbsp;<span class="ident" id="4197345">Net</span><span class="op" id="4197348">:</span>&nbsp;<span class="ident" id="4197350">net</span><span class="op" id="4197353">,</span>&nbsp;<span class="ident" id="4197355">Addr</span><span class="op" id="4197359">:</span>&nbsp;<span class="op" id="4197361">&amp;</span><span class="ident" id="4197362">IPAddr</span><span class="op" id="4197368">{</span><span class="ident" id="4197369">IP</span><span class="op" id="4197371">:</span>&nbsp;<span class="ident" id="4197373">ip4</span><span class="op" id="4197376">}</span><span class="op" id="4197377">,</span>&nbsp;<span class="ident" id="4197379">Err</span><span class="op" id="4197382">:</span>&nbsp;<span class="ident" id="4197384">err</span><span class="op" id="4197387">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4197391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4197394">}</span>&nbsp;<span class="keyword" id="4197396">else</span>&nbsp;<span class="op" id="4197401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197405">if</span>&nbsp;<span class="ident" id="4197408">err</span>&nbsp;<span class="op" id="4197412">:=</span>&nbsp;<span class="ident" id="4197415">listenIPv6MulticastUDP</span><span class="op" id="4197437">(</span><span class="ident" id="4197438">c</span><span class="op" id="4197439">,</span>&nbsp;<span class="ident" id="4197441">ifi</span><span class="op" id="4197444">,</span>&nbsp;<span class="ident" id="4197446">gaddr</span><span class="op" id="4197451">.</span><span class="ident" id="4197452">IP</span><span class="op" id="4197454">)</span><span class="op" id="4197455">;</span>&nbsp;<span class="ident" id="4197457">err</span>&nbsp;<span class="op" id="4197461">!=</span>&nbsp;<span class="ident" id="4197464">nil</span>&nbsp;<span class="op" id="4197468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197473">c</span><span class="op" id="4197474">.</span><span class="ident" id="4197475">Close</span><span class="op" id="4197480">(</span><span class="op" id="4197481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197486">return</span>&nbsp;<span class="ident" id="4197493">nil</span><span class="op" id="4197496">,</span>&nbsp;<span class="op" id="4197498">&amp;</span><span class="ident" id="4197499">OpError</span><span class="op" id="4197506">{</span><span class="ident" id="4197507">Op</span><span class="op" id="4197509">:</span>&nbsp;<span class="string" id="4197511">&#34;listen&#34;</span><span class="op" id="4197519">,</span>&nbsp;<span class="ident" id="4197521">Net</span><span class="op" id="4197524">:</span>&nbsp;<span class="ident" id="4197526">net</span><span class="op" id="4197529">,</span>&nbsp;<span class="ident" id="4197531">Addr</span><span class="op" id="4197535">:</span>&nbsp;<span class="op" id="4197537">&amp;</span><span class="ident" id="4197538">IPAddr</span><span class="op" id="4197544">{</span><span class="ident" id="4197545">IP</span><span class="op" id="4197547">:</span>&nbsp;<span class="ident" id="4197549">gaddr</span><span class="op" id="4197554">.</span><span class="ident" id="4197555">IP</span><span class="op" id="4197557">}</span><span class="op" id="4197558">,</span>&nbsp;<span class="ident" id="4197560">Err</span><span class="op" id="4197563">:</span>&nbsp;<span class="ident" id="4197565">err</span><span class="op" id="4197568">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4197572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4197575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197578">return</span>&nbsp;<span class="ident" id="4197585">c</span><span class="op" id="4197586">,</span>&nbsp;<span class="ident" id="4197588">nil</span><br>
<span class="lineno"></span><span class="op" id="4197592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="4197595">func</span>&nbsp;<span class="ident" id="4197600">listenIPv4MulticastUDP</span><span class="op" id="4197622">(</span><span class="ident" id="4197623">c</span>&nbsp;<span class="op" id="4197625">*</span><span class="ident" id="4197626">UDPConn</span><span class="op" id="4197633">,</span>&nbsp;<span class="ident" id="4197635">ifi</span>&nbsp;<span class="op" id="4197639">*</span><span class="ident" id="4197640">Interface</span><span class="op" id="4197649">,</span>&nbsp;<span class="ident" id="4197651">ip</span>&nbsp;<span class="ident" id="4197654">IP</span><span class="op" id="4197656">)</span>&nbsp;<span class="builtintype" id="4197658">error</span>&nbsp;<span class="op" id="4197664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197667">if</span>&nbsp;<span class="ident" id="4197670">ifi</span>&nbsp;<span class="op" id="4197674">!=</span>&nbsp;<span class="ident" id="4197677">nil</span>&nbsp;<span class="op" id="4197681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197685">if</span>&nbsp;<span class="ident" id="4197688">err</span>&nbsp;<span class="op" id="4197692">:=</span>&nbsp;<span class="ident" id="4197695">setIPv4MulticastInterface</span><span class="op" id="4197720">(</span><span class="ident" id="4197721">c</span><span class="op" id="4197722">.</span><span class="ident" id="4197723">fd</span><span class="op" id="4197725">,</span>&nbsp;<span class="ident" id="4197727">ifi</span><span class="op" id="4197730">)</span><span class="op" id="4197731">;</span>&nbsp;<span class="ident" id="4197733">err</span>&nbsp;<span class="op" id="4197737">!=</span>&nbsp;<span class="ident" id="4197740">nil</span>&nbsp;<span class="op" id="4197744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197749">return</span>&nbsp;<span class="ident" id="4197756">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4197762">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4197765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197768">if</span>&nbsp;<span class="ident" id="4197771">err</span>&nbsp;<span class="op" id="4197775">:=</span>&nbsp;<span class="ident" id="4197778">setIPv4MulticastLoopback</span><span class="op" id="4197802">(</span><span class="ident" id="4197803">c</span><span class="op" id="4197804">.</span><span class="ident" id="4197805">fd</span><span class="op" id="4197807">,</span>&nbsp;<span class="builtintype" id="4197809">false</span><span class="op" id="4197814">)</span><span class="op" id="4197815">;</span>&nbsp;<span class="ident" id="4197817">err</span>&nbsp;<span class="op" id="4197821">!=</span>&nbsp;<span class="ident" id="4197824">nil</span>&nbsp;<span class="op" id="4197828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197832">return</span>&nbsp;<span class="ident" id="4197839">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4197844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197847">if</span>&nbsp;<span class="ident" id="4197850">err</span>&nbsp;<span class="op" id="4197854">:=</span>&nbsp;<span class="ident" id="4197857">joinIPv4Group</span><span class="op" id="4197870">(</span><span class="ident" id="4197871">c</span><span class="op" id="4197872">.</span><span class="ident" id="4197873">fd</span><span class="op" id="4197875">,</span>&nbsp;<span class="ident" id="4197877">ifi</span><span class="op" id="4197880">,</span>&nbsp;<span class="ident" id="4197882">ip</span><span class="op" id="4197884">)</span><span class="op" id="4197885">;</span>&nbsp;<span class="ident" id="4197887">err</span>&nbsp;<span class="op" id="4197891">!=</span>&nbsp;<span class="ident" id="4197894">nil</span>&nbsp;<span class="op" id="4197898">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197902">return</span>&nbsp;<span class="ident" id="4197909">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4197914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197917">return</span>&nbsp;<span class="ident" id="4197924">nil</span><br>
<span class="lineno"></span><span class="op" id="4197928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="4197931">func</span>&nbsp;<span class="ident" id="4197936">listenIPv6MulticastUDP</span><span class="op" id="4197958">(</span><span class="ident" id="4197959">c</span>&nbsp;<span class="op" id="4197961">*</span><span class="ident" id="4197962">UDPConn</span><span class="op" id="4197969">,</span>&nbsp;<span class="ident" id="4197971">ifi</span>&nbsp;<span class="op" id="4197975">*</span><span class="ident" id="4197976">Interface</span><span class="op" id="4197985">,</span>&nbsp;<span class="ident" id="4197987">ip</span>&nbsp;<span class="ident" id="4197990">IP</span><span class="op" id="4197992">)</span>&nbsp;<span class="builtintype" id="4197994">error</span>&nbsp;<span class="op" id="4198000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198003">if</span>&nbsp;<span class="ident" id="4198006">ifi</span>&nbsp;<span class="op" id="4198010">!=</span>&nbsp;<span class="ident" id="4198013">nil</span>&nbsp;<span class="op" id="4198017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198021">if</span>&nbsp;<span class="ident" id="4198024">err</span>&nbsp;<span class="op" id="4198028">:=</span>&nbsp;<span class="ident" id="4198031">setIPv6MulticastInterface</span><span class="op" id="4198056">(</span><span class="ident" id="4198057">c</span><span class="op" id="4198058">.</span><span class="ident" id="4198059">fd</span><span class="op" id="4198061">,</span>&nbsp;<span class="ident" id="4198063">ifi</span><span class="op" id="4198066">)</span><span class="op" id="4198067">;</span>&nbsp;<span class="ident" id="4198069">err</span>&nbsp;<span class="op" id="4198073">!=</span>&nbsp;<span class="ident" id="4198076">nil</span>&nbsp;<span class="op" id="4198080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198085">return</span>&nbsp;<span class="ident" id="4198092">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4198098">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4198101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198104">if</span>&nbsp;<span class="ident" id="4198107">err</span>&nbsp;<span class="op" id="4198111">:=</span>&nbsp;<span class="ident" id="4198114">setIPv6MulticastLoopback</span><span class="op" id="4198138">(</span><span class="ident" id="4198139">c</span><span class="op" id="4198140">.</span><span class="ident" id="4198141">fd</span><span class="op" id="4198143">,</span>&nbsp;<span class="builtintype" id="4198145">false</span><span class="op" id="4198150">)</span><span class="op" id="4198151">;</span>&nbsp;<span class="ident" id="4198153">err</span>&nbsp;<span class="op" id="4198157">!=</span>&nbsp;<span class="ident" id="4198160">nil</span>&nbsp;<span class="op" id="4198164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198168">return</span>&nbsp;<span class="ident" id="4198175">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4198180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198183">if</span>&nbsp;<span class="ident" id="4198186">err</span>&nbsp;<span class="op" id="4198190">:=</span>&nbsp;<span class="ident" id="4198193">joinIPv6Group</span><span class="op" id="4198206">(</span><span class="ident" id="4198207">c</span><span class="op" id="4198208">.</span><span class="ident" id="4198209">fd</span><span class="op" id="4198211">,</span>&nbsp;<span class="ident" id="4198213">ifi</span><span class="op" id="4198216">,</span>&nbsp;<span class="ident" id="4198218">ip</span><span class="op" id="4198220">)</span><span class="op" id="4198221">;</span>&nbsp;<span class="ident" id="4198223">err</span>&nbsp;<span class="op" id="4198227">!=</span>&nbsp;<span class="ident" id="4198230">nil</span>&nbsp;<span class="op" id="4198234">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198238">return</span>&nbsp;<span class="ident" id="4198245">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4198250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198253">return</span>&nbsp;<span class="ident" id="4198260">nil</span><br>
<span class="lineno"></span><span class="op" id="4198264">}</span>
</div>
</body>
</html>
