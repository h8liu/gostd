<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html" class="current">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3915917">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3915972">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3916026">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3916077">//&nbsp;+build&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3916140">package</span>&nbsp;<span class="ident" id="3916148">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3916154">import</span>&nbsp;<span class="string" id="3916161">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="3916174">//&nbsp;Possible&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;finding&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="3916229">var</span>&nbsp;<span class="ident" id="3916233">certFiles</span>&nbsp;<span class="op" id="3916243">=</span>&nbsp;<span class="op" id="3916245">[</span><span class="op" id="3916246">]</span><span class="builtintype" id="3916247">string</span><span class="op" id="3916253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3916256">&#34;/etc/ssl/certs/ca-certificates.crt&#34;</span><span class="op" id="3916292">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3916298">//&nbsp;Debian/Ubuntu/Gentoo&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3916328">&#34;/etc/pki/tls/certs/ca-bundle.crt&#34;</span><span class="op" id="3916362">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3916370">//&nbsp;Fedora/RHEL</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3916386">&#34;/etc/ssl/ca-bundle.pem&#34;</span><span class="op" id="3916410">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3916428">//&nbsp;OpenSUSE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3916441">&#34;/etc/ssl/cert.pem&#34;</span><span class="op" id="3916460">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3916483">//&nbsp;OpenBSD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3916495">&#34;/usr/local/share/certs/ca-root-nss.crt&#34;</span><span class="op" id="3916535">,</span>&nbsp;<span class="comment" id="3916537">//&nbsp;FreeBSD/DragonFly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3916559">&#34;/etc/pki/tls/cacert.pem&#34;</span><span class="op" id="3916584">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3916601">//&nbsp;OpenELEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3916614">&#34;/etc/certs/ca-certificates.crt&#34;</span><span class="op" id="3916646">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3916656">//&nbsp;Solaris&nbsp;11.2+</span><br>
<span class="lineno">20</span><span class="op" id="3916673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3916676">//&nbsp;Possible&nbsp;directories&nbsp;with&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;successfully</span><br>
<span class="lineno"></span><span class="comment" id="3916748">//&nbsp;reading&nbsp;at&nbsp;least&nbsp;one&nbsp;file&nbsp;from&nbsp;a&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="3916795">var</span>&nbsp;<span class="ident" id="3916799">certDirectories</span>&nbsp;<span class="op" id="3916815">=</span>&nbsp;<span class="op" id="3916817">[</span><span class="op" id="3916818">]</span><span class="builtintype" id="3916819">string</span><span class="op" id="3916825">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3916828">&#34;/system/etc/security/cacerts&#34;</span><span class="op" id="3916858">,</span>&nbsp;<span class="comment" id="3916860">//&nbsp;Android</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="3916872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3916875">func</span>&nbsp;<span class="op" id="3916880">(</span><span class="ident" id="3916881">c</span>&nbsp;<span class="op" id="3916883">*</span><span class="ident" id="3916884">Certificate</span><span class="op" id="3916895">)</span>&nbsp;<span class="ident" id="3916897">systemVerify</span><span class="op" id="3916909">(</span><span class="ident" id="3916910">opts</span>&nbsp;<span class="op" id="3916915">*</span><span class="ident" id="3916916">VerifyOptions</span><span class="op" id="3916929">)</span>&nbsp;<span class="op" id="3916931">(</span><span class="ident" id="3916932">chains</span>&nbsp;<span class="op" id="3916939">[</span><span class="op" id="3916940">]</span><span class="op" id="3916941">[</span><span class="op" id="3916942">]</span><span class="op" id="3916943">*</span><span class="ident" id="3916944">Certificate</span><span class="op" id="3916955">,</span>&nbsp;<span class="ident" id="3916957">err</span>&nbsp;<span class="builtintype" id="3916961">error</span><span class="op" id="3916966">)</span>&nbsp;<span class="op" id="3916968">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3916971">return</span>&nbsp;<span class="builtintype" id="3916978">nil</span><span class="op" id="3916981">,</span>&nbsp;<span class="builtintype" id="3916983">nil</span><br>
<span class="lineno"></span><span class="op" id="3916987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3916990">func</span>&nbsp;<span class="ident" id="3916995">initSystemRoots</span><span class="op" id="3917010">(</span><span class="op" id="3917011">)</span>&nbsp;<span class="op" id="3917013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3917016">roots</span>&nbsp;<span class="op" id="3917022">:=</span>&nbsp;<span class="ident" id="3917025">NewCertPool</span><span class="op" id="3917036">(</span><span class="op" id="3917037">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3917040">for</span>&nbsp;<span class="ident" id="3917044">_</span><span class="op" id="3917045">,</span>&nbsp;<span class="ident" id="3917047">file</span>&nbsp;<span class="op" id="3917052">:=</span>&nbsp;<span class="keyword" id="3917055">range</span>&nbsp;<span class="ident" id="3917061">certFiles</span>&nbsp;<span class="op" id="3917071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3917075">data</span><span class="op" id="3917079">,</span>&nbsp;<span class="ident" id="3917081">err</span>&nbsp;<span class="op" id="3917085">:=</span>&nbsp;<span class="ident" id="3917088">ioutil</span><span class="op" id="3917094">.</span><span class="ident" id="3917095">ReadFile</span><span class="op" id="3917103">(</span><span class="ident" id="3917104">file</span><span class="op" id="3917108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3917112">if</span>&nbsp;<span class="ident" id="3917115">err</span>&nbsp;<span class="op" id="3917119">==</span>&nbsp;<span class="builtintype" id="3917122">nil</span>&nbsp;<span class="op" id="3917126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3917131">roots</span><span class="op" id="3917136">.</span><span class="ident" id="3917137">AppendCertsFromPEM</span><span class="op" id="3917155">(</span><span class="ident" id="3917156">data</span><span class="op" id="3917160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3917165">systemRoots</span>&nbsp;<span class="op" id="3917177">=</span>&nbsp;<span class="ident" id="3917179">roots</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3917188">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3917197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3917200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3917204">for</span>&nbsp;<span class="ident" id="3917208">_</span><span class="op" id="3917209">,</span>&nbsp;<span class="ident" id="3917211">directory</span>&nbsp;<span class="op" id="3917221">:=</span>&nbsp;<span class="keyword" id="3917224">range</span>&nbsp;<span class="ident" id="3917230">certDirectories</span>&nbsp;<span class="op" id="3917246">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3917250">fis</span><span class="op" id="3917253">,</span>&nbsp;<span class="ident" id="3917255">err</span>&nbsp;<span class="op" id="3917259">:=</span>&nbsp;<span class="ident" id="3917262">ioutil</span><span class="op" id="3917268">.</span><span class="ident" id="3917269">ReadDir</span><span class="op" id="3917276">(</span><span class="ident" id="3917277">directory</span><span class="op" id="3917286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3917290">if</span>&nbsp;<span class="ident" id="3917293">err</span>&nbsp;<span class="op" id="3917297">!=</span>&nbsp;<span class="builtintype" id="3917300">nil</span>&nbsp;<span class="op" id="3917304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3917309">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3917320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3917324">rootsAdded</span>&nbsp;<span class="op" id="3917335">:=</span>&nbsp;<span class="builtintype" id="3917338">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3917346">for</span>&nbsp;<span class="ident" id="3917350">_</span><span class="op" id="3917351">,</span>&nbsp;<span class="ident" id="3917353">fi</span>&nbsp;<span class="op" id="3917356">:=</span>&nbsp;<span class="keyword" id="3917359">range</span>&nbsp;<span class="ident" id="3917365">fis</span>&nbsp;<span class="op" id="3917369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3917374">data</span><span class="op" id="3917378">,</span>&nbsp;<span class="ident" id="3917380">err</span>&nbsp;<span class="op" id="3917384">:=</span>&nbsp;<span class="ident" id="3917387">ioutil</span><span class="op" id="3917393">.</span><span class="ident" id="3917394">ReadFile</span><span class="op" id="3917402">(</span><span class="ident" id="3917403">directory</span>&nbsp;<span class="op" id="3917413">+</span>&nbsp;<span class="string" id="3917415">&#34;/&#34;</span>&nbsp;<span class="op" id="3917419">+</span>&nbsp;<span class="ident" id="3917421">fi</span><span class="op" id="3917423">.</span><span class="ident" id="3917424">Name</span><span class="op" id="3917428">(</span><span class="op" id="3917429">)</span><span class="op" id="3917430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3917435">if</span>&nbsp;<span class="ident" id="3917438">err</span>&nbsp;<span class="op" id="3917442">==</span>&nbsp;<span class="builtintype" id="3917445">nil</span>&nbsp;<span class="op" id="3917449">&amp;&amp;</span>&nbsp;<span class="ident" id="3917452">roots</span><span class="op" id="3917457">.</span><span class="ident" id="3917458">AppendCertsFromPEM</span><span class="op" id="3917476">(</span><span class="ident" id="3917477">data</span><span class="op" id="3917481">)</span>&nbsp;<span class="op" id="3917483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3917489">rootsAdded</span>&nbsp;<span class="op" id="3917500">=</span>&nbsp;<span class="builtintype" id="3917502">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3917510">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3917514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3917518">if</span>&nbsp;<span class="ident" id="3917521">rootsAdded</span>&nbsp;<span class="op" id="3917532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3917537">systemRoots</span>&nbsp;<span class="op" id="3917549">=</span>&nbsp;<span class="ident" id="3917551">roots</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3917560">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3917569">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3917572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3917576">//&nbsp;All&nbsp;of&nbsp;the&nbsp;files&nbsp;failed&nbsp;to&nbsp;load.&nbsp;systemRoots&nbsp;will&nbsp;be&nbsp;nil&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3917648">//&nbsp;trigger&nbsp;a&nbsp;specific&nbsp;error&nbsp;at&nbsp;verification&nbsp;time.</span><br>
<span class="lineno"></span><span class="op" id="3917698">}</span>
</div>
</body>
</html>
