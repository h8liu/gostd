<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8076564">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8076619">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8076673">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8076724">package</span>&nbsp;<span class="ident" id="8076732">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8076737">import</span>&nbsp;<span class="op" id="8076744">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8076747">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8076756">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8076763">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8076769">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8076782">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8076788">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8076799">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8076810">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8076821">&#34;testing/iotest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8076839">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8076846">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8076849">type</span>&nbsp;<span class="ident" id="8076854">writerTestEntry</span>&nbsp;<span class="keyword" id="8076870">struct</span>&nbsp;<span class="op" id="8076877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076880">header</span>&nbsp;&nbsp;&nbsp;<span class="op" id="8076889">*</span><span class="ident" id="8076890">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076898">contents</span>&nbsp;<span class="builtintype" id="8076907">string</span><br>
<span class="lineno"></span><span class="op" id="8076914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8076917">type</span>&nbsp;<span class="ident" id="8076922">writerTest</span>&nbsp;<span class="keyword" id="8076933">struct</span>&nbsp;<span class="op" id="8076940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076943">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8076951">string</span>&nbsp;<span class="comment" id="8076958">//&nbsp;filename&nbsp;of&nbsp;expected&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8076990">entries</span>&nbsp;<span class="op" id="8076998">[</span><span class="op" id="8076999">]</span><span class="op" id="8077000">*</span><span class="ident" id="8077001">writerTestEntry</span><br>
<span class="lineno"></span><span class="op" id="8077017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8077020">var</span>&nbsp;<span class="ident" id="8077024">writerTests</span>&nbsp;<span class="op" id="8077036">=</span>&nbsp;<span class="op" id="8077038">[</span><span class="op" id="8077039">]</span><span class="op" id="8077040">*</span><span class="ident" id="8077041">writerTest</span><span class="op" id="8077051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8077054">//&nbsp;The&nbsp;writer&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;with&nbsp;this&nbsp;command:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8077111">//&nbsp;tar&nbsp;(GNU&nbsp;tar)&nbsp;1.26</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8077134">//&nbsp;&nbsp;&nbsp;ln&nbsp;-s&nbsp;small.txt&nbsp;link.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8077165">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;--format=ustar&nbsp;-c&nbsp;-f&nbsp;writer.tar&nbsp;small.txt&nbsp;small2.txt&nbsp;link.txt</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8077242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077246">file</span><span class="op" id="8077250">:</span>&nbsp;<span class="string" id="8077252">&#34;testdata/writer.tar&#34;</span><span class="op" id="8077273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077277">entries</span><span class="op" id="8077284">:</span>&nbsp;<span class="op" id="8077286">[</span><span class="op" id="8077287">]</span><span class="op" id="8077288">*</span><span class="ident" id="8077289">writerTestEntry</span><span class="op" id="8077304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8077309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077315">header</span><span class="op" id="8077321">:</span>&nbsp;<span class="op" id="8077323">&amp;</span><span class="ident" id="8077324">Header</span><span class="op" id="8077330">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077337">Name</span><span class="op" id="8077341">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8077347">&#34;small.txt&#34;</span><span class="op" id="8077358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077365">Mode</span><span class="op" id="8077369">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8077375">0640</span><span class="op" id="8077379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077386">Uid</span><span class="op" id="8077389">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8077396">73025</span><span class="op" id="8077401">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077408">Gid</span><span class="op" id="8077411">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8077418">5000</span><span class="op" id="8077422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077429">Size</span><span class="op" id="8077433">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8077439">5</span><span class="op" id="8077440">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077447">ModTime</span><span class="op" id="8077454">:</span>&nbsp;&nbsp;<span class="ident" id="8077457">time</span><span class="op" id="8077461">.</span><span class="ident" id="8077462">Unix</span><span class="op" id="8077466">(</span><span class="num" id="8077467">1246508266</span><span class="op" id="8077477">,</span>&nbsp;<span class="num" id="8077479">0</span><span class="op" id="8077480">)</span><span class="op" id="8077481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077488">Typeflag</span><span class="op" id="8077496">:</span>&nbsp;<span class="string" id="8077498">&#39;0&#39;</span><span class="op" id="8077501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077508">Uname</span><span class="op" id="8077513">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8077518">&#34;dsymonds&#34;</span><span class="op" id="8077528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077535">Gname</span><span class="op" id="8077540">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8077545">&#34;eng&#34;</span><span class="op" id="8077550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8077556">}</span><span class="op" id="8077557">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077563">contents</span><span class="op" id="8077571">:</span>&nbsp;<span class="string" id="8077573">&#34;Kilts&#34;</span><span class="op" id="8077580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8077585">}</span><span class="op" id="8077586">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8077591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077597">header</span><span class="op" id="8077603">:</span>&nbsp;<span class="op" id="8077605">&amp;</span><span class="ident" id="8077606">Header</span><span class="op" id="8077612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077619">Name</span><span class="op" id="8077623">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8077629">&#34;small2.txt&#34;</span><span class="op" id="8077641">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077648">Mode</span><span class="op" id="8077652">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8077658">0640</span><span class="op" id="8077662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077669">Uid</span><span class="op" id="8077672">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8077679">73025</span><span class="op" id="8077684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077691">Gid</span><span class="op" id="8077694">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8077701">5000</span><span class="op" id="8077705">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077712">Size</span><span class="op" id="8077716">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8077722">11</span><span class="op" id="8077724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077731">ModTime</span><span class="op" id="8077738">:</span>&nbsp;&nbsp;<span class="ident" id="8077741">time</span><span class="op" id="8077745">.</span><span class="ident" id="8077746">Unix</span><span class="op" id="8077750">(</span><span class="num" id="8077751">1245217492</span><span class="op" id="8077761">,</span>&nbsp;<span class="num" id="8077763">0</span><span class="op" id="8077764">)</span><span class="op" id="8077765">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077772">Typeflag</span><span class="op" id="8077780">:</span>&nbsp;<span class="string" id="8077782">&#39;0&#39;</span><span class="op" id="8077785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077792">Uname</span><span class="op" id="8077797">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8077802">&#34;dsymonds&#34;</span><span class="op" id="8077812">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077819">Gname</span><span class="op" id="8077824">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8077829">&#34;eng&#34;</span><span class="op" id="8077834">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8077840">}</span><span class="op" id="8077841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077847">contents</span><span class="op" id="8077855">:</span>&nbsp;<span class="string" id="8077857">&#34;Google.com\n&#34;</span><span class="op" id="8077871">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8077876">}</span><span class="op" id="8077877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8077882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077888">header</span><span class="op" id="8077894">:</span>&nbsp;<span class="op" id="8077896">&amp;</span><span class="ident" id="8077897">Header</span><span class="op" id="8077903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077910">Name</span><span class="op" id="8077914">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8077920">&#34;link.txt&#34;</span><span class="op" id="8077930">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077937">Mode</span><span class="op" id="8077941">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8077947">0777</span><span class="op" id="8077951">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077958">Uid</span><span class="op" id="8077961">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8077968">1000</span><span class="op" id="8077972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8077979">Gid</span><span class="op" id="8077982">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8077989">1000</span><span class="op" id="8077993">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078000">Size</span><span class="op" id="8078004">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8078010">0</span><span class="op" id="8078011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078018">ModTime</span><span class="op" id="8078025">:</span>&nbsp;&nbsp;<span class="ident" id="8078028">time</span><span class="op" id="8078032">.</span><span class="ident" id="8078033">Unix</span><span class="op" id="8078037">(</span><span class="num" id="8078038">1314603082</span><span class="op" id="8078048">,</span>&nbsp;<span class="num" id="8078050">0</span><span class="op" id="8078051">)</span><span class="op" id="8078052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078059">Typeflag</span><span class="op" id="8078067">:</span>&nbsp;<span class="string" id="8078069">&#39;2&#39;</span><span class="op" id="8078072">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078079">Linkname</span><span class="op" id="8078087">:</span>&nbsp;<span class="string" id="8078089">&#34;small.txt&#34;</span><span class="op" id="8078100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078107">Uname</span><span class="op" id="8078112">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8078117">&#34;strings&#34;</span><span class="op" id="8078126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078133">Gname</span><span class="op" id="8078138">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8078143">&#34;strings&#34;</span><span class="op" id="8078152">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8078158">}</span><span class="op" id="8078159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8078165">//&nbsp;no&nbsp;contents</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8078183">}</span><span class="op" id="8078184">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8078188">}</span><span class="op" id="8078189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8078192">}</span><span class="op" id="8078193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8078196">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8078259">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;/tmp/16gig.txt</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8078321">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;/tmp/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8078395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078399">file</span><span class="op" id="8078403">:</span>&nbsp;<span class="string" id="8078405">&#34;testdata/writer-big.tar&#34;</span><span class="op" id="8078430">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078434">entries</span><span class="op" id="8078441">:</span>&nbsp;<span class="op" id="8078443">[</span><span class="op" id="8078444">]</span><span class="op" id="8078445">*</span><span class="ident" id="8078446">writerTestEntry</span><span class="op" id="8078461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8078466">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078472">header</span><span class="op" id="8078478">:</span>&nbsp;<span class="op" id="8078480">&amp;</span><span class="ident" id="8078481">Header</span><span class="op" id="8078487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078494">Name</span><span class="op" id="8078498">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8078504">&#34;tmp/16gig.txt&#34;</span><span class="op" id="8078519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078526">Mode</span><span class="op" id="8078530">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8078536">0640</span><span class="op" id="8078540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078547">Uid</span><span class="op" id="8078550">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8078557">73025</span><span class="op" id="8078562">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078569">Gid</span><span class="op" id="8078572">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8078579">5000</span><span class="op" id="8078583">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078590">Size</span><span class="op" id="8078594">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8078600">16</span>&nbsp;<span class="op" id="8078603">&lt;&lt;</span>&nbsp;<span class="num" id="8078606">30</span><span class="op" id="8078608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078615">ModTime</span><span class="op" id="8078622">:</span>&nbsp;&nbsp;<span class="ident" id="8078625">time</span><span class="op" id="8078629">.</span><span class="ident" id="8078630">Unix</span><span class="op" id="8078634">(</span><span class="num" id="8078635">1254699560</span><span class="op" id="8078645">,</span>&nbsp;<span class="num" id="8078647">0</span><span class="op" id="8078648">)</span><span class="op" id="8078649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078656">Typeflag</span><span class="op" id="8078664">:</span>&nbsp;<span class="string" id="8078666">&#39;0&#39;</span><span class="op" id="8078669">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078676">Uname</span><span class="op" id="8078681">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8078686">&#34;dsymonds&#34;</span><span class="op" id="8078696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078703">Gname</span><span class="op" id="8078708">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8078713">&#34;eng&#34;</span><span class="op" id="8078718">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8078724">}</span><span class="op" id="8078725">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8078731">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8078752">contents</span><span class="op" id="8078760">:</span>&nbsp;<span class="ident" id="8078762">strings</span><span class="op" id="8078769">.</span><span class="ident" id="8078770">Repeat</span><span class="op" id="8078776">(</span><span class="string" id="8078777">&#34;\x00&#34;</span><span class="op" id="8078783">,</span>&nbsp;<span class="num" id="8078785">4</span><span class="op" id="8078786">&lt;&lt;</span><span class="num" id="8078788">10</span><span class="op" id="8078790">)</span><span class="op" id="8078791">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8078796">}</span><span class="op" id="8078797">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8078801">}</span><span class="op" id="8078802">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8078805">}</span><span class="op" id="8078806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8078809">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8078872">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;(longname/)*15&nbsp;/16gig.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8078945">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;(longname/)*15&nbsp;/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big-long.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8079035">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079039">file</span><span class="op" id="8079043">:</span>&nbsp;<span class="string" id="8079045">&#34;testdata/writer-big-long.tar&#34;</span><span class="op" id="8079075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079079">entries</span><span class="op" id="8079086">:</span>&nbsp;<span class="op" id="8079088">[</span><span class="op" id="8079089">]</span><span class="op" id="8079090">*</span><span class="ident" id="8079091">writerTestEntry</span><span class="op" id="8079106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8079111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079117">header</span><span class="op" id="8079123">:</span>&nbsp;<span class="op" id="8079125">&amp;</span><span class="ident" id="8079126">Header</span><span class="op" id="8079132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079139">Name</span><span class="op" id="8079143">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079149">strings</span><span class="op" id="8079156">.</span><span class="ident" id="8079157">Repeat</span><span class="op" id="8079163">(</span><span class="string" id="8079164">&#34;longname/&#34;</span><span class="op" id="8079175">,</span>&nbsp;<span class="num" id="8079177">15</span><span class="op" id="8079179">)</span>&nbsp;<span class="op" id="8079181">+</span>&nbsp;<span class="string" id="8079183">&#34;16gig.txt&#34;</span><span class="op" id="8079194">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079201">Mode</span><span class="op" id="8079205">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8079211">0644</span><span class="op" id="8079215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079222">Uid</span><span class="op" id="8079225">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8079232">1000</span><span class="op" id="8079236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079243">Gid</span><span class="op" id="8079246">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8079253">1000</span><span class="op" id="8079257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079264">Size</span><span class="op" id="8079268">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8079274">16</span>&nbsp;<span class="op" id="8079277">&lt;&lt;</span>&nbsp;<span class="num" id="8079280">30</span><span class="op" id="8079282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079289">ModTime</span><span class="op" id="8079296">:</span>&nbsp;&nbsp;<span class="ident" id="8079299">time</span><span class="op" id="8079303">.</span><span class="ident" id="8079304">Unix</span><span class="op" id="8079308">(</span><span class="num" id="8079309">1399583047</span><span class="op" id="8079319">,</span>&nbsp;<span class="num" id="8079321">0</span><span class="op" id="8079322">)</span><span class="op" id="8079323">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079330">Typeflag</span><span class="op" id="8079338">:</span>&nbsp;<span class="string" id="8079340">&#39;0&#39;</span><span class="op" id="8079343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079350">Uname</span><span class="op" id="8079355">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8079360">&#34;guillaume&#34;</span><span class="op" id="8079371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079378">Gname</span><span class="op" id="8079383">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8079388">&#34;guillaume&#34;</span><span class="op" id="8079399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8079405">}</span><span class="op" id="8079406">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8079412">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079433">contents</span><span class="op" id="8079441">:</span>&nbsp;<span class="ident" id="8079443">strings</span><span class="op" id="8079450">.</span><span class="ident" id="8079451">Repeat</span><span class="op" id="8079457">(</span><span class="string" id="8079458">&#34;\x00&#34;</span><span class="op" id="8079464">,</span>&nbsp;<span class="num" id="8079466">4</span><span class="op" id="8079467">&lt;&lt;</span><span class="num" id="8079469">10</span><span class="op" id="8079471">)</span><span class="op" id="8079472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8079477">}</span><span class="op" id="8079478">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8079482">}</span><span class="op" id="8079483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8079486">}</span><span class="op" id="8079487">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8079490">//&nbsp;This&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;gnu&nbsp;tar&nbsp;1.17</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8079536">//&nbsp;gnutar&nbsp;&nbsp;-b&nbsp;4&nbsp;--format=ustar&nbsp;(longname/)*15&nbsp;+&nbsp;file.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8079594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079598">file</span><span class="op" id="8079602">:</span>&nbsp;<span class="string" id="8079604">&#34;testdata/ustar.tar&#34;</span><span class="op" id="8079624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079628">entries</span><span class="op" id="8079635">:</span>&nbsp;<span class="op" id="8079637">[</span><span class="op" id="8079638">]</span><span class="op" id="8079639">*</span><span class="ident" id="8079640">writerTestEntry</span><span class="op" id="8079655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8079660">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079666">header</span><span class="op" id="8079672">:</span>&nbsp;<span class="op" id="8079674">&amp;</span><span class="ident" id="8079675">Header</span><span class="op" id="8079681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079688">Name</span><span class="op" id="8079692">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079698">strings</span><span class="op" id="8079705">.</span><span class="ident" id="8079706">Repeat</span><span class="op" id="8079712">(</span><span class="string" id="8079713">&#34;longname/&#34;</span><span class="op" id="8079724">,</span>&nbsp;<span class="num" id="8079726">15</span><span class="op" id="8079728">)</span>&nbsp;<span class="op" id="8079730">+</span>&nbsp;<span class="string" id="8079732">&#34;file.txt&#34;</span><span class="op" id="8079742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079749">Mode</span><span class="op" id="8079753">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8079759">0644</span><span class="op" id="8079763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079770">Uid</span><span class="op" id="8079773">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8079780">0765</span><span class="op" id="8079784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079791">Gid</span><span class="op" id="8079794">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8079801">024</span><span class="op" id="8079804">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079811">Size</span><span class="op" id="8079815">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8079821">06</span><span class="op" id="8079823">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079830">ModTime</span><span class="op" id="8079837">:</span>&nbsp;&nbsp;<span class="ident" id="8079840">time</span><span class="op" id="8079844">.</span><span class="ident" id="8079845">Unix</span><span class="op" id="8079849">(</span><span class="num" id="8079850">1360135598</span><span class="op" id="8079860">,</span>&nbsp;<span class="num" id="8079862">0</span><span class="op" id="8079863">)</span><span class="op" id="8079864">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079871">Typeflag</span><span class="op" id="8079879">:</span>&nbsp;<span class="string" id="8079881">&#39;0&#39;</span><span class="op" id="8079884">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079891">Uname</span><span class="op" id="8079896">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8079901">&#34;shane&#34;</span><span class="op" id="8079908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079915">Gname</span><span class="op" id="8079920">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8079925">&#34;staff&#34;</span><span class="op" id="8079932">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8079938">}</span><span class="op" id="8079939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8079945">contents</span><span class="op" id="8079953">:</span>&nbsp;<span class="string" id="8079955">&#34;hello\n&#34;</span><span class="op" id="8079964">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8079969">}</span><span class="op" id="8079970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8079974">}</span><span class="op" id="8079975">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8079978">}</span><span class="op" id="8079979">,</span><br>
<span class="lineno">150</span><span class="op" id="8079981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8079984">//&nbsp;Render&nbsp;byte&nbsp;array&nbsp;in&nbsp;a&nbsp;two-character&nbsp;hexadecimal&nbsp;string,&nbsp;spaced&nbsp;for&nbsp;easy&nbsp;visual&nbsp;inspection.</span><br>
<span class="lineno"></span><span class="keyword" id="8080079">func</span>&nbsp;<span class="ident" id="8080084">bytestr</span><span class="op" id="8080091">(</span><span class="ident" id="8080092">offset</span>&nbsp;<span class="builtintype" id="8080099">int</span><span class="op" id="8080102">,</span>&nbsp;<span class="ident" id="8080104">b</span>&nbsp;<span class="op" id="8080106">[</span><span class="op" id="8080107">]</span><span class="builtintype" id="8080108">byte</span><span class="op" id="8080112">)</span>&nbsp;<span class="builtintype" id="8080114">string</span>&nbsp;<span class="op" id="8080121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8080124">const</span>&nbsp;<span class="ident" id="8080130">rowLen</span>&nbsp;<span class="op" id="8080137">=</span>&nbsp;<span class="num" id="8080139">32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8080143">s</span>&nbsp;<span class="op" id="8080145">:=</span>&nbsp;<span class="ident" id="8080148">fmt</span><span class="op" id="8080151">.</span><span class="ident" id="8080152">Sprintf</span><span class="op" id="8080159">(</span><span class="string" id="8080160">&#34;%04x&nbsp;&#34;</span><span class="op" id="8080167">,</span>&nbsp;<span class="ident" id="8080169">offset</span><span class="op" id="8080175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8080178">for</span>&nbsp;<span class="ident" id="8080182">_</span><span class="op" id="8080183">,</span>&nbsp;<span class="ident" id="8080185">ch</span>&nbsp;<span class="op" id="8080188">:=</span>&nbsp;<span class="keyword" id="8080191">range</span>&nbsp;<span class="ident" id="8080197">b</span>&nbsp;<span class="op" id="8080199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8080203">switch</span>&nbsp;<span class="op" id="8080210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8080214">case</span>&nbsp;<span class="string" id="8080219">&#39;0&#39;</span>&nbsp;<span class="op" id="8080223">&lt;=</span>&nbsp;<span class="ident" id="8080226">ch</span>&nbsp;<span class="op" id="8080229">&amp;&amp;</span>&nbsp;<span class="ident" id="8080232">ch</span>&nbsp;<span class="op" id="8080235">&lt;=</span>&nbsp;<span class="string" id="8080238">&#39;9&#39;</span><span class="op" id="8080241">,</span>&nbsp;<span class="string" id="8080243">&#39;A&#39;</span>&nbsp;<span class="op" id="8080247">&lt;=</span>&nbsp;<span class="ident" id="8080250">ch</span>&nbsp;<span class="op" id="8080253">&amp;&amp;</span>&nbsp;<span class="ident" id="8080256">ch</span>&nbsp;<span class="op" id="8080259">&lt;=</span>&nbsp;<span class="string" id="8080262">&#39;Z&#39;</span><span class="op" id="8080265">,</span>&nbsp;<span class="string" id="8080267">&#39;a&#39;</span>&nbsp;<span class="op" id="8080271">&lt;=</span>&nbsp;<span class="ident" id="8080274">ch</span>&nbsp;<span class="op" id="8080277">&amp;&amp;</span>&nbsp;<span class="ident" id="8080280">ch</span>&nbsp;<span class="op" id="8080283">&lt;=</span>&nbsp;<span class="string" id="8080286">&#39;z&#39;</span><span class="op" id="8080289">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8080294">s</span>&nbsp;<span class="op" id="8080296">+=</span>&nbsp;<span class="ident" id="8080299">fmt</span><span class="op" id="8080302">.</span><span class="ident" id="8080303">Sprintf</span><span class="op" id="8080310">(</span><span class="string" id="8080311">&#34;&nbsp;&nbsp;%c&#34;</span><span class="op" id="8080317">,</span>&nbsp;<span class="ident" id="8080319">ch</span><span class="op" id="8080321">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8080325">default</span><span class="op" id="8080332">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8080337">s</span>&nbsp;<span class="op" id="8080339">+=</span>&nbsp;<span class="ident" id="8080342">fmt</span><span class="op" id="8080345">.</span><span class="ident" id="8080346">Sprintf</span><span class="op" id="8080353">(</span><span class="string" id="8080354">&#34;&nbsp;%02x&#34;</span><span class="op" id="8080361">,</span>&nbsp;<span class="ident" id="8080363">ch</span><span class="op" id="8080365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8080369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8080372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8080375">return</span>&nbsp;<span class="ident" id="8080382">s</span><br>
<span class="lineno">165</span><span class="op" id="8080384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8080387">//&nbsp;Render&nbsp;a&nbsp;pseudo-diff&nbsp;between&nbsp;two&nbsp;blocks&nbsp;of&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="8080440">func</span>&nbsp;<span class="ident" id="8080445">bytediff</span><span class="op" id="8080453">(</span><span class="ident" id="8080454">a</span>&nbsp;<span class="op" id="8080456">[</span><span class="op" id="8080457">]</span><span class="builtintype" id="8080458">byte</span><span class="op" id="8080462">,</span>&nbsp;<span class="ident" id="8080464">b</span>&nbsp;<span class="op" id="8080466">[</span><span class="op" id="8080467">]</span><span class="builtintype" id="8080468">byte</span><span class="op" id="8080472">)</span>&nbsp;<span class="builtintype" id="8080474">string</span>&nbsp;<span class="op" id="8080481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8080484">const</span>&nbsp;<span class="ident" id="8080490">rowLen</span>&nbsp;<span class="op" id="8080497">=</span>&nbsp;<span class="num" id="8080499">32</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8080503">s</span>&nbsp;<span class="op" id="8080505">:=</span>&nbsp;<span class="ident" id="8080508">fmt</span><span class="op" id="8080511">.</span><span class="ident" id="8080512">Sprintf</span><span class="op" id="8080519">(</span><span class="string" id="8080520">&#34;(%d&nbsp;bytes&nbsp;vs.&nbsp;%d&nbsp;bytes)\n&#34;</span><span class="op" id="8080547">,</span>&nbsp;<span class="builtinfunc" id="8080549">len</span><span class="op" id="8080552">(</span><span class="ident" id="8080553">a</span><span class="op" id="8080554">)</span><span class="op" id="8080555">,</span>&nbsp;<span class="builtinfunc" id="8080557">len</span><span class="op" id="8080560">(</span><span class="ident" id="8080561">b</span><span class="op" id="8080562">)</span><span class="op" id="8080563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8080566">for</span>&nbsp;<span class="ident" id="8080570">offset</span>&nbsp;<span class="op" id="8080577">:=</span>&nbsp;<span class="num" id="8080580">0</span><span class="op" id="8080581">;</span>&nbsp;<span class="builtinfunc" id="8080583">len</span><span class="op" id="8080586">(</span><span class="ident" id="8080587">a</span><span class="op" id="8080588">)</span><span class="op" id="8080589">+</span><span class="builtinfunc" id="8080590">len</span><span class="op" id="8080593">(</span><span class="ident" id="8080594">b</span><span class="op" id="8080595">)</span>&nbsp;<span class="op" id="8080597">&gt;</span>&nbsp;<span class="num" id="8080599">0</span><span class="op" id="8080600">;</span>&nbsp;<span class="ident" id="8080602">offset</span>&nbsp;<span class="op" id="8080609">+=</span>&nbsp;<span class="ident" id="8080612">rowLen</span>&nbsp;<span class="op" id="8080619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8080623">na</span><span class="op" id="8080625">,</span>&nbsp;<span class="ident" id="8080627">nb</span>&nbsp;<span class="op" id="8080630">:=</span>&nbsp;<span class="ident" id="8080633">rowLen</span><span class="op" id="8080639">,</span>&nbsp;<span class="ident" id="8080641">rowLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8080650">if</span>&nbsp;<span class="ident" id="8080653">na</span>&nbsp;<span class="op" id="8080656">&gt;</span>&nbsp;<span class="builtinfunc" id="8080658">len</span><span class="op" id="8080661">(</span><span class="ident" id="8080662">a</span><span class="op" id="8080663">)</span>&nbsp;<span class="op" id="8080665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8080670">na</span>&nbsp;<span class="op" id="8080673">=</span>&nbsp;<span class="builtinfunc" id="8080675">len</span><span class="op" id="8080678">(</span><span class="ident" id="8080679">a</span><span class="op" id="8080680">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8080684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8080688">if</span>&nbsp;<span class="ident" id="8080691">nb</span>&nbsp;<span class="op" id="8080694">&gt;</span>&nbsp;<span class="builtinfunc" id="8080696">len</span><span class="op" id="8080699">(</span><span class="ident" id="8080700">b</span><span class="op" id="8080701">)</span>&nbsp;<span class="op" id="8080703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8080708">nb</span>&nbsp;<span class="op" id="8080711">=</span>&nbsp;<span class="builtinfunc" id="8080713">len</span><span class="op" id="8080716">(</span><span class="ident" id="8080717">b</span><span class="op" id="8080718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8080722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8080726">sa</span>&nbsp;<span class="op" id="8080729">:=</span>&nbsp;<span class="ident" id="8080732">bytestr</span><span class="op" id="8080739">(</span><span class="ident" id="8080740">offset</span><span class="op" id="8080746">,</span>&nbsp;<span class="ident" id="8080748">a</span><span class="op" id="8080749">[</span><span class="num" id="8080750">0</span><span class="op" id="8080751">:</span><span class="ident" id="8080752">na</span><span class="op" id="8080754">]</span><span class="op" id="8080755">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8080759">sb</span>&nbsp;<span class="op" id="8080762">:=</span>&nbsp;<span class="ident" id="8080765">bytestr</span><span class="op" id="8080772">(</span><span class="ident" id="8080773">offset</span><span class="op" id="8080779">,</span>&nbsp;<span class="ident" id="8080781">b</span><span class="op" id="8080782">[</span><span class="num" id="8080783">0</span><span class="op" id="8080784">:</span><span class="ident" id="8080785">nb</span><span class="op" id="8080787">]</span><span class="op" id="8080788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8080792">if</span>&nbsp;<span class="ident" id="8080795">sa</span>&nbsp;<span class="op" id="8080798">!=</span>&nbsp;<span class="ident" id="8080801">sb</span>&nbsp;<span class="op" id="8080804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8080809">s</span>&nbsp;<span class="op" id="8080811">+=</span>&nbsp;<span class="ident" id="8080814">fmt</span><span class="op" id="8080817">.</span><span class="ident" id="8080818">Sprintf</span><span class="op" id="8080825">(</span><span class="string" id="8080826">&#34;-%v\n+%v\n&#34;</span><span class="op" id="8080838">,</span>&nbsp;<span class="ident" id="8080840">sa</span><span class="op" id="8080842">,</span>&nbsp;<span class="ident" id="8080844">sb</span><span class="op" id="8080846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8080850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8080854">a</span>&nbsp;<span class="op" id="8080856">=</span>&nbsp;<span class="ident" id="8080858">a</span><span class="op" id="8080859">[</span><span class="ident" id="8080860">na</span><span class="op" id="8080862">:</span><span class="op" id="8080863">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8080867">b</span>&nbsp;<span class="op" id="8080869">=</span>&nbsp;<span class="ident" id="8080871">b</span><span class="op" id="8080872">[</span><span class="ident" id="8080873">nb</span><span class="op" id="8080875">:</span><span class="op" id="8080876">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8080879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8080882">return</span>&nbsp;<span class="ident" id="8080889">s</span><br>
<span class="lineno"></span><span class="op" id="8080891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="8080894">func</span>&nbsp;<span class="ident" id="8080899">TestWriter</span><span class="op" id="8080909">(</span><span class="ident" id="8080910">t</span>&nbsp;<span class="op" id="8080912">*</span><span class="ident" id="8080913">testing</span><span class="op" id="8080920">.</span><span class="ident" id="8080921">T</span><span class="op" id="8080922">)</span>&nbsp;<span class="op" id="8080924">{</span><br>
<span class="lineno"></span><span class="ident" id="8080926">testLoop</span><span class="op" id="8080934">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8080937">for</span>&nbsp;<span class="ident" id="8080941">i</span><span class="op" id="8080942">,</span>&nbsp;<span class="ident" id="8080944">test</span>&nbsp;<span class="op" id="8080949">:=</span>&nbsp;<span class="keyword" id="8080952">range</span>&nbsp;<span class="ident" id="8080958">writerTests</span>&nbsp;<span class="op" id="8080970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8080974">expected</span><span class="op" id="8080982">,</span>&nbsp;<span class="ident" id="8080984">err</span>&nbsp;<span class="op" id="8080988">:=</span>&nbsp;<span class="ident" id="8080991">ioutil</span><span class="op" id="8080997">.</span><span class="ident" id="8080998">ReadFile</span><span class="op" id="8081006">(</span><span class="ident" id="8081007">test</span><span class="op" id="8081011">.</span><span class="ident" id="8081012">file</span><span class="op" id="8081016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8081020">if</span>&nbsp;<span class="ident" id="8081023">err</span>&nbsp;<span class="op" id="8081027">!=</span>&nbsp;<span class="ident" id="8081030">nil</span>&nbsp;<span class="op" id="8081034">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8081039">t</span><span class="op" id="8081040">.</span><span class="ident" id="8081041">Errorf</span><span class="op" id="8081047">(</span><span class="string" id="8081048">&#34;test&nbsp;%d:&nbsp;Unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="8081079">,</span>&nbsp;<span class="ident" id="8081081">i</span><span class="op" id="8081082">,</span>&nbsp;<span class="ident" id="8081084">err</span><span class="op" id="8081087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8081092">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8081103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8081108">buf</span>&nbsp;<span class="op" id="8081112">:=</span>&nbsp;<span class="builtinfunc" id="8081115">new</span><span class="op" id="8081118">(</span><span class="ident" id="8081119">bytes</span><span class="op" id="8081124">.</span><span class="ident" id="8081125">Buffer</span><span class="op" id="8081131">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8081135">tw</span>&nbsp;<span class="op" id="8081138">:=</span>&nbsp;<span class="ident" id="8081141">NewWriter</span><span class="op" id="8081150">(</span><span class="ident" id="8081151">iotest</span><span class="op" id="8081157">.</span><span class="ident" id="8081158">TruncateWriter</span><span class="op" id="8081172">(</span><span class="ident" id="8081173">buf</span><span class="op" id="8081176">,</span>&nbsp;<span class="num" id="8081178">4</span><span class="op" id="8081179">&lt;&lt;</span><span class="num" id="8081181">10</span><span class="op" id="8081183">)</span><span class="op" id="8081184">)</span>&nbsp;<span class="comment" id="8081186">//&nbsp;only&nbsp;catch&nbsp;the&nbsp;first&nbsp;4&nbsp;KB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8081217">big</span>&nbsp;<span class="op" id="8081221">:=</span>&nbsp;<span class="builtintype" id="8081224">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8081232">for</span>&nbsp;<span class="ident" id="8081236">j</span><span class="op" id="8081237">,</span>&nbsp;<span class="ident" id="8081239">entry</span>&nbsp;<span class="op" id="8081245">:=</span>&nbsp;<span class="keyword" id="8081248">range</span>&nbsp;<span class="ident" id="8081254">test</span><span class="op" id="8081258">.</span><span class="ident" id="8081259">entries</span>&nbsp;<span class="op" id="8081267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8081272">big</span>&nbsp;<span class="op" id="8081276">=</span>&nbsp;<span class="ident" id="8081278">big</span>&nbsp;<span class="op" id="8081282">||</span>&nbsp;<span class="ident" id="8081285">entry</span><span class="op" id="8081290">.</span><span class="ident" id="8081291">header</span><span class="op" id="8081297">.</span><span class="ident" id="8081298">Size</span>&nbsp;<span class="op" id="8081303">&gt;</span>&nbsp;<span class="num" id="8081305">1</span><span class="op" id="8081306">&lt;&lt;</span><span class="num" id="8081308">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8081314">if</span>&nbsp;<span class="ident" id="8081317">err</span>&nbsp;<span class="op" id="8081321">:=</span>&nbsp;<span class="ident" id="8081324">tw</span><span class="op" id="8081326">.</span><span class="ident" id="8081327">WriteHeader</span><span class="op" id="8081338">(</span><span class="ident" id="8081339">entry</span><span class="op" id="8081344">.</span><span class="ident" id="8081345">header</span><span class="op" id="8081351">)</span><span class="op" id="8081352">;</span>&nbsp;<span class="ident" id="8081354">err</span>&nbsp;<span class="op" id="8081358">!=</span>&nbsp;<span class="ident" id="8081361">nil</span>&nbsp;<span class="op" id="8081365">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8081371">t</span><span class="op" id="8081372">.</span><span class="ident" id="8081373">Errorf</span><span class="op" id="8081379">(</span><span class="string" id="8081380">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="8081426">,</span>&nbsp;<span class="ident" id="8081428">i</span><span class="op" id="8081429">,</span>&nbsp;<span class="ident" id="8081431">j</span><span class="op" id="8081432">,</span>&nbsp;<span class="ident" id="8081434">err</span><span class="op" id="8081437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8081443">continue</span>&nbsp;<span class="ident" id="8081452">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8081464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8081469">if</span>&nbsp;<span class="ident" id="8081472">_</span><span class="op" id="8081473">,</span>&nbsp;<span class="ident" id="8081475">err</span>&nbsp;<span class="op" id="8081479">:=</span>&nbsp;<span class="ident" id="8081482">io</span><span class="op" id="8081484">.</span><span class="ident" id="8081485">WriteString</span><span class="op" id="8081496">(</span><span class="ident" id="8081497">tw</span><span class="op" id="8081499">,</span>&nbsp;<span class="ident" id="8081501">entry</span><span class="op" id="8081506">.</span><span class="ident" id="8081507">contents</span><span class="op" id="8081515">)</span><span class="op" id="8081516">;</span>&nbsp;<span class="ident" id="8081518">err</span>&nbsp;<span class="op" id="8081522">!=</span>&nbsp;<span class="ident" id="8081525">nil</span>&nbsp;<span class="op" id="8081529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8081535">t</span><span class="op" id="8081536">.</span><span class="ident" id="8081537">Errorf</span><span class="op" id="8081543">(</span><span class="string" id="8081544">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;contents:&nbsp;%v&#34;</span><span class="op" id="8081592">,</span>&nbsp;<span class="ident" id="8081594">i</span><span class="op" id="8081595">,</span>&nbsp;<span class="ident" id="8081597">j</span><span class="op" id="8081598">,</span>&nbsp;<span class="ident" id="8081600">err</span><span class="op" id="8081603">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8081609">continue</span>&nbsp;<span class="ident" id="8081618">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8081630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8081634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8081638">//&nbsp;Only&nbsp;interested&nbsp;in&nbsp;Close&nbsp;failures&nbsp;for&nbsp;the&nbsp;small&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8081698">if</span>&nbsp;<span class="ident" id="8081701">err</span>&nbsp;<span class="op" id="8081705">:=</span>&nbsp;<span class="ident" id="8081708">tw</span><span class="op" id="8081710">.</span><span class="ident" id="8081711">Close</span><span class="op" id="8081716">(</span><span class="op" id="8081717">)</span><span class="op" id="8081718">;</span>&nbsp;<span class="ident" id="8081720">err</span>&nbsp;<span class="op" id="8081724">!=</span>&nbsp;<span class="ident" id="8081727">nil</span>&nbsp;<span class="op" id="8081731">&amp;&amp;</span>&nbsp;<span class="op" id="8081734">!</span><span class="ident" id="8081735">big</span>&nbsp;<span class="op" id="8081739">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8081744">t</span><span class="op" id="8081745">.</span><span class="ident" id="8081746">Errorf</span><span class="op" id="8081752">(</span><span class="string" id="8081753">&#34;test&nbsp;%d:&nbsp;Failed&nbsp;closing&nbsp;archive:&nbsp;%v&#34;</span><span class="op" id="8081790">,</span>&nbsp;<span class="ident" id="8081792">i</span><span class="op" id="8081793">,</span>&nbsp;<span class="ident" id="8081795">err</span><span class="op" id="8081798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8081803">continue</span>&nbsp;<span class="ident" id="8081812">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8081823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8081828">actual</span>&nbsp;<span class="op" id="8081835">:=</span>&nbsp;<span class="ident" id="8081838">buf</span><span class="op" id="8081841">.</span><span class="ident" id="8081842">Bytes</span><span class="op" id="8081847">(</span><span class="op" id="8081848">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8081852">if</span>&nbsp;<span class="op" id="8081855">!</span><span class="ident" id="8081856">bytes</span><span class="op" id="8081861">.</span><span class="ident" id="8081862">Equal</span><span class="op" id="8081867">(</span><span class="ident" id="8081868">expected</span><span class="op" id="8081876">,</span>&nbsp;<span class="ident" id="8081878">actual</span><span class="op" id="8081884">)</span>&nbsp;<span class="op" id="8081886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8081891">t</span><span class="op" id="8081892">.</span><span class="ident" id="8081893">Errorf</span><span class="op" id="8081899">(</span><span class="string" id="8081900">&#34;test&nbsp;%d:&nbsp;Incorrect&nbsp;result:&nbsp;(-=expected,&nbsp;+=actual)\n%v&#34;</span><span class="op" id="8081955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8081961">i</span><span class="op" id="8081962">,</span>&nbsp;<span class="ident" id="8081964">bytediff</span><span class="op" id="8081972">(</span><span class="ident" id="8081973">expected</span><span class="op" id="8081981">,</span>&nbsp;<span class="ident" id="8081983">actual</span><span class="op" id="8081989">)</span><span class="op" id="8081990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8081994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8081998">if</span>&nbsp;<span class="ident" id="8082001">testing</span><span class="op" id="8082008">.</span><span class="ident" id="8082009">Short</span><span class="op" id="8082014">(</span><span class="op" id="8082015">)</span>&nbsp;<span class="op" id="8082017">{</span>&nbsp;<span class="comment" id="8082019">//&nbsp;The&nbsp;second&nbsp;test&nbsp;is&nbsp;expensive.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8082055">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8082063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8082066">}</span><br>
<span class="lineno"></span><span class="op" id="8082068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="8082071">func</span>&nbsp;<span class="ident" id="8082076">TestPax</span><span class="op" id="8082083">(</span><span class="ident" id="8082084">t</span>&nbsp;<span class="op" id="8082086">*</span><span class="ident" id="8082087">testing</span><span class="op" id="8082094">.</span><span class="ident" id="8082095">T</span><span class="op" id="8082096">)</span>&nbsp;<span class="op" id="8082098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8082101">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8082141">fileinfo</span><span class="op" id="8082149">,</span>&nbsp;<span class="ident" id="8082151">err</span>&nbsp;<span class="op" id="8082155">:=</span>&nbsp;<span class="ident" id="8082158">os</span><span class="op" id="8082160">.</span><span class="ident" id="8082161">Stat</span><span class="op" id="8082165">(</span><span class="string" id="8082166">&#34;testdata/small.txt&#34;</span><span class="op" id="8082186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8082189">if</span>&nbsp;<span class="ident" id="8082192">err</span>&nbsp;<span class="op" id="8082196">!=</span>&nbsp;<span class="ident" id="8082199">nil</span>&nbsp;<span class="op" id="8082203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8082207">t</span><span class="op" id="8082208">.</span><span class="ident" id="8082209">Fatal</span><span class="op" id="8082214">(</span><span class="ident" id="8082215">err</span><span class="op" id="8082218">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8082221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8082224">hdr</span><span class="op" id="8082227">,</span>&nbsp;<span class="ident" id="8082229">err</span>&nbsp;<span class="op" id="8082233">:=</span>&nbsp;<span class="ident" id="8082236">FileInfoHeader</span><span class="op" id="8082250">(</span><span class="ident" id="8082251">fileinfo</span><span class="op" id="8082259">,</span>&nbsp;<span class="string" id="8082261">&#34;&#34;</span><span class="op" id="8082263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8082266">if</span>&nbsp;<span class="ident" id="8082269">err</span>&nbsp;<span class="op" id="8082273">!=</span>&nbsp;<span class="ident" id="8082276">nil</span>&nbsp;<span class="op" id="8082280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8082284">t</span><span class="op" id="8082285">.</span><span class="ident" id="8082286">Fatalf</span><span class="op" id="8082292">(</span><span class="string" id="8082293">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="8082306">,</span>&nbsp;<span class="ident" id="8082308">err</span><span class="op" id="8082311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8082314">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8082317">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8082357">longName</span>&nbsp;<span class="op" id="8082366">:=</span>&nbsp;<span class="ident" id="8082369">strings</span><span class="op" id="8082376">.</span><span class="ident" id="8082377">Repeat</span><span class="op" id="8082383">(</span><span class="string" id="8082384">&#34;ab&#34;</span><span class="op" id="8082388">,</span>&nbsp;<span class="num" id="8082390">100</span><span class="op" id="8082393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8082396">contents</span>&nbsp;<span class="op" id="8082405">:=</span>&nbsp;<span class="ident" id="8082408">strings</span><span class="op" id="8082415">.</span><span class="ident" id="8082416">Repeat</span><span class="op" id="8082422">(</span><span class="string" id="8082423">&#34;&nbsp;&#34;</span><span class="op" id="8082426">,</span>&nbsp;<span class="builtintype" id="8082428">int</span><span class="op" id="8082431">(</span><span class="ident" id="8082432">hdr</span><span class="op" id="8082435">.</span><span class="ident" id="8082436">Size</span><span class="op" id="8082440">)</span><span class="op" id="8082441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8082444">hdr</span><span class="op" id="8082447">.</span><span class="ident" id="8082448">Name</span>&nbsp;<span class="op" id="8082453">=</span>&nbsp;<span class="ident" id="8082455">longName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8082465">var</span>&nbsp;<span class="ident" id="8082469">buf</span>&nbsp;<span class="ident" id="8082473">bytes</span><span class="op" id="8082478">.</span><span class="ident" id="8082479">Buffer</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8082487">writer</span>&nbsp;<span class="op" id="8082494">:=</span>&nbsp;<span class="ident" id="8082497">NewWriter</span><span class="op" id="8082506">(</span><span class="op" id="8082507">&amp;</span><span class="ident" id="8082508">buf</span><span class="op" id="8082511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8082514">if</span>&nbsp;<span class="ident" id="8082517">err</span>&nbsp;<span class="op" id="8082521">:=</span>&nbsp;<span class="ident" id="8082524">writer</span><span class="op" id="8082530">.</span><span class="ident" id="8082531">WriteHeader</span><span class="op" id="8082542">(</span><span class="ident" id="8082543">hdr</span><span class="op" id="8082546">)</span><span class="op" id="8082547">;</span>&nbsp;<span class="ident" id="8082549">err</span>&nbsp;<span class="op" id="8082553">!=</span>&nbsp;<span class="ident" id="8082556">nil</span>&nbsp;<span class="op" id="8082560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8082564">t</span><span class="op" id="8082565">.</span><span class="ident" id="8082566">Fatal</span><span class="op" id="8082571">(</span><span class="ident" id="8082572">err</span><span class="op" id="8082575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8082578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8082581">if</span>&nbsp;<span class="ident" id="8082584">_</span><span class="op" id="8082585">,</span>&nbsp;<span class="ident" id="8082587">err</span>&nbsp;<span class="op" id="8082591">=</span>&nbsp;<span class="ident" id="8082593">writer</span><span class="op" id="8082599">.</span><span class="ident" id="8082600">Write</span><span class="op" id="8082605">(</span><span class="op" id="8082606">[</span><span class="op" id="8082607">]</span><span class="builtintype" id="8082608">byte</span><span class="op" id="8082612">(</span><span class="ident" id="8082613">contents</span><span class="op" id="8082621">)</span><span class="op" id="8082622">)</span><span class="op" id="8082623">;</span>&nbsp;<span class="ident" id="8082625">err</span>&nbsp;<span class="op" id="8082629">!=</span>&nbsp;<span class="ident" id="8082632">nil</span>&nbsp;<span class="op" id="8082636">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8082640">t</span><span class="op" id="8082641">.</span><span class="ident" id="8082642">Fatal</span><span class="op" id="8082647">(</span><span class="ident" id="8082648">err</span><span class="op" id="8082651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8082654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8082657">if</span>&nbsp;<span class="ident" id="8082660">err</span>&nbsp;<span class="op" id="8082664">:=</span>&nbsp;<span class="ident" id="8082667">writer</span><span class="op" id="8082673">.</span><span class="ident" id="8082674">Close</span><span class="op" id="8082679">(</span><span class="op" id="8082680">)</span><span class="op" id="8082681">;</span>&nbsp;<span class="ident" id="8082683">err</span>&nbsp;<span class="op" id="8082687">!=</span>&nbsp;<span class="ident" id="8082690">nil</span>&nbsp;<span class="op" id="8082694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8082698">t</span><span class="op" id="8082699">.</span><span class="ident" id="8082700">Fatal</span><span class="op" id="8082705">(</span><span class="ident" id="8082706">err</span><span class="op" id="8082709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8082712">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8082715">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8082773">if</span>&nbsp;<span class="op" id="8082776">!</span><span class="ident" id="8082777">bytes</span><span class="op" id="8082782">.</span><span class="ident" id="8082783">Contains</span><span class="op" id="8082791">(</span><span class="ident" id="8082792">buf</span><span class="op" id="8082795">.</span><span class="ident" id="8082796">Bytes</span><span class="op" id="8082801">(</span><span class="op" id="8082802">)</span><span class="op" id="8082803">,</span>&nbsp;<span class="op" id="8082805">[</span><span class="op" id="8082806">]</span><span class="builtintype" id="8082807">byte</span><span class="op" id="8082811">(</span><span class="string" id="8082812">&#34;PaxHeaders.&#34;</span><span class="op" id="8082825">)</span><span class="op" id="8082826">)</span>&nbsp;<span class="op" id="8082828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8082832">t</span><span class="op" id="8082833">.</span><span class="ident" id="8082834">Fatal</span><span class="op" id="8082839">(</span><span class="string" id="8082840">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="8082889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8082892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8082895">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8082957">reader</span>&nbsp;<span class="op" id="8082964">:=</span>&nbsp;<span class="ident" id="8082967">NewReader</span><span class="op" id="8082976">(</span><span class="op" id="8082977">&amp;</span><span class="ident" id="8082978">buf</span><span class="op" id="8082981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8082984">hdr</span><span class="op" id="8082987">,</span>&nbsp;<span class="ident" id="8082989">err</span>&nbsp;<span class="op" id="8082993">=</span>&nbsp;<span class="ident" id="8082995">reader</span><span class="op" id="8083001">.</span><span class="ident" id="8083002">Next</span><span class="op" id="8083006">(</span><span class="op" id="8083007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8083010">if</span>&nbsp;<span class="ident" id="8083013">err</span>&nbsp;<span class="op" id="8083017">!=</span>&nbsp;<span class="ident" id="8083020">nil</span>&nbsp;<span class="op" id="8083024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8083028">t</span><span class="op" id="8083029">.</span><span class="ident" id="8083030">Fatal</span><span class="op" id="8083035">(</span><span class="ident" id="8083036">err</span><span class="op" id="8083039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8083042">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8083045">if</span>&nbsp;<span class="ident" id="8083048">hdr</span><span class="op" id="8083051">.</span><span class="ident" id="8083052">Name</span>&nbsp;<span class="op" id="8083057">!=</span>&nbsp;<span class="ident" id="8083060">longName</span>&nbsp;<span class="op" id="8083069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8083073">t</span><span class="op" id="8083074">.</span><span class="ident" id="8083075">Fatal</span><span class="op" id="8083080">(</span><span class="string" id="8083081">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;file&nbsp;name&#34;</span><span class="op" id="8083114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8083117">}</span><br>
<span class="lineno"></span><span class="op" id="8083119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="8083122">func</span>&nbsp;<span class="ident" id="8083127">TestPaxSymlink</span><span class="op" id="8083141">(</span><span class="ident" id="8083142">t</span>&nbsp;<span class="op" id="8083144">*</span><span class="ident" id="8083145">testing</span><span class="op" id="8083152">.</span><span class="ident" id="8083153">T</span><span class="op" id="8083154">)</span>&nbsp;<span class="op" id="8083156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8083159">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;linkname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8083203">fileinfo</span><span class="op" id="8083211">,</span>&nbsp;<span class="ident" id="8083213">err</span>&nbsp;<span class="op" id="8083217">:=</span>&nbsp;<span class="ident" id="8083220">os</span><span class="op" id="8083222">.</span><span class="ident" id="8083223">Stat</span><span class="op" id="8083227">(</span><span class="string" id="8083228">&#34;testdata/small.txt&#34;</span><span class="op" id="8083248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8083251">if</span>&nbsp;<span class="ident" id="8083254">err</span>&nbsp;<span class="op" id="8083258">!=</span>&nbsp;<span class="ident" id="8083261">nil</span>&nbsp;<span class="op" id="8083265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8083269">t</span><span class="op" id="8083270">.</span><span class="ident" id="8083271">Fatal</span><span class="op" id="8083276">(</span><span class="ident" id="8083277">err</span><span class="op" id="8083280">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8083283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8083286">hdr</span><span class="op" id="8083289">,</span>&nbsp;<span class="ident" id="8083291">err</span>&nbsp;<span class="op" id="8083295">:=</span>&nbsp;<span class="ident" id="8083298">FileInfoHeader</span><span class="op" id="8083312">(</span><span class="ident" id="8083313">fileinfo</span><span class="op" id="8083321">,</span>&nbsp;<span class="string" id="8083323">&#34;&#34;</span><span class="op" id="8083325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8083328">hdr</span><span class="op" id="8083331">.</span><span class="ident" id="8083332">Typeflag</span>&nbsp;<span class="op" id="8083341">=</span>&nbsp;<span class="ident" id="8083343">TypeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8083356">if</span>&nbsp;<span class="ident" id="8083359">err</span>&nbsp;<span class="op" id="8083363">!=</span>&nbsp;<span class="ident" id="8083366">nil</span>&nbsp;<span class="op" id="8083370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8083374">t</span><span class="op" id="8083375">.</span><span class="ident" id="8083376">Fatalf</span><span class="op" id="8083382">(</span><span class="string" id="8083383">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="8083397">,</span>&nbsp;<span class="ident" id="8083399">err</span><span class="op" id="8083402">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8083405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8083408">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;linkname&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8083452">longLinkname</span>&nbsp;<span class="op" id="8083465">:=</span>&nbsp;<span class="ident" id="8083468">strings</span><span class="op" id="8083475">.</span><span class="ident" id="8083476">Repeat</span><span class="op" id="8083482">(</span><span class="string" id="8083483">&#34;1234567890/1234567890&#34;</span><span class="op" id="8083506">,</span>&nbsp;<span class="num" id="8083508">10</span><span class="op" id="8083510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8083513">hdr</span><span class="op" id="8083516">.</span><span class="ident" id="8083517">Linkname</span>&nbsp;<span class="op" id="8083526">=</span>&nbsp;<span class="ident" id="8083528">longLinkname</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8083543">hdr</span><span class="op" id="8083546">.</span><span class="ident" id="8083547">Size</span>&nbsp;<span class="op" id="8083552">=</span>&nbsp;<span class="num" id="8083554">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8083557">var</span>&nbsp;<span class="ident" id="8083561">buf</span>&nbsp;<span class="ident" id="8083565">bytes</span><span class="op" id="8083570">.</span><span class="ident" id="8083571">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8083579">writer</span>&nbsp;<span class="op" id="8083586">:=</span>&nbsp;<span class="ident" id="8083589">NewWriter</span><span class="op" id="8083598">(</span><span class="op" id="8083599">&amp;</span><span class="ident" id="8083600">buf</span><span class="op" id="8083603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8083606">if</span>&nbsp;<span class="ident" id="8083609">err</span>&nbsp;<span class="op" id="8083613">:=</span>&nbsp;<span class="ident" id="8083616">writer</span><span class="op" id="8083622">.</span><span class="ident" id="8083623">WriteHeader</span><span class="op" id="8083634">(</span><span class="ident" id="8083635">hdr</span><span class="op" id="8083638">)</span><span class="op" id="8083639">;</span>&nbsp;<span class="ident" id="8083641">err</span>&nbsp;<span class="op" id="8083645">!=</span>&nbsp;<span class="ident" id="8083648">nil</span>&nbsp;<span class="op" id="8083652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8083656">t</span><span class="op" id="8083657">.</span><span class="ident" id="8083658">Fatal</span><span class="op" id="8083663">(</span><span class="ident" id="8083664">err</span><span class="op" id="8083667">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8083670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8083673">if</span>&nbsp;<span class="ident" id="8083676">err</span>&nbsp;<span class="op" id="8083680">:=</span>&nbsp;<span class="ident" id="8083683">writer</span><span class="op" id="8083689">.</span><span class="ident" id="8083690">Close</span><span class="op" id="8083695">(</span><span class="op" id="8083696">)</span><span class="op" id="8083697">;</span>&nbsp;<span class="ident" id="8083699">err</span>&nbsp;<span class="op" id="8083703">!=</span>&nbsp;<span class="ident" id="8083706">nil</span>&nbsp;<span class="op" id="8083710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8083714">t</span><span class="op" id="8083715">.</span><span class="ident" id="8083716">Fatal</span><span class="op" id="8083721">(</span><span class="ident" id="8083722">err</span><span class="op" id="8083725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8083728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8083731">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8083789">if</span>&nbsp;<span class="op" id="8083792">!</span><span class="ident" id="8083793">bytes</span><span class="op" id="8083798">.</span><span class="ident" id="8083799">Contains</span><span class="op" id="8083807">(</span><span class="ident" id="8083808">buf</span><span class="op" id="8083811">.</span><span class="ident" id="8083812">Bytes</span><span class="op" id="8083817">(</span><span class="op" id="8083818">)</span><span class="op" id="8083819">,</span>&nbsp;<span class="op" id="8083821">[</span><span class="op" id="8083822">]</span><span class="builtintype" id="8083823">byte</span><span class="op" id="8083827">(</span><span class="string" id="8083828">&#34;PaxHeaders.&#34;</span><span class="op" id="8083841">)</span><span class="op" id="8083842">)</span>&nbsp;<span class="op" id="8083844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8083848">t</span><span class="op" id="8083849">.</span><span class="ident" id="8083850">Fatal</span><span class="op" id="8083855">(</span><span class="string" id="8083856">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="8083905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8083908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8083911">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8083973">reader</span>&nbsp;<span class="op" id="8083980">:=</span>&nbsp;<span class="ident" id="8083983">NewReader</span><span class="op" id="8083992">(</span><span class="op" id="8083993">&amp;</span><span class="ident" id="8083994">buf</span><span class="op" id="8083997">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084000">hdr</span><span class="op" id="8084003">,</span>&nbsp;<span class="ident" id="8084005">err</span>&nbsp;<span class="op" id="8084009">=</span>&nbsp;<span class="ident" id="8084011">reader</span><span class="op" id="8084017">.</span><span class="ident" id="8084018">Next</span><span class="op" id="8084022">(</span><span class="op" id="8084023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8084026">if</span>&nbsp;<span class="ident" id="8084029">err</span>&nbsp;<span class="op" id="8084033">!=</span>&nbsp;<span class="ident" id="8084036">nil</span>&nbsp;<span class="op" id="8084040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084044">t</span><span class="op" id="8084045">.</span><span class="ident" id="8084046">Fatal</span><span class="op" id="8084051">(</span><span class="ident" id="8084052">err</span><span class="op" id="8084055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8084058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8084061">if</span>&nbsp;<span class="ident" id="8084064">hdr</span><span class="op" id="8084067">.</span><span class="ident" id="8084068">Linkname</span>&nbsp;<span class="op" id="8084077">!=</span>&nbsp;<span class="ident" id="8084080">longLinkname</span>&nbsp;<span class="op" id="8084093">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084097">t</span><span class="op" id="8084098">.</span><span class="ident" id="8084099">Fatal</span><span class="op" id="8084104">(</span><span class="string" id="8084105">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;link&nbsp;name&#34;</span><span class="op" id="8084138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8084141">}</span><br>
<span class="lineno"></span><span class="op" id="8084143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8084146">func</span>&nbsp;<span class="ident" id="8084151">TestPaxNonAscii</span><span class="op" id="8084166">(</span><span class="ident" id="8084167">t</span>&nbsp;<span class="op" id="8084169">*</span><span class="ident" id="8084170">testing</span><span class="op" id="8084177">.</span><span class="ident" id="8084178">T</span><span class="op" id="8084179">)</span>&nbsp;<span class="op" id="8084181">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8084184">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;non&nbsp;ascii.&nbsp;These&nbsp;should&nbsp;trigger&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8084256">//&nbsp;because&nbsp;pax&nbsp;headers&nbsp;have&nbsp;a&nbsp;defined&nbsp;utf-8&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084311">fileinfo</span><span class="op" id="8084319">,</span>&nbsp;<span class="ident" id="8084321">err</span>&nbsp;<span class="op" id="8084325">:=</span>&nbsp;<span class="ident" id="8084328">os</span><span class="op" id="8084330">.</span><span class="ident" id="8084331">Stat</span><span class="op" id="8084335">(</span><span class="string" id="8084336">&#34;testdata/small.txt&#34;</span><span class="op" id="8084356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8084359">if</span>&nbsp;<span class="ident" id="8084362">err</span>&nbsp;<span class="op" id="8084366">!=</span>&nbsp;<span class="ident" id="8084369">nil</span>&nbsp;<span class="op" id="8084373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084377">t</span><span class="op" id="8084378">.</span><span class="ident" id="8084379">Fatal</span><span class="op" id="8084384">(</span><span class="ident" id="8084385">err</span><span class="op" id="8084388">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8084391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084395">hdr</span><span class="op" id="8084398">,</span>&nbsp;<span class="ident" id="8084400">err</span>&nbsp;<span class="op" id="8084404">:=</span>&nbsp;<span class="ident" id="8084407">FileInfoHeader</span><span class="op" id="8084421">(</span><span class="ident" id="8084422">fileinfo</span><span class="op" id="8084430">,</span>&nbsp;<span class="string" id="8084432">&#34;&#34;</span><span class="op" id="8084434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8084437">if</span>&nbsp;<span class="ident" id="8084440">err</span>&nbsp;<span class="op" id="8084444">!=</span>&nbsp;<span class="ident" id="8084447">nil</span>&nbsp;<span class="op" id="8084451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084455">t</span><span class="op" id="8084456">.</span><span class="ident" id="8084457">Fatalf</span><span class="op" id="8084463">(</span><span class="string" id="8084464">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="8084478">,</span>&nbsp;<span class="ident" id="8084480">err</span><span class="op" id="8084483">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8084486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8084490">//&nbsp;some&nbsp;sample&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084511">chineseFilename</span>&nbsp;<span class="op" id="8084527">:=</span>&nbsp;<span class="string" id="8084530">&#34;文件名&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084543">chineseGroupname</span>&nbsp;<span class="op" id="8084560">:=</span>&nbsp;<span class="string" id="8084563">&#34;組&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084570">chineseUsername</span>&nbsp;<span class="op" id="8084586">:=</span>&nbsp;<span class="string" id="8084589">&#34;用戶名&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084603">hdr</span><span class="op" id="8084606">.</span><span class="ident" id="8084607">Name</span>&nbsp;<span class="op" id="8084612">=</span>&nbsp;<span class="ident" id="8084614">chineseFilename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084631">hdr</span><span class="op" id="8084634">.</span><span class="ident" id="8084635">Gname</span>&nbsp;<span class="op" id="8084641">=</span>&nbsp;<span class="ident" id="8084643">chineseGroupname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084661">hdr</span><span class="op" id="8084664">.</span><span class="ident" id="8084665">Uname</span>&nbsp;<span class="op" id="8084671">=</span>&nbsp;<span class="ident" id="8084673">chineseUsername</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084691">contents</span>&nbsp;<span class="op" id="8084700">:=</span>&nbsp;<span class="ident" id="8084703">strings</span><span class="op" id="8084710">.</span><span class="ident" id="8084711">Repeat</span><span class="op" id="8084717">(</span><span class="string" id="8084718">&#34;&nbsp;&#34;</span><span class="op" id="8084721">,</span>&nbsp;<span class="builtintype" id="8084723">int</span><span class="op" id="8084726">(</span><span class="ident" id="8084727">hdr</span><span class="op" id="8084730">.</span><span class="ident" id="8084731">Size</span><span class="op" id="8084735">)</span><span class="op" id="8084736">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8084740">var</span>&nbsp;<span class="ident" id="8084744">buf</span>&nbsp;<span class="ident" id="8084748">bytes</span><span class="op" id="8084753">.</span><span class="ident" id="8084754">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084762">writer</span>&nbsp;<span class="op" id="8084769">:=</span>&nbsp;<span class="ident" id="8084772">NewWriter</span><span class="op" id="8084781">(</span><span class="op" id="8084782">&amp;</span><span class="ident" id="8084783">buf</span><span class="op" id="8084786">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8084789">if</span>&nbsp;<span class="ident" id="8084792">err</span>&nbsp;<span class="op" id="8084796">:=</span>&nbsp;<span class="ident" id="8084799">writer</span><span class="op" id="8084805">.</span><span class="ident" id="8084806">WriteHeader</span><span class="op" id="8084817">(</span><span class="ident" id="8084818">hdr</span><span class="op" id="8084821">)</span><span class="op" id="8084822">;</span>&nbsp;<span class="ident" id="8084824">err</span>&nbsp;<span class="op" id="8084828">!=</span>&nbsp;<span class="ident" id="8084831">nil</span>&nbsp;<span class="op" id="8084835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084839">t</span><span class="op" id="8084840">.</span><span class="ident" id="8084841">Fatal</span><span class="op" id="8084846">(</span><span class="ident" id="8084847">err</span><span class="op" id="8084850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8084853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8084856">if</span>&nbsp;<span class="ident" id="8084859">_</span><span class="op" id="8084860">,</span>&nbsp;<span class="ident" id="8084862">err</span>&nbsp;<span class="op" id="8084866">=</span>&nbsp;<span class="ident" id="8084868">writer</span><span class="op" id="8084874">.</span><span class="ident" id="8084875">Write</span><span class="op" id="8084880">(</span><span class="op" id="8084881">[</span><span class="op" id="8084882">]</span><span class="builtintype" id="8084883">byte</span><span class="op" id="8084887">(</span><span class="ident" id="8084888">contents</span><span class="op" id="8084896">)</span><span class="op" id="8084897">)</span><span class="op" id="8084898">;</span>&nbsp;<span class="ident" id="8084900">err</span>&nbsp;<span class="op" id="8084904">!=</span>&nbsp;<span class="ident" id="8084907">nil</span>&nbsp;<span class="op" id="8084911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084915">t</span><span class="op" id="8084916">.</span><span class="ident" id="8084917">Fatal</span><span class="op" id="8084922">(</span><span class="ident" id="8084923">err</span><span class="op" id="8084926">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8084929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8084932">if</span>&nbsp;<span class="ident" id="8084935">err</span>&nbsp;<span class="op" id="8084939">:=</span>&nbsp;<span class="ident" id="8084942">writer</span><span class="op" id="8084948">.</span><span class="ident" id="8084949">Close</span><span class="op" id="8084954">(</span><span class="op" id="8084955">)</span><span class="op" id="8084956">;</span>&nbsp;<span class="ident" id="8084958">err</span>&nbsp;<span class="op" id="8084962">!=</span>&nbsp;<span class="ident" id="8084965">nil</span>&nbsp;<span class="op" id="8084969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8084973">t</span><span class="op" id="8084974">.</span><span class="ident" id="8084975">Fatal</span><span class="op" id="8084980">(</span><span class="ident" id="8084981">err</span><span class="op" id="8084984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8084987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8084990">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8085048">if</span>&nbsp;<span class="op" id="8085051">!</span><span class="ident" id="8085052">bytes</span><span class="op" id="8085057">.</span><span class="ident" id="8085058">Contains</span><span class="op" id="8085066">(</span><span class="ident" id="8085067">buf</span><span class="op" id="8085070">.</span><span class="ident" id="8085071">Bytes</span><span class="op" id="8085076">(</span><span class="op" id="8085077">)</span><span class="op" id="8085078">,</span>&nbsp;<span class="op" id="8085080">[</span><span class="op" id="8085081">]</span><span class="builtintype" id="8085082">byte</span><span class="op" id="8085086">(</span><span class="string" id="8085087">&#34;PaxHeaders.&#34;</span><span class="op" id="8085100">)</span><span class="op" id="8085101">)</span>&nbsp;<span class="op" id="8085103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085107">t</span><span class="op" id="8085108">.</span><span class="ident" id="8085109">Fatal</span><span class="op" id="8085114">(</span><span class="string" id="8085115">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="8085164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8085167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8085170">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085232">reader</span>&nbsp;<span class="op" id="8085239">:=</span>&nbsp;<span class="ident" id="8085242">NewReader</span><span class="op" id="8085251">(</span><span class="op" id="8085252">&amp;</span><span class="ident" id="8085253">buf</span><span class="op" id="8085256">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085259">hdr</span><span class="op" id="8085262">,</span>&nbsp;<span class="ident" id="8085264">err</span>&nbsp;<span class="op" id="8085268">=</span>&nbsp;<span class="ident" id="8085270">reader</span><span class="op" id="8085276">.</span><span class="ident" id="8085277">Next</span><span class="op" id="8085281">(</span><span class="op" id="8085282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8085285">if</span>&nbsp;<span class="ident" id="8085288">err</span>&nbsp;<span class="op" id="8085292">!=</span>&nbsp;<span class="ident" id="8085295">nil</span>&nbsp;<span class="op" id="8085299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085303">t</span><span class="op" id="8085304">.</span><span class="ident" id="8085305">Fatal</span><span class="op" id="8085310">(</span><span class="ident" id="8085311">err</span><span class="op" id="8085314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8085317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8085320">if</span>&nbsp;<span class="ident" id="8085323">hdr</span><span class="op" id="8085326">.</span><span class="ident" id="8085327">Name</span>&nbsp;<span class="op" id="8085332">!=</span>&nbsp;<span class="ident" id="8085335">chineseFilename</span>&nbsp;<span class="op" id="8085351">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085355">t</span><span class="op" id="8085356">.</span><span class="ident" id="8085357">Fatal</span><span class="op" id="8085362">(</span><span class="string" id="8085363">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;name&#34;</span><span class="op" id="8085394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8085397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8085400">if</span>&nbsp;<span class="ident" id="8085403">hdr</span><span class="op" id="8085406">.</span><span class="ident" id="8085407">Gname</span>&nbsp;<span class="op" id="8085413">!=</span>&nbsp;<span class="ident" id="8085416">chineseGroupname</span>&nbsp;<span class="op" id="8085433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085437">t</span><span class="op" id="8085438">.</span><span class="ident" id="8085439">Fatal</span><span class="op" id="8085444">(</span><span class="string" id="8085445">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;group&#34;</span><span class="op" id="8085477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8085480">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8085483">if</span>&nbsp;<span class="ident" id="8085486">hdr</span><span class="op" id="8085489">.</span><span class="ident" id="8085490">Uname</span>&nbsp;<span class="op" id="8085496">!=</span>&nbsp;<span class="ident" id="8085499">chineseUsername</span>&nbsp;<span class="op" id="8085515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085519">t</span><span class="op" id="8085520">.</span><span class="ident" id="8085521">Fatal</span><span class="op" id="8085526">(</span><span class="string" id="8085527">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;user&#34;</span><span class="op" id="8085558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8085561">}</span><br>
<span class="lineno"></span><span class="op" id="8085563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="8085566">func</span>&nbsp;<span class="ident" id="8085571">TestPaxXattrs</span><span class="op" id="8085584">(</span><span class="ident" id="8085585">t</span>&nbsp;<span class="op" id="8085587">*</span><span class="ident" id="8085588">testing</span><span class="op" id="8085595">.</span><span class="ident" id="8085596">T</span><span class="op" id="8085597">)</span>&nbsp;<span class="op" id="8085599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085602">xattrs</span>&nbsp;<span class="op" id="8085609">:=</span>&nbsp;<span class="keyword" id="8085612">map</span><span class="op" id="8085615">[</span><span class="builtintype" id="8085616">string</span><span class="op" id="8085622">]</span><span class="builtintype" id="8085623">string</span><span class="op" id="8085629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8085633">&#34;user.key&#34;</span><span class="op" id="8085643">:</span>&nbsp;<span class="string" id="8085645">&#34;value&#34;</span><span class="op" id="8085652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8085655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8085659">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;an&nbsp;xattr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085695">fileinfo</span><span class="op" id="8085703">,</span>&nbsp;<span class="ident" id="8085705">err</span>&nbsp;<span class="op" id="8085709">:=</span>&nbsp;<span class="ident" id="8085712">os</span><span class="op" id="8085714">.</span><span class="ident" id="8085715">Stat</span><span class="op" id="8085719">(</span><span class="string" id="8085720">&#34;testdata/small.txt&#34;</span><span class="op" id="8085740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8085743">if</span>&nbsp;<span class="ident" id="8085746">err</span>&nbsp;<span class="op" id="8085750">!=</span>&nbsp;<span class="ident" id="8085753">nil</span>&nbsp;<span class="op" id="8085757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085761">t</span><span class="op" id="8085762">.</span><span class="ident" id="8085763">Fatal</span><span class="op" id="8085768">(</span><span class="ident" id="8085769">err</span><span class="op" id="8085772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8085775">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085778">hdr</span><span class="op" id="8085781">,</span>&nbsp;<span class="ident" id="8085783">err</span>&nbsp;<span class="op" id="8085787">:=</span>&nbsp;<span class="ident" id="8085790">FileInfoHeader</span><span class="op" id="8085804">(</span><span class="ident" id="8085805">fileinfo</span><span class="op" id="8085813">,</span>&nbsp;<span class="string" id="8085815">&#34;&#34;</span><span class="op" id="8085817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8085820">if</span>&nbsp;<span class="ident" id="8085823">err</span>&nbsp;<span class="op" id="8085827">!=</span>&nbsp;<span class="ident" id="8085830">nil</span>&nbsp;<span class="op" id="8085834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085838">t</span><span class="op" id="8085839">.</span><span class="ident" id="8085840">Fatalf</span><span class="op" id="8085846">(</span><span class="string" id="8085847">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="8085860">,</span>&nbsp;<span class="ident" id="8085862">err</span><span class="op" id="8085865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8085868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085871">contents</span>&nbsp;<span class="op" id="8085880">:=</span>&nbsp;<span class="string" id="8085883">&#34;Kilts&#34;</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085892">hdr</span><span class="op" id="8085895">.</span><span class="ident" id="8085896">Xattrs</span>&nbsp;<span class="op" id="8085903">=</span>&nbsp;<span class="ident" id="8085905">xattrs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8085913">var</span>&nbsp;<span class="ident" id="8085917">buf</span>&nbsp;<span class="ident" id="8085921">bytes</span><span class="op" id="8085926">.</span><span class="ident" id="8085927">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8085935">writer</span>&nbsp;<span class="op" id="8085942">:=</span>&nbsp;<span class="ident" id="8085945">NewWriter</span><span class="op" id="8085954">(</span><span class="op" id="8085955">&amp;</span><span class="ident" id="8085956">buf</span><span class="op" id="8085959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8085962">if</span>&nbsp;<span class="ident" id="8085965">err</span>&nbsp;<span class="op" id="8085969">:=</span>&nbsp;<span class="ident" id="8085972">writer</span><span class="op" id="8085978">.</span><span class="ident" id="8085979">WriteHeader</span><span class="op" id="8085990">(</span><span class="ident" id="8085991">hdr</span><span class="op" id="8085994">)</span><span class="op" id="8085995">;</span>&nbsp;<span class="ident" id="8085997">err</span>&nbsp;<span class="op" id="8086001">!=</span>&nbsp;<span class="ident" id="8086004">nil</span>&nbsp;<span class="op" id="8086008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086012">t</span><span class="op" id="8086013">.</span><span class="ident" id="8086014">Fatal</span><span class="op" id="8086019">(</span><span class="ident" id="8086020">err</span><span class="op" id="8086023">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8086026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8086029">if</span>&nbsp;<span class="ident" id="8086032">_</span><span class="op" id="8086033">,</span>&nbsp;<span class="ident" id="8086035">err</span>&nbsp;<span class="op" id="8086039">=</span>&nbsp;<span class="ident" id="8086041">writer</span><span class="op" id="8086047">.</span><span class="ident" id="8086048">Write</span><span class="op" id="8086053">(</span><span class="op" id="8086054">[</span><span class="op" id="8086055">]</span><span class="builtintype" id="8086056">byte</span><span class="op" id="8086060">(</span><span class="ident" id="8086061">contents</span><span class="op" id="8086069">)</span><span class="op" id="8086070">)</span><span class="op" id="8086071">;</span>&nbsp;<span class="ident" id="8086073">err</span>&nbsp;<span class="op" id="8086077">!=</span>&nbsp;<span class="ident" id="8086080">nil</span>&nbsp;<span class="op" id="8086084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086088">t</span><span class="op" id="8086089">.</span><span class="ident" id="8086090">Fatal</span><span class="op" id="8086095">(</span><span class="ident" id="8086096">err</span><span class="op" id="8086099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8086102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8086105">if</span>&nbsp;<span class="ident" id="8086108">err</span>&nbsp;<span class="op" id="8086112">:=</span>&nbsp;<span class="ident" id="8086115">writer</span><span class="op" id="8086121">.</span><span class="ident" id="8086122">Close</span><span class="op" id="8086127">(</span><span class="op" id="8086128">)</span><span class="op" id="8086129">;</span>&nbsp;<span class="ident" id="8086131">err</span>&nbsp;<span class="op" id="8086135">!=</span>&nbsp;<span class="ident" id="8086138">nil</span>&nbsp;<span class="op" id="8086142">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086146">t</span><span class="op" id="8086147">.</span><span class="ident" id="8086148">Fatal</span><span class="op" id="8086153">(</span><span class="ident" id="8086154">err</span><span class="op" id="8086157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8086160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8086163">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;the&nbsp;xattrs&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086224">reader</span>&nbsp;<span class="op" id="8086231">:=</span>&nbsp;<span class="ident" id="8086234">NewReader</span><span class="op" id="8086243">(</span><span class="op" id="8086244">&amp;</span><span class="ident" id="8086245">buf</span><span class="op" id="8086248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086251">hdr</span><span class="op" id="8086254">,</span>&nbsp;<span class="ident" id="8086256">err</span>&nbsp;<span class="op" id="8086260">=</span>&nbsp;<span class="ident" id="8086262">reader</span><span class="op" id="8086268">.</span><span class="ident" id="8086269">Next</span><span class="op" id="8086273">(</span><span class="op" id="8086274">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8086277">if</span>&nbsp;<span class="ident" id="8086280">err</span>&nbsp;<span class="op" id="8086284">!=</span>&nbsp;<span class="ident" id="8086287">nil</span>&nbsp;<span class="op" id="8086291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086295">t</span><span class="op" id="8086296">.</span><span class="ident" id="8086297">Fatal</span><span class="op" id="8086302">(</span><span class="ident" id="8086303">err</span><span class="op" id="8086306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8086309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8086312">if</span>&nbsp;<span class="op" id="8086315">!</span><span class="ident" id="8086316">reflect</span><span class="op" id="8086323">.</span><span class="ident" id="8086324">DeepEqual</span><span class="op" id="8086333">(</span><span class="ident" id="8086334">hdr</span><span class="op" id="8086337">.</span><span class="ident" id="8086338">Xattrs</span><span class="op" id="8086344">,</span>&nbsp;<span class="ident" id="8086346">xattrs</span><span class="op" id="8086352">)</span>&nbsp;<span class="op" id="8086354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086358">t</span><span class="op" id="8086359">.</span><span class="ident" id="8086360">Fatalf</span><span class="op" id="8086366">(</span><span class="string" id="8086367">&#34;xattrs&nbsp;did&nbsp;not&nbsp;survive&nbsp;round&nbsp;trip:&nbsp;got&nbsp;%+v,&nbsp;want&nbsp;%+v&#34;</span><span class="op" id="8086421">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086426">hdr</span><span class="op" id="8086429">.</span><span class="ident" id="8086430">Xattrs</span><span class="op" id="8086436">,</span>&nbsp;<span class="ident" id="8086438">xattrs</span><span class="op" id="8086444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8086447">}</span><br>
<span class="lineno"></span><span class="op" id="8086449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8086452">func</span>&nbsp;<span class="ident" id="8086457">TestPAXHeader</span><span class="op" id="8086470">(</span><span class="ident" id="8086471">t</span>&nbsp;<span class="op" id="8086473">*</span><span class="ident" id="8086474">testing</span><span class="op" id="8086481">.</span><span class="ident" id="8086482">T</span><span class="op" id="8086483">)</span>&nbsp;<span class="op" id="8086485">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086488">medName</span>&nbsp;<span class="op" id="8086496">:=</span>&nbsp;<span class="ident" id="8086499">strings</span><span class="op" id="8086506">.</span><span class="ident" id="8086507">Repeat</span><span class="op" id="8086513">(</span><span class="string" id="8086514">&#34;CD&#34;</span><span class="op" id="8086518">,</span>&nbsp;<span class="num" id="8086520">50</span><span class="op" id="8086522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086525">longName</span>&nbsp;<span class="op" id="8086534">:=</span>&nbsp;<span class="ident" id="8086537">strings</span><span class="op" id="8086544">.</span><span class="ident" id="8086545">Repeat</span><span class="op" id="8086551">(</span><span class="string" id="8086552">&#34;AB&#34;</span><span class="op" id="8086556">,</span>&nbsp;<span class="num" id="8086558">100</span><span class="op" id="8086561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086564">paxTests</span>&nbsp;<span class="op" id="8086573">:=</span>&nbsp;<span class="op" id="8086576">[</span><span class="op" id="8086577">]</span><span class="op" id="8086578">[</span><span class="num" id="8086579">2</span><span class="op" id="8086580">]</span><span class="builtintype" id="8086581">string</span><span class="op" id="8086587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8086591">{</span><span class="ident" id="8086592">paxPath</span>&nbsp;<span class="op" id="8086600">+</span>&nbsp;<span class="string" id="8086602">&#34;=/etc/hosts&#34;</span><span class="op" id="8086615">,</span>&nbsp;<span class="string" id="8086617">&#34;19&nbsp;path=/etc/hosts\n&#34;</span><span class="op" id="8086639">}</span><span class="op" id="8086640">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8086644">{</span><span class="string" id="8086645">&#34;a=b&#34;</span><span class="op" id="8086650">,</span>&nbsp;<span class="string" id="8086652">&#34;6&nbsp;a=b\n&#34;</span><span class="op" id="8086661">}</span><span class="op" id="8086662">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8086673">//&nbsp;Single&nbsp;digit&nbsp;length</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8086698">{</span><span class="string" id="8086699">&#34;a=names&#34;</span><span class="op" id="8086708">,</span>&nbsp;<span class="string" id="8086710">&#34;11&nbsp;a=names\n&#34;</span><span class="op" id="8086724">}</span><span class="op" id="8086725">,</span>&nbsp;<span class="comment" id="8086727">//&nbsp;Test&nbsp;case&nbsp;involving&nbsp;carries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8086760">{</span><span class="ident" id="8086761">paxPath</span>&nbsp;<span class="op" id="8086769">+</span>&nbsp;<span class="string" id="8086771">&#34;=&#34;</span>&nbsp;<span class="op" id="8086775">+</span>&nbsp;<span class="ident" id="8086777">longName</span><span class="op" id="8086785">,</span>&nbsp;<span class="ident" id="8086787">fmt</span><span class="op" id="8086790">.</span><span class="ident" id="8086791">Sprintf</span><span class="op" id="8086798">(</span><span class="string" id="8086799">&#34;210&nbsp;path=%s\n&#34;</span><span class="op" id="8086814">,</span>&nbsp;<span class="ident" id="8086816">longName</span><span class="op" id="8086824">)</span><span class="op" id="8086825">}</span><span class="op" id="8086826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8086830">{</span><span class="ident" id="8086831">paxPath</span>&nbsp;<span class="op" id="8086839">+</span>&nbsp;<span class="string" id="8086841">&#34;=&#34;</span>&nbsp;<span class="op" id="8086845">+</span>&nbsp;<span class="ident" id="8086847">medName</span><span class="op" id="8086854">,</span>&nbsp;<span class="ident" id="8086856">fmt</span><span class="op" id="8086859">.</span><span class="ident" id="8086860">Sprintf</span><span class="op" id="8086867">(</span><span class="string" id="8086868">&#34;110&nbsp;path=%s\n&#34;</span><span class="op" id="8086883">,</span>&nbsp;<span class="ident" id="8086885">medName</span><span class="op" id="8086892">)</span><span class="op" id="8086893">}</span><span class="op" id="8086894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8086898">for</span>&nbsp;<span class="ident" id="8086902">_</span><span class="op" id="8086903">,</span>&nbsp;<span class="ident" id="8086905">test</span>&nbsp;<span class="op" id="8086910">:=</span>&nbsp;<span class="keyword" id="8086913">range</span>&nbsp;<span class="ident" id="8086919">paxTests</span>&nbsp;<span class="op" id="8086928">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8086932">key</span><span class="op" id="8086935">,</span>&nbsp;<span class="ident" id="8086937">expected</span>&nbsp;<span class="op" id="8086946">:=</span>&nbsp;<span class="ident" id="8086949">test</span><span class="op" id="8086953">[</span><span class="num" id="8086954">0</span><span class="op" id="8086955">]</span><span class="op" id="8086956">,</span>&nbsp;<span class="ident" id="8086958">test</span><span class="op" id="8086962">[</span><span class="num" id="8086963">1</span><span class="op" id="8086964">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8086968">if</span>&nbsp;<span class="ident" id="8086971">result</span>&nbsp;<span class="op" id="8086978">:=</span>&nbsp;<span class="ident" id="8086981">paxHeader</span><span class="op" id="8086990">(</span><span class="ident" id="8086991">key</span><span class="op" id="8086994">)</span><span class="op" id="8086995">;</span>&nbsp;<span class="ident" id="8086997">result</span>&nbsp;<span class="op" id="8087004">!=</span>&nbsp;<span class="ident" id="8087007">expected</span>&nbsp;<span class="op" id="8087016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087021">t</span><span class="op" id="8087022">.</span><span class="ident" id="8087023">Fatalf</span><span class="op" id="8087029">(</span><span class="string" id="8087030">&#34;paxHeader:&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="8087062">,</span>&nbsp;<span class="ident" id="8087064">result</span><span class="op" id="8087070">,</span>&nbsp;<span class="ident" id="8087072">expected</span><span class="op" id="8087080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8087084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8087087">}</span><br>
<span class="lineno">420</span><span class="op" id="8087089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8087092">func</span>&nbsp;<span class="ident" id="8087097">TestUSTARLongName</span><span class="op" id="8087114">(</span><span class="ident" id="8087115">t</span>&nbsp;<span class="op" id="8087117">*</span><span class="ident" id="8087118">testing</span><span class="op" id="8087125">.</span><span class="ident" id="8087126">T</span><span class="op" id="8087127">)</span>&nbsp;<span class="op" id="8087129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8087132">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;path&nbsp;that&nbsp;failed&nbsp;to&nbsp;split&nbsp;with&nbsp;USTAR&nbsp;extension&nbsp;in&nbsp;previous&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087230">fileinfo</span><span class="op" id="8087238">,</span>&nbsp;<span class="ident" id="8087240">err</span>&nbsp;<span class="op" id="8087244">:=</span>&nbsp;<span class="ident" id="8087247">os</span><span class="op" id="8087249">.</span><span class="ident" id="8087250">Stat</span><span class="op" id="8087254">(</span><span class="string" id="8087255">&#34;testdata/small.txt&#34;</span><span class="op" id="8087275">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8087278">if</span>&nbsp;<span class="ident" id="8087281">err</span>&nbsp;<span class="op" id="8087285">!=</span>&nbsp;<span class="ident" id="8087288">nil</span>&nbsp;<span class="op" id="8087292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087296">t</span><span class="op" id="8087297">.</span><span class="ident" id="8087298">Fatal</span><span class="op" id="8087303">(</span><span class="ident" id="8087304">err</span><span class="op" id="8087307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8087310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087313">hdr</span><span class="op" id="8087316">,</span>&nbsp;<span class="ident" id="8087318">err</span>&nbsp;<span class="op" id="8087322">:=</span>&nbsp;<span class="ident" id="8087325">FileInfoHeader</span><span class="op" id="8087339">(</span><span class="ident" id="8087340">fileinfo</span><span class="op" id="8087348">,</span>&nbsp;<span class="string" id="8087350">&#34;&#34;</span><span class="op" id="8087352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087355">hdr</span><span class="op" id="8087358">.</span><span class="ident" id="8087359">Typeflag</span>&nbsp;<span class="op" id="8087368">=</span>&nbsp;<span class="ident" id="8087370">TypeDir</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8087379">if</span>&nbsp;<span class="ident" id="8087382">err</span>&nbsp;<span class="op" id="8087386">!=</span>&nbsp;<span class="ident" id="8087389">nil</span>&nbsp;<span class="op" id="8087393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087397">t</span><span class="op" id="8087398">.</span><span class="ident" id="8087399">Fatalf</span><span class="op" id="8087405">(</span><span class="string" id="8087406">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="8087420">,</span>&nbsp;<span class="ident" id="8087422">err</span><span class="op" id="8087425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8087428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8087431">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written.&nbsp;The&nbsp;name&nbsp;was&nbsp;taken&nbsp;from&nbsp;a&nbsp;practical&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8087516">//&nbsp;that&nbsp;fails&nbsp;and&nbsp;replaced&nbsp;ever&nbsp;char&nbsp;through&nbsp;numbers&nbsp;to&nbsp;anonymize&nbsp;the&nbsp;sample.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087595">longName</span>&nbsp;<span class="op" id="8087604">:=</span>&nbsp;<span class="string" id="8087607">&#34;/0000_0000000/00000-000000000/0000_0000000/00000-0000000000000/0000_0000000/00000-0000000-00000000/0000_0000000/00000000/0000_0000000/000/0000_0000000/00000000v00/0000_0000000/000000/0000_0000000/0000000/0000_0000000/00000y-00/0000/0000/00000000/0x000000/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087866">hdr</span><span class="op" id="8087869">.</span><span class="ident" id="8087870">Name</span>&nbsp;<span class="op" id="8087875">=</span>&nbsp;<span class="ident" id="8087877">longName</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087888">hdr</span><span class="op" id="8087891">.</span><span class="ident" id="8087892">Size</span>&nbsp;<span class="op" id="8087897">=</span>&nbsp;<span class="num" id="8087899">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8087902">var</span>&nbsp;<span class="ident" id="8087906">buf</span>&nbsp;<span class="ident" id="8087910">bytes</span><span class="op" id="8087915">.</span><span class="ident" id="8087916">Buffer</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8087924">writer</span>&nbsp;<span class="op" id="8087931">:=</span>&nbsp;<span class="ident" id="8087934">NewWriter</span><span class="op" id="8087943">(</span><span class="op" id="8087944">&amp;</span><span class="ident" id="8087945">buf</span><span class="op" id="8087948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8087951">if</span>&nbsp;<span class="ident" id="8087954">err</span>&nbsp;<span class="op" id="8087958">:=</span>&nbsp;<span class="ident" id="8087961">writer</span><span class="op" id="8087967">.</span><span class="ident" id="8087968">WriteHeader</span><span class="op" id="8087979">(</span><span class="ident" id="8087980">hdr</span><span class="op" id="8087983">)</span><span class="op" id="8087984">;</span>&nbsp;<span class="ident" id="8087986">err</span>&nbsp;<span class="op" id="8087990">!=</span>&nbsp;<span class="ident" id="8087993">nil</span>&nbsp;<span class="op" id="8087997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088001">t</span><span class="op" id="8088002">.</span><span class="ident" id="8088003">Fatal</span><span class="op" id="8088008">(</span><span class="ident" id="8088009">err</span><span class="op" id="8088012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088018">if</span>&nbsp;<span class="ident" id="8088021">err</span>&nbsp;<span class="op" id="8088025">:=</span>&nbsp;<span class="ident" id="8088028">writer</span><span class="op" id="8088034">.</span><span class="ident" id="8088035">Close</span><span class="op" id="8088040">(</span><span class="op" id="8088041">)</span><span class="op" id="8088042">;</span>&nbsp;<span class="ident" id="8088044">err</span>&nbsp;<span class="op" id="8088048">!=</span>&nbsp;<span class="ident" id="8088051">nil</span>&nbsp;<span class="op" id="8088055">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088059">t</span><span class="op" id="8088060">.</span><span class="ident" id="8088061">Fatal</span><span class="op" id="8088066">(</span><span class="ident" id="8088067">err</span><span class="op" id="8088070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8088076">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088138">reader</span>&nbsp;<span class="op" id="8088145">:=</span>&nbsp;<span class="ident" id="8088148">NewReader</span><span class="op" id="8088157">(</span><span class="op" id="8088158">&amp;</span><span class="ident" id="8088159">buf</span><span class="op" id="8088162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088165">hdr</span><span class="op" id="8088168">,</span>&nbsp;<span class="ident" id="8088170">err</span>&nbsp;<span class="op" id="8088174">=</span>&nbsp;<span class="ident" id="8088176">reader</span><span class="op" id="8088182">.</span><span class="ident" id="8088183">Next</span><span class="op" id="8088187">(</span><span class="op" id="8088188">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088191">if</span>&nbsp;<span class="ident" id="8088194">err</span>&nbsp;<span class="op" id="8088198">!=</span>&nbsp;<span class="ident" id="8088201">nil</span>&nbsp;<span class="op" id="8088205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088209">t</span><span class="op" id="8088210">.</span><span class="ident" id="8088211">Fatal</span><span class="op" id="8088216">(</span><span class="ident" id="8088217">err</span><span class="op" id="8088220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088226">if</span>&nbsp;<span class="ident" id="8088229">hdr</span><span class="op" id="8088232">.</span><span class="ident" id="8088233">Name</span>&nbsp;<span class="op" id="8088238">!=</span>&nbsp;<span class="ident" id="8088241">longName</span>&nbsp;<span class="op" id="8088250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088254">t</span><span class="op" id="8088255">.</span><span class="ident" id="8088256">Fatal</span><span class="op" id="8088261">(</span><span class="string" id="8088262">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;name&#34;</span><span class="op" id="8088290">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088293">}</span><br>
<span class="lineno"></span><span class="op" id="8088295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8088298">func</span>&nbsp;<span class="ident" id="8088303">TestValidTypeflagWithPAXHeader</span><span class="op" id="8088333">(</span><span class="ident" id="8088334">t</span>&nbsp;<span class="op" id="8088336">*</span><span class="ident" id="8088337">testing</span><span class="op" id="8088344">.</span><span class="ident" id="8088345">T</span><span class="op" id="8088346">)</span>&nbsp;<span class="op" id="8088348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088351">var</span>&nbsp;<span class="ident" id="8088355">buffer</span>&nbsp;<span class="ident" id="8088362">bytes</span><span class="op" id="8088367">.</span><span class="ident" id="8088368">Buffer</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088376">tw</span>&nbsp;<span class="op" id="8088379">:=</span>&nbsp;<span class="ident" id="8088382">NewWriter</span><span class="op" id="8088391">(</span><span class="op" id="8088392">&amp;</span><span class="ident" id="8088393">buffer</span><span class="op" id="8088399">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088403">fileName</span>&nbsp;<span class="op" id="8088412">:=</span>&nbsp;<span class="ident" id="8088415">strings</span><span class="op" id="8088422">.</span><span class="ident" id="8088423">Repeat</span><span class="op" id="8088429">(</span><span class="string" id="8088430">&#34;ab&#34;</span><span class="op" id="8088434">,</span>&nbsp;<span class="num" id="8088436">100</span><span class="op" id="8088439">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088443">hdr</span>&nbsp;<span class="op" id="8088447">:=</span>&nbsp;<span class="op" id="8088450">&amp;</span><span class="ident" id="8088451">Header</span><span class="op" id="8088457">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088461">Name</span><span class="op" id="8088465">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8088471">fileName</span><span class="op" id="8088479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088483">Size</span><span class="op" id="8088487">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8088493">4</span><span class="op" id="8088494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088498">Typeflag</span><span class="op" id="8088506">:</span>&nbsp;<span class="num" id="8088508">0</span><span class="op" id="8088509">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088515">if</span>&nbsp;<span class="ident" id="8088518">err</span>&nbsp;<span class="op" id="8088522">:=</span>&nbsp;<span class="ident" id="8088525">tw</span><span class="op" id="8088527">.</span><span class="ident" id="8088528">WriteHeader</span><span class="op" id="8088539">(</span><span class="ident" id="8088540">hdr</span><span class="op" id="8088543">)</span><span class="op" id="8088544">;</span>&nbsp;<span class="ident" id="8088546">err</span>&nbsp;<span class="op" id="8088550">!=</span>&nbsp;<span class="ident" id="8088553">nil</span>&nbsp;<span class="op" id="8088557">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088561">t</span><span class="op" id="8088562">.</span><span class="ident" id="8088563">Fatalf</span><span class="op" id="8088569">(</span><span class="string" id="8088570">&#34;Failed&nbsp;to&nbsp;write&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="8088598">,</span>&nbsp;<span class="ident" id="8088600">err</span><span class="op" id="8088603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088609">if</span>&nbsp;<span class="ident" id="8088612">_</span><span class="op" id="8088613">,</span>&nbsp;<span class="ident" id="8088615">err</span>&nbsp;<span class="op" id="8088619">:=</span>&nbsp;<span class="ident" id="8088622">tw</span><span class="op" id="8088624">.</span><span class="ident" id="8088625">Write</span><span class="op" id="8088630">(</span><span class="op" id="8088631">[</span><span class="op" id="8088632">]</span><span class="builtintype" id="8088633">byte</span><span class="op" id="8088637">(</span><span class="string" id="8088638">&#34;fooo&#34;</span><span class="op" id="8088644">)</span><span class="op" id="8088645">)</span><span class="op" id="8088646">;</span>&nbsp;<span class="ident" id="8088648">err</span>&nbsp;<span class="op" id="8088652">!=</span>&nbsp;<span class="ident" id="8088655">nil</span>&nbsp;<span class="op" id="8088659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088663">t</span><span class="op" id="8088664">.</span><span class="ident" id="8088665">Fatalf</span><span class="op" id="8088671">(</span><span class="string" id="8088672">&#34;Failed&nbsp;to&nbsp;write&nbsp;the&nbsp;file&#39;s&nbsp;data:&nbsp;%s&#34;</span><span class="op" id="8088709">,</span>&nbsp;<span class="ident" id="8088711">err</span><span class="op" id="8088714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088717">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088720">tw</span><span class="op" id="8088722">.</span><span class="ident" id="8088723">Close</span><span class="op" id="8088728">(</span><span class="op" id="8088729">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088733">tr</span>&nbsp;<span class="op" id="8088736">:=</span>&nbsp;<span class="ident" id="8088739">NewReader</span><span class="op" id="8088748">(</span><span class="op" id="8088749">&amp;</span><span class="ident" id="8088750">buffer</span><span class="op" id="8088756">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088760">for</span>&nbsp;<span class="op" id="8088764">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088768">header</span><span class="op" id="8088774">,</span>&nbsp;<span class="ident" id="8088776">err</span>&nbsp;<span class="op" id="8088780">:=</span>&nbsp;<span class="ident" id="8088783">tr</span><span class="op" id="8088785">.</span><span class="ident" id="8088786">Next</span><span class="op" id="8088790">(</span><span class="op" id="8088791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088795">if</span>&nbsp;<span class="ident" id="8088798">err</span>&nbsp;<span class="op" id="8088802">==</span>&nbsp;<span class="ident" id="8088805">io</span><span class="op" id="8088807">.</span><span class="ident" id="8088808">EOF</span>&nbsp;<span class="op" id="8088812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088817">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088829">if</span>&nbsp;<span class="ident" id="8088832">err</span>&nbsp;<span class="op" id="8088836">!=</span>&nbsp;<span class="ident" id="8088839">nil</span>&nbsp;<span class="op" id="8088843">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088848">t</span><span class="op" id="8088849">.</span><span class="ident" id="8088850">Fatalf</span><span class="op" id="8088856">(</span><span class="string" id="8088857">&#34;Failed&nbsp;to&nbsp;read&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="8088884">,</span>&nbsp;<span class="ident" id="8088886">err</span><span class="op" id="8088889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088897">if</span>&nbsp;<span class="ident" id="8088900">header</span><span class="op" id="8088906">.</span><span class="ident" id="8088907">Typeflag</span>&nbsp;<span class="op" id="8088916">!=</span>&nbsp;<span class="num" id="8088919">0</span>&nbsp;<span class="op" id="8088921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088926">t</span><span class="op" id="8088927">.</span><span class="ident" id="8088928">Fatalf</span><span class="op" id="8088934">(</span><span class="string" id="8088935">&#34;Typeflag&nbsp;should&#39;ve&nbsp;been&nbsp;0,&nbsp;found&nbsp;%d&#34;</span><span class="op" id="8088972">,</span>&nbsp;<span class="ident" id="8088974">header</span><span class="op" id="8088980">.</span><span class="ident" id="8088981">Typeflag</span><span class="op" id="8088989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088993">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088996">}</span><br>
<span class="lineno"></span><span class="op" id="8088998">}</span>
</div>
</body>
</html>
