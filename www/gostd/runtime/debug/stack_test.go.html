<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7708681">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7708736">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7708790">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7708841">package</span>&nbsp;<span class="ident" id="7708849">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7708856">import</span>&nbsp;<span class="op" id="7708863">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7708866">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7708877">&#34;testing&#34;</span><br>
<span class="lineno">10</span><span class="op" id="7708887">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7708890">type</span>&nbsp;<span class="ident" id="7708895">T</span>&nbsp;<span class="builtintype" id="7708897">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7708902">func</span>&nbsp;<span class="op" id="7708907">(</span><span class="ident" id="7708908">t</span>&nbsp;<span class="op" id="7708910">*</span><span class="ident" id="7708911">T</span><span class="op" id="7708912">)</span>&nbsp;<span class="ident" id="7708914">ptrmethod</span><span class="op" id="7708923">(</span><span class="op" id="7708924">)</span>&nbsp;<span class="op" id="7708926">[</span><span class="op" id="7708927">]</span><span class="builtintype" id="7708928">byte</span>&nbsp;<span class="op" id="7708933">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708936">return</span>&nbsp;<span class="ident" id="7708943">Stack</span><span class="op" id="7708948">(</span><span class="op" id="7708949">)</span><br>
<span class="lineno"></span><span class="op" id="7708951">}</span><br>
<span class="lineno"></span><span class="keyword" id="7708953">func</span>&nbsp;<span class="op" id="7708958">(</span><span class="ident" id="7708959">t</span>&nbsp;<span class="ident" id="7708961">T</span><span class="op" id="7708962">)</span>&nbsp;<span class="ident" id="7708964">method</span><span class="op" id="7708970">(</span><span class="op" id="7708971">)</span>&nbsp;<span class="op" id="7708973">[</span><span class="op" id="7708974">]</span><span class="builtintype" id="7708975">byte</span>&nbsp;<span class="op" id="7708980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708983">return</span>&nbsp;<span class="ident" id="7708990">t</span><span class="op" id="7708991">.</span><span class="ident" id="7708992">ptrmethod</span><span class="op" id="7709001">(</span><span class="op" id="7709002">)</span><br>
<span class="lineno"></span><span class="op" id="7709004">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="7709007">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;traceback&nbsp;should&nbsp;look&nbsp;something&nbsp;like&nbsp;this,&nbsp;modulo&nbsp;line&nbsp;numbers&nbsp;and&nbsp;hex&nbsp;constants.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspDon&#39;t&nbsp;worry&nbsp;much&nbsp;about&nbsp;the&nbsp;base&nbsp;levels,&nbsp;but&nbsp;check&nbsp;the&nbsp;ones&nbsp;in&nbsp;our&nbsp;own&nbsp;package.<br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:15&nbsp;(0x13878)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(*T).ptrmethod:&nbsp;return&nbsp;Stack()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:18&nbsp;(0x138dd)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspT.method:&nbsp;return&nbsp;t.ptrmethod()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:23&nbsp;(0x13920)<br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/testing/testing.go:132&nbsp;(0x14a7a)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptRunner:&nbsp;test.F(t)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/proc.c:145&nbsp;(0xc970)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp???:&nbsp;runtime·unlock(&amp;runtime·sched);<br>
<span class="lineno">35</span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="7709620">func</span>&nbsp;<span class="ident" id="7709625">TestStack</span><span class="op" id="7709634">(</span><span class="ident" id="7709635">t</span>&nbsp;<span class="op" id="7709637">*</span><span class="ident" id="7709638">testing</span><span class="op" id="7709645">.</span><span class="ident" id="7709646">T</span><span class="op" id="7709647">)</span>&nbsp;<span class="op" id="7709649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709652">b</span>&nbsp;<span class="op" id="7709654">:=</span>&nbsp;<span class="ident" id="7709657">T</span><span class="op" id="7709658">(</span><span class="num" id="7709659">0</span><span class="op" id="7709660">)</span><span class="op" id="7709661">.</span><span class="ident" id="7709662">method</span><span class="op" id="7709668">(</span><span class="op" id="7709669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709672">lines</span>&nbsp;<span class="op" id="7709678">:=</span>&nbsp;<span class="ident" id="7709681">strings</span><span class="op" id="7709688">.</span><span class="ident" id="7709689">Split</span><span class="op" id="7709694">(</span><span class="builtintype" id="7709695">string</span><span class="op" id="7709701">(</span><span class="ident" id="7709702">b</span><span class="op" id="7709703">)</span><span class="op" id="7709704">,</span>&nbsp;<span class="string" id="7709706">&#34;\n&#34;</span><span class="op" id="7709710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709713">if</span>&nbsp;<span class="builtinfunc" id="7709716">len</span><span class="op" id="7709719">(</span><span class="ident" id="7709720">lines</span><span class="op" id="7709725">)</span>&nbsp;<span class="op" id="7709727">&lt;</span>&nbsp;<span class="num" id="7709729">6</span>&nbsp;<span class="op" id="7709731">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709735">t</span><span class="op" id="7709736">.</span><span class="ident" id="7709737">Fatal</span><span class="op" id="7709742">(</span><span class="string" id="7709743">&#34;too&nbsp;few&nbsp;lines&#34;</span><span class="op" id="7709758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7709761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709764">n</span>&nbsp;<span class="op" id="7709766">:=</span>&nbsp;<span class="num" id="7709769">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709772">frame</span>&nbsp;<span class="op" id="7709778">:=</span>&nbsp;<span class="keyword" id="7709781">func</span><span class="op" id="7709785">(</span><span class="ident" id="7709786">line</span><span class="op" id="7709790">,</span>&nbsp;<span class="ident" id="7709792">code</span>&nbsp;<span class="builtintype" id="7709797">string</span><span class="op" id="7709803">)</span>&nbsp;<span class="op" id="7709805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709809">check</span><span class="op" id="7709814">(</span><span class="ident" id="7709815">t</span><span class="op" id="7709816">,</span>&nbsp;<span class="ident" id="7709818">lines</span><span class="op" id="7709823">[</span><span class="ident" id="7709824">n</span><span class="op" id="7709825">]</span><span class="op" id="7709826">,</span>&nbsp;<span class="ident" id="7709828">line</span><span class="op" id="7709832">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709836">n</span><span class="op" id="7709837">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7709842">//&nbsp;The&nbsp;source&nbsp;might&nbsp;not&nbsp;be&nbsp;available&nbsp;while&nbsp;running&nbsp;the&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709905">if</span>&nbsp;<span class="ident" id="7709908">strings</span><span class="op" id="7709915">.</span><span class="ident" id="7709916">HasPrefix</span><span class="op" id="7709925">(</span><span class="ident" id="7709926">lines</span><span class="op" id="7709931">[</span><span class="ident" id="7709932">n</span><span class="op" id="7709933">]</span><span class="op" id="7709934">,</span>&nbsp;<span class="string" id="7709936">&#34;\t&#34;</span><span class="op" id="7709940">)</span>&nbsp;<span class="op" id="7709942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709947">check</span><span class="op" id="7709952">(</span><span class="ident" id="7709953">t</span><span class="op" id="7709954">,</span>&nbsp;<span class="ident" id="7709956">lines</span><span class="op" id="7709961">[</span><span class="ident" id="7709962">n</span><span class="op" id="7709963">]</span><span class="op" id="7709964">,</span>&nbsp;<span class="ident" id="7709966">code</span><span class="op" id="7709970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709975">n</span><span class="op" id="7709976">++</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7709981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7709984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709987">frame</span><span class="op" id="7709992">(</span><span class="string" id="7709993">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="7710026">,</span>&nbsp;<span class="string" id="7710028">&#34;\t(*T).ptrmethod:&nbsp;return&nbsp;Stack()&#34;</span><span class="op" id="7710062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710065">frame</span><span class="op" id="7710070">(</span><span class="string" id="7710071">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="7710104">,</span>&nbsp;<span class="string" id="7710106">&#34;\tT.method:&nbsp;return&nbsp;t.ptrmethod()&#34;</span><span class="op" id="7710140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710143">frame</span><span class="op" id="7710148">(</span><span class="string" id="7710149">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="7710182">,</span>&nbsp;<span class="string" id="7710184">&#34;\tTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()&#34;</span><span class="op" id="7710217">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710220">frame</span><span class="op" id="7710225">(</span><span class="string" id="7710226">&#34;src/testing/testing.go&#34;</span><span class="op" id="7710250">,</span>&nbsp;<span class="string" id="7710252">&#34;&#34;</span><span class="op" id="7710254">)</span><br>
<span class="lineno"></span><span class="op" id="7710256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7710259">func</span>&nbsp;<span class="ident" id="7710264">check</span><span class="op" id="7710269">(</span><span class="ident" id="7710270">t</span>&nbsp;<span class="op" id="7710272">*</span><span class="ident" id="7710273">testing</span><span class="op" id="7710280">.</span><span class="ident" id="7710281">T</span><span class="op" id="7710282">,</span>&nbsp;<span class="ident" id="7710284">line</span><span class="op" id="7710288">,</span>&nbsp;<span class="ident" id="7710290">has</span>&nbsp;<span class="builtintype" id="7710294">string</span><span class="op" id="7710300">)</span>&nbsp;<span class="op" id="7710302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7710305">if</span>&nbsp;<span class="ident" id="7710308">strings</span><span class="op" id="7710315">.</span><span class="ident" id="7710316">Index</span><span class="op" id="7710321">(</span><span class="ident" id="7710322">line</span><span class="op" id="7710326">,</span>&nbsp;<span class="ident" id="7710328">has</span><span class="op" id="7710331">)</span>&nbsp;<span class="op" id="7710333">&lt;</span>&nbsp;<span class="num" id="7710335">0</span>&nbsp;<span class="op" id="7710337">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710341">t</span><span class="op" id="7710342">.</span><span class="ident" id="7710343">Errorf</span><span class="op" id="7710349">(</span><span class="string" id="7710350">&#34;expected&nbsp;%q&nbsp;in&nbsp;%q&#34;</span><span class="op" id="7710369">,</span>&nbsp;<span class="ident" id="7710371">has</span><span class="op" id="7710374">,</span>&nbsp;<span class="ident" id="7710376">line</span><span class="op" id="7710380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710383">}</span><br>
<span class="lineno"></span><span class="op" id="7710385">}</span>
</div>
</body>
</html>
