<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html" class="current">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4510122">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4510177">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4510231">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4510282">//&nbsp;+build&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4510345">package</span>&nbsp;<span class="ident" id="4510353">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4510359">import</span>&nbsp;<span class="string" id="4510366">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4510379">//&nbsp;Possible&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;finding&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4510434">var</span>&nbsp;<span class="ident" id="4510438">certFiles</span>&nbsp;<span class="op" id="4510448">=</span>&nbsp;<span class="op" id="4510450">[</span><span class="op" id="4510451">]</span><span class="builtintype" id="4510452">string</span><span class="op" id="4510458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4510461">&#34;/etc/ssl/certs/ca-certificates.crt&#34;</span><span class="op" id="4510497">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4510503">//&nbsp;Debian/Ubuntu/Gentoo&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4510533">&#34;/etc/pki/tls/certs/ca-bundle.crt&#34;</span><span class="op" id="4510567">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4510575">//&nbsp;Fedora/RHEL</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4510591">&#34;/etc/ssl/ca-bundle.pem&#34;</span><span class="op" id="4510615">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4510633">//&nbsp;OpenSUSE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4510646">&#34;/etc/ssl/cert.pem&#34;</span><span class="op" id="4510665">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4510688">//&nbsp;OpenBSD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4510700">&#34;/usr/local/share/certs/ca-root-nss.crt&#34;</span><span class="op" id="4510740">,</span>&nbsp;<span class="comment" id="4510742">//&nbsp;FreeBSD/DragonFly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4510764">&#34;/etc/pki/tls/cacert.pem&#34;</span><span class="op" id="4510789">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4510806">//&nbsp;OpenELEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4510819">&#34;/etc/certs/ca-certificates.crt&#34;</span><span class="op" id="4510851">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4510861">//&nbsp;Solaris&nbsp;11.2+</span><br>
<span class="lineno">20</span><span class="op" id="4510878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4510881">//&nbsp;Possible&nbsp;directories&nbsp;with&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;successfully</span><br>
<span class="lineno"></span><span class="comment" id="4510953">//&nbsp;reading&nbsp;at&nbsp;least&nbsp;one&nbsp;file&nbsp;from&nbsp;a&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="4511000">var</span>&nbsp;<span class="ident" id="4511004">certDirectories</span>&nbsp;<span class="op" id="4511020">=</span>&nbsp;<span class="op" id="4511022">[</span><span class="op" id="4511023">]</span><span class="builtintype" id="4511024">string</span><span class="op" id="4511030">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4511033">&#34;/system/etc/security/cacerts&#34;</span><span class="op" id="4511063">,</span>&nbsp;<span class="comment" id="4511065">//&nbsp;Android</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="4511077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4511080">func</span>&nbsp;<span class="op" id="4511085">(</span><span class="ident" id="4511086">c</span>&nbsp;<span class="op" id="4511088">*</span><span class="ident" id="4511089">Certificate</span><span class="op" id="4511100">)</span>&nbsp;<span class="ident" id="4511102">systemVerify</span><span class="op" id="4511114">(</span><span class="ident" id="4511115">opts</span>&nbsp;<span class="op" id="4511120">*</span><span class="ident" id="4511121">VerifyOptions</span><span class="op" id="4511134">)</span>&nbsp;<span class="op" id="4511136">(</span><span class="ident" id="4511137">chains</span>&nbsp;<span class="op" id="4511144">[</span><span class="op" id="4511145">]</span><span class="op" id="4511146">[</span><span class="op" id="4511147">]</span><span class="op" id="4511148">*</span><span class="ident" id="4511149">Certificate</span><span class="op" id="4511160">,</span>&nbsp;<span class="ident" id="4511162">err</span>&nbsp;<span class="builtintype" id="4511166">error</span><span class="op" id="4511171">)</span>&nbsp;<span class="op" id="4511173">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511176">return</span>&nbsp;<span class="builtintype" id="4511183">nil</span><span class="op" id="4511186">,</span>&nbsp;<span class="builtintype" id="4511188">nil</span><br>
<span class="lineno"></span><span class="op" id="4511192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4511195">func</span>&nbsp;<span class="ident" id="4511200">initSystemRoots</span><span class="op" id="4511215">(</span><span class="op" id="4511216">)</span>&nbsp;<span class="op" id="4511218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511221">roots</span>&nbsp;<span class="op" id="4511227">:=</span>&nbsp;<span class="ident" id="4511230">NewCertPool</span><span class="op" id="4511241">(</span><span class="op" id="4511242">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511245">for</span>&nbsp;<span class="ident" id="4511249">_</span><span class="op" id="4511250">,</span>&nbsp;<span class="ident" id="4511252">file</span>&nbsp;<span class="op" id="4511257">:=</span>&nbsp;<span class="keyword" id="4511260">range</span>&nbsp;<span class="ident" id="4511266">certFiles</span>&nbsp;<span class="op" id="4511276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511280">data</span><span class="op" id="4511284">,</span>&nbsp;<span class="ident" id="4511286">err</span>&nbsp;<span class="op" id="4511290">:=</span>&nbsp;<span class="ident" id="4511293">ioutil</span><span class="op" id="4511299">.</span><span class="ident" id="4511300">ReadFile</span><span class="op" id="4511308">(</span><span class="ident" id="4511309">file</span><span class="op" id="4511313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511317">if</span>&nbsp;<span class="ident" id="4511320">err</span>&nbsp;<span class="op" id="4511324">==</span>&nbsp;<span class="builtintype" id="4511327">nil</span>&nbsp;<span class="op" id="4511331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511336">roots</span><span class="op" id="4511341">.</span><span class="ident" id="4511342">AppendCertsFromPEM</span><span class="op" id="4511360">(</span><span class="ident" id="4511361">data</span><span class="op" id="4511365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511370">systemRoots</span>&nbsp;<span class="op" id="4511382">=</span>&nbsp;<span class="ident" id="4511384">roots</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511393">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4511402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4511405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511409">for</span>&nbsp;<span class="ident" id="4511413">_</span><span class="op" id="4511414">,</span>&nbsp;<span class="ident" id="4511416">directory</span>&nbsp;<span class="op" id="4511426">:=</span>&nbsp;<span class="keyword" id="4511429">range</span>&nbsp;<span class="ident" id="4511435">certDirectories</span>&nbsp;<span class="op" id="4511451">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511455">fis</span><span class="op" id="4511458">,</span>&nbsp;<span class="ident" id="4511460">err</span>&nbsp;<span class="op" id="4511464">:=</span>&nbsp;<span class="ident" id="4511467">ioutil</span><span class="op" id="4511473">.</span><span class="ident" id="4511474">ReadDir</span><span class="op" id="4511481">(</span><span class="ident" id="4511482">directory</span><span class="op" id="4511491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511495">if</span>&nbsp;<span class="ident" id="4511498">err</span>&nbsp;<span class="op" id="4511502">!=</span>&nbsp;<span class="builtintype" id="4511505">nil</span>&nbsp;<span class="op" id="4511509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511514">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4511525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511529">rootsAdded</span>&nbsp;<span class="op" id="4511540">:=</span>&nbsp;<span class="builtintype" id="4511543">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511551">for</span>&nbsp;<span class="ident" id="4511555">_</span><span class="op" id="4511556">,</span>&nbsp;<span class="ident" id="4511558">fi</span>&nbsp;<span class="op" id="4511561">:=</span>&nbsp;<span class="keyword" id="4511564">range</span>&nbsp;<span class="ident" id="4511570">fis</span>&nbsp;<span class="op" id="4511574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511579">data</span><span class="op" id="4511583">,</span>&nbsp;<span class="ident" id="4511585">err</span>&nbsp;<span class="op" id="4511589">:=</span>&nbsp;<span class="ident" id="4511592">ioutil</span><span class="op" id="4511598">.</span><span class="ident" id="4511599">ReadFile</span><span class="op" id="4511607">(</span><span class="ident" id="4511608">directory</span>&nbsp;<span class="op" id="4511618">+</span>&nbsp;<span class="string" id="4511620">&#34;/&#34;</span>&nbsp;<span class="op" id="4511624">+</span>&nbsp;<span class="ident" id="4511626">fi</span><span class="op" id="4511628">.</span><span class="ident" id="4511629">Name</span><span class="op" id="4511633">(</span><span class="op" id="4511634">)</span><span class="op" id="4511635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511640">if</span>&nbsp;<span class="ident" id="4511643">err</span>&nbsp;<span class="op" id="4511647">==</span>&nbsp;<span class="builtintype" id="4511650">nil</span>&nbsp;<span class="op" id="4511654">&amp;&amp;</span>&nbsp;<span class="ident" id="4511657">roots</span><span class="op" id="4511662">.</span><span class="ident" id="4511663">AppendCertsFromPEM</span><span class="op" id="4511681">(</span><span class="ident" id="4511682">data</span><span class="op" id="4511686">)</span>&nbsp;<span class="op" id="4511688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511694">rootsAdded</span>&nbsp;<span class="op" id="4511705">=</span>&nbsp;<span class="builtintype" id="4511707">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4511715">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4511719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511723">if</span>&nbsp;<span class="ident" id="4511726">rootsAdded</span>&nbsp;<span class="op" id="4511737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511742">systemRoots</span>&nbsp;<span class="op" id="4511754">=</span>&nbsp;<span class="ident" id="4511756">roots</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511765">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4511774">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4511777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4511781">//&nbsp;All&nbsp;of&nbsp;the&nbsp;files&nbsp;failed&nbsp;to&nbsp;load.&nbsp;systemRoots&nbsp;will&nbsp;be&nbsp;nil&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4511853">//&nbsp;trigger&nbsp;a&nbsp;specific&nbsp;error&nbsp;at&nbsp;verification&nbsp;time.</span><br>
<span class="lineno"></span><span class="op" id="4511903">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
