<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html" class="current">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1465789">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1465844">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1465898">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1465949">package</span>&nbsp;<span class="ident" id="1465957">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1465965">import</span>&nbsp;<span class="op" id="1465972">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1465975">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1465984">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1465987">//&nbsp;A&nbsp;Value&nbsp;provides&nbsp;an&nbsp;atomic&nbsp;load&nbsp;and&nbsp;store&nbsp;of&nbsp;a&nbsp;consistently&nbsp;typed&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1466063">//&nbsp;Values&nbsp;can&nbsp;be&nbsp;created&nbsp;as&nbsp;part&nbsp;of&nbsp;other&nbsp;data&nbsp;structures.</span><br>
<span class="lineno"></span><span class="comment" id="1466122">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Value&nbsp;returns&nbsp;nil&nbsp;from&nbsp;Load.</span><br>
<span class="lineno"></span><span class="comment" id="1466175">//&nbsp;Once&nbsp;Store&nbsp;has&nbsp;been&nbsp;called,&nbsp;a&nbsp;Value&nbsp;must&nbsp;not&nbsp;be&nbsp;copied.</span><br>
<span class="lineno">15</span><span class="keyword" id="1466234">type</span>&nbsp;<span class="ident" id="1466239">Value</span>&nbsp;<span class="keyword" id="1466245">struct</span>&nbsp;<span class="op" id="1466252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1466255">v</span>&nbsp;<span class="keyword" id="1466257">interface</span><span class="op" id="1466266">{</span><span class="op" id="1466267">}</span><br>
<span class="lineno"></span><span class="op" id="1466269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1466272">//&nbsp;ifaceWords&nbsp;is&nbsp;interface{}&nbsp;internal&nbsp;representation.</span><br>
<span class="lineno">20</span><span class="keyword" id="1466326">type</span>&nbsp;<span class="ident" id="1466331">ifaceWords</span>&nbsp;<span class="keyword" id="1466342">struct</span>&nbsp;<span class="op" id="1466349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1466352">typ</span>&nbsp;&nbsp;<span class="ident" id="1466357">unsafe</span><span class="op" id="1466363">.</span><span class="ident" id="1466364">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1466373">data</span>&nbsp;<span class="ident" id="1466378">unsafe</span><span class="op" id="1466384">.</span><span class="ident" id="1466385">Pointer</span><br>
<span class="lineno"></span><span class="op" id="1466393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1466396">//&nbsp;Load&nbsp;returns&nbsp;the&nbsp;value&nbsp;set&nbsp;by&nbsp;the&nbsp;most&nbsp;recent&nbsp;Store.</span><br>
<span class="lineno"></span><span class="comment" id="1466452">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;there&nbsp;has&nbsp;been&nbsp;no&nbsp;call&nbsp;to&nbsp;Store&nbsp;for&nbsp;this&nbsp;Value.</span><br>
<span class="lineno"></span><span class="keyword" id="1466521">func</span>&nbsp;<span class="op" id="1466526">(</span><span class="ident" id="1466527">v</span>&nbsp;<span class="op" id="1466529">*</span><span class="ident" id="1466530">Value</span><span class="op" id="1466535">)</span>&nbsp;<span class="ident" id="1466537">Load</span><span class="op" id="1466541">(</span><span class="op" id="1466542">)</span>&nbsp;<span class="op" id="1466544">(</span><span class="ident" id="1466545">x</span>&nbsp;<span class="keyword" id="1466547">interface</span><span class="op" id="1466556">{</span><span class="op" id="1466557">}</span><span class="op" id="1466558">)</span>&nbsp;<span class="op" id="1466560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1466563">vp</span>&nbsp;<span class="op" id="1466566">:=</span>&nbsp;<span class="op" id="1466569">(</span><span class="op" id="1466570">*</span><span class="ident" id="1466571">ifaceWords</span><span class="op" id="1466581">)</span><span class="op" id="1466582">(</span><span class="ident" id="1466583">unsafe</span><span class="op" id="1466589">.</span><span class="ident" id="1466590">Pointer</span><span class="op" id="1466597">(</span><span class="ident" id="1466598">v</span><span class="op" id="1466599">)</span><span class="op" id="1466600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1466603">typ</span>&nbsp;<span class="op" id="1466607">:=</span>&nbsp;<span class="ident" id="1466610">LoadPointer</span><span class="op" id="1466621">(</span><span class="op" id="1466622">&amp;</span><span class="ident" id="1466623">vp</span><span class="op" id="1466625">.</span><span class="ident" id="1466626">typ</span><span class="op" id="1466629">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1466632">if</span>&nbsp;<span class="ident" id="1466635">typ</span>&nbsp;<span class="op" id="1466639">==</span>&nbsp;<span class="ident" id="1466642">nil</span>&nbsp;<span class="op" id="1466646">||</span>&nbsp;<span class="builtintype" id="1466649">uintptr</span><span class="op" id="1466656">(</span><span class="ident" id="1466657">typ</span><span class="op" id="1466660">)</span>&nbsp;<span class="op" id="1466662">==</span>&nbsp;<span class="op" id="1466665">^</span><span class="builtintype" id="1466666">uintptr</span><span class="op" id="1466673">(</span><span class="num" id="1466674">0</span><span class="op" id="1466675">)</span>&nbsp;<span class="op" id="1466677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1466681">//&nbsp;First&nbsp;store&nbsp;not&nbsp;yet&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1466717">return</span>&nbsp;<span class="ident" id="1466724">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1466729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1466732">data</span>&nbsp;<span class="op" id="1466737">:=</span>&nbsp;<span class="ident" id="1466740">LoadPointer</span><span class="op" id="1466751">(</span><span class="op" id="1466752">&amp;</span><span class="ident" id="1466753">vp</span><span class="op" id="1466755">.</span><span class="ident" id="1466756">data</span><span class="op" id="1466760">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1466763">xp</span>&nbsp;<span class="op" id="1466766">:=</span>&nbsp;<span class="op" id="1466769">(</span><span class="op" id="1466770">*</span><span class="ident" id="1466771">ifaceWords</span><span class="op" id="1466781">)</span><span class="op" id="1466782">(</span><span class="ident" id="1466783">unsafe</span><span class="op" id="1466789">.</span><span class="ident" id="1466790">Pointer</span><span class="op" id="1466797">(</span><span class="op" id="1466798">&amp;</span><span class="ident" id="1466799">x</span><span class="op" id="1466800">)</span><span class="op" id="1466801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1466804">xp</span><span class="op" id="1466806">.</span><span class="ident" id="1466807">typ</span>&nbsp;<span class="op" id="1466811">=</span>&nbsp;<span class="ident" id="1466813">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1466818">xp</span><span class="op" id="1466820">.</span><span class="ident" id="1466821">data</span>&nbsp;<span class="op" id="1466826">=</span>&nbsp;<span class="ident" id="1466828">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1466834">return</span><br>
<span class="lineno"></span><span class="op" id="1466841">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="1466844">//&nbsp;Store&nbsp;sets&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;Value&nbsp;to&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1466887">//&nbsp;All&nbsp;calls&nbsp;to&nbsp;Store&nbsp;for&nbsp;a&nbsp;given&nbsp;Value&nbsp;must&nbsp;use&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="1466970">//&nbsp;Store&nbsp;of&nbsp;an&nbsp;inconsistent&nbsp;type&nbsp;panics,&nbsp;as&nbsp;does&nbsp;Store(nil).</span><br>
<span class="lineno"></span><span class="keyword" id="1467031">func</span>&nbsp;<span class="op" id="1467036">(</span><span class="ident" id="1467037">v</span>&nbsp;<span class="op" id="1467039">*</span><span class="ident" id="1467040">Value</span><span class="op" id="1467045">)</span>&nbsp;<span class="ident" id="1467047">Store</span><span class="op" id="1467052">(</span><span class="ident" id="1467053">x</span>&nbsp;<span class="keyword" id="1467055">interface</span><span class="op" id="1467064">{</span><span class="op" id="1467065">}</span><span class="op" id="1467066">)</span>&nbsp;<span class="op" id="1467068">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1467071">if</span>&nbsp;<span class="ident" id="1467074">x</span>&nbsp;<span class="op" id="1467076">==</span>&nbsp;<span class="ident" id="1467079">nil</span>&nbsp;<span class="op" id="1467083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1467087">panic</span><span class="op" id="1467092">(</span><span class="string" id="1467093">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;nil&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1467137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1467140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1467143">vp</span>&nbsp;<span class="op" id="1467146">:=</span>&nbsp;<span class="op" id="1467149">(</span><span class="op" id="1467150">*</span><span class="ident" id="1467151">ifaceWords</span><span class="op" id="1467161">)</span><span class="op" id="1467162">(</span><span class="ident" id="1467163">unsafe</span><span class="op" id="1467169">.</span><span class="ident" id="1467170">Pointer</span><span class="op" id="1467177">(</span><span class="ident" id="1467178">v</span><span class="op" id="1467179">)</span><span class="op" id="1467180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1467183">xp</span>&nbsp;<span class="op" id="1467186">:=</span>&nbsp;<span class="op" id="1467189">(</span><span class="op" id="1467190">*</span><span class="ident" id="1467191">ifaceWords</span><span class="op" id="1467201">)</span><span class="op" id="1467202">(</span><span class="ident" id="1467203">unsafe</span><span class="op" id="1467209">.</span><span class="ident" id="1467210">Pointer</span><span class="op" id="1467217">(</span><span class="op" id="1467218">&amp;</span><span class="ident" id="1467219">x</span><span class="op" id="1467220">)</span><span class="op" id="1467221">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1467224">for</span>&nbsp;<span class="op" id="1467228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1467232">typ</span>&nbsp;<span class="op" id="1467236">:=</span>&nbsp;<span class="ident" id="1467239">LoadPointer</span><span class="op" id="1467250">(</span><span class="op" id="1467251">&amp;</span><span class="ident" id="1467252">vp</span><span class="op" id="1467254">.</span><span class="ident" id="1467255">typ</span><span class="op" id="1467258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1467262">if</span>&nbsp;<span class="ident" id="1467265">typ</span>&nbsp;<span class="op" id="1467269">==</span>&nbsp;<span class="ident" id="1467272">nil</span>&nbsp;<span class="op" id="1467276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1467281">//&nbsp;Attempt&nbsp;to&nbsp;start&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1467317">//&nbsp;Disable&nbsp;preemption&nbsp;so&nbsp;that&nbsp;other&nbsp;goroutines&nbsp;can&nbsp;use</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1467375">//&nbsp;active&nbsp;spin&nbsp;wait&nbsp;to&nbsp;wait&nbsp;for&nbsp;completion;&nbsp;and&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1467434">//&nbsp;GC&nbsp;does&nbsp;not&nbsp;see&nbsp;the&nbsp;fake&nbsp;type&nbsp;accidentally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1467484">runtime_procPin</span><span class="op" id="1467499">(</span><span class="op" id="1467500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1467505">if</span>&nbsp;<span class="op" id="1467508">!</span><span class="ident" id="1467509">CompareAndSwapPointer</span><span class="op" id="1467530">(</span><span class="op" id="1467531">&amp;</span><span class="ident" id="1467532">vp</span><span class="op" id="1467534">.</span><span class="ident" id="1467535">typ</span><span class="op" id="1467538">,</span>&nbsp;<span class="ident" id="1467540">nil</span><span class="op" id="1467543">,</span>&nbsp;<span class="ident" id="1467545">unsafe</span><span class="op" id="1467551">.</span><span class="ident" id="1467552">Pointer</span><span class="op" id="1467559">(</span><span class="op" id="1467560">^</span><span class="builtintype" id="1467561">uintptr</span><span class="op" id="1467568">(</span><span class="num" id="1467569">0</span><span class="op" id="1467570">)</span><span class="op" id="1467571">)</span><span class="op" id="1467572">)</span>&nbsp;<span class="op" id="1467574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1467580">runtime_procUnpin</span><span class="op" id="1467597">(</span><span class="op" id="1467598">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1467604">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1467616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1467621">//&nbsp;Complete&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1467649">StorePointer</span><span class="op" id="1467661">(</span><span class="op" id="1467662">&amp;</span><span class="ident" id="1467663">vp</span><span class="op" id="1467665">.</span><span class="ident" id="1467666">data</span><span class="op" id="1467670">,</span>&nbsp;<span class="ident" id="1467672">xp</span><span class="op" id="1467674">.</span><span class="ident" id="1467675">data</span><span class="op" id="1467679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1467684">StorePointer</span><span class="op" id="1467696">(</span><span class="op" id="1467697">&amp;</span><span class="ident" id="1467698">vp</span><span class="op" id="1467700">.</span><span class="ident" id="1467701">typ</span><span class="op" id="1467704">,</span>&nbsp;<span class="ident" id="1467706">xp</span><span class="op" id="1467708">.</span><span class="ident" id="1467709">typ</span><span class="op" id="1467712">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1467717">runtime_procUnpin</span><span class="op" id="1467734">(</span><span class="op" id="1467735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1467740">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1467749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1467753">if</span>&nbsp;<span class="builtintype" id="1467756">uintptr</span><span class="op" id="1467763">(</span><span class="ident" id="1467764">typ</span><span class="op" id="1467767">)</span>&nbsp;<span class="op" id="1467769">==</span>&nbsp;<span class="op" id="1467772">^</span><span class="builtintype" id="1467773">uintptr</span><span class="op" id="1467780">(</span><span class="num" id="1467781">0</span><span class="op" id="1467782">)</span>&nbsp;<span class="op" id="1467784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1467789">//&nbsp;First&nbsp;store&nbsp;in&nbsp;progress.&nbsp;Wait.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1467826">//&nbsp;Since&nbsp;we&nbsp;disable&nbsp;preemption&nbsp;around&nbsp;the&nbsp;first&nbsp;store,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1467884">//&nbsp;we&nbsp;can&nbsp;wait&nbsp;with&nbsp;active&nbsp;spinning.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1467924">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1467935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1467939">//&nbsp;First&nbsp;store&nbsp;completed.&nbsp;Check&nbsp;type&nbsp;and&nbsp;overwrite&nbsp;data.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1467998">if</span>&nbsp;<span class="ident" id="1468001">typ</span>&nbsp;<span class="op" id="1468005">!=</span>&nbsp;<span class="ident" id="1468008">xp</span><span class="op" id="1468010">.</span><span class="ident" id="1468011">typ</span>&nbsp;<span class="op" id="1468015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1468020">panic</span><span class="op" id="1468025">(</span><span class="string" id="1468026">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;inconsistently&nbsp;typed&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1468087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1468091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1468095">StorePointer</span><span class="op" id="1468107">(</span><span class="op" id="1468108">&amp;</span><span class="ident" id="1468109">vp</span><span class="op" id="1468111">.</span><span class="ident" id="1468112">data</span><span class="op" id="1468116">,</span>&nbsp;<span class="ident" id="1468118">xp</span><span class="op" id="1468120">.</span><span class="ident" id="1468121">data</span><span class="op" id="1468125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1468129">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1468137">}</span><br>
<span class="lineno"></span><span class="op" id="1468139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1468142">//&nbsp;Disable/enable&nbsp;preemption,&nbsp;implemented&nbsp;in&nbsp;runtime.</span><br>
<span class="lineno"></span><span class="keyword" id="1468196">func</span>&nbsp;<span class="ident" id="1468201">runtime_procPin</span><span class="op" id="1468216">(</span><span class="op" id="1468217">)</span><br>
<span class="lineno">85</span><span class="keyword" id="1468219">func</span>&nbsp;<span class="ident" id="1468224">runtime_procUnpin</span><span class="op" id="1468241">(</span><span class="op" id="1468242">)</span>
</div>
</body>
</html>
