<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5004633">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5004688">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5004742">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5004793">package</span>&nbsp;<span class="ident" id="5004801">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5004806">import</span>&nbsp;<span class="op" id="5004813">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5004816">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5004828">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5004835">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5004838">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5004918">//&nbsp;Export&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5004939">//&nbsp;exportFilter&nbsp;is&nbsp;a&nbsp;special&nbsp;filter&nbsp;function&nbsp;to&nbsp;extract&nbsp;exported&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="5005011">func</span>&nbsp;<span class="ident" id="5005016">exportFilter</span><span class="op" id="5005028">(</span><span class="ident" id="5005029">name</span>&nbsp;<span class="builtintype" id="5005034">string</span><span class="op" id="5005040">)</span>&nbsp;<span class="builtintype" id="5005042">bool</span>&nbsp;<span class="op" id="5005047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005050">return</span>&nbsp;<span class="ident" id="5005057">IsExported</span><span class="op" id="5005067">(</span><span class="ident" id="5005068">name</span><span class="op" id="5005072">)</span><br>
<span class="lineno"></span><span class="op" id="5005074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5005077">//&nbsp;FileExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5005146">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain:&nbsp;all&nbsp;top-level&nbsp;identifiers&nbsp;which&nbsp;are&nbsp;not&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="5005226">//&nbsp;and&nbsp;their&nbsp;associated&nbsp;information&nbsp;(such&nbsp;as&nbsp;type,&nbsp;initial&nbsp;value,&nbsp;or&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="5005304">//&nbsp;body)&nbsp;are&nbsp;removed.&nbsp;Non-exported&nbsp;fields&nbsp;and&nbsp;methods&nbsp;of&nbsp;exported&nbsp;types&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5005380">//&nbsp;stripped.&nbsp;The&nbsp;File.Comments&nbsp;list&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno">25</span><span class="comment" id="5005432">//</span><br>
<span class="lineno"></span><span class="comment" id="5005435">//&nbsp;FileExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="5005499">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5005530">//</span><br>
<span class="lineno"></span><span class="keyword" id="5005533">func</span>&nbsp;<span class="ident" id="5005538">FileExports</span><span class="op" id="5005549">(</span><span class="ident" id="5005550">src</span>&nbsp;<span class="op" id="5005554">*</span><span class="ident" id="5005555">File</span><span class="op" id="5005559">)</span>&nbsp;<span class="builtintype" id="5005561">bool</span>&nbsp;<span class="op" id="5005566">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005569">return</span>&nbsp;<span class="ident" id="5005576">filterFile</span><span class="op" id="5005586">(</span><span class="ident" id="5005587">src</span><span class="op" id="5005590">,</span>&nbsp;<span class="ident" id="5005592">exportFilter</span><span class="op" id="5005604">,</span>&nbsp;<span class="ident" id="5005606">true</span><span class="op" id="5005610">)</span><br>
<span class="lineno"></span><span class="op" id="5005612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5005615">//&nbsp;PackageExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5005683">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not&nbsp;changed,&nbsp;so&nbsp;that</span><br>
<span class="lineno">35</span><span class="comment" id="5005757">//&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="5005818">//</span><br>
<span class="lineno"></span><span class="comment" id="5005821">//&nbsp;PackageExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="5005888">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5005919">//</span><br>
<span class="lineno">40</span><span class="keyword" id="5005922">func</span>&nbsp;<span class="ident" id="5005927">PackageExports</span><span class="op" id="5005941">(</span><span class="ident" id="5005942">pkg</span>&nbsp;<span class="op" id="5005946">*</span><span class="ident" id="5005947">Package</span><span class="op" id="5005954">)</span>&nbsp;<span class="builtintype" id="5005956">bool</span>&nbsp;<span class="op" id="5005961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005964">return</span>&nbsp;<span class="ident" id="5005971">filterPackage</span><span class="op" id="5005984">(</span><span class="ident" id="5005985">pkg</span><span class="op" id="5005988">,</span>&nbsp;<span class="ident" id="5005990">exportFilter</span><span class="op" id="5006002">,</span>&nbsp;<span class="ident" id="5006004">true</span><span class="op" id="5006008">)</span><br>
<span class="lineno"></span><span class="op" id="5006010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5006013">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">45</span><span class="comment" id="5006093">//&nbsp;General&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5006115">type</span>&nbsp;<span class="ident" id="5006120">Filter</span>&nbsp;<span class="keyword" id="5006127">func</span><span class="op" id="5006131">(</span><span class="builtintype" id="5006132">string</span><span class="op" id="5006138">)</span>&nbsp;<span class="builtintype" id="5006140">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5006146">func</span>&nbsp;<span class="ident" id="5006151">filterIdentList</span><span class="op" id="5006166">(</span><span class="ident" id="5006167">list</span>&nbsp;<span class="op" id="5006172">[</span><span class="op" id="5006173">]</span><span class="op" id="5006174">*</span><span class="ident" id="5006175">Ident</span><span class="op" id="5006180">,</span>&nbsp;<span class="ident" id="5006182">f</span>&nbsp;<span class="ident" id="5006184">Filter</span><span class="op" id="5006190">)</span>&nbsp;<span class="op" id="5006192">[</span><span class="op" id="5006193">]</span><span class="op" id="5006194">*</span><span class="ident" id="5006195">Ident</span>&nbsp;<span class="op" id="5006201">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006204">j</span>&nbsp;<span class="op" id="5006206">:=</span>&nbsp;<span class="num" id="5006209">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006212">for</span>&nbsp;<span class="ident" id="5006216">_</span><span class="op" id="5006217">,</span>&nbsp;<span class="ident" id="5006219">x</span>&nbsp;<span class="op" id="5006221">:=</span>&nbsp;<span class="keyword" id="5006224">range</span>&nbsp;<span class="ident" id="5006230">list</span>&nbsp;<span class="op" id="5006235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006239">if</span>&nbsp;<span class="ident" id="5006242">f</span><span class="op" id="5006243">(</span><span class="ident" id="5006244">x</span><span class="op" id="5006245">.</span><span class="ident" id="5006246">Name</span><span class="op" id="5006250">)</span>&nbsp;<span class="op" id="5006252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006257">list</span><span class="op" id="5006261">[</span><span class="ident" id="5006262">j</span><span class="op" id="5006263">]</span>&nbsp;<span class="op" id="5006265">=</span>&nbsp;<span class="ident" id="5006267">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006272">j</span><span class="op" id="5006273">++</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5006278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5006281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006284">return</span>&nbsp;<span class="ident" id="5006291">list</span><span class="op" id="5006295">[</span><span class="num" id="5006296">0</span><span class="op" id="5006297">:</span><span class="ident" id="5006298">j</span><span class="op" id="5006299">]</span><br>
<span class="lineno"></span><span class="op" id="5006301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5006304">//&nbsp;fieldName&nbsp;assumes&nbsp;that&nbsp;x&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;an&nbsp;anonymous&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5006370">//&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;field&nbsp;name.&nbsp;If&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;acceptable</span><br>
<span class="lineno"></span><span class="comment" id="5006437">//&nbsp;anonymous&nbsp;field,&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="5006476">//</span><br>
<span class="lineno"></span><span class="keyword" id="5006479">func</span>&nbsp;<span class="ident" id="5006484">fieldName</span><span class="op" id="5006493">(</span><span class="ident" id="5006494">x</span>&nbsp;<span class="ident" id="5006496">Expr</span><span class="op" id="5006500">)</span>&nbsp;<span class="op" id="5006502">*</span><span class="ident" id="5006503">Ident</span>&nbsp;<span class="op" id="5006509">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006512">switch</span>&nbsp;<span class="ident" id="5006519">t</span>&nbsp;<span class="op" id="5006521">:=</span>&nbsp;<span class="ident" id="5006524">x</span><span class="op" id="5006525">.</span><span class="op" id="5006526">(</span><span class="keyword" id="5006527">type</span><span class="op" id="5006531">)</span>&nbsp;<span class="op" id="5006533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006536">case</span>&nbsp;<span class="op" id="5006541">*</span><span class="ident" id="5006542">Ident</span><span class="op" id="5006547">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006551">return</span>&nbsp;<span class="ident" id="5006558">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006561">case</span>&nbsp;<span class="op" id="5006566">*</span><span class="ident" id="5006567">SelectorExpr</span><span class="op" id="5006579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006583">if</span>&nbsp;<span class="ident" id="5006586">_</span><span class="op" id="5006587">,</span>&nbsp;<span class="ident" id="5006589">ok</span>&nbsp;<span class="op" id="5006592">:=</span>&nbsp;<span class="ident" id="5006595">t</span><span class="op" id="5006596">.</span><span class="ident" id="5006597">X</span><span class="op" id="5006598">.</span><span class="op" id="5006599">(</span><span class="op" id="5006600">*</span><span class="ident" id="5006601">Ident</span><span class="op" id="5006606">)</span><span class="op" id="5006607">;</span>&nbsp;<span class="ident" id="5006609">ok</span>&nbsp;<span class="op" id="5006612">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006617">return</span>&nbsp;<span class="ident" id="5006624">t</span><span class="op" id="5006625">.</span><span class="ident" id="5006626">Sel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5006632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006635">case</span>&nbsp;<span class="op" id="5006640">*</span><span class="ident" id="5006641">StarExpr</span><span class="op" id="5006649">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006653">return</span>&nbsp;<span class="ident" id="5006660">fieldName</span><span class="op" id="5006669">(</span><span class="ident" id="5006670">t</span><span class="op" id="5006671">.</span><span class="ident" id="5006672">X</span><span class="op" id="5006673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5006676">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006679">return</span>&nbsp;<span class="ident" id="5006686">nil</span><br>
<span class="lineno"></span><span class="op" id="5006690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5006693">func</span>&nbsp;<span class="ident" id="5006698">filterFieldList</span><span class="op" id="5006713">(</span><span class="ident" id="5006714">fields</span>&nbsp;<span class="op" id="5006721">*</span><span class="ident" id="5006722">FieldList</span><span class="op" id="5006731">,</span>&nbsp;<span class="ident" id="5006733">filter</span>&nbsp;<span class="ident" id="5006740">Filter</span><span class="op" id="5006746">,</span>&nbsp;<span class="ident" id="5006748">export</span>&nbsp;<span class="builtintype" id="5006755">bool</span><span class="op" id="5006759">)</span>&nbsp;<span class="op" id="5006761">(</span><span class="ident" id="5006762">removedFields</span>&nbsp;<span class="builtintype" id="5006776">bool</span><span class="op" id="5006780">)</span>&nbsp;<span class="op" id="5006782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006785">if</span>&nbsp;<span class="ident" id="5006788">fields</span>&nbsp;<span class="op" id="5006795">==</span>&nbsp;<span class="ident" id="5006798">nil</span>&nbsp;<span class="op" id="5006802">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006806">return</span>&nbsp;<span class="ident" id="5006813">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5006820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006823">list</span>&nbsp;<span class="op" id="5006828">:=</span>&nbsp;<span class="ident" id="5006831">fields</span><span class="op" id="5006837">.</span><span class="ident" id="5006838">List</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006844">j</span>&nbsp;<span class="op" id="5006846">:=</span>&nbsp;<span class="num" id="5006849">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006852">for</span>&nbsp;<span class="ident" id="5006856">_</span><span class="op" id="5006857">,</span>&nbsp;<span class="ident" id="5006859">f</span>&nbsp;<span class="op" id="5006861">:=</span>&nbsp;<span class="keyword" id="5006864">range</span>&nbsp;<span class="ident" id="5006870">list</span>&nbsp;<span class="op" id="5006875">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006879">keepField</span>&nbsp;<span class="op" id="5006889">:=</span>&nbsp;<span class="ident" id="5006892">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006900">if</span>&nbsp;<span class="builtinfunc" id="5006903">len</span><span class="op" id="5006906">(</span><span class="ident" id="5006907">f</span><span class="op" id="5006908">.</span><span class="ident" id="5006909">Names</span><span class="op" id="5006914">)</span>&nbsp;<span class="op" id="5006916">==</span>&nbsp;<span class="num" id="5006919">0</span>&nbsp;<span class="op" id="5006921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5006926">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006948">name</span>&nbsp;<span class="op" id="5006953">:=</span>&nbsp;<span class="ident" id="5006956">fieldName</span><span class="op" id="5006965">(</span><span class="ident" id="5006966">f</span><span class="op" id="5006967">.</span><span class="ident" id="5006968">Type</span><span class="op" id="5006972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006977">keepField</span>&nbsp;<span class="op" id="5006987">=</span>&nbsp;<span class="ident" id="5006989">name</span>&nbsp;<span class="op" id="5006994">!=</span>&nbsp;<span class="ident" id="5006997">nil</span>&nbsp;<span class="op" id="5007001">&amp;&amp;</span>&nbsp;<span class="ident" id="5007004">filter</span><span class="op" id="5007010">(</span><span class="ident" id="5007011">name</span><span class="op" id="5007015">.</span><span class="ident" id="5007016">Name</span><span class="op" id="5007020">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5007024">}</span>&nbsp;<span class="keyword" id="5007026">else</span>&nbsp;<span class="op" id="5007031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007036">n</span>&nbsp;<span class="op" id="5007038">:=</span>&nbsp;<span class="builtinfunc" id="5007041">len</span><span class="op" id="5007044">(</span><span class="ident" id="5007045">f</span><span class="op" id="5007046">.</span><span class="ident" id="5007047">Names</span><span class="op" id="5007052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007057">f</span><span class="op" id="5007058">.</span><span class="ident" id="5007059">Names</span>&nbsp;<span class="op" id="5007065">=</span>&nbsp;<span class="ident" id="5007067">filterIdentList</span><span class="op" id="5007082">(</span><span class="ident" id="5007083">f</span><span class="op" id="5007084">.</span><span class="ident" id="5007085">Names</span><span class="op" id="5007090">,</span>&nbsp;<span class="ident" id="5007092">filter</span><span class="op" id="5007098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007103">if</span>&nbsp;<span class="builtinfunc" id="5007106">len</span><span class="op" id="5007109">(</span><span class="ident" id="5007110">f</span><span class="op" id="5007111">.</span><span class="ident" id="5007112">Names</span><span class="op" id="5007117">)</span>&nbsp;<span class="op" id="5007119">&lt;</span>&nbsp;<span class="ident" id="5007121">n</span>&nbsp;<span class="op" id="5007123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007129">removedFields</span>&nbsp;<span class="op" id="5007143">=</span>&nbsp;<span class="ident" id="5007145">true</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5007153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007158">keepField</span>&nbsp;<span class="op" id="5007168">=</span>&nbsp;<span class="builtinfunc" id="5007170">len</span><span class="op" id="5007173">(</span><span class="ident" id="5007174">f</span><span class="op" id="5007175">.</span><span class="ident" id="5007176">Names</span><span class="op" id="5007181">)</span>&nbsp;<span class="op" id="5007183">&gt;</span>&nbsp;<span class="num" id="5007185">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5007189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007193">if</span>&nbsp;<span class="ident" id="5007196">keepField</span>&nbsp;<span class="op" id="5007206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007211">if</span>&nbsp;<span class="ident" id="5007214">export</span>&nbsp;<span class="op" id="5007221">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007227">filterType</span><span class="op" id="5007237">(</span><span class="ident" id="5007238">f</span><span class="op" id="5007239">.</span><span class="ident" id="5007240">Type</span><span class="op" id="5007244">,</span>&nbsp;<span class="ident" id="5007246">filter</span><span class="op" id="5007252">,</span>&nbsp;<span class="ident" id="5007254">export</span><span class="op" id="5007260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5007265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007270">list</span><span class="op" id="5007274">[</span><span class="ident" id="5007275">j</span><span class="op" id="5007276">]</span>&nbsp;<span class="op" id="5007278">=</span>&nbsp;<span class="ident" id="5007280">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007285">j</span><span class="op" id="5007286">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5007291">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5007294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007297">if</span>&nbsp;<span class="ident" id="5007300">j</span>&nbsp;<span class="op" id="5007302">&lt;</span>&nbsp;<span class="builtinfunc" id="5007304">len</span><span class="op" id="5007307">(</span><span class="ident" id="5007308">list</span><span class="op" id="5007312">)</span>&nbsp;<span class="op" id="5007314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007318">removedFields</span>&nbsp;<span class="op" id="5007332">=</span>&nbsp;<span class="ident" id="5007334">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5007340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007343">fields</span><span class="op" id="5007349">.</span><span class="ident" id="5007350">List</span>&nbsp;<span class="op" id="5007355">=</span>&nbsp;<span class="ident" id="5007357">list</span><span class="op" id="5007361">[</span><span class="num" id="5007362">0</span><span class="op" id="5007363">:</span><span class="ident" id="5007364">j</span><span class="op" id="5007365">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007368">return</span><br>
<span class="lineno"></span><span class="op" id="5007375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5007378">func</span>&nbsp;<span class="ident" id="5007383">filterParamList</span><span class="op" id="5007398">(</span><span class="ident" id="5007399">fields</span>&nbsp;<span class="op" id="5007406">*</span><span class="ident" id="5007407">FieldList</span><span class="op" id="5007416">,</span>&nbsp;<span class="ident" id="5007418">filter</span>&nbsp;<span class="ident" id="5007425">Filter</span><span class="op" id="5007431">,</span>&nbsp;<span class="ident" id="5007433">export</span>&nbsp;<span class="builtintype" id="5007440">bool</span><span class="op" id="5007444">)</span>&nbsp;<span class="builtintype" id="5007446">bool</span>&nbsp;<span class="op" id="5007451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007454">if</span>&nbsp;<span class="ident" id="5007457">fields</span>&nbsp;<span class="op" id="5007464">==</span>&nbsp;<span class="ident" id="5007467">nil</span>&nbsp;<span class="op" id="5007471">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007475">return</span>&nbsp;<span class="ident" id="5007482">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5007489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007492">var</span>&nbsp;<span class="ident" id="5007496">b</span>&nbsp;<span class="builtintype" id="5007498">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007504">for</span>&nbsp;<span class="ident" id="5007508">_</span><span class="op" id="5007509">,</span>&nbsp;<span class="ident" id="5007511">f</span>&nbsp;<span class="op" id="5007513">:=</span>&nbsp;<span class="keyword" id="5007516">range</span>&nbsp;<span class="ident" id="5007522">fields</span><span class="op" id="5007528">.</span><span class="ident" id="5007529">List</span>&nbsp;<span class="op" id="5007534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007538">if</span>&nbsp;<span class="ident" id="5007541">filterType</span><span class="op" id="5007551">(</span><span class="ident" id="5007552">f</span><span class="op" id="5007553">.</span><span class="ident" id="5007554">Type</span><span class="op" id="5007558">,</span>&nbsp;<span class="ident" id="5007560">filter</span><span class="op" id="5007566">,</span>&nbsp;<span class="ident" id="5007568">export</span><span class="op" id="5007574">)</span>&nbsp;<span class="op" id="5007576">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007581">b</span>&nbsp;<span class="op" id="5007583">=</span>&nbsp;<span class="ident" id="5007585">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5007592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5007595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007598">return</span>&nbsp;<span class="ident" id="5007605">b</span><br>
<span class="lineno"></span><span class="op" id="5007607">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="5007610">func</span>&nbsp;<span class="ident" id="5007615">filterType</span><span class="op" id="5007625">(</span><span class="ident" id="5007626">typ</span>&nbsp;<span class="ident" id="5007630">Expr</span><span class="op" id="5007634">,</span>&nbsp;<span class="ident" id="5007636">f</span>&nbsp;<span class="ident" id="5007638">Filter</span><span class="op" id="5007644">,</span>&nbsp;<span class="ident" id="5007646">export</span>&nbsp;<span class="builtintype" id="5007653">bool</span><span class="op" id="5007657">)</span>&nbsp;<span class="builtintype" id="5007659">bool</span>&nbsp;<span class="op" id="5007664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007667">switch</span>&nbsp;<span class="ident" id="5007674">t</span>&nbsp;<span class="op" id="5007676">:=</span>&nbsp;<span class="ident" id="5007679">typ</span><span class="op" id="5007682">.</span><span class="op" id="5007683">(</span><span class="keyword" id="5007684">type</span><span class="op" id="5007688">)</span>&nbsp;<span class="op" id="5007690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007693">case</span>&nbsp;<span class="op" id="5007698">*</span><span class="ident" id="5007699">Ident</span><span class="op" id="5007704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007708">return</span>&nbsp;<span class="ident" id="5007715">f</span><span class="op" id="5007716">(</span><span class="ident" id="5007717">t</span><span class="op" id="5007718">.</span><span class="ident" id="5007719">Name</span><span class="op" id="5007723">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007726">case</span>&nbsp;<span class="op" id="5007731">*</span><span class="ident" id="5007732">ParenExpr</span><span class="op" id="5007741">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007745">return</span>&nbsp;<span class="ident" id="5007752">filterType</span><span class="op" id="5007762">(</span><span class="ident" id="5007763">t</span><span class="op" id="5007764">.</span><span class="ident" id="5007765">X</span><span class="op" id="5007766">,</span>&nbsp;<span class="ident" id="5007768">f</span><span class="op" id="5007769">,</span>&nbsp;<span class="ident" id="5007771">export</span><span class="op" id="5007777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007780">case</span>&nbsp;<span class="op" id="5007785">*</span><span class="ident" id="5007786">ArrayType</span><span class="op" id="5007795">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007799">return</span>&nbsp;<span class="ident" id="5007806">filterType</span><span class="op" id="5007816">(</span><span class="ident" id="5007817">t</span><span class="op" id="5007818">.</span><span class="ident" id="5007819">Elt</span><span class="op" id="5007822">,</span>&nbsp;<span class="ident" id="5007824">f</span><span class="op" id="5007825">,</span>&nbsp;<span class="ident" id="5007827">export</span><span class="op" id="5007833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007836">case</span>&nbsp;<span class="op" id="5007841">*</span><span class="ident" id="5007842">StructType</span><span class="op" id="5007852">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007856">if</span>&nbsp;<span class="ident" id="5007859">filterFieldList</span><span class="op" id="5007874">(</span><span class="ident" id="5007875">t</span><span class="op" id="5007876">.</span><span class="ident" id="5007877">Fields</span><span class="op" id="5007883">,</span>&nbsp;<span class="ident" id="5007885">f</span><span class="op" id="5007886">,</span>&nbsp;<span class="ident" id="5007888">export</span><span class="op" id="5007894">)</span>&nbsp;<span class="op" id="5007896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007901">t</span><span class="op" id="5007902">.</span><span class="ident" id="5007903">Incomplete</span>&nbsp;<span class="op" id="5007914">=</span>&nbsp;<span class="ident" id="5007916">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5007923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007927">return</span>&nbsp;<span class="builtinfunc" id="5007934">len</span><span class="op" id="5007937">(</span><span class="ident" id="5007938">t</span><span class="op" id="5007939">.</span><span class="ident" id="5007940">Fields</span><span class="op" id="5007946">.</span><span class="ident" id="5007947">List</span><span class="op" id="5007951">)</span>&nbsp;<span class="op" id="5007953">&gt;</span>&nbsp;<span class="num" id="5007955">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007958">case</span>&nbsp;<span class="op" id="5007963">*</span><span class="ident" id="5007964">FuncType</span><span class="op" id="5007972">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007976">b1</span>&nbsp;<span class="op" id="5007979">:=</span>&nbsp;<span class="ident" id="5007982">filterParamList</span><span class="op" id="5007997">(</span><span class="ident" id="5007998">t</span><span class="op" id="5007999">.</span><span class="ident" id="5008000">Params</span><span class="op" id="5008006">,</span>&nbsp;<span class="ident" id="5008008">f</span><span class="op" id="5008009">,</span>&nbsp;<span class="ident" id="5008011">export</span><span class="op" id="5008017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008021">b2</span>&nbsp;<span class="op" id="5008024">:=</span>&nbsp;<span class="ident" id="5008027">filterParamList</span><span class="op" id="5008042">(</span><span class="ident" id="5008043">t</span><span class="op" id="5008044">.</span><span class="ident" id="5008045">Results</span><span class="op" id="5008052">,</span>&nbsp;<span class="ident" id="5008054">f</span><span class="op" id="5008055">,</span>&nbsp;<span class="ident" id="5008057">export</span><span class="op" id="5008063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008067">return</span>&nbsp;<span class="ident" id="5008074">b1</span>&nbsp;<span class="op" id="5008077">||</span>&nbsp;<span class="ident" id="5008080">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008084">case</span>&nbsp;<span class="op" id="5008089">*</span><span class="ident" id="5008090">InterfaceType</span><span class="op" id="5008103">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008107">if</span>&nbsp;<span class="ident" id="5008110">filterFieldList</span><span class="op" id="5008125">(</span><span class="ident" id="5008126">t</span><span class="op" id="5008127">.</span><span class="ident" id="5008128">Methods</span><span class="op" id="5008135">,</span>&nbsp;<span class="ident" id="5008137">f</span><span class="op" id="5008138">,</span>&nbsp;<span class="ident" id="5008140">export</span><span class="op" id="5008146">)</span>&nbsp;<span class="op" id="5008148">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008153">t</span><span class="op" id="5008154">.</span><span class="ident" id="5008155">Incomplete</span>&nbsp;<span class="op" id="5008166">=</span>&nbsp;<span class="ident" id="5008168">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008179">return</span>&nbsp;<span class="builtinfunc" id="5008186">len</span><span class="op" id="5008189">(</span><span class="ident" id="5008190">t</span><span class="op" id="5008191">.</span><span class="ident" id="5008192">Methods</span><span class="op" id="5008199">.</span><span class="ident" id="5008200">List</span><span class="op" id="5008204">)</span>&nbsp;<span class="op" id="5008206">&gt;</span>&nbsp;<span class="num" id="5008208">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008211">case</span>&nbsp;<span class="op" id="5008216">*</span><span class="ident" id="5008217">MapType</span><span class="op" id="5008224">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008228">b1</span>&nbsp;<span class="op" id="5008231">:=</span>&nbsp;<span class="ident" id="5008234">filterType</span><span class="op" id="5008244">(</span><span class="ident" id="5008245">t</span><span class="op" id="5008246">.</span><span class="ident" id="5008247">Key</span><span class="op" id="5008250">,</span>&nbsp;<span class="ident" id="5008252">f</span><span class="op" id="5008253">,</span>&nbsp;<span class="ident" id="5008255">export</span><span class="op" id="5008261">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008265">b2</span>&nbsp;<span class="op" id="5008268">:=</span>&nbsp;<span class="ident" id="5008271">filterType</span><span class="op" id="5008281">(</span><span class="ident" id="5008282">t</span><span class="op" id="5008283">.</span><span class="ident" id="5008284">Value</span><span class="op" id="5008289">,</span>&nbsp;<span class="ident" id="5008291">f</span><span class="op" id="5008292">,</span>&nbsp;<span class="ident" id="5008294">export</span><span class="op" id="5008300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008304">return</span>&nbsp;<span class="ident" id="5008311">b1</span>&nbsp;<span class="op" id="5008314">||</span>&nbsp;<span class="ident" id="5008317">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008321">case</span>&nbsp;<span class="op" id="5008326">*</span><span class="ident" id="5008327">ChanType</span><span class="op" id="5008335">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008339">return</span>&nbsp;<span class="ident" id="5008346">filterType</span><span class="op" id="5008356">(</span><span class="ident" id="5008357">t</span><span class="op" id="5008358">.</span><span class="ident" id="5008359">Value</span><span class="op" id="5008364">,</span>&nbsp;<span class="ident" id="5008366">f</span><span class="op" id="5008367">,</span>&nbsp;<span class="ident" id="5008369">export</span><span class="op" id="5008375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008378">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008381">return</span>&nbsp;<span class="ident" id="5008388">false</span><br>
<span class="lineno"></span><span class="op" id="5008394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5008397">func</span>&nbsp;<span class="ident" id="5008402">filterSpec</span><span class="op" id="5008412">(</span><span class="ident" id="5008413">spec</span>&nbsp;<span class="ident" id="5008418">Spec</span><span class="op" id="5008422">,</span>&nbsp;<span class="ident" id="5008424">f</span>&nbsp;<span class="ident" id="5008426">Filter</span><span class="op" id="5008432">,</span>&nbsp;<span class="ident" id="5008434">export</span>&nbsp;<span class="builtintype" id="5008441">bool</span><span class="op" id="5008445">)</span>&nbsp;<span class="builtintype" id="5008447">bool</span>&nbsp;<span class="op" id="5008452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008455">switch</span>&nbsp;<span class="ident" id="5008462">s</span>&nbsp;<span class="op" id="5008464">:=</span>&nbsp;<span class="ident" id="5008467">spec</span><span class="op" id="5008471">.</span><span class="op" id="5008472">(</span><span class="keyword" id="5008473">type</span><span class="op" id="5008477">)</span>&nbsp;<span class="op" id="5008479">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008482">case</span>&nbsp;<span class="op" id="5008487">*</span><span class="ident" id="5008488">ValueSpec</span><span class="op" id="5008497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008501">s</span><span class="op" id="5008502">.</span><span class="ident" id="5008503">Names</span>&nbsp;<span class="op" id="5008509">=</span>&nbsp;<span class="ident" id="5008511">filterIdentList</span><span class="op" id="5008526">(</span><span class="ident" id="5008527">s</span><span class="op" id="5008528">.</span><span class="ident" id="5008529">Names</span><span class="op" id="5008534">,</span>&nbsp;<span class="ident" id="5008536">f</span><span class="op" id="5008537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008541">if</span>&nbsp;<span class="builtinfunc" id="5008544">len</span><span class="op" id="5008547">(</span><span class="ident" id="5008548">s</span><span class="op" id="5008549">.</span><span class="ident" id="5008550">Names</span><span class="op" id="5008555">)</span>&nbsp;<span class="op" id="5008557">&gt;</span>&nbsp;<span class="num" id="5008559">0</span>&nbsp;<span class="op" id="5008561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008566">if</span>&nbsp;<span class="ident" id="5008569">export</span>&nbsp;<span class="op" id="5008576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008582">filterType</span><span class="op" id="5008592">(</span><span class="ident" id="5008593">s</span><span class="op" id="5008594">.</span><span class="ident" id="5008595">Type</span><span class="op" id="5008599">,</span>&nbsp;<span class="ident" id="5008601">f</span><span class="op" id="5008602">,</span>&nbsp;<span class="ident" id="5008604">export</span><span class="op" id="5008610">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008620">return</span>&nbsp;<span class="ident" id="5008627">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008637">case</span>&nbsp;<span class="op" id="5008642">*</span><span class="ident" id="5008643">TypeSpec</span><span class="op" id="5008651">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008655">if</span>&nbsp;<span class="ident" id="5008658">f</span><span class="op" id="5008659">(</span><span class="ident" id="5008660">s</span><span class="op" id="5008661">.</span><span class="ident" id="5008662">Name</span><span class="op" id="5008666">.</span><span class="ident" id="5008667">Name</span><span class="op" id="5008671">)</span>&nbsp;<span class="op" id="5008673">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008678">if</span>&nbsp;<span class="ident" id="5008681">export</span>&nbsp;<span class="op" id="5008688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008694">filterType</span><span class="op" id="5008704">(</span><span class="ident" id="5008705">s</span><span class="op" id="5008706">.</span><span class="ident" id="5008707">Type</span><span class="op" id="5008711">,</span>&nbsp;<span class="ident" id="5008713">f</span><span class="op" id="5008714">,</span>&nbsp;<span class="ident" id="5008716">export</span><span class="op" id="5008722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008732">return</span>&nbsp;<span class="ident" id="5008739">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008746">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008750">if</span>&nbsp;<span class="op" id="5008753">!</span><span class="ident" id="5008754">export</span>&nbsp;<span class="op" id="5008761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008766">//&nbsp;For&nbsp;general&nbsp;filtering&nbsp;(not&nbsp;just&nbsp;exports),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008814">//&nbsp;filter&nbsp;type&nbsp;even&nbsp;if&nbsp;name&nbsp;is&nbsp;not&nbsp;filtered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008861">//&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008872">//&nbsp;If&nbsp;the&nbsp;type&nbsp;contains&nbsp;filtered&nbsp;elements,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008918">//&nbsp;keep&nbsp;the&nbsp;declaration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008946">return</span>&nbsp;<span class="ident" id="5008953">filterType</span><span class="op" id="5008963">(</span><span class="ident" id="5008964">s</span><span class="op" id="5008965">.</span><span class="ident" id="5008966">Type</span><span class="op" id="5008970">,</span>&nbsp;<span class="ident" id="5008972">f</span><span class="op" id="5008973">,</span>&nbsp;<span class="ident" id="5008975">export</span><span class="op" id="5008981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008991">return</span>&nbsp;<span class="ident" id="5008998">false</span><br>
<span class="lineno">185</span><span class="op" id="5009004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5009007">func</span>&nbsp;<span class="ident" id="5009012">filterSpecList</span><span class="op" id="5009026">(</span><span class="ident" id="5009027">list</span>&nbsp;<span class="op" id="5009032">[</span><span class="op" id="5009033">]</span><span class="ident" id="5009034">Spec</span><span class="op" id="5009038">,</span>&nbsp;<span class="ident" id="5009040">f</span>&nbsp;<span class="ident" id="5009042">Filter</span><span class="op" id="5009048">,</span>&nbsp;<span class="ident" id="5009050">export</span>&nbsp;<span class="builtintype" id="5009057">bool</span><span class="op" id="5009061">)</span>&nbsp;<span class="op" id="5009063">[</span><span class="op" id="5009064">]</span><span class="ident" id="5009065">Spec</span>&nbsp;<span class="op" id="5009070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009073">j</span>&nbsp;<span class="op" id="5009075">:=</span>&nbsp;<span class="num" id="5009078">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009081">for</span>&nbsp;<span class="ident" id="5009085">_</span><span class="op" id="5009086">,</span>&nbsp;<span class="ident" id="5009088">s</span>&nbsp;<span class="op" id="5009090">:=</span>&nbsp;<span class="keyword" id="5009093">range</span>&nbsp;<span class="ident" id="5009099">list</span>&nbsp;<span class="op" id="5009104">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009108">if</span>&nbsp;<span class="ident" id="5009111">filterSpec</span><span class="op" id="5009121">(</span><span class="ident" id="5009122">s</span><span class="op" id="5009123">,</span>&nbsp;<span class="ident" id="5009125">f</span><span class="op" id="5009126">,</span>&nbsp;<span class="ident" id="5009128">export</span><span class="op" id="5009134">)</span>&nbsp;<span class="op" id="5009136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009141">list</span><span class="op" id="5009145">[</span><span class="ident" id="5009146">j</span><span class="op" id="5009147">]</span>&nbsp;<span class="op" id="5009149">=</span>&nbsp;<span class="ident" id="5009151">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009156">j</span><span class="op" id="5009157">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5009162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5009165">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009168">return</span>&nbsp;<span class="ident" id="5009175">list</span><span class="op" id="5009179">[</span><span class="num" id="5009180">0</span><span class="op" id="5009181">:</span><span class="ident" id="5009182">j</span><span class="op" id="5009183">]</span><br>
<span class="lineno"></span><span class="op" id="5009185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5009188">//&nbsp;FilterDecl&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;declaration&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="5009258">//&nbsp;all&nbsp;names&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but</span><br>
<span class="lineno">200</span><span class="comment" id="5009327">//&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="5009394">//</span><br>
<span class="lineno"></span><span class="comment" id="5009397">//&nbsp;FilterDecl&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;declared&nbsp;names&nbsp;left&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="5009467">//&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5009509">//</span><br>
<span class="lineno">205</span><span class="keyword" id="5009512">func</span>&nbsp;<span class="ident" id="5009517">FilterDecl</span><span class="op" id="5009527">(</span><span class="ident" id="5009528">decl</span>&nbsp;<span class="ident" id="5009533">Decl</span><span class="op" id="5009537">,</span>&nbsp;<span class="ident" id="5009539">f</span>&nbsp;<span class="ident" id="5009541">Filter</span><span class="op" id="5009547">)</span>&nbsp;<span class="builtintype" id="5009549">bool</span>&nbsp;<span class="op" id="5009554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009557">return</span>&nbsp;<span class="ident" id="5009564">filterDecl</span><span class="op" id="5009574">(</span><span class="ident" id="5009575">decl</span><span class="op" id="5009579">,</span>&nbsp;<span class="ident" id="5009581">f</span><span class="op" id="5009582">,</span>&nbsp;<span class="ident" id="5009584">false</span><span class="op" id="5009589">)</span><br>
<span class="lineno"></span><span class="op" id="5009591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5009594">func</span>&nbsp;<span class="ident" id="5009599">filterDecl</span><span class="op" id="5009609">(</span><span class="ident" id="5009610">decl</span>&nbsp;<span class="ident" id="5009615">Decl</span><span class="op" id="5009619">,</span>&nbsp;<span class="ident" id="5009621">f</span>&nbsp;<span class="ident" id="5009623">Filter</span><span class="op" id="5009629">,</span>&nbsp;<span class="ident" id="5009631">export</span>&nbsp;<span class="builtintype" id="5009638">bool</span><span class="op" id="5009642">)</span>&nbsp;<span class="builtintype" id="5009644">bool</span>&nbsp;<span class="op" id="5009649">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009652">switch</span>&nbsp;<span class="ident" id="5009659">d</span>&nbsp;<span class="op" id="5009661">:=</span>&nbsp;<span class="ident" id="5009664">decl</span><span class="op" id="5009668">.</span><span class="op" id="5009669">(</span><span class="keyword" id="5009670">type</span><span class="op" id="5009674">)</span>&nbsp;<span class="op" id="5009676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009679">case</span>&nbsp;<span class="op" id="5009684">*</span><span class="ident" id="5009685">GenDecl</span><span class="op" id="5009692">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009696">d</span><span class="op" id="5009697">.</span><span class="ident" id="5009698">Specs</span>&nbsp;<span class="op" id="5009704">=</span>&nbsp;<span class="ident" id="5009706">filterSpecList</span><span class="op" id="5009720">(</span><span class="ident" id="5009721">d</span><span class="op" id="5009722">.</span><span class="ident" id="5009723">Specs</span><span class="op" id="5009728">,</span>&nbsp;<span class="ident" id="5009730">f</span><span class="op" id="5009731">,</span>&nbsp;<span class="ident" id="5009733">export</span><span class="op" id="5009739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009743">return</span>&nbsp;<span class="builtinfunc" id="5009750">len</span><span class="op" id="5009753">(</span><span class="ident" id="5009754">d</span><span class="op" id="5009755">.</span><span class="ident" id="5009756">Specs</span><span class="op" id="5009761">)</span>&nbsp;<span class="op" id="5009763">&gt;</span>&nbsp;<span class="num" id="5009765">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009768">case</span>&nbsp;<span class="op" id="5009773">*</span><span class="ident" id="5009774">FuncDecl</span><span class="op" id="5009782">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009786">return</span>&nbsp;<span class="ident" id="5009793">f</span><span class="op" id="5009794">(</span><span class="ident" id="5009795">d</span><span class="op" id="5009796">.</span><span class="ident" id="5009797">Name</span><span class="op" id="5009801">.</span><span class="ident" id="5009802">Name</span><span class="op" id="5009806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5009809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009812">return</span>&nbsp;<span class="ident" id="5009819">false</span><br>
<span class="lineno"></span><span class="op" id="5009825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="5009828">//&nbsp;FilterFile&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;file&nbsp;in&nbsp;place&nbsp;by&nbsp;removing&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="5009895">//&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5009960">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5010028">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno"></span><span class="comment" id="5010098">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;File.Comments&nbsp;list</span><br>
<span class="lineno">225</span><span class="comment" id="5010165">//&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno"></span><span class="comment" id="5010184">//</span><br>
<span class="lineno"></span><span class="comment" id="5010187">//&nbsp;FilterFile&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno"></span><span class="comment" id="5010254">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5010307">//</span><br>
<span class="lineno">230</span><span class="keyword" id="5010310">func</span>&nbsp;<span class="ident" id="5010315">FilterFile</span><span class="op" id="5010325">(</span><span class="ident" id="5010326">src</span>&nbsp;<span class="op" id="5010330">*</span><span class="ident" id="5010331">File</span><span class="op" id="5010335">,</span>&nbsp;<span class="ident" id="5010337">f</span>&nbsp;<span class="ident" id="5010339">Filter</span><span class="op" id="5010345">)</span>&nbsp;<span class="builtintype" id="5010347">bool</span>&nbsp;<span class="op" id="5010352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010355">return</span>&nbsp;<span class="ident" id="5010362">filterFile</span><span class="op" id="5010372">(</span><span class="ident" id="5010373">src</span><span class="op" id="5010376">,</span>&nbsp;<span class="ident" id="5010378">f</span><span class="op" id="5010379">,</span>&nbsp;<span class="ident" id="5010381">false</span><span class="op" id="5010386">)</span><br>
<span class="lineno"></span><span class="op" id="5010388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5010391">func</span>&nbsp;<span class="ident" id="5010396">filterFile</span><span class="op" id="5010406">(</span><span class="ident" id="5010407">src</span>&nbsp;<span class="op" id="5010411">*</span><span class="ident" id="5010412">File</span><span class="op" id="5010416">,</span>&nbsp;<span class="ident" id="5010418">f</span>&nbsp;<span class="ident" id="5010420">Filter</span><span class="op" id="5010426">,</span>&nbsp;<span class="ident" id="5010428">export</span>&nbsp;<span class="builtintype" id="5010435">bool</span><span class="op" id="5010439">)</span>&nbsp;<span class="builtintype" id="5010441">bool</span>&nbsp;<span class="op" id="5010446">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010449">j</span>&nbsp;<span class="op" id="5010451">:=</span>&nbsp;<span class="num" id="5010454">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010457">for</span>&nbsp;<span class="ident" id="5010461">_</span><span class="op" id="5010462">,</span>&nbsp;<span class="ident" id="5010464">d</span>&nbsp;<span class="op" id="5010466">:=</span>&nbsp;<span class="keyword" id="5010469">range</span>&nbsp;<span class="ident" id="5010475">src</span><span class="op" id="5010478">.</span><span class="ident" id="5010479">Decls</span>&nbsp;<span class="op" id="5010485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010489">if</span>&nbsp;<span class="ident" id="5010492">filterDecl</span><span class="op" id="5010502">(</span><span class="ident" id="5010503">d</span><span class="op" id="5010504">,</span>&nbsp;<span class="ident" id="5010506">f</span><span class="op" id="5010507">,</span>&nbsp;<span class="ident" id="5010509">export</span><span class="op" id="5010515">)</span>&nbsp;<span class="op" id="5010517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010522">src</span><span class="op" id="5010525">.</span><span class="ident" id="5010526">Decls</span><span class="op" id="5010531">[</span><span class="ident" id="5010532">j</span><span class="op" id="5010533">]</span>&nbsp;<span class="op" id="5010535">=</span>&nbsp;<span class="ident" id="5010537">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010542">j</span><span class="op" id="5010543">++</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010554">src</span><span class="op" id="5010557">.</span><span class="ident" id="5010558">Decls</span>&nbsp;<span class="op" id="5010564">=</span>&nbsp;<span class="ident" id="5010566">src</span><span class="op" id="5010569">.</span><span class="ident" id="5010570">Decls</span><span class="op" id="5010575">[</span><span class="num" id="5010576">0</span><span class="op" id="5010577">:</span><span class="ident" id="5010578">j</span><span class="op" id="5010579">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010582">return</span>&nbsp;<span class="ident" id="5010589">j</span>&nbsp;<span class="op" id="5010591">&gt;</span>&nbsp;<span class="num" id="5010593">0</span><br>
<span class="lineno"></span><span class="op" id="5010595">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="5010598">//&nbsp;FilterPackage&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="5010667">//&nbsp;all&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5010736">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5010804">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno">250</span><span class="comment" id="5010874">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5010944">//&nbsp;changed,&nbsp;so&nbsp;that&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get</span><br>
<span class="lineno"></span><span class="comment" id="5011016">//&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="5011025">//</span><br>
<span class="lineno"></span><span class="comment" id="5011028">//&nbsp;FilterPackage&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno">255</span><span class="comment" id="5011098">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5011151">//</span><br>
<span class="lineno"></span><span class="keyword" id="5011154">func</span>&nbsp;<span class="ident" id="5011159">FilterPackage</span><span class="op" id="5011172">(</span><span class="ident" id="5011173">pkg</span>&nbsp;<span class="op" id="5011177">*</span><span class="ident" id="5011178">Package</span><span class="op" id="5011185">,</span>&nbsp;<span class="ident" id="5011187">f</span>&nbsp;<span class="ident" id="5011189">Filter</span><span class="op" id="5011195">)</span>&nbsp;<span class="builtintype" id="5011197">bool</span>&nbsp;<span class="op" id="5011202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011205">return</span>&nbsp;<span class="ident" id="5011212">filterPackage</span><span class="op" id="5011225">(</span><span class="ident" id="5011226">pkg</span><span class="op" id="5011229">,</span>&nbsp;<span class="ident" id="5011231">f</span><span class="op" id="5011232">,</span>&nbsp;<span class="ident" id="5011234">false</span><span class="op" id="5011239">)</span><br>
<span class="lineno"></span><span class="op" id="5011241">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="5011244">func</span>&nbsp;<span class="ident" id="5011249">filterPackage</span><span class="op" id="5011262">(</span><span class="ident" id="5011263">pkg</span>&nbsp;<span class="op" id="5011267">*</span><span class="ident" id="5011268">Package</span><span class="op" id="5011275">,</span>&nbsp;<span class="ident" id="5011277">f</span>&nbsp;<span class="ident" id="5011279">Filter</span><span class="op" id="5011285">,</span>&nbsp;<span class="ident" id="5011287">export</span>&nbsp;<span class="builtintype" id="5011294">bool</span><span class="op" id="5011298">)</span>&nbsp;<span class="builtintype" id="5011300">bool</span>&nbsp;<span class="op" id="5011305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011308">hasDecls</span>&nbsp;<span class="op" id="5011317">:=</span>&nbsp;<span class="ident" id="5011320">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011327">for</span>&nbsp;<span class="ident" id="5011331">_</span><span class="op" id="5011332">,</span>&nbsp;<span class="ident" id="5011334">src</span>&nbsp;<span class="op" id="5011338">:=</span>&nbsp;<span class="keyword" id="5011341">range</span>&nbsp;<span class="ident" id="5011347">pkg</span><span class="op" id="5011350">.</span><span class="ident" id="5011351">Files</span>&nbsp;<span class="op" id="5011357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011361">if</span>&nbsp;<span class="ident" id="5011364">filterFile</span><span class="op" id="5011374">(</span><span class="ident" id="5011375">src</span><span class="op" id="5011378">,</span>&nbsp;<span class="ident" id="5011380">f</span><span class="op" id="5011381">,</span>&nbsp;<span class="ident" id="5011383">export</span><span class="op" id="5011389">)</span>&nbsp;<span class="op" id="5011391">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011396">hasDecls</span>&nbsp;<span class="op" id="5011405">=</span>&nbsp;<span class="ident" id="5011407">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011420">return</span>&nbsp;<span class="ident" id="5011427">hasDecls</span><br>
<span class="lineno"></span><span class="op" id="5011436">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="comment" id="5011439">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5011519">//&nbsp;Merging&nbsp;of&nbsp;package&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5011548">//&nbsp;The&nbsp;MergeMode&nbsp;flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;MergePackageFiles.</span><br>
<span class="lineno">275</span><span class="keyword" id="5011614">type</span>&nbsp;<span class="ident" id="5011619">MergeMode</span>&nbsp;<span class="builtintype" id="5011629">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5011635">const</span>&nbsp;<span class="op" id="5011641">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011644">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;function&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011702">FilterFuncDuplicates</span>&nbsp;<span class="ident" id="5011723">MergeMode</span>&nbsp;<span class="op" id="5011733">=</span>&nbsp;<span class="num" id="5011735">1</span>&nbsp;<span class="op" id="5011737">&lt;&lt;</span>&nbsp;<span class="ident" id="5011740">iota</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011746">//&nbsp;If&nbsp;set,&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;associated&nbsp;with&nbsp;a&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011807">//&nbsp;AST&nbsp;node&nbsp;(as&nbsp;Doc&nbsp;or&nbsp;Comment)&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011854">FilterUnassociatedComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011882">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;import&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011938">FilterImportDuplicates</span><br>
<span class="lineno">285</span><span class="op" id="5011961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5011964">//&nbsp;nameOf&nbsp;returns&nbsp;the&nbsp;function&nbsp;(foo)&nbsp;or&nbsp;method&nbsp;name&nbsp;(foo.bar)&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5012030">//&nbsp;the&nbsp;given&nbsp;function&nbsp;declaration.&nbsp;If&nbsp;the&nbsp;AST&nbsp;is&nbsp;incorrect&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5012097">//&nbsp;receiver,&nbsp;it&nbsp;assumes&nbsp;a&nbsp;function&nbsp;instead.</span><br>
<span class="lineno">290</span><span class="comment" id="5012141">//</span><br>
<span class="lineno"></span><span class="keyword" id="5012144">func</span>&nbsp;<span class="ident" id="5012149">nameOf</span><span class="op" id="5012155">(</span><span class="ident" id="5012156">f</span>&nbsp;<span class="op" id="5012158">*</span><span class="ident" id="5012159">FuncDecl</span><span class="op" id="5012167">)</span>&nbsp;<span class="builtintype" id="5012169">string</span>&nbsp;<span class="op" id="5012176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012179">if</span>&nbsp;<span class="ident" id="5012182">r</span>&nbsp;<span class="op" id="5012184">:=</span>&nbsp;<span class="ident" id="5012187">f</span><span class="op" id="5012188">.</span><span class="ident" id="5012189">Recv</span><span class="op" id="5012193">;</span>&nbsp;<span class="ident" id="5012195">r</span>&nbsp;<span class="op" id="5012197">!=</span>&nbsp;<span class="ident" id="5012200">nil</span>&nbsp;<span class="op" id="5012204">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5012207">len</span><span class="op" id="5012210">(</span><span class="ident" id="5012211">r</span><span class="op" id="5012212">.</span><span class="ident" id="5012213">List</span><span class="op" id="5012217">)</span>&nbsp;<span class="op" id="5012219">==</span>&nbsp;<span class="num" id="5012222">1</span>&nbsp;<span class="op" id="5012224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5012228">//&nbsp;looks&nbsp;like&nbsp;a&nbsp;correct&nbsp;receiver&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012275">t</span>&nbsp;<span class="op" id="5012277">:=</span>&nbsp;<span class="ident" id="5012280">r</span><span class="op" id="5012281">.</span><span class="ident" id="5012282">List</span><span class="op" id="5012286">[</span><span class="num" id="5012287">0</span><span class="op" id="5012288">]</span><span class="op" id="5012289">.</span><span class="ident" id="5012290">Type</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5012297">//&nbsp;dereference&nbsp;pointer&nbsp;receiver&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012337">if</span>&nbsp;<span class="ident" id="5012340">p</span><span class="op" id="5012341">,</span>&nbsp;<span class="ident" id="5012343">_</span>&nbsp;<span class="op" id="5012345">:=</span>&nbsp;<span class="ident" id="5012348">t</span><span class="op" id="5012349">.</span><span class="op" id="5012350">(</span><span class="op" id="5012351">*</span><span class="ident" id="5012352">StarExpr</span><span class="op" id="5012360">)</span><span class="op" id="5012361">;</span>&nbsp;<span class="ident" id="5012363">p</span>&nbsp;<span class="op" id="5012365">!=</span>&nbsp;<span class="ident" id="5012368">nil</span>&nbsp;<span class="op" id="5012372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012377">t</span>&nbsp;<span class="op" id="5012379">=</span>&nbsp;<span class="ident" id="5012381">p</span><span class="op" id="5012382">.</span><span class="ident" id="5012383">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5012391">//&nbsp;the&nbsp;receiver&nbsp;type&nbsp;must&nbsp;be&nbsp;a&nbsp;type&nbsp;name</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012434">if</span>&nbsp;<span class="ident" id="5012437">p</span><span class="op" id="5012438">,</span>&nbsp;<span class="ident" id="5012440">_</span>&nbsp;<span class="op" id="5012442">:=</span>&nbsp;<span class="ident" id="5012445">t</span><span class="op" id="5012446">.</span><span class="op" id="5012447">(</span><span class="op" id="5012448">*</span><span class="ident" id="5012449">Ident</span><span class="op" id="5012454">)</span><span class="op" id="5012455">;</span>&nbsp;<span class="ident" id="5012457">p</span>&nbsp;<span class="op" id="5012459">!=</span>&nbsp;<span class="ident" id="5012462">nil</span>&nbsp;<span class="op" id="5012466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012471">return</span>&nbsp;<span class="ident" id="5012478">p</span><span class="op" id="5012479">.</span><span class="ident" id="5012480">Name</span>&nbsp;<span class="op" id="5012485">+</span>&nbsp;<span class="string" id="5012487">&#34;.&#34;</span>&nbsp;<span class="op" id="5012491">+</span>&nbsp;<span class="ident" id="5012493">f</span><span class="op" id="5012494">.</span><span class="ident" id="5012495">Name</span><span class="op" id="5012499">.</span><span class="ident" id="5012500">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5012511">//&nbsp;otherwise&nbsp;assume&nbsp;a&nbsp;function&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012551">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012554">return</span>&nbsp;<span class="ident" id="5012561">f</span><span class="op" id="5012562">.</span><span class="ident" id="5012563">Name</span><span class="op" id="5012567">.</span><span class="ident" id="5012568">Name</span><br>
<span class="lineno"></span><span class="op" id="5012573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5012576">//&nbsp;separator&nbsp;is&nbsp;an&nbsp;empty&nbsp;//-style&nbsp;comment&nbsp;that&nbsp;is&nbsp;interspersed&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="5012647">//&nbsp;different&nbsp;comment&nbsp;groups&nbsp;when&nbsp;they&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single&nbsp;group</span><br>
<span class="lineno">310</span><span class="comment" id="5012722">//</span><br>
<span class="lineno"></span><span class="keyword" id="5012725">var</span>&nbsp;<span class="ident" id="5012729">separator</span>&nbsp;<span class="op" id="5012739">=</span>&nbsp;<span class="op" id="5012741">&amp;</span><span class="ident" id="5012742">Comment</span><span class="op" id="5012749">{</span><span class="ident" id="5012750">token</span><span class="op" id="5012755">.</span><span class="ident" id="5012756">NoPos</span><span class="op" id="5012761">,</span>&nbsp;<span class="string" id="5012763">&#34;//&#34;</span><span class="op" id="5012767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5012770">//&nbsp;MergePackageFiles&nbsp;creates&nbsp;a&nbsp;file&nbsp;AST&nbsp;by&nbsp;merging&nbsp;the&nbsp;ASTs&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5012837">//&nbsp;files&nbsp;belonging&nbsp;to&nbsp;a&nbsp;package.&nbsp;The&nbsp;mode&nbsp;flags&nbsp;control&nbsp;merging&nbsp;behavior.</span><br>
<span class="lineno">315</span><span class="comment" id="5012911">//</span><br>
<span class="lineno"></span><span class="keyword" id="5012914">func</span>&nbsp;<span class="ident" id="5012919">MergePackageFiles</span><span class="op" id="5012936">(</span><span class="ident" id="5012937">pkg</span>&nbsp;<span class="op" id="5012941">*</span><span class="ident" id="5012942">Package</span><span class="op" id="5012949">,</span>&nbsp;<span class="ident" id="5012951">mode</span>&nbsp;<span class="ident" id="5012956">MergeMode</span><span class="op" id="5012965">)</span>&nbsp;<span class="op" id="5012967">*</span><span class="ident" id="5012968">File</span>&nbsp;<span class="op" id="5012973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5012976">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;package&nbsp;docs,&nbsp;comments&nbsp;and&nbsp;declarations&nbsp;across</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5013047">//&nbsp;all&nbsp;package&nbsp;files.&nbsp;Also,&nbsp;compute&nbsp;sorted&nbsp;list&nbsp;of&nbsp;filenames,&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5013118">//&nbsp;subsequent&nbsp;iterations&nbsp;can&nbsp;always&nbsp;iterate&nbsp;in&nbsp;the&nbsp;same&nbsp;order.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013182">ndocs</span>&nbsp;<span class="op" id="5013188">:=</span>&nbsp;<span class="num" id="5013191">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013194">ncomments</span>&nbsp;<span class="op" id="5013204">:=</span>&nbsp;<span class="num" id="5013207">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013210">ndecls</span>&nbsp;<span class="op" id="5013217">:=</span>&nbsp;<span class="num" id="5013220">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013223">filenames</span>&nbsp;<span class="op" id="5013233">:=</span>&nbsp;<span class="builtinfunc" id="5013236">make</span><span class="op" id="5013240">(</span><span class="op" id="5013241">[</span><span class="op" id="5013242">]</span><span class="builtintype" id="5013243">string</span><span class="op" id="5013249">,</span>&nbsp;<span class="builtinfunc" id="5013251">len</span><span class="op" id="5013254">(</span><span class="ident" id="5013255">pkg</span><span class="op" id="5013258">.</span><span class="ident" id="5013259">Files</span><span class="op" id="5013264">)</span><span class="op" id="5013265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013268">i</span>&nbsp;<span class="op" id="5013270">:=</span>&nbsp;<span class="num" id="5013273">0</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013276">for</span>&nbsp;<span class="ident" id="5013280">filename</span><span class="op" id="5013288">,</span>&nbsp;<span class="ident" id="5013290">f</span>&nbsp;<span class="op" id="5013292">:=</span>&nbsp;<span class="keyword" id="5013295">range</span>&nbsp;<span class="ident" id="5013301">pkg</span><span class="op" id="5013304">.</span><span class="ident" id="5013305">Files</span>&nbsp;<span class="op" id="5013311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013315">filenames</span><span class="op" id="5013324">[</span><span class="ident" id="5013325">i</span><span class="op" id="5013326">]</span>&nbsp;<span class="op" id="5013328">=</span>&nbsp;<span class="ident" id="5013330">filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013341">i</span><span class="op" id="5013342">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013347">if</span>&nbsp;<span class="ident" id="5013350">f</span><span class="op" id="5013351">.</span><span class="ident" id="5013352">Doc</span>&nbsp;<span class="op" id="5013356">!=</span>&nbsp;<span class="ident" id="5013359">nil</span>&nbsp;<span class="op" id="5013363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013368">ndocs</span>&nbsp;<span class="op" id="5013374">+=</span>&nbsp;<span class="builtinfunc" id="5013377">len</span><span class="op" id="5013380">(</span><span class="ident" id="5013381">f</span><span class="op" id="5013382">.</span><span class="ident" id="5013383">Doc</span><span class="op" id="5013386">.</span><span class="ident" id="5013387">List</span><span class="op" id="5013391">)</span>&nbsp;<span class="op" id="5013393">+</span>&nbsp;<span class="num" id="5013395">1</span>&nbsp;<span class="comment" id="5013397">//&nbsp;+1&nbsp;for&nbsp;separator</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013423">ncomments</span>&nbsp;<span class="op" id="5013433">+=</span>&nbsp;<span class="builtinfunc" id="5013436">len</span><span class="op" id="5013439">(</span><span class="ident" id="5013440">f</span><span class="op" id="5013441">.</span><span class="ident" id="5013442">Comments</span><span class="op" id="5013450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013454">ndecls</span>&nbsp;<span class="op" id="5013461">+=</span>&nbsp;<span class="builtinfunc" id="5013464">len</span><span class="op" id="5013467">(</span><span class="ident" id="5013468">f</span><span class="op" id="5013469">.</span><span class="ident" id="5013470">Decls</span><span class="op" id="5013475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013481">sort</span><span class="op" id="5013485">.</span><span class="ident" id="5013486">Strings</span><span class="op" id="5013493">(</span><span class="ident" id="5013494">filenames</span><span class="op" id="5013503">)</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5013507">//&nbsp;Collect&nbsp;package&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5013573">//&nbsp;CommentGroup&nbsp;-&nbsp;the&nbsp;collected&nbsp;package&nbsp;documentation.&nbsp;In&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5013640">//&nbsp;there&nbsp;should&nbsp;be&nbsp;only&nbsp;one&nbsp;file&nbsp;with&nbsp;a&nbsp;package&nbsp;comment;&nbsp;but&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5013707">//&nbsp;better&nbsp;to&nbsp;collect&nbsp;extra&nbsp;comments&nbsp;than&nbsp;drop&nbsp;them&nbsp;on&nbsp;the&nbsp;floor.</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013773">var</span>&nbsp;<span class="ident" id="5013777">doc</span>&nbsp;<span class="op" id="5013781">*</span><span class="ident" id="5013782">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013796">var</span>&nbsp;<span class="ident" id="5013800">pos</span>&nbsp;<span class="ident" id="5013804">token</span><span class="op" id="5013809">.</span><span class="ident" id="5013810">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013815">if</span>&nbsp;<span class="ident" id="5013818">ndocs</span>&nbsp;<span class="op" id="5013824">&gt;</span>&nbsp;<span class="num" id="5013826">0</span>&nbsp;<span class="op" id="5013828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013832">list</span>&nbsp;<span class="op" id="5013837">:=</span>&nbsp;<span class="builtinfunc" id="5013840">make</span><span class="op" id="5013844">(</span><span class="op" id="5013845">[</span><span class="op" id="5013846">]</span><span class="op" id="5013847">*</span><span class="ident" id="5013848">Comment</span><span class="op" id="5013855">,</span>&nbsp;<span class="ident" id="5013857">ndocs</span><span class="op" id="5013862">-</span><span class="num" id="5013863">1</span><span class="op" id="5013864">)</span>&nbsp;<span class="comment" id="5013866">//&nbsp;-1:&nbsp;no&nbsp;separator&nbsp;before&nbsp;first&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013907">i</span>&nbsp;<span class="op" id="5013909">:=</span>&nbsp;<span class="num" id="5013912">0</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013916">for</span>&nbsp;<span class="ident" id="5013920">_</span><span class="op" id="5013921">,</span>&nbsp;<span class="ident" id="5013923">filename</span>&nbsp;<span class="op" id="5013932">:=</span>&nbsp;<span class="keyword" id="5013935">range</span>&nbsp;<span class="ident" id="5013941">filenames</span>&nbsp;<span class="op" id="5013951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013956">f</span>&nbsp;<span class="op" id="5013958">:=</span>&nbsp;<span class="ident" id="5013961">pkg</span><span class="op" id="5013964">.</span><span class="ident" id="5013965">Files</span><span class="op" id="5013970">[</span><span class="ident" id="5013971">filename</span><span class="op" id="5013979">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013984">if</span>&nbsp;<span class="ident" id="5013987">f</span><span class="op" id="5013988">.</span><span class="ident" id="5013989">Doc</span>&nbsp;<span class="op" id="5013993">!=</span>&nbsp;<span class="ident" id="5013996">nil</span>&nbsp;<span class="op" id="5014000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014006">if</span>&nbsp;<span class="ident" id="5014009">i</span>&nbsp;<span class="op" id="5014011">&gt;</span>&nbsp;<span class="num" id="5014013">0</span>&nbsp;<span class="op" id="5014015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014022">//&nbsp;not&nbsp;the&nbsp;first&nbsp;group&nbsp;-&nbsp;add&nbsp;separator</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014066">list</span><span class="op" id="5014070">[</span><span class="ident" id="5014071">i</span><span class="op" id="5014072">]</span>&nbsp;<span class="op" id="5014074">=</span>&nbsp;<span class="ident" id="5014076">separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014091">i</span><span class="op" id="5014092">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014105">for</span>&nbsp;<span class="ident" id="5014109">_</span><span class="op" id="5014110">,</span>&nbsp;<span class="ident" id="5014112">c</span>&nbsp;<span class="op" id="5014114">:=</span>&nbsp;<span class="keyword" id="5014117">range</span>&nbsp;<span class="ident" id="5014123">f</span><span class="op" id="5014124">.</span><span class="ident" id="5014125">Doc</span><span class="op" id="5014128">.</span><span class="ident" id="5014129">List</span>&nbsp;<span class="op" id="5014134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014141">list</span><span class="op" id="5014145">[</span><span class="ident" id="5014146">i</span><span class="op" id="5014147">]</span>&nbsp;<span class="op" id="5014149">=</span>&nbsp;<span class="ident" id="5014151">c</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014158">i</span><span class="op" id="5014159">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014172">if</span>&nbsp;<span class="ident" id="5014175">f</span><span class="op" id="5014176">.</span><span class="ident" id="5014177">Package</span>&nbsp;<span class="op" id="5014185">&gt;</span>&nbsp;<span class="ident" id="5014187">pos</span>&nbsp;<span class="op" id="5014191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014198">//&nbsp;Keep&nbsp;the&nbsp;maximum&nbsp;package&nbsp;clause&nbsp;position&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014250">//&nbsp;position&nbsp;for&nbsp;the&nbsp;package&nbsp;clause&nbsp;of&nbsp;the&nbsp;merged</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014304">//&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014319">pos</span>&nbsp;<span class="op" id="5014323">=</span>&nbsp;<span class="ident" id="5014325">f</span><span class="op" id="5014326">.</span><span class="ident" id="5014327">Package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014348">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014352">doc</span>&nbsp;<span class="op" id="5014356">=</span>&nbsp;<span class="op" id="5014358">&amp;</span><span class="ident" id="5014359">CommentGroup</span><span class="op" id="5014371">{</span><span class="ident" id="5014372">list</span><span class="op" id="5014376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014383">//&nbsp;Collect&nbsp;declarations&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014432">var</span>&nbsp;<span class="ident" id="5014436">decls</span>&nbsp;<span class="op" id="5014442">[</span><span class="op" id="5014443">]</span><span class="ident" id="5014444">Decl</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014450">if</span>&nbsp;<span class="ident" id="5014453">ndecls</span>&nbsp;<span class="op" id="5014460">&gt;</span>&nbsp;<span class="num" id="5014462">0</span>&nbsp;<span class="op" id="5014464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014468">decls</span>&nbsp;<span class="op" id="5014474">=</span>&nbsp;<span class="builtinfunc" id="5014476">make</span><span class="op" id="5014480">(</span><span class="op" id="5014481">[</span><span class="op" id="5014482">]</span><span class="ident" id="5014483">Decl</span><span class="op" id="5014487">,</span>&nbsp;<span class="ident" id="5014489">ndecls</span><span class="op" id="5014495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014499">funcs</span>&nbsp;<span class="op" id="5014505">:=</span>&nbsp;<span class="builtinfunc" id="5014508">make</span><span class="op" id="5014512">(</span><span class="keyword" id="5014513">map</span><span class="op" id="5014516">[</span><span class="builtintype" id="5014517">string</span><span class="op" id="5014523">]</span><span class="builtintype" id="5014524">int</span><span class="op" id="5014527">)</span>&nbsp;<span class="comment" id="5014529">//&nbsp;map&nbsp;of&nbsp;func&nbsp;name&nbsp;-&gt;&nbsp;decls&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014566">i</span>&nbsp;<span class="op" id="5014568">:=</span>&nbsp;<span class="num" id="5014571">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014596">//&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014615">n</span>&nbsp;<span class="op" id="5014617">:=</span>&nbsp;<span class="num" id="5014620">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014645">//&nbsp;number&nbsp;of&nbsp;filtered&nbsp;entries</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014677">for</span>&nbsp;<span class="ident" id="5014681">_</span><span class="op" id="5014682">,</span>&nbsp;<span class="ident" id="5014684">filename</span>&nbsp;<span class="op" id="5014693">:=</span>&nbsp;<span class="keyword" id="5014696">range</span>&nbsp;<span class="ident" id="5014702">filenames</span>&nbsp;<span class="op" id="5014712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014717">f</span>&nbsp;<span class="op" id="5014719">:=</span>&nbsp;<span class="ident" id="5014722">pkg</span><span class="op" id="5014725">.</span><span class="ident" id="5014726">Files</span><span class="op" id="5014731">[</span><span class="ident" id="5014732">filename</span><span class="op" id="5014740">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014745">for</span>&nbsp;<span class="ident" id="5014749">_</span><span class="op" id="5014750">,</span>&nbsp;<span class="ident" id="5014752">d</span>&nbsp;<span class="op" id="5014754">:=</span>&nbsp;<span class="keyword" id="5014757">range</span>&nbsp;<span class="ident" id="5014763">f</span><span class="op" id="5014764">.</span><span class="ident" id="5014765">Decls</span>&nbsp;<span class="op" id="5014771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014777">if</span>&nbsp;<span class="ident" id="5014780">mode</span><span class="op" id="5014784">&amp;</span><span class="ident" id="5014785">FilterFuncDuplicates</span>&nbsp;<span class="op" id="5014806">!=</span>&nbsp;<span class="num" id="5014809">0</span>&nbsp;<span class="op" id="5014811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014818">//&nbsp;A&nbsp;language&nbsp;entity&nbsp;may&nbsp;be&nbsp;declared&nbsp;multiple</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014869">//&nbsp;times&nbsp;in&nbsp;different&nbsp;package&nbsp;files;&nbsp;only&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014919">//&nbsp;build&nbsp;time&nbsp;declarations&nbsp;must&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014967">//&nbsp;For&nbsp;now,&nbsp;exclude&nbsp;multiple&nbsp;declarations&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015017">//&nbsp;functions&nbsp;-&nbsp;keep&nbsp;the&nbsp;one&nbsp;with&nbsp;documentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015070">//</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015078">//&nbsp;TODO(gri):&nbsp;Expand&nbsp;this&nbsp;filtering&nbsp;to&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015128">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entities&nbsp;(const,&nbsp;type,&nbsp;vars)&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015179">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple&nbsp;declarations&nbsp;are&nbsp;common.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015232">if</span>&nbsp;<span class="ident" id="5015235">f</span><span class="op" id="5015236">,</span>&nbsp;<span class="ident" id="5015238">isFun</span>&nbsp;<span class="op" id="5015244">:=</span>&nbsp;<span class="ident" id="5015247">d</span><span class="op" id="5015248">.</span><span class="op" id="5015249">(</span><span class="op" id="5015250">*</span><span class="ident" id="5015251">FuncDecl</span><span class="op" id="5015259">)</span><span class="op" id="5015260">;</span>&nbsp;<span class="ident" id="5015262">isFun</span>&nbsp;<span class="op" id="5015268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015276">name</span>&nbsp;<span class="op" id="5015281">:=</span>&nbsp;<span class="ident" id="5015284">nameOf</span><span class="op" id="5015290">(</span><span class="ident" id="5015291">f</span><span class="op" id="5015292">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015300">if</span>&nbsp;<span class="ident" id="5015303">j</span><span class="op" id="5015304">,</span>&nbsp;<span class="ident" id="5015306">exists</span>&nbsp;<span class="op" id="5015313">:=</span>&nbsp;<span class="ident" id="5015316">funcs</span><span class="op" id="5015321">[</span><span class="ident" id="5015322">name</span><span class="op" id="5015326">]</span><span class="op" id="5015327">;</span>&nbsp;<span class="ident" id="5015329">exists</span>&nbsp;<span class="op" id="5015336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015345">//&nbsp;function&nbsp;declared&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015381">if</span>&nbsp;<span class="ident" id="5015384">decls</span><span class="op" id="5015389">[</span><span class="ident" id="5015390">j</span><span class="op" id="5015391">]</span>&nbsp;<span class="op" id="5015393">!=</span>&nbsp;<span class="ident" id="5015396">nil</span>&nbsp;<span class="op" id="5015400">&amp;&amp;</span>&nbsp;<span class="ident" id="5015403">decls</span><span class="op" id="5015408">[</span><span class="ident" id="5015409">j</span><span class="op" id="5015410">]</span><span class="op" id="5015411">.</span><span class="op" id="5015412">(</span><span class="op" id="5015413">*</span><span class="ident" id="5015414">FuncDecl</span><span class="op" id="5015422">)</span><span class="op" id="5015423">.</span><span class="ident" id="5015424">Doc</span>&nbsp;<span class="op" id="5015428">==</span>&nbsp;<span class="ident" id="5015431">nil</span>&nbsp;<span class="op" id="5015435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015445">//&nbsp;existing&nbsp;declaration&nbsp;has&nbsp;no&nbsp;documentation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015499">//&nbsp;ignore&nbsp;the&nbsp;existing&nbsp;declaration</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015542">decls</span><span class="op" id="5015547">[</span><span class="ident" id="5015548">j</span><span class="op" id="5015549">]</span>&nbsp;<span class="op" id="5015551">=</span>&nbsp;<span class="ident" id="5015553">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015564">}</span>&nbsp;<span class="keyword" id="5015566">else</span>&nbsp;<span class="op" id="5015571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015581">//&nbsp;ignore&nbsp;the&nbsp;new&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015619">d</span>&nbsp;<span class="op" id="5015621">=</span>&nbsp;<span class="ident" id="5015623">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015634">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015643">n</span><span class="op" id="5015644">++</span>&nbsp;<span class="comment" id="5015647">//&nbsp;filtered&nbsp;an&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015674">}</span>&nbsp;<span class="keyword" id="5015676">else</span>&nbsp;<span class="op" id="5015681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015690">funcs</span><span class="op" id="5015695">[</span><span class="ident" id="5015696">name</span><span class="op" id="5015700">]</span>&nbsp;<span class="op" id="5015702">=</span>&nbsp;<span class="ident" id="5015704">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015719">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015731">decls</span><span class="op" id="5015736">[</span><span class="ident" id="5015737">i</span><span class="op" id="5015738">]</span>&nbsp;<span class="op" id="5015740">=</span>&nbsp;<span class="ident" id="5015742">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015748">i</span><span class="op" id="5015749">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015759">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015764">//&nbsp;Eliminate&nbsp;nil&nbsp;entries&nbsp;from&nbsp;the&nbsp;decls&nbsp;list&nbsp;if&nbsp;entries&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015827">//&nbsp;filtered.&nbsp;We&nbsp;do&nbsp;this&nbsp;using&nbsp;a&nbsp;2nd&nbsp;pass&nbsp;in&nbsp;order&nbsp;to&nbsp;not&nbsp;disturb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015894">//&nbsp;the&nbsp;original&nbsp;declaration&nbsp;order&nbsp;in&nbsp;the&nbsp;source&nbsp;(otherwise,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015961">//&nbsp;would&nbsp;also&nbsp;invalidate&nbsp;the&nbsp;monotonically&nbsp;increasing&nbsp;position</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016026">//&nbsp;info&nbsp;within&nbsp;a&nbsp;single&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016059">if</span>&nbsp;<span class="ident" id="5016062">n</span>&nbsp;<span class="op" id="5016064">&gt;</span>&nbsp;<span class="num" id="5016066">0</span>&nbsp;<span class="op" id="5016068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016073">i</span>&nbsp;<span class="op" id="5016075">=</span>&nbsp;<span class="num" id="5016077">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016082">for</span>&nbsp;<span class="ident" id="5016086">_</span><span class="op" id="5016087">,</span>&nbsp;<span class="ident" id="5016089">d</span>&nbsp;<span class="op" id="5016091">:=</span>&nbsp;<span class="keyword" id="5016094">range</span>&nbsp;<span class="ident" id="5016100">decls</span>&nbsp;<span class="op" id="5016106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016112">if</span>&nbsp;<span class="ident" id="5016115">d</span>&nbsp;<span class="op" id="5016117">!=</span>&nbsp;<span class="ident" id="5016120">nil</span>&nbsp;<span class="op" id="5016124">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016131">decls</span><span class="op" id="5016136">[</span><span class="ident" id="5016137">i</span><span class="op" id="5016138">]</span>&nbsp;<span class="op" id="5016140">=</span>&nbsp;<span class="ident" id="5016142">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016149">i</span><span class="op" id="5016150">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016167">decls</span>&nbsp;<span class="op" id="5016173">=</span>&nbsp;<span class="ident" id="5016175">decls</span><span class="op" id="5016180">[</span><span class="num" id="5016181">0</span><span class="op" id="5016182">:</span><span class="ident" id="5016183">i</span><span class="op" id="5016184">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016195">//&nbsp;Collect&nbsp;import&nbsp;specs&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016244">var</span>&nbsp;<span class="ident" id="5016248">imports</span>&nbsp;<span class="op" id="5016256">[</span><span class="op" id="5016257">]</span><span class="op" id="5016258">*</span><span class="ident" id="5016259">ImportSpec</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016271">if</span>&nbsp;<span class="ident" id="5016274">mode</span><span class="op" id="5016278">&amp;</span><span class="ident" id="5016279">FilterImportDuplicates</span>&nbsp;<span class="op" id="5016302">!=</span>&nbsp;<span class="num" id="5016305">0</span>&nbsp;<span class="op" id="5016307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016311">seen</span>&nbsp;<span class="op" id="5016316">:=</span>&nbsp;<span class="builtinfunc" id="5016319">make</span><span class="op" id="5016323">(</span><span class="keyword" id="5016324">map</span><span class="op" id="5016327">[</span><span class="builtintype" id="5016328">string</span><span class="op" id="5016334">]</span><span class="builtintype" id="5016335">bool</span><span class="op" id="5016339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016343">for</span>&nbsp;<span class="ident" id="5016347">_</span><span class="op" id="5016348">,</span>&nbsp;<span class="ident" id="5016350">filename</span>&nbsp;<span class="op" id="5016359">:=</span>&nbsp;<span class="keyword" id="5016362">range</span>&nbsp;<span class="ident" id="5016368">filenames</span>&nbsp;<span class="op" id="5016378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016383">f</span>&nbsp;<span class="op" id="5016385">:=</span>&nbsp;<span class="ident" id="5016388">pkg</span><span class="op" id="5016391">.</span><span class="ident" id="5016392">Files</span><span class="op" id="5016397">[</span><span class="ident" id="5016398">filename</span><span class="op" id="5016406">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016411">for</span>&nbsp;<span class="ident" id="5016415">_</span><span class="op" id="5016416">,</span>&nbsp;<span class="ident" id="5016418">imp</span>&nbsp;<span class="op" id="5016422">:=</span>&nbsp;<span class="keyword" id="5016425">range</span>&nbsp;<span class="ident" id="5016431">f</span><span class="op" id="5016432">.</span><span class="ident" id="5016433">Imports</span>&nbsp;<span class="op" id="5016441">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016447">if</span>&nbsp;<span class="ident" id="5016450">path</span>&nbsp;<span class="op" id="5016455">:=</span>&nbsp;<span class="ident" id="5016458">imp</span><span class="op" id="5016461">.</span><span class="ident" id="5016462">Path</span><span class="op" id="5016466">.</span><span class="ident" id="5016467">Value</span><span class="op" id="5016472">;</span>&nbsp;<span class="op" id="5016474">!</span><span class="ident" id="5016475">seen</span><span class="op" id="5016479">[</span><span class="ident" id="5016480">path</span><span class="op" id="5016484">]</span>&nbsp;<span class="op" id="5016486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016493">//&nbsp;TODO:&nbsp;consider&nbsp;handling&nbsp;cases&nbsp;where:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016538">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;with&nbsp;the&nbsp;same&nbsp;import&nbsp;path&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016594">//&nbsp;&nbsp;&nbsp;have&nbsp;different&nbsp;local&nbsp;names&nbsp;(one&nbsp;should&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016652">//&nbsp;&nbsp;&nbsp;keep&nbsp;both&nbsp;of&nbsp;them)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016681">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;but&nbsp;only&nbsp;one&nbsp;has&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016734">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;and&nbsp;they&nbsp;both&nbsp;have&nbsp;(possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016789">//&nbsp;&nbsp;&nbsp;different)&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016819">imports</span>&nbsp;<span class="op" id="5016827">=</span>&nbsp;<span class="builtinfunc" id="5016829">append</span><span class="op" id="5016835">(</span><span class="ident" id="5016836">imports</span><span class="op" id="5016843">,</span>&nbsp;<span class="ident" id="5016845">imp</span><span class="op" id="5016848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016855">seen</span><span class="op" id="5016859">[</span><span class="ident" id="5016860">path</span><span class="op" id="5016864">]</span>&nbsp;<span class="op" id="5016866">=</span>&nbsp;<span class="ident" id="5016868">true</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016889">}</span>&nbsp;<span class="keyword" id="5016891">else</span>&nbsp;<span class="op" id="5016896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016900">for</span>&nbsp;<span class="ident" id="5016904">_</span><span class="op" id="5016905">,</span>&nbsp;<span class="ident" id="5016907">f</span>&nbsp;<span class="op" id="5016909">:=</span>&nbsp;<span class="keyword" id="5016912">range</span>&nbsp;<span class="ident" id="5016918">pkg</span><span class="op" id="5016921">.</span><span class="ident" id="5016922">Files</span>&nbsp;<span class="op" id="5016928">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016933">imports</span>&nbsp;<span class="op" id="5016941">=</span>&nbsp;<span class="builtinfunc" id="5016943">append</span><span class="op" id="5016949">(</span><span class="ident" id="5016950">imports</span><span class="op" id="5016957">,</span>&nbsp;<span class="ident" id="5016959">f</span><span class="op" id="5016960">.</span><span class="ident" id="5016961">Imports</span><span class="op" id="5016968">...</span><span class="op" id="5016971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016982">//&nbsp;Collect&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017027">var</span>&nbsp;<span class="ident" id="5017031">comments</span>&nbsp;<span class="op" id="5017040">[</span><span class="op" id="5017041">]</span><span class="op" id="5017042">*</span><span class="ident" id="5017043">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017057">if</span>&nbsp;<span class="ident" id="5017060">mode</span><span class="op" id="5017064">&amp;</span><span class="ident" id="5017065">FilterUnassociatedComments</span>&nbsp;<span class="op" id="5017092">==</span>&nbsp;<span class="num" id="5017095">0</span>&nbsp;<span class="op" id="5017097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017101">comments</span>&nbsp;<span class="op" id="5017110">=</span>&nbsp;<span class="builtinfunc" id="5017112">make</span><span class="op" id="5017116">(</span><span class="op" id="5017117">[</span><span class="op" id="5017118">]</span><span class="op" id="5017119">*</span><span class="ident" id="5017120">CommentGroup</span><span class="op" id="5017132">,</span>&nbsp;<span class="ident" id="5017134">ncomments</span><span class="op" id="5017143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017147">i</span>&nbsp;<span class="op" id="5017149">:=</span>&nbsp;<span class="num" id="5017152">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017156">for</span>&nbsp;<span class="ident" id="5017160">_</span><span class="op" id="5017161">,</span>&nbsp;<span class="ident" id="5017163">f</span>&nbsp;<span class="op" id="5017165">:=</span>&nbsp;<span class="keyword" id="5017168">range</span>&nbsp;<span class="ident" id="5017174">pkg</span><span class="op" id="5017177">.</span><span class="ident" id="5017178">Files</span>&nbsp;<span class="op" id="5017184">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017189">i</span>&nbsp;<span class="op" id="5017191">+=</span>&nbsp;<span class="builtinfunc" id="5017194">copy</span><span class="op" id="5017198">(</span><span class="ident" id="5017199">comments</span><span class="op" id="5017207">[</span><span class="ident" id="5017208">i</span><span class="op" id="5017209">:</span><span class="op" id="5017210">]</span><span class="op" id="5017211">,</span>&nbsp;<span class="ident" id="5017213">f</span><span class="op" id="5017214">.</span><span class="ident" id="5017215">Comments</span><span class="op" id="5017223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5017234">//&nbsp;TODO(gri)&nbsp;need&nbsp;to&nbsp;compute&nbsp;unresolved&nbsp;identifiers!</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017288">return</span>&nbsp;<span class="op" id="5017295">&amp;</span><span class="ident" id="5017296">File</span><span class="op" id="5017300">{</span><span class="ident" id="5017301">doc</span><span class="op" id="5017304">,</span>&nbsp;<span class="ident" id="5017306">pos</span><span class="op" id="5017309">,</span>&nbsp;<span class="ident" id="5017311">NewIdent</span><span class="op" id="5017319">(</span><span class="ident" id="5017320">pkg</span><span class="op" id="5017323">.</span><span class="ident" id="5017324">Name</span><span class="op" id="5017328">)</span><span class="op" id="5017329">,</span>&nbsp;<span class="ident" id="5017331">decls</span><span class="op" id="5017336">,</span>&nbsp;<span class="ident" id="5017338">pkg</span><span class="op" id="5017341">.</span><span class="ident" id="5017342">Scope</span><span class="op" id="5017347">,</span>&nbsp;<span class="ident" id="5017349">imports</span><span class="op" id="5017356">,</span>&nbsp;<span class="ident" id="5017358">nil</span><span class="op" id="5017361">,</span>&nbsp;<span class="ident" id="5017363">comments</span><span class="op" id="5017371">}</span><br>
<span class="lineno"></span><span class="op" id="5017373">}</span>
</div>
</body>
</html>
