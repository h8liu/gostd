<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html" class="current">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8442868">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8442923">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8442977">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8443028">package</span>&nbsp;<span class="ident" id="8443036">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8443043">import</span>&nbsp;<span class="op" id="8443050">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8443053">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8443062">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8443078">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8443085">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8443095">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8443098">//&nbsp;equal&nbsp;returns&nbsp;nil&nbsp;if&nbsp;p&nbsp;and&nbsp;q&nbsp;describe&nbsp;the&nbsp;same&nbsp;file&nbsp;set;</span><br>
<span class="lineno">15</span><span class="comment" id="8443158">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;discrepancy.</span><br>
<span class="lineno"></span><span class="keyword" id="8443219">func</span>&nbsp;<span class="ident" id="8443224">equal</span><span class="op" id="8443229">(</span><span class="ident" id="8443230">p</span><span class="op" id="8443231">,</span>&nbsp;<span class="ident" id="8443233">q</span>&nbsp;<span class="op" id="8443235">*</span><span class="ident" id="8443236">FileSet</span><span class="op" id="8443243">)</span>&nbsp;<span class="builtintype" id="8443245">error</span>&nbsp;<span class="op" id="8443251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443254">if</span>&nbsp;<span class="ident" id="8443257">p</span>&nbsp;<span class="op" id="8443259">==</span>&nbsp;<span class="ident" id="8443262">q</span>&nbsp;<span class="op" id="8443264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8443268">//&nbsp;avoid&nbsp;deadlock&nbsp;if&nbsp;p&nbsp;==&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443298">return</span>&nbsp;<span class="builtintype" id="8443305">nil</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8443310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8443314">//&nbsp;not&nbsp;strictly&nbsp;needed&nbsp;for&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8443351">p</span><span class="op" id="8443352">.</span><span class="ident" id="8443353">mutex</span><span class="op" id="8443358">.</span><span class="ident" id="8443359">Lock</span><span class="op" id="8443363">(</span><span class="op" id="8443364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8443367">q</span><span class="op" id="8443368">.</span><span class="ident" id="8443369">mutex</span><span class="op" id="8443374">.</span><span class="ident" id="8443375">Lock</span><span class="op" id="8443379">(</span><span class="op" id="8443380">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443383">defer</span>&nbsp;<span class="ident" id="8443389">q</span><span class="op" id="8443390">.</span><span class="ident" id="8443391">mutex</span><span class="op" id="8443396">.</span><span class="ident" id="8443397">Unlock</span><span class="op" id="8443403">(</span><span class="op" id="8443404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443407">defer</span>&nbsp;<span class="ident" id="8443413">p</span><span class="op" id="8443414">.</span><span class="ident" id="8443415">mutex</span><span class="op" id="8443420">.</span><span class="ident" id="8443421">Unlock</span><span class="op" id="8443427">(</span><span class="op" id="8443428">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443432">if</span>&nbsp;<span class="ident" id="8443435">p</span><span class="op" id="8443436">.</span><span class="ident" id="8443437">base</span>&nbsp;<span class="op" id="8443442">!=</span>&nbsp;<span class="ident" id="8443445">q</span><span class="op" id="8443446">.</span><span class="ident" id="8443447">base</span>&nbsp;<span class="op" id="8443452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443456">return</span>&nbsp;<span class="ident" id="8443463">fmt</span><span class="op" id="8443466">.</span><span class="ident" id="8443467">Errorf</span><span class="op" id="8443473">(</span><span class="string" id="8443474">&#34;different&nbsp;bases:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="8443501">,</span>&nbsp;<span class="ident" id="8443503">p</span><span class="op" id="8443504">.</span><span class="ident" id="8443505">base</span><span class="op" id="8443509">,</span>&nbsp;<span class="ident" id="8443511">q</span><span class="op" id="8443512">.</span><span class="ident" id="8443513">base</span><span class="op" id="8443517">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8443520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443524">if</span>&nbsp;<span class="builtinfunc" id="8443527">len</span><span class="op" id="8443530">(</span><span class="ident" id="8443531">p</span><span class="op" id="8443532">.</span><span class="ident" id="8443533">files</span><span class="op" id="8443538">)</span>&nbsp;<span class="op" id="8443540">!=</span>&nbsp;<span class="builtinfunc" id="8443543">len</span><span class="op" id="8443546">(</span><span class="ident" id="8443547">q</span><span class="op" id="8443548">.</span><span class="ident" id="8443549">files</span><span class="op" id="8443554">)</span>&nbsp;<span class="op" id="8443556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443560">return</span>&nbsp;<span class="ident" id="8443567">fmt</span><span class="op" id="8443570">.</span><span class="ident" id="8443571">Errorf</span><span class="op" id="8443577">(</span><span class="string" id="8443578">&#34;different&nbsp;number&nbsp;of&nbsp;files:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="8443615">,</span>&nbsp;<span class="builtinfunc" id="8443617">len</span><span class="op" id="8443620">(</span><span class="ident" id="8443621">p</span><span class="op" id="8443622">.</span><span class="ident" id="8443623">files</span><span class="op" id="8443628">)</span><span class="op" id="8443629">,</span>&nbsp;<span class="builtinfunc" id="8443631">len</span><span class="op" id="8443634">(</span><span class="ident" id="8443635">q</span><span class="op" id="8443636">.</span><span class="ident" id="8443637">files</span><span class="op" id="8443642">)</span><span class="op" id="8443643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8443646">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443650">for</span>&nbsp;<span class="ident" id="8443654">i</span><span class="op" id="8443655">,</span>&nbsp;<span class="ident" id="8443657">f</span>&nbsp;<span class="op" id="8443659">:=</span>&nbsp;<span class="keyword" id="8443662">range</span>&nbsp;<span class="ident" id="8443668">p</span><span class="op" id="8443669">.</span><span class="ident" id="8443670">files</span>&nbsp;<span class="op" id="8443676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8443680">g</span>&nbsp;<span class="op" id="8443682">:=</span>&nbsp;<span class="ident" id="8443685">q</span><span class="op" id="8443686">.</span><span class="ident" id="8443687">files</span><span class="op" id="8443692">[</span><span class="ident" id="8443693">i</span><span class="op" id="8443694">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443698">if</span>&nbsp;<span class="ident" id="8443701">f</span><span class="op" id="8443702">.</span><span class="ident" id="8443703">set</span>&nbsp;<span class="op" id="8443707">!=</span>&nbsp;<span class="ident" id="8443710">p</span>&nbsp;<span class="op" id="8443712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443717">return</span>&nbsp;<span class="ident" id="8443724">fmt</span><span class="op" id="8443727">.</span><span class="ident" id="8443728">Errorf</span><span class="op" id="8443734">(</span><span class="string" id="8443735">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="8443757">,</span>&nbsp;<span class="ident" id="8443759">f</span><span class="op" id="8443760">.</span><span class="ident" id="8443761">name</span><span class="op" id="8443765">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8443769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443773">if</span>&nbsp;<span class="ident" id="8443776">g</span><span class="op" id="8443777">.</span><span class="ident" id="8443778">set</span>&nbsp;<span class="op" id="8443782">!=</span>&nbsp;<span class="ident" id="8443785">q</span>&nbsp;<span class="op" id="8443787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443792">return</span>&nbsp;<span class="ident" id="8443799">fmt</span><span class="op" id="8443802">.</span><span class="ident" id="8443803">Errorf</span><span class="op" id="8443809">(</span><span class="string" id="8443810">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="8443832">,</span>&nbsp;<span class="ident" id="8443834">g</span><span class="op" id="8443835">.</span><span class="ident" id="8443836">name</span><span class="op" id="8443840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8443844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443848">if</span>&nbsp;<span class="ident" id="8443851">f</span><span class="op" id="8443852">.</span><span class="ident" id="8443853">name</span>&nbsp;<span class="op" id="8443858">!=</span>&nbsp;<span class="ident" id="8443861">g</span><span class="op" id="8443862">.</span><span class="ident" id="8443863">name</span>&nbsp;<span class="op" id="8443868">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443873">return</span>&nbsp;<span class="ident" id="8443880">fmt</span><span class="op" id="8443883">.</span><span class="ident" id="8443884">Errorf</span><span class="op" id="8443890">(</span><span class="string" id="8443891">&#34;different&nbsp;filenames:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="8443922">,</span>&nbsp;<span class="ident" id="8443924">f</span><span class="op" id="8443925">.</span><span class="ident" id="8443926">name</span><span class="op" id="8443930">,</span>&nbsp;<span class="ident" id="8443932">g</span><span class="op" id="8443933">.</span><span class="ident" id="8443934">name</span><span class="op" id="8443938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8443942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443946">if</span>&nbsp;<span class="ident" id="8443949">f</span><span class="op" id="8443950">.</span><span class="ident" id="8443951">base</span>&nbsp;<span class="op" id="8443956">!=</span>&nbsp;<span class="ident" id="8443959">g</span><span class="op" id="8443960">.</span><span class="ident" id="8443961">base</span>&nbsp;<span class="op" id="8443966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443971">return</span>&nbsp;<span class="ident" id="8443978">fmt</span><span class="op" id="8443981">.</span><span class="ident" id="8443982">Errorf</span><span class="op" id="8443988">(</span><span class="string" id="8443989">&#34;different&nbsp;base&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="8444022">,</span>&nbsp;<span class="ident" id="8444024">f</span><span class="op" id="8444025">.</span><span class="ident" id="8444026">name</span><span class="op" id="8444030">,</span>&nbsp;<span class="ident" id="8444032">f</span><span class="op" id="8444033">.</span><span class="ident" id="8444034">base</span><span class="op" id="8444038">,</span>&nbsp;<span class="ident" id="8444040">g</span><span class="op" id="8444041">.</span><span class="ident" id="8444042">base</span><span class="op" id="8444046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444050">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444054">if</span>&nbsp;<span class="ident" id="8444057">f</span><span class="op" id="8444058">.</span><span class="ident" id="8444059">size</span>&nbsp;<span class="op" id="8444064">!=</span>&nbsp;<span class="ident" id="8444067">g</span><span class="op" id="8444068">.</span><span class="ident" id="8444069">size</span>&nbsp;<span class="op" id="8444074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444079">return</span>&nbsp;<span class="ident" id="8444086">fmt</span><span class="op" id="8444089">.</span><span class="ident" id="8444090">Errorf</span><span class="op" id="8444096">(</span><span class="string" id="8444097">&#34;different&nbsp;size&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="8444130">,</span>&nbsp;<span class="ident" id="8444132">f</span><span class="op" id="8444133">.</span><span class="ident" id="8444134">name</span><span class="op" id="8444138">,</span>&nbsp;<span class="ident" id="8444140">f</span><span class="op" id="8444141">.</span><span class="ident" id="8444142">size</span><span class="op" id="8444146">,</span>&nbsp;<span class="ident" id="8444148">g</span><span class="op" id="8444149">.</span><span class="ident" id="8444150">size</span><span class="op" id="8444154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444162">for</span>&nbsp;<span class="ident" id="8444166">j</span><span class="op" id="8444167">,</span>&nbsp;<span class="ident" id="8444169">l</span>&nbsp;<span class="op" id="8444171">:=</span>&nbsp;<span class="keyword" id="8444174">range</span>&nbsp;<span class="ident" id="8444180">f</span><span class="op" id="8444181">.</span><span class="ident" id="8444182">lines</span>&nbsp;<span class="op" id="8444188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8444193">m</span>&nbsp;<span class="op" id="8444195">:=</span>&nbsp;<span class="ident" id="8444198">g</span><span class="op" id="8444199">.</span><span class="ident" id="8444200">lines</span><span class="op" id="8444205">[</span><span class="ident" id="8444206">j</span><span class="op" id="8444207">]</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444212">if</span>&nbsp;<span class="ident" id="8444215">l</span>&nbsp;<span class="op" id="8444217">!=</span>&nbsp;<span class="ident" id="8444220">m</span>&nbsp;<span class="op" id="8444222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444228">return</span>&nbsp;<span class="ident" id="8444235">fmt</span><span class="op" id="8444238">.</span><span class="ident" id="8444239">Errorf</span><span class="op" id="8444245">(</span><span class="string" id="8444246">&#34;different&nbsp;offsets&nbsp;for&nbsp;%q&#34;</span><span class="op" id="8444272">,</span>&nbsp;<span class="ident" id="8444274">f</span><span class="op" id="8444275">.</span><span class="ident" id="8444276">name</span><span class="op" id="8444280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444293">for</span>&nbsp;<span class="ident" id="8444297">j</span><span class="op" id="8444298">,</span>&nbsp;<span class="ident" id="8444300">l</span>&nbsp;<span class="op" id="8444302">:=</span>&nbsp;<span class="keyword" id="8444305">range</span>&nbsp;<span class="ident" id="8444311">f</span><span class="op" id="8444312">.</span><span class="ident" id="8444313">infos</span>&nbsp;<span class="op" id="8444319">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8444324">m</span>&nbsp;<span class="op" id="8444326">:=</span>&nbsp;<span class="ident" id="8444329">g</span><span class="op" id="8444330">.</span><span class="ident" id="8444331">infos</span><span class="op" id="8444336">[</span><span class="ident" id="8444337">j</span><span class="op" id="8444338">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444343">if</span>&nbsp;<span class="ident" id="8444346">l</span><span class="op" id="8444347">.</span><span class="ident" id="8444348">Offset</span>&nbsp;<span class="op" id="8444355">!=</span>&nbsp;<span class="ident" id="8444358">m</span><span class="op" id="8444359">.</span><span class="ident" id="8444360">Offset</span>&nbsp;<span class="op" id="8444367">||</span>&nbsp;<span class="ident" id="8444370">l</span><span class="op" id="8444371">.</span><span class="ident" id="8444372">Filename</span>&nbsp;<span class="op" id="8444381">!=</span>&nbsp;<span class="ident" id="8444384">m</span><span class="op" id="8444385">.</span><span class="ident" id="8444386">Filename</span>&nbsp;<span class="op" id="8444395">||</span>&nbsp;<span class="ident" id="8444398">l</span><span class="op" id="8444399">.</span><span class="ident" id="8444400">Line</span>&nbsp;<span class="op" id="8444405">!=</span>&nbsp;<span class="ident" id="8444408">m</span><span class="op" id="8444409">.</span><span class="ident" id="8444410">Line</span>&nbsp;<span class="op" id="8444415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444421">return</span>&nbsp;<span class="ident" id="8444428">fmt</span><span class="op" id="8444431">.</span><span class="ident" id="8444432">Errorf</span><span class="op" id="8444438">(</span><span class="string" id="8444439">&#34;different&nbsp;infos&nbsp;for&nbsp;%q&#34;</span><span class="op" id="8444463">,</span>&nbsp;<span class="ident" id="8444465">f</span><span class="op" id="8444466">.</span><span class="ident" id="8444467">name</span><span class="op" id="8444471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444480">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8444487">//&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;about&nbsp;.last&nbsp;-&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444537">return</span>&nbsp;<span class="builtintype" id="8444544">nil</span><br>
<span class="lineno"></span><span class="op" id="8444548">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="8444551">func</span>&nbsp;<span class="ident" id="8444556">checkSerialize</span><span class="op" id="8444570">(</span><span class="ident" id="8444571">t</span>&nbsp;<span class="op" id="8444573">*</span><span class="ident" id="8444574">testing</span><span class="op" id="8444581">.</span><span class="ident" id="8444582">T</span><span class="op" id="8444583">,</span>&nbsp;<span class="ident" id="8444585">p</span>&nbsp;<span class="op" id="8444587">*</span><span class="ident" id="8444588">FileSet</span><span class="op" id="8444595">)</span>&nbsp;<span class="op" id="8444597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444600">var</span>&nbsp;<span class="ident" id="8444604">buf</span>&nbsp;<span class="ident" id="8444608">bytes</span><span class="op" id="8444613">.</span><span class="ident" id="8444614">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8444622">encode</span>&nbsp;<span class="op" id="8444629">:=</span>&nbsp;<span class="keyword" id="8444632">func</span><span class="op" id="8444636">(</span><span class="ident" id="8444637">x</span>&nbsp;<span class="keyword" id="8444639">interface</span><span class="op" id="8444648">{</span><span class="op" id="8444649">}</span><span class="op" id="8444650">)</span>&nbsp;<span class="builtintype" id="8444652">error</span>&nbsp;<span class="op" id="8444658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444662">return</span>&nbsp;<span class="ident" id="8444669">gob</span><span class="op" id="8444672">.</span><span class="ident" id="8444673">NewEncoder</span><span class="op" id="8444683">(</span><span class="op" id="8444684">&amp;</span><span class="ident" id="8444685">buf</span><span class="op" id="8444688">)</span><span class="op" id="8444689">.</span><span class="ident" id="8444690">Encode</span><span class="op" id="8444696">(</span><span class="ident" id="8444697">x</span><span class="op" id="8444698">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444704">if</span>&nbsp;<span class="ident" id="8444707">err</span>&nbsp;<span class="op" id="8444711">:=</span>&nbsp;<span class="ident" id="8444714">p</span><span class="op" id="8444715">.</span><span class="ident" id="8444716">Write</span><span class="op" id="8444721">(</span><span class="ident" id="8444722">encode</span><span class="op" id="8444728">)</span><span class="op" id="8444729">;</span>&nbsp;<span class="ident" id="8444731">err</span>&nbsp;<span class="op" id="8444735">!=</span>&nbsp;<span class="builtintype" id="8444738">nil</span>&nbsp;<span class="op" id="8444742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8444746">t</span><span class="op" id="8444747">.</span><span class="ident" id="8444748">Errorf</span><span class="op" id="8444754">(</span><span class="string" id="8444755">&#34;writing&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8444783">,</span>&nbsp;<span class="ident" id="8444785">err</span><span class="op" id="8444788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444792">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444800">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8444803">q</span>&nbsp;<span class="op" id="8444805">:=</span>&nbsp;<span class="ident" id="8444808">NewFileSet</span><span class="op" id="8444818">(</span><span class="op" id="8444819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8444822">decode</span>&nbsp;<span class="op" id="8444829">:=</span>&nbsp;<span class="keyword" id="8444832">func</span><span class="op" id="8444836">(</span><span class="ident" id="8444837">x</span>&nbsp;<span class="keyword" id="8444839">interface</span><span class="op" id="8444848">{</span><span class="op" id="8444849">}</span><span class="op" id="8444850">)</span>&nbsp;<span class="builtintype" id="8444852">error</span>&nbsp;<span class="op" id="8444858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444862">return</span>&nbsp;<span class="ident" id="8444869">gob</span><span class="op" id="8444872">.</span><span class="ident" id="8444873">NewDecoder</span><span class="op" id="8444883">(</span><span class="op" id="8444884">&amp;</span><span class="ident" id="8444885">buf</span><span class="op" id="8444888">)</span><span class="op" id="8444889">.</span><span class="ident" id="8444890">Decode</span><span class="op" id="8444896">(</span><span class="ident" id="8444897">x</span><span class="op" id="8444898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444904">if</span>&nbsp;<span class="ident" id="8444907">err</span>&nbsp;<span class="op" id="8444911">:=</span>&nbsp;<span class="ident" id="8444914">q</span><span class="op" id="8444915">.</span><span class="ident" id="8444916">Read</span><span class="op" id="8444920">(</span><span class="ident" id="8444921">decode</span><span class="op" id="8444927">)</span><span class="op" id="8444928">;</span>&nbsp;<span class="ident" id="8444930">err</span>&nbsp;<span class="op" id="8444934">!=</span>&nbsp;<span class="builtintype" id="8444937">nil</span>&nbsp;<span class="op" id="8444941">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8444945">t</span><span class="op" id="8444946">.</span><span class="ident" id="8444947">Errorf</span><span class="op" id="8444953">(</span><span class="string" id="8444954">&#34;reading&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8444982">,</span>&nbsp;<span class="ident" id="8444984">err</span><span class="op" id="8444987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444991">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8445002">if</span>&nbsp;<span class="ident" id="8445005">err</span>&nbsp;<span class="op" id="8445009">:=</span>&nbsp;<span class="ident" id="8445012">equal</span><span class="op" id="8445017">(</span><span class="ident" id="8445018">p</span><span class="op" id="8445019">,</span>&nbsp;<span class="ident" id="8445021">q</span><span class="op" id="8445022">)</span><span class="op" id="8445023">;</span>&nbsp;<span class="ident" id="8445025">err</span>&nbsp;<span class="op" id="8445029">!=</span>&nbsp;<span class="builtintype" id="8445032">nil</span>&nbsp;<span class="op" id="8445036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445040">t</span><span class="op" id="8445041">.</span><span class="ident" id="8445042">Errorf</span><span class="op" id="8445048">(</span><span class="string" id="8445049">&#34;filesets&nbsp;not&nbsp;identical:&nbsp;%s&#34;</span><span class="op" id="8445077">,</span>&nbsp;<span class="ident" id="8445079">err</span><span class="op" id="8445082">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8445085">}</span><br>
<span class="lineno"></span><span class="op" id="8445087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8445090">func</span>&nbsp;<span class="ident" id="8445095">TestSerialization</span><span class="op" id="8445112">(</span><span class="ident" id="8445113">t</span>&nbsp;<span class="op" id="8445115">*</span><span class="ident" id="8445116">testing</span><span class="op" id="8445123">.</span><span class="ident" id="8445124">T</span><span class="op" id="8445125">)</span>&nbsp;<span class="op" id="8445127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445130">p</span>&nbsp;<span class="op" id="8445132">:=</span>&nbsp;<span class="ident" id="8445135">NewFileSet</span><span class="op" id="8445145">(</span><span class="op" id="8445146">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445149">checkSerialize</span><span class="op" id="8445163">(</span><span class="ident" id="8445164">t</span><span class="op" id="8445165">,</span>&nbsp;<span class="ident" id="8445167">p</span><span class="op" id="8445168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8445171">//&nbsp;add&nbsp;some&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8445190">for</span>&nbsp;<span class="ident" id="8445194">i</span>&nbsp;<span class="op" id="8445196">:=</span>&nbsp;<span class="num" id="8445199">0</span><span class="op" id="8445200">;</span>&nbsp;<span class="ident" id="8445202">i</span>&nbsp;<span class="op" id="8445204">&lt;</span>&nbsp;<span class="num" id="8445206">10</span><span class="op" id="8445208">;</span>&nbsp;<span class="ident" id="8445210">i</span><span class="op" id="8445211">++</span>&nbsp;<span class="op" id="8445214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445218">f</span>&nbsp;<span class="op" id="8445220">:=</span>&nbsp;<span class="ident" id="8445223">p</span><span class="op" id="8445224">.</span><span class="ident" id="8445225">AddFile</span><span class="op" id="8445232">(</span><span class="ident" id="8445233">fmt</span><span class="op" id="8445236">.</span><span class="ident" id="8445237">Sprintf</span><span class="op" id="8445244">(</span><span class="string" id="8445245">&#34;file%d&#34;</span><span class="op" id="8445253">,</span>&nbsp;<span class="ident" id="8445255">i</span><span class="op" id="8445256">)</span><span class="op" id="8445257">,</span>&nbsp;<span class="ident" id="8445259">p</span><span class="op" id="8445260">.</span><span class="ident" id="8445261">Base</span><span class="op" id="8445265">(</span><span class="op" id="8445266">)</span><span class="op" id="8445267">+</span><span class="ident" id="8445268">i</span><span class="op" id="8445269">,</span>&nbsp;<span class="ident" id="8445271">i</span><span class="op" id="8445272">*</span><span class="num" id="8445273">100</span><span class="op" id="8445276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445280">checkSerialize</span><span class="op" id="8445294">(</span><span class="ident" id="8445295">t</span><span class="op" id="8445296">,</span>&nbsp;<span class="ident" id="8445298">p</span><span class="op" id="8445299">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8445303">//&nbsp;add&nbsp;some&nbsp;lines&nbsp;and&nbsp;alternative&nbsp;file&nbsp;infos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445350">line</span>&nbsp;<span class="op" id="8445355">:=</span>&nbsp;<span class="num" id="8445358">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8445365">for</span>&nbsp;<span class="ident" id="8445369">offs</span>&nbsp;<span class="op" id="8445374">:=</span>&nbsp;<span class="num" id="8445377">0</span><span class="op" id="8445378">;</span>&nbsp;<span class="ident" id="8445380">offs</span>&nbsp;<span class="op" id="8445385">&lt;</span>&nbsp;<span class="ident" id="8445387">f</span><span class="op" id="8445388">.</span><span class="ident" id="8445389">Size</span><span class="op" id="8445393">(</span><span class="op" id="8445394">)</span><span class="op" id="8445395">;</span>&nbsp;<span class="ident" id="8445397">offs</span>&nbsp;<span class="op" id="8445402">+=</span>&nbsp;<span class="num" id="8445405">40</span>&nbsp;<span class="op" id="8445408">+</span>&nbsp;<span class="ident" id="8445410">i</span>&nbsp;<span class="op" id="8445412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445417">f</span><span class="op" id="8445418">.</span><span class="ident" id="8445419">AddLine</span><span class="op" id="8445426">(</span><span class="ident" id="8445427">offs</span><span class="op" id="8445431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8445436">if</span>&nbsp;<span class="ident" id="8445439">offs</span><span class="op" id="8445443">%</span><span class="num" id="8445444">7</span>&nbsp;<span class="op" id="8445446">==</span>&nbsp;<span class="num" id="8445449">0</span>&nbsp;<span class="op" id="8445451">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445457">f</span><span class="op" id="8445458">.</span><span class="ident" id="8445459">AddLineInfo</span><span class="op" id="8445470">(</span><span class="ident" id="8445471">offs</span><span class="op" id="8445475">,</span>&nbsp;<span class="ident" id="8445477">fmt</span><span class="op" id="8445480">.</span><span class="ident" id="8445481">Sprintf</span><span class="op" id="8445488">(</span><span class="string" id="8445489">&#34;file%d&#34;</span><span class="op" id="8445497">,</span>&nbsp;<span class="ident" id="8445499">offs</span><span class="op" id="8445503">)</span><span class="op" id="8445504">,</span>&nbsp;<span class="ident" id="8445506">line</span><span class="op" id="8445510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445516">line</span>&nbsp;<span class="op" id="8445521">+=</span>&nbsp;<span class="num" id="8445524">33</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8445530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8445534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445538">checkSerialize</span><span class="op" id="8445552">(</span><span class="ident" id="8445553">t</span><span class="op" id="8445554">,</span>&nbsp;<span class="ident" id="8445556">p</span><span class="op" id="8445557">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8445560">}</span><br>
<span class="lineno"></span><span class="op" id="8445562">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
