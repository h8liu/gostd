<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3914947">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3915002">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3915056">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3915107">//go:generate&nbsp;go&nbsp;run&nbsp;decgen.go&nbsp;-output&nbsp;dec_helpers.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3915162">package</span>&nbsp;<span class="ident" id="3915170">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3915175">import</span>&nbsp;<span class="op" id="3915182">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915185">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915197">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915207">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915213">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915221">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3915231">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3915234">var</span>&nbsp;<span class="op" id="3915238">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915241">errBadUint</span>&nbsp;<span class="op" id="3915252">=</span>&nbsp;<span class="ident" id="3915254">errors</span><span class="op" id="3915260">.</span><span class="ident" id="3915261">New</span><span class="op" id="3915264">(</span><span class="string" id="3915265">&#34;gob:&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="3915309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915312">errBadType</span>&nbsp;<span class="op" id="3915323">=</span>&nbsp;<span class="ident" id="3915325">errors</span><span class="op" id="3915331">.</span><span class="ident" id="3915332">New</span><span class="op" id="3915335">(</span><span class="string" id="3915336">&#34;gob:&nbsp;unknown&nbsp;type&nbsp;id&nbsp;or&nbsp;corrupted&nbsp;data&#34;</span><span class="op" id="3915376">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915379">errRange</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3915390">=</span>&nbsp;<span class="ident" id="3915392">errors</span><span class="op" id="3915398">.</span><span class="ident" id="3915399">New</span><span class="op" id="3915402">(</span><span class="string" id="3915403">&#34;gob:&nbsp;bad&nbsp;data:&nbsp;field&nbsp;numbers&nbsp;out&nbsp;of&nbsp;bounds&#34;</span><span class="op" id="3915447">)</span><br>
<span class="lineno"></span><span class="op" id="3915449">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3915452">type</span>&nbsp;<span class="ident" id="3915457">decHelper</span>&nbsp;<span class="keyword" id="3915467">func</span><span class="op" id="3915471">(</span><span class="ident" id="3915472">state</span>&nbsp;<span class="op" id="3915478">*</span><span class="ident" id="3915479">decoderState</span><span class="op" id="3915491">,</span>&nbsp;<span class="ident" id="3915493">v</span>&nbsp;<span class="ident" id="3915495">reflect</span><span class="op" id="3915502">.</span><span class="ident" id="3915503">Value</span><span class="op" id="3915508">,</span>&nbsp;<span class="ident" id="3915510">length</span>&nbsp;<span class="builtintype" id="3915517">int</span><span class="op" id="3915520">,</span>&nbsp;<span class="ident" id="3915522">ovfl</span>&nbsp;<span class="builtintype" id="3915527">error</span><span class="op" id="3915532">)</span>&nbsp;<span class="builtintype" id="3915534">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3915540">//&nbsp;decoderState&nbsp;is&nbsp;the&nbsp;execution&nbsp;state&nbsp;of&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;decoder.&nbsp;A&nbsp;new&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="3915622">//&nbsp;is&nbsp;created&nbsp;for&nbsp;nested&nbsp;objects.</span><br>
<span class="lineno"></span><span class="keyword" id="3915656">type</span>&nbsp;<span class="ident" id="3915661">decoderState</span>&nbsp;<span class="keyword" id="3915674">struct</span>&nbsp;<span class="op" id="3915681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915684">dec</span>&nbsp;<span class="op" id="3915688">*</span><span class="ident" id="3915689">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3915698">//&nbsp;The&nbsp;buffer&nbsp;is&nbsp;stored&nbsp;with&nbsp;an&nbsp;extra&nbsp;indirection&nbsp;because&nbsp;it&nbsp;may&nbsp;be&nbsp;replaced</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3915776">//&nbsp;if&nbsp;we&nbsp;load&nbsp;a&nbsp;type&nbsp;during&nbsp;decode&nbsp;(when&nbsp;reading&nbsp;an&nbsp;interface&nbsp;value).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915847">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3915856">*</span><span class="ident" id="3915857">decBuffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915868">fieldnum</span>&nbsp;<span class="builtintype" id="3915877">int</span>&nbsp;<span class="comment" id="3915881">//&nbsp;the&nbsp;last&nbsp;field&nbsp;number&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915913">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3915922">[</span><span class="op" id="3915923">]</span><span class="builtintype" id="3915924">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915930">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3915939">*</span><span class="ident" id="3915940">decoderState</span>&nbsp;<span class="comment" id="3915953">//&nbsp;for&nbsp;free&nbsp;list</span><br>
<span class="lineno">35</span><span class="op" id="3915970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3915973">//&nbsp;decBuffer&nbsp;is&nbsp;an&nbsp;extremely&nbsp;simple,&nbsp;fast&nbsp;implementation&nbsp;of&nbsp;a&nbsp;read-only&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3916058">//&nbsp;It&nbsp;is&nbsp;initialized&nbsp;by&nbsp;calling&nbsp;Size&nbsp;and&nbsp;then&nbsp;copying&nbsp;the&nbsp;data&nbsp;into&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;Bytes().</span><br>
<span class="lineno"></span><span class="keyword" id="3916157">type</span>&nbsp;<span class="ident" id="3916162">decBuffer</span>&nbsp;<span class="keyword" id="3916172">struct</span>&nbsp;<span class="op" id="3916179">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916182">data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3916189">[</span><span class="op" id="3916190">]</span><span class="builtintype" id="3916191">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916197">offset</span>&nbsp;<span class="builtintype" id="3916204">int</span>&nbsp;<span class="comment" id="3916208">//&nbsp;Read&nbsp;offset.</span><br>
<span class="lineno"></span><span class="op" id="3916224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3916227">func</span>&nbsp;<span class="op" id="3916232">(</span><span class="ident" id="3916233">d</span>&nbsp;<span class="op" id="3916235">*</span><span class="ident" id="3916236">decBuffer</span><span class="op" id="3916245">)</span>&nbsp;<span class="ident" id="3916247">Read</span><span class="op" id="3916251">(</span><span class="ident" id="3916252">p</span>&nbsp;<span class="op" id="3916254">[</span><span class="op" id="3916255">]</span><span class="builtintype" id="3916256">byte</span><span class="op" id="3916260">)</span>&nbsp;<span class="op" id="3916262">(</span><span class="builtintype" id="3916263">int</span><span class="op" id="3916266">,</span>&nbsp;<span class="builtintype" id="3916268">error</span><span class="op" id="3916273">)</span>&nbsp;<span class="op" id="3916275">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916278">n</span>&nbsp;<span class="op" id="3916280">:=</span>&nbsp;<span class="builtinfunc" id="3916283">copy</span><span class="op" id="3916287">(</span><span class="ident" id="3916288">p</span><span class="op" id="3916289">,</span>&nbsp;<span class="ident" id="3916291">d</span><span class="op" id="3916292">.</span><span class="ident" id="3916293">data</span><span class="op" id="3916297">[</span><span class="ident" id="3916298">d</span><span class="op" id="3916299">.</span><span class="ident" id="3916300">offset</span><span class="op" id="3916306">:</span><span class="op" id="3916307">]</span><span class="op" id="3916308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916311">if</span>&nbsp;<span class="ident" id="3916314">n</span>&nbsp;<span class="op" id="3916316">==</span>&nbsp;<span class="num" id="3916319">0</span>&nbsp;<span class="op" id="3916321">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3916324">len</span><span class="op" id="3916327">(</span><span class="ident" id="3916328">p</span><span class="op" id="3916329">)</span>&nbsp;<span class="op" id="3916331">!=</span>&nbsp;<span class="num" id="3916334">0</span>&nbsp;<span class="op" id="3916336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916340">return</span>&nbsp;<span class="num" id="3916347">0</span><span class="op" id="3916348">,</span>&nbsp;<span class="ident" id="3916350">io</span><span class="op" id="3916352">.</span><span class="ident" id="3916353">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3916358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916361">d</span><span class="op" id="3916362">.</span><span class="ident" id="3916363">offset</span>&nbsp;<span class="op" id="3916370">+=</span>&nbsp;<span class="ident" id="3916373">n</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916376">return</span>&nbsp;<span class="ident" id="3916383">n</span><span class="op" id="3916384">,</span>&nbsp;<span class="ident" id="3916386">nil</span><br>
<span class="lineno"></span><span class="op" id="3916390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3916393">func</span>&nbsp;<span class="op" id="3916398">(</span><span class="ident" id="3916399">d</span>&nbsp;<span class="op" id="3916401">*</span><span class="ident" id="3916402">decBuffer</span><span class="op" id="3916411">)</span>&nbsp;<span class="ident" id="3916413">Drop</span><span class="op" id="3916417">(</span><span class="ident" id="3916418">n</span>&nbsp;<span class="builtintype" id="3916420">int</span><span class="op" id="3916423">)</span>&nbsp;<span class="op" id="3916425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916428">if</span>&nbsp;<span class="ident" id="3916431">n</span>&nbsp;<span class="op" id="3916433">&gt;</span>&nbsp;<span class="ident" id="3916435">d</span><span class="op" id="3916436">.</span><span class="ident" id="3916437">Len</span><span class="op" id="3916440">(</span><span class="op" id="3916441">)</span>&nbsp;<span class="op" id="3916443">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3916447">panic</span><span class="op" id="3916452">(</span><span class="string" id="3916453">&#34;drop&#34;</span><span class="op" id="3916459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3916462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916465">d</span><span class="op" id="3916466">.</span><span class="ident" id="3916467">offset</span>&nbsp;<span class="op" id="3916474">+=</span>&nbsp;<span class="ident" id="3916477">n</span><br>
<span class="lineno"></span><span class="op" id="3916479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3916482">//&nbsp;Size&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;exactly&nbsp;n&nbsp;bytes,&nbsp;so&nbsp;d.Bytes()&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="3916545">//&nbsp;return&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n.&nbsp;Existing&nbsp;data&nbsp;is&nbsp;first&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="3916610">func</span>&nbsp;<span class="op" id="3916615">(</span><span class="ident" id="3916616">d</span>&nbsp;<span class="op" id="3916618">*</span><span class="ident" id="3916619">decBuffer</span><span class="op" id="3916628">)</span>&nbsp;<span class="ident" id="3916630">Size</span><span class="op" id="3916634">(</span><span class="ident" id="3916635">n</span>&nbsp;<span class="builtintype" id="3916637">int</span><span class="op" id="3916640">)</span>&nbsp;<span class="op" id="3916642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916645">d</span><span class="op" id="3916646">.</span><span class="ident" id="3916647">Reset</span><span class="op" id="3916652">(</span><span class="op" id="3916653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916656">if</span>&nbsp;<span class="builtinfunc" id="3916659">cap</span><span class="op" id="3916662">(</span><span class="ident" id="3916663">d</span><span class="op" id="3916664">.</span><span class="ident" id="3916665">data</span><span class="op" id="3916669">)</span>&nbsp;<span class="op" id="3916671">&lt;</span>&nbsp;<span class="ident" id="3916673">n</span>&nbsp;<span class="op" id="3916675">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916679">d</span><span class="op" id="3916680">.</span><span class="ident" id="3916681">data</span>&nbsp;<span class="op" id="3916686">=</span>&nbsp;<span class="builtinfunc" id="3916688">make</span><span class="op" id="3916692">(</span><span class="op" id="3916693">[</span><span class="op" id="3916694">]</span><span class="builtintype" id="3916695">byte</span><span class="op" id="3916699">,</span>&nbsp;<span class="ident" id="3916701">n</span><span class="op" id="3916702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3916705">}</span>&nbsp;<span class="keyword" id="3916707">else</span>&nbsp;<span class="op" id="3916712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916716">d</span><span class="op" id="3916717">.</span><span class="ident" id="3916718">data</span>&nbsp;<span class="op" id="3916723">=</span>&nbsp;<span class="ident" id="3916725">d</span><span class="op" id="3916726">.</span><span class="ident" id="3916727">data</span><span class="op" id="3916731">[</span><span class="num" id="3916732">0</span><span class="op" id="3916733">:</span><span class="ident" id="3916734">n</span><span class="op" id="3916735">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3916738">}</span><br>
<span class="lineno"></span><span class="op" id="3916740">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3916743">func</span>&nbsp;<span class="op" id="3916748">(</span><span class="ident" id="3916749">d</span>&nbsp;<span class="op" id="3916751">*</span><span class="ident" id="3916752">decBuffer</span><span class="op" id="3916761">)</span>&nbsp;<span class="ident" id="3916763">ReadByte</span><span class="op" id="3916771">(</span><span class="op" id="3916772">)</span>&nbsp;<span class="op" id="3916774">(</span><span class="builtintype" id="3916775">byte</span><span class="op" id="3916779">,</span>&nbsp;<span class="builtintype" id="3916781">error</span><span class="op" id="3916786">)</span>&nbsp;<span class="op" id="3916788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916791">if</span>&nbsp;<span class="ident" id="3916794">d</span><span class="op" id="3916795">.</span><span class="ident" id="3916796">offset</span>&nbsp;<span class="op" id="3916803">&gt;=</span>&nbsp;<span class="builtinfunc" id="3916806">len</span><span class="op" id="3916809">(</span><span class="ident" id="3916810">d</span><span class="op" id="3916811">.</span><span class="ident" id="3916812">data</span><span class="op" id="3916816">)</span>&nbsp;<span class="op" id="3916818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916822">return</span>&nbsp;<span class="num" id="3916829">0</span><span class="op" id="3916830">,</span>&nbsp;<span class="ident" id="3916832">io</span><span class="op" id="3916834">.</span><span class="ident" id="3916835">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3916840">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916843">c</span>&nbsp;<span class="op" id="3916845">:=</span>&nbsp;<span class="ident" id="3916848">d</span><span class="op" id="3916849">.</span><span class="ident" id="3916850">data</span><span class="op" id="3916854">[</span><span class="ident" id="3916855">d</span><span class="op" id="3916856">.</span><span class="ident" id="3916857">offset</span><span class="op" id="3916863">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916866">d</span><span class="op" id="3916867">.</span><span class="ident" id="3916868">offset</span><span class="op" id="3916874">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916878">return</span>&nbsp;<span class="ident" id="3916885">c</span><span class="op" id="3916886">,</span>&nbsp;<span class="ident" id="3916888">nil</span><br>
<span class="lineno"></span><span class="op" id="3916892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="3916895">func</span>&nbsp;<span class="op" id="3916900">(</span><span class="ident" id="3916901">d</span>&nbsp;<span class="op" id="3916903">*</span><span class="ident" id="3916904">decBuffer</span><span class="op" id="3916913">)</span>&nbsp;<span class="ident" id="3916915">Len</span><span class="op" id="3916918">(</span><span class="op" id="3916919">)</span>&nbsp;<span class="builtintype" id="3916921">int</span>&nbsp;<span class="op" id="3916925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916928">return</span>&nbsp;<span class="builtinfunc" id="3916935">len</span><span class="op" id="3916938">(</span><span class="ident" id="3916939">d</span><span class="op" id="3916940">.</span><span class="ident" id="3916941">data</span><span class="op" id="3916945">)</span>&nbsp;<span class="op" id="3916947">-</span>&nbsp;<span class="ident" id="3916949">d</span><span class="op" id="3916950">.</span><span class="ident" id="3916951">offset</span><br>
<span class="lineno"></span><span class="op" id="3916958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3916961">func</span>&nbsp;<span class="op" id="3916966">(</span><span class="ident" id="3916967">d</span>&nbsp;<span class="op" id="3916969">*</span><span class="ident" id="3916970">decBuffer</span><span class="op" id="3916979">)</span>&nbsp;<span class="ident" id="3916981">Bytes</span><span class="op" id="3916986">(</span><span class="op" id="3916987">)</span>&nbsp;<span class="op" id="3916989">[</span><span class="op" id="3916990">]</span><span class="builtintype" id="3916991">byte</span>&nbsp;<span class="op" id="3916996">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916999">return</span>&nbsp;<span class="ident" id="3917006">d</span><span class="op" id="3917007">.</span><span class="ident" id="3917008">data</span><span class="op" id="3917012">[</span><span class="ident" id="3917013">d</span><span class="op" id="3917014">.</span><span class="ident" id="3917015">offset</span><span class="op" id="3917021">:</span><span class="op" id="3917022">]</span><br>
<span class="lineno"></span><span class="op" id="3917024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3917027">func</span>&nbsp;<span class="op" id="3917032">(</span><span class="ident" id="3917033">d</span>&nbsp;<span class="op" id="3917035">*</span><span class="ident" id="3917036">decBuffer</span><span class="op" id="3917045">)</span>&nbsp;<span class="ident" id="3917047">Reset</span><span class="op" id="3917052">(</span><span class="op" id="3917053">)</span>&nbsp;<span class="op" id="3917055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917058">d</span><span class="op" id="3917059">.</span><span class="ident" id="3917060">data</span>&nbsp;<span class="op" id="3917065">=</span>&nbsp;<span class="ident" id="3917067">d</span><span class="op" id="3917068">.</span><span class="ident" id="3917069">data</span><span class="op" id="3917073">[</span><span class="num" id="3917074">0</span><span class="op" id="3917075">:</span><span class="num" id="3917076">0</span><span class="op" id="3917077">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917080">d</span><span class="op" id="3917081">.</span><span class="ident" id="3917082">offset</span>&nbsp;<span class="op" id="3917089">=</span>&nbsp;<span class="num" id="3917091">0</span><br>
<span class="lineno"></span><span class="op" id="3917093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3917096">//&nbsp;We&nbsp;pass&nbsp;the&nbsp;bytes.Buffer&nbsp;separately&nbsp;for&nbsp;easier&nbsp;testing&nbsp;of&nbsp;the&nbsp;infrastructure</span><br>
<span class="lineno"></span><span class="comment" id="3917176">//&nbsp;without&nbsp;requiring&nbsp;a&nbsp;full&nbsp;Decoder.</span><br>
<span class="lineno">95</span><span class="keyword" id="3917213">func</span>&nbsp;<span class="op" id="3917218">(</span><span class="ident" id="3917219">dec</span>&nbsp;<span class="op" id="3917223">*</span><span class="ident" id="3917224">Decoder</span><span class="op" id="3917231">)</span>&nbsp;<span class="ident" id="3917233">newDecoderState</span><span class="op" id="3917248">(</span><span class="ident" id="3917249">buf</span>&nbsp;<span class="op" id="3917253">*</span><span class="ident" id="3917254">decBuffer</span><span class="op" id="3917263">)</span>&nbsp;<span class="op" id="3917265">*</span><span class="ident" id="3917266">decoderState</span>&nbsp;<span class="op" id="3917279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917282">d</span>&nbsp;<span class="op" id="3917284">:=</span>&nbsp;<span class="ident" id="3917287">dec</span><span class="op" id="3917290">.</span><span class="ident" id="3917291">freeList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3917301">if</span>&nbsp;<span class="ident" id="3917304">d</span>&nbsp;<span class="op" id="3917306">==</span>&nbsp;<span class="ident" id="3917309">nil</span>&nbsp;<span class="op" id="3917313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917317">d</span>&nbsp;<span class="op" id="3917319">=</span>&nbsp;<span class="builtinfunc" id="3917321">new</span><span class="op" id="3917324">(</span><span class="ident" id="3917325">decoderState</span><span class="op" id="3917337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917341">d</span><span class="op" id="3917342">.</span><span class="ident" id="3917343">dec</span>&nbsp;<span class="op" id="3917347">=</span>&nbsp;<span class="ident" id="3917349">dec</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917355">d</span><span class="op" id="3917356">.</span><span class="ident" id="3917357">buf</span>&nbsp;<span class="op" id="3917361">=</span>&nbsp;<span class="builtinfunc" id="3917363">make</span><span class="op" id="3917367">(</span><span class="op" id="3917368">[</span><span class="op" id="3917369">]</span><span class="builtintype" id="3917370">byte</span><span class="op" id="3917374">,</span>&nbsp;<span class="ident" id="3917376">uint64Size</span><span class="op" id="3917386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3917389">}</span>&nbsp;<span class="keyword" id="3917391">else</span>&nbsp;<span class="op" id="3917396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917400">dec</span><span class="op" id="3917403">.</span><span class="ident" id="3917404">freeList</span>&nbsp;<span class="op" id="3917413">=</span>&nbsp;<span class="ident" id="3917415">d</span><span class="op" id="3917416">.</span><span class="ident" id="3917417">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3917423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917426">d</span><span class="op" id="3917427">.</span><span class="ident" id="3917428">b</span>&nbsp;<span class="op" id="3917430">=</span>&nbsp;<span class="ident" id="3917432">buf</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3917437">return</span>&nbsp;<span class="ident" id="3917444">d</span><br>
<span class="lineno"></span><span class="op" id="3917446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3917449">func</span>&nbsp;<span class="op" id="3917454">(</span><span class="ident" id="3917455">dec</span>&nbsp;<span class="op" id="3917459">*</span><span class="ident" id="3917460">Decoder</span><span class="op" id="3917467">)</span>&nbsp;<span class="ident" id="3917469">freeDecoderState</span><span class="op" id="3917485">(</span><span class="ident" id="3917486">d</span>&nbsp;<span class="op" id="3917488">*</span><span class="ident" id="3917489">decoderState</span><span class="op" id="3917501">)</span>&nbsp;<span class="op" id="3917503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917506">d</span><span class="op" id="3917507">.</span><span class="ident" id="3917508">next</span>&nbsp;<span class="op" id="3917513">=</span>&nbsp;<span class="ident" id="3917515">dec</span><span class="op" id="3917518">.</span><span class="ident" id="3917519">freeList</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917529">dec</span><span class="op" id="3917532">.</span><span class="ident" id="3917533">freeList</span>&nbsp;<span class="op" id="3917542">=</span>&nbsp;<span class="ident" id="3917544">d</span><br>
<span class="lineno"></span><span class="op" id="3917546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3917549">func</span>&nbsp;<span class="ident" id="3917554">overflow</span><span class="op" id="3917562">(</span><span class="ident" id="3917563">name</span>&nbsp;<span class="builtintype" id="3917568">string</span><span class="op" id="3917574">)</span>&nbsp;<span class="builtintype" id="3917576">error</span>&nbsp;<span class="op" id="3917582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3917585">return</span>&nbsp;<span class="ident" id="3917592">errors</span><span class="op" id="3917598">.</span><span class="ident" id="3917599">New</span><span class="op" id="3917602">(</span><span class="string" id="3917603">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="3917617">+</span>&nbsp;<span class="ident" id="3917619">name</span>&nbsp;<span class="op" id="3917624">+</span>&nbsp;<span class="string" id="3917626">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="3917642">)</span><br>
<span class="lineno">115</span><span class="op" id="3917644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3917647">//&nbsp;decodeUintReader&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;an&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="3917720">//&nbsp;Used&nbsp;only&nbsp;by&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;read&nbsp;the&nbsp;message&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="3917776">func</span>&nbsp;<span class="ident" id="3917781">decodeUintReader</span><span class="op" id="3917797">(</span><span class="ident" id="3917798">r</span>&nbsp;<span class="ident" id="3917800">io</span><span class="op" id="3917802">.</span><span class="ident" id="3917803">Reader</span><span class="op" id="3917809">,</span>&nbsp;<span class="ident" id="3917811">buf</span>&nbsp;<span class="op" id="3917815">[</span><span class="op" id="3917816">]</span><span class="builtintype" id="3917817">byte</span><span class="op" id="3917821">)</span>&nbsp;<span class="op" id="3917823">(</span><span class="ident" id="3917824">x</span>&nbsp;<span class="ident" id="3917826">uint64</span><span class="op" id="3917832">,</span>&nbsp;<span class="ident" id="3917834">width</span>&nbsp;<span class="builtintype" id="3917840">int</span><span class="op" id="3917843">,</span>&nbsp;<span class="ident" id="3917845">err</span>&nbsp;<span class="builtintype" id="3917849">error</span><span class="op" id="3917854">)</span>&nbsp;<span class="op" id="3917856">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917859">width</span>&nbsp;<span class="op" id="3917865">=</span>&nbsp;<span class="num" id="3917867">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917870">n</span><span class="op" id="3917871">,</span>&nbsp;<span class="ident" id="3917873">err</span>&nbsp;<span class="op" id="3917877">:=</span>&nbsp;<span class="ident" id="3917880">io</span><span class="op" id="3917882">.</span><span class="ident" id="3917883">ReadFull</span><span class="op" id="3917891">(</span><span class="ident" id="3917892">r</span><span class="op" id="3917893">,</span>&nbsp;<span class="ident" id="3917895">buf</span><span class="op" id="3917898">[</span><span class="num" id="3917899">0</span><span class="op" id="3917900">:</span><span class="ident" id="3917901">width</span><span class="op" id="3917906">]</span><span class="op" id="3917907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3917910">if</span>&nbsp;<span class="ident" id="3917913">n</span>&nbsp;<span class="op" id="3917915">==</span>&nbsp;<span class="num" id="3917918">0</span>&nbsp;<span class="op" id="3917920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3917924">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3917932">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917935">b</span>&nbsp;<span class="op" id="3917937">:=</span>&nbsp;<span class="ident" id="3917940">buf</span><span class="op" id="3917943">[</span><span class="num" id="3917944">0</span><span class="op" id="3917945">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3917948">if</span>&nbsp;<span class="ident" id="3917951">b</span>&nbsp;<span class="op" id="3917953">&lt;=</span>&nbsp;<span class="num" id="3917956">0x7f</span>&nbsp;<span class="op" id="3917961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3917965">return</span>&nbsp;<span class="ident" id="3917972">uint64</span><span class="op" id="3917978">(</span><span class="ident" id="3917979">b</span><span class="op" id="3917980">)</span><span class="op" id="3917981">,</span>&nbsp;<span class="ident" id="3917983">width</span><span class="op" id="3917988">,</span>&nbsp;<span class="ident" id="3917990">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3917995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917998">n</span>&nbsp;<span class="op" id="3918000">=</span>&nbsp;<span class="op" id="3918002">-</span><span class="builtintype" id="3918003">int</span><span class="op" id="3918006">(</span><span class="builtintype" id="3918007">int8</span><span class="op" id="3918011">(</span><span class="ident" id="3918012">b</span><span class="op" id="3918013">)</span><span class="op" id="3918014">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3918017">if</span>&nbsp;<span class="ident" id="3918020">n</span>&nbsp;<span class="op" id="3918022">&gt;</span>&nbsp;<span class="ident" id="3918024">uint64Size</span>&nbsp;<span class="op" id="3918035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3918039">err</span>&nbsp;<span class="op" id="3918043">=</span>&nbsp;<span class="ident" id="3918045">errBadUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3918058">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3918066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3918069">width</span><span class="op" id="3918074">,</span>&nbsp;<span class="ident" id="3918076">err</span>&nbsp;<span class="op" id="3918080">=</span>&nbsp;<span class="ident" id="3918082">io</span><span class="op" id="3918084">.</span><span class="ident" id="3918085">ReadFull</span><span class="op" id="3918093">(</span><span class="ident" id="3918094">r</span><span class="op" id="3918095">,</span>&nbsp;<span class="ident" id="3918097">buf</span><span class="op" id="3918100">[</span><span class="num" id="3918101">0</span><span class="op" id="3918102">:</span><span class="ident" id="3918103">n</span><span class="op" id="3918104">]</span><span class="op" id="3918105">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3918108">if</span>&nbsp;<span class="ident" id="3918111">err</span>&nbsp;<span class="op" id="3918115">!=</span>&nbsp;<span class="ident" id="3918118">nil</span>&nbsp;<span class="op" id="3918122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3918126">if</span>&nbsp;<span class="ident" id="3918129">err</span>&nbsp;<span class="op" id="3918133">==</span>&nbsp;<span class="ident" id="3918136">io</span><span class="op" id="3918138">.</span><span class="ident" id="3918139">EOF</span>&nbsp;<span class="op" id="3918143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3918148">err</span>&nbsp;<span class="op" id="3918152">=</span>&nbsp;<span class="ident" id="3918154">io</span><span class="op" id="3918156">.</span><span class="ident" id="3918157">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3918176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3918180">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3918188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918191">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3918257">for</span>&nbsp;<span class="ident" id="3918261">_</span><span class="op" id="3918262">,</span>&nbsp;<span class="ident" id="3918264">b</span>&nbsp;<span class="op" id="3918266">:=</span>&nbsp;<span class="keyword" id="3918269">range</span>&nbsp;<span class="ident" id="3918275">buf</span><span class="op" id="3918278">[</span><span class="num" id="3918279">0</span><span class="op" id="3918280">:</span><span class="ident" id="3918281">width</span><span class="op" id="3918286">]</span>&nbsp;<span class="op" id="3918288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3918292">x</span>&nbsp;<span class="op" id="3918294">=</span>&nbsp;<span class="ident" id="3918296">x</span><span class="op" id="3918297">&lt;&lt;</span><span class="num" id="3918299">8</span>&nbsp;<span class="op" id="3918301">|</span>&nbsp;<span class="ident" id="3918303">uint64</span><span class="op" id="3918309">(</span><span class="ident" id="3918310">b</span><span class="op" id="3918311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3918314">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3918317">width</span><span class="op" id="3918322">++</span>&nbsp;<span class="comment" id="3918325">//&nbsp;+1&nbsp;for&nbsp;length&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3918348">return</span><br>
<span class="lineno"></span><span class="op" id="3918355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3918358">//&nbsp;decodeUint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno">150</span><span class="comment" id="3918420">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="3918452">func</span>&nbsp;<span class="op" id="3918457">(</span><span class="ident" id="3918458">state</span>&nbsp;<span class="op" id="3918464">*</span><span class="ident" id="3918465">decoderState</span><span class="op" id="3918477">)</span>&nbsp;<span class="ident" id="3918479">decodeUint</span><span class="op" id="3918489">(</span><span class="op" id="3918490">)</span>&nbsp;<span class="op" id="3918492">(</span><span class="ident" id="3918493">x</span>&nbsp;<span class="ident" id="3918495">uint64</span><span class="op" id="3918501">)</span>&nbsp;<span class="op" id="3918503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3918506">b</span><span class="op" id="3918507">,</span>&nbsp;<span class="ident" id="3918509">err</span>&nbsp;<span class="op" id="3918513">:=</span>&nbsp;<span class="ident" id="3918516">state</span><span class="op" id="3918521">.</span><span class="ident" id="3918522">b</span><span class="op" id="3918523">.</span><span class="ident" id="3918524">ReadByte</span><span class="op" id="3918532">(</span><span class="op" id="3918533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3918536">if</span>&nbsp;<span class="ident" id="3918539">err</span>&nbsp;<span class="op" id="3918543">!=</span>&nbsp;<span class="ident" id="3918546">nil</span>&nbsp;<span class="op" id="3918550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3918554">error_</span><span class="op" id="3918560">(</span><span class="ident" id="3918561">err</span><span class="op" id="3918564">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3918567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3918570">if</span>&nbsp;<span class="ident" id="3918573">b</span>&nbsp;<span class="op" id="3918575">&lt;=</span>&nbsp;<span class="num" id="3918578">0x7f</span>&nbsp;<span class="op" id="3918583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3918587">return</span>&nbsp;<span class="ident" id="3918594">uint64</span><span class="op" id="3918600">(</span><span class="ident" id="3918601">b</span><span class="op" id="3918602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3918605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3918608">n</span>&nbsp;<span class="op" id="3918610">:=</span>&nbsp;<span class="op" id="3918613">-</span><span class="builtintype" id="3918614">int</span><span class="op" id="3918617">(</span><span class="builtintype" id="3918618">int8</span><span class="op" id="3918622">(</span><span class="ident" id="3918623">b</span><span class="op" id="3918624">)</span><span class="op" id="3918625">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3918628">if</span>&nbsp;<span class="ident" id="3918631">n</span>&nbsp;<span class="op" id="3918633">&gt;</span>&nbsp;<span class="ident" id="3918635">uint64Size</span>&nbsp;<span class="op" id="3918646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3918650">error_</span><span class="op" id="3918656">(</span><span class="ident" id="3918657">errBadUint</span><span class="op" id="3918667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3918670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3918673">width</span><span class="op" id="3918678">,</span>&nbsp;<span class="ident" id="3918680">err</span>&nbsp;<span class="op" id="3918684">:=</span>&nbsp;<span class="ident" id="3918687">state</span><span class="op" id="3918692">.</span><span class="ident" id="3918693">b</span><span class="op" id="3918694">.</span><span class="ident" id="3918695">Read</span><span class="op" id="3918699">(</span><span class="ident" id="3918700">state</span><span class="op" id="3918705">.</span><span class="ident" id="3918706">buf</span><span class="op" id="3918709">[</span><span class="num" id="3918710">0</span><span class="op" id="3918711">:</span><span class="ident" id="3918712">n</span><span class="op" id="3918713">]</span><span class="op" id="3918714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3918717">if</span>&nbsp;<span class="ident" id="3918720">err</span>&nbsp;<span class="op" id="3918724">!=</span>&nbsp;<span class="ident" id="3918727">nil</span>&nbsp;<span class="op" id="3918731">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3918735">error_</span><span class="op" id="3918741">(</span><span class="ident" id="3918742">err</span><span class="op" id="3918745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3918748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918751">//&nbsp;Don&#39;t&nbsp;need&nbsp;to&nbsp;check&nbsp;error;&nbsp;it&#39;s&nbsp;safe&nbsp;to&nbsp;loop&nbsp;regardless.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918812">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3918878">for</span>&nbsp;<span class="ident" id="3918882">_</span><span class="op" id="3918883">,</span>&nbsp;<span class="ident" id="3918885">b</span>&nbsp;<span class="op" id="3918887">:=</span>&nbsp;<span class="keyword" id="3918890">range</span>&nbsp;<span class="ident" id="3918896">state</span><span class="op" id="3918901">.</span><span class="ident" id="3918902">buf</span><span class="op" id="3918905">[</span><span class="num" id="3918906">0</span><span class="op" id="3918907">:</span><span class="ident" id="3918908">width</span><span class="op" id="3918913">]</span>&nbsp;<span class="op" id="3918915">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3918919">x</span>&nbsp;<span class="op" id="3918921">=</span>&nbsp;<span class="ident" id="3918923">x</span><span class="op" id="3918924">&lt;&lt;</span><span class="num" id="3918926">8</span>&nbsp;<span class="op" id="3918928">|</span>&nbsp;<span class="ident" id="3918930">uint64</span><span class="op" id="3918936">(</span><span class="ident" id="3918937">b</span><span class="op" id="3918938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3918941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3918944">return</span>&nbsp;<span class="ident" id="3918951">x</span><br>
<span class="lineno"></span><span class="op" id="3918953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="3918956">//&nbsp;decodeInt&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno"></span><span class="comment" id="3919015">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="3919047">func</span>&nbsp;<span class="op" id="3919052">(</span><span class="ident" id="3919053">state</span>&nbsp;<span class="op" id="3919059">*</span><span class="ident" id="3919060">decoderState</span><span class="op" id="3919072">)</span>&nbsp;<span class="ident" id="3919074">decodeInt</span><span class="op" id="3919083">(</span><span class="op" id="3919084">)</span>&nbsp;<span class="ident" id="3919086">int64</span>&nbsp;<span class="op" id="3919092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3919095">x</span>&nbsp;<span class="op" id="3919097">:=</span>&nbsp;<span class="ident" id="3919100">state</span><span class="op" id="3919105">.</span><span class="ident" id="3919106">decodeUint</span><span class="op" id="3919116">(</span><span class="op" id="3919117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3919120">if</span>&nbsp;<span class="ident" id="3919123">x</span><span class="op" id="3919124">&amp;</span><span class="num" id="3919125">1</span>&nbsp;<span class="op" id="3919127">!=</span>&nbsp;<span class="num" id="3919130">0</span>&nbsp;<span class="op" id="3919132">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3919136">return</span>&nbsp;<span class="op" id="3919143">^</span><span class="ident" id="3919144">int64</span><span class="op" id="3919149">(</span><span class="ident" id="3919150">x</span>&nbsp;<span class="op" id="3919152">&gt;&gt;</span>&nbsp;<span class="num" id="3919155">1</span><span class="op" id="3919156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3919159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3919162">return</span>&nbsp;<span class="ident" id="3919169">int64</span><span class="op" id="3919174">(</span><span class="ident" id="3919175">x</span>&nbsp;<span class="op" id="3919177">&gt;&gt;</span>&nbsp;<span class="num" id="3919180">1</span><span class="op" id="3919181">)</span><br>
<span class="lineno"></span><span class="op" id="3919183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="3919186">//&nbsp;decOp&nbsp;is&nbsp;the&nbsp;signature&nbsp;of&nbsp;a&nbsp;decoding&nbsp;operator&nbsp;for&nbsp;a&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="3919253">type</span>&nbsp;<span class="ident" id="3919258">decOp</span>&nbsp;<span class="keyword" id="3919264">func</span><span class="op" id="3919268">(</span><span class="ident" id="3919269">i</span>&nbsp;<span class="op" id="3919271">*</span><span class="ident" id="3919272">decInstr</span><span class="op" id="3919280">,</span>&nbsp;<span class="ident" id="3919282">state</span>&nbsp;<span class="op" id="3919288">*</span><span class="ident" id="3919289">decoderState</span><span class="op" id="3919301">,</span>&nbsp;<span class="ident" id="3919303">v</span>&nbsp;<span class="ident" id="3919305">reflect</span><span class="op" id="3919312">.</span><span class="ident" id="3919313">Value</span><span class="op" id="3919318">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3919321">//&nbsp;The&nbsp;&#39;instructions&#39;&nbsp;of&nbsp;the&nbsp;decoding&nbsp;machine</span><br>
<span class="lineno"></span><span class="keyword" id="3919367">type</span>&nbsp;<span class="ident" id="3919372">decInstr</span>&nbsp;<span class="keyword" id="3919381">struct</span>&nbsp;<span class="op" id="3919388">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3919391">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3919397">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3919404">field</span>&nbsp;<span class="builtintype" id="3919410">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3919416">//&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;wire&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3919450">index</span>&nbsp;<span class="op" id="3919456">[</span><span class="op" id="3919457">]</span><span class="builtintype" id="3919458">int</span>&nbsp;<span class="comment" id="3919462">//&nbsp;field&nbsp;access&nbsp;indices&nbsp;for&nbsp;destination&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3919508">ovfl</span>&nbsp;&nbsp;<span class="builtintype" id="3919514">error</span>&nbsp;<span class="comment" id="3919520">//&nbsp;error&nbsp;message&nbsp;for&nbsp;overflow/underflow&nbsp;(for&nbsp;arrays,&nbsp;of&nbsp;the&nbsp;elements)</span><br>
<span class="lineno"></span><span class="op" id="3919590">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="3919593">//&nbsp;ignoreUint&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3919650">func</span>&nbsp;<span class="ident" id="3919655">ignoreUint</span><span class="op" id="3919665">(</span><span class="ident" id="3919666">i</span>&nbsp;<span class="op" id="3919668">*</span><span class="ident" id="3919669">decInstr</span><span class="op" id="3919677">,</span>&nbsp;<span class="ident" id="3919679">state</span>&nbsp;<span class="op" id="3919685">*</span><span class="ident" id="3919686">decoderState</span><span class="op" id="3919698">,</span>&nbsp;<span class="ident" id="3919700">v</span>&nbsp;<span class="ident" id="3919702">reflect</span><span class="op" id="3919709">.</span><span class="ident" id="3919710">Value</span><span class="op" id="3919715">)</span>&nbsp;<span class="op" id="3919717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3919720">state</span><span class="op" id="3919725">.</span><span class="ident" id="3919726">decodeUint</span><span class="op" id="3919736">(</span><span class="op" id="3919737">)</span><br>
<span class="lineno"></span><span class="op" id="3919739">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="3919742">//&nbsp;ignoreTwoUints&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;to&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="3919821">//&nbsp;complex&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3919840">func</span>&nbsp;<span class="ident" id="3919845">ignoreTwoUints</span><span class="op" id="3919859">(</span><span class="ident" id="3919860">i</span>&nbsp;<span class="op" id="3919862">*</span><span class="ident" id="3919863">decInstr</span><span class="op" id="3919871">,</span>&nbsp;<span class="ident" id="3919873">state</span>&nbsp;<span class="op" id="3919879">*</span><span class="ident" id="3919880">decoderState</span><span class="op" id="3919892">,</span>&nbsp;<span class="ident" id="3919894">v</span>&nbsp;<span class="ident" id="3919896">reflect</span><span class="op" id="3919903">.</span><span class="ident" id="3919904">Value</span><span class="op" id="3919909">)</span>&nbsp;<span class="op" id="3919911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3919914">state</span><span class="op" id="3919919">.</span><span class="ident" id="3919920">decodeUint</span><span class="op" id="3919930">(</span><span class="op" id="3919931">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3919934">state</span><span class="op" id="3919939">.</span><span class="ident" id="3919940">decodeUint</span><span class="op" id="3919950">(</span><span class="op" id="3919951">)</span><br>
<span class="lineno"></span><span class="op" id="3919953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3919956">//&nbsp;Since&nbsp;the&nbsp;encoder&nbsp;writes&nbsp;no&nbsp;zeros,&nbsp;if&nbsp;we&nbsp;arrive&nbsp;at&nbsp;a&nbsp;decoder&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="3920028">//&nbsp;a&nbsp;value&nbsp;to&nbsp;extract&nbsp;and&nbsp;store.&nbsp;&nbsp;The&nbsp;field&nbsp;number&nbsp;has&nbsp;already&nbsp;been&nbsp;read</span><br>
<span class="lineno">210</span><span class="comment" id="3920101">//&nbsp;(it&#39;s&nbsp;how&nbsp;we&nbsp;knew&nbsp;to&nbsp;call&nbsp;this&nbsp;decoder).</span><br>
<span class="lineno"></span><span class="comment" id="3920145">//&nbsp;Each&nbsp;decoder&nbsp;is&nbsp;responsible&nbsp;for&nbsp;handling&nbsp;any&nbsp;indirections&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3920217">//&nbsp;with&nbsp;the&nbsp;data&nbsp;structure.&nbsp;&nbsp;If&nbsp;any&nbsp;pointer&nbsp;so&nbsp;reached&nbsp;is&nbsp;nil,&nbsp;allocation&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="3920296">//&nbsp;be&nbsp;done.</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3920309">//&nbsp;decAlloc&nbsp;takes&nbsp;a&nbsp;value&nbsp;and&nbsp;returns&nbsp;a&nbsp;settable&nbsp;value&nbsp;that&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="3920373">//&nbsp;be&nbsp;assigned&nbsp;to.&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer,&nbsp;decAlloc&nbsp;guarantees&nbsp;it&nbsp;points&nbsp;to&nbsp;storage.</span><br>
<span class="lineno"></span><span class="comment" id="3920461">//&nbsp;The&nbsp;callers&nbsp;to&nbsp;the&nbsp;individual&nbsp;decoders&nbsp;are&nbsp;expected&nbsp;to&nbsp;have&nbsp;used&nbsp;decAlloc.</span><br>
<span class="lineno"></span><span class="comment" id="3920539">//&nbsp;The&nbsp;individual&nbsp;decoders&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3920584">func</span>&nbsp;<span class="ident" id="3920589">decAlloc</span><span class="op" id="3920597">(</span><span class="ident" id="3920598">v</span>&nbsp;<span class="ident" id="3920600">reflect</span><span class="op" id="3920607">.</span><span class="ident" id="3920608">Value</span><span class="op" id="3920613">)</span>&nbsp;<span class="ident" id="3920615">reflect</span><span class="op" id="3920622">.</span><span class="ident" id="3920623">Value</span>&nbsp;<span class="op" id="3920629">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3920632">for</span>&nbsp;<span class="ident" id="3920636">v</span><span class="op" id="3920637">.</span><span class="ident" id="3920638">Kind</span><span class="op" id="3920642">(</span><span class="op" id="3920643">)</span>&nbsp;<span class="op" id="3920645">==</span>&nbsp;<span class="ident" id="3920648">reflect</span><span class="op" id="3920655">.</span><span class="ident" id="3920656">Ptr</span>&nbsp;<span class="op" id="3920660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3920664">if</span>&nbsp;<span class="ident" id="3920667">v</span><span class="op" id="3920668">.</span><span class="ident" id="3920669">IsNil</span><span class="op" id="3920674">(</span><span class="op" id="3920675">)</span>&nbsp;<span class="op" id="3920677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3920682">v</span><span class="op" id="3920683">.</span><span class="ident" id="3920684">Set</span><span class="op" id="3920687">(</span><span class="ident" id="3920688">reflect</span><span class="op" id="3920695">.</span><span class="ident" id="3920696">New</span><span class="op" id="3920699">(</span><span class="ident" id="3920700">v</span><span class="op" id="3920701">.</span><span class="ident" id="3920702">Type</span><span class="op" id="3920706">(</span><span class="op" id="3920707">)</span><span class="op" id="3920708">.</span><span class="ident" id="3920709">Elem</span><span class="op" id="3920713">(</span><span class="op" id="3920714">)</span><span class="op" id="3920715">)</span><span class="op" id="3920716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3920720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3920724">v</span>&nbsp;<span class="op" id="3920726">=</span>&nbsp;<span class="ident" id="3920728">v</span><span class="op" id="3920729">.</span><span class="ident" id="3920730">Elem</span><span class="op" id="3920734">(</span><span class="op" id="3920735">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3920738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3920741">return</span>&nbsp;<span class="ident" id="3920748">v</span><br>
<span class="lineno"></span><span class="op" id="3920750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3920753">//&nbsp;decBool&nbsp;decodes&nbsp;a&nbsp;uint&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;boolean&nbsp;in&nbsp;value.</span><br>
<span class="lineno">230</span><span class="keyword" id="3920816">func</span>&nbsp;<span class="ident" id="3920821">decBool</span><span class="op" id="3920828">(</span><span class="ident" id="3920829">i</span>&nbsp;<span class="op" id="3920831">*</span><span class="ident" id="3920832">decInstr</span><span class="op" id="3920840">,</span>&nbsp;<span class="ident" id="3920842">state</span>&nbsp;<span class="op" id="3920848">*</span><span class="ident" id="3920849">decoderState</span><span class="op" id="3920861">,</span>&nbsp;<span class="ident" id="3920863">value</span>&nbsp;<span class="ident" id="3920869">reflect</span><span class="op" id="3920876">.</span><span class="ident" id="3920877">Value</span><span class="op" id="3920882">)</span>&nbsp;<span class="op" id="3920884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3920887">value</span><span class="op" id="3920892">.</span><span class="ident" id="3920893">SetBool</span><span class="op" id="3920900">(</span><span class="ident" id="3920901">state</span><span class="op" id="3920906">.</span><span class="ident" id="3920907">decodeUint</span><span class="op" id="3920917">(</span><span class="op" id="3920918">)</span>&nbsp;<span class="op" id="3920920">!=</span>&nbsp;<span class="num" id="3920923">0</span><span class="op" id="3920924">)</span><br>
<span class="lineno"></span><span class="op" id="3920926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3920929">//&nbsp;decInt8&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int8&nbsp;in&nbsp;value.</span><br>
<span class="lineno">235</span><span class="keyword" id="3920994">func</span>&nbsp;<span class="ident" id="3920999">decInt8</span><span class="op" id="3921006">(</span><span class="ident" id="3921007">i</span>&nbsp;<span class="op" id="3921009">*</span><span class="ident" id="3921010">decInstr</span><span class="op" id="3921018">,</span>&nbsp;<span class="ident" id="3921020">state</span>&nbsp;<span class="op" id="3921026">*</span><span class="ident" id="3921027">decoderState</span><span class="op" id="3921039">,</span>&nbsp;<span class="ident" id="3921041">value</span>&nbsp;<span class="ident" id="3921047">reflect</span><span class="op" id="3921054">.</span><span class="ident" id="3921055">Value</span><span class="op" id="3921060">)</span>&nbsp;<span class="op" id="3921062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921065">v</span>&nbsp;<span class="op" id="3921067">:=</span>&nbsp;<span class="ident" id="3921070">state</span><span class="op" id="3921075">.</span><span class="ident" id="3921076">decodeInt</span><span class="op" id="3921085">(</span><span class="op" id="3921086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921089">if</span>&nbsp;<span class="ident" id="3921092">v</span>&nbsp;<span class="op" id="3921094">&lt;</span>&nbsp;<span class="ident" id="3921096">math</span><span class="op" id="3921100">.</span><span class="ident" id="3921101">MinInt8</span>&nbsp;<span class="op" id="3921109">||</span>&nbsp;<span class="ident" id="3921112">math</span><span class="op" id="3921116">.</span><span class="ident" id="3921117">MaxInt8</span>&nbsp;<span class="op" id="3921125">&lt;</span>&nbsp;<span class="ident" id="3921127">v</span>&nbsp;<span class="op" id="3921129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921133">error_</span><span class="op" id="3921139">(</span><span class="ident" id="3921140">i</span><span class="op" id="3921141">.</span><span class="ident" id="3921142">ovfl</span><span class="op" id="3921146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3921149">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921152">value</span><span class="op" id="3921157">.</span><span class="ident" id="3921158">SetInt</span><span class="op" id="3921164">(</span><span class="ident" id="3921165">v</span><span class="op" id="3921166">)</span><br>
<span class="lineno"></span><span class="op" id="3921168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3921171">//&nbsp;decUint8&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint8&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3921246">func</span>&nbsp;<span class="ident" id="3921251">decUint8</span><span class="op" id="3921259">(</span><span class="ident" id="3921260">i</span>&nbsp;<span class="op" id="3921262">*</span><span class="ident" id="3921263">decInstr</span><span class="op" id="3921271">,</span>&nbsp;<span class="ident" id="3921273">state</span>&nbsp;<span class="op" id="3921279">*</span><span class="ident" id="3921280">decoderState</span><span class="op" id="3921292">,</span>&nbsp;<span class="ident" id="3921294">value</span>&nbsp;<span class="ident" id="3921300">reflect</span><span class="op" id="3921307">.</span><span class="ident" id="3921308">Value</span><span class="op" id="3921313">)</span>&nbsp;<span class="op" id="3921315">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921318">v</span>&nbsp;<span class="op" id="3921320">:=</span>&nbsp;<span class="ident" id="3921323">state</span><span class="op" id="3921328">.</span><span class="ident" id="3921329">decodeUint</span><span class="op" id="3921339">(</span><span class="op" id="3921340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921343">if</span>&nbsp;<span class="ident" id="3921346">math</span><span class="op" id="3921350">.</span><span class="ident" id="3921351">MaxUint8</span>&nbsp;<span class="op" id="3921360">&lt;</span>&nbsp;<span class="ident" id="3921362">v</span>&nbsp;<span class="op" id="3921364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921368">error_</span><span class="op" id="3921374">(</span><span class="ident" id="3921375">i</span><span class="op" id="3921376">.</span><span class="ident" id="3921377">ovfl</span><span class="op" id="3921381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3921384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921387">value</span><span class="op" id="3921392">.</span><span class="ident" id="3921393">SetUint</span><span class="op" id="3921400">(</span><span class="ident" id="3921401">v</span><span class="op" id="3921402">)</span><br>
<span class="lineno">250</span><span class="op" id="3921404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3921407">//&nbsp;decInt16&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3921474">func</span>&nbsp;<span class="ident" id="3921479">decInt16</span><span class="op" id="3921487">(</span><span class="ident" id="3921488">i</span>&nbsp;<span class="op" id="3921490">*</span><span class="ident" id="3921491">decInstr</span><span class="op" id="3921499">,</span>&nbsp;<span class="ident" id="3921501">state</span>&nbsp;<span class="op" id="3921507">*</span><span class="ident" id="3921508">decoderState</span><span class="op" id="3921520">,</span>&nbsp;<span class="ident" id="3921522">value</span>&nbsp;<span class="ident" id="3921528">reflect</span><span class="op" id="3921535">.</span><span class="ident" id="3921536">Value</span><span class="op" id="3921541">)</span>&nbsp;<span class="op" id="3921543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921546">v</span>&nbsp;<span class="op" id="3921548">:=</span>&nbsp;<span class="ident" id="3921551">state</span><span class="op" id="3921556">.</span><span class="ident" id="3921557">decodeInt</span><span class="op" id="3921566">(</span><span class="op" id="3921567">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921570">if</span>&nbsp;<span class="ident" id="3921573">v</span>&nbsp;<span class="op" id="3921575">&lt;</span>&nbsp;<span class="ident" id="3921577">math</span><span class="op" id="3921581">.</span><span class="ident" id="3921582">MinInt16</span>&nbsp;<span class="op" id="3921591">||</span>&nbsp;<span class="ident" id="3921594">math</span><span class="op" id="3921598">.</span><span class="ident" id="3921599">MaxInt16</span>&nbsp;<span class="op" id="3921608">&lt;</span>&nbsp;<span class="ident" id="3921610">v</span>&nbsp;<span class="op" id="3921612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921616">error_</span><span class="op" id="3921622">(</span><span class="ident" id="3921623">i</span><span class="op" id="3921624">.</span><span class="ident" id="3921625">ovfl</span><span class="op" id="3921629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3921632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921635">value</span><span class="op" id="3921640">.</span><span class="ident" id="3921641">SetInt</span><span class="op" id="3921647">(</span><span class="ident" id="3921648">v</span><span class="op" id="3921649">)</span><br>
<span class="lineno"></span><span class="op" id="3921651">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="3921654">//&nbsp;decUint16&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3921731">func</span>&nbsp;<span class="ident" id="3921736">decUint16</span><span class="op" id="3921745">(</span><span class="ident" id="3921746">i</span>&nbsp;<span class="op" id="3921748">*</span><span class="ident" id="3921749">decInstr</span><span class="op" id="3921757">,</span>&nbsp;<span class="ident" id="3921759">state</span>&nbsp;<span class="op" id="3921765">*</span><span class="ident" id="3921766">decoderState</span><span class="op" id="3921778">,</span>&nbsp;<span class="ident" id="3921780">value</span>&nbsp;<span class="ident" id="3921786">reflect</span><span class="op" id="3921793">.</span><span class="ident" id="3921794">Value</span><span class="op" id="3921799">)</span>&nbsp;<span class="op" id="3921801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921804">v</span>&nbsp;<span class="op" id="3921806">:=</span>&nbsp;<span class="ident" id="3921809">state</span><span class="op" id="3921814">.</span><span class="ident" id="3921815">decodeUint</span><span class="op" id="3921825">(</span><span class="op" id="3921826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921829">if</span>&nbsp;<span class="ident" id="3921832">math</span><span class="op" id="3921836">.</span><span class="ident" id="3921837">MaxUint16</span>&nbsp;<span class="op" id="3921847">&lt;</span>&nbsp;<span class="ident" id="3921849">v</span>&nbsp;<span class="op" id="3921851">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921855">error_</span><span class="op" id="3921861">(</span><span class="ident" id="3921862">i</span><span class="op" id="3921863">.</span><span class="ident" id="3921864">ovfl</span><span class="op" id="3921868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3921871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921874">value</span><span class="op" id="3921879">.</span><span class="ident" id="3921880">SetUint</span><span class="op" id="3921887">(</span><span class="ident" id="3921888">v</span><span class="op" id="3921889">)</span><br>
<span class="lineno"></span><span class="op" id="3921891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="3921894">//&nbsp;decInt32&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int32&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3921961">func</span>&nbsp;<span class="ident" id="3921966">decInt32</span><span class="op" id="3921974">(</span><span class="ident" id="3921975">i</span>&nbsp;<span class="op" id="3921977">*</span><span class="ident" id="3921978">decInstr</span><span class="op" id="3921986">,</span>&nbsp;<span class="ident" id="3921988">state</span>&nbsp;<span class="op" id="3921994">*</span><span class="ident" id="3921995">decoderState</span><span class="op" id="3922007">,</span>&nbsp;<span class="ident" id="3922009">value</span>&nbsp;<span class="ident" id="3922015">reflect</span><span class="op" id="3922022">.</span><span class="ident" id="3922023">Value</span><span class="op" id="3922028">)</span>&nbsp;<span class="op" id="3922030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922033">v</span>&nbsp;<span class="op" id="3922035">:=</span>&nbsp;<span class="ident" id="3922038">state</span><span class="op" id="3922043">.</span><span class="ident" id="3922044">decodeInt</span><span class="op" id="3922053">(</span><span class="op" id="3922054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922057">if</span>&nbsp;<span class="ident" id="3922060">v</span>&nbsp;<span class="op" id="3922062">&lt;</span>&nbsp;<span class="ident" id="3922064">math</span><span class="op" id="3922068">.</span><span class="ident" id="3922069">MinInt32</span>&nbsp;<span class="op" id="3922078">||</span>&nbsp;<span class="ident" id="3922081">math</span><span class="op" id="3922085">.</span><span class="ident" id="3922086">MaxInt32</span>&nbsp;<span class="op" id="3922095">&lt;</span>&nbsp;<span class="ident" id="3922097">v</span>&nbsp;<span class="op" id="3922099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922103">error_</span><span class="op" id="3922109">(</span><span class="ident" id="3922110">i</span><span class="op" id="3922111">.</span><span class="ident" id="3922112">ovfl</span><span class="op" id="3922116">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3922119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922122">value</span><span class="op" id="3922127">.</span><span class="ident" id="3922128">SetInt</span><span class="op" id="3922134">(</span><span class="ident" id="3922135">v</span><span class="op" id="3922136">)</span><br>
<span class="lineno"></span><span class="op" id="3922138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3922141">//&nbsp;decUint32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint32&nbsp;in&nbsp;value.</span><br>
<span class="lineno">280</span><span class="keyword" id="3922218">func</span>&nbsp;<span class="ident" id="3922223">decUint32</span><span class="op" id="3922232">(</span><span class="ident" id="3922233">i</span>&nbsp;<span class="op" id="3922235">*</span><span class="ident" id="3922236">decInstr</span><span class="op" id="3922244">,</span>&nbsp;<span class="ident" id="3922246">state</span>&nbsp;<span class="op" id="3922252">*</span><span class="ident" id="3922253">decoderState</span><span class="op" id="3922265">,</span>&nbsp;<span class="ident" id="3922267">value</span>&nbsp;<span class="ident" id="3922273">reflect</span><span class="op" id="3922280">.</span><span class="ident" id="3922281">Value</span><span class="op" id="3922286">)</span>&nbsp;<span class="op" id="3922288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922291">v</span>&nbsp;<span class="op" id="3922293">:=</span>&nbsp;<span class="ident" id="3922296">state</span><span class="op" id="3922301">.</span><span class="ident" id="3922302">decodeUint</span><span class="op" id="3922312">(</span><span class="op" id="3922313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922316">if</span>&nbsp;<span class="ident" id="3922319">math</span><span class="op" id="3922323">.</span><span class="ident" id="3922324">MaxUint32</span>&nbsp;<span class="op" id="3922334">&lt;</span>&nbsp;<span class="ident" id="3922336">v</span>&nbsp;<span class="op" id="3922338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922342">error_</span><span class="op" id="3922348">(</span><span class="ident" id="3922349">i</span><span class="op" id="3922350">.</span><span class="ident" id="3922351">ovfl</span><span class="op" id="3922355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3922358">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922361">value</span><span class="op" id="3922366">.</span><span class="ident" id="3922367">SetUint</span><span class="op" id="3922374">(</span><span class="ident" id="3922375">v</span><span class="op" id="3922376">)</span><br>
<span class="lineno"></span><span class="op" id="3922378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3922381">//&nbsp;decInt64&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3922448">func</span>&nbsp;<span class="ident" id="3922453">decInt64</span><span class="op" id="3922461">(</span><span class="ident" id="3922462">i</span>&nbsp;<span class="op" id="3922464">*</span><span class="ident" id="3922465">decInstr</span><span class="op" id="3922473">,</span>&nbsp;<span class="ident" id="3922475">state</span>&nbsp;<span class="op" id="3922481">*</span><span class="ident" id="3922482">decoderState</span><span class="op" id="3922494">,</span>&nbsp;<span class="ident" id="3922496">value</span>&nbsp;<span class="ident" id="3922502">reflect</span><span class="op" id="3922509">.</span><span class="ident" id="3922510">Value</span><span class="op" id="3922515">)</span>&nbsp;<span class="op" id="3922517">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922520">v</span>&nbsp;<span class="op" id="3922522">:=</span>&nbsp;<span class="ident" id="3922525">state</span><span class="op" id="3922530">.</span><span class="ident" id="3922531">decodeInt</span><span class="op" id="3922540">(</span><span class="op" id="3922541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922544">value</span><span class="op" id="3922549">.</span><span class="ident" id="3922550">SetInt</span><span class="op" id="3922556">(</span><span class="ident" id="3922557">v</span><span class="op" id="3922558">)</span><br>
<span class="lineno"></span><span class="op" id="3922560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3922563">//&nbsp;decUint64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64&nbsp;in&nbsp;value.</span><br>
<span class="lineno">295</span><span class="keyword" id="3922640">func</span>&nbsp;<span class="ident" id="3922645">decUint64</span><span class="op" id="3922654">(</span><span class="ident" id="3922655">i</span>&nbsp;<span class="op" id="3922657">*</span><span class="ident" id="3922658">decInstr</span><span class="op" id="3922666">,</span>&nbsp;<span class="ident" id="3922668">state</span>&nbsp;<span class="op" id="3922674">*</span><span class="ident" id="3922675">decoderState</span><span class="op" id="3922687">,</span>&nbsp;<span class="ident" id="3922689">value</span>&nbsp;<span class="ident" id="3922695">reflect</span><span class="op" id="3922702">.</span><span class="ident" id="3922703">Value</span><span class="op" id="3922708">)</span>&nbsp;<span class="op" id="3922710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922713">v</span>&nbsp;<span class="op" id="3922715">:=</span>&nbsp;<span class="ident" id="3922718">state</span><span class="op" id="3922723">.</span><span class="ident" id="3922724">decodeUint</span><span class="op" id="3922734">(</span><span class="op" id="3922735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922738">value</span><span class="op" id="3922743">.</span><span class="ident" id="3922744">SetUint</span><span class="op" id="3922751">(</span><span class="ident" id="3922752">v</span><span class="op" id="3922753">)</span><br>
<span class="lineno"></span><span class="op" id="3922755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="3922758">//&nbsp;Floating-point&nbsp;numbers&nbsp;are&nbsp;transmitted&nbsp;as&nbsp;uint64s&nbsp;holding&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3922828">//&nbsp;of&nbsp;the&nbsp;underlying&nbsp;representation.&nbsp;&nbsp;They&nbsp;are&nbsp;sent&nbsp;byte-reversed,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3922900">//&nbsp;the&nbsp;exponent&nbsp;end&nbsp;coming&nbsp;out&nbsp;first,&nbsp;so&nbsp;integer&nbsp;floating&nbsp;point&nbsp;numbers</span><br>
<span class="lineno"></span><span class="comment" id="3922972">//&nbsp;(for&nbsp;example)&nbsp;transmit&nbsp;more&nbsp;compactly.&nbsp;&nbsp;This&nbsp;routine&nbsp;does&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3923037">//&nbsp;unswizzling.</span><br>
<span class="lineno">305</span><span class="keyword" id="3923053">func</span>&nbsp;<span class="ident" id="3923058">float64FromBits</span><span class="op" id="3923073">(</span><span class="ident" id="3923074">u</span>&nbsp;<span class="ident" id="3923076">uint64</span><span class="op" id="3923082">)</span>&nbsp;<span class="builtintype" id="3923084">float64</span>&nbsp;<span class="op" id="3923092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3923095">var</span>&nbsp;<span class="ident" id="3923099">v</span>&nbsp;<span class="ident" id="3923101">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3923109">for</span>&nbsp;<span class="ident" id="3923113">i</span>&nbsp;<span class="op" id="3923115">:=</span>&nbsp;<span class="num" id="3923118">0</span><span class="op" id="3923119">;</span>&nbsp;<span class="ident" id="3923121">i</span>&nbsp;<span class="op" id="3923123">&lt;</span>&nbsp;<span class="num" id="3923125">8</span><span class="op" id="3923126">;</span>&nbsp;<span class="ident" id="3923128">i</span><span class="op" id="3923129">++</span>&nbsp;<span class="op" id="3923132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923136">v</span>&nbsp;<span class="op" id="3923138">&lt;&lt;=</span>&nbsp;<span class="num" id="3923142">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923146">v</span>&nbsp;<span class="op" id="3923148">|=</span>&nbsp;<span class="ident" id="3923151">u</span>&nbsp;<span class="op" id="3923153">&amp;</span>&nbsp;<span class="num" id="3923155">0xFF</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923162">u</span>&nbsp;<span class="op" id="3923164">&gt;&gt;=</span>&nbsp;<span class="num" id="3923168">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3923171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3923174">return</span>&nbsp;<span class="ident" id="3923181">math</span><span class="op" id="3923185">.</span><span class="ident" id="3923186">Float64frombits</span><span class="op" id="3923201">(</span><span class="ident" id="3923202">v</span><span class="op" id="3923203">)</span><br>
<span class="lineno"></span><span class="op" id="3923205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="3923208">//&nbsp;float32FromBits&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="3923293">//&nbsp;number,&nbsp;and&nbsp;returns&nbsp;it.&nbsp;It&#39;s&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;float32&nbsp;and&nbsp;complex64.</span><br>
<span class="lineno"></span><span class="comment" id="3923370">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;float64&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;reflection&nbsp;needs,&nbsp;but&nbsp;its&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="3923447">//&nbsp;value&nbsp;is&nbsp;known&nbsp;to&nbsp;be&nbsp;accurately&nbsp;representable&nbsp;in&nbsp;a&nbsp;float32.</span><br>
<span class="lineno"></span><span class="keyword" id="3923510">func</span>&nbsp;<span class="ident" id="3923515">float32FromBits</span><span class="op" id="3923530">(</span><span class="ident" id="3923531">u</span>&nbsp;<span class="ident" id="3923533">uint64</span><span class="op" id="3923539">,</span>&nbsp;<span class="ident" id="3923541">ovfl</span>&nbsp;<span class="builtintype" id="3923546">error</span><span class="op" id="3923551">)</span>&nbsp;<span class="builtintype" id="3923553">float64</span>&nbsp;<span class="op" id="3923561">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923564">v</span>&nbsp;<span class="op" id="3923566">:=</span>&nbsp;<span class="ident" id="3923569">float64FromBits</span><span class="op" id="3923584">(</span><span class="ident" id="3923585">u</span><span class="op" id="3923586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923589">av</span>&nbsp;<span class="op" id="3923592">:=</span>&nbsp;<span class="ident" id="3923595">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3923598">if</span>&nbsp;<span class="ident" id="3923601">av</span>&nbsp;<span class="op" id="3923604">&lt;</span>&nbsp;<span class="num" id="3923606">0</span>&nbsp;<span class="op" id="3923608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923612">av</span>&nbsp;<span class="op" id="3923615">=</span>&nbsp;<span class="op" id="3923617">-</span><span class="ident" id="3923618">av</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3923622">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3923625">//&nbsp;+Inf&nbsp;is&nbsp;OK&nbsp;in&nbsp;both&nbsp;32-&nbsp;and&nbsp;64-bit&nbsp;floats.&nbsp;&nbsp;Underflow&nbsp;is&nbsp;always&nbsp;OK.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3923696">if</span>&nbsp;<span class="ident" id="3923699">math</span><span class="op" id="3923703">.</span><span class="ident" id="3923704">MaxFloat32</span>&nbsp;<span class="op" id="3923715">&lt;</span>&nbsp;<span class="ident" id="3923717">av</span>&nbsp;<span class="op" id="3923720">&amp;&amp;</span>&nbsp;<span class="ident" id="3923723">av</span>&nbsp;<span class="op" id="3923726">&lt;=</span>&nbsp;<span class="ident" id="3923729">math</span><span class="op" id="3923733">.</span><span class="ident" id="3923734">MaxFloat64</span>&nbsp;<span class="op" id="3923745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923749">error_</span><span class="op" id="3923755">(</span><span class="ident" id="3923756">ovfl</span><span class="op" id="3923760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3923763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3923766">return</span>&nbsp;<span class="ident" id="3923773">v</span><br>
<span class="lineno">330</span><span class="op" id="3923775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3923778">//&nbsp;decFloat32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="3923858">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3923893">func</span>&nbsp;<span class="ident" id="3923898">decFloat32</span><span class="op" id="3923908">(</span><span class="ident" id="3923909">i</span>&nbsp;<span class="op" id="3923911">*</span><span class="ident" id="3923912">decInstr</span><span class="op" id="3923920">,</span>&nbsp;<span class="ident" id="3923922">state</span>&nbsp;<span class="op" id="3923928">*</span><span class="ident" id="3923929">decoderState</span><span class="op" id="3923941">,</span>&nbsp;<span class="ident" id="3923943">value</span>&nbsp;<span class="ident" id="3923949">reflect</span><span class="op" id="3923956">.</span><span class="ident" id="3923957">Value</span><span class="op" id="3923962">)</span>&nbsp;<span class="op" id="3923964">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923967">value</span><span class="op" id="3923972">.</span><span class="ident" id="3923973">SetFloat</span><span class="op" id="3923981">(</span><span class="ident" id="3923982">float32FromBits</span><span class="op" id="3923997">(</span><span class="ident" id="3923998">state</span><span class="op" id="3924003">.</span><span class="ident" id="3924004">decodeUint</span><span class="op" id="3924014">(</span><span class="op" id="3924015">)</span><span class="op" id="3924016">,</span>&nbsp;<span class="ident" id="3924018">i</span><span class="op" id="3924019">.</span><span class="ident" id="3924020">ovfl</span><span class="op" id="3924024">)</span><span class="op" id="3924025">)</span><br>
<span class="lineno"></span><span class="op" id="3924027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3924030">//&nbsp;decFloat64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;64-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="3924110">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">340</span><span class="keyword" id="3924145">func</span>&nbsp;<span class="ident" id="3924150">decFloat64</span><span class="op" id="3924160">(</span><span class="ident" id="3924161">i</span>&nbsp;<span class="op" id="3924163">*</span><span class="ident" id="3924164">decInstr</span><span class="op" id="3924172">,</span>&nbsp;<span class="ident" id="3924174">state</span>&nbsp;<span class="op" id="3924180">*</span><span class="ident" id="3924181">decoderState</span><span class="op" id="3924193">,</span>&nbsp;<span class="ident" id="3924195">value</span>&nbsp;<span class="ident" id="3924201">reflect</span><span class="op" id="3924208">.</span><span class="ident" id="3924209">Value</span><span class="op" id="3924214">)</span>&nbsp;<span class="op" id="3924216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924219">value</span><span class="op" id="3924224">.</span><span class="ident" id="3924225">SetFloat</span><span class="op" id="3924233">(</span><span class="ident" id="3924234">float64FromBits</span><span class="op" id="3924249">(</span><span class="ident" id="3924250">state</span><span class="op" id="3924255">.</span><span class="ident" id="3924256">decodeUint</span><span class="op" id="3924266">(</span><span class="op" id="3924267">)</span><span class="op" id="3924268">)</span><span class="op" id="3924269">)</span><br>
<span class="lineno"></span><span class="op" id="3924271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3924274">//&nbsp;decComplex64&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno">345</span><span class="comment" id="3924344">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3924420">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="3924450">func</span>&nbsp;<span class="ident" id="3924455">decComplex64</span><span class="op" id="3924467">(</span><span class="ident" id="3924468">i</span>&nbsp;<span class="op" id="3924470">*</span><span class="ident" id="3924471">decInstr</span><span class="op" id="3924479">,</span>&nbsp;<span class="ident" id="3924481">state</span>&nbsp;<span class="op" id="3924487">*</span><span class="ident" id="3924488">decoderState</span><span class="op" id="3924500">,</span>&nbsp;<span class="ident" id="3924502">value</span>&nbsp;<span class="ident" id="3924508">reflect</span><span class="op" id="3924515">.</span><span class="ident" id="3924516">Value</span><span class="op" id="3924521">)</span>&nbsp;<span class="op" id="3924523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3924526">real</span>&nbsp;<span class="op" id="3924531">:=</span>&nbsp;<span class="ident" id="3924534">float32FromBits</span><span class="op" id="3924549">(</span><span class="ident" id="3924550">state</span><span class="op" id="3924555">.</span><span class="ident" id="3924556">decodeUint</span><span class="op" id="3924566">(</span><span class="op" id="3924567">)</span><span class="op" id="3924568">,</span>&nbsp;<span class="ident" id="3924570">i</span><span class="op" id="3924571">.</span><span class="ident" id="3924572">ovfl</span><span class="op" id="3924576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3924579">imag</span>&nbsp;<span class="op" id="3924584">:=</span>&nbsp;<span class="ident" id="3924587">float32FromBits</span><span class="op" id="3924602">(</span><span class="ident" id="3924603">state</span><span class="op" id="3924608">.</span><span class="ident" id="3924609">decodeUint</span><span class="op" id="3924619">(</span><span class="op" id="3924620">)</span><span class="op" id="3924621">,</span>&nbsp;<span class="ident" id="3924623">i</span><span class="op" id="3924624">.</span><span class="ident" id="3924625">ovfl</span><span class="op" id="3924629">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924632">value</span><span class="op" id="3924637">.</span><span class="ident" id="3924638">SetComplex</span><span class="op" id="3924648">(</span><span class="builtinfunc" id="3924649">complex</span><span class="op" id="3924656">(</span><span class="builtinfunc" id="3924657">real</span><span class="op" id="3924661">,</span>&nbsp;<span class="builtinfunc" id="3924663">imag</span><span class="op" id="3924667">)</span><span class="op" id="3924668">)</span><br>
<span class="lineno"></span><span class="op" id="3924670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3924673">//&nbsp;decComplex128&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3924744">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex128&nbsp;in&nbsp;value.</span><br>
<span class="lineno">355</span><span class="comment" id="3924821">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="3924851">func</span>&nbsp;<span class="ident" id="3924856">decComplex128</span><span class="op" id="3924869">(</span><span class="ident" id="3924870">i</span>&nbsp;<span class="op" id="3924872">*</span><span class="ident" id="3924873">decInstr</span><span class="op" id="3924881">,</span>&nbsp;<span class="ident" id="3924883">state</span>&nbsp;<span class="op" id="3924889">*</span><span class="ident" id="3924890">decoderState</span><span class="op" id="3924902">,</span>&nbsp;<span class="ident" id="3924904">value</span>&nbsp;<span class="ident" id="3924910">reflect</span><span class="op" id="3924917">.</span><span class="ident" id="3924918">Value</span><span class="op" id="3924923">)</span>&nbsp;<span class="op" id="3924925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3924928">real</span>&nbsp;<span class="op" id="3924933">:=</span>&nbsp;<span class="ident" id="3924936">float64FromBits</span><span class="op" id="3924951">(</span><span class="ident" id="3924952">state</span><span class="op" id="3924957">.</span><span class="ident" id="3924958">decodeUint</span><span class="op" id="3924968">(</span><span class="op" id="3924969">)</span><span class="op" id="3924970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3924973">imag</span>&nbsp;<span class="op" id="3924978">:=</span>&nbsp;<span class="ident" id="3924981">float64FromBits</span><span class="op" id="3924996">(</span><span class="ident" id="3924997">state</span><span class="op" id="3925002">.</span><span class="ident" id="3925003">decodeUint</span><span class="op" id="3925013">(</span><span class="op" id="3925014">)</span><span class="op" id="3925015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925018">value</span><span class="op" id="3925023">.</span><span class="ident" id="3925024">SetComplex</span><span class="op" id="3925034">(</span><span class="builtinfunc" id="3925035">complex</span><span class="op" id="3925042">(</span><span class="builtinfunc" id="3925043">real</span><span class="op" id="3925047">,</span>&nbsp;<span class="builtinfunc" id="3925049">imag</span><span class="op" id="3925053">)</span><span class="op" id="3925054">)</span><br>
<span class="lineno">360</span><span class="op" id="3925056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3925059">//&nbsp;decUint8Slice&nbsp;decodes&nbsp;a&nbsp;byte&nbsp;slice&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;slice&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="3925132">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="3925156">//&nbsp;uint8&nbsp;slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">365</span><span class="keyword" id="3925232">func</span>&nbsp;<span class="ident" id="3925237">decUint8Slice</span><span class="op" id="3925250">(</span><span class="ident" id="3925251">i</span>&nbsp;<span class="op" id="3925253">*</span><span class="ident" id="3925254">decInstr</span><span class="op" id="3925262">,</span>&nbsp;<span class="ident" id="3925264">state</span>&nbsp;<span class="op" id="3925270">*</span><span class="ident" id="3925271">decoderState</span><span class="op" id="3925283">,</span>&nbsp;<span class="ident" id="3925285">value</span>&nbsp;<span class="ident" id="3925291">reflect</span><span class="op" id="3925298">.</span><span class="ident" id="3925299">Value</span><span class="op" id="3925304">)</span>&nbsp;<span class="op" id="3925306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925309">u</span>&nbsp;<span class="op" id="3925311">:=</span>&nbsp;<span class="ident" id="3925314">state</span><span class="op" id="3925319">.</span><span class="ident" id="3925320">decodeUint</span><span class="op" id="3925330">(</span><span class="op" id="3925331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925334">n</span>&nbsp;<span class="op" id="3925336">:=</span>&nbsp;<span class="builtintype" id="3925339">int</span><span class="op" id="3925342">(</span><span class="ident" id="3925343">u</span><span class="op" id="3925344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925347">if</span>&nbsp;<span class="ident" id="3925350">n</span>&nbsp;<span class="op" id="3925352">&lt;</span>&nbsp;<span class="num" id="3925354">0</span>&nbsp;<span class="op" id="3925356">||</span>&nbsp;<span class="ident" id="3925359">uint64</span><span class="op" id="3925365">(</span><span class="ident" id="3925366">n</span><span class="op" id="3925367">)</span>&nbsp;<span class="op" id="3925369">!=</span>&nbsp;<span class="ident" id="3925372">u</span>&nbsp;<span class="op" id="3925374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925378">errorf</span><span class="op" id="3925384">(</span><span class="string" id="3925385">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="3925429">,</span>&nbsp;<span class="ident" id="3925431">value</span><span class="op" id="3925436">.</span><span class="ident" id="3925437">Type</span><span class="op" id="3925441">(</span><span class="op" id="3925442">)</span><span class="op" id="3925443">,</span>&nbsp;<span class="ident" id="3925445">u</span><span class="op" id="3925446">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925452">if</span>&nbsp;<span class="ident" id="3925455">n</span>&nbsp;<span class="op" id="3925457">&gt;</span>&nbsp;<span class="ident" id="3925459">state</span><span class="op" id="3925464">.</span><span class="ident" id="3925465">b</span><span class="op" id="3925466">.</span><span class="ident" id="3925467">Len</span><span class="op" id="3925470">(</span><span class="op" id="3925471">)</span>&nbsp;<span class="op" id="3925473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925477">errorf</span><span class="op" id="3925483">(</span><span class="string" id="3925484">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="3925517">,</span>&nbsp;<span class="ident" id="3925519">value</span><span class="op" id="3925524">.</span><span class="ident" id="3925525">Type</span><span class="op" id="3925529">(</span><span class="op" id="3925530">)</span><span class="op" id="3925531">,</span>&nbsp;<span class="ident" id="3925533">n</span><span class="op" id="3925534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925540">if</span>&nbsp;<span class="ident" id="3925543">n</span>&nbsp;<span class="op" id="3925545">&gt;</span>&nbsp;<span class="ident" id="3925547">tooBig</span>&nbsp;<span class="op" id="3925554">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925558">errorf</span><span class="op" id="3925564">(</span><span class="string" id="3925565">&#34;byte&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&#34;</span><span class="op" id="3925589">,</span>&nbsp;<span class="ident" id="3925591">n</span><span class="op" id="3925592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925598">if</span>&nbsp;<span class="ident" id="3925601">value</span><span class="op" id="3925606">.</span><span class="ident" id="3925607">Cap</span><span class="op" id="3925610">(</span><span class="op" id="3925611">)</span>&nbsp;<span class="op" id="3925613">&lt;</span>&nbsp;<span class="ident" id="3925615">n</span>&nbsp;<span class="op" id="3925617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925621">value</span><span class="op" id="3925626">.</span><span class="ident" id="3925627">Set</span><span class="op" id="3925630">(</span><span class="ident" id="3925631">reflect</span><span class="op" id="3925638">.</span><span class="ident" id="3925639">MakeSlice</span><span class="op" id="3925648">(</span><span class="ident" id="3925649">value</span><span class="op" id="3925654">.</span><span class="ident" id="3925655">Type</span><span class="op" id="3925659">(</span><span class="op" id="3925660">)</span><span class="op" id="3925661">,</span>&nbsp;<span class="ident" id="3925663">n</span><span class="op" id="3925664">,</span>&nbsp;<span class="ident" id="3925666">n</span><span class="op" id="3925667">)</span><span class="op" id="3925668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925671">}</span>&nbsp;<span class="keyword" id="3925673">else</span>&nbsp;<span class="op" id="3925678">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925682">value</span><span class="op" id="3925687">.</span><span class="ident" id="3925688">Set</span><span class="op" id="3925691">(</span><span class="ident" id="3925692">value</span><span class="op" id="3925697">.</span><span class="ident" id="3925698">Slice</span><span class="op" id="3925703">(</span><span class="num" id="3925704">0</span><span class="op" id="3925705">,</span>&nbsp;<span class="ident" id="3925707">n</span><span class="op" id="3925708">)</span><span class="op" id="3925709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925715">if</span>&nbsp;<span class="ident" id="3925718">_</span><span class="op" id="3925719">,</span>&nbsp;<span class="ident" id="3925721">err</span>&nbsp;<span class="op" id="3925725">:=</span>&nbsp;<span class="ident" id="3925728">state</span><span class="op" id="3925733">.</span><span class="ident" id="3925734">b</span><span class="op" id="3925735">.</span><span class="ident" id="3925736">Read</span><span class="op" id="3925740">(</span><span class="ident" id="3925741">value</span><span class="op" id="3925746">.</span><span class="ident" id="3925747">Bytes</span><span class="op" id="3925752">(</span><span class="op" id="3925753">)</span><span class="op" id="3925754">)</span><span class="op" id="3925755">;</span>&nbsp;<span class="ident" id="3925757">err</span>&nbsp;<span class="op" id="3925761">!=</span>&nbsp;<span class="ident" id="3925764">nil</span>&nbsp;<span class="op" id="3925768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925772">errorf</span><span class="op" id="3925778">(</span><span class="string" id="3925779">&#34;error&nbsp;decoding&nbsp;[]byte:&nbsp;%s&#34;</span><span class="op" id="3925806">,</span>&nbsp;<span class="ident" id="3925808">err</span><span class="op" id="3925811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925814">}</span><br>
<span class="lineno">385</span><span class="op" id="3925816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3925819">//&nbsp;decString&nbsp;decodes&nbsp;byte&nbsp;array&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;string&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="3925887">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="3925911">//&nbsp;Strings&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">390</span><span class="keyword" id="3925982">func</span>&nbsp;<span class="ident" id="3925987">decString</span><span class="op" id="3925996">(</span><span class="ident" id="3925997">i</span>&nbsp;<span class="op" id="3925999">*</span><span class="ident" id="3926000">decInstr</span><span class="op" id="3926008">,</span>&nbsp;<span class="ident" id="3926010">state</span>&nbsp;<span class="op" id="3926016">*</span><span class="ident" id="3926017">decoderState</span><span class="op" id="3926029">,</span>&nbsp;<span class="ident" id="3926031">value</span>&nbsp;<span class="ident" id="3926037">reflect</span><span class="op" id="3926044">.</span><span class="ident" id="3926045">Value</span><span class="op" id="3926050">)</span>&nbsp;<span class="op" id="3926052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926055">u</span>&nbsp;<span class="op" id="3926057">:=</span>&nbsp;<span class="ident" id="3926060">state</span><span class="op" id="3926065">.</span><span class="ident" id="3926066">decodeUint</span><span class="op" id="3926076">(</span><span class="op" id="3926077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926080">n</span>&nbsp;<span class="op" id="3926082">:=</span>&nbsp;<span class="builtintype" id="3926085">int</span><span class="op" id="3926088">(</span><span class="ident" id="3926089">u</span><span class="op" id="3926090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926093">if</span>&nbsp;<span class="ident" id="3926096">n</span>&nbsp;<span class="op" id="3926098">&lt;</span>&nbsp;<span class="num" id="3926100">0</span>&nbsp;<span class="op" id="3926102">||</span>&nbsp;<span class="ident" id="3926105">uint64</span><span class="op" id="3926111">(</span><span class="ident" id="3926112">n</span><span class="op" id="3926113">)</span>&nbsp;<span class="op" id="3926115">!=</span>&nbsp;<span class="ident" id="3926118">u</span>&nbsp;<span class="op" id="3926120">||</span>&nbsp;<span class="ident" id="3926123">n</span>&nbsp;<span class="op" id="3926125">&gt;</span>&nbsp;<span class="ident" id="3926127">state</span><span class="op" id="3926132">.</span><span class="ident" id="3926133">b</span><span class="op" id="3926134">.</span><span class="ident" id="3926135">Len</span><span class="op" id="3926138">(</span><span class="op" id="3926139">)</span>&nbsp;<span class="op" id="3926141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926145">errorf</span><span class="op" id="3926151">(</span><span class="string" id="3926152">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="3926196">,</span>&nbsp;<span class="ident" id="3926198">value</span><span class="op" id="3926203">.</span><span class="ident" id="3926204">Type</span><span class="op" id="3926208">(</span><span class="op" id="3926209">)</span><span class="op" id="3926210">,</span>&nbsp;<span class="ident" id="3926212">u</span><span class="op" id="3926213">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3926216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926219">if</span>&nbsp;<span class="ident" id="3926222">n</span>&nbsp;<span class="op" id="3926224">&gt;</span>&nbsp;<span class="ident" id="3926226">state</span><span class="op" id="3926231">.</span><span class="ident" id="3926232">b</span><span class="op" id="3926233">.</span><span class="ident" id="3926234">Len</span><span class="op" id="3926237">(</span><span class="op" id="3926238">)</span>&nbsp;<span class="op" id="3926240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926244">errorf</span><span class="op" id="3926250">(</span><span class="string" id="3926251">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="3926284">,</span>&nbsp;<span class="ident" id="3926286">value</span><span class="op" id="3926291">.</span><span class="ident" id="3926292">Type</span><span class="op" id="3926296">(</span><span class="op" id="3926297">)</span><span class="op" id="3926298">,</span>&nbsp;<span class="ident" id="3926300">n</span><span class="op" id="3926301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3926304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3926307">//&nbsp;Read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926326">data</span>&nbsp;<span class="op" id="3926331">:=</span>&nbsp;<span class="builtinfunc" id="3926334">make</span><span class="op" id="3926338">(</span><span class="op" id="3926339">[</span><span class="op" id="3926340">]</span><span class="builtintype" id="3926341">byte</span><span class="op" id="3926345">,</span>&nbsp;<span class="ident" id="3926347">n</span><span class="op" id="3926348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926351">if</span>&nbsp;<span class="ident" id="3926354">_</span><span class="op" id="3926355">,</span>&nbsp;<span class="ident" id="3926357">err</span>&nbsp;<span class="op" id="3926361">:=</span>&nbsp;<span class="ident" id="3926364">state</span><span class="op" id="3926369">.</span><span class="ident" id="3926370">b</span><span class="op" id="3926371">.</span><span class="ident" id="3926372">Read</span><span class="op" id="3926376">(</span><span class="ident" id="3926377">data</span><span class="op" id="3926381">)</span><span class="op" id="3926382">;</span>&nbsp;<span class="ident" id="3926384">err</span>&nbsp;<span class="op" id="3926388">!=</span>&nbsp;<span class="ident" id="3926391">nil</span>&nbsp;<span class="op" id="3926395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926399">errorf</span><span class="op" id="3926405">(</span><span class="string" id="3926406">&#34;error&nbsp;decoding&nbsp;string:&nbsp;%s&#34;</span><span class="op" id="3926433">,</span>&nbsp;<span class="ident" id="3926435">err</span><span class="op" id="3926438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3926441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926444">value</span><span class="op" id="3926449">.</span><span class="ident" id="3926450">SetString</span><span class="op" id="3926459">(</span><span class="builtintype" id="3926460">string</span><span class="op" id="3926466">(</span><span class="ident" id="3926467">data</span><span class="op" id="3926471">)</span><span class="op" id="3926472">)</span><br>
<span class="lineno">405</span><span class="op" id="3926474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3926477">//&nbsp;ignoreUint8Array&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;byte&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3926561">func</span>&nbsp;<span class="ident" id="3926566">ignoreUint8Array</span><span class="op" id="3926582">(</span><span class="ident" id="3926583">i</span>&nbsp;<span class="op" id="3926585">*</span><span class="ident" id="3926586">decInstr</span><span class="op" id="3926594">,</span>&nbsp;<span class="ident" id="3926596">state</span>&nbsp;<span class="op" id="3926602">*</span><span class="ident" id="3926603">decoderState</span><span class="op" id="3926615">,</span>&nbsp;<span class="ident" id="3926617">value</span>&nbsp;<span class="ident" id="3926623">reflect</span><span class="op" id="3926630">.</span><span class="ident" id="3926631">Value</span><span class="op" id="3926636">)</span>&nbsp;<span class="op" id="3926638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926641">b</span>&nbsp;<span class="op" id="3926643">:=</span>&nbsp;<span class="builtinfunc" id="3926646">make</span><span class="op" id="3926650">(</span><span class="op" id="3926651">[</span><span class="op" id="3926652">]</span><span class="builtintype" id="3926653">byte</span><span class="op" id="3926657">,</span>&nbsp;<span class="ident" id="3926659">state</span><span class="op" id="3926664">.</span><span class="ident" id="3926665">decodeUint</span><span class="op" id="3926675">(</span><span class="op" id="3926676">)</span><span class="op" id="3926677">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926680">state</span><span class="op" id="3926685">.</span><span class="ident" id="3926686">b</span><span class="op" id="3926687">.</span><span class="ident" id="3926688">Read</span><span class="op" id="3926692">(</span><span class="ident" id="3926693">b</span><span class="op" id="3926694">)</span><br>
<span class="lineno"></span><span class="op" id="3926696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3926699">//&nbsp;Execution&nbsp;engine</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="3926720">//&nbsp;The&nbsp;encoder&nbsp;engine&nbsp;is&nbsp;an&nbsp;array&nbsp;of&nbsp;instructions&nbsp;indexed&nbsp;by&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="3926810">//&nbsp;decoder.&nbsp;&nbsp;It&nbsp;is&nbsp;executed&nbsp;with&nbsp;random&nbsp;access&nbsp;according&nbsp;to&nbsp;field&nbsp;number.</span><br>
<span class="lineno"></span><span class="keyword" id="3926884">type</span>&nbsp;<span class="ident" id="3926889">decEngine</span>&nbsp;<span class="keyword" id="3926899">struct</span>&nbsp;<span class="op" id="3926906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926909">instr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3926918">[</span><span class="op" id="3926919">]</span><span class="ident" id="3926920">decInstr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926930">numInstr</span>&nbsp;<span class="builtintype" id="3926939">int</span>&nbsp;<span class="comment" id="3926943">//&nbsp;the&nbsp;number&nbsp;of&nbsp;active&nbsp;instructions</span><br>
<span class="lineno">420</span><span class="op" id="3926980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3926983">//&nbsp;decodeSingle&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;value&nbsp;that&nbsp;is&nbsp;not&nbsp;a&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3927070">//&nbsp;Such&nbsp;values&nbsp;are&nbsp;preceded&nbsp;by&nbsp;a&nbsp;zero,&nbsp;making&nbsp;them&nbsp;have&nbsp;the&nbsp;memory&nbsp;layout&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3927149">//&nbsp;struct&nbsp;field&nbsp;(although&nbsp;with&nbsp;an&nbsp;illegal&nbsp;field&nbsp;number).</span><br>
<span class="lineno">425</span><span class="keyword" id="3927206">func</span>&nbsp;<span class="op" id="3927211">(</span><span class="ident" id="3927212">dec</span>&nbsp;<span class="op" id="3927216">*</span><span class="ident" id="3927217">Decoder</span><span class="op" id="3927224">)</span>&nbsp;<span class="ident" id="3927226">decodeSingle</span><span class="op" id="3927238">(</span><span class="ident" id="3927239">engine</span>&nbsp;<span class="op" id="3927246">*</span><span class="ident" id="3927247">decEngine</span><span class="op" id="3927256">,</span>&nbsp;<span class="ident" id="3927258">ut</span>&nbsp;<span class="op" id="3927261">*</span><span class="ident" id="3927262">userTypeInfo</span><span class="op" id="3927274">,</span>&nbsp;<span class="ident" id="3927276">value</span>&nbsp;<span class="ident" id="3927282">reflect</span><span class="op" id="3927289">.</span><span class="ident" id="3927290">Value</span><span class="op" id="3927295">)</span>&nbsp;<span class="op" id="3927297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927300">state</span>&nbsp;<span class="op" id="3927306">:=</span>&nbsp;<span class="ident" id="3927309">dec</span><span class="op" id="3927312">.</span><span class="ident" id="3927313">newDecoderState</span><span class="op" id="3927328">(</span><span class="op" id="3927329">&amp;</span><span class="ident" id="3927330">dec</span><span class="op" id="3927333">.</span><span class="ident" id="3927334">buf</span><span class="op" id="3927337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927340">defer</span>&nbsp;<span class="ident" id="3927346">dec</span><span class="op" id="3927349">.</span><span class="ident" id="3927350">freeDecoderState</span><span class="op" id="3927366">(</span><span class="ident" id="3927367">state</span><span class="op" id="3927372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927375">state</span><span class="op" id="3927380">.</span><span class="ident" id="3927381">fieldnum</span>&nbsp;<span class="op" id="3927390">=</span>&nbsp;<span class="ident" id="3927392">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927408">if</span>&nbsp;<span class="ident" id="3927411">state</span><span class="op" id="3927416">.</span><span class="ident" id="3927417">decodeUint</span><span class="op" id="3927427">(</span><span class="op" id="3927428">)</span>&nbsp;<span class="op" id="3927430">!=</span>&nbsp;<span class="num" id="3927433">0</span>&nbsp;<span class="op" id="3927435">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927439">errorf</span><span class="op" id="3927445">(</span><span class="string" id="3927446">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="3927500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3927503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927506">instr</span>&nbsp;<span class="op" id="3927512">:=</span>&nbsp;<span class="op" id="3927515">&amp;</span><span class="ident" id="3927516">engine</span><span class="op" id="3927522">.</span><span class="ident" id="3927523">instr</span><span class="op" id="3927528">[</span><span class="ident" id="3927529">singletonField</span><span class="op" id="3927543">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927546">instr</span><span class="op" id="3927551">.</span><span class="ident" id="3927552">op</span><span class="op" id="3927554">(</span><span class="ident" id="3927555">instr</span><span class="op" id="3927560">,</span>&nbsp;<span class="ident" id="3927562">state</span><span class="op" id="3927567">,</span>&nbsp;<span class="ident" id="3927569">value</span><span class="op" id="3927574">)</span><br>
<span class="lineno"></span><span class="op" id="3927576">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="3927579">//&nbsp;decodeStruct&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3927646">//&nbsp;Indir&nbsp;is&nbsp;for&nbsp;the&nbsp;value,&nbsp;not&nbsp;the&nbsp;type.&nbsp;&nbsp;At&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;call&nbsp;it&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="3927719">//&nbsp;differ&nbsp;from&nbsp;ut.indir,&nbsp;which&nbsp;was&nbsp;computed&nbsp;when&nbsp;the&nbsp;engine&nbsp;was&nbsp;built.</span><br>
<span class="lineno"></span><span class="comment" id="3927790">//&nbsp;This&nbsp;state&nbsp;cannot&nbsp;arise&nbsp;for&nbsp;decodeSingle,&nbsp;which&nbsp;is&nbsp;called&nbsp;directly</span><br>
<span class="lineno">440</span><span class="comment" id="3927860">//&nbsp;from&nbsp;the&nbsp;user&#39;s&nbsp;value,&nbsp;not&nbsp;from&nbsp;the&nbsp;innards&nbsp;of&nbsp;an&nbsp;engine.</span><br>
<span class="lineno"></span><span class="keyword" id="3927921">func</span>&nbsp;<span class="op" id="3927926">(</span><span class="ident" id="3927927">dec</span>&nbsp;<span class="op" id="3927931">*</span><span class="ident" id="3927932">Decoder</span><span class="op" id="3927939">)</span>&nbsp;<span class="ident" id="3927941">decodeStruct</span><span class="op" id="3927953">(</span><span class="ident" id="3927954">engine</span>&nbsp;<span class="op" id="3927961">*</span><span class="ident" id="3927962">decEngine</span><span class="op" id="3927971">,</span>&nbsp;<span class="ident" id="3927973">ut</span>&nbsp;<span class="op" id="3927976">*</span><span class="ident" id="3927977">userTypeInfo</span><span class="op" id="3927989">,</span>&nbsp;<span class="ident" id="3927991">value</span>&nbsp;<span class="ident" id="3927997">reflect</span><span class="op" id="3928004">.</span><span class="ident" id="3928005">Value</span><span class="op" id="3928010">)</span>&nbsp;<span class="op" id="3928012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928015">state</span>&nbsp;<span class="op" id="3928021">:=</span>&nbsp;<span class="ident" id="3928024">dec</span><span class="op" id="3928027">.</span><span class="ident" id="3928028">newDecoderState</span><span class="op" id="3928043">(</span><span class="op" id="3928044">&amp;</span><span class="ident" id="3928045">dec</span><span class="op" id="3928048">.</span><span class="ident" id="3928049">buf</span><span class="op" id="3928052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928055">defer</span>&nbsp;<span class="ident" id="3928061">dec</span><span class="op" id="3928064">.</span><span class="ident" id="3928065">freeDecoderState</span><span class="op" id="3928081">(</span><span class="ident" id="3928082">state</span><span class="op" id="3928087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928090">state</span><span class="op" id="3928095">.</span><span class="ident" id="3928096">fieldnum</span>&nbsp;<span class="op" id="3928105">=</span>&nbsp;<span class="op" id="3928107">-</span><span class="num" id="3928108">1</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928111">for</span>&nbsp;<span class="ident" id="3928115">state</span><span class="op" id="3928120">.</span><span class="ident" id="3928121">b</span><span class="op" id="3928122">.</span><span class="ident" id="3928123">Len</span><span class="op" id="3928126">(</span><span class="op" id="3928127">)</span>&nbsp;<span class="op" id="3928129">&gt;</span>&nbsp;<span class="num" id="3928131">0</span>&nbsp;<span class="op" id="3928133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928137">delta</span>&nbsp;<span class="op" id="3928143">:=</span>&nbsp;<span class="builtintype" id="3928146">int</span><span class="op" id="3928149">(</span><span class="ident" id="3928150">state</span><span class="op" id="3928155">.</span><span class="ident" id="3928156">decodeUint</span><span class="op" id="3928166">(</span><span class="op" id="3928167">)</span><span class="op" id="3928168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928172">if</span>&nbsp;<span class="ident" id="3928175">delta</span>&nbsp;<span class="op" id="3928181">&lt;</span>&nbsp;<span class="num" id="3928183">0</span>&nbsp;<span class="op" id="3928185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928190">errorf</span><span class="op" id="3928196">(</span><span class="string" id="3928197">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="3928237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928241">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928245">if</span>&nbsp;<span class="ident" id="3928248">delta</span>&nbsp;<span class="op" id="3928254">==</span>&nbsp;<span class="num" id="3928257">0</span>&nbsp;<span class="op" id="3928259">{</span>&nbsp;<span class="comment" id="3928261">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928308">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928320">fieldnum</span>&nbsp;<span class="op" id="3928329">:=</span>&nbsp;<span class="ident" id="3928332">state</span><span class="op" id="3928337">.</span><span class="ident" id="3928338">fieldnum</span>&nbsp;<span class="op" id="3928347">+</span>&nbsp;<span class="ident" id="3928349">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928357">if</span>&nbsp;<span class="ident" id="3928360">fieldnum</span>&nbsp;<span class="op" id="3928369">&gt;=</span>&nbsp;<span class="builtinfunc" id="3928372">len</span><span class="op" id="3928375">(</span><span class="ident" id="3928376">engine</span><span class="op" id="3928382">.</span><span class="ident" id="3928383">instr</span><span class="op" id="3928388">)</span>&nbsp;<span class="op" id="3928390">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928395">error_</span><span class="op" id="3928401">(</span><span class="ident" id="3928402">errRange</span><span class="op" id="3928410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928415">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928427">instr</span>&nbsp;<span class="op" id="3928433">:=</span>&nbsp;<span class="op" id="3928436">&amp;</span><span class="ident" id="3928437">engine</span><span class="op" id="3928443">.</span><span class="ident" id="3928444">instr</span><span class="op" id="3928449">[</span><span class="ident" id="3928450">fieldnum</span><span class="op" id="3928458">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928462">var</span>&nbsp;<span class="ident" id="3928466">field</span>&nbsp;<span class="ident" id="3928472">reflect</span><span class="op" id="3928479">.</span><span class="ident" id="3928480">Value</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928488">if</span>&nbsp;<span class="ident" id="3928491">instr</span><span class="op" id="3928496">.</span><span class="ident" id="3928497">index</span>&nbsp;<span class="op" id="3928503">!=</span>&nbsp;<span class="ident" id="3928506">nil</span>&nbsp;<span class="op" id="3928510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3928515">//&nbsp;Otherwise&nbsp;the&nbsp;field&nbsp;is&nbsp;unknown&nbsp;to&nbsp;us&nbsp;and&nbsp;instr.op&nbsp;is&nbsp;an&nbsp;ignore&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928588">field</span>&nbsp;<span class="op" id="3928594">=</span>&nbsp;<span class="ident" id="3928596">value</span><span class="op" id="3928601">.</span><span class="ident" id="3928602">FieldByIndex</span><span class="op" id="3928614">(</span><span class="ident" id="3928615">instr</span><span class="op" id="3928620">.</span><span class="ident" id="3928621">index</span><span class="op" id="3928626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928631">if</span>&nbsp;<span class="ident" id="3928634">field</span><span class="op" id="3928639">.</span><span class="ident" id="3928640">Kind</span><span class="op" id="3928644">(</span><span class="op" id="3928645">)</span>&nbsp;<span class="op" id="3928647">==</span>&nbsp;<span class="ident" id="3928650">reflect</span><span class="op" id="3928657">.</span><span class="ident" id="3928658">Ptr</span>&nbsp;<span class="op" id="3928662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928668">field</span>&nbsp;<span class="op" id="3928674">=</span>&nbsp;<span class="ident" id="3928676">decAlloc</span><span class="op" id="3928684">(</span><span class="ident" id="3928685">field</span><span class="op" id="3928690">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928703">instr</span><span class="op" id="3928708">.</span><span class="ident" id="3928709">op</span><span class="op" id="3928711">(</span><span class="ident" id="3928712">instr</span><span class="op" id="3928717">,</span>&nbsp;<span class="ident" id="3928719">state</span><span class="op" id="3928724">,</span>&nbsp;<span class="ident" id="3928726">field</span><span class="op" id="3928731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928735">state</span><span class="op" id="3928740">.</span><span class="ident" id="3928741">fieldnum</span>&nbsp;<span class="op" id="3928750">=</span>&nbsp;<span class="ident" id="3928752">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928762">}</span><br>
<span class="lineno">470</span><span class="op" id="3928764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3928767">var</span>&nbsp;<span class="ident" id="3928771">noValue</span>&nbsp;<span class="ident" id="3928779">reflect</span><span class="op" id="3928786">.</span><span class="ident" id="3928787">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3928794">//&nbsp;ignoreStruct&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;struct&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">475</span><span class="keyword" id="3928862">func</span>&nbsp;<span class="op" id="3928867">(</span><span class="ident" id="3928868">dec</span>&nbsp;<span class="op" id="3928872">*</span><span class="ident" id="3928873">Decoder</span><span class="op" id="3928880">)</span>&nbsp;<span class="ident" id="3928882">ignoreStruct</span><span class="op" id="3928894">(</span><span class="ident" id="3928895">engine</span>&nbsp;<span class="op" id="3928902">*</span><span class="ident" id="3928903">decEngine</span><span class="op" id="3928912">)</span>&nbsp;<span class="op" id="3928914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928917">state</span>&nbsp;<span class="op" id="3928923">:=</span>&nbsp;<span class="ident" id="3928926">dec</span><span class="op" id="3928929">.</span><span class="ident" id="3928930">newDecoderState</span><span class="op" id="3928945">(</span><span class="op" id="3928946">&amp;</span><span class="ident" id="3928947">dec</span><span class="op" id="3928950">.</span><span class="ident" id="3928951">buf</span><span class="op" id="3928954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928957">defer</span>&nbsp;<span class="ident" id="3928963">dec</span><span class="op" id="3928966">.</span><span class="ident" id="3928967">freeDecoderState</span><span class="op" id="3928983">(</span><span class="ident" id="3928984">state</span><span class="op" id="3928989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928992">state</span><span class="op" id="3928997">.</span><span class="ident" id="3928998">fieldnum</span>&nbsp;<span class="op" id="3929007">=</span>&nbsp;<span class="op" id="3929009">-</span><span class="num" id="3929010">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929013">for</span>&nbsp;<span class="ident" id="3929017">state</span><span class="op" id="3929022">.</span><span class="ident" id="3929023">b</span><span class="op" id="3929024">.</span><span class="ident" id="3929025">Len</span><span class="op" id="3929028">(</span><span class="op" id="3929029">)</span>&nbsp;<span class="op" id="3929031">&gt;</span>&nbsp;<span class="num" id="3929033">0</span>&nbsp;<span class="op" id="3929035">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929039">delta</span>&nbsp;<span class="op" id="3929045">:=</span>&nbsp;<span class="builtintype" id="3929048">int</span><span class="op" id="3929051">(</span><span class="ident" id="3929052">state</span><span class="op" id="3929057">.</span><span class="ident" id="3929058">decodeUint</span><span class="op" id="3929068">(</span><span class="op" id="3929069">)</span><span class="op" id="3929070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929074">if</span>&nbsp;<span class="ident" id="3929077">delta</span>&nbsp;<span class="op" id="3929083">&lt;</span>&nbsp;<span class="num" id="3929085">0</span>&nbsp;<span class="op" id="3929087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929092">errorf</span><span class="op" id="3929098">(</span><span class="string" id="3929099">&#34;ignore&nbsp;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="3929146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3929150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929154">if</span>&nbsp;<span class="ident" id="3929157">delta</span>&nbsp;<span class="op" id="3929163">==</span>&nbsp;<span class="num" id="3929166">0</span>&nbsp;<span class="op" id="3929168">{</span>&nbsp;<span class="comment" id="3929170">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929217">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3929225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929229">fieldnum</span>&nbsp;<span class="op" id="3929238">:=</span>&nbsp;<span class="ident" id="3929241">state</span><span class="op" id="3929246">.</span><span class="ident" id="3929247">fieldnum</span>&nbsp;<span class="op" id="3929256">+</span>&nbsp;<span class="ident" id="3929258">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929266">if</span>&nbsp;<span class="ident" id="3929269">fieldnum</span>&nbsp;<span class="op" id="3929278">&gt;=</span>&nbsp;<span class="builtinfunc" id="3929281">len</span><span class="op" id="3929284">(</span><span class="ident" id="3929285">engine</span><span class="op" id="3929291">.</span><span class="ident" id="3929292">instr</span><span class="op" id="3929297">)</span>&nbsp;<span class="op" id="3929299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929304">error_</span><span class="op" id="3929310">(</span><span class="ident" id="3929311">errRange</span><span class="op" id="3929319">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3929323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929327">instr</span>&nbsp;<span class="op" id="3929333">:=</span>&nbsp;<span class="op" id="3929336">&amp;</span><span class="ident" id="3929337">engine</span><span class="op" id="3929343">.</span><span class="ident" id="3929344">instr</span><span class="op" id="3929349">[</span><span class="ident" id="3929350">fieldnum</span><span class="op" id="3929358">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929362">instr</span><span class="op" id="3929367">.</span><span class="ident" id="3929368">op</span><span class="op" id="3929370">(</span><span class="ident" id="3929371">instr</span><span class="op" id="3929376">,</span>&nbsp;<span class="ident" id="3929378">state</span><span class="op" id="3929383">,</span>&nbsp;<span class="ident" id="3929385">noValue</span><span class="op" id="3929392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929396">state</span><span class="op" id="3929401">.</span><span class="ident" id="3929402">fieldnum</span>&nbsp;<span class="op" id="3929411">=</span>&nbsp;<span class="ident" id="3929413">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3929423">}</span><br>
<span class="lineno">495</span><span class="op" id="3929425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3929428">//&nbsp;ignoreSingle&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;top-level&nbsp;non-struct&nbsp;value&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="3929503">//&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;when&nbsp;calling&nbsp;Decode&nbsp;with&nbsp;a&nbsp;nil&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3929567">func</span>&nbsp;<span class="op" id="3929572">(</span><span class="ident" id="3929573">dec</span>&nbsp;<span class="op" id="3929577">*</span><span class="ident" id="3929578">Decoder</span><span class="op" id="3929585">)</span>&nbsp;<span class="ident" id="3929587">ignoreSingle</span><span class="op" id="3929599">(</span><span class="ident" id="3929600">engine</span>&nbsp;<span class="op" id="3929607">*</span><span class="ident" id="3929608">decEngine</span><span class="op" id="3929617">)</span>&nbsp;<span class="op" id="3929619">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929622">state</span>&nbsp;<span class="op" id="3929628">:=</span>&nbsp;<span class="ident" id="3929631">dec</span><span class="op" id="3929634">.</span><span class="ident" id="3929635">newDecoderState</span><span class="op" id="3929650">(</span><span class="op" id="3929651">&amp;</span><span class="ident" id="3929652">dec</span><span class="op" id="3929655">.</span><span class="ident" id="3929656">buf</span><span class="op" id="3929659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929662">defer</span>&nbsp;<span class="ident" id="3929668">dec</span><span class="op" id="3929671">.</span><span class="ident" id="3929672">freeDecoderState</span><span class="op" id="3929688">(</span><span class="ident" id="3929689">state</span><span class="op" id="3929694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929697">state</span><span class="op" id="3929702">.</span><span class="ident" id="3929703">fieldnum</span>&nbsp;<span class="op" id="3929712">=</span>&nbsp;<span class="ident" id="3929714">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929730">delta</span>&nbsp;<span class="op" id="3929736">:=</span>&nbsp;<span class="builtintype" id="3929739">int</span><span class="op" id="3929742">(</span><span class="ident" id="3929743">state</span><span class="op" id="3929748">.</span><span class="ident" id="3929749">decodeUint</span><span class="op" id="3929759">(</span><span class="op" id="3929760">)</span><span class="op" id="3929761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929764">if</span>&nbsp;<span class="ident" id="3929767">delta</span>&nbsp;<span class="op" id="3929773">!=</span>&nbsp;<span class="num" id="3929776">0</span>&nbsp;<span class="op" id="3929778">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929782">errorf</span><span class="op" id="3929788">(</span><span class="string" id="3929789">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="3929843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3929846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929849">instr</span>&nbsp;<span class="op" id="3929855">:=</span>&nbsp;<span class="op" id="3929858">&amp;</span><span class="ident" id="3929859">engine</span><span class="op" id="3929865">.</span><span class="ident" id="3929866">instr</span><span class="op" id="3929871">[</span><span class="ident" id="3929872">singletonField</span><span class="op" id="3929886">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929889">instr</span><span class="op" id="3929894">.</span><span class="ident" id="3929895">op</span><span class="op" id="3929897">(</span><span class="ident" id="3929898">instr</span><span class="op" id="3929903">,</span>&nbsp;<span class="ident" id="3929905">state</span><span class="op" id="3929910">,</span>&nbsp;<span class="ident" id="3929912">noValue</span><span class="op" id="3929919">)</span><br>
<span class="lineno"></span><span class="op" id="3929921">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="comment" id="3929924">//&nbsp;decodeArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;decoding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="3929991">func</span>&nbsp;<span class="op" id="3929996">(</span><span class="ident" id="3929997">dec</span>&nbsp;<span class="op" id="3930001">*</span><span class="ident" id="3930002">Decoder</span><span class="op" id="3930009">)</span>&nbsp;<span class="ident" id="3930011">decodeArrayHelper</span><span class="op" id="3930028">(</span><span class="ident" id="3930029">state</span>&nbsp;<span class="op" id="3930035">*</span><span class="ident" id="3930036">decoderState</span><span class="op" id="3930048">,</span>&nbsp;<span class="ident" id="3930050">value</span>&nbsp;<span class="ident" id="3930056">reflect</span><span class="op" id="3930063">.</span><span class="ident" id="3930064">Value</span><span class="op" id="3930069">,</span>&nbsp;<span class="ident" id="3930071">elemOp</span>&nbsp;<span class="ident" id="3930078">decOp</span><span class="op" id="3930083">,</span>&nbsp;<span class="ident" id="3930085">length</span>&nbsp;<span class="builtintype" id="3930092">int</span><span class="op" id="3930095">,</span>&nbsp;<span class="ident" id="3930097">ovfl</span>&nbsp;<span class="builtintype" id="3930102">error</span><span class="op" id="3930107">,</span>&nbsp;<span class="ident" id="3930109">helper</span>&nbsp;<span class="ident" id="3930116">decHelper</span><span class="op" id="3930125">)</span>&nbsp;<span class="op" id="3930127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930130">if</span>&nbsp;<span class="ident" id="3930133">helper</span>&nbsp;<span class="op" id="3930140">!=</span>&nbsp;<span class="ident" id="3930143">nil</span>&nbsp;<span class="op" id="3930147">&amp;&amp;</span>&nbsp;<span class="ident" id="3930150">helper</span><span class="op" id="3930156">(</span><span class="ident" id="3930157">state</span><span class="op" id="3930162">,</span>&nbsp;<span class="ident" id="3930164">value</span><span class="op" id="3930169">,</span>&nbsp;<span class="ident" id="3930171">length</span><span class="op" id="3930177">,</span>&nbsp;<span class="ident" id="3930179">ovfl</span><span class="op" id="3930183">)</span>&nbsp;<span class="op" id="3930185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930189">return</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930200">instr</span>&nbsp;<span class="op" id="3930206">:=</span>&nbsp;<span class="op" id="3930209">&amp;</span><span class="ident" id="3930210">decInstr</span><span class="op" id="3930218">{</span><span class="ident" id="3930219">elemOp</span><span class="op" id="3930225">,</span>&nbsp;<span class="num" id="3930227">0</span><span class="op" id="3930228">,</span>&nbsp;<span class="ident" id="3930230">nil</span><span class="op" id="3930233">,</span>&nbsp;<span class="ident" id="3930235">ovfl</span><span class="op" id="3930239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930242">isPtr</span>&nbsp;<span class="op" id="3930248">:=</span>&nbsp;<span class="ident" id="3930251">value</span><span class="op" id="3930256">.</span><span class="ident" id="3930257">Type</span><span class="op" id="3930261">(</span><span class="op" id="3930262">)</span><span class="op" id="3930263">.</span><span class="ident" id="3930264">Elem</span><span class="op" id="3930268">(</span><span class="op" id="3930269">)</span><span class="op" id="3930270">.</span><span class="ident" id="3930271">Kind</span><span class="op" id="3930275">(</span><span class="op" id="3930276">)</span>&nbsp;<span class="op" id="3930278">==</span>&nbsp;<span class="ident" id="3930281">reflect</span><span class="op" id="3930288">.</span><span class="ident" id="3930289">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930294">for</span>&nbsp;<span class="ident" id="3930298">i</span>&nbsp;<span class="op" id="3930300">:=</span>&nbsp;<span class="num" id="3930303">0</span><span class="op" id="3930304">;</span>&nbsp;<span class="ident" id="3930306">i</span>&nbsp;<span class="op" id="3930308">&lt;</span>&nbsp;<span class="ident" id="3930310">length</span><span class="op" id="3930316">;</span>&nbsp;<span class="ident" id="3930318">i</span><span class="op" id="3930319">++</span>&nbsp;<span class="op" id="3930322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930326">if</span>&nbsp;<span class="ident" id="3930329">state</span><span class="op" id="3930334">.</span><span class="ident" id="3930335">b</span><span class="op" id="3930336">.</span><span class="ident" id="3930337">Len</span><span class="op" id="3930340">(</span><span class="op" id="3930341">)</span>&nbsp;<span class="op" id="3930343">==</span>&nbsp;<span class="num" id="3930346">0</span>&nbsp;<span class="op" id="3930348">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930353">errorf</span><span class="op" id="3930359">(</span><span class="string" id="3930360">&#34;decoding&nbsp;array&nbsp;or&nbsp;slice:&nbsp;length&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;elements)&#34;</span><span class="op" id="3930426">,</span>&nbsp;<span class="ident" id="3930428">length</span><span class="op" id="3930434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930442">v</span>&nbsp;<span class="op" id="3930444">:=</span>&nbsp;<span class="ident" id="3930447">value</span><span class="op" id="3930452">.</span><span class="ident" id="3930453">Index</span><span class="op" id="3930458">(</span><span class="ident" id="3930459">i</span><span class="op" id="3930460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930464">if</span>&nbsp;<span class="ident" id="3930467">isPtr</span>&nbsp;<span class="op" id="3930473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930478">v</span>&nbsp;<span class="op" id="3930480">=</span>&nbsp;<span class="ident" id="3930482">decAlloc</span><span class="op" id="3930490">(</span><span class="ident" id="3930491">v</span><span class="op" id="3930492">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930500">elemOp</span><span class="op" id="3930506">(</span><span class="ident" id="3930507">instr</span><span class="op" id="3930512">,</span>&nbsp;<span class="ident" id="3930514">state</span><span class="op" id="3930519">,</span>&nbsp;<span class="ident" id="3930521">v</span><span class="op" id="3930522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930525">}</span><br>
<span class="lineno"></span><span class="op" id="3930527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="3930530">//&nbsp;decodeArray&nbsp;decodes&nbsp;an&nbsp;array&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3930586">//&nbsp;The&nbsp;length&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;preceding&nbsp;the&nbsp;elements.&nbsp;&nbsp;Even&nbsp;though&nbsp;the&nbsp;length&nbsp;is&nbsp;redundant</span><br>
<span class="lineno"></span><span class="comment" id="3930684">//&nbsp;(it&#39;s&nbsp;part&nbsp;of&nbsp;the&nbsp;type),&nbsp;it&#39;s&nbsp;a&nbsp;useful&nbsp;check&nbsp;and&nbsp;is&nbsp;included&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3930765">func</span>&nbsp;<span class="op" id="3930770">(</span><span class="ident" id="3930771">dec</span>&nbsp;<span class="op" id="3930775">*</span><span class="ident" id="3930776">Decoder</span><span class="op" id="3930783">)</span>&nbsp;<span class="ident" id="3930785">decodeArray</span><span class="op" id="3930796">(</span><span class="ident" id="3930797">atyp</span>&nbsp;<span class="ident" id="3930802">reflect</span><span class="op" id="3930809">.</span><span class="ident" id="3930810">Type</span><span class="op" id="3930814">,</span>&nbsp;<span class="ident" id="3930816">state</span>&nbsp;<span class="op" id="3930822">*</span><span class="ident" id="3930823">decoderState</span><span class="op" id="3930835">,</span>&nbsp;<span class="ident" id="3930837">value</span>&nbsp;<span class="ident" id="3930843">reflect</span><span class="op" id="3930850">.</span><span class="ident" id="3930851">Value</span><span class="op" id="3930856">,</span>&nbsp;<span class="ident" id="3930858">elemOp</span>&nbsp;<span class="ident" id="3930865">decOp</span><span class="op" id="3930870">,</span>&nbsp;<span class="ident" id="3930872">length</span>&nbsp;<span class="builtintype" id="3930879">int</span><span class="op" id="3930882">,</span>&nbsp;<span class="ident" id="3930884">ovfl</span>&nbsp;<span class="builtintype" id="3930889">error</span><span class="op" id="3930894">,</span>&nbsp;<span class="ident" id="3930896">helper</span>&nbsp;<span class="ident" id="3930903">decHelper</span><span class="op" id="3930912">)</span>&nbsp;<span class="op" id="3930914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930917">if</span>&nbsp;<span class="ident" id="3930920">n</span>&nbsp;<span class="op" id="3930922">:=</span>&nbsp;<span class="ident" id="3930925">state</span><span class="op" id="3930930">.</span><span class="ident" id="3930931">decodeUint</span><span class="op" id="3930941">(</span><span class="op" id="3930942">)</span><span class="op" id="3930943">;</span>&nbsp;<span class="ident" id="3930945">n</span>&nbsp;<span class="op" id="3930947">!=</span>&nbsp;<span class="ident" id="3930950">uint64</span><span class="op" id="3930956">(</span><span class="ident" id="3930957">length</span><span class="op" id="3930963">)</span>&nbsp;<span class="op" id="3930965">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930969">errorf</span><span class="op" id="3930975">(</span><span class="string" id="3930976">&#34;length&nbsp;mismatch&nbsp;in&nbsp;decodeArray&#34;</span><span class="op" id="3931008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931014">dec</span><span class="op" id="3931017">.</span><span class="ident" id="3931018">decodeArrayHelper</span><span class="op" id="3931035">(</span><span class="ident" id="3931036">state</span><span class="op" id="3931041">,</span>&nbsp;<span class="ident" id="3931043">value</span><span class="op" id="3931048">,</span>&nbsp;<span class="ident" id="3931050">elemOp</span><span class="op" id="3931056">,</span>&nbsp;<span class="ident" id="3931058">length</span><span class="op" id="3931064">,</span>&nbsp;<span class="ident" id="3931066">ovfl</span><span class="op" id="3931070">,</span>&nbsp;<span class="ident" id="3931072">helper</span><span class="op" id="3931078">)</span><br>
<span class="lineno"></span><span class="op" id="3931080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="3931083">//&nbsp;decodeIntoValue&nbsp;is&nbsp;a&nbsp;helper&nbsp;for&nbsp;map&nbsp;decoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3931132">func</span>&nbsp;<span class="ident" id="3931137">decodeIntoValue</span><span class="op" id="3931152">(</span><span class="ident" id="3931153">state</span>&nbsp;<span class="op" id="3931159">*</span><span class="ident" id="3931160">decoderState</span><span class="op" id="3931172">,</span>&nbsp;<span class="ident" id="3931174">op</span>&nbsp;<span class="ident" id="3931177">decOp</span><span class="op" id="3931182">,</span>&nbsp;<span class="ident" id="3931184">isPtr</span>&nbsp;<span class="builtintype" id="3931190">bool</span><span class="op" id="3931194">,</span>&nbsp;<span class="ident" id="3931196">value</span>&nbsp;<span class="ident" id="3931202">reflect</span><span class="op" id="3931209">.</span><span class="ident" id="3931210">Value</span><span class="op" id="3931215">,</span>&nbsp;<span class="ident" id="3931217">ovfl</span>&nbsp;<span class="builtintype" id="3931222">error</span><span class="op" id="3931227">)</span>&nbsp;<span class="ident" id="3931229">reflect</span><span class="op" id="3931236">.</span><span class="ident" id="3931237">Value</span>&nbsp;<span class="op" id="3931243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931246">instr</span>&nbsp;<span class="op" id="3931252">:=</span>&nbsp;<span class="op" id="3931255">&amp;</span><span class="ident" id="3931256">decInstr</span><span class="op" id="3931264">{</span><span class="ident" id="3931265">op</span><span class="op" id="3931267">,</span>&nbsp;<span class="num" id="3931269">0</span><span class="op" id="3931270">,</span>&nbsp;<span class="ident" id="3931272">nil</span><span class="op" id="3931275">,</span>&nbsp;<span class="ident" id="3931277">ovfl</span><span class="op" id="3931281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931284">v</span>&nbsp;<span class="op" id="3931286">:=</span>&nbsp;<span class="ident" id="3931289">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931296">if</span>&nbsp;<span class="ident" id="3931299">isPtr</span>&nbsp;<span class="op" id="3931305">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931309">v</span>&nbsp;<span class="op" id="3931311">=</span>&nbsp;<span class="ident" id="3931313">decAlloc</span><span class="op" id="3931321">(</span><span class="ident" id="3931322">value</span><span class="op" id="3931327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931333">op</span><span class="op" id="3931335">(</span><span class="ident" id="3931336">instr</span><span class="op" id="3931341">,</span>&nbsp;<span class="ident" id="3931343">state</span><span class="op" id="3931348">,</span>&nbsp;<span class="ident" id="3931350">v</span><span class="op" id="3931351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931354">return</span>&nbsp;<span class="ident" id="3931361">value</span><br>
<span class="lineno"></span><span class="op" id="3931367">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="3931370">//&nbsp;decodeMap&nbsp;decodes&nbsp;a&nbsp;map&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3931421">//&nbsp;Maps&nbsp;are&nbsp;encoded&nbsp;as&nbsp;a&nbsp;length&nbsp;followed&nbsp;by&nbsp;key:value&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="comment" id="3931482">//&nbsp;Because&nbsp;the&nbsp;internals&nbsp;of&nbsp;maps&nbsp;are&nbsp;not&nbsp;visible&nbsp;to&nbsp;us,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="3931546">//&nbsp;use&nbsp;reflection&nbsp;rather&nbsp;than&nbsp;pointer&nbsp;magic.</span><br>
<span class="lineno">555</span><span class="keyword" id="3931591">func</span>&nbsp;<span class="op" id="3931596">(</span><span class="ident" id="3931597">dec</span>&nbsp;<span class="op" id="3931601">*</span><span class="ident" id="3931602">Decoder</span><span class="op" id="3931609">)</span>&nbsp;<span class="ident" id="3931611">decodeMap</span><span class="op" id="3931620">(</span><span class="ident" id="3931621">mtyp</span>&nbsp;<span class="ident" id="3931626">reflect</span><span class="op" id="3931633">.</span><span class="ident" id="3931634">Type</span><span class="op" id="3931638">,</span>&nbsp;<span class="ident" id="3931640">state</span>&nbsp;<span class="op" id="3931646">*</span><span class="ident" id="3931647">decoderState</span><span class="op" id="3931659">,</span>&nbsp;<span class="ident" id="3931661">value</span>&nbsp;<span class="ident" id="3931667">reflect</span><span class="op" id="3931674">.</span><span class="ident" id="3931675">Value</span><span class="op" id="3931680">,</span>&nbsp;<span class="ident" id="3931682">keyOp</span><span class="op" id="3931687">,</span>&nbsp;<span class="ident" id="3931689">elemOp</span>&nbsp;<span class="ident" id="3931696">decOp</span><span class="op" id="3931701">,</span>&nbsp;<span class="ident" id="3931703">ovfl</span>&nbsp;<span class="builtintype" id="3931708">error</span><span class="op" id="3931713">)</span>&nbsp;<span class="op" id="3931715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931718">if</span>&nbsp;<span class="ident" id="3931721">value</span><span class="op" id="3931726">.</span><span class="ident" id="3931727">IsNil</span><span class="op" id="3931732">(</span><span class="op" id="3931733">)</span>&nbsp;<span class="op" id="3931735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3931739">//&nbsp;Allocate&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931758">value</span><span class="op" id="3931763">.</span><span class="ident" id="3931764">Set</span><span class="op" id="3931767">(</span><span class="ident" id="3931768">reflect</span><span class="op" id="3931775">.</span><span class="ident" id="3931776">MakeMap</span><span class="op" id="3931783">(</span><span class="ident" id="3931784">mtyp</span><span class="op" id="3931788">)</span><span class="op" id="3931789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931792">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931795">n</span>&nbsp;<span class="op" id="3931797">:=</span>&nbsp;<span class="builtintype" id="3931800">int</span><span class="op" id="3931803">(</span><span class="ident" id="3931804">state</span><span class="op" id="3931809">.</span><span class="ident" id="3931810">decodeUint</span><span class="op" id="3931820">(</span><span class="op" id="3931821">)</span><span class="op" id="3931822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931825">keyIsPtr</span>&nbsp;<span class="op" id="3931834">:=</span>&nbsp;<span class="ident" id="3931837">mtyp</span><span class="op" id="3931841">.</span><span class="ident" id="3931842">Key</span><span class="op" id="3931845">(</span><span class="op" id="3931846">)</span><span class="op" id="3931847">.</span><span class="ident" id="3931848">Kind</span><span class="op" id="3931852">(</span><span class="op" id="3931853">)</span>&nbsp;<span class="op" id="3931855">==</span>&nbsp;<span class="ident" id="3931858">reflect</span><span class="op" id="3931865">.</span><span class="ident" id="3931866">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931871">elemIsPtr</span>&nbsp;<span class="op" id="3931881">:=</span>&nbsp;<span class="ident" id="3931884">mtyp</span><span class="op" id="3931888">.</span><span class="ident" id="3931889">Elem</span><span class="op" id="3931893">(</span><span class="op" id="3931894">)</span><span class="op" id="3931895">.</span><span class="ident" id="3931896">Kind</span><span class="op" id="3931900">(</span><span class="op" id="3931901">)</span>&nbsp;<span class="op" id="3931903">==</span>&nbsp;<span class="ident" id="3931906">reflect</span><span class="op" id="3931913">.</span><span class="ident" id="3931914">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931919">for</span>&nbsp;<span class="ident" id="3931923">i</span>&nbsp;<span class="op" id="3931925">:=</span>&nbsp;<span class="num" id="3931928">0</span><span class="op" id="3931929">;</span>&nbsp;<span class="ident" id="3931931">i</span>&nbsp;<span class="op" id="3931933">&lt;</span>&nbsp;<span class="ident" id="3931935">n</span><span class="op" id="3931936">;</span>&nbsp;<span class="ident" id="3931938">i</span><span class="op" id="3931939">++</span>&nbsp;<span class="op" id="3931942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931946">key</span>&nbsp;<span class="op" id="3931950">:=</span>&nbsp;<span class="ident" id="3931953">decodeIntoValue</span><span class="op" id="3931968">(</span><span class="ident" id="3931969">state</span><span class="op" id="3931974">,</span>&nbsp;<span class="ident" id="3931976">keyOp</span><span class="op" id="3931981">,</span>&nbsp;<span class="ident" id="3931983">keyIsPtr</span><span class="op" id="3931991">,</span>&nbsp;<span class="ident" id="3931993">allocValue</span><span class="op" id="3932003">(</span><span class="ident" id="3932004">mtyp</span><span class="op" id="3932008">.</span><span class="ident" id="3932009">Key</span><span class="op" id="3932012">(</span><span class="op" id="3932013">)</span><span class="op" id="3932014">)</span><span class="op" id="3932015">,</span>&nbsp;<span class="ident" id="3932017">ovfl</span><span class="op" id="3932021">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932025">elem</span>&nbsp;<span class="op" id="3932030">:=</span>&nbsp;<span class="ident" id="3932033">decodeIntoValue</span><span class="op" id="3932048">(</span><span class="ident" id="3932049">state</span><span class="op" id="3932054">,</span>&nbsp;<span class="ident" id="3932056">elemOp</span><span class="op" id="3932062">,</span>&nbsp;<span class="ident" id="3932064">elemIsPtr</span><span class="op" id="3932073">,</span>&nbsp;<span class="ident" id="3932075">allocValue</span><span class="op" id="3932085">(</span><span class="ident" id="3932086">mtyp</span><span class="op" id="3932090">.</span><span class="ident" id="3932091">Elem</span><span class="op" id="3932095">(</span><span class="op" id="3932096">)</span><span class="op" id="3932097">)</span><span class="op" id="3932098">,</span>&nbsp;<span class="ident" id="3932100">ovfl</span><span class="op" id="3932104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932108">value</span><span class="op" id="3932113">.</span><span class="ident" id="3932114">SetMapIndex</span><span class="op" id="3932125">(</span><span class="ident" id="3932126">key</span><span class="op" id="3932129">,</span>&nbsp;<span class="ident" id="3932131">elem</span><span class="op" id="3932135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3932138">}</span><br>
<span class="lineno"></span><span class="op" id="3932140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">570</span><span class="comment" id="3932143">//&nbsp;ignoreArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;discarding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="3932212">func</span>&nbsp;<span class="op" id="3932217">(</span><span class="ident" id="3932218">dec</span>&nbsp;<span class="op" id="3932222">*</span><span class="ident" id="3932223">Decoder</span><span class="op" id="3932230">)</span>&nbsp;<span class="ident" id="3932232">ignoreArrayHelper</span><span class="op" id="3932249">(</span><span class="ident" id="3932250">state</span>&nbsp;<span class="op" id="3932256">*</span><span class="ident" id="3932257">decoderState</span><span class="op" id="3932269">,</span>&nbsp;<span class="ident" id="3932271">elemOp</span>&nbsp;<span class="ident" id="3932278">decOp</span><span class="op" id="3932283">,</span>&nbsp;<span class="ident" id="3932285">length</span>&nbsp;<span class="builtintype" id="3932292">int</span><span class="op" id="3932295">)</span>&nbsp;<span class="op" id="3932297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932300">instr</span>&nbsp;<span class="op" id="3932306">:=</span>&nbsp;<span class="op" id="3932309">&amp;</span><span class="ident" id="3932310">decInstr</span><span class="op" id="3932318">{</span><span class="ident" id="3932319">elemOp</span><span class="op" id="3932325">,</span>&nbsp;<span class="num" id="3932327">0</span><span class="op" id="3932328">,</span>&nbsp;<span class="ident" id="3932330">nil</span><span class="op" id="3932333">,</span>&nbsp;<span class="ident" id="3932335">errors</span><span class="op" id="3932341">.</span><span class="ident" id="3932342">New</span><span class="op" id="3932345">(</span><span class="string" id="3932346">&#34;no&nbsp;error&#34;</span><span class="op" id="3932356">)</span><span class="op" id="3932357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932360">for</span>&nbsp;<span class="ident" id="3932364">i</span>&nbsp;<span class="op" id="3932366">:=</span>&nbsp;<span class="num" id="3932369">0</span><span class="op" id="3932370">;</span>&nbsp;<span class="ident" id="3932372">i</span>&nbsp;<span class="op" id="3932374">&lt;</span>&nbsp;<span class="ident" id="3932376">length</span><span class="op" id="3932382">;</span>&nbsp;<span class="ident" id="3932384">i</span><span class="op" id="3932385">++</span>&nbsp;<span class="op" id="3932388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932392">elemOp</span><span class="op" id="3932398">(</span><span class="ident" id="3932399">instr</span><span class="op" id="3932404">,</span>&nbsp;<span class="ident" id="3932406">state</span><span class="op" id="3932411">,</span>&nbsp;<span class="ident" id="3932413">noValue</span><span class="op" id="3932420">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3932423">}</span><br>
<span class="lineno"></span><span class="op" id="3932425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3932428">//&nbsp;ignoreArray&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;array&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3932501">func</span>&nbsp;<span class="op" id="3932506">(</span><span class="ident" id="3932507">dec</span>&nbsp;<span class="op" id="3932511">*</span><span class="ident" id="3932512">Decoder</span><span class="op" id="3932519">)</span>&nbsp;<span class="ident" id="3932521">ignoreArray</span><span class="op" id="3932532">(</span><span class="ident" id="3932533">state</span>&nbsp;<span class="op" id="3932539">*</span><span class="ident" id="3932540">decoderState</span><span class="op" id="3932552">,</span>&nbsp;<span class="ident" id="3932554">elemOp</span>&nbsp;<span class="ident" id="3932561">decOp</span><span class="op" id="3932566">,</span>&nbsp;<span class="ident" id="3932568">length</span>&nbsp;<span class="builtintype" id="3932575">int</span><span class="op" id="3932578">)</span>&nbsp;<span class="op" id="3932580">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932583">if</span>&nbsp;<span class="ident" id="3932586">n</span>&nbsp;<span class="op" id="3932588">:=</span>&nbsp;<span class="ident" id="3932591">state</span><span class="op" id="3932596">.</span><span class="ident" id="3932597">decodeUint</span><span class="op" id="3932607">(</span><span class="op" id="3932608">)</span><span class="op" id="3932609">;</span>&nbsp;<span class="ident" id="3932611">n</span>&nbsp;<span class="op" id="3932613">!=</span>&nbsp;<span class="ident" id="3932616">uint64</span><span class="op" id="3932622">(</span><span class="ident" id="3932623">length</span><span class="op" id="3932629">)</span>&nbsp;<span class="op" id="3932631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932635">errorf</span><span class="op" id="3932641">(</span><span class="string" id="3932642">&#34;length&nbsp;mismatch&nbsp;in&nbsp;ignoreArray&#34;</span><span class="op" id="3932674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3932677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932680">dec</span><span class="op" id="3932683">.</span><span class="ident" id="3932684">ignoreArrayHelper</span><span class="op" id="3932701">(</span><span class="ident" id="3932702">state</span><span class="op" id="3932707">,</span>&nbsp;<span class="ident" id="3932709">elemOp</span><span class="op" id="3932715">,</span>&nbsp;<span class="ident" id="3932717">length</span><span class="op" id="3932723">)</span><br>
<span class="lineno"></span><span class="op" id="3932725">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="comment" id="3932728">//&nbsp;ignoreMap&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;map&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3932796">func</span>&nbsp;<span class="op" id="3932801">(</span><span class="ident" id="3932802">dec</span>&nbsp;<span class="op" id="3932806">*</span><span class="ident" id="3932807">Decoder</span><span class="op" id="3932814">)</span>&nbsp;<span class="ident" id="3932816">ignoreMap</span><span class="op" id="3932825">(</span><span class="ident" id="3932826">state</span>&nbsp;<span class="op" id="3932832">*</span><span class="ident" id="3932833">decoderState</span><span class="op" id="3932845">,</span>&nbsp;<span class="ident" id="3932847">keyOp</span><span class="op" id="3932852">,</span>&nbsp;<span class="ident" id="3932854">elemOp</span>&nbsp;<span class="ident" id="3932861">decOp</span><span class="op" id="3932866">)</span>&nbsp;<span class="op" id="3932868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932871">n</span>&nbsp;<span class="op" id="3932873">:=</span>&nbsp;<span class="builtintype" id="3932876">int</span><span class="op" id="3932879">(</span><span class="ident" id="3932880">state</span><span class="op" id="3932885">.</span><span class="ident" id="3932886">decodeUint</span><span class="op" id="3932896">(</span><span class="op" id="3932897">)</span><span class="op" id="3932898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932901">keyInstr</span>&nbsp;<span class="op" id="3932910">:=</span>&nbsp;<span class="op" id="3932913">&amp;</span><span class="ident" id="3932914">decInstr</span><span class="op" id="3932922">{</span><span class="ident" id="3932923">keyOp</span><span class="op" id="3932928">,</span>&nbsp;<span class="num" id="3932930">0</span><span class="op" id="3932931">,</span>&nbsp;<span class="ident" id="3932933">nil</span><span class="op" id="3932936">,</span>&nbsp;<span class="ident" id="3932938">errors</span><span class="op" id="3932944">.</span><span class="ident" id="3932945">New</span><span class="op" id="3932948">(</span><span class="string" id="3932949">&#34;no&nbsp;error&#34;</span><span class="op" id="3932959">)</span><span class="op" id="3932960">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932963">elemInstr</span>&nbsp;<span class="op" id="3932973">:=</span>&nbsp;<span class="op" id="3932976">&amp;</span><span class="ident" id="3932977">decInstr</span><span class="op" id="3932985">{</span><span class="ident" id="3932986">elemOp</span><span class="op" id="3932992">,</span>&nbsp;<span class="num" id="3932994">0</span><span class="op" id="3932995">,</span>&nbsp;<span class="ident" id="3932997">nil</span><span class="op" id="3933000">,</span>&nbsp;<span class="ident" id="3933002">errors</span><span class="op" id="3933008">.</span><span class="ident" id="3933009">New</span><span class="op" id="3933012">(</span><span class="string" id="3933013">&#34;no&nbsp;error&#34;</span><span class="op" id="3933023">)</span><span class="op" id="3933024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933027">for</span>&nbsp;<span class="ident" id="3933031">i</span>&nbsp;<span class="op" id="3933033">:=</span>&nbsp;<span class="num" id="3933036">0</span><span class="op" id="3933037">;</span>&nbsp;<span class="ident" id="3933039">i</span>&nbsp;<span class="op" id="3933041">&lt;</span>&nbsp;<span class="ident" id="3933043">n</span><span class="op" id="3933044">;</span>&nbsp;<span class="ident" id="3933046">i</span><span class="op" id="3933047">++</span>&nbsp;<span class="op" id="3933050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933054">keyOp</span><span class="op" id="3933059">(</span><span class="ident" id="3933060">keyInstr</span><span class="op" id="3933068">,</span>&nbsp;<span class="ident" id="3933070">state</span><span class="op" id="3933075">,</span>&nbsp;<span class="ident" id="3933077">noValue</span><span class="op" id="3933084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933088">elemOp</span><span class="op" id="3933094">(</span><span class="ident" id="3933095">elemInstr</span><span class="op" id="3933104">,</span>&nbsp;<span class="ident" id="3933106">state</span><span class="op" id="3933111">,</span>&nbsp;<span class="ident" id="3933113">noValue</span><span class="op" id="3933120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933123">}</span><br>
<span class="lineno">595</span><span class="op" id="3933125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3933128">//&nbsp;decodeSlice&nbsp;decodes&nbsp;a&nbsp;slice&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3933183">//&nbsp;Slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;length&nbsp;followed&nbsp;by&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="3933253">func</span>&nbsp;<span class="op" id="3933258">(</span><span class="ident" id="3933259">dec</span>&nbsp;<span class="op" id="3933263">*</span><span class="ident" id="3933264">Decoder</span><span class="op" id="3933271">)</span>&nbsp;<span class="ident" id="3933273">decodeSlice</span><span class="op" id="3933284">(</span><span class="ident" id="3933285">state</span>&nbsp;<span class="op" id="3933291">*</span><span class="ident" id="3933292">decoderState</span><span class="op" id="3933304">,</span>&nbsp;<span class="ident" id="3933306">value</span>&nbsp;<span class="ident" id="3933312">reflect</span><span class="op" id="3933319">.</span><span class="ident" id="3933320">Value</span><span class="op" id="3933325">,</span>&nbsp;<span class="ident" id="3933327">elemOp</span>&nbsp;<span class="ident" id="3933334">decOp</span><span class="op" id="3933339">,</span>&nbsp;<span class="ident" id="3933341">ovfl</span>&nbsp;<span class="builtintype" id="3933346">error</span><span class="op" id="3933351">,</span>&nbsp;<span class="ident" id="3933353">helper</span>&nbsp;<span class="ident" id="3933360">decHelper</span><span class="op" id="3933369">)</span>&nbsp;<span class="op" id="3933371">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933374">u</span>&nbsp;<span class="op" id="3933376">:=</span>&nbsp;<span class="ident" id="3933379">state</span><span class="op" id="3933384">.</span><span class="ident" id="3933385">decodeUint</span><span class="op" id="3933395">(</span><span class="op" id="3933396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933399">typ</span>&nbsp;<span class="op" id="3933403">:=</span>&nbsp;<span class="ident" id="3933406">value</span><span class="op" id="3933411">.</span><span class="ident" id="3933412">Type</span><span class="op" id="3933416">(</span><span class="op" id="3933417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933420">size</span>&nbsp;<span class="op" id="3933425">:=</span>&nbsp;<span class="ident" id="3933428">uint64</span><span class="op" id="3933434">(</span><span class="ident" id="3933435">typ</span><span class="op" id="3933438">.</span><span class="ident" id="3933439">Elem</span><span class="op" id="3933443">(</span><span class="op" id="3933444">)</span><span class="op" id="3933445">.</span><span class="ident" id="3933446">Size</span><span class="op" id="3933450">(</span><span class="op" id="3933451">)</span><span class="op" id="3933452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933455">nBytes</span>&nbsp;<span class="op" id="3933462">:=</span>&nbsp;<span class="ident" id="3933465">u</span>&nbsp;<span class="op" id="3933467">*</span>&nbsp;<span class="ident" id="3933469">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933475">n</span>&nbsp;<span class="op" id="3933477">:=</span>&nbsp;<span class="builtintype" id="3933480">int</span><span class="op" id="3933483">(</span><span class="ident" id="3933484">u</span><span class="op" id="3933485">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3933488">//&nbsp;Take&nbsp;care&nbsp;with&nbsp;overflow&nbsp;in&nbsp;this&nbsp;calculation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933537">if</span>&nbsp;<span class="ident" id="3933540">n</span>&nbsp;<span class="op" id="3933542">&lt;</span>&nbsp;<span class="num" id="3933544">0</span>&nbsp;<span class="op" id="3933546">||</span>&nbsp;<span class="ident" id="3933549">uint64</span><span class="op" id="3933555">(</span><span class="ident" id="3933556">n</span><span class="op" id="3933557">)</span>&nbsp;<span class="op" id="3933559">!=</span>&nbsp;<span class="ident" id="3933562">u</span>&nbsp;<span class="op" id="3933564">||</span>&nbsp;<span class="ident" id="3933567">nBytes</span>&nbsp;<span class="op" id="3933574">&gt;</span>&nbsp;<span class="ident" id="3933576">tooBig</span>&nbsp;<span class="op" id="3933583">||</span>&nbsp;<span class="op" id="3933586">(</span><span class="ident" id="3933587">size</span>&nbsp;<span class="op" id="3933592">&gt;</span>&nbsp;<span class="num" id="3933594">0</span>&nbsp;<span class="op" id="3933596">&amp;&amp;</span>&nbsp;<span class="ident" id="3933599">nBytes</span><span class="op" id="3933605">/</span><span class="ident" id="3933606">size</span>&nbsp;<span class="op" id="3933611">!=</span>&nbsp;<span class="ident" id="3933614">u</span><span class="op" id="3933615">)</span>&nbsp;<span class="op" id="3933617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3933621">//&nbsp;We&nbsp;don&#39;t&nbsp;check&nbsp;n&nbsp;against&nbsp;buffer&nbsp;length&nbsp;here&nbsp;because&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3933694">//&nbsp;of&nbsp;interfaces,&nbsp;there&nbsp;will&nbsp;be&nbsp;buffer&nbsp;reloads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933744">errorf</span><span class="op" id="3933750">(</span><span class="string" id="3933751">&#34;%s&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&nbsp;elements&nbsp;of&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="3933794">,</span>&nbsp;<span class="ident" id="3933796">typ</span><span class="op" id="3933799">.</span><span class="ident" id="3933800">Elem</span><span class="op" id="3933804">(</span><span class="op" id="3933805">)</span><span class="op" id="3933806">,</span>&nbsp;<span class="ident" id="3933808">u</span><span class="op" id="3933809">,</span>&nbsp;<span class="ident" id="3933811">size</span><span class="op" id="3933815">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933821">if</span>&nbsp;<span class="ident" id="3933824">value</span><span class="op" id="3933829">.</span><span class="ident" id="3933830">Cap</span><span class="op" id="3933833">(</span><span class="op" id="3933834">)</span>&nbsp;<span class="op" id="3933836">&lt;</span>&nbsp;<span class="ident" id="3933838">n</span>&nbsp;<span class="op" id="3933840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933844">value</span><span class="op" id="3933849">.</span><span class="ident" id="3933850">Set</span><span class="op" id="3933853">(</span><span class="ident" id="3933854">reflect</span><span class="op" id="3933861">.</span><span class="ident" id="3933862">MakeSlice</span><span class="op" id="3933871">(</span><span class="ident" id="3933872">typ</span><span class="op" id="3933875">,</span>&nbsp;<span class="ident" id="3933877">n</span><span class="op" id="3933878">,</span>&nbsp;<span class="ident" id="3933880">n</span><span class="op" id="3933881">)</span><span class="op" id="3933882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933885">}</span>&nbsp;<span class="keyword" id="3933887">else</span>&nbsp;<span class="op" id="3933892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933896">value</span><span class="op" id="3933901">.</span><span class="ident" id="3933902">Set</span><span class="op" id="3933905">(</span><span class="ident" id="3933906">value</span><span class="op" id="3933911">.</span><span class="ident" id="3933912">Slice</span><span class="op" id="3933917">(</span><span class="num" id="3933918">0</span><span class="op" id="3933919">,</span>&nbsp;<span class="ident" id="3933921">n</span><span class="op" id="3933922">)</span><span class="op" id="3933923">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933929">dec</span><span class="op" id="3933932">.</span><span class="ident" id="3933933">decodeArrayHelper</span><span class="op" id="3933950">(</span><span class="ident" id="3933951">state</span><span class="op" id="3933956">,</span>&nbsp;<span class="ident" id="3933958">value</span><span class="op" id="3933963">,</span>&nbsp;<span class="ident" id="3933965">elemOp</span><span class="op" id="3933971">,</span>&nbsp;<span class="ident" id="3933973">n</span><span class="op" id="3933974">,</span>&nbsp;<span class="ident" id="3933976">ovfl</span><span class="op" id="3933980">,</span>&nbsp;<span class="ident" id="3933982">helper</span><span class="op" id="3933988">)</span><br>
<span class="lineno"></span><span class="op" id="3933990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3933993">//&nbsp;ignoreSlice&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">620</span><span class="keyword" id="3934067">func</span>&nbsp;<span class="op" id="3934072">(</span><span class="ident" id="3934073">dec</span>&nbsp;<span class="op" id="3934077">*</span><span class="ident" id="3934078">Decoder</span><span class="op" id="3934085">)</span>&nbsp;<span class="ident" id="3934087">ignoreSlice</span><span class="op" id="3934098">(</span><span class="ident" id="3934099">state</span>&nbsp;<span class="op" id="3934105">*</span><span class="ident" id="3934106">decoderState</span><span class="op" id="3934118">,</span>&nbsp;<span class="ident" id="3934120">elemOp</span>&nbsp;<span class="ident" id="3934127">decOp</span><span class="op" id="3934132">)</span>&nbsp;<span class="op" id="3934134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934137">dec</span><span class="op" id="3934140">.</span><span class="ident" id="3934141">ignoreArrayHelper</span><span class="op" id="3934158">(</span><span class="ident" id="3934159">state</span><span class="op" id="3934164">,</span>&nbsp;<span class="ident" id="3934166">elemOp</span><span class="op" id="3934172">,</span>&nbsp;<span class="builtintype" id="3934174">int</span><span class="op" id="3934177">(</span><span class="ident" id="3934178">state</span><span class="op" id="3934183">.</span><span class="ident" id="3934184">decodeUint</span><span class="op" id="3934194">(</span><span class="op" id="3934195">)</span><span class="op" id="3934196">)</span><span class="op" id="3934197">)</span><br>
<span class="lineno"></span><span class="op" id="3934199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3934202">//&nbsp;decodeInterface&nbsp;decodes&nbsp;an&nbsp;interface&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">625</span><span class="comment" id="3934272">//&nbsp;Interfaces&nbsp;are&nbsp;encoded&nbsp;as&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;concrete&nbsp;type&nbsp;followed&nbsp;by&nbsp;a&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3934350">//&nbsp;If&nbsp;the&nbsp;name&nbsp;is&nbsp;empty,&nbsp;the&nbsp;value&nbsp;is&nbsp;nil&nbsp;and&nbsp;no&nbsp;value&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="3934414">func</span>&nbsp;<span class="op" id="3934419">(</span><span class="ident" id="3934420">dec</span>&nbsp;<span class="op" id="3934424">*</span><span class="ident" id="3934425">Decoder</span><span class="op" id="3934432">)</span>&nbsp;<span class="ident" id="3934434">decodeInterface</span><span class="op" id="3934449">(</span><span class="ident" id="3934450">ityp</span>&nbsp;<span class="ident" id="3934455">reflect</span><span class="op" id="3934462">.</span><span class="ident" id="3934463">Type</span><span class="op" id="3934467">,</span>&nbsp;<span class="ident" id="3934469">state</span>&nbsp;<span class="op" id="3934475">*</span><span class="ident" id="3934476">decoderState</span><span class="op" id="3934488">,</span>&nbsp;<span class="ident" id="3934490">value</span>&nbsp;<span class="ident" id="3934496">reflect</span><span class="op" id="3934503">.</span><span class="ident" id="3934504">Value</span><span class="op" id="3934509">)</span>&nbsp;<span class="op" id="3934511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3934514">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934554">nr</span>&nbsp;<span class="op" id="3934557">:=</span>&nbsp;<span class="ident" id="3934560">state</span><span class="op" id="3934565">.</span><span class="ident" id="3934566">decodeUint</span><span class="op" id="3934576">(</span><span class="op" id="3934577">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934580">if</span>&nbsp;<span class="ident" id="3934583">nr</span>&nbsp;<span class="op" id="3934586">&lt;</span>&nbsp;<span class="num" id="3934588">0</span>&nbsp;<span class="op" id="3934590">||</span>&nbsp;<span class="ident" id="3934593">nr</span>&nbsp;<span class="op" id="3934596">&gt;</span>&nbsp;<span class="num" id="3934598">1</span><span class="op" id="3934599">&lt;&lt;</span><span class="num" id="3934601">31</span>&nbsp;<span class="op" id="3934604">{</span>&nbsp;<span class="comment" id="3934606">//&nbsp;zero&nbsp;is&nbsp;permissible&nbsp;for&nbsp;anonymous&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934651">errorf</span><span class="op" id="3934657">(</span><span class="string" id="3934658">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d&#34;</span><span class="op" id="3934687">,</span>&nbsp;<span class="ident" id="3934689">nr</span><span class="op" id="3934691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3934694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934697">if</span>&nbsp;<span class="ident" id="3934700">nr</span>&nbsp;<span class="op" id="3934703">&gt;</span>&nbsp;<span class="ident" id="3934705">uint64</span><span class="op" id="3934711">(</span><span class="ident" id="3934712">state</span><span class="op" id="3934717">.</span><span class="ident" id="3934718">b</span><span class="op" id="3934719">.</span><span class="ident" id="3934720">Len</span><span class="op" id="3934723">(</span><span class="op" id="3934724">)</span><span class="op" id="3934725">)</span>&nbsp;<span class="op" id="3934727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934731">errorf</span><span class="op" id="3934737">(</span><span class="string" id="3934738">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d:&nbsp;exceeds&nbsp;input&nbsp;size&#34;</span><span class="op" id="3934787">,</span>&nbsp;<span class="ident" id="3934789">nr</span><span class="op" id="3934791">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3934794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934797">b</span>&nbsp;<span class="op" id="3934799">:=</span>&nbsp;<span class="builtinfunc" id="3934802">make</span><span class="op" id="3934806">(</span><span class="op" id="3934807">[</span><span class="op" id="3934808">]</span><span class="builtintype" id="3934809">byte</span><span class="op" id="3934813">,</span>&nbsp;<span class="ident" id="3934815">nr</span><span class="op" id="3934817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934820">state</span><span class="op" id="3934825">.</span><span class="ident" id="3934826">b</span><span class="op" id="3934827">.</span><span class="ident" id="3934828">Read</span><span class="op" id="3934832">(</span><span class="ident" id="3934833">b</span><span class="op" id="3934834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934837">name</span>&nbsp;<span class="op" id="3934842">:=</span>&nbsp;<span class="builtintype" id="3934845">string</span><span class="op" id="3934851">(</span><span class="ident" id="3934852">b</span><span class="op" id="3934853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3934856">//&nbsp;Allocate&nbsp;the&nbsp;destination&nbsp;interface&nbsp;value.</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934902">if</span>&nbsp;<span class="ident" id="3934905">name</span>&nbsp;<span class="op" id="3934910">==</span>&nbsp;<span class="string" id="3934913">&#34;&#34;</span>&nbsp;<span class="op" id="3934916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3934920">//&nbsp;Copy&nbsp;the&nbsp;nil&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934969">value</span><span class="op" id="3934974">.</span><span class="ident" id="3934975">Set</span><span class="op" id="3934978">(</span><span class="ident" id="3934979">reflect</span><span class="op" id="3934986">.</span><span class="ident" id="3934987">Zero</span><span class="op" id="3934991">(</span><span class="ident" id="3934992">value</span><span class="op" id="3934997">.</span><span class="ident" id="3934998">Type</span><span class="op" id="3935002">(</span><span class="op" id="3935003">)</span><span class="op" id="3935004">)</span><span class="op" id="3935005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935009">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3935017">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935020">if</span>&nbsp;<span class="builtinfunc" id="3935023">len</span><span class="op" id="3935026">(</span><span class="ident" id="3935027">name</span><span class="op" id="3935031">)</span>&nbsp;<span class="op" id="3935033">&gt;</span>&nbsp;<span class="num" id="3935035">1024</span>&nbsp;<span class="op" id="3935040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935044">errorf</span><span class="op" id="3935050">(</span><span class="string" id="3935051">&#34;name&nbsp;too&nbsp;long&nbsp;(%d&nbsp;bytes):&nbsp;%.20q...&#34;</span><span class="op" id="3935087">,</span>&nbsp;<span class="builtinfunc" id="3935089">len</span><span class="op" id="3935092">(</span><span class="ident" id="3935093">name</span><span class="op" id="3935097">)</span><span class="op" id="3935098">,</span>&nbsp;<span class="ident" id="3935100">name</span><span class="op" id="3935104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3935107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3935110">//&nbsp;The&nbsp;concrete&nbsp;type&nbsp;must&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935152">registerLock</span><span class="op" id="3935164">.</span><span class="ident" id="3935165">RLock</span><span class="op" id="3935170">(</span><span class="op" id="3935171">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935174">typ</span><span class="op" id="3935177">,</span>&nbsp;<span class="ident" id="3935179">ok</span>&nbsp;<span class="op" id="3935182">:=</span>&nbsp;<span class="ident" id="3935185">nameToConcreteType</span><span class="op" id="3935203">[</span><span class="ident" id="3935204">name</span><span class="op" id="3935208">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935211">registerLock</span><span class="op" id="3935223">.</span><span class="ident" id="3935224">RUnlock</span><span class="op" id="3935231">(</span><span class="op" id="3935232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935235">if</span>&nbsp;<span class="op" id="3935238">!</span><span class="ident" id="3935239">ok</span>&nbsp;<span class="op" id="3935242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935246">errorf</span><span class="op" id="3935252">(</span><span class="string" id="3935253">&#34;name&nbsp;not&nbsp;registered&nbsp;for&nbsp;interface:&nbsp;%q&#34;</span><span class="op" id="3935292">,</span>&nbsp;<span class="ident" id="3935294">name</span><span class="op" id="3935298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3935301">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3935304">//&nbsp;Read&nbsp;the&nbsp;type&nbsp;id&nbsp;of&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935348">concreteId</span>&nbsp;<span class="op" id="3935359">:=</span>&nbsp;<span class="ident" id="3935362">dec</span><span class="op" id="3935365">.</span><span class="ident" id="3935366">decodeTypeSequence</span><span class="op" id="3935384">(</span><span class="builtintype" id="3935385">true</span><span class="op" id="3935389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935392">if</span>&nbsp;<span class="ident" id="3935395">concreteId</span>&nbsp;<span class="op" id="3935406">&lt;</span>&nbsp;<span class="num" id="3935408">0</span>&nbsp;<span class="op" id="3935410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935414">error_</span><span class="op" id="3935420">(</span><span class="ident" id="3935421">dec</span><span class="op" id="3935424">.</span><span class="ident" id="3935425">err</span><span class="op" id="3935428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3935431">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3935434">//&nbsp;Byte&nbsp;count&nbsp;of&nbsp;value&nbsp;is&nbsp;next;&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;what&nbsp;it&nbsp;is&nbsp;(it&#39;s&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3935504">//&nbsp;in&nbsp;case&nbsp;we&nbsp;want&nbsp;to&nbsp;ignore&nbsp;the&nbsp;value&nbsp;by&nbsp;skipping&nbsp;it&nbsp;completely).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935572">state</span><span class="op" id="3935577">.</span><span class="ident" id="3935578">decodeUint</span><span class="op" id="3935588">(</span><span class="op" id="3935589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3935592">//&nbsp;Read&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935621">v</span>&nbsp;<span class="op" id="3935623">:=</span>&nbsp;<span class="ident" id="3935626">allocValue</span><span class="op" id="3935636">(</span><span class="ident" id="3935637">typ</span><span class="op" id="3935640">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935643">dec</span><span class="op" id="3935646">.</span><span class="ident" id="3935647">decodeValue</span><span class="op" id="3935658">(</span><span class="ident" id="3935659">concreteId</span><span class="op" id="3935669">,</span>&nbsp;<span class="ident" id="3935671">v</span><span class="op" id="3935672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935675">if</span>&nbsp;<span class="ident" id="3935678">dec</span><span class="op" id="3935681">.</span><span class="ident" id="3935682">err</span>&nbsp;<span class="op" id="3935686">!=</span>&nbsp;<span class="ident" id="3935689">nil</span>&nbsp;<span class="op" id="3935693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935697">error_</span><span class="op" id="3935703">(</span><span class="ident" id="3935704">dec</span><span class="op" id="3935707">.</span><span class="ident" id="3935708">err</span><span class="op" id="3935711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3935714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3935717">//&nbsp;Assign&nbsp;the&nbsp;concrete&nbsp;value&nbsp;to&nbsp;the&nbsp;interface.</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3935765">//&nbsp;Tread&nbsp;carefully;&nbsp;it&nbsp;might&nbsp;not&nbsp;satisfy&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935822">if</span>&nbsp;<span class="op" id="3935825">!</span><span class="ident" id="3935826">typ</span><span class="op" id="3935829">.</span><span class="ident" id="3935830">AssignableTo</span><span class="op" id="3935842">(</span><span class="ident" id="3935843">ityp</span><span class="op" id="3935847">)</span>&nbsp;<span class="op" id="3935849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935853">errorf</span><span class="op" id="3935859">(</span><span class="string" id="3935860">&#34;%s&nbsp;is&nbsp;not&nbsp;assignable&nbsp;to&nbsp;type&nbsp;%s&#34;</span><span class="op" id="3935893">,</span>&nbsp;<span class="ident" id="3935895">typ</span><span class="op" id="3935898">,</span>&nbsp;<span class="ident" id="3935900">ityp</span><span class="op" id="3935904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3935907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3935910">//&nbsp;Copy&nbsp;the&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935954">value</span><span class="op" id="3935959">.</span><span class="ident" id="3935960">Set</span><span class="op" id="3935963">(</span><span class="ident" id="3935964">v</span><span class="op" id="3935965">)</span><br>
<span class="lineno"></span><span class="op" id="3935967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3935970">//&nbsp;ignoreInterface&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;interface&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3936051">func</span>&nbsp;<span class="op" id="3936056">(</span><span class="ident" id="3936057">dec</span>&nbsp;<span class="op" id="3936061">*</span><span class="ident" id="3936062">Decoder</span><span class="op" id="3936069">)</span>&nbsp;<span class="ident" id="3936071">ignoreInterface</span><span class="op" id="3936086">(</span><span class="ident" id="3936087">state</span>&nbsp;<span class="op" id="3936093">*</span><span class="ident" id="3936094">decoderState</span><span class="op" id="3936106">)</span>&nbsp;<span class="op" id="3936108">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3936111">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936151">b</span>&nbsp;<span class="op" id="3936153">:=</span>&nbsp;<span class="builtinfunc" id="3936156">make</span><span class="op" id="3936160">(</span><span class="op" id="3936161">[</span><span class="op" id="3936162">]</span><span class="builtintype" id="3936163">byte</span><span class="op" id="3936167">,</span>&nbsp;<span class="ident" id="3936169">state</span><span class="op" id="3936174">.</span><span class="ident" id="3936175">decodeUint</span><span class="op" id="3936185">(</span><span class="op" id="3936186">)</span><span class="op" id="3936187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936190">_</span><span class="op" id="3936191">,</span>&nbsp;<span class="ident" id="3936193">err</span>&nbsp;<span class="op" id="3936197">:=</span>&nbsp;<span class="ident" id="3936200">state</span><span class="op" id="3936205">.</span><span class="ident" id="3936206">b</span><span class="op" id="3936207">.</span><span class="ident" id="3936208">Read</span><span class="op" id="3936212">(</span><span class="ident" id="3936213">b</span><span class="op" id="3936214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3936217">if</span>&nbsp;<span class="ident" id="3936220">err</span>&nbsp;<span class="op" id="3936224">!=</span>&nbsp;<span class="ident" id="3936227">nil</span>&nbsp;<span class="op" id="3936231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936235">error_</span><span class="op" id="3936241">(</span><span class="ident" id="3936242">err</span><span class="op" id="3936245">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3936248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936251">id</span>&nbsp;<span class="op" id="3936254">:=</span>&nbsp;<span class="ident" id="3936257">dec</span><span class="op" id="3936260">.</span><span class="ident" id="3936261">decodeTypeSequence</span><span class="op" id="3936279">(</span><span class="builtintype" id="3936280">true</span><span class="op" id="3936284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3936287">if</span>&nbsp;<span class="ident" id="3936290">id</span>&nbsp;<span class="op" id="3936293">&lt;</span>&nbsp;<span class="num" id="3936295">0</span>&nbsp;<span class="op" id="3936297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936301">error_</span><span class="op" id="3936307">(</span><span class="ident" id="3936308">dec</span><span class="op" id="3936311">.</span><span class="ident" id="3936312">err</span><span class="op" id="3936315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3936318">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3936321">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;the&nbsp;decoder&nbsp;buffer&nbsp;contains&nbsp;a&nbsp;delimited&nbsp;value.&nbsp;Just&nbsp;toss&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936401">state</span><span class="op" id="3936406">.</span><span class="ident" id="3936407">b</span><span class="op" id="3936408">.</span><span class="ident" id="3936409">Drop</span><span class="op" id="3936413">(</span><span class="builtintype" id="3936414">int</span><span class="op" id="3936417">(</span><span class="ident" id="3936418">state</span><span class="op" id="3936423">.</span><span class="ident" id="3936424">decodeUint</span><span class="op" id="3936434">(</span><span class="op" id="3936435">)</span><span class="op" id="3936436">)</span><span class="op" id="3936437">)</span><br>
<span class="lineno"></span><span class="op" id="3936439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3936442">//&nbsp;decodeGobDecoder&nbsp;decodes&nbsp;something&nbsp;implementing&nbsp;the&nbsp;GobDecoder&nbsp;interface.</span><br>
<span class="lineno">695</span><span class="comment" id="3936519">//&nbsp;The&nbsp;data&nbsp;is&nbsp;encoded&nbsp;as&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="3936559">func</span>&nbsp;<span class="op" id="3936564">(</span><span class="ident" id="3936565">dec</span>&nbsp;<span class="op" id="3936569">*</span><span class="ident" id="3936570">Decoder</span><span class="op" id="3936577">)</span>&nbsp;<span class="ident" id="3936579">decodeGobDecoder</span><span class="op" id="3936595">(</span><span class="ident" id="3936596">ut</span>&nbsp;<span class="op" id="3936599">*</span><span class="ident" id="3936600">userTypeInfo</span><span class="op" id="3936612">,</span>&nbsp;<span class="ident" id="3936614">state</span>&nbsp;<span class="op" id="3936620">*</span><span class="ident" id="3936621">decoderState</span><span class="op" id="3936633">,</span>&nbsp;<span class="ident" id="3936635">value</span>&nbsp;<span class="ident" id="3936641">reflect</span><span class="op" id="3936648">.</span><span class="ident" id="3936649">Value</span><span class="op" id="3936654">)</span>&nbsp;<span class="op" id="3936656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3936659">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936693">b</span>&nbsp;<span class="op" id="3936695">:=</span>&nbsp;<span class="builtinfunc" id="3936698">make</span><span class="op" id="3936702">(</span><span class="op" id="3936703">[</span><span class="op" id="3936704">]</span><span class="builtintype" id="3936705">byte</span><span class="op" id="3936709">,</span>&nbsp;<span class="ident" id="3936711">state</span><span class="op" id="3936716">.</span><span class="ident" id="3936717">decodeUint</span><span class="op" id="3936727">(</span><span class="op" id="3936728">)</span><span class="op" id="3936729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936732">_</span><span class="op" id="3936733">,</span>&nbsp;<span class="ident" id="3936735">err</span>&nbsp;<span class="op" id="3936739">:=</span>&nbsp;<span class="ident" id="3936742">state</span><span class="op" id="3936747">.</span><span class="ident" id="3936748">b</span><span class="op" id="3936749">.</span><span class="ident" id="3936750">Read</span><span class="op" id="3936754">(</span><span class="ident" id="3936755">b</span><span class="op" id="3936756">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3936759">if</span>&nbsp;<span class="ident" id="3936762">err</span>&nbsp;<span class="op" id="3936766">!=</span>&nbsp;<span class="ident" id="3936769">nil</span>&nbsp;<span class="op" id="3936773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936777">error_</span><span class="op" id="3936783">(</span><span class="ident" id="3936784">err</span><span class="op" id="3936787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3936790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3936793">//&nbsp;We&nbsp;know&nbsp;it&#39;s&nbsp;one&nbsp;of&nbsp;these.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3936824">switch</span>&nbsp;<span class="ident" id="3936831">ut</span><span class="op" id="3936833">.</span><span class="ident" id="3936834">externalDec</span>&nbsp;<span class="op" id="3936846">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3936849">case</span>&nbsp;<span class="ident" id="3936854">xGob</span><span class="op" id="3936858">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936862">err</span>&nbsp;<span class="op" id="3936866">=</span>&nbsp;<span class="ident" id="3936868">value</span><span class="op" id="3936873">.</span><span class="ident" id="3936874">Interface</span><span class="op" id="3936883">(</span><span class="op" id="3936884">)</span><span class="op" id="3936885">.</span><span class="op" id="3936886">(</span><span class="ident" id="3936887">GobDecoder</span><span class="op" id="3936897">)</span><span class="op" id="3936898">.</span><span class="ident" id="3936899">GobDecode</span><span class="op" id="3936908">(</span><span class="ident" id="3936909">b</span><span class="op" id="3936910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3936913">case</span>&nbsp;<span class="ident" id="3936918">xBinary</span><span class="op" id="3936925">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936929">err</span>&nbsp;<span class="op" id="3936933">=</span>&nbsp;<span class="ident" id="3936935">value</span><span class="op" id="3936940">.</span><span class="ident" id="3936941">Interface</span><span class="op" id="3936950">(</span><span class="op" id="3936951">)</span><span class="op" id="3936952">.</span><span class="op" id="3936953">(</span><span class="ident" id="3936954">encoding</span><span class="op" id="3936962">.</span><span class="ident" id="3936963">BinaryUnmarshaler</span><span class="op" id="3936980">)</span><span class="op" id="3936981">.</span><span class="ident" id="3936982">UnmarshalBinary</span><span class="op" id="3936997">(</span><span class="ident" id="3936998">b</span><span class="op" id="3936999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937002">case</span>&nbsp;<span class="ident" id="3937007">xText</span><span class="op" id="3937012">:</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937016">err</span>&nbsp;<span class="op" id="3937020">=</span>&nbsp;<span class="ident" id="3937022">value</span><span class="op" id="3937027">.</span><span class="ident" id="3937028">Interface</span><span class="op" id="3937037">(</span><span class="op" id="3937038">)</span><span class="op" id="3937039">.</span><span class="op" id="3937040">(</span><span class="ident" id="3937041">encoding</span><span class="op" id="3937049">.</span><span class="ident" id="3937050">TextUnmarshaler</span><span class="op" id="3937065">)</span><span class="op" id="3937066">.</span><span class="ident" id="3937067">UnmarshalText</span><span class="op" id="3937080">(</span><span class="ident" id="3937081">b</span><span class="op" id="3937082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3937085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937088">if</span>&nbsp;<span class="ident" id="3937091">err</span>&nbsp;<span class="op" id="3937095">!=</span>&nbsp;<span class="ident" id="3937098">nil</span>&nbsp;<span class="op" id="3937102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937106">error_</span><span class="op" id="3937112">(</span><span class="ident" id="3937113">err</span><span class="op" id="3937116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3937119">}</span><br>
<span class="lineno">715</span><span class="op" id="3937121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3937124">//&nbsp;ignoreGobDecoder&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;GobDecoder&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3937206">func</span>&nbsp;<span class="op" id="3937211">(</span><span class="ident" id="3937212">dec</span>&nbsp;<span class="op" id="3937216">*</span><span class="ident" id="3937217">Decoder</span><span class="op" id="3937224">)</span>&nbsp;<span class="ident" id="3937226">ignoreGobDecoder</span><span class="op" id="3937242">(</span><span class="ident" id="3937243">state</span>&nbsp;<span class="op" id="3937249">*</span><span class="ident" id="3937250">decoderState</span><span class="op" id="3937262">)</span>&nbsp;<span class="op" id="3937264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3937267">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937301">b</span>&nbsp;<span class="op" id="3937303">:=</span>&nbsp;<span class="builtinfunc" id="3937306">make</span><span class="op" id="3937310">(</span><span class="op" id="3937311">[</span><span class="op" id="3937312">]</span><span class="builtintype" id="3937313">byte</span><span class="op" id="3937317">,</span>&nbsp;<span class="ident" id="3937319">state</span><span class="op" id="3937324">.</span><span class="ident" id="3937325">decodeUint</span><span class="op" id="3937335">(</span><span class="op" id="3937336">)</span><span class="op" id="3937337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937340">_</span><span class="op" id="3937341">,</span>&nbsp;<span class="ident" id="3937343">err</span>&nbsp;<span class="op" id="3937347">:=</span>&nbsp;<span class="ident" id="3937350">state</span><span class="op" id="3937355">.</span><span class="ident" id="3937356">b</span><span class="op" id="3937357">.</span><span class="ident" id="3937358">Read</span><span class="op" id="3937362">(</span><span class="ident" id="3937363">b</span><span class="op" id="3937364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937367">if</span>&nbsp;<span class="ident" id="3937370">err</span>&nbsp;<span class="op" id="3937374">!=</span>&nbsp;<span class="ident" id="3937377">nil</span>&nbsp;<span class="op" id="3937381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937385">error_</span><span class="op" id="3937391">(</span><span class="ident" id="3937392">err</span><span class="op" id="3937395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3937398">}</span><br>
<span class="lineno">725</span><span class="op" id="3937400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3937403">//&nbsp;Index&nbsp;by&nbsp;Go&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3937425">var</span>&nbsp;<span class="ident" id="3937429">decOpTable</span>&nbsp;<span class="op" id="3937440">=</span>&nbsp;<span class="op" id="3937442">[</span><span class="op" id="3937443">...</span><span class="op" id="3937446">]</span><span class="ident" id="3937447">decOp</span><span class="op" id="3937452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937455">reflect</span><span class="op" id="3937462">.</span><span class="ident" id="3937463">Bool</span><span class="op" id="3937467">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3937475">decBool</span><span class="op" id="3937482">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937485">reflect</span><span class="op" id="3937492">.</span><span class="ident" id="3937493">Int8</span><span class="op" id="3937497">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3937505">decInt8</span><span class="op" id="3937512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937515">reflect</span><span class="op" id="3937522">.</span><span class="ident" id="3937523">Int16</span><span class="op" id="3937528">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3937535">decInt16</span><span class="op" id="3937543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937546">reflect</span><span class="op" id="3937553">.</span><span class="ident" id="3937554">Int32</span><span class="op" id="3937559">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3937566">decInt32</span><span class="op" id="3937574">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937577">reflect</span><span class="op" id="3937584">.</span><span class="ident" id="3937585">Int64</span><span class="op" id="3937590">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3937597">decInt64</span><span class="op" id="3937605">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937608">reflect</span><span class="op" id="3937615">.</span><span class="ident" id="3937616">Uint8</span><span class="op" id="3937621">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3937628">decUint8</span><span class="op" id="3937636">,</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937639">reflect</span><span class="op" id="3937646">.</span><span class="ident" id="3937647">Uint16</span><span class="op" id="3937653">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3937659">decUint16</span><span class="op" id="3937668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937671">reflect</span><span class="op" id="3937678">.</span><span class="ident" id="3937679">Uint32</span><span class="op" id="3937685">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3937691">decUint32</span><span class="op" id="3937700">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937703">reflect</span><span class="op" id="3937710">.</span><span class="ident" id="3937711">Uint64</span><span class="op" id="3937717">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3937723">decUint64</span><span class="op" id="3937732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937735">reflect</span><span class="op" id="3937742">.</span><span class="ident" id="3937743">Float32</span><span class="op" id="3937750">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3937755">decFloat32</span><span class="op" id="3937765">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937768">reflect</span><span class="op" id="3937775">.</span><span class="ident" id="3937776">Float64</span><span class="op" id="3937783">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3937788">decFloat64</span><span class="op" id="3937798">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937801">reflect</span><span class="op" id="3937808">.</span><span class="ident" id="3937809">Complex64</span><span class="op" id="3937818">:</span>&nbsp;&nbsp;<span class="ident" id="3937821">decComplex64</span><span class="op" id="3937833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937836">reflect</span><span class="op" id="3937843">.</span><span class="ident" id="3937844">Complex128</span><span class="op" id="3937854">:</span>&nbsp;<span class="ident" id="3937856">decComplex128</span><span class="op" id="3937869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937872">reflect</span><span class="op" id="3937879">.</span><span class="ident" id="3937880">String</span><span class="op" id="3937886">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3937892">decString</span><span class="op" id="3937901">,</span><br>
<span class="lineno"></span><span class="op" id="3937903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">745</span><span class="comment" id="3937906">//&nbsp;Indexed&nbsp;by&nbsp;gob&nbsp;types.&nbsp;&nbsp;tComplex&nbsp;will&nbsp;be&nbsp;added&nbsp;during&nbsp;type.init().</span><br>
<span class="lineno"></span><span class="keyword" id="3937975">var</span>&nbsp;<span class="ident" id="3937979">decIgnoreOpMap</span>&nbsp;<span class="op" id="3937994">=</span>&nbsp;<span class="keyword" id="3937996">map</span><span class="op" id="3937999">[</span><span class="ident" id="3938000">typeId</span><span class="op" id="3938006">]</span><span class="ident" id="3938007">decOp</span><span class="op" id="3938012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938015">tBool</span><span class="op" id="3938020">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3938025">ignoreUint</span><span class="op" id="3938035">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938038">tInt</span><span class="op" id="3938042">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3938048">ignoreUint</span><span class="op" id="3938058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938061">tUint</span><span class="op" id="3938066">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3938071">ignoreUint</span><span class="op" id="3938081">,</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938084">tFloat</span><span class="op" id="3938090">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3938094">ignoreUint</span><span class="op" id="3938104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938107">tBytes</span><span class="op" id="3938113">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3938117">ignoreUint8Array</span><span class="op" id="3938133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938136">tString</span><span class="op" id="3938143">:</span>&nbsp;&nbsp;<span class="ident" id="3938146">ignoreUint8Array</span><span class="op" id="3938162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938165">tComplex</span><span class="op" id="3938173">:</span>&nbsp;<span class="ident" id="3938175">ignoreTwoUints</span><span class="op" id="3938189">,</span><br>
<span class="lineno"></span><span class="op" id="3938191">}</span><br>
<span class="lineno">755</span><br>
<span class="lineno"></span><span class="comment" id="3938194">//&nbsp;decOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;the&nbsp;base&nbsp;type&nbsp;under&nbsp;rt&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3938261">//&nbsp;the&nbsp;indirection&nbsp;count&nbsp;to&nbsp;reach&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3938299">func</span>&nbsp;<span class="op" id="3938304">(</span><span class="ident" id="3938305">dec</span>&nbsp;<span class="op" id="3938309">*</span><span class="ident" id="3938310">Decoder</span><span class="op" id="3938317">)</span>&nbsp;<span class="ident" id="3938319">decOpFor</span><span class="op" id="3938327">(</span><span class="ident" id="3938328">wireId</span>&nbsp;<span class="ident" id="3938335">typeId</span><span class="op" id="3938341">,</span>&nbsp;<span class="ident" id="3938343">rt</span>&nbsp;<span class="ident" id="3938346">reflect</span><span class="op" id="3938353">.</span><span class="ident" id="3938354">Type</span><span class="op" id="3938358">,</span>&nbsp;<span class="ident" id="3938360">name</span>&nbsp;<span class="builtintype" id="3938365">string</span><span class="op" id="3938371">,</span>&nbsp;<span class="ident" id="3938373">inProgress</span>&nbsp;<span class="keyword" id="3938384">map</span><span class="op" id="3938387">[</span><span class="ident" id="3938388">reflect</span><span class="op" id="3938395">.</span><span class="ident" id="3938396">Type</span><span class="op" id="3938400">]</span><span class="op" id="3938401">*</span><span class="ident" id="3938402">decOp</span><span class="op" id="3938407">)</span>&nbsp;<span class="op" id="3938409">*</span><span class="ident" id="3938410">decOp</span>&nbsp;<span class="op" id="3938416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938419">ut</span>&nbsp;<span class="op" id="3938422">:=</span>&nbsp;<span class="ident" id="3938425">userType</span><span class="op" id="3938433">(</span><span class="ident" id="3938434">rt</span><span class="op" id="3938436">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3938439">//&nbsp;If&nbsp;the&nbsp;type&nbsp;implements&nbsp;GobEncoder,&nbsp;we&nbsp;handle&nbsp;it&nbsp;without&nbsp;further&nbsp;processing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938519">if</span>&nbsp;<span class="ident" id="3938522">ut</span><span class="op" id="3938524">.</span><span class="ident" id="3938525">externalDec</span>&nbsp;<span class="op" id="3938537">!=</span>&nbsp;<span class="num" id="3938540">0</span>&nbsp;<span class="op" id="3938542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938546">return</span>&nbsp;<span class="ident" id="3938553">dec</span><span class="op" id="3938556">.</span><span class="ident" id="3938557">gobDecodeOpFor</span><span class="op" id="3938571">(</span><span class="ident" id="3938572">ut</span><span class="op" id="3938574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3938577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3938581">//&nbsp;If&nbsp;this&nbsp;type&nbsp;is&nbsp;already&nbsp;in&nbsp;progress,&nbsp;it&#39;s&nbsp;a&nbsp;recursive&nbsp;type&nbsp;(e.g.&nbsp;map[string]*T).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3938666">//&nbsp;Return&nbsp;the&nbsp;pointer&nbsp;to&nbsp;the&nbsp;op&nbsp;we&#39;re&nbsp;already&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938723">if</span>&nbsp;<span class="ident" id="3938726">opPtr</span>&nbsp;<span class="op" id="3938732">:=</span>&nbsp;<span class="ident" id="3938735">inProgress</span><span class="op" id="3938745">[</span><span class="ident" id="3938746">rt</span><span class="op" id="3938748">]</span><span class="op" id="3938749">;</span>&nbsp;<span class="ident" id="3938751">opPtr</span>&nbsp;<span class="op" id="3938757">!=</span>&nbsp;<span class="ident" id="3938760">nil</span>&nbsp;<span class="op" id="3938764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938768">return</span>&nbsp;<span class="ident" id="3938775">opPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3938782">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938785">typ</span>&nbsp;<span class="op" id="3938789">:=</span>&nbsp;<span class="ident" id="3938792">ut</span><span class="op" id="3938794">.</span><span class="ident" id="3938795">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938801">var</span>&nbsp;<span class="ident" id="3938805">op</span>&nbsp;<span class="ident" id="3938808">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938815">k</span>&nbsp;<span class="op" id="3938817">:=</span>&nbsp;<span class="ident" id="3938820">typ</span><span class="op" id="3938823">.</span><span class="ident" id="3938824">Kind</span><span class="op" id="3938828">(</span><span class="op" id="3938829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938832">if</span>&nbsp;<span class="builtintype" id="3938835">int</span><span class="op" id="3938838">(</span><span class="ident" id="3938839">k</span><span class="op" id="3938840">)</span>&nbsp;<span class="op" id="3938842">&lt;</span>&nbsp;<span class="builtinfunc" id="3938844">len</span><span class="op" id="3938847">(</span><span class="ident" id="3938848">decOpTable</span><span class="op" id="3938858">)</span>&nbsp;<span class="op" id="3938860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938864">op</span>&nbsp;<span class="op" id="3938867">=</span>&nbsp;<span class="ident" id="3938869">decOpTable</span><span class="op" id="3938879">[</span><span class="ident" id="3938880">k</span><span class="op" id="3938881">]</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3938884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938887">if</span>&nbsp;<span class="ident" id="3938890">op</span>&nbsp;<span class="op" id="3938893">==</span>&nbsp;<span class="ident" id="3938896">nil</span>&nbsp;<span class="op" id="3938900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938904">inProgress</span><span class="op" id="3938914">[</span><span class="ident" id="3938915">rt</span><span class="op" id="3938917">]</span>&nbsp;<span class="op" id="3938919">=</span>&nbsp;<span class="op" id="3938921">&amp;</span><span class="ident" id="3938922">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3938927">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938946">switch</span>&nbsp;<span class="ident" id="3938953">t</span>&nbsp;<span class="op" id="3938955">:=</span>&nbsp;<span class="ident" id="3938958">typ</span><span class="op" id="3938961">;</span>&nbsp;<span class="ident" id="3938963">t</span><span class="op" id="3938964">.</span><span class="ident" id="3938965">Kind</span><span class="op" id="3938969">(</span><span class="op" id="3938970">)</span>&nbsp;<span class="op" id="3938972">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938976">case</span>&nbsp;<span class="ident" id="3938981">reflect</span><span class="op" id="3938988">.</span><span class="ident" id="3938989">Array</span><span class="op" id="3938994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938999">name</span>&nbsp;<span class="op" id="3939004">=</span>&nbsp;<span class="string" id="3939006">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="3939020">+</span>&nbsp;<span class="ident" id="3939022">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939030">elemId</span>&nbsp;<span class="op" id="3939037">:=</span>&nbsp;<span class="ident" id="3939040">dec</span><span class="op" id="3939043">.</span><span class="ident" id="3939044">wireType</span><span class="op" id="3939052">[</span><span class="ident" id="3939053">wireId</span><span class="op" id="3939059">]</span><span class="op" id="3939060">.</span><span class="ident" id="3939061">ArrayT</span><span class="op" id="3939067">.</span><span class="ident" id="3939068">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939076">elemOp</span>&nbsp;<span class="op" id="3939083">:=</span>&nbsp;<span class="ident" id="3939086">dec</span><span class="op" id="3939089">.</span><span class="ident" id="3939090">decOpFor</span><span class="op" id="3939098">(</span><span class="ident" id="3939099">elemId</span><span class="op" id="3939105">,</span>&nbsp;<span class="ident" id="3939107">t</span><span class="op" id="3939108">.</span><span class="ident" id="3939109">Elem</span><span class="op" id="3939113">(</span><span class="op" id="3939114">)</span><span class="op" id="3939115">,</span>&nbsp;<span class="ident" id="3939117">name</span><span class="op" id="3939121">,</span>&nbsp;<span class="ident" id="3939123">inProgress</span><span class="op" id="3939133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939138">ovfl</span>&nbsp;<span class="op" id="3939143">:=</span>&nbsp;<span class="ident" id="3939146">overflow</span><span class="op" id="3939154">(</span><span class="ident" id="3939155">name</span><span class="op" id="3939159">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939164">helper</span>&nbsp;<span class="op" id="3939171">:=</span>&nbsp;<span class="ident" id="3939174">decArrayHelper</span><span class="op" id="3939188">[</span><span class="ident" id="3939189">t</span><span class="op" id="3939190">.</span><span class="ident" id="3939191">Elem</span><span class="op" id="3939195">(</span><span class="op" id="3939196">)</span><span class="op" id="3939197">.</span><span class="ident" id="3939198">Kind</span><span class="op" id="3939202">(</span><span class="op" id="3939203">)</span><span class="op" id="3939204">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939209">op</span>&nbsp;<span class="op" id="3939212">=</span>&nbsp;<span class="keyword" id="3939214">func</span><span class="op" id="3939218">(</span><span class="ident" id="3939219">i</span>&nbsp;<span class="op" id="3939221">*</span><span class="ident" id="3939222">decInstr</span><span class="op" id="3939230">,</span>&nbsp;<span class="ident" id="3939232">state</span>&nbsp;<span class="op" id="3939238">*</span><span class="ident" id="3939239">decoderState</span><span class="op" id="3939251">,</span>&nbsp;<span class="ident" id="3939253">value</span>&nbsp;<span class="ident" id="3939259">reflect</span><span class="op" id="3939266">.</span><span class="ident" id="3939267">Value</span><span class="op" id="3939272">)</span>&nbsp;<span class="op" id="3939274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939280">state</span><span class="op" id="3939285">.</span><span class="ident" id="3939286">dec</span><span class="op" id="3939289">.</span><span class="ident" id="3939290">decodeArray</span><span class="op" id="3939301">(</span><span class="ident" id="3939302">t</span><span class="op" id="3939303">,</span>&nbsp;<span class="ident" id="3939305">state</span><span class="op" id="3939310">,</span>&nbsp;<span class="ident" id="3939312">value</span><span class="op" id="3939317">,</span>&nbsp;<span class="op" id="3939319">*</span><span class="ident" id="3939320">elemOp</span><span class="op" id="3939326">,</span>&nbsp;<span class="ident" id="3939328">t</span><span class="op" id="3939329">.</span><span class="ident" id="3939330">Len</span><span class="op" id="3939333">(</span><span class="op" id="3939334">)</span><span class="op" id="3939335">,</span>&nbsp;<span class="ident" id="3939337">ovfl</span><span class="op" id="3939341">,</span>&nbsp;<span class="ident" id="3939343">helper</span><span class="op" id="3939349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939359">case</span>&nbsp;<span class="ident" id="3939364">reflect</span><span class="op" id="3939371">.</span><span class="ident" id="3939372">Map</span><span class="op" id="3939375">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939380">keyId</span>&nbsp;<span class="op" id="3939386">:=</span>&nbsp;<span class="ident" id="3939389">dec</span><span class="op" id="3939392">.</span><span class="ident" id="3939393">wireType</span><span class="op" id="3939401">[</span><span class="ident" id="3939402">wireId</span><span class="op" id="3939408">]</span><span class="op" id="3939409">.</span><span class="ident" id="3939410">MapT</span><span class="op" id="3939414">.</span><span class="ident" id="3939415">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939422">elemId</span>&nbsp;<span class="op" id="3939429">:=</span>&nbsp;<span class="ident" id="3939432">dec</span><span class="op" id="3939435">.</span><span class="ident" id="3939436">wireType</span><span class="op" id="3939444">[</span><span class="ident" id="3939445">wireId</span><span class="op" id="3939451">]</span><span class="op" id="3939452">.</span><span class="ident" id="3939453">MapT</span><span class="op" id="3939457">.</span><span class="ident" id="3939458">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939466">keyOp</span>&nbsp;<span class="op" id="3939472">:=</span>&nbsp;<span class="ident" id="3939475">dec</span><span class="op" id="3939478">.</span><span class="ident" id="3939479">decOpFor</span><span class="op" id="3939487">(</span><span class="ident" id="3939488">keyId</span><span class="op" id="3939493">,</span>&nbsp;<span class="ident" id="3939495">t</span><span class="op" id="3939496">.</span><span class="ident" id="3939497">Key</span><span class="op" id="3939500">(</span><span class="op" id="3939501">)</span><span class="op" id="3939502">,</span>&nbsp;<span class="string" id="3939504">&#34;key&nbsp;of&nbsp;&#34;</span><span class="op" id="3939513">+</span><span class="ident" id="3939514">name</span><span class="op" id="3939518">,</span>&nbsp;<span class="ident" id="3939520">inProgress</span><span class="op" id="3939530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939535">elemOp</span>&nbsp;<span class="op" id="3939542">:=</span>&nbsp;<span class="ident" id="3939545">dec</span><span class="op" id="3939548">.</span><span class="ident" id="3939549">decOpFor</span><span class="op" id="3939557">(</span><span class="ident" id="3939558">elemId</span><span class="op" id="3939564">,</span>&nbsp;<span class="ident" id="3939566">t</span><span class="op" id="3939567">.</span><span class="ident" id="3939568">Elem</span><span class="op" id="3939572">(</span><span class="op" id="3939573">)</span><span class="op" id="3939574">,</span>&nbsp;<span class="string" id="3939576">&#34;element&nbsp;of&nbsp;&#34;</span><span class="op" id="3939589">+</span><span class="ident" id="3939590">name</span><span class="op" id="3939594">,</span>&nbsp;<span class="ident" id="3939596">inProgress</span><span class="op" id="3939606">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939611">ovfl</span>&nbsp;<span class="op" id="3939616">:=</span>&nbsp;<span class="ident" id="3939619">overflow</span><span class="op" id="3939627">(</span><span class="ident" id="3939628">name</span><span class="op" id="3939632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939637">op</span>&nbsp;<span class="op" id="3939640">=</span>&nbsp;<span class="keyword" id="3939642">func</span><span class="op" id="3939646">(</span><span class="ident" id="3939647">i</span>&nbsp;<span class="op" id="3939649">*</span><span class="ident" id="3939650">decInstr</span><span class="op" id="3939658">,</span>&nbsp;<span class="ident" id="3939660">state</span>&nbsp;<span class="op" id="3939666">*</span><span class="ident" id="3939667">decoderState</span><span class="op" id="3939679">,</span>&nbsp;<span class="ident" id="3939681">value</span>&nbsp;<span class="ident" id="3939687">reflect</span><span class="op" id="3939694">.</span><span class="ident" id="3939695">Value</span><span class="op" id="3939700">)</span>&nbsp;<span class="op" id="3939702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939708">state</span><span class="op" id="3939713">.</span><span class="ident" id="3939714">dec</span><span class="op" id="3939717">.</span><span class="ident" id="3939718">decodeMap</span><span class="op" id="3939727">(</span><span class="ident" id="3939728">t</span><span class="op" id="3939729">,</span>&nbsp;<span class="ident" id="3939731">state</span><span class="op" id="3939736">,</span>&nbsp;<span class="ident" id="3939738">value</span><span class="op" id="3939743">,</span>&nbsp;<span class="op" id="3939745">*</span><span class="ident" id="3939746">keyOp</span><span class="op" id="3939751">,</span>&nbsp;<span class="op" id="3939753">*</span><span class="ident" id="3939754">elemOp</span><span class="op" id="3939760">,</span>&nbsp;<span class="ident" id="3939762">ovfl</span><span class="op" id="3939766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939776">case</span>&nbsp;<span class="ident" id="3939781">reflect</span><span class="op" id="3939788">.</span><span class="ident" id="3939789">Slice</span><span class="op" id="3939794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939799">name</span>&nbsp;<span class="op" id="3939804">=</span>&nbsp;<span class="string" id="3939806">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="3939820">+</span>&nbsp;<span class="ident" id="3939822">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939830">if</span>&nbsp;<span class="ident" id="3939833">t</span><span class="op" id="3939834">.</span><span class="ident" id="3939835">Elem</span><span class="op" id="3939839">(</span><span class="op" id="3939840">)</span><span class="op" id="3939841">.</span><span class="ident" id="3939842">Kind</span><span class="op" id="3939846">(</span><span class="op" id="3939847">)</span>&nbsp;<span class="op" id="3939849">==</span>&nbsp;<span class="ident" id="3939852">reflect</span><span class="op" id="3939859">.</span><span class="ident" id="3939860">Uint8</span>&nbsp;<span class="op" id="3939866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939872">op</span>&nbsp;<span class="op" id="3939875">=</span>&nbsp;<span class="ident" id="3939877">decUint8Slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939895">break</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939909">var</span>&nbsp;<span class="ident" id="3939913">elemId</span>&nbsp;<span class="ident" id="3939920">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939930">if</span>&nbsp;<span class="ident" id="3939933">tt</span><span class="op" id="3939935">,</span>&nbsp;<span class="ident" id="3939937">ok</span>&nbsp;<span class="op" id="3939940">:=</span>&nbsp;<span class="ident" id="3939943">builtinIdToType</span><span class="op" id="3939958">[</span><span class="ident" id="3939959">wireId</span><span class="op" id="3939965">]</span><span class="op" id="3939966">;</span>&nbsp;<span class="ident" id="3939968">ok</span>&nbsp;<span class="op" id="3939971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939977">elemId</span>&nbsp;<span class="op" id="3939984">=</span>&nbsp;<span class="ident" id="3939986">tt</span><span class="op" id="3939988">.</span><span class="op" id="3939989">(</span><span class="op" id="3939990">*</span><span class="ident" id="3939991">sliceType</span><span class="op" id="3940000">)</span><span class="op" id="3940001">.</span><span class="ident" id="3940002">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940010">}</span>&nbsp;<span class="keyword" id="3940012">else</span>&nbsp;<span class="op" id="3940017">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940023">elemId</span>&nbsp;<span class="op" id="3940030">=</span>&nbsp;<span class="ident" id="3940032">dec</span><span class="op" id="3940035">.</span><span class="ident" id="3940036">wireType</span><span class="op" id="3940044">[</span><span class="ident" id="3940045">wireId</span><span class="op" id="3940051">]</span><span class="op" id="3940052">.</span><span class="ident" id="3940053">SliceT</span><span class="op" id="3940059">.</span><span class="ident" id="3940060">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940073">elemOp</span>&nbsp;<span class="op" id="3940080">:=</span>&nbsp;<span class="ident" id="3940083">dec</span><span class="op" id="3940086">.</span><span class="ident" id="3940087">decOpFor</span><span class="op" id="3940095">(</span><span class="ident" id="3940096">elemId</span><span class="op" id="3940102">,</span>&nbsp;<span class="ident" id="3940104">t</span><span class="op" id="3940105">.</span><span class="ident" id="3940106">Elem</span><span class="op" id="3940110">(</span><span class="op" id="3940111">)</span><span class="op" id="3940112">,</span>&nbsp;<span class="ident" id="3940114">name</span><span class="op" id="3940118">,</span>&nbsp;<span class="ident" id="3940120">inProgress</span><span class="op" id="3940130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940135">ovfl</span>&nbsp;<span class="op" id="3940140">:=</span>&nbsp;<span class="ident" id="3940143">overflow</span><span class="op" id="3940151">(</span><span class="ident" id="3940152">name</span><span class="op" id="3940156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940161">helper</span>&nbsp;<span class="op" id="3940168">:=</span>&nbsp;<span class="ident" id="3940171">decSliceHelper</span><span class="op" id="3940185">[</span><span class="ident" id="3940186">t</span><span class="op" id="3940187">.</span><span class="ident" id="3940188">Elem</span><span class="op" id="3940192">(</span><span class="op" id="3940193">)</span><span class="op" id="3940194">.</span><span class="ident" id="3940195">Kind</span><span class="op" id="3940199">(</span><span class="op" id="3940200">)</span><span class="op" id="3940201">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940206">op</span>&nbsp;<span class="op" id="3940209">=</span>&nbsp;<span class="keyword" id="3940211">func</span><span class="op" id="3940215">(</span><span class="ident" id="3940216">i</span>&nbsp;<span class="op" id="3940218">*</span><span class="ident" id="3940219">decInstr</span><span class="op" id="3940227">,</span>&nbsp;<span class="ident" id="3940229">state</span>&nbsp;<span class="op" id="3940235">*</span><span class="ident" id="3940236">decoderState</span><span class="op" id="3940248">,</span>&nbsp;<span class="ident" id="3940250">value</span>&nbsp;<span class="ident" id="3940256">reflect</span><span class="op" id="3940263">.</span><span class="ident" id="3940264">Value</span><span class="op" id="3940269">)</span>&nbsp;<span class="op" id="3940271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940277">state</span><span class="op" id="3940282">.</span><span class="ident" id="3940283">dec</span><span class="op" id="3940286">.</span><span class="ident" id="3940287">decodeSlice</span><span class="op" id="3940298">(</span><span class="ident" id="3940299">state</span><span class="op" id="3940304">,</span>&nbsp;<span class="ident" id="3940306">value</span><span class="op" id="3940311">,</span>&nbsp;<span class="op" id="3940313">*</span><span class="ident" id="3940314">elemOp</span><span class="op" id="3940320">,</span>&nbsp;<span class="ident" id="3940322">ovfl</span><span class="op" id="3940326">,</span>&nbsp;<span class="ident" id="3940328">helper</span><span class="op" id="3940334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940344">case</span>&nbsp;<span class="ident" id="3940349">reflect</span><span class="op" id="3940356">.</span><span class="ident" id="3940357">Struct</span><span class="op" id="3940363">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3940368">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940443">ut</span>&nbsp;<span class="op" id="3940446">:=</span>&nbsp;<span class="ident" id="3940449">userType</span><span class="op" id="3940457">(</span><span class="ident" id="3940458">typ</span><span class="op" id="3940461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940466">enginePtr</span><span class="op" id="3940475">,</span>&nbsp;<span class="ident" id="3940477">err</span>&nbsp;<span class="op" id="3940481">:=</span>&nbsp;<span class="ident" id="3940484">dec</span><span class="op" id="3940487">.</span><span class="ident" id="3940488">getDecEnginePtr</span><span class="op" id="3940503">(</span><span class="ident" id="3940504">wireId</span><span class="op" id="3940510">,</span>&nbsp;<span class="ident" id="3940512">ut</span><span class="op" id="3940514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940519">if</span>&nbsp;<span class="ident" id="3940522">err</span>&nbsp;<span class="op" id="3940526">!=</span>&nbsp;<span class="ident" id="3940529">nil</span>&nbsp;<span class="op" id="3940533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940539">error_</span><span class="op" id="3940545">(</span><span class="ident" id="3940546">err</span><span class="op" id="3940549">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940559">op</span>&nbsp;<span class="op" id="3940562">=</span>&nbsp;<span class="keyword" id="3940564">func</span><span class="op" id="3940568">(</span><span class="ident" id="3940569">i</span>&nbsp;<span class="op" id="3940571">*</span><span class="ident" id="3940572">decInstr</span><span class="op" id="3940580">,</span>&nbsp;<span class="ident" id="3940582">state</span>&nbsp;<span class="op" id="3940588">*</span><span class="ident" id="3940589">decoderState</span><span class="op" id="3940601">,</span>&nbsp;<span class="ident" id="3940603">value</span>&nbsp;<span class="ident" id="3940609">reflect</span><span class="op" id="3940616">.</span><span class="ident" id="3940617">Value</span><span class="op" id="3940622">)</span>&nbsp;<span class="op" id="3940624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3940630">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940707">dec</span><span class="op" id="3940710">.</span><span class="ident" id="3940711">decodeStruct</span><span class="op" id="3940723">(</span><span class="op" id="3940724">*</span><span class="ident" id="3940725">enginePtr</span><span class="op" id="3940734">,</span>&nbsp;<span class="ident" id="3940736">ut</span><span class="op" id="3940738">,</span>&nbsp;<span class="ident" id="3940740">value</span><span class="op" id="3940745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940750">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940754">case</span>&nbsp;<span class="ident" id="3940759">reflect</span><span class="op" id="3940766">.</span><span class="ident" id="3940767">Interface</span><span class="op" id="3940776">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940781">op</span>&nbsp;<span class="op" id="3940784">=</span>&nbsp;<span class="keyword" id="3940786">func</span><span class="op" id="3940790">(</span><span class="ident" id="3940791">i</span>&nbsp;<span class="op" id="3940793">*</span><span class="ident" id="3940794">decInstr</span><span class="op" id="3940802">,</span>&nbsp;<span class="ident" id="3940804">state</span>&nbsp;<span class="op" id="3940810">*</span><span class="ident" id="3940811">decoderState</span><span class="op" id="3940823">,</span>&nbsp;<span class="ident" id="3940825">value</span>&nbsp;<span class="ident" id="3940831">reflect</span><span class="op" id="3940838">.</span><span class="ident" id="3940839">Value</span><span class="op" id="3940844">)</span>&nbsp;<span class="op" id="3940846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940852">state</span><span class="op" id="3940857">.</span><span class="ident" id="3940858">dec</span><span class="op" id="3940861">.</span><span class="ident" id="3940862">decodeInterface</span><span class="op" id="3940877">(</span><span class="ident" id="3940878">t</span><span class="op" id="3940879">,</span>&nbsp;<span class="ident" id="3940881">state</span><span class="op" id="3940886">,</span>&nbsp;<span class="ident" id="3940888">value</span><span class="op" id="3940893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940902">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940908">if</span>&nbsp;<span class="ident" id="3940911">op</span>&nbsp;<span class="op" id="3940914">==</span>&nbsp;<span class="ident" id="3940917">nil</span>&nbsp;<span class="op" id="3940921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940925">errorf</span><span class="op" id="3940931">(</span><span class="string" id="3940932">&#34;decode&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="3940961">,</span>&nbsp;<span class="ident" id="3940963">rt</span><span class="op" id="3940965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940971">return</span>&nbsp;<span class="op" id="3940978">&amp;</span><span class="ident" id="3940979">op</span><br>
<span class="lineno">840</span><span class="op" id="3940982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3940985">//&nbsp;decIgnoreOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;a&nbsp;field&nbsp;that&nbsp;has&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3941064">func</span>&nbsp;<span class="op" id="3941069">(</span><span class="ident" id="3941070">dec</span>&nbsp;<span class="op" id="3941074">*</span><span class="ident" id="3941075">Decoder</span><span class="op" id="3941082">)</span>&nbsp;<span class="ident" id="3941084">decIgnoreOpFor</span><span class="op" id="3941098">(</span><span class="ident" id="3941099">wireId</span>&nbsp;<span class="ident" id="3941106">typeId</span><span class="op" id="3941112">)</span>&nbsp;<span class="ident" id="3941114">decOp</span>&nbsp;<span class="op" id="3941120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941123">op</span><span class="op" id="3941125">,</span>&nbsp;<span class="ident" id="3941127">ok</span>&nbsp;<span class="op" id="3941130">:=</span>&nbsp;<span class="ident" id="3941133">decIgnoreOpMap</span><span class="op" id="3941147">[</span><span class="ident" id="3941148">wireId</span><span class="op" id="3941154">]</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941157">if</span>&nbsp;<span class="op" id="3941160">!</span><span class="ident" id="3941161">ok</span>&nbsp;<span class="op" id="3941164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941168">if</span>&nbsp;<span class="ident" id="3941171">wireId</span>&nbsp;<span class="op" id="3941178">==</span>&nbsp;<span class="ident" id="3941181">tInterface</span>&nbsp;<span class="op" id="3941192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941197">//&nbsp;Special&nbsp;case&nbsp;because&nbsp;it&#39;s&nbsp;a&nbsp;method:&nbsp;the&nbsp;ignored&nbsp;item&nbsp;might</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941262">//&nbsp;define&nbsp;types&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;record&nbsp;their&nbsp;state&nbsp;in&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941331">op</span>&nbsp;<span class="op" id="3941334">=</span>&nbsp;<span class="keyword" id="3941336">func</span><span class="op" id="3941340">(</span><span class="ident" id="3941341">i</span>&nbsp;<span class="op" id="3941343">*</span><span class="ident" id="3941344">decInstr</span><span class="op" id="3941352">,</span>&nbsp;<span class="ident" id="3941354">state</span>&nbsp;<span class="op" id="3941360">*</span><span class="ident" id="3941361">decoderState</span><span class="op" id="3941373">,</span>&nbsp;<span class="ident" id="3941375">value</span>&nbsp;<span class="ident" id="3941381">reflect</span><span class="op" id="3941388">.</span><span class="ident" id="3941389">Value</span><span class="op" id="3941394">)</span>&nbsp;<span class="op" id="3941396">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941402">state</span><span class="op" id="3941407">.</span><span class="ident" id="3941408">dec</span><span class="op" id="3941411">.</span><span class="ident" id="3941412">ignoreInterface</span><span class="op" id="3941427">(</span><span class="ident" id="3941428">state</span><span class="op" id="3941433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3941438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941443">return</span>&nbsp;<span class="ident" id="3941450">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3941455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941459">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941478">wire</span>&nbsp;<span class="op" id="3941483">:=</span>&nbsp;<span class="ident" id="3941486">dec</span><span class="op" id="3941489">.</span><span class="ident" id="3941490">wireType</span><span class="op" id="3941498">[</span><span class="ident" id="3941499">wireId</span><span class="op" id="3941505">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941509">switch</span>&nbsp;<span class="op" id="3941516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941520">case</span>&nbsp;<span class="ident" id="3941525">wire</span>&nbsp;<span class="op" id="3941530">==</span>&nbsp;<span class="ident" id="3941533">nil</span><span class="op" id="3941536">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941541">errorf</span><span class="op" id="3941547">(</span><span class="string" id="3941548">&#34;bad&nbsp;data:&nbsp;undefined&nbsp;type&nbsp;%s&#34;</span><span class="op" id="3941577">,</span>&nbsp;<span class="ident" id="3941579">wireId</span><span class="op" id="3941585">.</span><span class="builtintype" id="3941586">string</span><span class="op" id="3941592">(</span><span class="op" id="3941593">)</span><span class="op" id="3941594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941598">case</span>&nbsp;<span class="ident" id="3941603">wire</span><span class="op" id="3941607">.</span><span class="ident" id="3941608">ArrayT</span>&nbsp;<span class="op" id="3941615">!=</span>&nbsp;<span class="ident" id="3941618">nil</span><span class="op" id="3941621">:</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941626">elemId</span>&nbsp;<span class="op" id="3941633">:=</span>&nbsp;<span class="ident" id="3941636">wire</span><span class="op" id="3941640">.</span><span class="ident" id="3941641">ArrayT</span><span class="op" id="3941647">.</span><span class="ident" id="3941648">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941656">elemOp</span>&nbsp;<span class="op" id="3941663">:=</span>&nbsp;<span class="ident" id="3941666">dec</span><span class="op" id="3941669">.</span><span class="ident" id="3941670">decIgnoreOpFor</span><span class="op" id="3941684">(</span><span class="ident" id="3941685">elemId</span><span class="op" id="3941691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941696">op</span>&nbsp;<span class="op" id="3941699">=</span>&nbsp;<span class="keyword" id="3941701">func</span><span class="op" id="3941705">(</span><span class="ident" id="3941706">i</span>&nbsp;<span class="op" id="3941708">*</span><span class="ident" id="3941709">decInstr</span><span class="op" id="3941717">,</span>&nbsp;<span class="ident" id="3941719">state</span>&nbsp;<span class="op" id="3941725">*</span><span class="ident" id="3941726">decoderState</span><span class="op" id="3941738">,</span>&nbsp;<span class="ident" id="3941740">value</span>&nbsp;<span class="ident" id="3941746">reflect</span><span class="op" id="3941753">.</span><span class="ident" id="3941754">Value</span><span class="op" id="3941759">)</span>&nbsp;<span class="op" id="3941761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941767">state</span><span class="op" id="3941772">.</span><span class="ident" id="3941773">dec</span><span class="op" id="3941776">.</span><span class="ident" id="3941777">ignoreArray</span><span class="op" id="3941788">(</span><span class="ident" id="3941789">state</span><span class="op" id="3941794">,</span>&nbsp;<span class="ident" id="3941796">elemOp</span><span class="op" id="3941802">,</span>&nbsp;<span class="ident" id="3941804">wire</span><span class="op" id="3941808">.</span><span class="ident" id="3941809">ArrayT</span><span class="op" id="3941815">.</span><span class="ident" id="3941816">Len</span><span class="op" id="3941819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3941824">}</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941829">case</span>&nbsp;<span class="ident" id="3941834">wire</span><span class="op" id="3941838">.</span><span class="ident" id="3941839">MapT</span>&nbsp;<span class="op" id="3941844">!=</span>&nbsp;<span class="ident" id="3941847">nil</span><span class="op" id="3941850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941855">keyId</span>&nbsp;<span class="op" id="3941861">:=</span>&nbsp;<span class="ident" id="3941864">dec</span><span class="op" id="3941867">.</span><span class="ident" id="3941868">wireType</span><span class="op" id="3941876">[</span><span class="ident" id="3941877">wireId</span><span class="op" id="3941883">]</span><span class="op" id="3941884">.</span><span class="ident" id="3941885">MapT</span><span class="op" id="3941889">.</span><span class="ident" id="3941890">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941897">elemId</span>&nbsp;<span class="op" id="3941904">:=</span>&nbsp;<span class="ident" id="3941907">dec</span><span class="op" id="3941910">.</span><span class="ident" id="3941911">wireType</span><span class="op" id="3941919">[</span><span class="ident" id="3941920">wireId</span><span class="op" id="3941926">]</span><span class="op" id="3941927">.</span><span class="ident" id="3941928">MapT</span><span class="op" id="3941932">.</span><span class="ident" id="3941933">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941941">keyOp</span>&nbsp;<span class="op" id="3941947">:=</span>&nbsp;<span class="ident" id="3941950">dec</span><span class="op" id="3941953">.</span><span class="ident" id="3941954">decIgnoreOpFor</span><span class="op" id="3941968">(</span><span class="ident" id="3941969">keyId</span><span class="op" id="3941974">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941979">elemOp</span>&nbsp;<span class="op" id="3941986">:=</span>&nbsp;<span class="ident" id="3941989">dec</span><span class="op" id="3941992">.</span><span class="ident" id="3941993">decIgnoreOpFor</span><span class="op" id="3942007">(</span><span class="ident" id="3942008">elemId</span><span class="op" id="3942014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942019">op</span>&nbsp;<span class="op" id="3942022">=</span>&nbsp;<span class="keyword" id="3942024">func</span><span class="op" id="3942028">(</span><span class="ident" id="3942029">i</span>&nbsp;<span class="op" id="3942031">*</span><span class="ident" id="3942032">decInstr</span><span class="op" id="3942040">,</span>&nbsp;<span class="ident" id="3942042">state</span>&nbsp;<span class="op" id="3942048">*</span><span class="ident" id="3942049">decoderState</span><span class="op" id="3942061">,</span>&nbsp;<span class="ident" id="3942063">value</span>&nbsp;<span class="ident" id="3942069">reflect</span><span class="op" id="3942076">.</span><span class="ident" id="3942077">Value</span><span class="op" id="3942082">)</span>&nbsp;<span class="op" id="3942084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942090">state</span><span class="op" id="3942095">.</span><span class="ident" id="3942096">dec</span><span class="op" id="3942099">.</span><span class="ident" id="3942100">ignoreMap</span><span class="op" id="3942109">(</span><span class="ident" id="3942110">state</span><span class="op" id="3942115">,</span>&nbsp;<span class="ident" id="3942117">keyOp</span><span class="op" id="3942122">,</span>&nbsp;<span class="ident" id="3942124">elemOp</span><span class="op" id="3942130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3942135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3942140">case</span>&nbsp;<span class="ident" id="3942145">wire</span><span class="op" id="3942149">.</span><span class="ident" id="3942150">SliceT</span>&nbsp;<span class="op" id="3942157">!=</span>&nbsp;<span class="ident" id="3942160">nil</span><span class="op" id="3942163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942168">elemId</span>&nbsp;<span class="op" id="3942175">:=</span>&nbsp;<span class="ident" id="3942178">wire</span><span class="op" id="3942182">.</span><span class="ident" id="3942183">SliceT</span><span class="op" id="3942189">.</span><span class="ident" id="3942190">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942198">elemOp</span>&nbsp;<span class="op" id="3942205">:=</span>&nbsp;<span class="ident" id="3942208">dec</span><span class="op" id="3942211">.</span><span class="ident" id="3942212">decIgnoreOpFor</span><span class="op" id="3942226">(</span><span class="ident" id="3942227">elemId</span><span class="op" id="3942233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942238">op</span>&nbsp;<span class="op" id="3942241">=</span>&nbsp;<span class="keyword" id="3942243">func</span><span class="op" id="3942247">(</span><span class="ident" id="3942248">i</span>&nbsp;<span class="op" id="3942250">*</span><span class="ident" id="3942251">decInstr</span><span class="op" id="3942259">,</span>&nbsp;<span class="ident" id="3942261">state</span>&nbsp;<span class="op" id="3942267">*</span><span class="ident" id="3942268">decoderState</span><span class="op" id="3942280">,</span>&nbsp;<span class="ident" id="3942282">value</span>&nbsp;<span class="ident" id="3942288">reflect</span><span class="op" id="3942295">.</span><span class="ident" id="3942296">Value</span><span class="op" id="3942301">)</span>&nbsp;<span class="op" id="3942303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942309">state</span><span class="op" id="3942314">.</span><span class="ident" id="3942315">dec</span><span class="op" id="3942318">.</span><span class="ident" id="3942319">ignoreSlice</span><span class="op" id="3942330">(</span><span class="ident" id="3942331">state</span><span class="op" id="3942336">,</span>&nbsp;<span class="ident" id="3942338">elemOp</span><span class="op" id="3942344">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3942349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3942354">case</span>&nbsp;<span class="ident" id="3942359">wire</span><span class="op" id="3942363">.</span><span class="ident" id="3942364">StructT</span>&nbsp;<span class="op" id="3942372">!=</span>&nbsp;<span class="ident" id="3942375">nil</span><span class="op" id="3942378">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3942383">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942458">enginePtr</span><span class="op" id="3942467">,</span>&nbsp;<span class="ident" id="3942469">err</span>&nbsp;<span class="op" id="3942473">:=</span>&nbsp;<span class="ident" id="3942476">dec</span><span class="op" id="3942479">.</span><span class="ident" id="3942480">getIgnoreEnginePtr</span><span class="op" id="3942498">(</span><span class="ident" id="3942499">wireId</span><span class="op" id="3942505">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3942510">if</span>&nbsp;<span class="ident" id="3942513">err</span>&nbsp;<span class="op" id="3942517">!=</span>&nbsp;<span class="ident" id="3942520">nil</span>&nbsp;<span class="op" id="3942524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942530">error_</span><span class="op" id="3942536">(</span><span class="ident" id="3942537">err</span><span class="op" id="3942540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3942545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942550">op</span>&nbsp;<span class="op" id="3942553">=</span>&nbsp;<span class="keyword" id="3942555">func</span><span class="op" id="3942559">(</span><span class="ident" id="3942560">i</span>&nbsp;<span class="op" id="3942562">*</span><span class="ident" id="3942563">decInstr</span><span class="op" id="3942571">,</span>&nbsp;<span class="ident" id="3942573">state</span>&nbsp;<span class="op" id="3942579">*</span><span class="ident" id="3942580">decoderState</span><span class="op" id="3942592">,</span>&nbsp;<span class="ident" id="3942594">value</span>&nbsp;<span class="ident" id="3942600">reflect</span><span class="op" id="3942607">.</span><span class="ident" id="3942608">Value</span><span class="op" id="3942613">)</span>&nbsp;<span class="op" id="3942615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3942621">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942697">state</span><span class="op" id="3942702">.</span><span class="ident" id="3942703">dec</span><span class="op" id="3942706">.</span><span class="ident" id="3942707">ignoreStruct</span><span class="op" id="3942719">(</span><span class="op" id="3942720">*</span><span class="ident" id="3942721">enginePtr</span><span class="op" id="3942730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3942735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3942740">case</span>&nbsp;<span class="ident" id="3942745">wire</span><span class="op" id="3942749">.</span><span class="ident" id="3942750">GobEncoderT</span>&nbsp;<span class="op" id="3942762">!=</span>&nbsp;<span class="ident" id="3942765">nil</span><span class="op" id="3942768">,</span>&nbsp;<span class="ident" id="3942770">wire</span><span class="op" id="3942774">.</span><span class="ident" id="3942775">BinaryMarshalerT</span>&nbsp;<span class="op" id="3942792">!=</span>&nbsp;<span class="ident" id="3942795">nil</span><span class="op" id="3942798">,</span>&nbsp;<span class="ident" id="3942800">wire</span><span class="op" id="3942804">.</span><span class="ident" id="3942805">TextMarshalerT</span>&nbsp;<span class="op" id="3942820">!=</span>&nbsp;<span class="ident" id="3942823">nil</span><span class="op" id="3942826">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942831">op</span>&nbsp;<span class="op" id="3942834">=</span>&nbsp;<span class="keyword" id="3942836">func</span><span class="op" id="3942840">(</span><span class="ident" id="3942841">i</span>&nbsp;<span class="op" id="3942843">*</span><span class="ident" id="3942844">decInstr</span><span class="op" id="3942852">,</span>&nbsp;<span class="ident" id="3942854">state</span>&nbsp;<span class="op" id="3942860">*</span><span class="ident" id="3942861">decoderState</span><span class="op" id="3942873">,</span>&nbsp;<span class="ident" id="3942875">value</span>&nbsp;<span class="ident" id="3942881">reflect</span><span class="op" id="3942888">.</span><span class="ident" id="3942889">Value</span><span class="op" id="3942894">)</span>&nbsp;<span class="op" id="3942896">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942902">state</span><span class="op" id="3942907">.</span><span class="ident" id="3942908">dec</span><span class="op" id="3942911">.</span><span class="ident" id="3942912">ignoreGobDecoder</span><span class="op" id="3942928">(</span><span class="ident" id="3942929">state</span><span class="op" id="3942934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3942939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3942943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3942946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3942949">if</span>&nbsp;<span class="ident" id="3942952">op</span>&nbsp;<span class="op" id="3942955">==</span>&nbsp;<span class="ident" id="3942958">nil</span>&nbsp;<span class="op" id="3942962">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942966">errorf</span><span class="op" id="3942972">(</span><span class="string" id="3942973">&#34;bad&nbsp;data:&nbsp;ignore&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="3943012">,</span>&nbsp;<span class="ident" id="3943014">wireId</span><span class="op" id="3943020">.</span><span class="builtintype" id="3943021">string</span><span class="op" id="3943027">(</span><span class="op" id="3943028">)</span><span class="op" id="3943029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3943032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3943035">return</span>&nbsp;<span class="ident" id="3943042">op</span><br>
<span class="lineno"></span><span class="op" id="3943045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="3943048">//&nbsp;gobDecodeOpFor&nbsp;returns&nbsp;the&nbsp;op&nbsp;for&nbsp;a&nbsp;type&nbsp;that&nbsp;is&nbsp;known&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="3943119">//&nbsp;GobDecoder.</span><br>
<span class="lineno"></span><span class="keyword" id="3943134">func</span>&nbsp;<span class="op" id="3943139">(</span><span class="ident" id="3943140">dec</span>&nbsp;<span class="op" id="3943144">*</span><span class="ident" id="3943145">Decoder</span><span class="op" id="3943152">)</span>&nbsp;<span class="ident" id="3943154">gobDecodeOpFor</span><span class="op" id="3943168">(</span><span class="ident" id="3943169">ut</span>&nbsp;<span class="op" id="3943172">*</span><span class="ident" id="3943173">userTypeInfo</span><span class="op" id="3943185">)</span>&nbsp;<span class="op" id="3943187">*</span><span class="ident" id="3943188">decOp</span>&nbsp;<span class="op" id="3943194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943197">rcvrType</span>&nbsp;<span class="op" id="3943206">:=</span>&nbsp;<span class="ident" id="3943209">ut</span><span class="op" id="3943211">.</span><span class="ident" id="3943212">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3943218">if</span>&nbsp;<span class="ident" id="3943221">ut</span><span class="op" id="3943223">.</span><span class="ident" id="3943224">decIndir</span>&nbsp;<span class="op" id="3943233">==</span>&nbsp;<span class="op" id="3943236">-</span><span class="num" id="3943237">1</span>&nbsp;<span class="op" id="3943239">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943243">rcvrType</span>&nbsp;<span class="op" id="3943252">=</span>&nbsp;<span class="ident" id="3943254">reflect</span><span class="op" id="3943261">.</span><span class="ident" id="3943262">PtrTo</span><span class="op" id="3943267">(</span><span class="ident" id="3943268">rcvrType</span><span class="op" id="3943276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3943279">}</span>&nbsp;<span class="keyword" id="3943281">else</span>&nbsp;<span class="keyword" id="3943286">if</span>&nbsp;<span class="ident" id="3943289">ut</span><span class="op" id="3943291">.</span><span class="ident" id="3943292">decIndir</span>&nbsp;<span class="op" id="3943301">&gt;</span>&nbsp;<span class="num" id="3943303">0</span>&nbsp;<span class="op" id="3943305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3943309">for</span>&nbsp;<span class="ident" id="3943313">i</span>&nbsp;<span class="op" id="3943315">:=</span>&nbsp;<span class="builtintype" id="3943318">int8</span><span class="op" id="3943322">(</span><span class="num" id="3943323">0</span><span class="op" id="3943324">)</span><span class="op" id="3943325">;</span>&nbsp;<span class="ident" id="3943327">i</span>&nbsp;<span class="op" id="3943329">&lt;</span>&nbsp;<span class="ident" id="3943331">ut</span><span class="op" id="3943333">.</span><span class="ident" id="3943334">decIndir</span><span class="op" id="3943342">;</span>&nbsp;<span class="ident" id="3943344">i</span><span class="op" id="3943345">++</span>&nbsp;<span class="op" id="3943348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943353">rcvrType</span>&nbsp;<span class="op" id="3943362">=</span>&nbsp;<span class="ident" id="3943364">rcvrType</span><span class="op" id="3943372">.</span><span class="ident" id="3943373">Elem</span><span class="op" id="3943377">(</span><span class="op" id="3943378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3943382">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3943385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3943388">var</span>&nbsp;<span class="ident" id="3943392">op</span>&nbsp;<span class="ident" id="3943395">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943402">op</span>&nbsp;<span class="op" id="3943405">=</span>&nbsp;<span class="keyword" id="3943407">func</span><span class="op" id="3943411">(</span><span class="ident" id="3943412">i</span>&nbsp;<span class="op" id="3943414">*</span><span class="ident" id="3943415">decInstr</span><span class="op" id="3943423">,</span>&nbsp;<span class="ident" id="3943425">state</span>&nbsp;<span class="op" id="3943431">*</span><span class="ident" id="3943432">decoderState</span><span class="op" id="3943444">,</span>&nbsp;<span class="ident" id="3943446">value</span>&nbsp;<span class="ident" id="3943452">reflect</span><span class="op" id="3943459">.</span><span class="ident" id="3943460">Value</span><span class="op" id="3943465">)</span>&nbsp;<span class="op" id="3943467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3943471">//&nbsp;We&nbsp;now&nbsp;have&nbsp;the&nbsp;base&nbsp;type.&nbsp;We&nbsp;need&nbsp;its&nbsp;address&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3943553">if</span>&nbsp;<span class="ident" id="3943556">value</span><span class="op" id="3943561">.</span><span class="ident" id="3943562">Kind</span><span class="op" id="3943566">(</span><span class="op" id="3943567">)</span>&nbsp;<span class="op" id="3943569">!=</span>&nbsp;<span class="ident" id="3943572">reflect</span><span class="op" id="3943579">.</span><span class="ident" id="3943580">Ptr</span>&nbsp;<span class="op" id="3943584">&amp;&amp;</span>&nbsp;<span class="ident" id="3943587">rcvrType</span><span class="op" id="3943595">.</span><span class="ident" id="3943596">Kind</span><span class="op" id="3943600">(</span><span class="op" id="3943601">)</span>&nbsp;<span class="op" id="3943603">==</span>&nbsp;<span class="ident" id="3943606">reflect</span><span class="op" id="3943613">.</span><span class="ident" id="3943614">Ptr</span>&nbsp;<span class="op" id="3943618">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943623">value</span>&nbsp;<span class="op" id="3943629">=</span>&nbsp;<span class="ident" id="3943631">value</span><span class="op" id="3943636">.</span><span class="ident" id="3943637">Addr</span><span class="op" id="3943641">(</span><span class="op" id="3943642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3943646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943650">state</span><span class="op" id="3943655">.</span><span class="ident" id="3943656">dec</span><span class="op" id="3943659">.</span><span class="ident" id="3943660">decodeGobDecoder</span><span class="op" id="3943676">(</span><span class="ident" id="3943677">ut</span><span class="op" id="3943679">,</span>&nbsp;<span class="ident" id="3943681">state</span><span class="op" id="3943686">,</span>&nbsp;<span class="ident" id="3943688">value</span><span class="op" id="3943693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3943696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3943699">return</span>&nbsp;<span class="op" id="3943706">&amp;</span><span class="ident" id="3943707">op</span><br>
<span class="lineno">925</span><span class="op" id="3943710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3943713">//&nbsp;compatibleType&nbsp;asks:&nbsp;Are&nbsp;these&nbsp;two&nbsp;gob&nbsp;Types&nbsp;compatible?</span><br>
<span class="lineno"></span><span class="comment" id="3943773">//&nbsp;Answers&nbsp;the&nbsp;question&nbsp;for&nbsp;basic&nbsp;types,&nbsp;arrays,&nbsp;maps&nbsp;and&nbsp;slices,&nbsp;plus</span><br>
<span class="lineno"></span><span class="comment" id="3943844">//&nbsp;GobEncoder/Decoder&nbsp;pairs.</span><br>
<span class="lineno">930</span><span class="comment" id="3943873">//&nbsp;Structs&nbsp;are&nbsp;considered&nbsp;ok;&nbsp;fields&nbsp;will&nbsp;be&nbsp;checked&nbsp;later.</span><br>
<span class="lineno"></span><span class="keyword" id="3943933">func</span>&nbsp;<span class="op" id="3943938">(</span><span class="ident" id="3943939">dec</span>&nbsp;<span class="op" id="3943943">*</span><span class="ident" id="3943944">Decoder</span><span class="op" id="3943951">)</span>&nbsp;<span class="ident" id="3943953">compatibleType</span><span class="op" id="3943967">(</span><span class="ident" id="3943968">fr</span>&nbsp;<span class="ident" id="3943971">reflect</span><span class="op" id="3943978">.</span><span class="ident" id="3943979">Type</span><span class="op" id="3943983">,</span>&nbsp;<span class="ident" id="3943985">fw</span>&nbsp;<span class="ident" id="3943988">typeId</span><span class="op" id="3943994">,</span>&nbsp;<span class="ident" id="3943996">inProgress</span>&nbsp;<span class="keyword" id="3944007">map</span><span class="op" id="3944010">[</span><span class="ident" id="3944011">reflect</span><span class="op" id="3944018">.</span><span class="ident" id="3944019">Type</span><span class="op" id="3944023">]</span><span class="ident" id="3944024">typeId</span><span class="op" id="3944030">)</span>&nbsp;<span class="builtintype" id="3944032">bool</span>&nbsp;<span class="op" id="3944037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944040">if</span>&nbsp;<span class="ident" id="3944043">rhs</span><span class="op" id="3944046">,</span>&nbsp;<span class="ident" id="3944048">ok</span>&nbsp;<span class="op" id="3944051">:=</span>&nbsp;<span class="ident" id="3944054">inProgress</span><span class="op" id="3944064">[</span><span class="ident" id="3944065">fr</span><span class="op" id="3944067">]</span><span class="op" id="3944068">;</span>&nbsp;<span class="ident" id="3944070">ok</span>&nbsp;<span class="op" id="3944073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944077">return</span>&nbsp;<span class="ident" id="3944084">rhs</span>&nbsp;<span class="op" id="3944088">==</span>&nbsp;<span class="ident" id="3944091">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3944095">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944098">inProgress</span><span class="op" id="3944108">[</span><span class="ident" id="3944109">fr</span><span class="op" id="3944111">]</span>&nbsp;<span class="op" id="3944113">=</span>&nbsp;<span class="ident" id="3944115">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944119">ut</span>&nbsp;<span class="op" id="3944122">:=</span>&nbsp;<span class="ident" id="3944125">userType</span><span class="op" id="3944133">(</span><span class="ident" id="3944134">fr</span><span class="op" id="3944136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944139">wire</span><span class="op" id="3944143">,</span>&nbsp;<span class="ident" id="3944145">ok</span>&nbsp;<span class="op" id="3944148">:=</span>&nbsp;<span class="ident" id="3944151">dec</span><span class="op" id="3944154">.</span><span class="ident" id="3944155">wireType</span><span class="op" id="3944163">[</span><span class="ident" id="3944164">fw</span><span class="op" id="3944166">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3944169">//&nbsp;If&nbsp;wire&nbsp;was&nbsp;encoded&nbsp;with&nbsp;an&nbsp;encoding&nbsp;method,&nbsp;fr&nbsp;must&nbsp;have&nbsp;that&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3944244">//&nbsp;And&nbsp;if&nbsp;not,&nbsp;it&nbsp;must&nbsp;not.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3944273">//&nbsp;At&nbsp;most&nbsp;one&nbsp;of&nbsp;the&nbsp;booleans&nbsp;in&nbsp;ut&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3944319">//&nbsp;We&nbsp;could&nbsp;possibly&nbsp;relax&nbsp;this&nbsp;constraint&nbsp;in&nbsp;the&nbsp;future&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3944389">//&nbsp;choose&nbsp;the&nbsp;decoding&nbsp;method&nbsp;using&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;wireType.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3944452">//&nbsp;The&nbsp;parentheses&nbsp;look&nbsp;odd&nbsp;but&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944498">if</span>&nbsp;<span class="op" id="3944501">(</span><span class="ident" id="3944502">ut</span><span class="op" id="3944504">.</span><span class="ident" id="3944505">externalDec</span>&nbsp;<span class="op" id="3944517">==</span>&nbsp;<span class="ident" id="3944520">xGob</span><span class="op" id="3944524">)</span>&nbsp;<span class="op" id="3944526">!=</span>&nbsp;<span class="op" id="3944529">(</span><span class="ident" id="3944530">ok</span>&nbsp;<span class="op" id="3944533">&amp;&amp;</span>&nbsp;<span class="ident" id="3944536">wire</span><span class="op" id="3944540">.</span><span class="ident" id="3944541">GobEncoderT</span>&nbsp;<span class="op" id="3944553">!=</span>&nbsp;<span class="ident" id="3944556">nil</span><span class="op" id="3944559">)</span>&nbsp;<span class="op" id="3944561">||</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3944566">(</span><span class="ident" id="3944567">ut</span><span class="op" id="3944569">.</span><span class="ident" id="3944570">externalDec</span>&nbsp;<span class="op" id="3944582">==</span>&nbsp;<span class="ident" id="3944585">xBinary</span><span class="op" id="3944592">)</span>&nbsp;<span class="op" id="3944594">!=</span>&nbsp;<span class="op" id="3944597">(</span><span class="ident" id="3944598">ok</span>&nbsp;<span class="op" id="3944601">&amp;&amp;</span>&nbsp;<span class="ident" id="3944604">wire</span><span class="op" id="3944608">.</span><span class="ident" id="3944609">BinaryMarshalerT</span>&nbsp;<span class="op" id="3944626">!=</span>&nbsp;<span class="ident" id="3944629">nil</span><span class="op" id="3944632">)</span>&nbsp;<span class="op" id="3944634">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3944639">(</span><span class="ident" id="3944640">ut</span><span class="op" id="3944642">.</span><span class="ident" id="3944643">externalDec</span>&nbsp;<span class="op" id="3944655">==</span>&nbsp;<span class="ident" id="3944658">xText</span><span class="op" id="3944663">)</span>&nbsp;<span class="op" id="3944665">!=</span>&nbsp;<span class="op" id="3944668">(</span><span class="ident" id="3944669">ok</span>&nbsp;<span class="op" id="3944672">&amp;&amp;</span>&nbsp;<span class="ident" id="3944675">wire</span><span class="op" id="3944679">.</span><span class="ident" id="3944680">TextMarshalerT</span>&nbsp;<span class="op" id="3944695">!=</span>&nbsp;<span class="ident" id="3944698">nil</span><span class="op" id="3944701">)</span>&nbsp;<span class="op" id="3944703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944707">return</span>&nbsp;<span class="builtintype" id="3944714">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3944721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944724">if</span>&nbsp;<span class="ident" id="3944727">ut</span><span class="op" id="3944729">.</span><span class="ident" id="3944730">externalDec</span>&nbsp;<span class="op" id="3944742">!=</span>&nbsp;<span class="num" id="3944745">0</span>&nbsp;<span class="op" id="3944747">{</span>&nbsp;<span class="comment" id="3944749">//&nbsp;This&nbsp;test&nbsp;trumps&nbsp;all&nbsp;others.</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944783">return</span>&nbsp;<span class="builtintype" id="3944790">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3944796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944799">switch</span>&nbsp;<span class="ident" id="3944806">t</span>&nbsp;<span class="op" id="3944808">:=</span>&nbsp;<span class="ident" id="3944811">ut</span><span class="op" id="3944813">.</span><span class="ident" id="3944814">base</span><span class="op" id="3944818">;</span>&nbsp;<span class="ident" id="3944820">t</span><span class="op" id="3944821">.</span><span class="ident" id="3944822">Kind</span><span class="op" id="3944826">(</span><span class="op" id="3944827">)</span>&nbsp;<span class="op" id="3944829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944832">default</span><span class="op" id="3944839">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3944843">//&nbsp;chan,&nbsp;etc:&nbsp;cannot&nbsp;handle.</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944874">return</span>&nbsp;<span class="builtintype" id="3944881">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944888">case</span>&nbsp;<span class="ident" id="3944893">reflect</span><span class="op" id="3944900">.</span><span class="ident" id="3944901">Bool</span><span class="op" id="3944905">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944909">return</span>&nbsp;<span class="ident" id="3944916">fw</span>&nbsp;<span class="op" id="3944919">==</span>&nbsp;<span class="ident" id="3944922">tBool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944929">case</span>&nbsp;<span class="ident" id="3944934">reflect</span><span class="op" id="3944941">.</span><span class="ident" id="3944942">Int</span><span class="op" id="3944945">,</span>&nbsp;<span class="ident" id="3944947">reflect</span><span class="op" id="3944954">.</span><span class="ident" id="3944955">Int8</span><span class="op" id="3944959">,</span>&nbsp;<span class="ident" id="3944961">reflect</span><span class="op" id="3944968">.</span><span class="ident" id="3944969">Int16</span><span class="op" id="3944974">,</span>&nbsp;<span class="ident" id="3944976">reflect</span><span class="op" id="3944983">.</span><span class="ident" id="3944984">Int32</span><span class="op" id="3944989">,</span>&nbsp;<span class="ident" id="3944991">reflect</span><span class="op" id="3944998">.</span><span class="ident" id="3944999">Int64</span><span class="op" id="3945004">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945008">return</span>&nbsp;<span class="ident" id="3945015">fw</span>&nbsp;<span class="op" id="3945018">==</span>&nbsp;<span class="ident" id="3945021">tInt</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945027">case</span>&nbsp;<span class="ident" id="3945032">reflect</span><span class="op" id="3945039">.</span><span class="ident" id="3945040">Uint</span><span class="op" id="3945044">,</span>&nbsp;<span class="ident" id="3945046">reflect</span><span class="op" id="3945053">.</span><span class="ident" id="3945054">Uint8</span><span class="op" id="3945059">,</span>&nbsp;<span class="ident" id="3945061">reflect</span><span class="op" id="3945068">.</span><span class="ident" id="3945069">Uint16</span><span class="op" id="3945075">,</span>&nbsp;<span class="ident" id="3945077">reflect</span><span class="op" id="3945084">.</span><span class="ident" id="3945085">Uint32</span><span class="op" id="3945091">,</span>&nbsp;<span class="ident" id="3945093">reflect</span><span class="op" id="3945100">.</span><span class="ident" id="3945101">Uint64</span><span class="op" id="3945107">,</span>&nbsp;<span class="ident" id="3945109">reflect</span><span class="op" id="3945116">.</span><span class="ident" id="3945117">Uintptr</span><span class="op" id="3945124">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945128">return</span>&nbsp;<span class="ident" id="3945135">fw</span>&nbsp;<span class="op" id="3945138">==</span>&nbsp;<span class="ident" id="3945141">tUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945148">case</span>&nbsp;<span class="ident" id="3945153">reflect</span><span class="op" id="3945160">.</span><span class="ident" id="3945161">Float32</span><span class="op" id="3945168">,</span>&nbsp;<span class="ident" id="3945170">reflect</span><span class="op" id="3945177">.</span><span class="ident" id="3945178">Float64</span><span class="op" id="3945185">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945189">return</span>&nbsp;<span class="ident" id="3945196">fw</span>&nbsp;<span class="op" id="3945199">==</span>&nbsp;<span class="ident" id="3945202">tFloat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945210">case</span>&nbsp;<span class="ident" id="3945215">reflect</span><span class="op" id="3945222">.</span><span class="ident" id="3945223">Complex64</span><span class="op" id="3945232">,</span>&nbsp;<span class="ident" id="3945234">reflect</span><span class="op" id="3945241">.</span><span class="ident" id="3945242">Complex128</span><span class="op" id="3945252">:</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945256">return</span>&nbsp;<span class="ident" id="3945263">fw</span>&nbsp;<span class="op" id="3945266">==</span>&nbsp;<span class="ident" id="3945269">tComplex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945279">case</span>&nbsp;<span class="ident" id="3945284">reflect</span><span class="op" id="3945291">.</span><span class="ident" id="3945292">String</span><span class="op" id="3945298">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945302">return</span>&nbsp;<span class="ident" id="3945309">fw</span>&nbsp;<span class="op" id="3945312">==</span>&nbsp;<span class="ident" id="3945315">tString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945324">case</span>&nbsp;<span class="ident" id="3945329">reflect</span><span class="op" id="3945336">.</span><span class="ident" id="3945337">Interface</span><span class="op" id="3945346">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945350">return</span>&nbsp;<span class="ident" id="3945357">fw</span>&nbsp;<span class="op" id="3945360">==</span>&nbsp;<span class="ident" id="3945363">tInterface</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945375">case</span>&nbsp;<span class="ident" id="3945380">reflect</span><span class="op" id="3945387">.</span><span class="ident" id="3945388">Array</span><span class="op" id="3945393">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945397">if</span>&nbsp;<span class="op" id="3945400">!</span><span class="ident" id="3945401">ok</span>&nbsp;<span class="op" id="3945404">||</span>&nbsp;<span class="ident" id="3945407">wire</span><span class="op" id="3945411">.</span><span class="ident" id="3945412">ArrayT</span>&nbsp;<span class="op" id="3945419">==</span>&nbsp;<span class="ident" id="3945422">nil</span>&nbsp;<span class="op" id="3945426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945431">return</span>&nbsp;<span class="builtintype" id="3945438">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3945446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945450">array</span>&nbsp;<span class="op" id="3945456">:=</span>&nbsp;<span class="ident" id="3945459">wire</span><span class="op" id="3945463">.</span><span class="ident" id="3945464">ArrayT</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945473">return</span>&nbsp;<span class="ident" id="3945480">t</span><span class="op" id="3945481">.</span><span class="ident" id="3945482">Len</span><span class="op" id="3945485">(</span><span class="op" id="3945486">)</span>&nbsp;<span class="op" id="3945488">==</span>&nbsp;<span class="ident" id="3945491">array</span><span class="op" id="3945496">.</span><span class="ident" id="3945497">Len</span>&nbsp;<span class="op" id="3945501">&amp;&amp;</span>&nbsp;<span class="ident" id="3945504">dec</span><span class="op" id="3945507">.</span><span class="ident" id="3945508">compatibleType</span><span class="op" id="3945522">(</span><span class="ident" id="3945523">t</span><span class="op" id="3945524">.</span><span class="ident" id="3945525">Elem</span><span class="op" id="3945529">(</span><span class="op" id="3945530">)</span><span class="op" id="3945531">,</span>&nbsp;<span class="ident" id="3945533">array</span><span class="op" id="3945538">.</span><span class="ident" id="3945539">Elem</span><span class="op" id="3945543">,</span>&nbsp;<span class="ident" id="3945545">inProgress</span><span class="op" id="3945555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945558">case</span>&nbsp;<span class="ident" id="3945563">reflect</span><span class="op" id="3945570">.</span><span class="ident" id="3945571">Map</span><span class="op" id="3945574">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945578">if</span>&nbsp;<span class="op" id="3945581">!</span><span class="ident" id="3945582">ok</span>&nbsp;<span class="op" id="3945585">||</span>&nbsp;<span class="ident" id="3945588">wire</span><span class="op" id="3945592">.</span><span class="ident" id="3945593">MapT</span>&nbsp;<span class="op" id="3945598">==</span>&nbsp;<span class="ident" id="3945601">nil</span>&nbsp;<span class="op" id="3945605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945610">return</span>&nbsp;<span class="builtintype" id="3945617">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3945625">}</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945629">MapType</span>&nbsp;<span class="op" id="3945637">:=</span>&nbsp;<span class="ident" id="3945640">wire</span><span class="op" id="3945644">.</span><span class="ident" id="3945645">MapT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945652">return</span>&nbsp;<span class="ident" id="3945659">dec</span><span class="op" id="3945662">.</span><span class="ident" id="3945663">compatibleType</span><span class="op" id="3945677">(</span><span class="ident" id="3945678">t</span><span class="op" id="3945679">.</span><span class="ident" id="3945680">Key</span><span class="op" id="3945683">(</span><span class="op" id="3945684">)</span><span class="op" id="3945685">,</span>&nbsp;<span class="ident" id="3945687">MapType</span><span class="op" id="3945694">.</span><span class="ident" id="3945695">Key</span><span class="op" id="3945698">,</span>&nbsp;<span class="ident" id="3945700">inProgress</span><span class="op" id="3945710">)</span>&nbsp;<span class="op" id="3945712">&amp;&amp;</span>&nbsp;<span class="ident" id="3945715">dec</span><span class="op" id="3945718">.</span><span class="ident" id="3945719">compatibleType</span><span class="op" id="3945733">(</span><span class="ident" id="3945734">t</span><span class="op" id="3945735">.</span><span class="ident" id="3945736">Elem</span><span class="op" id="3945740">(</span><span class="op" id="3945741">)</span><span class="op" id="3945742">,</span>&nbsp;<span class="ident" id="3945744">MapType</span><span class="op" id="3945751">.</span><span class="ident" id="3945752">Elem</span><span class="op" id="3945756">,</span>&nbsp;<span class="ident" id="3945758">inProgress</span><span class="op" id="3945768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945771">case</span>&nbsp;<span class="ident" id="3945776">reflect</span><span class="op" id="3945783">.</span><span class="ident" id="3945784">Slice</span><span class="op" id="3945789">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3945793">//&nbsp;Is&nbsp;it&nbsp;an&nbsp;array&nbsp;of&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945823">if</span>&nbsp;<span class="ident" id="3945826">t</span><span class="op" id="3945827">.</span><span class="ident" id="3945828">Elem</span><span class="op" id="3945832">(</span><span class="op" id="3945833">)</span><span class="op" id="3945834">.</span><span class="ident" id="3945835">Kind</span><span class="op" id="3945839">(</span><span class="op" id="3945840">)</span>&nbsp;<span class="op" id="3945842">==</span>&nbsp;<span class="ident" id="3945845">reflect</span><span class="op" id="3945852">.</span><span class="ident" id="3945853">Uint8</span>&nbsp;<span class="op" id="3945859">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945864">return</span>&nbsp;<span class="ident" id="3945871">fw</span>&nbsp;<span class="op" id="3945874">==</span>&nbsp;<span class="ident" id="3945877">tBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3945886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3945890">//&nbsp;Extract&nbsp;and&nbsp;compare&nbsp;element&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945930">var</span>&nbsp;<span class="ident" id="3945934">sw</span>&nbsp;<span class="op" id="3945937">*</span><span class="ident" id="3945938">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945950">if</span>&nbsp;<span class="ident" id="3945953">tt</span><span class="op" id="3945955">,</span>&nbsp;<span class="ident" id="3945957">ok</span>&nbsp;<span class="op" id="3945960">:=</span>&nbsp;<span class="ident" id="3945963">builtinIdToType</span><span class="op" id="3945978">[</span><span class="ident" id="3945979">fw</span><span class="op" id="3945981">]</span><span class="op" id="3945982">;</span>&nbsp;<span class="ident" id="3945984">ok</span>&nbsp;<span class="op" id="3945987">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945992">sw</span><span class="op" id="3945994">,</span>&nbsp;<span class="ident" id="3945996">_</span>&nbsp;<span class="op" id="3945998">=</span>&nbsp;<span class="ident" id="3946000">tt</span><span class="op" id="3946002">.</span><span class="op" id="3946003">(</span><span class="op" id="3946004">*</span><span class="ident" id="3946005">sliceType</span><span class="op" id="3946014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3946018">}</span>&nbsp;<span class="keyword" id="3946020">else</span>&nbsp;<span class="keyword" id="3946025">if</span>&nbsp;<span class="ident" id="3946028">wire</span>&nbsp;<span class="op" id="3946033">!=</span>&nbsp;<span class="ident" id="3946036">nil</span>&nbsp;<span class="op" id="3946040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946045">sw</span>&nbsp;<span class="op" id="3946048">=</span>&nbsp;<span class="ident" id="3946050">wire</span><span class="op" id="3946054">.</span><span class="ident" id="3946055">SliceT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3946064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946068">elem</span>&nbsp;<span class="op" id="3946073">:=</span>&nbsp;<span class="ident" id="3946076">userType</span><span class="op" id="3946084">(</span><span class="ident" id="3946085">t</span><span class="op" id="3946086">.</span><span class="ident" id="3946087">Elem</span><span class="op" id="3946091">(</span><span class="op" id="3946092">)</span><span class="op" id="3946093">)</span><span class="op" id="3946094">.</span><span class="ident" id="3946095">base</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946102">return</span>&nbsp;<span class="ident" id="3946109">sw</span>&nbsp;<span class="op" id="3946112">!=</span>&nbsp;<span class="ident" id="3946115">nil</span>&nbsp;<span class="op" id="3946119">&amp;&amp;</span>&nbsp;<span class="ident" id="3946122">dec</span><span class="op" id="3946125">.</span><span class="ident" id="3946126">compatibleType</span><span class="op" id="3946140">(</span><span class="ident" id="3946141">elem</span><span class="op" id="3946145">,</span>&nbsp;<span class="ident" id="3946147">sw</span><span class="op" id="3946149">.</span><span class="ident" id="3946150">Elem</span><span class="op" id="3946154">,</span>&nbsp;<span class="ident" id="3946156">inProgress</span><span class="op" id="3946166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946169">case</span>&nbsp;<span class="ident" id="3946174">reflect</span><span class="op" id="3946181">.</span><span class="ident" id="3946182">Struct</span><span class="op" id="3946188">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946192">return</span>&nbsp;<span class="builtintype" id="3946199">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3946205">}</span><br>
<span class="lineno"></span><span class="op" id="3946207">}</span><br>
<span class="lineno">1000</span><br>
<span class="lineno"></span><span class="comment" id="3946210">//&nbsp;typeString&nbsp;returns&nbsp;a&nbsp;human-readable&nbsp;description&nbsp;of&nbsp;the&nbsp;type&nbsp;identified&nbsp;by&nbsp;remoteId.</span><br>
<span class="lineno"></span><span class="keyword" id="3946297">func</span>&nbsp;<span class="op" id="3946302">(</span><span class="ident" id="3946303">dec</span>&nbsp;<span class="op" id="3946307">*</span><span class="ident" id="3946308">Decoder</span><span class="op" id="3946315">)</span>&nbsp;<span class="ident" id="3946317">typeString</span><span class="op" id="3946327">(</span><span class="ident" id="3946328">remoteId</span>&nbsp;<span class="ident" id="3946337">typeId</span><span class="op" id="3946343">)</span>&nbsp;<span class="builtintype" id="3946345">string</span>&nbsp;<span class="op" id="3946352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946355">if</span>&nbsp;<span class="ident" id="3946358">t</span>&nbsp;<span class="op" id="3946360">:=</span>&nbsp;<span class="ident" id="3946363">idToType</span><span class="op" id="3946371">[</span><span class="ident" id="3946372">remoteId</span><span class="op" id="3946380">]</span><span class="op" id="3946381">;</span>&nbsp;<span class="ident" id="3946383">t</span>&nbsp;<span class="op" id="3946385">!=</span>&nbsp;<span class="ident" id="3946388">nil</span>&nbsp;<span class="op" id="3946392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3946396">//&nbsp;globally&nbsp;known&nbsp;type.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946422">return</span>&nbsp;<span class="ident" id="3946429">t</span><span class="op" id="3946430">.</span><span class="builtintype" id="3946431">string</span><span class="op" id="3946437">(</span><span class="op" id="3946438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3946441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946444">return</span>&nbsp;<span class="ident" id="3946451">dec</span><span class="op" id="3946454">.</span><span class="ident" id="3946455">wireType</span><span class="op" id="3946463">[</span><span class="ident" id="3946464">remoteId</span><span class="op" id="3946472">]</span><span class="op" id="3946473">.</span><span class="builtintype" id="3946474">string</span><span class="op" id="3946480">(</span><span class="op" id="3946481">)</span><br>
<span class="lineno"></span><span class="op" id="3946483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1010</span><span class="comment" id="3946486">//&nbsp;compileSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value,&nbsp;including</span><br>
<span class="lineno"></span><span class="comment" id="3946575">//&nbsp;GobDecoders.</span><br>
<span class="lineno"></span><span class="keyword" id="3946591">func</span>&nbsp;<span class="op" id="3946596">(</span><span class="ident" id="3946597">dec</span>&nbsp;<span class="op" id="3946601">*</span><span class="ident" id="3946602">Decoder</span><span class="op" id="3946609">)</span>&nbsp;<span class="ident" id="3946611">compileSingle</span><span class="op" id="3946624">(</span><span class="ident" id="3946625">remoteId</span>&nbsp;<span class="ident" id="3946634">typeId</span><span class="op" id="3946640">,</span>&nbsp;<span class="ident" id="3946642">ut</span>&nbsp;<span class="op" id="3946645">*</span><span class="ident" id="3946646">userTypeInfo</span><span class="op" id="3946658">)</span>&nbsp;<span class="op" id="3946660">(</span><span class="ident" id="3946661">engine</span>&nbsp;<span class="op" id="3946668">*</span><span class="ident" id="3946669">decEngine</span><span class="op" id="3946678">,</span>&nbsp;<span class="ident" id="3946680">err</span>&nbsp;<span class="builtintype" id="3946684">error</span><span class="op" id="3946689">)</span>&nbsp;<span class="op" id="3946691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946694">rt</span>&nbsp;<span class="op" id="3946697">:=</span>&nbsp;<span class="ident" id="3946700">ut</span><span class="op" id="3946702">.</span><span class="ident" id="3946703">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946709">engine</span>&nbsp;<span class="op" id="3946716">=</span>&nbsp;<span class="builtinfunc" id="3946718">new</span><span class="op" id="3946721">(</span><span class="ident" id="3946722">decEngine</span><span class="op" id="3946731">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946734">engine</span><span class="op" id="3946740">.</span><span class="ident" id="3946741">instr</span>&nbsp;<span class="op" id="3946747">=</span>&nbsp;<span class="builtinfunc" id="3946749">make</span><span class="op" id="3946753">(</span><span class="op" id="3946754">[</span><span class="op" id="3946755">]</span><span class="ident" id="3946756">decInstr</span><span class="op" id="3946764">,</span>&nbsp;<span class="num" id="3946766">1</span><span class="op" id="3946767">)</span>&nbsp;<span class="comment" id="3946769">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946782">name</span>&nbsp;<span class="op" id="3946787">:=</span>&nbsp;<span class="ident" id="3946790">rt</span><span class="op" id="3946792">.</span><span class="ident" id="3946793">String</span><span class="op" id="3946799">(</span><span class="op" id="3946800">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3946817">//&nbsp;best&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946836">if</span>&nbsp;<span class="op" id="3946839">!</span><span class="ident" id="3946840">dec</span><span class="op" id="3946843">.</span><span class="ident" id="3946844">compatibleType</span><span class="op" id="3946858">(</span><span class="ident" id="3946859">rt</span><span class="op" id="3946861">,</span>&nbsp;<span class="ident" id="3946863">remoteId</span><span class="op" id="3946871">,</span>&nbsp;<span class="builtinfunc" id="3946873">make</span><span class="op" id="3946877">(</span><span class="keyword" id="3946878">map</span><span class="op" id="3946881">[</span><span class="ident" id="3946882">reflect</span><span class="op" id="3946889">.</span><span class="ident" id="3946890">Type</span><span class="op" id="3946894">]</span><span class="ident" id="3946895">typeId</span><span class="op" id="3946901">)</span><span class="op" id="3946902">)</span>&nbsp;<span class="op" id="3946904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946908">remoteType</span>&nbsp;<span class="op" id="3946919">:=</span>&nbsp;<span class="ident" id="3946922">dec</span><span class="op" id="3946925">.</span><span class="ident" id="3946926">typeString</span><span class="op" id="3946936">(</span><span class="ident" id="3946937">remoteId</span><span class="op" id="3946945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3946949">//&nbsp;Common&nbsp;confusing&nbsp;case:&nbsp;local&nbsp;interface&nbsp;type,&nbsp;remote&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947021">if</span>&nbsp;<span class="ident" id="3947024">ut</span><span class="op" id="3947026">.</span><span class="ident" id="3947027">base</span><span class="op" id="3947031">.</span><span class="ident" id="3947032">Kind</span><span class="op" id="3947036">(</span><span class="op" id="3947037">)</span>&nbsp;<span class="op" id="3947039">==</span>&nbsp;<span class="ident" id="3947042">reflect</span><span class="op" id="3947049">.</span><span class="ident" id="3947050">Interface</span>&nbsp;<span class="op" id="3947060">&amp;&amp;</span>&nbsp;<span class="ident" id="3947063">remoteId</span>&nbsp;<span class="op" id="3947072">!=</span>&nbsp;<span class="ident" id="3947075">tInterface</span>&nbsp;<span class="op" id="3947086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947091">return</span>&nbsp;<span class="ident" id="3947098">nil</span><span class="op" id="3947101">,</span>&nbsp;<span class="ident" id="3947103">errors</span><span class="op" id="3947109">.</span><span class="ident" id="3947110">New</span><span class="op" id="3947113">(</span><span class="string" id="3947114">&#34;gob:&nbsp;local&nbsp;interface&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3947143">+</span>&nbsp;<span class="ident" id="3947145">name</span>&nbsp;<span class="op" id="3947150">+</span>&nbsp;<span class="string" id="3947152">&#34;&nbsp;can&nbsp;only&nbsp;be&nbsp;decoded&nbsp;from&nbsp;remote&nbsp;interface&nbsp;type;&nbsp;received&nbsp;concrete&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3947227">+</span>&nbsp;<span class="ident" id="3947229">remoteType</span><span class="op" id="3947239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3947243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947247">return</span>&nbsp;<span class="ident" id="3947254">nil</span><span class="op" id="3947257">,</span>&nbsp;<span class="ident" id="3947259">errors</span><span class="op" id="3947265">.</span><span class="ident" id="3947266">New</span><span class="op" id="3947269">(</span><span class="string" id="3947270">&#34;gob:&nbsp;decoding&nbsp;into&nbsp;local&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3947303">+</span>&nbsp;<span class="ident" id="3947305">name</span>&nbsp;<span class="op" id="3947310">+</span>&nbsp;<span class="string" id="3947312">&#34;,&nbsp;received&nbsp;remote&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3947338">+</span>&nbsp;<span class="ident" id="3947340">remoteType</span><span class="op" id="3947350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3947353">}</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947356">op</span>&nbsp;<span class="op" id="3947359">:=</span>&nbsp;<span class="ident" id="3947362">dec</span><span class="op" id="3947365">.</span><span class="ident" id="3947366">decOpFor</span><span class="op" id="3947374">(</span><span class="ident" id="3947375">remoteId</span><span class="op" id="3947383">,</span>&nbsp;<span class="ident" id="3947385">rt</span><span class="op" id="3947387">,</span>&nbsp;<span class="ident" id="3947389">name</span><span class="op" id="3947393">,</span>&nbsp;<span class="builtinfunc" id="3947395">make</span><span class="op" id="3947399">(</span><span class="keyword" id="3947400">map</span><span class="op" id="3947403">[</span><span class="ident" id="3947404">reflect</span><span class="op" id="3947411">.</span><span class="ident" id="3947412">Type</span><span class="op" id="3947416">]</span><span class="op" id="3947417">*</span><span class="ident" id="3947418">decOp</span><span class="op" id="3947423">)</span><span class="op" id="3947424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947427">ovfl</span>&nbsp;<span class="op" id="3947432">:=</span>&nbsp;<span class="ident" id="3947435">errors</span><span class="op" id="3947441">.</span><span class="ident" id="3947442">New</span><span class="op" id="3947445">(</span><span class="string" id="3947446">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="3947460">+</span>&nbsp;<span class="ident" id="3947462">name</span>&nbsp;<span class="op" id="3947467">+</span>&nbsp;<span class="string" id="3947469">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="3947485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947488">engine</span><span class="op" id="3947494">.</span><span class="ident" id="3947495">instr</span><span class="op" id="3947500">[</span><span class="ident" id="3947501">singletonField</span><span class="op" id="3947515">]</span>&nbsp;<span class="op" id="3947517">=</span>&nbsp;<span class="ident" id="3947519">decInstr</span><span class="op" id="3947527">{</span><span class="op" id="3947528">*</span><span class="ident" id="3947529">op</span><span class="op" id="3947531">,</span>&nbsp;<span class="ident" id="3947533">singletonField</span><span class="op" id="3947547">,</span>&nbsp;<span class="ident" id="3947549">nil</span><span class="op" id="3947552">,</span>&nbsp;<span class="ident" id="3947554">ovfl</span><span class="op" id="3947558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947561">engine</span><span class="op" id="3947567">.</span><span class="ident" id="3947568">numInstr</span>&nbsp;<span class="op" id="3947577">=</span>&nbsp;<span class="num" id="3947579">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947582">return</span><br>
<span class="lineno">1030</span><span class="op" id="3947589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3947592">//&nbsp;compileIgnoreSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value&nbsp;that&nbsp;will&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="3947700">func</span>&nbsp;<span class="op" id="3947705">(</span><span class="ident" id="3947706">dec</span>&nbsp;<span class="op" id="3947710">*</span><span class="ident" id="3947711">Decoder</span><span class="op" id="3947718">)</span>&nbsp;<span class="ident" id="3947720">compileIgnoreSingle</span><span class="op" id="3947739">(</span><span class="ident" id="3947740">remoteId</span>&nbsp;<span class="ident" id="3947749">typeId</span><span class="op" id="3947755">)</span>&nbsp;<span class="op" id="3947757">(</span><span class="ident" id="3947758">engine</span>&nbsp;<span class="op" id="3947765">*</span><span class="ident" id="3947766">decEngine</span><span class="op" id="3947775">,</span>&nbsp;<span class="ident" id="3947777">err</span>&nbsp;<span class="builtintype" id="3947781">error</span><span class="op" id="3947786">)</span>&nbsp;<span class="op" id="3947788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947791">engine</span>&nbsp;<span class="op" id="3947798">=</span>&nbsp;<span class="builtinfunc" id="3947800">new</span><span class="op" id="3947803">(</span><span class="ident" id="3947804">decEngine</span><span class="op" id="3947813">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947816">engine</span><span class="op" id="3947822">.</span><span class="ident" id="3947823">instr</span>&nbsp;<span class="op" id="3947829">=</span>&nbsp;<span class="builtinfunc" id="3947831">make</span><span class="op" id="3947835">(</span><span class="op" id="3947836">[</span><span class="op" id="3947837">]</span><span class="ident" id="3947838">decInstr</span><span class="op" id="3947846">,</span>&nbsp;<span class="num" id="3947848">1</span><span class="op" id="3947849">)</span>&nbsp;<span class="comment" id="3947851">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947864">op</span>&nbsp;<span class="op" id="3947867">:=</span>&nbsp;<span class="ident" id="3947870">dec</span><span class="op" id="3947873">.</span><span class="ident" id="3947874">decIgnoreOpFor</span><span class="op" id="3947888">(</span><span class="ident" id="3947889">remoteId</span><span class="op" id="3947897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947900">ovfl</span>&nbsp;<span class="op" id="3947905">:=</span>&nbsp;<span class="ident" id="3947908">overflow</span><span class="op" id="3947916">(</span><span class="ident" id="3947917">dec</span><span class="op" id="3947920">.</span><span class="ident" id="3947921">typeString</span><span class="op" id="3947931">(</span><span class="ident" id="3947932">remoteId</span><span class="op" id="3947940">)</span><span class="op" id="3947941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947944">engine</span><span class="op" id="3947950">.</span><span class="ident" id="3947951">instr</span><span class="op" id="3947956">[</span><span class="num" id="3947957">0</span><span class="op" id="3947958">]</span>&nbsp;<span class="op" id="3947960">=</span>&nbsp;<span class="ident" id="3947962">decInstr</span><span class="op" id="3947970">{</span><span class="ident" id="3947971">op</span><span class="op" id="3947973">,</span>&nbsp;<span class="num" id="3947975">0</span><span class="op" id="3947976">,</span>&nbsp;<span class="ident" id="3947978">nil</span><span class="op" id="3947981">,</span>&nbsp;<span class="ident" id="3947983">ovfl</span><span class="op" id="3947987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947990">engine</span><span class="op" id="3947996">.</span><span class="ident" id="3947997">numInstr</span>&nbsp;<span class="op" id="3948006">=</span>&nbsp;<span class="num" id="3948008">1</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948011">return</span><br>
<span class="lineno"></span><span class="op" id="3948018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3948021">//&nbsp;compileDec&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;value.&nbsp;&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;a&nbsp;struct,</span><br>
<span class="lineno"></span><span class="comment" id="3948107">//&nbsp;it&nbsp;calls&nbsp;out&nbsp;to&nbsp;compileSingle.</span><br>
<span class="lineno">1045</span><span class="keyword" id="3948141">func</span>&nbsp;<span class="op" id="3948146">(</span><span class="ident" id="3948147">dec</span>&nbsp;<span class="op" id="3948151">*</span><span class="ident" id="3948152">Decoder</span><span class="op" id="3948159">)</span>&nbsp;<span class="ident" id="3948161">compileDec</span><span class="op" id="3948171">(</span><span class="ident" id="3948172">remoteId</span>&nbsp;<span class="ident" id="3948181">typeId</span><span class="op" id="3948187">,</span>&nbsp;<span class="ident" id="3948189">ut</span>&nbsp;<span class="op" id="3948192">*</span><span class="ident" id="3948193">userTypeInfo</span><span class="op" id="3948205">)</span>&nbsp;<span class="op" id="3948207">(</span><span class="ident" id="3948208">engine</span>&nbsp;<span class="op" id="3948215">*</span><span class="ident" id="3948216">decEngine</span><span class="op" id="3948225">,</span>&nbsp;<span class="ident" id="3948227">err</span>&nbsp;<span class="builtintype" id="3948231">error</span><span class="op" id="3948236">)</span>&nbsp;<span class="op" id="3948238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948241">rt</span>&nbsp;<span class="op" id="3948244">:=</span>&nbsp;<span class="ident" id="3948247">ut</span><span class="op" id="3948249">.</span><span class="ident" id="3948250">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948256">srt</span>&nbsp;<span class="op" id="3948260">:=</span>&nbsp;<span class="ident" id="3948263">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948267">if</span>&nbsp;<span class="ident" id="3948270">srt</span><span class="op" id="3948273">.</span><span class="ident" id="3948274">Kind</span><span class="op" id="3948278">(</span><span class="op" id="3948279">)</span>&nbsp;<span class="op" id="3948281">!=</span>&nbsp;<span class="ident" id="3948284">reflect</span><span class="op" id="3948291">.</span><span class="ident" id="3948292">Struct</span>&nbsp;<span class="op" id="3948299">||</span>&nbsp;<span class="ident" id="3948302">ut</span><span class="op" id="3948304">.</span><span class="ident" id="3948305">externalDec</span>&nbsp;<span class="op" id="3948317">!=</span>&nbsp;<span class="num" id="3948320">0</span>&nbsp;<span class="op" id="3948322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948326">return</span>&nbsp;<span class="ident" id="3948333">dec</span><span class="op" id="3948336">.</span><span class="ident" id="3948337">compileSingle</span><span class="op" id="3948350">(</span><span class="ident" id="3948351">remoteId</span><span class="op" id="3948359">,</span>&nbsp;<span class="ident" id="3948361">ut</span><span class="op" id="3948363">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3948366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948369">var</span>&nbsp;<span class="ident" id="3948373">wireStruct</span>&nbsp;<span class="op" id="3948384">*</span><span class="ident" id="3948385">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3948397">//&nbsp;Builtin&nbsp;types&nbsp;can&nbsp;come&nbsp;from&nbsp;global&nbsp;pool;&nbsp;the&nbsp;rest&nbsp;must&nbsp;be&nbsp;defined&nbsp;by&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3948483">//&nbsp;Also&nbsp;we&nbsp;know&nbsp;we&#39;re&nbsp;decoding&nbsp;a&nbsp;struct&nbsp;now,&nbsp;so&nbsp;the&nbsp;client&nbsp;must&nbsp;have&nbsp;sent&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948563">if</span>&nbsp;<span class="ident" id="3948566">t</span><span class="op" id="3948567">,</span>&nbsp;<span class="ident" id="3948569">ok</span>&nbsp;<span class="op" id="3948572">:=</span>&nbsp;<span class="ident" id="3948575">builtinIdToType</span><span class="op" id="3948590">[</span><span class="ident" id="3948591">remoteId</span><span class="op" id="3948599">]</span><span class="op" id="3948600">;</span>&nbsp;<span class="ident" id="3948602">ok</span>&nbsp;<span class="op" id="3948605">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948609">wireStruct</span><span class="op" id="3948619">,</span>&nbsp;<span class="ident" id="3948621">_</span>&nbsp;<span class="op" id="3948623">=</span>&nbsp;<span class="ident" id="3948625">t</span><span class="op" id="3948626">.</span><span class="op" id="3948627">(</span><span class="op" id="3948628">*</span><span class="ident" id="3948629">structType</span><span class="op" id="3948639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3948642">}</span>&nbsp;<span class="keyword" id="3948644">else</span>&nbsp;<span class="op" id="3948649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948653">wire</span>&nbsp;<span class="op" id="3948658">:=</span>&nbsp;<span class="ident" id="3948661">dec</span><span class="op" id="3948664">.</span><span class="ident" id="3948665">wireType</span><span class="op" id="3948673">[</span><span class="ident" id="3948674">remoteId</span><span class="op" id="3948682">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948686">if</span>&nbsp;<span class="ident" id="3948689">wire</span>&nbsp;<span class="op" id="3948694">==</span>&nbsp;<span class="ident" id="3948697">nil</span>&nbsp;<span class="op" id="3948701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948706">error_</span><span class="op" id="3948712">(</span><span class="ident" id="3948713">errBadType</span><span class="op" id="3948723">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3948727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948731">wireStruct</span>&nbsp;<span class="op" id="3948742">=</span>&nbsp;<span class="ident" id="3948744">wire</span><span class="op" id="3948748">.</span><span class="ident" id="3948749">StructT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3948758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948761">if</span>&nbsp;<span class="ident" id="3948764">wireStruct</span>&nbsp;<span class="op" id="3948775">==</span>&nbsp;<span class="ident" id="3948778">nil</span>&nbsp;<span class="op" id="3948782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948786">errorf</span><span class="op" id="3948792">(</span><span class="string" id="3948793">&#34;type&nbsp;mismatch&nbsp;in&nbsp;decoder:&nbsp;want&nbsp;struct&nbsp;type&nbsp;%s;&nbsp;got&nbsp;non-struct&#34;</span><span class="op" id="3948856">,</span>&nbsp;<span class="ident" id="3948858">rt</span><span class="op" id="3948860">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3948863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948866">engine</span>&nbsp;<span class="op" id="3948873">=</span>&nbsp;<span class="builtinfunc" id="3948875">new</span><span class="op" id="3948878">(</span><span class="ident" id="3948879">decEngine</span><span class="op" id="3948888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948891">engine</span><span class="op" id="3948897">.</span><span class="ident" id="3948898">instr</span>&nbsp;<span class="op" id="3948904">=</span>&nbsp;<span class="builtinfunc" id="3948906">make</span><span class="op" id="3948910">(</span><span class="op" id="3948911">[</span><span class="op" id="3948912">]</span><span class="ident" id="3948913">decInstr</span><span class="op" id="3948921">,</span>&nbsp;<span class="builtinfunc" id="3948923">len</span><span class="op" id="3948926">(</span><span class="ident" id="3948927">wireStruct</span><span class="op" id="3948937">.</span><span class="ident" id="3948938">Field</span><span class="op" id="3948943">)</span><span class="op" id="3948944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948947">seen</span>&nbsp;<span class="op" id="3948952">:=</span>&nbsp;<span class="builtinfunc" id="3948955">make</span><span class="op" id="3948959">(</span><span class="keyword" id="3948960">map</span><span class="op" id="3948963">[</span><span class="ident" id="3948964">reflect</span><span class="op" id="3948971">.</span><span class="ident" id="3948972">Type</span><span class="op" id="3948976">]</span><span class="op" id="3948977">*</span><span class="ident" id="3948978">decOp</span><span class="op" id="3948983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3948986">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;wire&nbsp;type.</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3949029">for</span>&nbsp;<span class="ident" id="3949033">fieldnum</span>&nbsp;<span class="op" id="3949042">:=</span>&nbsp;<span class="num" id="3949045">0</span><span class="op" id="3949046">;</span>&nbsp;<span class="ident" id="3949048">fieldnum</span>&nbsp;<span class="op" id="3949057">&lt;</span>&nbsp;<span class="builtinfunc" id="3949059">len</span><span class="op" id="3949062">(</span><span class="ident" id="3949063">wireStruct</span><span class="op" id="3949073">.</span><span class="ident" id="3949074">Field</span><span class="op" id="3949079">)</span><span class="op" id="3949080">;</span>&nbsp;<span class="ident" id="3949082">fieldnum</span><span class="op" id="3949090">++</span>&nbsp;<span class="op" id="3949093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3949097">wireField</span>&nbsp;<span class="op" id="3949107">:=</span>&nbsp;<span class="ident" id="3949110">wireStruct</span><span class="op" id="3949120">.</span><span class="ident" id="3949121">Field</span><span class="op" id="3949126">[</span><span class="ident" id="3949127">fieldnum</span><span class="op" id="3949135">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3949139">if</span>&nbsp;<span class="ident" id="3949142">wireField</span><span class="op" id="3949151">.</span><span class="ident" id="3949152">Name</span>&nbsp;<span class="op" id="3949157">==</span>&nbsp;<span class="string" id="3949160">&#34;&#34;</span>&nbsp;<span class="op" id="3949163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3949168">errorf</span><span class="op" id="3949174">(</span><span class="string" id="3949175">&#34;empty&nbsp;name&nbsp;for&nbsp;remote&nbsp;field&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="3949215">,</span>&nbsp;<span class="ident" id="3949217">wireStruct</span><span class="op" id="3949227">.</span><span class="ident" id="3949228">Name</span><span class="op" id="3949232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3949236">}</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3949240">ovfl</span>&nbsp;<span class="op" id="3949245">:=</span>&nbsp;<span class="ident" id="3949248">overflow</span><span class="op" id="3949256">(</span><span class="ident" id="3949257">wireField</span><span class="op" id="3949266">.</span><span class="ident" id="3949267">Name</span><span class="op" id="3949271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3949275">//&nbsp;Find&nbsp;the&nbsp;field&nbsp;of&nbsp;the&nbsp;local&nbsp;type&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3949333">localField</span><span class="op" id="3949343">,</span>&nbsp;<span class="ident" id="3949345">present</span>&nbsp;<span class="op" id="3949353">:=</span>&nbsp;<span class="ident" id="3949356">srt</span><span class="op" id="3949359">.</span><span class="ident" id="3949360">FieldByName</span><span class="op" id="3949371">(</span><span class="ident" id="3949372">wireField</span><span class="op" id="3949381">.</span><span class="ident" id="3949382">Name</span><span class="op" id="3949386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3949390">//&nbsp;TODO(r):&nbsp;anonymous&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3949420">if</span>&nbsp;<span class="op" id="3949423">!</span><span class="ident" id="3949424">present</span>&nbsp;<span class="op" id="3949432">||</span>&nbsp;<span class="op" id="3949435">!</span><span class="ident" id="3949436">isExported</span><span class="op" id="3949446">(</span><span class="ident" id="3949447">wireField</span><span class="op" id="3949456">.</span><span class="ident" id="3949457">Name</span><span class="op" id="3949461">)</span>&nbsp;<span class="op" id="3949463">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3949468">op</span>&nbsp;<span class="op" id="3949471">:=</span>&nbsp;<span class="ident" id="3949474">dec</span><span class="op" id="3949477">.</span><span class="ident" id="3949478">decIgnoreOpFor</span><span class="op" id="3949492">(</span><span class="ident" id="3949493">wireField</span><span class="op" id="3949502">.</span><span class="ident" id="3949503">Id</span><span class="op" id="3949505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3949510">engine</span><span class="op" id="3949516">.</span><span class="ident" id="3949517">instr</span><span class="op" id="3949522">[</span><span class="ident" id="3949523">fieldnum</span><span class="op" id="3949531">]</span>&nbsp;<span class="op" id="3949533">=</span>&nbsp;<span class="ident" id="3949535">decInstr</span><span class="op" id="3949543">{</span><span class="ident" id="3949544">op</span><span class="op" id="3949546">,</span>&nbsp;<span class="ident" id="3949548">fieldnum</span><span class="op" id="3949556">,</span>&nbsp;<span class="ident" id="3949558">nil</span><span class="op" id="3949561">,</span>&nbsp;<span class="ident" id="3949563">ovfl</span><span class="op" id="3949567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3949572">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3949583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3949587">if</span>&nbsp;<span class="op" id="3949590">!</span><span class="ident" id="3949591">dec</span><span class="op" id="3949594">.</span><span class="ident" id="3949595">compatibleType</span><span class="op" id="3949609">(</span><span class="ident" id="3949610">localField</span><span class="op" id="3949620">.</span><span class="ident" id="3949621">Type</span><span class="op" id="3949625">,</span>&nbsp;<span class="ident" id="3949627">wireField</span><span class="op" id="3949636">.</span><span class="ident" id="3949637">Id</span><span class="op" id="3949639">,</span>&nbsp;<span class="builtinfunc" id="3949641">make</span><span class="op" id="3949645">(</span><span class="keyword" id="3949646">map</span><span class="op" id="3949649">[</span><span class="ident" id="3949650">reflect</span><span class="op" id="3949657">.</span><span class="ident" id="3949658">Type</span><span class="op" id="3949662">]</span><span class="ident" id="3949663">typeId</span><span class="op" id="3949669">)</span><span class="op" id="3949670">)</span>&nbsp;<span class="op" id="3949672">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3949677">errorf</span><span class="op" id="3949683">(</span><span class="string" id="3949684">&#34;wrong&nbsp;type&nbsp;(%s)&nbsp;for&nbsp;received&nbsp;field&nbsp;%s.%s&#34;</span><span class="op" id="3949726">,</span>&nbsp;<span class="ident" id="3949728">localField</span><span class="op" id="3949738">.</span><span class="ident" id="3949739">Type</span><span class="op" id="3949743">,</span>&nbsp;<span class="ident" id="3949745">wireStruct</span><span class="op" id="3949755">.</span><span class="ident" id="3949756">Name</span><span class="op" id="3949760">,</span>&nbsp;<span class="ident" id="3949762">wireField</span><span class="op" id="3949771">.</span><span class="ident" id="3949772">Name</span><span class="op" id="3949776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3949780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3949784">op</span>&nbsp;<span class="op" id="3949787">:=</span>&nbsp;<span class="ident" id="3949790">dec</span><span class="op" id="3949793">.</span><span class="ident" id="3949794">decOpFor</span><span class="op" id="3949802">(</span><span class="ident" id="3949803">wireField</span><span class="op" id="3949812">.</span><span class="ident" id="3949813">Id</span><span class="op" id="3949815">,</span>&nbsp;<span class="ident" id="3949817">localField</span><span class="op" id="3949827">.</span><span class="ident" id="3949828">Type</span><span class="op" id="3949832">,</span>&nbsp;<span class="ident" id="3949834">localField</span><span class="op" id="3949844">.</span><span class="ident" id="3949845">Name</span><span class="op" id="3949849">,</span>&nbsp;<span class="ident" id="3949851">seen</span><span class="op" id="3949855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3949859">engine</span><span class="op" id="3949865">.</span><span class="ident" id="3949866">instr</span><span class="op" id="3949871">[</span><span class="ident" id="3949872">fieldnum</span><span class="op" id="3949880">]</span>&nbsp;<span class="op" id="3949882">=</span>&nbsp;<span class="ident" id="3949884">decInstr</span><span class="op" id="3949892">{</span><span class="op" id="3949893">*</span><span class="ident" id="3949894">op</span><span class="op" id="3949896">,</span>&nbsp;<span class="ident" id="3949898">fieldnum</span><span class="op" id="3949906">,</span>&nbsp;<span class="ident" id="3949908">localField</span><span class="op" id="3949918">.</span><span class="ident" id="3949919">Index</span><span class="op" id="3949924">,</span>&nbsp;<span class="ident" id="3949926">ovfl</span><span class="op" id="3949930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3949934">engine</span><span class="op" id="3949940">.</span><span class="ident" id="3949941">numInstr</span><span class="op" id="3949949">++</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3949953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3949956">return</span><br>
<span class="lineno"></span><span class="op" id="3949963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3949966">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type.</span><br>
<span class="lineno">1095</span><span class="keyword" id="3950028">func</span>&nbsp;<span class="op" id="3950033">(</span><span class="ident" id="3950034">dec</span>&nbsp;<span class="op" id="3950038">*</span><span class="ident" id="3950039">Decoder</span><span class="op" id="3950046">)</span>&nbsp;<span class="ident" id="3950048">getDecEnginePtr</span><span class="op" id="3950063">(</span><span class="ident" id="3950064">remoteId</span>&nbsp;<span class="ident" id="3950073">typeId</span><span class="op" id="3950079">,</span>&nbsp;<span class="ident" id="3950081">ut</span>&nbsp;<span class="op" id="3950084">*</span><span class="ident" id="3950085">userTypeInfo</span><span class="op" id="3950097">)</span>&nbsp;<span class="op" id="3950099">(</span><span class="ident" id="3950100">enginePtr</span>&nbsp;<span class="op" id="3950110">*</span><span class="op" id="3950111">*</span><span class="ident" id="3950112">decEngine</span><span class="op" id="3950121">,</span>&nbsp;<span class="ident" id="3950123">err</span>&nbsp;<span class="builtintype" id="3950127">error</span><span class="op" id="3950132">)</span>&nbsp;<span class="op" id="3950134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3950137">rt</span>&nbsp;<span class="op" id="3950140">:=</span>&nbsp;<span class="ident" id="3950143">ut</span><span class="op" id="3950145">.</span><span class="ident" id="3950146">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3950152">decoderMap</span><span class="op" id="3950162">,</span>&nbsp;<span class="ident" id="3950164">ok</span>&nbsp;<span class="op" id="3950167">:=</span>&nbsp;<span class="ident" id="3950170">dec</span><span class="op" id="3950173">.</span><span class="ident" id="3950174">decoderCache</span><span class="op" id="3950186">[</span><span class="ident" id="3950187">rt</span><span class="op" id="3950189">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3950192">if</span>&nbsp;<span class="op" id="3950195">!</span><span class="ident" id="3950196">ok</span>&nbsp;<span class="op" id="3950199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3950203">decoderMap</span>&nbsp;<span class="op" id="3950214">=</span>&nbsp;<span class="builtinfunc" id="3950216">make</span><span class="op" id="3950220">(</span><span class="keyword" id="3950221">map</span><span class="op" id="3950224">[</span><span class="ident" id="3950225">typeId</span><span class="op" id="3950231">]</span><span class="op" id="3950232">*</span><span class="op" id="3950233">*</span><span class="ident" id="3950234">decEngine</span><span class="op" id="3950243">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3950247">dec</span><span class="op" id="3950250">.</span><span class="ident" id="3950251">decoderCache</span><span class="op" id="3950263">[</span><span class="ident" id="3950264">rt</span><span class="op" id="3950266">]</span>&nbsp;<span class="op" id="3950268">=</span>&nbsp;<span class="ident" id="3950270">decoderMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3950282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3950285">if</span>&nbsp;<span class="ident" id="3950288">enginePtr</span><span class="op" id="3950297">,</span>&nbsp;<span class="ident" id="3950299">ok</span>&nbsp;<span class="op" id="3950302">=</span>&nbsp;<span class="ident" id="3950304">decoderMap</span><span class="op" id="3950314">[</span><span class="ident" id="3950315">remoteId</span><span class="op" id="3950323">]</span><span class="op" id="3950324">;</span>&nbsp;<span class="op" id="3950326">!</span><span class="ident" id="3950327">ok</span>&nbsp;<span class="op" id="3950330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3950334">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3950413">enginePtr</span>&nbsp;<span class="op" id="3950423">=</span>&nbsp;<span class="builtinfunc" id="3950425">new</span><span class="op" id="3950428">(</span><span class="op" id="3950429">*</span><span class="ident" id="3950430">decEngine</span><span class="op" id="3950439">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3950443">decoderMap</span><span class="op" id="3950453">[</span><span class="ident" id="3950454">remoteId</span><span class="op" id="3950462">]</span>&nbsp;<span class="op" id="3950464">=</span>&nbsp;<span class="ident" id="3950466">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3950478">*</span><span class="ident" id="3950479">enginePtr</span><span class="op" id="3950488">,</span>&nbsp;<span class="ident" id="3950490">err</span>&nbsp;<span class="op" id="3950494">=</span>&nbsp;<span class="ident" id="3950496">dec</span><span class="op" id="3950499">.</span><span class="ident" id="3950500">compileDec</span><span class="op" id="3950510">(</span><span class="ident" id="3950511">remoteId</span><span class="op" id="3950519">,</span>&nbsp;<span class="ident" id="3950521">ut</span><span class="op" id="3950523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3950527">if</span>&nbsp;<span class="ident" id="3950530">err</span>&nbsp;<span class="op" id="3950534">!=</span>&nbsp;<span class="ident" id="3950537">nil</span>&nbsp;<span class="op" id="3950541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3950546">delete</span><span class="op" id="3950552">(</span><span class="ident" id="3950553">decoderMap</span><span class="op" id="3950563">,</span>&nbsp;<span class="ident" id="3950565">remoteId</span><span class="op" id="3950573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3950577">}</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3950580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3950583">return</span><br>
<span class="lineno"></span><span class="op" id="3950590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3950593">//&nbsp;emptyStruct&nbsp;is&nbsp;the&nbsp;type&nbsp;we&nbsp;compile&nbsp;into&nbsp;when&nbsp;ignoring&nbsp;a&nbsp;struct&nbsp;value.</span><br>
<span class="lineno">1115</span><span class="keyword" id="3950666">type</span>&nbsp;<span class="ident" id="3950671">emptyStruct</span>&nbsp;<span class="keyword" id="3950683">struct</span><span class="op" id="3950689">{</span><span class="op" id="3950690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3950693">var</span>&nbsp;<span class="ident" id="3950697">emptyStructType</span>&nbsp;<span class="op" id="3950713">=</span>&nbsp;<span class="ident" id="3950715">reflect</span><span class="op" id="3950722">.</span><span class="ident" id="3950723">TypeOf</span><span class="op" id="3950729">(</span><span class="ident" id="3950730">emptyStruct</span><span class="op" id="3950741">{</span><span class="op" id="3950742">}</span><span class="op" id="3950743">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3950746">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type&nbsp;when&nbsp;the&nbsp;value&nbsp;is&nbsp;to&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno">1120</span><span class="keyword" id="3950842">func</span>&nbsp;<span class="op" id="3950847">(</span><span class="ident" id="3950848">dec</span>&nbsp;<span class="op" id="3950852">*</span><span class="ident" id="3950853">Decoder</span><span class="op" id="3950860">)</span>&nbsp;<span class="ident" id="3950862">getIgnoreEnginePtr</span><span class="op" id="3950880">(</span><span class="ident" id="3950881">wireId</span>&nbsp;<span class="ident" id="3950888">typeId</span><span class="op" id="3950894">)</span>&nbsp;<span class="op" id="3950896">(</span><span class="ident" id="3950897">enginePtr</span>&nbsp;<span class="op" id="3950907">*</span><span class="op" id="3950908">*</span><span class="ident" id="3950909">decEngine</span><span class="op" id="3950918">,</span>&nbsp;<span class="ident" id="3950920">err</span>&nbsp;<span class="builtintype" id="3950924">error</span><span class="op" id="3950929">)</span>&nbsp;<span class="op" id="3950931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3950934">var</span>&nbsp;<span class="ident" id="3950938">ok</span>&nbsp;<span class="builtintype" id="3950941">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3950947">if</span>&nbsp;<span class="ident" id="3950950">enginePtr</span><span class="op" id="3950959">,</span>&nbsp;<span class="ident" id="3950961">ok</span>&nbsp;<span class="op" id="3950964">=</span>&nbsp;<span class="ident" id="3950966">dec</span><span class="op" id="3950969">.</span><span class="ident" id="3950970">ignorerCache</span><span class="op" id="3950982">[</span><span class="ident" id="3950983">wireId</span><span class="op" id="3950989">]</span><span class="op" id="3950990">;</span>&nbsp;<span class="op" id="3950992">!</span><span class="ident" id="3950993">ok</span>&nbsp;<span class="op" id="3950996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3951000">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3951079">enginePtr</span>&nbsp;<span class="op" id="3951089">=</span>&nbsp;<span class="builtinfunc" id="3951091">new</span><span class="op" id="3951094">(</span><span class="op" id="3951095">*</span><span class="ident" id="3951096">decEngine</span><span class="op" id="3951105">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3951109">dec</span><span class="op" id="3951112">.</span><span class="ident" id="3951113">ignorerCache</span><span class="op" id="3951125">[</span><span class="ident" id="3951126">wireId</span><span class="op" id="3951132">]</span>&nbsp;<span class="op" id="3951134">=</span>&nbsp;<span class="ident" id="3951136">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3951148">wire</span>&nbsp;<span class="op" id="3951153">:=</span>&nbsp;<span class="ident" id="3951156">dec</span><span class="op" id="3951159">.</span><span class="ident" id="3951160">wireType</span><span class="op" id="3951168">[</span><span class="ident" id="3951169">wireId</span><span class="op" id="3951175">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3951179">if</span>&nbsp;<span class="ident" id="3951182">wire</span>&nbsp;<span class="op" id="3951187">!=</span>&nbsp;<span class="ident" id="3951190">nil</span>&nbsp;<span class="op" id="3951194">&amp;&amp;</span>&nbsp;<span class="ident" id="3951197">wire</span><span class="op" id="3951201">.</span><span class="ident" id="3951202">StructT</span>&nbsp;<span class="op" id="3951210">!=</span>&nbsp;<span class="ident" id="3951213">nil</span>&nbsp;<span class="op" id="3951217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3951222">*</span><span class="ident" id="3951223">enginePtr</span><span class="op" id="3951232">,</span>&nbsp;<span class="ident" id="3951234">err</span>&nbsp;<span class="op" id="3951238">=</span>&nbsp;<span class="ident" id="3951240">dec</span><span class="op" id="3951243">.</span><span class="ident" id="3951244">compileDec</span><span class="op" id="3951254">(</span><span class="ident" id="3951255">wireId</span><span class="op" id="3951261">,</span>&nbsp;<span class="ident" id="3951263">userType</span><span class="op" id="3951271">(</span><span class="ident" id="3951272">emptyStructType</span><span class="op" id="3951287">)</span><span class="op" id="3951288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3951292">}</span>&nbsp;<span class="keyword" id="3951294">else</span>&nbsp;<span class="op" id="3951299">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3951304">*</span><span class="ident" id="3951305">enginePtr</span><span class="op" id="3951314">,</span>&nbsp;<span class="ident" id="3951316">err</span>&nbsp;<span class="op" id="3951320">=</span>&nbsp;<span class="ident" id="3951322">dec</span><span class="op" id="3951325">.</span><span class="ident" id="3951326">compileIgnoreSingle</span><span class="op" id="3951345">(</span><span class="ident" id="3951346">wireId</span><span class="op" id="3951352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3951356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3951360">if</span>&nbsp;<span class="ident" id="3951363">err</span>&nbsp;<span class="op" id="3951367">!=</span>&nbsp;<span class="ident" id="3951370">nil</span>&nbsp;<span class="op" id="3951374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3951379">delete</span><span class="op" id="3951385">(</span><span class="ident" id="3951386">dec</span><span class="op" id="3951389">.</span><span class="ident" id="3951390">ignorerCache</span><span class="op" id="3951402">,</span>&nbsp;<span class="ident" id="3951404">wireId</span><span class="op" id="3951410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3951414">}</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3951417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3951420">return</span><br>
<span class="lineno"></span><span class="op" id="3951427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3951430">//&nbsp;decodeValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">1140</span><span class="keyword" id="3951514">func</span>&nbsp;<span class="op" id="3951519">(</span><span class="ident" id="3951520">dec</span>&nbsp;<span class="op" id="3951524">*</span><span class="ident" id="3951525">Decoder</span><span class="op" id="3951532">)</span>&nbsp;<span class="ident" id="3951534">decodeValue</span><span class="op" id="3951545">(</span><span class="ident" id="3951546">wireId</span>&nbsp;<span class="ident" id="3951553">typeId</span><span class="op" id="3951559">,</span>&nbsp;<span class="ident" id="3951561">value</span>&nbsp;<span class="ident" id="3951567">reflect</span><span class="op" id="3951574">.</span><span class="ident" id="3951575">Value</span><span class="op" id="3951580">)</span>&nbsp;<span class="op" id="3951582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3951585">defer</span>&nbsp;<span class="ident" id="3951591">catchError</span><span class="op" id="3951601">(</span><span class="op" id="3951602">&amp;</span><span class="ident" id="3951603">dec</span><span class="op" id="3951606">.</span><span class="ident" id="3951607">err</span><span class="op" id="3951610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3951613">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;nil,&nbsp;it&nbsp;means&nbsp;we&nbsp;should&nbsp;just&nbsp;ignore&nbsp;this&nbsp;item.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3951680">if</span>&nbsp;<span class="op" id="3951683">!</span><span class="ident" id="3951684">value</span><span class="op" id="3951689">.</span><span class="ident" id="3951690">IsValid</span><span class="op" id="3951697">(</span><span class="op" id="3951698">)</span>&nbsp;<span class="op" id="3951700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3951704">dec</span><span class="op" id="3951707">.</span><span class="ident" id="3951708">decodeIgnoredValue</span><span class="op" id="3951726">(</span><span class="ident" id="3951727">wireId</span><span class="op" id="3951733">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3951737">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3951745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3951748">//&nbsp;Dereference&nbsp;down&nbsp;to&nbsp;the&nbsp;underlying&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3951793">ut</span>&nbsp;<span class="op" id="3951796">:=</span>&nbsp;<span class="ident" id="3951799">userType</span><span class="op" id="3951807">(</span><span class="ident" id="3951808">value</span><span class="op" id="3951813">.</span><span class="ident" id="3951814">Type</span><span class="op" id="3951818">(</span><span class="op" id="3951819">)</span><span class="op" id="3951820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3951823">base</span>&nbsp;<span class="op" id="3951828">:=</span>&nbsp;<span class="ident" id="3951831">ut</span><span class="op" id="3951833">.</span><span class="ident" id="3951834">base</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3951840">var</span>&nbsp;<span class="ident" id="3951844">enginePtr</span>&nbsp;<span class="op" id="3951854">*</span><span class="op" id="3951855">*</span><span class="ident" id="3951856">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3951867">enginePtr</span><span class="op" id="3951876">,</span>&nbsp;<span class="ident" id="3951878">dec</span><span class="op" id="3951881">.</span><span class="ident" id="3951882">err</span>&nbsp;<span class="op" id="3951886">=</span>&nbsp;<span class="ident" id="3951888">dec</span><span class="op" id="3951891">.</span><span class="ident" id="3951892">getDecEnginePtr</span><span class="op" id="3951907">(</span><span class="ident" id="3951908">wireId</span><span class="op" id="3951914">,</span>&nbsp;<span class="ident" id="3951916">ut</span><span class="op" id="3951918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3951921">if</span>&nbsp;<span class="ident" id="3951924">dec</span><span class="op" id="3951927">.</span><span class="ident" id="3951928">err</span>&nbsp;<span class="op" id="3951932">!=</span>&nbsp;<span class="ident" id="3951935">nil</span>&nbsp;<span class="op" id="3951939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3951943">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3951951">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3951954">value</span>&nbsp;<span class="op" id="3951960">=</span>&nbsp;<span class="ident" id="3951962">decAlloc</span><span class="op" id="3951970">(</span><span class="ident" id="3951971">value</span><span class="op" id="3951976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3951979">engine</span>&nbsp;<span class="op" id="3951986">:=</span>&nbsp;<span class="op" id="3951989">*</span><span class="ident" id="3951990">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3952001">if</span>&nbsp;<span class="ident" id="3952004">st</span>&nbsp;<span class="op" id="3952007">:=</span>&nbsp;<span class="ident" id="3952010">base</span><span class="op" id="3952014">;</span>&nbsp;<span class="ident" id="3952016">st</span><span class="op" id="3952018">.</span><span class="ident" id="3952019">Kind</span><span class="op" id="3952023">(</span><span class="op" id="3952024">)</span>&nbsp;<span class="op" id="3952026">==</span>&nbsp;<span class="ident" id="3952029">reflect</span><span class="op" id="3952036">.</span><span class="ident" id="3952037">Struct</span>&nbsp;<span class="op" id="3952044">&amp;&amp;</span>&nbsp;<span class="ident" id="3952047">ut</span><span class="op" id="3952049">.</span><span class="ident" id="3952050">externalDec</span>&nbsp;<span class="op" id="3952062">==</span>&nbsp;<span class="num" id="3952065">0</span>&nbsp;<span class="op" id="3952067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3952071">if</span>&nbsp;<span class="ident" id="3952074">engine</span><span class="op" id="3952080">.</span><span class="ident" id="3952081">numInstr</span>&nbsp;<span class="op" id="3952090">==</span>&nbsp;<span class="num" id="3952093">0</span>&nbsp;<span class="op" id="3952095">&amp;&amp;</span>&nbsp;<span class="ident" id="3952098">st</span><span class="op" id="3952100">.</span><span class="ident" id="3952101">NumField</span><span class="op" id="3952109">(</span><span class="op" id="3952110">)</span>&nbsp;<span class="op" id="3952112">&gt;</span>&nbsp;<span class="num" id="3952114">0</span>&nbsp;<span class="op" id="3952116">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3952122">dec</span><span class="op" id="3952125">.</span><span class="ident" id="3952126">wireType</span><span class="op" id="3952134">[</span><span class="ident" id="3952135">wireId</span><span class="op" id="3952141">]</span>&nbsp;<span class="op" id="3952143">!=</span>&nbsp;<span class="ident" id="3952146">nil</span>&nbsp;<span class="op" id="3952150">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3952153">len</span><span class="op" id="3952156">(</span><span class="ident" id="3952157">dec</span><span class="op" id="3952160">.</span><span class="ident" id="3952161">wireType</span><span class="op" id="3952169">[</span><span class="ident" id="3952170">wireId</span><span class="op" id="3952176">]</span><span class="op" id="3952177">.</span><span class="ident" id="3952178">StructT</span><span class="op" id="3952185">.</span><span class="ident" id="3952186">Field</span><span class="op" id="3952191">)</span>&nbsp;<span class="op" id="3952193">&gt;</span>&nbsp;<span class="num" id="3952195">0</span>&nbsp;<span class="op" id="3952197">{</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3952202">name</span>&nbsp;<span class="op" id="3952207">:=</span>&nbsp;<span class="ident" id="3952210">base</span><span class="op" id="3952214">.</span><span class="ident" id="3952215">Name</span><span class="op" id="3952219">(</span><span class="op" id="3952220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3952225">errorf</span><span class="op" id="3952231">(</span><span class="string" id="3952232">&#34;type&nbsp;mismatch:&nbsp;no&nbsp;fields&nbsp;matched&nbsp;compiling&nbsp;decoder&nbsp;for&nbsp;%s&#34;</span><span class="op" id="3952291">,</span>&nbsp;<span class="ident" id="3952293">name</span><span class="op" id="3952297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3952301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3952305">dec</span><span class="op" id="3952308">.</span><span class="ident" id="3952309">decodeStruct</span><span class="op" id="3952321">(</span><span class="ident" id="3952322">engine</span><span class="op" id="3952328">,</span>&nbsp;<span class="ident" id="3952330">ut</span><span class="op" id="3952332">,</span>&nbsp;<span class="ident" id="3952334">value</span><span class="op" id="3952339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3952342">}</span>&nbsp;<span class="keyword" id="3952344">else</span>&nbsp;<span class="op" id="3952349">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3952353">dec</span><span class="op" id="3952356">.</span><span class="ident" id="3952357">decodeSingle</span><span class="op" id="3952369">(</span><span class="ident" id="3952370">engine</span><span class="op" id="3952376">,</span>&nbsp;<span class="ident" id="3952378">ut</span><span class="op" id="3952380">,</span>&nbsp;<span class="ident" id="3952382">value</span><span class="op" id="3952387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3952390">}</span><br>
<span class="lineno"></span><span class="op" id="3952392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3952395">//&nbsp;decodeIgnoredValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;and&nbsp;discards&nbsp;it.</span><br>
<span class="lineno">1170</span><span class="keyword" id="3952501">func</span>&nbsp;<span class="op" id="3952506">(</span><span class="ident" id="3952507">dec</span>&nbsp;<span class="op" id="3952511">*</span><span class="ident" id="3952512">Decoder</span><span class="op" id="3952519">)</span>&nbsp;<span class="ident" id="3952521">decodeIgnoredValue</span><span class="op" id="3952539">(</span><span class="ident" id="3952540">wireId</span>&nbsp;<span class="ident" id="3952547">typeId</span><span class="op" id="3952553">)</span>&nbsp;<span class="op" id="3952555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3952558">var</span>&nbsp;<span class="ident" id="3952562">enginePtr</span>&nbsp;<span class="op" id="3952572">*</span><span class="op" id="3952573">*</span><span class="ident" id="3952574">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3952585">enginePtr</span><span class="op" id="3952594">,</span>&nbsp;<span class="ident" id="3952596">dec</span><span class="op" id="3952599">.</span><span class="ident" id="3952600">err</span>&nbsp;<span class="op" id="3952604">=</span>&nbsp;<span class="ident" id="3952606">dec</span><span class="op" id="3952609">.</span><span class="ident" id="3952610">getIgnoreEnginePtr</span><span class="op" id="3952628">(</span><span class="ident" id="3952629">wireId</span><span class="op" id="3952635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3952638">if</span>&nbsp;<span class="ident" id="3952641">dec</span><span class="op" id="3952644">.</span><span class="ident" id="3952645">err</span>&nbsp;<span class="op" id="3952649">!=</span>&nbsp;<span class="ident" id="3952652">nil</span>&nbsp;<span class="op" id="3952656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3952660">return</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3952668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3952671">wire</span>&nbsp;<span class="op" id="3952676">:=</span>&nbsp;<span class="ident" id="3952679">dec</span><span class="op" id="3952682">.</span><span class="ident" id="3952683">wireType</span><span class="op" id="3952691">[</span><span class="ident" id="3952692">wireId</span><span class="op" id="3952698">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3952701">if</span>&nbsp;<span class="ident" id="3952704">wire</span>&nbsp;<span class="op" id="3952709">!=</span>&nbsp;<span class="ident" id="3952712">nil</span>&nbsp;<span class="op" id="3952716">&amp;&amp;</span>&nbsp;<span class="ident" id="3952719">wire</span><span class="op" id="3952723">.</span><span class="ident" id="3952724">StructT</span>&nbsp;<span class="op" id="3952732">!=</span>&nbsp;<span class="ident" id="3952735">nil</span>&nbsp;<span class="op" id="3952739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3952743">dec</span><span class="op" id="3952746">.</span><span class="ident" id="3952747">ignoreStruct</span><span class="op" id="3952759">(</span><span class="op" id="3952760">*</span><span class="ident" id="3952761">enginePtr</span><span class="op" id="3952770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3952773">}</span>&nbsp;<span class="keyword" id="3952775">else</span>&nbsp;<span class="op" id="3952780">{</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3952784">dec</span><span class="op" id="3952787">.</span><span class="ident" id="3952788">ignoreSingle</span><span class="op" id="3952800">(</span><span class="op" id="3952801">*</span><span class="ident" id="3952802">enginePtr</span><span class="op" id="3952811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3952814">}</span><br>
<span class="lineno"></span><span class="op" id="3952816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3952819">func</span>&nbsp;<span class="ident" id="3952824">init</span><span class="op" id="3952828">(</span><span class="op" id="3952829">)</span>&nbsp;<span class="op" id="3952831">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3952834">var</span>&nbsp;<span class="ident" id="3952838">iop</span><span class="op" id="3952841">,</span>&nbsp;<span class="ident" id="3952843">uop</span>&nbsp;<span class="ident" id="3952847">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3952854">switch</span>&nbsp;<span class="ident" id="3952861">reflect</span><span class="op" id="3952868">.</span><span class="ident" id="3952869">TypeOf</span><span class="op" id="3952875">(</span><span class="builtintype" id="3952876">int</span><span class="op" id="3952879">(</span><span class="num" id="3952880">0</span><span class="op" id="3952881">)</span><span class="op" id="3952882">)</span><span class="op" id="3952883">.</span><span class="ident" id="3952884">Bits</span><span class="op" id="3952888">(</span><span class="op" id="3952889">)</span>&nbsp;<span class="op" id="3952891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3952894">case</span>&nbsp;<span class="num" id="3952899">32</span><span class="op" id="3952901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3952905">iop</span>&nbsp;<span class="op" id="3952909">=</span>&nbsp;<span class="ident" id="3952911">decInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3952922">uop</span>&nbsp;<span class="op" id="3952926">=</span>&nbsp;<span class="ident" id="3952928">decUint32</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3952939">case</span>&nbsp;<span class="num" id="3952944">64</span><span class="op" id="3952946">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3952950">iop</span>&nbsp;<span class="op" id="3952954">=</span>&nbsp;<span class="ident" id="3952956">decInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3952967">uop</span>&nbsp;<span class="op" id="3952971">=</span>&nbsp;<span class="ident" id="3952973">decUint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3952984">default</span><span class="op" id="3952991">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3952995">panic</span><span class="op" id="3953000">(</span><span class="string" id="3953001">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;int/uint&#34;</span><span class="op" id="3953032">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3953035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3953038">decOpTable</span><span class="op" id="3953048">[</span><span class="ident" id="3953049">reflect</span><span class="op" id="3953056">.</span><span class="ident" id="3953057">Int</span><span class="op" id="3953060">]</span>&nbsp;<span class="op" id="3953062">=</span>&nbsp;<span class="ident" id="3953064">iop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3953069">decOpTable</span><span class="op" id="3953079">[</span><span class="ident" id="3953080">reflect</span><span class="op" id="3953087">.</span><span class="ident" id="3953088">Uint</span><span class="op" id="3953092">]</span>&nbsp;<span class="op" id="3953094">=</span>&nbsp;<span class="ident" id="3953096">uop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3953102">//&nbsp;Finally&nbsp;uintptr</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3953122">switch</span>&nbsp;<span class="ident" id="3953129">reflect</span><span class="op" id="3953136">.</span><span class="ident" id="3953137">TypeOf</span><span class="op" id="3953143">(</span><span class="builtintype" id="3953144">uintptr</span><span class="op" id="3953151">(</span><span class="num" id="3953152">0</span><span class="op" id="3953153">)</span><span class="op" id="3953154">)</span><span class="op" id="3953155">.</span><span class="ident" id="3953156">Bits</span><span class="op" id="3953160">(</span><span class="op" id="3953161">)</span>&nbsp;<span class="op" id="3953163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3953166">case</span>&nbsp;<span class="num" id="3953171">32</span><span class="op" id="3953173">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3953177">uop</span>&nbsp;<span class="op" id="3953181">=</span>&nbsp;<span class="ident" id="3953183">decUint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3953194">case</span>&nbsp;<span class="num" id="3953199">64</span><span class="op" id="3953201">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3953205">uop</span>&nbsp;<span class="op" id="3953209">=</span>&nbsp;<span class="ident" id="3953211">decUint64</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3953222">default</span><span class="op" id="3953229">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3953233">panic</span><span class="op" id="3953238">(</span><span class="string" id="3953239">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;uintptr&#34;</span><span class="op" id="3953269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3953272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3953275">decOpTable</span><span class="op" id="3953285">[</span><span class="ident" id="3953286">reflect</span><span class="op" id="3953293">.</span><span class="ident" id="3953294">Uintptr</span><span class="op" id="3953301">]</span>&nbsp;<span class="op" id="3953303">=</span>&nbsp;<span class="ident" id="3953305">uop</span><br>
<span class="lineno"></span><span class="op" id="3953309">}</span><br>
<span class="lineno">1210</span><br>
<span class="lineno"></span><span class="comment" id="3953312">//&nbsp;Gob&nbsp;depends&nbsp;on&nbsp;being&nbsp;able&nbsp;to&nbsp;take&nbsp;the&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3953361">//&nbsp;of&nbsp;zeroed&nbsp;Values&nbsp;it&nbsp;creates,&nbsp;so&nbsp;use&nbsp;this&nbsp;wrapper&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="3953421">//&nbsp;of&nbsp;the&nbsp;standard&nbsp;reflect.Zero.</span><br>
<span class="lineno"></span><span class="comment" id="3953454">//&nbsp;Each&nbsp;call&nbsp;allocates&nbsp;once.</span><br>
<span class="lineno">1215</span><span class="keyword" id="3953483">func</span>&nbsp;<span class="ident" id="3953488">allocValue</span><span class="op" id="3953498">(</span><span class="ident" id="3953499">t</span>&nbsp;<span class="ident" id="3953501">reflect</span><span class="op" id="3953508">.</span><span class="ident" id="3953509">Type</span><span class="op" id="3953513">)</span>&nbsp;<span class="ident" id="3953515">reflect</span><span class="op" id="3953522">.</span><span class="ident" id="3953523">Value</span>&nbsp;<span class="op" id="3953529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3953532">return</span>&nbsp;<span class="ident" id="3953539">reflect</span><span class="op" id="3953546">.</span><span class="ident" id="3953547">New</span><span class="op" id="3953550">(</span><span class="ident" id="3953551">t</span><span class="op" id="3953552">)</span><span class="op" id="3953553">.</span><span class="ident" id="3953554">Elem</span><span class="op" id="3953558">(</span><span class="op" id="3953559">)</span><br>
<span class="lineno"></span><span class="op" id="3953561">}</span>
</div>
</body>
</html>
