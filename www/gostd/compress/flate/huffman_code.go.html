<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3004932">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3004987">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3005041">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3005092">package</span>&nbsp;<span class="ident" id="3005100">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3005107">import</span>&nbsp;<span class="op" id="3005114">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3005117">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3005125">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3005132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3005135">type</span>&nbsp;<span class="ident" id="3005140">huffmanEncoder</span>&nbsp;<span class="keyword" id="3005155">struct</span>&nbsp;<span class="op" id="3005162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005165">codeBits</span>&nbsp;<span class="op" id="3005174">[</span><span class="op" id="3005175">]</span><span class="builtintype" id="3005176">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005183">code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3005192">[</span><span class="op" id="3005193">]</span><span class="builtintype" id="3005194">uint16</span><br>
<span class="lineno">15</span><span class="op" id="3005201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3005204">type</span>&nbsp;<span class="ident" id="3005209">literalNode</span>&nbsp;<span class="keyword" id="3005221">struct</span>&nbsp;<span class="op" id="3005228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005231">literal</span>&nbsp;<span class="builtintype" id="3005239">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005247">freq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3005255">int32</span><br>
<span class="lineno">20</span><span class="op" id="3005261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3005264">//&nbsp;A&nbsp;levelInfo&nbsp;describes&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;constructed&nbsp;tree&nbsp;for&nbsp;a&nbsp;given&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="3005342">type</span>&nbsp;<span class="ident" id="3005347">levelInfo</span>&nbsp;<span class="keyword" id="3005357">struct</span>&nbsp;<span class="op" id="3005364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3005367">//&nbsp;Our&nbsp;level.&nbsp;&nbsp;for&nbsp;better&nbsp;printing</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005403">level</span>&nbsp;<span class="builtintype" id="3005409">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3005417">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;last&nbsp;node&nbsp;at&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005466">lastFreq</span>&nbsp;<span class="builtintype" id="3005475">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3005483">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;character&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005544">nextCharFreq</span>&nbsp;<span class="builtintype" id="3005557">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3005565">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;pair&nbsp;(from&nbsp;level&nbsp;below)&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3005641">//&nbsp;Only&nbsp;valid&nbsp;if&nbsp;the&nbsp;&#34;needed&#34;&nbsp;value&nbsp;of&nbsp;the&nbsp;next&nbsp;lower&nbsp;level&nbsp;is&nbsp;0.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005708">nextPairFreq</span>&nbsp;<span class="builtintype" id="3005721">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3005729">//&nbsp;The&nbsp;number&nbsp;of&nbsp;chains&nbsp;remaining&nbsp;to&nbsp;generate&nbsp;for&nbsp;this&nbsp;level&nbsp;before&nbsp;moving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3005805">//&nbsp;up&nbsp;to&nbsp;the&nbsp;next&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3005830">needed</span>&nbsp;<span class="builtintype" id="3005837">int32</span><br>
<span class="lineno">40</span><span class="op" id="3005843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3005846">func</span>&nbsp;<span class="ident" id="3005851">maxNode</span><span class="op" id="3005858">(</span><span class="op" id="3005859">)</span>&nbsp;<span class="ident" id="3005861">literalNode</span>&nbsp;<span class="op" id="3005873">{</span>&nbsp;<span class="keyword" id="3005875">return</span>&nbsp;<span class="ident" id="3005882">literalNode</span><span class="op" id="3005893">{</span><span class="ident" id="3005894">math</span><span class="op" id="3005898">.</span><span class="ident" id="3005899">MaxUint16</span><span class="op" id="3005908">,</span>&nbsp;<span class="ident" id="3005910">math</span><span class="op" id="3005914">.</span><span class="ident" id="3005915">MaxInt32</span><span class="op" id="3005923">}</span>&nbsp;<span class="op" id="3005925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3005928">func</span>&nbsp;<span class="ident" id="3005933">newHuffmanEncoder</span><span class="op" id="3005950">(</span><span class="ident" id="3005951">size</span>&nbsp;<span class="builtintype" id="3005956">int</span><span class="op" id="3005959">)</span>&nbsp;<span class="op" id="3005961">*</span><span class="ident" id="3005962">huffmanEncoder</span>&nbsp;<span class="op" id="3005977">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3005980">return</span>&nbsp;<span class="op" id="3005987">&amp;</span><span class="ident" id="3005988">huffmanEncoder</span><span class="op" id="3006002">{</span><span class="builtinfunc" id="3006003">make</span><span class="op" id="3006007">(</span><span class="op" id="3006008">[</span><span class="op" id="3006009">]</span><span class="builtintype" id="3006010">uint8</span><span class="op" id="3006015">,</span>&nbsp;<span class="ident" id="3006017">size</span><span class="op" id="3006021">)</span><span class="op" id="3006022">,</span>&nbsp;<span class="builtinfunc" id="3006024">make</span><span class="op" id="3006028">(</span><span class="op" id="3006029">[</span><span class="op" id="3006030">]</span><span class="builtintype" id="3006031">uint16</span><span class="op" id="3006037">,</span>&nbsp;<span class="ident" id="3006039">size</span><span class="op" id="3006043">)</span><span class="op" id="3006044">}</span><br>
<span class="lineno"></span><span class="op" id="3006046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3006049">//&nbsp;Generates&nbsp;a&nbsp;HuffmanCode&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;fixed&nbsp;literal&nbsp;table</span><br>
<span class="lineno"></span><span class="keyword" id="3006117">func</span>&nbsp;<span class="ident" id="3006122">generateFixedLiteralEncoding</span><span class="op" id="3006150">(</span><span class="op" id="3006151">)</span>&nbsp;<span class="op" id="3006153">*</span><span class="ident" id="3006154">huffmanEncoder</span>&nbsp;<span class="op" id="3006169">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006172">h</span>&nbsp;<span class="op" id="3006174">:=</span>&nbsp;<span class="ident" id="3006177">newHuffmanEncoder</span><span class="op" id="3006194">(</span><span class="ident" id="3006195">maxLit</span><span class="op" id="3006201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006204">codeBits</span>&nbsp;<span class="op" id="3006213">:=</span>&nbsp;<span class="ident" id="3006216">h</span><span class="op" id="3006217">.</span><span class="ident" id="3006218">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006228">code</span>&nbsp;<span class="op" id="3006233">:=</span>&nbsp;<span class="ident" id="3006236">h</span><span class="op" id="3006237">.</span><span class="ident" id="3006238">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006244">var</span>&nbsp;<span class="ident" id="3006248">ch</span>&nbsp;<span class="builtintype" id="3006251">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006259">for</span>&nbsp;<span class="ident" id="3006263">ch</span>&nbsp;<span class="op" id="3006266">=</span>&nbsp;<span class="num" id="3006268">0</span><span class="op" id="3006269">;</span>&nbsp;<span class="ident" id="3006271">ch</span>&nbsp;<span class="op" id="3006274">&lt;</span>&nbsp;<span class="ident" id="3006276">maxLit</span><span class="op" id="3006282">;</span>&nbsp;<span class="ident" id="3006284">ch</span><span class="op" id="3006286">++</span>&nbsp;<span class="op" id="3006289">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006293">var</span>&nbsp;<span class="ident" id="3006297">bits</span>&nbsp;<span class="builtintype" id="3006302">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006311">var</span>&nbsp;<span class="ident" id="3006315">size</span>&nbsp;<span class="builtintype" id="3006320">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006328">switch</span>&nbsp;<span class="op" id="3006335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006339">case</span>&nbsp;<span class="ident" id="3006344">ch</span>&nbsp;<span class="op" id="3006347">&lt;</span>&nbsp;<span class="num" id="3006349">144</span><span class="op" id="3006352">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3006357">//&nbsp;size&nbsp;8,&nbsp;000110000&nbsp;&nbsp;..&nbsp;10111111</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006394">bits</span>&nbsp;<span class="op" id="3006399">=</span>&nbsp;<span class="ident" id="3006401">ch</span>&nbsp;<span class="op" id="3006404">+</span>&nbsp;<span class="num" id="3006406">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006412">size</span>&nbsp;<span class="op" id="3006417">=</span>&nbsp;<span class="num" id="3006419">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006424">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006432">case</span>&nbsp;<span class="ident" id="3006437">ch</span>&nbsp;<span class="op" id="3006440">&lt;</span>&nbsp;<span class="num" id="3006442">256</span><span class="op" id="3006445">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3006450">//&nbsp;size&nbsp;9,&nbsp;110010000&nbsp;..&nbsp;111111111</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006487">bits</span>&nbsp;<span class="op" id="3006492">=</span>&nbsp;<span class="ident" id="3006494">ch</span>&nbsp;<span class="op" id="3006497">+</span>&nbsp;<span class="num" id="3006499">400</span>&nbsp;<span class="op" id="3006503">-</span>&nbsp;<span class="num" id="3006505">144</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006512">size</span>&nbsp;<span class="op" id="3006517">=</span>&nbsp;<span class="num" id="3006519">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006524">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006532">case</span>&nbsp;<span class="ident" id="3006537">ch</span>&nbsp;<span class="op" id="3006540">&lt;</span>&nbsp;<span class="num" id="3006542">280</span><span class="op" id="3006545">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3006550">//&nbsp;size&nbsp;7,&nbsp;0000000&nbsp;..&nbsp;0010111</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006583">bits</span>&nbsp;<span class="op" id="3006588">=</span>&nbsp;<span class="ident" id="3006590">ch</span>&nbsp;<span class="op" id="3006593">-</span>&nbsp;<span class="num" id="3006595">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006602">size</span>&nbsp;<span class="op" id="3006607">=</span>&nbsp;<span class="num" id="3006609">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006614">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006622">default</span><span class="op" id="3006629">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3006634">//&nbsp;size&nbsp;8,&nbsp;11000000&nbsp;..&nbsp;11000111</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006669">bits</span>&nbsp;<span class="op" id="3006674">=</span>&nbsp;<span class="ident" id="3006676">ch</span>&nbsp;<span class="op" id="3006679">+</span>&nbsp;<span class="num" id="3006681">192</span>&nbsp;<span class="op" id="3006685">-</span>&nbsp;<span class="num" id="3006687">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006694">size</span>&nbsp;<span class="op" id="3006699">=</span>&nbsp;<span class="num" id="3006701">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3006705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006709">codeBits</span><span class="op" id="3006717">[</span><span class="ident" id="3006718">ch</span><span class="op" id="3006720">]</span>&nbsp;<span class="op" id="3006722">=</span>&nbsp;<span class="ident" id="3006724">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006731">code</span><span class="op" id="3006735">[</span><span class="ident" id="3006736">ch</span><span class="op" id="3006738">]</span>&nbsp;<span class="op" id="3006740">=</span>&nbsp;<span class="ident" id="3006742">reverseBits</span><span class="op" id="3006753">(</span><span class="ident" id="3006754">bits</span><span class="op" id="3006758">,</span>&nbsp;<span class="ident" id="3006760">size</span><span class="op" id="3006764">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3006767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006770">return</span>&nbsp;<span class="ident" id="3006777">h</span><br>
<span class="lineno"></span><span class="op" id="3006779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3006782">func</span>&nbsp;<span class="ident" id="3006787">generateFixedOffsetEncoding</span><span class="op" id="3006814">(</span><span class="op" id="3006815">)</span>&nbsp;<span class="op" id="3006817">*</span><span class="ident" id="3006818">huffmanEncoder</span>&nbsp;<span class="op" id="3006833">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006836">h</span>&nbsp;<span class="op" id="3006838">:=</span>&nbsp;<span class="ident" id="3006841">newHuffmanEncoder</span><span class="op" id="3006858">(</span><span class="num" id="3006859">30</span><span class="op" id="3006861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006864">codeBits</span>&nbsp;<span class="op" id="3006873">:=</span>&nbsp;<span class="ident" id="3006876">h</span><span class="op" id="3006877">.</span><span class="ident" id="3006878">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006888">code</span>&nbsp;<span class="op" id="3006893">:=</span>&nbsp;<span class="ident" id="3006896">h</span><span class="op" id="3006897">.</span><span class="ident" id="3006898">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006904">for</span>&nbsp;<span class="ident" id="3006908">ch</span>&nbsp;<span class="op" id="3006911">:=</span>&nbsp;<span class="builtintype" id="3006914">uint16</span><span class="op" id="3006920">(</span><span class="num" id="3006921">0</span><span class="op" id="3006922">)</span><span class="op" id="3006923">;</span>&nbsp;<span class="ident" id="3006925">ch</span>&nbsp;<span class="op" id="3006928">&lt;</span>&nbsp;<span class="num" id="3006930">30</span><span class="op" id="3006932">;</span>&nbsp;<span class="ident" id="3006934">ch</span><span class="op" id="3006936">++</span>&nbsp;<span class="op" id="3006939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006943">codeBits</span><span class="op" id="3006951">[</span><span class="ident" id="3006952">ch</span><span class="op" id="3006954">]</span>&nbsp;<span class="op" id="3006956">=</span>&nbsp;<span class="num" id="3006958">5</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3006962">code</span><span class="op" id="3006966">[</span><span class="ident" id="3006967">ch</span><span class="op" id="3006969">]</span>&nbsp;<span class="op" id="3006971">=</span>&nbsp;<span class="ident" id="3006973">reverseBits</span><span class="op" id="3006984">(</span><span class="ident" id="3006985">ch</span><span class="op" id="3006987">,</span>&nbsp;<span class="num" id="3006989">5</span><span class="op" id="3006990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3006993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3006996">return</span>&nbsp;<span class="ident" id="3007003">h</span><br>
<span class="lineno"></span><span class="op" id="3007005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="3007008">var</span>&nbsp;<span class="ident" id="3007012">fixedLiteralEncoding</span>&nbsp;<span class="op" id="3007033">*</span><span class="ident" id="3007034">huffmanEncoder</span>&nbsp;<span class="op" id="3007049">=</span>&nbsp;<span class="ident" id="3007051">generateFixedLiteralEncoding</span><span class="op" id="3007079">(</span><span class="op" id="3007080">)</span><br>
<span class="lineno"></span><span class="keyword" id="3007082">var</span>&nbsp;<span class="ident" id="3007086">fixedOffsetEncoding</span>&nbsp;<span class="op" id="3007106">*</span><span class="ident" id="3007107">huffmanEncoder</span>&nbsp;<span class="op" id="3007122">=</span>&nbsp;<span class="ident" id="3007124">generateFixedOffsetEncoding</span><span class="op" id="3007151">(</span><span class="op" id="3007152">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3007155">func</span>&nbsp;<span class="op" id="3007160">(</span><span class="ident" id="3007161">h</span>&nbsp;<span class="op" id="3007163">*</span><span class="ident" id="3007164">huffmanEncoder</span><span class="op" id="3007178">)</span>&nbsp;<span class="ident" id="3007180">bitLength</span><span class="op" id="3007189">(</span><span class="ident" id="3007190">freq</span>&nbsp;<span class="op" id="3007195">[</span><span class="op" id="3007196">]</span><span class="builtintype" id="3007197">int32</span><span class="op" id="3007202">)</span>&nbsp;<span class="ident" id="3007204">int64</span>&nbsp;<span class="op" id="3007210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3007213">var</span>&nbsp;<span class="ident" id="3007217">total</span>&nbsp;<span class="ident" id="3007223">int64</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3007230">for</span>&nbsp;<span class="ident" id="3007234">i</span><span class="op" id="3007235">,</span>&nbsp;<span class="ident" id="3007237">f</span>&nbsp;<span class="op" id="3007239">:=</span>&nbsp;<span class="keyword" id="3007242">range</span>&nbsp;<span class="ident" id="3007248">freq</span>&nbsp;<span class="op" id="3007253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3007257">if</span>&nbsp;<span class="ident" id="3007260">f</span>&nbsp;<span class="op" id="3007262">!=</span>&nbsp;<span class="num" id="3007265">0</span>&nbsp;<span class="op" id="3007267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3007272">total</span>&nbsp;<span class="op" id="3007278">+=</span>&nbsp;<span class="ident" id="3007281">int64</span><span class="op" id="3007286">(</span><span class="ident" id="3007287">f</span><span class="op" id="3007288">)</span>&nbsp;<span class="op" id="3007290">*</span>&nbsp;<span class="ident" id="3007292">int64</span><span class="op" id="3007297">(</span><span class="ident" id="3007298">h</span><span class="op" id="3007299">.</span><span class="ident" id="3007300">codeBits</span><span class="op" id="3007308">[</span><span class="ident" id="3007309">i</span><span class="op" id="3007310">]</span><span class="op" id="3007311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3007315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3007318">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3007321">return</span>&nbsp;<span class="ident" id="3007328">total</span><br>
<span class="lineno"></span><span class="op" id="3007334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3007337">const</span>&nbsp;<span class="ident" id="3007343">maxBitsLimit</span>&nbsp;<span class="op" id="3007356">=</span>&nbsp;<span class="num" id="3007358">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3007362">//&nbsp;Return&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;assigned&nbsp;to&nbsp;each&nbsp;bit&nbsp;size&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="3007445">//</span><br>
<span class="lineno"></span><span class="comment" id="3007448">//&nbsp;This&nbsp;method&nbsp;is&nbsp;only&nbsp;called&nbsp;when&nbsp;list.length&nbsp;&gt;=&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="3007500">//&nbsp;The&nbsp;cases&nbsp;of&nbsp;0,&nbsp;1,&nbsp;and&nbsp;2&nbsp;literals&nbsp;are&nbsp;handled&nbsp;by&nbsp;special&nbsp;case&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3007571">//</span><br>
<span class="lineno">115</span><span class="comment" id="3007574">//&nbsp;list&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;the&nbsp;literals&nbsp;with&nbsp;non-zero&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="3007634">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;their&nbsp;associated&nbsp;frequencies.&nbsp;&nbsp;The&nbsp;array&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing</span><br>
<span class="lineno"></span><span class="comment" id="3007720">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frequency,&nbsp;and&nbsp;has&nbsp;as&nbsp;its&nbsp;last&nbsp;element&nbsp;a&nbsp;special&nbsp;element&nbsp;with&nbsp;frequency</span><br>
<span class="lineno"></span><span class="comment" id="3007807">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MaxInt32</span><br>
<span class="lineno"></span><span class="comment" id="3007831">//&nbsp;maxBits&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;that&nbsp;should&nbsp;be&nbsp;used&nbsp;to&nbsp;encode&nbsp;any&nbsp;literal.</span><br>
<span class="lineno">120</span><span class="comment" id="3007916">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Must&nbsp;be&nbsp;less&nbsp;than&nbsp;16.</span><br>
<span class="lineno"></span><span class="comment" id="3007953">//&nbsp;return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An&nbsp;integer&nbsp;array&nbsp;in&nbsp;which&nbsp;array[i]&nbsp;indicates&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span><span class="comment" id="3008036">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;should&nbsp;be&nbsp;encoded&nbsp;in&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="3008085">func</span>&nbsp;<span class="op" id="3008090">(</span><span class="ident" id="3008091">h</span>&nbsp;<span class="op" id="3008093">*</span><span class="ident" id="3008094">huffmanEncoder</span><span class="op" id="3008108">)</span>&nbsp;<span class="ident" id="3008110">bitCounts</span><span class="op" id="3008119">(</span><span class="ident" id="3008120">list</span>&nbsp;<span class="op" id="3008125">[</span><span class="op" id="3008126">]</span><span class="ident" id="3008127">literalNode</span><span class="op" id="3008138">,</span>&nbsp;<span class="ident" id="3008140">maxBits</span>&nbsp;<span class="builtintype" id="3008148">int32</span><span class="op" id="3008153">)</span>&nbsp;<span class="op" id="3008155">[</span><span class="op" id="3008156">]</span><span class="builtintype" id="3008157">int32</span>&nbsp;<span class="op" id="3008163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3008166">if</span>&nbsp;<span class="ident" id="3008169">maxBits</span>&nbsp;<span class="op" id="3008177">&gt;=</span>&nbsp;<span class="ident" id="3008180">maxBitsLimit</span>&nbsp;<span class="op" id="3008193">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3008197">panic</span><span class="op" id="3008202">(</span><span class="string" id="3008203">&#34;flate:&nbsp;maxBits&nbsp;too&nbsp;large&#34;</span><span class="op" id="3008229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3008232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3008235">n</span>&nbsp;<span class="op" id="3008237">:=</span>&nbsp;<span class="builtintype" id="3008240">int32</span><span class="op" id="3008245">(</span><span class="builtinfunc" id="3008246">len</span><span class="op" id="3008249">(</span><span class="ident" id="3008250">list</span><span class="op" id="3008254">)</span><span class="op" id="3008255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3008258">list</span>&nbsp;<span class="op" id="3008263">=</span>&nbsp;<span class="ident" id="3008265">list</span><span class="op" id="3008269">[</span><span class="num" id="3008270">0</span>&nbsp;<span class="op" id="3008272">:</span>&nbsp;<span class="ident" id="3008274">n</span><span class="op" id="3008275">+</span><span class="num" id="3008276">1</span><span class="op" id="3008277">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3008280">list</span><span class="op" id="3008284">[</span><span class="ident" id="3008285">n</span><span class="op" id="3008286">]</span>&nbsp;<span class="op" id="3008288">=</span>&nbsp;<span class="ident" id="3008290">maxNode</span><span class="op" id="3008297">(</span><span class="op" id="3008298">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3008302">//&nbsp;The&nbsp;tree&nbsp;can&#39;t&nbsp;have&nbsp;greater&nbsp;depth&nbsp;than&nbsp;n&nbsp;-&nbsp;1,&nbsp;no&nbsp;matter&nbsp;what.&nbsp;&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3008374">//&nbsp;saves&nbsp;a&nbsp;little&nbsp;bit&nbsp;of&nbsp;work&nbsp;in&nbsp;some&nbsp;small&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3008425">if</span>&nbsp;<span class="ident" id="3008428">maxBits</span>&nbsp;<span class="op" id="3008436">&gt;</span>&nbsp;<span class="ident" id="3008438">n</span><span class="op" id="3008439">-</span><span class="num" id="3008440">1</span>&nbsp;<span class="op" id="3008442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3008446">maxBits</span>&nbsp;<span class="op" id="3008454">=</span>&nbsp;<span class="ident" id="3008456">n</span>&nbsp;<span class="op" id="3008458">-</span>&nbsp;<span class="num" id="3008460">1</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3008463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3008467">//&nbsp;Create&nbsp;information&nbsp;about&nbsp;each&nbsp;of&nbsp;the&nbsp;levels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3008516">//&nbsp;A&nbsp;bogus&nbsp;&#34;Level&nbsp;0&#34;&nbsp;whose&nbsp;sole&nbsp;purpose&nbsp;is&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3008568">//&nbsp;level1.prev.needed==0.&nbsp;&nbsp;This&nbsp;makes&nbsp;level1.nextPairFreq</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3008627">//&nbsp;be&nbsp;a&nbsp;legitimate&nbsp;value&nbsp;that&nbsp;never&nbsp;gets&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3008677">var</span>&nbsp;<span class="ident" id="3008681">levels</span>&nbsp;<span class="op" id="3008688">[</span><span class="ident" id="3008689">maxBitsLimit</span><span class="op" id="3008701">]</span><span class="ident" id="3008702">levelInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3008713">//&nbsp;leafCounts[i]&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3008773">//&nbsp;of&nbsp;ancestors&nbsp;of&nbsp;the&nbsp;rightmost&nbsp;node&nbsp;at&nbsp;level&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3008824">//&nbsp;leafCounts[i][j]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3008883">//&nbsp;of&nbsp;the&nbsp;level&nbsp;j&nbsp;ancestor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3008912">var</span>&nbsp;<span class="ident" id="3008916">leafCounts</span>&nbsp;<span class="op" id="3008927">[</span><span class="ident" id="3008928">maxBitsLimit</span><span class="op" id="3008940">]</span><span class="op" id="3008941">[</span><span class="ident" id="3008942">maxBitsLimit</span><span class="op" id="3008954">]</span><span class="builtintype" id="3008955">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3008963">for</span>&nbsp;<span class="ident" id="3008967">level</span>&nbsp;<span class="op" id="3008973">:=</span>&nbsp;<span class="builtintype" id="3008976">int32</span><span class="op" id="3008981">(</span><span class="num" id="3008982">1</span><span class="op" id="3008983">)</span><span class="op" id="3008984">;</span>&nbsp;<span class="ident" id="3008986">level</span>&nbsp;<span class="op" id="3008992">&lt;=</span>&nbsp;<span class="ident" id="3008995">maxBits</span><span class="op" id="3009002">;</span>&nbsp;<span class="ident" id="3009004">level</span><span class="op" id="3009009">++</span>&nbsp;<span class="op" id="3009012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3009016">//&nbsp;For&nbsp;every&nbsp;level,&nbsp;the&nbsp;first&nbsp;two&nbsp;items&nbsp;are&nbsp;the&nbsp;first&nbsp;two&nbsp;characters.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3009088">//&nbsp;We&nbsp;initialize&nbsp;the&nbsp;levels&nbsp;as&nbsp;if&nbsp;we&nbsp;had&nbsp;already&nbsp;figured&nbsp;this&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3009157">levels</span><span class="op" id="3009163">[</span><span class="ident" id="3009164">level</span><span class="op" id="3009169">]</span>&nbsp;<span class="op" id="3009171">=</span>&nbsp;<span class="ident" id="3009173">levelInfo</span><span class="op" id="3009182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3009187">level</span><span class="op" id="3009192">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009201">level</span><span class="op" id="3009206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3009211">lastFreq</span><span class="op" id="3009219">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009225">list</span><span class="op" id="3009229">[</span><span class="num" id="3009230">1</span><span class="op" id="3009231">]</span><span class="op" id="3009232">.</span><span class="ident" id="3009233">freq</span><span class="op" id="3009237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3009242">nextCharFreq</span><span class="op" id="3009254">:</span>&nbsp;<span class="ident" id="3009256">list</span><span class="op" id="3009260">[</span><span class="num" id="3009261">2</span><span class="op" id="3009262">]</span><span class="op" id="3009263">.</span><span class="ident" id="3009264">freq</span><span class="op" id="3009268">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3009273">nextPairFreq</span><span class="op" id="3009285">:</span>&nbsp;<span class="ident" id="3009287">list</span><span class="op" id="3009291">[</span><span class="num" id="3009292">0</span><span class="op" id="3009293">]</span><span class="op" id="3009294">.</span><span class="ident" id="3009295">freq</span>&nbsp;<span class="op" id="3009300">+</span>&nbsp;<span class="ident" id="3009302">list</span><span class="op" id="3009306">[</span><span class="num" id="3009307">1</span><span class="op" id="3009308">]</span><span class="op" id="3009309">.</span><span class="ident" id="3009310">freq</span><span class="op" id="3009314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3009318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3009322">leafCounts</span><span class="op" id="3009332">[</span><span class="ident" id="3009333">level</span><span class="op" id="3009338">]</span><span class="op" id="3009339">[</span><span class="ident" id="3009340">level</span><span class="op" id="3009345">]</span>&nbsp;<span class="op" id="3009347">=</span>&nbsp;<span class="num" id="3009349">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3009353">if</span>&nbsp;<span class="ident" id="3009356">level</span>&nbsp;<span class="op" id="3009362">==</span>&nbsp;<span class="num" id="3009365">1</span>&nbsp;<span class="op" id="3009367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3009372">levels</span><span class="op" id="3009378">[</span><span class="ident" id="3009379">level</span><span class="op" id="3009384">]</span><span class="op" id="3009385">.</span><span class="ident" id="3009386">nextPairFreq</span>&nbsp;<span class="op" id="3009399">=</span>&nbsp;<span class="ident" id="3009401">math</span><span class="op" id="3009405">.</span><span class="ident" id="3009406">MaxInt32</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3009417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3009420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3009424">//&nbsp;We&nbsp;need&nbsp;a&nbsp;total&nbsp;of&nbsp;2*n&nbsp;-&nbsp;2&nbsp;items&nbsp;at&nbsp;top&nbsp;level&nbsp;and&nbsp;have&nbsp;already&nbsp;generated&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3009504">levels</span><span class="op" id="3009510">[</span><span class="ident" id="3009511">maxBits</span><span class="op" id="3009518">]</span><span class="op" id="3009519">.</span><span class="ident" id="3009520">needed</span>&nbsp;<span class="op" id="3009527">=</span>&nbsp;<span class="num" id="3009529">2</span><span class="op" id="3009530">*</span><span class="ident" id="3009531">n</span>&nbsp;<span class="op" id="3009533">-</span>&nbsp;<span class="num" id="3009535">4</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3009539">level</span>&nbsp;<span class="op" id="3009545">:=</span>&nbsp;<span class="ident" id="3009548">maxBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3009557">for</span>&nbsp;<span class="op" id="3009561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3009565">l</span>&nbsp;<span class="op" id="3009567">:=</span>&nbsp;<span class="op" id="3009570">&amp;</span><span class="ident" id="3009571">levels</span><span class="op" id="3009577">[</span><span class="ident" id="3009578">level</span><span class="op" id="3009583">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3009587">if</span>&nbsp;<span class="ident" id="3009590">l</span><span class="op" id="3009591">.</span><span class="ident" id="3009592">nextPairFreq</span>&nbsp;<span class="op" id="3009605">==</span>&nbsp;<span class="ident" id="3009608">math</span><span class="op" id="3009612">.</span><span class="ident" id="3009613">MaxInt32</span>&nbsp;<span class="op" id="3009622">&amp;&amp;</span>&nbsp;<span class="ident" id="3009625">l</span><span class="op" id="3009626">.</span><span class="ident" id="3009627">nextCharFreq</span>&nbsp;<span class="op" id="3009640">==</span>&nbsp;<span class="ident" id="3009643">math</span><span class="op" id="3009647">.</span><span class="ident" id="3009648">MaxInt32</span>&nbsp;<span class="op" id="3009657">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3009662">//&nbsp;We&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;both&nbsp;leafs&nbsp;and&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3009707">//&nbsp;End&nbsp;all&nbsp;calculations&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3009750">//&nbsp;To&nbsp;make&nbsp;sure&nbsp;we&nbsp;never&nbsp;come&nbsp;back&nbsp;to&nbsp;this&nbsp;level&nbsp;or&nbsp;any&nbsp;lower&nbsp;level,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3009822">//&nbsp;set&nbsp;nextPairFreq&nbsp;impossibly&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3009863">l</span><span class="op" id="3009864">.</span><span class="ident" id="3009865">needed</span>&nbsp;<span class="op" id="3009872">=</span>&nbsp;<span class="num" id="3009874">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3009879">levels</span><span class="op" id="3009885">[</span><span class="ident" id="3009886">level</span><span class="op" id="3009891">+</span><span class="num" id="3009892">1</span><span class="op" id="3009893">]</span><span class="op" id="3009894">.</span><span class="ident" id="3009895">nextPairFreq</span>&nbsp;<span class="op" id="3009908">=</span>&nbsp;<span class="ident" id="3009910">math</span><span class="op" id="3009914">.</span><span class="ident" id="3009915">MaxInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3009927">level</span><span class="op" id="3009932">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3009938">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3009949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3009954">prevFreq</span>&nbsp;<span class="op" id="3009963">:=</span>&nbsp;<span class="ident" id="3009966">l</span><span class="op" id="3009967">.</span><span class="ident" id="3009968">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3009979">if</span>&nbsp;<span class="ident" id="3009982">l</span><span class="op" id="3009983">.</span><span class="ident" id="3009984">nextCharFreq</span>&nbsp;<span class="op" id="3009997">&lt;</span>&nbsp;<span class="ident" id="3009999">l</span><span class="op" id="3010000">.</span><span class="ident" id="3010001">nextPairFreq</span>&nbsp;<span class="op" id="3010014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3010019">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;leaf&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3010067">n</span>&nbsp;<span class="op" id="3010069">:=</span>&nbsp;<span class="ident" id="3010072">leafCounts</span><span class="op" id="3010082">[</span><span class="ident" id="3010083">level</span><span class="op" id="3010088">]</span><span class="op" id="3010089">[</span><span class="ident" id="3010090">level</span><span class="op" id="3010095">]</span>&nbsp;<span class="op" id="3010097">+</span>&nbsp;<span class="num" id="3010099">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3010104">l</span><span class="op" id="3010105">.</span><span class="ident" id="3010106">lastFreq</span>&nbsp;<span class="op" id="3010115">=</span>&nbsp;<span class="ident" id="3010117">l</span><span class="op" id="3010118">.</span><span class="ident" id="3010119">nextCharFreq</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3010135">//&nbsp;Lower&nbsp;leafCounts&nbsp;are&nbsp;the&nbsp;same&nbsp;of&nbsp;the&nbsp;previous&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3010193">leafCounts</span><span class="op" id="3010203">[</span><span class="ident" id="3010204">level</span><span class="op" id="3010209">]</span><span class="op" id="3010210">[</span><span class="ident" id="3010211">level</span><span class="op" id="3010216">]</span>&nbsp;<span class="op" id="3010218">=</span>&nbsp;<span class="ident" id="3010220">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3010225">l</span><span class="op" id="3010226">.</span><span class="ident" id="3010227">nextCharFreq</span>&nbsp;<span class="op" id="3010240">=</span>&nbsp;<span class="ident" id="3010242">list</span><span class="op" id="3010246">[</span><span class="ident" id="3010247">n</span><span class="op" id="3010248">]</span><span class="op" id="3010249">.</span><span class="ident" id="3010250">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3010257">}</span>&nbsp;<span class="keyword" id="3010259">else</span>&nbsp;<span class="op" id="3010264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3010269">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;pair&nbsp;from&nbsp;the&nbsp;previous&nbsp;row.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3010334">//&nbsp;nextPairFreq&nbsp;isn&#39;t&nbsp;valid&nbsp;until&nbsp;we&nbsp;generate&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3010387">//&nbsp;more&nbsp;values&nbsp;in&nbsp;the&nbsp;level&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3010424">l</span><span class="op" id="3010425">.</span><span class="ident" id="3010426">lastFreq</span>&nbsp;<span class="op" id="3010435">=</span>&nbsp;<span class="ident" id="3010437">l</span><span class="op" id="3010438">.</span><span class="ident" id="3010439">nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3010455">//&nbsp;Take&nbsp;leaf&nbsp;counts&nbsp;from&nbsp;the&nbsp;lower&nbsp;level,&nbsp;except&nbsp;counts[level]&nbsp;remains&nbsp;the&nbsp;same.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3010539">copy</span><span class="op" id="3010543">(</span><span class="ident" id="3010544">leafCounts</span><span class="op" id="3010554">[</span><span class="ident" id="3010555">level</span><span class="op" id="3010560">]</span><span class="op" id="3010561">[</span><span class="op" id="3010562">:</span><span class="ident" id="3010563">level</span><span class="op" id="3010568">]</span><span class="op" id="3010569">,</span>&nbsp;<span class="ident" id="3010571">leafCounts</span><span class="op" id="3010581">[</span><span class="ident" id="3010582">level</span><span class="op" id="3010587">-</span><span class="num" id="3010588">1</span><span class="op" id="3010589">]</span><span class="op" id="3010590">[</span><span class="op" id="3010591">:</span><span class="ident" id="3010592">level</span><span class="op" id="3010597">]</span><span class="op" id="3010598">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3010603">levels</span><span class="op" id="3010609">[</span><span class="ident" id="3010610">l</span><span class="op" id="3010611">.</span><span class="ident" id="3010612">level</span><span class="op" id="3010617">-</span><span class="num" id="3010618">1</span><span class="op" id="3010619">]</span><span class="op" id="3010620">.</span><span class="ident" id="3010621">needed</span>&nbsp;<span class="op" id="3010628">=</span>&nbsp;<span class="num" id="3010630">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3010634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3010639">if</span>&nbsp;<span class="ident" id="3010642">l</span><span class="op" id="3010643">.</span><span class="ident" id="3010644">needed</span><span class="op" id="3010650">--</span><span class="op" id="3010652">;</span>&nbsp;<span class="ident" id="3010654">l</span><span class="op" id="3010655">.</span><span class="ident" id="3010656">needed</span>&nbsp;<span class="op" id="3010663">==</span>&nbsp;<span class="num" id="3010666">0</span>&nbsp;<span class="op" id="3010668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3010673">//&nbsp;We&#39;ve&nbsp;done&nbsp;everything&nbsp;we&nbsp;need&nbsp;to&nbsp;do&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3010731">//&nbsp;Continue&nbsp;calculating&nbsp;one&nbsp;level&nbsp;up.&nbsp;&nbsp;Fill&nbsp;in&nbsp;nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3010794">//&nbsp;of&nbsp;that&nbsp;level&nbsp;with&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;two&nbsp;nodes&nbsp;we&#39;ve&nbsp;just&nbsp;calculated&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3010869">//&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3010887">if</span>&nbsp;<span class="ident" id="3010890">l</span><span class="op" id="3010891">.</span><span class="ident" id="3010892">level</span>&nbsp;<span class="op" id="3010898">==</span>&nbsp;<span class="ident" id="3010901">maxBits</span>&nbsp;<span class="op" id="3010909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3010915">//&nbsp;All&nbsp;done!</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3010932">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3010941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3010946">levels</span><span class="op" id="3010952">[</span><span class="ident" id="3010953">l</span><span class="op" id="3010954">.</span><span class="ident" id="3010955">level</span><span class="op" id="3010960">+</span><span class="num" id="3010961">1</span><span class="op" id="3010962">]</span><span class="op" id="3010963">.</span><span class="ident" id="3010964">nextPairFreq</span>&nbsp;<span class="op" id="3010977">=</span>&nbsp;<span class="ident" id="3010979">prevFreq</span>&nbsp;<span class="op" id="3010988">+</span>&nbsp;<span class="ident" id="3010990">l</span><span class="op" id="3010991">.</span><span class="ident" id="3010992">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3011004">level</span><span class="op" id="3011009">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3011014">}</span>&nbsp;<span class="keyword" id="3011016">else</span>&nbsp;<span class="op" id="3011021">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3011026">//&nbsp;If&nbsp;we&nbsp;stole&nbsp;from&nbsp;below,&nbsp;move&nbsp;down&nbsp;temporarily&nbsp;to&nbsp;replenish&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3011095">for</span>&nbsp;<span class="ident" id="3011099">levels</span><span class="op" id="3011105">[</span><span class="ident" id="3011106">level</span><span class="op" id="3011111">-</span><span class="num" id="3011112">1</span><span class="op" id="3011113">]</span><span class="op" id="3011114">.</span><span class="ident" id="3011115">needed</span>&nbsp;<span class="op" id="3011122">&gt;</span>&nbsp;<span class="num" id="3011124">0</span>&nbsp;<span class="op" id="3011126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3011132">level</span><span class="op" id="3011137">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3011143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3011147">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3011150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3011154">//&nbsp;Somethings&nbsp;is&nbsp;wrong&nbsp;if&nbsp;at&nbsp;the&nbsp;end,&nbsp;the&nbsp;top&nbsp;level&nbsp;is&nbsp;null&nbsp;or&nbsp;hasn&#39;t&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3011230">//&nbsp;all&nbsp;of&nbsp;the&nbsp;leaves.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3011253">if</span>&nbsp;<span class="ident" id="3011256">leafCounts</span><span class="op" id="3011266">[</span><span class="ident" id="3011267">maxBits</span><span class="op" id="3011274">]</span><span class="op" id="3011275">[</span><span class="ident" id="3011276">maxBits</span><span class="op" id="3011283">]</span>&nbsp;<span class="op" id="3011285">!=</span>&nbsp;<span class="ident" id="3011288">n</span>&nbsp;<span class="op" id="3011290">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3011294">panic</span><span class="op" id="3011299">(</span><span class="string" id="3011300">&#34;leafCounts[maxBits][maxBits]&nbsp;!=&nbsp;n&#34;</span><span class="op" id="3011335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3011338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3011342">bitCount</span>&nbsp;<span class="op" id="3011351">:=</span>&nbsp;<span class="builtinfunc" id="3011354">make</span><span class="op" id="3011358">(</span><span class="op" id="3011359">[</span><span class="op" id="3011360">]</span><span class="builtintype" id="3011361">int32</span><span class="op" id="3011366">,</span>&nbsp;<span class="ident" id="3011368">maxBits</span><span class="op" id="3011375">+</span><span class="num" id="3011376">1</span><span class="op" id="3011377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3011380">bits</span>&nbsp;<span class="op" id="3011385">:=</span>&nbsp;<span class="num" id="3011388">1</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3011391">counts</span>&nbsp;<span class="op" id="3011398">:=</span>&nbsp;<span class="op" id="3011401">&amp;</span><span class="ident" id="3011402">leafCounts</span><span class="op" id="3011412">[</span><span class="ident" id="3011413">maxBits</span><span class="op" id="3011420">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3011423">for</span>&nbsp;<span class="ident" id="3011427">level</span>&nbsp;<span class="op" id="3011433">:=</span>&nbsp;<span class="ident" id="3011436">maxBits</span><span class="op" id="3011443">;</span>&nbsp;<span class="ident" id="3011445">level</span>&nbsp;<span class="op" id="3011451">&gt;</span>&nbsp;<span class="num" id="3011453">0</span><span class="op" id="3011454">;</span>&nbsp;<span class="ident" id="3011456">level</span><span class="op" id="3011461">--</span>&nbsp;<span class="op" id="3011464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3011468">//&nbsp;chain.leafCount&nbsp;gives&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;requiring&nbsp;at&nbsp;least&nbsp;&#34;bits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3011544">//&nbsp;bits&nbsp;to&nbsp;encode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3011565">bitCount</span><span class="op" id="3011573">[</span><span class="ident" id="3011574">bits</span><span class="op" id="3011578">]</span>&nbsp;<span class="op" id="3011580">=</span>&nbsp;<span class="ident" id="3011582">counts</span><span class="op" id="3011588">[</span><span class="ident" id="3011589">level</span><span class="op" id="3011594">]</span>&nbsp;<span class="op" id="3011596">-</span>&nbsp;<span class="ident" id="3011598">counts</span><span class="op" id="3011604">[</span><span class="ident" id="3011605">level</span><span class="op" id="3011610">-</span><span class="num" id="3011611">1</span><span class="op" id="3011612">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3011616">bits</span><span class="op" id="3011620">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3011624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3011627">return</span>&nbsp;<span class="ident" id="3011634">bitCount</span><br>
<span class="lineno"></span><span class="op" id="3011643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="3011646">//&nbsp;Look&nbsp;at&nbsp;the&nbsp;leaves&nbsp;and&nbsp;assign&nbsp;them&nbsp;a&nbsp;bit&nbsp;count&nbsp;and&nbsp;an&nbsp;encoding&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="3011725">//&nbsp;in&nbsp;RFC&nbsp;1951&nbsp;3.2.2</span><br>
<span class="lineno"></span><span class="keyword" id="3011746">func</span>&nbsp;<span class="op" id="3011751">(</span><span class="ident" id="3011752">h</span>&nbsp;<span class="op" id="3011754">*</span><span class="ident" id="3011755">huffmanEncoder</span><span class="op" id="3011769">)</span>&nbsp;<span class="ident" id="3011771">assignEncodingAndSize</span><span class="op" id="3011792">(</span><span class="ident" id="3011793">bitCount</span>&nbsp;<span class="op" id="3011802">[</span><span class="op" id="3011803">]</span><span class="builtintype" id="3011804">int32</span><span class="op" id="3011809">,</span>&nbsp;<span class="ident" id="3011811">list</span>&nbsp;<span class="op" id="3011816">[</span><span class="op" id="3011817">]</span><span class="ident" id="3011818">literalNode</span><span class="op" id="3011829">)</span>&nbsp;<span class="op" id="3011831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3011834">code</span>&nbsp;<span class="op" id="3011839">:=</span>&nbsp;<span class="builtintype" id="3011842">uint16</span><span class="op" id="3011848">(</span><span class="num" id="3011849">0</span><span class="op" id="3011850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3011853">for</span>&nbsp;<span class="ident" id="3011857">n</span><span class="op" id="3011858">,</span>&nbsp;<span class="ident" id="3011860">bits</span>&nbsp;<span class="op" id="3011865">:=</span>&nbsp;<span class="keyword" id="3011868">range</span>&nbsp;<span class="ident" id="3011874">bitCount</span>&nbsp;<span class="op" id="3011883">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3011887">code</span>&nbsp;<span class="op" id="3011892">&lt;&lt;=</span>&nbsp;<span class="num" id="3011896">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3011900">if</span>&nbsp;<span class="ident" id="3011903">n</span>&nbsp;<span class="op" id="3011905">==</span>&nbsp;<span class="num" id="3011908">0</span>&nbsp;<span class="op" id="3011910">||</span>&nbsp;<span class="ident" id="3011913">bits</span>&nbsp;<span class="op" id="3011918">==</span>&nbsp;<span class="num" id="3011921">0</span>&nbsp;<span class="op" id="3011923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3011928">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3011939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3011943">//&nbsp;The&nbsp;literals&nbsp;list[len(list)-bits]&nbsp;..&nbsp;list[len(list)-bits]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3012006">//&nbsp;are&nbsp;encoded&nbsp;using&nbsp;&#34;bits&#34;&nbsp;bits,&nbsp;and&nbsp;get&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3012061">//&nbsp;code,&nbsp;code&nbsp;+&nbsp;1,&nbsp;....&nbsp;&nbsp;The&nbsp;code&nbsp;values&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3012108">//&nbsp;assigned&nbsp;in&nbsp;literal&nbsp;order&nbsp;(not&nbsp;frequency&nbsp;order).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3012162">chunk</span>&nbsp;<span class="op" id="3012168">:=</span>&nbsp;<span class="ident" id="3012171">list</span><span class="op" id="3012175">[</span><span class="builtinfunc" id="3012176">len</span><span class="op" id="3012179">(</span><span class="ident" id="3012180">list</span><span class="op" id="3012184">)</span><span class="op" id="3012185">-</span><span class="builtintype" id="3012186">int</span><span class="op" id="3012189">(</span><span class="ident" id="3012190">bits</span><span class="op" id="3012194">)</span><span class="op" id="3012195">:</span><span class="op" id="3012196">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3012200">sortByLiteral</span><span class="op" id="3012213">(</span><span class="ident" id="3012214">chunk</span><span class="op" id="3012219">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3012223">for</span>&nbsp;<span class="ident" id="3012227">_</span><span class="op" id="3012228">,</span>&nbsp;<span class="ident" id="3012230">node</span>&nbsp;<span class="op" id="3012235">:=</span>&nbsp;<span class="keyword" id="3012238">range</span>&nbsp;<span class="ident" id="3012244">chunk</span>&nbsp;<span class="op" id="3012250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3012255">h</span><span class="op" id="3012256">.</span><span class="ident" id="3012257">codeBits</span><span class="op" id="3012265">[</span><span class="ident" id="3012266">node</span><span class="op" id="3012270">.</span><span class="ident" id="3012271">literal</span><span class="op" id="3012278">]</span>&nbsp;<span class="op" id="3012280">=</span>&nbsp;<span class="builtintype" id="3012282">uint8</span><span class="op" id="3012287">(</span><span class="ident" id="3012288">n</span><span class="op" id="3012289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3012294">h</span><span class="op" id="3012295">.</span><span class="ident" id="3012296">code</span><span class="op" id="3012300">[</span><span class="ident" id="3012301">node</span><span class="op" id="3012305">.</span><span class="ident" id="3012306">literal</span><span class="op" id="3012313">]</span>&nbsp;<span class="op" id="3012315">=</span>&nbsp;<span class="ident" id="3012317">reverseBits</span><span class="op" id="3012328">(</span><span class="ident" id="3012329">code</span><span class="op" id="3012333">,</span>&nbsp;<span class="builtintype" id="3012335">uint8</span><span class="op" id="3012340">(</span><span class="ident" id="3012341">n</span><span class="op" id="3012342">)</span><span class="op" id="3012343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3012348">code</span><span class="op" id="3012352">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3012357">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3012361">list</span>&nbsp;<span class="op" id="3012366">=</span>&nbsp;<span class="ident" id="3012368">list</span><span class="op" id="3012372">[</span><span class="num" id="3012373">0</span>&nbsp;<span class="op" id="3012375">:</span>&nbsp;<span class="builtinfunc" id="3012377">len</span><span class="op" id="3012380">(</span><span class="ident" id="3012381">list</span><span class="op" id="3012385">)</span><span class="op" id="3012386">-</span><span class="builtintype" id="3012387">int</span><span class="op" id="3012390">(</span><span class="ident" id="3012391">bits</span><span class="op" id="3012395">)</span><span class="op" id="3012396">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3012399">}</span><br>
<span class="lineno"></span><span class="op" id="3012401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3012404">//&nbsp;Update&nbsp;this&nbsp;Huffman&nbsp;Code&nbsp;object&nbsp;to&nbsp;be&nbsp;the&nbsp;minimum&nbsp;code&nbsp;for&nbsp;the&nbsp;specified&nbsp;frequency&nbsp;count.</span><br>
<span class="lineno">260</span><span class="comment" id="3012497">//</span><br>
<span class="lineno"></span><span class="comment" id="3012500">//&nbsp;freq&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;frequencies,&nbsp;in&nbsp;which&nbsp;frequency[i]&nbsp;gives&nbsp;the&nbsp;frequency&nbsp;of&nbsp;literal&nbsp;i.</span><br>
<span class="lineno"></span><span class="comment" id="3012590">//&nbsp;maxBits&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;any&nbsp;literal.</span><br>
<span class="lineno"></span><span class="keyword" id="3012653">func</span>&nbsp;<span class="op" id="3012658">(</span><span class="ident" id="3012659">h</span>&nbsp;<span class="op" id="3012661">*</span><span class="ident" id="3012662">huffmanEncoder</span><span class="op" id="3012676">)</span>&nbsp;<span class="ident" id="3012678">generate</span><span class="op" id="3012686">(</span><span class="ident" id="3012687">freq</span>&nbsp;<span class="op" id="3012692">[</span><span class="op" id="3012693">]</span><span class="builtintype" id="3012694">int32</span><span class="op" id="3012699">,</span>&nbsp;<span class="ident" id="3012701">maxBits</span>&nbsp;<span class="builtintype" id="3012709">int32</span><span class="op" id="3012714">)</span>&nbsp;<span class="op" id="3012716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3012719">list</span>&nbsp;<span class="op" id="3012724">:=</span>&nbsp;<span class="builtinfunc" id="3012727">make</span><span class="op" id="3012731">(</span><span class="op" id="3012732">[</span><span class="op" id="3012733">]</span><span class="ident" id="3012734">literalNode</span><span class="op" id="3012745">,</span>&nbsp;<span class="builtinfunc" id="3012747">len</span><span class="op" id="3012750">(</span><span class="ident" id="3012751">freq</span><span class="op" id="3012755">)</span><span class="op" id="3012756">+</span><span class="num" id="3012757">1</span><span class="op" id="3012758">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3012761">//&nbsp;Number&nbsp;of&nbsp;non-zero&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3012793">count</span>&nbsp;<span class="op" id="3012799">:=</span>&nbsp;<span class="num" id="3012802">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3012805">//&nbsp;Set&nbsp;list&nbsp;to&nbsp;be&nbsp;the&nbsp;set&nbsp;of&nbsp;all&nbsp;non-zero&nbsp;literals&nbsp;and&nbsp;their&nbsp;frequencies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3012879">for</span>&nbsp;<span class="ident" id="3012883">i</span><span class="op" id="3012884">,</span>&nbsp;<span class="ident" id="3012886">f</span>&nbsp;<span class="op" id="3012888">:=</span>&nbsp;<span class="keyword" id="3012891">range</span>&nbsp;<span class="ident" id="3012897">freq</span>&nbsp;<span class="op" id="3012902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3012906">if</span>&nbsp;<span class="ident" id="3012909">f</span>&nbsp;<span class="op" id="3012911">!=</span>&nbsp;<span class="num" id="3012914">0</span>&nbsp;<span class="op" id="3012916">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3012921">list</span><span class="op" id="3012925">[</span><span class="ident" id="3012926">count</span><span class="op" id="3012931">]</span>&nbsp;<span class="op" id="3012933">=</span>&nbsp;<span class="ident" id="3012935">literalNode</span><span class="op" id="3012946">{</span><span class="builtintype" id="3012947">uint16</span><span class="op" id="3012953">(</span><span class="ident" id="3012954">i</span><span class="op" id="3012955">)</span><span class="op" id="3012956">,</span>&nbsp;<span class="ident" id="3012958">f</span><span class="op" id="3012959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3012964">count</span><span class="op" id="3012969">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3012974">}</span>&nbsp;<span class="keyword" id="3012976">else</span>&nbsp;<span class="op" id="3012981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3012986">h</span><span class="op" id="3012987">.</span><span class="ident" id="3012988">codeBits</span><span class="op" id="3012996">[</span><span class="ident" id="3012997">i</span><span class="op" id="3012998">]</span>&nbsp;<span class="op" id="3013000">=</span>&nbsp;<span class="num" id="3013002">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3013006">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3013009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3013012">//&nbsp;If&nbsp;freq[]&nbsp;is&nbsp;shorter&nbsp;than&nbsp;codeBits[],&nbsp;fill&nbsp;rest&nbsp;of&nbsp;codeBits[]&nbsp;with&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3013089">h</span><span class="op" id="3013090">.</span><span class="ident" id="3013091">codeBits</span>&nbsp;<span class="op" id="3013100">=</span>&nbsp;<span class="ident" id="3013102">h</span><span class="op" id="3013103">.</span><span class="ident" id="3013104">codeBits</span><span class="op" id="3013112">[</span><span class="num" id="3013113">0</span><span class="op" id="3013114">:</span><span class="builtinfunc" id="3013115">len</span><span class="op" id="3013118">(</span><span class="ident" id="3013119">freq</span><span class="op" id="3013123">)</span><span class="op" id="3013124">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3013127">list</span>&nbsp;<span class="op" id="3013132">=</span>&nbsp;<span class="ident" id="3013134">list</span><span class="op" id="3013138">[</span><span class="num" id="3013139">0</span><span class="op" id="3013140">:</span><span class="ident" id="3013141">count</span><span class="op" id="3013146">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3013149">if</span>&nbsp;<span class="ident" id="3013152">count</span>&nbsp;<span class="op" id="3013158">&lt;=</span>&nbsp;<span class="num" id="3013161">2</span>&nbsp;<span class="op" id="3013163">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3013167">//&nbsp;Handle&nbsp;the&nbsp;small&nbsp;cases&nbsp;here,&nbsp;because&nbsp;they&nbsp;are&nbsp;awkward&nbsp;for&nbsp;the&nbsp;general&nbsp;case&nbsp;code.&nbsp;&nbsp;With</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3013259">//&nbsp;two&nbsp;or&nbsp;fewer&nbsp;literals,&nbsp;everything&nbsp;has&nbsp;bit&nbsp;length&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3013316">for</span>&nbsp;<span class="ident" id="3013320">i</span><span class="op" id="3013321">,</span>&nbsp;<span class="ident" id="3013323">node</span>&nbsp;<span class="op" id="3013328">:=</span>&nbsp;<span class="keyword" id="3013331">range</span>&nbsp;<span class="ident" id="3013337">list</span>&nbsp;<span class="op" id="3013342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3013347">//&nbsp;&#34;list&#34;&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing&nbsp;literal&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3013401">h</span><span class="op" id="3013402">.</span><span class="ident" id="3013403">codeBits</span><span class="op" id="3013411">[</span><span class="ident" id="3013412">node</span><span class="op" id="3013416">.</span><span class="ident" id="3013417">literal</span><span class="op" id="3013424">]</span>&nbsp;<span class="op" id="3013426">=</span>&nbsp;<span class="num" id="3013428">1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3013433">h</span><span class="op" id="3013434">.</span><span class="ident" id="3013435">code</span><span class="op" id="3013439">[</span><span class="ident" id="3013440">node</span><span class="op" id="3013444">.</span><span class="ident" id="3013445">literal</span><span class="op" id="3013452">]</span>&nbsp;<span class="op" id="3013454">=</span>&nbsp;<span class="builtintype" id="3013456">uint16</span><span class="op" id="3013462">(</span><span class="ident" id="3013463">i</span><span class="op" id="3013464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3013468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3013472">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3013480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3013483">sortByFreq</span><span class="op" id="3013493">(</span><span class="ident" id="3013494">list</span><span class="op" id="3013498">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3013502">//&nbsp;Get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;for&nbsp;each&nbsp;bit&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3013552">bitCount</span>&nbsp;<span class="op" id="3013561">:=</span>&nbsp;<span class="ident" id="3013564">h</span><span class="op" id="3013565">.</span><span class="ident" id="3013566">bitCounts</span><span class="op" id="3013575">(</span><span class="ident" id="3013576">list</span><span class="op" id="3013580">,</span>&nbsp;<span class="ident" id="3013582">maxBits</span><span class="op" id="3013589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3013592">//&nbsp;And&nbsp;do&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3013618">h</span><span class="op" id="3013619">.</span><span class="ident" id="3013620">assignEncodingAndSize</span><span class="op" id="3013641">(</span><span class="ident" id="3013642">bitCount</span><span class="op" id="3013650">,</span>&nbsp;<span class="ident" id="3013652">list</span><span class="op" id="3013656">)</span><br>
<span class="lineno">295</span><span class="op" id="3013658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3013661">type</span>&nbsp;<span class="ident" id="3013666">literalNodeSorter</span>&nbsp;<span class="keyword" id="3013684">struct</span>&nbsp;<span class="op" id="3013691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3013694">a</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3013699">[</span><span class="op" id="3013700">]</span><span class="ident" id="3013701">literalNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3013714">less</span>&nbsp;<span class="keyword" id="3013719">func</span><span class="op" id="3013723">(</span><span class="ident" id="3013724">i</span><span class="op" id="3013725">,</span>&nbsp;<span class="ident" id="3013727">j</span>&nbsp;<span class="builtintype" id="3013729">int</span><span class="op" id="3013732">)</span>&nbsp;<span class="builtintype" id="3013734">bool</span><br>
<span class="lineno">300</span><span class="op" id="3013739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3013742">func</span>&nbsp;<span class="op" id="3013747">(</span><span class="ident" id="3013748">s</span>&nbsp;<span class="ident" id="3013750">literalNodeSorter</span><span class="op" id="3013767">)</span>&nbsp;<span class="ident" id="3013769">Len</span><span class="op" id="3013772">(</span><span class="op" id="3013773">)</span>&nbsp;<span class="builtintype" id="3013775">int</span>&nbsp;<span class="op" id="3013779">{</span>&nbsp;<span class="keyword" id="3013781">return</span>&nbsp;<span class="builtinfunc" id="3013788">len</span><span class="op" id="3013791">(</span><span class="ident" id="3013792">s</span><span class="op" id="3013793">.</span><span class="ident" id="3013794">a</span><span class="op" id="3013795">)</span>&nbsp;<span class="op" id="3013797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3013800">func</span>&nbsp;<span class="op" id="3013805">(</span><span class="ident" id="3013806">s</span>&nbsp;<span class="ident" id="3013808">literalNodeSorter</span><span class="op" id="3013825">)</span>&nbsp;<span class="ident" id="3013827">Less</span><span class="op" id="3013831">(</span><span class="ident" id="3013832">i</span><span class="op" id="3013833">,</span>&nbsp;<span class="ident" id="3013835">j</span>&nbsp;<span class="builtintype" id="3013837">int</span><span class="op" id="3013840">)</span>&nbsp;<span class="builtintype" id="3013842">bool</span>&nbsp;<span class="op" id="3013847">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3013850">return</span>&nbsp;<span class="ident" id="3013857">s</span><span class="op" id="3013858">.</span><span class="ident" id="3013859">less</span><span class="op" id="3013863">(</span><span class="ident" id="3013864">i</span><span class="op" id="3013865">,</span>&nbsp;<span class="ident" id="3013867">j</span><span class="op" id="3013868">)</span><br>
<span class="lineno"></span><span class="op" id="3013870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3013873">func</span>&nbsp;<span class="op" id="3013878">(</span><span class="ident" id="3013879">s</span>&nbsp;<span class="ident" id="3013881">literalNodeSorter</span><span class="op" id="3013898">)</span>&nbsp;<span class="ident" id="3013900">Swap</span><span class="op" id="3013904">(</span><span class="ident" id="3013905">i</span><span class="op" id="3013906">,</span>&nbsp;<span class="ident" id="3013908">j</span>&nbsp;<span class="builtintype" id="3013910">int</span><span class="op" id="3013913">)</span>&nbsp;<span class="op" id="3013915">{</span>&nbsp;<span class="ident" id="3013917">s</span><span class="op" id="3013918">.</span><span class="ident" id="3013919">a</span><span class="op" id="3013920">[</span><span class="ident" id="3013921">i</span><span class="op" id="3013922">]</span><span class="op" id="3013923">,</span>&nbsp;<span class="ident" id="3013925">s</span><span class="op" id="3013926">.</span><span class="ident" id="3013927">a</span><span class="op" id="3013928">[</span><span class="ident" id="3013929">j</span><span class="op" id="3013930">]</span>&nbsp;<span class="op" id="3013932">=</span>&nbsp;<span class="ident" id="3013934">s</span><span class="op" id="3013935">.</span><span class="ident" id="3013936">a</span><span class="op" id="3013937">[</span><span class="ident" id="3013938">j</span><span class="op" id="3013939">]</span><span class="op" id="3013940">,</span>&nbsp;<span class="ident" id="3013942">s</span><span class="op" id="3013943">.</span><span class="ident" id="3013944">a</span><span class="op" id="3013945">[</span><span class="ident" id="3013946">i</span><span class="op" id="3013947">]</span>&nbsp;<span class="op" id="3013949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="keyword" id="3013952">func</span>&nbsp;<span class="ident" id="3013957">sortByFreq</span><span class="op" id="3013967">(</span><span class="ident" id="3013968">a</span>&nbsp;<span class="op" id="3013970">[</span><span class="op" id="3013971">]</span><span class="ident" id="3013972">literalNode</span><span class="op" id="3013983">)</span>&nbsp;<span class="op" id="3013985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3013988">s</span>&nbsp;<span class="op" id="3013990">:=</span>&nbsp;<span class="op" id="3013993">&amp;</span><span class="ident" id="3013994">literalNodeSorter</span><span class="op" id="3014011">{</span><span class="ident" id="3014012">a</span><span class="op" id="3014013">,</span>&nbsp;<span class="keyword" id="3014015">func</span><span class="op" id="3014019">(</span><span class="ident" id="3014020">i</span><span class="op" id="3014021">,</span>&nbsp;<span class="ident" id="3014023">j</span>&nbsp;<span class="builtintype" id="3014025">int</span><span class="op" id="3014028">)</span>&nbsp;<span class="builtintype" id="3014030">bool</span>&nbsp;<span class="op" id="3014035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3014039">if</span>&nbsp;<span class="ident" id="3014042">a</span><span class="op" id="3014043">[</span><span class="ident" id="3014044">i</span><span class="op" id="3014045">]</span><span class="op" id="3014046">.</span><span class="ident" id="3014047">freq</span>&nbsp;<span class="op" id="3014052">==</span>&nbsp;<span class="ident" id="3014055">a</span><span class="op" id="3014056">[</span><span class="ident" id="3014057">j</span><span class="op" id="3014058">]</span><span class="op" id="3014059">.</span><span class="ident" id="3014060">freq</span>&nbsp;<span class="op" id="3014065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3014070">return</span>&nbsp;<span class="ident" id="3014077">a</span><span class="op" id="3014078">[</span><span class="ident" id="3014079">i</span><span class="op" id="3014080">]</span><span class="op" id="3014081">.</span><span class="ident" id="3014082">literal</span>&nbsp;<span class="op" id="3014090">&lt;</span>&nbsp;<span class="ident" id="3014092">a</span><span class="op" id="3014093">[</span><span class="ident" id="3014094">j</span><span class="op" id="3014095">]</span><span class="op" id="3014096">.</span><span class="ident" id="3014097">literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3014107">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3014111">return</span>&nbsp;<span class="ident" id="3014118">a</span><span class="op" id="3014119">[</span><span class="ident" id="3014120">i</span><span class="op" id="3014121">]</span><span class="op" id="3014122">.</span><span class="ident" id="3014123">freq</span>&nbsp;<span class="op" id="3014128">&lt;</span>&nbsp;<span class="ident" id="3014130">a</span><span class="op" id="3014131">[</span><span class="ident" id="3014132">j</span><span class="op" id="3014133">]</span><span class="op" id="3014134">.</span><span class="ident" id="3014135">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3014141">}</span><span class="op" id="3014142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3014145">sort</span><span class="op" id="3014149">.</span><span class="ident" id="3014150">Sort</span><span class="op" id="3014154">(</span><span class="ident" id="3014155">s</span><span class="op" id="3014156">)</span><br>
<span class="lineno"></span><span class="op" id="3014158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="keyword" id="3014161">func</span>&nbsp;<span class="ident" id="3014166">sortByLiteral</span><span class="op" id="3014179">(</span><span class="ident" id="3014180">a</span>&nbsp;<span class="op" id="3014182">[</span><span class="op" id="3014183">]</span><span class="ident" id="3014184">literalNode</span><span class="op" id="3014195">)</span>&nbsp;<span class="op" id="3014197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3014200">s</span>&nbsp;<span class="op" id="3014202">:=</span>&nbsp;<span class="op" id="3014205">&amp;</span><span class="ident" id="3014206">literalNodeSorter</span><span class="op" id="3014223">{</span><span class="ident" id="3014224">a</span><span class="op" id="3014225">,</span>&nbsp;<span class="keyword" id="3014227">func</span><span class="op" id="3014231">(</span><span class="ident" id="3014232">i</span><span class="op" id="3014233">,</span>&nbsp;<span class="ident" id="3014235">j</span>&nbsp;<span class="builtintype" id="3014237">int</span><span class="op" id="3014240">)</span>&nbsp;<span class="builtintype" id="3014242">bool</span>&nbsp;<span class="op" id="3014247">{</span>&nbsp;<span class="keyword" id="3014249">return</span>&nbsp;<span class="ident" id="3014256">a</span><span class="op" id="3014257">[</span><span class="ident" id="3014258">i</span><span class="op" id="3014259">]</span><span class="op" id="3014260">.</span><span class="ident" id="3014261">literal</span>&nbsp;<span class="op" id="3014269">&lt;</span>&nbsp;<span class="ident" id="3014271">a</span><span class="op" id="3014272">[</span><span class="ident" id="3014273">j</span><span class="op" id="3014274">]</span><span class="op" id="3014275">.</span><span class="ident" id="3014276">literal</span>&nbsp;<span class="op" id="3014284">}</span><span class="op" id="3014285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3014288">sort</span><span class="op" id="3014292">.</span><span class="ident" id="3014293">Sort</span><span class="op" id="3014297">(</span><span class="ident" id="3014298">s</span><span class="op" id="3014299">)</span><br>
<span class="lineno"></span><span class="op" id="3014301">}</span>
</div>
</body>
</html>
