<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html" class="current">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6644311">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6644367">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6644421">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6644472">package</span>&nbsp;<span class="ident" id="6644480">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6644485">import</span>&nbsp;<span class="op" id="6644492">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6644495">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6644504">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6644511">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6644517">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6644528">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6644539">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6644550">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6644557">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6644560">type</span>&nbsp;<span class="ident" id="6644565">resolveIPAddrTest</span>&nbsp;<span class="keyword" id="6644583">struct</span>&nbsp;<span class="op" id="6644590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6644593">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6644607">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6644615">litAddrOrName</span>&nbsp;<span class="builtintype" id="6644629">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6644637">addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6644651">*</span><span class="ident" id="6644652">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6644660">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6644674">error</span><br>
<span class="lineno"></span><span class="op" id="6644680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6644683">var</span>&nbsp;<span class="ident" id="6644687">resolveIPAddrTests</span>&nbsp;<span class="op" id="6644706">=</span>&nbsp;<span class="op" id="6644708">[</span><span class="op" id="6644709">]</span><span class="ident" id="6644710">resolveIPAddrTest</span><span class="op" id="6644727">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6644730">{</span><span class="string" id="6644731">&#34;ip&#34;</span><span class="op" id="6644735">,</span>&nbsp;<span class="string" id="6644737">&#34;127.0.0.1&#34;</span><span class="op" id="6644748">,</span>&nbsp;<span class="op" id="6644750">&amp;</span><span class="ident" id="6644751">IPAddr</span><span class="op" id="6644757">{</span><span class="ident" id="6644758">IP</span><span class="op" id="6644760">:</span>&nbsp;<span class="ident" id="6644762">IPv4</span><span class="op" id="6644766">(</span><span class="num" id="6644767">127</span><span class="op" id="6644770">,</span>&nbsp;<span class="num" id="6644772">0</span><span class="op" id="6644773">,</span>&nbsp;<span class="num" id="6644775">0</span><span class="op" id="6644776">,</span>&nbsp;<span class="num" id="6644778">1</span><span class="op" id="6644779">)</span><span class="op" id="6644780">}</span><span class="op" id="6644781">,</span>&nbsp;<span class="ident" id="6644783">nil</span><span class="op" id="6644786">}</span><span class="op" id="6644787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6644790">{</span><span class="string" id="6644791">&#34;ip4&#34;</span><span class="op" id="6644796">,</span>&nbsp;<span class="string" id="6644798">&#34;127.0.0.1&#34;</span><span class="op" id="6644809">,</span>&nbsp;<span class="op" id="6644811">&amp;</span><span class="ident" id="6644812">IPAddr</span><span class="op" id="6644818">{</span><span class="ident" id="6644819">IP</span><span class="op" id="6644821">:</span>&nbsp;<span class="ident" id="6644823">IPv4</span><span class="op" id="6644827">(</span><span class="num" id="6644828">127</span><span class="op" id="6644831">,</span>&nbsp;<span class="num" id="6644833">0</span><span class="op" id="6644834">,</span>&nbsp;<span class="num" id="6644836">0</span><span class="op" id="6644837">,</span>&nbsp;<span class="num" id="6644839">1</span><span class="op" id="6644840">)</span><span class="op" id="6644841">}</span><span class="op" id="6644842">,</span>&nbsp;<span class="ident" id="6644844">nil</span><span class="op" id="6644847">}</span><span class="op" id="6644848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6644851">{</span><span class="string" id="6644852">&#34;ip4:icmp&#34;</span><span class="op" id="6644862">,</span>&nbsp;<span class="string" id="6644864">&#34;127.0.0.1&#34;</span><span class="op" id="6644875">,</span>&nbsp;<span class="op" id="6644877">&amp;</span><span class="ident" id="6644878">IPAddr</span><span class="op" id="6644884">{</span><span class="ident" id="6644885">IP</span><span class="op" id="6644887">:</span>&nbsp;<span class="ident" id="6644889">IPv4</span><span class="op" id="6644893">(</span><span class="num" id="6644894">127</span><span class="op" id="6644897">,</span>&nbsp;<span class="num" id="6644899">0</span><span class="op" id="6644900">,</span>&nbsp;<span class="num" id="6644902">0</span><span class="op" id="6644903">,</span>&nbsp;<span class="num" id="6644905">1</span><span class="op" id="6644906">)</span><span class="op" id="6644907">}</span><span class="op" id="6644908">,</span>&nbsp;<span class="ident" id="6644910">nil</span><span class="op" id="6644913">}</span><span class="op" id="6644914">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6644918">{</span><span class="string" id="6644919">&#34;ip&#34;</span><span class="op" id="6644923">,</span>&nbsp;<span class="string" id="6644925">&#34;::1&#34;</span><span class="op" id="6644930">,</span>&nbsp;<span class="op" id="6644932">&amp;</span><span class="ident" id="6644933">IPAddr</span><span class="op" id="6644939">{</span><span class="ident" id="6644940">IP</span><span class="op" id="6644942">:</span>&nbsp;<span class="ident" id="6644944">ParseIP</span><span class="op" id="6644951">(</span><span class="string" id="6644952">&#34;::1&#34;</span><span class="op" id="6644957">)</span><span class="op" id="6644958">}</span><span class="op" id="6644959">,</span>&nbsp;<span class="ident" id="6644961">nil</span><span class="op" id="6644964">}</span><span class="op" id="6644965">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6644968">{</span><span class="string" id="6644969">&#34;ip6&#34;</span><span class="op" id="6644974">,</span>&nbsp;<span class="string" id="6644976">&#34;::1&#34;</span><span class="op" id="6644981">,</span>&nbsp;<span class="op" id="6644983">&amp;</span><span class="ident" id="6644984">IPAddr</span><span class="op" id="6644990">{</span><span class="ident" id="6644991">IP</span><span class="op" id="6644993">:</span>&nbsp;<span class="ident" id="6644995">ParseIP</span><span class="op" id="6645002">(</span><span class="string" id="6645003">&#34;::1&#34;</span><span class="op" id="6645008">)</span><span class="op" id="6645009">}</span><span class="op" id="6645010">,</span>&nbsp;<span class="ident" id="6645012">nil</span><span class="op" id="6645015">}</span><span class="op" id="6645016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6645019">{</span><span class="string" id="6645020">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="6645035">,</span>&nbsp;<span class="string" id="6645037">&#34;::1&#34;</span><span class="op" id="6645042">,</span>&nbsp;<span class="op" id="6645044">&amp;</span><span class="ident" id="6645045">IPAddr</span><span class="op" id="6645051">{</span><span class="ident" id="6645052">IP</span><span class="op" id="6645054">:</span>&nbsp;<span class="ident" id="6645056">ParseIP</span><span class="op" id="6645063">(</span><span class="string" id="6645064">&#34;::1&#34;</span><span class="op" id="6645069">)</span><span class="op" id="6645070">}</span><span class="op" id="6645071">,</span>&nbsp;<span class="ident" id="6645073">nil</span><span class="op" id="6645076">}</span><span class="op" id="6645077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6645080">{</span><span class="string" id="6645081">&#34;ip6:IPv6-ICMP&#34;</span><span class="op" id="6645096">,</span>&nbsp;<span class="string" id="6645098">&#34;::1&#34;</span><span class="op" id="6645103">,</span>&nbsp;<span class="op" id="6645105">&amp;</span><span class="ident" id="6645106">IPAddr</span><span class="op" id="6645112">{</span><span class="ident" id="6645113">IP</span><span class="op" id="6645115">:</span>&nbsp;<span class="ident" id="6645117">ParseIP</span><span class="op" id="6645124">(</span><span class="string" id="6645125">&#34;::1&#34;</span><span class="op" id="6645130">)</span><span class="op" id="6645131">}</span><span class="op" id="6645132">,</span>&nbsp;<span class="ident" id="6645134">nil</span><span class="op" id="6645137">}</span><span class="op" id="6645138">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6645142">{</span><span class="string" id="6645143">&#34;ip&#34;</span><span class="op" id="6645147">,</span>&nbsp;<span class="string" id="6645149">&#34;::1%en0&#34;</span><span class="op" id="6645158">,</span>&nbsp;<span class="op" id="6645160">&amp;</span><span class="ident" id="6645161">IPAddr</span><span class="op" id="6645167">{</span><span class="ident" id="6645168">IP</span><span class="op" id="6645170">:</span>&nbsp;<span class="ident" id="6645172">ParseIP</span><span class="op" id="6645179">(</span><span class="string" id="6645180">&#34;::1&#34;</span><span class="op" id="6645185">)</span><span class="op" id="6645186">,</span>&nbsp;<span class="ident" id="6645188">Zone</span><span class="op" id="6645192">:</span>&nbsp;<span class="string" id="6645194">&#34;en0&#34;</span><span class="op" id="6645199">}</span><span class="op" id="6645200">,</span>&nbsp;<span class="ident" id="6645202">nil</span><span class="op" id="6645205">}</span><span class="op" id="6645206">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6645209">{</span><span class="string" id="6645210">&#34;ip6&#34;</span><span class="op" id="6645215">,</span>&nbsp;<span class="string" id="6645217">&#34;::1%911&#34;</span><span class="op" id="6645226">,</span>&nbsp;<span class="op" id="6645228">&amp;</span><span class="ident" id="6645229">IPAddr</span><span class="op" id="6645235">{</span><span class="ident" id="6645236">IP</span><span class="op" id="6645238">:</span>&nbsp;<span class="ident" id="6645240">ParseIP</span><span class="op" id="6645247">(</span><span class="string" id="6645248">&#34;::1&#34;</span><span class="op" id="6645253">)</span><span class="op" id="6645254">,</span>&nbsp;<span class="ident" id="6645256">Zone</span><span class="op" id="6645260">:</span>&nbsp;<span class="string" id="6645262">&#34;911&#34;</span><span class="op" id="6645267">}</span><span class="op" id="6645268">,</span>&nbsp;<span class="ident" id="6645270">nil</span><span class="op" id="6645273">}</span><span class="op" id="6645274">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6645278">{</span><span class="string" id="6645279">&#34;&#34;</span><span class="op" id="6645281">,</span>&nbsp;<span class="string" id="6645283">&#34;127.0.0.1&#34;</span><span class="op" id="6645294">,</span>&nbsp;<span class="op" id="6645296">&amp;</span><span class="ident" id="6645297">IPAddr</span><span class="op" id="6645303">{</span><span class="ident" id="6645304">IP</span><span class="op" id="6645306">:</span>&nbsp;<span class="ident" id="6645308">IPv4</span><span class="op" id="6645312">(</span><span class="num" id="6645313">127</span><span class="op" id="6645316">,</span>&nbsp;<span class="num" id="6645318">0</span><span class="op" id="6645319">,</span>&nbsp;<span class="num" id="6645321">0</span><span class="op" id="6645322">,</span>&nbsp;<span class="num" id="6645324">1</span><span class="op" id="6645325">)</span><span class="op" id="6645326">}</span><span class="op" id="6645327">,</span>&nbsp;<span class="ident" id="6645329">nil</span><span class="op" id="6645332">}</span><span class="op" id="6645333">,</span>&nbsp;<span class="comment" id="6645335">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6645355">{</span><span class="string" id="6645356">&#34;&#34;</span><span class="op" id="6645358">,</span>&nbsp;<span class="string" id="6645360">&#34;::1&#34;</span><span class="op" id="6645365">,</span>&nbsp;<span class="op" id="6645367">&amp;</span><span class="ident" id="6645368">IPAddr</span><span class="op" id="6645374">{</span><span class="ident" id="6645375">IP</span><span class="op" id="6645377">:</span>&nbsp;<span class="ident" id="6645379">ParseIP</span><span class="op" id="6645386">(</span><span class="string" id="6645387">&#34;::1&#34;</span><span class="op" id="6645392">)</span><span class="op" id="6645393">}</span><span class="op" id="6645394">,</span>&nbsp;<span class="ident" id="6645396">nil</span><span class="op" id="6645399">}</span><span class="op" id="6645400">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6645412">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6645433">{</span><span class="string" id="6645434">&#34;l2tp&#34;</span><span class="op" id="6645440">,</span>&nbsp;<span class="string" id="6645442">&#34;127.0.0.1&#34;</span><span class="op" id="6645453">,</span>&nbsp;<span class="ident" id="6645455">nil</span><span class="op" id="6645458">,</span>&nbsp;<span class="ident" id="6645460">UnknownNetworkError</span><span class="op" id="6645479">(</span><span class="string" id="6645480">&#34;l2tp&#34;</span><span class="op" id="6645486">)</span><span class="op" id="6645487">}</span><span class="op" id="6645488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6645491">{</span><span class="string" id="6645492">&#34;l2tp:gre&#34;</span><span class="op" id="6645502">,</span>&nbsp;<span class="string" id="6645504">&#34;127.0.0.1&#34;</span><span class="op" id="6645515">,</span>&nbsp;<span class="ident" id="6645517">nil</span><span class="op" id="6645520">,</span>&nbsp;<span class="ident" id="6645522">UnknownNetworkError</span><span class="op" id="6645541">(</span><span class="string" id="6645542">&#34;l2tp:gre&#34;</span><span class="op" id="6645552">)</span><span class="op" id="6645553">}</span><span class="op" id="6645554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6645557">{</span><span class="string" id="6645558">&#34;tcp&#34;</span><span class="op" id="6645563">,</span>&nbsp;<span class="string" id="6645565">&#34;1.2.3.4:123&#34;</span><span class="op" id="6645578">,</span>&nbsp;<span class="ident" id="6645580">nil</span><span class="op" id="6645583">,</span>&nbsp;<span class="ident" id="6645585">UnknownNetworkError</span><span class="op" id="6645604">(</span><span class="string" id="6645605">&#34;tcp&#34;</span><span class="op" id="6645610">)</span><span class="op" id="6645611">}</span><span class="op" id="6645612">,</span><br>
<span class="lineno"></span><span class="op" id="6645614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="6645617">func</span>&nbsp;<span class="ident" id="6645622">init</span><span class="op" id="6645626">(</span><span class="op" id="6645627">)</span>&nbsp;<span class="op" id="6645629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6645632">if</span>&nbsp;<span class="ident" id="6645635">ifi</span>&nbsp;<span class="op" id="6645639">:=</span>&nbsp;<span class="ident" id="6645642">loopbackInterface</span><span class="op" id="6645659">(</span><span class="op" id="6645660">)</span><span class="op" id="6645661">;</span>&nbsp;<span class="ident" id="6645663">ifi</span>&nbsp;<span class="op" id="6645667">!=</span>&nbsp;<span class="ident" id="6645670">nil</span>&nbsp;<span class="op" id="6645674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6645678">index</span>&nbsp;<span class="op" id="6645684">:=</span>&nbsp;<span class="ident" id="6645687">fmt</span><span class="op" id="6645690">.</span><span class="ident" id="6645691">Sprintf</span><span class="op" id="6645698">(</span><span class="string" id="6645699">&#34;%v&#34;</span><span class="op" id="6645703">,</span>&nbsp;<span class="ident" id="6645705">ifi</span><span class="op" id="6645708">.</span><span class="ident" id="6645709">Index</span><span class="op" id="6645714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6645718">resolveIPAddrTests</span>&nbsp;<span class="op" id="6645737">=</span>&nbsp;<span class="builtinfunc" id="6645739">append</span><span class="op" id="6645745">(</span><span class="ident" id="6645746">resolveIPAddrTests</span><span class="op" id="6645764">,</span>&nbsp;<span class="op" id="6645766">[</span><span class="op" id="6645767">]</span><span class="ident" id="6645768">resolveIPAddrTest</span><span class="op" id="6645785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6645790">{</span><span class="string" id="6645791">&#34;ip6&#34;</span><span class="op" id="6645796">,</span>&nbsp;<span class="string" id="6645798">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="6645809">+</span>&nbsp;<span class="ident" id="6645811">ifi</span><span class="op" id="6645814">.</span><span class="ident" id="6645815">Name</span><span class="op" id="6645819">,</span>&nbsp;<span class="op" id="6645821">&amp;</span><span class="ident" id="6645822">IPAddr</span><span class="op" id="6645828">{</span><span class="ident" id="6645829">IP</span><span class="op" id="6645831">:</span>&nbsp;<span class="ident" id="6645833">ParseIP</span><span class="op" id="6645840">(</span><span class="string" id="6645841">&#34;fe80::1&#34;</span><span class="op" id="6645850">)</span><span class="op" id="6645851">,</span>&nbsp;<span class="ident" id="6645853">Zone</span><span class="op" id="6645857">:</span>&nbsp;<span class="ident" id="6645859">zoneToString</span><span class="op" id="6645871">(</span><span class="ident" id="6645872">ifi</span><span class="op" id="6645875">.</span><span class="ident" id="6645876">Index</span><span class="op" id="6645881">)</span><span class="op" id="6645882">}</span><span class="op" id="6645883">,</span>&nbsp;<span class="ident" id="6645885">nil</span><span class="op" id="6645888">}</span><span class="op" id="6645889">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6645894">{</span><span class="string" id="6645895">&#34;ip6&#34;</span><span class="op" id="6645900">,</span>&nbsp;<span class="string" id="6645902">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="6645913">+</span>&nbsp;<span class="ident" id="6645915">index</span><span class="op" id="6645920">,</span>&nbsp;<span class="op" id="6645922">&amp;</span><span class="ident" id="6645923">IPAddr</span><span class="op" id="6645929">{</span><span class="ident" id="6645930">IP</span><span class="op" id="6645932">:</span>&nbsp;<span class="ident" id="6645934">ParseIP</span><span class="op" id="6645941">(</span><span class="string" id="6645942">&#34;fe80::1&#34;</span><span class="op" id="6645951">)</span><span class="op" id="6645952">,</span>&nbsp;<span class="ident" id="6645954">Zone</span><span class="op" id="6645958">:</span>&nbsp;<span class="ident" id="6645960">index</span><span class="op" id="6645965">}</span><span class="op" id="6645966">,</span>&nbsp;<span class="ident" id="6645968">nil</span><span class="op" id="6645971">}</span><span class="op" id="6645972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6645976">}</span><span class="op" id="6645977">...</span><span class="op" id="6645980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6645983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6645986">if</span>&nbsp;<span class="ident" id="6645989">ips</span><span class="op" id="6645992">,</span>&nbsp;<span class="ident" id="6645994">err</span>&nbsp;<span class="op" id="6645998">:=</span>&nbsp;<span class="ident" id="6646001">LookupIP</span><span class="op" id="6646009">(</span><span class="string" id="6646010">&#34;localhost&#34;</span><span class="op" id="6646021">)</span><span class="op" id="6646022">;</span>&nbsp;<span class="ident" id="6646024">err</span>&nbsp;<span class="op" id="6646028">==</span>&nbsp;<span class="ident" id="6646031">nil</span>&nbsp;<span class="op" id="6646035">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6646038">len</span><span class="op" id="6646041">(</span><span class="ident" id="6646042">ips</span><span class="op" id="6646045">)</span>&nbsp;<span class="op" id="6646047">&gt;</span>&nbsp;<span class="num" id="6646049">1</span>&nbsp;<span class="op" id="6646051">&amp;&amp;</span>&nbsp;<span class="ident" id="6646054">supportsIPv4</span>&nbsp;<span class="op" id="6646067">&amp;&amp;</span>&nbsp;<span class="ident" id="6646070">supportsIPv6</span>&nbsp;<span class="op" id="6646083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6646087">resolveIPAddrTests</span>&nbsp;<span class="op" id="6646106">=</span>&nbsp;<span class="builtinfunc" id="6646108">append</span><span class="op" id="6646114">(</span><span class="ident" id="6646115">resolveIPAddrTests</span><span class="op" id="6646133">,</span>&nbsp;<span class="op" id="6646135">[</span><span class="op" id="6646136">]</span><span class="ident" id="6646137">resolveIPAddrTest</span><span class="op" id="6646154">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6646159">{</span><span class="string" id="6646160">&#34;ip&#34;</span><span class="op" id="6646164">,</span>&nbsp;<span class="string" id="6646166">&#34;localhost&#34;</span><span class="op" id="6646177">,</span>&nbsp;<span class="op" id="6646179">&amp;</span><span class="ident" id="6646180">IPAddr</span><span class="op" id="6646186">{</span><span class="ident" id="6646187">IP</span><span class="op" id="6646189">:</span>&nbsp;<span class="ident" id="6646191">IPv4</span><span class="op" id="6646195">(</span><span class="num" id="6646196">127</span><span class="op" id="6646199">,</span>&nbsp;<span class="num" id="6646201">0</span><span class="op" id="6646202">,</span>&nbsp;<span class="num" id="6646204">0</span><span class="op" id="6646205">,</span>&nbsp;<span class="num" id="6646207">1</span><span class="op" id="6646208">)</span><span class="op" id="6646209">}</span><span class="op" id="6646210">,</span>&nbsp;<span class="ident" id="6646212">nil</span><span class="op" id="6646215">}</span><span class="op" id="6646216">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6646221">{</span><span class="string" id="6646222">&#34;ip4&#34;</span><span class="op" id="6646227">,</span>&nbsp;<span class="string" id="6646229">&#34;localhost&#34;</span><span class="op" id="6646240">,</span>&nbsp;<span class="op" id="6646242">&amp;</span><span class="ident" id="6646243">IPAddr</span><span class="op" id="6646249">{</span><span class="ident" id="6646250">IP</span><span class="op" id="6646252">:</span>&nbsp;<span class="ident" id="6646254">IPv4</span><span class="op" id="6646258">(</span><span class="num" id="6646259">127</span><span class="op" id="6646262">,</span>&nbsp;<span class="num" id="6646264">0</span><span class="op" id="6646265">,</span>&nbsp;<span class="num" id="6646267">0</span><span class="op" id="6646268">,</span>&nbsp;<span class="num" id="6646270">1</span><span class="op" id="6646271">)</span><span class="op" id="6646272">}</span><span class="op" id="6646273">,</span>&nbsp;<span class="ident" id="6646275">nil</span><span class="op" id="6646278">}</span><span class="op" id="6646279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6646284">{</span><span class="string" id="6646285">&#34;ip6&#34;</span><span class="op" id="6646290">,</span>&nbsp;<span class="string" id="6646292">&#34;localhost&#34;</span><span class="op" id="6646303">,</span>&nbsp;<span class="op" id="6646305">&amp;</span><span class="ident" id="6646306">IPAddr</span><span class="op" id="6646312">{</span><span class="ident" id="6646313">IP</span><span class="op" id="6646315">:</span>&nbsp;<span class="ident" id="6646317">IPv6loopback</span><span class="op" id="6646329">}</span><span class="op" id="6646330">,</span>&nbsp;<span class="ident" id="6646332">nil</span><span class="op" id="6646335">}</span><span class="op" id="6646336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6646340">}</span><span class="op" id="6646341">...</span><span class="op" id="6646344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6646347">}</span><br>
<span class="lineno">60</span><span class="op" id="6646349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6646352">func</span>&nbsp;<span class="ident" id="6646357">skipRawSocketTest</span><span class="op" id="6646374">(</span><span class="ident" id="6646375">t</span>&nbsp;<span class="op" id="6646377">*</span><span class="ident" id="6646378">testing</span><span class="op" id="6646385">.</span><span class="ident" id="6646386">T</span><span class="op" id="6646387">)</span>&nbsp;<span class="op" id="6646389">(</span><span class="ident" id="6646390">skip</span>&nbsp;<span class="builtintype" id="6646395">bool</span><span class="op" id="6646399">,</span>&nbsp;<span class="ident" id="6646401">skipmsg</span>&nbsp;<span class="builtintype" id="6646409">string</span><span class="op" id="6646415">)</span>&nbsp;<span class="op" id="6646417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6646420">skip</span><span class="op" id="6646424">,</span>&nbsp;<span class="ident" id="6646426">skipmsg</span><span class="op" id="6646433">,</span>&nbsp;<span class="ident" id="6646435">err</span>&nbsp;<span class="op" id="6646439">:=</span>&nbsp;<span class="ident" id="6646442">skipRawSocketTests</span><span class="op" id="6646460">(</span><span class="op" id="6646461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6646464">if</span>&nbsp;<span class="ident" id="6646467">err</span>&nbsp;<span class="op" id="6646471">!=</span>&nbsp;<span class="ident" id="6646474">nil</span>&nbsp;<span class="op" id="6646478">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6646482">t</span><span class="op" id="6646483">.</span><span class="ident" id="6646484">Fatal</span><span class="op" id="6646489">(</span><span class="ident" id="6646490">err</span><span class="op" id="6646493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6646496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6646499">return</span>&nbsp;<span class="ident" id="6646506">skip</span><span class="op" id="6646510">,</span>&nbsp;<span class="ident" id="6646512">skipmsg</span><br>
<span class="lineno"></span><span class="op" id="6646520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="6646523">func</span>&nbsp;<span class="ident" id="6646528">TestResolveIPAddr</span><span class="op" id="6646545">(</span><span class="ident" id="6646546">t</span>&nbsp;<span class="op" id="6646548">*</span><span class="ident" id="6646549">testing</span><span class="op" id="6646556">.</span><span class="ident" id="6646557">T</span><span class="op" id="6646558">)</span>&nbsp;<span class="op" id="6646560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6646563">switch</span>&nbsp;<span class="ident" id="6646570">runtime</span><span class="op" id="6646577">.</span><span class="ident" id="6646578">GOOS</span>&nbsp;<span class="op" id="6646583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6646586">case</span>&nbsp;<span class="string" id="6646591">&#34;nacl&#34;</span><span class="op" id="6646597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6646601">t</span><span class="op" id="6646602">.</span><span class="ident" id="6646603">Skipf</span><span class="op" id="6646608">(</span><span class="string" id="6646609">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6646630">,</span>&nbsp;<span class="ident" id="6646632">runtime</span><span class="op" id="6646639">.</span><span class="ident" id="6646640">GOOS</span><span class="op" id="6646644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6646647">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6646651">for</span>&nbsp;<span class="ident" id="6646655">_</span><span class="op" id="6646656">,</span>&nbsp;<span class="ident" id="6646658">tt</span>&nbsp;<span class="op" id="6646661">:=</span>&nbsp;<span class="keyword" id="6646664">range</span>&nbsp;<span class="ident" id="6646670">resolveIPAddrTests</span>&nbsp;<span class="op" id="6646689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6646693">addr</span><span class="op" id="6646697">,</span>&nbsp;<span class="ident" id="6646699">err</span>&nbsp;<span class="op" id="6646703">:=</span>&nbsp;<span class="ident" id="6646706">ResolveIPAddr</span><span class="op" id="6646719">(</span><span class="ident" id="6646720">tt</span><span class="op" id="6646722">.</span><span class="ident" id="6646723">net</span><span class="op" id="6646726">,</span>&nbsp;<span class="ident" id="6646728">tt</span><span class="op" id="6646730">.</span><span class="ident" id="6646731">litAddrOrName</span><span class="op" id="6646744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6646748">if</span>&nbsp;<span class="ident" id="6646751">err</span>&nbsp;<span class="op" id="6646755">!=</span>&nbsp;<span class="ident" id="6646758">tt</span><span class="op" id="6646760">.</span><span class="ident" id="6646761">err</span>&nbsp;<span class="op" id="6646765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6646770">t</span><span class="op" id="6646771">.</span><span class="ident" id="6646772">Fatalf</span><span class="op" id="6646778">(</span><span class="string" id="6646779">&#34;ResolveIPAddr(%v,&nbsp;%v)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6646813">,</span>&nbsp;<span class="ident" id="6646815">tt</span><span class="op" id="6646817">.</span><span class="ident" id="6646818">net</span><span class="op" id="6646821">,</span>&nbsp;<span class="ident" id="6646823">tt</span><span class="op" id="6646825">.</span><span class="ident" id="6646826">litAddrOrName</span><span class="op" id="6646839">,</span>&nbsp;<span class="ident" id="6646841">err</span><span class="op" id="6646844">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6646848">}</span>&nbsp;<span class="keyword" id="6646850">else</span>&nbsp;<span class="keyword" id="6646855">if</span>&nbsp;<span class="op" id="6646858">!</span><span class="ident" id="6646859">reflect</span><span class="op" id="6646866">.</span><span class="ident" id="6646867">DeepEqual</span><span class="op" id="6646876">(</span><span class="ident" id="6646877">addr</span><span class="op" id="6646881">,</span>&nbsp;<span class="ident" id="6646883">tt</span><span class="op" id="6646885">.</span><span class="ident" id="6646886">addr</span><span class="op" id="6646890">)</span>&nbsp;<span class="op" id="6646892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6646897">t</span><span class="op" id="6646898">.</span><span class="ident" id="6646899">Fatalf</span><span class="op" id="6646905">(</span><span class="string" id="6646906">&#34;got&nbsp;%#v;&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6646929">,</span>&nbsp;<span class="ident" id="6646931">addr</span><span class="op" id="6646935">,</span>&nbsp;<span class="ident" id="6646937">tt</span><span class="op" id="6646939">.</span><span class="ident" id="6646940">addr</span><span class="op" id="6646944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6646948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6646951">}</span><br>
<span class="lineno"></span><span class="op" id="6646953">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="6646956">var</span>&nbsp;<span class="ident" id="6646960">icmpEchoTests</span>&nbsp;<span class="op" id="6646974">=</span>&nbsp;<span class="op" id="6646976">[</span><span class="op" id="6646977">]</span><span class="keyword" id="6646978">struct</span>&nbsp;<span class="op" id="6646985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6646988">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6646994">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647002">laddr</span>&nbsp;<span class="builtintype" id="6647008">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647016">raddr</span>&nbsp;<span class="builtintype" id="6647022">string</span><br>
<span class="lineno">90</span><span class="op" id="6647029">}</span><span class="op" id="6647030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6647033">{</span><span class="string" id="6647034">&#34;ip4:icmp&#34;</span><span class="op" id="6647044">,</span>&nbsp;<span class="string" id="6647046">&#34;0.0.0.0&#34;</span><span class="op" id="6647055">,</span>&nbsp;<span class="string" id="6647057">&#34;127.0.0.1&#34;</span><span class="op" id="6647068">}</span><span class="op" id="6647069">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6647072">{</span><span class="string" id="6647073">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="6647088">,</span>&nbsp;<span class="string" id="6647090">&#34;::&#34;</span><span class="op" id="6647094">,</span>&nbsp;<span class="string" id="6647096">&#34;::1&#34;</span><span class="op" id="6647101">}</span><span class="op" id="6647102">,</span><br>
<span class="lineno"></span><span class="op" id="6647104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6647107">func</span>&nbsp;<span class="ident" id="6647112">TestConnICMPEcho</span><span class="op" id="6647128">(</span><span class="ident" id="6647129">t</span>&nbsp;<span class="op" id="6647131">*</span><span class="ident" id="6647132">testing</span><span class="op" id="6647139">.</span><span class="ident" id="6647140">T</span><span class="op" id="6647141">)</span>&nbsp;<span class="op" id="6647143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6647146">if</span>&nbsp;<span class="ident" id="6647149">skip</span><span class="op" id="6647153">,</span>&nbsp;<span class="ident" id="6647155">skipmsg</span>&nbsp;<span class="op" id="6647163">:=</span>&nbsp;<span class="ident" id="6647166">skipRawSocketTest</span><span class="op" id="6647183">(</span><span class="ident" id="6647184">t</span><span class="op" id="6647185">)</span><span class="op" id="6647186">;</span>&nbsp;<span class="ident" id="6647188">skip</span>&nbsp;<span class="op" id="6647193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647197">t</span><span class="op" id="6647198">.</span><span class="ident" id="6647199">Skip</span><span class="op" id="6647203">(</span><span class="ident" id="6647204">skipmsg</span><span class="op" id="6647211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6647214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6647218">for</span>&nbsp;<span class="ident" id="6647222">i</span><span class="op" id="6647223">,</span>&nbsp;<span class="ident" id="6647225">tt</span>&nbsp;<span class="op" id="6647228">:=</span>&nbsp;<span class="keyword" id="6647231">range</span>&nbsp;<span class="ident" id="6647237">icmpEchoTests</span>&nbsp;<span class="op" id="6647251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647255">net</span><span class="op" id="6647258">,</span>&nbsp;<span class="ident" id="6647260">_</span><span class="op" id="6647261">,</span>&nbsp;<span class="ident" id="6647263">err</span>&nbsp;<span class="op" id="6647267">:=</span>&nbsp;<span class="ident" id="6647270">parseNetwork</span><span class="op" id="6647282">(</span><span class="ident" id="6647283">tt</span><span class="op" id="6647285">.</span><span class="ident" id="6647286">net</span><span class="op" id="6647289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6647293">if</span>&nbsp;<span class="ident" id="6647296">err</span>&nbsp;<span class="op" id="6647300">!=</span>&nbsp;<span class="ident" id="6647303">nil</span>&nbsp;<span class="op" id="6647307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647312">t</span><span class="op" id="6647313">.</span><span class="ident" id="6647314">Fatalf</span><span class="op" id="6647320">(</span><span class="string" id="6647321">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6647346">,</span>&nbsp;<span class="ident" id="6647348">err</span><span class="op" id="6647351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6647355">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6647359">if</span>&nbsp;<span class="ident" id="6647362">net</span>&nbsp;<span class="op" id="6647366">==</span>&nbsp;<span class="string" id="6647369">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6647375">&amp;&amp;</span>&nbsp;<span class="op" id="6647378">!</span><span class="ident" id="6647379">supportsIPv6</span>&nbsp;<span class="op" id="6647392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6647397">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6647408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647413">c</span><span class="op" id="6647414">,</span>&nbsp;<span class="ident" id="6647416">err</span>&nbsp;<span class="op" id="6647420">:=</span>&nbsp;<span class="ident" id="6647423">Dial</span><span class="op" id="6647427">(</span><span class="ident" id="6647428">tt</span><span class="op" id="6647430">.</span><span class="ident" id="6647431">net</span><span class="op" id="6647434">,</span>&nbsp;<span class="ident" id="6647436">tt</span><span class="op" id="6647438">.</span><span class="ident" id="6647439">raddr</span><span class="op" id="6647444">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6647448">if</span>&nbsp;<span class="ident" id="6647451">err</span>&nbsp;<span class="op" id="6647455">!=</span>&nbsp;<span class="ident" id="6647458">nil</span>&nbsp;<span class="op" id="6647462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647467">t</span><span class="op" id="6647468">.</span><span class="ident" id="6647469">Fatalf</span><span class="op" id="6647475">(</span><span class="string" id="6647476">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6647493">,</span>&nbsp;<span class="ident" id="6647495">err</span><span class="op" id="6647498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6647502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647506">c</span><span class="op" id="6647507">.</span><span class="ident" id="6647508">SetDeadline</span><span class="op" id="6647519">(</span><span class="ident" id="6647520">time</span><span class="op" id="6647524">.</span><span class="ident" id="6647525">Now</span><span class="op" id="6647528">(</span><span class="op" id="6647529">)</span><span class="op" id="6647530">.</span><span class="ident" id="6647531">Add</span><span class="op" id="6647534">(</span><span class="num" id="6647535">100</span>&nbsp;<span class="op" id="6647539">*</span>&nbsp;<span class="ident" id="6647541">time</span><span class="op" id="6647545">.</span><span class="ident" id="6647546">Millisecond</span><span class="op" id="6647557">)</span><span class="op" id="6647558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6647562">defer</span>&nbsp;<span class="ident" id="6647568">c</span><span class="op" id="6647569">.</span><span class="ident" id="6647570">Close</span><span class="op" id="6647575">(</span><span class="op" id="6647576">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647581">typ</span>&nbsp;<span class="op" id="6647585">:=</span>&nbsp;<span class="ident" id="6647588">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6647608">if</span>&nbsp;<span class="ident" id="6647611">net</span>&nbsp;<span class="op" id="6647615">==</span>&nbsp;<span class="string" id="6647618">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6647624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647629">typ</span>&nbsp;<span class="op" id="6647633">=</span>&nbsp;<span class="ident" id="6647635">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6647655">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647659">xid</span><span class="op" id="6647662">,</span>&nbsp;<span class="ident" id="6647664">xseq</span>&nbsp;<span class="op" id="6647669">:=</span>&nbsp;<span class="ident" id="6647672">os</span><span class="op" id="6647674">.</span><span class="ident" id="6647675">Getpid</span><span class="op" id="6647681">(</span><span class="op" id="6647682">)</span><span class="op" id="6647683">&amp;</span><span class="num" id="6647684">0xffff</span><span class="op" id="6647690">,</span>&nbsp;<span class="ident" id="6647692">i</span><span class="op" id="6647693">+</span><span class="num" id="6647694">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647698">wb</span><span class="op" id="6647700">,</span>&nbsp;<span class="ident" id="6647702">err</span>&nbsp;<span class="op" id="6647706">:=</span>&nbsp;<span class="op" id="6647709">(</span><span class="op" id="6647710">&amp;</span><span class="ident" id="6647711">icmpMessage</span><span class="op" id="6647722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647727">Type</span><span class="op" id="6647731">:</span>&nbsp;<span class="ident" id="6647733">typ</span><span class="op" id="6647736">,</span>&nbsp;<span class="ident" id="6647738">Code</span><span class="op" id="6647742">:</span>&nbsp;<span class="num" id="6647744">0</span><span class="op" id="6647745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647750">Body</span><span class="op" id="6647754">:</span>&nbsp;<span class="op" id="6647756">&amp;</span><span class="ident" id="6647757">icmpEcho</span><span class="op" id="6647765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647771">ID</span><span class="op" id="6647773">:</span>&nbsp;<span class="ident" id="6647775">xid</span><span class="op" id="6647778">,</span>&nbsp;<span class="ident" id="6647780">Seq</span><span class="op" id="6647783">:</span>&nbsp;<span class="ident" id="6647785">xseq</span><span class="op" id="6647789">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647795">Data</span><span class="op" id="6647799">:</span>&nbsp;<span class="ident" id="6647801">bytes</span><span class="op" id="6647806">.</span><span class="ident" id="6647807">Repeat</span><span class="op" id="6647813">(</span><span class="op" id="6647814">[</span><span class="op" id="6647815">]</span><span class="builtintype" id="6647816">byte</span><span class="op" id="6647820">(</span><span class="string" id="6647821">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="6647843">)</span><span class="op" id="6647844">,</span>&nbsp;<span class="num" id="6647846">3</span><span class="op" id="6647847">)</span><span class="op" id="6647848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6647853">}</span><span class="op" id="6647854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6647858">}</span><span class="op" id="6647859">)</span><span class="op" id="6647860">.</span><span class="ident" id="6647861">Marshal</span><span class="op" id="6647868">(</span><span class="op" id="6647869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6647873">if</span>&nbsp;<span class="ident" id="6647876">err</span>&nbsp;<span class="op" id="6647880">!=</span>&nbsp;<span class="ident" id="6647883">nil</span>&nbsp;<span class="op" id="6647887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647892">t</span><span class="op" id="6647893">.</span><span class="ident" id="6647894">Fatalf</span><span class="op" id="6647900">(</span><span class="string" id="6647901">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6647933">,</span>&nbsp;<span class="ident" id="6647935">err</span><span class="op" id="6647938">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6647942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6647946">if</span>&nbsp;<span class="ident" id="6647949">_</span><span class="op" id="6647950">,</span>&nbsp;<span class="ident" id="6647952">err</span>&nbsp;<span class="op" id="6647956">:=</span>&nbsp;<span class="ident" id="6647959">c</span><span class="op" id="6647960">.</span><span class="ident" id="6647961">Write</span><span class="op" id="6647966">(</span><span class="ident" id="6647967">wb</span><span class="op" id="6647969">)</span><span class="op" id="6647970">;</span>&nbsp;<span class="ident" id="6647972">err</span>&nbsp;<span class="op" id="6647976">!=</span>&nbsp;<span class="ident" id="6647979">nil</span>&nbsp;<span class="op" id="6647983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647988">t</span><span class="op" id="6647989">.</span><span class="ident" id="6647990">Fatalf</span><span class="op" id="6647996">(</span><span class="string" id="6647997">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6648020">,</span>&nbsp;<span class="ident" id="6648022">err</span><span class="op" id="6648025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6648029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648033">var</span>&nbsp;<span class="ident" id="6648037">m</span>&nbsp;<span class="op" id="6648039">*</span><span class="ident" id="6648040">icmpMessage</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648054">rb</span>&nbsp;<span class="op" id="6648057">:=</span>&nbsp;<span class="builtinfunc" id="6648060">make</span><span class="op" id="6648064">(</span><span class="op" id="6648065">[</span><span class="op" id="6648066">]</span><span class="builtintype" id="6648067">byte</span><span class="op" id="6648071">,</span>&nbsp;<span class="num" id="6648073">20</span><span class="op" id="6648075">+</span><span class="builtinfunc" id="6648076">len</span><span class="op" id="6648079">(</span><span class="ident" id="6648080">wb</span><span class="op" id="6648082">)</span><span class="op" id="6648083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648087">for</span>&nbsp;<span class="op" id="6648091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648096">if</span>&nbsp;<span class="ident" id="6648099">_</span><span class="op" id="6648100">,</span>&nbsp;<span class="ident" id="6648102">err</span>&nbsp;<span class="op" id="6648106">:=</span>&nbsp;<span class="ident" id="6648109">c</span><span class="op" id="6648110">.</span><span class="ident" id="6648111">Read</span><span class="op" id="6648115">(</span><span class="ident" id="6648116">rb</span><span class="op" id="6648118">)</span><span class="op" id="6648119">;</span>&nbsp;<span class="ident" id="6648121">err</span>&nbsp;<span class="op" id="6648125">!=</span>&nbsp;<span class="ident" id="6648128">nil</span>&nbsp;<span class="op" id="6648132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648138">t</span><span class="op" id="6648139">.</span><span class="ident" id="6648140">Fatalf</span><span class="op" id="6648146">(</span><span class="string" id="6648147">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6648169">,</span>&nbsp;<span class="ident" id="6648171">err</span><span class="op" id="6648174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6648179">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648184">if</span>&nbsp;<span class="ident" id="6648187">net</span>&nbsp;<span class="op" id="6648191">==</span>&nbsp;<span class="string" id="6648194">&#34;ip4&#34;</span>&nbsp;<span class="op" id="6648200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648206">rb</span>&nbsp;<span class="op" id="6648209">=</span>&nbsp;<span class="ident" id="6648211">ipv4Payload</span><span class="op" id="6648222">(</span><span class="ident" id="6648223">rb</span><span class="op" id="6648225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6648230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648235">if</span>&nbsp;<span class="ident" id="6648238">m</span><span class="op" id="6648239">,</span>&nbsp;<span class="ident" id="6648241">err</span>&nbsp;<span class="op" id="6648245">=</span>&nbsp;<span class="ident" id="6648247">parseICMPMessage</span><span class="op" id="6648263">(</span><span class="ident" id="6648264">rb</span><span class="op" id="6648266">)</span><span class="op" id="6648267">;</span>&nbsp;<span class="ident" id="6648269">err</span>&nbsp;<span class="op" id="6648273">!=</span>&nbsp;<span class="ident" id="6648276">nil</span>&nbsp;<span class="op" id="6648280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648286">t</span><span class="op" id="6648287">.</span><span class="ident" id="6648288">Fatalf</span><span class="op" id="6648294">(</span><span class="string" id="6648295">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6648324">,</span>&nbsp;<span class="ident" id="6648326">err</span><span class="op" id="6648329">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6648334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648339">switch</span>&nbsp;<span class="ident" id="6648346">m</span><span class="op" id="6648347">.</span><span class="ident" id="6648348">Type</span>&nbsp;<span class="op" id="6648353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648358">case</span>&nbsp;<span class="ident" id="6648363">icmpv4EchoRequest</span><span class="op" id="6648380">,</span>&nbsp;<span class="ident" id="6648382">icmpv6EchoRequest</span><span class="op" id="6648399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648405">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6648417">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648422">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6648430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648434">switch</span>&nbsp;<span class="ident" id="6648441">p</span>&nbsp;<span class="op" id="6648443">:=</span>&nbsp;<span class="ident" id="6648446">m</span><span class="op" id="6648447">.</span><span class="ident" id="6648448">Body</span><span class="op" id="6648452">.</span><span class="op" id="6648453">(</span><span class="keyword" id="6648454">type</span><span class="op" id="6648458">)</span>&nbsp;<span class="op" id="6648460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648464">case</span>&nbsp;<span class="op" id="6648469">*</span><span class="ident" id="6648470">icmpEcho</span><span class="op" id="6648478">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648483">if</span>&nbsp;<span class="ident" id="6648486">p</span><span class="op" id="6648487">.</span><span class="ident" id="6648488">ID</span>&nbsp;<span class="op" id="6648491">!=</span>&nbsp;<span class="ident" id="6648494">xid</span>&nbsp;<span class="op" id="6648498">||</span>&nbsp;<span class="ident" id="6648501">p</span><span class="op" id="6648502">.</span><span class="ident" id="6648503">Seq</span>&nbsp;<span class="op" id="6648507">!=</span>&nbsp;<span class="ident" id="6648510">xseq</span>&nbsp;<span class="op" id="6648515">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648521">t</span><span class="op" id="6648522">.</span><span class="ident" id="6648523">Fatalf</span><span class="op" id="6648529">(</span><span class="string" id="6648530">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="6648579">,</span>&nbsp;<span class="ident" id="6648581">p</span><span class="op" id="6648582">.</span><span class="ident" id="6648583">ID</span><span class="op" id="6648585">,</span>&nbsp;<span class="ident" id="6648587">p</span><span class="op" id="6648588">.</span><span class="ident" id="6648589">Seq</span><span class="op" id="6648592">,</span>&nbsp;<span class="ident" id="6648594">xid</span><span class="op" id="6648597">,</span>&nbsp;<span class="ident" id="6648599">xseq</span><span class="op" id="6648603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6648608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648612">default</span><span class="op" id="6648619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648624">t</span><span class="op" id="6648625">.</span><span class="ident" id="6648626">Fatalf</span><span class="op" id="6648632">(</span><span class="string" id="6648633">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="6648682">,</span>&nbsp;<span class="ident" id="6648684">m</span><span class="op" id="6648685">.</span><span class="ident" id="6648686">Type</span><span class="op" id="6648690">,</span>&nbsp;<span class="ident" id="6648692">m</span><span class="op" id="6648693">.</span><span class="ident" id="6648694">Code</span><span class="op" id="6648698">,</span>&nbsp;<span class="ident" id="6648700">typ</span><span class="op" id="6648703">,</span>&nbsp;<span class="num" id="6648705">0</span><span class="op" id="6648706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6648710">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6648713">}</span><br>
<span class="lineno"></span><span class="op" id="6648715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6648718">func</span>&nbsp;<span class="ident" id="6648723">TestPacketConnICMPEcho</span><span class="op" id="6648745">(</span><span class="ident" id="6648746">t</span>&nbsp;<span class="op" id="6648748">*</span><span class="ident" id="6648749">testing</span><span class="op" id="6648756">.</span><span class="ident" id="6648757">T</span><span class="op" id="6648758">)</span>&nbsp;<span class="op" id="6648760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648763">if</span>&nbsp;<span class="ident" id="6648766">skip</span><span class="op" id="6648770">,</span>&nbsp;<span class="ident" id="6648772">skipmsg</span>&nbsp;<span class="op" id="6648780">:=</span>&nbsp;<span class="ident" id="6648783">skipRawSocketTest</span><span class="op" id="6648800">(</span><span class="ident" id="6648801">t</span><span class="op" id="6648802">)</span><span class="op" id="6648803">;</span>&nbsp;<span class="ident" id="6648805">skip</span>&nbsp;<span class="op" id="6648810">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648814">t</span><span class="op" id="6648815">.</span><span class="ident" id="6648816">Skip</span><span class="op" id="6648820">(</span><span class="ident" id="6648821">skipmsg</span><span class="op" id="6648828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6648831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648835">for</span>&nbsp;<span class="ident" id="6648839">i</span><span class="op" id="6648840">,</span>&nbsp;<span class="ident" id="6648842">tt</span>&nbsp;<span class="op" id="6648845">:=</span>&nbsp;<span class="keyword" id="6648848">range</span>&nbsp;<span class="ident" id="6648854">icmpEchoTests</span>&nbsp;<span class="op" id="6648868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648872">net</span><span class="op" id="6648875">,</span>&nbsp;<span class="ident" id="6648877">_</span><span class="op" id="6648878">,</span>&nbsp;<span class="ident" id="6648880">err</span>&nbsp;<span class="op" id="6648884">:=</span>&nbsp;<span class="ident" id="6648887">parseNetwork</span><span class="op" id="6648899">(</span><span class="ident" id="6648900">tt</span><span class="op" id="6648902">.</span><span class="ident" id="6648903">net</span><span class="op" id="6648906">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648910">if</span>&nbsp;<span class="ident" id="6648913">err</span>&nbsp;<span class="op" id="6648917">!=</span>&nbsp;<span class="ident" id="6648920">nil</span>&nbsp;<span class="op" id="6648924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648929">t</span><span class="op" id="6648930">.</span><span class="ident" id="6648931">Fatalf</span><span class="op" id="6648937">(</span><span class="string" id="6648938">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6648963">,</span>&nbsp;<span class="ident" id="6648965">err</span><span class="op" id="6648968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6648972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648976">if</span>&nbsp;<span class="ident" id="6648979">net</span>&nbsp;<span class="op" id="6648983">==</span>&nbsp;<span class="string" id="6648986">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6648992">&amp;&amp;</span>&nbsp;<span class="op" id="6648995">!</span><span class="ident" id="6648996">supportsIPv6</span>&nbsp;<span class="op" id="6649009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649014">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6649025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649030">c</span><span class="op" id="6649031">,</span>&nbsp;<span class="ident" id="6649033">err</span>&nbsp;<span class="op" id="6649037">:=</span>&nbsp;<span class="ident" id="6649040">ListenPacket</span><span class="op" id="6649052">(</span><span class="ident" id="6649053">tt</span><span class="op" id="6649055">.</span><span class="ident" id="6649056">net</span><span class="op" id="6649059">,</span>&nbsp;<span class="ident" id="6649061">tt</span><span class="op" id="6649063">.</span><span class="ident" id="6649064">laddr</span><span class="op" id="6649069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649073">if</span>&nbsp;<span class="ident" id="6649076">err</span>&nbsp;<span class="op" id="6649080">!=</span>&nbsp;<span class="ident" id="6649083">nil</span>&nbsp;<span class="op" id="6649087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649092">t</span><span class="op" id="6649093">.</span><span class="ident" id="6649094">Fatalf</span><span class="op" id="6649100">(</span><span class="string" id="6649101">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6649126">,</span>&nbsp;<span class="ident" id="6649128">err</span><span class="op" id="6649131">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6649135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649139">c</span><span class="op" id="6649140">.</span><span class="ident" id="6649141">SetDeadline</span><span class="op" id="6649152">(</span><span class="ident" id="6649153">time</span><span class="op" id="6649157">.</span><span class="ident" id="6649158">Now</span><span class="op" id="6649161">(</span><span class="op" id="6649162">)</span><span class="op" id="6649163">.</span><span class="ident" id="6649164">Add</span><span class="op" id="6649167">(</span><span class="num" id="6649168">100</span>&nbsp;<span class="op" id="6649172">*</span>&nbsp;<span class="ident" id="6649174">time</span><span class="op" id="6649178">.</span><span class="ident" id="6649179">Millisecond</span><span class="op" id="6649190">)</span><span class="op" id="6649191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649195">defer</span>&nbsp;<span class="ident" id="6649201">c</span><span class="op" id="6649202">.</span><span class="ident" id="6649203">Close</span><span class="op" id="6649208">(</span><span class="op" id="6649209">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649214">ra</span><span class="op" id="6649216">,</span>&nbsp;<span class="ident" id="6649218">err</span>&nbsp;<span class="op" id="6649222">:=</span>&nbsp;<span class="ident" id="6649225">ResolveIPAddr</span><span class="op" id="6649238">(</span><span class="ident" id="6649239">tt</span><span class="op" id="6649241">.</span><span class="ident" id="6649242">net</span><span class="op" id="6649245">,</span>&nbsp;<span class="ident" id="6649247">tt</span><span class="op" id="6649249">.</span><span class="ident" id="6649250">raddr</span><span class="op" id="6649255">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649259">if</span>&nbsp;<span class="ident" id="6649262">err</span>&nbsp;<span class="op" id="6649266">!=</span>&nbsp;<span class="ident" id="6649269">nil</span>&nbsp;<span class="op" id="6649273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649278">t</span><span class="op" id="6649279">.</span><span class="ident" id="6649280">Fatalf</span><span class="op" id="6649286">(</span><span class="string" id="6649287">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6649313">,</span>&nbsp;<span class="ident" id="6649315">err</span><span class="op" id="6649318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6649322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649326">typ</span>&nbsp;<span class="op" id="6649330">:=</span>&nbsp;<span class="ident" id="6649333">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649353">if</span>&nbsp;<span class="ident" id="6649356">net</span>&nbsp;<span class="op" id="6649360">==</span>&nbsp;<span class="string" id="6649363">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6649369">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649374">typ</span>&nbsp;<span class="op" id="6649378">=</span>&nbsp;<span class="ident" id="6649380">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6649400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649404">xid</span><span class="op" id="6649407">,</span>&nbsp;<span class="ident" id="6649409">xseq</span>&nbsp;<span class="op" id="6649414">:=</span>&nbsp;<span class="ident" id="6649417">os</span><span class="op" id="6649419">.</span><span class="ident" id="6649420">Getpid</span><span class="op" id="6649426">(</span><span class="op" id="6649427">)</span><span class="op" id="6649428">&amp;</span><span class="num" id="6649429">0xffff</span><span class="op" id="6649435">,</span>&nbsp;<span class="ident" id="6649437">i</span><span class="op" id="6649438">+</span><span class="num" id="6649439">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649443">wb</span><span class="op" id="6649445">,</span>&nbsp;<span class="ident" id="6649447">err</span>&nbsp;<span class="op" id="6649451">:=</span>&nbsp;<span class="op" id="6649454">(</span><span class="op" id="6649455">&amp;</span><span class="ident" id="6649456">icmpMessage</span><span class="op" id="6649467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649472">Type</span><span class="op" id="6649476">:</span>&nbsp;<span class="ident" id="6649478">typ</span><span class="op" id="6649481">,</span>&nbsp;<span class="ident" id="6649483">Code</span><span class="op" id="6649487">:</span>&nbsp;<span class="num" id="6649489">0</span><span class="op" id="6649490">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649495">Body</span><span class="op" id="6649499">:</span>&nbsp;<span class="op" id="6649501">&amp;</span><span class="ident" id="6649502">icmpEcho</span><span class="op" id="6649510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649516">ID</span><span class="op" id="6649518">:</span>&nbsp;<span class="ident" id="6649520">xid</span><span class="op" id="6649523">,</span>&nbsp;<span class="ident" id="6649525">Seq</span><span class="op" id="6649528">:</span>&nbsp;<span class="ident" id="6649530">xseq</span><span class="op" id="6649534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649540">Data</span><span class="op" id="6649544">:</span>&nbsp;<span class="ident" id="6649546">bytes</span><span class="op" id="6649551">.</span><span class="ident" id="6649552">Repeat</span><span class="op" id="6649558">(</span><span class="op" id="6649559">[</span><span class="op" id="6649560">]</span><span class="builtintype" id="6649561">byte</span><span class="op" id="6649565">(</span><span class="string" id="6649566">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="6649588">)</span><span class="op" id="6649589">,</span>&nbsp;<span class="num" id="6649591">3</span><span class="op" id="6649592">)</span><span class="op" id="6649593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6649598">}</span><span class="op" id="6649599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6649603">}</span><span class="op" id="6649604">)</span><span class="op" id="6649605">.</span><span class="ident" id="6649606">Marshal</span><span class="op" id="6649613">(</span><span class="op" id="6649614">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649618">if</span>&nbsp;<span class="ident" id="6649621">err</span>&nbsp;<span class="op" id="6649625">!=</span>&nbsp;<span class="ident" id="6649628">nil</span>&nbsp;<span class="op" id="6649632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649637">t</span><span class="op" id="6649638">.</span><span class="ident" id="6649639">Fatalf</span><span class="op" id="6649645">(</span><span class="string" id="6649646">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6649678">,</span>&nbsp;<span class="ident" id="6649680">err</span><span class="op" id="6649683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6649687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649691">if</span>&nbsp;<span class="ident" id="6649694">_</span><span class="op" id="6649695">,</span>&nbsp;<span class="ident" id="6649697">err</span>&nbsp;<span class="op" id="6649701">:=</span>&nbsp;<span class="ident" id="6649704">c</span><span class="op" id="6649705">.</span><span class="ident" id="6649706">WriteTo</span><span class="op" id="6649713">(</span><span class="ident" id="6649714">wb</span><span class="op" id="6649716">,</span>&nbsp;<span class="ident" id="6649718">ra</span><span class="op" id="6649720">)</span><span class="op" id="6649721">;</span>&nbsp;<span class="ident" id="6649723">err</span>&nbsp;<span class="op" id="6649727">!=</span>&nbsp;<span class="ident" id="6649730">nil</span>&nbsp;<span class="op" id="6649734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649739">t</span><span class="op" id="6649740">.</span><span class="ident" id="6649741">Fatalf</span><span class="op" id="6649747">(</span><span class="string" id="6649748">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6649779">,</span>&nbsp;<span class="ident" id="6649781">err</span><span class="op" id="6649784">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6649788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649792">var</span>&nbsp;<span class="ident" id="6649796">m</span>&nbsp;<span class="op" id="6649798">*</span><span class="ident" id="6649799">icmpMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649813">rb</span>&nbsp;<span class="op" id="6649816">:=</span>&nbsp;<span class="builtinfunc" id="6649819">make</span><span class="op" id="6649823">(</span><span class="op" id="6649824">[</span><span class="op" id="6649825">]</span><span class="builtintype" id="6649826">byte</span><span class="op" id="6649830">,</span>&nbsp;<span class="num" id="6649832">20</span><span class="op" id="6649834">+</span><span class="builtinfunc" id="6649835">len</span><span class="op" id="6649838">(</span><span class="ident" id="6649839">wb</span><span class="op" id="6649841">)</span><span class="op" id="6649842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649846">for</span>&nbsp;<span class="op" id="6649850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649855">if</span>&nbsp;<span class="ident" id="6649858">_</span><span class="op" id="6649859">,</span>&nbsp;<span class="ident" id="6649861">_</span><span class="op" id="6649862">,</span>&nbsp;<span class="ident" id="6649864">err</span>&nbsp;<span class="op" id="6649868">:=</span>&nbsp;<span class="ident" id="6649871">c</span><span class="op" id="6649872">.</span><span class="ident" id="6649873">ReadFrom</span><span class="op" id="6649881">(</span><span class="ident" id="6649882">rb</span><span class="op" id="6649884">)</span><span class="op" id="6649885">;</span>&nbsp;<span class="ident" id="6649887">err</span>&nbsp;<span class="op" id="6649891">!=</span>&nbsp;<span class="ident" id="6649894">nil</span>&nbsp;<span class="op" id="6649898">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649904">t</span><span class="op" id="6649905">.</span><span class="ident" id="6649906">Fatalf</span><span class="op" id="6649912">(</span><span class="string" id="6649913">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6649945">,</span>&nbsp;<span class="ident" id="6649947">err</span><span class="op" id="6649950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6649955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6649960">//&nbsp;See&nbsp;BUG&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6649983">//if&nbsp;net&nbsp;==&nbsp;&#34;ip4&#34;&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6650006">//&nbsp;&nbsp;&nbsp;&nbsprb&nbsp;=&nbsp;ipv4Payload(rb)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6650033">//}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650040">if</span>&nbsp;<span class="ident" id="6650043">m</span><span class="op" id="6650044">,</span>&nbsp;<span class="ident" id="6650046">err</span>&nbsp;<span class="op" id="6650050">=</span>&nbsp;<span class="ident" id="6650052">parseICMPMessage</span><span class="op" id="6650068">(</span><span class="ident" id="6650069">rb</span><span class="op" id="6650071">)</span><span class="op" id="6650072">;</span>&nbsp;<span class="ident" id="6650074">err</span>&nbsp;<span class="op" id="6650078">!=</span>&nbsp;<span class="ident" id="6650081">nil</span>&nbsp;<span class="op" id="6650085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6650091">t</span><span class="op" id="6650092">.</span><span class="ident" id="6650093">Fatalf</span><span class="op" id="6650099">(</span><span class="string" id="6650100">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6650129">,</span>&nbsp;<span class="ident" id="6650131">err</span><span class="op" id="6650134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6650139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650144">switch</span>&nbsp;<span class="ident" id="6650151">m</span><span class="op" id="6650152">.</span><span class="ident" id="6650153">Type</span>&nbsp;<span class="op" id="6650158">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650163">case</span>&nbsp;<span class="ident" id="6650168">icmpv4EchoRequest</span><span class="op" id="6650185">,</span>&nbsp;<span class="ident" id="6650187">icmpv6EchoRequest</span><span class="op" id="6650204">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650210">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6650222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650227">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6650235">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650239">switch</span>&nbsp;<span class="ident" id="6650246">p</span>&nbsp;<span class="op" id="6650248">:=</span>&nbsp;<span class="ident" id="6650251">m</span><span class="op" id="6650252">.</span><span class="ident" id="6650253">Body</span><span class="op" id="6650257">.</span><span class="op" id="6650258">(</span><span class="keyword" id="6650259">type</span><span class="op" id="6650263">)</span>&nbsp;<span class="op" id="6650265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650269">case</span>&nbsp;<span class="op" id="6650274">*</span><span class="ident" id="6650275">icmpEcho</span><span class="op" id="6650283">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650288">if</span>&nbsp;<span class="ident" id="6650291">p</span><span class="op" id="6650292">.</span><span class="ident" id="6650293">ID</span>&nbsp;<span class="op" id="6650296">!=</span>&nbsp;<span class="ident" id="6650299">xid</span>&nbsp;<span class="op" id="6650303">||</span>&nbsp;<span class="ident" id="6650306">p</span><span class="op" id="6650307">.</span><span class="ident" id="6650308">Seq</span>&nbsp;<span class="op" id="6650312">!=</span>&nbsp;<span class="ident" id="6650315">xseq</span>&nbsp;<span class="op" id="6650320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6650326">t</span><span class="op" id="6650327">.</span><span class="ident" id="6650328">Fatalf</span><span class="op" id="6650334">(</span><span class="string" id="6650335">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="6650384">,</span>&nbsp;<span class="ident" id="6650386">p</span><span class="op" id="6650387">.</span><span class="ident" id="6650388">ID</span><span class="op" id="6650390">,</span>&nbsp;<span class="ident" id="6650392">p</span><span class="op" id="6650393">.</span><span class="ident" id="6650394">Seq</span><span class="op" id="6650397">,</span>&nbsp;<span class="ident" id="6650399">xid</span><span class="op" id="6650402">,</span>&nbsp;<span class="ident" id="6650404">xseq</span><span class="op" id="6650408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6650413">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650417">default</span><span class="op" id="6650424">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6650429">t</span><span class="op" id="6650430">.</span><span class="ident" id="6650431">Fatalf</span><span class="op" id="6650437">(</span><span class="string" id="6650438">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="6650487">,</span>&nbsp;<span class="ident" id="6650489">m</span><span class="op" id="6650490">.</span><span class="ident" id="6650491">Type</span><span class="op" id="6650495">,</span>&nbsp;<span class="ident" id="6650497">m</span><span class="op" id="6650498">.</span><span class="ident" id="6650499">Code</span><span class="op" id="6650503">,</span>&nbsp;<span class="ident" id="6650505">typ</span><span class="op" id="6650508">,</span>&nbsp;<span class="num" id="6650510">0</span><span class="op" id="6650511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6650515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6650518">}</span><br>
<span class="lineno"></span><span class="op" id="6650520">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="6650523">func</span>&nbsp;<span class="ident" id="6650528">ipv4Payload</span><span class="op" id="6650539">(</span><span class="ident" id="6650540">b</span>&nbsp;<span class="op" id="6650542">[</span><span class="op" id="6650543">]</span><span class="builtintype" id="6650544">byte</span><span class="op" id="6650548">)</span>&nbsp;<span class="op" id="6650550">[</span><span class="op" id="6650551">]</span><span class="builtintype" id="6650552">byte</span>&nbsp;<span class="op" id="6650557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650560">if</span>&nbsp;<span class="builtinfunc" id="6650563">len</span><span class="op" id="6650566">(</span><span class="ident" id="6650567">b</span><span class="op" id="6650568">)</span>&nbsp;<span class="op" id="6650570">&lt;</span>&nbsp;<span class="num" id="6650572">20</span>&nbsp;<span class="op" id="6650575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650579">return</span>&nbsp;<span class="ident" id="6650586">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6650589">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6650592">hdrlen</span>&nbsp;<span class="op" id="6650599">:=</span>&nbsp;<span class="builtintype" id="6650602">int</span><span class="op" id="6650605">(</span><span class="ident" id="6650606">b</span><span class="op" id="6650607">[</span><span class="num" id="6650608">0</span><span class="op" id="6650609">]</span><span class="op" id="6650610">&amp;</span><span class="num" id="6650611">0x0f</span><span class="op" id="6650615">)</span>&nbsp;<span class="op" id="6650617">&lt;&lt;</span>&nbsp;<span class="num" id="6650620">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650623">return</span>&nbsp;<span class="ident" id="6650630">b</span><span class="op" id="6650631">[</span><span class="ident" id="6650632">hdrlen</span><span class="op" id="6650638">:</span><span class="op" id="6650639">]</span><br>
<span class="lineno"></span><span class="op" id="6650641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6650644">var</span>&nbsp;<span class="ident" id="6650648">ipConnLocalNameTests</span>&nbsp;<span class="op" id="6650669">=</span>&nbsp;<span class="op" id="6650671">[</span><span class="op" id="6650672">]</span><span class="keyword" id="6650673">struct</span>&nbsp;<span class="op" id="6650680">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6650683">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6650689">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6650697">laddr</span>&nbsp;<span class="op" id="6650703">*</span><span class="ident" id="6650704">IPAddr</span><br>
<span class="lineno"></span><span class="op" id="6650711">}</span><span class="op" id="6650712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6650715">{</span><span class="string" id="6650716">&#34;ip4:icmp&#34;</span><span class="op" id="6650726">,</span>&nbsp;<span class="op" id="6650728">&amp;</span><span class="ident" id="6650729">IPAddr</span><span class="op" id="6650735">{</span><span class="ident" id="6650736">IP</span><span class="op" id="6650738">:</span>&nbsp;<span class="ident" id="6650740">IPv4</span><span class="op" id="6650744">(</span><span class="num" id="6650745">127</span><span class="op" id="6650748">,</span>&nbsp;<span class="num" id="6650750">0</span><span class="op" id="6650751">,</span>&nbsp;<span class="num" id="6650753">0</span><span class="op" id="6650754">,</span>&nbsp;<span class="num" id="6650756">1</span><span class="op" id="6650757">)</span><span class="op" id="6650758">}</span><span class="op" id="6650759">}</span><span class="op" id="6650760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6650763">{</span><span class="string" id="6650764">&#34;ip4:icmp&#34;</span><span class="op" id="6650774">,</span>&nbsp;<span class="op" id="6650776">&amp;</span><span class="ident" id="6650777">IPAddr</span><span class="op" id="6650783">{</span><span class="op" id="6650784">}</span><span class="op" id="6650785">}</span><span class="op" id="6650786">,</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6650789">{</span><span class="string" id="6650790">&#34;ip4:icmp&#34;</span><span class="op" id="6650800">,</span>&nbsp;<span class="ident" id="6650802">nil</span><span class="op" id="6650805">}</span><span class="op" id="6650806">,</span><br>
<span class="lineno"></span><span class="op" id="6650808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6650811">func</span>&nbsp;<span class="ident" id="6650816">TestIPConnLocalName</span><span class="op" id="6650835">(</span><span class="ident" id="6650836">t</span>&nbsp;<span class="op" id="6650838">*</span><span class="ident" id="6650839">testing</span><span class="op" id="6650846">.</span><span class="ident" id="6650847">T</span><span class="op" id="6650848">)</span>&nbsp;<span class="op" id="6650850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650853">switch</span>&nbsp;<span class="ident" id="6650860">runtime</span><span class="op" id="6650867">.</span><span class="ident" id="6650868">GOOS</span>&nbsp;<span class="op" id="6650873">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650876">case</span>&nbsp;<span class="string" id="6650881">&#34;nacl&#34;</span><span class="op" id="6650887">,</span>&nbsp;<span class="string" id="6650889">&#34;plan9&#34;</span><span class="op" id="6650896">,</span>&nbsp;<span class="string" id="6650898">&#34;windows&#34;</span><span class="op" id="6650907">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6650911">t</span><span class="op" id="6650912">.</span><span class="ident" id="6650913">Skipf</span><span class="op" id="6650918">(</span><span class="string" id="6650919">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6650940">,</span>&nbsp;<span class="ident" id="6650942">runtime</span><span class="op" id="6650949">.</span><span class="ident" id="6650950">GOOS</span><span class="op" id="6650954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650957">default</span><span class="op" id="6650964">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650968">if</span>&nbsp;<span class="ident" id="6650971">os</span><span class="op" id="6650973">.</span><span class="ident" id="6650974">Getuid</span><span class="op" id="6650980">(</span><span class="op" id="6650981">)</span>&nbsp;<span class="op" id="6650983">!=</span>&nbsp;<span class="num" id="6650986">0</span>&nbsp;<span class="op" id="6650988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6650993">t</span><span class="op" id="6650994">.</span><span class="ident" id="6650995">Skip</span><span class="op" id="6650999">(</span><span class="string" id="6651000">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="6651029">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651040">for</span>&nbsp;<span class="ident" id="6651044">_</span><span class="op" id="6651045">,</span>&nbsp;<span class="ident" id="6651047">tt</span>&nbsp;<span class="op" id="6651050">:=</span>&nbsp;<span class="keyword" id="6651053">range</span>&nbsp;<span class="ident" id="6651059">ipConnLocalNameTests</span>&nbsp;<span class="op" id="6651080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651084">c</span><span class="op" id="6651085">,</span>&nbsp;<span class="ident" id="6651087">err</span>&nbsp;<span class="op" id="6651091">:=</span>&nbsp;<span class="ident" id="6651094">ListenIP</span><span class="op" id="6651102">(</span><span class="ident" id="6651103">tt</span><span class="op" id="6651105">.</span><span class="ident" id="6651106">net</span><span class="op" id="6651109">,</span>&nbsp;<span class="ident" id="6651111">tt</span><span class="op" id="6651113">.</span><span class="ident" id="6651114">laddr</span><span class="op" id="6651119">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651123">if</span>&nbsp;<span class="ident" id="6651126">err</span>&nbsp;<span class="op" id="6651130">!=</span>&nbsp;<span class="ident" id="6651133">nil</span>&nbsp;<span class="op" id="6651137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651142">t</span><span class="op" id="6651143">.</span><span class="ident" id="6651144">Fatalf</span><span class="op" id="6651150">(</span><span class="string" id="6651151">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6651172">,</span>&nbsp;<span class="ident" id="6651174">err</span><span class="op" id="6651177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651185">defer</span>&nbsp;<span class="ident" id="6651191">c</span><span class="op" id="6651192">.</span><span class="ident" id="6651193">Close</span><span class="op" id="6651198">(</span><span class="op" id="6651199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651203">if</span>&nbsp;<span class="ident" id="6651206">la</span>&nbsp;<span class="op" id="6651209">:=</span>&nbsp;<span class="ident" id="6651212">c</span><span class="op" id="6651213">.</span><span class="ident" id="6651214">LocalAddr</span><span class="op" id="6651223">(</span><span class="op" id="6651224">)</span><span class="op" id="6651225">;</span>&nbsp;<span class="ident" id="6651227">la</span>&nbsp;<span class="op" id="6651230">==</span>&nbsp;<span class="ident" id="6651233">nil</span>&nbsp;<span class="op" id="6651237">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651242">t</span><span class="op" id="6651243">.</span><span class="ident" id="6651244">Fatal</span><span class="op" id="6651249">(</span><span class="string" id="6651250">&#34;IPConn.LocalAddr&nbsp;failed&#34;</span><span class="op" id="6651275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651282">}</span><br>
<span class="lineno"></span><span class="op" id="6651284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="6651287">func</span>&nbsp;<span class="ident" id="6651292">TestIPConnRemoteName</span><span class="op" id="6651312">(</span><span class="ident" id="6651313">t</span>&nbsp;<span class="op" id="6651315">*</span><span class="ident" id="6651316">testing</span><span class="op" id="6651323">.</span><span class="ident" id="6651324">T</span><span class="op" id="6651325">)</span>&nbsp;<span class="op" id="6651327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651330">switch</span>&nbsp;<span class="ident" id="6651337">runtime</span><span class="op" id="6651344">.</span><span class="ident" id="6651345">GOOS</span>&nbsp;<span class="op" id="6651350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651353">case</span>&nbsp;<span class="string" id="6651358">&#34;plan9&#34;</span><span class="op" id="6651365">,</span>&nbsp;<span class="string" id="6651367">&#34;windows&#34;</span><span class="op" id="6651376">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651380">t</span><span class="op" id="6651381">.</span><span class="ident" id="6651382">Skipf</span><span class="op" id="6651387">(</span><span class="string" id="6651388">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6651409">,</span>&nbsp;<span class="ident" id="6651411">runtime</span><span class="op" id="6651418">.</span><span class="ident" id="6651419">GOOS</span><span class="op" id="6651423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651426">default</span><span class="op" id="6651433">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651437">if</span>&nbsp;<span class="ident" id="6651440">os</span><span class="op" id="6651442">.</span><span class="ident" id="6651443">Getuid</span><span class="op" id="6651449">(</span><span class="op" id="6651450">)</span>&nbsp;<span class="op" id="6651452">!=</span>&nbsp;<span class="num" id="6651455">0</span>&nbsp;<span class="op" id="6651457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651462">t</span><span class="op" id="6651463">.</span><span class="ident" id="6651464">Skip</span><span class="op" id="6651468">(</span><span class="string" id="6651469">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="6651498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651509">raddr</span>&nbsp;<span class="op" id="6651515">:=</span>&nbsp;<span class="op" id="6651518">&amp;</span><span class="ident" id="6651519">IPAddr</span><span class="op" id="6651525">{</span><span class="ident" id="6651526">IP</span><span class="op" id="6651528">:</span>&nbsp;<span class="ident" id="6651530">IPv4</span><span class="op" id="6651534">(</span><span class="num" id="6651535">127</span><span class="op" id="6651538">,</span>&nbsp;<span class="num" id="6651540">0</span><span class="op" id="6651541">,</span>&nbsp;<span class="num" id="6651543">0</span><span class="op" id="6651544">,</span>&nbsp;<span class="num" id="6651546">1</span><span class="op" id="6651547">)</span><span class="op" id="6651548">.</span><span class="ident" id="6651549">To4</span><span class="op" id="6651552">(</span><span class="op" id="6651553">)</span><span class="op" id="6651554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651557">c</span><span class="op" id="6651558">,</span>&nbsp;<span class="ident" id="6651560">err</span>&nbsp;<span class="op" id="6651564">:=</span>&nbsp;<span class="ident" id="6651567">DialIP</span><span class="op" id="6651573">(</span><span class="string" id="6651574">&#34;ip:tcp&#34;</span><span class="op" id="6651582">,</span>&nbsp;<span class="op" id="6651584">&amp;</span><span class="ident" id="6651585">IPAddr</span><span class="op" id="6651591">{</span><span class="ident" id="6651592">IP</span><span class="op" id="6651594">:</span>&nbsp;<span class="ident" id="6651596">IPv4</span><span class="op" id="6651600">(</span><span class="num" id="6651601">127</span><span class="op" id="6651604">,</span>&nbsp;<span class="num" id="6651606">0</span><span class="op" id="6651607">,</span>&nbsp;<span class="num" id="6651609">0</span><span class="op" id="6651610">,</span>&nbsp;<span class="num" id="6651612">1</span><span class="op" id="6651613">)</span><span class="op" id="6651614">}</span><span class="op" id="6651615">,</span>&nbsp;<span class="ident" id="6651617">raddr</span><span class="op" id="6651622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651625">if</span>&nbsp;<span class="ident" id="6651628">err</span>&nbsp;<span class="op" id="6651632">!=</span>&nbsp;<span class="ident" id="6651635">nil</span>&nbsp;<span class="op" id="6651639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651643">t</span><span class="op" id="6651644">.</span><span class="ident" id="6651645">Fatalf</span><span class="op" id="6651651">(</span><span class="string" id="6651652">&#34;DialIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6651671">,</span>&nbsp;<span class="ident" id="6651673">err</span><span class="op" id="6651676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651679">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651682">defer</span>&nbsp;<span class="ident" id="6651688">c</span><span class="op" id="6651689">.</span><span class="ident" id="6651690">Close</span><span class="op" id="6651695">(</span><span class="op" id="6651696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651699">if</span>&nbsp;<span class="op" id="6651702">!</span><span class="ident" id="6651703">reflect</span><span class="op" id="6651710">.</span><span class="ident" id="6651711">DeepEqual</span><span class="op" id="6651720">(</span><span class="ident" id="6651721">raddr</span><span class="op" id="6651726">,</span>&nbsp;<span class="ident" id="6651728">c</span><span class="op" id="6651729">.</span><span class="ident" id="6651730">RemoteAddr</span><span class="op" id="6651740">(</span><span class="op" id="6651741">)</span><span class="op" id="6651742">)</span>&nbsp;<span class="op" id="6651744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651748">t</span><span class="op" id="6651749">.</span><span class="ident" id="6651750">Fatalf</span><span class="op" id="6651756">(</span><span class="string" id="6651757">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6651780">,</span>&nbsp;<span class="ident" id="6651782">c</span><span class="op" id="6651783">.</span><span class="ident" id="6651784">RemoteAddr</span><span class="op" id="6651794">(</span><span class="op" id="6651795">)</span><span class="op" id="6651796">,</span>&nbsp;<span class="ident" id="6651798">raddr</span><span class="op" id="6651803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651806">}</span><br>
<span class="lineno"></span><span class="op" id="6651808">}</span>
</div>
</body>
</html>
