<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7137372">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7137427">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7137481">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7137532">package</span>&nbsp;<span class="ident" id="7137540">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7137545">import</span>&nbsp;<span class="op" id="7137552">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7137555">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7137564">&#34;encoding/hex&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7137580">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7137590">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7137598">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7137605">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7137611">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7137624">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7137631">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7137642">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7137653">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="7137660">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="7137663">//&nbsp;TLS&nbsp;reference&nbsp;tests&nbsp;run&nbsp;a&nbsp;connection&nbsp;against&nbsp;a&nbsp;reference&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="7137738">//&nbsp;(OpenSSL)&nbsp;of&nbsp;TLS&nbsp;and&nbsp;record&nbsp;the&nbsp;bytes&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;The&nbsp;Go</span><br>
<span class="lineno"></span><span class="comment" id="7137815">//&nbsp;code,&nbsp;during&nbsp;a&nbsp;test,&nbsp;is&nbsp;configured&nbsp;with&nbsp;deterministic&nbsp;randomness&nbsp;and&nbsp;so&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7137894">//&nbsp;reference&nbsp;test&nbsp;can&nbsp;be&nbsp;reproduced&nbsp;exactly&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno">25</span><span class="comment" id="7137953">//</span><br>
<span class="lineno"></span><span class="comment" id="7137956">//&nbsp;In&nbsp;order&nbsp;to&nbsp;save&nbsp;everyone&nbsp;who&nbsp;wishes&nbsp;to&nbsp;run&nbsp;the&nbsp;tests&nbsp;from&nbsp;needing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7138030">//&nbsp;reference&nbsp;implementation&nbsp;installed,&nbsp;the&nbsp;reference&nbsp;connections&nbsp;are&nbsp;saved&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7138108">//&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata&nbsp;directory.&nbsp;Thus&nbsp;running&nbsp;the&nbsp;tests&nbsp;involves&nbsp;nothing</span><br>
<span class="lineno"></span><span class="comment" id="7138184">//&nbsp;external,&nbsp;but&nbsp;creating&nbsp;and&nbsp;updating&nbsp;them&nbsp;requires&nbsp;the&nbsp;reference</span><br>
<span class="lineno">30</span><span class="comment" id="7138251">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="comment" id="7138270">//</span><br>
<span class="lineno"></span><span class="comment" id="7138273">//&nbsp;Tests&nbsp;can&nbsp;be&nbsp;updated&nbsp;by&nbsp;running&nbsp;them&nbsp;with&nbsp;the&nbsp;-update&nbsp;flag.&nbsp;This&nbsp;will&nbsp;cause</span><br>
<span class="lineno"></span><span class="comment" id="7138352">//&nbsp;the&nbsp;test&nbsp;files.&nbsp;Generally&nbsp;one&nbsp;should&nbsp;combine&nbsp;the&nbsp;-update&nbsp;flag&nbsp;with&nbsp;-test.run</span><br>
<span class="lineno"></span><span class="comment" id="7138432">//&nbsp;to&nbsp;updated&nbsp;a&nbsp;specific&nbsp;test.&nbsp;Since&nbsp;the&nbsp;reference&nbsp;implementation&nbsp;will&nbsp;always</span><br>
<span class="lineno">35</span><span class="comment" id="7138510">//&nbsp;generate&nbsp;fresh&nbsp;random&nbsp;numbers,&nbsp;large&nbsp;parts&nbsp;of&nbsp;the&nbsp;reference&nbsp;connection&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="7138589">//&nbsp;always&nbsp;change.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7138608">var</span>&nbsp;<span class="ident" id="7138612">update</span>&nbsp;<span class="op" id="7138619">=</span>&nbsp;<span class="ident" id="7138621"><a href="/crypto/tls/handshake_test.go.html#7137590">flag</a></span><span class="op" id="7138625">.</span><span class="ident" id="7138626">Bool</span><span class="op" id="7138630">(</span><span class="string" id="7138631">&#34;update&#34;</span><span class="op" id="7138639">,</span>&nbsp;<span class="ident" id="7138641">false</span><span class="op" id="7138646">,</span>&nbsp;<span class="string" id="7138648">&#34;update&nbsp;golden&nbsp;files&nbsp;on&nbsp;disk&#34;</span><span class="op" id="7138677">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="7138680">//&nbsp;recordingConn&nbsp;is&nbsp;a&nbsp;net.Conn&nbsp;that&nbsp;records&nbsp;the&nbsp;traffic&nbsp;that&nbsp;passes&nbsp;through&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="7138760">//&nbsp;WriteTo&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;produce&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;later&nbsp;be&nbsp;loaded&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="7138834">//&nbsp;ParseTestData.</span><br>
<span class="lineno"></span><span class="keyword" id="7138852">type</span>&nbsp;<span class="ident" id="7138857">recordingConn</span>&nbsp;<span class="keyword" id="7138871">struct</span>&nbsp;<span class="op" id="7138878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138881"><a href="/crypto/tls/handshake_test.go.html#7137624">net</a></span><span class="op" id="7138884">.</span><span class="ident" id="7138885">Conn</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138891"><a href="/crypto/tls/handshake_test.go.html#7137653">sync</a></span><span class="op" id="7138895">.</span><span class="ident" id="7138896">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138903">flows</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7138911">[</span><span class="op" id="7138912">]</span><span class="op" id="7138913">[</span><span class="op" id="7138914">]</span><span class="builtintype" id="7138915">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138921">reading</span>&nbsp;<span class="builtintype" id="7138929">bool</span><br>
<span class="lineno"></span><span class="op" id="7138934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="7138937">func</span>&nbsp;<span class="op" id="7138942">(</span><span class="ident" id="7138943">r</span>&nbsp;<span class="op" id="7138945">*</span><span class="ident" id="7138946"><a href="/crypto/tls/handshake_test.go.html#7138857">recordingConn</a></span><span class="op" id="7138959">)</span>&nbsp;<span class="ident" id="7138961">Read</span><span class="op" id="7138965">(</span><span class="ident" id="7138966">b</span>&nbsp;<span class="op" id="7138968">[</span><span class="op" id="7138969">]</span><span class="builtintype" id="7138970">byte</span><span class="op" id="7138974">)</span>&nbsp;<span class="op" id="7138976">(</span><span class="ident" id="7138977">n</span>&nbsp;<span class="builtintype" id="7138979">int</span><span class="op" id="7138982">,</span>&nbsp;<span class="ident" id="7138984">err</span>&nbsp;<span class="builtintype" id="7138988">error</span><span class="op" id="7138993">)</span>&nbsp;<span class="op" id="7138995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7138998">if</span>&nbsp;<span class="ident" id="7139001"><a href="/crypto/tls/handshake_test.go.html#7138977">n</a></span><span class="op" id="7139002">,</span>&nbsp;<span class="ident" id="7139004"><a href="/crypto/tls/handshake_test.go.html#7138984">err</a></span>&nbsp;<span class="op" id="7139008">=</span>&nbsp;<span class="ident" id="7139010"><a href="/crypto/tls/handshake_test.go.html#7138943">r</a></span><span class="op" id="7139011">.</span><span class="ident" id="7139012">Conn</span><span class="op" id="7139016">.</span><span class="ident" id="7139017">Read</span><span class="op" id="7139021">(</span><span class="ident" id="7139022"><a href="/crypto/tls/handshake_test.go.html#7138966">b</a></span><span class="op" id="7139023">)</span><span class="op" id="7139024">;</span>&nbsp;<span class="ident" id="7139026"><a href="/crypto/tls/handshake_test.go.html#7138977">n</a></span>&nbsp;<span class="op" id="7139028">==</span>&nbsp;<span class="num" id="7139031">0</span>&nbsp;<span class="op" id="7139033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139037">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139048"><a href="/crypto/tls/handshake_test.go.html#7138966">b</a></span>&nbsp;<span class="op" id="7139050">=</span>&nbsp;<span class="ident" id="7139052"><a href="/crypto/tls/handshake_test.go.html#7138966">b</a></span><span class="op" id="7139053">[</span><span class="op" id="7139054">:</span><span class="ident" id="7139055"><a href="/crypto/tls/handshake_test.go.html#7138977">n</a></span><span class="op" id="7139056">]</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139060"><a href="/crypto/tls/handshake_test.go.html#7138943">r</a></span><span class="op" id="7139061">.</span><span class="ident" id="7139062">Lock</span><span class="op" id="7139066">(</span><span class="op" id="7139067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139070">defer</span>&nbsp;<span class="ident" id="7139076"><a href="/crypto/tls/handshake_test.go.html#7138943">r</a></span><span class="op" id="7139077">.</span><span class="ident" id="7139078">Unlock</span><span class="op" id="7139084">(</span><span class="op" id="7139085">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139089">if</span>&nbsp;<span class="ident" id="7139092">l</span>&nbsp;<span class="op" id="7139094">:=</span>&nbsp;<span class="builtinfunc" id="7139097">len</span><span class="op" id="7139100">(</span><span class="ident" id="7139101"><a href="/crypto/tls/handshake_test.go.html#7138943">r</a></span><span class="op" id="7139102">.</span><span class="ident" id="7139103">flows</span><span class="op" id="7139108">)</span><span class="op" id="7139109">;</span>&nbsp;<span class="ident" id="7139111"><a href="/crypto/tls/handshake_test.go.html#7139092">l</a></span>&nbsp;<span class="op" id="7139113">==</span>&nbsp;<span class="num" id="7139116">0</span>&nbsp;<span class="op" id="7139118">||</span>&nbsp;<span class="op" id="7139121">!</span><span class="ident" id="7139122"><a href="/crypto/tls/handshake_test.go.html#7138943">r</a></span><span class="op" id="7139123">.</span><span class="ident" id="7139124">reading</span>&nbsp;<span class="op" id="7139132">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139136">buf</span>&nbsp;<span class="op" id="7139140">:=</span>&nbsp;<span class="builtinfunc" id="7139143">make</span><span class="op" id="7139147">(</span><span class="op" id="7139148">[</span><span class="op" id="7139149">]</span><span class="builtintype" id="7139150">byte</span><span class="op" id="7139154">,</span>&nbsp;<span class="builtinfunc" id="7139156">len</span><span class="op" id="7139159">(</span><span class="ident" id="7139160"><a href="/crypto/tls/handshake_test.go.html#7138966">b</a></span><span class="op" id="7139161">)</span><span class="op" id="7139162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7139166">copy</span><span class="op" id="7139170">(</span><span class="ident" id="7139171"><a href="/crypto/tls/handshake_test.go.html#7139136">buf</a></span><span class="op" id="7139174">,</span>&nbsp;<span class="ident" id="7139176"><a href="/crypto/tls/handshake_test.go.html#7138966">b</a></span><span class="op" id="7139177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139181"><a href="/crypto/tls/handshake_test.go.html#7138943">r</a></span><span class="op" id="7139182">.</span><span class="ident" id="7139183">flows</span>&nbsp;<span class="op" id="7139189">=</span>&nbsp;<span class="builtinfunc" id="7139191">append</span><span class="op" id="7139197">(</span><span class="ident" id="7139198"><a href="/crypto/tls/handshake_test.go.html#7138943">r</a></span><span class="op" id="7139199">.</span><span class="ident" id="7139200">flows</span><span class="op" id="7139205">,</span>&nbsp;<span class="ident" id="7139207"><a href="/crypto/tls/handshake_test.go.html#7139136">buf</a></span><span class="op" id="7139210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139213">}</span>&nbsp;<span class="keyword" id="7139215">else</span>&nbsp;<span class="op" id="7139220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139224"><a href="/crypto/tls/handshake_test.go.html#7138943">r</a></span><span class="op" id="7139225">.</span><span class="ident" id="7139226">flows</span><span class="op" id="7139231">[</span><span class="ident" id="7139232"><a href="/crypto/tls/handshake_test.go.html#7139092">l</a></span><span class="op" id="7139233">-</span><span class="num" id="7139234">1</span><span class="op" id="7139235">]</span>&nbsp;<span class="op" id="7139237">=</span>&nbsp;<span class="builtinfunc" id="7139239">append</span><span class="op" id="7139245">(</span><span class="ident" id="7139246"><a href="/crypto/tls/handshake_test.go.html#7138943">r</a></span><span class="op" id="7139247">.</span><span class="ident" id="7139248">flows</span><span class="op" id="7139253">[</span><span class="ident" id="7139254"><a href="/crypto/tls/handshake_test.go.html#7139092">l</a></span><span class="op" id="7139255">-</span><span class="num" id="7139256">1</span><span class="op" id="7139257">]</span><span class="op" id="7139258">,</span>&nbsp;<span class="ident" id="7139260"><a href="/crypto/tls/handshake_test.go.html#7138966">b</a></span><span class="op" id="7139261">[</span><span class="op" id="7139262">:</span><span class="ident" id="7139263"><a href="/crypto/tls/handshake_test.go.html#7138977">n</a></span><span class="op" id="7139264">]</span><span class="op" id="7139265">...</span><span class="op" id="7139268">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139274"><a href="/crypto/tls/handshake_test.go.html#7138943">r</a></span><span class="op" id="7139275">.</span><span class="ident" id="7139276">reading</span>&nbsp;<span class="op" id="7139284">=</span>&nbsp;<span class="ident" id="7139286">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139292">return</span><br>
<span class="lineno"></span><span class="op" id="7139299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7139302">func</span>&nbsp;<span class="op" id="7139307">(</span><span class="ident" id="7139308">r</span>&nbsp;<span class="op" id="7139310">*</span><span class="ident" id="7139311"><a href="/crypto/tls/handshake_test.go.html#7138857">recordingConn</a></span><span class="op" id="7139324">)</span>&nbsp;<span class="ident" id="7139326">Write</span><span class="op" id="7139331">(</span><span class="ident" id="7139332">b</span>&nbsp;<span class="op" id="7139334">[</span><span class="op" id="7139335">]</span><span class="builtintype" id="7139336">byte</span><span class="op" id="7139340">)</span>&nbsp;<span class="op" id="7139342">(</span><span class="ident" id="7139343">n</span>&nbsp;<span class="builtintype" id="7139345">int</span><span class="op" id="7139348">,</span>&nbsp;<span class="ident" id="7139350">err</span>&nbsp;<span class="builtintype" id="7139354">error</span><span class="op" id="7139359">)</span>&nbsp;<span class="op" id="7139361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139364">if</span>&nbsp;<span class="ident" id="7139367"><a href="/crypto/tls/handshake_test.go.html#7139343">n</a></span><span class="op" id="7139368">,</span>&nbsp;<span class="ident" id="7139370"><a href="/crypto/tls/handshake_test.go.html#7139350">err</a></span>&nbsp;<span class="op" id="7139374">=</span>&nbsp;<span class="ident" id="7139376"><a href="/crypto/tls/handshake_test.go.html#7139308">r</a></span><span class="op" id="7139377">.</span><span class="ident" id="7139378">Conn</span><span class="op" id="7139382">.</span><span class="ident" id="7139383">Write</span><span class="op" id="7139388">(</span><span class="ident" id="7139389"><a href="/crypto/tls/handshake_test.go.html#7139332">b</a></span><span class="op" id="7139390">)</span><span class="op" id="7139391">;</span>&nbsp;<span class="ident" id="7139393"><a href="/crypto/tls/handshake_test.go.html#7139343">n</a></span>&nbsp;<span class="op" id="7139395">==</span>&nbsp;<span class="num" id="7139398">0</span>&nbsp;<span class="op" id="7139400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139404">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139415"><a href="/crypto/tls/handshake_test.go.html#7139332">b</a></span>&nbsp;<span class="op" id="7139417">=</span>&nbsp;<span class="ident" id="7139419"><a href="/crypto/tls/handshake_test.go.html#7139332">b</a></span><span class="op" id="7139420">[</span><span class="op" id="7139421">:</span><span class="ident" id="7139422"><a href="/crypto/tls/handshake_test.go.html#7139343">n</a></span><span class="op" id="7139423">]</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139427"><a href="/crypto/tls/handshake_test.go.html#7139308">r</a></span><span class="op" id="7139428">.</span><span class="ident" id="7139429">Lock</span><span class="op" id="7139433">(</span><span class="op" id="7139434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139437">defer</span>&nbsp;<span class="ident" id="7139443"><a href="/crypto/tls/handshake_test.go.html#7139308">r</a></span><span class="op" id="7139444">.</span><span class="ident" id="7139445">Unlock</span><span class="op" id="7139451">(</span><span class="op" id="7139452">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139456">if</span>&nbsp;<span class="ident" id="7139459">l</span>&nbsp;<span class="op" id="7139461">:=</span>&nbsp;<span class="builtinfunc" id="7139464">len</span><span class="op" id="7139467">(</span><span class="ident" id="7139468"><a href="/crypto/tls/handshake_test.go.html#7139308">r</a></span><span class="op" id="7139469">.</span><span class="ident" id="7139470">flows</span><span class="op" id="7139475">)</span><span class="op" id="7139476">;</span>&nbsp;<span class="ident" id="7139478"><a href="/crypto/tls/handshake_test.go.html#7139459">l</a></span>&nbsp;<span class="op" id="7139480">==</span>&nbsp;<span class="num" id="7139483">0</span>&nbsp;<span class="op" id="7139485">||</span>&nbsp;<span class="ident" id="7139488"><a href="/crypto/tls/handshake_test.go.html#7139308">r</a></span><span class="op" id="7139489">.</span><span class="ident" id="7139490">reading</span>&nbsp;<span class="op" id="7139498">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139502">buf</span>&nbsp;<span class="op" id="7139506">:=</span>&nbsp;<span class="builtinfunc" id="7139509">make</span><span class="op" id="7139513">(</span><span class="op" id="7139514">[</span><span class="op" id="7139515">]</span><span class="builtintype" id="7139516">byte</span><span class="op" id="7139520">,</span>&nbsp;<span class="builtinfunc" id="7139522">len</span><span class="op" id="7139525">(</span><span class="ident" id="7139526"><a href="/crypto/tls/handshake_test.go.html#7139332">b</a></span><span class="op" id="7139527">)</span><span class="op" id="7139528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7139532">copy</span><span class="op" id="7139536">(</span><span class="ident" id="7139537"><a href="/crypto/tls/handshake_test.go.html#7139502">buf</a></span><span class="op" id="7139540">,</span>&nbsp;<span class="ident" id="7139542"><a href="/crypto/tls/handshake_test.go.html#7139332">b</a></span><span class="op" id="7139543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139547"><a href="/crypto/tls/handshake_test.go.html#7139308">r</a></span><span class="op" id="7139548">.</span><span class="ident" id="7139549">flows</span>&nbsp;<span class="op" id="7139555">=</span>&nbsp;<span class="builtinfunc" id="7139557">append</span><span class="op" id="7139563">(</span><span class="ident" id="7139564"><a href="/crypto/tls/handshake_test.go.html#7139308">r</a></span><span class="op" id="7139565">.</span><span class="ident" id="7139566">flows</span><span class="op" id="7139571">,</span>&nbsp;<span class="ident" id="7139573"><a href="/crypto/tls/handshake_test.go.html#7139502">buf</a></span><span class="op" id="7139576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139579">}</span>&nbsp;<span class="keyword" id="7139581">else</span>&nbsp;<span class="op" id="7139586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139590"><a href="/crypto/tls/handshake_test.go.html#7139308">r</a></span><span class="op" id="7139591">.</span><span class="ident" id="7139592">flows</span><span class="op" id="7139597">[</span><span class="ident" id="7139598"><a href="/crypto/tls/handshake_test.go.html#7139459">l</a></span><span class="op" id="7139599">-</span><span class="num" id="7139600">1</span><span class="op" id="7139601">]</span>&nbsp;<span class="op" id="7139603">=</span>&nbsp;<span class="builtinfunc" id="7139605">append</span><span class="op" id="7139611">(</span><span class="ident" id="7139612"><a href="/crypto/tls/handshake_test.go.html#7139308">r</a></span><span class="op" id="7139613">.</span><span class="ident" id="7139614">flows</span><span class="op" id="7139619">[</span><span class="ident" id="7139620"><a href="/crypto/tls/handshake_test.go.html#7139459">l</a></span><span class="op" id="7139621">-</span><span class="num" id="7139622">1</span><span class="op" id="7139623">]</span><span class="op" id="7139624">,</span>&nbsp;<span class="ident" id="7139626"><a href="/crypto/tls/handshake_test.go.html#7139332">b</a></span><span class="op" id="7139627">[</span><span class="op" id="7139628">:</span><span class="ident" id="7139629"><a href="/crypto/tls/handshake_test.go.html#7139343">n</a></span><span class="op" id="7139630">]</span><span class="op" id="7139631">...</span><span class="op" id="7139634">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139640"><a href="/crypto/tls/handshake_test.go.html#7139308">r</a></span><span class="op" id="7139641">.</span><span class="ident" id="7139642">reading</span>&nbsp;<span class="op" id="7139650">=</span>&nbsp;<span class="ident" id="7139652">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139659">return</span><br>
<span class="lineno"></span><span class="op" id="7139666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="7139669">//&nbsp;WriteTo&nbsp;writes&nbsp;Go&nbsp;source&nbsp;code&nbsp;to&nbsp;w&nbsp;that&nbsp;contains&nbsp;the&nbsp;recorded&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="7139743">func</span>&nbsp;<span class="op" id="7139748">(</span><span class="ident" id="7139749">r</span>&nbsp;<span class="op" id="7139751">*</span><span class="ident" id="7139752"><a href="/crypto/tls/handshake_test.go.html#7138857">recordingConn</a></span><span class="op" id="7139765">)</span>&nbsp;<span class="ident" id="7139767">WriteTo</span><span class="op" id="7139774">(</span><span class="ident" id="7139775">w</span>&nbsp;<span class="ident" id="7139777"><a href="/crypto/tls/handshake_test.go.html#7137605">io</a></span><span class="op" id="7139779">.</span><span class="ident" id="7139780">Writer</span><span class="op" id="7139786">)</span>&nbsp;<span class="op" id="7139788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7139791">//&nbsp;TLS&nbsp;always&nbsp;starts&nbsp;with&nbsp;a&nbsp;client&nbsp;to&nbsp;server&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139843">clientToServer</span>&nbsp;<span class="op" id="7139858">:=</span>&nbsp;<span class="ident" id="7139861">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139868">for</span>&nbsp;<span class="ident" id="7139872">i</span><span class="op" id="7139873">,</span>&nbsp;<span class="ident" id="7139875">flow</span>&nbsp;<span class="op" id="7139880">:=</span>&nbsp;<span class="keyword" id="7139883">range</span>&nbsp;<span class="ident" id="7139889"><a href="/crypto/tls/handshake_test.go.html#7139749">r</a></span><span class="op" id="7139890">.</span><span class="ident" id="7139891">flows</span>&nbsp;<span class="op" id="7139897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139901">source</span><span class="op" id="7139907">,</span>&nbsp;<span class="ident" id="7139909">dest</span>&nbsp;<span class="op" id="7139914">:=</span>&nbsp;<span class="string" id="7139917">&#34;client&#34;</span><span class="op" id="7139925">,</span>&nbsp;<span class="string" id="7139927">&#34;server&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139938">if</span>&nbsp;<span class="op" id="7139941">!</span><span class="ident" id="7139942"><a href="/crypto/tls/handshake_test.go.html#7139843">clientToServer</a></span>&nbsp;<span class="op" id="7139957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139962"><a href="/crypto/tls/handshake_test.go.html#7139901">source</a></span><span class="op" id="7139968">,</span>&nbsp;<span class="ident" id="7139970"><a href="/crypto/tls/handshake_test.go.html#7139909">dest</a></span>&nbsp;<span class="op" id="7139975">=</span>&nbsp;<span class="ident" id="7139977"><a href="/crypto/tls/handshake_test.go.html#7139909">dest</a></span><span class="op" id="7139981">,</span>&nbsp;<span class="ident" id="7139983"><a href="/crypto/tls/handshake_test.go.html#7139901">source</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139992">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139996"><a href="/crypto/tls/handshake_test.go.html#7137598">fmt</a></span><span class="op" id="7139999">.</span><span class="ident" id="7140000">Fprintf</span><span class="op" id="7140007">(</span><span class="ident" id="7140008"><a href="/crypto/tls/handshake_test.go.html#7139775">w</a></span><span class="op" id="7140009">,</span>&nbsp;<span class="string" id="7140011">&#34;&gt;&gt;&gt;&nbsp;Flow&nbsp;%d&nbsp;(%s&nbsp;to&nbsp;%s)\n&#34;</span><span class="op" id="7140037">,</span>&nbsp;<span class="ident" id="7140039"><a href="/crypto/tls/handshake_test.go.html#7139872">i</a></span><span class="op" id="7140040">+</span><span class="num" id="7140041">1</span><span class="op" id="7140042">,</span>&nbsp;<span class="ident" id="7140044"><a href="/crypto/tls/handshake_test.go.html#7139901">source</a></span><span class="op" id="7140050">,</span>&nbsp;<span class="ident" id="7140052"><a href="/crypto/tls/handshake_test.go.html#7139909">dest</a></span><span class="op" id="7140056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140060">dumper</span>&nbsp;<span class="op" id="7140067">:=</span>&nbsp;<span class="ident" id="7140070"><a href="/crypto/tls/handshake_test.go.html#7137564">hex</a></span><span class="op" id="7140073">.</span><span class="ident" id="7140074">Dumper</span><span class="op" id="7140080">(</span><span class="ident" id="7140081"><a href="/crypto/tls/handshake_test.go.html#7139775">w</a></span><span class="op" id="7140082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140086"><a href="/crypto/tls/handshake_test.go.html#7140060">dumper</a></span><span class="op" id="7140092">.</span><span class="ident" id="7140093">Write</span><span class="op" id="7140098">(</span><span class="ident" id="7140099"><a href="/crypto/tls/handshake_test.go.html#7139875">flow</a></span><span class="op" id="7140103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140107"><a href="/crypto/tls/handshake_test.go.html#7140060">dumper</a></span><span class="op" id="7140113">.</span><span class="ident" id="7140114">Close</span><span class="op" id="7140119">(</span><span class="op" id="7140120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140124"><a href="/crypto/tls/handshake_test.go.html#7139843">clientToServer</a></span>&nbsp;<span class="op" id="7140139">=</span>&nbsp;<span class="op" id="7140141">!</span><span class="ident" id="7140142"><a href="/crypto/tls/handshake_test.go.html#7139843">clientToServer</a></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140158">}</span><br>
<span class="lineno"></span><span class="op" id="7140160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7140163">func</span>&nbsp;<span class="ident" id="7140168">parseTestData</span><span class="op" id="7140181">(</span><span class="ident" id="7140182">r</span>&nbsp;<span class="ident" id="7140184"><a href="/crypto/tls/handshake_test.go.html#7137605">io</a></span><span class="op" id="7140186">.</span><span class="ident" id="7140187">Reader</span><span class="op" id="7140193">)</span>&nbsp;<span class="op" id="7140195">(</span><span class="ident" id="7140196">flows</span>&nbsp;<span class="op" id="7140202">[</span><span class="op" id="7140203">]</span><span class="op" id="7140204">[</span><span class="op" id="7140205">]</span><span class="builtintype" id="7140206">byte</span><span class="op" id="7140210">,</span>&nbsp;<span class="ident" id="7140212">err</span>&nbsp;<span class="builtintype" id="7140216">error</span><span class="op" id="7140221">)</span>&nbsp;<span class="op" id="7140223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140226">var</span>&nbsp;<span class="ident" id="7140230">currentFlow</span>&nbsp;<span class="op" id="7140242">[</span><span class="op" id="7140243">]</span><span class="builtintype" id="7140244">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140251">scanner</span>&nbsp;<span class="op" id="7140259">:=</span>&nbsp;<span class="ident" id="7140262"><a href="/crypto/tls/handshake_test.go.html#7137555">bufio</a></span><span class="op" id="7140267">.</span><span class="ident" id="7140268">NewScanner</span><span class="op" id="7140278">(</span><span class="ident" id="7140279"><a href="/crypto/tls/handshake_test.go.html#7140182">r</a></span><span class="op" id="7140280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140283">for</span>&nbsp;<span class="ident" id="7140287"><a href="/crypto/tls/handshake_test.go.html#7140251">scanner</a></span><span class="op" id="7140294">.</span><span class="ident" id="7140295">Scan</span><span class="op" id="7140299">(</span><span class="op" id="7140300">)</span>&nbsp;<span class="op" id="7140302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140306">line</span>&nbsp;<span class="op" id="7140311">:=</span>&nbsp;<span class="ident" id="7140314"><a href="/crypto/tls/handshake_test.go.html#7140251">scanner</a></span><span class="op" id="7140321">.</span><span class="ident" id="7140322">Text</span><span class="op" id="7140326">(</span><span class="op" id="7140327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7140331">//&nbsp;If&nbsp;the&nbsp;line&nbsp;starts&nbsp;with&nbsp;&#34;&gt;&gt;&gt;&nbsp;&#34;&nbsp;then&nbsp;it&nbsp;marks&nbsp;the&nbsp;beginning</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7140395">//&nbsp;of&nbsp;a&nbsp;new&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140415">if</span>&nbsp;<span class="ident" id="7140418"><a href="/crypto/tls/handshake_test.go.html#7137642">strings</a></span><span class="op" id="7140425">.</span><span class="ident" id="7140426">HasPrefix</span><span class="op" id="7140435">(</span><span class="ident" id="7140436"><a href="/crypto/tls/handshake_test.go.html#7140306">line</a></span><span class="op" id="7140440">,</span>&nbsp;<span class="string" id="7140442">&#34;&gt;&gt;&gt;&nbsp;&#34;</span><span class="op" id="7140448">)</span>&nbsp;<span class="op" id="7140450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140455">if</span>&nbsp;<span class="builtinfunc" id="7140458">len</span><span class="op" id="7140461">(</span><span class="ident" id="7140462"><a href="/crypto/tls/handshake_test.go.html#7140230">currentFlow</a></span><span class="op" id="7140473">)</span>&nbsp;<span class="op" id="7140475">&gt;</span>&nbsp;<span class="num" id="7140477">0</span>&nbsp;<span class="op" id="7140479">||</span>&nbsp;<span class="builtinfunc" id="7140482">len</span><span class="op" id="7140485">(</span><span class="ident" id="7140486"><a href="/crypto/tls/handshake_test.go.html#7140196">flows</a></span><span class="op" id="7140491">)</span>&nbsp;<span class="op" id="7140493">&gt;</span>&nbsp;<span class="num" id="7140495">0</span>&nbsp;<span class="op" id="7140497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140503"><a href="/crypto/tls/handshake_test.go.html#7140196">flows</a></span>&nbsp;<span class="op" id="7140509">=</span>&nbsp;<span class="builtinfunc" id="7140511">append</span><span class="op" id="7140517">(</span><span class="ident" id="7140518"><a href="/crypto/tls/handshake_test.go.html#7140196">flows</a></span><span class="op" id="7140523">,</span>&nbsp;<span class="ident" id="7140525"><a href="/crypto/tls/handshake_test.go.html#7140230">currentFlow</a></span><span class="op" id="7140536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140542"><a href="/crypto/tls/handshake_test.go.html#7140230">currentFlow</a></span>&nbsp;<span class="op" id="7140554">=</span>&nbsp;<span class="ident" id="7140556">nil</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140568">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7140584">//&nbsp;Otherwise&nbsp;the&nbsp;line&nbsp;is&nbsp;a&nbsp;line&nbsp;of&nbsp;hex&nbsp;dump&nbsp;that&nbsp;looks&nbsp;like:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7140647">//&nbsp;00000170&nbsp;&nbsp;fc&nbsp;f5&nbsp;06&nbsp;bf&nbsp;(...)&nbsp;&nbsp;|.....X{&amp;?......!|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7140700">//&nbsp;(Some&nbsp;bytes&nbsp;have&nbsp;been&nbsp;omitted&nbsp;from&nbsp;the&nbsp;middle&nbsp;section.)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140762">if</span>&nbsp;<span class="ident" id="7140765">i</span>&nbsp;<span class="op" id="7140767">:=</span>&nbsp;<span class="ident" id="7140770"><a href="/crypto/tls/handshake_test.go.html#7137642">strings</a></span><span class="op" id="7140777">.</span><span class="ident" id="7140778">IndexByte</span><span class="op" id="7140787">(</span><span class="ident" id="7140788"><a href="/crypto/tls/handshake_test.go.html#7140306">line</a></span><span class="op" id="7140792">,</span>&nbsp;<span class="string" id="7140794">&#39;&nbsp;&#39;</span><span class="op" id="7140797">)</span><span class="op" id="7140798">;</span>&nbsp;<span class="ident" id="7140800"><a href="/crypto/tls/handshake_test.go.html#7140765">i</a></span>&nbsp;<span class="op" id="7140802">&gt;=</span>&nbsp;<span class="num" id="7140805">0</span>&nbsp;<span class="op" id="7140807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140812"><a href="/crypto/tls/handshake_test.go.html#7140306">line</a></span>&nbsp;<span class="op" id="7140817">=</span>&nbsp;<span class="ident" id="7140819"><a href="/crypto/tls/handshake_test.go.html#7140306">line</a></span><span class="op" id="7140823">[</span><span class="ident" id="7140824"><a href="/crypto/tls/handshake_test.go.html#7140765">i</a></span><span class="op" id="7140825">:</span><span class="op" id="7140826">]</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140830">}</span>&nbsp;<span class="keyword" id="7140832">else</span>&nbsp;<span class="op" id="7140837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140842">return</span>&nbsp;<span class="ident" id="7140849">nil</span><span class="op" id="7140852">,</span>&nbsp;<span class="ident" id="7140854"><a href="/crypto/tls/handshake_test.go.html#7137580">errors</a></span><span class="op" id="7140860">.</span><span class="ident" id="7140861">New</span><span class="op" id="7140864">(</span><span class="string" id="7140865">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="7140884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140893">if</span>&nbsp;<span class="ident" id="7140896">i</span>&nbsp;<span class="op" id="7140898">:=</span>&nbsp;<span class="ident" id="7140901"><a href="/crypto/tls/handshake_test.go.html#7137642">strings</a></span><span class="op" id="7140908">.</span><span class="ident" id="7140909">IndexByte</span><span class="op" id="7140918">(</span><span class="ident" id="7140919"><a href="/crypto/tls/handshake_test.go.html#7140306">line</a></span><span class="op" id="7140923">,</span>&nbsp;<span class="string" id="7140925">&#39;|&#39;</span><span class="op" id="7140928">)</span><span class="op" id="7140929">;</span>&nbsp;<span class="ident" id="7140931"><a href="/crypto/tls/handshake_test.go.html#7140896">i</a></span>&nbsp;<span class="op" id="7140933">&gt;=</span>&nbsp;<span class="num" id="7140936">0</span>&nbsp;<span class="op" id="7140938">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140943"><a href="/crypto/tls/handshake_test.go.html#7140306">line</a></span>&nbsp;<span class="op" id="7140948">=</span>&nbsp;<span class="ident" id="7140950"><a href="/crypto/tls/handshake_test.go.html#7140306">line</a></span><span class="op" id="7140954">[</span><span class="op" id="7140955">:</span><span class="ident" id="7140956"><a href="/crypto/tls/handshake_test.go.html#7140896">i</a></span><span class="op" id="7140957">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140961">}</span>&nbsp;<span class="keyword" id="7140963">else</span>&nbsp;<span class="op" id="7140968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140973">return</span>&nbsp;<span class="ident" id="7140980">nil</span><span class="op" id="7140983">,</span>&nbsp;<span class="ident" id="7140985"><a href="/crypto/tls/handshake_test.go.html#7137580">errors</a></span><span class="op" id="7140991">.</span><span class="ident" id="7140992">New</span><span class="op" id="7140995">(</span><span class="string" id="7140996">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="7141015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141024">hexBytes</span>&nbsp;<span class="op" id="7141033">:=</span>&nbsp;<span class="ident" id="7141036"><a href="/crypto/tls/handshake_test.go.html#7137642">strings</a></span><span class="op" id="7141043">.</span><span class="ident" id="7141044">Fields</span><span class="op" id="7141050">(</span><span class="ident" id="7141051"><a href="/crypto/tls/handshake_test.go.html#7140306">line</a></span><span class="op" id="7141055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141059">for</span>&nbsp;<span class="ident" id="7141063">_</span><span class="op" id="7141064">,</span>&nbsp;<span class="ident" id="7141066">hexByte</span>&nbsp;<span class="op" id="7141074">:=</span>&nbsp;<span class="keyword" id="7141077">range</span>&nbsp;<span class="ident" id="7141083"><a href="/crypto/tls/handshake_test.go.html#7141024">hexBytes</a></span>&nbsp;<span class="op" id="7141092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141097">val</span><span class="op" id="7141100">,</span>&nbsp;<span class="ident" id="7141102">err</span>&nbsp;<span class="op" id="7141106">:=</span>&nbsp;<span class="ident" id="7141109"><a href="/crypto/tls/handshake_test.go.html#7137631">strconv</a></span><span class="op" id="7141116">.</span><span class="ident" id="7141117">ParseUint</span><span class="op" id="7141126">(</span><span class="ident" id="7141127"><a href="/crypto/tls/handshake_test.go.html#7141066">hexByte</a></span><span class="op" id="7141134">,</span>&nbsp;<span class="num" id="7141136">16</span><span class="op" id="7141138">,</span>&nbsp;<span class="num" id="7141140">8</span><span class="op" id="7141141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141146">if</span>&nbsp;<span class="ident" id="7141149"><a href="/crypto/tls/handshake_test.go.html#7141102">err</a></span>&nbsp;<span class="op" id="7141153">!=</span>&nbsp;<span class="ident" id="7141156">nil</span>&nbsp;<span class="op" id="7141160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141166">return</span>&nbsp;<span class="ident" id="7141173">nil</span><span class="op" id="7141176">,</span>&nbsp;<span class="ident" id="7141178"><a href="/crypto/tls/handshake_test.go.html#7137580">errors</a></span><span class="op" id="7141184">.</span><span class="ident" id="7141185">New</span><span class="op" id="7141188">(</span><span class="string" id="7141189">&#34;invalid&nbsp;hex&nbsp;byte&nbsp;in&nbsp;test&nbsp;data:&nbsp;&#34;</span>&nbsp;<span class="op" id="7141223">+</span>&nbsp;<span class="ident" id="7141225"><a href="/crypto/tls/handshake_test.go.html#7141102">err</a></span><span class="op" id="7141228">.</span><span class="ident" id="7141229">Error</span><span class="op" id="7141234">(</span><span class="op" id="7141235">)</span><span class="op" id="7141236">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141246"><a href="/crypto/tls/handshake_test.go.html#7140230">currentFlow</a></span>&nbsp;<span class="op" id="7141258">=</span>&nbsp;<span class="builtinfunc" id="7141260">append</span><span class="op" id="7141266">(</span><span class="ident" id="7141267"><a href="/crypto/tls/handshake_test.go.html#7140230">currentFlow</a></span><span class="op" id="7141278">,</span>&nbsp;<span class="builtintype" id="7141280">byte</span><span class="op" id="7141284">(</span><span class="ident" id="7141285"><a href="/crypto/tls/handshake_test.go.html#7141097">val</a></span><span class="op" id="7141288">)</span><span class="op" id="7141289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141300">if</span>&nbsp;<span class="builtinfunc" id="7141303">len</span><span class="op" id="7141306">(</span><span class="ident" id="7141307"><a href="/crypto/tls/handshake_test.go.html#7140230">currentFlow</a></span><span class="op" id="7141318">)</span>&nbsp;<span class="op" id="7141320">&gt;</span>&nbsp;<span class="num" id="7141322">0</span>&nbsp;<span class="op" id="7141324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141328"><a href="/crypto/tls/handshake_test.go.html#7140196">flows</a></span>&nbsp;<span class="op" id="7141334">=</span>&nbsp;<span class="builtinfunc" id="7141336">append</span><span class="op" id="7141342">(</span><span class="ident" id="7141343"><a href="/crypto/tls/handshake_test.go.html#7140196">flows</a></span><span class="op" id="7141348">,</span>&nbsp;<span class="ident" id="7141350"><a href="/crypto/tls/handshake_test.go.html#7140230">currentFlow</a></span><span class="op" id="7141361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141368">return</span>&nbsp;<span class="ident" id="7141375"><a href="/crypto/tls/handshake_test.go.html#7140196">flows</a></span><span class="op" id="7141380">,</span>&nbsp;<span class="ident" id="7141382">nil</span><br>
<span class="lineno">155</span><span class="op" id="7141386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7141389">//&nbsp;tempFile&nbsp;creates&nbsp;a&nbsp;temp&nbsp;file&nbsp;containing&nbsp;contents&nbsp;and&nbsp;returns&nbsp;its&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="7141463">func</span>&nbsp;<span class="ident" id="7141468">tempFile</span><span class="op" id="7141476">(</span><span class="ident" id="7141477">contents</span>&nbsp;<span class="builtintype" id="7141486">string</span><span class="op" id="7141492">)</span>&nbsp;<span class="builtintype" id="7141494">string</span>&nbsp;<span class="op" id="7141501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141504">file</span><span class="op" id="7141508">,</span>&nbsp;<span class="ident" id="7141510">err</span>&nbsp;<span class="op" id="7141514">:=</span>&nbsp;<span class="ident" id="7141517"><a href="/crypto/tls/handshake_test.go.html#7137611">ioutil</a></span><span class="op" id="7141523">.</span><span class="ident" id="7141524">TempFile</span><span class="op" id="7141532">(</span><span class="string" id="7141533">&#34;&#34;</span><span class="op" id="7141535">,</span>&nbsp;<span class="string" id="7141537">&#34;go-tls-test&#34;</span><span class="op" id="7141550">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141553">if</span>&nbsp;<span class="ident" id="7141556"><a href="/crypto/tls/handshake_test.go.html#7141510">err</a></span>&nbsp;<span class="op" id="7141560">!=</span>&nbsp;<span class="ident" id="7141563">nil</span>&nbsp;<span class="op" id="7141567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7141571">panic</span><span class="op" id="7141576">(</span><span class="string" id="7141577">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file:&nbsp;&#34;</span>&nbsp;<span class="op" id="7141608">+</span>&nbsp;<span class="ident" id="7141610"><a href="/crypto/tls/handshake_test.go.html#7141510">err</a></span><span class="op" id="7141613">.</span><span class="ident" id="7141614">Error</span><span class="op" id="7141619">(</span><span class="op" id="7141620">)</span><span class="op" id="7141621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141627">path</span>&nbsp;<span class="op" id="7141632">:=</span>&nbsp;<span class="ident" id="7141635"><a href="/crypto/tls/handshake_test.go.html#7141504">file</a></span><span class="op" id="7141639">.</span><span class="ident" id="7141640">Name</span><span class="op" id="7141644">(</span><span class="op" id="7141645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141648"><a href="/crypto/tls/handshake_test.go.html#7141504">file</a></span><span class="op" id="7141652">.</span><span class="ident" id="7141653">WriteString</span><span class="op" id="7141664">(</span><span class="ident" id="7141665"><a href="/crypto/tls/handshake_test.go.html#7141477">contents</a></span><span class="op" id="7141673">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141676"><a href="/crypto/tls/handshake_test.go.html#7141504">file</a></span><span class="op" id="7141680">.</span><span class="ident" id="7141681">Close</span><span class="op" id="7141686">(</span><span class="op" id="7141687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141690">return</span>&nbsp;<span class="ident" id="7141697"><a href="/crypto/tls/handshake_test.go.html#7141627">path</a></span><br>
<span class="lineno"></span><span class="op" id="7141702">}</span>
</div>
</body>
</html>
