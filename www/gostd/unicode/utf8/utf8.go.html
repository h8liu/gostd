<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>unicode/utf8</h2>
<ul>
<li><a href="/gostd/unicode/utf8/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8.go.html" class="current">utf8.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8_test.go.html">utf8_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1751484">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1751539">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1751593">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1751644">//&nbsp;Package&nbsp;utf8&nbsp;implements&nbsp;functions&nbsp;and&nbsp;constants&nbsp;to&nbsp;support&nbsp;text&nbsp;encoded&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1751722">//&nbsp;UTF-8.&nbsp;It&nbsp;includes&nbsp;functions&nbsp;to&nbsp;translate&nbsp;between&nbsp;runes&nbsp;and&nbsp;UTF-8&nbsp;byte&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="keyword" id="1751807">package</span>&nbsp;<span class="ident" id="1751815">utf8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1751821">//&nbsp;The&nbsp;conditions&nbsp;RuneError==unicode.ReplacementChar&nbsp;and</span><br>
<span class="lineno">10</span><span class="comment" id="1751878">//&nbsp;MaxRune==unicode.MaxRune&nbsp;are&nbsp;verified&nbsp;in&nbsp;the&nbsp;tests.</span><br>
<span class="lineno"></span><span class="comment" id="1751933">//&nbsp;Defining&nbsp;them&nbsp;locally&nbsp;avoids&nbsp;this&nbsp;package&nbsp;depending&nbsp;on&nbsp;package&nbsp;unicode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1752009">//&nbsp;Numbers&nbsp;fundamental&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="1752049">const</span>&nbsp;<span class="op" id="1752055">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752058">RuneError</span>&nbsp;<span class="op" id="1752068">=</span>&nbsp;<span class="string" id="1752070">&#39;\uFFFD&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1752083">//&nbsp;the&nbsp;&#34;error&#34;&nbsp;Rune&nbsp;or&nbsp;&#34;Unicode&nbsp;replacement&nbsp;character&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752139">RuneSelf</span>&nbsp;&nbsp;<span class="op" id="1752149">=</span>&nbsp;<span class="num" id="1752151">0x80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1752164">//&nbsp;characters&nbsp;below&nbsp;Runeself&nbsp;are&nbsp;represented&nbsp;as&nbsp;themselves&nbsp;in&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752242">MaxRune</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1752252">=</span>&nbsp;<span class="string" id="1752254">&#39;\U0010FFFF&#39;</span>&nbsp;<span class="comment" id="1752267">//&nbsp;Maximum&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752305">UTFMax</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1752315">=</span>&nbsp;<span class="num" id="1752317">4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1752330">//&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;a&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character.</span><br>
<span class="lineno"></span><span class="op" id="1752395">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="1752398">//&nbsp;Code&nbsp;points&nbsp;in&nbsp;the&nbsp;surrogate&nbsp;range&nbsp;are&nbsp;not&nbsp;valid&nbsp;for&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="1752461">const</span>&nbsp;<span class="op" id="1752467">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752470">surrogateMin</span>&nbsp;<span class="op" id="1752483">=</span>&nbsp;<span class="num" id="1752485">0xD800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752493">surrogateMax</span>&nbsp;<span class="op" id="1752506">=</span>&nbsp;<span class="num" id="1752508">0xDFFF</span><br>
<span class="lineno">25</span><span class="op" id="1752515">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1752518">const</span>&nbsp;<span class="op" id="1752524">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752527">t1</span>&nbsp;<span class="op" id="1752530">=</span>&nbsp;<span class="num" id="1752532">0x00</span>&nbsp;<span class="comment" id="1752537">//&nbsp;0000&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752551">tx</span>&nbsp;<span class="op" id="1752554">=</span>&nbsp;<span class="num" id="1752556">0x80</span>&nbsp;<span class="comment" id="1752561">//&nbsp;1000&nbsp;0000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752575">t2</span>&nbsp;<span class="op" id="1752578">=</span>&nbsp;<span class="num" id="1752580">0xC0</span>&nbsp;<span class="comment" id="1752585">//&nbsp;1100&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752599">t3</span>&nbsp;<span class="op" id="1752602">=</span>&nbsp;<span class="num" id="1752604">0xE0</span>&nbsp;<span class="comment" id="1752609">//&nbsp;1110&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752623">t4</span>&nbsp;<span class="op" id="1752626">=</span>&nbsp;<span class="num" id="1752628">0xF0</span>&nbsp;<span class="comment" id="1752633">//&nbsp;1111&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752647">t5</span>&nbsp;<span class="op" id="1752650">=</span>&nbsp;<span class="num" id="1752652">0xF8</span>&nbsp;<span class="comment" id="1752657">//&nbsp;1111&nbsp;1000</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752672">maskx</span>&nbsp;<span class="op" id="1752678">=</span>&nbsp;<span class="num" id="1752680">0x3F</span>&nbsp;<span class="comment" id="1752685">//&nbsp;0011&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752699">mask2</span>&nbsp;<span class="op" id="1752705">=</span>&nbsp;<span class="num" id="1752707">0x1F</span>&nbsp;<span class="comment" id="1752712">//&nbsp;0001&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752726">mask3</span>&nbsp;<span class="op" id="1752732">=</span>&nbsp;<span class="num" id="1752734">0x0F</span>&nbsp;<span class="comment" id="1752739">//&nbsp;0000&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752753">mask4</span>&nbsp;<span class="op" id="1752759">=</span>&nbsp;<span class="num" id="1752761">0x07</span>&nbsp;<span class="comment" id="1752766">//&nbsp;0000&nbsp;0111</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752781">rune1Max</span>&nbsp;<span class="op" id="1752790">=</span>&nbsp;<span class="num" id="1752792">1</span><span class="op" id="1752793">&lt;&lt;</span><span class="num" id="1752795">7</span>&nbsp;<span class="op" id="1752797">-</span>&nbsp;<span class="num" id="1752799">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752802">rune2Max</span>&nbsp;<span class="op" id="1752811">=</span>&nbsp;<span class="num" id="1752813">1</span><span class="op" id="1752814">&lt;&lt;</span><span class="num" id="1752816">11</span>&nbsp;<span class="op" id="1752819">-</span>&nbsp;<span class="num" id="1752821">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752824">rune3Max</span>&nbsp;<span class="op" id="1752833">=</span>&nbsp;<span class="num" id="1752835">1</span><span class="op" id="1752836">&lt;&lt;</span><span class="num" id="1752838">16</span>&nbsp;<span class="op" id="1752841">-</span>&nbsp;<span class="num" id="1752843">1</span><br>
<span class="lineno"></span><span class="op" id="1752845">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="1752848">func</span>&nbsp;<span class="ident" id="1752853">decodeRuneInternal</span><span class="op" id="1752871">(</span><span class="ident" id="1752872">p</span>&nbsp;<span class="op" id="1752874">[</span><span class="op" id="1752875">]</span><span class="builtintype" id="1752876">byte</span><span class="op" id="1752880">)</span>&nbsp;<span class="op" id="1752882">(</span><span class="ident" id="1752883">r</span>&nbsp;<span class="builtintype" id="1752885">rune</span><span class="op" id="1752889">,</span>&nbsp;<span class="ident" id="1752891">size</span>&nbsp;<span class="builtintype" id="1752896">int</span><span class="op" id="1752899">,</span>&nbsp;<span class="ident" id="1752901">short</span>&nbsp;<span class="builtintype" id="1752907">bool</span><span class="op" id="1752911">)</span>&nbsp;<span class="op" id="1752913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752916">n</span>&nbsp;<span class="op" id="1752918">:=</span>&nbsp;<span class="builtinfunc" id="1752921">len</span><span class="op" id="1752924">(</span><span class="ident" id="1752925">p</span><span class="op" id="1752926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1752929">if</span>&nbsp;<span class="ident" id="1752932">n</span>&nbsp;<span class="op" id="1752934">&lt;</span>&nbsp;<span class="num" id="1752936">1</span>&nbsp;<span class="op" id="1752938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1752942">return</span>&nbsp;<span class="ident" id="1752949">RuneError</span><span class="op" id="1752958">,</span>&nbsp;<span class="num" id="1752960">0</span><span class="op" id="1752961">,</span>&nbsp;<span class="builtintype" id="1752963">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1752969">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752972">c0</span>&nbsp;<span class="op" id="1752975">:=</span>&nbsp;<span class="ident" id="1752978">p</span><span class="op" id="1752979">[</span><span class="num" id="1752980">0</span><span class="op" id="1752981">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1752985">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753013">if</span>&nbsp;<span class="ident" id="1753016">c0</span>&nbsp;<span class="op" id="1753019">&lt;</span>&nbsp;<span class="ident" id="1753021">tx</span>&nbsp;<span class="op" id="1753024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753028">return</span>&nbsp;<span class="builtintype" id="1753035">rune</span><span class="op" id="1753039">(</span><span class="ident" id="1753040">c0</span><span class="op" id="1753042">)</span><span class="op" id="1753043">,</span>&nbsp;<span class="num" id="1753045">1</span><span class="op" id="1753046">,</span>&nbsp;<span class="builtintype" id="1753048">false</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1753055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1753059">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753093">if</span>&nbsp;<span class="ident" id="1753096">c0</span>&nbsp;<span class="op" id="1753099">&lt;</span>&nbsp;<span class="ident" id="1753101">t2</span>&nbsp;<span class="op" id="1753104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753108">return</span>&nbsp;<span class="ident" id="1753115">RuneError</span><span class="op" id="1753124">,</span>&nbsp;<span class="num" id="1753126">1</span><span class="op" id="1753127">,</span>&nbsp;<span class="builtintype" id="1753129">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1753136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1753140">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753173">if</span>&nbsp;<span class="ident" id="1753176">n</span>&nbsp;<span class="op" id="1753178">&lt;</span>&nbsp;<span class="num" id="1753180">2</span>&nbsp;<span class="op" id="1753182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753186">return</span>&nbsp;<span class="ident" id="1753193">RuneError</span><span class="op" id="1753202">,</span>&nbsp;<span class="num" id="1753204">1</span><span class="op" id="1753205">,</span>&nbsp;<span class="builtintype" id="1753207">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1753213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1753216">c1</span>&nbsp;<span class="op" id="1753219">:=</span>&nbsp;<span class="ident" id="1753222">p</span><span class="op" id="1753223">[</span><span class="num" id="1753224">1</span><span class="op" id="1753225">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753228">if</span>&nbsp;<span class="ident" id="1753231">c1</span>&nbsp;<span class="op" id="1753234">&lt;</span>&nbsp;<span class="ident" id="1753236">tx</span>&nbsp;<span class="op" id="1753239">||</span>&nbsp;<span class="ident" id="1753242">t2</span>&nbsp;<span class="op" id="1753245">&lt;=</span>&nbsp;<span class="ident" id="1753248">c1</span>&nbsp;<span class="op" id="1753251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753255">return</span>&nbsp;<span class="ident" id="1753262">RuneError</span><span class="op" id="1753271">,</span>&nbsp;<span class="num" id="1753273">1</span><span class="op" id="1753274">,</span>&nbsp;<span class="builtintype" id="1753276">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1753283">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1753287">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753316">if</span>&nbsp;<span class="ident" id="1753319">c0</span>&nbsp;<span class="op" id="1753322">&lt;</span>&nbsp;<span class="ident" id="1753324">t3</span>&nbsp;<span class="op" id="1753327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1753331">r</span>&nbsp;<span class="op" id="1753333">=</span>&nbsp;<span class="builtintype" id="1753335">rune</span><span class="op" id="1753339">(</span><span class="ident" id="1753340">c0</span><span class="op" id="1753342">&amp;</span><span class="ident" id="1753343">mask2</span><span class="op" id="1753348">)</span><span class="op" id="1753349">&lt;&lt;</span><span class="num" id="1753351">6</span>&nbsp;<span class="op" id="1753353">|</span>&nbsp;<span class="builtintype" id="1753355">rune</span><span class="op" id="1753359">(</span><span class="ident" id="1753360">c1</span><span class="op" id="1753362">&amp;</span><span class="ident" id="1753363">maskx</span><span class="op" id="1753368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753372">if</span>&nbsp;<span class="ident" id="1753375">r</span>&nbsp;<span class="op" id="1753377">&lt;=</span>&nbsp;<span class="ident" id="1753380">rune1Max</span>&nbsp;<span class="op" id="1753389">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753394">return</span>&nbsp;<span class="ident" id="1753401">RuneError</span><span class="op" id="1753410">,</span>&nbsp;<span class="num" id="1753412">1</span><span class="op" id="1753413">,</span>&nbsp;<span class="builtintype" id="1753415">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1753423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753427">return</span>&nbsp;<span class="ident" id="1753434">r</span><span class="op" id="1753435">,</span>&nbsp;<span class="num" id="1753437">2</span><span class="op" id="1753438">,</span>&nbsp;<span class="builtintype" id="1753440">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1753447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1753451">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753485">if</span>&nbsp;<span class="ident" id="1753488">n</span>&nbsp;<span class="op" id="1753490">&lt;</span>&nbsp;<span class="num" id="1753492">3</span>&nbsp;<span class="op" id="1753494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753498">return</span>&nbsp;<span class="ident" id="1753505">RuneError</span><span class="op" id="1753514">,</span>&nbsp;<span class="num" id="1753516">1</span><span class="op" id="1753517">,</span>&nbsp;<span class="builtintype" id="1753519">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1753525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1753528">c2</span>&nbsp;<span class="op" id="1753531">:=</span>&nbsp;<span class="ident" id="1753534">p</span><span class="op" id="1753535">[</span><span class="num" id="1753536">2</span><span class="op" id="1753537">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753540">if</span>&nbsp;<span class="ident" id="1753543">c2</span>&nbsp;<span class="op" id="1753546">&lt;</span>&nbsp;<span class="ident" id="1753548">tx</span>&nbsp;<span class="op" id="1753551">||</span>&nbsp;<span class="ident" id="1753554">t2</span>&nbsp;<span class="op" id="1753557">&lt;=</span>&nbsp;<span class="ident" id="1753560">c2</span>&nbsp;<span class="op" id="1753563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753567">return</span>&nbsp;<span class="ident" id="1753574">RuneError</span><span class="op" id="1753583">,</span>&nbsp;<span class="num" id="1753585">1</span><span class="op" id="1753586">,</span>&nbsp;<span class="builtintype" id="1753588">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1753595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1753599">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753628">if</span>&nbsp;<span class="ident" id="1753631">c0</span>&nbsp;<span class="op" id="1753634">&lt;</span>&nbsp;<span class="ident" id="1753636">t4</span>&nbsp;<span class="op" id="1753639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1753643">r</span>&nbsp;<span class="op" id="1753645">=</span>&nbsp;<span class="builtintype" id="1753647">rune</span><span class="op" id="1753651">(</span><span class="ident" id="1753652">c0</span><span class="op" id="1753654">&amp;</span><span class="ident" id="1753655">mask3</span><span class="op" id="1753660">)</span><span class="op" id="1753661">&lt;&lt;</span><span class="num" id="1753663">12</span>&nbsp;<span class="op" id="1753666">|</span>&nbsp;<span class="builtintype" id="1753668">rune</span><span class="op" id="1753672">(</span><span class="ident" id="1753673">c1</span><span class="op" id="1753675">&amp;</span><span class="ident" id="1753676">maskx</span><span class="op" id="1753681">)</span><span class="op" id="1753682">&lt;&lt;</span><span class="num" id="1753684">6</span>&nbsp;<span class="op" id="1753686">|</span>&nbsp;<span class="builtintype" id="1753688">rune</span><span class="op" id="1753692">(</span><span class="ident" id="1753693">c2</span><span class="op" id="1753695">&amp;</span><span class="ident" id="1753696">maskx</span><span class="op" id="1753701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753705">if</span>&nbsp;<span class="ident" id="1753708">r</span>&nbsp;<span class="op" id="1753710">&lt;=</span>&nbsp;<span class="ident" id="1753713">rune2Max</span>&nbsp;<span class="op" id="1753722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753727">return</span>&nbsp;<span class="ident" id="1753734">RuneError</span><span class="op" id="1753743">,</span>&nbsp;<span class="num" id="1753745">1</span><span class="op" id="1753746">,</span>&nbsp;<span class="builtintype" id="1753748">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1753756">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753760">if</span>&nbsp;<span class="ident" id="1753763">surrogateMin</span>&nbsp;<span class="op" id="1753776">&lt;=</span>&nbsp;<span class="ident" id="1753779">r</span>&nbsp;<span class="op" id="1753781">&amp;&amp;</span>&nbsp;<span class="ident" id="1753784">r</span>&nbsp;<span class="op" id="1753786">&lt;=</span>&nbsp;<span class="ident" id="1753789">surrogateMax</span>&nbsp;<span class="op" id="1753802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753807">return</span>&nbsp;<span class="ident" id="1753814">RuneError</span><span class="op" id="1753823">,</span>&nbsp;<span class="num" id="1753825">1</span><span class="op" id="1753826">,</span>&nbsp;<span class="builtintype" id="1753828">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1753836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753840">return</span>&nbsp;<span class="ident" id="1753847">r</span><span class="op" id="1753848">,</span>&nbsp;<span class="num" id="1753850">3</span><span class="op" id="1753851">,</span>&nbsp;<span class="builtintype" id="1753853">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1753860">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1753864">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753897">if</span>&nbsp;<span class="ident" id="1753900">n</span>&nbsp;<span class="op" id="1753902">&lt;</span>&nbsp;<span class="num" id="1753904">4</span>&nbsp;<span class="op" id="1753906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753910">return</span>&nbsp;<span class="ident" id="1753917">RuneError</span><span class="op" id="1753926">,</span>&nbsp;<span class="num" id="1753928">1</span><span class="op" id="1753929">,</span>&nbsp;<span class="builtintype" id="1753931">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1753937">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1753940">c3</span>&nbsp;<span class="op" id="1753943">:=</span>&nbsp;<span class="ident" id="1753946">p</span><span class="op" id="1753947">[</span><span class="num" id="1753948">3</span><span class="op" id="1753949">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753952">if</span>&nbsp;<span class="ident" id="1753955">c3</span>&nbsp;<span class="op" id="1753958">&lt;</span>&nbsp;<span class="ident" id="1753960">tx</span>&nbsp;<span class="op" id="1753963">||</span>&nbsp;<span class="ident" id="1753966">t2</span>&nbsp;<span class="op" id="1753969">&lt;=</span>&nbsp;<span class="ident" id="1753972">c3</span>&nbsp;<span class="op" id="1753975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753979">return</span>&nbsp;<span class="ident" id="1753986">RuneError</span><span class="op" id="1753995">,</span>&nbsp;<span class="num" id="1753997">1</span><span class="op" id="1753998">,</span>&nbsp;<span class="builtintype" id="1754000">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1754007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1754011">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754040">if</span>&nbsp;<span class="ident" id="1754043">c0</span>&nbsp;<span class="op" id="1754046">&lt;</span>&nbsp;<span class="ident" id="1754048">t5</span>&nbsp;<span class="op" id="1754051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1754055">r</span>&nbsp;<span class="op" id="1754057">=</span>&nbsp;<span class="builtintype" id="1754059">rune</span><span class="op" id="1754063">(</span><span class="ident" id="1754064">c0</span><span class="op" id="1754066">&amp;</span><span class="ident" id="1754067">mask4</span><span class="op" id="1754072">)</span><span class="op" id="1754073">&lt;&lt;</span><span class="num" id="1754075">18</span>&nbsp;<span class="op" id="1754078">|</span>&nbsp;<span class="builtintype" id="1754080">rune</span><span class="op" id="1754084">(</span><span class="ident" id="1754085">c1</span><span class="op" id="1754087">&amp;</span><span class="ident" id="1754088">maskx</span><span class="op" id="1754093">)</span><span class="op" id="1754094">&lt;&lt;</span><span class="num" id="1754096">12</span>&nbsp;<span class="op" id="1754099">|</span>&nbsp;<span class="builtintype" id="1754101">rune</span><span class="op" id="1754105">(</span><span class="ident" id="1754106">c2</span><span class="op" id="1754108">&amp;</span><span class="ident" id="1754109">maskx</span><span class="op" id="1754114">)</span><span class="op" id="1754115">&lt;&lt;</span><span class="num" id="1754117">6</span>&nbsp;<span class="op" id="1754119">|</span>&nbsp;<span class="builtintype" id="1754121">rune</span><span class="op" id="1754125">(</span><span class="ident" id="1754126">c3</span><span class="op" id="1754128">&amp;</span><span class="ident" id="1754129">maskx</span><span class="op" id="1754134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754138">if</span>&nbsp;<span class="ident" id="1754141">r</span>&nbsp;<span class="op" id="1754143">&lt;=</span>&nbsp;<span class="ident" id="1754146">rune3Max</span>&nbsp;<span class="op" id="1754155">||</span>&nbsp;<span class="ident" id="1754158">MaxRune</span>&nbsp;<span class="op" id="1754166">&lt;</span>&nbsp;<span class="ident" id="1754168">r</span>&nbsp;<span class="op" id="1754170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754175">return</span>&nbsp;<span class="ident" id="1754182">RuneError</span><span class="op" id="1754191">,</span>&nbsp;<span class="num" id="1754193">1</span><span class="op" id="1754194">,</span>&nbsp;<span class="builtintype" id="1754196">false</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1754204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754208">return</span>&nbsp;<span class="ident" id="1754215">r</span><span class="op" id="1754216">,</span>&nbsp;<span class="num" id="1754218">4</span><span class="op" id="1754219">,</span>&nbsp;<span class="builtintype" id="1754221">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1754228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1754232">//&nbsp;error</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754242">return</span>&nbsp;<span class="ident" id="1754249">RuneError</span><span class="op" id="1754258">,</span>&nbsp;<span class="num" id="1754260">1</span><span class="op" id="1754261">,</span>&nbsp;<span class="builtintype" id="1754263">false</span><br>
<span class="lineno"></span><span class="op" id="1754269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1754272">func</span>&nbsp;<span class="ident" id="1754277">decodeRuneInStringInternal</span><span class="op" id="1754303">(</span><span class="ident" id="1754304">s</span>&nbsp;<span class="builtintype" id="1754306">string</span><span class="op" id="1754312">)</span>&nbsp;<span class="op" id="1754314">(</span><span class="ident" id="1754315">r</span>&nbsp;<span class="builtintype" id="1754317">rune</span><span class="op" id="1754321">,</span>&nbsp;<span class="ident" id="1754323">size</span>&nbsp;<span class="builtintype" id="1754328">int</span><span class="op" id="1754331">,</span>&nbsp;<span class="ident" id="1754333">short</span>&nbsp;<span class="builtintype" id="1754339">bool</span><span class="op" id="1754343">)</span>&nbsp;<span class="op" id="1754345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1754348">n</span>&nbsp;<span class="op" id="1754350">:=</span>&nbsp;<span class="builtinfunc" id="1754353">len</span><span class="op" id="1754356">(</span><span class="ident" id="1754357">s</span><span class="op" id="1754358">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754361">if</span>&nbsp;<span class="ident" id="1754364">n</span>&nbsp;<span class="op" id="1754366">&lt;</span>&nbsp;<span class="num" id="1754368">1</span>&nbsp;<span class="op" id="1754370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754374">return</span>&nbsp;<span class="ident" id="1754381">RuneError</span><span class="op" id="1754390">,</span>&nbsp;<span class="num" id="1754392">0</span><span class="op" id="1754393">,</span>&nbsp;<span class="builtintype" id="1754395">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1754401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1754404">c0</span>&nbsp;<span class="op" id="1754407">:=</span>&nbsp;<span class="ident" id="1754410">s</span><span class="op" id="1754411">[</span><span class="num" id="1754412">0</span><span class="op" id="1754413">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1754417">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754445">if</span>&nbsp;<span class="ident" id="1754448">c0</span>&nbsp;<span class="op" id="1754451">&lt;</span>&nbsp;<span class="ident" id="1754453">tx</span>&nbsp;<span class="op" id="1754456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754460">return</span>&nbsp;<span class="builtintype" id="1754467">rune</span><span class="op" id="1754471">(</span><span class="ident" id="1754472">c0</span><span class="op" id="1754474">)</span><span class="op" id="1754475">,</span>&nbsp;<span class="num" id="1754477">1</span><span class="op" id="1754478">,</span>&nbsp;<span class="builtintype" id="1754480">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1754487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1754491">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754525">if</span>&nbsp;<span class="ident" id="1754528">c0</span>&nbsp;<span class="op" id="1754531">&lt;</span>&nbsp;<span class="ident" id="1754533">t2</span>&nbsp;<span class="op" id="1754536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754540">return</span>&nbsp;<span class="ident" id="1754547">RuneError</span><span class="op" id="1754556">,</span>&nbsp;<span class="num" id="1754558">1</span><span class="op" id="1754559">,</span>&nbsp;<span class="builtintype" id="1754561">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1754568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1754572">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754605">if</span>&nbsp;<span class="ident" id="1754608">n</span>&nbsp;<span class="op" id="1754610">&lt;</span>&nbsp;<span class="num" id="1754612">2</span>&nbsp;<span class="op" id="1754614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754618">return</span>&nbsp;<span class="ident" id="1754625">RuneError</span><span class="op" id="1754634">,</span>&nbsp;<span class="num" id="1754636">1</span><span class="op" id="1754637">,</span>&nbsp;<span class="builtintype" id="1754639">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1754645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1754648">c1</span>&nbsp;<span class="op" id="1754651">:=</span>&nbsp;<span class="ident" id="1754654">s</span><span class="op" id="1754655">[</span><span class="num" id="1754656">1</span><span class="op" id="1754657">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754660">if</span>&nbsp;<span class="ident" id="1754663">c1</span>&nbsp;<span class="op" id="1754666">&lt;</span>&nbsp;<span class="ident" id="1754668">tx</span>&nbsp;<span class="op" id="1754671">||</span>&nbsp;<span class="ident" id="1754674">t2</span>&nbsp;<span class="op" id="1754677">&lt;=</span>&nbsp;<span class="ident" id="1754680">c1</span>&nbsp;<span class="op" id="1754683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754687">return</span>&nbsp;<span class="ident" id="1754694">RuneError</span><span class="op" id="1754703">,</span>&nbsp;<span class="num" id="1754705">1</span><span class="op" id="1754706">,</span>&nbsp;<span class="builtintype" id="1754708">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1754715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1754719">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754748">if</span>&nbsp;<span class="ident" id="1754751">c0</span>&nbsp;<span class="op" id="1754754">&lt;</span>&nbsp;<span class="ident" id="1754756">t3</span>&nbsp;<span class="op" id="1754759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1754763">r</span>&nbsp;<span class="op" id="1754765">=</span>&nbsp;<span class="builtintype" id="1754767">rune</span><span class="op" id="1754771">(</span><span class="ident" id="1754772">c0</span><span class="op" id="1754774">&amp;</span><span class="ident" id="1754775">mask2</span><span class="op" id="1754780">)</span><span class="op" id="1754781">&lt;&lt;</span><span class="num" id="1754783">6</span>&nbsp;<span class="op" id="1754785">|</span>&nbsp;<span class="builtintype" id="1754787">rune</span><span class="op" id="1754791">(</span><span class="ident" id="1754792">c1</span><span class="op" id="1754794">&amp;</span><span class="ident" id="1754795">maskx</span><span class="op" id="1754800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754804">if</span>&nbsp;<span class="ident" id="1754807">r</span>&nbsp;<span class="op" id="1754809">&lt;=</span>&nbsp;<span class="ident" id="1754812">rune1Max</span>&nbsp;<span class="op" id="1754821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754826">return</span>&nbsp;<span class="ident" id="1754833">RuneError</span><span class="op" id="1754842">,</span>&nbsp;<span class="num" id="1754844">1</span><span class="op" id="1754845">,</span>&nbsp;<span class="builtintype" id="1754847">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1754855">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754859">return</span>&nbsp;<span class="ident" id="1754866">r</span><span class="op" id="1754867">,</span>&nbsp;<span class="num" id="1754869">2</span><span class="op" id="1754870">,</span>&nbsp;<span class="builtintype" id="1754872">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1754879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1754883">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754917">if</span>&nbsp;<span class="ident" id="1754920">n</span>&nbsp;<span class="op" id="1754922">&lt;</span>&nbsp;<span class="num" id="1754924">3</span>&nbsp;<span class="op" id="1754926">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754930">return</span>&nbsp;<span class="ident" id="1754937">RuneError</span><span class="op" id="1754946">,</span>&nbsp;<span class="num" id="1754948">1</span><span class="op" id="1754949">,</span>&nbsp;<span class="builtintype" id="1754951">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1754957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1754960">c2</span>&nbsp;<span class="op" id="1754963">:=</span>&nbsp;<span class="ident" id="1754966">s</span><span class="op" id="1754967">[</span><span class="num" id="1754968">2</span><span class="op" id="1754969">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754972">if</span>&nbsp;<span class="ident" id="1754975">c2</span>&nbsp;<span class="op" id="1754978">&lt;</span>&nbsp;<span class="ident" id="1754980">tx</span>&nbsp;<span class="op" id="1754983">||</span>&nbsp;<span class="ident" id="1754986">t2</span>&nbsp;<span class="op" id="1754989">&lt;=</span>&nbsp;<span class="ident" id="1754992">c2</span>&nbsp;<span class="op" id="1754995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754999">return</span>&nbsp;<span class="ident" id="1755006">RuneError</span><span class="op" id="1755015">,</span>&nbsp;<span class="num" id="1755017">1</span><span class="op" id="1755018">,</span>&nbsp;<span class="builtintype" id="1755020">false</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1755027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755031">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755060">if</span>&nbsp;<span class="ident" id="1755063">c0</span>&nbsp;<span class="op" id="1755066">&lt;</span>&nbsp;<span class="ident" id="1755068">t4</span>&nbsp;<span class="op" id="1755071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1755075">r</span>&nbsp;<span class="op" id="1755077">=</span>&nbsp;<span class="builtintype" id="1755079">rune</span><span class="op" id="1755083">(</span><span class="ident" id="1755084">c0</span><span class="op" id="1755086">&amp;</span><span class="ident" id="1755087">mask3</span><span class="op" id="1755092">)</span><span class="op" id="1755093">&lt;&lt;</span><span class="num" id="1755095">12</span>&nbsp;<span class="op" id="1755098">|</span>&nbsp;<span class="builtintype" id="1755100">rune</span><span class="op" id="1755104">(</span><span class="ident" id="1755105">c1</span><span class="op" id="1755107">&amp;</span><span class="ident" id="1755108">maskx</span><span class="op" id="1755113">)</span><span class="op" id="1755114">&lt;&lt;</span><span class="num" id="1755116">6</span>&nbsp;<span class="op" id="1755118">|</span>&nbsp;<span class="builtintype" id="1755120">rune</span><span class="op" id="1755124">(</span><span class="ident" id="1755125">c2</span><span class="op" id="1755127">&amp;</span><span class="ident" id="1755128">maskx</span><span class="op" id="1755133">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755137">if</span>&nbsp;<span class="ident" id="1755140">r</span>&nbsp;<span class="op" id="1755142">&lt;=</span>&nbsp;<span class="ident" id="1755145">rune2Max</span>&nbsp;<span class="op" id="1755154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755159">return</span>&nbsp;<span class="ident" id="1755166">RuneError</span><span class="op" id="1755175">,</span>&nbsp;<span class="num" id="1755177">1</span><span class="op" id="1755178">,</span>&nbsp;<span class="builtintype" id="1755180">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1755188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755192">if</span>&nbsp;<span class="ident" id="1755195">surrogateMin</span>&nbsp;<span class="op" id="1755208">&lt;=</span>&nbsp;<span class="ident" id="1755211">r</span>&nbsp;<span class="op" id="1755213">&amp;&amp;</span>&nbsp;<span class="ident" id="1755216">r</span>&nbsp;<span class="op" id="1755218">&lt;=</span>&nbsp;<span class="ident" id="1755221">surrogateMax</span>&nbsp;<span class="op" id="1755234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755239">return</span>&nbsp;<span class="ident" id="1755246">RuneError</span><span class="op" id="1755255">,</span>&nbsp;<span class="num" id="1755257">1</span><span class="op" id="1755258">,</span>&nbsp;<span class="builtintype" id="1755260">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1755268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755272">return</span>&nbsp;<span class="ident" id="1755279">r</span><span class="op" id="1755280">,</span>&nbsp;<span class="num" id="1755282">3</span><span class="op" id="1755283">,</span>&nbsp;<span class="builtintype" id="1755285">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1755292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755296">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755329">if</span>&nbsp;<span class="ident" id="1755332">n</span>&nbsp;<span class="op" id="1755334">&lt;</span>&nbsp;<span class="num" id="1755336">4</span>&nbsp;<span class="op" id="1755338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755342">return</span>&nbsp;<span class="ident" id="1755349">RuneError</span><span class="op" id="1755358">,</span>&nbsp;<span class="num" id="1755360">1</span><span class="op" id="1755361">,</span>&nbsp;<span class="builtintype" id="1755363">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1755369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1755372">c3</span>&nbsp;<span class="op" id="1755375">:=</span>&nbsp;<span class="ident" id="1755378">s</span><span class="op" id="1755379">[</span><span class="num" id="1755380">3</span><span class="op" id="1755381">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755384">if</span>&nbsp;<span class="ident" id="1755387">c3</span>&nbsp;<span class="op" id="1755390">&lt;</span>&nbsp;<span class="ident" id="1755392">tx</span>&nbsp;<span class="op" id="1755395">||</span>&nbsp;<span class="ident" id="1755398">t2</span>&nbsp;<span class="op" id="1755401">&lt;=</span>&nbsp;<span class="ident" id="1755404">c3</span>&nbsp;<span class="op" id="1755407">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755411">return</span>&nbsp;<span class="ident" id="1755418">RuneError</span><span class="op" id="1755427">,</span>&nbsp;<span class="num" id="1755429">1</span><span class="op" id="1755430">,</span>&nbsp;<span class="builtintype" id="1755432">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1755439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755443">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755472">if</span>&nbsp;<span class="ident" id="1755475">c0</span>&nbsp;<span class="op" id="1755478">&lt;</span>&nbsp;<span class="ident" id="1755480">t5</span>&nbsp;<span class="op" id="1755483">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1755487">r</span>&nbsp;<span class="op" id="1755489">=</span>&nbsp;<span class="builtintype" id="1755491">rune</span><span class="op" id="1755495">(</span><span class="ident" id="1755496">c0</span><span class="op" id="1755498">&amp;</span><span class="ident" id="1755499">mask4</span><span class="op" id="1755504">)</span><span class="op" id="1755505">&lt;&lt;</span><span class="num" id="1755507">18</span>&nbsp;<span class="op" id="1755510">|</span>&nbsp;<span class="builtintype" id="1755512">rune</span><span class="op" id="1755516">(</span><span class="ident" id="1755517">c1</span><span class="op" id="1755519">&amp;</span><span class="ident" id="1755520">maskx</span><span class="op" id="1755525">)</span><span class="op" id="1755526">&lt;&lt;</span><span class="num" id="1755528">12</span>&nbsp;<span class="op" id="1755531">|</span>&nbsp;<span class="builtintype" id="1755533">rune</span><span class="op" id="1755537">(</span><span class="ident" id="1755538">c2</span><span class="op" id="1755540">&amp;</span><span class="ident" id="1755541">maskx</span><span class="op" id="1755546">)</span><span class="op" id="1755547">&lt;&lt;</span><span class="num" id="1755549">6</span>&nbsp;<span class="op" id="1755551">|</span>&nbsp;<span class="builtintype" id="1755553">rune</span><span class="op" id="1755557">(</span><span class="ident" id="1755558">c3</span><span class="op" id="1755560">&amp;</span><span class="ident" id="1755561">maskx</span><span class="op" id="1755566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755570">if</span>&nbsp;<span class="ident" id="1755573">r</span>&nbsp;<span class="op" id="1755575">&lt;=</span>&nbsp;<span class="ident" id="1755578">rune3Max</span>&nbsp;<span class="op" id="1755587">||</span>&nbsp;<span class="ident" id="1755590">MaxRune</span>&nbsp;<span class="op" id="1755598">&lt;</span>&nbsp;<span class="ident" id="1755600">r</span>&nbsp;<span class="op" id="1755602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755607">return</span>&nbsp;<span class="ident" id="1755614">RuneError</span><span class="op" id="1755623">,</span>&nbsp;<span class="num" id="1755625">1</span><span class="op" id="1755626">,</span>&nbsp;<span class="builtintype" id="1755628">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1755636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755640">return</span>&nbsp;<span class="ident" id="1755647">r</span><span class="op" id="1755648">,</span>&nbsp;<span class="num" id="1755650">4</span><span class="op" id="1755651">,</span>&nbsp;<span class="builtintype" id="1755653">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1755660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755664">//&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755674">return</span>&nbsp;<span class="ident" id="1755681">RuneError</span><span class="op" id="1755690">,</span>&nbsp;<span class="num" id="1755692">1</span><span class="op" id="1755693">,</span>&nbsp;<span class="builtintype" id="1755695">false</span><br>
<span class="lineno"></span><span class="op" id="1755701">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="1755704">//&nbsp;FullRune&nbsp;reports&nbsp;whether&nbsp;the&nbsp;bytes&nbsp;in&nbsp;p&nbsp;begin&nbsp;with&nbsp;a&nbsp;full&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;a&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1755791">//&nbsp;An&nbsp;invalid&nbsp;encoding&nbsp;is&nbsp;considered&nbsp;a&nbsp;full&nbsp;Rune&nbsp;since&nbsp;it&nbsp;will&nbsp;convert&nbsp;as&nbsp;a&nbsp;width-1&nbsp;error&nbsp;rune.</span><br>
<span class="lineno"></span><span class="keyword" id="1755887">func</span>&nbsp;<span class="ident" id="1755892">FullRune</span><span class="op" id="1755900">(</span><span class="ident" id="1755901">p</span>&nbsp;<span class="op" id="1755903">[</span><span class="op" id="1755904">]</span><span class="builtintype" id="1755905">byte</span><span class="op" id="1755909">)</span>&nbsp;<span class="builtintype" id="1755911">bool</span>&nbsp;<span class="op" id="1755916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1755919">_</span><span class="op" id="1755920">,</span>&nbsp;<span class="ident" id="1755922">_</span><span class="op" id="1755923">,</span>&nbsp;<span class="ident" id="1755925">short</span>&nbsp;<span class="op" id="1755931">:=</span>&nbsp;<span class="ident" id="1755934">decodeRuneInternal</span><span class="op" id="1755952">(</span><span class="ident" id="1755953">p</span><span class="op" id="1755954">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755957">return</span>&nbsp;<span class="op" id="1755964">!</span><span class="ident" id="1755965">short</span><br>
<span class="lineno"></span><span class="op" id="1755971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1755974">//&nbsp;FullRuneInString&nbsp;is&nbsp;like&nbsp;FullRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1756038">func</span>&nbsp;<span class="ident" id="1756043">FullRuneInString</span><span class="op" id="1756059">(</span><span class="ident" id="1756060">s</span>&nbsp;<span class="builtintype" id="1756062">string</span><span class="op" id="1756068">)</span>&nbsp;<span class="builtintype" id="1756070">bool</span>&nbsp;<span class="op" id="1756075">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1756078">_</span><span class="op" id="1756079">,</span>&nbsp;<span class="ident" id="1756081">_</span><span class="op" id="1756082">,</span>&nbsp;<span class="ident" id="1756084">short</span>&nbsp;<span class="op" id="1756090">:=</span>&nbsp;<span class="ident" id="1756093">decodeRuneInStringInternal</span><span class="op" id="1756119">(</span><span class="ident" id="1756120">s</span><span class="op" id="1756121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1756124">return</span>&nbsp;<span class="op" id="1756131">!</span><span class="ident" id="1756132">short</span><br>
<span class="lineno"></span><span class="op" id="1756138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1756141">//&nbsp;DecodeRune&nbsp;unpacks&nbsp;the&nbsp;first&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">215</span><span class="comment" id="1756218">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1756296">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1756371">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1756401">//</span><br>
<span class="lineno"></span><span class="comment" id="1756404">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">220</span><span class="comment" id="1756479">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1756551">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1756595">func</span>&nbsp;<span class="ident" id="1756600">DecodeRune</span><span class="op" id="1756610">(</span><span class="ident" id="1756611">p</span>&nbsp;<span class="op" id="1756613">[</span><span class="op" id="1756614">]</span><span class="builtintype" id="1756615">byte</span><span class="op" id="1756619">)</span>&nbsp;<span class="op" id="1756621">(</span><span class="ident" id="1756622">r</span>&nbsp;<span class="builtintype" id="1756624">rune</span><span class="op" id="1756628">,</span>&nbsp;<span class="ident" id="1756630">size</span>&nbsp;<span class="builtintype" id="1756635">int</span><span class="op" id="1756638">)</span>&nbsp;<span class="op" id="1756640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1756643">r</span><span class="op" id="1756644">,</span>&nbsp;<span class="ident" id="1756646">size</span><span class="op" id="1756650">,</span>&nbsp;<span class="ident" id="1756652">_</span>&nbsp;<span class="op" id="1756654">=</span>&nbsp;<span class="ident" id="1756656">decodeRuneInternal</span><span class="op" id="1756674">(</span><span class="ident" id="1756675">p</span><span class="op" id="1756676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1756679">return</span><br>
<span class="lineno">225</span><span class="op" id="1756686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1756689">//&nbsp;DecodeRuneInString&nbsp;is&nbsp;like&nbsp;DecodeRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If&nbsp;s&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1756765">//&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1756843">//&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno">230</span><span class="comment" id="1756917">//</span><br>
<span class="lineno"></span><span class="comment" id="1756920">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1756995">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1757067">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1757111">func</span>&nbsp;<span class="ident" id="1757116">DecodeRuneInString</span><span class="op" id="1757134">(</span><span class="ident" id="1757135">s</span>&nbsp;<span class="builtintype" id="1757137">string</span><span class="op" id="1757143">)</span>&nbsp;<span class="op" id="1757145">(</span><span class="ident" id="1757146">r</span>&nbsp;<span class="builtintype" id="1757148">rune</span><span class="op" id="1757152">,</span>&nbsp;<span class="ident" id="1757154">size</span>&nbsp;<span class="builtintype" id="1757159">int</span><span class="op" id="1757162">)</span>&nbsp;<span class="op" id="1757164">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1757167">r</span><span class="op" id="1757168">,</span>&nbsp;<span class="ident" id="1757170">size</span><span class="op" id="1757174">,</span>&nbsp;<span class="ident" id="1757176">_</span>&nbsp;<span class="op" id="1757178">=</span>&nbsp;<span class="ident" id="1757180">decodeRuneInStringInternal</span><span class="op" id="1757206">(</span><span class="ident" id="1757207">s</span><span class="op" id="1757208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757211">return</span><br>
<span class="lineno"></span><span class="op" id="1757218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1757221">//&nbsp;DecodeLastRune&nbsp;unpacks&nbsp;the&nbsp;last&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">240</span><span class="comment" id="1757301">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1757379">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1757454">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1757484">//</span><br>
<span class="lineno"></span><span class="comment" id="1757487">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">245</span><span class="comment" id="1757562">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1757634">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1757678">func</span>&nbsp;<span class="ident" id="1757683">DecodeLastRune</span><span class="op" id="1757697">(</span><span class="ident" id="1757698">p</span>&nbsp;<span class="op" id="1757700">[</span><span class="op" id="1757701">]</span><span class="builtintype" id="1757702">byte</span><span class="op" id="1757706">)</span>&nbsp;<span class="op" id="1757708">(</span><span class="ident" id="1757709">r</span>&nbsp;<span class="builtintype" id="1757711">rune</span><span class="op" id="1757715">,</span>&nbsp;<span class="ident" id="1757717">size</span>&nbsp;<span class="builtintype" id="1757722">int</span><span class="op" id="1757725">)</span>&nbsp;<span class="op" id="1757727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1757730">end</span>&nbsp;<span class="op" id="1757734">:=</span>&nbsp;<span class="builtinfunc" id="1757737">len</span><span class="op" id="1757740">(</span><span class="ident" id="1757741">p</span><span class="op" id="1757742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757745">if</span>&nbsp;<span class="ident" id="1757748">end</span>&nbsp;<span class="op" id="1757752">==</span>&nbsp;<span class="num" id="1757755">0</span>&nbsp;<span class="op" id="1757757">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757761">return</span>&nbsp;<span class="ident" id="1757768">RuneError</span><span class="op" id="1757777">,</span>&nbsp;<span class="num" id="1757779">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1757782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1757785">start</span>&nbsp;<span class="op" id="1757791">:=</span>&nbsp;<span class="ident" id="1757794">end</span>&nbsp;<span class="op" id="1757798">-</span>&nbsp;<span class="num" id="1757800">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1757803">r</span>&nbsp;<span class="op" id="1757805">=</span>&nbsp;<span class="builtintype" id="1757807">rune</span><span class="op" id="1757811">(</span><span class="ident" id="1757812">p</span><span class="op" id="1757813">[</span><span class="ident" id="1757814">start</span><span class="op" id="1757819">]</span><span class="op" id="1757820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757823">if</span>&nbsp;<span class="ident" id="1757826">r</span>&nbsp;<span class="op" id="1757828">&lt;</span>&nbsp;<span class="ident" id="1757830">RuneSelf</span>&nbsp;<span class="op" id="1757839">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757843">return</span>&nbsp;<span class="ident" id="1757850">r</span><span class="op" id="1757851">,</span>&nbsp;<span class="num" id="1757853">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1757856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1757859">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1757909">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1757962">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1757981">lim</span>&nbsp;<span class="op" id="1757985">:=</span>&nbsp;<span class="ident" id="1757988">end</span>&nbsp;<span class="op" id="1757992">-</span>&nbsp;<span class="ident" id="1757994">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758002">if</span>&nbsp;<span class="ident" id="1758005">lim</span>&nbsp;<span class="op" id="1758009">&lt;</span>&nbsp;<span class="num" id="1758011">0</span>&nbsp;<span class="op" id="1758013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1758017">lim</span>&nbsp;<span class="op" id="1758021">=</span>&nbsp;<span class="num" id="1758023">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1758026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758029">for</span>&nbsp;<span class="ident" id="1758033">start</span><span class="op" id="1758038">--</span><span class="op" id="1758040">;</span>&nbsp;<span class="ident" id="1758042">start</span>&nbsp;<span class="op" id="1758048">&gt;=</span>&nbsp;<span class="ident" id="1758051">lim</span><span class="op" id="1758054">;</span>&nbsp;<span class="ident" id="1758056">start</span><span class="op" id="1758061">--</span>&nbsp;<span class="op" id="1758064">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758068">if</span>&nbsp;<span class="ident" id="1758071">RuneStart</span><span class="op" id="1758080">(</span><span class="ident" id="1758081">p</span><span class="op" id="1758082">[</span><span class="ident" id="1758083">start</span><span class="op" id="1758088">]</span><span class="op" id="1758089">)</span>&nbsp;<span class="op" id="1758091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758096">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1758104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1758107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758110">if</span>&nbsp;<span class="ident" id="1758113">start</span>&nbsp;<span class="op" id="1758119">&lt;</span>&nbsp;<span class="num" id="1758121">0</span>&nbsp;<span class="op" id="1758123">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1758127">start</span>&nbsp;<span class="op" id="1758133">=</span>&nbsp;<span class="num" id="1758135">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1758138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1758141">r</span><span class="op" id="1758142">,</span>&nbsp;<span class="ident" id="1758144">size</span>&nbsp;<span class="op" id="1758149">=</span>&nbsp;<span class="ident" id="1758151">DecodeRune</span><span class="op" id="1758161">(</span><span class="ident" id="1758162">p</span><span class="op" id="1758163">[</span><span class="ident" id="1758164">start</span><span class="op" id="1758169">:</span><span class="ident" id="1758170">end</span><span class="op" id="1758173">]</span><span class="op" id="1758174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758177">if</span>&nbsp;<span class="ident" id="1758180">start</span><span class="op" id="1758185">+</span><span class="ident" id="1758186">size</span>&nbsp;<span class="op" id="1758191">!=</span>&nbsp;<span class="ident" id="1758194">end</span>&nbsp;<span class="op" id="1758198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758202">return</span>&nbsp;<span class="ident" id="1758209">RuneError</span><span class="op" id="1758218">,</span>&nbsp;<span class="num" id="1758220">1</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1758223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758226">return</span>&nbsp;<span class="ident" id="1758233">r</span><span class="op" id="1758234">,</span>&nbsp;<span class="ident" id="1758236">size</span><br>
<span class="lineno"></span><span class="op" id="1758241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1758244">//&nbsp;DecodeLastRuneInString&nbsp;is&nbsp;like&nbsp;DecodeLastRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If</span><br>
<span class="lineno">280</span><span class="comment" id="1758323">//&nbsp;s&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,</span><br>
<span class="lineno"></span><span class="comment" id="1758403">//&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1758480">//</span><br>
<span class="lineno"></span><span class="comment" id="1758483">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1758558">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno">285</span><span class="comment" id="1758630">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1758674">func</span>&nbsp;<span class="ident" id="1758679">DecodeLastRuneInString</span><span class="op" id="1758701">(</span><span class="ident" id="1758702">s</span>&nbsp;<span class="builtintype" id="1758704">string</span><span class="op" id="1758710">)</span>&nbsp;<span class="op" id="1758712">(</span><span class="ident" id="1758713">r</span>&nbsp;<span class="builtintype" id="1758715">rune</span><span class="op" id="1758719">,</span>&nbsp;<span class="ident" id="1758721">size</span>&nbsp;<span class="builtintype" id="1758726">int</span><span class="op" id="1758729">)</span>&nbsp;<span class="op" id="1758731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1758734">end</span>&nbsp;<span class="op" id="1758738">:=</span>&nbsp;<span class="builtinfunc" id="1758741">len</span><span class="op" id="1758744">(</span><span class="ident" id="1758745">s</span><span class="op" id="1758746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758749">if</span>&nbsp;<span class="ident" id="1758752">end</span>&nbsp;<span class="op" id="1758756">==</span>&nbsp;<span class="num" id="1758759">0</span>&nbsp;<span class="op" id="1758761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758765">return</span>&nbsp;<span class="ident" id="1758772">RuneError</span><span class="op" id="1758781">,</span>&nbsp;<span class="num" id="1758783">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1758786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1758789">start</span>&nbsp;<span class="op" id="1758795">:=</span>&nbsp;<span class="ident" id="1758798">end</span>&nbsp;<span class="op" id="1758802">-</span>&nbsp;<span class="num" id="1758804">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1758807">r</span>&nbsp;<span class="op" id="1758809">=</span>&nbsp;<span class="builtintype" id="1758811">rune</span><span class="op" id="1758815">(</span><span class="ident" id="1758816">s</span><span class="op" id="1758817">[</span><span class="ident" id="1758818">start</span><span class="op" id="1758823">]</span><span class="op" id="1758824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758827">if</span>&nbsp;<span class="ident" id="1758830">r</span>&nbsp;<span class="op" id="1758832">&lt;</span>&nbsp;<span class="ident" id="1758834">RuneSelf</span>&nbsp;<span class="op" id="1758843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758847">return</span>&nbsp;<span class="ident" id="1758854">r</span><span class="op" id="1758855">,</span>&nbsp;<span class="num" id="1758857">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1758860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1758863">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1758913">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1758966">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1758985">lim</span>&nbsp;<span class="op" id="1758989">:=</span>&nbsp;<span class="ident" id="1758992">end</span>&nbsp;<span class="op" id="1758996">-</span>&nbsp;<span class="ident" id="1758998">UTFMax</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759006">if</span>&nbsp;<span class="ident" id="1759009">lim</span>&nbsp;<span class="op" id="1759013">&lt;</span>&nbsp;<span class="num" id="1759015">0</span>&nbsp;<span class="op" id="1759017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1759021">lim</span>&nbsp;<span class="op" id="1759025">=</span>&nbsp;<span class="num" id="1759027">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1759030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759033">for</span>&nbsp;<span class="ident" id="1759037">start</span><span class="op" id="1759042">--</span><span class="op" id="1759044">;</span>&nbsp;<span class="ident" id="1759046">start</span>&nbsp;<span class="op" id="1759052">&gt;=</span>&nbsp;<span class="ident" id="1759055">lim</span><span class="op" id="1759058">;</span>&nbsp;<span class="ident" id="1759060">start</span><span class="op" id="1759065">--</span>&nbsp;<span class="op" id="1759068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759072">if</span>&nbsp;<span class="ident" id="1759075">RuneStart</span><span class="op" id="1759084">(</span><span class="ident" id="1759085">s</span><span class="op" id="1759086">[</span><span class="ident" id="1759087">start</span><span class="op" id="1759092">]</span><span class="op" id="1759093">)</span>&nbsp;<span class="op" id="1759095">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759100">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1759108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1759111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759114">if</span>&nbsp;<span class="ident" id="1759117">start</span>&nbsp;<span class="op" id="1759123">&lt;</span>&nbsp;<span class="num" id="1759125">0</span>&nbsp;<span class="op" id="1759127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1759131">start</span>&nbsp;<span class="op" id="1759137">=</span>&nbsp;<span class="num" id="1759139">0</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1759142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1759145">r</span><span class="op" id="1759146">,</span>&nbsp;<span class="ident" id="1759148">size</span>&nbsp;<span class="op" id="1759153">=</span>&nbsp;<span class="ident" id="1759155">DecodeRuneInString</span><span class="op" id="1759173">(</span><span class="ident" id="1759174">s</span><span class="op" id="1759175">[</span><span class="ident" id="1759176">start</span><span class="op" id="1759181">:</span><span class="ident" id="1759182">end</span><span class="op" id="1759185">]</span><span class="op" id="1759186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759189">if</span>&nbsp;<span class="ident" id="1759192">start</span><span class="op" id="1759197">+</span><span class="ident" id="1759198">size</span>&nbsp;<span class="op" id="1759203">!=</span>&nbsp;<span class="ident" id="1759206">end</span>&nbsp;<span class="op" id="1759210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759214">return</span>&nbsp;<span class="ident" id="1759221">RuneError</span><span class="op" id="1759230">,</span>&nbsp;<span class="num" id="1759232">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1759235">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759238">return</span>&nbsp;<span class="ident" id="1759245">r</span><span class="op" id="1759246">,</span>&nbsp;<span class="ident" id="1759248">size</span><br>
<span class="lineno"></span><span class="op" id="1759253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1759256">//&nbsp;RuneLen&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;required&nbsp;to&nbsp;encode&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1759324">//&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;the&nbsp;rune&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;value&nbsp;to&nbsp;encode&nbsp;in&nbsp;UTF-8.</span><br>
<span class="lineno">320</span><span class="keyword" id="1759394">func</span>&nbsp;<span class="ident" id="1759399">RuneLen</span><span class="op" id="1759406">(</span><span class="ident" id="1759407">r</span>&nbsp;<span class="builtintype" id="1759409">rune</span><span class="op" id="1759413">)</span>&nbsp;<span class="builtintype" id="1759415">int</span>&nbsp;<span class="op" id="1759419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759422">switch</span>&nbsp;<span class="op" id="1759429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759432">case</span>&nbsp;<span class="ident" id="1759437">r</span>&nbsp;<span class="op" id="1759439">&lt;</span>&nbsp;<span class="num" id="1759441">0</span><span class="op" id="1759442">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759446">return</span>&nbsp;<span class="op" id="1759453">-</span><span class="num" id="1759454">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759457">case</span>&nbsp;<span class="ident" id="1759462">r</span>&nbsp;<span class="op" id="1759464">&lt;=</span>&nbsp;<span class="ident" id="1759467">rune1Max</span><span class="op" id="1759475">:</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759479">return</span>&nbsp;<span class="num" id="1759486">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759489">case</span>&nbsp;<span class="ident" id="1759494">r</span>&nbsp;<span class="op" id="1759496">&lt;=</span>&nbsp;<span class="ident" id="1759499">rune2Max</span><span class="op" id="1759507">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759511">return</span>&nbsp;<span class="num" id="1759518">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759521">case</span>&nbsp;<span class="ident" id="1759526">surrogateMin</span>&nbsp;<span class="op" id="1759539">&lt;=</span>&nbsp;<span class="ident" id="1759542">r</span>&nbsp;<span class="op" id="1759544">&amp;&amp;</span>&nbsp;<span class="ident" id="1759547">r</span>&nbsp;<span class="op" id="1759549">&lt;=</span>&nbsp;<span class="ident" id="1759552">surrogateMax</span><span class="op" id="1759564">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759568">return</span>&nbsp;<span class="op" id="1759575">-</span><span class="num" id="1759576">1</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759579">case</span>&nbsp;<span class="ident" id="1759584">r</span>&nbsp;<span class="op" id="1759586">&lt;=</span>&nbsp;<span class="ident" id="1759589">rune3Max</span><span class="op" id="1759597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759601">return</span>&nbsp;<span class="num" id="1759608">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759611">case</span>&nbsp;<span class="ident" id="1759616">r</span>&nbsp;<span class="op" id="1759618">&lt;=</span>&nbsp;<span class="ident" id="1759621">MaxRune</span><span class="op" id="1759628">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759632">return</span>&nbsp;<span class="num" id="1759639">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1759642">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759645">return</span>&nbsp;<span class="op" id="1759652">-</span><span class="num" id="1759653">1</span><br>
<span class="lineno"></span><span class="op" id="1759655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1759658">//&nbsp;EncodeRune&nbsp;writes&nbsp;into&nbsp;p&nbsp;(which&nbsp;must&nbsp;be&nbsp;large&nbsp;enough)&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1759747">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">340</span><span class="keyword" id="1759790">func</span>&nbsp;<span class="ident" id="1759795">EncodeRune</span><span class="op" id="1759805">(</span><span class="ident" id="1759806">p</span>&nbsp;<span class="op" id="1759808">[</span><span class="op" id="1759809">]</span><span class="builtintype" id="1759810">byte</span><span class="op" id="1759814">,</span>&nbsp;<span class="ident" id="1759816">r</span>&nbsp;<span class="builtintype" id="1759818">rune</span><span class="op" id="1759822">)</span>&nbsp;<span class="builtintype" id="1759824">int</span>&nbsp;<span class="op" id="1759828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1759831">//&nbsp;Negative&nbsp;values&nbsp;are&nbsp;erroneous.&nbsp;&nbsp;Making&nbsp;it&nbsp;unsigned&nbsp;addresses&nbsp;the&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759909">switch</span>&nbsp;<span class="ident" id="1759916">i</span>&nbsp;<span class="op" id="1759918">:=</span>&nbsp;<span class="builtintype" id="1759921">uint32</span><span class="op" id="1759927">(</span><span class="ident" id="1759928">r</span><span class="op" id="1759929">)</span><span class="op" id="1759930">;</span>&nbsp;<span class="op" id="1759932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759935">case</span>&nbsp;<span class="ident" id="1759940">i</span>&nbsp;<span class="op" id="1759942">&lt;=</span>&nbsp;<span class="ident" id="1759945">rune1Max</span><span class="op" id="1759953">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1759957">p</span><span class="op" id="1759958">[</span><span class="num" id="1759959">0</span><span class="op" id="1759960">]</span>&nbsp;<span class="op" id="1759962">=</span>&nbsp;<span class="builtintype" id="1759964">byte</span><span class="op" id="1759968">(</span><span class="ident" id="1759969">r</span><span class="op" id="1759970">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759974">return</span>&nbsp;<span class="num" id="1759981">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759984">case</span>&nbsp;<span class="ident" id="1759989">i</span>&nbsp;<span class="op" id="1759991">&lt;=</span>&nbsp;<span class="ident" id="1759994">rune2Max</span><span class="op" id="1760002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760006">p</span><span class="op" id="1760007">[</span><span class="num" id="1760008">0</span><span class="op" id="1760009">]</span>&nbsp;<span class="op" id="1760011">=</span>&nbsp;<span class="ident" id="1760013">t2</span>&nbsp;<span class="op" id="1760016">|</span>&nbsp;<span class="builtintype" id="1760018">byte</span><span class="op" id="1760022">(</span><span class="ident" id="1760023">r</span><span class="op" id="1760024">&gt;&gt;</span><span class="num" id="1760026">6</span><span class="op" id="1760027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760031">p</span><span class="op" id="1760032">[</span><span class="num" id="1760033">1</span><span class="op" id="1760034">]</span>&nbsp;<span class="op" id="1760036">=</span>&nbsp;<span class="ident" id="1760038">tx</span>&nbsp;<span class="op" id="1760041">|</span>&nbsp;<span class="builtintype" id="1760043">byte</span><span class="op" id="1760047">(</span><span class="ident" id="1760048">r</span><span class="op" id="1760049">)</span><span class="op" id="1760050">&amp;</span><span class="ident" id="1760051">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760059">return</span>&nbsp;<span class="num" id="1760066">2</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760069">case</span>&nbsp;<span class="ident" id="1760074">i</span>&nbsp;<span class="op" id="1760076">&gt;</span>&nbsp;<span class="ident" id="1760078">MaxRune</span><span class="op" id="1760085">,</span>&nbsp;<span class="ident" id="1760087">surrogateMin</span>&nbsp;<span class="op" id="1760100">&lt;=</span>&nbsp;<span class="ident" id="1760103">i</span>&nbsp;<span class="op" id="1760105">&amp;&amp;</span>&nbsp;<span class="ident" id="1760108">i</span>&nbsp;<span class="op" id="1760110">&lt;=</span>&nbsp;<span class="ident" id="1760113">surrogateMax</span><span class="op" id="1760125">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760129">r</span>&nbsp;<span class="op" id="1760131">=</span>&nbsp;<span class="ident" id="1760133">RuneError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760145">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760158">case</span>&nbsp;<span class="ident" id="1760163">i</span>&nbsp;<span class="op" id="1760165">&lt;=</span>&nbsp;<span class="ident" id="1760168">rune3Max</span><span class="op" id="1760176">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760180">p</span><span class="op" id="1760181">[</span><span class="num" id="1760182">0</span><span class="op" id="1760183">]</span>&nbsp;<span class="op" id="1760185">=</span>&nbsp;<span class="ident" id="1760187">t3</span>&nbsp;<span class="op" id="1760190">|</span>&nbsp;<span class="builtintype" id="1760192">byte</span><span class="op" id="1760196">(</span><span class="ident" id="1760197">r</span><span class="op" id="1760198">&gt;&gt;</span><span class="num" id="1760200">12</span><span class="op" id="1760202">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760206">p</span><span class="op" id="1760207">[</span><span class="num" id="1760208">1</span><span class="op" id="1760209">]</span>&nbsp;<span class="op" id="1760211">=</span>&nbsp;<span class="ident" id="1760213">tx</span>&nbsp;<span class="op" id="1760216">|</span>&nbsp;<span class="builtintype" id="1760218">byte</span><span class="op" id="1760222">(</span><span class="ident" id="1760223">r</span><span class="op" id="1760224">&gt;&gt;</span><span class="num" id="1760226">6</span><span class="op" id="1760227">)</span><span class="op" id="1760228">&amp;</span><span class="ident" id="1760229">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760237">p</span><span class="op" id="1760238">[</span><span class="num" id="1760239">2</span><span class="op" id="1760240">]</span>&nbsp;<span class="op" id="1760242">=</span>&nbsp;<span class="ident" id="1760244">tx</span>&nbsp;<span class="op" id="1760247">|</span>&nbsp;<span class="builtintype" id="1760249">byte</span><span class="op" id="1760253">(</span><span class="ident" id="1760254">r</span><span class="op" id="1760255">)</span><span class="op" id="1760256">&amp;</span><span class="ident" id="1760257">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760265">return</span>&nbsp;<span class="num" id="1760272">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760275">default</span><span class="op" id="1760282">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760286">p</span><span class="op" id="1760287">[</span><span class="num" id="1760288">0</span><span class="op" id="1760289">]</span>&nbsp;<span class="op" id="1760291">=</span>&nbsp;<span class="ident" id="1760293">t4</span>&nbsp;<span class="op" id="1760296">|</span>&nbsp;<span class="builtintype" id="1760298">byte</span><span class="op" id="1760302">(</span><span class="ident" id="1760303">r</span><span class="op" id="1760304">&gt;&gt;</span><span class="num" id="1760306">18</span><span class="op" id="1760308">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760312">p</span><span class="op" id="1760313">[</span><span class="num" id="1760314">1</span><span class="op" id="1760315">]</span>&nbsp;<span class="op" id="1760317">=</span>&nbsp;<span class="ident" id="1760319">tx</span>&nbsp;<span class="op" id="1760322">|</span>&nbsp;<span class="builtintype" id="1760324">byte</span><span class="op" id="1760328">(</span><span class="ident" id="1760329">r</span><span class="op" id="1760330">&gt;&gt;</span><span class="num" id="1760332">12</span><span class="op" id="1760334">)</span><span class="op" id="1760335">&amp;</span><span class="ident" id="1760336">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760344">p</span><span class="op" id="1760345">[</span><span class="num" id="1760346">2</span><span class="op" id="1760347">]</span>&nbsp;<span class="op" id="1760349">=</span>&nbsp;<span class="ident" id="1760351">tx</span>&nbsp;<span class="op" id="1760354">|</span>&nbsp;<span class="builtintype" id="1760356">byte</span><span class="op" id="1760360">(</span><span class="ident" id="1760361">r</span><span class="op" id="1760362">&gt;&gt;</span><span class="num" id="1760364">6</span><span class="op" id="1760365">)</span><span class="op" id="1760366">&amp;</span><span class="ident" id="1760367">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760375">p</span><span class="op" id="1760376">[</span><span class="num" id="1760377">3</span><span class="op" id="1760378">]</span>&nbsp;<span class="op" id="1760380">=</span>&nbsp;<span class="ident" id="1760382">tx</span>&nbsp;<span class="op" id="1760385">|</span>&nbsp;<span class="builtintype" id="1760387">byte</span><span class="op" id="1760391">(</span><span class="ident" id="1760392">r</span><span class="op" id="1760393">)</span><span class="op" id="1760394">&amp;</span><span class="ident" id="1760395">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760403">return</span>&nbsp;<span class="num" id="1760410">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1760413">}</span><br>
<span class="lineno">365</span><span class="op" id="1760415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1760418">//&nbsp;RuneCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;runes&nbsp;in&nbsp;p.&nbsp;&nbsp;Erroneous&nbsp;and&nbsp;short</span><br>
<span class="lineno"></span><span class="comment" id="1760486">//&nbsp;encodings&nbsp;are&nbsp;treated&nbsp;as&nbsp;single&nbsp;runes&nbsp;of&nbsp;width&nbsp;1&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="1760544">func</span>&nbsp;<span class="ident" id="1760549">RuneCount</span><span class="op" id="1760558">(</span><span class="ident" id="1760559">p</span>&nbsp;<span class="op" id="1760561">[</span><span class="op" id="1760562">]</span><span class="builtintype" id="1760563">byte</span><span class="op" id="1760567">)</span>&nbsp;<span class="builtintype" id="1760569">int</span>&nbsp;<span class="op" id="1760573">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760576">i</span>&nbsp;<span class="op" id="1760578">:=</span>&nbsp;<span class="num" id="1760581">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760584">var</span>&nbsp;<span class="ident" id="1760588">n</span>&nbsp;<span class="builtintype" id="1760590">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760595">for</span>&nbsp;<span class="ident" id="1760599">n</span>&nbsp;<span class="op" id="1760601">=</span>&nbsp;<span class="num" id="1760603">0</span><span class="op" id="1760604">;</span>&nbsp;<span class="ident" id="1760606">i</span>&nbsp;<span class="op" id="1760608">&lt;</span>&nbsp;<span class="builtinfunc" id="1760610">len</span><span class="op" id="1760613">(</span><span class="ident" id="1760614">p</span><span class="op" id="1760615">)</span><span class="op" id="1760616">;</span>&nbsp;<span class="ident" id="1760618">n</span><span class="op" id="1760619">++</span>&nbsp;<span class="op" id="1760622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760626">if</span>&nbsp;<span class="ident" id="1760629">p</span><span class="op" id="1760630">[</span><span class="ident" id="1760631">i</span><span class="op" id="1760632">]</span>&nbsp;<span class="op" id="1760634">&lt;</span>&nbsp;<span class="ident" id="1760636">RuneSelf</span>&nbsp;<span class="op" id="1760645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760650">i</span><span class="op" id="1760651">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1760656">}</span>&nbsp;<span class="keyword" id="1760658">else</span>&nbsp;<span class="op" id="1760663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760668">_</span><span class="op" id="1760669">,</span>&nbsp;<span class="ident" id="1760671">size</span>&nbsp;<span class="op" id="1760676">:=</span>&nbsp;<span class="ident" id="1760679">DecodeRune</span><span class="op" id="1760689">(</span><span class="ident" id="1760690">p</span><span class="op" id="1760691">[</span><span class="ident" id="1760692">i</span><span class="op" id="1760693">:</span><span class="op" id="1760694">]</span><span class="op" id="1760695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760700">i</span>&nbsp;<span class="op" id="1760702">+=</span>&nbsp;<span class="ident" id="1760705">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1760712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1760715">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760718">return</span>&nbsp;<span class="ident" id="1760725">n</span><br>
<span class="lineno"></span><span class="op" id="1760727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1760730">//&nbsp;RuneCountInString&nbsp;is&nbsp;like&nbsp;RuneCount&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1760796">func</span>&nbsp;<span class="ident" id="1760801">RuneCountInString</span><span class="op" id="1760818">(</span><span class="ident" id="1760819">s</span>&nbsp;<span class="builtintype" id="1760821">string</span><span class="op" id="1760827">)</span>&nbsp;<span class="op" id="1760829">(</span><span class="ident" id="1760830">n</span>&nbsp;<span class="builtintype" id="1760832">int</span><span class="op" id="1760835">)</span>&nbsp;<span class="op" id="1760837">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760840">for</span>&nbsp;<span class="keyword" id="1760844">range</span>&nbsp;<span class="ident" id="1760850">s</span>&nbsp;<span class="op" id="1760852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760856">n</span><span class="op" id="1760857">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1760861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760864">return</span><br>
<span class="lineno"></span><span class="op" id="1760871">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="1760874">//&nbsp;RuneStart&nbsp;reports&nbsp;whether&nbsp;the&nbsp;byte&nbsp;could&nbsp;be&nbsp;the&nbsp;first&nbsp;byte&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1760939">//&nbsp;an&nbsp;encoded&nbsp;rune.&nbsp;&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;bytes&nbsp;always&nbsp;have&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span><span class="comment" id="1761008">//&nbsp;two&nbsp;bits&nbsp;set&nbsp;to&nbsp;10.</span><br>
<span class="lineno"></span><span class="keyword" id="1761031">func</span>&nbsp;<span class="ident" id="1761036">RuneStart</span><span class="op" id="1761045">(</span><span class="ident" id="1761046">b</span>&nbsp;<span class="builtintype" id="1761048">byte</span><span class="op" id="1761052">)</span>&nbsp;<span class="builtintype" id="1761054">bool</span>&nbsp;<span class="op" id="1761059">{</span>&nbsp;<span class="keyword" id="1761061">return</span>&nbsp;<span class="ident" id="1761068">b</span><span class="op" id="1761069">&amp;</span><span class="num" id="1761070">0xC0</span>&nbsp;<span class="op" id="1761075">!=</span>&nbsp;<span class="num" id="1761078">0x80</span>&nbsp;<span class="op" id="1761083">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="1761086">//&nbsp;Valid&nbsp;reports&nbsp;whether&nbsp;p&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1761161">func</span>&nbsp;<span class="ident" id="1761166">Valid</span><span class="op" id="1761171">(</span><span class="ident" id="1761172">p</span>&nbsp;<span class="op" id="1761174">[</span><span class="op" id="1761175">]</span><span class="builtintype" id="1761176">byte</span><span class="op" id="1761180">)</span>&nbsp;<span class="builtintype" id="1761182">bool</span>&nbsp;<span class="op" id="1761187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1761190">i</span>&nbsp;<span class="op" id="1761192">:=</span>&nbsp;<span class="num" id="1761195">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761198">for</span>&nbsp;<span class="ident" id="1761202">i</span>&nbsp;<span class="op" id="1761204">&lt;</span>&nbsp;<span class="builtinfunc" id="1761206">len</span><span class="op" id="1761209">(</span><span class="ident" id="1761210">p</span><span class="op" id="1761211">)</span>&nbsp;<span class="op" id="1761213">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761217">if</span>&nbsp;<span class="ident" id="1761220">p</span><span class="op" id="1761221">[</span><span class="ident" id="1761222">i</span><span class="op" id="1761223">]</span>&nbsp;<span class="op" id="1761225">&lt;</span>&nbsp;<span class="ident" id="1761227">RuneSelf</span>&nbsp;<span class="op" id="1761236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1761241">i</span><span class="op" id="1761242">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1761247">}</span>&nbsp;<span class="keyword" id="1761249">else</span>&nbsp;<span class="op" id="1761254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1761259">_</span><span class="op" id="1761260">,</span>&nbsp;<span class="ident" id="1761262">size</span>&nbsp;<span class="op" id="1761267">:=</span>&nbsp;<span class="ident" id="1761270">DecodeRune</span><span class="op" id="1761280">(</span><span class="ident" id="1761281">p</span><span class="op" id="1761282">[</span><span class="ident" id="1761283">i</span><span class="op" id="1761284">:</span><span class="op" id="1761285">]</span><span class="op" id="1761286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761291">if</span>&nbsp;<span class="ident" id="1761294">size</span>&nbsp;<span class="op" id="1761299">==</span>&nbsp;<span class="num" id="1761302">1</span>&nbsp;<span class="op" id="1761304">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1761310">//&nbsp;All&nbsp;valid&nbsp;runes&nbsp;of&nbsp;size&nbsp;1&nbsp;(those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1761350">//&nbsp;below&nbsp;RuneSelf)&nbsp;were&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1761393">//&nbsp;This&nbsp;must&nbsp;be&nbsp;a&nbsp;RuneError.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761426">return</span>&nbsp;<span class="builtintype" id="1761433">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1761442">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1761447">i</span>&nbsp;<span class="op" id="1761449">+=</span>&nbsp;<span class="ident" id="1761452">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1761459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1761462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761465">return</span>&nbsp;<span class="builtintype" id="1761472">true</span><br>
<span class="lineno"></span><span class="op" id="1761477">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="1761480">//&nbsp;ValidString&nbsp;reports&nbsp;whether&nbsp;s&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1761561">func</span>&nbsp;<span class="ident" id="1761566">ValidString</span><span class="op" id="1761577">(</span><span class="ident" id="1761578">s</span>&nbsp;<span class="builtintype" id="1761580">string</span><span class="op" id="1761586">)</span>&nbsp;<span class="builtintype" id="1761588">bool</span>&nbsp;<span class="op" id="1761593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761596">for</span>&nbsp;<span class="ident" id="1761600">i</span><span class="op" id="1761601">,</span>&nbsp;<span class="ident" id="1761603">r</span>&nbsp;<span class="op" id="1761605">:=</span>&nbsp;<span class="keyword" id="1761608">range</span>&nbsp;<span class="ident" id="1761614">s</span>&nbsp;<span class="op" id="1761616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761620">if</span>&nbsp;<span class="ident" id="1761623">r</span>&nbsp;<span class="op" id="1761625">==</span>&nbsp;<span class="ident" id="1761628">RuneError</span>&nbsp;<span class="op" id="1761638">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1761643">//&nbsp;The&nbsp;RuneError&nbsp;value&nbsp;can&nbsp;be&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1761685">//&nbsp;sentinel&nbsp;value&nbsp;(if&nbsp;it&#39;s&nbsp;size&nbsp;1)&nbsp;or&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1761735">//&nbsp;value&nbsp;encoded&nbsp;properly.&nbsp;Decode&nbsp;it&nbsp;to&nbsp;see&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1761785">//&nbsp;it&#39;s&nbsp;the&nbsp;1&nbsp;byte&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1761823">_</span><span class="op" id="1761824">,</span>&nbsp;<span class="ident" id="1761826">size</span>&nbsp;<span class="op" id="1761831">:=</span>&nbsp;<span class="ident" id="1761834">DecodeRuneInString</span><span class="op" id="1761852">(</span><span class="ident" id="1761853">s</span><span class="op" id="1761854">[</span><span class="ident" id="1761855">i</span><span class="op" id="1761856">:</span><span class="op" id="1761857">]</span><span class="op" id="1761858">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761863">if</span>&nbsp;<span class="ident" id="1761866">size</span>&nbsp;<span class="op" id="1761871">==</span>&nbsp;<span class="num" id="1761874">1</span>&nbsp;<span class="op" id="1761876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761882">return</span>&nbsp;<span class="builtintype" id="1761889">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1761898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1761902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1761905">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761908">return</span>&nbsp;<span class="builtintype" id="1761915">true</span><br>
<span class="lineno"></span><span class="op" id="1761920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1761923">//&nbsp;ValidRune&nbsp;reports&nbsp;whether&nbsp;r&nbsp;can&nbsp;be&nbsp;legally&nbsp;encoded&nbsp;as&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1761987">//&nbsp;Code&nbsp;points&nbsp;that&nbsp;are&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;a&nbsp;surrogate&nbsp;half&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno">435</span><span class="keyword" id="1762057">func</span>&nbsp;<span class="ident" id="1762062">ValidRune</span><span class="op" id="1762071">(</span><span class="ident" id="1762072">r</span>&nbsp;<span class="builtintype" id="1762074">rune</span><span class="op" id="1762078">)</span>&nbsp;<span class="builtintype" id="1762080">bool</span>&nbsp;<span class="op" id="1762085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762088">switch</span>&nbsp;<span class="op" id="1762095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762098">case</span>&nbsp;<span class="ident" id="1762103">r</span>&nbsp;<span class="op" id="1762105">&lt;</span>&nbsp;<span class="num" id="1762107">0</span><span class="op" id="1762108">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762112">return</span>&nbsp;<span class="builtintype" id="1762119">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762126">case</span>&nbsp;<span class="ident" id="1762131">surrogateMin</span>&nbsp;<span class="op" id="1762144">&lt;=</span>&nbsp;<span class="ident" id="1762147">r</span>&nbsp;<span class="op" id="1762149">&amp;&amp;</span>&nbsp;<span class="ident" id="1762152">r</span>&nbsp;<span class="op" id="1762154">&lt;=</span>&nbsp;<span class="ident" id="1762157">surrogateMax</span><span class="op" id="1762169">:</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762173">return</span>&nbsp;<span class="builtintype" id="1762180">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762187">case</span>&nbsp;<span class="ident" id="1762192">r</span>&nbsp;<span class="op" id="1762194">&gt;</span>&nbsp;<span class="ident" id="1762196">MaxRune</span><span class="op" id="1762203">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762207">return</span>&nbsp;<span class="builtintype" id="1762214">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1762221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762224">return</span>&nbsp;<span class="builtintype" id="1762231">true</span><br>
<span class="lineno">445</span><span class="op" id="1762236">}</span>
</div>
</body>
</html>
