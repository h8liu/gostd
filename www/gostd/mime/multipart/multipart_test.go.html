<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html" class="current">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7863265">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7863320">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7863374">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7863425">package</span>&nbsp;<span class="ident" id="7863433">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7863444">import</span>&nbsp;<span class="op" id="7863451">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863454">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863463">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863480">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863487">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863493">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863506">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863523">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863529">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863540">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863551">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7863561">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7863564">func</span>&nbsp;<span class="ident" id="7863569">TestBoundaryLine</span><span class="op" id="7863585">(</span><span class="ident" id="7863586">t</span>&nbsp;<span class="op" id="7863588">*</span><span class="ident" id="7863589">testing</span><span class="op" id="7863596">.</span><span class="ident" id="7863597">T</span><span class="op" id="7863598">)</span>&nbsp;<span class="op" id="7863600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863603">mr</span>&nbsp;<span class="op" id="7863606">:=</span>&nbsp;<span class="ident" id="7863609">NewReader</span><span class="op" id="7863618">(</span><span class="ident" id="7863619">strings</span><span class="op" id="7863626">.</span><span class="ident" id="7863627">NewReader</span><span class="op" id="7863636">(</span><span class="string" id="7863637">&#34;&#34;</span><span class="op" id="7863639">)</span><span class="op" id="7863640">,</span>&nbsp;<span class="string" id="7863642">&#34;myBoundary&#34;</span><span class="op" id="7863654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863657">if</span>&nbsp;<span class="op" id="7863660">!</span><span class="ident" id="7863661">mr</span><span class="op" id="7863663">.</span><span class="ident" id="7863664">isBoundaryDelimiterLine</span><span class="op" id="7863687">(</span><span class="op" id="7863688">[</span><span class="op" id="7863689">]</span><span class="builtintype" id="7863690">byte</span><span class="op" id="7863694">(</span><span class="string" id="7863695">&#34;--myBoundary\r\n&#34;</span><span class="op" id="7863713">)</span><span class="op" id="7863714">)</span>&nbsp;<span class="op" id="7863716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863720">t</span><span class="op" id="7863721">.</span><span class="ident" id="7863722">Error</span><span class="op" id="7863727">(</span><span class="string" id="7863728">&#34;expected&#34;</span><span class="op" id="7863738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7863741">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863744">if</span>&nbsp;<span class="op" id="7863747">!</span><span class="ident" id="7863748">mr</span><span class="op" id="7863750">.</span><span class="ident" id="7863751">isBoundaryDelimiterLine</span><span class="op" id="7863774">(</span><span class="op" id="7863775">[</span><span class="op" id="7863776">]</span><span class="builtintype" id="7863777">byte</span><span class="op" id="7863781">(</span><span class="string" id="7863782">&#34;--myBoundary&nbsp;\r\n&#34;</span><span class="op" id="7863801">)</span><span class="op" id="7863802">)</span>&nbsp;<span class="op" id="7863804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863808">t</span><span class="op" id="7863809">.</span><span class="ident" id="7863810">Error</span><span class="op" id="7863815">(</span><span class="string" id="7863816">&#34;expected&#34;</span><span class="op" id="7863826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7863829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863832">if</span>&nbsp;<span class="op" id="7863835">!</span><span class="ident" id="7863836">mr</span><span class="op" id="7863838">.</span><span class="ident" id="7863839">isBoundaryDelimiterLine</span><span class="op" id="7863862">(</span><span class="op" id="7863863">[</span><span class="op" id="7863864">]</span><span class="builtintype" id="7863865">byte</span><span class="op" id="7863869">(</span><span class="string" id="7863870">&#34;--myBoundary&nbsp;\n&#34;</span><span class="op" id="7863887">)</span><span class="op" id="7863888">)</span>&nbsp;<span class="op" id="7863890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863894">t</span><span class="op" id="7863895">.</span><span class="ident" id="7863896">Error</span><span class="op" id="7863901">(</span><span class="string" id="7863902">&#34;expected&#34;</span><span class="op" id="7863912">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7863915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863918">if</span>&nbsp;<span class="ident" id="7863921">mr</span><span class="op" id="7863923">.</span><span class="ident" id="7863924">isBoundaryDelimiterLine</span><span class="op" id="7863947">(</span><span class="op" id="7863948">[</span><span class="op" id="7863949">]</span><span class="builtintype" id="7863950">byte</span><span class="op" id="7863954">(</span><span class="string" id="7863955">&#34;--myBoundary&nbsp;bogus&nbsp;\n&#34;</span><span class="op" id="7863978">)</span><span class="op" id="7863979">)</span>&nbsp;<span class="op" id="7863981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863985">t</span><span class="op" id="7863986">.</span><span class="ident" id="7863987">Error</span><span class="op" id="7863992">(</span><span class="string" id="7863993">&#34;expected&nbsp;fail&#34;</span><span class="op" id="7864008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864014">if</span>&nbsp;<span class="ident" id="7864017">mr</span><span class="op" id="7864019">.</span><span class="ident" id="7864020">isBoundaryDelimiterLine</span><span class="op" id="7864043">(</span><span class="op" id="7864044">[</span><span class="op" id="7864045">]</span><span class="builtintype" id="7864046">byte</span><span class="op" id="7864050">(</span><span class="string" id="7864051">&#34;--myBoundary&nbsp;bogus--&#34;</span><span class="op" id="7864073">)</span><span class="op" id="7864074">)</span>&nbsp;<span class="op" id="7864076">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864080">t</span><span class="op" id="7864081">.</span><span class="ident" id="7864082">Error</span><span class="op" id="7864087">(</span><span class="string" id="7864088">&#34;expected&nbsp;fail&#34;</span><span class="op" id="7864103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864106">}</span><br>
<span class="lineno"></span><span class="op" id="7864108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7864111">func</span>&nbsp;<span class="ident" id="7864116">escapeString</span><span class="op" id="7864128">(</span><span class="ident" id="7864129">v</span>&nbsp;<span class="builtintype" id="7864131">string</span><span class="op" id="7864137">)</span>&nbsp;<span class="builtintype" id="7864139">string</span>&nbsp;<span class="op" id="7864146">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864149">bytes</span><span class="op" id="7864154">,</span>&nbsp;<span class="ident" id="7864156">_</span>&nbsp;<span class="op" id="7864158">:=</span>&nbsp;<span class="ident" id="7864161">json</span><span class="op" id="7864165">.</span><span class="ident" id="7864166">Marshal</span><span class="op" id="7864173">(</span><span class="ident" id="7864174">v</span><span class="op" id="7864175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864178">return</span>&nbsp;<span class="builtintype" id="7864185">string</span><span class="op" id="7864191">(</span><span class="ident" id="7864192">bytes</span><span class="op" id="7864197">)</span><br>
<span class="lineno"></span><span class="op" id="7864199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7864202">func</span>&nbsp;<span class="ident" id="7864207">expectEq</span><span class="op" id="7864215">(</span><span class="ident" id="7864216">t</span>&nbsp;<span class="op" id="7864218">*</span><span class="ident" id="7864219">testing</span><span class="op" id="7864226">.</span><span class="ident" id="7864227">T</span><span class="op" id="7864228">,</span>&nbsp;<span class="ident" id="7864230">expected</span><span class="op" id="7864238">,</span>&nbsp;<span class="ident" id="7864240">actual</span><span class="op" id="7864246">,</span>&nbsp;<span class="ident" id="7864248">what</span>&nbsp;<span class="builtintype" id="7864253">string</span><span class="op" id="7864259">)</span>&nbsp;<span class="op" id="7864261">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864264">if</span>&nbsp;<span class="ident" id="7864267">expected</span>&nbsp;<span class="op" id="7864276">==</span>&nbsp;<span class="ident" id="7864279">actual</span>&nbsp;<span class="op" id="7864286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864290">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864301">t</span><span class="op" id="7864302">.</span><span class="ident" id="7864303">Errorf</span><span class="op" id="7864309">(</span><span class="string" id="7864310">&#34;Unexpected&nbsp;value&nbsp;for&nbsp;%s;&nbsp;got&nbsp;%s&nbsp;(len&nbsp;%d)&nbsp;but&nbsp;expected:&nbsp;%s&nbsp;(len&nbsp;%d)&#34;</span><span class="op" id="7864378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864382">what</span><span class="op" id="7864386">,</span>&nbsp;<span class="ident" id="7864388">escapeString</span><span class="op" id="7864400">(</span><span class="ident" id="7864401">actual</span><span class="op" id="7864407">)</span><span class="op" id="7864408">,</span>&nbsp;<span class="builtinfunc" id="7864410">len</span><span class="op" id="7864413">(</span><span class="ident" id="7864414">actual</span><span class="op" id="7864420">)</span><span class="op" id="7864421">,</span>&nbsp;<span class="ident" id="7864423">escapeString</span><span class="op" id="7864435">(</span><span class="ident" id="7864436">expected</span><span class="op" id="7864444">)</span><span class="op" id="7864445">,</span>&nbsp;<span class="builtinfunc" id="7864447">len</span><span class="op" id="7864450">(</span><span class="ident" id="7864451">expected</span><span class="op" id="7864459">)</span><span class="op" id="7864460">)</span><br>
<span class="lineno">50</span><span class="op" id="7864462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7864465">func</span>&nbsp;<span class="ident" id="7864470">TestNameAccessors</span><span class="op" id="7864487">(</span><span class="ident" id="7864488">t</span>&nbsp;<span class="op" id="7864490">*</span><span class="ident" id="7864491">testing</span><span class="op" id="7864498">.</span><span class="ident" id="7864499">T</span><span class="op" id="7864500">)</span>&nbsp;<span class="op" id="7864502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864505">tests</span>&nbsp;<span class="op" id="7864511">:=</span>&nbsp;<span class="op" id="7864514">[</span><span class="op" id="7864515">...</span><span class="op" id="7864518">]</span><span class="op" id="7864519">[</span><span class="num" id="7864520">3</span><span class="op" id="7864521">]</span><span class="builtintype" id="7864522">string</span><span class="op" id="7864528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864532">{</span><span class="string" id="7864533">`form-data;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="7864556">,</span>&nbsp;<span class="string" id="7864558">&#34;foo&#34;</span><span class="op" id="7864563">,</span>&nbsp;<span class="string" id="7864565">&#34;&#34;</span><span class="op" id="7864567">}</span><span class="op" id="7864568">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864572">{</span><span class="string" id="7864573">`&nbsp;form-data&nbsp;;&nbsp;name=foo`</span><span class="op" id="7864596">,</span>&nbsp;<span class="string" id="7864598">&#34;foo&#34;</span><span class="op" id="7864603">,</span>&nbsp;<span class="string" id="7864605">&#34;&#34;</span><span class="op" id="7864607">}</span><span class="op" id="7864608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864612">{</span><span class="string" id="7864613">`FORM-DATA;name=&#34;foo&#34;`</span><span class="op" id="7864635">,</span>&nbsp;<span class="string" id="7864637">&#34;foo&#34;</span><span class="op" id="7864642">,</span>&nbsp;<span class="string" id="7864644">&#34;&#34;</span><span class="op" id="7864646">}</span><span class="op" id="7864647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864651">{</span><span class="string" id="7864652">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="7864677">,</span>&nbsp;<span class="string" id="7864679">&#34;foo&#34;</span><span class="op" id="7864684">,</span>&nbsp;<span class="string" id="7864686">&#34;&#34;</span><span class="op" id="7864688">}</span><span class="op" id="7864689">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864693">{</span><span class="string" id="7864694">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="7864719">,</span>&nbsp;<span class="string" id="7864721">&#34;foo&#34;</span><span class="op" id="7864726">,</span>&nbsp;<span class="string" id="7864728">&#34;&#34;</span><span class="op" id="7864730">}</span><span class="op" id="7864731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864735">{</span><span class="string" id="7864736">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=foo`</span><span class="op" id="7864759">,</span>&nbsp;<span class="string" id="7864761">&#34;foo&#34;</span><span class="op" id="7864766">,</span>&nbsp;<span class="string" id="7864768">&#34;&#34;</span><span class="op" id="7864770">}</span><span class="op" id="7864771">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864775">{</span><span class="string" id="7864776">`&nbsp;FORM-DATA&nbsp;;&nbsp;filename=&#34;foo.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="7864829">,</span>&nbsp;<span class="string" id="7864831">&#34;foo&#34;</span><span class="op" id="7864836">,</span>&nbsp;<span class="string" id="7864838">&#34;foo.txt&#34;</span><span class="op" id="7864847">}</span><span class="op" id="7864848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864852">{</span><span class="string" id="7864853">`&nbsp;not-form-data&nbsp;;&nbsp;filename=&#34;bar.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="7864910">,</span>&nbsp;<span class="string" id="7864912">&#34;&#34;</span><span class="op" id="7864914">,</span>&nbsp;<span class="string" id="7864916">&#34;bar.txt&#34;</span><span class="op" id="7864925">}</span><span class="op" id="7864926">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864932">for</span>&nbsp;<span class="ident" id="7864936">i</span><span class="op" id="7864937">,</span>&nbsp;<span class="ident" id="7864939">test</span>&nbsp;<span class="op" id="7864944">:=</span>&nbsp;<span class="keyword" id="7864947">range</span>&nbsp;<span class="ident" id="7864953">tests</span>&nbsp;<span class="op" id="7864959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864963">p</span>&nbsp;<span class="op" id="7864965">:=</span>&nbsp;<span class="op" id="7864968">&amp;</span><span class="ident" id="7864969">Part</span><span class="op" id="7864973">{</span><span class="ident" id="7864974">Header</span><span class="op" id="7864980">:</span>&nbsp;<span class="builtinfunc" id="7864982">make</span><span class="op" id="7864986">(</span><span class="keyword" id="7864987">map</span><span class="op" id="7864990">[</span><span class="builtintype" id="7864991">string</span><span class="op" id="7864997">]</span><span class="op" id="7864998">[</span><span class="op" id="7864999">]</span><span class="builtintype" id="7865000">string</span><span class="op" id="7865006">)</span><span class="op" id="7865007">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865011">p</span><span class="op" id="7865012">.</span><span class="ident" id="7865013">Header</span><span class="op" id="7865019">.</span><span class="ident" id="7865020">Set</span><span class="op" id="7865023">(</span><span class="string" id="7865024">&#34;Content-Disposition&#34;</span><span class="op" id="7865045">,</span>&nbsp;<span class="ident" id="7865047">test</span><span class="op" id="7865051">[</span><span class="num" id="7865052">0</span><span class="op" id="7865053">]</span><span class="op" id="7865054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865058">if</span>&nbsp;<span class="ident" id="7865061">g</span><span class="op" id="7865062">,</span>&nbsp;<span class="ident" id="7865064">e</span>&nbsp;<span class="op" id="7865066">:=</span>&nbsp;<span class="ident" id="7865069">p</span><span class="op" id="7865070">.</span><span class="ident" id="7865071">FormName</span><span class="op" id="7865079">(</span><span class="op" id="7865080">)</span><span class="op" id="7865081">,</span>&nbsp;<span class="ident" id="7865083">test</span><span class="op" id="7865087">[</span><span class="num" id="7865088">1</span><span class="op" id="7865089">]</span><span class="op" id="7865090">;</span>&nbsp;<span class="ident" id="7865092">g</span>&nbsp;<span class="op" id="7865094">!=</span>&nbsp;<span class="ident" id="7865097">e</span>&nbsp;<span class="op" id="7865099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865104">t</span><span class="op" id="7865105">.</span><span class="ident" id="7865106">Errorf</span><span class="op" id="7865112">(</span><span class="string" id="7865113">&#34;test&nbsp;%d:&nbsp;FormName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7865148">,</span>&nbsp;<span class="ident" id="7865150">i</span><span class="op" id="7865151">,</span>&nbsp;<span class="ident" id="7865153">g</span><span class="op" id="7865154">,</span>&nbsp;<span class="ident" id="7865156">e</span><span class="op" id="7865157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865165">if</span>&nbsp;<span class="ident" id="7865168">g</span><span class="op" id="7865169">,</span>&nbsp;<span class="ident" id="7865171">e</span>&nbsp;<span class="op" id="7865173">:=</span>&nbsp;<span class="ident" id="7865176">p</span><span class="op" id="7865177">.</span><span class="ident" id="7865178">FileName</span><span class="op" id="7865186">(</span><span class="op" id="7865187">)</span><span class="op" id="7865188">,</span>&nbsp;<span class="ident" id="7865190">test</span><span class="op" id="7865194">[</span><span class="num" id="7865195">2</span><span class="op" id="7865196">]</span><span class="op" id="7865197">;</span>&nbsp;<span class="ident" id="7865199">g</span>&nbsp;<span class="op" id="7865201">!=</span>&nbsp;<span class="ident" id="7865204">e</span>&nbsp;<span class="op" id="7865206">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865211">t</span><span class="op" id="7865212">.</span><span class="ident" id="7865213">Errorf</span><span class="op" id="7865219">(</span><span class="string" id="7865220">&#34;test&nbsp;%d:&nbsp;FileName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7865255">,</span>&nbsp;<span class="ident" id="7865257">i</span><span class="op" id="7865258">,</span>&nbsp;<span class="ident" id="7865260">g</span><span class="op" id="7865261">,</span>&nbsp;<span class="ident" id="7865263">e</span><span class="op" id="7865264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865271">}</span><br>
<span class="lineno"></span><span class="op" id="7865273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="7865276">var</span>&nbsp;<span class="ident" id="7865280">longLine</span>&nbsp;<span class="op" id="7865289">=</span>&nbsp;<span class="ident" id="7865291">strings</span><span class="op" id="7865298">.</span><span class="ident" id="7865299">Repeat</span><span class="op" id="7865305">(</span><span class="string" id="7865306">&#34;\n\n\r\r\r\n\r\000&#34;</span><span class="op" id="7865326">,</span>&nbsp;<span class="op" id="7865328">(</span><span class="num" id="7865329">1</span><span class="op" id="7865330">&lt;&lt;</span><span class="num" id="7865332">20</span><span class="op" id="7865334">)</span><span class="op" id="7865335">/</span><span class="num" id="7865336">8</span><span class="op" id="7865337">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7865340">func</span>&nbsp;<span class="ident" id="7865345">testMultipartBody</span><span class="op" id="7865362">(</span><span class="ident" id="7865363">sep</span>&nbsp;<span class="builtintype" id="7865367">string</span><span class="op" id="7865373">)</span>&nbsp;<span class="builtintype" id="7865375">string</span>&nbsp;<span class="op" id="7865382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865385">testBody</span>&nbsp;<span class="op" id="7865394">:=</span>&nbsp;<span class="string" id="7865397">`<br>
<span class="lineno"></span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno">80</span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1<br>
<span class="lineno"></span>HEADER2:&nbsp;value2<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno">85</span>My&nbsp;value<br>
<span class="lineno"></span>The&nbsp;end.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>name:&nbsp;bigsection<br>
<span class="lineno"></span><br>
<span class="lineno">90</span>[longline]<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1b<br>
<span class="lineno"></span>HEADER2:&nbsp;value2b<br>
<span class="lineno"></span>foo-bar:&nbsp;bazb<br>
<span class="lineno">95</span><br>
<span class="lineno"></span>Line&nbsp;1<br>
<span class="lineno"></span>Line&nbsp;2<br>
<span class="lineno"></span>Line&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.<br>
<span class="lineno"></span><br>
<span class="lineno">100</span>--MyBoundary<br>
<span class="lineno"></span><br>
<span class="lineno"></span>never&nbsp;read&nbsp;data<br>
<span class="lineno"></span>--MyBoundary--<br>
<span class="lineno"></span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>useless&nbsp;trailer<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865754">testBody</span>&nbsp;<span class="op" id="7865763">=</span>&nbsp;<span class="ident" id="7865765">strings</span><span class="op" id="7865772">.</span><span class="ident" id="7865773">Replace</span><span class="op" id="7865780">(</span><span class="ident" id="7865781">testBody</span><span class="op" id="7865789">,</span>&nbsp;<span class="string" id="7865791">&#34;\n&#34;</span><span class="op" id="7865795">,</span>&nbsp;<span class="ident" id="7865797">sep</span><span class="op" id="7865800">,</span>&nbsp;<span class="op" id="7865802">-</span><span class="num" id="7865803">1</span><span class="op" id="7865804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865807">return</span>&nbsp;<span class="ident" id="7865814">strings</span><span class="op" id="7865821">.</span><span class="ident" id="7865822">Replace</span><span class="op" id="7865829">(</span><span class="ident" id="7865830">testBody</span><span class="op" id="7865838">,</span>&nbsp;<span class="string" id="7865840">&#34;[longline]&#34;</span><span class="op" id="7865852">,</span>&nbsp;<span class="ident" id="7865854">longLine</span><span class="op" id="7865862">,</span>&nbsp;<span class="num" id="7865864">1</span><span class="op" id="7865865">)</span><br>
<span class="lineno">110</span><span class="op" id="7865867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7865870">func</span>&nbsp;<span class="ident" id="7865875">TestMultipart</span><span class="op" id="7865888">(</span><span class="ident" id="7865889">t</span>&nbsp;<span class="op" id="7865891">*</span><span class="ident" id="7865892">testing</span><span class="op" id="7865899">.</span><span class="ident" id="7865900">T</span><span class="op" id="7865901">)</span>&nbsp;<span class="op" id="7865903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865906">bodyReader</span>&nbsp;<span class="op" id="7865917">:=</span>&nbsp;<span class="ident" id="7865920">strings</span><span class="op" id="7865927">.</span><span class="ident" id="7865928">NewReader</span><span class="op" id="7865937">(</span><span class="ident" id="7865938">testMultipartBody</span><span class="op" id="7865955">(</span><span class="string" id="7865956">&#34;\r\n&#34;</span><span class="op" id="7865962">)</span><span class="op" id="7865963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865966">testMultipart</span><span class="op" id="7865979">(</span><span class="ident" id="7865980">t</span><span class="op" id="7865981">,</span>&nbsp;<span class="ident" id="7865983">bodyReader</span><span class="op" id="7865993">,</span>&nbsp;<span class="builtintype" id="7865995">false</span><span class="op" id="7866000">)</span><br>
<span class="lineno">115</span><span class="op" id="7866002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7866005">func</span>&nbsp;<span class="ident" id="7866010">TestMultipartOnlyNewlines</span><span class="op" id="7866035">(</span><span class="ident" id="7866036">t</span>&nbsp;<span class="op" id="7866038">*</span><span class="ident" id="7866039">testing</span><span class="op" id="7866046">.</span><span class="ident" id="7866047">T</span><span class="op" id="7866048">)</span>&nbsp;<span class="op" id="7866050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866053">bodyReader</span>&nbsp;<span class="op" id="7866064">:=</span>&nbsp;<span class="ident" id="7866067">strings</span><span class="op" id="7866074">.</span><span class="ident" id="7866075">NewReader</span><span class="op" id="7866084">(</span><span class="ident" id="7866085">testMultipartBody</span><span class="op" id="7866102">(</span><span class="string" id="7866103">&#34;\n&#34;</span><span class="op" id="7866107">)</span><span class="op" id="7866108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866111">testMultipart</span><span class="op" id="7866124">(</span><span class="ident" id="7866125">t</span><span class="op" id="7866126">,</span>&nbsp;<span class="ident" id="7866128">bodyReader</span><span class="op" id="7866138">,</span>&nbsp;<span class="builtintype" id="7866140">true</span><span class="op" id="7866144">)</span><br>
<span class="lineno">120</span><span class="op" id="7866146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7866149">func</span>&nbsp;<span class="ident" id="7866154">TestMultipartSlowInput</span><span class="op" id="7866176">(</span><span class="ident" id="7866177">t</span>&nbsp;<span class="op" id="7866179">*</span><span class="ident" id="7866180">testing</span><span class="op" id="7866187">.</span><span class="ident" id="7866188">T</span><span class="op" id="7866189">)</span>&nbsp;<span class="op" id="7866191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866194">bodyReader</span>&nbsp;<span class="op" id="7866205">:=</span>&nbsp;<span class="ident" id="7866208">strings</span><span class="op" id="7866215">.</span><span class="ident" id="7866216">NewReader</span><span class="op" id="7866225">(</span><span class="ident" id="7866226">testMultipartBody</span><span class="op" id="7866243">(</span><span class="string" id="7866244">&#34;\r\n&#34;</span><span class="op" id="7866250">)</span><span class="op" id="7866251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866254">testMultipart</span><span class="op" id="7866267">(</span><span class="ident" id="7866268">t</span><span class="op" id="7866269">,</span>&nbsp;<span class="op" id="7866271">&amp;</span><span class="ident" id="7866272">slowReader</span><span class="op" id="7866282">{</span><span class="ident" id="7866283">bodyReader</span><span class="op" id="7866293">}</span><span class="op" id="7866294">,</span>&nbsp;<span class="builtintype" id="7866296">false</span><span class="op" id="7866301">)</span><br>
<span class="lineno">125</span><span class="op" id="7866303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7866306">func</span>&nbsp;<span class="ident" id="7866311">testMultipart</span><span class="op" id="7866324">(</span><span class="ident" id="7866325">t</span>&nbsp;<span class="op" id="7866327">*</span><span class="ident" id="7866328">testing</span><span class="op" id="7866335">.</span><span class="ident" id="7866336">T</span><span class="op" id="7866337">,</span>&nbsp;<span class="ident" id="7866339">r</span>&nbsp;<span class="ident" id="7866341">io</span><span class="op" id="7866343">.</span><span class="ident" id="7866344">Reader</span><span class="op" id="7866350">,</span>&nbsp;<span class="ident" id="7866352">onlyNewlines</span>&nbsp;<span class="builtintype" id="7866365">bool</span><span class="op" id="7866369">)</span>&nbsp;<span class="op" id="7866371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866374">reader</span>&nbsp;<span class="op" id="7866381">:=</span>&nbsp;<span class="ident" id="7866384">NewReader</span><span class="op" id="7866393">(</span><span class="ident" id="7866394">r</span><span class="op" id="7866395">,</span>&nbsp;<span class="string" id="7866397">&#34;MyBoundary&#34;</span><span class="op" id="7866409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866412">buf</span>&nbsp;<span class="op" id="7866416">:=</span>&nbsp;<span class="builtinfunc" id="7866419">new</span><span class="op" id="7866422">(</span><span class="ident" id="7866423">bytes</span><span class="op" id="7866428">.</span><span class="ident" id="7866429">Buffer</span><span class="op" id="7866435">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7866439">//&nbsp;Part1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866449">part</span><span class="op" id="7866453">,</span>&nbsp;<span class="ident" id="7866455">err</span>&nbsp;<span class="op" id="7866459">:=</span>&nbsp;<span class="ident" id="7866462">reader</span><span class="op" id="7866468">.</span><span class="ident" id="7866469">NextPart</span><span class="op" id="7866477">(</span><span class="op" id="7866478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866481">if</span>&nbsp;<span class="ident" id="7866484">part</span>&nbsp;<span class="op" id="7866489">==</span>&nbsp;<span class="ident" id="7866492">nil</span>&nbsp;<span class="op" id="7866496">||</span>&nbsp;<span class="ident" id="7866499">err</span>&nbsp;<span class="op" id="7866503">!=</span>&nbsp;<span class="ident" id="7866506">nil</span>&nbsp;<span class="op" id="7866510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866514">t</span><span class="op" id="7866515">.</span><span class="ident" id="7866516">Error</span><span class="op" id="7866521">(</span><span class="string" id="7866522">&#34;Expected&nbsp;part1&#34;</span><span class="op" id="7866538">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866542">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866553">if</span>&nbsp;<span class="ident" id="7866556">x</span>&nbsp;<span class="op" id="7866558">:=</span>&nbsp;<span class="ident" id="7866561">part</span><span class="op" id="7866565">.</span><span class="ident" id="7866566">Header</span><span class="op" id="7866572">.</span><span class="ident" id="7866573">Get</span><span class="op" id="7866576">(</span><span class="string" id="7866577">&#34;Header1&#34;</span><span class="op" id="7866586">)</span><span class="op" id="7866587">;</span>&nbsp;<span class="ident" id="7866589">x</span>&nbsp;<span class="op" id="7866591">!=</span>&nbsp;<span class="string" id="7866594">&#34;value1&#34;</span>&nbsp;<span class="op" id="7866603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866607">t</span><span class="op" id="7866608">.</span><span class="ident" id="7866609">Errorf</span><span class="op" id="7866615">(</span><span class="string" id="7866616">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7866651">,</span>&nbsp;<span class="string" id="7866653">&#34;Header1&#34;</span><span class="op" id="7866662">,</span>&nbsp;<span class="ident" id="7866664">x</span><span class="op" id="7866665">,</span>&nbsp;<span class="string" id="7866667">&#34;value1&#34;</span><span class="op" id="7866675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866678">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866681">if</span>&nbsp;<span class="ident" id="7866684">x</span>&nbsp;<span class="op" id="7866686">:=</span>&nbsp;<span class="ident" id="7866689">part</span><span class="op" id="7866693">.</span><span class="ident" id="7866694">Header</span><span class="op" id="7866700">.</span><span class="ident" id="7866701">Get</span><span class="op" id="7866704">(</span><span class="string" id="7866705">&#34;foo-bar&#34;</span><span class="op" id="7866714">)</span><span class="op" id="7866715">;</span>&nbsp;<span class="ident" id="7866717">x</span>&nbsp;<span class="op" id="7866719">!=</span>&nbsp;<span class="string" id="7866722">&#34;baz&#34;</span>&nbsp;<span class="op" id="7866728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866732">t</span><span class="op" id="7866733">.</span><span class="ident" id="7866734">Errorf</span><span class="op" id="7866740">(</span><span class="string" id="7866741">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7866776">,</span>&nbsp;<span class="string" id="7866778">&#34;foo-bar&#34;</span><span class="op" id="7866787">,</span>&nbsp;<span class="ident" id="7866789">x</span><span class="op" id="7866790">,</span>&nbsp;<span class="string" id="7866792">&#34;baz&#34;</span><span class="op" id="7866797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866803">if</span>&nbsp;<span class="ident" id="7866806">x</span>&nbsp;<span class="op" id="7866808">:=</span>&nbsp;<span class="ident" id="7866811">part</span><span class="op" id="7866815">.</span><span class="ident" id="7866816">Header</span><span class="op" id="7866822">.</span><span class="ident" id="7866823">Get</span><span class="op" id="7866826">(</span><span class="string" id="7866827">&#34;Foo-Bar&#34;</span><span class="op" id="7866836">)</span><span class="op" id="7866837">;</span>&nbsp;<span class="ident" id="7866839">x</span>&nbsp;<span class="op" id="7866841">!=</span>&nbsp;<span class="string" id="7866844">&#34;baz&#34;</span>&nbsp;<span class="op" id="7866850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866854">t</span><span class="op" id="7866855">.</span><span class="ident" id="7866856">Errorf</span><span class="op" id="7866862">(</span><span class="string" id="7866863">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7866898">,</span>&nbsp;<span class="string" id="7866900">&#34;Foo-Bar&#34;</span><span class="op" id="7866909">,</span>&nbsp;<span class="ident" id="7866911">x</span><span class="op" id="7866912">,</span>&nbsp;<span class="string" id="7866914">&#34;baz&#34;</span><span class="op" id="7866919">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866925">buf</span><span class="op" id="7866928">.</span><span class="ident" id="7866929">Reset</span><span class="op" id="7866934">(</span><span class="op" id="7866935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866938">if</span>&nbsp;<span class="ident" id="7866941">_</span><span class="op" id="7866942">,</span>&nbsp;<span class="ident" id="7866944">err</span>&nbsp;<span class="op" id="7866948">:=</span>&nbsp;<span class="ident" id="7866951">io</span><span class="op" id="7866953">.</span><span class="ident" id="7866954">Copy</span><span class="op" id="7866958">(</span><span class="ident" id="7866959">buf</span><span class="op" id="7866962">,</span>&nbsp;<span class="ident" id="7866964">part</span><span class="op" id="7866968">)</span><span class="op" id="7866969">;</span>&nbsp;<span class="ident" id="7866971">err</span>&nbsp;<span class="op" id="7866975">!=</span>&nbsp;<span class="ident" id="7866978">nil</span>&nbsp;<span class="op" id="7866982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866986">t</span><span class="op" id="7866987">.</span><span class="ident" id="7866988">Errorf</span><span class="op" id="7866994">(</span><span class="string" id="7866995">&#34;part&nbsp;1&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="7867012">,</span>&nbsp;<span class="ident" id="7867014">err</span><span class="op" id="7867017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867020">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867024">adjustNewlines</span>&nbsp;<span class="op" id="7867039">:=</span>&nbsp;<span class="keyword" id="7867042">func</span><span class="op" id="7867046">(</span><span class="ident" id="7867047">s</span>&nbsp;<span class="builtintype" id="7867049">string</span><span class="op" id="7867055">)</span>&nbsp;<span class="builtintype" id="7867057">string</span>&nbsp;<span class="op" id="7867064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867068">if</span>&nbsp;<span class="ident" id="7867071">onlyNewlines</span>&nbsp;<span class="op" id="7867084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867089">return</span>&nbsp;<span class="ident" id="7867096">strings</span><span class="op" id="7867103">.</span><span class="ident" id="7867104">Replace</span><span class="op" id="7867111">(</span><span class="ident" id="7867112">s</span><span class="op" id="7867113">,</span>&nbsp;<span class="string" id="7867115">&#34;\r\n&#34;</span><span class="op" id="7867121">,</span>&nbsp;<span class="string" id="7867123">&#34;\n&#34;</span><span class="op" id="7867127">,</span>&nbsp;<span class="op" id="7867129">-</span><span class="num" id="7867130">1</span><span class="op" id="7867131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867135">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867139">return</span>&nbsp;<span class="ident" id="7867146">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867153">expectEq</span><span class="op" id="7867161">(</span><span class="ident" id="7867162">t</span><span class="op" id="7867163">,</span>&nbsp;<span class="ident" id="7867165">adjustNewlines</span><span class="op" id="7867179">(</span><span class="string" id="7867180">&#34;My&nbsp;value\r\nThe&nbsp;end.&#34;</span><span class="op" id="7867202">)</span><span class="op" id="7867203">,</span>&nbsp;<span class="ident" id="7867205">buf</span><span class="op" id="7867208">.</span><span class="ident" id="7867209">String</span><span class="op" id="7867215">(</span><span class="op" id="7867216">)</span><span class="op" id="7867217">,</span>&nbsp;<span class="string" id="7867219">&#34;Value&nbsp;of&nbsp;first&nbsp;part&#34;</span><span class="op" id="7867240">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7867244">//&nbsp;Part2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867254">part</span><span class="op" id="7867258">,</span>&nbsp;<span class="ident" id="7867260">err</span>&nbsp;<span class="op" id="7867264">=</span>&nbsp;<span class="ident" id="7867266">reader</span><span class="op" id="7867272">.</span><span class="ident" id="7867273">NextPart</span><span class="op" id="7867281">(</span><span class="op" id="7867282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867285">if</span>&nbsp;<span class="ident" id="7867288">err</span>&nbsp;<span class="op" id="7867292">!=</span>&nbsp;<span class="ident" id="7867295">nil</span>&nbsp;<span class="op" id="7867299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867303">t</span><span class="op" id="7867304">.</span><span class="ident" id="7867305">Fatalf</span><span class="op" id="7867311">(</span><span class="string" id="7867312">&#34;Expected&nbsp;part2;&nbsp;got:&nbsp;%v&#34;</span><span class="op" id="7867337">,</span>&nbsp;<span class="ident" id="7867339">err</span><span class="op" id="7867342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867346">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867357">if</span>&nbsp;<span class="ident" id="7867360">e</span><span class="op" id="7867361">,</span>&nbsp;<span class="ident" id="7867363">g</span>&nbsp;<span class="op" id="7867365">:=</span>&nbsp;<span class="string" id="7867368">&#34;bigsection&#34;</span><span class="op" id="7867380">,</span>&nbsp;<span class="ident" id="7867382">part</span><span class="op" id="7867386">.</span><span class="ident" id="7867387">Header</span><span class="op" id="7867393">.</span><span class="ident" id="7867394">Get</span><span class="op" id="7867397">(</span><span class="string" id="7867398">&#34;name&#34;</span><span class="op" id="7867404">)</span><span class="op" id="7867405">;</span>&nbsp;<span class="ident" id="7867407">e</span>&nbsp;<span class="op" id="7867409">!=</span>&nbsp;<span class="ident" id="7867412">g</span>&nbsp;<span class="op" id="7867414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867418">t</span><span class="op" id="7867419">.</span><span class="ident" id="7867420">Errorf</span><span class="op" id="7867426">(</span><span class="string" id="7867427">&#34;part2&#39;s&nbsp;name&nbsp;header:&nbsp;expected&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7867469">,</span>&nbsp;<span class="ident" id="7867471">e</span><span class="op" id="7867472">,</span>&nbsp;<span class="ident" id="7867474">g</span><span class="op" id="7867475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867481">buf</span><span class="op" id="7867484">.</span><span class="ident" id="7867485">Reset</span><span class="op" id="7867490">(</span><span class="op" id="7867491">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867494">if</span>&nbsp;<span class="ident" id="7867497">_</span><span class="op" id="7867498">,</span>&nbsp;<span class="ident" id="7867500">err</span>&nbsp;<span class="op" id="7867504">:=</span>&nbsp;<span class="ident" id="7867507">io</span><span class="op" id="7867509">.</span><span class="ident" id="7867510">Copy</span><span class="op" id="7867514">(</span><span class="ident" id="7867515">buf</span><span class="op" id="7867518">,</span>&nbsp;<span class="ident" id="7867520">part</span><span class="op" id="7867524">)</span><span class="op" id="7867525">;</span>&nbsp;<span class="ident" id="7867527">err</span>&nbsp;<span class="op" id="7867531">!=</span>&nbsp;<span class="ident" id="7867534">nil</span>&nbsp;<span class="op" id="7867538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867542">t</span><span class="op" id="7867543">.</span><span class="ident" id="7867544">Errorf</span><span class="op" id="7867550">(</span><span class="string" id="7867551">&#34;part&nbsp;2&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="7867568">,</span>&nbsp;<span class="ident" id="7867570">err</span><span class="op" id="7867573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867579">s</span>&nbsp;<span class="op" id="7867581">:=</span>&nbsp;<span class="ident" id="7867584">buf</span><span class="op" id="7867587">.</span><span class="ident" id="7867588">String</span><span class="op" id="7867594">(</span><span class="op" id="7867595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867598">if</span>&nbsp;<span class="builtinfunc" id="7867601">len</span><span class="op" id="7867604">(</span><span class="ident" id="7867605">s</span><span class="op" id="7867606">)</span>&nbsp;<span class="op" id="7867608">!=</span>&nbsp;<span class="builtinfunc" id="7867611">len</span><span class="op" id="7867614">(</span><span class="ident" id="7867615">longLine</span><span class="op" id="7867623">)</span>&nbsp;<span class="op" id="7867625">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867629">t</span><span class="op" id="7867630">.</span><span class="ident" id="7867631">Errorf</span><span class="op" id="7867637">(</span><span class="string" id="7867638">&#34;part2&nbsp;body&nbsp;expected&nbsp;long&nbsp;line&nbsp;of&nbsp;length&nbsp;%d;&nbsp;got&nbsp;length&nbsp;%d&#34;</span><span class="op" id="7867697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7867702">len</span><span class="op" id="7867705">(</span><span class="ident" id="7867706">longLine</span><span class="op" id="7867714">)</span><span class="op" id="7867715">,</span>&nbsp;<span class="builtinfunc" id="7867717">len</span><span class="op" id="7867720">(</span><span class="ident" id="7867721">s</span><span class="op" id="7867722">)</span><span class="op" id="7867723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867729">if</span>&nbsp;<span class="ident" id="7867732">s</span>&nbsp;<span class="op" id="7867734">!=</span>&nbsp;<span class="ident" id="7867737">longLine</span>&nbsp;<span class="op" id="7867746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867750">t</span><span class="op" id="7867751">.</span><span class="ident" id="7867752">Errorf</span><span class="op" id="7867758">(</span><span class="string" id="7867759">&#34;part2&nbsp;long&nbsp;body&nbsp;didn&#39;t&nbsp;match&#34;</span><span class="op" id="7867789">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7867796">//&nbsp;Part3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867806">part</span><span class="op" id="7867810">,</span>&nbsp;<span class="ident" id="7867812">err</span>&nbsp;<span class="op" id="7867816">=</span>&nbsp;<span class="ident" id="7867818">reader</span><span class="op" id="7867824">.</span><span class="ident" id="7867825">NextPart</span><span class="op" id="7867833">(</span><span class="op" id="7867834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867837">if</span>&nbsp;<span class="ident" id="7867840">part</span>&nbsp;<span class="op" id="7867845">==</span>&nbsp;<span class="ident" id="7867848">nil</span>&nbsp;<span class="op" id="7867852">||</span>&nbsp;<span class="ident" id="7867855">err</span>&nbsp;<span class="op" id="7867859">!=</span>&nbsp;<span class="ident" id="7867862">nil</span>&nbsp;<span class="op" id="7867866">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867870">t</span><span class="op" id="7867871">.</span><span class="ident" id="7867872">Error</span><span class="op" id="7867877">(</span><span class="string" id="7867878">&#34;Expected&nbsp;part3&#34;</span><span class="op" id="7867894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867898">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867909">if</span>&nbsp;<span class="ident" id="7867912">part</span><span class="op" id="7867916">.</span><span class="ident" id="7867917">Header</span><span class="op" id="7867923">.</span><span class="ident" id="7867924">Get</span><span class="op" id="7867927">(</span><span class="string" id="7867928">&#34;foo-bar&#34;</span><span class="op" id="7867937">)</span>&nbsp;<span class="op" id="7867939">!=</span>&nbsp;<span class="string" id="7867942">&#34;bazb&#34;</span>&nbsp;<span class="op" id="7867949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867953">t</span><span class="op" id="7867954">.</span><span class="ident" id="7867955">Error</span><span class="op" id="7867960">(</span><span class="string" id="7867961">&#34;Expected&nbsp;foo-bar:&nbsp;bazb&#34;</span><span class="op" id="7867985">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867991">buf</span><span class="op" id="7867994">.</span><span class="ident" id="7867995">Reset</span><span class="op" id="7868000">(</span><span class="op" id="7868001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868004">if</span>&nbsp;<span class="ident" id="7868007">_</span><span class="op" id="7868008">,</span>&nbsp;<span class="ident" id="7868010">err</span>&nbsp;<span class="op" id="7868014">:=</span>&nbsp;<span class="ident" id="7868017">io</span><span class="op" id="7868019">.</span><span class="ident" id="7868020">Copy</span><span class="op" id="7868024">(</span><span class="ident" id="7868025">buf</span><span class="op" id="7868028">,</span>&nbsp;<span class="ident" id="7868030">part</span><span class="op" id="7868034">)</span><span class="op" id="7868035">;</span>&nbsp;<span class="ident" id="7868037">err</span>&nbsp;<span class="op" id="7868041">!=</span>&nbsp;<span class="ident" id="7868044">nil</span>&nbsp;<span class="op" id="7868048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868052">t</span><span class="op" id="7868053">.</span><span class="ident" id="7868054">Errorf</span><span class="op" id="7868060">(</span><span class="string" id="7868061">&#34;part&nbsp;3&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="7868078">,</span>&nbsp;<span class="ident" id="7868080">err</span><span class="op" id="7868083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868086">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868089">expectEq</span><span class="op" id="7868097">(</span><span class="ident" id="7868098">t</span><span class="op" id="7868099">,</span>&nbsp;<span class="ident" id="7868101">adjustNewlines</span><span class="op" id="7868115">(</span><span class="string" id="7868116">&#34;Line&nbsp;1\r\nLine&nbsp;2\r\nLine&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.\r\n&#34;</span><span class="op" id="7868181">)</span><span class="op" id="7868182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868186">buf</span><span class="op" id="7868189">.</span><span class="ident" id="7868190">String</span><span class="op" id="7868196">(</span><span class="op" id="7868197">)</span><span class="op" id="7868198">,</span>&nbsp;<span class="string" id="7868200">&#34;body&nbsp;of&nbsp;part&nbsp;3&#34;</span><span class="op" id="7868216">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7868220">//&nbsp;Part4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868230">part</span><span class="op" id="7868234">,</span>&nbsp;<span class="ident" id="7868236">err</span>&nbsp;<span class="op" id="7868240">=</span>&nbsp;<span class="ident" id="7868242">reader</span><span class="op" id="7868248">.</span><span class="ident" id="7868249">NextPart</span><span class="op" id="7868257">(</span><span class="op" id="7868258">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868261">if</span>&nbsp;<span class="ident" id="7868264">part</span>&nbsp;<span class="op" id="7868269">==</span>&nbsp;<span class="ident" id="7868272">nil</span>&nbsp;<span class="op" id="7868276">||</span>&nbsp;<span class="ident" id="7868279">err</span>&nbsp;<span class="op" id="7868283">!=</span>&nbsp;<span class="ident" id="7868286">nil</span>&nbsp;<span class="op" id="7868290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868294">t</span><span class="op" id="7868295">.</span><span class="ident" id="7868296">Error</span><span class="op" id="7868301">(</span><span class="string" id="7868302">&#34;Expected&nbsp;part&nbsp;4&nbsp;without&nbsp;errors&#34;</span><span class="op" id="7868334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868338">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7868350">//&nbsp;Non-existent&nbsp;part5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868373">part</span><span class="op" id="7868377">,</span>&nbsp;<span class="ident" id="7868379">err</span>&nbsp;<span class="op" id="7868383">=</span>&nbsp;<span class="ident" id="7868385">reader</span><span class="op" id="7868391">.</span><span class="ident" id="7868392">NextPart</span><span class="op" id="7868400">(</span><span class="op" id="7868401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868404">if</span>&nbsp;<span class="ident" id="7868407">part</span>&nbsp;<span class="op" id="7868412">!=</span>&nbsp;<span class="ident" id="7868415">nil</span>&nbsp;<span class="op" id="7868419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868423">t</span><span class="op" id="7868424">.</span><span class="ident" id="7868425">Error</span><span class="op" id="7868430">(</span><span class="string" id="7868431">&#34;Didn&#39;t&nbsp;expect&nbsp;a&nbsp;fifth&nbsp;part.&#34;</span><span class="op" id="7868460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868463">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868466">if</span>&nbsp;<span class="ident" id="7868469">err</span>&nbsp;<span class="op" id="7868473">!=</span>&nbsp;<span class="ident" id="7868476">io</span><span class="op" id="7868478">.</span><span class="ident" id="7868479">EOF</span>&nbsp;<span class="op" id="7868483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868487">t</span><span class="op" id="7868488">.</span><span class="ident" id="7868489">Errorf</span><span class="op" id="7868495">(</span><span class="string" id="7868496">&#34;On&nbsp;fifth&nbsp;part&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7868535">,</span>&nbsp;<span class="ident" id="7868537">err</span><span class="op" id="7868540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868543">}</span><br>
<span class="lineno"></span><span class="op" id="7868545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="7868548">func</span>&nbsp;<span class="ident" id="7868553">TestVariousTextLineEndings</span><span class="op" id="7868579">(</span><span class="ident" id="7868580">t</span>&nbsp;<span class="op" id="7868582">*</span><span class="ident" id="7868583">testing</span><span class="op" id="7868590">.</span><span class="ident" id="7868591">T</span><span class="op" id="7868592">)</span>&nbsp;<span class="op" id="7868594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868597">tests</span>&nbsp;<span class="op" id="7868603">:=</span>&nbsp;<span class="op" id="7868606">[</span><span class="op" id="7868607">...</span><span class="op" id="7868610">]</span><span class="builtintype" id="7868611">string</span><span class="op" id="7868617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7868621">&#34;Foo\nBar&#34;</span><span class="op" id="7868631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7868635">&#34;Foo\nBar\n&#34;</span><span class="op" id="7868647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7868651">&#34;Foo\r\nBar&#34;</span><span class="op" id="7868663">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7868667">&#34;Foo\r\nBar\r\n&#34;</span><span class="op" id="7868683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7868687">&#34;Foo\rBar&#34;</span><span class="op" id="7868697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7868701">&#34;Foo\rBar\r&#34;</span><span class="op" id="7868713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7868717">&#34;\x00\x01\x02\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10&#34;</span><span class="op" id="7868763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868766">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868770">for</span>&nbsp;<span class="ident" id="7868774">testNum</span><span class="op" id="7868781">,</span>&nbsp;<span class="ident" id="7868783">expectedBody</span>&nbsp;<span class="op" id="7868796">:=</span>&nbsp;<span class="keyword" id="7868799">range</span>&nbsp;<span class="ident" id="7868805">tests</span>&nbsp;<span class="op" id="7868811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868815">body</span>&nbsp;<span class="op" id="7868820">:=</span>&nbsp;<span class="string" id="7868823">&#34;--BOUNDARY\r\n&#34;</span>&nbsp;<span class="op" id="7868840">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7868845">&#34;Content-Disposition:&nbsp;form-data;&nbsp;name=\&#34;value\&#34;\r\n&#34;</span>&nbsp;<span class="op" id="7868898">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7868903">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="7868910">+</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868915">expectedBody</span>&nbsp;<span class="op" id="7868928">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7868933">&#34;\r\n--BOUNDARY--\r\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868958">bodyReader</span>&nbsp;<span class="op" id="7868969">:=</span>&nbsp;<span class="ident" id="7868972">strings</span><span class="op" id="7868979">.</span><span class="ident" id="7868980">NewReader</span><span class="op" id="7868989">(</span><span class="ident" id="7868990">body</span><span class="op" id="7868994">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868999">reader</span>&nbsp;<span class="op" id="7869006">:=</span>&nbsp;<span class="ident" id="7869009">NewReader</span><span class="op" id="7869018">(</span><span class="ident" id="7869019">bodyReader</span><span class="op" id="7869029">,</span>&nbsp;<span class="string" id="7869031">&#34;BOUNDARY&#34;</span><span class="op" id="7869041">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869045">buf</span>&nbsp;<span class="op" id="7869049">:=</span>&nbsp;<span class="builtinfunc" id="7869052">new</span><span class="op" id="7869055">(</span><span class="ident" id="7869056">bytes</span><span class="op" id="7869061">.</span><span class="ident" id="7869062">Buffer</span><span class="op" id="7869068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869072">part</span><span class="op" id="7869076">,</span>&nbsp;<span class="ident" id="7869078">err</span>&nbsp;<span class="op" id="7869082">:=</span>&nbsp;<span class="ident" id="7869085">reader</span><span class="op" id="7869091">.</span><span class="ident" id="7869092">NextPart</span><span class="op" id="7869100">(</span><span class="op" id="7869101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869105">if</span>&nbsp;<span class="ident" id="7869108">part</span>&nbsp;<span class="op" id="7869113">==</span>&nbsp;<span class="ident" id="7869116">nil</span>&nbsp;<span class="op" id="7869120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869125">t</span><span class="op" id="7869126">.</span><span class="ident" id="7869127">Errorf</span><span class="op" id="7869133">(</span><span class="string" id="7869134">&#34;Expected&nbsp;a&nbsp;body&nbsp;part&nbsp;on&nbsp;text&nbsp;%d&#34;</span><span class="op" id="7869167">,</span>&nbsp;<span class="ident" id="7869169">testNum</span><span class="op" id="7869176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869181">continue</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869196">if</span>&nbsp;<span class="ident" id="7869199">err</span>&nbsp;<span class="op" id="7869203">!=</span>&nbsp;<span class="ident" id="7869206">nil</span>&nbsp;<span class="op" id="7869210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869215">t</span><span class="op" id="7869216">.</span><span class="ident" id="7869217">Errorf</span><span class="op" id="7869223">(</span><span class="string" id="7869224">&#34;Unexpected&nbsp;error&nbsp;on&nbsp;text&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7869257">,</span>&nbsp;<span class="ident" id="7869259">testNum</span><span class="op" id="7869266">,</span>&nbsp;<span class="ident" id="7869268">err</span><span class="op" id="7869271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869276">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869287">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869291">written</span><span class="op" id="7869298">,</span>&nbsp;<span class="ident" id="7869300">err</span>&nbsp;<span class="op" id="7869304">:=</span>&nbsp;<span class="ident" id="7869307">io</span><span class="op" id="7869309">.</span><span class="ident" id="7869310">Copy</span><span class="op" id="7869314">(</span><span class="ident" id="7869315">buf</span><span class="op" id="7869318">,</span>&nbsp;<span class="ident" id="7869320">part</span><span class="op" id="7869324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869328">expectEq</span><span class="op" id="7869336">(</span><span class="ident" id="7869337">t</span><span class="op" id="7869338">,</span>&nbsp;<span class="ident" id="7869340">expectedBody</span><span class="op" id="7869352">,</span>&nbsp;<span class="ident" id="7869354">buf</span><span class="op" id="7869357">.</span><span class="ident" id="7869358">String</span><span class="op" id="7869364">(</span><span class="op" id="7869365">)</span><span class="op" id="7869366">,</span>&nbsp;<span class="ident" id="7869368">fmt</span><span class="op" id="7869371">.</span><span class="ident" id="7869372">Sprintf</span><span class="op" id="7869379">(</span><span class="string" id="7869380">&#34;test&nbsp;%d&#34;</span><span class="op" id="7869389">,</span>&nbsp;<span class="ident" id="7869391">testNum</span><span class="op" id="7869398">)</span><span class="op" id="7869399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869403">if</span>&nbsp;<span class="ident" id="7869406">err</span>&nbsp;<span class="op" id="7869410">!=</span>&nbsp;<span class="ident" id="7869413">nil</span>&nbsp;<span class="op" id="7869417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869422">t</span><span class="op" id="7869423">.</span><span class="ident" id="7869424">Errorf</span><span class="op" id="7869430">(</span><span class="string" id="7869431">&#34;Error&nbsp;copying&nbsp;multipart;&nbsp;bytes=%v,&nbsp;error=%v&#34;</span><span class="op" id="7869476">,</span>&nbsp;<span class="ident" id="7869478">written</span><span class="op" id="7869485">,</span>&nbsp;<span class="ident" id="7869487">err</span><span class="op" id="7869490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869494">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869499">part</span><span class="op" id="7869503">,</span>&nbsp;<span class="ident" id="7869505">err</span>&nbsp;<span class="op" id="7869509">=</span>&nbsp;<span class="ident" id="7869511">reader</span><span class="op" id="7869517">.</span><span class="ident" id="7869518">NextPart</span><span class="op" id="7869526">(</span><span class="op" id="7869527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869531">if</span>&nbsp;<span class="ident" id="7869534">part</span>&nbsp;<span class="op" id="7869539">!=</span>&nbsp;<span class="ident" id="7869542">nil</span>&nbsp;<span class="op" id="7869546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869551">t</span><span class="op" id="7869552">.</span><span class="ident" id="7869553">Errorf</span><span class="op" id="7869559">(</span><span class="string" id="7869560">&#34;Unexpected&nbsp;part&nbsp;in&nbsp;test&nbsp;%d&#34;</span><span class="op" id="7869588">,</span>&nbsp;<span class="ident" id="7869590">testNum</span><span class="op" id="7869597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869601">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869605">if</span>&nbsp;<span class="ident" id="7869608">err</span>&nbsp;<span class="op" id="7869612">!=</span>&nbsp;<span class="ident" id="7869615">io</span><span class="op" id="7869617">.</span><span class="ident" id="7869618">EOF</span>&nbsp;<span class="op" id="7869622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869627">t</span><span class="op" id="7869628">.</span><span class="ident" id="7869629">Errorf</span><span class="op" id="7869635">(</span><span class="string" id="7869636">&#34;On&nbsp;test&nbsp;%d&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7869672">,</span>&nbsp;<span class="ident" id="7869674">testNum</span><span class="op" id="7869681">,</span>&nbsp;<span class="ident" id="7869683">err</span><span class="op" id="7869686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869694">}</span><br>
<span class="lineno">260</span><span class="op" id="7869696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7869699">type</span>&nbsp;<span class="ident" id="7869704">maliciousReader</span>&nbsp;<span class="keyword" id="7869720">struct</span>&nbsp;<span class="op" id="7869727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869730">t</span>&nbsp;<span class="op" id="7869732">*</span><span class="ident" id="7869733">testing</span><span class="op" id="7869740">.</span><span class="ident" id="7869741">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869744">n</span>&nbsp;<span class="builtintype" id="7869746">int</span><br>
<span class="lineno">265</span><span class="op" id="7869750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7869753">const</span>&nbsp;<span class="ident" id="7869759">maxReadThreshold</span>&nbsp;<span class="op" id="7869776">=</span>&nbsp;<span class="num" id="7869778">1</span>&nbsp;<span class="op" id="7869780">&lt;&lt;</span>&nbsp;<span class="num" id="7869783">20</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7869787">func</span>&nbsp;<span class="op" id="7869792">(</span><span class="ident" id="7869793">mr</span>&nbsp;<span class="op" id="7869796">*</span><span class="ident" id="7869797">maliciousReader</span><span class="op" id="7869812">)</span>&nbsp;<span class="ident" id="7869814">Read</span><span class="op" id="7869818">(</span><span class="ident" id="7869819">b</span>&nbsp;<span class="op" id="7869821">[</span><span class="op" id="7869822">]</span><span class="builtintype" id="7869823">byte</span><span class="op" id="7869827">)</span>&nbsp;<span class="op" id="7869829">(</span><span class="ident" id="7869830">n</span>&nbsp;<span class="builtintype" id="7869832">int</span><span class="op" id="7869835">,</span>&nbsp;<span class="ident" id="7869837">err</span>&nbsp;<span class="builtintype" id="7869841">error</span><span class="op" id="7869846">)</span>&nbsp;<span class="op" id="7869848">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869851">mr</span><span class="op" id="7869853">.</span><span class="ident" id="7869854">n</span>&nbsp;<span class="op" id="7869856">+=</span>&nbsp;<span class="builtinfunc" id="7869859">len</span><span class="op" id="7869862">(</span><span class="ident" id="7869863">b</span><span class="op" id="7869864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869867">if</span>&nbsp;<span class="ident" id="7869870">mr</span><span class="op" id="7869872">.</span><span class="ident" id="7869873">n</span>&nbsp;<span class="op" id="7869875">&gt;=</span>&nbsp;<span class="ident" id="7869878">maxReadThreshold</span>&nbsp;<span class="op" id="7869895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869899">mr</span><span class="op" id="7869901">.</span><span class="ident" id="7869902">t</span><span class="op" id="7869903">.</span><span class="ident" id="7869904">Fatal</span><span class="op" id="7869909">(</span><span class="string" id="7869910">&#34;too&nbsp;much&nbsp;was&nbsp;read&#34;</span><span class="op" id="7869929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869933">return</span>&nbsp;<span class="num" id="7869940">0</span><span class="op" id="7869941">,</span>&nbsp;<span class="ident" id="7869943">io</span><span class="op" id="7869945">.</span><span class="ident" id="7869946">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869951">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869954">return</span>&nbsp;<span class="builtinfunc" id="7869961">len</span><span class="op" id="7869964">(</span><span class="ident" id="7869965">b</span><span class="op" id="7869966">)</span><span class="op" id="7869967">,</span>&nbsp;<span class="ident" id="7869969">nil</span><br>
<span class="lineno"></span><span class="op" id="7869973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7869976">func</span>&nbsp;<span class="ident" id="7869981">TestLineLimit</span><span class="op" id="7869994">(</span><span class="ident" id="7869995">t</span>&nbsp;<span class="op" id="7869997">*</span><span class="ident" id="7869998">testing</span><span class="op" id="7870005">.</span><span class="ident" id="7870006">T</span><span class="op" id="7870007">)</span>&nbsp;<span class="op" id="7870009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870012">mr</span>&nbsp;<span class="op" id="7870015">:=</span>&nbsp;<span class="op" id="7870018">&amp;</span><span class="ident" id="7870019">maliciousReader</span><span class="op" id="7870034">{</span><span class="ident" id="7870035">t</span><span class="op" id="7870036">:</span>&nbsp;<span class="ident" id="7870038">t</span><span class="op" id="7870039">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870042">r</span>&nbsp;<span class="op" id="7870044">:=</span>&nbsp;<span class="ident" id="7870047">NewReader</span><span class="op" id="7870056">(</span><span class="ident" id="7870057">mr</span><span class="op" id="7870059">,</span>&nbsp;<span class="string" id="7870061">&#34;fooBoundary&#34;</span><span class="op" id="7870074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870077">part</span><span class="op" id="7870081">,</span>&nbsp;<span class="ident" id="7870083">err</span>&nbsp;<span class="op" id="7870087">:=</span>&nbsp;<span class="ident" id="7870090">r</span><span class="op" id="7870091">.</span><span class="ident" id="7870092">NextPart</span><span class="op" id="7870100">(</span><span class="op" id="7870101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870104">if</span>&nbsp;<span class="ident" id="7870107">part</span>&nbsp;<span class="op" id="7870112">!=</span>&nbsp;<span class="ident" id="7870115">nil</span>&nbsp;<span class="op" id="7870119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870123">t</span><span class="op" id="7870124">.</span><span class="ident" id="7870125">Errorf</span><span class="op" id="7870131">(</span><span class="string" id="7870132">&#34;unexpected&nbsp;part&nbsp;read&#34;</span><span class="op" id="7870154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870157">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870160">if</span>&nbsp;<span class="ident" id="7870163">err</span>&nbsp;<span class="op" id="7870167">==</span>&nbsp;<span class="ident" id="7870170">nil</span>&nbsp;<span class="op" id="7870174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870178">t</span><span class="op" id="7870179">.</span><span class="ident" id="7870180">Errorf</span><span class="op" id="7870186">(</span><span class="string" id="7870187">&#34;expected&nbsp;an&nbsp;error&#34;</span><span class="op" id="7870206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870212">if</span>&nbsp;<span class="ident" id="7870215">mr</span><span class="op" id="7870217">.</span><span class="ident" id="7870218">n</span>&nbsp;<span class="op" id="7870220">&gt;=</span>&nbsp;<span class="ident" id="7870223">maxReadThreshold</span>&nbsp;<span class="op" id="7870240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870244">t</span><span class="op" id="7870245">.</span><span class="ident" id="7870246">Errorf</span><span class="op" id="7870252">(</span><span class="string" id="7870253">&#34;expected&nbsp;to&nbsp;read&nbsp;&lt;&nbsp;%d&nbsp;bytes;&nbsp;read&nbsp;%d&#34;</span><span class="op" id="7870291">,</span>&nbsp;<span class="ident" id="7870293">maxReadThreshold</span><span class="op" id="7870309">,</span>&nbsp;<span class="ident" id="7870311">mr</span><span class="op" id="7870313">.</span><span class="ident" id="7870314">n</span><span class="op" id="7870315">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870318">}</span><br>
<span class="lineno"></span><span class="op" id="7870320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7870323">func</span>&nbsp;<span class="ident" id="7870328">TestMultipartTruncated</span><span class="op" id="7870350">(</span><span class="ident" id="7870351">t</span>&nbsp;<span class="op" id="7870353">*</span><span class="ident" id="7870354">testing</span><span class="op" id="7870361">.</span><span class="ident" id="7870362">T</span><span class="op" id="7870363">)</span>&nbsp;<span class="op" id="7870365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870368">testBody</span>&nbsp;<span class="op" id="7870377">:=</span>&nbsp;<span class="string" id="7870380">`<br>
<span class="lineno">295</span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno"></span>Oh&nbsp;no,&nbsp;premature&nbsp;EOF!<br>
<span class="lineno">300</span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870487">body</span>&nbsp;<span class="op" id="7870492">:=</span>&nbsp;<span class="ident" id="7870495">strings</span><span class="op" id="7870502">.</span><span class="ident" id="7870503">Replace</span><span class="op" id="7870510">(</span><span class="ident" id="7870511">testBody</span><span class="op" id="7870519">,</span>&nbsp;<span class="string" id="7870521">&#34;\n&#34;</span><span class="op" id="7870525">,</span>&nbsp;<span class="string" id="7870527">&#34;\r\n&#34;</span><span class="op" id="7870533">,</span>&nbsp;<span class="op" id="7870535">-</span><span class="num" id="7870536">1</span><span class="op" id="7870537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870540">bodyReader</span>&nbsp;<span class="op" id="7870551">:=</span>&nbsp;<span class="ident" id="7870554">strings</span><span class="op" id="7870561">.</span><span class="ident" id="7870562">NewReader</span><span class="op" id="7870571">(</span><span class="ident" id="7870572">body</span><span class="op" id="7870576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870579">r</span>&nbsp;<span class="op" id="7870581">:=</span>&nbsp;<span class="ident" id="7870584">NewReader</span><span class="op" id="7870593">(</span><span class="ident" id="7870594">bodyReader</span><span class="op" id="7870604">,</span>&nbsp;<span class="string" id="7870606">&#34;MyBoundary&#34;</span><span class="op" id="7870618">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870622">part</span><span class="op" id="7870626">,</span>&nbsp;<span class="ident" id="7870628">err</span>&nbsp;<span class="op" id="7870632">:=</span>&nbsp;<span class="ident" id="7870635">r</span><span class="op" id="7870636">.</span><span class="ident" id="7870637">NextPart</span><span class="op" id="7870645">(</span><span class="op" id="7870646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870649">if</span>&nbsp;<span class="ident" id="7870652">err</span>&nbsp;<span class="op" id="7870656">!=</span>&nbsp;<span class="ident" id="7870659">nil</span>&nbsp;<span class="op" id="7870663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870667">t</span><span class="op" id="7870668">.</span><span class="ident" id="7870669">Fatalf</span><span class="op" id="7870675">(</span><span class="string" id="7870676">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="7870695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870701">_</span><span class="op" id="7870702">,</span>&nbsp;<span class="ident" id="7870704">err</span>&nbsp;<span class="op" id="7870708">=</span>&nbsp;<span class="ident" id="7870710">io</span><span class="op" id="7870712">.</span><span class="ident" id="7870713">Copy</span><span class="op" id="7870717">(</span><span class="ident" id="7870718">ioutil</span><span class="op" id="7870724">.</span><span class="ident" id="7870725">Discard</span><span class="op" id="7870732">,</span>&nbsp;<span class="ident" id="7870734">part</span><span class="op" id="7870738">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870741">if</span>&nbsp;<span class="ident" id="7870744">err</span>&nbsp;<span class="op" id="7870748">!=</span>&nbsp;<span class="ident" id="7870751">io</span><span class="op" id="7870753">.</span><span class="ident" id="7870754">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7870771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870775">t</span><span class="op" id="7870776">.</span><span class="ident" id="7870777">Fatalf</span><span class="op" id="7870783">(</span><span class="string" id="7870784">&#34;expected&nbsp;error&nbsp;io.ErrUnexpectedEOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7870828">,</span>&nbsp;<span class="ident" id="7870830">err</span><span class="op" id="7870833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870836">}</span><br>
<span class="lineno"></span><span class="op" id="7870838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="7870841">type</span>&nbsp;<span class="ident" id="7870846">slowReader</span>&nbsp;<span class="keyword" id="7870857">struct</span>&nbsp;<span class="op" id="7870864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870867">r</span>&nbsp;<span class="ident" id="7870869">io</span><span class="op" id="7870871">.</span><span class="ident" id="7870872">Reader</span><br>
<span class="lineno"></span><span class="op" id="7870879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7870882">func</span>&nbsp;<span class="op" id="7870887">(</span><span class="ident" id="7870888">s</span>&nbsp;<span class="op" id="7870890">*</span><span class="ident" id="7870891">slowReader</span><span class="op" id="7870901">)</span>&nbsp;<span class="ident" id="7870903">Read</span><span class="op" id="7870907">(</span><span class="ident" id="7870908">p</span>&nbsp;<span class="op" id="7870910">[</span><span class="op" id="7870911">]</span><span class="builtintype" id="7870912">byte</span><span class="op" id="7870916">)</span>&nbsp;<span class="op" id="7870918">(</span><span class="builtintype" id="7870919">int</span><span class="op" id="7870922">,</span>&nbsp;<span class="builtintype" id="7870924">error</span><span class="op" id="7870929">)</span>&nbsp;<span class="op" id="7870931">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870934">if</span>&nbsp;<span class="builtinfunc" id="7870937">len</span><span class="op" id="7870940">(</span><span class="ident" id="7870941">p</span><span class="op" id="7870942">)</span>&nbsp;<span class="op" id="7870944">==</span>&nbsp;<span class="num" id="7870947">0</span>&nbsp;<span class="op" id="7870949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870953">return</span>&nbsp;<span class="ident" id="7870960">s</span><span class="op" id="7870961">.</span><span class="ident" id="7870962">r</span><span class="op" id="7870963">.</span><span class="ident" id="7870964">Read</span><span class="op" id="7870968">(</span><span class="ident" id="7870969">p</span><span class="op" id="7870970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870976">return</span>&nbsp;<span class="ident" id="7870983">s</span><span class="op" id="7870984">.</span><span class="ident" id="7870985">r</span><span class="op" id="7870986">.</span><span class="ident" id="7870987">Read</span><span class="op" id="7870991">(</span><span class="ident" id="7870992">p</span><span class="op" id="7870993">[</span><span class="op" id="7870994">:</span><span class="num" id="7870995">1</span><span class="op" id="7870996">]</span><span class="op" id="7870997">)</span><br>
<span class="lineno"></span><span class="op" id="7870999">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="7871002">func</span>&nbsp;<span class="ident" id="7871007">TestLineContinuation</span><span class="op" id="7871027">(</span><span class="ident" id="7871028">t</span>&nbsp;<span class="op" id="7871030">*</span><span class="ident" id="7871031">testing</span><span class="op" id="7871038">.</span><span class="ident" id="7871039">T</span><span class="op" id="7871040">)</span>&nbsp;<span class="op" id="7871042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7871045">//&nbsp;This&nbsp;body,&nbsp;extracted&nbsp;from&nbsp;an&nbsp;email,&nbsp;contains&nbsp;headers&nbsp;that&nbsp;span&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7871121">//&nbsp;lines.</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7871133">//&nbsp;TODO:&nbsp;The&nbsp;original&nbsp;mail&nbsp;ended&nbsp;with&nbsp;a&nbsp;double-newline&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7871200">//&nbsp;final&nbsp;delimiter;&nbsp;this&nbsp;was&nbsp;manually&nbsp;edited&nbsp;to&nbsp;use&nbsp;a&nbsp;CRLF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871261">testBody</span>&nbsp;<span class="op" id="7871270">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7871275">&#34;\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;7bit\nContent-Type:&nbsp;text/plain;\n\tcharset=US-ASCII;\n\tdelsp=yes;\n\tformat=flowed\n\nI&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;happening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).\n\n\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;quoted-printable\nContent-Type:&nbsp;text/html;\n\tcharset=ISO-8859-1\n\n&lt;HTML&gt;&lt;BODY&gt;I&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;=\nhappening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).=A0&nbsp;But&nbsp;I&nbsp;built&nbsp;it&nbsp;with&nbsp;XCode&nbsp;=\n2.0.&lt;/BODY&gt;&lt;/=\nHTML&gt;=\n\r\n--Apple-Mail-2-292336769--\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871771">r</span>&nbsp;<span class="op" id="7871773">:=</span>&nbsp;<span class="ident" id="7871776">NewReader</span><span class="op" id="7871785">(</span><span class="ident" id="7871786">strings</span><span class="op" id="7871793">.</span><span class="ident" id="7871794">NewReader</span><span class="op" id="7871803">(</span><span class="ident" id="7871804">testBody</span><span class="op" id="7871812">)</span><span class="op" id="7871813">,</span>&nbsp;<span class="string" id="7871815">&#34;Apple-Mail-2-292336769&#34;</span><span class="op" id="7871839">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871843">for</span>&nbsp;<span class="ident" id="7871847">i</span>&nbsp;<span class="op" id="7871849">:=</span>&nbsp;<span class="num" id="7871852">0</span><span class="op" id="7871853">;</span>&nbsp;<span class="ident" id="7871855">i</span>&nbsp;<span class="op" id="7871857">&lt;</span>&nbsp;<span class="num" id="7871859">2</span><span class="op" id="7871860">;</span>&nbsp;<span class="ident" id="7871862">i</span><span class="op" id="7871863">++</span>&nbsp;<span class="op" id="7871866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871870">part</span><span class="op" id="7871874">,</span>&nbsp;<span class="ident" id="7871876">err</span>&nbsp;<span class="op" id="7871880">:=</span>&nbsp;<span class="ident" id="7871883">r</span><span class="op" id="7871884">.</span><span class="ident" id="7871885">NextPart</span><span class="op" id="7871893">(</span><span class="op" id="7871894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871898">if</span>&nbsp;<span class="ident" id="7871901">err</span>&nbsp;<span class="op" id="7871905">!=</span>&nbsp;<span class="ident" id="7871908">nil</span>&nbsp;<span class="op" id="7871912">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871917">t</span><span class="op" id="7871918">.</span><span class="ident" id="7871919">Fatalf</span><span class="op" id="7871925">(</span><span class="string" id="7871926">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="7871945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871953">var</span>&nbsp;<span class="ident" id="7871957">buf</span>&nbsp;<span class="ident" id="7871961">bytes</span><span class="op" id="7871966">.</span><span class="ident" id="7871967">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871976">n</span><span class="op" id="7871977">,</span>&nbsp;<span class="ident" id="7871979">err</span>&nbsp;<span class="op" id="7871983">:=</span>&nbsp;<span class="ident" id="7871986">io</span><span class="op" id="7871988">.</span><span class="ident" id="7871989">Copy</span><span class="op" id="7871993">(</span><span class="op" id="7871994">&amp;</span><span class="ident" id="7871995">buf</span><span class="op" id="7871998">,</span>&nbsp;<span class="ident" id="7872000">part</span><span class="op" id="7872004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872008">if</span>&nbsp;<span class="ident" id="7872011">err</span>&nbsp;<span class="op" id="7872015">!=</span>&nbsp;<span class="ident" id="7872018">nil</span>&nbsp;<span class="op" id="7872022">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872027">t</span><span class="op" id="7872028">.</span><span class="ident" id="7872029">Errorf</span><span class="op" id="7872035">(</span><span class="string" id="7872036">&#34;error&nbsp;reading&nbsp;part:&nbsp;%v\nread&nbsp;so&nbsp;far:&nbsp;%q&#34;</span><span class="op" id="7872077">,</span>&nbsp;<span class="ident" id="7872079">err</span><span class="op" id="7872082">,</span>&nbsp;<span class="ident" id="7872084">buf</span><span class="op" id="7872087">.</span><span class="ident" id="7872088">String</span><span class="op" id="7872094">(</span><span class="op" id="7872095">)</span><span class="op" id="7872096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872104">if</span>&nbsp;<span class="ident" id="7872107">n</span>&nbsp;<span class="op" id="7872109">&lt;=</span>&nbsp;<span class="num" id="7872112">0</span>&nbsp;<span class="op" id="7872114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872119">t</span><span class="op" id="7872120">.</span><span class="ident" id="7872121">Errorf</span><span class="op" id="7872127">(</span><span class="string" id="7872128">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;expected&nbsp;&gt;0&#34;</span><span class="op" id="7872156">,</span>&nbsp;<span class="ident" id="7872158">n</span><span class="op" id="7872159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872163">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872166">}</span><br>
<span class="lineno"></span><span class="op" id="7872168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7872171">func</span>&nbsp;<span class="ident" id="7872176">TestQuotedPrintableEncoding</span><span class="op" id="7872203">(</span><span class="ident" id="7872204">t</span>&nbsp;<span class="op" id="7872206">*</span><span class="ident" id="7872207">testing</span><span class="op" id="7872214">.</span><span class="ident" id="7872215">T</span><span class="op" id="7872216">)</span>&nbsp;<span class="op" id="7872218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7872221">//&nbsp;From&nbsp;http://golang.org/issue/4411</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872259">body</span>&nbsp;<span class="op" id="7872264">:=</span>&nbsp;<span class="string" id="7872267">&#34;--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=text\r\nContent-Transfer-Encoding:&nbsp;quoted-printable\r\n\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words\r\n--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--0016e68ee29c5d515f04cedf6733--&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873001">r</span>&nbsp;<span class="op" id="7873003">:=</span>&nbsp;<span class="ident" id="7873006">NewReader</span><span class="op" id="7873015">(</span><span class="ident" id="7873016">strings</span><span class="op" id="7873023">.</span><span class="ident" id="7873024">NewReader</span><span class="op" id="7873033">(</span><span class="ident" id="7873034">body</span><span class="op" id="7873038">)</span><span class="op" id="7873039">,</span>&nbsp;<span class="string" id="7873041">&#34;0016e68ee29c5d515f04cedf6733&#34;</span><span class="op" id="7873071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873074">part</span><span class="op" id="7873078">,</span>&nbsp;<span class="ident" id="7873080">err</span>&nbsp;<span class="op" id="7873084">:=</span>&nbsp;<span class="ident" id="7873087">r</span><span class="op" id="7873088">.</span><span class="ident" id="7873089">NextPart</span><span class="op" id="7873097">(</span><span class="op" id="7873098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873101">if</span>&nbsp;<span class="ident" id="7873104">err</span>&nbsp;<span class="op" id="7873108">!=</span>&nbsp;<span class="ident" id="7873111">nil</span>&nbsp;<span class="op" id="7873115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873119">t</span><span class="op" id="7873120">.</span><span class="ident" id="7873121">Fatal</span><span class="op" id="7873126">(</span><span class="ident" id="7873127">err</span><span class="op" id="7873130">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7873133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873136">if</span>&nbsp;<span class="ident" id="7873139">te</span><span class="op" id="7873141">,</span>&nbsp;<span class="ident" id="7873143">ok</span>&nbsp;<span class="op" id="7873146">:=</span>&nbsp;<span class="ident" id="7873149">part</span><span class="op" id="7873153">.</span><span class="ident" id="7873154">Header</span><span class="op" id="7873160">[</span><span class="string" id="7873161">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="7873188">]</span><span class="op" id="7873189">;</span>&nbsp;<span class="ident" id="7873191">ok</span>&nbsp;<span class="op" id="7873194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873198">t</span><span class="op" id="7873199">.</span><span class="ident" id="7873200">Errorf</span><span class="op" id="7873206">(</span><span class="string" id="7873207">&#34;unexpected&nbsp;Content-Transfer-Encoding&nbsp;of&nbsp;%q&#34;</span><span class="op" id="7873251">,</span>&nbsp;<span class="ident" id="7873253">te</span><span class="op" id="7873255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7873258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873261">var</span>&nbsp;<span class="ident" id="7873265">buf</span>&nbsp;<span class="ident" id="7873269">bytes</span><span class="op" id="7873274">.</span><span class="ident" id="7873275">Buffer</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873283">_</span><span class="op" id="7873284">,</span>&nbsp;<span class="ident" id="7873286">err</span>&nbsp;<span class="op" id="7873290">=</span>&nbsp;<span class="ident" id="7873292">io</span><span class="op" id="7873294">.</span><span class="ident" id="7873295">Copy</span><span class="op" id="7873299">(</span><span class="op" id="7873300">&amp;</span><span class="ident" id="7873301">buf</span><span class="op" id="7873304">,</span>&nbsp;<span class="ident" id="7873306">part</span><span class="op" id="7873310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873313">if</span>&nbsp;<span class="ident" id="7873316">err</span>&nbsp;<span class="op" id="7873320">!=</span>&nbsp;<span class="ident" id="7873323">nil</span>&nbsp;<span class="op" id="7873327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873331">t</span><span class="op" id="7873332">.</span><span class="ident" id="7873333">Error</span><span class="op" id="7873338">(</span><span class="ident" id="7873339">err</span><span class="op" id="7873342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7873345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873348">got</span>&nbsp;<span class="op" id="7873352">:=</span>&nbsp;<span class="ident" id="7873355">buf</span><span class="op" id="7873358">.</span><span class="ident" id="7873359">String</span><span class="op" id="7873365">(</span><span class="op" id="7873366">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873369">want</span>&nbsp;<span class="op" id="7873374">:=</span>&nbsp;<span class="string" id="7873377">&#34;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873734">if</span>&nbsp;<span class="ident" id="7873737">got</span>&nbsp;<span class="op" id="7873741">!=</span>&nbsp;<span class="ident" id="7873744">want</span>&nbsp;<span class="op" id="7873749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873753">t</span><span class="op" id="7873754">.</span><span class="ident" id="7873755">Errorf</span><span class="op" id="7873761">(</span><span class="string" id="7873762">&#34;wrong&nbsp;part&nbsp;value:\n&nbsp;got:&nbsp;%q\nwant:&nbsp;%q&#34;</span><span class="op" id="7873801">,</span>&nbsp;<span class="ident" id="7873803">got</span><span class="op" id="7873806">,</span>&nbsp;<span class="ident" id="7873808">want</span><span class="op" id="7873812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7873815">}</span><br>
<span class="lineno"></span><span class="op" id="7873817">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="7873820">//&nbsp;Test&nbsp;parsing&nbsp;an&nbsp;image&nbsp;attachment&nbsp;from&nbsp;gmail,&nbsp;which&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="7873893">func</span>&nbsp;<span class="ident" id="7873898">TestNested</span><span class="op" id="7873908">(</span><span class="ident" id="7873909">t</span>&nbsp;<span class="op" id="7873911">*</span><span class="ident" id="7873912">testing</span><span class="op" id="7873919">.</span><span class="ident" id="7873920">T</span><span class="op" id="7873921">)</span>&nbsp;<span class="op" id="7873923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7873926">//&nbsp;nested-mime&nbsp;is&nbsp;the&nbsp;body&nbsp;part&nbsp;of&nbsp;a&nbsp;multipart/mixed&nbsp;email</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7873986">//&nbsp;with&nbsp;boundary&nbsp;e89a8ff1c1e83553e304be640612</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874033">f</span><span class="op" id="7874034">,</span>&nbsp;<span class="ident" id="7874036">err</span>&nbsp;<span class="op" id="7874040">:=</span>&nbsp;<span class="ident" id="7874043">os</span><span class="op" id="7874045">.</span><span class="ident" id="7874046">Open</span><span class="op" id="7874050">(</span><span class="string" id="7874051">&#34;testdata/nested-mime&#34;</span><span class="op" id="7874073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874076">if</span>&nbsp;<span class="ident" id="7874079">err</span>&nbsp;<span class="op" id="7874083">!=</span>&nbsp;<span class="ident" id="7874086">nil</span>&nbsp;<span class="op" id="7874090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874094">t</span><span class="op" id="7874095">.</span><span class="ident" id="7874096">Fatal</span><span class="op" id="7874101">(</span><span class="ident" id="7874102">err</span><span class="op" id="7874105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7874108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874111">defer</span>&nbsp;<span class="ident" id="7874117">f</span><span class="op" id="7874118">.</span><span class="ident" id="7874119">Close</span><span class="op" id="7874124">(</span><span class="op" id="7874125">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874128">mr</span>&nbsp;<span class="op" id="7874131">:=</span>&nbsp;<span class="ident" id="7874134">NewReader</span><span class="op" id="7874143">(</span><span class="ident" id="7874144">f</span><span class="op" id="7874145">,</span>&nbsp;<span class="string" id="7874147">&#34;e89a8ff1c1e83553e304be640612&#34;</span><span class="op" id="7874177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874180">p</span><span class="op" id="7874181">,</span>&nbsp;<span class="ident" id="7874183">err</span>&nbsp;<span class="op" id="7874187">:=</span>&nbsp;<span class="ident" id="7874190">mr</span><span class="op" id="7874192">.</span><span class="ident" id="7874193">NextPart</span><span class="op" id="7874201">(</span><span class="op" id="7874202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874205">if</span>&nbsp;<span class="ident" id="7874208">err</span>&nbsp;<span class="op" id="7874212">!=</span>&nbsp;<span class="ident" id="7874215">nil</span>&nbsp;<span class="op" id="7874219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874223">t</span><span class="op" id="7874224">.</span><span class="ident" id="7874225">Fatalf</span><span class="op" id="7874231">(</span><span class="string" id="7874232">&#34;error&nbsp;reading&nbsp;first&nbsp;section&nbsp;(alternative):&nbsp;%v&#34;</span><span class="op" id="7874279">,</span>&nbsp;<span class="ident" id="7874281">err</span><span class="op" id="7874284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7874287">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7874291">//&nbsp;Read&nbsp;the&nbsp;inner&nbsp;text/plain&nbsp;and&nbsp;text/html&nbsp;sections&nbsp;of&nbsp;the&nbsp;multipart/alternative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874374">mr2</span>&nbsp;<span class="op" id="7874378">:=</span>&nbsp;<span class="ident" id="7874381">NewReader</span><span class="op" id="7874390">(</span><span class="ident" id="7874391">p</span><span class="op" id="7874392">,</span>&nbsp;<span class="string" id="7874394">&#34;e89a8ff1c1e83553e004be640610&#34;</span><span class="op" id="7874424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874427">p</span><span class="op" id="7874428">,</span>&nbsp;<span class="ident" id="7874430">err</span>&nbsp;<span class="op" id="7874434">=</span>&nbsp;<span class="ident" id="7874436">mr2</span><span class="op" id="7874439">.</span><span class="ident" id="7874440">NextPart</span><span class="op" id="7874448">(</span><span class="op" id="7874449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874452">if</span>&nbsp;<span class="ident" id="7874455">err</span>&nbsp;<span class="op" id="7874459">!=</span>&nbsp;<span class="ident" id="7874462">nil</span>&nbsp;<span class="op" id="7874466">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874470">t</span><span class="op" id="7874471">.</span><span class="ident" id="7874472">Fatalf</span><span class="op" id="7874478">(</span><span class="string" id="7874479">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="7874508">,</span>&nbsp;<span class="ident" id="7874510">err</span><span class="op" id="7874513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7874516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874519">if</span>&nbsp;<span class="ident" id="7874522">b</span><span class="op" id="7874523">,</span>&nbsp;<span class="ident" id="7874525">err</span>&nbsp;<span class="op" id="7874529">:=</span>&nbsp;<span class="ident" id="7874532">ioutil</span><span class="op" id="7874538">.</span><span class="ident" id="7874539">ReadAll</span><span class="op" id="7874546">(</span><span class="ident" id="7874547">p</span><span class="op" id="7874548">)</span><span class="op" id="7874549">;</span>&nbsp;<span class="builtintype" id="7874551">string</span><span class="op" id="7874557">(</span><span class="ident" id="7874558">b</span><span class="op" id="7874559">)</span>&nbsp;<span class="op" id="7874561">!=</span>&nbsp;<span class="string" id="7874564">&#34;*body*\r\n&#34;</span>&nbsp;<span class="op" id="7874577">||</span>&nbsp;<span class="ident" id="7874580">err</span>&nbsp;<span class="op" id="7874584">!=</span>&nbsp;<span class="ident" id="7874587">nil</span>&nbsp;<span class="op" id="7874591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874595">t</span><span class="op" id="7874596">.</span><span class="ident" id="7874597">Fatalf</span><span class="op" id="7874603">(</span><span class="string" id="7874604">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7874641">,</span>&nbsp;<span class="ident" id="7874643">b</span><span class="op" id="7874644">,</span>&nbsp;<span class="ident" id="7874646">err</span><span class="op" id="7874649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7874652">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874655">p</span><span class="op" id="7874656">,</span>&nbsp;<span class="ident" id="7874658">err</span>&nbsp;<span class="op" id="7874662">=</span>&nbsp;<span class="ident" id="7874664">mr2</span><span class="op" id="7874667">.</span><span class="ident" id="7874668">NextPart</span><span class="op" id="7874676">(</span><span class="op" id="7874677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874680">if</span>&nbsp;<span class="ident" id="7874683">err</span>&nbsp;<span class="op" id="7874687">!=</span>&nbsp;<span class="ident" id="7874690">nil</span>&nbsp;<span class="op" id="7874694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874698">t</span><span class="op" id="7874699">.</span><span class="ident" id="7874700">Fatalf</span><span class="op" id="7874706">(</span><span class="string" id="7874707">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="7874735">,</span>&nbsp;<span class="ident" id="7874737">err</span><span class="op" id="7874740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7874743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874746">if</span>&nbsp;<span class="ident" id="7874749">b</span><span class="op" id="7874750">,</span>&nbsp;<span class="ident" id="7874752">err</span>&nbsp;<span class="op" id="7874756">:=</span>&nbsp;<span class="ident" id="7874759">ioutil</span><span class="op" id="7874765">.</span><span class="ident" id="7874766">ReadAll</span><span class="op" id="7874773">(</span><span class="ident" id="7874774">p</span><span class="op" id="7874775">)</span><span class="op" id="7874776">;</span>&nbsp;<span class="builtintype" id="7874778">string</span><span class="op" id="7874784">(</span><span class="ident" id="7874785">b</span><span class="op" id="7874786">)</span>&nbsp;<span class="op" id="7874788">!=</span>&nbsp;<span class="string" id="7874791">&#34;&lt;b&gt;body&lt;/b&gt;\r\n&#34;</span>&nbsp;<span class="op" id="7874809">||</span>&nbsp;<span class="ident" id="7874812">err</span>&nbsp;<span class="op" id="7874816">!=</span>&nbsp;<span class="ident" id="7874819">nil</span>&nbsp;<span class="op" id="7874823">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874827">t</span><span class="op" id="7874828">.</span><span class="ident" id="7874829">Fatalf</span><span class="op" id="7874835">(</span><span class="string" id="7874836">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7874872">,</span>&nbsp;<span class="ident" id="7874874">b</span><span class="op" id="7874875">,</span>&nbsp;<span class="ident" id="7874877">err</span><span class="op" id="7874880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7874883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874887">p</span><span class="op" id="7874888">,</span>&nbsp;<span class="ident" id="7874890">err</span>&nbsp;<span class="op" id="7874894">=</span>&nbsp;<span class="ident" id="7874896">mr2</span><span class="op" id="7874899">.</span><span class="ident" id="7874900">NextPart</span><span class="op" id="7874908">(</span><span class="op" id="7874909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874912">if</span>&nbsp;<span class="ident" id="7874915">err</span>&nbsp;<span class="op" id="7874919">!=</span>&nbsp;<span class="ident" id="7874922">io</span><span class="op" id="7874924">.</span><span class="ident" id="7874925">EOF</span>&nbsp;<span class="op" id="7874929">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874933">t</span><span class="op" id="7874934">.</span><span class="ident" id="7874935">Fatalf</span><span class="op" id="7874941">(</span><span class="string" id="7874942">&#34;final&nbsp;inner&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="7874982">,</span>&nbsp;<span class="ident" id="7874984">err</span><span class="op" id="7874987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7874990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7874994">//&nbsp;Back&nbsp;to&nbsp;the&nbsp;outer&nbsp;multipart/mixed,&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875063">_</span><span class="op" id="7875064">,</span>&nbsp;<span class="ident" id="7875066">err</span>&nbsp;<span class="op" id="7875070">=</span>&nbsp;<span class="ident" id="7875072">mr</span><span class="op" id="7875074">.</span><span class="ident" id="7875075">NextPart</span><span class="op" id="7875083">(</span><span class="op" id="7875084">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7875087">if</span>&nbsp;<span class="ident" id="7875090">err</span>&nbsp;<span class="op" id="7875094">!=</span>&nbsp;<span class="ident" id="7875097">nil</span>&nbsp;<span class="op" id="7875101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875105">t</span><span class="op" id="7875106">.</span><span class="ident" id="7875107">Fatalf</span><span class="op" id="7875113">(</span><span class="string" id="7875114">&#34;error&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment&nbsp;at&nbsp;the&nbsp;end:&nbsp;%v&#34;</span><span class="op" id="7875165">,</span>&nbsp;<span class="ident" id="7875167">err</span><span class="op" id="7875170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7875173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875177">_</span><span class="op" id="7875178">,</span>&nbsp;<span class="ident" id="7875180">err</span>&nbsp;<span class="op" id="7875184">=</span>&nbsp;<span class="ident" id="7875186">mr</span><span class="op" id="7875188">.</span><span class="ident" id="7875189">NextPart</span><span class="op" id="7875197">(</span><span class="op" id="7875198">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7875201">if</span>&nbsp;<span class="ident" id="7875204">err</span>&nbsp;<span class="op" id="7875208">!=</span>&nbsp;<span class="ident" id="7875211">io</span><span class="op" id="7875213">.</span><span class="ident" id="7875214">EOF</span>&nbsp;<span class="op" id="7875218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875222">t</span><span class="op" id="7875223">.</span><span class="ident" id="7875224">Fatalf</span><span class="op" id="7875230">(</span><span class="string" id="7875231">&#34;final&nbsp;outer&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="7875271">,</span>&nbsp;<span class="ident" id="7875273">err</span><span class="op" id="7875276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7875279">}</span><br>
<span class="lineno"></span><span class="op" id="7875281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span><span class="keyword" id="7875284">type</span>&nbsp;<span class="ident" id="7875289">headerBody</span>&nbsp;<span class="keyword" id="7875300">struct</span>&nbsp;<span class="op" id="7875307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875310">header</span>&nbsp;<span class="ident" id="7875317">textproto</span><span class="op" id="7875326">.</span><span class="ident" id="7875327">MIMEHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875339">body</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7875346">string</span><br>
<span class="lineno"></span><span class="op" id="7875353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="7875356">func</span>&nbsp;<span class="ident" id="7875361">formData</span><span class="op" id="7875369">(</span><span class="ident" id="7875370">key</span><span class="op" id="7875373">,</span>&nbsp;<span class="ident" id="7875375">value</span>&nbsp;<span class="builtintype" id="7875381">string</span><span class="op" id="7875387">)</span>&nbsp;<span class="ident" id="7875389">headerBody</span>&nbsp;<span class="op" id="7875400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7875403">return</span>&nbsp;<span class="ident" id="7875410">headerBody</span><span class="op" id="7875420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875424">textproto</span><span class="op" id="7875433">.</span><span class="ident" id="7875434">MIMEHeader</span><span class="op" id="7875444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7875449">&#34;Content-Type&#34;</span><span class="op" id="7875463">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7875472">{</span><span class="string" id="7875473">&#34;text/plain;&nbsp;charset=ISO-8859-1&#34;</span><span class="op" id="7875505">}</span><span class="op" id="7875506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7875511">&#34;Content-Disposition&#34;</span><span class="op" id="7875532">:</span>&nbsp;<span class="op" id="7875534">{</span><span class="string" id="7875535">&#34;form-data;&nbsp;name=&#34;</span>&nbsp;<span class="op" id="7875554">+</span>&nbsp;<span class="ident" id="7875556">key</span><span class="op" id="7875559">}</span><span class="op" id="7875560">,</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7875564">}</span><span class="op" id="7875565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875569">value</span><span class="op" id="7875574">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7875577">}</span><br>
<span class="lineno"></span><span class="op" id="7875579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="keyword" id="7875582">type</span>&nbsp;<span class="ident" id="7875587">parseTest</span>&nbsp;<span class="keyword" id="7875597">struct</span>&nbsp;<span class="op" id="7875604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875607">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7875615">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875623">in</span><span class="op" id="7875625">,</span>&nbsp;<span class="ident" id="7875627">sep</span>&nbsp;<span class="builtintype" id="7875631">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875639">want</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7875647">[</span><span class="op" id="7875648">]</span><span class="ident" id="7875649">headerBody</span><br>
<span class="lineno"></span><span class="op" id="7875660">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="7875663">var</span>&nbsp;<span class="ident" id="7875667">parseTests</span>&nbsp;<span class="op" id="7875678">=</span>&nbsp;<span class="op" id="7875680">[</span><span class="op" id="7875681">]</span><span class="ident" id="7875682">parseTest</span><span class="op" id="7875691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7875694">//&nbsp;Actual&nbsp;body&nbsp;from&nbsp;App&nbsp;Engine&nbsp;on&nbsp;a&nbsp;blob&nbsp;upload.&nbsp;The&nbsp;final&nbsp;part&nbsp;(the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7875764">//&nbsp;Content-Type:&nbsp;message/external-body)&nbsp;is&nbsp;what&nbsp;App&nbsp;Engine&nbsp;replaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7875833">//&nbsp;the&nbsp;uploaded&nbsp;file&nbsp;with.&nbsp;&nbsp;The&nbsp;other&nbsp;form&nbsp;fields&nbsp;(prefixed&nbsp;with</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7875899">//&nbsp;&#34;other&#34;&nbsp;in&nbsp;their&nbsp;form-data&nbsp;name)&nbsp;are&nbsp;unchanged.&nbsp;&nbsp;A&nbsp;bug&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7875962">//&nbsp;reported&nbsp;with&nbsp;blob&nbsp;uploads&nbsp;failing&nbsp;when&nbsp;the&nbsp;other&nbsp;fields&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7876028">//&nbsp;empty.&nbsp;This&nbsp;was&nbsp;the&nbsp;MIME&nbsp;POST&nbsp;body&nbsp;that&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7876091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7876095">name</span><span class="op" id="7876099">:</span>&nbsp;<span class="string" id="7876101">&#34;App&nbsp;Engine&nbsp;post&#34;</span><span class="op" id="7876118">,</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7876122">sep</span><span class="op" id="7876125">:</span>&nbsp;&nbsp;<span class="string" id="7876128">&#34;00151757727e9583fd04bfbca4c6&#34;</span><span class="op" id="7876158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7876162">in</span><span class="op" id="7876164">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7876168">&#34;--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty1\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo1\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo2\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty2\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\nContent-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n\r\n--00151757727e9583fd04bfbca4c6--&#34;</span><span class="op" id="7878076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7878080">want</span><span class="op" id="7878084">:</span>&nbsp;<span class="op" id="7878086">[</span><span class="op" id="7878087">]</span><span class="ident" id="7878088">headerBody</span><span class="op" id="7878098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7878103">formData</span><span class="op" id="7878111">(</span><span class="string" id="7878112">&#34;otherEmpty1&#34;</span><span class="op" id="7878125">,</span>&nbsp;<span class="string" id="7878127">&#34;&#34;</span><span class="op" id="7878129">)</span><span class="op" id="7878130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7878135">formData</span><span class="op" id="7878143">(</span><span class="string" id="7878144">&#34;otherFoo1&#34;</span><span class="op" id="7878155">,</span>&nbsp;<span class="string" id="7878157">&#34;foo&#34;</span><span class="op" id="7878162">)</span><span class="op" id="7878163">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7878168">formData</span><span class="op" id="7878176">(</span><span class="string" id="7878177">&#34;otherFoo2&#34;</span><span class="op" id="7878188">,</span>&nbsp;<span class="string" id="7878190">&#34;foo&#34;</span><span class="op" id="7878195">)</span><span class="op" id="7878196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7878201">formData</span><span class="op" id="7878209">(</span><span class="string" id="7878210">&#34;otherEmpty2&#34;</span><span class="op" id="7878223">,</span>&nbsp;<span class="string" id="7878225">&#34;&#34;</span><span class="op" id="7878227">)</span><span class="op" id="7878228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7878233">formData</span><span class="op" id="7878241">(</span><span class="string" id="7878242">&#34;otherRepeatFoo&#34;</span><span class="op" id="7878258">,</span>&nbsp;<span class="string" id="7878260">&#34;foo&#34;</span><span class="op" id="7878265">)</span><span class="op" id="7878266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7878271">formData</span><span class="op" id="7878279">(</span><span class="string" id="7878280">&#34;otherRepeatFoo&#34;</span><span class="op" id="7878296">,</span>&nbsp;<span class="string" id="7878298">&#34;foo&#34;</span><span class="op" id="7878303">)</span><span class="op" id="7878304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7878309">formData</span><span class="op" id="7878317">(</span><span class="string" id="7878318">&#34;otherRepeatEmpty&#34;</span><span class="op" id="7878336">,</span>&nbsp;<span class="string" id="7878338">&#34;&#34;</span><span class="op" id="7878340">)</span><span class="op" id="7878341">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7878346">formData</span><span class="op" id="7878354">(</span><span class="string" id="7878355">&#34;otherRepeatEmpty&#34;</span><span class="op" id="7878373">,</span>&nbsp;<span class="string" id="7878375">&#34;&#34;</span><span class="op" id="7878377">)</span><span class="op" id="7878378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7878383">formData</span><span class="op" id="7878391">(</span><span class="string" id="7878392">&#34;submit&#34;</span><span class="op" id="7878400">,</span>&nbsp;<span class="string" id="7878402">&#34;Submit&#34;</span><span class="op" id="7878410">)</span><span class="op" id="7878411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7878416">{</span><span class="ident" id="7878417">textproto</span><span class="op" id="7878426">.</span><span class="ident" id="7878427">MIMEHeader</span><span class="op" id="7878437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7878443">&#34;Content-Type&#34;</span><span class="op" id="7878457">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7878466">{</span><span class="string" id="7878467">&#34;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q&#34;</span><span class="op" id="7878683">}</span><span class="op" id="7878684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7878690">&#34;Content-Disposition&#34;</span><span class="op" id="7878711">:</span>&nbsp;<span class="op" id="7878713">{</span><span class="string" id="7878714">&#34;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;&#34;</span><span class="op" id="7878759">}</span><span class="op" id="7878760">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7878765">}</span><span class="op" id="7878766">,</span>&nbsp;<span class="string" id="7878768">&#34;Content-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n&#34;</span><span class="op" id="7879015">}</span><span class="op" id="7879016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7879020">}</span><span class="op" id="7879021">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7879024">}</span><span class="op" id="7879025">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7879029">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7879101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879105">name</span><span class="op" id="7879109">:</span>&nbsp;<span class="string" id="7879111">&#34;single&nbsp;empty&nbsp;part,&nbsp;--boundary&#34;</span><span class="op" id="7879142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879146">sep</span><span class="op" id="7879149">:</span>&nbsp;&nbsp;<span class="string" id="7879152">&#34;abc&#34;</span><span class="op" id="7879157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879161">in</span><span class="op" id="7879163">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7879167">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&#34;</span><span class="op" id="7879201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879205">want</span><span class="op" id="7879209">:</span>&nbsp;<span class="op" id="7879211">[</span><span class="op" id="7879212">]</span><span class="ident" id="7879213">headerBody</span><span class="op" id="7879223">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7879228">{</span><span class="ident" id="7879229">textproto</span><span class="op" id="7879238">.</span><span class="ident" id="7879239">MIMEHeader</span><span class="op" id="7879249">{</span><span class="string" id="7879250">&#34;Foo&#34;</span><span class="op" id="7879255">:</span>&nbsp;<span class="op" id="7879257">{</span><span class="string" id="7879258">&#34;bar&#34;</span><span class="op" id="7879263">}</span><span class="op" id="7879264">}</span><span class="op" id="7879265">,</span>&nbsp;<span class="string" id="7879267">&#34;&#34;</span><span class="op" id="7879269">}</span><span class="op" id="7879270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7879274">}</span><span class="op" id="7879275">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7879278">}</span><span class="op" id="7879279">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7879283">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;\r\n--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7879359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879363">name</span><span class="op" id="7879367">:</span>&nbsp;<span class="string" id="7879369">&#34;single&nbsp;empty&nbsp;part,&nbsp;\r\n--boundary&#34;</span><span class="op" id="7879404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879408">sep</span><span class="op" id="7879411">:</span>&nbsp;&nbsp;<span class="string" id="7879414">&#34;abc&#34;</span><span class="op" id="7879419">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879423">in</span><span class="op" id="7879425">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7879429">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n\r\n--abc--&#34;</span><span class="op" id="7879467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879471">want</span><span class="op" id="7879475">:</span>&nbsp;<span class="op" id="7879477">[</span><span class="op" id="7879478">]</span><span class="ident" id="7879479">headerBody</span><span class="op" id="7879489">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7879494">{</span><span class="ident" id="7879495">textproto</span><span class="op" id="7879504">.</span><span class="ident" id="7879505">MIMEHeader</span><span class="op" id="7879515">{</span><span class="string" id="7879516">&#34;Foo&#34;</span><span class="op" id="7879521">:</span>&nbsp;<span class="op" id="7879523">{</span><span class="string" id="7879524">&#34;bar&#34;</span><span class="op" id="7879529">}</span><span class="op" id="7879530">}</span><span class="op" id="7879531">,</span>&nbsp;<span class="string" id="7879533">&#34;&#34;</span><span class="op" id="7879535">}</span><span class="op" id="7879536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7879540">}</span><span class="op" id="7879541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7879544">}</span><span class="op" id="7879545">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7879549">//&nbsp;Final&nbsp;part&nbsp;empty.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7879571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879575">name</span><span class="op" id="7879579">:</span>&nbsp;<span class="string" id="7879581">&#34;final&nbsp;part&nbsp;empty&#34;</span><span class="op" id="7879599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879603">sep</span><span class="op" id="7879606">:</span>&nbsp;&nbsp;<span class="string" id="7879609">&#34;abc&#34;</span><span class="op" id="7879614">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879618">in</span><span class="op" id="7879620">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7879624">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc\r\nFoo2:&nbsp;bar2\r\n\r\n--abc--&#34;</span><span class="op" id="7879685">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879689">want</span><span class="op" id="7879693">:</span>&nbsp;<span class="op" id="7879695">[</span><span class="op" id="7879696">]</span><span class="ident" id="7879697">headerBody</span><span class="op" id="7879707">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7879712">{</span><span class="ident" id="7879713">textproto</span><span class="op" id="7879722">.</span><span class="ident" id="7879723">MIMEHeader</span><span class="op" id="7879733">{</span><span class="string" id="7879734">&#34;Foo&#34;</span><span class="op" id="7879739">:</span>&nbsp;<span class="op" id="7879741">{</span><span class="string" id="7879742">&#34;bar&#34;</span><span class="op" id="7879747">}</span><span class="op" id="7879748">}</span><span class="op" id="7879749">,</span>&nbsp;<span class="string" id="7879751">&#34;&#34;</span><span class="op" id="7879753">}</span><span class="op" id="7879754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7879759">{</span><span class="ident" id="7879760">textproto</span><span class="op" id="7879769">.</span><span class="ident" id="7879770">MIMEHeader</span><span class="op" id="7879780">{</span><span class="string" id="7879781">&#34;Foo2&#34;</span><span class="op" id="7879787">:</span>&nbsp;<span class="op" id="7879789">{</span><span class="string" id="7879790">&#34;bar2&#34;</span><span class="op" id="7879796">}</span><span class="op" id="7879797">}</span><span class="op" id="7879798">,</span>&nbsp;<span class="string" id="7879800">&#34;&#34;</span><span class="op" id="7879802">}</span><span class="op" id="7879803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7879807">}</span><span class="op" id="7879808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7879811">}</span><span class="op" id="7879812">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7879816">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;newlines&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7879874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879878">name</span><span class="op" id="7879882">:</span>&nbsp;<span class="string" id="7879884">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;crlf&#34;</span><span class="op" id="7879912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879916">sep</span><span class="op" id="7879919">:</span>&nbsp;&nbsp;<span class="string" id="7879922">&#34;abc&#34;</span><span class="op" id="7879927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879931">in</span><span class="op" id="7879933">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7879937">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--\r\n&#34;</span><span class="op" id="7879975">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879979">want</span><span class="op" id="7879983">:</span>&nbsp;<span class="op" id="7879985">[</span><span class="op" id="7879986">]</span><span class="ident" id="7879987">headerBody</span><span class="op" id="7879997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880002">{</span><span class="ident" id="7880003">textproto</span><span class="op" id="7880012">.</span><span class="ident" id="7880013">MIMEHeader</span><span class="op" id="7880023">{</span><span class="string" id="7880024">&#34;Foo&#34;</span><span class="op" id="7880029">:</span>&nbsp;<span class="op" id="7880031">{</span><span class="string" id="7880032">&#34;bar&#34;</span><span class="op" id="7880037">}</span><span class="op" id="7880038">}</span><span class="op" id="7880039">,</span>&nbsp;<span class="string" id="7880041">&#34;&#34;</span><span class="op" id="7880043">}</span><span class="op" id="7880044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880048">}</span><span class="op" id="7880049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880052">}</span><span class="op" id="7880053">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7880057">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;lwsp-chars&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880121">name</span><span class="op" id="7880125">:</span>&nbsp;<span class="string" id="7880127">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;lwsp&#34;</span><span class="op" id="7880155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880159">sep</span><span class="op" id="7880162">:</span>&nbsp;&nbsp;<span class="string" id="7880165">&#34;abc&#34;</span><span class="op" id="7880170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880174">in</span><span class="op" id="7880176">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7880180">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&nbsp;\t&#34;</span><span class="op" id="7880217">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880221">want</span><span class="op" id="7880225">:</span>&nbsp;<span class="op" id="7880227">[</span><span class="op" id="7880228">]</span><span class="ident" id="7880229">headerBody</span><span class="op" id="7880239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880244">{</span><span class="ident" id="7880245">textproto</span><span class="op" id="7880254">.</span><span class="ident" id="7880255">MIMEHeader</span><span class="op" id="7880265">{</span><span class="string" id="7880266">&#34;Foo&#34;</span><span class="op" id="7880271">:</span>&nbsp;<span class="op" id="7880273">{</span><span class="string" id="7880274">&#34;bar&#34;</span><span class="op" id="7880279">}</span><span class="op" id="7880280">}</span><span class="op" id="7880281">,</span>&nbsp;<span class="string" id="7880283">&#34;&#34;</span><span class="op" id="7880285">}</span><span class="op" id="7880286">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880290">}</span><span class="op" id="7880291">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880294">}</span><span class="op" id="7880295">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7880299">//&nbsp;No&nbsp;parts&nbsp;(empty&nbsp;form&nbsp;as&nbsp;submitted&nbsp;by&nbsp;Chrome)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880352">name</span><span class="op" id="7880356">:</span>&nbsp;<span class="string" id="7880358">&#34;no&nbsp;parts&#34;</span><span class="op" id="7880368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880372">sep</span><span class="op" id="7880375">:</span>&nbsp;&nbsp;<span class="string" id="7880378">&#34;----WebKitFormBoundaryQfEAfzFOiSemeHfA&#34;</span><span class="op" id="7880418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880422">in</span><span class="op" id="7880424">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7880428">&#34;------WebKitFormBoundaryQfEAfzFOiSemeHfA--\r\n&#34;</span><span class="op" id="7880476">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880480">want</span><span class="op" id="7880484">:</span>&nbsp;<span class="op" id="7880486">[</span><span class="op" id="7880487">]</span><span class="ident" id="7880488">headerBody</span><span class="op" id="7880498">{</span><span class="op" id="7880499">}</span><span class="op" id="7880500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880503">}</span><span class="op" id="7880504">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7880508">//&nbsp;Part&nbsp;containing&nbsp;data&nbsp;starting&nbsp;with&nbsp;the&nbsp;boundary,&nbsp;but&nbsp;with&nbsp;additional&nbsp;suffix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880589">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880593">name</span><span class="op" id="7880597">:</span>&nbsp;<span class="string" id="7880599">&#34;fake&nbsp;separator&nbsp;as&nbsp;data&#34;</span><span class="op" id="7880623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880627">sep</span><span class="op" id="7880630">:</span>&nbsp;&nbsp;<span class="string" id="7880633">&#34;sep&#34;</span><span class="op" id="7880638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880642">in</span><span class="op" id="7880644">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7880648">&#34;--sep\r\nFoo:&nbsp;bar\r\n\r\n--sepFAKE\r\n--sep--&#34;</span><span class="op" id="7880695">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880699">want</span><span class="op" id="7880703">:</span>&nbsp;<span class="op" id="7880705">[</span><span class="op" id="7880706">]</span><span class="ident" id="7880707">headerBody</span><span class="op" id="7880717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880722">{</span><span class="ident" id="7880723">textproto</span><span class="op" id="7880732">.</span><span class="ident" id="7880733">MIMEHeader</span><span class="op" id="7880743">{</span><span class="string" id="7880744">&#34;Foo&#34;</span><span class="op" id="7880749">:</span>&nbsp;<span class="op" id="7880751">{</span><span class="string" id="7880752">&#34;bar&#34;</span><span class="op" id="7880757">}</span><span class="op" id="7880758">}</span><span class="op" id="7880759">,</span>&nbsp;<span class="string" id="7880761">&#34;--sepFAKE&#34;</span><span class="op" id="7880772">}</span><span class="op" id="7880773">,</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880777">}</span><span class="op" id="7880778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880781">}</span><span class="op" id="7880782">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7880786">//&nbsp;Part&nbsp;containing&nbsp;a&nbsp;boundary&nbsp;with&nbsp;whitespace&nbsp;following&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880847">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880851">name</span><span class="op" id="7880855">:</span>&nbsp;<span class="string" id="7880857">&#34;boundary&nbsp;with&nbsp;whitespace&#34;</span><span class="op" id="7880883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880887">sep</span><span class="op" id="7880890">:</span>&nbsp;&nbsp;<span class="string" id="7880893">&#34;sep&#34;</span><span class="op" id="7880898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880902">in</span><span class="op" id="7880904">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7880908">&#34;--sep&nbsp;\r\nFoo:&nbsp;bar\r\n\r\ntext\r\n--sep--&#34;</span><span class="op" id="7880951">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880955">want</span><span class="op" id="7880959">:</span>&nbsp;<span class="op" id="7880961">[</span><span class="op" id="7880962">]</span><span class="ident" id="7880963">headerBody</span><span class="op" id="7880973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880978">{</span><span class="ident" id="7880979">textproto</span><span class="op" id="7880988">.</span><span class="ident" id="7880989">MIMEHeader</span><span class="op" id="7880999">{</span><span class="string" id="7881000">&#34;Foo&#34;</span><span class="op" id="7881005">:</span>&nbsp;<span class="op" id="7881007">{</span><span class="string" id="7881008">&#34;bar&#34;</span><span class="op" id="7881013">}</span><span class="op" id="7881014">}</span><span class="op" id="7881015">,</span>&nbsp;<span class="string" id="7881017">&#34;text&#34;</span><span class="op" id="7881023">}</span><span class="op" id="7881024">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881028">}</span><span class="op" id="7881029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881032">}</span><span class="op" id="7881033">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7881037">//&nbsp;With&nbsp;ignored&nbsp;leading&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881068">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881072">name</span><span class="op" id="7881076">:</span>&nbsp;<span class="string" id="7881078">&#34;leading&nbsp;line&#34;</span><span class="op" id="7881092">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881096">sep</span><span class="op" id="7881099">:</span>&nbsp;&nbsp;<span class="string" id="7881102">&#34;MyBoundary&#34;</span><span class="op" id="7881114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881118">in</span><span class="op" id="7881120">:</span>&nbsp;<span class="ident" id="7881122">strings</span><span class="op" id="7881129">.</span><span class="ident" id="7881130">Replace</span><span class="op" id="7881137">(</span><span class="string" id="7881138">`This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo:&nbsp;bar<br>
<span class="lineno">560</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>--MyBoundary--`</span><span class="op" id="7881231">,</span>&nbsp;<span class="string" id="7881233">&#34;\n&#34;</span><span class="op" id="7881237">,</span>&nbsp;<span class="string" id="7881239">&#34;\r\n&#34;</span><span class="op" id="7881245">,</span>&nbsp;<span class="op" id="7881247">-</span><span class="num" id="7881248">1</span><span class="op" id="7881249">)</span><span class="op" id="7881250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881254">want</span><span class="op" id="7881258">:</span>&nbsp;<span class="op" id="7881260">[</span><span class="op" id="7881261">]</span><span class="ident" id="7881262">headerBody</span><span class="op" id="7881272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881277">{</span><span class="ident" id="7881278">textproto</span><span class="op" id="7881287">.</span><span class="ident" id="7881288">MIMEHeader</span><span class="op" id="7881298">{</span><span class="string" id="7881299">&#34;Foo&#34;</span><span class="op" id="7881304">:</span>&nbsp;<span class="op" id="7881306">{</span><span class="string" id="7881307">&#34;bar&#34;</span><span class="op" id="7881312">}</span><span class="op" id="7881313">}</span><span class="op" id="7881314">,</span>&nbsp;<span class="string" id="7881316">&#34;&#34;</span><span class="op" id="7881318">}</span><span class="op" id="7881319">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881323">}</span><span class="op" id="7881324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881327">}</span><span class="op" id="7881328">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881332">roundTripParseTest</span><span class="op" id="7881350">(</span><span class="op" id="7881351">)</span><span class="op" id="7881352">,</span><br>
<span class="lineno"></span><span class="op" id="7881354">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="keyword" id="7881357">func</span>&nbsp;<span class="ident" id="7881362">TestParse</span><span class="op" id="7881371">(</span><span class="ident" id="7881372">t</span>&nbsp;<span class="op" id="7881374">*</span><span class="ident" id="7881375">testing</span><span class="op" id="7881382">.</span><span class="ident" id="7881383">T</span><span class="op" id="7881384">)</span>&nbsp;<span class="op" id="7881386">{</span><br>
<span class="lineno"></span><span class="ident" id="7881388">Cases</span><span class="op" id="7881393">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7881396">for</span>&nbsp;<span class="ident" id="7881400">_</span><span class="op" id="7881401">,</span>&nbsp;<span class="ident" id="7881403">tt</span>&nbsp;<span class="op" id="7881406">:=</span>&nbsp;<span class="keyword" id="7881409">range</span>&nbsp;<span class="ident" id="7881415">parseTests</span>&nbsp;<span class="op" id="7881426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881430">r</span>&nbsp;<span class="op" id="7881432">:=</span>&nbsp;<span class="ident" id="7881435">NewReader</span><span class="op" id="7881444">(</span><span class="ident" id="7881445">strings</span><span class="op" id="7881452">.</span><span class="ident" id="7881453">NewReader</span><span class="op" id="7881462">(</span><span class="ident" id="7881463">tt</span><span class="op" id="7881465">.</span><span class="ident" id="7881466">in</span><span class="op" id="7881468">)</span><span class="op" id="7881469">,</span>&nbsp;<span class="ident" id="7881471">tt</span><span class="op" id="7881473">.</span><span class="ident" id="7881474">sep</span><span class="op" id="7881477">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881481">got</span>&nbsp;<span class="op" id="7881485">:=</span>&nbsp;<span class="op" id="7881488">[</span><span class="op" id="7881489">]</span><span class="ident" id="7881490">headerBody</span><span class="op" id="7881500">{</span><span class="op" id="7881501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7881505">for</span>&nbsp;<span class="op" id="7881509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881514">p</span><span class="op" id="7881515">,</span>&nbsp;<span class="ident" id="7881517">err</span>&nbsp;<span class="op" id="7881521">:=</span>&nbsp;<span class="ident" id="7881524">r</span><span class="op" id="7881525">.</span><span class="ident" id="7881526">NextPart</span><span class="op" id="7881534">(</span><span class="op" id="7881535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7881540">if</span>&nbsp;<span class="ident" id="7881543">err</span>&nbsp;<span class="op" id="7881547">==</span>&nbsp;<span class="ident" id="7881550">io</span><span class="op" id="7881552">.</span><span class="ident" id="7881553">EOF</span>&nbsp;<span class="op" id="7881557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7881563">break</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7881577">if</span>&nbsp;<span class="ident" id="7881580">err</span>&nbsp;<span class="op" id="7881584">!=</span>&nbsp;<span class="ident" id="7881587">nil</span>&nbsp;<span class="op" id="7881591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881597">t</span><span class="op" id="7881598">.</span><span class="ident" id="7881599">Errorf</span><span class="op" id="7881605">(</span><span class="string" id="7881606">&#34;in&nbsp;test&nbsp;%q,&nbsp;NextPart:&nbsp;%v&#34;</span><span class="op" id="7881632">,</span>&nbsp;<span class="ident" id="7881634">tt</span><span class="op" id="7881636">.</span><span class="ident" id="7881637">name</span><span class="op" id="7881641">,</span>&nbsp;<span class="ident" id="7881643">err</span><span class="op" id="7881646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7881652">continue</span>&nbsp;<span class="ident" id="7881661">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881670">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881675">pbody</span><span class="op" id="7881680">,</span>&nbsp;<span class="ident" id="7881682">err</span>&nbsp;<span class="op" id="7881686">:=</span>&nbsp;<span class="ident" id="7881689">ioutil</span><span class="op" id="7881695">.</span><span class="ident" id="7881696">ReadAll</span><span class="op" id="7881703">(</span><span class="ident" id="7881704">p</span><span class="op" id="7881705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7881710">if</span>&nbsp;<span class="ident" id="7881713">err</span>&nbsp;<span class="op" id="7881717">!=</span>&nbsp;<span class="ident" id="7881720">nil</span>&nbsp;<span class="op" id="7881724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881730">t</span><span class="op" id="7881731">.</span><span class="ident" id="7881732">Errorf</span><span class="op" id="7881738">(</span><span class="string" id="7881739">&#34;in&nbsp;test&nbsp;%q,&nbsp;error&nbsp;reading&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="7881775">,</span>&nbsp;<span class="ident" id="7881777">tt</span><span class="op" id="7881779">.</span><span class="ident" id="7881780">name</span><span class="op" id="7881784">,</span>&nbsp;<span class="ident" id="7881786">err</span><span class="op" id="7881789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7881795">continue</span>&nbsp;<span class="ident" id="7881804">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881813">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881818">got</span>&nbsp;<span class="op" id="7881822">=</span>&nbsp;<span class="builtinfunc" id="7881824">append</span><span class="op" id="7881830">(</span><span class="ident" id="7881831">got</span><span class="op" id="7881834">,</span>&nbsp;<span class="ident" id="7881836">headerBody</span><span class="op" id="7881846">{</span><span class="ident" id="7881847">p</span><span class="op" id="7881848">.</span><span class="ident" id="7881849">Header</span><span class="op" id="7881855">,</span>&nbsp;<span class="builtintype" id="7881857">string</span><span class="op" id="7881863">(</span><span class="ident" id="7881864">pbody</span><span class="op" id="7881869">)</span><span class="op" id="7881870">}</span><span class="op" id="7881871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7881879">if</span>&nbsp;<span class="op" id="7881882">!</span><span class="ident" id="7881883">reflect</span><span class="op" id="7881890">.</span><span class="ident" id="7881891">DeepEqual</span><span class="op" id="7881900">(</span><span class="ident" id="7881901">tt</span><span class="op" id="7881903">.</span><span class="ident" id="7881904">want</span><span class="op" id="7881908">,</span>&nbsp;<span class="ident" id="7881910">got</span><span class="op" id="7881913">)</span>&nbsp;<span class="op" id="7881915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881920">t</span><span class="op" id="7881921">.</span><span class="ident" id="7881922">Errorf</span><span class="op" id="7881928">(</span><span class="string" id="7881929">&#34;test&nbsp;%q:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="7881959">,</span>&nbsp;<span class="ident" id="7881961">tt</span><span class="op" id="7881963">.</span><span class="ident" id="7881964">name</span><span class="op" id="7881968">,</span>&nbsp;<span class="ident" id="7881970">got</span><span class="op" id="7881973">,</span>&nbsp;<span class="ident" id="7881975">tt</span><span class="op" id="7881977">.</span><span class="ident" id="7881978">want</span><span class="op" id="7881982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7881987">if</span>&nbsp;<span class="builtinfunc" id="7881990">len</span><span class="op" id="7881993">(</span><span class="ident" id="7881994">tt</span><span class="op" id="7881996">.</span><span class="ident" id="7881997">want</span><span class="op" id="7882001">)</span>&nbsp;<span class="op" id="7882003">!=</span>&nbsp;<span class="builtinfunc" id="7882006">len</span><span class="op" id="7882009">(</span><span class="ident" id="7882010">got</span><span class="op" id="7882013">)</span>&nbsp;<span class="op" id="7882015">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882021">t</span><span class="op" id="7882022">.</span><span class="ident" id="7882023">Errorf</span><span class="op" id="7882029">(</span><span class="string" id="7882030">&#34;test&nbsp;%q:&nbsp;got&nbsp;%d&nbsp;parts,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7882062">,</span>&nbsp;<span class="ident" id="7882064">tt</span><span class="op" id="7882066">.</span><span class="ident" id="7882067">name</span><span class="op" id="7882071">,</span>&nbsp;<span class="builtinfunc" id="7882073">len</span><span class="op" id="7882076">(</span><span class="ident" id="7882077">got</span><span class="op" id="7882080">)</span><span class="op" id="7882081">,</span>&nbsp;<span class="builtinfunc" id="7882083">len</span><span class="op" id="7882086">(</span><span class="ident" id="7882087">tt</span><span class="op" id="7882089">.</span><span class="ident" id="7882090">want</span><span class="op" id="7882094">)</span><span class="op" id="7882095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882100">}</span>&nbsp;<span class="keyword" id="7882102">else</span>&nbsp;<span class="keyword" id="7882107">if</span>&nbsp;<span class="builtinfunc" id="7882110">len</span><span class="op" id="7882113">(</span><span class="ident" id="7882114">got</span><span class="op" id="7882117">)</span>&nbsp;<span class="op" id="7882119">&gt;</span>&nbsp;<span class="num" id="7882121">1</span>&nbsp;<span class="op" id="7882123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7882129">for</span>&nbsp;<span class="ident" id="7882133">pi</span><span class="op" id="7882135">,</span>&nbsp;<span class="ident" id="7882137">wantPart</span>&nbsp;<span class="op" id="7882146">:=</span>&nbsp;<span class="keyword" id="7882149">range</span>&nbsp;<span class="ident" id="7882155">tt</span><span class="op" id="7882157">.</span><span class="ident" id="7882158">want</span>&nbsp;<span class="op" id="7882163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7882170">if</span>&nbsp;<span class="op" id="7882173">!</span><span class="ident" id="7882174">reflect</span><span class="op" id="7882181">.</span><span class="ident" id="7882182">DeepEqual</span><span class="op" id="7882191">(</span><span class="ident" id="7882192">wantPart</span><span class="op" id="7882200">,</span>&nbsp;<span class="ident" id="7882202">got</span><span class="op" id="7882205">[</span><span class="ident" id="7882206">pi</span><span class="op" id="7882208">]</span><span class="op" id="7882209">)</span>&nbsp;<span class="op" id="7882211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882219">t</span><span class="op" id="7882220">.</span><span class="ident" id="7882221">Errorf</span><span class="op" id="7882227">(</span><span class="string" id="7882228">&#34;test&nbsp;%q,&nbsp;part&nbsp;%d:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="7882267">,</span>&nbsp;<span class="ident" id="7882269">tt</span><span class="op" id="7882271">.</span><span class="ident" id="7882272">name</span><span class="op" id="7882276">,</span>&nbsp;<span class="ident" id="7882278">pi</span><span class="op" id="7882280">,</span>&nbsp;<span class="ident" id="7882282">got</span><span class="op" id="7882285">[</span><span class="ident" id="7882286">pi</span><span class="op" id="7882288">]</span><span class="op" id="7882289">,</span>&nbsp;<span class="ident" id="7882291">wantPart</span><span class="op" id="7882299">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882324">}</span><br>
<span class="lineno">605</span><span class="op" id="7882326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7882329">func</span>&nbsp;<span class="ident" id="7882334">roundTripParseTest</span><span class="op" id="7882352">(</span><span class="op" id="7882353">)</span>&nbsp;<span class="ident" id="7882355">parseTest</span>&nbsp;<span class="op" id="7882365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882368">t</span>&nbsp;<span class="op" id="7882370">:=</span>&nbsp;<span class="ident" id="7882373">parseTest</span><span class="op" id="7882382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882386">name</span><span class="op" id="7882390">:</span>&nbsp;<span class="string" id="7882392">&#34;round&nbsp;trip&#34;</span><span class="op" id="7882404">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882408">want</span><span class="op" id="7882412">:</span>&nbsp;<span class="op" id="7882414">[</span><span class="op" id="7882415">]</span><span class="ident" id="7882416">headerBody</span><span class="op" id="7882426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882431">formData</span><span class="op" id="7882439">(</span><span class="string" id="7882440">&#34;empty&#34;</span><span class="op" id="7882447">,</span>&nbsp;<span class="string" id="7882449">&#34;&#34;</span><span class="op" id="7882451">)</span><span class="op" id="7882452">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882457">formData</span><span class="op" id="7882465">(</span><span class="string" id="7882466">&#34;lf&#34;</span><span class="op" id="7882470">,</span>&nbsp;<span class="string" id="7882472">&#34;\n&#34;</span><span class="op" id="7882476">)</span><span class="op" id="7882477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882482">formData</span><span class="op" id="7882490">(</span><span class="string" id="7882491">&#34;cr&#34;</span><span class="op" id="7882495">,</span>&nbsp;<span class="string" id="7882497">&#34;\r&#34;</span><span class="op" id="7882501">)</span><span class="op" id="7882502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882507">formData</span><span class="op" id="7882515">(</span><span class="string" id="7882516">&#34;crlf&#34;</span><span class="op" id="7882522">,</span>&nbsp;<span class="string" id="7882524">&#34;\r\n&#34;</span><span class="op" id="7882530">)</span><span class="op" id="7882531">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882536">formData</span><span class="op" id="7882544">(</span><span class="string" id="7882545">&#34;foo&#34;</span><span class="op" id="7882550">,</span>&nbsp;<span class="string" id="7882552">&#34;bar&#34;</span><span class="op" id="7882557">)</span><span class="op" id="7882558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882562">}</span><span class="op" id="7882563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7882569">var</span>&nbsp;<span class="ident" id="7882573">buf</span>&nbsp;<span class="ident" id="7882577">bytes</span><span class="op" id="7882582">.</span><span class="ident" id="7882583">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882591">w</span>&nbsp;<span class="op" id="7882593">:=</span>&nbsp;<span class="ident" id="7882596">NewWriter</span><span class="op" id="7882605">(</span><span class="op" id="7882606">&amp;</span><span class="ident" id="7882607">buf</span><span class="op" id="7882610">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7882613">for</span>&nbsp;<span class="ident" id="7882617">_</span><span class="op" id="7882618">,</span>&nbsp;<span class="ident" id="7882620">p</span>&nbsp;<span class="op" id="7882622">:=</span>&nbsp;<span class="keyword" id="7882625">range</span>&nbsp;<span class="ident" id="7882631">t</span><span class="op" id="7882632">.</span><span class="ident" id="7882633">want</span>&nbsp;<span class="op" id="7882638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882642">pw</span><span class="op" id="7882644">,</span>&nbsp;<span class="ident" id="7882646">err</span>&nbsp;<span class="op" id="7882650">:=</span>&nbsp;<span class="ident" id="7882653">w</span><span class="op" id="7882654">.</span><span class="ident" id="7882655">CreatePart</span><span class="op" id="7882665">(</span><span class="ident" id="7882666">p</span><span class="op" id="7882667">.</span><span class="ident" id="7882668">header</span><span class="op" id="7882674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7882678">if</span>&nbsp;<span class="ident" id="7882681">err</span>&nbsp;<span class="op" id="7882685">!=</span>&nbsp;<span class="ident" id="7882688">nil</span>&nbsp;<span class="op" id="7882692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7882697">panic</span><span class="op" id="7882702">(</span><span class="ident" id="7882703">err</span><span class="op" id="7882706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882710">}</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882714">_</span><span class="op" id="7882715">,</span>&nbsp;<span class="ident" id="7882717">err</span>&nbsp;<span class="op" id="7882721">=</span>&nbsp;<span class="ident" id="7882723">pw</span><span class="op" id="7882725">.</span><span class="ident" id="7882726">Write</span><span class="op" id="7882731">(</span><span class="op" id="7882732">[</span><span class="op" id="7882733">]</span><span class="builtintype" id="7882734">byte</span><span class="op" id="7882738">(</span><span class="ident" id="7882739">p</span><span class="op" id="7882740">.</span><span class="ident" id="7882741">body</span><span class="op" id="7882745">)</span><span class="op" id="7882746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7882750">if</span>&nbsp;<span class="ident" id="7882753">err</span>&nbsp;<span class="op" id="7882757">!=</span>&nbsp;<span class="ident" id="7882760">nil</span>&nbsp;<span class="op" id="7882764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7882769">panic</span><span class="op" id="7882774">(</span><span class="ident" id="7882775">err</span><span class="op" id="7882778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882785">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882788">w</span><span class="op" id="7882789">.</span><span class="ident" id="7882790">Close</span><span class="op" id="7882795">(</span><span class="op" id="7882796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882799">t</span><span class="op" id="7882800">.</span><span class="ident" id="7882801">in</span>&nbsp;<span class="op" id="7882804">=</span>&nbsp;<span class="ident" id="7882806">buf</span><span class="op" id="7882809">.</span><span class="ident" id="7882810">String</span><span class="op" id="7882816">(</span><span class="op" id="7882817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882820">t</span><span class="op" id="7882821">.</span><span class="ident" id="7882822">sep</span>&nbsp;<span class="op" id="7882826">=</span>&nbsp;<span class="ident" id="7882828">w</span><span class="op" id="7882829">.</span><span class="ident" id="7882830">Boundary</span><span class="op" id="7882838">(</span><span class="op" id="7882839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7882842">return</span>&nbsp;<span class="ident" id="7882849">t</span><br>
<span class="lineno"></span><span class="op" id="7882851">}</span>
</div>
</body>
</html>
