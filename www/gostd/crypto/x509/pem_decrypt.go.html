<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4304040">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4304095">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4304149">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4304200">package</span>&nbsp;<span class="ident" id="4304208">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4304214">//&nbsp;RFC&nbsp;1423&nbsp;describes&nbsp;the&nbsp;encryption&nbsp;of&nbsp;PEM&nbsp;blocks.&nbsp;The&nbsp;algorithm&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4304288">//&nbsp;generate&nbsp;a&nbsp;key&nbsp;from&nbsp;the&nbsp;password&nbsp;was&nbsp;derived&nbsp;by&nbsp;looking&nbsp;at&nbsp;the&nbsp;OpenSSL</span><br>
<span class="lineno"></span><span class="comment" id="4304362">//&nbsp;implementation.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4304382">import</span>&nbsp;<span class="op" id="4304389">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4304392">&#34;crypto/aes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4304406">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4304423">&#34;crypto/des&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4304437">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4304451">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4304467">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4304483">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4304493">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4304499">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4304509">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4304512">type</span>&nbsp;<span class="ident" id="4304517">PEMCipher</span>&nbsp;<span class="builtintype" id="4304527">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4304532">//&nbsp;Possible&nbsp;values&nbsp;for&nbsp;the&nbsp;EncryptPEMBlock&nbsp;encryption&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="4304597">const</span>&nbsp;<span class="op" id="4304603">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304606">_</span>&nbsp;<span class="ident" id="4304608">PEMCipher</span>&nbsp;<span class="op" id="4304618">=</span>&nbsp;<span class="ident" id="4304620">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304626">PEMCipherDES</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304640">PEMCipher3DES</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304655">PEMCipherAES128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304672">PEMCipherAES192</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304689">PEMCipherAES256</span><br>
<span class="lineno"></span><span class="op" id="4304705">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4304708">//&nbsp;rfc1423Algo&nbsp;holds&nbsp;a&nbsp;method&nbsp;for&nbsp;enciphering&nbsp;a&nbsp;PEM&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="4304767">type</span>&nbsp;<span class="ident" id="4304772">rfc1423Algo</span>&nbsp;<span class="keyword" id="4304784">struct</span>&nbsp;<span class="op" id="4304791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304794">cipher</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4304805">PEMCipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304816">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4304827">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304835">cipherFunc</span>&nbsp;<span class="keyword" id="4304846">func</span><span class="op" id="4304850">(</span><span class="ident" id="4304851">key</span>&nbsp;<span class="op" id="4304855">[</span><span class="op" id="4304856">]</span><span class="builtintype" id="4304857">byte</span><span class="op" id="4304861">)</span>&nbsp;<span class="op" id="4304863">(</span><span class="ident" id="4304864">cipher</span><span class="op" id="4304870">.</span><span class="ident" id="4304871">Block</span><span class="op" id="4304876">,</span>&nbsp;<span class="builtintype" id="4304878">error</span><span class="op" id="4304883">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304886">keySize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4304897">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304902">blockSize</span>&nbsp;&nbsp;<span class="builtintype" id="4304913">int</span><br>
<span class="lineno"></span><span class="op" id="4304917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4304920">//&nbsp;rfc1423Algos&nbsp;holds&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;possible&nbsp;ways&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;PEM</span><br>
<span class="lineno">45</span><span class="comment" id="4304988">//&nbsp;block.&nbsp;&nbsp;The&nbsp;ivSize&nbsp;numbers&nbsp;were&nbsp;taken&nbsp;from&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4305054">var</span>&nbsp;<span class="ident" id="4305058">rfc1423Algos</span>&nbsp;<span class="op" id="4305071">=</span>&nbsp;<span class="op" id="4305073">[</span><span class="op" id="4305074">]</span><span class="ident" id="4305075">rfc1423Algo</span><span class="op" id="4305086">{</span><span class="op" id="4305087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305090">cipher</span><span class="op" id="4305096">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305102">PEMCipherDES</span><span class="op" id="4305114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305117">name</span><span class="op" id="4305121">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4305129">&#34;DES-CBC&#34;</span><span class="op" id="4305138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305141">cipherFunc</span><span class="op" id="4305151">:</span>&nbsp;<span class="ident" id="4305153">des</span><span class="op" id="4305156">.</span><span class="ident" id="4305157">NewCipher</span><span class="op" id="4305166">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305169">keySize</span><span class="op" id="4305176">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4305181">8</span><span class="op" id="4305182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305185">blockSize</span><span class="op" id="4305194">:</span>&nbsp;&nbsp;<span class="ident" id="4305197">des</span><span class="op" id="4305200">.</span><span class="ident" id="4305201">BlockSize</span><span class="op" id="4305210">,</span><br>
<span class="lineno"></span><span class="op" id="4305212">}</span><span class="op" id="4305213">,</span>&nbsp;<span class="op" id="4305215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305218">cipher</span><span class="op" id="4305224">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305230">PEMCipher3DES</span><span class="op" id="4305243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305246">name</span><span class="op" id="4305250">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4305258">&#34;DES-EDE3-CBC&#34;</span><span class="op" id="4305272">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305275">cipherFunc</span><span class="op" id="4305285">:</span>&nbsp;<span class="ident" id="4305287">des</span><span class="op" id="4305290">.</span><span class="ident" id="4305291">NewTripleDESCipher</span><span class="op" id="4305309">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305312">keySize</span><span class="op" id="4305319">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4305324">24</span><span class="op" id="4305326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305329">blockSize</span><span class="op" id="4305338">:</span>&nbsp;&nbsp;<span class="ident" id="4305341">des</span><span class="op" id="4305344">.</span><span class="ident" id="4305345">BlockSize</span><span class="op" id="4305354">,</span><br>
<span class="lineno"></span><span class="op" id="4305356">}</span><span class="op" id="4305357">,</span>&nbsp;<span class="op" id="4305359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305362">cipher</span><span class="op" id="4305368">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305374">PEMCipherAES128</span><span class="op" id="4305389">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305392">name</span><span class="op" id="4305396">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4305404">&#34;AES-128-CBC&#34;</span><span class="op" id="4305417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305420">cipherFunc</span><span class="op" id="4305430">:</span>&nbsp;<span class="ident" id="4305432">aes</span><span class="op" id="4305435">.</span><span class="ident" id="4305436">NewCipher</span><span class="op" id="4305445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305448">keySize</span><span class="op" id="4305455">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4305460">16</span><span class="op" id="4305462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305465">blockSize</span><span class="op" id="4305474">:</span>&nbsp;&nbsp;<span class="ident" id="4305477">aes</span><span class="op" id="4305480">.</span><span class="ident" id="4305481">BlockSize</span><span class="op" id="4305490">,</span><br>
<span class="lineno"></span><span class="op" id="4305492">}</span><span class="op" id="4305493">,</span>&nbsp;<span class="op" id="4305495">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305498">cipher</span><span class="op" id="4305504">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305510">PEMCipherAES192</span><span class="op" id="4305525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305528">name</span><span class="op" id="4305532">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4305540">&#34;AES-192-CBC&#34;</span><span class="op" id="4305553">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305556">cipherFunc</span><span class="op" id="4305566">:</span>&nbsp;<span class="ident" id="4305568">aes</span><span class="op" id="4305571">.</span><span class="ident" id="4305572">NewCipher</span><span class="op" id="4305581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305584">keySize</span><span class="op" id="4305591">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4305596">24</span><span class="op" id="4305598">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305601">blockSize</span><span class="op" id="4305610">:</span>&nbsp;&nbsp;<span class="ident" id="4305613">aes</span><span class="op" id="4305616">.</span><span class="ident" id="4305617">BlockSize</span><span class="op" id="4305626">,</span><br>
<span class="lineno">70</span><span class="op" id="4305628">}</span><span class="op" id="4305629">,</span>&nbsp;<span class="op" id="4305631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305634">cipher</span><span class="op" id="4305640">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305646">PEMCipherAES256</span><span class="op" id="4305661">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305664">name</span><span class="op" id="4305668">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4305676">&#34;AES-256-CBC&#34;</span><span class="op" id="4305689">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305692">cipherFunc</span><span class="op" id="4305702">:</span>&nbsp;<span class="ident" id="4305704">aes</span><span class="op" id="4305707">.</span><span class="ident" id="4305708">NewCipher</span><span class="op" id="4305717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305720">keySize</span><span class="op" id="4305727">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4305732">32</span><span class="op" id="4305734">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305737">blockSize</span><span class="op" id="4305746">:</span>&nbsp;&nbsp;<span class="ident" id="4305749">aes</span><span class="op" id="4305752">.</span><span class="ident" id="4305753">BlockSize</span><span class="op" id="4305762">,</span><br>
<span class="lineno"></span><span class="op" id="4305764">}</span><span class="op" id="4305765">,</span><br>
<span class="lineno"></span><span class="op" id="4305767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4305770">//&nbsp;deriveKey&nbsp;uses&nbsp;a&nbsp;key&nbsp;derivation&nbsp;function&nbsp;to&nbsp;stretch&nbsp;the&nbsp;password&nbsp;into&nbsp;a&nbsp;key</span><br>
<span class="lineno">80</span><span class="comment" id="4305849">//&nbsp;with&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;our&nbsp;cipher&nbsp;requires.&nbsp;This&nbsp;algorithm&nbsp;was&nbsp;derived&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4305929">//&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4305952">func</span>&nbsp;<span class="op" id="4305957">(</span><span class="ident" id="4305958">c</span>&nbsp;<span class="ident" id="4305960">rfc1423Algo</span><span class="op" id="4305971">)</span>&nbsp;<span class="ident" id="4305973">deriveKey</span><span class="op" id="4305982">(</span><span class="ident" id="4305983">password</span><span class="op" id="4305991">,</span>&nbsp;<span class="ident" id="4305993">salt</span>&nbsp;<span class="op" id="4305998">[</span><span class="op" id="4305999">]</span><span class="builtintype" id="4306000">byte</span><span class="op" id="4306004">)</span>&nbsp;<span class="op" id="4306006">[</span><span class="op" id="4306007">]</span><span class="builtintype" id="4306008">byte</span>&nbsp;<span class="op" id="4306013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306016">hash</span>&nbsp;<span class="op" id="4306021">:=</span>&nbsp;<span class="ident" id="4306024">md5</span><span class="op" id="4306027">.</span><span class="ident" id="4306028">New</span><span class="op" id="4306031">(</span><span class="op" id="4306032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306035">out</span>&nbsp;<span class="op" id="4306039">:=</span>&nbsp;<span class="builtinfunc" id="4306042">make</span><span class="op" id="4306046">(</span><span class="op" id="4306047">[</span><span class="op" id="4306048">]</span><span class="builtintype" id="4306049">byte</span><span class="op" id="4306053">,</span>&nbsp;<span class="ident" id="4306055">c</span><span class="op" id="4306056">.</span><span class="ident" id="4306057">keySize</span><span class="op" id="4306064">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4306067">var</span>&nbsp;<span class="ident" id="4306071">digest</span>&nbsp;<span class="op" id="4306078">[</span><span class="op" id="4306079">]</span><span class="builtintype" id="4306080">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4306087">for</span>&nbsp;<span class="ident" id="4306091">i</span>&nbsp;<span class="op" id="4306093">:=</span>&nbsp;<span class="num" id="4306096">0</span><span class="op" id="4306097">;</span>&nbsp;<span class="ident" id="4306099">i</span>&nbsp;<span class="op" id="4306101">&lt;</span>&nbsp;<span class="builtinfunc" id="4306103">len</span><span class="op" id="4306106">(</span><span class="ident" id="4306107">out</span><span class="op" id="4306110">)</span><span class="op" id="4306111">;</span>&nbsp;<span class="ident" id="4306113">i</span>&nbsp;<span class="op" id="4306115">+=</span>&nbsp;<span class="builtinfunc" id="4306118">len</span><span class="op" id="4306121">(</span><span class="ident" id="4306122">digest</span><span class="op" id="4306128">)</span>&nbsp;<span class="op" id="4306130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306134">hash</span><span class="op" id="4306138">.</span><span class="ident" id="4306139">Reset</span><span class="op" id="4306144">(</span><span class="op" id="4306145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306149">hash</span><span class="op" id="4306153">.</span><span class="ident" id="4306154">Write</span><span class="op" id="4306159">(</span><span class="ident" id="4306160">digest</span><span class="op" id="4306166">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306170">hash</span><span class="op" id="4306174">.</span><span class="ident" id="4306175">Write</span><span class="op" id="4306180">(</span><span class="ident" id="4306181">password</span><span class="op" id="4306189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306193">hash</span><span class="op" id="4306197">.</span><span class="ident" id="4306198">Write</span><span class="op" id="4306203">(</span><span class="ident" id="4306204">salt</span><span class="op" id="4306208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306212">digest</span>&nbsp;<span class="op" id="4306219">=</span>&nbsp;<span class="ident" id="4306221">hash</span><span class="op" id="4306225">.</span><span class="ident" id="4306226">Sum</span><span class="op" id="4306229">(</span><span class="ident" id="4306230">digest</span><span class="op" id="4306236">[</span><span class="op" id="4306237">:</span><span class="num" id="4306238">0</span><span class="op" id="4306239">]</span><span class="op" id="4306240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4306244">copy</span><span class="op" id="4306248">(</span><span class="ident" id="4306249">out</span><span class="op" id="4306252">[</span><span class="ident" id="4306253">i</span><span class="op" id="4306254">:</span><span class="op" id="4306255">]</span><span class="op" id="4306256">,</span>&nbsp;<span class="ident" id="4306258">digest</span><span class="op" id="4306264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4306267">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4306270">return</span>&nbsp;<span class="ident" id="4306277">out</span><br>
<span class="lineno"></span><span class="op" id="4306281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4306284">//&nbsp;IsEncryptedPEMBlock&nbsp;returns&nbsp;if&nbsp;the&nbsp;PEM&nbsp;block&nbsp;is&nbsp;password&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="4306355">func</span>&nbsp;<span class="ident" id="4306360">IsEncryptedPEMBlock</span><span class="op" id="4306379">(</span><span class="ident" id="4306380">b</span>&nbsp;<span class="op" id="4306382">*</span><span class="ident" id="4306383">pem</span><span class="op" id="4306386">.</span><span class="ident" id="4306387">Block</span><span class="op" id="4306392">)</span>&nbsp;<span class="builtintype" id="4306394">bool</span>&nbsp;<span class="op" id="4306399">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306402">_</span><span class="op" id="4306403">,</span>&nbsp;<span class="ident" id="4306405">ok</span>&nbsp;<span class="op" id="4306408">:=</span>&nbsp;<span class="ident" id="4306411">b</span><span class="op" id="4306412">.</span><span class="ident" id="4306413">Headers</span><span class="op" id="4306420">[</span><span class="string" id="4306421">&#34;DEK-Info&#34;</span><span class="op" id="4306431">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4306434">return</span>&nbsp;<span class="ident" id="4306441">ok</span><br>
<span class="lineno"></span><span class="op" id="4306444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4306447">//&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned&nbsp;when&nbsp;an&nbsp;incorrect&nbsp;password&nbsp;is&nbsp;detected.</span><br>
<span class="lineno">105</span><span class="keyword" id="4306525">var</span>&nbsp;<span class="ident" id="4306529">IncorrectPasswordError</span>&nbsp;<span class="op" id="4306552">=</span>&nbsp;<span class="ident" id="4306554">errors</span><span class="op" id="4306560">.</span><span class="ident" id="4306561">New</span><span class="op" id="4306564">(</span><span class="string" id="4306565">&#34;x509:&nbsp;decryption&nbsp;password&nbsp;incorrect&#34;</span><span class="op" id="4306602">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4306605">//&nbsp;DecryptPEMBlock&nbsp;takes&nbsp;a&nbsp;password&nbsp;encrypted&nbsp;PEM&nbsp;block&nbsp;and&nbsp;the&nbsp;password&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4306686">//&nbsp;encrypt&nbsp;it&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;decrypted&nbsp;DER&nbsp;encoded&nbsp;bytes.&nbsp;It&nbsp;inspects</span><br>
<span class="lineno"></span><span class="comment" id="4306764">//&nbsp;the&nbsp;DEK-Info&nbsp;header&nbsp;to&nbsp;determine&nbsp;the&nbsp;algorithm&nbsp;used&nbsp;for&nbsp;decryption.&nbsp;If&nbsp;no</span><br>
<span class="lineno">110</span><span class="comment" id="4306841">//&nbsp;DEK-Info&nbsp;header&nbsp;is&nbsp;present,&nbsp;an&nbsp;error&nbsp;is&nbsp;returned.&nbsp;If&nbsp;an&nbsp;incorrect&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="4306919">//&nbsp;is&nbsp;detected&nbsp;an&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="4306973">func</span>&nbsp;<span class="ident" id="4306978">DecryptPEMBlock</span><span class="op" id="4306993">(</span><span class="ident" id="4306994">b</span>&nbsp;<span class="op" id="4306996">*</span><span class="ident" id="4306997">pem</span><span class="op" id="4307000">.</span><span class="ident" id="4307001">Block</span><span class="op" id="4307006">,</span>&nbsp;<span class="ident" id="4307008">password</span>&nbsp;<span class="op" id="4307017">[</span><span class="op" id="4307018">]</span><span class="builtintype" id="4307019">byte</span><span class="op" id="4307023">)</span>&nbsp;<span class="op" id="4307025">(</span><span class="op" id="4307026">[</span><span class="op" id="4307027">]</span><span class="builtintype" id="4307028">byte</span><span class="op" id="4307032">,</span>&nbsp;<span class="builtintype" id="4307034">error</span><span class="op" id="4307039">)</span>&nbsp;<span class="op" id="4307041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307044">dek</span><span class="op" id="4307047">,</span>&nbsp;<span class="ident" id="4307049">ok</span>&nbsp;<span class="op" id="4307052">:=</span>&nbsp;<span class="ident" id="4307055">b</span><span class="op" id="4307056">.</span><span class="ident" id="4307057">Headers</span><span class="op" id="4307064">[</span><span class="string" id="4307065">&#34;DEK-Info&#34;</span><span class="op" id="4307075">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307078">if</span>&nbsp;<span class="op" id="4307081">!</span><span class="ident" id="4307082">ok</span>&nbsp;<span class="op" id="4307085">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307089">return</span>&nbsp;<span class="ident" id="4307096">nil</span><span class="op" id="4307099">,</span>&nbsp;<span class="ident" id="4307101">errors</span><span class="op" id="4307107">.</span><span class="ident" id="4307108">New</span><span class="op" id="4307111">(</span><span class="string" id="4307112">&#34;x509:&nbsp;no&nbsp;DEK-Info&nbsp;header&nbsp;in&nbsp;block&#34;</span><span class="op" id="4307147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4307150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307154">idx</span>&nbsp;<span class="op" id="4307158">:=</span>&nbsp;<span class="ident" id="4307161">strings</span><span class="op" id="4307168">.</span><span class="ident" id="4307169">Index</span><span class="op" id="4307174">(</span><span class="ident" id="4307175">dek</span><span class="op" id="4307178">,</span>&nbsp;<span class="string" id="4307180">&#34;,&#34;</span><span class="op" id="4307183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307186">if</span>&nbsp;<span class="ident" id="4307189">idx</span>&nbsp;<span class="op" id="4307193">==</span>&nbsp;<span class="op" id="4307196">-</span><span class="num" id="4307197">1</span>&nbsp;<span class="op" id="4307199">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307203">return</span>&nbsp;<span class="ident" id="4307210">nil</span><span class="op" id="4307213">,</span>&nbsp;<span class="ident" id="4307215">errors</span><span class="op" id="4307221">.</span><span class="ident" id="4307222">New</span><span class="op" id="4307225">(</span><span class="string" id="4307226">&#34;x509:&nbsp;malformed&nbsp;DEK-Info&nbsp;header&#34;</span><span class="op" id="4307259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4307262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307266">mode</span><span class="op" id="4307270">,</span>&nbsp;<span class="ident" id="4307272">hexIV</span>&nbsp;<span class="op" id="4307278">:=</span>&nbsp;<span class="ident" id="4307281">dek</span><span class="op" id="4307284">[</span><span class="op" id="4307285">:</span><span class="ident" id="4307286">idx</span><span class="op" id="4307289">]</span><span class="op" id="4307290">,</span>&nbsp;<span class="ident" id="4307292">dek</span><span class="op" id="4307295">[</span><span class="ident" id="4307296">idx</span><span class="op" id="4307299">+</span><span class="num" id="4307300">1</span><span class="op" id="4307301">:</span><span class="op" id="4307302">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307305">ciph</span>&nbsp;<span class="op" id="4307310">:=</span>&nbsp;<span class="ident" id="4307313">cipherByName</span><span class="op" id="4307325">(</span><span class="ident" id="4307326">mode</span><span class="op" id="4307330">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307333">if</span>&nbsp;<span class="ident" id="4307336">ciph</span>&nbsp;<span class="op" id="4307341">==</span>&nbsp;<span class="ident" id="4307344">nil</span>&nbsp;<span class="op" id="4307348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307352">return</span>&nbsp;<span class="ident" id="4307359">nil</span><span class="op" id="4307362">,</span>&nbsp;<span class="ident" id="4307364">errors</span><span class="op" id="4307370">.</span><span class="ident" id="4307371">New</span><span class="op" id="4307374">(</span><span class="string" id="4307375">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="4307406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4307409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307412">iv</span><span class="op" id="4307414">,</span>&nbsp;<span class="ident" id="4307416">err</span>&nbsp;<span class="op" id="4307420">:=</span>&nbsp;<span class="ident" id="4307423">hex</span><span class="op" id="4307426">.</span><span class="ident" id="4307427">DecodeString</span><span class="op" id="4307439">(</span><span class="ident" id="4307440">hexIV</span><span class="op" id="4307445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307448">if</span>&nbsp;<span class="ident" id="4307451">err</span>&nbsp;<span class="op" id="4307455">!=</span>&nbsp;<span class="ident" id="4307458">nil</span>&nbsp;<span class="op" id="4307462">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307466">return</span>&nbsp;<span class="ident" id="4307473">nil</span><span class="op" id="4307476">,</span>&nbsp;<span class="ident" id="4307478">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4307483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307486">if</span>&nbsp;<span class="builtinfunc" id="4307489">len</span><span class="op" id="4307492">(</span><span class="ident" id="4307493">iv</span><span class="op" id="4307495">)</span>&nbsp;<span class="op" id="4307497">!=</span>&nbsp;<span class="ident" id="4307500">ciph</span><span class="op" id="4307504">.</span><span class="ident" id="4307505">blockSize</span>&nbsp;<span class="op" id="4307515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307519">return</span>&nbsp;<span class="ident" id="4307526">nil</span><span class="op" id="4307529">,</span>&nbsp;<span class="ident" id="4307531">errors</span><span class="op" id="4307537">.</span><span class="ident" id="4307538">New</span><span class="op" id="4307541">(</span><span class="string" id="4307542">&#34;x509:&nbsp;incorrect&nbsp;IV&nbsp;size&#34;</span><span class="op" id="4307567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4307570">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4307574">//&nbsp;Based&nbsp;on&nbsp;the&nbsp;OpenSSL&nbsp;implementation.&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4307645">//&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307679">key</span>&nbsp;<span class="op" id="4307683">:=</span>&nbsp;<span class="ident" id="4307686">ciph</span><span class="op" id="4307690">.</span><span class="ident" id="4307691">deriveKey</span><span class="op" id="4307700">(</span><span class="ident" id="4307701">password</span><span class="op" id="4307709">,</span>&nbsp;<span class="ident" id="4307711">iv</span><span class="op" id="4307713">[</span><span class="op" id="4307714">:</span><span class="num" id="4307715">8</span><span class="op" id="4307716">]</span><span class="op" id="4307717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307720">block</span><span class="op" id="4307725">,</span>&nbsp;<span class="ident" id="4307727">err</span>&nbsp;<span class="op" id="4307731">:=</span>&nbsp;<span class="ident" id="4307734">ciph</span><span class="op" id="4307738">.</span><span class="ident" id="4307739">cipherFunc</span><span class="op" id="4307749">(</span><span class="ident" id="4307750">key</span><span class="op" id="4307753">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307756">if</span>&nbsp;<span class="ident" id="4307759">err</span>&nbsp;<span class="op" id="4307763">!=</span>&nbsp;<span class="ident" id="4307766">nil</span>&nbsp;<span class="op" id="4307770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307774">return</span>&nbsp;<span class="ident" id="4307781">nil</span><span class="op" id="4307784">,</span>&nbsp;<span class="ident" id="4307786">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4307791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307795">data</span>&nbsp;<span class="op" id="4307800">:=</span>&nbsp;<span class="builtinfunc" id="4307803">make</span><span class="op" id="4307807">(</span><span class="op" id="4307808">[</span><span class="op" id="4307809">]</span><span class="builtintype" id="4307810">byte</span><span class="op" id="4307814">,</span>&nbsp;<span class="builtinfunc" id="4307816">len</span><span class="op" id="4307819">(</span><span class="ident" id="4307820">b</span><span class="op" id="4307821">.</span><span class="ident" id="4307822">Bytes</span><span class="op" id="4307827">)</span><span class="op" id="4307828">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307831">dec</span>&nbsp;<span class="op" id="4307835">:=</span>&nbsp;<span class="ident" id="4307838">cipher</span><span class="op" id="4307844">.</span><span class="ident" id="4307845">NewCBCDecrypter</span><span class="op" id="4307860">(</span><span class="ident" id="4307861">block</span><span class="op" id="4307866">,</span>&nbsp;<span class="ident" id="4307868">iv</span><span class="op" id="4307870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307873">dec</span><span class="op" id="4307876">.</span><span class="ident" id="4307877">CryptBlocks</span><span class="op" id="4307888">(</span><span class="ident" id="4307889">data</span><span class="op" id="4307893">,</span>&nbsp;<span class="ident" id="4307895">b</span><span class="op" id="4307896">.</span><span class="ident" id="4307897">Bytes</span><span class="op" id="4307902">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4307906">//&nbsp;Blocks&nbsp;are&nbsp;padded&nbsp;using&nbsp;a&nbsp;scheme&nbsp;where&nbsp;the&nbsp;last&nbsp;n&nbsp;bytes&nbsp;of&nbsp;padding&nbsp;are&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4307985">//&nbsp;equal&nbsp;to&nbsp;n.&nbsp;It&nbsp;can&nbsp;pad&nbsp;from&nbsp;1&nbsp;to&nbsp;blocksize&nbsp;bytes&nbsp;inclusive.&nbsp;See&nbsp;RFC&nbsp;1423.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4308063">//&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4308080">//&nbsp;&nbsp;&nbsp;&nbsp[x&nbsp;y&nbsp;z&nbsp;2&nbsp;2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4308096">//&nbsp;&nbsp;&nbsp;&nbsp[x&nbsp;y&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4308120">//&nbsp;If&nbsp;we&nbsp;detect&nbsp;a&nbsp;bad&nbsp;padding,&nbsp;we&nbsp;assume&nbsp;it&nbsp;is&nbsp;an&nbsp;invalid&nbsp;password.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308189">dlen</span>&nbsp;<span class="op" id="4308194">:=</span>&nbsp;<span class="builtinfunc" id="4308197">len</span><span class="op" id="4308200">(</span><span class="ident" id="4308201">data</span><span class="op" id="4308205">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308208">if</span>&nbsp;<span class="ident" id="4308211">dlen</span>&nbsp;<span class="op" id="4308216">==</span>&nbsp;<span class="num" id="4308219">0</span>&nbsp;<span class="op" id="4308221">||</span>&nbsp;<span class="ident" id="4308224">dlen</span><span class="op" id="4308228">%</span><span class="ident" id="4308229">ciph</span><span class="op" id="4308233">.</span><span class="ident" id="4308234">blockSize</span>&nbsp;<span class="op" id="4308244">!=</span>&nbsp;<span class="num" id="4308247">0</span>&nbsp;<span class="op" id="4308249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308253">return</span>&nbsp;<span class="ident" id="4308260">nil</span><span class="op" id="4308263">,</span>&nbsp;<span class="ident" id="4308265">errors</span><span class="op" id="4308271">.</span><span class="ident" id="4308272">New</span><span class="op" id="4308275">(</span><span class="string" id="4308276">&#34;x509:&nbsp;invalid&nbsp;padding&#34;</span><span class="op" id="4308299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4308302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308305">last</span>&nbsp;<span class="op" id="4308310">:=</span>&nbsp;<span class="builtintype" id="4308313">int</span><span class="op" id="4308316">(</span><span class="ident" id="4308317">data</span><span class="op" id="4308321">[</span><span class="ident" id="4308322">dlen</span><span class="op" id="4308326">-</span><span class="num" id="4308327">1</span><span class="op" id="4308328">]</span><span class="op" id="4308329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308332">if</span>&nbsp;<span class="ident" id="4308335">dlen</span>&nbsp;<span class="op" id="4308340">&lt;</span>&nbsp;<span class="ident" id="4308342">last</span>&nbsp;<span class="op" id="4308347">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308351">return</span>&nbsp;<span class="ident" id="4308358">nil</span><span class="op" id="4308361">,</span>&nbsp;<span class="ident" id="4308363">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4308387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308390">if</span>&nbsp;<span class="ident" id="4308393">last</span>&nbsp;<span class="op" id="4308398">==</span>&nbsp;<span class="num" id="4308401">0</span>&nbsp;<span class="op" id="4308403">||</span>&nbsp;<span class="ident" id="4308406">last</span>&nbsp;<span class="op" id="4308411">&gt;</span>&nbsp;<span class="ident" id="4308413">ciph</span><span class="op" id="4308417">.</span><span class="ident" id="4308418">blockSize</span>&nbsp;<span class="op" id="4308428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308432">return</span>&nbsp;<span class="ident" id="4308439">nil</span><span class="op" id="4308442">,</span>&nbsp;<span class="ident" id="4308444">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4308468">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308471">for</span>&nbsp;<span class="ident" id="4308475">_</span><span class="op" id="4308476">,</span>&nbsp;<span class="ident" id="4308478">val</span>&nbsp;<span class="op" id="4308482">:=</span>&nbsp;<span class="keyword" id="4308485">range</span>&nbsp;<span class="ident" id="4308491">data</span><span class="op" id="4308495">[</span><span class="ident" id="4308496">dlen</span><span class="op" id="4308500">-</span><span class="ident" id="4308501">last</span><span class="op" id="4308505">:</span><span class="op" id="4308506">]</span>&nbsp;<span class="op" id="4308508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308512">if</span>&nbsp;<span class="builtintype" id="4308515">int</span><span class="op" id="4308518">(</span><span class="ident" id="4308519">val</span><span class="op" id="4308522">)</span>&nbsp;<span class="op" id="4308524">!=</span>&nbsp;<span class="ident" id="4308527">last</span>&nbsp;<span class="op" id="4308532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308537">return</span>&nbsp;<span class="ident" id="4308544">nil</span><span class="op" id="4308547">,</span>&nbsp;<span class="ident" id="4308549">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4308574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4308577">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308580">return</span>&nbsp;<span class="ident" id="4308587">data</span><span class="op" id="4308591">[</span><span class="op" id="4308592">:</span><span class="ident" id="4308593">dlen</span><span class="op" id="4308597">-</span><span class="ident" id="4308598">last</span><span class="op" id="4308602">]</span><span class="op" id="4308603">,</span>&nbsp;<span class="ident" id="4308605">nil</span><br>
<span class="lineno"></span><span class="op" id="4308609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4308612">//&nbsp;EncryptPEMBlock&nbsp;returns&nbsp;a&nbsp;PEM&nbsp;block&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;holding&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4308685">//&nbsp;given&nbsp;DER-encoded&nbsp;data&nbsp;encrypted&nbsp;with&nbsp;the&nbsp;specified&nbsp;algorithm&nbsp;and</span><br>
<span class="lineno">175</span><span class="comment" id="4308754">//&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="4308767">func</span>&nbsp;<span class="ident" id="4308772">EncryptPEMBlock</span><span class="op" id="4308787">(</span><span class="ident" id="4308788">rand</span>&nbsp;<span class="ident" id="4308793">io</span><span class="op" id="4308795">.</span><span class="ident" id="4308796">Reader</span><span class="op" id="4308802">,</span>&nbsp;<span class="ident" id="4308804">blockType</span>&nbsp;<span class="builtintype" id="4308814">string</span><span class="op" id="4308820">,</span>&nbsp;<span class="ident" id="4308822">data</span><span class="op" id="4308826">,</span>&nbsp;<span class="ident" id="4308828">password</span>&nbsp;<span class="op" id="4308837">[</span><span class="op" id="4308838">]</span><span class="builtintype" id="4308839">byte</span><span class="op" id="4308843">,</span>&nbsp;<span class="ident" id="4308845">alg</span>&nbsp;<span class="ident" id="4308849">PEMCipher</span><span class="op" id="4308858">)</span>&nbsp;<span class="op" id="4308860">(</span><span class="op" id="4308861">*</span><span class="ident" id="4308862">pem</span><span class="op" id="4308865">.</span><span class="ident" id="4308866">Block</span><span class="op" id="4308871">,</span>&nbsp;<span class="builtintype" id="4308873">error</span><span class="op" id="4308878">)</span>&nbsp;<span class="op" id="4308880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308883">ciph</span>&nbsp;<span class="op" id="4308888">:=</span>&nbsp;<span class="ident" id="4308891">cipherByKey</span><span class="op" id="4308902">(</span><span class="ident" id="4308903">alg</span><span class="op" id="4308906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308909">if</span>&nbsp;<span class="ident" id="4308912">ciph</span>&nbsp;<span class="op" id="4308917">==</span>&nbsp;<span class="ident" id="4308920">nil</span>&nbsp;<span class="op" id="4308924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308928">return</span>&nbsp;<span class="ident" id="4308935">nil</span><span class="op" id="4308938">,</span>&nbsp;<span class="ident" id="4308940">errors</span><span class="op" id="4308946">.</span><span class="ident" id="4308947">New</span><span class="op" id="4308950">(</span><span class="string" id="4308951">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="4308982">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4308985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308988">iv</span>&nbsp;<span class="op" id="4308991">:=</span>&nbsp;<span class="builtinfunc" id="4308994">make</span><span class="op" id="4308998">(</span><span class="op" id="4308999">[</span><span class="op" id="4309000">]</span><span class="builtintype" id="4309001">byte</span><span class="op" id="4309005">,</span>&nbsp;<span class="ident" id="4309007">ciph</span><span class="op" id="4309011">.</span><span class="ident" id="4309012">blockSize</span><span class="op" id="4309021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309024">if</span>&nbsp;<span class="ident" id="4309027">_</span><span class="op" id="4309028">,</span>&nbsp;<span class="ident" id="4309030">err</span>&nbsp;<span class="op" id="4309034">:=</span>&nbsp;<span class="ident" id="4309037">io</span><span class="op" id="4309039">.</span><span class="ident" id="4309040">ReadFull</span><span class="op" id="4309048">(</span><span class="ident" id="4309049">rand</span><span class="op" id="4309053">,</span>&nbsp;<span class="ident" id="4309055">iv</span><span class="op" id="4309057">)</span><span class="op" id="4309058">;</span>&nbsp;<span class="ident" id="4309060">err</span>&nbsp;<span class="op" id="4309064">!=</span>&nbsp;<span class="ident" id="4309067">nil</span>&nbsp;<span class="op" id="4309071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309075">return</span>&nbsp;<span class="ident" id="4309082">nil</span><span class="op" id="4309085">,</span>&nbsp;<span class="ident" id="4309087">errors</span><span class="op" id="4309093">.</span><span class="ident" id="4309094">New</span><span class="op" id="4309097">(</span><span class="string" id="4309098">&#34;x509:&nbsp;cannot&nbsp;generate&nbsp;IV:&nbsp;&#34;</span>&nbsp;<span class="op" id="4309127">+</span>&nbsp;<span class="ident" id="4309129">err</span><span class="op" id="4309132">.</span><span class="ident" id="4309133">Error</span><span class="op" id="4309138">(</span><span class="op" id="4309139">)</span><span class="op" id="4309140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4309143">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4309146">//&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4309210">//&nbsp;matching&nbsp;the&nbsp;key&nbsp;derivation&nbsp;in&nbsp;DecryptPEMBlock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309262">key</span>&nbsp;<span class="op" id="4309266">:=</span>&nbsp;<span class="ident" id="4309269">ciph</span><span class="op" id="4309273">.</span><span class="ident" id="4309274">deriveKey</span><span class="op" id="4309283">(</span><span class="ident" id="4309284">password</span><span class="op" id="4309292">,</span>&nbsp;<span class="ident" id="4309294">iv</span><span class="op" id="4309296">[</span><span class="op" id="4309297">:</span><span class="num" id="4309298">8</span><span class="op" id="4309299">]</span><span class="op" id="4309300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309303">block</span><span class="op" id="4309308">,</span>&nbsp;<span class="ident" id="4309310">err</span>&nbsp;<span class="op" id="4309314">:=</span>&nbsp;<span class="ident" id="4309317">ciph</span><span class="op" id="4309321">.</span><span class="ident" id="4309322">cipherFunc</span><span class="op" id="4309332">(</span><span class="ident" id="4309333">key</span><span class="op" id="4309336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309339">if</span>&nbsp;<span class="ident" id="4309342">err</span>&nbsp;<span class="op" id="4309346">!=</span>&nbsp;<span class="ident" id="4309349">nil</span>&nbsp;<span class="op" id="4309353">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309357">return</span>&nbsp;<span class="ident" id="4309364">nil</span><span class="op" id="4309367">,</span>&nbsp;<span class="ident" id="4309369">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4309374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309377">enc</span>&nbsp;<span class="op" id="4309381">:=</span>&nbsp;<span class="ident" id="4309384">cipher</span><span class="op" id="4309390">.</span><span class="ident" id="4309391">NewCBCEncrypter</span><span class="op" id="4309406">(</span><span class="ident" id="4309407">block</span><span class="op" id="4309412">,</span>&nbsp;<span class="ident" id="4309414">iv</span><span class="op" id="4309416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309419">pad</span>&nbsp;<span class="op" id="4309423">:=</span>&nbsp;<span class="ident" id="4309426">ciph</span><span class="op" id="4309430">.</span><span class="ident" id="4309431">blockSize</span>&nbsp;<span class="op" id="4309441">-</span>&nbsp;<span class="builtinfunc" id="4309443">len</span><span class="op" id="4309446">(</span><span class="ident" id="4309447">data</span><span class="op" id="4309451">)</span><span class="op" id="4309452">%</span><span class="ident" id="4309453">ciph</span><span class="op" id="4309457">.</span><span class="ident" id="4309458">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309469">encrypted</span>&nbsp;<span class="op" id="4309479">:=</span>&nbsp;<span class="builtinfunc" id="4309482">make</span><span class="op" id="4309486">(</span><span class="op" id="4309487">[</span><span class="op" id="4309488">]</span><span class="builtintype" id="4309489">byte</span><span class="op" id="4309493">,</span>&nbsp;<span class="builtinfunc" id="4309495">len</span><span class="op" id="4309498">(</span><span class="ident" id="4309499">data</span><span class="op" id="4309503">)</span><span class="op" id="4309504">,</span>&nbsp;<span class="builtinfunc" id="4309506">len</span><span class="op" id="4309509">(</span><span class="ident" id="4309510">data</span><span class="op" id="4309514">)</span><span class="op" id="4309515">+</span><span class="ident" id="4309516">pad</span><span class="op" id="4309519">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4309522">//&nbsp;We&nbsp;could&nbsp;save&nbsp;this&nbsp;copy&nbsp;by&nbsp;encrypting&nbsp;all&nbsp;the&nbsp;whole&nbsp;blocks&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4309588">//&nbsp;the&nbsp;data&nbsp;separately,&nbsp;but&nbsp;it&nbsp;doesn&#39;t&nbsp;seem&nbsp;worth&nbsp;the&nbsp;additional</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4309654">//&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4309664">copy</span><span class="op" id="4309668">(</span><span class="ident" id="4309669">encrypted</span><span class="op" id="4309678">,</span>&nbsp;<span class="ident" id="4309680">data</span><span class="op" id="4309684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4309687">//&nbsp;See&nbsp;RFC&nbsp;1423,&nbsp;section&nbsp;1.1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309717">for</span>&nbsp;<span class="ident" id="4309721">i</span>&nbsp;<span class="op" id="4309723">:=</span>&nbsp;<span class="num" id="4309726">0</span><span class="op" id="4309727">;</span>&nbsp;<span class="ident" id="4309729">i</span>&nbsp;<span class="op" id="4309731">&lt;</span>&nbsp;<span class="ident" id="4309733">pad</span><span class="op" id="4309736">;</span>&nbsp;<span class="ident" id="4309738">i</span><span class="op" id="4309739">++</span>&nbsp;<span class="op" id="4309742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309746">encrypted</span>&nbsp;<span class="op" id="4309756">=</span>&nbsp;<span class="builtinfunc" id="4309758">append</span><span class="op" id="4309764">(</span><span class="ident" id="4309765">encrypted</span><span class="op" id="4309774">,</span>&nbsp;<span class="builtintype" id="4309776">byte</span><span class="op" id="4309780">(</span><span class="ident" id="4309781">pad</span><span class="op" id="4309784">)</span><span class="op" id="4309785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4309788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309791">enc</span><span class="op" id="4309794">.</span><span class="ident" id="4309795">CryptBlocks</span><span class="op" id="4309806">(</span><span class="ident" id="4309807">encrypted</span><span class="op" id="4309816">,</span>&nbsp;<span class="ident" id="4309818">encrypted</span><span class="op" id="4309827">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309831">return</span>&nbsp;<span class="op" id="4309838">&amp;</span><span class="ident" id="4309839">pem</span><span class="op" id="4309842">.</span><span class="ident" id="4309843">Block</span><span class="op" id="4309848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309852">Type</span><span class="op" id="4309856">:</span>&nbsp;<span class="ident" id="4309858">blockType</span><span class="op" id="4309867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309871">Headers</span><span class="op" id="4309878">:</span>&nbsp;<span class="keyword" id="4309880">map</span><span class="op" id="4309883">[</span><span class="builtintype" id="4309884">string</span><span class="op" id="4309890">]</span><span class="builtintype" id="4309891">string</span><span class="op" id="4309897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4309902">&#34;Proc-Type&#34;</span><span class="op" id="4309913">:</span>&nbsp;<span class="string" id="4309915">&#34;4,ENCRYPTED&#34;</span><span class="op" id="4309928">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4309933">&#34;DEK-Info&#34;</span><span class="op" id="4309943">:</span>&nbsp;&nbsp;<span class="ident" id="4309946">ciph</span><span class="op" id="4309950">.</span><span class="ident" id="4309951">name</span>&nbsp;<span class="op" id="4309956">+</span>&nbsp;<span class="string" id="4309958">&#34;,&#34;</span>&nbsp;<span class="op" id="4309962">+</span>&nbsp;<span class="ident" id="4309964">hex</span><span class="op" id="4309967">.</span><span class="ident" id="4309968">EncodeToString</span><span class="op" id="4309982">(</span><span class="ident" id="4309983">iv</span><span class="op" id="4309985">)</span><span class="op" id="4309986">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4309990">}</span><span class="op" id="4309991">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309995">Bytes</span><span class="op" id="4310000">:</span>&nbsp;<span class="ident" id="4310002">encrypted</span><span class="op" id="4310011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4310014">}</span><span class="op" id="4310015">,</span>&nbsp;<span class="ident" id="4310017">nil</span><br>
<span class="lineno"></span><span class="op" id="4310021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="4310024">func</span>&nbsp;<span class="ident" id="4310029">cipherByName</span><span class="op" id="4310041">(</span><span class="ident" id="4310042">name</span>&nbsp;<span class="builtintype" id="4310047">string</span><span class="op" id="4310053">)</span>&nbsp;<span class="op" id="4310055">*</span><span class="ident" id="4310056">rfc1423Algo</span>&nbsp;<span class="op" id="4310068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310071">for</span>&nbsp;<span class="ident" id="4310075">i</span>&nbsp;<span class="op" id="4310077">:=</span>&nbsp;<span class="keyword" id="4310080">range</span>&nbsp;<span class="ident" id="4310086">rfc1423Algos</span>&nbsp;<span class="op" id="4310099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310103">alg</span>&nbsp;<span class="op" id="4310107">:=</span>&nbsp;<span class="op" id="4310110">&amp;</span><span class="ident" id="4310111">rfc1423Algos</span><span class="op" id="4310123">[</span><span class="ident" id="4310124">i</span><span class="op" id="4310125">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310129">if</span>&nbsp;<span class="ident" id="4310132">alg</span><span class="op" id="4310135">.</span><span class="ident" id="4310136">name</span>&nbsp;<span class="op" id="4310141">==</span>&nbsp;<span class="ident" id="4310144">name</span>&nbsp;<span class="op" id="4310149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310154">return</span>&nbsp;<span class="ident" id="4310161">alg</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4310167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4310170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310173">return</span>&nbsp;<span class="ident" id="4310180">nil</span><br>
<span class="lineno"></span><span class="op" id="4310184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="4310187">func</span>&nbsp;<span class="ident" id="4310192">cipherByKey</span><span class="op" id="4310203">(</span><span class="ident" id="4310204">key</span>&nbsp;<span class="ident" id="4310208">PEMCipher</span><span class="op" id="4310217">)</span>&nbsp;<span class="op" id="4310219">*</span><span class="ident" id="4310220">rfc1423Algo</span>&nbsp;<span class="op" id="4310232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310235">for</span>&nbsp;<span class="ident" id="4310239">i</span>&nbsp;<span class="op" id="4310241">:=</span>&nbsp;<span class="keyword" id="4310244">range</span>&nbsp;<span class="ident" id="4310250">rfc1423Algos</span>&nbsp;<span class="op" id="4310263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310267">alg</span>&nbsp;<span class="op" id="4310271">:=</span>&nbsp;<span class="op" id="4310274">&amp;</span><span class="ident" id="4310275">rfc1423Algos</span><span class="op" id="4310287">[</span><span class="ident" id="4310288">i</span><span class="op" id="4310289">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310293">if</span>&nbsp;<span class="ident" id="4310296">alg</span><span class="op" id="4310299">.</span><span class="ident" id="4310300">cipher</span>&nbsp;<span class="op" id="4310307">==</span>&nbsp;<span class="ident" id="4310310">key</span>&nbsp;<span class="op" id="4310314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310319">return</span>&nbsp;<span class="ident" id="4310326">alg</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4310332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4310335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310338">return</span>&nbsp;<span class="ident" id="4310345">nil</span><br>
<span class="lineno"></span><span class="op" id="4310349">}</span>
</div>
</body>
</html>
