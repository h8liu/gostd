<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html" class="current">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6483233">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6483289">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6483343">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6483394">package</span>&nbsp;<span class="ident" id="6483402">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6483407">import</span>&nbsp;<span class="op" id="6483414">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6483417">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6483426">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6483433">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6483439">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6483450">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6483461">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6483472">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6483479">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6483482">type</span>&nbsp;<span class="ident" id="6483487">resolveIPAddrTest</span>&nbsp;<span class="keyword" id="6483505">struct</span>&nbsp;<span class="op" id="6483512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6483515">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6483529">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6483537">litAddrOrName</span>&nbsp;<span class="builtintype" id="6483551">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6483559">addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6483573">*</span><span class="ident" id="6483574">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6483582">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6483596">error</span><br>
<span class="lineno"></span><span class="op" id="6483602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6483605">var</span>&nbsp;<span class="ident" id="6483609">resolveIPAddrTests</span>&nbsp;<span class="op" id="6483628">=</span>&nbsp;<span class="op" id="6483630">[</span><span class="op" id="6483631">]</span><span class="ident" id="6483632">resolveIPAddrTest</span><span class="op" id="6483649">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6483652">{</span><span class="string" id="6483653">&#34;ip&#34;</span><span class="op" id="6483657">,</span>&nbsp;<span class="string" id="6483659">&#34;127.0.0.1&#34;</span><span class="op" id="6483670">,</span>&nbsp;<span class="op" id="6483672">&amp;</span><span class="ident" id="6483673">IPAddr</span><span class="op" id="6483679">{</span><span class="ident" id="6483680">IP</span><span class="op" id="6483682">:</span>&nbsp;<span class="ident" id="6483684">IPv4</span><span class="op" id="6483688">(</span><span class="num" id="6483689">127</span><span class="op" id="6483692">,</span>&nbsp;<span class="num" id="6483694">0</span><span class="op" id="6483695">,</span>&nbsp;<span class="num" id="6483697">0</span><span class="op" id="6483698">,</span>&nbsp;<span class="num" id="6483700">1</span><span class="op" id="6483701">)</span><span class="op" id="6483702">}</span><span class="op" id="6483703">,</span>&nbsp;<span class="builtintype" id="6483705">nil</span><span class="op" id="6483708">}</span><span class="op" id="6483709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6483712">{</span><span class="string" id="6483713">&#34;ip4&#34;</span><span class="op" id="6483718">,</span>&nbsp;<span class="string" id="6483720">&#34;127.0.0.1&#34;</span><span class="op" id="6483731">,</span>&nbsp;<span class="op" id="6483733">&amp;</span><span class="ident" id="6483734">IPAddr</span><span class="op" id="6483740">{</span><span class="ident" id="6483741">IP</span><span class="op" id="6483743">:</span>&nbsp;<span class="ident" id="6483745">IPv4</span><span class="op" id="6483749">(</span><span class="num" id="6483750">127</span><span class="op" id="6483753">,</span>&nbsp;<span class="num" id="6483755">0</span><span class="op" id="6483756">,</span>&nbsp;<span class="num" id="6483758">0</span><span class="op" id="6483759">,</span>&nbsp;<span class="num" id="6483761">1</span><span class="op" id="6483762">)</span><span class="op" id="6483763">}</span><span class="op" id="6483764">,</span>&nbsp;<span class="builtintype" id="6483766">nil</span><span class="op" id="6483769">}</span><span class="op" id="6483770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6483773">{</span><span class="string" id="6483774">&#34;ip4:icmp&#34;</span><span class="op" id="6483784">,</span>&nbsp;<span class="string" id="6483786">&#34;127.0.0.1&#34;</span><span class="op" id="6483797">,</span>&nbsp;<span class="op" id="6483799">&amp;</span><span class="ident" id="6483800">IPAddr</span><span class="op" id="6483806">{</span><span class="ident" id="6483807">IP</span><span class="op" id="6483809">:</span>&nbsp;<span class="ident" id="6483811">IPv4</span><span class="op" id="6483815">(</span><span class="num" id="6483816">127</span><span class="op" id="6483819">,</span>&nbsp;<span class="num" id="6483821">0</span><span class="op" id="6483822">,</span>&nbsp;<span class="num" id="6483824">0</span><span class="op" id="6483825">,</span>&nbsp;<span class="num" id="6483827">1</span><span class="op" id="6483828">)</span><span class="op" id="6483829">}</span><span class="op" id="6483830">,</span>&nbsp;<span class="builtintype" id="6483832">nil</span><span class="op" id="6483835">}</span><span class="op" id="6483836">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6483840">{</span><span class="string" id="6483841">&#34;ip&#34;</span><span class="op" id="6483845">,</span>&nbsp;<span class="string" id="6483847">&#34;::1&#34;</span><span class="op" id="6483852">,</span>&nbsp;<span class="op" id="6483854">&amp;</span><span class="ident" id="6483855">IPAddr</span><span class="op" id="6483861">{</span><span class="ident" id="6483862">IP</span><span class="op" id="6483864">:</span>&nbsp;<span class="ident" id="6483866">ParseIP</span><span class="op" id="6483873">(</span><span class="string" id="6483874">&#34;::1&#34;</span><span class="op" id="6483879">)</span><span class="op" id="6483880">}</span><span class="op" id="6483881">,</span>&nbsp;<span class="builtintype" id="6483883">nil</span><span class="op" id="6483886">}</span><span class="op" id="6483887">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6483890">{</span><span class="string" id="6483891">&#34;ip6&#34;</span><span class="op" id="6483896">,</span>&nbsp;<span class="string" id="6483898">&#34;::1&#34;</span><span class="op" id="6483903">,</span>&nbsp;<span class="op" id="6483905">&amp;</span><span class="ident" id="6483906">IPAddr</span><span class="op" id="6483912">{</span><span class="ident" id="6483913">IP</span><span class="op" id="6483915">:</span>&nbsp;<span class="ident" id="6483917">ParseIP</span><span class="op" id="6483924">(</span><span class="string" id="6483925">&#34;::1&#34;</span><span class="op" id="6483930">)</span><span class="op" id="6483931">}</span><span class="op" id="6483932">,</span>&nbsp;<span class="builtintype" id="6483934">nil</span><span class="op" id="6483937">}</span><span class="op" id="6483938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6483941">{</span><span class="string" id="6483942">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="6483957">,</span>&nbsp;<span class="string" id="6483959">&#34;::1&#34;</span><span class="op" id="6483964">,</span>&nbsp;<span class="op" id="6483966">&amp;</span><span class="ident" id="6483967">IPAddr</span><span class="op" id="6483973">{</span><span class="ident" id="6483974">IP</span><span class="op" id="6483976">:</span>&nbsp;<span class="ident" id="6483978">ParseIP</span><span class="op" id="6483985">(</span><span class="string" id="6483986">&#34;::1&#34;</span><span class="op" id="6483991">)</span><span class="op" id="6483992">}</span><span class="op" id="6483993">,</span>&nbsp;<span class="builtintype" id="6483995">nil</span><span class="op" id="6483998">}</span><span class="op" id="6483999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6484002">{</span><span class="string" id="6484003">&#34;ip6:IPv6-ICMP&#34;</span><span class="op" id="6484018">,</span>&nbsp;<span class="string" id="6484020">&#34;::1&#34;</span><span class="op" id="6484025">,</span>&nbsp;<span class="op" id="6484027">&amp;</span><span class="ident" id="6484028">IPAddr</span><span class="op" id="6484034">{</span><span class="ident" id="6484035">IP</span><span class="op" id="6484037">:</span>&nbsp;<span class="ident" id="6484039">ParseIP</span><span class="op" id="6484046">(</span><span class="string" id="6484047">&#34;::1&#34;</span><span class="op" id="6484052">)</span><span class="op" id="6484053">}</span><span class="op" id="6484054">,</span>&nbsp;<span class="builtintype" id="6484056">nil</span><span class="op" id="6484059">}</span><span class="op" id="6484060">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6484064">{</span><span class="string" id="6484065">&#34;ip&#34;</span><span class="op" id="6484069">,</span>&nbsp;<span class="string" id="6484071">&#34;::1%en0&#34;</span><span class="op" id="6484080">,</span>&nbsp;<span class="op" id="6484082">&amp;</span><span class="ident" id="6484083">IPAddr</span><span class="op" id="6484089">{</span><span class="ident" id="6484090">IP</span><span class="op" id="6484092">:</span>&nbsp;<span class="ident" id="6484094">ParseIP</span><span class="op" id="6484101">(</span><span class="string" id="6484102">&#34;::1&#34;</span><span class="op" id="6484107">)</span><span class="op" id="6484108">,</span>&nbsp;<span class="ident" id="6484110">Zone</span><span class="op" id="6484114">:</span>&nbsp;<span class="string" id="6484116">&#34;en0&#34;</span><span class="op" id="6484121">}</span><span class="op" id="6484122">,</span>&nbsp;<span class="builtintype" id="6484124">nil</span><span class="op" id="6484127">}</span><span class="op" id="6484128">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6484131">{</span><span class="string" id="6484132">&#34;ip6&#34;</span><span class="op" id="6484137">,</span>&nbsp;<span class="string" id="6484139">&#34;::1%911&#34;</span><span class="op" id="6484148">,</span>&nbsp;<span class="op" id="6484150">&amp;</span><span class="ident" id="6484151">IPAddr</span><span class="op" id="6484157">{</span><span class="ident" id="6484158">IP</span><span class="op" id="6484160">:</span>&nbsp;<span class="ident" id="6484162">ParseIP</span><span class="op" id="6484169">(</span><span class="string" id="6484170">&#34;::1&#34;</span><span class="op" id="6484175">)</span><span class="op" id="6484176">,</span>&nbsp;<span class="ident" id="6484178">Zone</span><span class="op" id="6484182">:</span>&nbsp;<span class="string" id="6484184">&#34;911&#34;</span><span class="op" id="6484189">}</span><span class="op" id="6484190">,</span>&nbsp;<span class="builtintype" id="6484192">nil</span><span class="op" id="6484195">}</span><span class="op" id="6484196">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6484200">{</span><span class="string" id="6484201">&#34;&#34;</span><span class="op" id="6484203">,</span>&nbsp;<span class="string" id="6484205">&#34;127.0.0.1&#34;</span><span class="op" id="6484216">,</span>&nbsp;<span class="op" id="6484218">&amp;</span><span class="ident" id="6484219">IPAddr</span><span class="op" id="6484225">{</span><span class="ident" id="6484226">IP</span><span class="op" id="6484228">:</span>&nbsp;<span class="ident" id="6484230">IPv4</span><span class="op" id="6484234">(</span><span class="num" id="6484235">127</span><span class="op" id="6484238">,</span>&nbsp;<span class="num" id="6484240">0</span><span class="op" id="6484241">,</span>&nbsp;<span class="num" id="6484243">0</span><span class="op" id="6484244">,</span>&nbsp;<span class="num" id="6484246">1</span><span class="op" id="6484247">)</span><span class="op" id="6484248">}</span><span class="op" id="6484249">,</span>&nbsp;<span class="builtintype" id="6484251">nil</span><span class="op" id="6484254">}</span><span class="op" id="6484255">,</span>&nbsp;<span class="comment" id="6484257">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6484277">{</span><span class="string" id="6484278">&#34;&#34;</span><span class="op" id="6484280">,</span>&nbsp;<span class="string" id="6484282">&#34;::1&#34;</span><span class="op" id="6484287">,</span>&nbsp;<span class="op" id="6484289">&amp;</span><span class="ident" id="6484290">IPAddr</span><span class="op" id="6484296">{</span><span class="ident" id="6484297">IP</span><span class="op" id="6484299">:</span>&nbsp;<span class="ident" id="6484301">ParseIP</span><span class="op" id="6484308">(</span><span class="string" id="6484309">&#34;::1&#34;</span><span class="op" id="6484314">)</span><span class="op" id="6484315">}</span><span class="op" id="6484316">,</span>&nbsp;<span class="builtintype" id="6484318">nil</span><span class="op" id="6484321">}</span><span class="op" id="6484322">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6484334">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6484355">{</span><span class="string" id="6484356">&#34;l2tp&#34;</span><span class="op" id="6484362">,</span>&nbsp;<span class="string" id="6484364">&#34;127.0.0.1&#34;</span><span class="op" id="6484375">,</span>&nbsp;<span class="builtintype" id="6484377">nil</span><span class="op" id="6484380">,</span>&nbsp;<span class="ident" id="6484382">UnknownNetworkError</span><span class="op" id="6484401">(</span><span class="string" id="6484402">&#34;l2tp&#34;</span><span class="op" id="6484408">)</span><span class="op" id="6484409">}</span><span class="op" id="6484410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6484413">{</span><span class="string" id="6484414">&#34;l2tp:gre&#34;</span><span class="op" id="6484424">,</span>&nbsp;<span class="string" id="6484426">&#34;127.0.0.1&#34;</span><span class="op" id="6484437">,</span>&nbsp;<span class="builtintype" id="6484439">nil</span><span class="op" id="6484442">,</span>&nbsp;<span class="ident" id="6484444">UnknownNetworkError</span><span class="op" id="6484463">(</span><span class="string" id="6484464">&#34;l2tp:gre&#34;</span><span class="op" id="6484474">)</span><span class="op" id="6484475">}</span><span class="op" id="6484476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6484479">{</span><span class="string" id="6484480">&#34;tcp&#34;</span><span class="op" id="6484485">,</span>&nbsp;<span class="string" id="6484487">&#34;1.2.3.4:123&#34;</span><span class="op" id="6484500">,</span>&nbsp;<span class="builtintype" id="6484502">nil</span><span class="op" id="6484505">,</span>&nbsp;<span class="ident" id="6484507">UnknownNetworkError</span><span class="op" id="6484526">(</span><span class="string" id="6484527">&#34;tcp&#34;</span><span class="op" id="6484532">)</span><span class="op" id="6484533">}</span><span class="op" id="6484534">,</span><br>
<span class="lineno"></span><span class="op" id="6484536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="6484539">func</span>&nbsp;<span class="ident" id="6484544">init</span><span class="op" id="6484548">(</span><span class="op" id="6484549">)</span>&nbsp;<span class="op" id="6484551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6484554">if</span>&nbsp;<span class="ident" id="6484557">ifi</span>&nbsp;<span class="op" id="6484561">:=</span>&nbsp;<span class="ident" id="6484564">loopbackInterface</span><span class="op" id="6484581">(</span><span class="op" id="6484582">)</span><span class="op" id="6484583">;</span>&nbsp;<span class="ident" id="6484585">ifi</span>&nbsp;<span class="op" id="6484589">!=</span>&nbsp;<span class="builtintype" id="6484592">nil</span>&nbsp;<span class="op" id="6484596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6484600">index</span>&nbsp;<span class="op" id="6484606">:=</span>&nbsp;<span class="ident" id="6484609">fmt</span><span class="op" id="6484612">.</span><span class="ident" id="6484613">Sprintf</span><span class="op" id="6484620">(</span><span class="string" id="6484621">&#34;%v&#34;</span><span class="op" id="6484625">,</span>&nbsp;<span class="ident" id="6484627">ifi</span><span class="op" id="6484630">.</span><span class="ident" id="6484631">Index</span><span class="op" id="6484636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6484640">resolveIPAddrTests</span>&nbsp;<span class="op" id="6484659">=</span>&nbsp;<span class="builtinfunc" id="6484661">append</span><span class="op" id="6484667">(</span><span class="ident" id="6484668">resolveIPAddrTests</span><span class="op" id="6484686">,</span>&nbsp;<span class="op" id="6484688">[</span><span class="op" id="6484689">]</span><span class="ident" id="6484690">resolveIPAddrTest</span><span class="op" id="6484707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6484712">{</span><span class="string" id="6484713">&#34;ip6&#34;</span><span class="op" id="6484718">,</span>&nbsp;<span class="string" id="6484720">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="6484731">+</span>&nbsp;<span class="ident" id="6484733">ifi</span><span class="op" id="6484736">.</span><span class="ident" id="6484737">Name</span><span class="op" id="6484741">,</span>&nbsp;<span class="op" id="6484743">&amp;</span><span class="ident" id="6484744">IPAddr</span><span class="op" id="6484750">{</span><span class="ident" id="6484751">IP</span><span class="op" id="6484753">:</span>&nbsp;<span class="ident" id="6484755">ParseIP</span><span class="op" id="6484762">(</span><span class="string" id="6484763">&#34;fe80::1&#34;</span><span class="op" id="6484772">)</span><span class="op" id="6484773">,</span>&nbsp;<span class="ident" id="6484775">Zone</span><span class="op" id="6484779">:</span>&nbsp;<span class="ident" id="6484781">zoneToString</span><span class="op" id="6484793">(</span><span class="ident" id="6484794">ifi</span><span class="op" id="6484797">.</span><span class="ident" id="6484798">Index</span><span class="op" id="6484803">)</span><span class="op" id="6484804">}</span><span class="op" id="6484805">,</span>&nbsp;<span class="builtintype" id="6484807">nil</span><span class="op" id="6484810">}</span><span class="op" id="6484811">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6484816">{</span><span class="string" id="6484817">&#34;ip6&#34;</span><span class="op" id="6484822">,</span>&nbsp;<span class="string" id="6484824">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="6484835">+</span>&nbsp;<span class="ident" id="6484837">index</span><span class="op" id="6484842">,</span>&nbsp;<span class="op" id="6484844">&amp;</span><span class="ident" id="6484845">IPAddr</span><span class="op" id="6484851">{</span><span class="ident" id="6484852">IP</span><span class="op" id="6484854">:</span>&nbsp;<span class="ident" id="6484856">ParseIP</span><span class="op" id="6484863">(</span><span class="string" id="6484864">&#34;fe80::1&#34;</span><span class="op" id="6484873">)</span><span class="op" id="6484874">,</span>&nbsp;<span class="ident" id="6484876">Zone</span><span class="op" id="6484880">:</span>&nbsp;<span class="ident" id="6484882">index</span><span class="op" id="6484887">}</span><span class="op" id="6484888">,</span>&nbsp;<span class="builtintype" id="6484890">nil</span><span class="op" id="6484893">}</span><span class="op" id="6484894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6484898">}</span><span class="op" id="6484899">...</span><span class="op" id="6484902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6484905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6484908">if</span>&nbsp;<span class="ident" id="6484911">ips</span><span class="op" id="6484914">,</span>&nbsp;<span class="ident" id="6484916">err</span>&nbsp;<span class="op" id="6484920">:=</span>&nbsp;<span class="ident" id="6484923">LookupIP</span><span class="op" id="6484931">(</span><span class="string" id="6484932">&#34;localhost&#34;</span><span class="op" id="6484943">)</span><span class="op" id="6484944">;</span>&nbsp;<span class="ident" id="6484946">err</span>&nbsp;<span class="op" id="6484950">==</span>&nbsp;<span class="builtintype" id="6484953">nil</span>&nbsp;<span class="op" id="6484957">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6484960">len</span><span class="op" id="6484963">(</span><span class="ident" id="6484964">ips</span><span class="op" id="6484967">)</span>&nbsp;<span class="op" id="6484969">&gt;</span>&nbsp;<span class="num" id="6484971">1</span>&nbsp;<span class="op" id="6484973">&amp;&amp;</span>&nbsp;<span class="ident" id="6484976">supportsIPv4</span>&nbsp;<span class="op" id="6484989">&amp;&amp;</span>&nbsp;<span class="ident" id="6484992">supportsIPv6</span>&nbsp;<span class="op" id="6485005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6485009">resolveIPAddrTests</span>&nbsp;<span class="op" id="6485028">=</span>&nbsp;<span class="builtinfunc" id="6485030">append</span><span class="op" id="6485036">(</span><span class="ident" id="6485037">resolveIPAddrTests</span><span class="op" id="6485055">,</span>&nbsp;<span class="op" id="6485057">[</span><span class="op" id="6485058">]</span><span class="ident" id="6485059">resolveIPAddrTest</span><span class="op" id="6485076">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6485081">{</span><span class="string" id="6485082">&#34;ip&#34;</span><span class="op" id="6485086">,</span>&nbsp;<span class="string" id="6485088">&#34;localhost&#34;</span><span class="op" id="6485099">,</span>&nbsp;<span class="op" id="6485101">&amp;</span><span class="ident" id="6485102">IPAddr</span><span class="op" id="6485108">{</span><span class="ident" id="6485109">IP</span><span class="op" id="6485111">:</span>&nbsp;<span class="ident" id="6485113">IPv4</span><span class="op" id="6485117">(</span><span class="num" id="6485118">127</span><span class="op" id="6485121">,</span>&nbsp;<span class="num" id="6485123">0</span><span class="op" id="6485124">,</span>&nbsp;<span class="num" id="6485126">0</span><span class="op" id="6485127">,</span>&nbsp;<span class="num" id="6485129">1</span><span class="op" id="6485130">)</span><span class="op" id="6485131">}</span><span class="op" id="6485132">,</span>&nbsp;<span class="builtintype" id="6485134">nil</span><span class="op" id="6485137">}</span><span class="op" id="6485138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6485143">{</span><span class="string" id="6485144">&#34;ip4&#34;</span><span class="op" id="6485149">,</span>&nbsp;<span class="string" id="6485151">&#34;localhost&#34;</span><span class="op" id="6485162">,</span>&nbsp;<span class="op" id="6485164">&amp;</span><span class="ident" id="6485165">IPAddr</span><span class="op" id="6485171">{</span><span class="ident" id="6485172">IP</span><span class="op" id="6485174">:</span>&nbsp;<span class="ident" id="6485176">IPv4</span><span class="op" id="6485180">(</span><span class="num" id="6485181">127</span><span class="op" id="6485184">,</span>&nbsp;<span class="num" id="6485186">0</span><span class="op" id="6485187">,</span>&nbsp;<span class="num" id="6485189">0</span><span class="op" id="6485190">,</span>&nbsp;<span class="num" id="6485192">1</span><span class="op" id="6485193">)</span><span class="op" id="6485194">}</span><span class="op" id="6485195">,</span>&nbsp;<span class="builtintype" id="6485197">nil</span><span class="op" id="6485200">}</span><span class="op" id="6485201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6485206">{</span><span class="string" id="6485207">&#34;ip6&#34;</span><span class="op" id="6485212">,</span>&nbsp;<span class="string" id="6485214">&#34;localhost&#34;</span><span class="op" id="6485225">,</span>&nbsp;<span class="op" id="6485227">&amp;</span><span class="ident" id="6485228">IPAddr</span><span class="op" id="6485234">{</span><span class="ident" id="6485235">IP</span><span class="op" id="6485237">:</span>&nbsp;<span class="ident" id="6485239">IPv6loopback</span><span class="op" id="6485251">}</span><span class="op" id="6485252">,</span>&nbsp;<span class="builtintype" id="6485254">nil</span><span class="op" id="6485257">}</span><span class="op" id="6485258">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6485262">}</span><span class="op" id="6485263">...</span><span class="op" id="6485266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6485269">}</span><br>
<span class="lineno">60</span><span class="op" id="6485271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6485274">func</span>&nbsp;<span class="ident" id="6485279">skipRawSocketTest</span><span class="op" id="6485296">(</span><span class="ident" id="6485297">t</span>&nbsp;<span class="op" id="6485299">*</span><span class="ident" id="6485300">testing</span><span class="op" id="6485307">.</span><span class="ident" id="6485308">T</span><span class="op" id="6485309">)</span>&nbsp;<span class="op" id="6485311">(</span><span class="ident" id="6485312">skip</span>&nbsp;<span class="builtintype" id="6485317">bool</span><span class="op" id="6485321">,</span>&nbsp;<span class="ident" id="6485323">skipmsg</span>&nbsp;<span class="builtintype" id="6485331">string</span><span class="op" id="6485337">)</span>&nbsp;<span class="op" id="6485339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6485342">skip</span><span class="op" id="6485346">,</span>&nbsp;<span class="ident" id="6485348">skipmsg</span><span class="op" id="6485355">,</span>&nbsp;<span class="ident" id="6485357">err</span>&nbsp;<span class="op" id="6485361">:=</span>&nbsp;<span class="ident" id="6485364">skipRawSocketTests</span><span class="op" id="6485382">(</span><span class="op" id="6485383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6485386">if</span>&nbsp;<span class="ident" id="6485389">err</span>&nbsp;<span class="op" id="6485393">!=</span>&nbsp;<span class="builtintype" id="6485396">nil</span>&nbsp;<span class="op" id="6485400">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6485404">t</span><span class="op" id="6485405">.</span><span class="ident" id="6485406">Fatal</span><span class="op" id="6485411">(</span><span class="ident" id="6485412">err</span><span class="op" id="6485415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6485418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6485421">return</span>&nbsp;<span class="ident" id="6485428">skip</span><span class="op" id="6485432">,</span>&nbsp;<span class="ident" id="6485434">skipmsg</span><br>
<span class="lineno"></span><span class="op" id="6485442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="6485445">func</span>&nbsp;<span class="ident" id="6485450">TestResolveIPAddr</span><span class="op" id="6485467">(</span><span class="ident" id="6485468">t</span>&nbsp;<span class="op" id="6485470">*</span><span class="ident" id="6485471">testing</span><span class="op" id="6485478">.</span><span class="ident" id="6485479">T</span><span class="op" id="6485480">)</span>&nbsp;<span class="op" id="6485482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6485485">switch</span>&nbsp;<span class="ident" id="6485492">runtime</span><span class="op" id="6485499">.</span><span class="ident" id="6485500">GOOS</span>&nbsp;<span class="op" id="6485505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6485508">case</span>&nbsp;<span class="string" id="6485513">&#34;nacl&#34;</span><span class="op" id="6485519">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6485523">t</span><span class="op" id="6485524">.</span><span class="ident" id="6485525">Skipf</span><span class="op" id="6485530">(</span><span class="string" id="6485531">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6485552">,</span>&nbsp;<span class="ident" id="6485554">runtime</span><span class="op" id="6485561">.</span><span class="ident" id="6485562">GOOS</span><span class="op" id="6485566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6485569">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6485573">for</span>&nbsp;<span class="ident" id="6485577">_</span><span class="op" id="6485578">,</span>&nbsp;<span class="ident" id="6485580">tt</span>&nbsp;<span class="op" id="6485583">:=</span>&nbsp;<span class="keyword" id="6485586">range</span>&nbsp;<span class="ident" id="6485592">resolveIPAddrTests</span>&nbsp;<span class="op" id="6485611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6485615">addr</span><span class="op" id="6485619">,</span>&nbsp;<span class="ident" id="6485621">err</span>&nbsp;<span class="op" id="6485625">:=</span>&nbsp;<span class="ident" id="6485628">ResolveIPAddr</span><span class="op" id="6485641">(</span><span class="ident" id="6485642">tt</span><span class="op" id="6485644">.</span><span class="ident" id="6485645">net</span><span class="op" id="6485648">,</span>&nbsp;<span class="ident" id="6485650">tt</span><span class="op" id="6485652">.</span><span class="ident" id="6485653">litAddrOrName</span><span class="op" id="6485666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6485670">if</span>&nbsp;<span class="ident" id="6485673">err</span>&nbsp;<span class="op" id="6485677">!=</span>&nbsp;<span class="ident" id="6485680">tt</span><span class="op" id="6485682">.</span><span class="ident" id="6485683">err</span>&nbsp;<span class="op" id="6485687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6485692">t</span><span class="op" id="6485693">.</span><span class="ident" id="6485694">Fatalf</span><span class="op" id="6485700">(</span><span class="string" id="6485701">&#34;ResolveIPAddr(%v,&nbsp;%v)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6485735">,</span>&nbsp;<span class="ident" id="6485737">tt</span><span class="op" id="6485739">.</span><span class="ident" id="6485740">net</span><span class="op" id="6485743">,</span>&nbsp;<span class="ident" id="6485745">tt</span><span class="op" id="6485747">.</span><span class="ident" id="6485748">litAddrOrName</span><span class="op" id="6485761">,</span>&nbsp;<span class="ident" id="6485763">err</span><span class="op" id="6485766">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6485770">}</span>&nbsp;<span class="keyword" id="6485772">else</span>&nbsp;<span class="keyword" id="6485777">if</span>&nbsp;<span class="op" id="6485780">!</span><span class="ident" id="6485781">reflect</span><span class="op" id="6485788">.</span><span class="ident" id="6485789">DeepEqual</span><span class="op" id="6485798">(</span><span class="ident" id="6485799">addr</span><span class="op" id="6485803">,</span>&nbsp;<span class="ident" id="6485805">tt</span><span class="op" id="6485807">.</span><span class="ident" id="6485808">addr</span><span class="op" id="6485812">)</span>&nbsp;<span class="op" id="6485814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6485819">t</span><span class="op" id="6485820">.</span><span class="ident" id="6485821">Fatalf</span><span class="op" id="6485827">(</span><span class="string" id="6485828">&#34;got&nbsp;%#v;&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6485851">,</span>&nbsp;<span class="ident" id="6485853">addr</span><span class="op" id="6485857">,</span>&nbsp;<span class="ident" id="6485859">tt</span><span class="op" id="6485861">.</span><span class="ident" id="6485862">addr</span><span class="op" id="6485866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6485870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6485873">}</span><br>
<span class="lineno"></span><span class="op" id="6485875">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="6485878">var</span>&nbsp;<span class="ident" id="6485882">icmpEchoTests</span>&nbsp;<span class="op" id="6485896">=</span>&nbsp;<span class="op" id="6485898">[</span><span class="op" id="6485899">]</span><span class="keyword" id="6485900">struct</span>&nbsp;<span class="op" id="6485907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6485910">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6485916">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6485924">laddr</span>&nbsp;<span class="builtintype" id="6485930">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6485938">raddr</span>&nbsp;<span class="builtintype" id="6485944">string</span><br>
<span class="lineno">90</span><span class="op" id="6485951">}</span><span class="op" id="6485952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6485955">{</span><span class="string" id="6485956">&#34;ip4:icmp&#34;</span><span class="op" id="6485966">,</span>&nbsp;<span class="string" id="6485968">&#34;0.0.0.0&#34;</span><span class="op" id="6485977">,</span>&nbsp;<span class="string" id="6485979">&#34;127.0.0.1&#34;</span><span class="op" id="6485990">}</span><span class="op" id="6485991">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6485994">{</span><span class="string" id="6485995">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="6486010">,</span>&nbsp;<span class="string" id="6486012">&#34;::&#34;</span><span class="op" id="6486016">,</span>&nbsp;<span class="string" id="6486018">&#34;::1&#34;</span><span class="op" id="6486023">}</span><span class="op" id="6486024">,</span><br>
<span class="lineno"></span><span class="op" id="6486026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6486029">func</span>&nbsp;<span class="ident" id="6486034">TestConnICMPEcho</span><span class="op" id="6486050">(</span><span class="ident" id="6486051">t</span>&nbsp;<span class="op" id="6486053">*</span><span class="ident" id="6486054">testing</span><span class="op" id="6486061">.</span><span class="ident" id="6486062">T</span><span class="op" id="6486063">)</span>&nbsp;<span class="op" id="6486065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6486068">if</span>&nbsp;<span class="ident" id="6486071">skip</span><span class="op" id="6486075">,</span>&nbsp;<span class="ident" id="6486077">skipmsg</span>&nbsp;<span class="op" id="6486085">:=</span>&nbsp;<span class="ident" id="6486088">skipRawSocketTest</span><span class="op" id="6486105">(</span><span class="ident" id="6486106">t</span><span class="op" id="6486107">)</span><span class="op" id="6486108">;</span>&nbsp;<span class="ident" id="6486110">skip</span>&nbsp;<span class="op" id="6486115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486119">t</span><span class="op" id="6486120">.</span><span class="ident" id="6486121">Skip</span><span class="op" id="6486125">(</span><span class="ident" id="6486126">skipmsg</span><span class="op" id="6486133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6486136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6486140">for</span>&nbsp;<span class="ident" id="6486144">i</span><span class="op" id="6486145">,</span>&nbsp;<span class="ident" id="6486147">tt</span>&nbsp;<span class="op" id="6486150">:=</span>&nbsp;<span class="keyword" id="6486153">range</span>&nbsp;<span class="ident" id="6486159">icmpEchoTests</span>&nbsp;<span class="op" id="6486173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486177">net</span><span class="op" id="6486180">,</span>&nbsp;<span class="ident" id="6486182">_</span><span class="op" id="6486183">,</span>&nbsp;<span class="ident" id="6486185">err</span>&nbsp;<span class="op" id="6486189">:=</span>&nbsp;<span class="ident" id="6486192">parseNetwork</span><span class="op" id="6486204">(</span><span class="ident" id="6486205">tt</span><span class="op" id="6486207">.</span><span class="ident" id="6486208">net</span><span class="op" id="6486211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6486215">if</span>&nbsp;<span class="ident" id="6486218">err</span>&nbsp;<span class="op" id="6486222">!=</span>&nbsp;<span class="builtintype" id="6486225">nil</span>&nbsp;<span class="op" id="6486229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486234">t</span><span class="op" id="6486235">.</span><span class="ident" id="6486236">Fatalf</span><span class="op" id="6486242">(</span><span class="string" id="6486243">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6486268">,</span>&nbsp;<span class="ident" id="6486270">err</span><span class="op" id="6486273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6486277">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6486281">if</span>&nbsp;<span class="ident" id="6486284">net</span>&nbsp;<span class="op" id="6486288">==</span>&nbsp;<span class="string" id="6486291">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6486297">&amp;&amp;</span>&nbsp;<span class="op" id="6486300">!</span><span class="ident" id="6486301">supportsIPv6</span>&nbsp;<span class="op" id="6486314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6486319">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6486330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486335">c</span><span class="op" id="6486336">,</span>&nbsp;<span class="ident" id="6486338">err</span>&nbsp;<span class="op" id="6486342">:=</span>&nbsp;<span class="ident" id="6486345">Dial</span><span class="op" id="6486349">(</span><span class="ident" id="6486350">tt</span><span class="op" id="6486352">.</span><span class="ident" id="6486353">net</span><span class="op" id="6486356">,</span>&nbsp;<span class="ident" id="6486358">tt</span><span class="op" id="6486360">.</span><span class="ident" id="6486361">raddr</span><span class="op" id="6486366">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6486370">if</span>&nbsp;<span class="ident" id="6486373">err</span>&nbsp;<span class="op" id="6486377">!=</span>&nbsp;<span class="builtintype" id="6486380">nil</span>&nbsp;<span class="op" id="6486384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486389">t</span><span class="op" id="6486390">.</span><span class="ident" id="6486391">Fatalf</span><span class="op" id="6486397">(</span><span class="string" id="6486398">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6486415">,</span>&nbsp;<span class="ident" id="6486417">err</span><span class="op" id="6486420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6486424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486428">c</span><span class="op" id="6486429">.</span><span class="ident" id="6486430">SetDeadline</span><span class="op" id="6486441">(</span><span class="ident" id="6486442">time</span><span class="op" id="6486446">.</span><span class="ident" id="6486447">Now</span><span class="op" id="6486450">(</span><span class="op" id="6486451">)</span><span class="op" id="6486452">.</span><span class="ident" id="6486453">Add</span><span class="op" id="6486456">(</span><span class="num" id="6486457">100</span>&nbsp;<span class="op" id="6486461">*</span>&nbsp;<span class="ident" id="6486463">time</span><span class="op" id="6486467">.</span><span class="ident" id="6486468">Millisecond</span><span class="op" id="6486479">)</span><span class="op" id="6486480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6486484">defer</span>&nbsp;<span class="ident" id="6486490">c</span><span class="op" id="6486491">.</span><span class="ident" id="6486492">Close</span><span class="op" id="6486497">(</span><span class="op" id="6486498">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486503">typ</span>&nbsp;<span class="op" id="6486507">:=</span>&nbsp;<span class="ident" id="6486510">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6486530">if</span>&nbsp;<span class="ident" id="6486533">net</span>&nbsp;<span class="op" id="6486537">==</span>&nbsp;<span class="string" id="6486540">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6486546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486551">typ</span>&nbsp;<span class="op" id="6486555">=</span>&nbsp;<span class="ident" id="6486557">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6486577">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486581">xid</span><span class="op" id="6486584">,</span>&nbsp;<span class="ident" id="6486586">xseq</span>&nbsp;<span class="op" id="6486591">:=</span>&nbsp;<span class="ident" id="6486594">os</span><span class="op" id="6486596">.</span><span class="ident" id="6486597">Getpid</span><span class="op" id="6486603">(</span><span class="op" id="6486604">)</span><span class="op" id="6486605">&amp;</span><span class="num" id="6486606">0xffff</span><span class="op" id="6486612">,</span>&nbsp;<span class="ident" id="6486614">i</span><span class="op" id="6486615">+</span><span class="num" id="6486616">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486620">wb</span><span class="op" id="6486622">,</span>&nbsp;<span class="ident" id="6486624">err</span>&nbsp;<span class="op" id="6486628">:=</span>&nbsp;<span class="op" id="6486631">(</span><span class="op" id="6486632">&amp;</span><span class="ident" id="6486633">icmpMessage</span><span class="op" id="6486644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486649">Type</span><span class="op" id="6486653">:</span>&nbsp;<span class="ident" id="6486655">typ</span><span class="op" id="6486658">,</span>&nbsp;<span class="ident" id="6486660">Code</span><span class="op" id="6486664">:</span>&nbsp;<span class="num" id="6486666">0</span><span class="op" id="6486667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486672">Body</span><span class="op" id="6486676">:</span>&nbsp;<span class="op" id="6486678">&amp;</span><span class="ident" id="6486679">icmpEcho</span><span class="op" id="6486687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486693">ID</span><span class="op" id="6486695">:</span>&nbsp;<span class="ident" id="6486697">xid</span><span class="op" id="6486700">,</span>&nbsp;<span class="ident" id="6486702">Seq</span><span class="op" id="6486705">:</span>&nbsp;<span class="ident" id="6486707">xseq</span><span class="op" id="6486711">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486717">Data</span><span class="op" id="6486721">:</span>&nbsp;<span class="ident" id="6486723">bytes</span><span class="op" id="6486728">.</span><span class="ident" id="6486729">Repeat</span><span class="op" id="6486735">(</span><span class="op" id="6486736">[</span><span class="op" id="6486737">]</span><span class="builtintype" id="6486738">byte</span><span class="op" id="6486742">(</span><span class="string" id="6486743">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="6486765">)</span><span class="op" id="6486766">,</span>&nbsp;<span class="num" id="6486768">3</span><span class="op" id="6486769">)</span><span class="op" id="6486770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6486775">}</span><span class="op" id="6486776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6486780">}</span><span class="op" id="6486781">)</span><span class="op" id="6486782">.</span><span class="ident" id="6486783">Marshal</span><span class="op" id="6486790">(</span><span class="op" id="6486791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6486795">if</span>&nbsp;<span class="ident" id="6486798">err</span>&nbsp;<span class="op" id="6486802">!=</span>&nbsp;<span class="builtintype" id="6486805">nil</span>&nbsp;<span class="op" id="6486809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486814">t</span><span class="op" id="6486815">.</span><span class="ident" id="6486816">Fatalf</span><span class="op" id="6486822">(</span><span class="string" id="6486823">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6486855">,</span>&nbsp;<span class="ident" id="6486857">err</span><span class="op" id="6486860">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6486864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6486868">if</span>&nbsp;<span class="ident" id="6486871">_</span><span class="op" id="6486872">,</span>&nbsp;<span class="ident" id="6486874">err</span>&nbsp;<span class="op" id="6486878">:=</span>&nbsp;<span class="ident" id="6486881">c</span><span class="op" id="6486882">.</span><span class="ident" id="6486883">Write</span><span class="op" id="6486888">(</span><span class="ident" id="6486889">wb</span><span class="op" id="6486891">)</span><span class="op" id="6486892">;</span>&nbsp;<span class="ident" id="6486894">err</span>&nbsp;<span class="op" id="6486898">!=</span>&nbsp;<span class="builtintype" id="6486901">nil</span>&nbsp;<span class="op" id="6486905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486910">t</span><span class="op" id="6486911">.</span><span class="ident" id="6486912">Fatalf</span><span class="op" id="6486918">(</span><span class="string" id="6486919">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6486942">,</span>&nbsp;<span class="ident" id="6486944">err</span><span class="op" id="6486947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6486951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6486955">var</span>&nbsp;<span class="ident" id="6486959">m</span>&nbsp;<span class="op" id="6486961">*</span><span class="ident" id="6486962">icmpMessage</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486976">rb</span>&nbsp;<span class="op" id="6486979">:=</span>&nbsp;<span class="builtinfunc" id="6486982">make</span><span class="op" id="6486986">(</span><span class="op" id="6486987">[</span><span class="op" id="6486988">]</span><span class="builtintype" id="6486989">byte</span><span class="op" id="6486993">,</span>&nbsp;<span class="num" id="6486995">20</span><span class="op" id="6486997">+</span><span class="builtinfunc" id="6486998">len</span><span class="op" id="6487001">(</span><span class="ident" id="6487002">wb</span><span class="op" id="6487004">)</span><span class="op" id="6487005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487009">for</span>&nbsp;<span class="op" id="6487013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487018">if</span>&nbsp;<span class="ident" id="6487021">_</span><span class="op" id="6487022">,</span>&nbsp;<span class="ident" id="6487024">err</span>&nbsp;<span class="op" id="6487028">:=</span>&nbsp;<span class="ident" id="6487031">c</span><span class="op" id="6487032">.</span><span class="ident" id="6487033">Read</span><span class="op" id="6487037">(</span><span class="ident" id="6487038">rb</span><span class="op" id="6487040">)</span><span class="op" id="6487041">;</span>&nbsp;<span class="ident" id="6487043">err</span>&nbsp;<span class="op" id="6487047">!=</span>&nbsp;<span class="builtintype" id="6487050">nil</span>&nbsp;<span class="op" id="6487054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487060">t</span><span class="op" id="6487061">.</span><span class="ident" id="6487062">Fatalf</span><span class="op" id="6487068">(</span><span class="string" id="6487069">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6487091">,</span>&nbsp;<span class="ident" id="6487093">err</span><span class="op" id="6487096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487101">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487106">if</span>&nbsp;<span class="ident" id="6487109">net</span>&nbsp;<span class="op" id="6487113">==</span>&nbsp;<span class="string" id="6487116">&#34;ip4&#34;</span>&nbsp;<span class="op" id="6487122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487128">rb</span>&nbsp;<span class="op" id="6487131">=</span>&nbsp;<span class="ident" id="6487133">ipv4Payload</span><span class="op" id="6487144">(</span><span class="ident" id="6487145">rb</span><span class="op" id="6487147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487157">if</span>&nbsp;<span class="ident" id="6487160">m</span><span class="op" id="6487161">,</span>&nbsp;<span class="ident" id="6487163">err</span>&nbsp;<span class="op" id="6487167">=</span>&nbsp;<span class="ident" id="6487169">parseICMPMessage</span><span class="op" id="6487185">(</span><span class="ident" id="6487186">rb</span><span class="op" id="6487188">)</span><span class="op" id="6487189">;</span>&nbsp;<span class="ident" id="6487191">err</span>&nbsp;<span class="op" id="6487195">!=</span>&nbsp;<span class="builtintype" id="6487198">nil</span>&nbsp;<span class="op" id="6487202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487208">t</span><span class="op" id="6487209">.</span><span class="ident" id="6487210">Fatalf</span><span class="op" id="6487216">(</span><span class="string" id="6487217">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6487246">,</span>&nbsp;<span class="ident" id="6487248">err</span><span class="op" id="6487251">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487261">switch</span>&nbsp;<span class="ident" id="6487268">m</span><span class="op" id="6487269">.</span><span class="ident" id="6487270">Type</span>&nbsp;<span class="op" id="6487275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487280">case</span>&nbsp;<span class="ident" id="6487285">icmpv4EchoRequest</span><span class="op" id="6487302">,</span>&nbsp;<span class="ident" id="6487304">icmpv6EchoRequest</span><span class="op" id="6487321">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487327">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487339">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487344">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487356">switch</span>&nbsp;<span class="ident" id="6487363">p</span>&nbsp;<span class="op" id="6487365">:=</span>&nbsp;<span class="ident" id="6487368">m</span><span class="op" id="6487369">.</span><span class="ident" id="6487370">Body</span><span class="op" id="6487374">.</span><span class="op" id="6487375">(</span><span class="keyword" id="6487376">type</span><span class="op" id="6487380">)</span>&nbsp;<span class="op" id="6487382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487386">case</span>&nbsp;<span class="op" id="6487391">*</span><span class="ident" id="6487392">icmpEcho</span><span class="op" id="6487400">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487405">if</span>&nbsp;<span class="ident" id="6487408">p</span><span class="op" id="6487409">.</span><span class="ident" id="6487410">ID</span>&nbsp;<span class="op" id="6487413">!=</span>&nbsp;<span class="ident" id="6487416">xid</span>&nbsp;<span class="op" id="6487420">||</span>&nbsp;<span class="ident" id="6487423">p</span><span class="op" id="6487424">.</span><span class="ident" id="6487425">Seq</span>&nbsp;<span class="op" id="6487429">!=</span>&nbsp;<span class="ident" id="6487432">xseq</span>&nbsp;<span class="op" id="6487437">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487443">t</span><span class="op" id="6487444">.</span><span class="ident" id="6487445">Fatalf</span><span class="op" id="6487451">(</span><span class="string" id="6487452">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="6487501">,</span>&nbsp;<span class="ident" id="6487503">p</span><span class="op" id="6487504">.</span><span class="ident" id="6487505">ID</span><span class="op" id="6487507">,</span>&nbsp;<span class="ident" id="6487509">p</span><span class="op" id="6487510">.</span><span class="ident" id="6487511">Seq</span><span class="op" id="6487514">,</span>&nbsp;<span class="ident" id="6487516">xid</span><span class="op" id="6487519">,</span>&nbsp;<span class="ident" id="6487521">xseq</span><span class="op" id="6487525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487534">default</span><span class="op" id="6487541">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487546">t</span><span class="op" id="6487547">.</span><span class="ident" id="6487548">Fatalf</span><span class="op" id="6487554">(</span><span class="string" id="6487555">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="6487604">,</span>&nbsp;<span class="ident" id="6487606">m</span><span class="op" id="6487607">.</span><span class="ident" id="6487608">Type</span><span class="op" id="6487612">,</span>&nbsp;<span class="ident" id="6487614">m</span><span class="op" id="6487615">.</span><span class="ident" id="6487616">Code</span><span class="op" id="6487620">,</span>&nbsp;<span class="ident" id="6487622">typ</span><span class="op" id="6487625">,</span>&nbsp;<span class="num" id="6487627">0</span><span class="op" id="6487628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487632">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487635">}</span><br>
<span class="lineno"></span><span class="op" id="6487637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6487640">func</span>&nbsp;<span class="ident" id="6487645">TestPacketConnICMPEcho</span><span class="op" id="6487667">(</span><span class="ident" id="6487668">t</span>&nbsp;<span class="op" id="6487670">*</span><span class="ident" id="6487671">testing</span><span class="op" id="6487678">.</span><span class="ident" id="6487679">T</span><span class="op" id="6487680">)</span>&nbsp;<span class="op" id="6487682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487685">if</span>&nbsp;<span class="ident" id="6487688">skip</span><span class="op" id="6487692">,</span>&nbsp;<span class="ident" id="6487694">skipmsg</span>&nbsp;<span class="op" id="6487702">:=</span>&nbsp;<span class="ident" id="6487705">skipRawSocketTest</span><span class="op" id="6487722">(</span><span class="ident" id="6487723">t</span><span class="op" id="6487724">)</span><span class="op" id="6487725">;</span>&nbsp;<span class="ident" id="6487727">skip</span>&nbsp;<span class="op" id="6487732">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487736">t</span><span class="op" id="6487737">.</span><span class="ident" id="6487738">Skip</span><span class="op" id="6487742">(</span><span class="ident" id="6487743">skipmsg</span><span class="op" id="6487750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487757">for</span>&nbsp;<span class="ident" id="6487761">i</span><span class="op" id="6487762">,</span>&nbsp;<span class="ident" id="6487764">tt</span>&nbsp;<span class="op" id="6487767">:=</span>&nbsp;<span class="keyword" id="6487770">range</span>&nbsp;<span class="ident" id="6487776">icmpEchoTests</span>&nbsp;<span class="op" id="6487790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487794">net</span><span class="op" id="6487797">,</span>&nbsp;<span class="ident" id="6487799">_</span><span class="op" id="6487800">,</span>&nbsp;<span class="ident" id="6487802">err</span>&nbsp;<span class="op" id="6487806">:=</span>&nbsp;<span class="ident" id="6487809">parseNetwork</span><span class="op" id="6487821">(</span><span class="ident" id="6487822">tt</span><span class="op" id="6487824">.</span><span class="ident" id="6487825">net</span><span class="op" id="6487828">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487832">if</span>&nbsp;<span class="ident" id="6487835">err</span>&nbsp;<span class="op" id="6487839">!=</span>&nbsp;<span class="builtintype" id="6487842">nil</span>&nbsp;<span class="op" id="6487846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487851">t</span><span class="op" id="6487852">.</span><span class="ident" id="6487853">Fatalf</span><span class="op" id="6487859">(</span><span class="string" id="6487860">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6487885">,</span>&nbsp;<span class="ident" id="6487887">err</span><span class="op" id="6487890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487898">if</span>&nbsp;<span class="ident" id="6487901">net</span>&nbsp;<span class="op" id="6487905">==</span>&nbsp;<span class="string" id="6487908">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6487914">&amp;&amp;</span>&nbsp;<span class="op" id="6487917">!</span><span class="ident" id="6487918">supportsIPv6</span>&nbsp;<span class="op" id="6487931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487936">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487952">c</span><span class="op" id="6487953">,</span>&nbsp;<span class="ident" id="6487955">err</span>&nbsp;<span class="op" id="6487959">:=</span>&nbsp;<span class="ident" id="6487962">ListenPacket</span><span class="op" id="6487974">(</span><span class="ident" id="6487975">tt</span><span class="op" id="6487977">.</span><span class="ident" id="6487978">net</span><span class="op" id="6487981">,</span>&nbsp;<span class="ident" id="6487983">tt</span><span class="op" id="6487985">.</span><span class="ident" id="6487986">laddr</span><span class="op" id="6487991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487995">if</span>&nbsp;<span class="ident" id="6487998">err</span>&nbsp;<span class="op" id="6488002">!=</span>&nbsp;<span class="builtintype" id="6488005">nil</span>&nbsp;<span class="op" id="6488009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488014">t</span><span class="op" id="6488015">.</span><span class="ident" id="6488016">Fatalf</span><span class="op" id="6488022">(</span><span class="string" id="6488023">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6488048">,</span>&nbsp;<span class="ident" id="6488050">err</span><span class="op" id="6488053">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488061">c</span><span class="op" id="6488062">.</span><span class="ident" id="6488063">SetDeadline</span><span class="op" id="6488074">(</span><span class="ident" id="6488075">time</span><span class="op" id="6488079">.</span><span class="ident" id="6488080">Now</span><span class="op" id="6488083">(</span><span class="op" id="6488084">)</span><span class="op" id="6488085">.</span><span class="ident" id="6488086">Add</span><span class="op" id="6488089">(</span><span class="num" id="6488090">100</span>&nbsp;<span class="op" id="6488094">*</span>&nbsp;<span class="ident" id="6488096">time</span><span class="op" id="6488100">.</span><span class="ident" id="6488101">Millisecond</span><span class="op" id="6488112">)</span><span class="op" id="6488113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6488117">defer</span>&nbsp;<span class="ident" id="6488123">c</span><span class="op" id="6488124">.</span><span class="ident" id="6488125">Close</span><span class="op" id="6488130">(</span><span class="op" id="6488131">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488136">ra</span><span class="op" id="6488138">,</span>&nbsp;<span class="ident" id="6488140">err</span>&nbsp;<span class="op" id="6488144">:=</span>&nbsp;<span class="ident" id="6488147">ResolveIPAddr</span><span class="op" id="6488160">(</span><span class="ident" id="6488161">tt</span><span class="op" id="6488163">.</span><span class="ident" id="6488164">net</span><span class="op" id="6488167">,</span>&nbsp;<span class="ident" id="6488169">tt</span><span class="op" id="6488171">.</span><span class="ident" id="6488172">raddr</span><span class="op" id="6488177">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6488181">if</span>&nbsp;<span class="ident" id="6488184">err</span>&nbsp;<span class="op" id="6488188">!=</span>&nbsp;<span class="builtintype" id="6488191">nil</span>&nbsp;<span class="op" id="6488195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488200">t</span><span class="op" id="6488201">.</span><span class="ident" id="6488202">Fatalf</span><span class="op" id="6488208">(</span><span class="string" id="6488209">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6488235">,</span>&nbsp;<span class="ident" id="6488237">err</span><span class="op" id="6488240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488248">typ</span>&nbsp;<span class="op" id="6488252">:=</span>&nbsp;<span class="ident" id="6488255">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6488275">if</span>&nbsp;<span class="ident" id="6488278">net</span>&nbsp;<span class="op" id="6488282">==</span>&nbsp;<span class="string" id="6488285">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6488291">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488296">typ</span>&nbsp;<span class="op" id="6488300">=</span>&nbsp;<span class="ident" id="6488302">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488326">xid</span><span class="op" id="6488329">,</span>&nbsp;<span class="ident" id="6488331">xseq</span>&nbsp;<span class="op" id="6488336">:=</span>&nbsp;<span class="ident" id="6488339">os</span><span class="op" id="6488341">.</span><span class="ident" id="6488342">Getpid</span><span class="op" id="6488348">(</span><span class="op" id="6488349">)</span><span class="op" id="6488350">&amp;</span><span class="num" id="6488351">0xffff</span><span class="op" id="6488357">,</span>&nbsp;<span class="ident" id="6488359">i</span><span class="op" id="6488360">+</span><span class="num" id="6488361">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488365">wb</span><span class="op" id="6488367">,</span>&nbsp;<span class="ident" id="6488369">err</span>&nbsp;<span class="op" id="6488373">:=</span>&nbsp;<span class="op" id="6488376">(</span><span class="op" id="6488377">&amp;</span><span class="ident" id="6488378">icmpMessage</span><span class="op" id="6488389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488394">Type</span><span class="op" id="6488398">:</span>&nbsp;<span class="ident" id="6488400">typ</span><span class="op" id="6488403">,</span>&nbsp;<span class="ident" id="6488405">Code</span><span class="op" id="6488409">:</span>&nbsp;<span class="num" id="6488411">0</span><span class="op" id="6488412">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488417">Body</span><span class="op" id="6488421">:</span>&nbsp;<span class="op" id="6488423">&amp;</span><span class="ident" id="6488424">icmpEcho</span><span class="op" id="6488432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488438">ID</span><span class="op" id="6488440">:</span>&nbsp;<span class="ident" id="6488442">xid</span><span class="op" id="6488445">,</span>&nbsp;<span class="ident" id="6488447">Seq</span><span class="op" id="6488450">:</span>&nbsp;<span class="ident" id="6488452">xseq</span><span class="op" id="6488456">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488462">Data</span><span class="op" id="6488466">:</span>&nbsp;<span class="ident" id="6488468">bytes</span><span class="op" id="6488473">.</span><span class="ident" id="6488474">Repeat</span><span class="op" id="6488480">(</span><span class="op" id="6488481">[</span><span class="op" id="6488482">]</span><span class="builtintype" id="6488483">byte</span><span class="op" id="6488487">(</span><span class="string" id="6488488">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="6488510">)</span><span class="op" id="6488511">,</span>&nbsp;<span class="num" id="6488513">3</span><span class="op" id="6488514">)</span><span class="op" id="6488515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488520">}</span><span class="op" id="6488521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488525">}</span><span class="op" id="6488526">)</span><span class="op" id="6488527">.</span><span class="ident" id="6488528">Marshal</span><span class="op" id="6488535">(</span><span class="op" id="6488536">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6488540">if</span>&nbsp;<span class="ident" id="6488543">err</span>&nbsp;<span class="op" id="6488547">!=</span>&nbsp;<span class="builtintype" id="6488550">nil</span>&nbsp;<span class="op" id="6488554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488559">t</span><span class="op" id="6488560">.</span><span class="ident" id="6488561">Fatalf</span><span class="op" id="6488567">(</span><span class="string" id="6488568">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6488600">,</span>&nbsp;<span class="ident" id="6488602">err</span><span class="op" id="6488605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6488613">if</span>&nbsp;<span class="ident" id="6488616">_</span><span class="op" id="6488617">,</span>&nbsp;<span class="ident" id="6488619">err</span>&nbsp;<span class="op" id="6488623">:=</span>&nbsp;<span class="ident" id="6488626">c</span><span class="op" id="6488627">.</span><span class="ident" id="6488628">WriteTo</span><span class="op" id="6488635">(</span><span class="ident" id="6488636">wb</span><span class="op" id="6488638">,</span>&nbsp;<span class="ident" id="6488640">ra</span><span class="op" id="6488642">)</span><span class="op" id="6488643">;</span>&nbsp;<span class="ident" id="6488645">err</span>&nbsp;<span class="op" id="6488649">!=</span>&nbsp;<span class="builtintype" id="6488652">nil</span>&nbsp;<span class="op" id="6488656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488661">t</span><span class="op" id="6488662">.</span><span class="ident" id="6488663">Fatalf</span><span class="op" id="6488669">(</span><span class="string" id="6488670">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6488701">,</span>&nbsp;<span class="ident" id="6488703">err</span><span class="op" id="6488706">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6488714">var</span>&nbsp;<span class="ident" id="6488718">m</span>&nbsp;<span class="op" id="6488720">*</span><span class="ident" id="6488721">icmpMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488735">rb</span>&nbsp;<span class="op" id="6488738">:=</span>&nbsp;<span class="builtinfunc" id="6488741">make</span><span class="op" id="6488745">(</span><span class="op" id="6488746">[</span><span class="op" id="6488747">]</span><span class="builtintype" id="6488748">byte</span><span class="op" id="6488752">,</span>&nbsp;<span class="num" id="6488754">20</span><span class="op" id="6488756">+</span><span class="builtinfunc" id="6488757">len</span><span class="op" id="6488760">(</span><span class="ident" id="6488761">wb</span><span class="op" id="6488763">)</span><span class="op" id="6488764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6488768">for</span>&nbsp;<span class="op" id="6488772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6488777">if</span>&nbsp;<span class="ident" id="6488780">_</span><span class="op" id="6488781">,</span>&nbsp;<span class="ident" id="6488783">_</span><span class="op" id="6488784">,</span>&nbsp;<span class="ident" id="6488786">err</span>&nbsp;<span class="op" id="6488790">:=</span>&nbsp;<span class="ident" id="6488793">c</span><span class="op" id="6488794">.</span><span class="ident" id="6488795">ReadFrom</span><span class="op" id="6488803">(</span><span class="ident" id="6488804">rb</span><span class="op" id="6488806">)</span><span class="op" id="6488807">;</span>&nbsp;<span class="ident" id="6488809">err</span>&nbsp;<span class="op" id="6488813">!=</span>&nbsp;<span class="builtintype" id="6488816">nil</span>&nbsp;<span class="op" id="6488820">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488826">t</span><span class="op" id="6488827">.</span><span class="ident" id="6488828">Fatalf</span><span class="op" id="6488834">(</span><span class="string" id="6488835">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6488867">,</span>&nbsp;<span class="ident" id="6488869">err</span><span class="op" id="6488872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6488882">//&nbsp;See&nbsp;BUG&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6488905">//if&nbsp;net&nbsp;==&nbsp;&#34;ip4&#34;&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6488928">//&nbsp;&nbsp;&nbsp;&nbsp;rb&nbsp;=&nbsp;ipv4Payload(rb)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6488955">//}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6488962">if</span>&nbsp;<span class="ident" id="6488965">m</span><span class="op" id="6488966">,</span>&nbsp;<span class="ident" id="6488968">err</span>&nbsp;<span class="op" id="6488972">=</span>&nbsp;<span class="ident" id="6488974">parseICMPMessage</span><span class="op" id="6488990">(</span><span class="ident" id="6488991">rb</span><span class="op" id="6488993">)</span><span class="op" id="6488994">;</span>&nbsp;<span class="ident" id="6488996">err</span>&nbsp;<span class="op" id="6489000">!=</span>&nbsp;<span class="builtintype" id="6489003">nil</span>&nbsp;<span class="op" id="6489007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6489013">t</span><span class="op" id="6489014">.</span><span class="ident" id="6489015">Fatalf</span><span class="op" id="6489021">(</span><span class="string" id="6489022">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6489051">,</span>&nbsp;<span class="ident" id="6489053">err</span><span class="op" id="6489056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6489061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6489066">switch</span>&nbsp;<span class="ident" id="6489073">m</span><span class="op" id="6489074">.</span><span class="ident" id="6489075">Type</span>&nbsp;<span class="op" id="6489080">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6489085">case</span>&nbsp;<span class="ident" id="6489090">icmpv4EchoRequest</span><span class="op" id="6489107">,</span>&nbsp;<span class="ident" id="6489109">icmpv6EchoRequest</span><span class="op" id="6489126">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6489132">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6489144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6489149">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6489157">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6489161">switch</span>&nbsp;<span class="ident" id="6489168">p</span>&nbsp;<span class="op" id="6489170">:=</span>&nbsp;<span class="ident" id="6489173">m</span><span class="op" id="6489174">.</span><span class="ident" id="6489175">Body</span><span class="op" id="6489179">.</span><span class="op" id="6489180">(</span><span class="keyword" id="6489181">type</span><span class="op" id="6489185">)</span>&nbsp;<span class="op" id="6489187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6489191">case</span>&nbsp;<span class="op" id="6489196">*</span><span class="ident" id="6489197">icmpEcho</span><span class="op" id="6489205">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6489210">if</span>&nbsp;<span class="ident" id="6489213">p</span><span class="op" id="6489214">.</span><span class="ident" id="6489215">ID</span>&nbsp;<span class="op" id="6489218">!=</span>&nbsp;<span class="ident" id="6489221">xid</span>&nbsp;<span class="op" id="6489225">||</span>&nbsp;<span class="ident" id="6489228">p</span><span class="op" id="6489229">.</span><span class="ident" id="6489230">Seq</span>&nbsp;<span class="op" id="6489234">!=</span>&nbsp;<span class="ident" id="6489237">xseq</span>&nbsp;<span class="op" id="6489242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6489248">t</span><span class="op" id="6489249">.</span><span class="ident" id="6489250">Fatalf</span><span class="op" id="6489256">(</span><span class="string" id="6489257">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="6489306">,</span>&nbsp;<span class="ident" id="6489308">p</span><span class="op" id="6489309">.</span><span class="ident" id="6489310">ID</span><span class="op" id="6489312">,</span>&nbsp;<span class="ident" id="6489314">p</span><span class="op" id="6489315">.</span><span class="ident" id="6489316">Seq</span><span class="op" id="6489319">,</span>&nbsp;<span class="ident" id="6489321">xid</span><span class="op" id="6489324">,</span>&nbsp;<span class="ident" id="6489326">xseq</span><span class="op" id="6489330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6489335">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6489339">default</span><span class="op" id="6489346">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6489351">t</span><span class="op" id="6489352">.</span><span class="ident" id="6489353">Fatalf</span><span class="op" id="6489359">(</span><span class="string" id="6489360">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="6489409">,</span>&nbsp;<span class="ident" id="6489411">m</span><span class="op" id="6489412">.</span><span class="ident" id="6489413">Type</span><span class="op" id="6489417">,</span>&nbsp;<span class="ident" id="6489419">m</span><span class="op" id="6489420">.</span><span class="ident" id="6489421">Code</span><span class="op" id="6489425">,</span>&nbsp;<span class="ident" id="6489427">typ</span><span class="op" id="6489430">,</span>&nbsp;<span class="num" id="6489432">0</span><span class="op" id="6489433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6489437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6489440">}</span><br>
<span class="lineno"></span><span class="op" id="6489442">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="6489445">func</span>&nbsp;<span class="ident" id="6489450">ipv4Payload</span><span class="op" id="6489461">(</span><span class="ident" id="6489462">b</span>&nbsp;<span class="op" id="6489464">[</span><span class="op" id="6489465">]</span><span class="builtintype" id="6489466">byte</span><span class="op" id="6489470">)</span>&nbsp;<span class="op" id="6489472">[</span><span class="op" id="6489473">]</span><span class="builtintype" id="6489474">byte</span>&nbsp;<span class="op" id="6489479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6489482">if</span>&nbsp;<span class="builtinfunc" id="6489485">len</span><span class="op" id="6489488">(</span><span class="ident" id="6489489">b</span><span class="op" id="6489490">)</span>&nbsp;<span class="op" id="6489492">&lt;</span>&nbsp;<span class="num" id="6489494">20</span>&nbsp;<span class="op" id="6489497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6489501">return</span>&nbsp;<span class="ident" id="6489508">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6489511">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6489514">hdrlen</span>&nbsp;<span class="op" id="6489521">:=</span>&nbsp;<span class="builtintype" id="6489524">int</span><span class="op" id="6489527">(</span><span class="ident" id="6489528">b</span><span class="op" id="6489529">[</span><span class="num" id="6489530">0</span><span class="op" id="6489531">]</span><span class="op" id="6489532">&amp;</span><span class="num" id="6489533">0x0f</span><span class="op" id="6489537">)</span>&nbsp;<span class="op" id="6489539">&lt;&lt;</span>&nbsp;<span class="num" id="6489542">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6489545">return</span>&nbsp;<span class="ident" id="6489552">b</span><span class="op" id="6489553">[</span><span class="ident" id="6489554">hdrlen</span><span class="op" id="6489560">:</span><span class="op" id="6489561">]</span><br>
<span class="lineno"></span><span class="op" id="6489563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6489566">var</span>&nbsp;<span class="ident" id="6489570">ipConnLocalNameTests</span>&nbsp;<span class="op" id="6489591">=</span>&nbsp;<span class="op" id="6489593">[</span><span class="op" id="6489594">]</span><span class="keyword" id="6489595">struct</span>&nbsp;<span class="op" id="6489602">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6489605">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6489611">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6489619">laddr</span>&nbsp;<span class="op" id="6489625">*</span><span class="ident" id="6489626">IPAddr</span><br>
<span class="lineno"></span><span class="op" id="6489633">}</span><span class="op" id="6489634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6489637">{</span><span class="string" id="6489638">&#34;ip4:icmp&#34;</span><span class="op" id="6489648">,</span>&nbsp;<span class="op" id="6489650">&amp;</span><span class="ident" id="6489651">IPAddr</span><span class="op" id="6489657">{</span><span class="ident" id="6489658">IP</span><span class="op" id="6489660">:</span>&nbsp;<span class="ident" id="6489662">IPv4</span><span class="op" id="6489666">(</span><span class="num" id="6489667">127</span><span class="op" id="6489670">,</span>&nbsp;<span class="num" id="6489672">0</span><span class="op" id="6489673">,</span>&nbsp;<span class="num" id="6489675">0</span><span class="op" id="6489676">,</span>&nbsp;<span class="num" id="6489678">1</span><span class="op" id="6489679">)</span><span class="op" id="6489680">}</span><span class="op" id="6489681">}</span><span class="op" id="6489682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6489685">{</span><span class="string" id="6489686">&#34;ip4:icmp&#34;</span><span class="op" id="6489696">,</span>&nbsp;<span class="op" id="6489698">&amp;</span><span class="ident" id="6489699">IPAddr</span><span class="op" id="6489705">{</span><span class="op" id="6489706">}</span><span class="op" id="6489707">}</span><span class="op" id="6489708">,</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6489711">{</span><span class="string" id="6489712">&#34;ip4:icmp&#34;</span><span class="op" id="6489722">,</span>&nbsp;<span class="builtintype" id="6489724">nil</span><span class="op" id="6489727">}</span><span class="op" id="6489728">,</span><br>
<span class="lineno"></span><span class="op" id="6489730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6489733">func</span>&nbsp;<span class="ident" id="6489738">TestIPConnLocalName</span><span class="op" id="6489757">(</span><span class="ident" id="6489758">t</span>&nbsp;<span class="op" id="6489760">*</span><span class="ident" id="6489761">testing</span><span class="op" id="6489768">.</span><span class="ident" id="6489769">T</span><span class="op" id="6489770">)</span>&nbsp;<span class="op" id="6489772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6489775">switch</span>&nbsp;<span class="ident" id="6489782">runtime</span><span class="op" id="6489789">.</span><span class="ident" id="6489790">GOOS</span>&nbsp;<span class="op" id="6489795">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6489798">case</span>&nbsp;<span class="string" id="6489803">&#34;nacl&#34;</span><span class="op" id="6489809">,</span>&nbsp;<span class="string" id="6489811">&#34;plan9&#34;</span><span class="op" id="6489818">,</span>&nbsp;<span class="string" id="6489820">&#34;windows&#34;</span><span class="op" id="6489829">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6489833">t</span><span class="op" id="6489834">.</span><span class="ident" id="6489835">Skipf</span><span class="op" id="6489840">(</span><span class="string" id="6489841">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6489862">,</span>&nbsp;<span class="ident" id="6489864">runtime</span><span class="op" id="6489871">.</span><span class="ident" id="6489872">GOOS</span><span class="op" id="6489876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6489879">default</span><span class="op" id="6489886">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6489890">if</span>&nbsp;<span class="ident" id="6489893">os</span><span class="op" id="6489895">.</span><span class="ident" id="6489896">Getuid</span><span class="op" id="6489902">(</span><span class="op" id="6489903">)</span>&nbsp;<span class="op" id="6489905">!=</span>&nbsp;<span class="num" id="6489908">0</span>&nbsp;<span class="op" id="6489910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6489915">t</span><span class="op" id="6489916">.</span><span class="ident" id="6489917">Skip</span><span class="op" id="6489921">(</span><span class="string" id="6489922">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="6489951">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6489955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6489958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6489962">for</span>&nbsp;<span class="ident" id="6489966">_</span><span class="op" id="6489967">,</span>&nbsp;<span class="ident" id="6489969">tt</span>&nbsp;<span class="op" id="6489972">:=</span>&nbsp;<span class="keyword" id="6489975">range</span>&nbsp;<span class="ident" id="6489981">ipConnLocalNameTests</span>&nbsp;<span class="op" id="6490002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6490006">c</span><span class="op" id="6490007">,</span>&nbsp;<span class="ident" id="6490009">err</span>&nbsp;<span class="op" id="6490013">:=</span>&nbsp;<span class="ident" id="6490016">ListenIP</span><span class="op" id="6490024">(</span><span class="ident" id="6490025">tt</span><span class="op" id="6490027">.</span><span class="ident" id="6490028">net</span><span class="op" id="6490031">,</span>&nbsp;<span class="ident" id="6490033">tt</span><span class="op" id="6490035">.</span><span class="ident" id="6490036">laddr</span><span class="op" id="6490041">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6490045">if</span>&nbsp;<span class="ident" id="6490048">err</span>&nbsp;<span class="op" id="6490052">!=</span>&nbsp;<span class="builtintype" id="6490055">nil</span>&nbsp;<span class="op" id="6490059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6490064">t</span><span class="op" id="6490065">.</span><span class="ident" id="6490066">Fatalf</span><span class="op" id="6490072">(</span><span class="string" id="6490073">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6490094">,</span>&nbsp;<span class="ident" id="6490096">err</span><span class="op" id="6490099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6490103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6490107">defer</span>&nbsp;<span class="ident" id="6490113">c</span><span class="op" id="6490114">.</span><span class="ident" id="6490115">Close</span><span class="op" id="6490120">(</span><span class="op" id="6490121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6490125">if</span>&nbsp;<span class="ident" id="6490128">la</span>&nbsp;<span class="op" id="6490131">:=</span>&nbsp;<span class="ident" id="6490134">c</span><span class="op" id="6490135">.</span><span class="ident" id="6490136">LocalAddr</span><span class="op" id="6490145">(</span><span class="op" id="6490146">)</span><span class="op" id="6490147">;</span>&nbsp;<span class="ident" id="6490149">la</span>&nbsp;<span class="op" id="6490152">==</span>&nbsp;<span class="builtintype" id="6490155">nil</span>&nbsp;<span class="op" id="6490159">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6490164">t</span><span class="op" id="6490165">.</span><span class="ident" id="6490166">Fatal</span><span class="op" id="6490171">(</span><span class="string" id="6490172">&#34;IPConn.LocalAddr&nbsp;failed&#34;</span><span class="op" id="6490197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6490201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6490204">}</span><br>
<span class="lineno"></span><span class="op" id="6490206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="6490209">func</span>&nbsp;<span class="ident" id="6490214">TestIPConnRemoteName</span><span class="op" id="6490234">(</span><span class="ident" id="6490235">t</span>&nbsp;<span class="op" id="6490237">*</span><span class="ident" id="6490238">testing</span><span class="op" id="6490245">.</span><span class="ident" id="6490246">T</span><span class="op" id="6490247">)</span>&nbsp;<span class="op" id="6490249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6490252">switch</span>&nbsp;<span class="ident" id="6490259">runtime</span><span class="op" id="6490266">.</span><span class="ident" id="6490267">GOOS</span>&nbsp;<span class="op" id="6490272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6490275">case</span>&nbsp;<span class="string" id="6490280">&#34;plan9&#34;</span><span class="op" id="6490287">,</span>&nbsp;<span class="string" id="6490289">&#34;windows&#34;</span><span class="op" id="6490298">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6490302">t</span><span class="op" id="6490303">.</span><span class="ident" id="6490304">Skipf</span><span class="op" id="6490309">(</span><span class="string" id="6490310">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6490331">,</span>&nbsp;<span class="ident" id="6490333">runtime</span><span class="op" id="6490340">.</span><span class="ident" id="6490341">GOOS</span><span class="op" id="6490345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6490348">default</span><span class="op" id="6490355">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6490359">if</span>&nbsp;<span class="ident" id="6490362">os</span><span class="op" id="6490364">.</span><span class="ident" id="6490365">Getuid</span><span class="op" id="6490371">(</span><span class="op" id="6490372">)</span>&nbsp;<span class="op" id="6490374">!=</span>&nbsp;<span class="num" id="6490377">0</span>&nbsp;<span class="op" id="6490379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6490384">t</span><span class="op" id="6490385">.</span><span class="ident" id="6490386">Skip</span><span class="op" id="6490390">(</span><span class="string" id="6490391">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="6490420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6490424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6490427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6490431">raddr</span>&nbsp;<span class="op" id="6490437">:=</span>&nbsp;<span class="op" id="6490440">&amp;</span><span class="ident" id="6490441">IPAddr</span><span class="op" id="6490447">{</span><span class="ident" id="6490448">IP</span><span class="op" id="6490450">:</span>&nbsp;<span class="ident" id="6490452">IPv4</span><span class="op" id="6490456">(</span><span class="num" id="6490457">127</span><span class="op" id="6490460">,</span>&nbsp;<span class="num" id="6490462">0</span><span class="op" id="6490463">,</span>&nbsp;<span class="num" id="6490465">0</span><span class="op" id="6490466">,</span>&nbsp;<span class="num" id="6490468">1</span><span class="op" id="6490469">)</span><span class="op" id="6490470">.</span><span class="ident" id="6490471">To4</span><span class="op" id="6490474">(</span><span class="op" id="6490475">)</span><span class="op" id="6490476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6490479">c</span><span class="op" id="6490480">,</span>&nbsp;<span class="ident" id="6490482">err</span>&nbsp;<span class="op" id="6490486">:=</span>&nbsp;<span class="ident" id="6490489">DialIP</span><span class="op" id="6490495">(</span><span class="string" id="6490496">&#34;ip:tcp&#34;</span><span class="op" id="6490504">,</span>&nbsp;<span class="op" id="6490506">&amp;</span><span class="ident" id="6490507">IPAddr</span><span class="op" id="6490513">{</span><span class="ident" id="6490514">IP</span><span class="op" id="6490516">:</span>&nbsp;<span class="ident" id="6490518">IPv4</span><span class="op" id="6490522">(</span><span class="num" id="6490523">127</span><span class="op" id="6490526">,</span>&nbsp;<span class="num" id="6490528">0</span><span class="op" id="6490529">,</span>&nbsp;<span class="num" id="6490531">0</span><span class="op" id="6490532">,</span>&nbsp;<span class="num" id="6490534">1</span><span class="op" id="6490535">)</span><span class="op" id="6490536">}</span><span class="op" id="6490537">,</span>&nbsp;<span class="ident" id="6490539">raddr</span><span class="op" id="6490544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6490547">if</span>&nbsp;<span class="ident" id="6490550">err</span>&nbsp;<span class="op" id="6490554">!=</span>&nbsp;<span class="builtintype" id="6490557">nil</span>&nbsp;<span class="op" id="6490561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6490565">t</span><span class="op" id="6490566">.</span><span class="ident" id="6490567">Fatalf</span><span class="op" id="6490573">(</span><span class="string" id="6490574">&#34;DialIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6490593">,</span>&nbsp;<span class="ident" id="6490595">err</span><span class="op" id="6490598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6490601">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6490604">defer</span>&nbsp;<span class="ident" id="6490610">c</span><span class="op" id="6490611">.</span><span class="ident" id="6490612">Close</span><span class="op" id="6490617">(</span><span class="op" id="6490618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6490621">if</span>&nbsp;<span class="op" id="6490624">!</span><span class="ident" id="6490625">reflect</span><span class="op" id="6490632">.</span><span class="ident" id="6490633">DeepEqual</span><span class="op" id="6490642">(</span><span class="ident" id="6490643">raddr</span><span class="op" id="6490648">,</span>&nbsp;<span class="ident" id="6490650">c</span><span class="op" id="6490651">.</span><span class="ident" id="6490652">RemoteAddr</span><span class="op" id="6490662">(</span><span class="op" id="6490663">)</span><span class="op" id="6490664">)</span>&nbsp;<span class="op" id="6490666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6490670">t</span><span class="op" id="6490671">.</span><span class="ident" id="6490672">Fatalf</span><span class="op" id="6490678">(</span><span class="string" id="6490679">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6490702">,</span>&nbsp;<span class="ident" id="6490704">c</span><span class="op" id="6490705">.</span><span class="ident" id="6490706">RemoteAddr</span><span class="op" id="6490716">(</span><span class="op" id="6490717">)</span><span class="op" id="6490718">,</span>&nbsp;<span class="ident" id="6490720">raddr</span><span class="op" id="6490725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6490728">}</span><br>
<span class="lineno"></span><span class="op" id="6490730">}</span>
</div>
</body>
</html>
