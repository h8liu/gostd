<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4734872">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4734927">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4734981">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4735032">package</span>&nbsp;<span class="ident" id="4735040">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4735047">import</span>&nbsp;<span class="op" id="4735054">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4735057">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4735064">&#34;sort&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4735072">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="4735079">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4735082">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4735163">//&nbsp;Positions</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4735177">//&nbsp;Position&nbsp;describes&nbsp;an&nbsp;arbitrary&nbsp;source&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="4735228">//&nbsp;including&nbsp;the&nbsp;file,&nbsp;line,&nbsp;and&nbsp;column&nbsp;location.</span><br>
<span class="lineno"></span><span class="comment" id="4735278">//&nbsp;A&nbsp;Position&nbsp;is&nbsp;valid&nbsp;if&nbsp;the&nbsp;line&nbsp;number&nbsp;is&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="4735328">//</span><br>
<span class="lineno">20</span><span class="keyword" id="4735331">type</span>&nbsp;<span class="ident" id="4735336">Position</span>&nbsp;<span class="keyword" id="4735345">struct</span>&nbsp;<span class="op" id="4735352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4735355">Filename</span>&nbsp;<span class="builtintype" id="4735364">string</span>&nbsp;<span class="comment" id="4735371">//&nbsp;filename,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4735392">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4735401">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4735408">//&nbsp;offset,&nbsp;starting&nbsp;at&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4735434">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4735443">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4735450">//&nbsp;line&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4735481">Column</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4735490">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4735497">//&nbsp;column&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1&nbsp;(character&nbsp;count)</span><br>
<span class="lineno">25</span><span class="op" id="4735547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4735550">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4735600">func</span>&nbsp;<span class="op" id="4735605">(</span><span class="ident" id="4735606">pos</span>&nbsp;<span class="op" id="4735610">*</span><span class="ident" id="4735611">Position</span><span class="op" id="4735619">)</span>&nbsp;<span class="ident" id="4735621">IsValid</span><span class="op" id="4735628">(</span><span class="op" id="4735629">)</span>&nbsp;<span class="builtintype" id="4735631">bool</span>&nbsp;<span class="op" id="4735636">{</span>&nbsp;<span class="keyword" id="4735638">return</span>&nbsp;<span class="ident" id="4735645">pos</span><span class="op" id="4735648">.</span><span class="ident" id="4735649">Line</span>&nbsp;<span class="op" id="4735654">&gt;</span>&nbsp;<span class="num" id="4735656">0</span>&nbsp;<span class="op" id="4735658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="4735661">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;several&nbsp;forms:</span><br>
<span class="lineno"></span><span class="comment" id="4735713">//</span><br>
<span class="lineno"></span><span class="comment" id="4735716">//&nbsp;&nbsp;&nbsp;&nbspfile:line:column&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="4735769">//&nbsp;&nbsp;&nbsp;&nbspline:column&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="4735825">//&nbsp;&nbsp;&nbsp;&nbspfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="4735880">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="4735938">//</span><br>
<span class="lineno"></span><span class="keyword" id="4735941">func</span>&nbsp;<span class="op" id="4735946">(</span><span class="ident" id="4735947">pos</span>&nbsp;<span class="ident" id="4735951">Position</span><span class="op" id="4735959">)</span>&nbsp;<span class="ident" id="4735961">String</span><span class="op" id="4735967">(</span><span class="op" id="4735968">)</span>&nbsp;<span class="builtintype" id="4735970">string</span>&nbsp;<span class="op" id="4735977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4735980">s</span>&nbsp;<span class="op" id="4735982">:=</span>&nbsp;<span class="ident" id="4735985">pos</span><span class="op" id="4735988">.</span><span class="ident" id="4735989">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4735999">if</span>&nbsp;<span class="ident" id="4736002">pos</span><span class="op" id="4736005">.</span><span class="ident" id="4736006">IsValid</span><span class="op" id="4736013">(</span><span class="op" id="4736014">)</span>&nbsp;<span class="op" id="4736016">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736020">if</span>&nbsp;<span class="ident" id="4736023">s</span>&nbsp;<span class="op" id="4736025">!=</span>&nbsp;<span class="string" id="4736028">&#34;&#34;</span>&nbsp;<span class="op" id="4736031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4736036">s</span>&nbsp;<span class="op" id="4736038">+=</span>&nbsp;<span class="string" id="4736041">&#34;:&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4736047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4736051">s</span>&nbsp;<span class="op" id="4736053">+=</span>&nbsp;<span class="ident" id="4736056">fmt</span><span class="op" id="4736059">.</span><span class="ident" id="4736060">Sprintf</span><span class="op" id="4736067">(</span><span class="string" id="4736068">&#34;%d:%d&#34;</span><span class="op" id="4736075">,</span>&nbsp;<span class="ident" id="4736077">pos</span><span class="op" id="4736080">.</span><span class="ident" id="4736081">Line</span><span class="op" id="4736085">,</span>&nbsp;<span class="ident" id="4736087">pos</span><span class="op" id="4736090">.</span><span class="ident" id="4736091">Column</span><span class="op" id="4736097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4736100">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736103">if</span>&nbsp;<span class="ident" id="4736106">s</span>&nbsp;<span class="op" id="4736108">==</span>&nbsp;<span class="string" id="4736111">&#34;&#34;</span>&nbsp;<span class="op" id="4736114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4736118">s</span>&nbsp;<span class="op" id="4736120">=</span>&nbsp;<span class="string" id="4736122">&#34;-&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4736127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736130">return</span>&nbsp;<span class="ident" id="4736137">s</span><br>
<span class="lineno"></span><span class="op" id="4736139">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4736142">//&nbsp;Pos&nbsp;is&nbsp;a&nbsp;compact&nbsp;encoding&nbsp;of&nbsp;a&nbsp;source&nbsp;position&nbsp;within&nbsp;a&nbsp;file&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="4736211">//&nbsp;It&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;Position&nbsp;for&nbsp;a&nbsp;more&nbsp;convenient,&nbsp;but&nbsp;much</span><br>
<span class="lineno"></span><span class="comment" id="4736282">//&nbsp;larger,&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="4736309">//</span><br>
<span class="lineno">55</span><span class="comment" id="4736312">//&nbsp;The&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;a&nbsp;number&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size],</span><br>
<span class="lineno"></span><span class="comment" id="4736390">//&nbsp;where&nbsp;base&nbsp;and&nbsp;size&nbsp;are&nbsp;specified&nbsp;when&nbsp;adding&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="4736468">//&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="comment" id="4736480">//</span><br>
<span class="lineno"></span><span class="comment" id="4736483">//&nbsp;To&nbsp;create&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;specific&nbsp;source&nbsp;offset,&nbsp;first&nbsp;add</span><br>
<span class="lineno">60</span><span class="comment" id="4736550">//&nbsp;the&nbsp;respective&nbsp;file&nbsp;to&nbsp;the&nbsp;current&nbsp;file&nbsp;set&nbsp;(via&nbsp;FileSet.AddFile)</span><br>
<span class="lineno"></span><span class="comment" id="4736619">//&nbsp;and&nbsp;then&nbsp;call&nbsp;File.Pos(offset)&nbsp;for&nbsp;that&nbsp;file.&nbsp;Given&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="4736688">//&nbsp;for&nbsp;a&nbsp;specific&nbsp;file&nbsp;set&nbsp;fset,&nbsp;the&nbsp;corresponding&nbsp;Position&nbsp;value&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4736757">//&nbsp;obtained&nbsp;by&nbsp;calling&nbsp;fset.Position(p).</span><br>
<span class="lineno"></span><span class="comment" id="4736798">//</span><br>
<span class="lineno">65</span><span class="comment" id="4736801">//&nbsp;Pos&nbsp;values&nbsp;can&nbsp;be&nbsp;compared&nbsp;directly&nbsp;with&nbsp;the&nbsp;usual&nbsp;comparison&nbsp;operators:</span><br>
<span class="lineno"></span><span class="comment" id="4736877">//&nbsp;If&nbsp;two&nbsp;Pos&nbsp;values&nbsp;p&nbsp;and&nbsp;q&nbsp;are&nbsp;in&nbsp;the&nbsp;same&nbsp;file,&nbsp;comparing&nbsp;p&nbsp;and&nbsp;q&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4736949">//&nbsp;equivalent&nbsp;to&nbsp;comparing&nbsp;the&nbsp;respective&nbsp;source&nbsp;file&nbsp;offsets.&nbsp;If&nbsp;p&nbsp;and&nbsp;q</span><br>
<span class="lineno"></span><span class="comment" id="4737023">//&nbsp;are&nbsp;in&nbsp;different&nbsp;files,&nbsp;p&nbsp;&lt;&nbsp;q&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;p&nbsp;was&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="4737099">//&nbsp;to&nbsp;the&nbsp;respective&nbsp;file&nbsp;set&nbsp;before&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;q.</span><br>
<span class="lineno">70</span><span class="comment" id="4737159">//</span><br>
<span class="lineno"></span><span class="keyword" id="4737162">type</span>&nbsp;<span class="ident" id="4737167">Pos</span>&nbsp;<span class="builtintype" id="4737171">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4737176">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Pos&nbsp;is&nbsp;NoPos;&nbsp;there&nbsp;is&nbsp;no&nbsp;file&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="4737250">//&nbsp;associated&nbsp;with&nbsp;it,&nbsp;and&nbsp;NoPos().IsValid()&nbsp;is&nbsp;false.&nbsp;NoPos&nbsp;is&nbsp;always</span><br>
<span class="lineno">75</span><span class="comment" id="4737321">//&nbsp;smaller&nbsp;than&nbsp;any&nbsp;other&nbsp;Pos&nbsp;value.&nbsp;The&nbsp;corresponding&nbsp;Position&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4737391">//&nbsp;for&nbsp;NoPos&nbsp;is&nbsp;the&nbsp;zero&nbsp;value&nbsp;for&nbsp;Position.</span><br>
<span class="lineno"></span><span class="comment" id="4737436">//</span><br>
<span class="lineno"></span><span class="keyword" id="4737439">const</span>&nbsp;<span class="ident" id="4737445">NoPos</span>&nbsp;<span class="ident" id="4737451">Pos</span>&nbsp;<span class="op" id="4737455">=</span>&nbsp;<span class="num" id="4737457">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4737460">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4737510">func</span>&nbsp;<span class="op" id="4737515">(</span><span class="ident" id="4737516">p</span>&nbsp;<span class="ident" id="4737518">Pos</span><span class="op" id="4737521">)</span>&nbsp;<span class="ident" id="4737523">IsValid</span><span class="op" id="4737530">(</span><span class="op" id="4737531">)</span>&nbsp;<span class="builtintype" id="4737533">bool</span>&nbsp;<span class="op" id="4737538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4737541">return</span>&nbsp;<span class="ident" id="4737548">p</span>&nbsp;<span class="op" id="4737550">!=</span>&nbsp;<span class="ident" id="4737553">NoPos</span><br>
<span class="lineno"></span><span class="op" id="4737559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="4737562">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4737643">//&nbsp;File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4737652">//&nbsp;A&nbsp;File&nbsp;is&nbsp;a&nbsp;handle&nbsp;for&nbsp;a&nbsp;file&nbsp;belonging&nbsp;to&nbsp;a&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="comment" id="4737709">//&nbsp;A&nbsp;File&nbsp;has&nbsp;a&nbsp;name,&nbsp;size,&nbsp;and&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno">90</span><span class="comment" id="4737760">//</span><br>
<span class="lineno"></span><span class="keyword" id="4737763">type</span>&nbsp;<span class="ident" id="4737768">File</span>&nbsp;<span class="keyword" id="4737773">struct</span>&nbsp;<span class="op" id="4737780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4737783">set</span>&nbsp;&nbsp;<span class="op" id="4737788">*</span><span class="ident" id="4737789">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4737798">name</span>&nbsp;<span class="builtintype" id="4737803">string</span>&nbsp;<span class="comment" id="4737810">//&nbsp;file&nbsp;name&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4737847">base</span>&nbsp;<span class="builtintype" id="4737852">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4737859">//&nbsp;Pos&nbsp;value&nbsp;range&nbsp;for&nbsp;this&nbsp;file&nbsp;is&nbsp;[base...base+size]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4737915">size</span>&nbsp;<span class="builtintype" id="4737920">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4737927">//&nbsp;file&nbsp;size&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4737965">//&nbsp;lines&nbsp;and&nbsp;infos&nbsp;are&nbsp;protected&nbsp;by&nbsp;set.mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4738012">lines</span>&nbsp;<span class="op" id="4738018">[</span><span class="op" id="4738019">]</span><span class="builtintype" id="4738020">int</span>&nbsp;<span class="comment" id="4738024">//&nbsp;lines&nbsp;contains&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;for&nbsp;each&nbsp;line&nbsp;(the&nbsp;first&nbsp;entry&nbsp;is&nbsp;always&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4738121">infos</span>&nbsp;<span class="op" id="4738127">[</span><span class="op" id="4738128">]</span><span class="ident" id="4738129">lineInfo</span><br>
<span class="lineno">100</span><span class="op" id="4738138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4738141">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="4738209">func</span>&nbsp;<span class="op" id="4738214">(</span><span class="ident" id="4738215">f</span>&nbsp;<span class="op" id="4738217">*</span><span class="ident" id="4738218">File</span><span class="op" id="4738222">)</span>&nbsp;<span class="ident" id="4738224">Name</span><span class="op" id="4738228">(</span><span class="op" id="4738229">)</span>&nbsp;<span class="builtintype" id="4738231">string</span>&nbsp;<span class="op" id="4738238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738241">return</span>&nbsp;<span class="ident" id="4738248">f</span><span class="op" id="4738249">.</span><span class="ident" id="4738250">name</span><br>
<span class="lineno">105</span><span class="op" id="4738255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4738258">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;base&nbsp;offset&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="4738328">func</span>&nbsp;<span class="op" id="4738333">(</span><span class="ident" id="4738334">f</span>&nbsp;<span class="op" id="4738336">*</span><span class="ident" id="4738337">File</span><span class="op" id="4738341">)</span>&nbsp;<span class="ident" id="4738343">Base</span><span class="op" id="4738347">(</span><span class="op" id="4738348">)</span>&nbsp;<span class="builtintype" id="4738350">int</span>&nbsp;<span class="op" id="4738354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738357">return</span>&nbsp;<span class="ident" id="4738364">f</span><span class="op" id="4738365">.</span><span class="ident" id="4738366">base</span><br>
<span class="lineno">110</span><span class="op" id="4738371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4738374">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="4738437">func</span>&nbsp;<span class="op" id="4738442">(</span><span class="ident" id="4738443">f</span>&nbsp;<span class="op" id="4738445">*</span><span class="ident" id="4738446">File</span><span class="op" id="4738450">)</span>&nbsp;<span class="ident" id="4738452">Size</span><span class="op" id="4738456">(</span><span class="op" id="4738457">)</span>&nbsp;<span class="builtintype" id="4738459">int</span>&nbsp;<span class="op" id="4738463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738466">return</span>&nbsp;<span class="ident" id="4738473">f</span><span class="op" id="4738474">.</span><span class="ident" id="4738475">size</span><br>
<span class="lineno">115</span><span class="op" id="4738480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4738483">//&nbsp;LineCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;lines&nbsp;in&nbsp;file&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="4738535">func</span>&nbsp;<span class="op" id="4738540">(</span><span class="ident" id="4738541">f</span>&nbsp;<span class="op" id="4738543">*</span><span class="ident" id="4738544">File</span><span class="op" id="4738548">)</span>&nbsp;<span class="ident" id="4738550">LineCount</span><span class="op" id="4738559">(</span><span class="op" id="4738560">)</span>&nbsp;<span class="builtintype" id="4738562">int</span>&nbsp;<span class="op" id="4738566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4738569">f</span><span class="op" id="4738570">.</span><span class="ident" id="4738571">set</span><span class="op" id="4738574">.</span><span class="ident" id="4738575">mutex</span><span class="op" id="4738580">.</span><span class="ident" id="4738581">RLock</span><span class="op" id="4738586">(</span><span class="op" id="4738587">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4738590">n</span>&nbsp;<span class="op" id="4738592">:=</span>&nbsp;<span class="builtinfunc" id="4738595">len</span><span class="op" id="4738598">(</span><span class="ident" id="4738599">f</span><span class="op" id="4738600">.</span><span class="ident" id="4738601">lines</span><span class="op" id="4738606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4738609">f</span><span class="op" id="4738610">.</span><span class="ident" id="4738611">set</span><span class="op" id="4738614">.</span><span class="ident" id="4738615">mutex</span><span class="op" id="4738620">.</span><span class="ident" id="4738621">RUnlock</span><span class="op" id="4738628">(</span><span class="op" id="4738629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738632">return</span>&nbsp;<span class="ident" id="4738639">n</span><br>
<span class="lineno"></span><span class="op" id="4738641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="4738644">//&nbsp;AddLine&nbsp;adds&nbsp;the&nbsp;line&nbsp;offset&nbsp;for&nbsp;a&nbsp;new&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="4738692">//&nbsp;The&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4738764">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;line&nbsp;offset&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4738837">//</span><br>
<span class="lineno"></span><span class="keyword" id="4738840">func</span>&nbsp;<span class="op" id="4738845">(</span><span class="ident" id="4738846">f</span>&nbsp;<span class="op" id="4738848">*</span><span class="ident" id="4738849">File</span><span class="op" id="4738853">)</span>&nbsp;<span class="ident" id="4738855">AddLine</span><span class="op" id="4738862">(</span><span class="ident" id="4738863">offset</span>&nbsp;<span class="builtintype" id="4738870">int</span><span class="op" id="4738873">)</span>&nbsp;<span class="op" id="4738875">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4738878">f</span><span class="op" id="4738879">.</span><span class="ident" id="4738880">set</span><span class="op" id="4738883">.</span><span class="ident" id="4738884">mutex</span><span class="op" id="4738889">.</span><span class="ident" id="4738890">Lock</span><span class="op" id="4738894">(</span><span class="op" id="4738895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738898">if</span>&nbsp;<span class="ident" id="4738901">i</span>&nbsp;<span class="op" id="4738903">:=</span>&nbsp;<span class="builtinfunc" id="4738906">len</span><span class="op" id="4738909">(</span><span class="ident" id="4738910">f</span><span class="op" id="4738911">.</span><span class="ident" id="4738912">lines</span><span class="op" id="4738917">)</span><span class="op" id="4738918">;</span>&nbsp;<span class="op" id="4738920">(</span><span class="ident" id="4738921">i</span>&nbsp;<span class="op" id="4738923">==</span>&nbsp;<span class="num" id="4738926">0</span>&nbsp;<span class="op" id="4738928">||</span>&nbsp;<span class="ident" id="4738931">f</span><span class="op" id="4738932">.</span><span class="ident" id="4738933">lines</span><span class="op" id="4738938">[</span><span class="ident" id="4738939">i</span><span class="op" id="4738940">-</span><span class="num" id="4738941">1</span><span class="op" id="4738942">]</span>&nbsp;<span class="op" id="4738944">&lt;</span>&nbsp;<span class="ident" id="4738946">offset</span><span class="op" id="4738952">)</span>&nbsp;<span class="op" id="4738954">&amp;&amp;</span>&nbsp;<span class="ident" id="4738957">offset</span>&nbsp;<span class="op" id="4738964">&lt;</span>&nbsp;<span class="ident" id="4738966">f</span><span class="op" id="4738967">.</span><span class="ident" id="4738968">size</span>&nbsp;<span class="op" id="4738973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4738977">f</span><span class="op" id="4738978">.</span><span class="ident" id="4738979">lines</span>&nbsp;<span class="op" id="4738985">=</span>&nbsp;<span class="builtinfunc" id="4738987">append</span><span class="op" id="4738993">(</span><span class="ident" id="4738994">f</span><span class="op" id="4738995">.</span><span class="ident" id="4738996">lines</span><span class="op" id="4739001">,</span>&nbsp;<span class="ident" id="4739003">offset</span><span class="op" id="4739009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4739012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739015">f</span><span class="op" id="4739016">.</span><span class="ident" id="4739017">set</span><span class="op" id="4739020">.</span><span class="ident" id="4739021">mutex</span><span class="op" id="4739026">.</span><span class="ident" id="4739027">Unlock</span><span class="op" id="4739033">(</span><span class="op" id="4739034">)</span><br>
<span class="lineno">135</span><span class="op" id="4739036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4739039">//&nbsp;MergeLine&nbsp;merges&nbsp;a&nbsp;line&nbsp;with&nbsp;the&nbsp;following&nbsp;line.&nbsp;It&nbsp;is&nbsp;akin&nbsp;to&nbsp;replacing</span><br>
<span class="lineno"></span><span class="comment" id="4739115">//&nbsp;the&nbsp;newline&nbsp;character&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;with&nbsp;a&nbsp;space&nbsp;(to&nbsp;not&nbsp;change&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4739195">//&nbsp;remaining&nbsp;offsets).&nbsp;To&nbsp;obtain&nbsp;the&nbsp;line&nbsp;number,&nbsp;consult&nbsp;e.g.&nbsp;Position.Line.</span><br>
<span class="lineno">140</span><span class="comment" id="4739273">//&nbsp;MergeLine&nbsp;will&nbsp;panic&nbsp;if&nbsp;given&nbsp;an&nbsp;invalid&nbsp;line&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="4739330">//</span><br>
<span class="lineno"></span><span class="keyword" id="4739333">func</span>&nbsp;<span class="op" id="4739338">(</span><span class="ident" id="4739339">f</span>&nbsp;<span class="op" id="4739341">*</span><span class="ident" id="4739342">File</span><span class="op" id="4739346">)</span>&nbsp;<span class="ident" id="4739348">MergeLine</span><span class="op" id="4739357">(</span><span class="ident" id="4739358">line</span>&nbsp;<span class="builtintype" id="4739363">int</span><span class="op" id="4739366">)</span>&nbsp;<span class="op" id="4739368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4739371">if</span>&nbsp;<span class="ident" id="4739374">line</span>&nbsp;<span class="op" id="4739379">&lt;=</span>&nbsp;<span class="num" id="4739382">0</span>&nbsp;<span class="op" id="4739384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4739388">panic</span><span class="op" id="4739393">(</span><span class="string" id="4739394">&#34;illegal&nbsp;line&nbsp;number&nbsp;(line&nbsp;numbering&nbsp;starts&nbsp;at&nbsp;1)&#34;</span><span class="op" id="4739444">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4739447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739450">f</span><span class="op" id="4739451">.</span><span class="ident" id="4739452">set</span><span class="op" id="4739455">.</span><span class="ident" id="4739456">mutex</span><span class="op" id="4739461">.</span><span class="ident" id="4739462">Lock</span><span class="op" id="4739466">(</span><span class="op" id="4739467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4739470">defer</span>&nbsp;<span class="ident" id="4739476">f</span><span class="op" id="4739477">.</span><span class="ident" id="4739478">set</span><span class="op" id="4739481">.</span><span class="ident" id="4739482">mutex</span><span class="op" id="4739487">.</span><span class="ident" id="4739488">Unlock</span><span class="op" id="4739494">(</span><span class="op" id="4739495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4739498">if</span>&nbsp;<span class="ident" id="4739501">line</span>&nbsp;<span class="op" id="4739506">&gt;=</span>&nbsp;<span class="builtinfunc" id="4739509">len</span><span class="op" id="4739512">(</span><span class="ident" id="4739513">f</span><span class="op" id="4739514">.</span><span class="ident" id="4739515">lines</span><span class="op" id="4739520">)</span>&nbsp;<span class="op" id="4739522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4739526">panic</span><span class="op" id="4739531">(</span><span class="string" id="4739532">&#34;illegal&nbsp;line&nbsp;number&#34;</span><span class="op" id="4739553">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4739556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4739559">//&nbsp;To&nbsp;merge&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line&gt;&nbsp;with&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line+1&gt;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4739630">//&nbsp;we&nbsp;need&nbsp;to&nbsp;remove&nbsp;the&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4739697">//&nbsp;numbered&nbsp;&lt;line+1&gt;.&nbsp;The&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4739765">//&nbsp;numbered&nbsp;&lt;line+1&gt;&nbsp;is&nbsp;located&nbsp;at&nbsp;index&nbsp;&lt;line&gt;,&nbsp;since&nbsp;indices&nbsp;in&nbsp;lines</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4739838">//&nbsp;are&nbsp;0-based&nbsp;and&nbsp;line&nbsp;numbers&nbsp;are&nbsp;1-based.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4739884">copy</span><span class="op" id="4739888">(</span><span class="ident" id="4739889">f</span><span class="op" id="4739890">.</span><span class="ident" id="4739891">lines</span><span class="op" id="4739896">[</span><span class="ident" id="4739897">line</span><span class="op" id="4739901">:</span><span class="op" id="4739902">]</span><span class="op" id="4739903">,</span>&nbsp;<span class="ident" id="4739905">f</span><span class="op" id="4739906">.</span><span class="ident" id="4739907">lines</span><span class="op" id="4739912">[</span><span class="ident" id="4739913">line</span><span class="op" id="4739917">+</span><span class="num" id="4739918">1</span><span class="op" id="4739919">:</span><span class="op" id="4739920">]</span><span class="op" id="4739921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4739924">f</span><span class="op" id="4739925">.</span><span class="ident" id="4739926">lines</span>&nbsp;<span class="op" id="4739932">=</span>&nbsp;<span class="ident" id="4739934">f</span><span class="op" id="4739935">.</span><span class="ident" id="4739936">lines</span><span class="op" id="4739941">[</span><span class="op" id="4739942">:</span><span class="builtinfunc" id="4739943">len</span><span class="op" id="4739946">(</span><span class="ident" id="4739947">f</span><span class="op" id="4739948">.</span><span class="ident" id="4739949">lines</span><span class="op" id="4739954">)</span><span class="op" id="4739955">-</span><span class="num" id="4739956">1</span><span class="op" id="4739957">]</span><br>
<span class="lineno"></span><span class="op" id="4739959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="4739962">//&nbsp;SetLines&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;a&nbsp;file&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;successful.</span><br>
<span class="lineno"></span><span class="comment" id="4740039">//&nbsp;The&nbsp;line&nbsp;offsets&nbsp;are&nbsp;the&nbsp;offsets&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;of&nbsp;each&nbsp;line;</span><br>
<span class="lineno"></span><span class="comment" id="4740112">//&nbsp;for&nbsp;instance&nbsp;for&nbsp;the&nbsp;content&nbsp;&#34;ab\nc\n&#34;&nbsp;the&nbsp;line&nbsp;offsets&nbsp;are&nbsp;{0,&nbsp;3}.</span><br>
<span class="lineno"></span><span class="comment" id="4740183">//&nbsp;An&nbsp;empty&nbsp;file&nbsp;has&nbsp;an&nbsp;empty&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment" id="4740232">//&nbsp;Each&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno">165</span><span class="comment" id="4740305">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;SetLines&nbsp;fails&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4740377">//&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="4740387">//</span><br>
<span class="lineno"></span><span class="keyword" id="4740390">func</span>&nbsp;<span class="op" id="4740395">(</span><span class="ident" id="4740396">f</span>&nbsp;<span class="op" id="4740398">*</span><span class="ident" id="4740399">File</span><span class="op" id="4740403">)</span>&nbsp;<span class="ident" id="4740405">SetLines</span><span class="op" id="4740413">(</span><span class="ident" id="4740414">lines</span>&nbsp;<span class="op" id="4740420">[</span><span class="op" id="4740421">]</span><span class="builtintype" id="4740422">int</span><span class="op" id="4740425">)</span>&nbsp;<span class="builtintype" id="4740427">bool</span>&nbsp;<span class="op" id="4740432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4740435">//&nbsp;verify&nbsp;validity&nbsp;of&nbsp;lines&nbsp;table</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740470">size</span>&nbsp;<span class="op" id="4740475">:=</span>&nbsp;<span class="ident" id="4740478">f</span><span class="op" id="4740479">.</span><span class="ident" id="4740480">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740486">for</span>&nbsp;<span class="ident" id="4740490">i</span><span class="op" id="4740491">,</span>&nbsp;<span class="ident" id="4740493">offset</span>&nbsp;<span class="op" id="4740500">:=</span>&nbsp;<span class="keyword" id="4740503">range</span>&nbsp;<span class="ident" id="4740509">lines</span>&nbsp;<span class="op" id="4740515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740519">if</span>&nbsp;<span class="ident" id="4740522">i</span>&nbsp;<span class="op" id="4740524">&gt;</span>&nbsp;<span class="num" id="4740526">0</span>&nbsp;<span class="op" id="4740528">&amp;&amp;</span>&nbsp;<span class="ident" id="4740531">offset</span>&nbsp;<span class="op" id="4740538">&lt;=</span>&nbsp;<span class="ident" id="4740541">lines</span><span class="op" id="4740546">[</span><span class="ident" id="4740547">i</span><span class="op" id="4740548">-</span><span class="num" id="4740549">1</span><span class="op" id="4740550">]</span>&nbsp;<span class="op" id="4740552">||</span>&nbsp;<span class="ident" id="4740555">size</span>&nbsp;<span class="op" id="4740560">&lt;=</span>&nbsp;<span class="ident" id="4740563">offset</span>&nbsp;<span class="op" id="4740570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740575">return</span>&nbsp;<span class="builtintype" id="4740582">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4740590">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4740593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4740597">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740617">f</span><span class="op" id="4740618">.</span><span class="ident" id="4740619">set</span><span class="op" id="4740622">.</span><span class="ident" id="4740623">mutex</span><span class="op" id="4740628">.</span><span class="ident" id="4740629">Lock</span><span class="op" id="4740633">(</span><span class="op" id="4740634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740637">f</span><span class="op" id="4740638">.</span><span class="ident" id="4740639">lines</span>&nbsp;<span class="op" id="4740645">=</span>&nbsp;<span class="ident" id="4740647">lines</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740654">f</span><span class="op" id="4740655">.</span><span class="ident" id="4740656">set</span><span class="op" id="4740659">.</span><span class="ident" id="4740660">mutex</span><span class="op" id="4740665">.</span><span class="ident" id="4740666">Unlock</span><span class="op" id="4740672">(</span><span class="op" id="4740673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740676">return</span>&nbsp;<span class="builtintype" id="4740683">true</span><br>
<span class="lineno"></span><span class="op" id="4740688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4740691">//&nbsp;SetLinesForContent&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;content.</span><br>
<span class="lineno">185</span><span class="comment" id="4740763">//&nbsp;It&nbsp;ignores&nbsp;position-altering&nbsp;//line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="keyword" id="4740812">func</span>&nbsp;<span class="op" id="4740817">(</span><span class="ident" id="4740818">f</span>&nbsp;<span class="op" id="4740820">*</span><span class="ident" id="4740821">File</span><span class="op" id="4740825">)</span>&nbsp;<span class="ident" id="4740827">SetLinesForContent</span><span class="op" id="4740845">(</span><span class="ident" id="4740846">content</span>&nbsp;<span class="op" id="4740854">[</span><span class="op" id="4740855">]</span><span class="builtintype" id="4740856">byte</span><span class="op" id="4740860">)</span>&nbsp;<span class="op" id="4740862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740865">var</span>&nbsp;<span class="ident" id="4740869">lines</span>&nbsp;<span class="op" id="4740875">[</span><span class="op" id="4740876">]</span><span class="builtintype" id="4740877">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740882">line</span>&nbsp;<span class="op" id="4740887">:=</span>&nbsp;<span class="num" id="4740890">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740893">for</span>&nbsp;<span class="ident" id="4740897">offset</span><span class="op" id="4740903">,</span>&nbsp;<span class="ident" id="4740905">b</span>&nbsp;<span class="op" id="4740907">:=</span>&nbsp;<span class="keyword" id="4740910">range</span>&nbsp;<span class="ident" id="4740916">content</span>&nbsp;<span class="op" id="4740924">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740928">if</span>&nbsp;<span class="ident" id="4740931">line</span>&nbsp;<span class="op" id="4740936">&gt;=</span>&nbsp;<span class="num" id="4740939">0</span>&nbsp;<span class="op" id="4740941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740946">lines</span>&nbsp;<span class="op" id="4740952">=</span>&nbsp;<span class="builtinfunc" id="4740954">append</span><span class="op" id="4740960">(</span><span class="ident" id="4740961">lines</span><span class="op" id="4740966">,</span>&nbsp;<span class="ident" id="4740968">line</span><span class="op" id="4740972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4740976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740980">line</span>&nbsp;<span class="op" id="4740985">=</span>&nbsp;<span class="op" id="4740987">-</span><span class="num" id="4740988">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740992">if</span>&nbsp;<span class="ident" id="4740995">b</span>&nbsp;<span class="op" id="4740997">==</span>&nbsp;<span class="string" id="4741000">&#39;\n&#39;</span>&nbsp;<span class="op" id="4741005">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741010">line</span>&nbsp;<span class="op" id="4741015">=</span>&nbsp;<span class="ident" id="4741017">offset</span>&nbsp;<span class="op" id="4741024">+</span>&nbsp;<span class="num" id="4741026">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4741030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4741033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4741037">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741057">f</span><span class="op" id="4741058">.</span><span class="ident" id="4741059">set</span><span class="op" id="4741062">.</span><span class="ident" id="4741063">mutex</span><span class="op" id="4741068">.</span><span class="ident" id="4741069">Lock</span><span class="op" id="4741073">(</span><span class="op" id="4741074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741077">f</span><span class="op" id="4741078">.</span><span class="ident" id="4741079">lines</span>&nbsp;<span class="op" id="4741085">=</span>&nbsp;<span class="ident" id="4741087">lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741094">f</span><span class="op" id="4741095">.</span><span class="ident" id="4741096">set</span><span class="op" id="4741099">.</span><span class="ident" id="4741100">mutex</span><span class="op" id="4741105">.</span><span class="ident" id="4741106">Unlock</span><span class="op" id="4741112">(</span><span class="op" id="4741113">)</span><br>
<span class="lineno"></span><span class="op" id="4741115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="4741118">//&nbsp;A&nbsp;lineInfo&nbsp;object&nbsp;describes&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="4741182">//&nbsp;information&nbsp;(such&nbsp;as&nbsp;provided&nbsp;via&nbsp;a&nbsp;//line&nbsp;comment&nbsp;in&nbsp;a&nbsp;.go</span><br>
<span class="lineno"></span><span class="comment" id="4741245">//&nbsp;file)&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="4741279">type</span>&nbsp;<span class="ident" id="4741284">lineInfo</span>&nbsp;<span class="keyword" id="4741293">struct</span>&nbsp;<span class="op" id="4741300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4741303">//&nbsp;fields&nbsp;are&nbsp;exported&nbsp;to&nbsp;make&nbsp;them&nbsp;accessible&nbsp;to&nbsp;gob</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741358">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4741367">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741372">Filename</span>&nbsp;<span class="builtintype" id="4741381">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741389">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4741398">int</span><br>
<span class="lineno"></span><span class="op" id="4741402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="4741405">//&nbsp;AddLineInfo&nbsp;adds&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number&nbsp;information&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4741474">//&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.&nbsp;The&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4741544">//&nbsp;the&nbsp;previously&nbsp;added&nbsp;alternative&nbsp;line&nbsp;info&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4741611">//&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;information&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4741663">//</span><br>
<span class="lineno">220</span><span class="comment" id="4741666">//&nbsp;AddLineInfo&nbsp;is&nbsp;typically&nbsp;used&nbsp;to&nbsp;register&nbsp;alternative&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="4741732">//&nbsp;information&nbsp;for&nbsp;//line&nbsp;filename:line&nbsp;comments&nbsp;in&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4741798">//</span><br>
<span class="lineno"></span><span class="keyword" id="4741801">func</span>&nbsp;<span class="op" id="4741806">(</span><span class="ident" id="4741807">f</span>&nbsp;<span class="op" id="4741809">*</span><span class="ident" id="4741810">File</span><span class="op" id="4741814">)</span>&nbsp;<span class="ident" id="4741816">AddLineInfo</span><span class="op" id="4741827">(</span><span class="ident" id="4741828">offset</span>&nbsp;<span class="builtintype" id="4741835">int</span><span class="op" id="4741838">,</span>&nbsp;<span class="ident" id="4741840">filename</span>&nbsp;<span class="builtintype" id="4741849">string</span><span class="op" id="4741855">,</span>&nbsp;<span class="ident" id="4741857">line</span>&nbsp;<span class="builtintype" id="4741862">int</span><span class="op" id="4741865">)</span>&nbsp;<span class="op" id="4741867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741870">f</span><span class="op" id="4741871">.</span><span class="ident" id="4741872">set</span><span class="op" id="4741875">.</span><span class="ident" id="4741876">mutex</span><span class="op" id="4741881">.</span><span class="ident" id="4741882">Lock</span><span class="op" id="4741886">(</span><span class="op" id="4741887">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741890">if</span>&nbsp;<span class="ident" id="4741893">i</span>&nbsp;<span class="op" id="4741895">:=</span>&nbsp;<span class="builtinfunc" id="4741898">len</span><span class="op" id="4741901">(</span><span class="ident" id="4741902">f</span><span class="op" id="4741903">.</span><span class="ident" id="4741904">infos</span><span class="op" id="4741909">)</span><span class="op" id="4741910">;</span>&nbsp;<span class="ident" id="4741912">i</span>&nbsp;<span class="op" id="4741914">==</span>&nbsp;<span class="num" id="4741917">0</span>&nbsp;<span class="op" id="4741919">||</span>&nbsp;<span class="ident" id="4741922">f</span><span class="op" id="4741923">.</span><span class="ident" id="4741924">infos</span><span class="op" id="4741929">[</span><span class="ident" id="4741930">i</span><span class="op" id="4741931">-</span><span class="num" id="4741932">1</span><span class="op" id="4741933">]</span><span class="op" id="4741934">.</span><span class="ident" id="4741935">Offset</span>&nbsp;<span class="op" id="4741942">&lt;</span>&nbsp;<span class="ident" id="4741944">offset</span>&nbsp;<span class="op" id="4741951">&amp;&amp;</span>&nbsp;<span class="ident" id="4741954">offset</span>&nbsp;<span class="op" id="4741961">&lt;</span>&nbsp;<span class="ident" id="4741963">f</span><span class="op" id="4741964">.</span><span class="ident" id="4741965">size</span>&nbsp;<span class="op" id="4741970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741974">f</span><span class="op" id="4741975">.</span><span class="ident" id="4741976">infos</span>&nbsp;<span class="op" id="4741982">=</span>&nbsp;<span class="builtinfunc" id="4741984">append</span><span class="op" id="4741990">(</span><span class="ident" id="4741991">f</span><span class="op" id="4741992">.</span><span class="ident" id="4741993">infos</span><span class="op" id="4741998">,</span>&nbsp;<span class="ident" id="4742000">lineInfo</span><span class="op" id="4742008">{</span><span class="ident" id="4742009">offset</span><span class="op" id="4742015">,</span>&nbsp;<span class="ident" id="4742017">filename</span><span class="op" id="4742025">,</span>&nbsp;<span class="ident" id="4742027">line</span><span class="op" id="4742031">}</span><span class="op" id="4742032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742038">f</span><span class="op" id="4742039">.</span><span class="ident" id="4742040">set</span><span class="op" id="4742043">.</span><span class="ident" id="4742044">mutex</span><span class="op" id="4742049">.</span><span class="ident" id="4742050">Unlock</span><span class="op" id="4742056">(</span><span class="op" id="4742057">)</span><br>
<span class="lineno"></span><span class="op" id="4742059">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="4742062">//&nbsp;Pos&nbsp;returns&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;offset;</span><br>
<span class="lineno"></span><span class="comment" id="4742118">//&nbsp;the&nbsp;offset&nbsp;must&nbsp;be&nbsp;&lt;=&nbsp;f.Size().</span><br>
<span class="lineno"></span><span class="comment" id="4742153">//&nbsp;f.Pos(f.Offset(p))&nbsp;==&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="4742181">//</span><br>
<span class="lineno">235</span><span class="keyword" id="4742184">func</span>&nbsp;<span class="op" id="4742189">(</span><span class="ident" id="4742190">f</span>&nbsp;<span class="op" id="4742192">*</span><span class="ident" id="4742193">File</span><span class="op" id="4742197">)</span>&nbsp;<span class="ident" id="4742199">Pos</span><span class="op" id="4742202">(</span><span class="ident" id="4742203">offset</span>&nbsp;<span class="builtintype" id="4742210">int</span><span class="op" id="4742213">)</span>&nbsp;<span class="ident" id="4742215">Pos</span>&nbsp;<span class="op" id="4742219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742222">if</span>&nbsp;<span class="ident" id="4742225">offset</span>&nbsp;<span class="op" id="4742232">&gt;</span>&nbsp;<span class="ident" id="4742234">f</span><span class="op" id="4742235">.</span><span class="ident" id="4742236">size</span>&nbsp;<span class="op" id="4742241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4742245">panic</span><span class="op" id="4742250">(</span><span class="string" id="4742251">&#34;illegal&nbsp;file&nbsp;offset&#34;</span><span class="op" id="4742272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742278">return</span>&nbsp;<span class="ident" id="4742285">Pos</span><span class="op" id="4742288">(</span><span class="ident" id="4742289">f</span><span class="op" id="4742290">.</span><span class="ident" id="4742291">base</span>&nbsp;<span class="op" id="4742296">+</span>&nbsp;<span class="ident" id="4742298">offset</span><span class="op" id="4742304">)</span><br>
<span class="lineno">240</span><span class="op" id="4742306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4742309">//&nbsp;Offset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="4742369">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;valid&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4742414">//&nbsp;f.Offset(f.Pos(offset))&nbsp;==&nbsp;offset.</span><br>
<span class="lineno">245</span><span class="comment" id="4742452">//</span><br>
<span class="lineno"></span><span class="keyword" id="4742455">func</span>&nbsp;<span class="op" id="4742460">(</span><span class="ident" id="4742461">f</span>&nbsp;<span class="op" id="4742463">*</span><span class="ident" id="4742464">File</span><span class="op" id="4742468">)</span>&nbsp;<span class="ident" id="4742470">Offset</span><span class="op" id="4742476">(</span><span class="ident" id="4742477">p</span>&nbsp;<span class="ident" id="4742479">Pos</span><span class="op" id="4742482">)</span>&nbsp;<span class="builtintype" id="4742484">int</span>&nbsp;<span class="op" id="4742488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742491">if</span>&nbsp;<span class="builtintype" id="4742494">int</span><span class="op" id="4742497">(</span><span class="ident" id="4742498">p</span><span class="op" id="4742499">)</span>&nbsp;<span class="op" id="4742501">&lt;</span>&nbsp;<span class="ident" id="4742503">f</span><span class="op" id="4742504">.</span><span class="ident" id="4742505">base</span>&nbsp;<span class="op" id="4742510">||</span>&nbsp;<span class="builtintype" id="4742513">int</span><span class="op" id="4742516">(</span><span class="ident" id="4742517">p</span><span class="op" id="4742518">)</span>&nbsp;<span class="op" id="4742520">&gt;</span>&nbsp;<span class="ident" id="4742522">f</span><span class="op" id="4742523">.</span><span class="ident" id="4742524">base</span><span class="op" id="4742528">+</span><span class="ident" id="4742529">f</span><span class="op" id="4742530">.</span><span class="ident" id="4742531">size</span>&nbsp;<span class="op" id="4742536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4742540">panic</span><span class="op" id="4742545">(</span><span class="string" id="4742546">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="4742565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742568">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742571">return</span>&nbsp;<span class="builtintype" id="4742578">int</span><span class="op" id="4742581">(</span><span class="ident" id="4742582">p</span><span class="op" id="4742583">)</span>&nbsp;<span class="op" id="4742585">-</span>&nbsp;<span class="ident" id="4742587">f</span><span class="op" id="4742588">.</span><span class="ident" id="4742589">base</span><br>
<span class="lineno"></span><span class="op" id="4742594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4742597">//&nbsp;Line&nbsp;returns&nbsp;the&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="4742660">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno">255</span><span class="comment" id="4742708">//</span><br>
<span class="lineno"></span><span class="keyword" id="4742711">func</span>&nbsp;<span class="op" id="4742716">(</span><span class="ident" id="4742717">f</span>&nbsp;<span class="op" id="4742719">*</span><span class="ident" id="4742720">File</span><span class="op" id="4742724">)</span>&nbsp;<span class="ident" id="4742726">Line</span><span class="op" id="4742730">(</span><span class="ident" id="4742731">p</span>&nbsp;<span class="ident" id="4742733">Pos</span><span class="op" id="4742736">)</span>&nbsp;<span class="builtintype" id="4742738">int</span>&nbsp;<span class="op" id="4742742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742745">return</span>&nbsp;<span class="ident" id="4742752">f</span><span class="op" id="4742753">.</span><span class="ident" id="4742754">Position</span><span class="op" id="4742762">(</span><span class="ident" id="4742763">p</span><span class="op" id="4742764">)</span><span class="op" id="4742765">.</span><span class="ident" id="4742766">Line</span><br>
<span class="lineno"></span><span class="op" id="4742771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="4742774">func</span>&nbsp;<span class="ident" id="4742779">searchLineInfos</span><span class="op" id="4742794">(</span><span class="ident" id="4742795">a</span>&nbsp;<span class="op" id="4742797">[</span><span class="op" id="4742798">]</span><span class="ident" id="4742799">lineInfo</span><span class="op" id="4742807">,</span>&nbsp;<span class="ident" id="4742809">x</span>&nbsp;<span class="builtintype" id="4742811">int</span><span class="op" id="4742814">)</span>&nbsp;<span class="builtintype" id="4742816">int</span>&nbsp;<span class="op" id="4742820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742823">return</span>&nbsp;<span class="ident" id="4742830">sort</span><span class="op" id="4742834">.</span><span class="ident" id="4742835">Search</span><span class="op" id="4742841">(</span><span class="builtinfunc" id="4742842">len</span><span class="op" id="4742845">(</span><span class="ident" id="4742846">a</span><span class="op" id="4742847">)</span><span class="op" id="4742848">,</span>&nbsp;<span class="keyword" id="4742850">func</span><span class="op" id="4742854">(</span><span class="ident" id="4742855">i</span>&nbsp;<span class="builtintype" id="4742857">int</span><span class="op" id="4742860">)</span>&nbsp;<span class="builtintype" id="4742862">bool</span>&nbsp;<span class="op" id="4742867">{</span>&nbsp;<span class="keyword" id="4742869">return</span>&nbsp;<span class="ident" id="4742876">a</span><span class="op" id="4742877">[</span><span class="ident" id="4742878">i</span><span class="op" id="4742879">]</span><span class="op" id="4742880">.</span><span class="ident" id="4742881">Offset</span>&nbsp;<span class="op" id="4742888">&gt;</span>&nbsp;<span class="ident" id="4742890">x</span>&nbsp;<span class="op" id="4742892">}</span><span class="op" id="4742893">)</span>&nbsp;<span class="op" id="4742895">-</span>&nbsp;<span class="num" id="4742897">1</span><br>
<span class="lineno"></span><span class="op" id="4742899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4742902">//&nbsp;unpack&nbsp;returns&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;and&nbsp;column&nbsp;number&nbsp;for&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno">265</span><span class="comment" id="4742979">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;unpack&nbsp;will&nbsp;return&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="4743055">//&nbsp;possibly&nbsp;adjusted&nbsp;by&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4743134">//</span><br>
<span class="lineno"></span><span class="keyword" id="4743137">func</span>&nbsp;<span class="op" id="4743142">(</span><span class="ident" id="4743143">f</span>&nbsp;<span class="op" id="4743145">*</span><span class="ident" id="4743146">File</span><span class="op" id="4743150">)</span>&nbsp;<span class="ident" id="4743152">unpack</span><span class="op" id="4743158">(</span><span class="ident" id="4743159">offset</span>&nbsp;<span class="builtintype" id="4743166">int</span><span class="op" id="4743169">,</span>&nbsp;<span class="ident" id="4743171">adjusted</span>&nbsp;<span class="builtintype" id="4743180">bool</span><span class="op" id="4743184">)</span>&nbsp;<span class="op" id="4743186">(</span><span class="ident" id="4743187">filename</span>&nbsp;<span class="builtintype" id="4743196">string</span><span class="op" id="4743202">,</span>&nbsp;<span class="ident" id="4743204">line</span><span class="op" id="4743208">,</span>&nbsp;<span class="ident" id="4743210">column</span>&nbsp;<span class="builtintype" id="4743217">int</span><span class="op" id="4743220">)</span>&nbsp;<span class="op" id="4743222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743225">filename</span>&nbsp;<span class="op" id="4743234">=</span>&nbsp;<span class="ident" id="4743236">f</span><span class="op" id="4743237">.</span><span class="ident" id="4743238">name</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743244">if</span>&nbsp;<span class="ident" id="4743247">i</span>&nbsp;<span class="op" id="4743249">:=</span>&nbsp;<span class="ident" id="4743252">searchInts</span><span class="op" id="4743262">(</span><span class="ident" id="4743263">f</span><span class="op" id="4743264">.</span><span class="ident" id="4743265">lines</span><span class="op" id="4743270">,</span>&nbsp;<span class="ident" id="4743272">offset</span><span class="op" id="4743278">)</span><span class="op" id="4743279">;</span>&nbsp;<span class="ident" id="4743281">i</span>&nbsp;<span class="op" id="4743283">&gt;=</span>&nbsp;<span class="num" id="4743286">0</span>&nbsp;<span class="op" id="4743288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743292">line</span><span class="op" id="4743296">,</span>&nbsp;<span class="ident" id="4743298">column</span>&nbsp;<span class="op" id="4743305">=</span>&nbsp;<span class="ident" id="4743307">i</span><span class="op" id="4743308">+</span><span class="num" id="4743309">1</span><span class="op" id="4743310">,</span>&nbsp;<span class="ident" id="4743312">offset</span><span class="op" id="4743318">-</span><span class="ident" id="4743319">f</span><span class="op" id="4743320">.</span><span class="ident" id="4743321">lines</span><span class="op" id="4743326">[</span><span class="ident" id="4743327">i</span><span class="op" id="4743328">]</span><span class="op" id="4743329">+</span><span class="num" id="4743330">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4743333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743336">if</span>&nbsp;<span class="ident" id="4743339">adjusted</span>&nbsp;<span class="op" id="4743348">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4743351">len</span><span class="op" id="4743354">(</span><span class="ident" id="4743355">f</span><span class="op" id="4743356">.</span><span class="ident" id="4743357">infos</span><span class="op" id="4743362">)</span>&nbsp;<span class="op" id="4743364">&gt;</span>&nbsp;<span class="num" id="4743366">0</span>&nbsp;<span class="op" id="4743368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4743372">//&nbsp;almost&nbsp;no&nbsp;files&nbsp;have&nbsp;extra&nbsp;line&nbsp;infos</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743415">if</span>&nbsp;<span class="ident" id="4743418">i</span>&nbsp;<span class="op" id="4743420">:=</span>&nbsp;<span class="ident" id="4743423">searchLineInfos</span><span class="op" id="4743438">(</span><span class="ident" id="4743439">f</span><span class="op" id="4743440">.</span><span class="ident" id="4743441">infos</span><span class="op" id="4743446">,</span>&nbsp;<span class="ident" id="4743448">offset</span><span class="op" id="4743454">)</span><span class="op" id="4743455">;</span>&nbsp;<span class="ident" id="4743457">i</span>&nbsp;<span class="op" id="4743459">&gt;=</span>&nbsp;<span class="num" id="4743462">0</span>&nbsp;<span class="op" id="4743464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743469">alt</span>&nbsp;<span class="op" id="4743473">:=</span>&nbsp;<span class="op" id="4743476">&amp;</span><span class="ident" id="4743477">f</span><span class="op" id="4743478">.</span><span class="ident" id="4743479">infos</span><span class="op" id="4743484">[</span><span class="ident" id="4743485">i</span><span class="op" id="4743486">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743491">filename</span>&nbsp;<span class="op" id="4743500">=</span>&nbsp;<span class="ident" id="4743502">alt</span><span class="op" id="4743505">.</span><span class="ident" id="4743506">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743518">if</span>&nbsp;<span class="ident" id="4743521">i</span>&nbsp;<span class="op" id="4743523">:=</span>&nbsp;<span class="ident" id="4743526">searchInts</span><span class="op" id="4743536">(</span><span class="ident" id="4743537">f</span><span class="op" id="4743538">.</span><span class="ident" id="4743539">lines</span><span class="op" id="4743544">,</span>&nbsp;<span class="ident" id="4743546">alt</span><span class="op" id="4743549">.</span><span class="ident" id="4743550">Offset</span><span class="op" id="4743556">)</span><span class="op" id="4743557">;</span>&nbsp;<span class="ident" id="4743559">i</span>&nbsp;<span class="op" id="4743561">&gt;=</span>&nbsp;<span class="num" id="4743564">0</span>&nbsp;<span class="op" id="4743566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743572">line</span>&nbsp;<span class="op" id="4743577">+=</span>&nbsp;<span class="ident" id="4743580">alt</span><span class="op" id="4743583">.</span><span class="ident" id="4743584">Line</span>&nbsp;<span class="op" id="4743589">-</span>&nbsp;<span class="ident" id="4743591">i</span>&nbsp;<span class="op" id="4743593">-</span>&nbsp;<span class="num" id="4743595">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4743600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4743604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4743607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743610">return</span><br>
<span class="lineno"></span><span class="op" id="4743617">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="4743620">func</span>&nbsp;<span class="op" id="4743625">(</span><span class="ident" id="4743626">f</span>&nbsp;<span class="op" id="4743628">*</span><span class="ident" id="4743629">File</span><span class="op" id="4743633">)</span>&nbsp;<span class="ident" id="4743635">position</span><span class="op" id="4743643">(</span><span class="ident" id="4743644">p</span>&nbsp;<span class="ident" id="4743646">Pos</span><span class="op" id="4743649">,</span>&nbsp;<span class="ident" id="4743651">adjusted</span>&nbsp;<span class="builtintype" id="4743660">bool</span><span class="op" id="4743664">)</span>&nbsp;<span class="op" id="4743666">(</span><span class="ident" id="4743667">pos</span>&nbsp;<span class="ident" id="4743671">Position</span><span class="op" id="4743679">)</span>&nbsp;<span class="op" id="4743681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743684">offset</span>&nbsp;<span class="op" id="4743691">:=</span>&nbsp;<span class="builtintype" id="4743694">int</span><span class="op" id="4743697">(</span><span class="ident" id="4743698">p</span><span class="op" id="4743699">)</span>&nbsp;<span class="op" id="4743701">-</span>&nbsp;<span class="ident" id="4743703">f</span><span class="op" id="4743704">.</span><span class="ident" id="4743705">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743711">pos</span><span class="op" id="4743714">.</span><span class="ident" id="4743715">Offset</span>&nbsp;<span class="op" id="4743722">=</span>&nbsp;<span class="ident" id="4743724">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743732">pos</span><span class="op" id="4743735">.</span><span class="ident" id="4743736">Filename</span><span class="op" id="4743744">,</span>&nbsp;<span class="ident" id="4743746">pos</span><span class="op" id="4743749">.</span><span class="ident" id="4743750">Line</span><span class="op" id="4743754">,</span>&nbsp;<span class="ident" id="4743756">pos</span><span class="op" id="4743759">.</span><span class="ident" id="4743760">Column</span>&nbsp;<span class="op" id="4743767">=</span>&nbsp;<span class="ident" id="4743769">f</span><span class="op" id="4743770">.</span><span class="ident" id="4743771">unpack</span><span class="op" id="4743777">(</span><span class="ident" id="4743778">offset</span><span class="op" id="4743784">,</span>&nbsp;<span class="ident" id="4743786">adjusted</span><span class="op" id="4743794">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743797">return</span><br>
<span class="lineno"></span><span class="op" id="4743804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4743807">//&nbsp;PositionFor&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="4743880">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno">295</span><span class="comment" id="4743953">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4744011">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;f&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="4744051">//</span><br>
<span class="lineno"></span><span class="keyword" id="4744054">func</span>&nbsp;<span class="op" id="4744059">(</span><span class="ident" id="4744060">f</span>&nbsp;<span class="op" id="4744062">*</span><span class="ident" id="4744063">File</span><span class="op" id="4744067">)</span>&nbsp;<span class="ident" id="4744069">PositionFor</span><span class="op" id="4744080">(</span><span class="ident" id="4744081">p</span>&nbsp;<span class="ident" id="4744083">Pos</span><span class="op" id="4744086">,</span>&nbsp;<span class="ident" id="4744088">adjusted</span>&nbsp;<span class="builtintype" id="4744097">bool</span><span class="op" id="4744101">)</span>&nbsp;<span class="op" id="4744103">(</span><span class="ident" id="4744104">pos</span>&nbsp;<span class="ident" id="4744108">Position</span><span class="op" id="4744116">)</span>&nbsp;<span class="op" id="4744118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744121">if</span>&nbsp;<span class="ident" id="4744124">p</span>&nbsp;<span class="op" id="4744126">!=</span>&nbsp;<span class="ident" id="4744129">NoPos</span>&nbsp;<span class="op" id="4744135">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744139">if</span>&nbsp;<span class="builtintype" id="4744142">int</span><span class="op" id="4744145">(</span><span class="ident" id="4744146">p</span><span class="op" id="4744147">)</span>&nbsp;<span class="op" id="4744149">&lt;</span>&nbsp;<span class="ident" id="4744151">f</span><span class="op" id="4744152">.</span><span class="ident" id="4744153">base</span>&nbsp;<span class="op" id="4744158">||</span>&nbsp;<span class="builtintype" id="4744161">int</span><span class="op" id="4744164">(</span><span class="ident" id="4744165">p</span><span class="op" id="4744166">)</span>&nbsp;<span class="op" id="4744168">&gt;</span>&nbsp;<span class="ident" id="4744170">f</span><span class="op" id="4744171">.</span><span class="ident" id="4744172">base</span><span class="op" id="4744176">+</span><span class="ident" id="4744177">f</span><span class="op" id="4744178">.</span><span class="ident" id="4744179">size</span>&nbsp;<span class="op" id="4744184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4744189">panic</span><span class="op" id="4744194">(</span><span class="string" id="4744195">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="4744214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744222">pos</span>&nbsp;<span class="op" id="4744226">=</span>&nbsp;<span class="ident" id="4744228">f</span><span class="op" id="4744229">.</span><span class="ident" id="4744230">position</span><span class="op" id="4744238">(</span><span class="ident" id="4744239">p</span><span class="op" id="4744240">,</span>&nbsp;<span class="ident" id="4744242">adjusted</span><span class="op" id="4744250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744253">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744256">return</span><br>
<span class="lineno"></span><span class="op" id="4744263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4744266">//&nbsp;Position&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="4744336">//&nbsp;Calling&nbsp;f.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;f.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno">310</span><span class="comment" id="4744410">//</span><br>
<span class="lineno"></span><span class="keyword" id="4744413">func</span>&nbsp;<span class="op" id="4744418">(</span><span class="ident" id="4744419">f</span>&nbsp;<span class="op" id="4744421">*</span><span class="ident" id="4744422">File</span><span class="op" id="4744426">)</span>&nbsp;<span class="ident" id="4744428">Position</span><span class="op" id="4744436">(</span><span class="ident" id="4744437">p</span>&nbsp;<span class="ident" id="4744439">Pos</span><span class="op" id="4744442">)</span>&nbsp;<span class="op" id="4744444">(</span><span class="ident" id="4744445">pos</span>&nbsp;<span class="ident" id="4744449">Position</span><span class="op" id="4744457">)</span>&nbsp;<span class="op" id="4744459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744462">return</span>&nbsp;<span class="ident" id="4744469">f</span><span class="op" id="4744470">.</span><span class="ident" id="4744471">PositionFor</span><span class="op" id="4744482">(</span><span class="ident" id="4744483">p</span><span class="op" id="4744484">,</span>&nbsp;<span class="builtintype" id="4744486">true</span><span class="op" id="4744490">)</span><br>
<span class="lineno"></span><span class="op" id="4744492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="4744495">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4744576">//&nbsp;FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4744588">//&nbsp;A&nbsp;FileSet&nbsp;represents&nbsp;a&nbsp;set&nbsp;of&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4744635">//&nbsp;Methods&nbsp;of&nbsp;file&nbsp;sets&nbsp;are&nbsp;synchronized;&nbsp;multiple&nbsp;goroutines</span><br>
<span class="lineno">320</span><span class="comment" id="4744697">//&nbsp;may&nbsp;invoke&nbsp;them&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="comment" id="4744730">//</span><br>
<span class="lineno"></span><span class="keyword" id="4744733">type</span>&nbsp;<span class="ident" id="4744738">FileSet</span>&nbsp;<span class="keyword" id="4744746">struct</span>&nbsp;<span class="op" id="4744753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744756">mutex</span>&nbsp;<span class="ident" id="4744762">sync</span><span class="op" id="4744766">.</span><span class="ident" id="4744767">RWMutex</span>&nbsp;<span class="comment" id="4744775">//&nbsp;protects&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744801">base</span>&nbsp;&nbsp;<span class="builtintype" id="4744807">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4744820">//&nbsp;base&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;file</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744854">files</span>&nbsp;<span class="op" id="4744860">[</span><span class="op" id="4744861">]</span><span class="op" id="4744862">*</span><span class="ident" id="4744863">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4744873">//&nbsp;list&nbsp;of&nbsp;files&nbsp;in&nbsp;the&nbsp;order&nbsp;added&nbsp;to&nbsp;the&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744921">last</span>&nbsp;&nbsp;<span class="op" id="4744927">*</span><span class="ident" id="4744928">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4744940">//&nbsp;cache&nbsp;of&nbsp;last&nbsp;file&nbsp;looked&nbsp;up</span><br>
<span class="lineno"></span><span class="op" id="4744972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4744975">//&nbsp;NewFileSet&nbsp;creates&nbsp;a&nbsp;new&nbsp;file&nbsp;set.</span><br>
<span class="lineno">330</span><span class="keyword" id="4745013">func</span>&nbsp;<span class="ident" id="4745018">NewFileSet</span><span class="op" id="4745028">(</span><span class="op" id="4745029">)</span>&nbsp;<span class="op" id="4745031">*</span><span class="ident" id="4745032">FileSet</span>&nbsp;<span class="op" id="4745040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745043">return</span>&nbsp;<span class="op" id="4745050">&amp;</span><span class="ident" id="4745051">FileSet</span><span class="op" id="4745058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745062">base</span><span class="op" id="4745066">:</span>&nbsp;<span class="num" id="4745068">1</span><span class="op" id="4745069">,</span>&nbsp;<span class="comment" id="4745071">//&nbsp;0&nbsp;==&nbsp;NoPos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745086">}</span><br>
<span class="lineno"></span><span class="op" id="4745088">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="comment" id="4745091">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;base&nbsp;offset&nbsp;that&nbsp;must&nbsp;be&nbsp;provided&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4745156">//&nbsp;AddFile&nbsp;when&nbsp;adding&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4745194">//</span><br>
<span class="lineno"></span><span class="keyword" id="4745197">func</span>&nbsp;<span class="op" id="4745202">(</span><span class="ident" id="4745203">s</span>&nbsp;<span class="op" id="4745205">*</span><span class="ident" id="4745206">FileSet</span><span class="op" id="4745213">)</span>&nbsp;<span class="ident" id="4745215">Base</span><span class="op" id="4745219">(</span><span class="op" id="4745220">)</span>&nbsp;<span class="builtintype" id="4745222">int</span>&nbsp;<span class="op" id="4745226">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745229">s</span><span class="op" id="4745230">.</span><span class="ident" id="4745231">mutex</span><span class="op" id="4745236">.</span><span class="ident" id="4745237">RLock</span><span class="op" id="4745242">(</span><span class="op" id="4745243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745246">b</span>&nbsp;<span class="op" id="4745248">:=</span>&nbsp;<span class="ident" id="4745251">s</span><span class="op" id="4745252">.</span><span class="ident" id="4745253">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745259">s</span><span class="op" id="4745260">.</span><span class="ident" id="4745261">mutex</span><span class="op" id="4745266">.</span><span class="ident" id="4745267">RUnlock</span><span class="op" id="4745274">(</span><span class="op" id="4745275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745278">return</span>&nbsp;<span class="ident" id="4745285">b</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="op" id="4745288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4745291">//&nbsp;AddFile&nbsp;adds&nbsp;a&nbsp;new&nbsp;file&nbsp;with&nbsp;a&nbsp;given&nbsp;filename,&nbsp;base&nbsp;offset,&nbsp;and&nbsp;file&nbsp;size</span><br>
<span class="lineno"></span><span class="comment" id="4745368">//&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;s&nbsp;and&nbsp;returns&nbsp;the&nbsp;file.&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;have&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="4745444">//&nbsp;name.&nbsp;The&nbsp;base&nbsp;offset&nbsp;must&nbsp;not&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base(),&nbsp;and</span><br>
<span class="lineno">350</span><span class="comment" id="4745520">//&nbsp;size&nbsp;must&nbsp;not&nbsp;be&nbsp;negative.&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;if&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span><span class="comment" id="4745601">//&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base()&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="4745663">//</span><br>
<span class="lineno"></span><span class="comment" id="4745666">//&nbsp;Adding&nbsp;the&nbsp;file&nbsp;will&nbsp;set&nbsp;the&nbsp;file&nbsp;set&#39;s&nbsp;Base()&nbsp;value&nbsp;to&nbsp;base&nbsp;+&nbsp;size&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="4745741">//&nbsp;as&nbsp;the&nbsp;minimum&nbsp;base&nbsp;value&nbsp;for&nbsp;the&nbsp;next&nbsp;file.&nbsp;The&nbsp;following&nbsp;relationship</span><br>
<span class="lineno">355</span><span class="comment" id="4745816">//&nbsp;exists&nbsp;between&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset&nbsp;offs:</span><br>
<span class="lineno"></span><span class="comment" id="4745878">//</span><br>
<span class="lineno"></span><span class="comment" id="4745881">//&nbsp;&nbsp;&nbsp;&nbspint(p)&nbsp;=&nbsp;base&nbsp;+&nbsp;offs</span><br>
<span class="lineno"></span><span class="comment" id="4745905">//</span><br>
<span class="lineno"></span><span class="comment" id="4745908">//&nbsp;with&nbsp;offs&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;size]&nbsp;and&nbsp;thus&nbsp;p&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size].</span><br>
<span class="lineno">360</span><span class="comment" id="4745987">//&nbsp;For&nbsp;convenience,&nbsp;File.Pos&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;file-specific&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="4746061">//&nbsp;values&nbsp;from&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="4746091">//</span><br>
<span class="lineno"></span><span class="keyword" id="4746094">func</span>&nbsp;<span class="op" id="4746099">(</span><span class="ident" id="4746100">s</span>&nbsp;<span class="op" id="4746102">*</span><span class="ident" id="4746103">FileSet</span><span class="op" id="4746110">)</span>&nbsp;<span class="ident" id="4746112">AddFile</span><span class="op" id="4746119">(</span><span class="ident" id="4746120">filename</span>&nbsp;<span class="builtintype" id="4746129">string</span><span class="op" id="4746135">,</span>&nbsp;<span class="ident" id="4746137">base</span><span class="op" id="4746141">,</span>&nbsp;<span class="ident" id="4746143">size</span>&nbsp;<span class="builtintype" id="4746148">int</span><span class="op" id="4746151">)</span>&nbsp;<span class="op" id="4746153">*</span><span class="ident" id="4746154">File</span>&nbsp;<span class="op" id="4746159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746162">s</span><span class="op" id="4746163">.</span><span class="ident" id="4746164">mutex</span><span class="op" id="4746169">.</span><span class="ident" id="4746170">Lock</span><span class="op" id="4746174">(</span><span class="op" id="4746175">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746178">defer</span>&nbsp;<span class="ident" id="4746184">s</span><span class="op" id="4746185">.</span><span class="ident" id="4746186">mutex</span><span class="op" id="4746191">.</span><span class="ident" id="4746192">Unlock</span><span class="op" id="4746198">(</span><span class="op" id="4746199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746202">if</span>&nbsp;<span class="ident" id="4746205">base</span>&nbsp;<span class="op" id="4746210">&lt;</span>&nbsp;<span class="num" id="4746212">0</span>&nbsp;<span class="op" id="4746214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746218">base</span>&nbsp;<span class="op" id="4746223">=</span>&nbsp;<span class="ident" id="4746225">s</span><span class="op" id="4746226">.</span><span class="ident" id="4746227">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4746233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746236">if</span>&nbsp;<span class="ident" id="4746239">base</span>&nbsp;<span class="op" id="4746244">&lt;</span>&nbsp;<span class="ident" id="4746246">s</span><span class="op" id="4746247">.</span><span class="ident" id="4746248">base</span>&nbsp;<span class="op" id="4746253">||</span>&nbsp;<span class="ident" id="4746256">size</span>&nbsp;<span class="op" id="4746261">&lt;</span>&nbsp;<span class="num" id="4746263">0</span>&nbsp;<span class="op" id="4746265">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4746269">panic</span><span class="op" id="4746274">(</span><span class="string" id="4746275">&#34;illegal&nbsp;base&nbsp;or&nbsp;size&#34;</span><span class="op" id="4746297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4746300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4746303">//&nbsp;base&nbsp;&gt;=&nbsp;s.base&nbsp;&amp;&amp;&nbsp;size&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746335">f</span>&nbsp;<span class="op" id="4746337">:=</span>&nbsp;<span class="op" id="4746340">&amp;</span><span class="ident" id="4746341">File</span><span class="op" id="4746345">{</span><span class="ident" id="4746346">s</span><span class="op" id="4746347">,</span>&nbsp;<span class="ident" id="4746349">filename</span><span class="op" id="4746357">,</span>&nbsp;<span class="ident" id="4746359">base</span><span class="op" id="4746363">,</span>&nbsp;<span class="ident" id="4746365">size</span><span class="op" id="4746369">,</span>&nbsp;<span class="op" id="4746371">[</span><span class="op" id="4746372">]</span><span class="builtintype" id="4746373">int</span><span class="op" id="4746376">{</span><span class="num" id="4746377">0</span><span class="op" id="4746378">}</span><span class="op" id="4746379">,</span>&nbsp;<span class="ident" id="4746381">nil</span><span class="op" id="4746384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746387">base</span>&nbsp;<span class="op" id="4746392">+=</span>&nbsp;<span class="ident" id="4746395">size</span>&nbsp;<span class="op" id="4746400">+</span>&nbsp;<span class="num" id="4746402">1</span>&nbsp;<span class="comment" id="4746404">//&nbsp;+1&nbsp;because&nbsp;EOF&nbsp;also&nbsp;has&nbsp;a&nbsp;position</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746443">if</span>&nbsp;<span class="ident" id="4746446">base</span>&nbsp;<span class="op" id="4746451">&lt;</span>&nbsp;<span class="num" id="4746453">0</span>&nbsp;<span class="op" id="4746455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4746459">panic</span><span class="op" id="4746464">(</span><span class="string" id="4746465">&#34;token.Pos&nbsp;offset&nbsp;overflow&nbsp;(&gt;&nbsp;2G&nbsp;of&nbsp;source&nbsp;code&nbsp;in&nbsp;file&nbsp;set)&#34;</span><span class="op" id="4746526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4746529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4746532">//&nbsp;add&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746565">s</span><span class="op" id="4746566">.</span><span class="ident" id="4746567">base</span>&nbsp;<span class="op" id="4746572">=</span>&nbsp;<span class="ident" id="4746574">base</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746580">s</span><span class="op" id="4746581">.</span><span class="ident" id="4746582">files</span>&nbsp;<span class="op" id="4746588">=</span>&nbsp;<span class="builtinfunc" id="4746590">append</span><span class="op" id="4746596">(</span><span class="ident" id="4746597">s</span><span class="op" id="4746598">.</span><span class="ident" id="4746599">files</span><span class="op" id="4746604">,</span>&nbsp;<span class="ident" id="4746606">f</span><span class="op" id="4746607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746610">s</span><span class="op" id="4746611">.</span><span class="ident" id="4746612">last</span>&nbsp;<span class="op" id="4746617">=</span>&nbsp;<span class="ident" id="4746619">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746622">return</span>&nbsp;<span class="ident" id="4746629">f</span><br>
<span class="lineno"></span><span class="op" id="4746631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="4746634">//&nbsp;Iterate&nbsp;calls&nbsp;f&nbsp;for&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;file&nbsp;set&nbsp;in&nbsp;the&nbsp;order&nbsp;they&nbsp;were&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="4746712">//&nbsp;until&nbsp;f&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="4746738">//</span><br>
<span class="lineno"></span><span class="keyword" id="4746741">func</span>&nbsp;<span class="op" id="4746746">(</span><span class="ident" id="4746747">s</span>&nbsp;<span class="op" id="4746749">*</span><span class="ident" id="4746750">FileSet</span><span class="op" id="4746757">)</span>&nbsp;<span class="ident" id="4746759">Iterate</span><span class="op" id="4746766">(</span><span class="ident" id="4746767">f</span>&nbsp;<span class="keyword" id="4746769">func</span><span class="op" id="4746773">(</span><span class="op" id="4746774">*</span><span class="ident" id="4746775">File</span><span class="op" id="4746779">)</span>&nbsp;<span class="builtintype" id="4746781">bool</span><span class="op" id="4746785">)</span>&nbsp;<span class="op" id="4746787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746790">for</span>&nbsp;<span class="ident" id="4746794">i</span>&nbsp;<span class="op" id="4746796">:=</span>&nbsp;<span class="num" id="4746799">0</span><span class="op" id="4746800">;</span>&nbsp;<span class="op" id="4746802">;</span>&nbsp;<span class="ident" id="4746804">i</span><span class="op" id="4746805">++</span>&nbsp;<span class="op" id="4746808">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746812">var</span>&nbsp;<span class="ident" id="4746816">file</span>&nbsp;<span class="op" id="4746821">*</span><span class="ident" id="4746822">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746829">s</span><span class="op" id="4746830">.</span><span class="ident" id="4746831">mutex</span><span class="op" id="4746836">.</span><span class="ident" id="4746837">RLock</span><span class="op" id="4746842">(</span><span class="op" id="4746843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746847">if</span>&nbsp;<span class="ident" id="4746850">i</span>&nbsp;<span class="op" id="4746852">&lt;</span>&nbsp;<span class="builtinfunc" id="4746854">len</span><span class="op" id="4746857">(</span><span class="ident" id="4746858">s</span><span class="op" id="4746859">.</span><span class="ident" id="4746860">files</span><span class="op" id="4746865">)</span>&nbsp;<span class="op" id="4746867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746872">file</span>&nbsp;<span class="op" id="4746877">=</span>&nbsp;<span class="ident" id="4746879">s</span><span class="op" id="4746880">.</span><span class="ident" id="4746881">files</span><span class="op" id="4746886">[</span><span class="ident" id="4746887">i</span><span class="op" id="4746888">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4746892">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746896">s</span><span class="op" id="4746897">.</span><span class="ident" id="4746898">mutex</span><span class="op" id="4746903">.</span><span class="ident" id="4746904">RUnlock</span><span class="op" id="4746911">(</span><span class="op" id="4746912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746916">if</span>&nbsp;<span class="ident" id="4746919">file</span>&nbsp;<span class="op" id="4746924">==</span>&nbsp;<span class="ident" id="4746927">nil</span>&nbsp;<span class="op" id="4746931">||</span>&nbsp;<span class="op" id="4746934">!</span><span class="ident" id="4746935">f</span><span class="op" id="4746936">(</span><span class="ident" id="4746937">file</span><span class="op" id="4746941">)</span>&nbsp;<span class="op" id="4746943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746948">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4746956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4746959">}</span><br>
<span class="lineno">400</span><span class="op" id="4746961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4746964">func</span>&nbsp;<span class="ident" id="4746969">searchFiles</span><span class="op" id="4746980">(</span><span class="ident" id="4746981">a</span>&nbsp;<span class="op" id="4746983">[</span><span class="op" id="4746984">]</span><span class="op" id="4746985">*</span><span class="ident" id="4746986">File</span><span class="op" id="4746990">,</span>&nbsp;<span class="ident" id="4746992">x</span>&nbsp;<span class="builtintype" id="4746994">int</span><span class="op" id="4746997">)</span>&nbsp;<span class="builtintype" id="4746999">int</span>&nbsp;<span class="op" id="4747003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747006">return</span>&nbsp;<span class="ident" id="4747013">sort</span><span class="op" id="4747017">.</span><span class="ident" id="4747018">Search</span><span class="op" id="4747024">(</span><span class="builtinfunc" id="4747025">len</span><span class="op" id="4747028">(</span><span class="ident" id="4747029">a</span><span class="op" id="4747030">)</span><span class="op" id="4747031">,</span>&nbsp;<span class="keyword" id="4747033">func</span><span class="op" id="4747037">(</span><span class="ident" id="4747038">i</span>&nbsp;<span class="builtintype" id="4747040">int</span><span class="op" id="4747043">)</span>&nbsp;<span class="builtintype" id="4747045">bool</span>&nbsp;<span class="op" id="4747050">{</span>&nbsp;<span class="keyword" id="4747052">return</span>&nbsp;<span class="ident" id="4747059">a</span><span class="op" id="4747060">[</span><span class="ident" id="4747061">i</span><span class="op" id="4747062">]</span><span class="op" id="4747063">.</span><span class="ident" id="4747064">base</span>&nbsp;<span class="op" id="4747069">&gt;</span>&nbsp;<span class="ident" id="4747071">x</span>&nbsp;<span class="op" id="4747073">}</span><span class="op" id="4747074">)</span>&nbsp;<span class="op" id="4747076">-</span>&nbsp;<span class="num" id="4747078">1</span><br>
<span class="lineno"></span><span class="op" id="4747080">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="4747083">func</span>&nbsp;<span class="op" id="4747088">(</span><span class="ident" id="4747089">s</span>&nbsp;<span class="op" id="4747091">*</span><span class="ident" id="4747092">FileSet</span><span class="op" id="4747099">)</span>&nbsp;<span class="ident" id="4747101">file</span><span class="op" id="4747105">(</span><span class="ident" id="4747106">p</span>&nbsp;<span class="ident" id="4747108">Pos</span><span class="op" id="4747111">)</span>&nbsp;<span class="op" id="4747113">*</span><span class="ident" id="4747114">File</span>&nbsp;<span class="op" id="4747119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747122">s</span><span class="op" id="4747123">.</span><span class="ident" id="4747124">mutex</span><span class="op" id="4747129">.</span><span class="ident" id="4747130">RLock</span><span class="op" id="4747135">(</span><span class="op" id="4747136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4747139">//&nbsp;common&nbsp;case:&nbsp;p&nbsp;is&nbsp;in&nbsp;last&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747174">if</span>&nbsp;<span class="ident" id="4747177">f</span>&nbsp;<span class="op" id="4747179">:=</span>&nbsp;<span class="ident" id="4747182">s</span><span class="op" id="4747183">.</span><span class="ident" id="4747184">last</span><span class="op" id="4747188">;</span>&nbsp;<span class="ident" id="4747190">f</span>&nbsp;<span class="op" id="4747192">!=</span>&nbsp;<span class="ident" id="4747195">nil</span>&nbsp;<span class="op" id="4747199">&amp;&amp;</span>&nbsp;<span class="ident" id="4747202">f</span><span class="op" id="4747203">.</span><span class="ident" id="4747204">base</span>&nbsp;<span class="op" id="4747209">&lt;=</span>&nbsp;<span class="builtintype" id="4747212">int</span><span class="op" id="4747215">(</span><span class="ident" id="4747216">p</span><span class="op" id="4747217">)</span>&nbsp;<span class="op" id="4747219">&amp;&amp;</span>&nbsp;<span class="builtintype" id="4747222">int</span><span class="op" id="4747225">(</span><span class="ident" id="4747226">p</span><span class="op" id="4747227">)</span>&nbsp;<span class="op" id="4747229">&lt;=</span>&nbsp;<span class="ident" id="4747232">f</span><span class="op" id="4747233">.</span><span class="ident" id="4747234">base</span><span class="op" id="4747238">+</span><span class="ident" id="4747239">f</span><span class="op" id="4747240">.</span><span class="ident" id="4747241">size</span>&nbsp;<span class="op" id="4747246">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747250">s</span><span class="op" id="4747251">.</span><span class="ident" id="4747252">mutex</span><span class="op" id="4747257">.</span><span class="ident" id="4747258">RUnlock</span><span class="op" id="4747265">(</span><span class="op" id="4747266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747270">return</span>&nbsp;<span class="ident" id="4747277">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4747280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4747283">//&nbsp;p&nbsp;is&nbsp;not&nbsp;in&nbsp;last&nbsp;file&nbsp;-&nbsp;search&nbsp;all&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747328">if</span>&nbsp;<span class="ident" id="4747331">i</span>&nbsp;<span class="op" id="4747333">:=</span>&nbsp;<span class="ident" id="4747336">searchFiles</span><span class="op" id="4747347">(</span><span class="ident" id="4747348">s</span><span class="op" id="4747349">.</span><span class="ident" id="4747350">files</span><span class="op" id="4747355">,</span>&nbsp;<span class="builtintype" id="4747357">int</span><span class="op" id="4747360">(</span><span class="ident" id="4747361">p</span><span class="op" id="4747362">)</span><span class="op" id="4747363">)</span><span class="op" id="4747364">;</span>&nbsp;<span class="ident" id="4747366">i</span>&nbsp;<span class="op" id="4747368">&gt;=</span>&nbsp;<span class="num" id="4747371">0</span>&nbsp;<span class="op" id="4747373">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747377">f</span>&nbsp;<span class="op" id="4747379">:=</span>&nbsp;<span class="ident" id="4747382">s</span><span class="op" id="4747383">.</span><span class="ident" id="4747384">files</span><span class="op" id="4747389">[</span><span class="ident" id="4747390">i</span><span class="op" id="4747391">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4747395">//&nbsp;f.base&nbsp;&lt;=&nbsp;int(p)&nbsp;by&nbsp;definition&nbsp;of&nbsp;searchFiles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747446">if</span>&nbsp;<span class="builtintype" id="4747449">int</span><span class="op" id="4747452">(</span><span class="ident" id="4747453">p</span><span class="op" id="4747454">)</span>&nbsp;<span class="op" id="4747456">&lt;=</span>&nbsp;<span class="ident" id="4747459">f</span><span class="op" id="4747460">.</span><span class="ident" id="4747461">base</span><span class="op" id="4747465">+</span><span class="ident" id="4747466">f</span><span class="op" id="4747467">.</span><span class="ident" id="4747468">size</span>&nbsp;<span class="op" id="4747473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747478">s</span><span class="op" id="4747479">.</span><span class="ident" id="4747480">mutex</span><span class="op" id="4747485">.</span><span class="ident" id="4747486">RUnlock</span><span class="op" id="4747493">(</span><span class="op" id="4747494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747499">s</span><span class="op" id="4747500">.</span><span class="ident" id="4747501">mutex</span><span class="op" id="4747506">.</span><span class="ident" id="4747507">Lock</span><span class="op" id="4747511">(</span><span class="op" id="4747512">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747517">s</span><span class="op" id="4747518">.</span><span class="ident" id="4747519">last</span>&nbsp;<span class="op" id="4747524">=</span>&nbsp;<span class="ident" id="4747526">f</span>&nbsp;<span class="comment" id="4747528">//&nbsp;race&nbsp;is&nbsp;ok&nbsp;-&nbsp;s.last&nbsp;is&nbsp;only&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747570">s</span><span class="op" id="4747571">.</span><span class="ident" id="4747572">mutex</span><span class="op" id="4747577">.</span><span class="ident" id="4747578">Unlock</span><span class="op" id="4747584">(</span><span class="op" id="4747585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747590">return</span>&nbsp;<span class="ident" id="4747597">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4747601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4747604">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747607">s</span><span class="op" id="4747608">.</span><span class="ident" id="4747609">mutex</span><span class="op" id="4747614">.</span><span class="ident" id="4747615">RUnlock</span><span class="op" id="4747622">(</span><span class="op" id="4747623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747626">return</span>&nbsp;<span class="ident" id="4747633">nil</span><br>
<span class="lineno"></span><span class="op" id="4747637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4747640">//&nbsp;File&nbsp;returns&nbsp;the&nbsp;file&nbsp;that&nbsp;contains&nbsp;the&nbsp;position&nbsp;p.</span><br>
<span class="lineno">430</span><span class="comment" id="4747695">//&nbsp;If&nbsp;no&nbsp;such&nbsp;file&nbsp;is&nbsp;found&nbsp;(for&nbsp;instance&nbsp;for&nbsp;p&nbsp;==&nbsp;NoPos),</span><br>
<span class="lineno"></span><span class="comment" id="4747754">//&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="4747776">//</span><br>
<span class="lineno"></span><span class="keyword" id="4747779">func</span>&nbsp;<span class="op" id="4747784">(</span><span class="ident" id="4747785">s</span>&nbsp;<span class="op" id="4747787">*</span><span class="ident" id="4747788">FileSet</span><span class="op" id="4747795">)</span>&nbsp;<span class="ident" id="4747797">File</span><span class="op" id="4747801">(</span><span class="ident" id="4747802">p</span>&nbsp;<span class="ident" id="4747804">Pos</span><span class="op" id="4747807">)</span>&nbsp;<span class="op" id="4747809">(</span><span class="ident" id="4747810">f</span>&nbsp;<span class="op" id="4747812">*</span><span class="ident" id="4747813">File</span><span class="op" id="4747817">)</span>&nbsp;<span class="op" id="4747819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747822">if</span>&nbsp;<span class="ident" id="4747825">p</span>&nbsp;<span class="op" id="4747827">!=</span>&nbsp;<span class="ident" id="4747830">NoPos</span>&nbsp;<span class="op" id="4747836">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4747840">f</span>&nbsp;<span class="op" id="4747842">=</span>&nbsp;<span class="ident" id="4747844">s</span><span class="op" id="4747845">.</span><span class="ident" id="4747846">file</span><span class="op" id="4747850">(</span><span class="ident" id="4747851">p</span><span class="op" id="4747852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4747855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747858">return</span><br>
<span class="lineno"></span><span class="op" id="4747865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="4747868">//&nbsp;PositionFor&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4747938">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno"></span><span class="comment" id="4748011">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4748069">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;s&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="4748109">//</span><br>
<span class="lineno">445</span><span class="keyword" id="4748112">func</span>&nbsp;<span class="op" id="4748117">(</span><span class="ident" id="4748118">s</span>&nbsp;<span class="op" id="4748120">*</span><span class="ident" id="4748121">FileSet</span><span class="op" id="4748128">)</span>&nbsp;<span class="ident" id="4748130">PositionFor</span><span class="op" id="4748141">(</span><span class="ident" id="4748142">p</span>&nbsp;<span class="ident" id="4748144">Pos</span><span class="op" id="4748147">,</span>&nbsp;<span class="ident" id="4748149">adjusted</span>&nbsp;<span class="builtintype" id="4748158">bool</span><span class="op" id="4748162">)</span>&nbsp;<span class="op" id="4748164">(</span><span class="ident" id="4748165">pos</span>&nbsp;<span class="ident" id="4748169">Position</span><span class="op" id="4748177">)</span>&nbsp;<span class="op" id="4748179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748182">if</span>&nbsp;<span class="ident" id="4748185">p</span>&nbsp;<span class="op" id="4748187">!=</span>&nbsp;<span class="ident" id="4748190">NoPos</span>&nbsp;<span class="op" id="4748196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748200">if</span>&nbsp;<span class="ident" id="4748203">f</span>&nbsp;<span class="op" id="4748205">:=</span>&nbsp;<span class="ident" id="4748208">s</span><span class="op" id="4748209">.</span><span class="ident" id="4748210">file</span><span class="op" id="4748214">(</span><span class="ident" id="4748215">p</span><span class="op" id="4748216">)</span><span class="op" id="4748217">;</span>&nbsp;<span class="ident" id="4748219">f</span>&nbsp;<span class="op" id="4748221">!=</span>&nbsp;<span class="ident" id="4748224">nil</span>&nbsp;<span class="op" id="4748228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748233">pos</span>&nbsp;<span class="op" id="4748237">=</span>&nbsp;<span class="ident" id="4748239">f</span><span class="op" id="4748240">.</span><span class="ident" id="4748241">position</span><span class="op" id="4748249">(</span><span class="ident" id="4748250">p</span><span class="op" id="4748251">,</span>&nbsp;<span class="ident" id="4748253">adjusted</span><span class="op" id="4748261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4748265">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4748268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748271">return</span><br>
<span class="lineno"></span><span class="op" id="4748278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4748281">//&nbsp;Position&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno">455</span><span class="comment" id="4748348">//&nbsp;Calling&nbsp;s.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;s.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno"></span><span class="comment" id="4748422">//</span><br>
<span class="lineno"></span><span class="keyword" id="4748425">func</span>&nbsp;<span class="op" id="4748430">(</span><span class="ident" id="4748431">s</span>&nbsp;<span class="op" id="4748433">*</span><span class="ident" id="4748434">FileSet</span><span class="op" id="4748441">)</span>&nbsp;<span class="ident" id="4748443">Position</span><span class="op" id="4748451">(</span><span class="ident" id="4748452">p</span>&nbsp;<span class="ident" id="4748454">Pos</span><span class="op" id="4748457">)</span>&nbsp;<span class="op" id="4748459">(</span><span class="ident" id="4748460">pos</span>&nbsp;<span class="ident" id="4748464">Position</span><span class="op" id="4748472">)</span>&nbsp;<span class="op" id="4748474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748477">return</span>&nbsp;<span class="ident" id="4748484">s</span><span class="op" id="4748485">.</span><span class="ident" id="4748486">PositionFor</span><span class="op" id="4748497">(</span><span class="ident" id="4748498">p</span><span class="op" id="4748499">,</span>&nbsp;<span class="builtintype" id="4748501">true</span><span class="op" id="4748505">)</span><br>
<span class="lineno"></span><span class="op" id="4748507">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="4748510">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4748591">//&nbsp;Helper&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4748612">func</span>&nbsp;<span class="ident" id="4748617">searchInts</span><span class="op" id="4748627">(</span><span class="ident" id="4748628">a</span>&nbsp;<span class="op" id="4748630">[</span><span class="op" id="4748631">]</span><span class="builtintype" id="4748632">int</span><span class="op" id="4748635">,</span>&nbsp;<span class="ident" id="4748637">x</span>&nbsp;<span class="builtintype" id="4748639">int</span><span class="op" id="4748642">)</span>&nbsp;<span class="builtintype" id="4748644">int</span>&nbsp;<span class="op" id="4748648">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4748651">//&nbsp;This&nbsp;function&nbsp;body&nbsp;is&nbsp;a&nbsp;manually&nbsp;inlined&nbsp;version&nbsp;of:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4748708">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4748712">//&nbsp;&nbsp;&nbsp;return&nbsp;sort.Search(len(a),&nbsp;func(i&nbsp;int)&nbsp;bool&nbsp;{&nbsp;return&nbsp;a[i]&nbsp;&gt;&nbsp;x&nbsp;})&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4748787">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4748791">//&nbsp;With&nbsp;better&nbsp;compiler&nbsp;optimizations,&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;needed&nbsp;in&nbsp;the</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4748861">//&nbsp;future,&nbsp;but&nbsp;at&nbsp;the&nbsp;moment&nbsp;this&nbsp;change&nbsp;improves&nbsp;the&nbsp;go/printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4748927">//&nbsp;benchmark&nbsp;performance&nbsp;by&nbsp;~30%.&nbsp;This&nbsp;has&nbsp;a&nbsp;direct&nbsp;impact&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4748994">//&nbsp;speed&nbsp;of&nbsp;gofmt&nbsp;and&nbsp;thus&nbsp;seems&nbsp;worthwhile&nbsp;(2011-04-29).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4749053">//&nbsp;TODO(gri):&nbsp;Remove&nbsp;this&nbsp;when&nbsp;compilers&nbsp;have&nbsp;caught&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749111">i</span><span class="op" id="4749112">,</span>&nbsp;<span class="ident" id="4749114">j</span>&nbsp;<span class="op" id="4749116">:=</span>&nbsp;<span class="num" id="4749119">0</span><span class="op" id="4749120">,</span>&nbsp;<span class="builtinfunc" id="4749122">len</span><span class="op" id="4749125">(</span><span class="ident" id="4749126">a</span><span class="op" id="4749127">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749130">for</span>&nbsp;<span class="ident" id="4749134">i</span>&nbsp;<span class="op" id="4749136">&lt;</span>&nbsp;<span class="ident" id="4749138">j</span>&nbsp;<span class="op" id="4749140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749144">h</span>&nbsp;<span class="op" id="4749146">:=</span>&nbsp;<span class="ident" id="4749149">i</span>&nbsp;<span class="op" id="4749151">+</span>&nbsp;<span class="op" id="4749153">(</span><span class="ident" id="4749154">j</span><span class="op" id="4749155">-</span><span class="ident" id="4749156">i</span><span class="op" id="4749157">)</span><span class="op" id="4749158">/</span><span class="num" id="4749159">2</span>&nbsp;<span class="comment" id="4749161">//&nbsp;avoid&nbsp;overflow&nbsp;when&nbsp;computing&nbsp;h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4749198">//&nbsp;i&nbsp;&nbsp;h&nbsp;&lt;&nbsp;j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749215">if</span>&nbsp;<span class="ident" id="4749218">a</span><span class="op" id="4749219">[</span><span class="ident" id="4749220">h</span><span class="op" id="4749221">]</span>&nbsp;<span class="op" id="4749223">&lt;=</span>&nbsp;<span class="ident" id="4749226">x</span>&nbsp;<span class="op" id="4749228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749233">i</span>&nbsp;<span class="op" id="4749235">=</span>&nbsp;<span class="ident" id="4749237">h</span>&nbsp;<span class="op" id="4749239">+</span>&nbsp;<span class="num" id="4749241">1</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4749245">}</span>&nbsp;<span class="keyword" id="4749247">else</span>&nbsp;<span class="op" id="4749252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749257">j</span>&nbsp;<span class="op" id="4749259">=</span>&nbsp;<span class="ident" id="4749261">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4749265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4749268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749271">return</span>&nbsp;<span class="ident" id="4749278">i</span>&nbsp;<span class="op" id="4749280">-</span>&nbsp;<span class="num" id="4749282">1</span><br>
<span class="lineno">485</span><span class="op" id="4749284">}</span>
</div>
</body>
</html>
