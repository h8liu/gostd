<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>time</h2>
<ul>
<li><a href="/gostd/time/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/time/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/time/format.go.html">format.go</a></li>
<li><a href="/gostd/time/format_test.go.html">format_test.go</a></li>
<li><a href="/gostd/time/internal_test.go.html">internal_test.go</a></li>
<li><a href="/gostd/time/sleep.go.html" class="current">sleep.go</a></li>
<li><a href="/gostd/time/sleep_test.go.html">sleep_test.go</a></li>
<li><a href="/gostd/time/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/time/tick.go.html">tick.go</a></li>
<li><a href="/gostd/time/tick_test.go.html">tick_test.go</a></li>
<li><a href="/gostd/time/time.go.html">time.go</a></li>
<li><a href="/gostd/time/time_test.go.html">time_test.go</a></li>
<li><a href="/gostd/time/zoneinfo.go.html">zoneinfo.go</a></li>
<li><a href="/gostd/time/zoneinfo_read.go.html">zoneinfo_read.go</a></li>
<li><a href="/gostd/time/zoneinfo_test.go.html">zoneinfo_test.go</a></li>
<li><a href="/gostd/time/zoneinfo_unix.go.html">zoneinfo_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2607294">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2607349">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2607403">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2607454">package</span>&nbsp;<span class="ident" id="2607462">time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2607468">//&nbsp;Sleep&nbsp;pauses&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;duration&nbsp;d.</span><br>
<span class="lineno"></span><span class="comment" id="2607535">//&nbsp;A&nbsp;negative&nbsp;or&nbsp;zero&nbsp;duration&nbsp;causes&nbsp;Sleep&nbsp;to&nbsp;return&nbsp;immediately.</span><br>
<span class="lineno"></span><span class="keyword" id="2607602">func</span>&nbsp;<span class="ident" id="2607607">Sleep</span><span class="op" id="2607612">(</span><span class="ident" id="2607613">d</span>&nbsp;<span class="ident" id="2607615">Duration</span><span class="op" id="2607623">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2607626">//&nbsp;runtimeNano&nbsp;returns&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;runtime&nbsp;clock&nbsp;in&nbsp;nanoseconds.</span><br>
<span class="lineno"></span><span class="keyword" id="2607704">func</span>&nbsp;<span class="ident" id="2607709">runtimeNano</span><span class="op" id="2607720">(</span><span class="op" id="2607721">)</span>&nbsp;<span class="ident" id="2607723">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2607730">//&nbsp;Interface&nbsp;to&nbsp;timers&nbsp;implemented&nbsp;in&nbsp;package&nbsp;runtime.</span><br>
<span class="lineno">15</span><span class="comment" id="2607785">//&nbsp;Must&nbsp;be&nbsp;in&nbsp;sync&nbsp;with&nbsp;../runtime/runtime.h:/^struct.Timer$</span><br>
<span class="lineno"></span><span class="keyword" id="2607846">type</span>&nbsp;<span class="ident" id="2607851">runtimeTimer</span>&nbsp;<span class="keyword" id="2607864">struct</span>&nbsp;<span class="op" id="2607871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2607874">i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2607881">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2607886">when</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2607893">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2607900">period</span>&nbsp;<span class="ident" id="2607907">int64</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2607914">f</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2607921">func</span><span class="op" id="2607925">(</span><span class="keyword" id="2607926">interface</span><span class="op" id="2607935">{</span><span class="op" id="2607936">}</span><span class="op" id="2607937">,</span>&nbsp;<span class="builtintype" id="2607939">uintptr</span><span class="op" id="2607946">)</span>&nbsp;<span class="comment" id="2607948">//&nbsp;NOTE:&nbsp;must&nbsp;not&nbsp;be&nbsp;closure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2607978">arg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2607985">interface</span><span class="op" id="2607994">{</span><span class="op" id="2607995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2607998">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2608005">uintptr</span><br>
<span class="lineno"></span><span class="op" id="2608013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2608016">//&nbsp;when&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;setting&nbsp;the&nbsp;&#39;when&#39;&nbsp;field&nbsp;of&nbsp;a&nbsp;runtimeTimer.</span><br>
<span class="lineno"></span><span class="comment" id="2608093">//&nbsp;It&nbsp;returns&nbsp;what&nbsp;the&nbsp;time&nbsp;will&nbsp;be,&nbsp;in&nbsp;nanoseconds,&nbsp;Duration&nbsp;d&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="comment" id="2608172">//&nbsp;If&nbsp;d&nbsp;is&nbsp;negative,&nbsp;it&nbsp;is&nbsp;ignored.&nbsp;&nbsp;If&nbsp;the&nbsp;returned&nbsp;value&nbsp;would&nbsp;be&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="2608250">//&nbsp;zero&nbsp;because&nbsp;of&nbsp;an&nbsp;overflow,&nbsp;MaxInt64&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="2608304">func</span>&nbsp;<span class="ident" id="2608309">when</span><span class="op" id="2608313">(</span><span class="ident" id="2608314">d</span>&nbsp;<span class="ident" id="2608316">Duration</span><span class="op" id="2608324">)</span>&nbsp;<span class="ident" id="2608326">int64</span>&nbsp;<span class="op" id="2608332">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2608335">if</span>&nbsp;<span class="ident" id="2608338">d</span>&nbsp;<span class="op" id="2608340">&lt;=</span>&nbsp;<span class="num" id="2608343">0</span>&nbsp;<span class="op" id="2608345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2608349">return</span>&nbsp;<span class="ident" id="2608356">runtimeNano</span><span class="op" id="2608367">(</span><span class="op" id="2608368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2608371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2608374">t</span>&nbsp;<span class="op" id="2608376">:=</span>&nbsp;<span class="ident" id="2608379">runtimeNano</span><span class="op" id="2608390">(</span><span class="op" id="2608391">)</span>&nbsp;<span class="op" id="2608393">+</span>&nbsp;<span class="ident" id="2608395">int64</span><span class="op" id="2608400">(</span><span class="ident" id="2608401">d</span><span class="op" id="2608402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2608405">if</span>&nbsp;<span class="ident" id="2608408">t</span>&nbsp;<span class="op" id="2608410">&lt;</span>&nbsp;<span class="num" id="2608412">0</span>&nbsp;<span class="op" id="2608414">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2608418">t</span>&nbsp;<span class="op" id="2608420">=</span>&nbsp;<span class="num" id="2608422">1</span><span class="op" id="2608423">&lt;&lt;</span><span class="num" id="2608425">63</span>&nbsp;<span class="op" id="2608428">-</span>&nbsp;<span class="num" id="2608430">1</span>&nbsp;<span class="comment" id="2608432">//&nbsp;math.MaxInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2608450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2608453">return</span>&nbsp;<span class="ident" id="2608460">t</span><br>
<span class="lineno"></span><span class="op" id="2608462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2608465">func</span>&nbsp;<span class="ident" id="2608470">startTimer</span><span class="op" id="2608480">(</span><span class="op" id="2608481">*</span><span class="ident" id="2608482">runtimeTimer</span><span class="op" id="2608494">)</span><br>
<span class="lineno"></span><span class="keyword" id="2608496">func</span>&nbsp;<span class="ident" id="2608501">stopTimer</span><span class="op" id="2608510">(</span><span class="op" id="2608511">*</span><span class="ident" id="2608512">runtimeTimer</span><span class="op" id="2608524">)</span>&nbsp;<span class="builtintype" id="2608526">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2608532">//&nbsp;The&nbsp;Timer&nbsp;type&nbsp;represents&nbsp;a&nbsp;single&nbsp;event.</span><br>
<span class="lineno"></span><span class="comment" id="2608577">//&nbsp;When&nbsp;the&nbsp;Timer&nbsp;expires,&nbsp;the&nbsp;current&nbsp;time&nbsp;will&nbsp;be&nbsp;sent&nbsp;on&nbsp;C,</span><br>
<span class="lineno">45</span><span class="comment" id="2608640">//&nbsp;unless&nbsp;the&nbsp;Timer&nbsp;was&nbsp;created&nbsp;by&nbsp;AfterFunc.</span><br>
<span class="lineno"></span><span class="comment" id="2608686">//&nbsp;A&nbsp;Timer&nbsp;must&nbsp;be&nbsp;created&nbsp;with&nbsp;NewTimer&nbsp;or&nbsp;AfterFunc.</span><br>
<span class="lineno"></span><span class="keyword" id="2608741">type</span>&nbsp;<span class="ident" id="2608746">Timer</span>&nbsp;<span class="keyword" id="2608752">struct</span>&nbsp;<span class="op" id="2608759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2608762">C</span>&nbsp;<span class="op" id="2608764">&lt;-</span><span class="keyword" id="2608766">chan</span>&nbsp;<span class="ident" id="2608771">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2608777">r</span>&nbsp;<span class="ident" id="2608779">runtimeTimer</span><br>
<span class="lineno">50</span><span class="op" id="2608792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2608795">//&nbsp;Stop&nbsp;prevents&nbsp;the&nbsp;Timer&nbsp;from&nbsp;firing.</span><br>
<span class="lineno"></span><span class="comment" id="2608835">//&nbsp;It&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;call&nbsp;stops&nbsp;the&nbsp;timer,&nbsp;false&nbsp;if&nbsp;the&nbsp;timer&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="2608914">//&nbsp;expired&nbsp;or&nbsp;been&nbsp;stopped.</span><br>
<span class="lineno">55</span><span class="comment" id="2608942">//&nbsp;Stop&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;channel,&nbsp;to&nbsp;prevent&nbsp;a&nbsp;read&nbsp;from&nbsp;the&nbsp;channel&nbsp;succeeding</span><br>
<span class="lineno"></span><span class="comment" id="2609024">//&nbsp;incorrectly.</span><br>
<span class="lineno"></span><span class="keyword" id="2609040">func</span>&nbsp;<span class="op" id="2609045">(</span><span class="ident" id="2609046">t</span>&nbsp;<span class="op" id="2609048">*</span><span class="ident" id="2609049">Timer</span><span class="op" id="2609054">)</span>&nbsp;<span class="ident" id="2609056">Stop</span><span class="op" id="2609060">(</span><span class="op" id="2609061">)</span>&nbsp;<span class="builtintype" id="2609063">bool</span>&nbsp;<span class="op" id="2609068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2609071">if</span>&nbsp;<span class="ident" id="2609074">t</span><span class="op" id="2609075">.</span><span class="ident" id="2609076">r</span><span class="op" id="2609077">.</span><span class="ident" id="2609078">f</span>&nbsp;<span class="op" id="2609080">==</span>&nbsp;<span class="builtintype" id="2609083">nil</span>&nbsp;<span class="op" id="2609087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2609091">panic</span><span class="op" id="2609096">(</span><span class="string" id="2609097">&#34;time:&nbsp;Stop&nbsp;called&nbsp;on&nbsp;uninitialized&nbsp;Timer&#34;</span><span class="op" id="2609139">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2609142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2609145">return</span>&nbsp;<span class="ident" id="2609152">stopTimer</span><span class="op" id="2609161">(</span><span class="op" id="2609162">&amp;</span><span class="ident" id="2609163">t</span><span class="op" id="2609164">.</span><span class="ident" id="2609165">r</span><span class="op" id="2609166">)</span><br>
<span class="lineno"></span><span class="op" id="2609168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2609171">//&nbsp;NewTimer&nbsp;creates&nbsp;a&nbsp;new&nbsp;Timer&nbsp;that&nbsp;will&nbsp;send</span><br>
<span class="lineno">65</span><span class="comment" id="2609218">//&nbsp;the&nbsp;current&nbsp;time&nbsp;on&nbsp;its&nbsp;channel&nbsp;after&nbsp;at&nbsp;least&nbsp;duration&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="2609280">func</span>&nbsp;<span class="ident" id="2609285">NewTimer</span><span class="op" id="2609293">(</span><span class="ident" id="2609294">d</span>&nbsp;<span class="ident" id="2609296">Duration</span><span class="op" id="2609304">)</span>&nbsp;<span class="op" id="2609306">*</span><span class="ident" id="2609307">Timer</span>&nbsp;<span class="op" id="2609313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2609316">c</span>&nbsp;<span class="op" id="2609318">:=</span>&nbsp;<span class="builtinfunc" id="2609321">make</span><span class="op" id="2609325">(</span><span class="keyword" id="2609326">chan</span>&nbsp;<span class="ident" id="2609331">Time</span><span class="op" id="2609335">,</span>&nbsp;<span class="num" id="2609337">1</span><span class="op" id="2609338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2609341">t</span>&nbsp;<span class="op" id="2609343">:=</span>&nbsp;<span class="op" id="2609346">&amp;</span><span class="ident" id="2609347">Timer</span><span class="op" id="2609352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2609356">C</span><span class="op" id="2609357">:</span>&nbsp;<span class="ident" id="2609359">c</span><span class="op" id="2609360">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2609364">r</span><span class="op" id="2609365">:</span>&nbsp;<span class="ident" id="2609367">runtimeTimer</span><span class="op" id="2609379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2609384">when</span><span class="op" id="2609388">:</span>&nbsp;<span class="ident" id="2609390">when</span><span class="op" id="2609394">(</span><span class="ident" id="2609395">d</span><span class="op" id="2609396">)</span><span class="op" id="2609397">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2609402">f</span><span class="op" id="2609403">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2609408">sendTime</span><span class="op" id="2609416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2609421">arg</span><span class="op" id="2609424">:</span>&nbsp;&nbsp;<span class="ident" id="2609427">c</span><span class="op" id="2609428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2609432">}</span><span class="op" id="2609433">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2609436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2609439">startTimer</span><span class="op" id="2609449">(</span><span class="op" id="2609450">&amp;</span><span class="ident" id="2609451">t</span><span class="op" id="2609452">.</span><span class="ident" id="2609453">r</span><span class="op" id="2609454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2609457">return</span>&nbsp;<span class="ident" id="2609464">t</span><br>
<span class="lineno"></span><span class="op" id="2609466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2609469">//&nbsp;Reset&nbsp;changes&nbsp;the&nbsp;timer&nbsp;to&nbsp;expire&nbsp;after&nbsp;duration&nbsp;d.</span><br>
<span class="lineno"></span><span class="comment" id="2609524">//&nbsp;It&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;timer&nbsp;had&nbsp;been&nbsp;active,&nbsp;false&nbsp;if&nbsp;the&nbsp;timer&nbsp;had</span><br>
<span class="lineno"></span><span class="comment" id="2609596">//&nbsp;expired&nbsp;or&nbsp;been&nbsp;stopped.</span><br>
<span class="lineno"></span><span class="keyword" id="2609624">func</span>&nbsp;<span class="op" id="2609629">(</span><span class="ident" id="2609630">t</span>&nbsp;<span class="op" id="2609632">*</span><span class="ident" id="2609633">Timer</span><span class="op" id="2609638">)</span>&nbsp;<span class="ident" id="2609640">Reset</span><span class="op" id="2609645">(</span><span class="ident" id="2609646">d</span>&nbsp;<span class="ident" id="2609648">Duration</span><span class="op" id="2609656">)</span>&nbsp;<span class="builtintype" id="2609658">bool</span>&nbsp;<span class="op" id="2609663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2609666">if</span>&nbsp;<span class="ident" id="2609669">t</span><span class="op" id="2609670">.</span><span class="ident" id="2609671">r</span><span class="op" id="2609672">.</span><span class="ident" id="2609673">f</span>&nbsp;<span class="op" id="2609675">==</span>&nbsp;<span class="builtintype" id="2609678">nil</span>&nbsp;<span class="op" id="2609682">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2609686">panic</span><span class="op" id="2609691">(</span><span class="string" id="2609692">&#34;time:&nbsp;Reset&nbsp;called&nbsp;on&nbsp;uninitialized&nbsp;Timer&#34;</span><span class="op" id="2609735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2609738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2609741">w</span>&nbsp;<span class="op" id="2609743">:=</span>&nbsp;<span class="ident" id="2609746">when</span><span class="op" id="2609750">(</span><span class="ident" id="2609751">d</span><span class="op" id="2609752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2609755">active</span>&nbsp;<span class="op" id="2609762">:=</span>&nbsp;<span class="ident" id="2609765">stopTimer</span><span class="op" id="2609774">(</span><span class="op" id="2609775">&amp;</span><span class="ident" id="2609776">t</span><span class="op" id="2609777">.</span><span class="ident" id="2609778">r</span><span class="op" id="2609779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2609782">t</span><span class="op" id="2609783">.</span><span class="ident" id="2609784">r</span><span class="op" id="2609785">.</span><span class="ident" id="2609786">when</span>&nbsp;<span class="op" id="2609791">=</span>&nbsp;<span class="ident" id="2609793">w</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2609796">startTimer</span><span class="op" id="2609806">(</span><span class="op" id="2609807">&amp;</span><span class="ident" id="2609808">t</span><span class="op" id="2609809">.</span><span class="ident" id="2609810">r</span><span class="op" id="2609811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2609814">return</span>&nbsp;<span class="ident" id="2609821">active</span><br>
<span class="lineno"></span><span class="op" id="2609828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2609831">func</span>&nbsp;<span class="ident" id="2609836">sendTime</span><span class="op" id="2609844">(</span><span class="ident" id="2609845">c</span>&nbsp;<span class="keyword" id="2609847">interface</span><span class="op" id="2609856">{</span><span class="op" id="2609857">}</span><span class="op" id="2609858">,</span>&nbsp;<span class="ident" id="2609860">seq</span>&nbsp;<span class="builtintype" id="2609864">uintptr</span><span class="op" id="2609871">)</span>&nbsp;<span class="op" id="2609873">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2609876">//&nbsp;Non-blocking&nbsp;send&nbsp;of&nbsp;time&nbsp;on&nbsp;c.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2609912">//&nbsp;Used&nbsp;in&nbsp;NewTimer,&nbsp;it&nbsp;cannot&nbsp;block&nbsp;anyway&nbsp;(buffer).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2609967">//&nbsp;Used&nbsp;in&nbsp;NewTicker,&nbsp;dropping&nbsp;sends&nbsp;on&nbsp;the&nbsp;floor&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2610021">//&nbsp;the&nbsp;desired&nbsp;behavior&nbsp;when&nbsp;the&nbsp;reader&nbsp;gets&nbsp;behind,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2610075">//&nbsp;because&nbsp;the&nbsp;sends&nbsp;are&nbsp;periodic.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2610111">select</span>&nbsp;<span class="op" id="2610118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2610121">case</span>&nbsp;<span class="ident" id="2610126">c</span><span class="op" id="2610127">.</span><span class="op" id="2610128">(</span><span class="keyword" id="2610129">chan</span>&nbsp;<span class="ident" id="2610134">Time</span><span class="op" id="2610138">)</span>&nbsp;<span class="op" id="2610140">&lt;-</span>&nbsp;<span class="ident" id="2610143">Now</span><span class="op" id="2610146">(</span><span class="op" id="2610147">)</span><span class="op" id="2610148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2610151">default</span><span class="op" id="2610158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2610161">}</span><br>
<span class="lineno"></span><span class="op" id="2610163">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="2610166">//&nbsp;After&nbsp;waits&nbsp;for&nbsp;the&nbsp;duration&nbsp;to&nbsp;elapse&nbsp;and&nbsp;then&nbsp;sends&nbsp;the&nbsp;current&nbsp;time</span><br>
<span class="lineno"></span><span class="comment" id="2610240">//&nbsp;on&nbsp;the&nbsp;returned&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="2610268">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;NewTimer(d).C.</span><br>
<span class="lineno"></span><span class="keyword" id="2610306">func</span>&nbsp;<span class="ident" id="2610311">After</span><span class="op" id="2610316">(</span><span class="ident" id="2610317">d</span>&nbsp;<span class="ident" id="2610319">Duration</span><span class="op" id="2610327">)</span>&nbsp;<span class="op" id="2610329">&lt;-</span><span class="keyword" id="2610331">chan</span>&nbsp;<span class="ident" id="2610336">Time</span>&nbsp;<span class="op" id="2610341">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2610344">return</span>&nbsp;<span class="ident" id="2610351">NewTimer</span><span class="op" id="2610359">(</span><span class="ident" id="2610360">d</span><span class="op" id="2610361">)</span><span class="op" id="2610362">.</span><span class="ident" id="2610363">C</span><br>
<span class="lineno"></span><span class="op" id="2610365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2610368">//&nbsp;AfterFunc&nbsp;waits&nbsp;for&nbsp;the&nbsp;duration&nbsp;to&nbsp;elapse&nbsp;and&nbsp;then&nbsp;calls&nbsp;f</span><br>
<span class="lineno"></span><span class="comment" id="2610431">//&nbsp;in&nbsp;its&nbsp;own&nbsp;goroutine.&nbsp;It&nbsp;returns&nbsp;a&nbsp;Timer&nbsp;that&nbsp;can</span><br>
<span class="lineno">115</span><span class="comment" id="2610484">//&nbsp;be&nbsp;used&nbsp;to&nbsp;cancel&nbsp;the&nbsp;call&nbsp;using&nbsp;its&nbsp;Stop&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="2610537">func</span>&nbsp;<span class="ident" id="2610542">AfterFunc</span><span class="op" id="2610551">(</span><span class="ident" id="2610552">d</span>&nbsp;<span class="ident" id="2610554">Duration</span><span class="op" id="2610562">,</span>&nbsp;<span class="ident" id="2610564">f</span>&nbsp;<span class="keyword" id="2610566">func</span><span class="op" id="2610570">(</span><span class="op" id="2610571">)</span><span class="op" id="2610572">)</span>&nbsp;<span class="op" id="2610574">*</span><span class="ident" id="2610575">Timer</span>&nbsp;<span class="op" id="2610581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2610584">t</span>&nbsp;<span class="op" id="2610586">:=</span>&nbsp;<span class="op" id="2610589">&amp;</span><span class="ident" id="2610590">Timer</span><span class="op" id="2610595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2610599">r</span><span class="op" id="2610600">:</span>&nbsp;<span class="ident" id="2610602">runtimeTimer</span><span class="op" id="2610614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2610619">when</span><span class="op" id="2610623">:</span>&nbsp;<span class="ident" id="2610625">when</span><span class="op" id="2610629">(</span><span class="ident" id="2610630">d</span><span class="op" id="2610631">)</span><span class="op" id="2610632">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2610637">f</span><span class="op" id="2610638">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2610643">goFunc</span><span class="op" id="2610649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2610654">arg</span><span class="op" id="2610657">:</span>&nbsp;&nbsp;<span class="ident" id="2610660">f</span><span class="op" id="2610661">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2610665">}</span><span class="op" id="2610666">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2610669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2610672">startTimer</span><span class="op" id="2610682">(</span><span class="op" id="2610683">&amp;</span><span class="ident" id="2610684">t</span><span class="op" id="2610685">.</span><span class="ident" id="2610686">r</span><span class="op" id="2610687">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2610690">return</span>&nbsp;<span class="ident" id="2610697">t</span><br>
<span class="lineno"></span><span class="op" id="2610699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2610702">func</span>&nbsp;<span class="ident" id="2610707">goFunc</span><span class="op" id="2610713">(</span><span class="ident" id="2610714">arg</span>&nbsp;<span class="keyword" id="2610718">interface</span><span class="op" id="2610727">{</span><span class="op" id="2610728">}</span><span class="op" id="2610729">,</span>&nbsp;<span class="ident" id="2610731">seq</span>&nbsp;<span class="builtintype" id="2610735">uintptr</span><span class="op" id="2610742">)</span>&nbsp;<span class="op" id="2610744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2610747">go</span>&nbsp;<span class="ident" id="2610750">arg</span><span class="op" id="2610753">.</span><span class="op" id="2610754">(</span><span class="keyword" id="2610755">func</span><span class="op" id="2610759">(</span><span class="op" id="2610760">)</span><span class="op" id="2610761">)</span><span class="op" id="2610762">(</span><span class="op" id="2610763">)</span><br>
<span class="lineno">130</span><span class="op" id="2610765">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
