<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4306019">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4306074">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4306128">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4306179">package</span>&nbsp;<span class="ident" id="4306187">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4306194">import</span>&nbsp;<span class="op" id="4306201">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306204">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306211">&#34;sort&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4306219">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="4306226">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4306229">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4306310">//&nbsp;Positions</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4306324">//&nbsp;Position&nbsp;describes&nbsp;an&nbsp;arbitrary&nbsp;source&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="4306375">//&nbsp;including&nbsp;the&nbsp;file,&nbsp;line,&nbsp;and&nbsp;column&nbsp;location.</span><br>
<span class="lineno"></span><span class="comment" id="4306425">//&nbsp;A&nbsp;Position&nbsp;is&nbsp;valid&nbsp;if&nbsp;the&nbsp;line&nbsp;number&nbsp;is&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="4306475">//</span><br>
<span class="lineno">20</span><span class="keyword" id="4306478">type</span>&nbsp;<span class="ident" id="4306483">Position</span>&nbsp;<span class="keyword" id="4306492">struct</span>&nbsp;<span class="op" id="4306499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306502">Filename</span>&nbsp;<span class="builtintype" id="4306511">string</span>&nbsp;<span class="comment" id="4306518">//&nbsp;filename,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306539">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4306548">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4306555">//&nbsp;offset,&nbsp;starting&nbsp;at&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306581">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4306590">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4306597">//&nbsp;line&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306628">Column</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4306637">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4306644">//&nbsp;column&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1&nbsp;(character&nbsp;count)</span><br>
<span class="lineno">25</span><span class="op" id="4306694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4306697">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4306747">func</span>&nbsp;<span class="op" id="4306752">(</span><span class="ident" id="4306753">pos</span>&nbsp;<span class="op" id="4306757">*</span><span class="ident" id="4306758">Position</span><span class="op" id="4306766">)</span>&nbsp;<span class="ident" id="4306768">IsValid</span><span class="op" id="4306775">(</span><span class="op" id="4306776">)</span>&nbsp;<span class="builtintype" id="4306778">bool</span>&nbsp;<span class="op" id="4306783">{</span>&nbsp;<span class="keyword" id="4306785">return</span>&nbsp;<span class="ident" id="4306792">pos</span><span class="op" id="4306795">.</span><span class="ident" id="4306796">Line</span>&nbsp;<span class="op" id="4306801">&gt;</span>&nbsp;<span class="num" id="4306803">0</span>&nbsp;<span class="op" id="4306805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="4306808">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;several&nbsp;forms:</span><br>
<span class="lineno"></span><span class="comment" id="4306860">//</span><br>
<span class="lineno"></span><span class="comment" id="4306863">//&nbsp;&nbsp;&nbsp;&nbspfile:line:column&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="4306916">//&nbsp;&nbsp;&nbsp;&nbspline:column&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="4306972">//&nbsp;&nbsp;&nbsp;&nbspfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="4307027">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="4307085">//</span><br>
<span class="lineno"></span><span class="keyword" id="4307088">func</span>&nbsp;<span class="op" id="4307093">(</span><span class="ident" id="4307094">pos</span>&nbsp;<span class="ident" id="4307098">Position</span><span class="op" id="4307106">)</span>&nbsp;<span class="ident" id="4307108">String</span><span class="op" id="4307114">(</span><span class="op" id="4307115">)</span>&nbsp;<span class="builtintype" id="4307117">string</span>&nbsp;<span class="op" id="4307124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307127">s</span>&nbsp;<span class="op" id="4307129">:=</span>&nbsp;<span class="ident" id="4307132">pos</span><span class="op" id="4307135">.</span><span class="ident" id="4307136">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307146">if</span>&nbsp;<span class="ident" id="4307149">pos</span><span class="op" id="4307152">.</span><span class="ident" id="4307153">IsValid</span><span class="op" id="4307160">(</span><span class="op" id="4307161">)</span>&nbsp;<span class="op" id="4307163">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307167">if</span>&nbsp;<span class="ident" id="4307170">s</span>&nbsp;<span class="op" id="4307172">!=</span>&nbsp;<span class="string" id="4307175">&#34;&#34;</span>&nbsp;<span class="op" id="4307178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307183">s</span>&nbsp;<span class="op" id="4307185">+=</span>&nbsp;<span class="string" id="4307188">&#34;:&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4307194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307198">s</span>&nbsp;<span class="op" id="4307200">+=</span>&nbsp;<span class="ident" id="4307203">fmt</span><span class="op" id="4307206">.</span><span class="ident" id="4307207">Sprintf</span><span class="op" id="4307214">(</span><span class="string" id="4307215">&#34;%d:%d&#34;</span><span class="op" id="4307222">,</span>&nbsp;<span class="ident" id="4307224">pos</span><span class="op" id="4307227">.</span><span class="ident" id="4307228">Line</span><span class="op" id="4307232">,</span>&nbsp;<span class="ident" id="4307234">pos</span><span class="op" id="4307237">.</span><span class="ident" id="4307238">Column</span><span class="op" id="4307244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4307247">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307250">if</span>&nbsp;<span class="ident" id="4307253">s</span>&nbsp;<span class="op" id="4307255">==</span>&nbsp;<span class="string" id="4307258">&#34;&#34;</span>&nbsp;<span class="op" id="4307261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307265">s</span>&nbsp;<span class="op" id="4307267">=</span>&nbsp;<span class="string" id="4307269">&#34;-&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4307274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307277">return</span>&nbsp;<span class="ident" id="4307284">s</span><br>
<span class="lineno"></span><span class="op" id="4307286">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4307289">//&nbsp;Pos&nbsp;is&nbsp;a&nbsp;compact&nbsp;encoding&nbsp;of&nbsp;a&nbsp;source&nbsp;position&nbsp;within&nbsp;a&nbsp;file&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="4307358">//&nbsp;It&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;Position&nbsp;for&nbsp;a&nbsp;more&nbsp;convenient,&nbsp;but&nbsp;much</span><br>
<span class="lineno"></span><span class="comment" id="4307429">//&nbsp;larger,&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="4307456">//</span><br>
<span class="lineno">55</span><span class="comment" id="4307459">//&nbsp;The&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;a&nbsp;number&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size],</span><br>
<span class="lineno"></span><span class="comment" id="4307537">//&nbsp;where&nbsp;base&nbsp;and&nbsp;size&nbsp;are&nbsp;specified&nbsp;when&nbsp;adding&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="4307615">//&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="comment" id="4307627">//</span><br>
<span class="lineno"></span><span class="comment" id="4307630">//&nbsp;To&nbsp;create&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;specific&nbsp;source&nbsp;offset,&nbsp;first&nbsp;add</span><br>
<span class="lineno">60</span><span class="comment" id="4307697">//&nbsp;the&nbsp;respective&nbsp;file&nbsp;to&nbsp;the&nbsp;current&nbsp;file&nbsp;set&nbsp;(via&nbsp;FileSet.AddFile)</span><br>
<span class="lineno"></span><span class="comment" id="4307766">//&nbsp;and&nbsp;then&nbsp;call&nbsp;File.Pos(offset)&nbsp;for&nbsp;that&nbsp;file.&nbsp;Given&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="4307835">//&nbsp;for&nbsp;a&nbsp;specific&nbsp;file&nbsp;set&nbsp;fset,&nbsp;the&nbsp;corresponding&nbsp;Position&nbsp;value&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4307904">//&nbsp;obtained&nbsp;by&nbsp;calling&nbsp;fset.Position(p).</span><br>
<span class="lineno"></span><span class="comment" id="4307945">//</span><br>
<span class="lineno">65</span><span class="comment" id="4307948">//&nbsp;Pos&nbsp;values&nbsp;can&nbsp;be&nbsp;compared&nbsp;directly&nbsp;with&nbsp;the&nbsp;usual&nbsp;comparison&nbsp;operators:</span><br>
<span class="lineno"></span><span class="comment" id="4308024">//&nbsp;If&nbsp;two&nbsp;Pos&nbsp;values&nbsp;p&nbsp;and&nbsp;q&nbsp;are&nbsp;in&nbsp;the&nbsp;same&nbsp;file,&nbsp;comparing&nbsp;p&nbsp;and&nbsp;q&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4308096">//&nbsp;equivalent&nbsp;to&nbsp;comparing&nbsp;the&nbsp;respective&nbsp;source&nbsp;file&nbsp;offsets.&nbsp;If&nbsp;p&nbsp;and&nbsp;q</span><br>
<span class="lineno"></span><span class="comment" id="4308170">//&nbsp;are&nbsp;in&nbsp;different&nbsp;files,&nbsp;p&nbsp;&lt;&nbsp;q&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;p&nbsp;was&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="4308246">//&nbsp;to&nbsp;the&nbsp;respective&nbsp;file&nbsp;set&nbsp;before&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;q.</span><br>
<span class="lineno">70</span><span class="comment" id="4308306">//</span><br>
<span class="lineno"></span><span class="keyword" id="4308309">type</span>&nbsp;<span class="ident" id="4308314">Pos</span>&nbsp;<span class="builtintype" id="4308318">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4308323">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Pos&nbsp;is&nbsp;NoPos;&nbsp;there&nbsp;is&nbsp;no&nbsp;file&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="4308397">//&nbsp;associated&nbsp;with&nbsp;it,&nbsp;and&nbsp;NoPos().IsValid()&nbsp;is&nbsp;false.&nbsp;NoPos&nbsp;is&nbsp;always</span><br>
<span class="lineno">75</span><span class="comment" id="4308468">//&nbsp;smaller&nbsp;than&nbsp;any&nbsp;other&nbsp;Pos&nbsp;value.&nbsp;The&nbsp;corresponding&nbsp;Position&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4308538">//&nbsp;for&nbsp;NoPos&nbsp;is&nbsp;the&nbsp;zero&nbsp;value&nbsp;for&nbsp;Position.</span><br>
<span class="lineno"></span><span class="comment" id="4308583">//</span><br>
<span class="lineno"></span><span class="keyword" id="4308586">const</span>&nbsp;<span class="ident" id="4308592">NoPos</span>&nbsp;<span class="ident" id="4308598">Pos</span>&nbsp;<span class="op" id="4308602">=</span>&nbsp;<span class="num" id="4308604">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4308607">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4308657">func</span>&nbsp;<span class="op" id="4308662">(</span><span class="ident" id="4308663">p</span>&nbsp;<span class="ident" id="4308665">Pos</span><span class="op" id="4308668">)</span>&nbsp;<span class="ident" id="4308670">IsValid</span><span class="op" id="4308677">(</span><span class="op" id="4308678">)</span>&nbsp;<span class="builtintype" id="4308680">bool</span>&nbsp;<span class="op" id="4308685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308688">return</span>&nbsp;<span class="ident" id="4308695">p</span>&nbsp;<span class="op" id="4308697">!=</span>&nbsp;<span class="ident" id="4308700">NoPos</span><br>
<span class="lineno"></span><span class="op" id="4308706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="4308709">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4308790">//&nbsp;File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4308799">//&nbsp;A&nbsp;File&nbsp;is&nbsp;a&nbsp;handle&nbsp;for&nbsp;a&nbsp;file&nbsp;belonging&nbsp;to&nbsp;a&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="comment" id="4308856">//&nbsp;A&nbsp;File&nbsp;has&nbsp;a&nbsp;name,&nbsp;size,&nbsp;and&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno">90</span><span class="comment" id="4308907">//</span><br>
<span class="lineno"></span><span class="keyword" id="4308910">type</span>&nbsp;<span class="ident" id="4308915">File</span>&nbsp;<span class="keyword" id="4308920">struct</span>&nbsp;<span class="op" id="4308927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308930">set</span>&nbsp;&nbsp;<span class="op" id="4308935">*</span><span class="ident" id="4308936">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308945">name</span>&nbsp;<span class="builtintype" id="4308950">string</span>&nbsp;<span class="comment" id="4308957">//&nbsp;file&nbsp;name&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308994">base</span>&nbsp;<span class="builtintype" id="4308999">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4309006">//&nbsp;Pos&nbsp;value&nbsp;range&nbsp;for&nbsp;this&nbsp;file&nbsp;is&nbsp;[base...base+size]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309062">size</span>&nbsp;<span class="builtintype" id="4309067">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4309074">//&nbsp;file&nbsp;size&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4309112">//&nbsp;lines&nbsp;and&nbsp;infos&nbsp;are&nbsp;protected&nbsp;by&nbsp;set.mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309159">lines</span>&nbsp;<span class="op" id="4309165">[</span><span class="op" id="4309166">]</span><span class="builtintype" id="4309167">int</span>&nbsp;<span class="comment" id="4309171">//&nbsp;lines&nbsp;contains&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;for&nbsp;each&nbsp;line&nbsp;(the&nbsp;first&nbsp;entry&nbsp;is&nbsp;always&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309268">infos</span>&nbsp;<span class="op" id="4309274">[</span><span class="op" id="4309275">]</span><span class="ident" id="4309276">lineInfo</span><br>
<span class="lineno">100</span><span class="op" id="4309285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4309288">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="4309356">func</span>&nbsp;<span class="op" id="4309361">(</span><span class="ident" id="4309362">f</span>&nbsp;<span class="op" id="4309364">*</span><span class="ident" id="4309365">File</span><span class="op" id="4309369">)</span>&nbsp;<span class="ident" id="4309371">Name</span><span class="op" id="4309375">(</span><span class="op" id="4309376">)</span>&nbsp;<span class="builtintype" id="4309378">string</span>&nbsp;<span class="op" id="4309385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309388">return</span>&nbsp;<span class="ident" id="4309395">f</span><span class="op" id="4309396">.</span><span class="ident" id="4309397">name</span><br>
<span class="lineno">105</span><span class="op" id="4309402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4309405">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;base&nbsp;offset&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="4309475">func</span>&nbsp;<span class="op" id="4309480">(</span><span class="ident" id="4309481">f</span>&nbsp;<span class="op" id="4309483">*</span><span class="ident" id="4309484">File</span><span class="op" id="4309488">)</span>&nbsp;<span class="ident" id="4309490">Base</span><span class="op" id="4309494">(</span><span class="op" id="4309495">)</span>&nbsp;<span class="builtintype" id="4309497">int</span>&nbsp;<span class="op" id="4309501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309504">return</span>&nbsp;<span class="ident" id="4309511">f</span><span class="op" id="4309512">.</span><span class="ident" id="4309513">base</span><br>
<span class="lineno">110</span><span class="op" id="4309518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4309521">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="4309584">func</span>&nbsp;<span class="op" id="4309589">(</span><span class="ident" id="4309590">f</span>&nbsp;<span class="op" id="4309592">*</span><span class="ident" id="4309593">File</span><span class="op" id="4309597">)</span>&nbsp;<span class="ident" id="4309599">Size</span><span class="op" id="4309603">(</span><span class="op" id="4309604">)</span>&nbsp;<span class="builtintype" id="4309606">int</span>&nbsp;<span class="op" id="4309610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309613">return</span>&nbsp;<span class="ident" id="4309620">f</span><span class="op" id="4309621">.</span><span class="ident" id="4309622">size</span><br>
<span class="lineno">115</span><span class="op" id="4309627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4309630">//&nbsp;LineCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;lines&nbsp;in&nbsp;file&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="4309682">func</span>&nbsp;<span class="op" id="4309687">(</span><span class="ident" id="4309688">f</span>&nbsp;<span class="op" id="4309690">*</span><span class="ident" id="4309691">File</span><span class="op" id="4309695">)</span>&nbsp;<span class="ident" id="4309697">LineCount</span><span class="op" id="4309706">(</span><span class="op" id="4309707">)</span>&nbsp;<span class="builtintype" id="4309709">int</span>&nbsp;<span class="op" id="4309713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309716">f</span><span class="op" id="4309717">.</span><span class="ident" id="4309718">set</span><span class="op" id="4309721">.</span><span class="ident" id="4309722">mutex</span><span class="op" id="4309727">.</span><span class="ident" id="4309728">RLock</span><span class="op" id="4309733">(</span><span class="op" id="4309734">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309737">n</span>&nbsp;<span class="op" id="4309739">:=</span>&nbsp;<span class="builtinfunc" id="4309742">len</span><span class="op" id="4309745">(</span><span class="ident" id="4309746">f</span><span class="op" id="4309747">.</span><span class="ident" id="4309748">lines</span><span class="op" id="4309753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309756">f</span><span class="op" id="4309757">.</span><span class="ident" id="4309758">set</span><span class="op" id="4309761">.</span><span class="ident" id="4309762">mutex</span><span class="op" id="4309767">.</span><span class="ident" id="4309768">RUnlock</span><span class="op" id="4309775">(</span><span class="op" id="4309776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309779">return</span>&nbsp;<span class="ident" id="4309786">n</span><br>
<span class="lineno"></span><span class="op" id="4309788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="4309791">//&nbsp;AddLine&nbsp;adds&nbsp;the&nbsp;line&nbsp;offset&nbsp;for&nbsp;a&nbsp;new&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="4309839">//&nbsp;The&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4309911">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;line&nbsp;offset&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4309984">//</span><br>
<span class="lineno"></span><span class="keyword" id="4309987">func</span>&nbsp;<span class="op" id="4309992">(</span><span class="ident" id="4309993">f</span>&nbsp;<span class="op" id="4309995">*</span><span class="ident" id="4309996">File</span><span class="op" id="4310000">)</span>&nbsp;<span class="ident" id="4310002">AddLine</span><span class="op" id="4310009">(</span><span class="ident" id="4310010">offset</span>&nbsp;<span class="builtintype" id="4310017">int</span><span class="op" id="4310020">)</span>&nbsp;<span class="op" id="4310022">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310025">f</span><span class="op" id="4310026">.</span><span class="ident" id="4310027">set</span><span class="op" id="4310030">.</span><span class="ident" id="4310031">mutex</span><span class="op" id="4310036">.</span><span class="ident" id="4310037">Lock</span><span class="op" id="4310041">(</span><span class="op" id="4310042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310045">if</span>&nbsp;<span class="ident" id="4310048">i</span>&nbsp;<span class="op" id="4310050">:=</span>&nbsp;<span class="builtinfunc" id="4310053">len</span><span class="op" id="4310056">(</span><span class="ident" id="4310057">f</span><span class="op" id="4310058">.</span><span class="ident" id="4310059">lines</span><span class="op" id="4310064">)</span><span class="op" id="4310065">;</span>&nbsp;<span class="op" id="4310067">(</span><span class="ident" id="4310068">i</span>&nbsp;<span class="op" id="4310070">==</span>&nbsp;<span class="num" id="4310073">0</span>&nbsp;<span class="op" id="4310075">||</span>&nbsp;<span class="ident" id="4310078">f</span><span class="op" id="4310079">.</span><span class="ident" id="4310080">lines</span><span class="op" id="4310085">[</span><span class="ident" id="4310086">i</span><span class="op" id="4310087">-</span><span class="num" id="4310088">1</span><span class="op" id="4310089">]</span>&nbsp;<span class="op" id="4310091">&lt;</span>&nbsp;<span class="ident" id="4310093">offset</span><span class="op" id="4310099">)</span>&nbsp;<span class="op" id="4310101">&amp;&amp;</span>&nbsp;<span class="ident" id="4310104">offset</span>&nbsp;<span class="op" id="4310111">&lt;</span>&nbsp;<span class="ident" id="4310113">f</span><span class="op" id="4310114">.</span><span class="ident" id="4310115">size</span>&nbsp;<span class="op" id="4310120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310124">f</span><span class="op" id="4310125">.</span><span class="ident" id="4310126">lines</span>&nbsp;<span class="op" id="4310132">=</span>&nbsp;<span class="builtinfunc" id="4310134">append</span><span class="op" id="4310140">(</span><span class="ident" id="4310141">f</span><span class="op" id="4310142">.</span><span class="ident" id="4310143">lines</span><span class="op" id="4310148">,</span>&nbsp;<span class="ident" id="4310150">offset</span><span class="op" id="4310156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4310159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310162">f</span><span class="op" id="4310163">.</span><span class="ident" id="4310164">set</span><span class="op" id="4310167">.</span><span class="ident" id="4310168">mutex</span><span class="op" id="4310173">.</span><span class="ident" id="4310174">Unlock</span><span class="op" id="4310180">(</span><span class="op" id="4310181">)</span><br>
<span class="lineno">135</span><span class="op" id="4310183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4310186">//&nbsp;MergeLine&nbsp;merges&nbsp;a&nbsp;line&nbsp;with&nbsp;the&nbsp;following&nbsp;line.&nbsp;It&nbsp;is&nbsp;akin&nbsp;to&nbsp;replacing</span><br>
<span class="lineno"></span><span class="comment" id="4310262">//&nbsp;the&nbsp;newline&nbsp;character&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;with&nbsp;a&nbsp;space&nbsp;(to&nbsp;not&nbsp;change&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4310342">//&nbsp;remaining&nbsp;offsets).&nbsp;To&nbsp;obtain&nbsp;the&nbsp;line&nbsp;number,&nbsp;consult&nbsp;e.g.&nbsp;Position.Line.</span><br>
<span class="lineno">140</span><span class="comment" id="4310420">//&nbsp;MergeLine&nbsp;will&nbsp;panic&nbsp;if&nbsp;given&nbsp;an&nbsp;invalid&nbsp;line&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="4310477">//</span><br>
<span class="lineno"></span><span class="keyword" id="4310480">func</span>&nbsp;<span class="op" id="4310485">(</span><span class="ident" id="4310486">f</span>&nbsp;<span class="op" id="4310488">*</span><span class="ident" id="4310489">File</span><span class="op" id="4310493">)</span>&nbsp;<span class="ident" id="4310495">MergeLine</span><span class="op" id="4310504">(</span><span class="ident" id="4310505">line</span>&nbsp;<span class="builtintype" id="4310510">int</span><span class="op" id="4310513">)</span>&nbsp;<span class="op" id="4310515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310518">if</span>&nbsp;<span class="ident" id="4310521">line</span>&nbsp;<span class="op" id="4310526">&lt;=</span>&nbsp;<span class="num" id="4310529">0</span>&nbsp;<span class="op" id="4310531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4310535">panic</span><span class="op" id="4310540">(</span><span class="string" id="4310541">&#34;illegal&nbsp;line&nbsp;number&nbsp;(line&nbsp;numbering&nbsp;starts&nbsp;at&nbsp;1)&#34;</span><span class="op" id="4310591">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4310594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310597">f</span><span class="op" id="4310598">.</span><span class="ident" id="4310599">set</span><span class="op" id="4310602">.</span><span class="ident" id="4310603">mutex</span><span class="op" id="4310608">.</span><span class="ident" id="4310609">Lock</span><span class="op" id="4310613">(</span><span class="op" id="4310614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310617">defer</span>&nbsp;<span class="ident" id="4310623">f</span><span class="op" id="4310624">.</span><span class="ident" id="4310625">set</span><span class="op" id="4310628">.</span><span class="ident" id="4310629">mutex</span><span class="op" id="4310634">.</span><span class="ident" id="4310635">Unlock</span><span class="op" id="4310641">(</span><span class="op" id="4310642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310645">if</span>&nbsp;<span class="ident" id="4310648">line</span>&nbsp;<span class="op" id="4310653">&gt;=</span>&nbsp;<span class="builtinfunc" id="4310656">len</span><span class="op" id="4310659">(</span><span class="ident" id="4310660">f</span><span class="op" id="4310661">.</span><span class="ident" id="4310662">lines</span><span class="op" id="4310667">)</span>&nbsp;<span class="op" id="4310669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4310673">panic</span><span class="op" id="4310678">(</span><span class="string" id="4310679">&#34;illegal&nbsp;line&nbsp;number&#34;</span><span class="op" id="4310700">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4310703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4310706">//&nbsp;To&nbsp;merge&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line&gt;&nbsp;with&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line+1&gt;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4310777">//&nbsp;we&nbsp;need&nbsp;to&nbsp;remove&nbsp;the&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4310844">//&nbsp;numbered&nbsp;&lt;line+1&gt;.&nbsp;The&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4310912">//&nbsp;numbered&nbsp;&lt;line+1&gt;&nbsp;is&nbsp;located&nbsp;at&nbsp;index&nbsp;&lt;line&gt;,&nbsp;since&nbsp;indices&nbsp;in&nbsp;lines</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4310985">//&nbsp;are&nbsp;0-based&nbsp;and&nbsp;line&nbsp;numbers&nbsp;are&nbsp;1-based.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4311031">copy</span><span class="op" id="4311035">(</span><span class="ident" id="4311036">f</span><span class="op" id="4311037">.</span><span class="ident" id="4311038">lines</span><span class="op" id="4311043">[</span><span class="ident" id="4311044">line</span><span class="op" id="4311048">:</span><span class="op" id="4311049">]</span><span class="op" id="4311050">,</span>&nbsp;<span class="ident" id="4311052">f</span><span class="op" id="4311053">.</span><span class="ident" id="4311054">lines</span><span class="op" id="4311059">[</span><span class="ident" id="4311060">line</span><span class="op" id="4311064">+</span><span class="num" id="4311065">1</span><span class="op" id="4311066">:</span><span class="op" id="4311067">]</span><span class="op" id="4311068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311071">f</span><span class="op" id="4311072">.</span><span class="ident" id="4311073">lines</span>&nbsp;<span class="op" id="4311079">=</span>&nbsp;<span class="ident" id="4311081">f</span><span class="op" id="4311082">.</span><span class="ident" id="4311083">lines</span><span class="op" id="4311088">[</span><span class="op" id="4311089">:</span><span class="builtinfunc" id="4311090">len</span><span class="op" id="4311093">(</span><span class="ident" id="4311094">f</span><span class="op" id="4311095">.</span><span class="ident" id="4311096">lines</span><span class="op" id="4311101">)</span><span class="op" id="4311102">-</span><span class="num" id="4311103">1</span><span class="op" id="4311104">]</span><br>
<span class="lineno"></span><span class="op" id="4311106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="4311109">//&nbsp;SetLines&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;a&nbsp;file&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;successful.</span><br>
<span class="lineno"></span><span class="comment" id="4311186">//&nbsp;The&nbsp;line&nbsp;offsets&nbsp;are&nbsp;the&nbsp;offsets&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;of&nbsp;each&nbsp;line;</span><br>
<span class="lineno"></span><span class="comment" id="4311259">//&nbsp;for&nbsp;instance&nbsp;for&nbsp;the&nbsp;content&nbsp;&#34;ab\nc\n&#34;&nbsp;the&nbsp;line&nbsp;offsets&nbsp;are&nbsp;{0,&nbsp;3}.</span><br>
<span class="lineno"></span><span class="comment" id="4311330">//&nbsp;An&nbsp;empty&nbsp;file&nbsp;has&nbsp;an&nbsp;empty&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment" id="4311379">//&nbsp;Each&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno">165</span><span class="comment" id="4311452">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;SetLines&nbsp;fails&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4311524">//&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="4311534">//</span><br>
<span class="lineno"></span><span class="keyword" id="4311537">func</span>&nbsp;<span class="op" id="4311542">(</span><span class="ident" id="4311543">f</span>&nbsp;<span class="op" id="4311545">*</span><span class="ident" id="4311546">File</span><span class="op" id="4311550">)</span>&nbsp;<span class="ident" id="4311552">SetLines</span><span class="op" id="4311560">(</span><span class="ident" id="4311561">lines</span>&nbsp;<span class="op" id="4311567">[</span><span class="op" id="4311568">]</span><span class="builtintype" id="4311569">int</span><span class="op" id="4311572">)</span>&nbsp;<span class="builtintype" id="4311574">bool</span>&nbsp;<span class="op" id="4311579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4311582">//&nbsp;verify&nbsp;validity&nbsp;of&nbsp;lines&nbsp;table</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311617">size</span>&nbsp;<span class="op" id="4311622">:=</span>&nbsp;<span class="ident" id="4311625">f</span><span class="op" id="4311626">.</span><span class="ident" id="4311627">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4311633">for</span>&nbsp;<span class="ident" id="4311637">i</span><span class="op" id="4311638">,</span>&nbsp;<span class="ident" id="4311640">offset</span>&nbsp;<span class="op" id="4311647">:=</span>&nbsp;<span class="keyword" id="4311650">range</span>&nbsp;<span class="ident" id="4311656">lines</span>&nbsp;<span class="op" id="4311662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4311666">if</span>&nbsp;<span class="ident" id="4311669">i</span>&nbsp;<span class="op" id="4311671">&gt;</span>&nbsp;<span class="num" id="4311673">0</span>&nbsp;<span class="op" id="4311675">&amp;&amp;</span>&nbsp;<span class="ident" id="4311678">offset</span>&nbsp;<span class="op" id="4311685">&lt;=</span>&nbsp;<span class="ident" id="4311688">lines</span><span class="op" id="4311693">[</span><span class="ident" id="4311694">i</span><span class="op" id="4311695">-</span><span class="num" id="4311696">1</span><span class="op" id="4311697">]</span>&nbsp;<span class="op" id="4311699">||</span>&nbsp;<span class="ident" id="4311702">size</span>&nbsp;<span class="op" id="4311707">&lt;=</span>&nbsp;<span class="ident" id="4311710">offset</span>&nbsp;<span class="op" id="4311717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4311722">return</span>&nbsp;<span class="builtintype" id="4311729">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4311737">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4311740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4311744">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311764">f</span><span class="op" id="4311765">.</span><span class="ident" id="4311766">set</span><span class="op" id="4311769">.</span><span class="ident" id="4311770">mutex</span><span class="op" id="4311775">.</span><span class="ident" id="4311776">Lock</span><span class="op" id="4311780">(</span><span class="op" id="4311781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311784">f</span><span class="op" id="4311785">.</span><span class="ident" id="4311786">lines</span>&nbsp;<span class="op" id="4311792">=</span>&nbsp;<span class="ident" id="4311794">lines</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311801">f</span><span class="op" id="4311802">.</span><span class="ident" id="4311803">set</span><span class="op" id="4311806">.</span><span class="ident" id="4311807">mutex</span><span class="op" id="4311812">.</span><span class="ident" id="4311813">Unlock</span><span class="op" id="4311819">(</span><span class="op" id="4311820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4311823">return</span>&nbsp;<span class="builtintype" id="4311830">true</span><br>
<span class="lineno"></span><span class="op" id="4311835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4311838">//&nbsp;SetLinesForContent&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;content.</span><br>
<span class="lineno">185</span><span class="comment" id="4311910">//&nbsp;It&nbsp;ignores&nbsp;position-altering&nbsp;//line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="keyword" id="4311959">func</span>&nbsp;<span class="op" id="4311964">(</span><span class="ident" id="4311965">f</span>&nbsp;<span class="op" id="4311967">*</span><span class="ident" id="4311968">File</span><span class="op" id="4311972">)</span>&nbsp;<span class="ident" id="4311974">SetLinesForContent</span><span class="op" id="4311992">(</span><span class="ident" id="4311993">content</span>&nbsp;<span class="op" id="4312001">[</span><span class="op" id="4312002">]</span><span class="builtintype" id="4312003">byte</span><span class="op" id="4312007">)</span>&nbsp;<span class="op" id="4312009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312012">var</span>&nbsp;<span class="ident" id="4312016">lines</span>&nbsp;<span class="op" id="4312022">[</span><span class="op" id="4312023">]</span><span class="builtintype" id="4312024">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312029">line</span>&nbsp;<span class="op" id="4312034">:=</span>&nbsp;<span class="num" id="4312037">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312040">for</span>&nbsp;<span class="ident" id="4312044">offset</span><span class="op" id="4312050">,</span>&nbsp;<span class="ident" id="4312052">b</span>&nbsp;<span class="op" id="4312054">:=</span>&nbsp;<span class="keyword" id="4312057">range</span>&nbsp;<span class="ident" id="4312063">content</span>&nbsp;<span class="op" id="4312071">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312075">if</span>&nbsp;<span class="ident" id="4312078">line</span>&nbsp;<span class="op" id="4312083">&gt;=</span>&nbsp;<span class="num" id="4312086">0</span>&nbsp;<span class="op" id="4312088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312093">lines</span>&nbsp;<span class="op" id="4312099">=</span>&nbsp;<span class="builtinfunc" id="4312101">append</span><span class="op" id="4312107">(</span><span class="ident" id="4312108">lines</span><span class="op" id="4312113">,</span>&nbsp;<span class="ident" id="4312115">line</span><span class="op" id="4312119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312127">line</span>&nbsp;<span class="op" id="4312132">=</span>&nbsp;<span class="op" id="4312134">-</span><span class="num" id="4312135">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312139">if</span>&nbsp;<span class="ident" id="4312142">b</span>&nbsp;<span class="op" id="4312144">==</span>&nbsp;<span class="string" id="4312147">&#39;\n&#39;</span>&nbsp;<span class="op" id="4312152">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312157">line</span>&nbsp;<span class="op" id="4312162">=</span>&nbsp;<span class="ident" id="4312164">offset</span>&nbsp;<span class="op" id="4312171">+</span>&nbsp;<span class="num" id="4312173">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4312184">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312204">f</span><span class="op" id="4312205">.</span><span class="ident" id="4312206">set</span><span class="op" id="4312209">.</span><span class="ident" id="4312210">mutex</span><span class="op" id="4312215">.</span><span class="ident" id="4312216">Lock</span><span class="op" id="4312220">(</span><span class="op" id="4312221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312224">f</span><span class="op" id="4312225">.</span><span class="ident" id="4312226">lines</span>&nbsp;<span class="op" id="4312232">=</span>&nbsp;<span class="ident" id="4312234">lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312241">f</span><span class="op" id="4312242">.</span><span class="ident" id="4312243">set</span><span class="op" id="4312246">.</span><span class="ident" id="4312247">mutex</span><span class="op" id="4312252">.</span><span class="ident" id="4312253">Unlock</span><span class="op" id="4312259">(</span><span class="op" id="4312260">)</span><br>
<span class="lineno"></span><span class="op" id="4312262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="4312265">//&nbsp;A&nbsp;lineInfo&nbsp;object&nbsp;describes&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="4312329">//&nbsp;information&nbsp;(such&nbsp;as&nbsp;provided&nbsp;via&nbsp;a&nbsp;//line&nbsp;comment&nbsp;in&nbsp;a&nbsp;.go</span><br>
<span class="lineno"></span><span class="comment" id="4312392">//&nbsp;file)&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="4312426">type</span>&nbsp;<span class="ident" id="4312431">lineInfo</span>&nbsp;<span class="keyword" id="4312440">struct</span>&nbsp;<span class="op" id="4312447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4312450">//&nbsp;fields&nbsp;are&nbsp;exported&nbsp;to&nbsp;make&nbsp;them&nbsp;accessible&nbsp;to&nbsp;gob</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312505">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4312514">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312519">Filename</span>&nbsp;<span class="builtintype" id="4312528">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312536">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4312545">int</span><br>
<span class="lineno"></span><span class="op" id="4312549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="4312552">//&nbsp;AddLineInfo&nbsp;adds&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number&nbsp;information&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4312621">//&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.&nbsp;The&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4312691">//&nbsp;the&nbsp;previously&nbsp;added&nbsp;alternative&nbsp;line&nbsp;info&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4312758">//&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;information&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4312810">//</span><br>
<span class="lineno">220</span><span class="comment" id="4312813">//&nbsp;AddLineInfo&nbsp;is&nbsp;typically&nbsp;used&nbsp;to&nbsp;register&nbsp;alternative&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="4312879">//&nbsp;information&nbsp;for&nbsp;//line&nbsp;filename:line&nbsp;comments&nbsp;in&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4312945">//</span><br>
<span class="lineno"></span><span class="keyword" id="4312948">func</span>&nbsp;<span class="op" id="4312953">(</span><span class="ident" id="4312954">f</span>&nbsp;<span class="op" id="4312956">*</span><span class="ident" id="4312957">File</span><span class="op" id="4312961">)</span>&nbsp;<span class="ident" id="4312963">AddLineInfo</span><span class="op" id="4312974">(</span><span class="ident" id="4312975">offset</span>&nbsp;<span class="builtintype" id="4312982">int</span><span class="op" id="4312985">,</span>&nbsp;<span class="ident" id="4312987">filename</span>&nbsp;<span class="builtintype" id="4312996">string</span><span class="op" id="4313002">,</span>&nbsp;<span class="ident" id="4313004">line</span>&nbsp;<span class="builtintype" id="4313009">int</span><span class="op" id="4313012">)</span>&nbsp;<span class="op" id="4313014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313017">f</span><span class="op" id="4313018">.</span><span class="ident" id="4313019">set</span><span class="op" id="4313022">.</span><span class="ident" id="4313023">mutex</span><span class="op" id="4313028">.</span><span class="ident" id="4313029">Lock</span><span class="op" id="4313033">(</span><span class="op" id="4313034">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313037">if</span>&nbsp;<span class="ident" id="4313040">i</span>&nbsp;<span class="op" id="4313042">:=</span>&nbsp;<span class="builtinfunc" id="4313045">len</span><span class="op" id="4313048">(</span><span class="ident" id="4313049">f</span><span class="op" id="4313050">.</span><span class="ident" id="4313051">infos</span><span class="op" id="4313056">)</span><span class="op" id="4313057">;</span>&nbsp;<span class="ident" id="4313059">i</span>&nbsp;<span class="op" id="4313061">==</span>&nbsp;<span class="num" id="4313064">0</span>&nbsp;<span class="op" id="4313066">||</span>&nbsp;<span class="ident" id="4313069">f</span><span class="op" id="4313070">.</span><span class="ident" id="4313071">infos</span><span class="op" id="4313076">[</span><span class="ident" id="4313077">i</span><span class="op" id="4313078">-</span><span class="num" id="4313079">1</span><span class="op" id="4313080">]</span><span class="op" id="4313081">.</span><span class="ident" id="4313082">Offset</span>&nbsp;<span class="op" id="4313089">&lt;</span>&nbsp;<span class="ident" id="4313091">offset</span>&nbsp;<span class="op" id="4313098">&amp;&amp;</span>&nbsp;<span class="ident" id="4313101">offset</span>&nbsp;<span class="op" id="4313108">&lt;</span>&nbsp;<span class="ident" id="4313110">f</span><span class="op" id="4313111">.</span><span class="ident" id="4313112">size</span>&nbsp;<span class="op" id="4313117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313121">f</span><span class="op" id="4313122">.</span><span class="ident" id="4313123">infos</span>&nbsp;<span class="op" id="4313129">=</span>&nbsp;<span class="builtinfunc" id="4313131">append</span><span class="op" id="4313137">(</span><span class="ident" id="4313138">f</span><span class="op" id="4313139">.</span><span class="ident" id="4313140">infos</span><span class="op" id="4313145">,</span>&nbsp;<span class="ident" id="4313147">lineInfo</span><span class="op" id="4313155">{</span><span class="ident" id="4313156">offset</span><span class="op" id="4313162">,</span>&nbsp;<span class="ident" id="4313164">filename</span><span class="op" id="4313172">,</span>&nbsp;<span class="ident" id="4313174">line</span><span class="op" id="4313178">}</span><span class="op" id="4313179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4313182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313185">f</span><span class="op" id="4313186">.</span><span class="ident" id="4313187">set</span><span class="op" id="4313190">.</span><span class="ident" id="4313191">mutex</span><span class="op" id="4313196">.</span><span class="ident" id="4313197">Unlock</span><span class="op" id="4313203">(</span><span class="op" id="4313204">)</span><br>
<span class="lineno"></span><span class="op" id="4313206">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="4313209">//&nbsp;Pos&nbsp;returns&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;offset;</span><br>
<span class="lineno"></span><span class="comment" id="4313265">//&nbsp;the&nbsp;offset&nbsp;must&nbsp;be&nbsp;&lt;=&nbsp;f.Size().</span><br>
<span class="lineno"></span><span class="comment" id="4313300">//&nbsp;f.Pos(f.Offset(p))&nbsp;==&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="4313328">//</span><br>
<span class="lineno">235</span><span class="keyword" id="4313331">func</span>&nbsp;<span class="op" id="4313336">(</span><span class="ident" id="4313337">f</span>&nbsp;<span class="op" id="4313339">*</span><span class="ident" id="4313340">File</span><span class="op" id="4313344">)</span>&nbsp;<span class="ident" id="4313346">Pos</span><span class="op" id="4313349">(</span><span class="ident" id="4313350">offset</span>&nbsp;<span class="builtintype" id="4313357">int</span><span class="op" id="4313360">)</span>&nbsp;<span class="ident" id="4313362">Pos</span>&nbsp;<span class="op" id="4313366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313369">if</span>&nbsp;<span class="ident" id="4313372">offset</span>&nbsp;<span class="op" id="4313379">&gt;</span>&nbsp;<span class="ident" id="4313381">f</span><span class="op" id="4313382">.</span><span class="ident" id="4313383">size</span>&nbsp;<span class="op" id="4313388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4313392">panic</span><span class="op" id="4313397">(</span><span class="string" id="4313398">&#34;illegal&nbsp;file&nbsp;offset&#34;</span><span class="op" id="4313419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4313422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313425">return</span>&nbsp;<span class="ident" id="4313432">Pos</span><span class="op" id="4313435">(</span><span class="ident" id="4313436">f</span><span class="op" id="4313437">.</span><span class="ident" id="4313438">base</span>&nbsp;<span class="op" id="4313443">+</span>&nbsp;<span class="ident" id="4313445">offset</span><span class="op" id="4313451">)</span><br>
<span class="lineno">240</span><span class="op" id="4313453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4313456">//&nbsp;Offset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="4313516">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;valid&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4313561">//&nbsp;f.Offset(f.Pos(offset))&nbsp;==&nbsp;offset.</span><br>
<span class="lineno">245</span><span class="comment" id="4313599">//</span><br>
<span class="lineno"></span><span class="keyword" id="4313602">func</span>&nbsp;<span class="op" id="4313607">(</span><span class="ident" id="4313608">f</span>&nbsp;<span class="op" id="4313610">*</span><span class="ident" id="4313611">File</span><span class="op" id="4313615">)</span>&nbsp;<span class="ident" id="4313617">Offset</span><span class="op" id="4313623">(</span><span class="ident" id="4313624">p</span>&nbsp;<span class="ident" id="4313626">Pos</span><span class="op" id="4313629">)</span>&nbsp;<span class="builtintype" id="4313631">int</span>&nbsp;<span class="op" id="4313635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313638">if</span>&nbsp;<span class="builtintype" id="4313641">int</span><span class="op" id="4313644">(</span><span class="ident" id="4313645">p</span><span class="op" id="4313646">)</span>&nbsp;<span class="op" id="4313648">&lt;</span>&nbsp;<span class="ident" id="4313650">f</span><span class="op" id="4313651">.</span><span class="ident" id="4313652">base</span>&nbsp;<span class="op" id="4313657">||</span>&nbsp;<span class="builtintype" id="4313660">int</span><span class="op" id="4313663">(</span><span class="ident" id="4313664">p</span><span class="op" id="4313665">)</span>&nbsp;<span class="op" id="4313667">&gt;</span>&nbsp;<span class="ident" id="4313669">f</span><span class="op" id="4313670">.</span><span class="ident" id="4313671">base</span><span class="op" id="4313675">+</span><span class="ident" id="4313676">f</span><span class="op" id="4313677">.</span><span class="ident" id="4313678">size</span>&nbsp;<span class="op" id="4313683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4313687">panic</span><span class="op" id="4313692">(</span><span class="string" id="4313693">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="4313712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4313715">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313718">return</span>&nbsp;<span class="builtintype" id="4313725">int</span><span class="op" id="4313728">(</span><span class="ident" id="4313729">p</span><span class="op" id="4313730">)</span>&nbsp;<span class="op" id="4313732">-</span>&nbsp;<span class="ident" id="4313734">f</span><span class="op" id="4313735">.</span><span class="ident" id="4313736">base</span><br>
<span class="lineno"></span><span class="op" id="4313741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4313744">//&nbsp;Line&nbsp;returns&nbsp;the&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="4313807">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno">255</span><span class="comment" id="4313855">//</span><br>
<span class="lineno"></span><span class="keyword" id="4313858">func</span>&nbsp;<span class="op" id="4313863">(</span><span class="ident" id="4313864">f</span>&nbsp;<span class="op" id="4313866">*</span><span class="ident" id="4313867">File</span><span class="op" id="4313871">)</span>&nbsp;<span class="ident" id="4313873">Line</span><span class="op" id="4313877">(</span><span class="ident" id="4313878">p</span>&nbsp;<span class="ident" id="4313880">Pos</span><span class="op" id="4313883">)</span>&nbsp;<span class="builtintype" id="4313885">int</span>&nbsp;<span class="op" id="4313889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313892">return</span>&nbsp;<span class="ident" id="4313899">f</span><span class="op" id="4313900">.</span><span class="ident" id="4313901">Position</span><span class="op" id="4313909">(</span><span class="ident" id="4313910">p</span><span class="op" id="4313911">)</span><span class="op" id="4313912">.</span><span class="ident" id="4313913">Line</span><br>
<span class="lineno"></span><span class="op" id="4313918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="4313921">func</span>&nbsp;<span class="ident" id="4313926">searchLineInfos</span><span class="op" id="4313941">(</span><span class="ident" id="4313942">a</span>&nbsp;<span class="op" id="4313944">[</span><span class="op" id="4313945">]</span><span class="ident" id="4313946">lineInfo</span><span class="op" id="4313954">,</span>&nbsp;<span class="ident" id="4313956">x</span>&nbsp;<span class="builtintype" id="4313958">int</span><span class="op" id="4313961">)</span>&nbsp;<span class="builtintype" id="4313963">int</span>&nbsp;<span class="op" id="4313967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313970">return</span>&nbsp;<span class="ident" id="4313977">sort</span><span class="op" id="4313981">.</span><span class="ident" id="4313982">Search</span><span class="op" id="4313988">(</span><span class="builtinfunc" id="4313989">len</span><span class="op" id="4313992">(</span><span class="ident" id="4313993">a</span><span class="op" id="4313994">)</span><span class="op" id="4313995">,</span>&nbsp;<span class="keyword" id="4313997">func</span><span class="op" id="4314001">(</span><span class="ident" id="4314002">i</span>&nbsp;<span class="builtintype" id="4314004">int</span><span class="op" id="4314007">)</span>&nbsp;<span class="builtintype" id="4314009">bool</span>&nbsp;<span class="op" id="4314014">{</span>&nbsp;<span class="keyword" id="4314016">return</span>&nbsp;<span class="ident" id="4314023">a</span><span class="op" id="4314024">[</span><span class="ident" id="4314025">i</span><span class="op" id="4314026">]</span><span class="op" id="4314027">.</span><span class="ident" id="4314028">Offset</span>&nbsp;<span class="op" id="4314035">&gt;</span>&nbsp;<span class="ident" id="4314037">x</span>&nbsp;<span class="op" id="4314039">}</span><span class="op" id="4314040">)</span>&nbsp;<span class="op" id="4314042">-</span>&nbsp;<span class="num" id="4314044">1</span><br>
<span class="lineno"></span><span class="op" id="4314046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4314049">//&nbsp;unpack&nbsp;returns&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;and&nbsp;column&nbsp;number&nbsp;for&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno">265</span><span class="comment" id="4314126">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;unpack&nbsp;will&nbsp;return&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="4314202">//&nbsp;possibly&nbsp;adjusted&nbsp;by&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4314281">//</span><br>
<span class="lineno"></span><span class="keyword" id="4314284">func</span>&nbsp;<span class="op" id="4314289">(</span><span class="ident" id="4314290">f</span>&nbsp;<span class="op" id="4314292">*</span><span class="ident" id="4314293">File</span><span class="op" id="4314297">)</span>&nbsp;<span class="ident" id="4314299">unpack</span><span class="op" id="4314305">(</span><span class="ident" id="4314306">offset</span>&nbsp;<span class="builtintype" id="4314313">int</span><span class="op" id="4314316">,</span>&nbsp;<span class="ident" id="4314318">adjusted</span>&nbsp;<span class="builtintype" id="4314327">bool</span><span class="op" id="4314331">)</span>&nbsp;<span class="op" id="4314333">(</span><span class="ident" id="4314334">filename</span>&nbsp;<span class="builtintype" id="4314343">string</span><span class="op" id="4314349">,</span>&nbsp;<span class="ident" id="4314351">line</span><span class="op" id="4314355">,</span>&nbsp;<span class="ident" id="4314357">column</span>&nbsp;<span class="builtintype" id="4314364">int</span><span class="op" id="4314367">)</span>&nbsp;<span class="op" id="4314369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314372">filename</span>&nbsp;<span class="op" id="4314381">=</span>&nbsp;<span class="ident" id="4314383">f</span><span class="op" id="4314384">.</span><span class="ident" id="4314385">name</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314391">if</span>&nbsp;<span class="ident" id="4314394">i</span>&nbsp;<span class="op" id="4314396">:=</span>&nbsp;<span class="ident" id="4314399">searchInts</span><span class="op" id="4314409">(</span><span class="ident" id="4314410">f</span><span class="op" id="4314411">.</span><span class="ident" id="4314412">lines</span><span class="op" id="4314417">,</span>&nbsp;<span class="ident" id="4314419">offset</span><span class="op" id="4314425">)</span><span class="op" id="4314426">;</span>&nbsp;<span class="ident" id="4314428">i</span>&nbsp;<span class="op" id="4314430">&gt;=</span>&nbsp;<span class="num" id="4314433">0</span>&nbsp;<span class="op" id="4314435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314439">line</span><span class="op" id="4314443">,</span>&nbsp;<span class="ident" id="4314445">column</span>&nbsp;<span class="op" id="4314452">=</span>&nbsp;<span class="ident" id="4314454">i</span><span class="op" id="4314455">+</span><span class="num" id="4314456">1</span><span class="op" id="4314457">,</span>&nbsp;<span class="ident" id="4314459">offset</span><span class="op" id="4314465">-</span><span class="ident" id="4314466">f</span><span class="op" id="4314467">.</span><span class="ident" id="4314468">lines</span><span class="op" id="4314473">[</span><span class="ident" id="4314474">i</span><span class="op" id="4314475">]</span><span class="op" id="4314476">+</span><span class="num" id="4314477">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4314480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314483">if</span>&nbsp;<span class="ident" id="4314486">adjusted</span>&nbsp;<span class="op" id="4314495">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4314498">len</span><span class="op" id="4314501">(</span><span class="ident" id="4314502">f</span><span class="op" id="4314503">.</span><span class="ident" id="4314504">infos</span><span class="op" id="4314509">)</span>&nbsp;<span class="op" id="4314511">&gt;</span>&nbsp;<span class="num" id="4314513">0</span>&nbsp;<span class="op" id="4314515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4314519">//&nbsp;almost&nbsp;no&nbsp;files&nbsp;have&nbsp;extra&nbsp;line&nbsp;infos</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314562">if</span>&nbsp;<span class="ident" id="4314565">i</span>&nbsp;<span class="op" id="4314567">:=</span>&nbsp;<span class="ident" id="4314570">searchLineInfos</span><span class="op" id="4314585">(</span><span class="ident" id="4314586">f</span><span class="op" id="4314587">.</span><span class="ident" id="4314588">infos</span><span class="op" id="4314593">,</span>&nbsp;<span class="ident" id="4314595">offset</span><span class="op" id="4314601">)</span><span class="op" id="4314602">;</span>&nbsp;<span class="ident" id="4314604">i</span>&nbsp;<span class="op" id="4314606">&gt;=</span>&nbsp;<span class="num" id="4314609">0</span>&nbsp;<span class="op" id="4314611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314616">alt</span>&nbsp;<span class="op" id="4314620">:=</span>&nbsp;<span class="op" id="4314623">&amp;</span><span class="ident" id="4314624">f</span><span class="op" id="4314625">.</span><span class="ident" id="4314626">infos</span><span class="op" id="4314631">[</span><span class="ident" id="4314632">i</span><span class="op" id="4314633">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314638">filename</span>&nbsp;<span class="op" id="4314647">=</span>&nbsp;<span class="ident" id="4314649">alt</span><span class="op" id="4314652">.</span><span class="ident" id="4314653">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314665">if</span>&nbsp;<span class="ident" id="4314668">i</span>&nbsp;<span class="op" id="4314670">:=</span>&nbsp;<span class="ident" id="4314673">searchInts</span><span class="op" id="4314683">(</span><span class="ident" id="4314684">f</span><span class="op" id="4314685">.</span><span class="ident" id="4314686">lines</span><span class="op" id="4314691">,</span>&nbsp;<span class="ident" id="4314693">alt</span><span class="op" id="4314696">.</span><span class="ident" id="4314697">Offset</span><span class="op" id="4314703">)</span><span class="op" id="4314704">;</span>&nbsp;<span class="ident" id="4314706">i</span>&nbsp;<span class="op" id="4314708">&gt;=</span>&nbsp;<span class="num" id="4314711">0</span>&nbsp;<span class="op" id="4314713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314719">line</span>&nbsp;<span class="op" id="4314724">+=</span>&nbsp;<span class="ident" id="4314727">alt</span><span class="op" id="4314730">.</span><span class="ident" id="4314731">Line</span>&nbsp;<span class="op" id="4314736">-</span>&nbsp;<span class="ident" id="4314738">i</span>&nbsp;<span class="op" id="4314740">-</span>&nbsp;<span class="num" id="4314742">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4314747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4314751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4314754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314757">return</span><br>
<span class="lineno"></span><span class="op" id="4314764">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="4314767">func</span>&nbsp;<span class="op" id="4314772">(</span><span class="ident" id="4314773">f</span>&nbsp;<span class="op" id="4314775">*</span><span class="ident" id="4314776">File</span><span class="op" id="4314780">)</span>&nbsp;<span class="ident" id="4314782">position</span><span class="op" id="4314790">(</span><span class="ident" id="4314791">p</span>&nbsp;<span class="ident" id="4314793">Pos</span><span class="op" id="4314796">,</span>&nbsp;<span class="ident" id="4314798">adjusted</span>&nbsp;<span class="builtintype" id="4314807">bool</span><span class="op" id="4314811">)</span>&nbsp;<span class="op" id="4314813">(</span><span class="ident" id="4314814">pos</span>&nbsp;<span class="ident" id="4314818">Position</span><span class="op" id="4314826">)</span>&nbsp;<span class="op" id="4314828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314831">offset</span>&nbsp;<span class="op" id="4314838">:=</span>&nbsp;<span class="builtintype" id="4314841">int</span><span class="op" id="4314844">(</span><span class="ident" id="4314845">p</span><span class="op" id="4314846">)</span>&nbsp;<span class="op" id="4314848">-</span>&nbsp;<span class="ident" id="4314850">f</span><span class="op" id="4314851">.</span><span class="ident" id="4314852">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314858">pos</span><span class="op" id="4314861">.</span><span class="ident" id="4314862">Offset</span>&nbsp;<span class="op" id="4314869">=</span>&nbsp;<span class="ident" id="4314871">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314879">pos</span><span class="op" id="4314882">.</span><span class="ident" id="4314883">Filename</span><span class="op" id="4314891">,</span>&nbsp;<span class="ident" id="4314893">pos</span><span class="op" id="4314896">.</span><span class="ident" id="4314897">Line</span><span class="op" id="4314901">,</span>&nbsp;<span class="ident" id="4314903">pos</span><span class="op" id="4314906">.</span><span class="ident" id="4314907">Column</span>&nbsp;<span class="op" id="4314914">=</span>&nbsp;<span class="ident" id="4314916">f</span><span class="op" id="4314917">.</span><span class="ident" id="4314918">unpack</span><span class="op" id="4314924">(</span><span class="ident" id="4314925">offset</span><span class="op" id="4314931">,</span>&nbsp;<span class="ident" id="4314933">adjusted</span><span class="op" id="4314941">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314944">return</span><br>
<span class="lineno"></span><span class="op" id="4314951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4314954">//&nbsp;PositionFor&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="4315027">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno">295</span><span class="comment" id="4315100">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4315158">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;f&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="4315198">//</span><br>
<span class="lineno"></span><span class="keyword" id="4315201">func</span>&nbsp;<span class="op" id="4315206">(</span><span class="ident" id="4315207">f</span>&nbsp;<span class="op" id="4315209">*</span><span class="ident" id="4315210">File</span><span class="op" id="4315214">)</span>&nbsp;<span class="ident" id="4315216">PositionFor</span><span class="op" id="4315227">(</span><span class="ident" id="4315228">p</span>&nbsp;<span class="ident" id="4315230">Pos</span><span class="op" id="4315233">,</span>&nbsp;<span class="ident" id="4315235">adjusted</span>&nbsp;<span class="builtintype" id="4315244">bool</span><span class="op" id="4315248">)</span>&nbsp;<span class="op" id="4315250">(</span><span class="ident" id="4315251">pos</span>&nbsp;<span class="ident" id="4315255">Position</span><span class="op" id="4315263">)</span>&nbsp;<span class="op" id="4315265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4315268">if</span>&nbsp;<span class="ident" id="4315271">p</span>&nbsp;<span class="op" id="4315273">!=</span>&nbsp;<span class="ident" id="4315276">NoPos</span>&nbsp;<span class="op" id="4315282">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4315286">if</span>&nbsp;<span class="builtintype" id="4315289">int</span><span class="op" id="4315292">(</span><span class="ident" id="4315293">p</span><span class="op" id="4315294">)</span>&nbsp;<span class="op" id="4315296">&lt;</span>&nbsp;<span class="ident" id="4315298">f</span><span class="op" id="4315299">.</span><span class="ident" id="4315300">base</span>&nbsp;<span class="op" id="4315305">||</span>&nbsp;<span class="builtintype" id="4315308">int</span><span class="op" id="4315311">(</span><span class="ident" id="4315312">p</span><span class="op" id="4315313">)</span>&nbsp;<span class="op" id="4315315">&gt;</span>&nbsp;<span class="ident" id="4315317">f</span><span class="op" id="4315318">.</span><span class="ident" id="4315319">base</span><span class="op" id="4315323">+</span><span class="ident" id="4315324">f</span><span class="op" id="4315325">.</span><span class="ident" id="4315326">size</span>&nbsp;<span class="op" id="4315331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4315336">panic</span><span class="op" id="4315341">(</span><span class="string" id="4315342">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="4315361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4315365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315369">pos</span>&nbsp;<span class="op" id="4315373">=</span>&nbsp;<span class="ident" id="4315375">f</span><span class="op" id="4315376">.</span><span class="ident" id="4315377">position</span><span class="op" id="4315385">(</span><span class="ident" id="4315386">p</span><span class="op" id="4315387">,</span>&nbsp;<span class="ident" id="4315389">adjusted</span><span class="op" id="4315397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4315400">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4315403">return</span><br>
<span class="lineno"></span><span class="op" id="4315410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4315413">//&nbsp;Position&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="4315483">//&nbsp;Calling&nbsp;f.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;f.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno">310</span><span class="comment" id="4315557">//</span><br>
<span class="lineno"></span><span class="keyword" id="4315560">func</span>&nbsp;<span class="op" id="4315565">(</span><span class="ident" id="4315566">f</span>&nbsp;<span class="op" id="4315568">*</span><span class="ident" id="4315569">File</span><span class="op" id="4315573">)</span>&nbsp;<span class="ident" id="4315575">Position</span><span class="op" id="4315583">(</span><span class="ident" id="4315584">p</span>&nbsp;<span class="ident" id="4315586">Pos</span><span class="op" id="4315589">)</span>&nbsp;<span class="op" id="4315591">(</span><span class="ident" id="4315592">pos</span>&nbsp;<span class="ident" id="4315596">Position</span><span class="op" id="4315604">)</span>&nbsp;<span class="op" id="4315606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4315609">return</span>&nbsp;<span class="ident" id="4315616">f</span><span class="op" id="4315617">.</span><span class="ident" id="4315618">PositionFor</span><span class="op" id="4315629">(</span><span class="ident" id="4315630">p</span><span class="op" id="4315631">,</span>&nbsp;<span class="builtintype" id="4315633">true</span><span class="op" id="4315637">)</span><br>
<span class="lineno"></span><span class="op" id="4315639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="4315642">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4315723">//&nbsp;FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4315735">//&nbsp;A&nbsp;FileSet&nbsp;represents&nbsp;a&nbsp;set&nbsp;of&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4315782">//&nbsp;Methods&nbsp;of&nbsp;file&nbsp;sets&nbsp;are&nbsp;synchronized;&nbsp;multiple&nbsp;goroutines</span><br>
<span class="lineno">320</span><span class="comment" id="4315844">//&nbsp;may&nbsp;invoke&nbsp;them&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="comment" id="4315877">//</span><br>
<span class="lineno"></span><span class="keyword" id="4315880">type</span>&nbsp;<span class="ident" id="4315885">FileSet</span>&nbsp;<span class="keyword" id="4315893">struct</span>&nbsp;<span class="op" id="4315900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315903">mutex</span>&nbsp;<span class="ident" id="4315909">sync</span><span class="op" id="4315913">.</span><span class="ident" id="4315914">RWMutex</span>&nbsp;<span class="comment" id="4315922">//&nbsp;protects&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4315948">base</span>&nbsp;&nbsp;<span class="builtintype" id="4315954">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4315967">//&nbsp;base&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;file</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316001">files</span>&nbsp;<span class="op" id="4316007">[</span><span class="op" id="4316008">]</span><span class="op" id="4316009">*</span><span class="ident" id="4316010">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4316020">//&nbsp;list&nbsp;of&nbsp;files&nbsp;in&nbsp;the&nbsp;order&nbsp;added&nbsp;to&nbsp;the&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316068">last</span>&nbsp;&nbsp;<span class="op" id="4316074">*</span><span class="ident" id="4316075">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4316087">//&nbsp;cache&nbsp;of&nbsp;last&nbsp;file&nbsp;looked&nbsp;up</span><br>
<span class="lineno"></span><span class="op" id="4316119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4316122">//&nbsp;NewFileSet&nbsp;creates&nbsp;a&nbsp;new&nbsp;file&nbsp;set.</span><br>
<span class="lineno">330</span><span class="keyword" id="4316160">func</span>&nbsp;<span class="ident" id="4316165">NewFileSet</span><span class="op" id="4316175">(</span><span class="op" id="4316176">)</span>&nbsp;<span class="op" id="4316178">*</span><span class="ident" id="4316179">FileSet</span>&nbsp;<span class="op" id="4316187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316190">return</span>&nbsp;<span class="op" id="4316197">&amp;</span><span class="ident" id="4316198">FileSet</span><span class="op" id="4316205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316209">base</span><span class="op" id="4316213">:</span>&nbsp;<span class="num" id="4316215">1</span><span class="op" id="4316216">,</span>&nbsp;<span class="comment" id="4316218">//&nbsp;0&nbsp;==&nbsp;NoPos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4316233">}</span><br>
<span class="lineno"></span><span class="op" id="4316235">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="comment" id="4316238">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;base&nbsp;offset&nbsp;that&nbsp;must&nbsp;be&nbsp;provided&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4316303">//&nbsp;AddFile&nbsp;when&nbsp;adding&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4316341">//</span><br>
<span class="lineno"></span><span class="keyword" id="4316344">func</span>&nbsp;<span class="op" id="4316349">(</span><span class="ident" id="4316350">s</span>&nbsp;<span class="op" id="4316352">*</span><span class="ident" id="4316353">FileSet</span><span class="op" id="4316360">)</span>&nbsp;<span class="ident" id="4316362">Base</span><span class="op" id="4316366">(</span><span class="op" id="4316367">)</span>&nbsp;<span class="builtintype" id="4316369">int</span>&nbsp;<span class="op" id="4316373">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316376">s</span><span class="op" id="4316377">.</span><span class="ident" id="4316378">mutex</span><span class="op" id="4316383">.</span><span class="ident" id="4316384">RLock</span><span class="op" id="4316389">(</span><span class="op" id="4316390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316393">b</span>&nbsp;<span class="op" id="4316395">:=</span>&nbsp;<span class="ident" id="4316398">s</span><span class="op" id="4316399">.</span><span class="ident" id="4316400">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4316406">s</span><span class="op" id="4316407">.</span><span class="ident" id="4316408">mutex</span><span class="op" id="4316413">.</span><span class="ident" id="4316414">RUnlock</span><span class="op" id="4316421">(</span><span class="op" id="4316422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4316425">return</span>&nbsp;<span class="ident" id="4316432">b</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="op" id="4316435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4316438">//&nbsp;AddFile&nbsp;adds&nbsp;a&nbsp;new&nbsp;file&nbsp;with&nbsp;a&nbsp;given&nbsp;filename,&nbsp;base&nbsp;offset,&nbsp;and&nbsp;file&nbsp;size</span><br>
<span class="lineno"></span><span class="comment" id="4316515">//&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;s&nbsp;and&nbsp;returns&nbsp;the&nbsp;file.&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;have&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="4316591">//&nbsp;name.&nbsp;The&nbsp;base&nbsp;offset&nbsp;must&nbsp;not&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base(),&nbsp;and</span><br>
<span class="lineno">350</span><span class="comment" id="4316667">//&nbsp;size&nbsp;must&nbsp;not&nbsp;be&nbsp;negative.&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;if&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span><span class="comment" id="4316748">//&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base()&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="4316810">//</span><br>
<span class="lineno"></span><span class="comment" id="4316813">//&nbsp;Adding&nbsp;the&nbsp;file&nbsp;will&nbsp;set&nbsp;the&nbsp;file&nbsp;set&#39;s&nbsp;Base()&nbsp;value&nbsp;to&nbsp;base&nbsp;+&nbsp;size&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="4316888">//&nbsp;as&nbsp;the&nbsp;minimum&nbsp;base&nbsp;value&nbsp;for&nbsp;the&nbsp;next&nbsp;file.&nbsp;The&nbsp;following&nbsp;relationship</span><br>
<span class="lineno">355</span><span class="comment" id="4316963">//&nbsp;exists&nbsp;between&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset&nbsp;offs:</span><br>
<span class="lineno"></span><span class="comment" id="4317025">//</span><br>
<span class="lineno"></span><span class="comment" id="4317028">//&nbsp;&nbsp;&nbsp;&nbspint(p)&nbsp;=&nbsp;base&nbsp;+&nbsp;offs</span><br>
<span class="lineno"></span><span class="comment" id="4317052">//</span><br>
<span class="lineno"></span><span class="comment" id="4317055">//&nbsp;with&nbsp;offs&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;size]&nbsp;and&nbsp;thus&nbsp;p&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size].</span><br>
<span class="lineno">360</span><span class="comment" id="4317134">//&nbsp;For&nbsp;convenience,&nbsp;File.Pos&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;file-specific&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="4317208">//&nbsp;values&nbsp;from&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="4317238">//</span><br>
<span class="lineno"></span><span class="keyword" id="4317241">func</span>&nbsp;<span class="op" id="4317246">(</span><span class="ident" id="4317247">s</span>&nbsp;<span class="op" id="4317249">*</span><span class="ident" id="4317250">FileSet</span><span class="op" id="4317257">)</span>&nbsp;<span class="ident" id="4317259">AddFile</span><span class="op" id="4317266">(</span><span class="ident" id="4317267">filename</span>&nbsp;<span class="builtintype" id="4317276">string</span><span class="op" id="4317282">,</span>&nbsp;<span class="ident" id="4317284">base</span><span class="op" id="4317288">,</span>&nbsp;<span class="ident" id="4317290">size</span>&nbsp;<span class="builtintype" id="4317295">int</span><span class="op" id="4317298">)</span>&nbsp;<span class="op" id="4317300">*</span><span class="ident" id="4317301">File</span>&nbsp;<span class="op" id="4317306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317309">s</span><span class="op" id="4317310">.</span><span class="ident" id="4317311">mutex</span><span class="op" id="4317316">.</span><span class="ident" id="4317317">Lock</span><span class="op" id="4317321">(</span><span class="op" id="4317322">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4317325">defer</span>&nbsp;<span class="ident" id="4317331">s</span><span class="op" id="4317332">.</span><span class="ident" id="4317333">mutex</span><span class="op" id="4317338">.</span><span class="ident" id="4317339">Unlock</span><span class="op" id="4317345">(</span><span class="op" id="4317346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4317349">if</span>&nbsp;<span class="ident" id="4317352">base</span>&nbsp;<span class="op" id="4317357">&lt;</span>&nbsp;<span class="num" id="4317359">0</span>&nbsp;<span class="op" id="4317361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317365">base</span>&nbsp;<span class="op" id="4317370">=</span>&nbsp;<span class="ident" id="4317372">s</span><span class="op" id="4317373">.</span><span class="ident" id="4317374">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4317380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4317383">if</span>&nbsp;<span class="ident" id="4317386">base</span>&nbsp;<span class="op" id="4317391">&lt;</span>&nbsp;<span class="ident" id="4317393">s</span><span class="op" id="4317394">.</span><span class="ident" id="4317395">base</span>&nbsp;<span class="op" id="4317400">||</span>&nbsp;<span class="ident" id="4317403">size</span>&nbsp;<span class="op" id="4317408">&lt;</span>&nbsp;<span class="num" id="4317410">0</span>&nbsp;<span class="op" id="4317412">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4317416">panic</span><span class="op" id="4317421">(</span><span class="string" id="4317422">&#34;illegal&nbsp;base&nbsp;or&nbsp;size&#34;</span><span class="op" id="4317444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4317447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4317450">//&nbsp;base&nbsp;&gt;=&nbsp;s.base&nbsp;&amp;&amp;&nbsp;size&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317482">f</span>&nbsp;<span class="op" id="4317484">:=</span>&nbsp;<span class="op" id="4317487">&amp;</span><span class="ident" id="4317488">File</span><span class="op" id="4317492">{</span><span class="ident" id="4317493">s</span><span class="op" id="4317494">,</span>&nbsp;<span class="ident" id="4317496">filename</span><span class="op" id="4317504">,</span>&nbsp;<span class="ident" id="4317506">base</span><span class="op" id="4317510">,</span>&nbsp;<span class="ident" id="4317512">size</span><span class="op" id="4317516">,</span>&nbsp;<span class="op" id="4317518">[</span><span class="op" id="4317519">]</span><span class="builtintype" id="4317520">int</span><span class="op" id="4317523">{</span><span class="num" id="4317524">0</span><span class="op" id="4317525">}</span><span class="op" id="4317526">,</span>&nbsp;<span class="ident" id="4317528">nil</span><span class="op" id="4317531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317534">base</span>&nbsp;<span class="op" id="4317539">+=</span>&nbsp;<span class="ident" id="4317542">size</span>&nbsp;<span class="op" id="4317547">+</span>&nbsp;<span class="num" id="4317549">1</span>&nbsp;<span class="comment" id="4317551">//&nbsp;+1&nbsp;because&nbsp;EOF&nbsp;also&nbsp;has&nbsp;a&nbsp;position</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4317590">if</span>&nbsp;<span class="ident" id="4317593">base</span>&nbsp;<span class="op" id="4317598">&lt;</span>&nbsp;<span class="num" id="4317600">0</span>&nbsp;<span class="op" id="4317602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4317606">panic</span><span class="op" id="4317611">(</span><span class="string" id="4317612">&#34;token.Pos&nbsp;offset&nbsp;overflow&nbsp;(&gt;&nbsp;2G&nbsp;of&nbsp;source&nbsp;code&nbsp;in&nbsp;file&nbsp;set)&#34;</span><span class="op" id="4317673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4317676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4317679">//&nbsp;add&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317712">s</span><span class="op" id="4317713">.</span><span class="ident" id="4317714">base</span>&nbsp;<span class="op" id="4317719">=</span>&nbsp;<span class="ident" id="4317721">base</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317727">s</span><span class="op" id="4317728">.</span><span class="ident" id="4317729">files</span>&nbsp;<span class="op" id="4317735">=</span>&nbsp;<span class="builtinfunc" id="4317737">append</span><span class="op" id="4317743">(</span><span class="ident" id="4317744">s</span><span class="op" id="4317745">.</span><span class="ident" id="4317746">files</span><span class="op" id="4317751">,</span>&nbsp;<span class="ident" id="4317753">f</span><span class="op" id="4317754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317757">s</span><span class="op" id="4317758">.</span><span class="ident" id="4317759">last</span>&nbsp;<span class="op" id="4317764">=</span>&nbsp;<span class="ident" id="4317766">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4317769">return</span>&nbsp;<span class="ident" id="4317776">f</span><br>
<span class="lineno"></span><span class="op" id="4317778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="4317781">//&nbsp;Iterate&nbsp;calls&nbsp;f&nbsp;for&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;file&nbsp;set&nbsp;in&nbsp;the&nbsp;order&nbsp;they&nbsp;were&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="4317859">//&nbsp;until&nbsp;f&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="4317885">//</span><br>
<span class="lineno"></span><span class="keyword" id="4317888">func</span>&nbsp;<span class="op" id="4317893">(</span><span class="ident" id="4317894">s</span>&nbsp;<span class="op" id="4317896">*</span><span class="ident" id="4317897">FileSet</span><span class="op" id="4317904">)</span>&nbsp;<span class="ident" id="4317906">Iterate</span><span class="op" id="4317913">(</span><span class="ident" id="4317914">f</span>&nbsp;<span class="keyword" id="4317916">func</span><span class="op" id="4317920">(</span><span class="op" id="4317921">*</span><span class="ident" id="4317922">File</span><span class="op" id="4317926">)</span>&nbsp;<span class="builtintype" id="4317928">bool</span><span class="op" id="4317932">)</span>&nbsp;<span class="op" id="4317934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4317937">for</span>&nbsp;<span class="ident" id="4317941">i</span>&nbsp;<span class="op" id="4317943">:=</span>&nbsp;<span class="num" id="4317946">0</span><span class="op" id="4317947">;</span>&nbsp;<span class="op" id="4317949">;</span>&nbsp;<span class="ident" id="4317951">i</span><span class="op" id="4317952">++</span>&nbsp;<span class="op" id="4317955">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4317959">var</span>&nbsp;<span class="ident" id="4317963">file</span>&nbsp;<span class="op" id="4317968">*</span><span class="ident" id="4317969">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317976">s</span><span class="op" id="4317977">.</span><span class="ident" id="4317978">mutex</span><span class="op" id="4317983">.</span><span class="ident" id="4317984">RLock</span><span class="op" id="4317989">(</span><span class="op" id="4317990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4317994">if</span>&nbsp;<span class="ident" id="4317997">i</span>&nbsp;<span class="op" id="4317999">&lt;</span>&nbsp;<span class="builtinfunc" id="4318001">len</span><span class="op" id="4318004">(</span><span class="ident" id="4318005">s</span><span class="op" id="4318006">.</span><span class="ident" id="4318007">files</span><span class="op" id="4318012">)</span>&nbsp;<span class="op" id="4318014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318019">file</span>&nbsp;<span class="op" id="4318024">=</span>&nbsp;<span class="ident" id="4318026">s</span><span class="op" id="4318027">.</span><span class="ident" id="4318028">files</span><span class="op" id="4318033">[</span><span class="ident" id="4318034">i</span><span class="op" id="4318035">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4318039">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318043">s</span><span class="op" id="4318044">.</span><span class="ident" id="4318045">mutex</span><span class="op" id="4318050">.</span><span class="ident" id="4318051">RUnlock</span><span class="op" id="4318058">(</span><span class="op" id="4318059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318063">if</span>&nbsp;<span class="ident" id="4318066">file</span>&nbsp;<span class="op" id="4318071">==</span>&nbsp;<span class="ident" id="4318074">nil</span>&nbsp;<span class="op" id="4318078">||</span>&nbsp;<span class="op" id="4318081">!</span><span class="ident" id="4318082">f</span><span class="op" id="4318083">(</span><span class="ident" id="4318084">file</span><span class="op" id="4318088">)</span>&nbsp;<span class="op" id="4318090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318095">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4318103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4318106">}</span><br>
<span class="lineno">400</span><span class="op" id="4318108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4318111">func</span>&nbsp;<span class="ident" id="4318116">searchFiles</span><span class="op" id="4318127">(</span><span class="ident" id="4318128">a</span>&nbsp;<span class="op" id="4318130">[</span><span class="op" id="4318131">]</span><span class="op" id="4318132">*</span><span class="ident" id="4318133">File</span><span class="op" id="4318137">,</span>&nbsp;<span class="ident" id="4318139">x</span>&nbsp;<span class="builtintype" id="4318141">int</span><span class="op" id="4318144">)</span>&nbsp;<span class="builtintype" id="4318146">int</span>&nbsp;<span class="op" id="4318150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318153">return</span>&nbsp;<span class="ident" id="4318160">sort</span><span class="op" id="4318164">.</span><span class="ident" id="4318165">Search</span><span class="op" id="4318171">(</span><span class="builtinfunc" id="4318172">len</span><span class="op" id="4318175">(</span><span class="ident" id="4318176">a</span><span class="op" id="4318177">)</span><span class="op" id="4318178">,</span>&nbsp;<span class="keyword" id="4318180">func</span><span class="op" id="4318184">(</span><span class="ident" id="4318185">i</span>&nbsp;<span class="builtintype" id="4318187">int</span><span class="op" id="4318190">)</span>&nbsp;<span class="builtintype" id="4318192">bool</span>&nbsp;<span class="op" id="4318197">{</span>&nbsp;<span class="keyword" id="4318199">return</span>&nbsp;<span class="ident" id="4318206">a</span><span class="op" id="4318207">[</span><span class="ident" id="4318208">i</span><span class="op" id="4318209">]</span><span class="op" id="4318210">.</span><span class="ident" id="4318211">base</span>&nbsp;<span class="op" id="4318216">&gt;</span>&nbsp;<span class="ident" id="4318218">x</span>&nbsp;<span class="op" id="4318220">}</span><span class="op" id="4318221">)</span>&nbsp;<span class="op" id="4318223">-</span>&nbsp;<span class="num" id="4318225">1</span><br>
<span class="lineno"></span><span class="op" id="4318227">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="4318230">func</span>&nbsp;<span class="op" id="4318235">(</span><span class="ident" id="4318236">s</span>&nbsp;<span class="op" id="4318238">*</span><span class="ident" id="4318239">FileSet</span><span class="op" id="4318246">)</span>&nbsp;<span class="ident" id="4318248">file</span><span class="op" id="4318252">(</span><span class="ident" id="4318253">p</span>&nbsp;<span class="ident" id="4318255">Pos</span><span class="op" id="4318258">)</span>&nbsp;<span class="op" id="4318260">*</span><span class="ident" id="4318261">File</span>&nbsp;<span class="op" id="4318266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318269">s</span><span class="op" id="4318270">.</span><span class="ident" id="4318271">mutex</span><span class="op" id="4318276">.</span><span class="ident" id="4318277">RLock</span><span class="op" id="4318282">(</span><span class="op" id="4318283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4318286">//&nbsp;common&nbsp;case:&nbsp;p&nbsp;is&nbsp;in&nbsp;last&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318321">if</span>&nbsp;<span class="ident" id="4318324">f</span>&nbsp;<span class="op" id="4318326">:=</span>&nbsp;<span class="ident" id="4318329">s</span><span class="op" id="4318330">.</span><span class="ident" id="4318331">last</span><span class="op" id="4318335">;</span>&nbsp;<span class="ident" id="4318337">f</span>&nbsp;<span class="op" id="4318339">!=</span>&nbsp;<span class="ident" id="4318342">nil</span>&nbsp;<span class="op" id="4318346">&amp;&amp;</span>&nbsp;<span class="ident" id="4318349">f</span><span class="op" id="4318350">.</span><span class="ident" id="4318351">base</span>&nbsp;<span class="op" id="4318356">&lt;=</span>&nbsp;<span class="builtintype" id="4318359">int</span><span class="op" id="4318362">(</span><span class="ident" id="4318363">p</span><span class="op" id="4318364">)</span>&nbsp;<span class="op" id="4318366">&amp;&amp;</span>&nbsp;<span class="builtintype" id="4318369">int</span><span class="op" id="4318372">(</span><span class="ident" id="4318373">p</span><span class="op" id="4318374">)</span>&nbsp;<span class="op" id="4318376">&lt;=</span>&nbsp;<span class="ident" id="4318379">f</span><span class="op" id="4318380">.</span><span class="ident" id="4318381">base</span><span class="op" id="4318385">+</span><span class="ident" id="4318386">f</span><span class="op" id="4318387">.</span><span class="ident" id="4318388">size</span>&nbsp;<span class="op" id="4318393">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318397">s</span><span class="op" id="4318398">.</span><span class="ident" id="4318399">mutex</span><span class="op" id="4318404">.</span><span class="ident" id="4318405">RUnlock</span><span class="op" id="4318412">(</span><span class="op" id="4318413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318417">return</span>&nbsp;<span class="ident" id="4318424">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4318427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4318430">//&nbsp;p&nbsp;is&nbsp;not&nbsp;in&nbsp;last&nbsp;file&nbsp;-&nbsp;search&nbsp;all&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318475">if</span>&nbsp;<span class="ident" id="4318478">i</span>&nbsp;<span class="op" id="4318480">:=</span>&nbsp;<span class="ident" id="4318483">searchFiles</span><span class="op" id="4318494">(</span><span class="ident" id="4318495">s</span><span class="op" id="4318496">.</span><span class="ident" id="4318497">files</span><span class="op" id="4318502">,</span>&nbsp;<span class="builtintype" id="4318504">int</span><span class="op" id="4318507">(</span><span class="ident" id="4318508">p</span><span class="op" id="4318509">)</span><span class="op" id="4318510">)</span><span class="op" id="4318511">;</span>&nbsp;<span class="ident" id="4318513">i</span>&nbsp;<span class="op" id="4318515">&gt;=</span>&nbsp;<span class="num" id="4318518">0</span>&nbsp;<span class="op" id="4318520">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318524">f</span>&nbsp;<span class="op" id="4318526">:=</span>&nbsp;<span class="ident" id="4318529">s</span><span class="op" id="4318530">.</span><span class="ident" id="4318531">files</span><span class="op" id="4318536">[</span><span class="ident" id="4318537">i</span><span class="op" id="4318538">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4318542">//&nbsp;f.base&nbsp;&lt;=&nbsp;int(p)&nbsp;by&nbsp;definition&nbsp;of&nbsp;searchFiles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318593">if</span>&nbsp;<span class="builtintype" id="4318596">int</span><span class="op" id="4318599">(</span><span class="ident" id="4318600">p</span><span class="op" id="4318601">)</span>&nbsp;<span class="op" id="4318603">&lt;=</span>&nbsp;<span class="ident" id="4318606">f</span><span class="op" id="4318607">.</span><span class="ident" id="4318608">base</span><span class="op" id="4318612">+</span><span class="ident" id="4318613">f</span><span class="op" id="4318614">.</span><span class="ident" id="4318615">size</span>&nbsp;<span class="op" id="4318620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318625">s</span><span class="op" id="4318626">.</span><span class="ident" id="4318627">mutex</span><span class="op" id="4318632">.</span><span class="ident" id="4318633">RUnlock</span><span class="op" id="4318640">(</span><span class="op" id="4318641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318646">s</span><span class="op" id="4318647">.</span><span class="ident" id="4318648">mutex</span><span class="op" id="4318653">.</span><span class="ident" id="4318654">Lock</span><span class="op" id="4318658">(</span><span class="op" id="4318659">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318664">s</span><span class="op" id="4318665">.</span><span class="ident" id="4318666">last</span>&nbsp;<span class="op" id="4318671">=</span>&nbsp;<span class="ident" id="4318673">f</span>&nbsp;<span class="comment" id="4318675">//&nbsp;race&nbsp;is&nbsp;ok&nbsp;-&nbsp;s.last&nbsp;is&nbsp;only&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318717">s</span><span class="op" id="4318718">.</span><span class="ident" id="4318719">mutex</span><span class="op" id="4318724">.</span><span class="ident" id="4318725">Unlock</span><span class="op" id="4318731">(</span><span class="op" id="4318732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318737">return</span>&nbsp;<span class="ident" id="4318744">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4318748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4318751">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318754">s</span><span class="op" id="4318755">.</span><span class="ident" id="4318756">mutex</span><span class="op" id="4318761">.</span><span class="ident" id="4318762">RUnlock</span><span class="op" id="4318769">(</span><span class="op" id="4318770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318773">return</span>&nbsp;<span class="ident" id="4318780">nil</span><br>
<span class="lineno"></span><span class="op" id="4318784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4318787">//&nbsp;File&nbsp;returns&nbsp;the&nbsp;file&nbsp;that&nbsp;contains&nbsp;the&nbsp;position&nbsp;p.</span><br>
<span class="lineno">430</span><span class="comment" id="4318842">//&nbsp;If&nbsp;no&nbsp;such&nbsp;file&nbsp;is&nbsp;found&nbsp;(for&nbsp;instance&nbsp;for&nbsp;p&nbsp;==&nbsp;NoPos),</span><br>
<span class="lineno"></span><span class="comment" id="4318901">//&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="4318923">//</span><br>
<span class="lineno"></span><span class="keyword" id="4318926">func</span>&nbsp;<span class="op" id="4318931">(</span><span class="ident" id="4318932">s</span>&nbsp;<span class="op" id="4318934">*</span><span class="ident" id="4318935">FileSet</span><span class="op" id="4318942">)</span>&nbsp;<span class="ident" id="4318944">File</span><span class="op" id="4318948">(</span><span class="ident" id="4318949">p</span>&nbsp;<span class="ident" id="4318951">Pos</span><span class="op" id="4318954">)</span>&nbsp;<span class="op" id="4318956">(</span><span class="ident" id="4318957">f</span>&nbsp;<span class="op" id="4318959">*</span><span class="ident" id="4318960">File</span><span class="op" id="4318964">)</span>&nbsp;<span class="op" id="4318966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318969">if</span>&nbsp;<span class="ident" id="4318972">p</span>&nbsp;<span class="op" id="4318974">!=</span>&nbsp;<span class="ident" id="4318977">NoPos</span>&nbsp;<span class="op" id="4318983">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318987">f</span>&nbsp;<span class="op" id="4318989">=</span>&nbsp;<span class="ident" id="4318991">s</span><span class="op" id="4318992">.</span><span class="ident" id="4318993">file</span><span class="op" id="4318997">(</span><span class="ident" id="4318998">p</span><span class="op" id="4318999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4319002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319005">return</span><br>
<span class="lineno"></span><span class="op" id="4319012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="4319015">//&nbsp;PositionFor&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4319085">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno"></span><span class="comment" id="4319158">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4319216">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;s&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="4319256">//</span><br>
<span class="lineno">445</span><span class="keyword" id="4319259">func</span>&nbsp;<span class="op" id="4319264">(</span><span class="ident" id="4319265">s</span>&nbsp;<span class="op" id="4319267">*</span><span class="ident" id="4319268">FileSet</span><span class="op" id="4319275">)</span>&nbsp;<span class="ident" id="4319277">PositionFor</span><span class="op" id="4319288">(</span><span class="ident" id="4319289">p</span>&nbsp;<span class="ident" id="4319291">Pos</span><span class="op" id="4319294">,</span>&nbsp;<span class="ident" id="4319296">adjusted</span>&nbsp;<span class="builtintype" id="4319305">bool</span><span class="op" id="4319309">)</span>&nbsp;<span class="op" id="4319311">(</span><span class="ident" id="4319312">pos</span>&nbsp;<span class="ident" id="4319316">Position</span><span class="op" id="4319324">)</span>&nbsp;<span class="op" id="4319326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319329">if</span>&nbsp;<span class="ident" id="4319332">p</span>&nbsp;<span class="op" id="4319334">!=</span>&nbsp;<span class="ident" id="4319337">NoPos</span>&nbsp;<span class="op" id="4319343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319347">if</span>&nbsp;<span class="ident" id="4319350">f</span>&nbsp;<span class="op" id="4319352">:=</span>&nbsp;<span class="ident" id="4319355">s</span><span class="op" id="4319356">.</span><span class="ident" id="4319357">file</span><span class="op" id="4319361">(</span><span class="ident" id="4319362">p</span><span class="op" id="4319363">)</span><span class="op" id="4319364">;</span>&nbsp;<span class="ident" id="4319366">f</span>&nbsp;<span class="op" id="4319368">!=</span>&nbsp;<span class="ident" id="4319371">nil</span>&nbsp;<span class="op" id="4319375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319380">pos</span>&nbsp;<span class="op" id="4319384">=</span>&nbsp;<span class="ident" id="4319386">f</span><span class="op" id="4319387">.</span><span class="ident" id="4319388">position</span><span class="op" id="4319396">(</span><span class="ident" id="4319397">p</span><span class="op" id="4319398">,</span>&nbsp;<span class="ident" id="4319400">adjusted</span><span class="op" id="4319408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4319412">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4319415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319418">return</span><br>
<span class="lineno"></span><span class="op" id="4319425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4319428">//&nbsp;Position&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno">455</span><span class="comment" id="4319495">//&nbsp;Calling&nbsp;s.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;s.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno"></span><span class="comment" id="4319569">//</span><br>
<span class="lineno"></span><span class="keyword" id="4319572">func</span>&nbsp;<span class="op" id="4319577">(</span><span class="ident" id="4319578">s</span>&nbsp;<span class="op" id="4319580">*</span><span class="ident" id="4319581">FileSet</span><span class="op" id="4319588">)</span>&nbsp;<span class="ident" id="4319590">Position</span><span class="op" id="4319598">(</span><span class="ident" id="4319599">p</span>&nbsp;<span class="ident" id="4319601">Pos</span><span class="op" id="4319604">)</span>&nbsp;<span class="op" id="4319606">(</span><span class="ident" id="4319607">pos</span>&nbsp;<span class="ident" id="4319611">Position</span><span class="op" id="4319619">)</span>&nbsp;<span class="op" id="4319621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319624">return</span>&nbsp;<span class="ident" id="4319631">s</span><span class="op" id="4319632">.</span><span class="ident" id="4319633">PositionFor</span><span class="op" id="4319644">(</span><span class="ident" id="4319645">p</span><span class="op" id="4319646">,</span>&nbsp;<span class="builtintype" id="4319648">true</span><span class="op" id="4319652">)</span><br>
<span class="lineno"></span><span class="op" id="4319654">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="4319657">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4319738">//&nbsp;Helper&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4319759">func</span>&nbsp;<span class="ident" id="4319764">searchInts</span><span class="op" id="4319774">(</span><span class="ident" id="4319775">a</span>&nbsp;<span class="op" id="4319777">[</span><span class="op" id="4319778">]</span><span class="builtintype" id="4319779">int</span><span class="op" id="4319782">,</span>&nbsp;<span class="ident" id="4319784">x</span>&nbsp;<span class="builtintype" id="4319786">int</span><span class="op" id="4319789">)</span>&nbsp;<span class="builtintype" id="4319791">int</span>&nbsp;<span class="op" id="4319795">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4319798">//&nbsp;This&nbsp;function&nbsp;body&nbsp;is&nbsp;a&nbsp;manually&nbsp;inlined&nbsp;version&nbsp;of:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4319855">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4319859">//&nbsp;&nbsp;&nbsp;return&nbsp;sort.Search(len(a),&nbsp;func(i&nbsp;int)&nbsp;bool&nbsp;{&nbsp;return&nbsp;a[i]&nbsp;&gt;&nbsp;x&nbsp;})&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4319934">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4319938">//&nbsp;With&nbsp;better&nbsp;compiler&nbsp;optimizations,&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;needed&nbsp;in&nbsp;the</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4320008">//&nbsp;future,&nbsp;but&nbsp;at&nbsp;the&nbsp;moment&nbsp;this&nbsp;change&nbsp;improves&nbsp;the&nbsp;go/printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4320074">//&nbsp;benchmark&nbsp;performance&nbsp;by&nbsp;~30%.&nbsp;This&nbsp;has&nbsp;a&nbsp;direct&nbsp;impact&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4320141">//&nbsp;speed&nbsp;of&nbsp;gofmt&nbsp;and&nbsp;thus&nbsp;seems&nbsp;worthwhile&nbsp;(2011-04-29).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4320200">//&nbsp;TODO(gri):&nbsp;Remove&nbsp;this&nbsp;when&nbsp;compilers&nbsp;have&nbsp;caught&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320258">i</span><span class="op" id="4320259">,</span>&nbsp;<span class="ident" id="4320261">j</span>&nbsp;<span class="op" id="4320263">:=</span>&nbsp;<span class="num" id="4320266">0</span><span class="op" id="4320267">,</span>&nbsp;<span class="builtinfunc" id="4320269">len</span><span class="op" id="4320272">(</span><span class="ident" id="4320273">a</span><span class="op" id="4320274">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4320277">for</span>&nbsp;<span class="ident" id="4320281">i</span>&nbsp;<span class="op" id="4320283">&lt;</span>&nbsp;<span class="ident" id="4320285">j</span>&nbsp;<span class="op" id="4320287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320291">h</span>&nbsp;<span class="op" id="4320293">:=</span>&nbsp;<span class="ident" id="4320296">i</span>&nbsp;<span class="op" id="4320298">+</span>&nbsp;<span class="op" id="4320300">(</span><span class="ident" id="4320301">j</span><span class="op" id="4320302">-</span><span class="ident" id="4320303">i</span><span class="op" id="4320304">)</span><span class="op" id="4320305">/</span><span class="num" id="4320306">2</span>&nbsp;<span class="comment" id="4320308">//&nbsp;avoid&nbsp;overflow&nbsp;when&nbsp;computing&nbsp;h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4320345">//&nbsp;i&nbsp;&nbsp;h&nbsp;&lt;&nbsp;j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4320362">if</span>&nbsp;<span class="ident" id="4320365">a</span><span class="op" id="4320366">[</span><span class="ident" id="4320367">h</span><span class="op" id="4320368">]</span>&nbsp;<span class="op" id="4320370">&lt;=</span>&nbsp;<span class="ident" id="4320373">x</span>&nbsp;<span class="op" id="4320375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320380">i</span>&nbsp;<span class="op" id="4320382">=</span>&nbsp;<span class="ident" id="4320384">h</span>&nbsp;<span class="op" id="4320386">+</span>&nbsp;<span class="num" id="4320388">1</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4320392">}</span>&nbsp;<span class="keyword" id="4320394">else</span>&nbsp;<span class="op" id="4320399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320404">j</span>&nbsp;<span class="op" id="4320406">=</span>&nbsp;<span class="ident" id="4320408">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4320412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4320415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4320418">return</span>&nbsp;<span class="ident" id="4320425">i</span>&nbsp;<span class="op" id="4320427">-</span>&nbsp;<span class="num" id="4320429">1</span><br>
<span class="lineno">485</span><span class="op" id="4320431">}</span>
</div>
</body>
</html>
