<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html" class="current">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6604495">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6604551">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6604605">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6604656">//&nbsp;+build&nbsp;!nacl,!plan9,!windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6604689">package</span>&nbsp;<span class="ident" id="6604697">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6604702">import</span>&nbsp;<span class="op" id="6604709">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6604712">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6604721">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6604727">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6604738">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6604749">&#34;syscall&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6604760">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6604771">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6604778">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6604781">func</span>&nbsp;<span class="ident" id="6604786">TestReadUnixgramWithUnnamedSocket</span><span class="op" id="6604819">(</span><span class="ident" id="6604820">t</span>&nbsp;<span class="op" id="6604822">*</span><span class="ident" id="6604823">testing</span><span class="op" id="6604830">.</span><span class="ident" id="6604831">T</span><span class="op" id="6604832">)</span>&nbsp;<span class="op" id="6604834">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6604837">addr</span>&nbsp;<span class="op" id="6604842">:=</span>&nbsp;<span class="ident" id="6604845">testUnixAddr</span><span class="op" id="6604857">(</span><span class="op" id="6604858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6604861">la</span><span class="op" id="6604863">,</span>&nbsp;<span class="ident" id="6604865">err</span>&nbsp;<span class="op" id="6604869">:=</span>&nbsp;<span class="ident" id="6604872">ResolveUnixAddr</span><span class="op" id="6604887">(</span><span class="string" id="6604888">&#34;unixgram&#34;</span><span class="op" id="6604898">,</span>&nbsp;<span class="ident" id="6604900">addr</span><span class="op" id="6604904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6604907">if</span>&nbsp;<span class="ident" id="6604910">err</span>&nbsp;<span class="op" id="6604914">!=</span>&nbsp;<span class="builtintype" id="6604917">nil</span>&nbsp;<span class="op" id="6604921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6604925">t</span><span class="op" id="6604926">.</span><span class="ident" id="6604927">Fatalf</span><span class="op" id="6604933">(</span><span class="string" id="6604934">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6604962">,</span>&nbsp;<span class="ident" id="6604964">err</span><span class="op" id="6604967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6604970">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6604973">c</span><span class="op" id="6604974">,</span>&nbsp;<span class="ident" id="6604976">err</span>&nbsp;<span class="op" id="6604980">:=</span>&nbsp;<span class="ident" id="6604983">ListenUnixgram</span><span class="op" id="6604997">(</span><span class="string" id="6604998">&#34;unixgram&#34;</span><span class="op" id="6605008">,</span>&nbsp;<span class="ident" id="6605010">la</span><span class="op" id="6605012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6605015">if</span>&nbsp;<span class="ident" id="6605018">err</span>&nbsp;<span class="op" id="6605022">!=</span>&nbsp;<span class="builtintype" id="6605025">nil</span>&nbsp;<span class="op" id="6605029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605033">t</span><span class="op" id="6605034">.</span><span class="ident" id="6605035">Fatalf</span><span class="op" id="6605041">(</span><span class="string" id="6605042">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6605069">,</span>&nbsp;<span class="ident" id="6605071">err</span><span class="op" id="6605074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6605077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6605080">defer</span>&nbsp;<span class="keyword" id="6605086">func</span><span class="op" id="6605090">(</span><span class="op" id="6605091">)</span>&nbsp;<span class="op" id="6605093">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605097">c</span><span class="op" id="6605098">.</span><span class="ident" id="6605099">Close</span><span class="op" id="6605104">(</span><span class="op" id="6605105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605109">os</span><span class="op" id="6605111">.</span><span class="ident" id="6605112">Remove</span><span class="op" id="6605118">(</span><span class="ident" id="6605119">addr</span><span class="op" id="6605123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6605126">}</span><span class="op" id="6605127">(</span><span class="op" id="6605128">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605132">off</span>&nbsp;<span class="op" id="6605136">:=</span>&nbsp;<span class="builtinfunc" id="6605139">make</span><span class="op" id="6605143">(</span><span class="keyword" id="6605144">chan</span>&nbsp;<span class="builtintype" id="6605149">bool</span><span class="op" id="6605153">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605156">data</span>&nbsp;<span class="op" id="6605161">:=</span>&nbsp;<span class="op" id="6605164">[</span><span class="num" id="6605165">5</span><span class="op" id="6605166">]</span><span class="builtintype" id="6605167">byte</span><span class="op" id="6605171">{</span><span class="num" id="6605172">1</span><span class="op" id="6605173">,</span>&nbsp;<span class="num" id="6605175">2</span><span class="op" id="6605176">,</span>&nbsp;<span class="num" id="6605178">3</span><span class="op" id="6605179">,</span>&nbsp;<span class="num" id="6605181">4</span><span class="op" id="6605182">,</span>&nbsp;<span class="num" id="6605184">5</span><span class="op" id="6605185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6605188">go</span>&nbsp;<span class="keyword" id="6605191">func</span><span class="op" id="6605195">(</span><span class="op" id="6605196">)</span>&nbsp;<span class="op" id="6605198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6605202">defer</span>&nbsp;<span class="keyword" id="6605208">func</span><span class="op" id="6605212">(</span><span class="op" id="6605213">)</span>&nbsp;<span class="op" id="6605215">{</span>&nbsp;<span class="ident" id="6605217">off</span>&nbsp;<span class="op" id="6605221">&lt;-</span>&nbsp;<span class="builtintype" id="6605224">true</span>&nbsp;<span class="op" id="6605229">}</span><span class="op" id="6605230">(</span><span class="op" id="6605231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605235">s</span><span class="op" id="6605236">,</span>&nbsp;<span class="ident" id="6605238">err</span>&nbsp;<span class="op" id="6605242">:=</span>&nbsp;<span class="ident" id="6605245">syscall</span><span class="op" id="6605252">.</span><span class="ident" id="6605253">Socket</span><span class="op" id="6605259">(</span><span class="ident" id="6605260">syscall</span><span class="op" id="6605267">.</span><span class="ident" id="6605268">AF_UNIX</span><span class="op" id="6605275">,</span>&nbsp;<span class="ident" id="6605277">syscall</span><span class="op" id="6605284">.</span><span class="ident" id="6605285">SOCK_DGRAM</span><span class="op" id="6605295">,</span>&nbsp;<span class="num" id="6605297">0</span><span class="op" id="6605298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6605302">if</span>&nbsp;<span class="ident" id="6605305">err</span>&nbsp;<span class="op" id="6605309">!=</span>&nbsp;<span class="builtintype" id="6605312">nil</span>&nbsp;<span class="op" id="6605316">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605321">t</span><span class="op" id="6605322">.</span><span class="ident" id="6605323">Errorf</span><span class="op" id="6605329">(</span><span class="string" id="6605330">&#34;syscall.Socket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6605357">,</span>&nbsp;<span class="ident" id="6605359">err</span><span class="op" id="6605362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6605367">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6605376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6605380">defer</span>&nbsp;<span class="ident" id="6605386">syscall</span><span class="op" id="6605393">.</span><span class="ident" id="6605394">Close</span><span class="op" id="6605399">(</span><span class="ident" id="6605400">s</span><span class="op" id="6605401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605405">rsa</span>&nbsp;<span class="op" id="6605409">:=</span>&nbsp;<span class="op" id="6605412">&amp;</span><span class="ident" id="6605413">syscall</span><span class="op" id="6605420">.</span><span class="ident" id="6605421">SockaddrUnix</span><span class="op" id="6605433">{</span><span class="ident" id="6605434">Name</span><span class="op" id="6605438">:</span>&nbsp;<span class="ident" id="6605440">addr</span><span class="op" id="6605444">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6605448">if</span>&nbsp;<span class="ident" id="6605451">err</span>&nbsp;<span class="op" id="6605455">:=</span>&nbsp;<span class="ident" id="6605458">syscall</span><span class="op" id="6605465">.</span><span class="ident" id="6605466">Sendto</span><span class="op" id="6605472">(</span><span class="ident" id="6605473">s</span><span class="op" id="6605474">,</span>&nbsp;<span class="ident" id="6605476">data</span><span class="op" id="6605480">[</span><span class="op" id="6605481">:</span><span class="op" id="6605482">]</span><span class="op" id="6605483">,</span>&nbsp;<span class="num" id="6605485">0</span><span class="op" id="6605486">,</span>&nbsp;<span class="ident" id="6605488">rsa</span><span class="op" id="6605491">)</span><span class="op" id="6605492">;</span>&nbsp;<span class="ident" id="6605494">err</span>&nbsp;<span class="op" id="6605498">!=</span>&nbsp;<span class="builtintype" id="6605501">nil</span>&nbsp;<span class="op" id="6605505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605510">t</span><span class="op" id="6605511">.</span><span class="ident" id="6605512">Errorf</span><span class="op" id="6605518">(</span><span class="string" id="6605519">&#34;syscall.Sendto&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6605546">,</span>&nbsp;<span class="ident" id="6605548">err</span><span class="op" id="6605551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6605556">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6605565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6605568">}</span><span class="op" id="6605569">(</span><span class="op" id="6605570">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6605574">&lt;-</span><span class="ident" id="6605576">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605581">b</span>&nbsp;<span class="op" id="6605583">:=</span>&nbsp;<span class="builtinfunc" id="6605586">make</span><span class="op" id="6605590">(</span><span class="op" id="6605591">[</span><span class="op" id="6605592">]</span><span class="builtintype" id="6605593">byte</span><span class="op" id="6605597">,</span>&nbsp;<span class="num" id="6605599">64</span><span class="op" id="6605601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605604">c</span><span class="op" id="6605605">.</span><span class="ident" id="6605606">SetReadDeadline</span><span class="op" id="6605621">(</span><span class="ident" id="6605622">time</span><span class="op" id="6605626">.</span><span class="ident" id="6605627">Now</span><span class="op" id="6605630">(</span><span class="op" id="6605631">)</span><span class="op" id="6605632">.</span><span class="ident" id="6605633">Add</span><span class="op" id="6605636">(</span><span class="num" id="6605637">100</span>&nbsp;<span class="op" id="6605641">*</span>&nbsp;<span class="ident" id="6605643">time</span><span class="op" id="6605647">.</span><span class="ident" id="6605648">Millisecond</span><span class="op" id="6605659">)</span><span class="op" id="6605660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605663">n</span><span class="op" id="6605664">,</span>&nbsp;<span class="ident" id="6605666">from</span><span class="op" id="6605670">,</span>&nbsp;<span class="ident" id="6605672">err</span>&nbsp;<span class="op" id="6605676">:=</span>&nbsp;<span class="ident" id="6605679">c</span><span class="op" id="6605680">.</span><span class="ident" id="6605681">ReadFrom</span><span class="op" id="6605689">(</span><span class="ident" id="6605690">b</span><span class="op" id="6605691">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6605694">if</span>&nbsp;<span class="ident" id="6605697">err</span>&nbsp;<span class="op" id="6605701">!=</span>&nbsp;<span class="builtintype" id="6605704">nil</span>&nbsp;<span class="op" id="6605708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605712">t</span><span class="op" id="6605713">.</span><span class="ident" id="6605714">Fatalf</span><span class="op" id="6605720">(</span><span class="string" id="6605721">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6605751">,</span>&nbsp;<span class="ident" id="6605753">err</span><span class="op" id="6605756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6605759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6605762">if</span>&nbsp;<span class="ident" id="6605765">from</span>&nbsp;<span class="op" id="6605770">!=</span>&nbsp;<span class="builtintype" id="6605773">nil</span>&nbsp;<span class="op" id="6605777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605781">t</span><span class="op" id="6605782">.</span><span class="ident" id="6605783">Fatalf</span><span class="op" id="6605789">(</span><span class="string" id="6605790">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="6605814">,</span>&nbsp;<span class="ident" id="6605816">from</span><span class="op" id="6605820">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6605823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6605826">if</span>&nbsp;<span class="op" id="6605829">!</span><span class="ident" id="6605830">bytes</span><span class="op" id="6605835">.</span><span class="ident" id="6605836">Equal</span><span class="op" id="6605841">(</span><span class="ident" id="6605842">b</span><span class="op" id="6605843">[</span><span class="op" id="6605844">:</span><span class="ident" id="6605845">n</span><span class="op" id="6605846">]</span><span class="op" id="6605847">,</span>&nbsp;<span class="ident" id="6605849">data</span><span class="op" id="6605853">[</span><span class="op" id="6605854">:</span><span class="op" id="6605855">]</span><span class="op" id="6605856">)</span>&nbsp;<span class="op" id="6605858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6605862">t</span><span class="op" id="6605863">.</span><span class="ident" id="6605864">Fatalf</span><span class="op" id="6605870">(</span><span class="string" id="6605871">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6605888">,</span>&nbsp;<span class="ident" id="6605890">b</span><span class="op" id="6605891">[</span><span class="op" id="6605892">:</span><span class="ident" id="6605893">n</span><span class="op" id="6605894">]</span><span class="op" id="6605895">,</span>&nbsp;<span class="ident" id="6605897">data</span><span class="op" id="6605901">[</span><span class="op" id="6605902">:</span><span class="op" id="6605903">]</span><span class="op" id="6605904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6605907">}</span><br>
<span class="lineno"></span><span class="op" id="6605909">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="6605912">func</span>&nbsp;<span class="ident" id="6605917">TestReadUnixgramWithZeroBytesBuffer</span><span class="op" id="6605952">(</span><span class="ident" id="6605953">t</span>&nbsp;<span class="op" id="6605955">*</span><span class="ident" id="6605956">testing</span><span class="op" id="6605963">.</span><span class="ident" id="6605964">T</span><span class="op" id="6605965">)</span>&nbsp;<span class="op" id="6605967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6605970">//&nbsp;issue&nbsp;4352:&nbsp;Recvfrom&nbsp;failed&nbsp;with&nbsp;&#34;address&nbsp;family&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6606027">//&nbsp;supported&nbsp;by&nbsp;protocol&nbsp;family&#34;&nbsp;if&nbsp;zero-length&nbsp;buffer&nbsp;provided</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606093">addr</span>&nbsp;<span class="op" id="6606098">:=</span>&nbsp;<span class="ident" id="6606101">testUnixAddr</span><span class="op" id="6606113">(</span><span class="op" id="6606114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606117">la</span><span class="op" id="6606119">,</span>&nbsp;<span class="ident" id="6606121">err</span>&nbsp;<span class="op" id="6606125">:=</span>&nbsp;<span class="ident" id="6606128">ResolveUnixAddr</span><span class="op" id="6606143">(</span><span class="string" id="6606144">&#34;unixgram&#34;</span><span class="op" id="6606154">,</span>&nbsp;<span class="ident" id="6606156">addr</span><span class="op" id="6606160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6606163">if</span>&nbsp;<span class="ident" id="6606166">err</span>&nbsp;<span class="op" id="6606170">!=</span>&nbsp;<span class="builtintype" id="6606173">nil</span>&nbsp;<span class="op" id="6606177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606181">t</span><span class="op" id="6606182">.</span><span class="ident" id="6606183">Fatalf</span><span class="op" id="6606189">(</span><span class="string" id="6606190">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6606218">,</span>&nbsp;<span class="ident" id="6606220">err</span><span class="op" id="6606223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6606226">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606229">c</span><span class="op" id="6606230">,</span>&nbsp;<span class="ident" id="6606232">err</span>&nbsp;<span class="op" id="6606236">:=</span>&nbsp;<span class="ident" id="6606239">ListenUnixgram</span><span class="op" id="6606253">(</span><span class="string" id="6606254">&#34;unixgram&#34;</span><span class="op" id="6606264">,</span>&nbsp;<span class="ident" id="6606266">la</span><span class="op" id="6606268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6606271">if</span>&nbsp;<span class="ident" id="6606274">err</span>&nbsp;<span class="op" id="6606278">!=</span>&nbsp;<span class="builtintype" id="6606281">nil</span>&nbsp;<span class="op" id="6606285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606289">t</span><span class="op" id="6606290">.</span><span class="ident" id="6606291">Fatalf</span><span class="op" id="6606297">(</span><span class="string" id="6606298">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6606325">,</span>&nbsp;<span class="ident" id="6606327">err</span><span class="op" id="6606330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6606333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6606336">defer</span>&nbsp;<span class="keyword" id="6606342">func</span><span class="op" id="6606346">(</span><span class="op" id="6606347">)</span>&nbsp;<span class="op" id="6606349">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606353">c</span><span class="op" id="6606354">.</span><span class="ident" id="6606355">Close</span><span class="op" id="6606360">(</span><span class="op" id="6606361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606365">os</span><span class="op" id="6606367">.</span><span class="ident" id="6606368">Remove</span><span class="op" id="6606374">(</span><span class="ident" id="6606375">addr</span><span class="op" id="6606379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6606382">}</span><span class="op" id="6606383">(</span><span class="op" id="6606384">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606388">off</span>&nbsp;<span class="op" id="6606392">:=</span>&nbsp;<span class="builtinfunc" id="6606395">make</span><span class="op" id="6606399">(</span><span class="keyword" id="6606400">chan</span>&nbsp;<span class="builtintype" id="6606405">bool</span><span class="op" id="6606409">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6606412">go</span>&nbsp;<span class="keyword" id="6606415">func</span><span class="op" id="6606419">(</span><span class="op" id="6606420">)</span>&nbsp;<span class="op" id="6606422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6606426">defer</span>&nbsp;<span class="keyword" id="6606432">func</span><span class="op" id="6606436">(</span><span class="op" id="6606437">)</span>&nbsp;<span class="op" id="6606439">{</span>&nbsp;<span class="ident" id="6606441">off</span>&nbsp;<span class="op" id="6606445">&lt;-</span>&nbsp;<span class="builtintype" id="6606448">true</span>&nbsp;<span class="op" id="6606453">}</span><span class="op" id="6606454">(</span><span class="op" id="6606455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606459">c</span><span class="op" id="6606460">,</span>&nbsp;<span class="ident" id="6606462">err</span>&nbsp;<span class="op" id="6606466">:=</span>&nbsp;<span class="ident" id="6606469">DialUnix</span><span class="op" id="6606477">(</span><span class="string" id="6606478">&#34;unixgram&#34;</span><span class="op" id="6606488">,</span>&nbsp;<span class="builtintype" id="6606490">nil</span><span class="op" id="6606493">,</span>&nbsp;<span class="ident" id="6606495">la</span><span class="op" id="6606497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6606501">if</span>&nbsp;<span class="ident" id="6606504">err</span>&nbsp;<span class="op" id="6606508">!=</span>&nbsp;<span class="builtintype" id="6606511">nil</span>&nbsp;<span class="op" id="6606515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606520">t</span><span class="op" id="6606521">.</span><span class="ident" id="6606522">Errorf</span><span class="op" id="6606528">(</span><span class="string" id="6606529">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6606550">,</span>&nbsp;<span class="ident" id="6606552">err</span><span class="op" id="6606555">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6606560">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6606569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6606573">defer</span>&nbsp;<span class="ident" id="6606579">c</span><span class="op" id="6606580">.</span><span class="ident" id="6606581">Close</span><span class="op" id="6606586">(</span><span class="op" id="6606587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6606591">if</span>&nbsp;<span class="ident" id="6606594">_</span><span class="op" id="6606595">,</span>&nbsp;<span class="ident" id="6606597">err</span>&nbsp;<span class="op" id="6606601">:=</span>&nbsp;<span class="ident" id="6606604">c</span><span class="op" id="6606605">.</span><span class="ident" id="6606606">Write</span><span class="op" id="6606611">(</span><span class="op" id="6606612">[</span><span class="op" id="6606613">]</span><span class="builtintype" id="6606614">byte</span><span class="op" id="6606618">{</span><span class="num" id="6606619">1</span><span class="op" id="6606620">,</span>&nbsp;<span class="num" id="6606622">2</span><span class="op" id="6606623">,</span>&nbsp;<span class="num" id="6606625">3</span><span class="op" id="6606626">,</span>&nbsp;<span class="num" id="6606628">4</span><span class="op" id="6606629">,</span>&nbsp;<span class="num" id="6606631">5</span><span class="op" id="6606632">}</span><span class="op" id="6606633">)</span><span class="op" id="6606634">;</span>&nbsp;<span class="ident" id="6606636">err</span>&nbsp;<span class="op" id="6606640">!=</span>&nbsp;<span class="builtintype" id="6606643">nil</span>&nbsp;<span class="op" id="6606647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606652">t</span><span class="op" id="6606653">.</span><span class="ident" id="6606654">Errorf</span><span class="op" id="6606660">(</span><span class="string" id="6606661">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6606688">,</span>&nbsp;<span class="ident" id="6606690">err</span><span class="op" id="6606693">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6606698">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6606707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6606710">}</span><span class="op" id="6606711">(</span><span class="op" id="6606712">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6606716">&lt;-</span><span class="ident" id="6606718">off</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606723">c</span><span class="op" id="6606724">.</span><span class="ident" id="6606725">SetReadDeadline</span><span class="op" id="6606740">(</span><span class="ident" id="6606741">time</span><span class="op" id="6606745">.</span><span class="ident" id="6606746">Now</span><span class="op" id="6606749">(</span><span class="op" id="6606750">)</span><span class="op" id="6606751">.</span><span class="ident" id="6606752">Add</span><span class="op" id="6606755">(</span><span class="num" id="6606756">100</span>&nbsp;<span class="op" id="6606760">*</span>&nbsp;<span class="ident" id="6606762">time</span><span class="op" id="6606766">.</span><span class="ident" id="6606767">Millisecond</span><span class="op" id="6606778">)</span><span class="op" id="6606779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606782">_</span><span class="op" id="6606783">,</span>&nbsp;<span class="ident" id="6606785">from</span><span class="op" id="6606789">,</span>&nbsp;<span class="ident" id="6606791">err</span>&nbsp;<span class="op" id="6606795">:=</span>&nbsp;<span class="ident" id="6606798">c</span><span class="op" id="6606799">.</span><span class="ident" id="6606800">ReadFrom</span><span class="op" id="6606808">(</span><span class="builtintype" id="6606809">nil</span><span class="op" id="6606812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6606815">if</span>&nbsp;<span class="ident" id="6606818">err</span>&nbsp;<span class="op" id="6606822">!=</span>&nbsp;<span class="builtintype" id="6606825">nil</span>&nbsp;<span class="op" id="6606829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606833">t</span><span class="op" id="6606834">.</span><span class="ident" id="6606835">Fatalf</span><span class="op" id="6606841">(</span><span class="string" id="6606842">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6606872">,</span>&nbsp;<span class="ident" id="6606874">err</span><span class="op" id="6606877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6606880">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6606883">if</span>&nbsp;<span class="ident" id="6606886">from</span>&nbsp;<span class="op" id="6606891">!=</span>&nbsp;<span class="builtintype" id="6606894">nil</span>&nbsp;<span class="op" id="6606898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606902">t</span><span class="op" id="6606903">.</span><span class="ident" id="6606904">Fatalf</span><span class="op" id="6606910">(</span><span class="string" id="6606911">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="6606935">,</span>&nbsp;<span class="ident" id="6606937">from</span><span class="op" id="6606941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6606944">}</span><br>
<span class="lineno"></span><span class="op" id="6606946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6606949">func</span>&nbsp;<span class="ident" id="6606954">TestUnixgramAutobind</span><span class="op" id="6606974">(</span><span class="ident" id="6606975">t</span>&nbsp;<span class="op" id="6606977">*</span><span class="ident" id="6606978">testing</span><span class="op" id="6606985">.</span><span class="ident" id="6606986">T</span><span class="op" id="6606987">)</span>&nbsp;<span class="op" id="6606989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6606992">if</span>&nbsp;<span class="ident" id="6606995">runtime</span><span class="op" id="6607002">.</span><span class="ident" id="6607003">GOOS</span>&nbsp;<span class="op" id="6607008">!=</span>&nbsp;<span class="string" id="6607011">&#34;linux&#34;</span>&nbsp;<span class="op" id="6607019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6607023">t</span><span class="op" id="6607024">.</span><span class="ident" id="6607025">Skip</span><span class="op" id="6607029">(</span><span class="string" id="6607030">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="6607064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6607067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6607071">laddr</span>&nbsp;<span class="op" id="6607077">:=</span>&nbsp;<span class="op" id="6607080">&amp;</span><span class="ident" id="6607081">UnixAddr</span><span class="op" id="6607089">{</span><span class="ident" id="6607090">Name</span><span class="op" id="6607094">:</span>&nbsp;<span class="string" id="6607096">&#34;&#34;</span><span class="op" id="6607098">,</span>&nbsp;<span class="ident" id="6607100">Net</span><span class="op" id="6607103">:</span>&nbsp;<span class="string" id="6607105">&#34;unixgram&#34;</span><span class="op" id="6607115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6607118">c1</span><span class="op" id="6607120">,</span>&nbsp;<span class="ident" id="6607122">err</span>&nbsp;<span class="op" id="6607126">:=</span>&nbsp;<span class="ident" id="6607129">ListenUnixgram</span><span class="op" id="6607143">(</span><span class="string" id="6607144">&#34;unixgram&#34;</span><span class="op" id="6607154">,</span>&nbsp;<span class="ident" id="6607156">laddr</span><span class="op" id="6607161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6607164">if</span>&nbsp;<span class="ident" id="6607167">err</span>&nbsp;<span class="op" id="6607171">!=</span>&nbsp;<span class="builtintype" id="6607174">nil</span>&nbsp;<span class="op" id="6607178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6607182">t</span><span class="op" id="6607183">.</span><span class="ident" id="6607184">Fatalf</span><span class="op" id="6607190">(</span><span class="string" id="6607191">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6607218">,</span>&nbsp;<span class="ident" id="6607220">err</span><span class="op" id="6607223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6607226">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6607229">defer</span>&nbsp;<span class="ident" id="6607235">c1</span><span class="op" id="6607237">.</span><span class="ident" id="6607238">Close</span><span class="op" id="6607243">(</span><span class="op" id="6607244">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6607248">//&nbsp;retrieve&nbsp;the&nbsp;autobind&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6607282">autoAddr</span>&nbsp;<span class="op" id="6607291">:=</span>&nbsp;<span class="ident" id="6607294">c1</span><span class="op" id="6607296">.</span><span class="ident" id="6607297">LocalAddr</span><span class="op" id="6607306">(</span><span class="op" id="6607307">)</span><span class="op" id="6607308">.</span><span class="op" id="6607309">(</span><span class="op" id="6607310">*</span><span class="ident" id="6607311">UnixAddr</span><span class="op" id="6607319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6607322">if</span>&nbsp;<span class="builtinfunc" id="6607325">len</span><span class="op" id="6607328">(</span><span class="ident" id="6607329">autoAddr</span><span class="op" id="6607337">.</span><span class="ident" id="6607338">Name</span><span class="op" id="6607342">)</span>&nbsp;<span class="op" id="6607344">&lt;=</span>&nbsp;<span class="num" id="6607347">1</span>&nbsp;<span class="op" id="6607349">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6607353">t</span><span class="op" id="6607354">.</span><span class="ident" id="6607355">Fatalf</span><span class="op" id="6607361">(</span><span class="string" id="6607362">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="6607392">,</span>&nbsp;<span class="ident" id="6607394">autoAddr</span><span class="op" id="6607402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6607405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6607408">if</span>&nbsp;<span class="ident" id="6607411">autoAddr</span><span class="op" id="6607419">.</span><span class="ident" id="6607420">Name</span><span class="op" id="6607424">[</span><span class="num" id="6607425">0</span><span class="op" id="6607426">]</span>&nbsp;<span class="op" id="6607428">!=</span>&nbsp;<span class="string" id="6607431">&#39;@&#39;</span>&nbsp;<span class="op" id="6607435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6607439">t</span><span class="op" id="6607440">.</span><span class="ident" id="6607441">Fatalf</span><span class="op" id="6607447">(</span><span class="string" id="6607448">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="6607478">,</span>&nbsp;<span class="ident" id="6607480">autoAddr</span><span class="op" id="6607488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6607491">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6607495">c2</span><span class="op" id="6607497">,</span>&nbsp;<span class="ident" id="6607499">err</span>&nbsp;<span class="op" id="6607503">:=</span>&nbsp;<span class="ident" id="6607506">DialUnix</span><span class="op" id="6607514">(</span><span class="string" id="6607515">&#34;unixgram&#34;</span><span class="op" id="6607525">,</span>&nbsp;<span class="builtintype" id="6607527">nil</span><span class="op" id="6607530">,</span>&nbsp;<span class="ident" id="6607532">autoAddr</span><span class="op" id="6607540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6607543">if</span>&nbsp;<span class="ident" id="6607546">err</span>&nbsp;<span class="op" id="6607550">!=</span>&nbsp;<span class="builtintype" id="6607553">nil</span>&nbsp;<span class="op" id="6607557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6607561">t</span><span class="op" id="6607562">.</span><span class="ident" id="6607563">Fatalf</span><span class="op" id="6607569">(</span><span class="string" id="6607570">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6607591">,</span>&nbsp;<span class="ident" id="6607593">err</span><span class="op" id="6607596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6607599">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6607602">defer</span>&nbsp;<span class="ident" id="6607608">c2</span><span class="op" id="6607610">.</span><span class="ident" id="6607611">Close</span><span class="op" id="6607616">(</span><span class="op" id="6607617">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6607621">if</span>&nbsp;<span class="op" id="6607624">!</span><span class="ident" id="6607625">reflect</span><span class="op" id="6607632">.</span><span class="ident" id="6607633">DeepEqual</span><span class="op" id="6607642">(</span><span class="ident" id="6607643">c1</span><span class="op" id="6607645">.</span><span class="ident" id="6607646">LocalAddr</span><span class="op" id="6607655">(</span><span class="op" id="6607656">)</span><span class="op" id="6607657">,</span>&nbsp;<span class="ident" id="6607659">c2</span><span class="op" id="6607661">.</span><span class="ident" id="6607662">RemoteAddr</span><span class="op" id="6607672">(</span><span class="op" id="6607673">)</span><span class="op" id="6607674">)</span>&nbsp;<span class="op" id="6607676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6607680">t</span><span class="op" id="6607681">.</span><span class="ident" id="6607682">Fatalf</span><span class="op" id="6607688">(</span><span class="string" id="6607689">&#34;expected&nbsp;autobind&nbsp;address&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6607727">,</span>&nbsp;<span class="ident" id="6607729">c1</span><span class="op" id="6607731">.</span><span class="ident" id="6607732">LocalAddr</span><span class="op" id="6607741">(</span><span class="op" id="6607742">)</span><span class="op" id="6607743">,</span>&nbsp;<span class="ident" id="6607745">c2</span><span class="op" id="6607747">.</span><span class="ident" id="6607748">RemoteAddr</span><span class="op" id="6607758">(</span><span class="op" id="6607759">)</span><span class="op" id="6607760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6607763">}</span><br>
<span class="lineno">140</span><span class="op" id="6607765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6607768">func</span>&nbsp;<span class="ident" id="6607773">TestUnixAutobindClose</span><span class="op" id="6607794">(</span><span class="ident" id="6607795">t</span>&nbsp;<span class="op" id="6607797">*</span><span class="ident" id="6607798">testing</span><span class="op" id="6607805">.</span><span class="ident" id="6607806">T</span><span class="op" id="6607807">)</span>&nbsp;<span class="op" id="6607809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6607812">if</span>&nbsp;<span class="ident" id="6607815">runtime</span><span class="op" id="6607822">.</span><span class="ident" id="6607823">GOOS</span>&nbsp;<span class="op" id="6607828">!=</span>&nbsp;<span class="string" id="6607831">&#34;linux&#34;</span>&nbsp;<span class="op" id="6607839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6607843">t</span><span class="op" id="6607844">.</span><span class="ident" id="6607845">Skip</span><span class="op" id="6607849">(</span><span class="string" id="6607850">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="6607884">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6607887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6607890">laddr</span>&nbsp;<span class="op" id="6607896">:=</span>&nbsp;<span class="op" id="6607899">&amp;</span><span class="ident" id="6607900">UnixAddr</span><span class="op" id="6607908">{</span><span class="ident" id="6607909">Name</span><span class="op" id="6607913">:</span>&nbsp;<span class="string" id="6607915">&#34;&#34;</span><span class="op" id="6607917">,</span>&nbsp;<span class="ident" id="6607919">Net</span><span class="op" id="6607922">:</span>&nbsp;<span class="string" id="6607924">&#34;unix&#34;</span><span class="op" id="6607930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6607933">ln</span><span class="op" id="6607935">,</span>&nbsp;<span class="ident" id="6607937">err</span>&nbsp;<span class="op" id="6607941">:=</span>&nbsp;<span class="ident" id="6607944">ListenUnix</span><span class="op" id="6607954">(</span><span class="string" id="6607955">&#34;unix&#34;</span><span class="op" id="6607961">,</span>&nbsp;<span class="ident" id="6607963">laddr</span><span class="op" id="6607968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6607971">if</span>&nbsp;<span class="ident" id="6607974">err</span>&nbsp;<span class="op" id="6607978">!=</span>&nbsp;<span class="builtintype" id="6607981">nil</span>&nbsp;<span class="op" id="6607985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6607989">t</span><span class="op" id="6607990">.</span><span class="ident" id="6607991">Fatalf</span><span class="op" id="6607997">(</span><span class="string" id="6607998">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6608021">,</span>&nbsp;<span class="ident" id="6608023">err</span><span class="op" id="6608026">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6608029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6608032">ln</span><span class="op" id="6608034">.</span><span class="ident" id="6608035">Close</span><span class="op" id="6608040">(</span><span class="op" id="6608041">)</span><br>
<span class="lineno"></span><span class="op" id="6608043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6608046">func</span>&nbsp;<span class="ident" id="6608051">TestUnixgramWrite</span><span class="op" id="6608068">(</span><span class="ident" id="6608069">t</span>&nbsp;<span class="op" id="6608071">*</span><span class="ident" id="6608072">testing</span><span class="op" id="6608079">.</span><span class="ident" id="6608080">T</span><span class="op" id="6608081">)</span>&nbsp;<span class="op" id="6608083">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6608086">addr</span>&nbsp;<span class="op" id="6608091">:=</span>&nbsp;<span class="ident" id="6608094">testUnixAddr</span><span class="op" id="6608106">(</span><span class="op" id="6608107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6608110">laddr</span><span class="op" id="6608115">,</span>&nbsp;<span class="ident" id="6608117">err</span>&nbsp;<span class="op" id="6608121">:=</span>&nbsp;<span class="ident" id="6608124">ResolveUnixAddr</span><span class="op" id="6608139">(</span><span class="string" id="6608140">&#34;unixgram&#34;</span><span class="op" id="6608150">,</span>&nbsp;<span class="ident" id="6608152">addr</span><span class="op" id="6608156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6608159">if</span>&nbsp;<span class="ident" id="6608162">err</span>&nbsp;<span class="op" id="6608166">!=</span>&nbsp;<span class="builtintype" id="6608169">nil</span>&nbsp;<span class="op" id="6608173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6608177">t</span><span class="op" id="6608178">.</span><span class="ident" id="6608179">Fatalf</span><span class="op" id="6608185">(</span><span class="string" id="6608186">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6608214">,</span>&nbsp;<span class="ident" id="6608216">err</span><span class="op" id="6608219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6608222">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6608225">c</span><span class="op" id="6608226">,</span>&nbsp;<span class="ident" id="6608228">err</span>&nbsp;<span class="op" id="6608232">:=</span>&nbsp;<span class="ident" id="6608235">ListenPacket</span><span class="op" id="6608247">(</span><span class="string" id="6608248">&#34;unixgram&#34;</span><span class="op" id="6608258">,</span>&nbsp;<span class="ident" id="6608260">addr</span><span class="op" id="6608264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6608267">if</span>&nbsp;<span class="ident" id="6608270">err</span>&nbsp;<span class="op" id="6608274">!=</span>&nbsp;<span class="builtintype" id="6608277">nil</span>&nbsp;<span class="op" id="6608281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6608285">t</span><span class="op" id="6608286">.</span><span class="ident" id="6608287">Fatalf</span><span class="op" id="6608293">(</span><span class="string" id="6608294">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6608319">,</span>&nbsp;<span class="ident" id="6608321">err</span><span class="op" id="6608324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6608327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6608330">defer</span>&nbsp;<span class="ident" id="6608336">os</span><span class="op" id="6608338">.</span><span class="ident" id="6608339">Remove</span><span class="op" id="6608345">(</span><span class="ident" id="6608346">addr</span><span class="op" id="6608350">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6608353">defer</span>&nbsp;<span class="ident" id="6608359">c</span><span class="op" id="6608360">.</span><span class="ident" id="6608361">Close</span><span class="op" id="6608366">(</span><span class="op" id="6608367">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6608371">testUnixgramWriteConn</span><span class="op" id="6608392">(</span><span class="ident" id="6608393">t</span><span class="op" id="6608394">,</span>&nbsp;<span class="ident" id="6608396">laddr</span><span class="op" id="6608401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6608404">testUnixgramWritePacketConn</span><span class="op" id="6608431">(</span><span class="ident" id="6608432">t</span><span class="op" id="6608433">,</span>&nbsp;<span class="ident" id="6608435">laddr</span><span class="op" id="6608440">)</span><br>
<span class="lineno"></span><span class="op" id="6608442">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6608445">func</span>&nbsp;<span class="ident" id="6608450">testUnixgramWriteConn</span><span class="op" id="6608471">(</span><span class="ident" id="6608472">t</span>&nbsp;<span class="op" id="6608474">*</span><span class="ident" id="6608475">testing</span><span class="op" id="6608482">.</span><span class="ident" id="6608483">T</span><span class="op" id="6608484">,</span>&nbsp;<span class="ident" id="6608486">raddr</span>&nbsp;<span class="op" id="6608492">*</span><span class="ident" id="6608493">UnixAddr</span><span class="op" id="6608501">)</span>&nbsp;<span class="op" id="6608503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6608506">c</span><span class="op" id="6608507">,</span>&nbsp;<span class="ident" id="6608509">err</span>&nbsp;<span class="op" id="6608513">:=</span>&nbsp;<span class="ident" id="6608516">Dial</span><span class="op" id="6608520">(</span><span class="string" id="6608521">&#34;unixgram&#34;</span><span class="op" id="6608531">,</span>&nbsp;<span class="ident" id="6608533">raddr</span><span class="op" id="6608538">.</span><span class="ident" id="6608539">String</span><span class="op" id="6608545">(</span><span class="op" id="6608546">)</span><span class="op" id="6608547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6608550">if</span>&nbsp;<span class="ident" id="6608553">err</span>&nbsp;<span class="op" id="6608557">!=</span>&nbsp;<span class="builtintype" id="6608560">nil</span>&nbsp;<span class="op" id="6608564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6608568">t</span><span class="op" id="6608569">.</span><span class="ident" id="6608570">Fatalf</span><span class="op" id="6608576">(</span><span class="string" id="6608577">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6608594">,</span>&nbsp;<span class="ident" id="6608596">err</span><span class="op" id="6608599">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6608602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6608605">defer</span>&nbsp;<span class="ident" id="6608611">c</span><span class="op" id="6608612">.</span><span class="ident" id="6608613">Close</span><span class="op" id="6608618">(</span><span class="op" id="6608619">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6608623">if</span>&nbsp;<span class="ident" id="6608626">_</span><span class="op" id="6608627">,</span>&nbsp;<span class="ident" id="6608629">err</span>&nbsp;<span class="op" id="6608633">:=</span>&nbsp;<span class="ident" id="6608636">c</span><span class="op" id="6608637">.</span><span class="op" id="6608638">(</span><span class="op" id="6608639">*</span><span class="ident" id="6608640">UnixConn</span><span class="op" id="6608648">)</span><span class="op" id="6608649">.</span><span class="ident" id="6608650">WriteToUnix</span><span class="op" id="6608661">(</span><span class="op" id="6608662">[</span><span class="op" id="6608663">]</span><span class="builtintype" id="6608664">byte</span><span class="op" id="6608668">(</span><span class="string" id="6608669">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6608702">)</span><span class="op" id="6608703">,</span>&nbsp;<span class="ident" id="6608705">raddr</span><span class="op" id="6608710">)</span><span class="op" id="6608711">;</span>&nbsp;<span class="ident" id="6608713">err</span>&nbsp;<span class="op" id="6608717">==</span>&nbsp;<span class="builtintype" id="6608720">nil</span>&nbsp;<span class="op" id="6608724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6608728">t</span><span class="op" id="6608729">.</span><span class="ident" id="6608730">Fatal</span><span class="op" id="6608735">(</span><span class="string" id="6608736">&#34;WriteToUnix&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6608761">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6608764">}</span>&nbsp;<span class="keyword" id="6608766">else</span>&nbsp;<span class="keyword" id="6608771">if</span>&nbsp;<span class="ident" id="6608774">err</span><span class="op" id="6608777">.</span><span class="op" id="6608778">(</span><span class="op" id="6608779">*</span><span class="ident" id="6608780">OpError</span><span class="op" id="6608787">)</span><span class="op" id="6608788">.</span><span class="ident" id="6608789">Err</span>&nbsp;<span class="op" id="6608793">!=</span>&nbsp;<span class="ident" id="6608796">ErrWriteToConnected</span>&nbsp;<span class="op" id="6608816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6608820">t</span><span class="op" id="6608821">.</span><span class="ident" id="6608822">Fatalf</span><span class="op" id="6608828">(</span><span class="string" id="6608829">&#34;WriteToUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="6608881">,</span>&nbsp;<span class="ident" id="6608883">err</span><span class="op" id="6608886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6608889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6608892">if</span>&nbsp;<span class="ident" id="6608895">_</span><span class="op" id="6608896">,</span>&nbsp;<span class="ident" id="6608898">err</span>&nbsp;<span class="op" id="6608902">=</span>&nbsp;<span class="ident" id="6608904">c</span><span class="op" id="6608905">.</span><span class="op" id="6608906">(</span><span class="op" id="6608907">*</span><span class="ident" id="6608908">UnixConn</span><span class="op" id="6608916">)</span><span class="op" id="6608917">.</span><span class="ident" id="6608918">WriteTo</span><span class="op" id="6608925">(</span><span class="op" id="6608926">[</span><span class="op" id="6608927">]</span><span class="builtintype" id="6608928">byte</span><span class="op" id="6608932">(</span><span class="string" id="6608933">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6608966">)</span><span class="op" id="6608967">,</span>&nbsp;<span class="ident" id="6608969">raddr</span><span class="op" id="6608974">)</span><span class="op" id="6608975">;</span>&nbsp;<span class="ident" id="6608977">err</span>&nbsp;<span class="op" id="6608981">==</span>&nbsp;<span class="builtintype" id="6608984">nil</span>&nbsp;<span class="op" id="6608988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6608992">t</span><span class="op" id="6608993">.</span><span class="ident" id="6608994">Fatal</span><span class="op" id="6608999">(</span><span class="string" id="6609000">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6609021">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6609024">}</span>&nbsp;<span class="keyword" id="6609026">else</span>&nbsp;<span class="keyword" id="6609031">if</span>&nbsp;<span class="ident" id="6609034">err</span><span class="op" id="6609037">.</span><span class="op" id="6609038">(</span><span class="op" id="6609039">*</span><span class="ident" id="6609040">OpError</span><span class="op" id="6609047">)</span><span class="op" id="6609048">.</span><span class="ident" id="6609049">Err</span>&nbsp;<span class="op" id="6609053">!=</span>&nbsp;<span class="ident" id="6609056">ErrWriteToConnected</span>&nbsp;<span class="op" id="6609076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6609080">t</span><span class="op" id="6609081">.</span><span class="ident" id="6609082">Fatalf</span><span class="op" id="6609088">(</span><span class="string" id="6609089">&#34;WriteTo&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="6609137">,</span>&nbsp;<span class="ident" id="6609139">err</span><span class="op" id="6609142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6609145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6609148">if</span>&nbsp;<span class="ident" id="6609151">_</span><span class="op" id="6609152">,</span>&nbsp;<span class="ident" id="6609154">_</span><span class="op" id="6609155">,</span>&nbsp;<span class="ident" id="6609157">err</span>&nbsp;<span class="op" id="6609161">=</span>&nbsp;<span class="ident" id="6609163">c</span><span class="op" id="6609164">.</span><span class="op" id="6609165">(</span><span class="op" id="6609166">*</span><span class="ident" id="6609167">UnixConn</span><span class="op" id="6609175">)</span><span class="op" id="6609176">.</span><span class="ident" id="6609177">WriteMsgUnix</span><span class="op" id="6609189">(</span><span class="op" id="6609190">[</span><span class="op" id="6609191">]</span><span class="builtintype" id="6609192">byte</span><span class="op" id="6609196">(</span><span class="string" id="6609197">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6609230">)</span><span class="op" id="6609231">,</span>&nbsp;<span class="builtintype" id="6609233">nil</span><span class="op" id="6609236">,</span>&nbsp;<span class="ident" id="6609238">raddr</span><span class="op" id="6609243">)</span><span class="op" id="6609244">;</span>&nbsp;<span class="ident" id="6609246">err</span>&nbsp;<span class="op" id="6609250">==</span>&nbsp;<span class="builtintype" id="6609253">nil</span>&nbsp;<span class="op" id="6609257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6609261">t</span><span class="op" id="6609262">.</span><span class="ident" id="6609263">Fatal</span><span class="op" id="6609268">(</span><span class="string" id="6609269">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6609290">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6609293">}</span>&nbsp;<span class="keyword" id="6609295">else</span>&nbsp;<span class="keyword" id="6609300">if</span>&nbsp;<span class="ident" id="6609303">err</span><span class="op" id="6609306">.</span><span class="op" id="6609307">(</span><span class="op" id="6609308">*</span><span class="ident" id="6609309">OpError</span><span class="op" id="6609316">)</span><span class="op" id="6609317">.</span><span class="ident" id="6609318">Err</span>&nbsp;<span class="op" id="6609322">!=</span>&nbsp;<span class="ident" id="6609325">ErrWriteToConnected</span>&nbsp;<span class="op" id="6609345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6609349">t</span><span class="op" id="6609350">.</span><span class="ident" id="6609351">Fatalf</span><span class="op" id="6609357">(</span><span class="string" id="6609358">&#34;WriteMsgUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="6609411">,</span>&nbsp;<span class="ident" id="6609413">err</span><span class="op" id="6609416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6609419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6609422">if</span>&nbsp;<span class="ident" id="6609425">_</span><span class="op" id="6609426">,</span>&nbsp;<span class="ident" id="6609428">err</span>&nbsp;<span class="op" id="6609432">:=</span>&nbsp;<span class="ident" id="6609435">c</span><span class="op" id="6609436">.</span><span class="ident" id="6609437">Write</span><span class="op" id="6609442">(</span><span class="op" id="6609443">[</span><span class="op" id="6609444">]</span><span class="builtintype" id="6609445">byte</span><span class="op" id="6609449">(</span><span class="string" id="6609450">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6609483">)</span><span class="op" id="6609484">)</span><span class="op" id="6609485">;</span>&nbsp;<span class="ident" id="6609487">err</span>&nbsp;<span class="op" id="6609491">!=</span>&nbsp;<span class="builtintype" id="6609494">nil</span>&nbsp;<span class="op" id="6609498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6609502">t</span><span class="op" id="6609503">.</span><span class="ident" id="6609504">Fatalf</span><span class="op" id="6609510">(</span><span class="string" id="6609511">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6609529">,</span>&nbsp;<span class="ident" id="6609531">err</span><span class="op" id="6609534">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6609537">}</span><br>
<span class="lineno"></span><span class="op" id="6609539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6609542">func</span>&nbsp;<span class="ident" id="6609547">testUnixgramWritePacketConn</span><span class="op" id="6609574">(</span><span class="ident" id="6609575">t</span>&nbsp;<span class="op" id="6609577">*</span><span class="ident" id="6609578">testing</span><span class="op" id="6609585">.</span><span class="ident" id="6609586">T</span><span class="op" id="6609587">,</span>&nbsp;<span class="ident" id="6609589">raddr</span>&nbsp;<span class="op" id="6609595">*</span><span class="ident" id="6609596">UnixAddr</span><span class="op" id="6609604">)</span>&nbsp;<span class="op" id="6609606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6609609">addr</span>&nbsp;<span class="op" id="6609614">:=</span>&nbsp;<span class="ident" id="6609617">testUnixAddr</span><span class="op" id="6609629">(</span><span class="op" id="6609630">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6609633">c</span><span class="op" id="6609634">,</span>&nbsp;<span class="ident" id="6609636">err</span>&nbsp;<span class="op" id="6609640">:=</span>&nbsp;<span class="ident" id="6609643">ListenPacket</span><span class="op" id="6609655">(</span><span class="string" id="6609656">&#34;unixgram&#34;</span><span class="op" id="6609666">,</span>&nbsp;<span class="ident" id="6609668">addr</span><span class="op" id="6609672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6609675">if</span>&nbsp;<span class="ident" id="6609678">err</span>&nbsp;<span class="op" id="6609682">!=</span>&nbsp;<span class="builtintype" id="6609685">nil</span>&nbsp;<span class="op" id="6609689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6609693">t</span><span class="op" id="6609694">.</span><span class="ident" id="6609695">Fatalf</span><span class="op" id="6609701">(</span><span class="string" id="6609702">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6609727">,</span>&nbsp;<span class="ident" id="6609729">err</span><span class="op" id="6609732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6609735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6609738">defer</span>&nbsp;<span class="ident" id="6609744">os</span><span class="op" id="6609746">.</span><span class="ident" id="6609747">Remove</span><span class="op" id="6609753">(</span><span class="ident" id="6609754">addr</span><span class="op" id="6609758">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6609761">defer</span>&nbsp;<span class="ident" id="6609767">c</span><span class="op" id="6609768">.</span><span class="ident" id="6609769">Close</span><span class="op" id="6609774">(</span><span class="op" id="6609775">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6609779">if</span>&nbsp;<span class="ident" id="6609782">_</span><span class="op" id="6609783">,</span>&nbsp;<span class="ident" id="6609785">err</span>&nbsp;<span class="op" id="6609789">:=</span>&nbsp;<span class="ident" id="6609792">c</span><span class="op" id="6609793">.</span><span class="op" id="6609794">(</span><span class="op" id="6609795">*</span><span class="ident" id="6609796">UnixConn</span><span class="op" id="6609804">)</span><span class="op" id="6609805">.</span><span class="ident" id="6609806">WriteToUnix</span><span class="op" id="6609817">(</span><span class="op" id="6609818">[</span><span class="op" id="6609819">]</span><span class="builtintype" id="6609820">byte</span><span class="op" id="6609824">(</span><span class="string" id="6609825">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6609853">)</span><span class="op" id="6609854">,</span>&nbsp;<span class="ident" id="6609856">raddr</span><span class="op" id="6609861">)</span><span class="op" id="6609862">;</span>&nbsp;<span class="ident" id="6609864">err</span>&nbsp;<span class="op" id="6609868">!=</span>&nbsp;<span class="builtintype" id="6609871">nil</span>&nbsp;<span class="op" id="6609875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6609879">t</span><span class="op" id="6609880">.</span><span class="ident" id="6609881">Fatalf</span><span class="op" id="6609887">(</span><span class="string" id="6609888">&#34;WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6609912">,</span>&nbsp;<span class="ident" id="6609914">err</span><span class="op" id="6609917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6609920">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6609923">if</span>&nbsp;<span class="ident" id="6609926">_</span><span class="op" id="6609927">,</span>&nbsp;<span class="ident" id="6609929">err</span>&nbsp;<span class="op" id="6609933">:=</span>&nbsp;<span class="ident" id="6609936">c</span><span class="op" id="6609937">.</span><span class="ident" id="6609938">WriteTo</span><span class="op" id="6609945">(</span><span class="op" id="6609946">[</span><span class="op" id="6609947">]</span><span class="builtintype" id="6609948">byte</span><span class="op" id="6609952">(</span><span class="string" id="6609953">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6609981">)</span><span class="op" id="6609982">,</span>&nbsp;<span class="ident" id="6609984">raddr</span><span class="op" id="6609989">)</span><span class="op" id="6609990">;</span>&nbsp;<span class="ident" id="6609992">err</span>&nbsp;<span class="op" id="6609996">!=</span>&nbsp;<span class="builtintype" id="6609999">nil</span>&nbsp;<span class="op" id="6610003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610007">t</span><span class="op" id="6610008">.</span><span class="ident" id="6610009">Fatalf</span><span class="op" id="6610015">(</span><span class="string" id="6610016">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6610036">,</span>&nbsp;<span class="ident" id="6610038">err</span><span class="op" id="6610041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6610044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6610047">if</span>&nbsp;<span class="ident" id="6610050">_</span><span class="op" id="6610051">,</span>&nbsp;<span class="ident" id="6610053">_</span><span class="op" id="6610054">,</span>&nbsp;<span class="ident" id="6610056">err</span>&nbsp;<span class="op" id="6610060">:=</span>&nbsp;<span class="ident" id="6610063">c</span><span class="op" id="6610064">.</span><span class="op" id="6610065">(</span><span class="op" id="6610066">*</span><span class="ident" id="6610067">UnixConn</span><span class="op" id="6610075">)</span><span class="op" id="6610076">.</span><span class="ident" id="6610077">WriteMsgUnix</span><span class="op" id="6610089">(</span><span class="op" id="6610090">[</span><span class="op" id="6610091">]</span><span class="builtintype" id="6610092">byte</span><span class="op" id="6610096">(</span><span class="string" id="6610097">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6610125">)</span><span class="op" id="6610126">,</span>&nbsp;<span class="builtintype" id="6610128">nil</span><span class="op" id="6610131">,</span>&nbsp;<span class="ident" id="6610133">raddr</span><span class="op" id="6610138">)</span><span class="op" id="6610139">;</span>&nbsp;<span class="ident" id="6610141">err</span>&nbsp;<span class="op" id="6610145">!=</span>&nbsp;<span class="builtintype" id="6610148">nil</span>&nbsp;<span class="op" id="6610152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610156">t</span><span class="op" id="6610157">.</span><span class="ident" id="6610158">Fatalf</span><span class="op" id="6610164">(</span><span class="string" id="6610165">&#34;WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6610190">,</span>&nbsp;<span class="ident" id="6610192">err</span><span class="op" id="6610195">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6610198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6610201">if</span>&nbsp;<span class="ident" id="6610204">_</span><span class="op" id="6610205">,</span>&nbsp;<span class="ident" id="6610207">err</span>&nbsp;<span class="op" id="6610211">:=</span>&nbsp;<span class="ident" id="6610214">c</span><span class="op" id="6610215">.</span><span class="op" id="6610216">(</span><span class="op" id="6610217">*</span><span class="ident" id="6610218">UnixConn</span><span class="op" id="6610226">)</span><span class="op" id="6610227">.</span><span class="ident" id="6610228">Write</span><span class="op" id="6610233">(</span><span class="op" id="6610234">[</span><span class="op" id="6610235">]</span><span class="builtintype" id="6610236">byte</span><span class="op" id="6610240">(</span><span class="string" id="6610241">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6610269">)</span><span class="op" id="6610270">)</span><span class="op" id="6610271">;</span>&nbsp;<span class="ident" id="6610273">err</span>&nbsp;<span class="op" id="6610277">==</span>&nbsp;<span class="builtintype" id="6610280">nil</span>&nbsp;<span class="op" id="6610284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610288">t</span><span class="op" id="6610289">.</span><span class="ident" id="6610290">Fatal</span><span class="op" id="6610295">(</span><span class="string" id="6610296">&#34;Write&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6610315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6610318">}</span><br>
<span class="lineno"></span><span class="op" id="6610320">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="6610323">func</span>&nbsp;<span class="ident" id="6610328">TestUnixConnLocalAndRemoteNames</span><span class="op" id="6610359">(</span><span class="ident" id="6610360">t</span>&nbsp;<span class="op" id="6610362">*</span><span class="ident" id="6610363">testing</span><span class="op" id="6610370">.</span><span class="ident" id="6610371">T</span><span class="op" id="6610372">)</span>&nbsp;<span class="op" id="6610374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6610377">for</span>&nbsp;<span class="ident" id="6610381">_</span><span class="op" id="6610382">,</span>&nbsp;<span class="ident" id="6610384">laddr</span>&nbsp;<span class="op" id="6610390">:=</span>&nbsp;<span class="keyword" id="6610393">range</span>&nbsp;<span class="op" id="6610399">[</span><span class="op" id="6610400">]</span><span class="builtintype" id="6610401">string</span><span class="op" id="6610407">{</span><span class="string" id="6610408">&#34;&#34;</span><span class="op" id="6610410">,</span>&nbsp;<span class="ident" id="6610412">testUnixAddr</span><span class="op" id="6610424">(</span><span class="op" id="6610425">)</span><span class="op" id="6610426">}</span>&nbsp;<span class="op" id="6610428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610432">laddr</span>&nbsp;<span class="op" id="6610438">:=</span>&nbsp;<span class="ident" id="6610441">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610449">taddr</span>&nbsp;<span class="op" id="6610455">:=</span>&nbsp;<span class="ident" id="6610458">testUnixAddr</span><span class="op" id="6610470">(</span><span class="op" id="6610471">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610475">ta</span><span class="op" id="6610477">,</span>&nbsp;<span class="ident" id="6610479">err</span>&nbsp;<span class="op" id="6610483">:=</span>&nbsp;<span class="ident" id="6610486">ResolveUnixAddr</span><span class="op" id="6610501">(</span><span class="string" id="6610502">&#34;unix&#34;</span><span class="op" id="6610508">,</span>&nbsp;<span class="ident" id="6610510">taddr</span><span class="op" id="6610515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6610519">if</span>&nbsp;<span class="ident" id="6610522">err</span>&nbsp;<span class="op" id="6610526">!=</span>&nbsp;<span class="builtintype" id="6610529">nil</span>&nbsp;<span class="op" id="6610533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610538">t</span><span class="op" id="6610539">.</span><span class="ident" id="6610540">Fatalf</span><span class="op" id="6610546">(</span><span class="string" id="6610547">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6610575">,</span>&nbsp;<span class="ident" id="6610577">err</span><span class="op" id="6610580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6610584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610588">ln</span><span class="op" id="6610590">,</span>&nbsp;<span class="ident" id="6610592">err</span>&nbsp;<span class="op" id="6610596">:=</span>&nbsp;<span class="ident" id="6610599">ListenUnix</span><span class="op" id="6610609">(</span><span class="string" id="6610610">&#34;unix&#34;</span><span class="op" id="6610616">,</span>&nbsp;<span class="ident" id="6610618">ta</span><span class="op" id="6610620">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6610624">if</span>&nbsp;<span class="ident" id="6610627">err</span>&nbsp;<span class="op" id="6610631">!=</span>&nbsp;<span class="builtintype" id="6610634">nil</span>&nbsp;<span class="op" id="6610638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610643">t</span><span class="op" id="6610644">.</span><span class="ident" id="6610645">Fatalf</span><span class="op" id="6610651">(</span><span class="string" id="6610652">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6610675">,</span>&nbsp;<span class="ident" id="6610677">err</span><span class="op" id="6610680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6610684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6610688">defer</span>&nbsp;<span class="keyword" id="6610694">func</span><span class="op" id="6610698">(</span><span class="op" id="6610699">)</span>&nbsp;<span class="op" id="6610701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610706">ln</span><span class="op" id="6610708">.</span><span class="ident" id="6610709">Close</span><span class="op" id="6610714">(</span><span class="op" id="6610715">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610720">os</span><span class="op" id="6610722">.</span><span class="ident" id="6610723">Remove</span><span class="op" id="6610729">(</span><span class="ident" id="6610730">taddr</span><span class="op" id="6610735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6610739">}</span><span class="op" id="6610740">(</span><span class="op" id="6610741">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610746">done</span>&nbsp;<span class="op" id="6610751">:=</span>&nbsp;<span class="builtinfunc" id="6610754">make</span><span class="op" id="6610758">(</span><span class="keyword" id="6610759">chan</span>&nbsp;<span class="builtintype" id="6610764">int</span><span class="op" id="6610767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6610771">go</span>&nbsp;<span class="ident" id="6610774">transponder</span><span class="op" id="6610785">(</span><span class="ident" id="6610786">t</span><span class="op" id="6610787">,</span>&nbsp;<span class="ident" id="6610789">ln</span><span class="op" id="6610791">,</span>&nbsp;<span class="ident" id="6610793">done</span><span class="op" id="6610797">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610802">la</span><span class="op" id="6610804">,</span>&nbsp;<span class="ident" id="6610806">err</span>&nbsp;<span class="op" id="6610810">:=</span>&nbsp;<span class="ident" id="6610813">ResolveUnixAddr</span><span class="op" id="6610828">(</span><span class="string" id="6610829">&#34;unix&#34;</span><span class="op" id="6610835">,</span>&nbsp;<span class="ident" id="6610837">laddr</span><span class="op" id="6610842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6610846">if</span>&nbsp;<span class="ident" id="6610849">err</span>&nbsp;<span class="op" id="6610853">!=</span>&nbsp;<span class="builtintype" id="6610856">nil</span>&nbsp;<span class="op" id="6610860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610865">t</span><span class="op" id="6610866">.</span><span class="ident" id="6610867">Fatalf</span><span class="op" id="6610873">(</span><span class="string" id="6610874">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6610902">,</span>&nbsp;<span class="ident" id="6610904">err</span><span class="op" id="6610907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6610911">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610915">c</span><span class="op" id="6610916">,</span>&nbsp;<span class="ident" id="6610918">err</span>&nbsp;<span class="op" id="6610922">:=</span>&nbsp;<span class="ident" id="6610925">DialUnix</span><span class="op" id="6610933">(</span><span class="string" id="6610934">&#34;unix&#34;</span><span class="op" id="6610940">,</span>&nbsp;<span class="ident" id="6610942">la</span><span class="op" id="6610944">,</span>&nbsp;<span class="ident" id="6610946">ta</span><span class="op" id="6610948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6610952">if</span>&nbsp;<span class="ident" id="6610955">err</span>&nbsp;<span class="op" id="6610959">!=</span>&nbsp;<span class="builtintype" id="6610962">nil</span>&nbsp;<span class="op" id="6610966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6610971">t</span><span class="op" id="6610972">.</span><span class="ident" id="6610973">Fatalf</span><span class="op" id="6610979">(</span><span class="string" id="6610980">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6611001">,</span>&nbsp;<span class="ident" id="6611003">err</span><span class="op" id="6611006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6611010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6611014">defer</span>&nbsp;<span class="keyword" id="6611020">func</span><span class="op" id="6611024">(</span><span class="op" id="6611025">)</span>&nbsp;<span class="op" id="6611027">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611032">c</span><span class="op" id="6611033">.</span><span class="ident" id="6611034">Close</span><span class="op" id="6611039">(</span><span class="op" id="6611040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6611045">if</span>&nbsp;<span class="ident" id="6611048">la</span>&nbsp;<span class="op" id="6611051">!=</span>&nbsp;<span class="builtintype" id="6611054">nil</span>&nbsp;<span class="op" id="6611058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6611064">defer</span>&nbsp;<span class="ident" id="6611070">os</span><span class="op" id="6611072">.</span><span class="ident" id="6611073">Remove</span><span class="op" id="6611079">(</span><span class="ident" id="6611080">laddr</span><span class="op" id="6611085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6611090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6611094">}</span><span class="op" id="6611095">(</span><span class="op" id="6611096">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6611100">if</span>&nbsp;<span class="ident" id="6611103">_</span><span class="op" id="6611104">,</span>&nbsp;<span class="ident" id="6611106">err</span>&nbsp;<span class="op" id="6611110">:=</span>&nbsp;<span class="ident" id="6611113">c</span><span class="op" id="6611114">.</span><span class="ident" id="6611115">Write</span><span class="op" id="6611120">(</span><span class="op" id="6611121">[</span><span class="op" id="6611122">]</span><span class="builtintype" id="6611123">byte</span><span class="op" id="6611127">(</span><span class="string" id="6611128">&#34;UNIXCONN&nbsp;LOCAL&nbsp;AND&nbsp;REMOTE&nbsp;NAME&nbsp;TEST&#34;</span><span class="op" id="6611165">)</span><span class="op" id="6611166">)</span><span class="op" id="6611167">;</span>&nbsp;<span class="ident" id="6611169">err</span>&nbsp;<span class="op" id="6611173">!=</span>&nbsp;<span class="builtintype" id="6611176">nil</span>&nbsp;<span class="op" id="6611180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611185">t</span><span class="op" id="6611186">.</span><span class="ident" id="6611187">Fatalf</span><span class="op" id="6611193">(</span><span class="string" id="6611194">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6611221">,</span>&nbsp;<span class="ident" id="6611223">err</span><span class="op" id="6611226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6611230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6611235">switch</span>&nbsp;<span class="ident" id="6611242">runtime</span><span class="op" id="6611249">.</span><span class="ident" id="6611250">GOOS</span>&nbsp;<span class="op" id="6611255">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6611259">case</span>&nbsp;<span class="string" id="6611264">&#34;android&#34;</span><span class="op" id="6611273">,</span>&nbsp;<span class="string" id="6611275">&#34;linux&#34;</span><span class="op" id="6611282">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6611287">if</span>&nbsp;<span class="ident" id="6611290">laddr</span>&nbsp;<span class="op" id="6611296">==</span>&nbsp;<span class="string" id="6611299">&#34;&#34;</span>&nbsp;<span class="op" id="6611302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611308">laddr</span>&nbsp;<span class="op" id="6611314">=</span>&nbsp;<span class="string" id="6611316">&#34;@&#34;</span>&nbsp;<span class="comment" id="6611320">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6611343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6611347">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6611351">var</span>&nbsp;<span class="ident" id="6611355">connAddrs</span>&nbsp;<span class="op" id="6611365">=</span>&nbsp;<span class="op" id="6611367">[</span><span class="num" id="6611368">3</span><span class="op" id="6611369">]</span><span class="keyword" id="6611370">struct</span><span class="op" id="6611376">{</span>&nbsp;<span class="ident" id="6611378">got</span><span class="op" id="6611381">,</span>&nbsp;<span class="ident" id="6611383">want</span>&nbsp;<span class="ident" id="6611388">Addr</span>&nbsp;<span class="op" id="6611393">}</span><span class="op" id="6611394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6611399">{</span><span class="ident" id="6611400">ln</span><span class="op" id="6611402">.</span><span class="ident" id="6611403">Addr</span><span class="op" id="6611407">(</span><span class="op" id="6611408">)</span><span class="op" id="6611409">,</span>&nbsp;<span class="ident" id="6611411">ta</span><span class="op" id="6611413">}</span><span class="op" id="6611414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6611419">{</span><span class="ident" id="6611420">c</span><span class="op" id="6611421">.</span><span class="ident" id="6611422">LocalAddr</span><span class="op" id="6611431">(</span><span class="op" id="6611432">)</span><span class="op" id="6611433">,</span>&nbsp;<span class="op" id="6611435">&amp;</span><span class="ident" id="6611436">UnixAddr</span><span class="op" id="6611444">{</span><span class="ident" id="6611445">Name</span><span class="op" id="6611449">:</span>&nbsp;<span class="ident" id="6611451">laddr</span><span class="op" id="6611456">,</span>&nbsp;<span class="ident" id="6611458">Net</span><span class="op" id="6611461">:</span>&nbsp;<span class="string" id="6611463">&#34;unix&#34;</span><span class="op" id="6611469">}</span><span class="op" id="6611470">}</span><span class="op" id="6611471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6611476">{</span><span class="ident" id="6611477">c</span><span class="op" id="6611478">.</span><span class="ident" id="6611479">RemoteAddr</span><span class="op" id="6611489">(</span><span class="op" id="6611490">)</span><span class="op" id="6611491">,</span>&nbsp;<span class="ident" id="6611493">ta</span><span class="op" id="6611495">}</span><span class="op" id="6611496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6611500">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6611504">for</span>&nbsp;<span class="ident" id="6611508">_</span><span class="op" id="6611509">,</span>&nbsp;<span class="ident" id="6611511">ca</span>&nbsp;<span class="op" id="6611514">:=</span>&nbsp;<span class="keyword" id="6611517">range</span>&nbsp;<span class="ident" id="6611523">connAddrs</span>&nbsp;<span class="op" id="6611533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6611538">if</span>&nbsp;<span class="op" id="6611541">!</span><span class="ident" id="6611542">reflect</span><span class="op" id="6611549">.</span><span class="ident" id="6611550">DeepEqual</span><span class="op" id="6611559">(</span><span class="ident" id="6611560">ca</span><span class="op" id="6611562">.</span><span class="ident" id="6611563">got</span><span class="op" id="6611566">,</span>&nbsp;<span class="ident" id="6611568">ca</span><span class="op" id="6611570">.</span><span class="ident" id="6611571">want</span><span class="op" id="6611575">)</span>&nbsp;<span class="op" id="6611577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611583">t</span><span class="op" id="6611584">.</span><span class="ident" id="6611585">Fatalf</span><span class="op" id="6611591">(</span><span class="string" id="6611592">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6611615">,</span>&nbsp;<span class="ident" id="6611617">ca</span><span class="op" id="6611619">.</span><span class="ident" id="6611620">got</span><span class="op" id="6611623">,</span>&nbsp;<span class="ident" id="6611625">ca</span><span class="op" id="6611627">.</span><span class="ident" id="6611628">want</span><span class="op" id="6611632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6611637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6611641">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6611646">&lt;-</span><span class="ident" id="6611648">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6611654">}</span><br>
<span class="lineno"></span><span class="op" id="6611656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="6611659">func</span>&nbsp;<span class="ident" id="6611664">TestUnixgramConnLocalAndRemoteNames</span><span class="op" id="6611699">(</span><span class="ident" id="6611700">t</span>&nbsp;<span class="op" id="6611702">*</span><span class="ident" id="6611703">testing</span><span class="op" id="6611710">.</span><span class="ident" id="6611711">T</span><span class="op" id="6611712">)</span>&nbsp;<span class="op" id="6611714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6611717">for</span>&nbsp;<span class="ident" id="6611721">_</span><span class="op" id="6611722">,</span>&nbsp;<span class="ident" id="6611724">laddr</span>&nbsp;<span class="op" id="6611730">:=</span>&nbsp;<span class="keyword" id="6611733">range</span>&nbsp;<span class="op" id="6611739">[</span><span class="op" id="6611740">]</span><span class="builtintype" id="6611741">string</span><span class="op" id="6611747">{</span><span class="string" id="6611748">&#34;&#34;</span><span class="op" id="6611750">,</span>&nbsp;<span class="ident" id="6611752">testUnixAddr</span><span class="op" id="6611764">(</span><span class="op" id="6611765">)</span><span class="op" id="6611766">}</span>&nbsp;<span class="op" id="6611768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611772">laddr</span>&nbsp;<span class="op" id="6611778">:=</span>&nbsp;<span class="ident" id="6611781">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611789">taddr</span>&nbsp;<span class="op" id="6611795">:=</span>&nbsp;<span class="ident" id="6611798">testUnixAddr</span><span class="op" id="6611810">(</span><span class="op" id="6611811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611815">ta</span><span class="op" id="6611817">,</span>&nbsp;<span class="ident" id="6611819">err</span>&nbsp;<span class="op" id="6611823">:=</span>&nbsp;<span class="ident" id="6611826">ResolveUnixAddr</span><span class="op" id="6611841">(</span><span class="string" id="6611842">&#34;unixgram&#34;</span><span class="op" id="6611852">,</span>&nbsp;<span class="ident" id="6611854">taddr</span><span class="op" id="6611859">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6611863">if</span>&nbsp;<span class="ident" id="6611866">err</span>&nbsp;<span class="op" id="6611870">!=</span>&nbsp;<span class="builtintype" id="6611873">nil</span>&nbsp;<span class="op" id="6611877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611882">t</span><span class="op" id="6611883">.</span><span class="ident" id="6611884">Fatalf</span><span class="op" id="6611890">(</span><span class="string" id="6611891">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6611919">,</span>&nbsp;<span class="ident" id="6611921">err</span><span class="op" id="6611924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6611928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611932">c1</span><span class="op" id="6611934">,</span>&nbsp;<span class="ident" id="6611936">err</span>&nbsp;<span class="op" id="6611940">:=</span>&nbsp;<span class="ident" id="6611943">ListenUnixgram</span><span class="op" id="6611957">(</span><span class="string" id="6611958">&#34;unixgram&#34;</span><span class="op" id="6611968">,</span>&nbsp;<span class="ident" id="6611970">ta</span><span class="op" id="6611972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6611976">if</span>&nbsp;<span class="ident" id="6611979">err</span>&nbsp;<span class="op" id="6611983">!=</span>&nbsp;<span class="builtintype" id="6611986">nil</span>&nbsp;<span class="op" id="6611990">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6611995">t</span><span class="op" id="6611996">.</span><span class="ident" id="6611997">Fatalf</span><span class="op" id="6612003">(</span><span class="string" id="6612004">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6612031">,</span>&nbsp;<span class="ident" id="6612033">err</span><span class="op" id="6612036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6612044">defer</span>&nbsp;<span class="keyword" id="6612050">func</span><span class="op" id="6612054">(</span><span class="op" id="6612055">)</span>&nbsp;<span class="op" id="6612057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6612062">c1</span><span class="op" id="6612064">.</span><span class="ident" id="6612065">Close</span><span class="op" id="6612070">(</span><span class="op" id="6612071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6612076">os</span><span class="op" id="6612078">.</span><span class="ident" id="6612079">Remove</span><span class="op" id="6612085">(</span><span class="ident" id="6612086">taddr</span><span class="op" id="6612091">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612095">}</span><span class="op" id="6612096">(</span><span class="op" id="6612097">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6612102">var</span>&nbsp;<span class="ident" id="6612106">la</span>&nbsp;<span class="op" id="6612109">*</span><span class="ident" id="6612110">UnixAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6612121">if</span>&nbsp;<span class="ident" id="6612124">laddr</span>&nbsp;<span class="op" id="6612130">!=</span>&nbsp;<span class="string" id="6612133">&#34;&#34;</span>&nbsp;<span class="op" id="6612136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6612141">if</span>&nbsp;<span class="ident" id="6612144">la</span><span class="op" id="6612146">,</span>&nbsp;<span class="ident" id="6612148">err</span>&nbsp;<span class="op" id="6612152">=</span>&nbsp;<span class="ident" id="6612154">ResolveUnixAddr</span><span class="op" id="6612169">(</span><span class="string" id="6612170">&#34;unixgram&#34;</span><span class="op" id="6612180">,</span>&nbsp;<span class="ident" id="6612182">laddr</span><span class="op" id="6612187">)</span><span class="op" id="6612188">;</span>&nbsp;<span class="ident" id="6612190">err</span>&nbsp;<span class="op" id="6612194">!=</span>&nbsp;<span class="builtintype" id="6612197">nil</span>&nbsp;<span class="op" id="6612201">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6612207">t</span><span class="op" id="6612208">.</span><span class="ident" id="6612209">Fatalf</span><span class="op" id="6612215">(</span><span class="string" id="6612216">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6612244">,</span>&nbsp;<span class="ident" id="6612246">err</span><span class="op" id="6612249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6612262">c2</span><span class="op" id="6612264">,</span>&nbsp;<span class="ident" id="6612266">err</span>&nbsp;<span class="op" id="6612270">:=</span>&nbsp;<span class="ident" id="6612273">DialUnix</span><span class="op" id="6612281">(</span><span class="string" id="6612282">&#34;unixgram&#34;</span><span class="op" id="6612292">,</span>&nbsp;<span class="ident" id="6612294">la</span><span class="op" id="6612296">,</span>&nbsp;<span class="ident" id="6612298">ta</span><span class="op" id="6612300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6612304">if</span>&nbsp;<span class="ident" id="6612307">err</span>&nbsp;<span class="op" id="6612311">!=</span>&nbsp;<span class="builtintype" id="6612314">nil</span>&nbsp;<span class="op" id="6612318">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6612323">t</span><span class="op" id="6612324">.</span><span class="ident" id="6612325">Fatalf</span><span class="op" id="6612331">(</span><span class="string" id="6612332">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6612353">,</span>&nbsp;<span class="ident" id="6612355">err</span><span class="op" id="6612358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6612366">defer</span>&nbsp;<span class="keyword" id="6612372">func</span><span class="op" id="6612376">(</span><span class="op" id="6612377">)</span>&nbsp;<span class="op" id="6612379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6612384">c2</span><span class="op" id="6612386">.</span><span class="ident" id="6612387">Close</span><span class="op" id="6612392">(</span><span class="op" id="6612393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6612398">if</span>&nbsp;<span class="ident" id="6612401">la</span>&nbsp;<span class="op" id="6612404">!=</span>&nbsp;<span class="builtintype" id="6612407">nil</span>&nbsp;<span class="op" id="6612411">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6612417">defer</span>&nbsp;<span class="ident" id="6612423">os</span><span class="op" id="6612425">.</span><span class="ident" id="6612426">Remove</span><span class="op" id="6612432">(</span><span class="ident" id="6612433">laddr</span><span class="op" id="6612438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612447">}</span><span class="op" id="6612448">(</span><span class="op" id="6612449">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6612454">switch</span>&nbsp;<span class="ident" id="6612461">runtime</span><span class="op" id="6612468">.</span><span class="ident" id="6612469">GOOS</span>&nbsp;<span class="op" id="6612474">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6612478">case</span>&nbsp;<span class="string" id="6612483">&#34;android&#34;</span><span class="op" id="6612492">,</span>&nbsp;<span class="string" id="6612494">&#34;linux&#34;</span><span class="op" id="6612501">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6612506">if</span>&nbsp;<span class="ident" id="6612509">laddr</span>&nbsp;<span class="op" id="6612515">==</span>&nbsp;<span class="string" id="6612518">&#34;&#34;</span>&nbsp;<span class="op" id="6612521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6612527">laddr</span>&nbsp;<span class="op" id="6612533">=</span>&nbsp;<span class="string" id="6612535">&#34;@&#34;</span>&nbsp;<span class="comment" id="6612539">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612566">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6612571">var</span>&nbsp;<span class="ident" id="6612575">connAddrs</span>&nbsp;<span class="op" id="6612585">=</span>&nbsp;<span class="op" id="6612587">[</span><span class="num" id="6612588">4</span><span class="op" id="6612589">]</span><span class="keyword" id="6612590">struct</span><span class="op" id="6612596">{</span>&nbsp;<span class="ident" id="6612598">got</span><span class="op" id="6612601">,</span>&nbsp;<span class="ident" id="6612603">want</span>&nbsp;<span class="ident" id="6612608">Addr</span>&nbsp;<span class="op" id="6612613">}</span><span class="op" id="6612614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612619">{</span><span class="ident" id="6612620">c1</span><span class="op" id="6612622">.</span><span class="ident" id="6612623">LocalAddr</span><span class="op" id="6612632">(</span><span class="op" id="6612633">)</span><span class="op" id="6612634">,</span>&nbsp;<span class="ident" id="6612636">ta</span><span class="op" id="6612638">}</span><span class="op" id="6612639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612644">{</span><span class="ident" id="6612645">c1</span><span class="op" id="6612647">.</span><span class="ident" id="6612648">RemoteAddr</span><span class="op" id="6612658">(</span><span class="op" id="6612659">)</span><span class="op" id="6612660">,</span>&nbsp;<span class="builtintype" id="6612662">nil</span><span class="op" id="6612665">}</span><span class="op" id="6612666">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612671">{</span><span class="ident" id="6612672">c2</span><span class="op" id="6612674">.</span><span class="ident" id="6612675">LocalAddr</span><span class="op" id="6612684">(</span><span class="op" id="6612685">)</span><span class="op" id="6612686">,</span>&nbsp;<span class="op" id="6612688">&amp;</span><span class="ident" id="6612689">UnixAddr</span><span class="op" id="6612697">{</span><span class="ident" id="6612698">Name</span><span class="op" id="6612702">:</span>&nbsp;<span class="ident" id="6612704">laddr</span><span class="op" id="6612709">,</span>&nbsp;<span class="ident" id="6612711">Net</span><span class="op" id="6612714">:</span>&nbsp;<span class="string" id="6612716">&#34;unixgram&#34;</span><span class="op" id="6612726">}</span><span class="op" id="6612727">}</span><span class="op" id="6612728">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612733">{</span><span class="ident" id="6612734">c2</span><span class="op" id="6612736">.</span><span class="ident" id="6612737">RemoteAddr</span><span class="op" id="6612747">(</span><span class="op" id="6612748">)</span><span class="op" id="6612749">,</span>&nbsp;<span class="ident" id="6612751">ta</span><span class="op" id="6612753">}</span><span class="op" id="6612754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6612762">for</span>&nbsp;<span class="ident" id="6612766">_</span><span class="op" id="6612767">,</span>&nbsp;<span class="ident" id="6612769">ca</span>&nbsp;<span class="op" id="6612772">:=</span>&nbsp;<span class="keyword" id="6612775">range</span>&nbsp;<span class="ident" id="6612781">connAddrs</span>&nbsp;<span class="op" id="6612791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6612796">if</span>&nbsp;<span class="op" id="6612799">!</span><span class="ident" id="6612800">reflect</span><span class="op" id="6612807">.</span><span class="ident" id="6612808">DeepEqual</span><span class="op" id="6612817">(</span><span class="ident" id="6612818">ca</span><span class="op" id="6612820">.</span><span class="ident" id="6612821">got</span><span class="op" id="6612824">,</span>&nbsp;<span class="ident" id="6612826">ca</span><span class="op" id="6612828">.</span><span class="ident" id="6612829">want</span><span class="op" id="6612833">)</span>&nbsp;<span class="op" id="6612835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6612841">t</span><span class="op" id="6612842">.</span><span class="ident" id="6612843">Fatalf</span><span class="op" id="6612849">(</span><span class="string" id="6612850">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6612873">,</span>&nbsp;<span class="ident" id="6612875">ca</span><span class="op" id="6612877">.</span><span class="ident" id="6612878">got</span><span class="op" id="6612881">,</span>&nbsp;<span class="ident" id="6612883">ca</span><span class="op" id="6612885">.</span><span class="ident" id="6612886">want</span><span class="op" id="6612890">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6612902">}</span><br>
<span class="lineno"></span><span class="op" id="6612904">}</span>
</div>
</body>
</html>
