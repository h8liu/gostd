<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html" class="current">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4075890">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4075945">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4075999">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4076050">//&nbsp;Read&nbsp;static&nbsp;host/IP&nbsp;entries&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4076099">package</span>&nbsp;<span class="ident" id="4076107">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4076112">import</span>&nbsp;<span class="op" id="4076119">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4076122">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4076130">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4076137">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4076140">const</span>&nbsp;<span class="ident" id="4076146">cacheMaxAge</span>&nbsp;<span class="op" id="4076158">=</span>&nbsp;<span class="num" id="4076160">5</span>&nbsp;<span class="op" id="4076162">*</span>&nbsp;<span class="ident" id="4076164">time</span><span class="op" id="4076168">.</span><span class="ident" id="4076169">Minute</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4076177">//&nbsp;hostsPath&nbsp;points&nbsp;to&nbsp;the&nbsp;file&nbsp;with&nbsp;static&nbsp;IP/address&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="4076241">var</span>&nbsp;<span class="ident" id="4076245">hostsPath</span>&nbsp;<span class="op" id="4076255">=</span>&nbsp;<span class="string" id="4076257">&#34;/etc/hosts&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4076271">//&nbsp;Simple&nbsp;cache.</span><br>
<span class="lineno">20</span><span class="keyword" id="4076288">var</span>&nbsp;<span class="ident" id="4076292">hosts</span>&nbsp;<span class="keyword" id="4076298">struct</span>&nbsp;<span class="op" id="4076305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076308">sync</span><span class="op" id="4076312">.</span><span class="ident" id="4076313">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076320">byName</span>&nbsp;<span class="keyword" id="4076327">map</span><span class="op" id="4076330">[</span><span class="builtintype" id="4076331">string</span><span class="op" id="4076337">]</span><span class="op" id="4076338">[</span><span class="op" id="4076339">]</span><span class="builtintype" id="4076340">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076348">byAddr</span>&nbsp;<span class="keyword" id="4076355">map</span><span class="op" id="4076358">[</span><span class="builtintype" id="4076359">string</span><span class="op" id="4076365">]</span><span class="op" id="4076366">[</span><span class="op" id="4076367">]</span><span class="builtintype" id="4076368">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076376">expire</span>&nbsp;<span class="ident" id="4076383">time</span><span class="op" id="4076387">.</span><span class="ident" id="4076388">Time</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076394">path</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4076401">string</span><br>
<span class="lineno"></span><span class="op" id="4076408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4076411">func</span>&nbsp;<span class="ident" id="4076416">readHosts</span><span class="op" id="4076425">(</span><span class="op" id="4076426">)</span>&nbsp;<span class="op" id="4076428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076431">now</span>&nbsp;<span class="op" id="4076435">:=</span>&nbsp;<span class="ident" id="4076438">time</span><span class="op" id="4076442">.</span><span class="ident" id="4076443">Now</span><span class="op" id="4076446">(</span><span class="op" id="4076447">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076450">hp</span>&nbsp;<span class="op" id="4076453">:=</span>&nbsp;<span class="ident" id="4076456">hostsPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076467">if</span>&nbsp;<span class="builtinfunc" id="4076470">len</span><span class="op" id="4076473">(</span><span class="ident" id="4076474">hosts</span><span class="op" id="4076479">.</span><span class="ident" id="4076480">byName</span><span class="op" id="4076486">)</span>&nbsp;<span class="op" id="4076488">==</span>&nbsp;<span class="num" id="4076491">0</span>&nbsp;<span class="op" id="4076493">||</span>&nbsp;<span class="ident" id="4076496">now</span><span class="op" id="4076499">.</span><span class="ident" id="4076500">After</span><span class="op" id="4076505">(</span><span class="ident" id="4076506">hosts</span><span class="op" id="4076511">.</span><span class="ident" id="4076512">expire</span><span class="op" id="4076518">)</span>&nbsp;<span class="op" id="4076520">||</span>&nbsp;<span class="ident" id="4076523">hosts</span><span class="op" id="4076528">.</span><span class="ident" id="4076529">path</span>&nbsp;<span class="op" id="4076534">!=</span>&nbsp;<span class="ident" id="4076537">hp</span>&nbsp;<span class="op" id="4076540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076544">hs</span>&nbsp;<span class="op" id="4076547">:=</span>&nbsp;<span class="builtinfunc" id="4076550">make</span><span class="op" id="4076554">(</span><span class="keyword" id="4076555">map</span><span class="op" id="4076558">[</span><span class="builtintype" id="4076559">string</span><span class="op" id="4076565">]</span><span class="op" id="4076566">[</span><span class="op" id="4076567">]</span><span class="builtintype" id="4076568">string</span><span class="op" id="4076574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076578">is</span>&nbsp;<span class="op" id="4076581">:=</span>&nbsp;<span class="builtinfunc" id="4076584">make</span><span class="op" id="4076588">(</span><span class="keyword" id="4076589">map</span><span class="op" id="4076592">[</span><span class="builtintype" id="4076593">string</span><span class="op" id="4076599">]</span><span class="op" id="4076600">[</span><span class="op" id="4076601">]</span><span class="builtintype" id="4076602">string</span><span class="op" id="4076608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076612">var</span>&nbsp;<span class="ident" id="4076616">file</span>&nbsp;<span class="op" id="4076621">*</span><span class="ident" id="4076622">file</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076629">if</span>&nbsp;<span class="ident" id="4076632">file</span><span class="op" id="4076636">,</span>&nbsp;<span class="ident" id="4076638">_</span>&nbsp;<span class="op" id="4076640">=</span>&nbsp;<span class="ident" id="4076642">open</span><span class="op" id="4076646">(</span><span class="ident" id="4076647">hp</span><span class="op" id="4076649">)</span><span class="op" id="4076650">;</span>&nbsp;<span class="ident" id="4076652">file</span>&nbsp;<span class="op" id="4076657">==</span>&nbsp;<span class="ident" id="4076660">nil</span>&nbsp;<span class="op" id="4076664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076669">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4076678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076682">for</span>&nbsp;<span class="ident" id="4076686">line</span><span class="op" id="4076690">,</span>&nbsp;<span class="ident" id="4076692">ok</span>&nbsp;<span class="op" id="4076695">:=</span>&nbsp;<span class="ident" id="4076698">file</span><span class="op" id="4076702">.</span><span class="ident" id="4076703">readLine</span><span class="op" id="4076711">(</span><span class="op" id="4076712">)</span><span class="op" id="4076713">;</span>&nbsp;<span class="ident" id="4076715">ok</span><span class="op" id="4076717">;</span>&nbsp;<span class="ident" id="4076719">line</span><span class="op" id="4076723">,</span>&nbsp;<span class="ident" id="4076725">ok</span>&nbsp;<span class="op" id="4076728">=</span>&nbsp;<span class="ident" id="4076730">file</span><span class="op" id="4076734">.</span><span class="ident" id="4076735">readLine</span><span class="op" id="4076743">(</span><span class="op" id="4076744">)</span>&nbsp;<span class="op" id="4076746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076751">if</span>&nbsp;<span class="ident" id="4076754">i</span>&nbsp;<span class="op" id="4076756">:=</span>&nbsp;<span class="ident" id="4076759">byteIndex</span><span class="op" id="4076768">(</span><span class="ident" id="4076769">line</span><span class="op" id="4076773">,</span>&nbsp;<span class="string" id="4076775">&#39;#&#39;</span><span class="op" id="4076778">)</span><span class="op" id="4076779">;</span>&nbsp;<span class="ident" id="4076781">i</span>&nbsp;<span class="op" id="4076783">&gt;=</span>&nbsp;<span class="num" id="4076786">0</span>&nbsp;<span class="op" id="4076788">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4076794">//&nbsp;Discard&nbsp;comments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076819">line</span>&nbsp;<span class="op" id="4076824">=</span>&nbsp;<span class="ident" id="4076826">line</span><span class="op" id="4076830">[</span><span class="num" id="4076831">0</span><span class="op" id="4076832">:</span><span class="ident" id="4076833">i</span><span class="op" id="4076834">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4076839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076844">f</span>&nbsp;<span class="op" id="4076846">:=</span>&nbsp;<span class="ident" id="4076849">getFields</span><span class="op" id="4076858">(</span><span class="ident" id="4076859">line</span><span class="op" id="4076863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076868">if</span>&nbsp;<span class="builtinfunc" id="4076871">len</span><span class="op" id="4076874">(</span><span class="ident" id="4076875">f</span><span class="op" id="4076876">)</span>&nbsp;<span class="op" id="4076878">&lt;</span>&nbsp;<span class="num" id="4076880">2</span>&nbsp;<span class="op" id="4076882">||</span>&nbsp;<span class="ident" id="4076885">ParseIP</span><span class="op" id="4076892">(</span><span class="ident" id="4076893">f</span><span class="op" id="4076894">[</span><span class="num" id="4076895">0</span><span class="op" id="4076896">]</span><span class="op" id="4076897">)</span>&nbsp;<span class="op" id="4076899">==</span>&nbsp;<span class="ident" id="4076902">nil</span>&nbsp;<span class="op" id="4076906">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076912">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4076924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076929">for</span>&nbsp;<span class="ident" id="4076933">i</span>&nbsp;<span class="op" id="4076935">:=</span>&nbsp;<span class="num" id="4076938">1</span><span class="op" id="4076939">;</span>&nbsp;<span class="ident" id="4076941">i</span>&nbsp;<span class="op" id="4076943">&lt;</span>&nbsp;<span class="builtinfunc" id="4076945">len</span><span class="op" id="4076948">(</span><span class="ident" id="4076949">f</span><span class="op" id="4076950">)</span><span class="op" id="4076951">;</span>&nbsp;<span class="ident" id="4076953">i</span><span class="op" id="4076954">++</span>&nbsp;<span class="op" id="4076957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076963">h</span>&nbsp;<span class="op" id="4076965">:=</span>&nbsp;<span class="ident" id="4076968">f</span><span class="op" id="4076969">[</span><span class="ident" id="4076970">i</span><span class="op" id="4076971">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076977">hs</span><span class="op" id="4076979">[</span><span class="ident" id="4076980">h</span><span class="op" id="4076981">]</span>&nbsp;<span class="op" id="4076983">=</span>&nbsp;<span class="builtinfunc" id="4076985">append</span><span class="op" id="4076991">(</span><span class="ident" id="4076992">hs</span><span class="op" id="4076994">[</span><span class="ident" id="4076995">h</span><span class="op" id="4076996">]</span><span class="op" id="4076997">,</span>&nbsp;<span class="ident" id="4076999">f</span><span class="op" id="4077000">[</span><span class="num" id="4077001">0</span><span class="op" id="4077002">]</span><span class="op" id="4077003">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077009">is</span><span class="op" id="4077011">[</span><span class="ident" id="4077012">f</span><span class="op" id="4077013">[</span><span class="num" id="4077014">0</span><span class="op" id="4077015">]</span><span class="op" id="4077016">]</span>&nbsp;<span class="op" id="4077018">=</span>&nbsp;<span class="builtinfunc" id="4077020">append</span><span class="op" id="4077026">(</span><span class="ident" id="4077027">is</span><span class="op" id="4077029">[</span><span class="ident" id="4077030">f</span><span class="op" id="4077031">[</span><span class="num" id="4077032">0</span><span class="op" id="4077033">]</span><span class="op" id="4077034">]</span><span class="op" id="4077035">,</span>&nbsp;<span class="ident" id="4077037">h</span><span class="op" id="4077038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4077051">//&nbsp;Update&nbsp;the&nbsp;data&nbsp;cache.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077079">hosts</span><span class="op" id="4077084">.</span><span class="ident" id="4077085">expire</span>&nbsp;<span class="op" id="4077092">=</span>&nbsp;<span class="ident" id="4077094">now</span><span class="op" id="4077097">.</span><span class="ident" id="4077098">Add</span><span class="op" id="4077101">(</span><span class="ident" id="4077102">cacheMaxAge</span><span class="op" id="4077113">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077117">hosts</span><span class="op" id="4077122">.</span><span class="ident" id="4077123">path</span>&nbsp;<span class="op" id="4077128">=</span>&nbsp;<span class="ident" id="4077130">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077135">hosts</span><span class="op" id="4077140">.</span><span class="ident" id="4077141">byName</span>&nbsp;<span class="op" id="4077148">=</span>&nbsp;<span class="ident" id="4077150">hs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077155">hosts</span><span class="op" id="4077160">.</span><span class="ident" id="4077161">byAddr</span>&nbsp;<span class="op" id="4077168">=</span>&nbsp;<span class="ident" id="4077170">is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077175">file</span><span class="op" id="4077179">.</span><span class="builtinfunc" id="4077180">close</span><span class="op" id="4077185">(</span><span class="op" id="4077186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077189">}</span><br>
<span class="lineno">60</span><span class="op" id="4077191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4077194">//&nbsp;lookupStaticHost&nbsp;looks&nbsp;up&nbsp;the&nbsp;addresses&nbsp;for&nbsp;the&nbsp;given&nbsp;host&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="4077273">func</span>&nbsp;<span class="ident" id="4077278">lookupStaticHost</span><span class="op" id="4077294">(</span><span class="ident" id="4077295">host</span>&nbsp;<span class="builtintype" id="4077300">string</span><span class="op" id="4077306">)</span>&nbsp;<span class="op" id="4077308">[</span><span class="op" id="4077309">]</span><span class="builtintype" id="4077310">string</span>&nbsp;<span class="op" id="4077317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077320">hosts</span><span class="op" id="4077325">.</span><span class="ident" id="4077326">Lock</span><span class="op" id="4077330">(</span><span class="op" id="4077331">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077334">defer</span>&nbsp;<span class="ident" id="4077340">hosts</span><span class="op" id="4077345">.</span><span class="ident" id="4077346">Unlock</span><span class="op" id="4077352">(</span><span class="op" id="4077353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077356">readHosts</span><span class="op" id="4077365">(</span><span class="op" id="4077366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077369">if</span>&nbsp;<span class="builtinfunc" id="4077372">len</span><span class="op" id="4077375">(</span><span class="ident" id="4077376">hosts</span><span class="op" id="4077381">.</span><span class="ident" id="4077382">byName</span><span class="op" id="4077388">)</span>&nbsp;<span class="op" id="4077390">!=</span>&nbsp;<span class="num" id="4077393">0</span>&nbsp;<span class="op" id="4077395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077399">if</span>&nbsp;<span class="ident" id="4077402">ips</span><span class="op" id="4077405">,</span>&nbsp;<span class="ident" id="4077407">ok</span>&nbsp;<span class="op" id="4077410">:=</span>&nbsp;<span class="ident" id="4077413">hosts</span><span class="op" id="4077418">.</span><span class="ident" id="4077419">byName</span><span class="op" id="4077425">[</span><span class="ident" id="4077426">host</span><span class="op" id="4077430">]</span><span class="op" id="4077431">;</span>&nbsp;<span class="ident" id="4077433">ok</span>&nbsp;<span class="op" id="4077436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077441">return</span>&nbsp;<span class="ident" id="4077448">ips</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077460">return</span>&nbsp;<span class="ident" id="4077467">nil</span><br>
<span class="lineno"></span><span class="op" id="4077471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="4077474">//&nbsp;lookupStaticAddr&nbsp;looks&nbsp;up&nbsp;the&nbsp;hosts&nbsp;for&nbsp;the&nbsp;given&nbsp;address&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="4077552">func</span>&nbsp;<span class="ident" id="4077557">lookupStaticAddr</span><span class="op" id="4077573">(</span><span class="ident" id="4077574">addr</span>&nbsp;<span class="builtintype" id="4077579">string</span><span class="op" id="4077585">)</span>&nbsp;<span class="op" id="4077587">[</span><span class="op" id="4077588">]</span><span class="builtintype" id="4077589">string</span>&nbsp;<span class="op" id="4077596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077599">hosts</span><span class="op" id="4077604">.</span><span class="ident" id="4077605">Lock</span><span class="op" id="4077609">(</span><span class="op" id="4077610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077613">defer</span>&nbsp;<span class="ident" id="4077619">hosts</span><span class="op" id="4077624">.</span><span class="ident" id="4077625">Unlock</span><span class="op" id="4077631">(</span><span class="op" id="4077632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077635">readHosts</span><span class="op" id="4077644">(</span><span class="op" id="4077645">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077648">if</span>&nbsp;<span class="builtinfunc" id="4077651">len</span><span class="op" id="4077654">(</span><span class="ident" id="4077655">hosts</span><span class="op" id="4077660">.</span><span class="ident" id="4077661">byAddr</span><span class="op" id="4077667">)</span>&nbsp;<span class="op" id="4077669">!=</span>&nbsp;<span class="num" id="4077672">0</span>&nbsp;<span class="op" id="4077674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077678">if</span>&nbsp;<span class="ident" id="4077681">hosts</span><span class="op" id="4077686">,</span>&nbsp;<span class="ident" id="4077688">ok</span>&nbsp;<span class="op" id="4077691">:=</span>&nbsp;<span class="ident" id="4077694">hosts</span><span class="op" id="4077699">.</span><span class="ident" id="4077700">byAddr</span><span class="op" id="4077706">[</span><span class="ident" id="4077707">addr</span><span class="op" id="4077711">]</span><span class="op" id="4077712">;</span>&nbsp;<span class="ident" id="4077714">ok</span>&nbsp;<span class="op" id="4077717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077722">return</span>&nbsp;<span class="ident" id="4077729">hosts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077740">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077743">return</span>&nbsp;<span class="ident" id="4077750">nil</span><br>
<span class="lineno"></span><span class="op" id="4077754">}</span>
</div>
</body>
</html>
