<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3436099">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3436155">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3436209">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3436260">package</span>&nbsp;<span class="ident" id="3436268">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3436273">import</span>&nbsp;<span class="string" id="3436280">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3436291">func</span>&nbsp;<span class="ident" id="3436296">maxListenerBacklog</span><span class="op" id="3436314">(</span><span class="op" id="3436315">)</span>&nbsp;<span class="builtintype" id="3436317">int</span>&nbsp;<span class="op" id="3436321">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436324">fd</span><span class="op" id="3436326">,</span>&nbsp;<span class="ident" id="3436328">err</span>&nbsp;<span class="op" id="3436332">:=</span>&nbsp;<span class="ident" id="3436335">open</span><span class="op" id="3436339">(</span><span class="string" id="3436340">&#34;/proc/sys/net/core/somaxconn&#34;</span><span class="op" id="3436370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436373">if</span>&nbsp;<span class="ident" id="3436376">err</span>&nbsp;<span class="op" id="3436380">!=</span>&nbsp;<span class="ident" id="3436383">nil</span>&nbsp;<span class="op" id="3436387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436391">return</span>&nbsp;<span class="ident" id="3436398">syscall</span><span class="op" id="3436405">.</span><span class="ident" id="3436406">SOMAXCONN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3436417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436420">defer</span>&nbsp;<span class="ident" id="3436426">fd</span><span class="op" id="3436428">.</span><span class="builtinfunc" id="3436429">close</span><span class="op" id="3436434">(</span><span class="op" id="3436435">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436438">l</span><span class="op" id="3436439">,</span>&nbsp;<span class="ident" id="3436441">ok</span>&nbsp;<span class="op" id="3436444">:=</span>&nbsp;<span class="ident" id="3436447">fd</span><span class="op" id="3436449">.</span><span class="ident" id="3436450">readLine</span><span class="op" id="3436458">(</span><span class="op" id="3436459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436462">if</span>&nbsp;<span class="op" id="3436465">!</span><span class="ident" id="3436466">ok</span>&nbsp;<span class="op" id="3436469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436473">return</span>&nbsp;<span class="ident" id="3436480">syscall</span><span class="op" id="3436487">.</span><span class="ident" id="3436488">SOMAXCONN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3436499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436502">f</span>&nbsp;<span class="op" id="3436504">:=</span>&nbsp;<span class="ident" id="3436507">getFields</span><span class="op" id="3436516">(</span><span class="ident" id="3436517">l</span><span class="op" id="3436518">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436521">n</span><span class="op" id="3436522">,</span>&nbsp;<span class="ident" id="3436524">_</span><span class="op" id="3436525">,</span>&nbsp;<span class="ident" id="3436527">ok</span>&nbsp;<span class="op" id="3436530">:=</span>&nbsp;<span class="ident" id="3436533">dtoi</span><span class="op" id="3436537">(</span><span class="ident" id="3436538">f</span><span class="op" id="3436539">[</span><span class="num" id="3436540">0</span><span class="op" id="3436541">]</span><span class="op" id="3436542">,</span>&nbsp;<span class="num" id="3436544">0</span><span class="op" id="3436545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436548">if</span>&nbsp;<span class="ident" id="3436551">n</span>&nbsp;<span class="op" id="3436553">==</span>&nbsp;<span class="num" id="3436556">0</span>&nbsp;<span class="op" id="3436558">||</span>&nbsp;<span class="op" id="3436561">!</span><span class="ident" id="3436562">ok</span>&nbsp;<span class="op" id="3436565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436569">return</span>&nbsp;<span class="ident" id="3436576">syscall</span><span class="op" id="3436583">.</span><span class="ident" id="3436584">SOMAXCONN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3436595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3436598">//&nbsp;Linux&nbsp;stores&nbsp;the&nbsp;backlog&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3436640">//&nbsp;Truncate&nbsp;number&nbsp;to&nbsp;avoid&nbsp;wrapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3436679">//&nbsp;See&nbsp;issue&nbsp;5030.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436699">if</span>&nbsp;<span class="ident" id="3436702">n</span>&nbsp;<span class="op" id="3436704">&gt;</span>&nbsp;<span class="num" id="3436706">1</span><span class="op" id="3436707">&lt;&lt;</span><span class="num" id="3436709">16</span><span class="op" id="3436711">-</span><span class="num" id="3436712">1</span>&nbsp;<span class="op" id="3436714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3436718">n</span>&nbsp;<span class="op" id="3436720">=</span>&nbsp;<span class="num" id="3436722">1</span><span class="op" id="3436723">&lt;&lt;</span><span class="num" id="3436725">16</span>&nbsp;<span class="op" id="3436728">-</span>&nbsp;<span class="num" id="3436730">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3436733">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3436736">return</span>&nbsp;<span class="ident" id="3436743">n</span><br>
<span class="lineno"></span><span class="op" id="3436745">}</span>
</div>
</body>
</html>
