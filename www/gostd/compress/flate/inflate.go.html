<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html" class="current">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4152574">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4152629">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4152683">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4152734">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-output&nbsp;fixedhuff.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4152784">//&nbsp;Package&nbsp;flate&nbsp;implements&nbsp;the&nbsp;DEFLATE&nbsp;compressed&nbsp;data&nbsp;format,&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4152861">//&nbsp;RFC&nbsp;1951.&nbsp;&nbsp;The&nbsp;gzip&nbsp;and&nbsp;zlib&nbsp;packages&nbsp;implement&nbsp;access&nbsp;to&nbsp;DEFLATE-based&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="4152941">//&nbsp;formats.</span><br>
<span class="lineno">10</span><span class="keyword" id="4152953">package</span>&nbsp;<span class="ident" id="4152961">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4152968">import</span>&nbsp;<span class="op" id="4152975">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4152978">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4152987">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4152993">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="4153003">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4153006">const</span>&nbsp;<span class="op" id="4153012">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153015">maxCodeLen</span>&nbsp;<span class="op" id="4153026">=</span>&nbsp;<span class="num" id="4153028">16</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4153034">//&nbsp;max&nbsp;length&nbsp;of&nbsp;Huffman&nbsp;code</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153065">maxHist</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4153076">=</span>&nbsp;<span class="num" id="4153078">32768</span>&nbsp;<span class="comment" id="4153084">//&nbsp;max&nbsp;history&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153109">//&nbsp;The&nbsp;next&nbsp;three&nbsp;numbers&nbsp;come&nbsp;from&nbsp;the&nbsp;RFC,&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153170">maxLit</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4153179">=</span>&nbsp;<span class="num" id="4153181">286</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153186">maxDist</span>&nbsp;&nbsp;<span class="op" id="4153195">=</span>&nbsp;<span class="num" id="4153197">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153201">numCodes</span>&nbsp;<span class="op" id="4153210">=</span>&nbsp;<span class="num" id="4153212">19</span>&nbsp;<span class="comment" id="4153215">//&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;Huffman&nbsp;meta-code</span><br>
<span class="lineno">25</span><span class="op" id="4153255">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4153258">//&nbsp;A&nbsp;CorruptInputError&nbsp;reports&nbsp;the&nbsp;presence&nbsp;of&nbsp;corrupt&nbsp;input&nbsp;at&nbsp;a&nbsp;given&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="4153338">type</span>&nbsp;<span class="ident" id="4153343">CorruptInputError</span>&nbsp;<span class="ident" id="4153361">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4153368">func</span>&nbsp;<span class="op" id="4153373">(</span><span class="ident" id="4153374">e</span>&nbsp;<span class="ident" id="4153376">CorruptInputError</span><span class="op" id="4153393">)</span>&nbsp;<span class="ident" id="4153395">Error</span><span class="op" id="4153400">(</span><span class="op" id="4153401">)</span>&nbsp;<span class="builtintype" id="4153403">string</span>&nbsp;<span class="op" id="4153410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153413">return</span>&nbsp;<span class="string" id="4153420">&#34;flate:&nbsp;corrupt&nbsp;input&nbsp;before&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4153458">+</span>&nbsp;<span class="ident" id="4153460">strconv</span><span class="op" id="4153467">.</span><span class="ident" id="4153468">FormatInt</span><span class="op" id="4153477">(</span><span class="ident" id="4153478">int64</span><span class="op" id="4153483">(</span><span class="ident" id="4153484">e</span><span class="op" id="4153485">)</span><span class="op" id="4153486">,</span>&nbsp;<span class="num" id="4153488">10</span><span class="op" id="4153490">)</span><br>
<span class="lineno"></span><span class="op" id="4153492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4153495">//&nbsp;An&nbsp;InternalError&nbsp;reports&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;flate&nbsp;code&nbsp;itself.</span><br>
<span class="lineno">35</span><span class="keyword" id="4153558">type</span>&nbsp;<span class="ident" id="4153563">InternalError</span>&nbsp;<span class="builtintype" id="4153577">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4153585">func</span>&nbsp;<span class="op" id="4153590">(</span><span class="ident" id="4153591">e</span>&nbsp;<span class="ident" id="4153593">InternalError</span><span class="op" id="4153606">)</span>&nbsp;<span class="ident" id="4153608">Error</span><span class="op" id="4153613">(</span><span class="op" id="4153614">)</span>&nbsp;<span class="builtintype" id="4153616">string</span>&nbsp;<span class="op" id="4153623">{</span>&nbsp;<span class="keyword" id="4153625">return</span>&nbsp;<span class="string" id="4153632">&#34;flate:&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="4153658">+</span>&nbsp;<span class="builtintype" id="4153660">string</span><span class="op" id="4153666">(</span><span class="ident" id="4153667">e</span><span class="op" id="4153668">)</span>&nbsp;<span class="op" id="4153670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4153673">//&nbsp;A&nbsp;ReadError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;reading&nbsp;input.</span><br>
<span class="lineno">40</span><span class="keyword" id="4153738">type</span>&nbsp;<span class="ident" id="4153743">ReadError</span>&nbsp;<span class="keyword" id="4153753">struct</span>&nbsp;<span class="op" id="4153760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153763">Offset</span>&nbsp;<span class="ident" id="4153770">int64</span>&nbsp;<span class="comment" id="4153776">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153813">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4153820">error</span>&nbsp;<span class="comment" id="4153826">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="4153863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4153866">func</span>&nbsp;<span class="op" id="4153871">(</span><span class="ident" id="4153872">e</span>&nbsp;<span class="op" id="4153874">*</span><span class="ident" id="4153875">ReadError</span><span class="op" id="4153884">)</span>&nbsp;<span class="ident" id="4153886">Error</span><span class="op" id="4153891">(</span><span class="op" id="4153892">)</span>&nbsp;<span class="builtintype" id="4153894">string</span>&nbsp;<span class="op" id="4153901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153904">return</span>&nbsp;<span class="string" id="4153911">&#34;flate:&nbsp;read&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4153942">+</span>&nbsp;<span class="ident" id="4153944">strconv</span><span class="op" id="4153951">.</span><span class="ident" id="4153952">FormatInt</span><span class="op" id="4153961">(</span><span class="ident" id="4153962">e</span><span class="op" id="4153963">.</span><span class="ident" id="4153964">Offset</span><span class="op" id="4153970">,</span>&nbsp;<span class="num" id="4153972">10</span><span class="op" id="4153974">)</span>&nbsp;<span class="op" id="4153976">+</span>&nbsp;<span class="string" id="4153978">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4153983">+</span>&nbsp;<span class="ident" id="4153985">e</span><span class="op" id="4153986">.</span><span class="ident" id="4153987">Err</span><span class="op" id="4153990">.</span><span class="ident" id="4153991">Error</span><span class="op" id="4153996">(</span><span class="op" id="4153997">)</span><br>
<span class="lineno"></span><span class="op" id="4153999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4154002">//&nbsp;A&nbsp;WriteError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;writing&nbsp;output.</span><br>
<span class="lineno">50</span><span class="keyword" id="4154069">type</span>&nbsp;<span class="ident" id="4154074">WriteError</span>&nbsp;<span class="keyword" id="4154085">struct</span>&nbsp;<span class="op" id="4154092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154095">Offset</span>&nbsp;<span class="ident" id="4154102">int64</span>&nbsp;<span class="comment" id="4154108">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154145">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4154152">error</span>&nbsp;<span class="comment" id="4154158">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="4154196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4154199">func</span>&nbsp;<span class="op" id="4154204">(</span><span class="ident" id="4154205">e</span>&nbsp;<span class="op" id="4154207">*</span><span class="ident" id="4154208">WriteError</span><span class="op" id="4154218">)</span>&nbsp;<span class="ident" id="4154220">Error</span><span class="op" id="4154225">(</span><span class="op" id="4154226">)</span>&nbsp;<span class="builtintype" id="4154228">string</span>&nbsp;<span class="op" id="4154235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154238">return</span>&nbsp;<span class="string" id="4154245">&#34;flate:&nbsp;write&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4154277">+</span>&nbsp;<span class="ident" id="4154279">strconv</span><span class="op" id="4154286">.</span><span class="ident" id="4154287">FormatInt</span><span class="op" id="4154296">(</span><span class="ident" id="4154297">e</span><span class="op" id="4154298">.</span><span class="ident" id="4154299">Offset</span><span class="op" id="4154305">,</span>&nbsp;<span class="num" id="4154307">10</span><span class="op" id="4154309">)</span>&nbsp;<span class="op" id="4154311">+</span>&nbsp;<span class="string" id="4154313">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4154318">+</span>&nbsp;<span class="ident" id="4154320">e</span><span class="op" id="4154321">.</span><span class="ident" id="4154322">Err</span><span class="op" id="4154325">.</span><span class="ident" id="4154326">Error</span><span class="op" id="4154331">(</span><span class="op" id="4154332">)</span><br>
<span class="lineno"></span><span class="op" id="4154334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4154337">//&nbsp;Resetter&nbsp;resets&nbsp;a&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;or&nbsp;NewReaderDict&nbsp;to</span><br>
<span class="lineno">60</span><span class="comment" id="4154411">//&nbsp;to&nbsp;switch&nbsp;to&nbsp;a&nbsp;new&nbsp;underlying&nbsp;Reader.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;ReadCloser</span><br>
<span class="lineno"></span><span class="comment" id="4154486">//&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4154522">type</span>&nbsp;<span class="ident" id="4154527">Resetter</span>&nbsp;<span class="keyword" id="4154536">interface</span>&nbsp;<span class="op" id="4154546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4154549">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data&nbsp;and&nbsp;resets&nbsp;the&nbsp;Resetter&nbsp;as&nbsp;if&nbsp;it&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4154623">//&nbsp;newly&nbsp;initialized&nbsp;with&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154668">Reset</span><span class="op" id="4154673">(</span><span class="ident" id="4154674">r</span>&nbsp;<span class="ident" id="4154676">io</span><span class="op" id="4154678">.</span><span class="ident" id="4154679">Reader</span><span class="op" id="4154685">,</span>&nbsp;<span class="ident" id="4154687">dict</span>&nbsp;<span class="op" id="4154692">[</span><span class="op" id="4154693">]</span><span class="builtintype" id="4154694">byte</span><span class="op" id="4154698">)</span>&nbsp;<span class="builtintype" id="4154700">error</span><br>
<span class="lineno"></span><span class="op" id="4154706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4154709">//&nbsp;Note&nbsp;that&nbsp;much&nbsp;of&nbsp;the&nbsp;implementation&nbsp;of&nbsp;huffmanDecoder&nbsp;is&nbsp;also&nbsp;copied</span><br>
<span class="lineno"></span><span class="comment" id="4154782">//&nbsp;into&nbsp;gen.go&nbsp;(in&nbsp;package&nbsp;main)&nbsp;for&nbsp;the&nbsp;purpose&nbsp;of&nbsp;precomputing&nbsp;the</span><br>
<span class="lineno">70</span><span class="comment" id="4154851">//&nbsp;fixed&nbsp;huffman&nbsp;tables&nbsp;so&nbsp;they&nbsp;can&nbsp;be&nbsp;included&nbsp;statically.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4154912">//&nbsp;The&nbsp;data&nbsp;structure&nbsp;for&nbsp;decoding&nbsp;Huffman&nbsp;tables&nbsp;is&nbsp;based&nbsp;on&nbsp;that&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4154982">//&nbsp;zlib.&nbsp;There&nbsp;is&nbsp;a&nbsp;lookup&nbsp;table&nbsp;of&nbsp;a&nbsp;fixed&nbsp;bit&nbsp;width&nbsp;(huffmanChunkBits),</span><br>
<span class="lineno"></span><span class="comment" id="4155056">//&nbsp;For&nbsp;codes&nbsp;smaller&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;there&nbsp;are&nbsp;multiple&nbsp;entries</span><br>
<span class="lineno">75</span><span class="comment" id="4155126">//&nbsp;(each&nbsp;combination&nbsp;of&nbsp;trailing&nbsp;bits&nbsp;has&nbsp;the&nbsp;same&nbsp;value).&nbsp;For&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4155195">//&nbsp;larger&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;the&nbsp;table&nbsp;contains&nbsp;a&nbsp;link&nbsp;to&nbsp;an&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="4155268">//&nbsp;table.&nbsp;The&nbsp;width&nbsp;of&nbsp;each&nbsp;entry&nbsp;in&nbsp;the&nbsp;link&nbsp;table&nbsp;is&nbsp;the&nbsp;maximum&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="4155340">//&nbsp;size&nbsp;minus&nbsp;the&nbsp;chunk&nbsp;width.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4155372">//&nbsp;Note&nbsp;that&nbsp;you&nbsp;can&nbsp;do&nbsp;a&nbsp;lookup&nbsp;in&nbsp;the&nbsp;table&nbsp;even&nbsp;without&nbsp;all&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4155440">//&nbsp;filled.&nbsp;Since&nbsp;the&nbsp;extra&nbsp;bits&nbsp;are&nbsp;zero,&nbsp;and&nbsp;the&nbsp;DEFLATE&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4155512">//&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;shorter&nbsp;codes&nbsp;come&nbsp;before&nbsp;longer&nbsp;ones,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4155581">//&nbsp;bit&nbsp;length&nbsp;estimate&nbsp;in&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;lower&nbsp;bound&nbsp;on&nbsp;the&nbsp;actual</span><br>
<span class="lineno"></span><span class="comment" id="4155649">//&nbsp;number&nbsp;of&nbsp;bits.</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4155669">//&nbsp;chunk&nbsp;&amp;&nbsp;15&nbsp;is&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4155701">//&nbsp;chunk&nbsp;&gt;&gt;&nbsp;4&nbsp;is&nbsp;value,&nbsp;including&nbsp;table&nbsp;link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4155747">const</span>&nbsp;<span class="op" id="4155753">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155756">huffmanChunkBits</span>&nbsp;&nbsp;<span class="op" id="4155774">=</span>&nbsp;<span class="num" id="4155776">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155779">huffmanNumChunks</span>&nbsp;&nbsp;<span class="op" id="4155797">=</span>&nbsp;<span class="num" id="4155799">1</span>&nbsp;<span class="op" id="4155801">&lt;&lt;</span>&nbsp;<span class="ident" id="4155804">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155822">huffmanCountMask</span>&nbsp;&nbsp;<span class="op" id="4155840">=</span>&nbsp;<span class="num" id="4155842">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155846">huffmanValueShift</span>&nbsp;<span class="op" id="4155864">=</span>&nbsp;<span class="num" id="4155866">4</span><br>
<span class="lineno"></span><span class="op" id="4155868">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="4155871">type</span>&nbsp;<span class="ident" id="4155876">huffmanDecoder</span>&nbsp;<span class="keyword" id="4155891">struct</span>&nbsp;<span class="op" id="4155898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155901">min</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4155910">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4155935">//&nbsp;the&nbsp;minimum&nbsp;code&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155963">chunks</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4155972">[</span><span class="ident" id="4155973">huffmanNumChunks</span><span class="op" id="4155989">]</span><span class="builtintype" id="4155990">uint32</span>&nbsp;<span class="comment" id="4155997">//&nbsp;chunks&nbsp;as&nbsp;described&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156027">links</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4156036">[</span><span class="op" id="4156037">]</span><span class="op" id="4156038">[</span><span class="op" id="4156039">]</span><span class="builtintype" id="4156040">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4156061">//&nbsp;overflow&nbsp;links</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156080">linkMask</span>&nbsp;<span class="builtintype" id="4156089">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4156114">//&nbsp;mask&nbsp;the&nbsp;width&nbsp;of&nbsp;the&nbsp;link&nbsp;table</span><br>
<span class="lineno"></span><span class="op" id="4156150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4156153">//&nbsp;Initialize&nbsp;Huffman&nbsp;decoding&nbsp;tables&nbsp;from&nbsp;array&nbsp;of&nbsp;code&nbsp;lengths.</span><br>
<span class="lineno"></span><span class="keyword" id="4156219">func</span>&nbsp;<span class="op" id="4156224">(</span><span class="ident" id="4156225">h</span>&nbsp;<span class="op" id="4156227">*</span><span class="ident" id="4156228">huffmanDecoder</span><span class="op" id="4156242">)</span>&nbsp;<span class="ident" id="4156244">init</span><span class="op" id="4156248">(</span><span class="ident" id="4156249">bits</span>&nbsp;<span class="op" id="4156254">[</span><span class="op" id="4156255">]</span><span class="builtintype" id="4156256">int</span><span class="op" id="4156259">)</span>&nbsp;<span class="builtintype" id="4156261">bool</span>&nbsp;<span class="op" id="4156266">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156269">if</span>&nbsp;<span class="ident" id="4156272">h</span><span class="op" id="4156273">.</span><span class="ident" id="4156274">min</span>&nbsp;<span class="op" id="4156278">!=</span>&nbsp;<span class="num" id="4156281">0</span>&nbsp;<span class="op" id="4156283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156287">*</span><span class="ident" id="4156288">h</span>&nbsp;<span class="op" id="4156290">=</span>&nbsp;<span class="ident" id="4156292">huffmanDecoder</span><span class="op" id="4156306">{</span><span class="op" id="4156307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4156314">//&nbsp;Count&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;each&nbsp;length,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4156356">//&nbsp;compute&nbsp;min&nbsp;and&nbsp;max&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156388">var</span>&nbsp;<span class="ident" id="4156392">count</span>&nbsp;<span class="op" id="4156398">[</span><span class="ident" id="4156399">maxCodeLen</span><span class="op" id="4156409">]</span><span class="builtintype" id="4156410">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156415">var</span>&nbsp;<span class="ident" id="4156419">min</span><span class="op" id="4156422">,</span>&nbsp;<span class="ident" id="4156424">max</span>&nbsp;<span class="builtintype" id="4156428">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156433">for</span>&nbsp;<span class="ident" id="4156437">_</span><span class="op" id="4156438">,</span>&nbsp;<span class="ident" id="4156440">n</span>&nbsp;<span class="op" id="4156442">:=</span>&nbsp;<span class="keyword" id="4156445">range</span>&nbsp;<span class="ident" id="4156451">bits</span>&nbsp;<span class="op" id="4156456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156460">if</span>&nbsp;<span class="ident" id="4156463">n</span>&nbsp;<span class="op" id="4156465">==</span>&nbsp;<span class="num" id="4156468">0</span>&nbsp;<span class="op" id="4156470">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156475">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156490">if</span>&nbsp;<span class="ident" id="4156493">min</span>&nbsp;<span class="op" id="4156497">==</span>&nbsp;<span class="num" id="4156500">0</span>&nbsp;<span class="op" id="4156502">||</span>&nbsp;<span class="ident" id="4156505">n</span>&nbsp;<span class="op" id="4156507">&lt;</span>&nbsp;<span class="ident" id="4156509">min</span>&nbsp;<span class="op" id="4156513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156518">min</span>&nbsp;<span class="op" id="4156522">=</span>&nbsp;<span class="ident" id="4156524">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156528">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156532">if</span>&nbsp;<span class="ident" id="4156535">n</span>&nbsp;<span class="op" id="4156537">&gt;</span>&nbsp;<span class="ident" id="4156539">max</span>&nbsp;<span class="op" id="4156543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156548">max</span>&nbsp;<span class="op" id="4156552">=</span>&nbsp;<span class="ident" id="4156554">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156562">count</span><span class="op" id="4156567">[</span><span class="ident" id="4156568">n</span><span class="op" id="4156569">]</span><span class="op" id="4156570">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156574">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156577">if</span>&nbsp;<span class="ident" id="4156580">max</span>&nbsp;<span class="op" id="4156584">==</span>&nbsp;<span class="num" id="4156587">0</span>&nbsp;<span class="op" id="4156589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156593">return</span>&nbsp;<span class="builtintype" id="4156600">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156611">h</span><span class="op" id="4156612">.</span><span class="ident" id="4156613">min</span>&nbsp;<span class="op" id="4156617">=</span>&nbsp;<span class="ident" id="4156619">min</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156624">var</span>&nbsp;<span class="ident" id="4156628">linkBits</span>&nbsp;<span class="builtintype" id="4156637">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156643">var</span>&nbsp;<span class="ident" id="4156647">numLinks</span>&nbsp;<span class="builtintype" id="4156656">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156661">if</span>&nbsp;<span class="ident" id="4156664">max</span>&nbsp;<span class="op" id="4156668">&gt;</span>&nbsp;<span class="ident" id="4156670">huffmanChunkBits</span>&nbsp;<span class="op" id="4156687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156691">linkBits</span>&nbsp;<span class="op" id="4156700">=</span>&nbsp;<span class="builtintype" id="4156702">uint</span><span class="op" id="4156706">(</span><span class="ident" id="4156707">max</span><span class="op" id="4156710">)</span>&nbsp;<span class="op" id="4156712">-</span>&nbsp;<span class="ident" id="4156714">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156733">numLinks</span>&nbsp;<span class="op" id="4156742">=</span>&nbsp;<span class="num" id="4156744">1</span>&nbsp;<span class="op" id="4156746">&lt;&lt;</span>&nbsp;<span class="ident" id="4156749">linkBits</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156760">h</span><span class="op" id="4156761">.</span><span class="ident" id="4156762">linkMask</span>&nbsp;<span class="op" id="4156771">=</span>&nbsp;<span class="builtintype" id="4156773">uint32</span><span class="op" id="4156779">(</span><span class="ident" id="4156780">numLinks</span>&nbsp;<span class="op" id="4156789">-</span>&nbsp;<span class="num" id="4156791">1</span><span class="op" id="4156792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156798">code</span>&nbsp;<span class="op" id="4156803">:=</span>&nbsp;<span class="num" id="4156806">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156809">var</span>&nbsp;<span class="ident" id="4156813">nextcode</span>&nbsp;<span class="op" id="4156822">[</span><span class="ident" id="4156823">maxCodeLen</span><span class="op" id="4156833">]</span><span class="builtintype" id="4156834">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156839">for</span>&nbsp;<span class="ident" id="4156843">i</span>&nbsp;<span class="op" id="4156845">:=</span>&nbsp;<span class="ident" id="4156848">min</span><span class="op" id="4156851">;</span>&nbsp;<span class="ident" id="4156853">i</span>&nbsp;<span class="op" id="4156855">&lt;=</span>&nbsp;<span class="ident" id="4156858">max</span><span class="op" id="4156861">;</span>&nbsp;<span class="ident" id="4156863">i</span><span class="op" id="4156864">++</span>&nbsp;<span class="op" id="4156867">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156871">if</span>&nbsp;<span class="ident" id="4156874">i</span>&nbsp;<span class="op" id="4156876">==</span>&nbsp;<span class="ident" id="4156879">huffmanChunkBits</span><span class="op" id="4156895">+</span><span class="num" id="4156896">1</span>&nbsp;<span class="op" id="4156898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4156903">//&nbsp;create&nbsp;link&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156928">link</span>&nbsp;<span class="op" id="4156933">:=</span>&nbsp;<span class="ident" id="4156936">code</span>&nbsp;<span class="op" id="4156941">&gt;&gt;</span>&nbsp;<span class="num" id="4156944">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156949">if</span>&nbsp;<span class="ident" id="4156952">huffmanNumChunks</span>&nbsp;<span class="op" id="4156969">&lt;</span>&nbsp;<span class="ident" id="4156971">link</span>&nbsp;<span class="op" id="4156976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156982">return</span>&nbsp;<span class="builtintype" id="4156989">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157003">h</span><span class="op" id="4157004">.</span><span class="ident" id="4157005">links</span>&nbsp;<span class="op" id="4157011">=</span>&nbsp;<span class="builtinfunc" id="4157013">make</span><span class="op" id="4157017">(</span><span class="op" id="4157018">[</span><span class="op" id="4157019">]</span><span class="op" id="4157020">[</span><span class="op" id="4157021">]</span><span class="builtintype" id="4157022">uint32</span><span class="op" id="4157028">,</span>&nbsp;<span class="ident" id="4157030">huffmanNumChunks</span><span class="op" id="4157046">-</span><span class="ident" id="4157047">link</span><span class="op" id="4157051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157056">for</span>&nbsp;<span class="ident" id="4157060">j</span>&nbsp;<span class="op" id="4157062">:=</span>&nbsp;<span class="builtintype" id="4157065">uint</span><span class="op" id="4157069">(</span><span class="ident" id="4157070">link</span><span class="op" id="4157074">)</span><span class="op" id="4157075">;</span>&nbsp;<span class="ident" id="4157077">j</span>&nbsp;<span class="op" id="4157079">&lt;</span>&nbsp;<span class="ident" id="4157081">huffmanNumChunks</span><span class="op" id="4157097">;</span>&nbsp;<span class="ident" id="4157099">j</span><span class="op" id="4157100">++</span>&nbsp;<span class="op" id="4157103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157109">reverse</span>&nbsp;<span class="op" id="4157117">:=</span>&nbsp;<span class="builtintype" id="4157120">int</span><span class="op" id="4157123">(</span><span class="ident" id="4157124">reverseByte</span><span class="op" id="4157135">[</span><span class="ident" id="4157136">j</span><span class="op" id="4157137">&gt;&gt;</span><span class="num" id="4157139">8</span><span class="op" id="4157140">]</span><span class="op" id="4157141">)</span>&nbsp;<span class="op" id="4157143">|</span>&nbsp;<span class="builtintype" id="4157145">int</span><span class="op" id="4157148">(</span><span class="ident" id="4157149">reverseByte</span><span class="op" id="4157160">[</span><span class="ident" id="4157161">j</span><span class="op" id="4157162">&amp;</span><span class="num" id="4157163">0xff</span><span class="op" id="4157167">]</span><span class="op" id="4157168">)</span><span class="op" id="4157169">&lt;&lt;</span><span class="num" id="4157171">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157177">reverse</span>&nbsp;<span class="op" id="4157185">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4157189">uint</span><span class="op" id="4157193">(</span><span class="num" id="4157194">16</span>&nbsp;<span class="op" id="4157197">-</span>&nbsp;<span class="ident" id="4157199">huffmanChunkBits</span><span class="op" id="4157215">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157221">off</span>&nbsp;<span class="op" id="4157225">:=</span>&nbsp;<span class="ident" id="4157228">j</span>&nbsp;<span class="op" id="4157230">-</span>&nbsp;<span class="builtintype" id="4157232">uint</span><span class="op" id="4157236">(</span><span class="ident" id="4157237">link</span><span class="op" id="4157241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157247">h</span><span class="op" id="4157248">.</span><span class="ident" id="4157249">chunks</span><span class="op" id="4157255">[</span><span class="ident" id="4157256">reverse</span><span class="op" id="4157263">]</span>&nbsp;<span class="op" id="4157265">=</span>&nbsp;<span class="builtintype" id="4157267">uint32</span><span class="op" id="4157273">(</span><span class="ident" id="4157274">off</span><span class="op" id="4157277">&lt;&lt;</span><span class="ident" id="4157279">huffmanValueShift</span>&nbsp;<span class="op" id="4157297">+</span>&nbsp;<span class="builtintype" id="4157299">uint</span><span class="op" id="4157303">(</span><span class="ident" id="4157304">i</span><span class="op" id="4157305">)</span><span class="op" id="4157306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157312">h</span><span class="op" id="4157313">.</span><span class="ident" id="4157314">links</span><span class="op" id="4157319">[</span><span class="ident" id="4157320">off</span><span class="op" id="4157323">]</span>&nbsp;<span class="op" id="4157325">=</span>&nbsp;<span class="builtinfunc" id="4157327">make</span><span class="op" id="4157331">(</span><span class="op" id="4157332">[</span><span class="op" id="4157333">]</span><span class="builtintype" id="4157334">uint32</span><span class="op" id="4157340">,</span>&nbsp;<span class="num" id="4157342">1</span><span class="op" id="4157343">&lt;&lt;</span><span class="ident" id="4157345">linkBits</span><span class="op" id="4157353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157362">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157366">n</span>&nbsp;<span class="op" id="4157368">:=</span>&nbsp;<span class="ident" id="4157371">count</span><span class="op" id="4157376">[</span><span class="ident" id="4157377">i</span><span class="op" id="4157378">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157382">nextcode</span><span class="op" id="4157390">[</span><span class="ident" id="4157391">i</span><span class="op" id="4157392">]</span>&nbsp;<span class="op" id="4157394">=</span>&nbsp;<span class="ident" id="4157396">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157403">code</span>&nbsp;<span class="op" id="4157408">+=</span>&nbsp;<span class="ident" id="4157411">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157415">code</span>&nbsp;<span class="op" id="4157420">&lt;&lt;=</span>&nbsp;<span class="num" id="4157424">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157427">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157431">for</span>&nbsp;<span class="ident" id="4157435">i</span><span class="op" id="4157436">,</span>&nbsp;<span class="ident" id="4157438">n</span>&nbsp;<span class="op" id="4157440">:=</span>&nbsp;<span class="keyword" id="4157443">range</span>&nbsp;<span class="ident" id="4157449">bits</span>&nbsp;<span class="op" id="4157454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157458">if</span>&nbsp;<span class="ident" id="4157461">n</span>&nbsp;<span class="op" id="4157463">==</span>&nbsp;<span class="num" id="4157466">0</span>&nbsp;<span class="op" id="4157468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157473">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157484">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157488">code</span>&nbsp;<span class="op" id="4157493">:=</span>&nbsp;<span class="ident" id="4157496">nextcode</span><span class="op" id="4157504">[</span><span class="ident" id="4157505">n</span><span class="op" id="4157506">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157510">nextcode</span><span class="op" id="4157518">[</span><span class="ident" id="4157519">n</span><span class="op" id="4157520">]</span><span class="op" id="4157521">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157526">chunk</span>&nbsp;<span class="op" id="4157532">:=</span>&nbsp;<span class="builtintype" id="4157535">uint32</span><span class="op" id="4157541">(</span><span class="ident" id="4157542">i</span><span class="op" id="4157543">&lt;&lt;</span><span class="ident" id="4157545">huffmanValueShift</span>&nbsp;<span class="op" id="4157563">|</span>&nbsp;<span class="ident" id="4157565">n</span><span class="op" id="4157566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157570">reverse</span>&nbsp;<span class="op" id="4157578">:=</span>&nbsp;<span class="builtintype" id="4157581">int</span><span class="op" id="4157584">(</span><span class="ident" id="4157585">reverseByte</span><span class="op" id="4157596">[</span><span class="ident" id="4157597">code</span><span class="op" id="4157601">&gt;&gt;</span><span class="num" id="4157603">8</span><span class="op" id="4157604">]</span><span class="op" id="4157605">)</span>&nbsp;<span class="op" id="4157607">|</span>&nbsp;<span class="builtintype" id="4157609">int</span><span class="op" id="4157612">(</span><span class="ident" id="4157613">reverseByte</span><span class="op" id="4157624">[</span><span class="ident" id="4157625">code</span><span class="op" id="4157629">&amp;</span><span class="num" id="4157630">0xff</span><span class="op" id="4157634">]</span><span class="op" id="4157635">)</span><span class="op" id="4157636">&lt;&lt;</span><span class="num" id="4157638">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157642">reverse</span>&nbsp;<span class="op" id="4157650">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4157654">uint</span><span class="op" id="4157658">(</span><span class="num" id="4157659">16</span>&nbsp;<span class="op" id="4157662">-</span>&nbsp;<span class="ident" id="4157664">n</span><span class="op" id="4157665">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157669">if</span>&nbsp;<span class="ident" id="4157672">n</span>&nbsp;<span class="op" id="4157674">&lt;=</span>&nbsp;<span class="ident" id="4157677">huffmanChunkBits</span>&nbsp;<span class="op" id="4157694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157699">for</span>&nbsp;<span class="ident" id="4157703">off</span>&nbsp;<span class="op" id="4157707">:=</span>&nbsp;<span class="ident" id="4157710">reverse</span><span class="op" id="4157717">;</span>&nbsp;<span class="ident" id="4157719">off</span>&nbsp;<span class="op" id="4157723">&lt;</span>&nbsp;<span class="ident" id="4157725">huffmanNumChunks</span><span class="op" id="4157741">;</span>&nbsp;<span class="ident" id="4157743">off</span>&nbsp;<span class="op" id="4157747">+=</span>&nbsp;<span class="num" id="4157750">1</span>&nbsp;<span class="op" id="4157752">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4157755">uint</span><span class="op" id="4157759">(</span><span class="ident" id="4157760">n</span><span class="op" id="4157761">)</span>&nbsp;<span class="op" id="4157763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157769">h</span><span class="op" id="4157770">.</span><span class="ident" id="4157771">chunks</span><span class="op" id="4157777">[</span><span class="ident" id="4157778">off</span><span class="op" id="4157781">]</span>&nbsp;<span class="op" id="4157783">=</span>&nbsp;<span class="ident" id="4157785">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157798">}</span>&nbsp;<span class="keyword" id="4157800">else</span>&nbsp;<span class="op" id="4157805">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157810">value</span>&nbsp;<span class="op" id="4157816">:=</span>&nbsp;<span class="ident" id="4157819">h</span><span class="op" id="4157820">.</span><span class="ident" id="4157821">chunks</span><span class="op" id="4157827">[</span><span class="ident" id="4157828">reverse</span><span class="op" id="4157835">&amp;</span><span class="op" id="4157836">(</span><span class="ident" id="4157837">huffmanNumChunks</span><span class="op" id="4157853">-</span><span class="num" id="4157854">1</span><span class="op" id="4157855">)</span><span class="op" id="4157856">]</span>&nbsp;<span class="op" id="4157858">&gt;&gt;</span>&nbsp;<span class="ident" id="4157861">huffmanValueShift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157882">if</span>&nbsp;<span class="ident" id="4157885">value</span>&nbsp;<span class="op" id="4157891">&gt;=</span>&nbsp;<span class="builtintype" id="4157894">uint32</span><span class="op" id="4157900">(</span><span class="builtinfunc" id="4157901">len</span><span class="op" id="4157904">(</span><span class="ident" id="4157905">h</span><span class="op" id="4157906">.</span><span class="ident" id="4157907">links</span><span class="op" id="4157912">)</span><span class="op" id="4157913">)</span>&nbsp;<span class="op" id="4157915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157921">return</span>&nbsp;<span class="builtintype" id="4157928">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157942">linktab</span>&nbsp;<span class="op" id="4157950">:=</span>&nbsp;<span class="ident" id="4157953">h</span><span class="op" id="4157954">.</span><span class="ident" id="4157955">links</span><span class="op" id="4157960">[</span><span class="ident" id="4157961">value</span><span class="op" id="4157966">]</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157971">reverse</span>&nbsp;<span class="op" id="4157979">&gt;&gt;=</span>&nbsp;<span class="ident" id="4157983">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158003">for</span>&nbsp;<span class="ident" id="4158007">off</span>&nbsp;<span class="op" id="4158011">:=</span>&nbsp;<span class="ident" id="4158014">reverse</span><span class="op" id="4158021">;</span>&nbsp;<span class="ident" id="4158023">off</span>&nbsp;<span class="op" id="4158027">&lt;</span>&nbsp;<span class="ident" id="4158029">numLinks</span><span class="op" id="4158037">;</span>&nbsp;<span class="ident" id="4158039">off</span>&nbsp;<span class="op" id="4158043">+=</span>&nbsp;<span class="num" id="4158046">1</span>&nbsp;<span class="op" id="4158048">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4158051">uint</span><span class="op" id="4158055">(</span><span class="ident" id="4158056">n</span><span class="op" id="4158057">-</span><span class="ident" id="4158058">huffmanChunkBits</span><span class="op" id="4158074">)</span>&nbsp;<span class="op" id="4158076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158082">linktab</span><span class="op" id="4158089">[</span><span class="ident" id="4158090">off</span><span class="op" id="4158093">]</span>&nbsp;<span class="op" id="4158095">=</span>&nbsp;<span class="ident" id="4158097">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4158106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4158110">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4158113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158116">return</span>&nbsp;<span class="builtintype" id="4158123">true</span><br>
<span class="lineno"></span><span class="op" id="4158128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4158131">//&nbsp;The&nbsp;actual&nbsp;read&nbsp;interface&nbsp;needed&nbsp;by&nbsp;NewReader.</span><br>
<span class="lineno">190</span><span class="comment" id="4158181">//&nbsp;If&nbsp;the&nbsp;passed&nbsp;in&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,</span><br>
<span class="lineno"></span><span class="comment" id="4158240">//&nbsp;the&nbsp;NewReader&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="4158291">type</span>&nbsp;<span class="ident" id="4158296">Reader</span>&nbsp;<span class="keyword" id="4158303">interface</span>&nbsp;<span class="op" id="4158313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158316">io</span><span class="op" id="4158318">.</span><span class="ident" id="4158319">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158327">io</span><span class="op" id="4158329">.</span><span class="ident" id="4158330">ByteReader</span><br>
<span class="lineno">195</span><span class="op" id="4158341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4158344">//&nbsp;Decompress&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4158365">type</span>&nbsp;<span class="ident" id="4158370">decompressor</span>&nbsp;<span class="keyword" id="4158383">struct</span>&nbsp;<span class="op" id="4158390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158393">//&nbsp;Input&nbsp;source.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158411">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4158419">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158427">roffset</span>&nbsp;<span class="ident" id="4158435">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158442">woffset</span>&nbsp;<span class="ident" id="4158450">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158458">//&nbsp;Input&nbsp;bits,&nbsp;in&nbsp;top&nbsp;of&nbsp;b.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158487">b</span>&nbsp;&nbsp;<span class="builtintype" id="4158490">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158498">nb</span>&nbsp;<span class="builtintype" id="4158501">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158508">//&nbsp;Huffman&nbsp;decoders&nbsp;for&nbsp;literal/length,&nbsp;distance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158559">h1</span><span class="op" id="4158561">,</span>&nbsp;<span class="ident" id="4158563">h2</span>&nbsp;<span class="ident" id="4158566">huffmanDecoder</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158583">//&nbsp;Length&nbsp;arrays&nbsp;used&nbsp;to&nbsp;define&nbsp;Huffman&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158631">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4158640">*</span><span class="op" id="4158641">[</span><span class="ident" id="4158642">maxLit</span>&nbsp;<span class="op" id="4158649">+</span>&nbsp;<span class="ident" id="4158651">maxDist</span><span class="op" id="4158658">]</span><span class="builtintype" id="4158659">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158664">codebits</span>&nbsp;<span class="op" id="4158673">*</span><span class="op" id="4158674">[</span><span class="ident" id="4158675">numCodes</span><span class="op" id="4158683">]</span><span class="builtintype" id="4158684">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158690">//&nbsp;Output&nbsp;history,&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158718">hist</span>&nbsp;&nbsp;<span class="op" id="4158724">*</span><span class="op" id="4158725">[</span><span class="ident" id="4158726">maxHist</span><span class="op" id="4158733">]</span><span class="builtintype" id="4158734">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158740">hp</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4158746">int</span>&nbsp;&nbsp;<span class="comment" id="4158751">//&nbsp;current&nbsp;output&nbsp;position&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158789">hw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4158795">int</span>&nbsp;&nbsp;<span class="comment" id="4158800">//&nbsp;have&nbsp;written&nbsp;hist[0:hw]&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158836">hfull</span>&nbsp;<span class="builtintype" id="4158842">bool</span>&nbsp;<span class="comment" id="4158847">//&nbsp;buffer&nbsp;has&nbsp;filled&nbsp;at&nbsp;least&nbsp;once</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158884">//&nbsp;Temporary&nbsp;buffer&nbsp;(avoids&nbsp;repeated&nbsp;allocation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158935">buf</span>&nbsp;<span class="op" id="4158939">[</span><span class="num" id="4158940">4</span><span class="op" id="4158941">]</span><span class="builtintype" id="4158942">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158949">//&nbsp;Next&nbsp;step&nbsp;in&nbsp;the&nbsp;decompression,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158985">//&nbsp;and&nbsp;decompression&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159014">step</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4159023">func</span><span class="op" id="4159027">(</span><span class="op" id="4159028">*</span><span class="ident" id="4159029">decompressor</span><span class="op" id="4159041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159044">final</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4159053">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159059">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4159068">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159075">toRead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4159084">[</span><span class="op" id="4159085">]</span><span class="builtintype" id="4159086">byte</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159092">hl</span><span class="op" id="4159094">,</span>&nbsp;<span class="ident" id="4159096">hd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4159101">*</span><span class="ident" id="4159102">huffmanDecoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159118">copyLen</span>&nbsp;&nbsp;<span class="builtintype" id="4159127">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159132">copyDist</span>&nbsp;<span class="builtintype" id="4159141">int</span><br>
<span class="lineno"></span><span class="op" id="4159145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4159148">func</span>&nbsp;<span class="op" id="4159153">(</span><span class="ident" id="4159154">f</span>&nbsp;<span class="op" id="4159156">*</span><span class="ident" id="4159157">decompressor</span><span class="op" id="4159169">)</span>&nbsp;<span class="ident" id="4159171">nextBlock</span><span class="op" id="4159180">(</span><span class="op" id="4159181">)</span>&nbsp;<span class="op" id="4159183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159186">if</span>&nbsp;<span class="ident" id="4159189">f</span><span class="op" id="4159190">.</span><span class="ident" id="4159191">final</span>&nbsp;<span class="op" id="4159197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159201">if</span>&nbsp;<span class="ident" id="4159204">f</span><span class="op" id="4159205">.</span><span class="ident" id="4159206">hw</span>&nbsp;<span class="op" id="4159209">!=</span>&nbsp;<span class="ident" id="4159212">f</span><span class="op" id="4159213">.</span><span class="ident" id="4159214">hp</span>&nbsp;<span class="op" id="4159217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159222">f</span><span class="op" id="4159223">.</span><span class="ident" id="4159224">flush</span><span class="op" id="4159229">(</span><span class="op" id="4159230">(</span><span class="op" id="4159231">*</span><span class="ident" id="4159232">decompressor</span><span class="op" id="4159244">)</span><span class="op" id="4159245">.</span><span class="ident" id="4159246">nextBlock</span><span class="op" id="4159255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159260">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159273">f</span><span class="op" id="4159274">.</span><span class="ident" id="4159275">err</span>&nbsp;<span class="op" id="4159279">=</span>&nbsp;<span class="ident" id="4159281">io</span><span class="op" id="4159283">.</span><span class="ident" id="4159284">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159290">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159301">for</span>&nbsp;<span class="ident" id="4159305">f</span><span class="op" id="4159306">.</span><span class="ident" id="4159307">nb</span>&nbsp;<span class="op" id="4159310">&lt;</span>&nbsp;<span class="num" id="4159312">1</span><span class="op" id="4159313">+</span><span class="num" id="4159314">2</span>&nbsp;<span class="op" id="4159316">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159320">if</span>&nbsp;<span class="ident" id="4159323">f</span><span class="op" id="4159324">.</span><span class="ident" id="4159325">err</span>&nbsp;<span class="op" id="4159329">=</span>&nbsp;<span class="ident" id="4159331">f</span><span class="op" id="4159332">.</span><span class="ident" id="4159333">moreBits</span><span class="op" id="4159341">(</span><span class="op" id="4159342">)</span><span class="op" id="4159343">;</span>&nbsp;<span class="ident" id="4159345">f</span><span class="op" id="4159346">.</span><span class="ident" id="4159347">err</span>&nbsp;<span class="op" id="4159351">!=</span>&nbsp;<span class="ident" id="4159354">nil</span>&nbsp;<span class="op" id="4159358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159363">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159378">f</span><span class="op" id="4159379">.</span><span class="ident" id="4159380">final</span>&nbsp;<span class="op" id="4159386">=</span>&nbsp;<span class="ident" id="4159388">f</span><span class="op" id="4159389">.</span><span class="ident" id="4159390">b</span><span class="op" id="4159391">&amp;</span><span class="num" id="4159392">1</span>&nbsp;<span class="op" id="4159394">==</span>&nbsp;<span class="num" id="4159397">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159400">f</span><span class="op" id="4159401">.</span><span class="ident" id="4159402">b</span>&nbsp;<span class="op" id="4159404">&gt;&gt;=</span>&nbsp;<span class="num" id="4159408">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159411">typ</span>&nbsp;<span class="op" id="4159415">:=</span>&nbsp;<span class="ident" id="4159418">f</span><span class="op" id="4159419">.</span><span class="ident" id="4159420">b</span>&nbsp;<span class="op" id="4159422">&amp;</span>&nbsp;<span class="num" id="4159424">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159427">f</span><span class="op" id="4159428">.</span><span class="ident" id="4159429">b</span>&nbsp;<span class="op" id="4159431">&gt;&gt;=</span>&nbsp;<span class="num" id="4159435">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159438">f</span><span class="op" id="4159439">.</span><span class="ident" id="4159440">nb</span>&nbsp;<span class="op" id="4159443">-=</span>&nbsp;<span class="num" id="4159446">1</span>&nbsp;<span class="op" id="4159448">+</span>&nbsp;<span class="num" id="4159450">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159453">switch</span>&nbsp;<span class="ident" id="4159460">typ</span>&nbsp;<span class="op" id="4159464">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159467">case</span>&nbsp;<span class="num" id="4159472">0</span><span class="op" id="4159473">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159477">f</span><span class="op" id="4159478">.</span><span class="ident" id="4159479">dataBlock</span><span class="op" id="4159488">(</span><span class="op" id="4159489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159492">case</span>&nbsp;<span class="num" id="4159497">1</span><span class="op" id="4159498">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4159502">//&nbsp;compressed,&nbsp;fixed&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159540">f</span><span class="op" id="4159541">.</span><span class="ident" id="4159542">hl</span>&nbsp;<span class="op" id="4159545">=</span>&nbsp;<span class="op" id="4159547">&amp;</span><span class="ident" id="4159548">fixedHuffmanDecoder</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159570">f</span><span class="op" id="4159571">.</span><span class="ident" id="4159572">hd</span>&nbsp;<span class="op" id="4159575">=</span>&nbsp;<span class="ident" id="4159577">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159583">f</span><span class="op" id="4159584">.</span><span class="ident" id="4159585">huffmanBlock</span><span class="op" id="4159597">(</span><span class="op" id="4159598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159601">case</span>&nbsp;<span class="num" id="4159606">2</span><span class="op" id="4159607">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4159611">//&nbsp;compressed,&nbsp;dynamic&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159651">if</span>&nbsp;<span class="ident" id="4159654">f</span><span class="op" id="4159655">.</span><span class="ident" id="4159656">err</span>&nbsp;<span class="op" id="4159660">=</span>&nbsp;<span class="ident" id="4159662">f</span><span class="op" id="4159663">.</span><span class="ident" id="4159664">readHuffman</span><span class="op" id="4159675">(</span><span class="op" id="4159676">)</span><span class="op" id="4159677">;</span>&nbsp;<span class="ident" id="4159679">f</span><span class="op" id="4159680">.</span><span class="ident" id="4159681">err</span>&nbsp;<span class="op" id="4159685">!=</span>&nbsp;<span class="ident" id="4159688">nil</span>&nbsp;<span class="op" id="4159692">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159697">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159709">f</span><span class="op" id="4159710">.</span><span class="ident" id="4159711">hl</span>&nbsp;<span class="op" id="4159714">=</span>&nbsp;<span class="op" id="4159716">&amp;</span><span class="ident" id="4159717">f</span><span class="op" id="4159718">.</span><span class="ident" id="4159719">h1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159724">f</span><span class="op" id="4159725">.</span><span class="ident" id="4159726">hd</span>&nbsp;<span class="op" id="4159729">=</span>&nbsp;<span class="op" id="4159731">&amp;</span><span class="ident" id="4159732">f</span><span class="op" id="4159733">.</span><span class="ident" id="4159734">h2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159739">f</span><span class="op" id="4159740">.</span><span class="ident" id="4159741">huffmanBlock</span><span class="op" id="4159753">(</span><span class="op" id="4159754">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159757">default</span><span class="op" id="4159764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4159768">//&nbsp;3&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159788">f</span><span class="op" id="4159789">.</span><span class="ident" id="4159790">err</span>&nbsp;<span class="op" id="4159794">=</span>&nbsp;<span class="ident" id="4159796">CorruptInputError</span><span class="op" id="4159813">(</span><span class="ident" id="4159814">f</span><span class="op" id="4159815">.</span><span class="ident" id="4159816">roffset</span><span class="op" id="4159823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159826">}</span><br>
<span class="lineno"></span><span class="op" id="4159828">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="4159831">func</span>&nbsp;<span class="op" id="4159836">(</span><span class="ident" id="4159837">f</span>&nbsp;<span class="op" id="4159839">*</span><span class="ident" id="4159840">decompressor</span><span class="op" id="4159852">)</span>&nbsp;<span class="ident" id="4159854">Read</span><span class="op" id="4159858">(</span><span class="ident" id="4159859">b</span>&nbsp;<span class="op" id="4159861">[</span><span class="op" id="4159862">]</span><span class="builtintype" id="4159863">byte</span><span class="op" id="4159867">)</span>&nbsp;<span class="op" id="4159869">(</span><span class="builtintype" id="4159870">int</span><span class="op" id="4159873">,</span>&nbsp;<span class="builtintype" id="4159875">error</span><span class="op" id="4159880">)</span>&nbsp;<span class="op" id="4159882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159885">for</span>&nbsp;<span class="op" id="4159889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159893">if</span>&nbsp;<span class="builtinfunc" id="4159896">len</span><span class="op" id="4159899">(</span><span class="ident" id="4159900">f</span><span class="op" id="4159901">.</span><span class="ident" id="4159902">toRead</span><span class="op" id="4159908">)</span>&nbsp;<span class="op" id="4159910">&gt;</span>&nbsp;<span class="num" id="4159912">0</span>&nbsp;<span class="op" id="4159914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159919">n</span>&nbsp;<span class="op" id="4159921">:=</span>&nbsp;<span class="builtinfunc" id="4159924">copy</span><span class="op" id="4159928">(</span><span class="ident" id="4159929">b</span><span class="op" id="4159930">,</span>&nbsp;<span class="ident" id="4159932">f</span><span class="op" id="4159933">.</span><span class="ident" id="4159934">toRead</span><span class="op" id="4159940">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159945">f</span><span class="op" id="4159946">.</span><span class="ident" id="4159947">toRead</span>&nbsp;<span class="op" id="4159954">=</span>&nbsp;<span class="ident" id="4159956">f</span><span class="op" id="4159957">.</span><span class="ident" id="4159958">toRead</span><span class="op" id="4159964">[</span><span class="ident" id="4159965">n</span><span class="op" id="4159966">:</span><span class="op" id="4159967">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159972">return</span>&nbsp;<span class="ident" id="4159979">n</span><span class="op" id="4159980">,</span>&nbsp;<span class="ident" id="4159982">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159992">if</span>&nbsp;<span class="ident" id="4159995">f</span><span class="op" id="4159996">.</span><span class="ident" id="4159997">err</span>&nbsp;<span class="op" id="4160001">!=</span>&nbsp;<span class="ident" id="4160004">nil</span>&nbsp;<span class="op" id="4160008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160013">return</span>&nbsp;<span class="num" id="4160020">0</span><span class="op" id="4160021">,</span>&nbsp;<span class="ident" id="4160023">f</span><span class="op" id="4160024">.</span><span class="ident" id="4160025">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160035">f</span><span class="op" id="4160036">.</span><span class="ident" id="4160037">step</span><span class="op" id="4160041">(</span><span class="ident" id="4160042">f</span><span class="op" id="4160043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160046">}</span><br>
<span class="lineno"></span><span class="op" id="4160048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="4160051">func</span>&nbsp;<span class="op" id="4160056">(</span><span class="ident" id="4160057">f</span>&nbsp;<span class="op" id="4160059">*</span><span class="ident" id="4160060">decompressor</span><span class="op" id="4160072">)</span>&nbsp;<span class="ident" id="4160074">Close</span><span class="op" id="4160079">(</span><span class="op" id="4160080">)</span>&nbsp;<span class="builtintype" id="4160082">error</span>&nbsp;<span class="op" id="4160088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160091">if</span>&nbsp;<span class="ident" id="4160094">f</span><span class="op" id="4160095">.</span><span class="ident" id="4160096">err</span>&nbsp;<span class="op" id="4160100">==</span>&nbsp;<span class="ident" id="4160103">io</span><span class="op" id="4160105">.</span><span class="ident" id="4160106">EOF</span>&nbsp;<span class="op" id="4160110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160114">return</span>&nbsp;<span class="ident" id="4160121">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160129">return</span>&nbsp;<span class="ident" id="4160136">f</span><span class="op" id="4160137">.</span><span class="ident" id="4160138">err</span><br>
<span class="lineno">295</span><span class="op" id="4160142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4160145">//&nbsp;RFC&nbsp;1951&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span><span class="comment" id="4160172">//&nbsp;Compression&nbsp;with&nbsp;dynamic&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="4160215">var</span>&nbsp;<span class="ident" id="4160219">codeOrder</span>&nbsp;<span class="op" id="4160229">=</span>&nbsp;<span class="op" id="4160231">[</span><span class="op" id="4160232">...</span><span class="op" id="4160235">]</span><span class="builtintype" id="4160236">int</span><span class="op" id="4160239">{</span><span class="num" id="4160240">16</span><span class="op" id="4160242">,</span>&nbsp;<span class="num" id="4160244">17</span><span class="op" id="4160246">,</span>&nbsp;<span class="num" id="4160248">18</span><span class="op" id="4160250">,</span>&nbsp;<span class="num" id="4160252">0</span><span class="op" id="4160253">,</span>&nbsp;<span class="num" id="4160255">8</span><span class="op" id="4160256">,</span>&nbsp;<span class="num" id="4160258">7</span><span class="op" id="4160259">,</span>&nbsp;<span class="num" id="4160261">9</span><span class="op" id="4160262">,</span>&nbsp;<span class="num" id="4160264">6</span><span class="op" id="4160265">,</span>&nbsp;<span class="num" id="4160267">10</span><span class="op" id="4160269">,</span>&nbsp;<span class="num" id="4160271">5</span><span class="op" id="4160272">,</span>&nbsp;<span class="num" id="4160274">11</span><span class="op" id="4160276">,</span>&nbsp;<span class="num" id="4160278">4</span><span class="op" id="4160279">,</span>&nbsp;<span class="num" id="4160281">12</span><span class="op" id="4160283">,</span>&nbsp;<span class="num" id="4160285">3</span><span class="op" id="4160286">,</span>&nbsp;<span class="num" id="4160288">13</span><span class="op" id="4160290">,</span>&nbsp;<span class="num" id="4160292">2</span><span class="op" id="4160293">,</span>&nbsp;<span class="num" id="4160295">14</span><span class="op" id="4160297">,</span>&nbsp;<span class="num" id="4160299">1</span><span class="op" id="4160300">,</span>&nbsp;<span class="num" id="4160302">15</span><span class="op" id="4160304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4160307">func</span>&nbsp;<span class="op" id="4160312">(</span><span class="ident" id="4160313">f</span>&nbsp;<span class="op" id="4160315">*</span><span class="ident" id="4160316">decompressor</span><span class="op" id="4160328">)</span>&nbsp;<span class="ident" id="4160330">readHuffman</span><span class="op" id="4160341">(</span><span class="op" id="4160342">)</span>&nbsp;<span class="builtintype" id="4160344">error</span>&nbsp;<span class="op" id="4160350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4160353">//&nbsp;HLIT[5],&nbsp;HDIST[5],&nbsp;HCLEN[4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160386">for</span>&nbsp;<span class="ident" id="4160390">f</span><span class="op" id="4160391">.</span><span class="ident" id="4160392">nb</span>&nbsp;<span class="op" id="4160395">&lt;</span>&nbsp;<span class="num" id="4160397">5</span><span class="op" id="4160398">+</span><span class="num" id="4160399">5</span><span class="op" id="4160400">+</span><span class="num" id="4160401">4</span>&nbsp;<span class="op" id="4160403">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160407">if</span>&nbsp;<span class="ident" id="4160410">err</span>&nbsp;<span class="op" id="4160414">:=</span>&nbsp;<span class="ident" id="4160417">f</span><span class="op" id="4160418">.</span><span class="ident" id="4160419">moreBits</span><span class="op" id="4160427">(</span><span class="op" id="4160428">)</span><span class="op" id="4160429">;</span>&nbsp;<span class="ident" id="4160431">err</span>&nbsp;<span class="op" id="4160435">!=</span>&nbsp;<span class="ident" id="4160438">nil</span>&nbsp;<span class="op" id="4160442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160447">return</span>&nbsp;<span class="ident" id="4160454">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160466">nlit</span>&nbsp;<span class="op" id="4160471">:=</span>&nbsp;<span class="builtintype" id="4160474">int</span><span class="op" id="4160477">(</span><span class="ident" id="4160478">f</span><span class="op" id="4160479">.</span><span class="ident" id="4160480">b</span><span class="op" id="4160481">&amp;</span><span class="num" id="4160482">0x1F</span><span class="op" id="4160486">)</span>&nbsp;<span class="op" id="4160488">+</span>&nbsp;<span class="num" id="4160490">257</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160495">if</span>&nbsp;<span class="ident" id="4160498">nlit</span>&nbsp;<span class="op" id="4160503">&gt;</span>&nbsp;<span class="ident" id="4160505">maxLit</span>&nbsp;<span class="op" id="4160512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160516">return</span>&nbsp;<span class="ident" id="4160523">CorruptInputError</span><span class="op" id="4160540">(</span><span class="ident" id="4160541">f</span><span class="op" id="4160542">.</span><span class="ident" id="4160543">roffset</span><span class="op" id="4160550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160556">f</span><span class="op" id="4160557">.</span><span class="ident" id="4160558">b</span>&nbsp;<span class="op" id="4160560">&gt;&gt;=</span>&nbsp;<span class="num" id="4160564">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160567">ndist</span>&nbsp;<span class="op" id="4160573">:=</span>&nbsp;<span class="builtintype" id="4160576">int</span><span class="op" id="4160579">(</span><span class="ident" id="4160580">f</span><span class="op" id="4160581">.</span><span class="ident" id="4160582">b</span><span class="op" id="4160583">&amp;</span><span class="num" id="4160584">0x1F</span><span class="op" id="4160588">)</span>&nbsp;<span class="op" id="4160590">+</span>&nbsp;<span class="num" id="4160592">1</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4160595">//&nbsp;maxDist&nbsp;is&nbsp;32,&nbsp;so&nbsp;ndist&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160640">f</span><span class="op" id="4160641">.</span><span class="ident" id="4160642">b</span>&nbsp;<span class="op" id="4160644">&gt;&gt;=</span>&nbsp;<span class="num" id="4160648">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160651">nclen</span>&nbsp;<span class="op" id="4160657">:=</span>&nbsp;<span class="builtintype" id="4160660">int</span><span class="op" id="4160663">(</span><span class="ident" id="4160664">f</span><span class="op" id="4160665">.</span><span class="ident" id="4160666">b</span><span class="op" id="4160667">&amp;</span><span class="num" id="4160668">0xF</span><span class="op" id="4160671">)</span>&nbsp;<span class="op" id="4160673">+</span>&nbsp;<span class="num" id="4160675">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4160678">//&nbsp;numCodes&nbsp;is&nbsp;19,&nbsp;so&nbsp;nclen&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160724">f</span><span class="op" id="4160725">.</span><span class="ident" id="4160726">b</span>&nbsp;<span class="op" id="4160728">&gt;&gt;=</span>&nbsp;<span class="num" id="4160732">4</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160735">f</span><span class="op" id="4160736">.</span><span class="ident" id="4160737">nb</span>&nbsp;<span class="op" id="4160740">-=</span>&nbsp;<span class="num" id="4160743">5</span>&nbsp;<span class="op" id="4160745">+</span>&nbsp;<span class="num" id="4160747">5</span>&nbsp;<span class="op" id="4160749">+</span>&nbsp;<span class="num" id="4160751">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4160755">//&nbsp;(HCLEN+4)*3&nbsp;bits:&nbsp;code&nbsp;lengths&nbsp;in&nbsp;the&nbsp;magic&nbsp;codeOrder&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160820">for</span>&nbsp;<span class="ident" id="4160824">i</span>&nbsp;<span class="op" id="4160826">:=</span>&nbsp;<span class="num" id="4160829">0</span><span class="op" id="4160830">;</span>&nbsp;<span class="ident" id="4160832">i</span>&nbsp;<span class="op" id="4160834">&lt;</span>&nbsp;<span class="ident" id="4160836">nclen</span><span class="op" id="4160841">;</span>&nbsp;<span class="ident" id="4160843">i</span><span class="op" id="4160844">++</span>&nbsp;<span class="op" id="4160847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160851">for</span>&nbsp;<span class="ident" id="4160855">f</span><span class="op" id="4160856">.</span><span class="ident" id="4160857">nb</span>&nbsp;<span class="op" id="4160860">&lt;</span>&nbsp;<span class="num" id="4160862">3</span>&nbsp;<span class="op" id="4160864">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160869">if</span>&nbsp;<span class="ident" id="4160872">err</span>&nbsp;<span class="op" id="4160876">:=</span>&nbsp;<span class="ident" id="4160879">f</span><span class="op" id="4160880">.</span><span class="ident" id="4160881">moreBits</span><span class="op" id="4160889">(</span><span class="op" id="4160890">)</span><span class="op" id="4160891">;</span>&nbsp;<span class="ident" id="4160893">err</span>&nbsp;<span class="op" id="4160897">!=</span>&nbsp;<span class="ident" id="4160900">nil</span>&nbsp;<span class="op" id="4160904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160910">return</span>&nbsp;<span class="ident" id="4160917">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160932">f</span><span class="op" id="4160933">.</span><span class="ident" id="4160934">codebits</span><span class="op" id="4160942">[</span><span class="ident" id="4160943">codeOrder</span><span class="op" id="4160952">[</span><span class="ident" id="4160953">i</span><span class="op" id="4160954">]</span><span class="op" id="4160955">]</span>&nbsp;<span class="op" id="4160957">=</span>&nbsp;<span class="builtintype" id="4160959">int</span><span class="op" id="4160962">(</span><span class="ident" id="4160963">f</span><span class="op" id="4160964">.</span><span class="ident" id="4160965">b</span>&nbsp;<span class="op" id="4160967">&amp;</span>&nbsp;<span class="num" id="4160969">0x7</span><span class="op" id="4160972">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160976">f</span><span class="op" id="4160977">.</span><span class="ident" id="4160978">b</span>&nbsp;<span class="op" id="4160980">&gt;&gt;=</span>&nbsp;<span class="num" id="4160984">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160988">f</span><span class="op" id="4160989">.</span><span class="ident" id="4160990">nb</span>&nbsp;<span class="op" id="4160993">-=</span>&nbsp;<span class="num" id="4160996">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161002">for</span>&nbsp;<span class="ident" id="4161006">i</span>&nbsp;<span class="op" id="4161008">:=</span>&nbsp;<span class="ident" id="4161011">nclen</span><span class="op" id="4161016">;</span>&nbsp;<span class="ident" id="4161018">i</span>&nbsp;<span class="op" id="4161020">&lt;</span>&nbsp;<span class="builtinfunc" id="4161022">len</span><span class="op" id="4161025">(</span><span class="ident" id="4161026">codeOrder</span><span class="op" id="4161035">)</span><span class="op" id="4161036">;</span>&nbsp;<span class="ident" id="4161038">i</span><span class="op" id="4161039">++</span>&nbsp;<span class="op" id="4161042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161046">f</span><span class="op" id="4161047">.</span><span class="ident" id="4161048">codebits</span><span class="op" id="4161056">[</span><span class="ident" id="4161057">codeOrder</span><span class="op" id="4161066">[</span><span class="ident" id="4161067">i</span><span class="op" id="4161068">]</span><span class="op" id="4161069">]</span>&nbsp;<span class="op" id="4161071">=</span>&nbsp;<span class="num" id="4161073">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161079">if</span>&nbsp;<span class="op" id="4161082">!</span><span class="ident" id="4161083">f</span><span class="op" id="4161084">.</span><span class="ident" id="4161085">h1</span><span class="op" id="4161087">.</span><span class="ident" id="4161088">init</span><span class="op" id="4161092">(</span><span class="ident" id="4161093">f</span><span class="op" id="4161094">.</span><span class="ident" id="4161095">codebits</span><span class="op" id="4161103">[</span><span class="num" id="4161104">0</span><span class="op" id="4161105">:</span><span class="op" id="4161106">]</span><span class="op" id="4161107">)</span>&nbsp;<span class="op" id="4161109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161113">return</span>&nbsp;<span class="ident" id="4161120">CorruptInputError</span><span class="op" id="4161137">(</span><span class="ident" id="4161138">f</span><span class="op" id="4161139">.</span><span class="ident" id="4161140">roffset</span><span class="op" id="4161147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4161154">//&nbsp;HLIT&nbsp;+&nbsp;257&nbsp;code&nbsp;lengths,&nbsp;HDIST&nbsp;+&nbsp;1&nbsp;code&nbsp;lengths,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4161207">//&nbsp;using&nbsp;the&nbsp;code&nbsp;length&nbsp;Huffman&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161247">for</span>&nbsp;<span class="ident" id="4161251">i</span><span class="op" id="4161252">,</span>&nbsp;<span class="ident" id="4161254">n</span>&nbsp;<span class="op" id="4161256">:=</span>&nbsp;<span class="num" id="4161259">0</span><span class="op" id="4161260">,</span>&nbsp;<span class="ident" id="4161262">nlit</span><span class="op" id="4161266">+</span><span class="ident" id="4161267">ndist</span><span class="op" id="4161272">;</span>&nbsp;<span class="ident" id="4161274">i</span>&nbsp;<span class="op" id="4161276">&lt;</span>&nbsp;<span class="ident" id="4161278">n</span><span class="op" id="4161279">;</span>&nbsp;<span class="op" id="4161281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161285">x</span><span class="op" id="4161286">,</span>&nbsp;<span class="ident" id="4161288">err</span>&nbsp;<span class="op" id="4161292">:=</span>&nbsp;<span class="ident" id="4161295">f</span><span class="op" id="4161296">.</span><span class="ident" id="4161297">huffSym</span><span class="op" id="4161304">(</span><span class="op" id="4161305">&amp;</span><span class="ident" id="4161306">f</span><span class="op" id="4161307">.</span><span class="ident" id="4161308">h1</span><span class="op" id="4161310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161314">if</span>&nbsp;<span class="ident" id="4161317">err</span>&nbsp;<span class="op" id="4161321">!=</span>&nbsp;<span class="ident" id="4161324">nil</span>&nbsp;<span class="op" id="4161328">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161333">return</span>&nbsp;<span class="ident" id="4161340">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161350">if</span>&nbsp;<span class="ident" id="4161353">x</span>&nbsp;<span class="op" id="4161355">&lt;</span>&nbsp;<span class="num" id="4161357">16</span>&nbsp;<span class="op" id="4161360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4161365">//&nbsp;Actual&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161386">f</span><span class="op" id="4161387">.</span><span class="ident" id="4161388">bits</span><span class="op" id="4161392">[</span><span class="ident" id="4161393">i</span><span class="op" id="4161394">]</span>&nbsp;<span class="op" id="4161396">=</span>&nbsp;<span class="ident" id="4161398">x</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161403">i</span><span class="op" id="4161404">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161410">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4161425">//&nbsp;Repeat&nbsp;previous&nbsp;length&nbsp;or&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161462">var</span>&nbsp;<span class="ident" id="4161466">rep</span>&nbsp;<span class="builtintype" id="4161470">int</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161476">var</span>&nbsp;<span class="ident" id="4161480">nb</span>&nbsp;<span class="builtintype" id="4161483">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161490">var</span>&nbsp;<span class="ident" id="4161494">b</span>&nbsp;<span class="builtintype" id="4161496">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161502">switch</span>&nbsp;<span class="ident" id="4161509">x</span>&nbsp;<span class="op" id="4161511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161515">default</span><span class="op" id="4161522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161527">return</span>&nbsp;<span class="ident" id="4161534">InternalError</span><span class="op" id="4161547">(</span><span class="string" id="4161548">&#34;unexpected&nbsp;length&nbsp;code&#34;</span><span class="op" id="4161572">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161576">case</span>&nbsp;<span class="num" id="4161581">16</span><span class="op" id="4161583">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161588">rep</span>&nbsp;<span class="op" id="4161592">=</span>&nbsp;<span class="num" id="4161594">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161599">nb</span>&nbsp;<span class="op" id="4161602">=</span>&nbsp;<span class="num" id="4161604">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161609">if</span>&nbsp;<span class="ident" id="4161612">i</span>&nbsp;<span class="op" id="4161614">==</span>&nbsp;<span class="num" id="4161617">0</span>&nbsp;<span class="op" id="4161619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161625">return</span>&nbsp;<span class="ident" id="4161632">CorruptInputError</span><span class="op" id="4161649">(</span><span class="ident" id="4161650">f</span><span class="op" id="4161651">.</span><span class="ident" id="4161652">roffset</span><span class="op" id="4161659">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161669">b</span>&nbsp;<span class="op" id="4161671">=</span>&nbsp;<span class="ident" id="4161673">f</span><span class="op" id="4161674">.</span><span class="ident" id="4161675">bits</span><span class="op" id="4161679">[</span><span class="ident" id="4161680">i</span><span class="op" id="4161681">-</span><span class="num" id="4161682">1</span><span class="op" id="4161683">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161687">case</span>&nbsp;<span class="num" id="4161692">17</span><span class="op" id="4161694">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161699">rep</span>&nbsp;<span class="op" id="4161703">=</span>&nbsp;<span class="num" id="4161705">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161710">nb</span>&nbsp;<span class="op" id="4161713">=</span>&nbsp;<span class="num" id="4161715">3</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161720">b</span>&nbsp;<span class="op" id="4161722">=</span>&nbsp;<span class="num" id="4161724">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161728">case</span>&nbsp;<span class="num" id="4161733">18</span><span class="op" id="4161735">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161740">rep</span>&nbsp;<span class="op" id="4161744">=</span>&nbsp;<span class="num" id="4161746">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161752">nb</span>&nbsp;<span class="op" id="4161755">=</span>&nbsp;<span class="num" id="4161757">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161762">b</span>&nbsp;<span class="op" id="4161764">=</span>&nbsp;<span class="num" id="4161766">0</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161774">for</span>&nbsp;<span class="ident" id="4161778">f</span><span class="op" id="4161779">.</span><span class="ident" id="4161780">nb</span>&nbsp;<span class="op" id="4161783">&lt;</span>&nbsp;<span class="ident" id="4161785">nb</span>&nbsp;<span class="op" id="4161788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161793">if</span>&nbsp;<span class="ident" id="4161796">err</span>&nbsp;<span class="op" id="4161800">:=</span>&nbsp;<span class="ident" id="4161803">f</span><span class="op" id="4161804">.</span><span class="ident" id="4161805">moreBits</span><span class="op" id="4161813">(</span><span class="op" id="4161814">)</span><span class="op" id="4161815">;</span>&nbsp;<span class="ident" id="4161817">err</span>&nbsp;<span class="op" id="4161821">!=</span>&nbsp;<span class="ident" id="4161824">nil</span>&nbsp;<span class="op" id="4161828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161834">return</span>&nbsp;<span class="ident" id="4161841">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161848">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161856">rep</span>&nbsp;<span class="op" id="4161860">+=</span>&nbsp;<span class="builtintype" id="4161863">int</span><span class="op" id="4161866">(</span><span class="ident" id="4161867">f</span><span class="op" id="4161868">.</span><span class="ident" id="4161869">b</span>&nbsp;<span class="op" id="4161871">&amp;</span>&nbsp;<span class="builtintype" id="4161873">uint32</span><span class="op" id="4161879">(</span><span class="num" id="4161880">1</span><span class="op" id="4161881">&lt;&lt;</span><span class="ident" id="4161883">nb</span><span class="op" id="4161885">-</span><span class="num" id="4161886">1</span><span class="op" id="4161887">)</span><span class="op" id="4161888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161892">f</span><span class="op" id="4161893">.</span><span class="ident" id="4161894">b</span>&nbsp;<span class="op" id="4161896">&gt;&gt;=</span>&nbsp;<span class="ident" id="4161900">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161905">f</span><span class="op" id="4161906">.</span><span class="ident" id="4161907">nb</span>&nbsp;<span class="op" id="4161910">-=</span>&nbsp;<span class="ident" id="4161913">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161918">if</span>&nbsp;<span class="ident" id="4161921">i</span><span class="op" id="4161922">+</span><span class="ident" id="4161923">rep</span>&nbsp;<span class="op" id="4161927">&gt;</span>&nbsp;<span class="ident" id="4161929">n</span>&nbsp;<span class="op" id="4161931">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161936">return</span>&nbsp;<span class="ident" id="4161943">CorruptInputError</span><span class="op" id="4161960">(</span><span class="ident" id="4161961">f</span><span class="op" id="4161962">.</span><span class="ident" id="4161963">roffset</span><span class="op" id="4161970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161978">for</span>&nbsp;<span class="ident" id="4161982">j</span>&nbsp;<span class="op" id="4161984">:=</span>&nbsp;<span class="num" id="4161987">0</span><span class="op" id="4161988">;</span>&nbsp;<span class="ident" id="4161990">j</span>&nbsp;<span class="op" id="4161992">&lt;</span>&nbsp;<span class="ident" id="4161994">rep</span><span class="op" id="4161997">;</span>&nbsp;<span class="ident" id="4161999">j</span><span class="op" id="4162000">++</span>&nbsp;<span class="op" id="4162003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162008">f</span><span class="op" id="4162009">.</span><span class="ident" id="4162010">bits</span><span class="op" id="4162014">[</span><span class="ident" id="4162015">i</span><span class="op" id="4162016">]</span>&nbsp;<span class="op" id="4162018">=</span>&nbsp;<span class="ident" id="4162020">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162025">i</span><span class="op" id="4162026">++</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162038">if</span>&nbsp;<span class="op" id="4162041">!</span><span class="ident" id="4162042">f</span><span class="op" id="4162043">.</span><span class="ident" id="4162044">h1</span><span class="op" id="4162046">.</span><span class="ident" id="4162047">init</span><span class="op" id="4162051">(</span><span class="ident" id="4162052">f</span><span class="op" id="4162053">.</span><span class="ident" id="4162054">bits</span><span class="op" id="4162058">[</span><span class="num" id="4162059">0</span><span class="op" id="4162060">:</span><span class="ident" id="4162061">nlit</span><span class="op" id="4162065">]</span><span class="op" id="4162066">)</span>&nbsp;<span class="op" id="4162068">||</span>&nbsp;<span class="op" id="4162071">!</span><span class="ident" id="4162072">f</span><span class="op" id="4162073">.</span><span class="ident" id="4162074">h2</span><span class="op" id="4162076">.</span><span class="ident" id="4162077">init</span><span class="op" id="4162081">(</span><span class="ident" id="4162082">f</span><span class="op" id="4162083">.</span><span class="ident" id="4162084">bits</span><span class="op" id="4162088">[</span><span class="ident" id="4162089">nlit</span><span class="op" id="4162093">:</span><span class="ident" id="4162094">nlit</span><span class="op" id="4162098">+</span><span class="ident" id="4162099">ndist</span><span class="op" id="4162104">]</span><span class="op" id="4162105">)</span>&nbsp;<span class="op" id="4162107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162111">return</span>&nbsp;<span class="ident" id="4162118">CorruptInputError</span><span class="op" id="4162135">(</span><span class="ident" id="4162136">f</span><span class="op" id="4162137">.</span><span class="ident" id="4162138">roffset</span><span class="op" id="4162145">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162152">return</span>&nbsp;<span class="ident" id="4162159">nil</span><br>
<span class="lineno"></span><span class="op" id="4162163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="4162166">//&nbsp;Decode&nbsp;a&nbsp;single&nbsp;Huffman&nbsp;block&nbsp;from&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="4162207">//&nbsp;hl&nbsp;and&nbsp;hd&nbsp;are&nbsp;the&nbsp;Huffman&nbsp;states&nbsp;for&nbsp;the&nbsp;lit/length&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4162269">//&nbsp;and&nbsp;the&nbsp;distance&nbsp;values,&nbsp;respectively.&nbsp;&nbsp;If&nbsp;hd&nbsp;==&nbsp;nil,&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4162336">//&nbsp;fixed&nbsp;distance&nbsp;encoding&nbsp;associated&nbsp;with&nbsp;fixed&nbsp;Huffman&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="4162401">func</span>&nbsp;<span class="op" id="4162406">(</span><span class="ident" id="4162407">f</span>&nbsp;<span class="op" id="4162409">*</span><span class="ident" id="4162410">decompressor</span><span class="op" id="4162422">)</span>&nbsp;<span class="ident" id="4162424">huffmanBlock</span><span class="op" id="4162436">(</span><span class="op" id="4162437">)</span>&nbsp;<span class="op" id="4162439">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162442">for</span>&nbsp;<span class="op" id="4162446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162450">v</span><span class="op" id="4162451">,</span>&nbsp;<span class="ident" id="4162453">err</span>&nbsp;<span class="op" id="4162457">:=</span>&nbsp;<span class="ident" id="4162460">f</span><span class="op" id="4162461">.</span><span class="ident" id="4162462">huffSym</span><span class="op" id="4162469">(</span><span class="ident" id="4162470">f</span><span class="op" id="4162471">.</span><span class="ident" id="4162472">hl</span><span class="op" id="4162474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162478">if</span>&nbsp;<span class="ident" id="4162481">err</span>&nbsp;<span class="op" id="4162485">!=</span>&nbsp;<span class="ident" id="4162488">nil</span>&nbsp;<span class="op" id="4162492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162497">f</span><span class="op" id="4162498">.</span><span class="ident" id="4162499">err</span>&nbsp;<span class="op" id="4162503">=</span>&nbsp;<span class="ident" id="4162505">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162512">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162525">var</span>&nbsp;<span class="ident" id="4162529">n</span>&nbsp;<span class="builtintype" id="4162531">uint</span>&nbsp;<span class="comment" id="4162536">//&nbsp;number&nbsp;of&nbsp;bits&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162562">var</span>&nbsp;<span class="ident" id="4162566">length</span>&nbsp;<span class="builtintype" id="4162573">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162579">switch</span>&nbsp;<span class="op" id="4162586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162590">case</span>&nbsp;<span class="ident" id="4162595">v</span>&nbsp;<span class="op" id="4162597">&lt;</span>&nbsp;<span class="num" id="4162599">256</span><span class="op" id="4162602">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162607">f</span><span class="op" id="4162608">.</span><span class="ident" id="4162609">hist</span><span class="op" id="4162613">[</span><span class="ident" id="4162614">f</span><span class="op" id="4162615">.</span><span class="ident" id="4162616">hp</span><span class="op" id="4162618">]</span>&nbsp;<span class="op" id="4162620">=</span>&nbsp;<span class="builtintype" id="4162622">byte</span><span class="op" id="4162626">(</span><span class="ident" id="4162627">v</span><span class="op" id="4162628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162633">f</span><span class="op" id="4162634">.</span><span class="ident" id="4162635">hp</span><span class="op" id="4162637">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162643">if</span>&nbsp;<span class="ident" id="4162646">f</span><span class="op" id="4162647">.</span><span class="ident" id="4162648">hp</span>&nbsp;<span class="op" id="4162651">==</span>&nbsp;<span class="builtinfunc" id="4162654">len</span><span class="op" id="4162657">(</span><span class="ident" id="4162658">f</span><span class="op" id="4162659">.</span><span class="ident" id="4162660">hist</span><span class="op" id="4162664">)</span>&nbsp;<span class="op" id="4162666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162672">//&nbsp;After&nbsp;the&nbsp;flush,&nbsp;continue&nbsp;this&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162716">f</span><span class="op" id="4162717">.</span><span class="ident" id="4162718">flush</span><span class="op" id="4162723">(</span><span class="op" id="4162724">(</span><span class="op" id="4162725">*</span><span class="ident" id="4162726">decompressor</span><span class="op" id="4162738">)</span><span class="op" id="4162739">.</span><span class="ident" id="4162740">huffmanBlock</span><span class="op" id="4162752">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162758">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162773">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162784">case</span>&nbsp;<span class="ident" id="4162789">v</span>&nbsp;<span class="op" id="4162791">==</span>&nbsp;<span class="num" id="4162794">256</span><span class="op" id="4162797">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162802">//&nbsp;Done&nbsp;with&nbsp;huffman&nbsp;block;&nbsp;read&nbsp;next&nbsp;block.</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162850">f</span><span class="op" id="4162851">.</span><span class="ident" id="4162852">step</span>&nbsp;<span class="op" id="4162857">=</span>&nbsp;<span class="op" id="4162859">(</span><span class="op" id="4162860">*</span><span class="ident" id="4162861">decompressor</span><span class="op" id="4162873">)</span><span class="op" id="4162874">.</span><span class="ident" id="4162875">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162888">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162897">//&nbsp;otherwise,&nbsp;reference&nbsp;to&nbsp;older&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162937">case</span>&nbsp;<span class="ident" id="4162942">v</span>&nbsp;<span class="op" id="4162944">&lt;</span>&nbsp;<span class="num" id="4162946">265</span><span class="op" id="4162949">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162954">length</span>&nbsp;<span class="op" id="4162961">=</span>&nbsp;<span class="ident" id="4162963">v</span>&nbsp;<span class="op" id="4162965">-</span>&nbsp;<span class="op" id="4162967">(</span><span class="num" id="4162968">257</span>&nbsp;<span class="op" id="4162972">-</span>&nbsp;<span class="num" id="4162974">3</span><span class="op" id="4162975">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162980">n</span>&nbsp;<span class="op" id="4162982">=</span>&nbsp;<span class="num" id="4162984">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162988">case</span>&nbsp;<span class="ident" id="4162993">v</span>&nbsp;<span class="op" id="4162995">&lt;</span>&nbsp;<span class="num" id="4162997">269</span><span class="op" id="4163000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163005">length</span>&nbsp;<span class="op" id="4163012">=</span>&nbsp;<span class="ident" id="4163014">v</span><span class="op" id="4163015">*</span><span class="num" id="4163016">2</span>&nbsp;<span class="op" id="4163018">-</span>&nbsp;<span class="op" id="4163020">(</span><span class="num" id="4163021">265</span><span class="op" id="4163024">*</span><span class="num" id="4163025">2</span>&nbsp;<span class="op" id="4163027">-</span>&nbsp;<span class="num" id="4163029">11</span><span class="op" id="4163031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163036">n</span>&nbsp;<span class="op" id="4163038">=</span>&nbsp;<span class="num" id="4163040">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163044">case</span>&nbsp;<span class="ident" id="4163049">v</span>&nbsp;<span class="op" id="4163051">&lt;</span>&nbsp;<span class="num" id="4163053">273</span><span class="op" id="4163056">:</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163061">length</span>&nbsp;<span class="op" id="4163068">=</span>&nbsp;<span class="ident" id="4163070">v</span><span class="op" id="4163071">*</span><span class="num" id="4163072">4</span>&nbsp;<span class="op" id="4163074">-</span>&nbsp;<span class="op" id="4163076">(</span><span class="num" id="4163077">269</span><span class="op" id="4163080">*</span><span class="num" id="4163081">4</span>&nbsp;<span class="op" id="4163083">-</span>&nbsp;<span class="num" id="4163085">19</span><span class="op" id="4163087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163092">n</span>&nbsp;<span class="op" id="4163094">=</span>&nbsp;<span class="num" id="4163096">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163100">case</span>&nbsp;<span class="ident" id="4163105">v</span>&nbsp;<span class="op" id="4163107">&lt;</span>&nbsp;<span class="num" id="4163109">277</span><span class="op" id="4163112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163117">length</span>&nbsp;<span class="op" id="4163124">=</span>&nbsp;<span class="ident" id="4163126">v</span><span class="op" id="4163127">*</span><span class="num" id="4163128">8</span>&nbsp;<span class="op" id="4163130">-</span>&nbsp;<span class="op" id="4163132">(</span><span class="num" id="4163133">273</span><span class="op" id="4163136">*</span><span class="num" id="4163137">8</span>&nbsp;<span class="op" id="4163139">-</span>&nbsp;<span class="num" id="4163141">35</span><span class="op" id="4163143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163148">n</span>&nbsp;<span class="op" id="4163150">=</span>&nbsp;<span class="num" id="4163152">3</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163156">case</span>&nbsp;<span class="ident" id="4163161">v</span>&nbsp;<span class="op" id="4163163">&lt;</span>&nbsp;<span class="num" id="4163165">281</span><span class="op" id="4163168">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163173">length</span>&nbsp;<span class="op" id="4163180">=</span>&nbsp;<span class="ident" id="4163182">v</span><span class="op" id="4163183">*</span><span class="num" id="4163184">16</span>&nbsp;<span class="op" id="4163187">-</span>&nbsp;<span class="op" id="4163189">(</span><span class="num" id="4163190">277</span><span class="op" id="4163193">*</span><span class="num" id="4163194">16</span>&nbsp;<span class="op" id="4163197">-</span>&nbsp;<span class="num" id="4163199">67</span><span class="op" id="4163201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163206">n</span>&nbsp;<span class="op" id="4163208">=</span>&nbsp;<span class="num" id="4163210">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163214">case</span>&nbsp;<span class="ident" id="4163219">v</span>&nbsp;<span class="op" id="4163221">&lt;</span>&nbsp;<span class="num" id="4163223">285</span><span class="op" id="4163226">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163231">length</span>&nbsp;<span class="op" id="4163238">=</span>&nbsp;<span class="ident" id="4163240">v</span><span class="op" id="4163241">*</span><span class="num" id="4163242">32</span>&nbsp;<span class="op" id="4163245">-</span>&nbsp;<span class="op" id="4163247">(</span><span class="num" id="4163248">281</span><span class="op" id="4163251">*</span><span class="num" id="4163252">32</span>&nbsp;<span class="op" id="4163255">-</span>&nbsp;<span class="num" id="4163257">131</span><span class="op" id="4163260">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163265">n</span>&nbsp;<span class="op" id="4163267">=</span>&nbsp;<span class="num" id="4163269">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163273">default</span><span class="op" id="4163280">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163285">length</span>&nbsp;<span class="op" id="4163292">=</span>&nbsp;<span class="num" id="4163294">258</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163301">n</span>&nbsp;<span class="op" id="4163303">=</span>&nbsp;<span class="num" id="4163305">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163309">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163313">if</span>&nbsp;<span class="ident" id="4163316">n</span>&nbsp;<span class="op" id="4163318">&gt;</span>&nbsp;<span class="num" id="4163320">0</span>&nbsp;<span class="op" id="4163322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163327">for</span>&nbsp;<span class="ident" id="4163331">f</span><span class="op" id="4163332">.</span><span class="ident" id="4163333">nb</span>&nbsp;<span class="op" id="4163336">&lt;</span>&nbsp;<span class="ident" id="4163338">n</span>&nbsp;<span class="op" id="4163340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163346">if</span>&nbsp;<span class="ident" id="4163349">err</span>&nbsp;<span class="op" id="4163353">=</span>&nbsp;<span class="ident" id="4163355">f</span><span class="op" id="4163356">.</span><span class="ident" id="4163357">moreBits</span><span class="op" id="4163365">(</span><span class="op" id="4163366">)</span><span class="op" id="4163367">;</span>&nbsp;<span class="ident" id="4163369">err</span>&nbsp;<span class="op" id="4163373">!=</span>&nbsp;<span class="ident" id="4163376">nil</span>&nbsp;<span class="op" id="4163380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163387">f</span><span class="op" id="4163388">.</span><span class="ident" id="4163389">err</span>&nbsp;<span class="op" id="4163393">=</span>&nbsp;<span class="ident" id="4163395">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163404">return</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163425">length</span>&nbsp;<span class="op" id="4163432">+=</span>&nbsp;<span class="builtintype" id="4163435">int</span><span class="op" id="4163438">(</span><span class="ident" id="4163439">f</span><span class="op" id="4163440">.</span><span class="ident" id="4163441">b</span>&nbsp;<span class="op" id="4163443">&amp;</span>&nbsp;<span class="builtintype" id="4163445">uint32</span><span class="op" id="4163451">(</span><span class="num" id="4163452">1</span><span class="op" id="4163453">&lt;&lt;</span><span class="ident" id="4163455">n</span><span class="op" id="4163456">-</span><span class="num" id="4163457">1</span><span class="op" id="4163458">)</span><span class="op" id="4163459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163464">f</span><span class="op" id="4163465">.</span><span class="ident" id="4163466">b</span>&nbsp;<span class="op" id="4163468">&gt;&gt;=</span>&nbsp;<span class="ident" id="4163472">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163477">f</span><span class="op" id="4163478">.</span><span class="ident" id="4163479">nb</span>&nbsp;<span class="op" id="4163482">-=</span>&nbsp;<span class="ident" id="4163485">n</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163494">var</span>&nbsp;<span class="ident" id="4163498">dist</span>&nbsp;<span class="builtintype" id="4163503">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163509">if</span>&nbsp;<span class="ident" id="4163512">f</span><span class="op" id="4163513">.</span><span class="ident" id="4163514">hd</span>&nbsp;<span class="op" id="4163517">==</span>&nbsp;<span class="ident" id="4163520">nil</span>&nbsp;<span class="op" id="4163524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163529">for</span>&nbsp;<span class="ident" id="4163533">f</span><span class="op" id="4163534">.</span><span class="ident" id="4163535">nb</span>&nbsp;<span class="op" id="4163538">&lt;</span>&nbsp;<span class="num" id="4163540">5</span>&nbsp;<span class="op" id="4163542">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163548">if</span>&nbsp;<span class="ident" id="4163551">err</span>&nbsp;<span class="op" id="4163555">=</span>&nbsp;<span class="ident" id="4163557">f</span><span class="op" id="4163558">.</span><span class="ident" id="4163559">moreBits</span><span class="op" id="4163567">(</span><span class="op" id="4163568">)</span><span class="op" id="4163569">;</span>&nbsp;<span class="ident" id="4163571">err</span>&nbsp;<span class="op" id="4163575">!=</span>&nbsp;<span class="ident" id="4163578">nil</span>&nbsp;<span class="op" id="4163582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163589">f</span><span class="op" id="4163590">.</span><span class="ident" id="4163591">err</span>&nbsp;<span class="op" id="4163595">=</span>&nbsp;<span class="ident" id="4163597">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163606">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163622">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163627">dist</span>&nbsp;<span class="op" id="4163632">=</span>&nbsp;<span class="builtintype" id="4163634">int</span><span class="op" id="4163637">(</span><span class="ident" id="4163638">reverseByte</span><span class="op" id="4163649">[</span><span class="op" id="4163650">(</span><span class="ident" id="4163651">f</span><span class="op" id="4163652">.</span><span class="ident" id="4163653">b</span><span class="op" id="4163654">&amp;</span><span class="num" id="4163655">0x1F</span><span class="op" id="4163659">)</span><span class="op" id="4163660">&lt;&lt;</span><span class="num" id="4163662">3</span><span class="op" id="4163663">]</span><span class="op" id="4163664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163669">f</span><span class="op" id="4163670">.</span><span class="ident" id="4163671">b</span>&nbsp;<span class="op" id="4163673">&gt;&gt;=</span>&nbsp;<span class="num" id="4163677">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163682">f</span><span class="op" id="4163683">.</span><span class="ident" id="4163684">nb</span>&nbsp;<span class="op" id="4163687">-=</span>&nbsp;<span class="num" id="4163690">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163694">}</span>&nbsp;<span class="keyword" id="4163696">else</span>&nbsp;<span class="op" id="4163701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163706">if</span>&nbsp;<span class="ident" id="4163709">dist</span><span class="op" id="4163713">,</span>&nbsp;<span class="ident" id="4163715">err</span>&nbsp;<span class="op" id="4163719">=</span>&nbsp;<span class="ident" id="4163721">f</span><span class="op" id="4163722">.</span><span class="ident" id="4163723">huffSym</span><span class="op" id="4163730">(</span><span class="ident" id="4163731">f</span><span class="op" id="4163732">.</span><span class="ident" id="4163733">hd</span><span class="op" id="4163735">)</span><span class="op" id="4163736">;</span>&nbsp;<span class="ident" id="4163738">err</span>&nbsp;<span class="op" id="4163742">!=</span>&nbsp;<span class="ident" id="4163745">nil</span>&nbsp;<span class="op" id="4163749">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163755">f</span><span class="op" id="4163756">.</span><span class="ident" id="4163757">err</span>&nbsp;<span class="op" id="4163761">=</span>&nbsp;<span class="ident" id="4163763">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163771">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163790">switch</span>&nbsp;<span class="op" id="4163797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163801">case</span>&nbsp;<span class="ident" id="4163806">dist</span>&nbsp;<span class="op" id="4163811">&lt;</span>&nbsp;<span class="num" id="4163813">4</span><span class="op" id="4163814">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163819">dist</span><span class="op" id="4163823">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163828">case</span>&nbsp;<span class="ident" id="4163833">dist</span>&nbsp;<span class="op" id="4163838">&gt;=</span>&nbsp;<span class="num" id="4163841">30</span><span class="op" id="4163843">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163848">f</span><span class="op" id="4163849">.</span><span class="ident" id="4163850">err</span>&nbsp;<span class="op" id="4163854">=</span>&nbsp;<span class="ident" id="4163856">CorruptInputError</span><span class="op" id="4163873">(</span><span class="ident" id="4163874">f</span><span class="op" id="4163875">.</span><span class="ident" id="4163876">roffset</span><span class="op" id="4163883">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163888">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163897">default</span><span class="op" id="4163904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163909">nb</span>&nbsp;<span class="op" id="4163912">:=</span>&nbsp;<span class="builtintype" id="4163915">uint</span><span class="op" id="4163919">(</span><span class="ident" id="4163920">dist</span><span class="op" id="4163924">-</span><span class="num" id="4163925">2</span><span class="op" id="4163926">)</span>&nbsp;<span class="op" id="4163928">&gt;&gt;</span>&nbsp;<span class="num" id="4163931">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4163936">//&nbsp;have&nbsp;1&nbsp;bit&nbsp;in&nbsp;bottom&nbsp;of&nbsp;dist,&nbsp;need&nbsp;nb&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163986">extra</span>&nbsp;<span class="op" id="4163992">:=</span>&nbsp;<span class="op" id="4163995">(</span><span class="ident" id="4163996">dist</span>&nbsp;<span class="op" id="4164001">&amp;</span>&nbsp;<span class="num" id="4164003">1</span><span class="op" id="4164004">)</span>&nbsp;<span class="op" id="4164006">&lt;&lt;</span>&nbsp;<span class="ident" id="4164009">nb</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164015">for</span>&nbsp;<span class="ident" id="4164019">f</span><span class="op" id="4164020">.</span><span class="ident" id="4164021">nb</span>&nbsp;<span class="op" id="4164024">&lt;</span>&nbsp;<span class="ident" id="4164026">nb</span>&nbsp;<span class="op" id="4164029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164035">if</span>&nbsp;<span class="ident" id="4164038">err</span>&nbsp;<span class="op" id="4164042">=</span>&nbsp;<span class="ident" id="4164044">f</span><span class="op" id="4164045">.</span><span class="ident" id="4164046">moreBits</span><span class="op" id="4164054">(</span><span class="op" id="4164055">)</span><span class="op" id="4164056">;</span>&nbsp;<span class="ident" id="4164058">err</span>&nbsp;<span class="op" id="4164062">!=</span>&nbsp;<span class="ident" id="4164065">nil</span>&nbsp;<span class="op" id="4164069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164076">f</span><span class="op" id="4164077">.</span><span class="ident" id="4164078">err</span>&nbsp;<span class="op" id="4164082">=</span>&nbsp;<span class="ident" id="4164084">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164093">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4164104">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4164109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164114">extra</span>&nbsp;<span class="op" id="4164120">|=</span>&nbsp;<span class="builtintype" id="4164123">int</span><span class="op" id="4164126">(</span><span class="ident" id="4164127">f</span><span class="op" id="4164128">.</span><span class="ident" id="4164129">b</span>&nbsp;<span class="op" id="4164131">&amp;</span>&nbsp;<span class="builtintype" id="4164133">uint32</span><span class="op" id="4164139">(</span><span class="num" id="4164140">1</span><span class="op" id="4164141">&lt;&lt;</span><span class="ident" id="4164143">nb</span><span class="op" id="4164145">-</span><span class="num" id="4164146">1</span><span class="op" id="4164147">)</span><span class="op" id="4164148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164153">f</span><span class="op" id="4164154">.</span><span class="ident" id="4164155">b</span>&nbsp;<span class="op" id="4164157">&gt;&gt;=</span>&nbsp;<span class="ident" id="4164161">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164167">f</span><span class="op" id="4164168">.</span><span class="ident" id="4164169">nb</span>&nbsp;<span class="op" id="4164172">-=</span>&nbsp;<span class="ident" id="4164175">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164181">dist</span>&nbsp;<span class="op" id="4164186">=</span>&nbsp;<span class="num" id="4164188">1</span><span class="op" id="4164189">&lt;&lt;</span><span class="op" id="4164191">(</span><span class="ident" id="4164192">nb</span><span class="op" id="4164194">+</span><span class="num" id="4164195">1</span><span class="op" id="4164196">)</span>&nbsp;<span class="op" id="4164198">+</span>&nbsp;<span class="num" id="4164200">1</span>&nbsp;<span class="op" id="4164202">+</span>&nbsp;<span class="ident" id="4164204">extra</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4164212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164217">//&nbsp;Copy&nbsp;history[-dist:-dist+length]&nbsp;into&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164268">if</span>&nbsp;<span class="ident" id="4164271">dist</span>&nbsp;<span class="op" id="4164276">&gt;</span>&nbsp;<span class="builtinfunc" id="4164278">len</span><span class="op" id="4164281">(</span><span class="ident" id="4164282">f</span><span class="op" id="4164283">.</span><span class="ident" id="4164284">hist</span><span class="op" id="4164288">)</span>&nbsp;<span class="op" id="4164290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164295">f</span><span class="op" id="4164296">.</span><span class="ident" id="4164297">err</span>&nbsp;<span class="op" id="4164301">=</span>&nbsp;<span class="ident" id="4164303">InternalError</span><span class="op" id="4164316">(</span><span class="string" id="4164317">&#34;bad&nbsp;history&nbsp;distance&#34;</span><span class="op" id="4164339">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164344">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4164353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164358">//&nbsp;No&nbsp;check&nbsp;on&nbsp;length;&nbsp;encoding&nbsp;can&nbsp;be&nbsp;prescient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164410">if</span>&nbsp;<span class="op" id="4164413">!</span><span class="ident" id="4164414">f</span><span class="op" id="4164415">.</span><span class="ident" id="4164416">hfull</span>&nbsp;<span class="op" id="4164422">&amp;&amp;</span>&nbsp;<span class="ident" id="4164425">dist</span>&nbsp;<span class="op" id="4164430">&gt;</span>&nbsp;<span class="ident" id="4164432">f</span><span class="op" id="4164433">.</span><span class="ident" id="4164434">hp</span>&nbsp;<span class="op" id="4164437">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164442">f</span><span class="op" id="4164443">.</span><span class="ident" id="4164444">err</span>&nbsp;<span class="op" id="4164448">=</span>&nbsp;<span class="ident" id="4164450">CorruptInputError</span><span class="op" id="4164467">(</span><span class="ident" id="4164468">f</span><span class="op" id="4164469">.</span><span class="ident" id="4164470">roffset</span><span class="op" id="4164477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164482">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4164491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164496">f</span><span class="op" id="4164497">.</span><span class="ident" id="4164498">copyLen</span><span class="op" id="4164505">,</span>&nbsp;<span class="ident" id="4164507">f</span><span class="op" id="4164508">.</span><span class="ident" id="4164509">copyDist</span>&nbsp;<span class="op" id="4164518">=</span>&nbsp;<span class="ident" id="4164520">length</span><span class="op" id="4164526">,</span>&nbsp;<span class="ident" id="4164528">dist</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164535">if</span>&nbsp;<span class="ident" id="4164538">f</span><span class="op" id="4164539">.</span><span class="ident" id="4164540">copyHist</span><span class="op" id="4164548">(</span><span class="op" id="4164549">)</span>&nbsp;<span class="op" id="4164551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164556">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4164565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4164568">}</span><br>
<span class="lineno"></span><span class="op" id="4164570">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span><span class="comment" id="4164573">//&nbsp;copyHist&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;f.hist&nbsp;(f.copyDist&nbsp;bytes&nbsp;ago)&nbsp;to&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="4164654">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;the&nbsp;f.hist&nbsp;buffer&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4164703">func</span>&nbsp;<span class="op" id="4164708">(</span><span class="ident" id="4164709">f</span>&nbsp;<span class="op" id="4164711">*</span><span class="ident" id="4164712">decompressor</span><span class="op" id="4164724">)</span>&nbsp;<span class="ident" id="4164726">copyHist</span><span class="op" id="4164734">(</span><span class="op" id="4164735">)</span>&nbsp;<span class="builtintype" id="4164737">bool</span>&nbsp;<span class="op" id="4164742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164745">p</span>&nbsp;<span class="op" id="4164747">:=</span>&nbsp;<span class="ident" id="4164750">f</span><span class="op" id="4164751">.</span><span class="ident" id="4164752">hp</span>&nbsp;<span class="op" id="4164755">-</span>&nbsp;<span class="ident" id="4164757">f</span><span class="op" id="4164758">.</span><span class="ident" id="4164759">copyDist</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164769">if</span>&nbsp;<span class="ident" id="4164772">p</span>&nbsp;<span class="op" id="4164774">&lt;</span>&nbsp;<span class="num" id="4164776">0</span>&nbsp;<span class="op" id="4164778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164782">p</span>&nbsp;<span class="op" id="4164784">+=</span>&nbsp;<span class="builtinfunc" id="4164787">len</span><span class="op" id="4164790">(</span><span class="ident" id="4164791">f</span><span class="op" id="4164792">.</span><span class="ident" id="4164793">hist</span><span class="op" id="4164797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4164800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164803">for</span>&nbsp;<span class="ident" id="4164807">f</span><span class="op" id="4164808">.</span><span class="ident" id="4164809">copyLen</span>&nbsp;<span class="op" id="4164817">&gt;</span>&nbsp;<span class="num" id="4164819">0</span>&nbsp;<span class="op" id="4164821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164825">n</span>&nbsp;<span class="op" id="4164827">:=</span>&nbsp;<span class="ident" id="4164830">f</span><span class="op" id="4164831">.</span><span class="ident" id="4164832">copyLen</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164842">if</span>&nbsp;<span class="ident" id="4164845">x</span>&nbsp;<span class="op" id="4164847">:=</span>&nbsp;<span class="builtinfunc" id="4164850">len</span><span class="op" id="4164853">(</span><span class="ident" id="4164854">f</span><span class="op" id="4164855">.</span><span class="ident" id="4164856">hist</span><span class="op" id="4164860">)</span>&nbsp;<span class="op" id="4164862">-</span>&nbsp;<span class="ident" id="4164864">f</span><span class="op" id="4164865">.</span><span class="ident" id="4164866">hp</span><span class="op" id="4164868">;</span>&nbsp;<span class="ident" id="4164870">n</span>&nbsp;<span class="op" id="4164872">&gt;</span>&nbsp;<span class="ident" id="4164874">x</span>&nbsp;<span class="op" id="4164876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164881">n</span>&nbsp;<span class="op" id="4164883">=</span>&nbsp;<span class="ident" id="4164885">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4164889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164893">if</span>&nbsp;<span class="ident" id="4164896">x</span>&nbsp;<span class="op" id="4164898">:=</span>&nbsp;<span class="builtinfunc" id="4164901">len</span><span class="op" id="4164904">(</span><span class="ident" id="4164905">f</span><span class="op" id="4164906">.</span><span class="ident" id="4164907">hist</span><span class="op" id="4164911">)</span>&nbsp;<span class="op" id="4164913">-</span>&nbsp;<span class="ident" id="4164915">p</span><span class="op" id="4164916">;</span>&nbsp;<span class="ident" id="4164918">n</span>&nbsp;<span class="op" id="4164920">&gt;</span>&nbsp;<span class="ident" id="4164922">x</span>&nbsp;<span class="op" id="4164924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164929">n</span>&nbsp;<span class="op" id="4164931">=</span>&nbsp;<span class="ident" id="4164933">x</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4164937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164941">forwardCopy</span><span class="op" id="4164952">(</span><span class="ident" id="4164953">f</span><span class="op" id="4164954">.</span><span class="ident" id="4164955">hist</span><span class="op" id="4164959">[</span><span class="op" id="4164960">:</span><span class="op" id="4164961">]</span><span class="op" id="4164962">,</span>&nbsp;<span class="ident" id="4164964">f</span><span class="op" id="4164965">.</span><span class="ident" id="4164966">hp</span><span class="op" id="4164968">,</span>&nbsp;<span class="ident" id="4164970">p</span><span class="op" id="4164971">,</span>&nbsp;<span class="ident" id="4164973">n</span><span class="op" id="4164974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164978">p</span>&nbsp;<span class="op" id="4164980">+=</span>&nbsp;<span class="ident" id="4164983">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164987">f</span><span class="op" id="4164988">.</span><span class="ident" id="4164989">hp</span>&nbsp;<span class="op" id="4164992">+=</span>&nbsp;<span class="ident" id="4164995">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164999">f</span><span class="op" id="4165000">.</span><span class="ident" id="4165001">copyLen</span>&nbsp;<span class="op" id="4165009">-=</span>&nbsp;<span class="ident" id="4165012">n</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165016">if</span>&nbsp;<span class="ident" id="4165019">f</span><span class="op" id="4165020">.</span><span class="ident" id="4165021">hp</span>&nbsp;<span class="op" id="4165024">==</span>&nbsp;<span class="builtinfunc" id="4165027">len</span><span class="op" id="4165030">(</span><span class="ident" id="4165031">f</span><span class="op" id="4165032">.</span><span class="ident" id="4165033">hist</span><span class="op" id="4165037">)</span>&nbsp;<span class="op" id="4165039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165044">//&nbsp;After&nbsp;flush&nbsp;continue&nbsp;copying&nbsp;out&nbsp;of&nbsp;history.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165095">f</span><span class="op" id="4165096">.</span><span class="ident" id="4165097">flush</span><span class="op" id="4165102">(</span><span class="op" id="4165103">(</span><span class="op" id="4165104">*</span><span class="ident" id="4165105">decompressor</span><span class="op" id="4165117">)</span><span class="op" id="4165118">.</span><span class="ident" id="4165119">copyHuff</span><span class="op" id="4165127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165132">return</span>&nbsp;<span class="builtintype" id="4165139">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4165146">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165150">if</span>&nbsp;<span class="ident" id="4165153">p</span>&nbsp;<span class="op" id="4165155">==</span>&nbsp;<span class="builtinfunc" id="4165158">len</span><span class="op" id="4165161">(</span><span class="ident" id="4165162">f</span><span class="op" id="4165163">.</span><span class="ident" id="4165164">hist</span><span class="op" id="4165168">)</span>&nbsp;<span class="op" id="4165170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165175">p</span>&nbsp;<span class="op" id="4165177">=</span>&nbsp;<span class="num" id="4165179">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4165183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4165186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165189">return</span>&nbsp;<span class="builtintype" id="4165196">false</span><br>
<span class="lineno">550</span><span class="op" id="4165202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4165205">func</span>&nbsp;<span class="op" id="4165210">(</span><span class="ident" id="4165211">f</span>&nbsp;<span class="op" id="4165213">*</span><span class="ident" id="4165214">decompressor</span><span class="op" id="4165226">)</span>&nbsp;<span class="ident" id="4165228">copyHuff</span><span class="op" id="4165236">(</span><span class="op" id="4165237">)</span>&nbsp;<span class="op" id="4165239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165242">if</span>&nbsp;<span class="ident" id="4165245">f</span><span class="op" id="4165246">.</span><span class="ident" id="4165247">copyHist</span><span class="op" id="4165255">(</span><span class="op" id="4165256">)</span>&nbsp;<span class="op" id="4165258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165262">return</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4165270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165273">f</span><span class="op" id="4165274">.</span><span class="ident" id="4165275">huffmanBlock</span><span class="op" id="4165287">(</span><span class="op" id="4165288">)</span><br>
<span class="lineno"></span><span class="op" id="4165290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4165293">//&nbsp;Copy&nbsp;a&nbsp;single&nbsp;uncompressed&nbsp;data&nbsp;block&nbsp;from&nbsp;input&nbsp;to&nbsp;output.</span><br>
<span class="lineno">560</span><span class="keyword" id="4165356">func</span>&nbsp;<span class="op" id="4165361">(</span><span class="ident" id="4165362">f</span>&nbsp;<span class="op" id="4165364">*</span><span class="ident" id="4165365">decompressor</span><span class="op" id="4165377">)</span>&nbsp;<span class="ident" id="4165379">dataBlock</span><span class="op" id="4165388">(</span><span class="op" id="4165389">)</span>&nbsp;<span class="op" id="4165391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165394">//&nbsp;Uncompressed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165412">//&nbsp;Discard&nbsp;current&nbsp;half-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165443">f</span><span class="op" id="4165444">.</span><span class="ident" id="4165445">nb</span>&nbsp;<span class="op" id="4165448">=</span>&nbsp;<span class="num" id="4165450">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165453">f</span><span class="op" id="4165454">.</span><span class="ident" id="4165455">b</span>&nbsp;<span class="op" id="4165457">=</span>&nbsp;<span class="num" id="4165459">0</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165463">//&nbsp;Length&nbsp;then&nbsp;ones-complement&nbsp;of&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165506">nr</span><span class="op" id="4165508">,</span>&nbsp;<span class="ident" id="4165510">err</span>&nbsp;<span class="op" id="4165514">:=</span>&nbsp;<span class="ident" id="4165517">io</span><span class="op" id="4165519">.</span><span class="ident" id="4165520">ReadFull</span><span class="op" id="4165528">(</span><span class="ident" id="4165529">f</span><span class="op" id="4165530">.</span><span class="ident" id="4165531">r</span><span class="op" id="4165532">,</span>&nbsp;<span class="ident" id="4165534">f</span><span class="op" id="4165535">.</span><span class="ident" id="4165536">buf</span><span class="op" id="4165539">[</span><span class="num" id="4165540">0</span><span class="op" id="4165541">:</span><span class="num" id="4165542">4</span><span class="op" id="4165543">]</span><span class="op" id="4165544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165547">f</span><span class="op" id="4165548">.</span><span class="ident" id="4165549">roffset</span>&nbsp;<span class="op" id="4165557">+=</span>&nbsp;<span class="ident" id="4165560">int64</span><span class="op" id="4165565">(</span><span class="ident" id="4165566">nr</span><span class="op" id="4165568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165571">if</span>&nbsp;<span class="ident" id="4165574">err</span>&nbsp;<span class="op" id="4165578">!=</span>&nbsp;<span class="ident" id="4165581">nil</span>&nbsp;<span class="op" id="4165585">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165589">f</span><span class="op" id="4165590">.</span><span class="ident" id="4165591">err</span>&nbsp;<span class="op" id="4165595">=</span>&nbsp;<span class="op" id="4165597">&amp;</span><span class="ident" id="4165598">ReadError</span><span class="op" id="4165607">{</span><span class="ident" id="4165608">f</span><span class="op" id="4165609">.</span><span class="ident" id="4165610">roffset</span><span class="op" id="4165617">,</span>&nbsp;<span class="ident" id="4165619">err</span><span class="op" id="4165622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165626">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4165634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165637">n</span>&nbsp;<span class="op" id="4165639">:=</span>&nbsp;<span class="builtintype" id="4165642">int</span><span class="op" id="4165645">(</span><span class="ident" id="4165646">f</span><span class="op" id="4165647">.</span><span class="ident" id="4165648">buf</span><span class="op" id="4165651">[</span><span class="num" id="4165652">0</span><span class="op" id="4165653">]</span><span class="op" id="4165654">)</span>&nbsp;<span class="op" id="4165656">|</span>&nbsp;<span class="builtintype" id="4165658">int</span><span class="op" id="4165661">(</span><span class="ident" id="4165662">f</span><span class="op" id="4165663">.</span><span class="ident" id="4165664">buf</span><span class="op" id="4165667">[</span><span class="num" id="4165668">1</span><span class="op" id="4165669">]</span><span class="op" id="4165670">)</span><span class="op" id="4165671">&lt;&lt;</span><span class="num" id="4165673">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165676">nn</span>&nbsp;<span class="op" id="4165679">:=</span>&nbsp;<span class="builtintype" id="4165682">int</span><span class="op" id="4165685">(</span><span class="ident" id="4165686">f</span><span class="op" id="4165687">.</span><span class="ident" id="4165688">buf</span><span class="op" id="4165691">[</span><span class="num" id="4165692">2</span><span class="op" id="4165693">]</span><span class="op" id="4165694">)</span>&nbsp;<span class="op" id="4165696">|</span>&nbsp;<span class="builtintype" id="4165698">int</span><span class="op" id="4165701">(</span><span class="ident" id="4165702">f</span><span class="op" id="4165703">.</span><span class="ident" id="4165704">buf</span><span class="op" id="4165707">[</span><span class="num" id="4165708">3</span><span class="op" id="4165709">]</span><span class="op" id="4165710">)</span><span class="op" id="4165711">&lt;&lt;</span><span class="num" id="4165713">8</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165716">if</span>&nbsp;<span class="builtintype" id="4165719">uint16</span><span class="op" id="4165725">(</span><span class="ident" id="4165726">nn</span><span class="op" id="4165728">)</span>&nbsp;<span class="op" id="4165730">!=</span>&nbsp;<span class="builtintype" id="4165733">uint16</span><span class="op" id="4165739">(</span><span class="op" id="4165740">^</span><span class="ident" id="4165741">n</span><span class="op" id="4165742">)</span>&nbsp;<span class="op" id="4165744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165748">f</span><span class="op" id="4165749">.</span><span class="ident" id="4165750">err</span>&nbsp;<span class="op" id="4165754">=</span>&nbsp;<span class="ident" id="4165756">CorruptInputError</span><span class="op" id="4165773">(</span><span class="ident" id="4165774">f</span><span class="op" id="4165775">.</span><span class="ident" id="4165776">roffset</span><span class="op" id="4165783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165787">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4165795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165799">if</span>&nbsp;<span class="ident" id="4165802">n</span>&nbsp;<span class="op" id="4165804">==</span>&nbsp;<span class="num" id="4165807">0</span>&nbsp;<span class="op" id="4165809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165813">//&nbsp;0-length&nbsp;block&nbsp;means&nbsp;sync</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165844">f</span><span class="op" id="4165845">.</span><span class="ident" id="4165846">flush</span><span class="op" id="4165851">(</span><span class="op" id="4165852">(</span><span class="op" id="4165853">*</span><span class="ident" id="4165854">decompressor</span><span class="op" id="4165866">)</span><span class="op" id="4165867">.</span><span class="ident" id="4165868">nextBlock</span><span class="op" id="4165877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165881">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4165889">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165893">f</span><span class="op" id="4165894">.</span><span class="ident" id="4165895">copyLen</span>&nbsp;<span class="op" id="4165903">=</span>&nbsp;<span class="ident" id="4165905">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165908">f</span><span class="op" id="4165909">.</span><span class="ident" id="4165910">copyData</span><span class="op" id="4165918">(</span><span class="op" id="4165919">)</span><br>
<span class="lineno"></span><span class="op" id="4165921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="4165924">//&nbsp;copyData&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;into&nbsp;f.hist.</span><br>
<span class="lineno"></span><span class="comment" id="4165999">//&nbsp;It&nbsp;pauses&nbsp;for&nbsp;reads&nbsp;when&nbsp;f.hist&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4166043">func</span>&nbsp;<span class="op" id="4166048">(</span><span class="ident" id="4166049">f</span>&nbsp;<span class="op" id="4166051">*</span><span class="ident" id="4166052">decompressor</span><span class="op" id="4166064">)</span>&nbsp;<span class="ident" id="4166066">copyData</span><span class="op" id="4166074">(</span><span class="op" id="4166075">)</span>&nbsp;<span class="op" id="4166077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166080">n</span>&nbsp;<span class="op" id="4166082">:=</span>&nbsp;<span class="ident" id="4166085">f</span><span class="op" id="4166086">.</span><span class="ident" id="4166087">copyLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166096">for</span>&nbsp;<span class="ident" id="4166100">n</span>&nbsp;<span class="op" id="4166102">&gt;</span>&nbsp;<span class="num" id="4166104">0</span>&nbsp;<span class="op" id="4166106">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166110">m</span>&nbsp;<span class="op" id="4166112">:=</span>&nbsp;<span class="builtinfunc" id="4166115">len</span><span class="op" id="4166118">(</span><span class="ident" id="4166119">f</span><span class="op" id="4166120">.</span><span class="ident" id="4166121">hist</span><span class="op" id="4166125">)</span>&nbsp;<span class="op" id="4166127">-</span>&nbsp;<span class="ident" id="4166129">f</span><span class="op" id="4166130">.</span><span class="ident" id="4166131">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166136">if</span>&nbsp;<span class="ident" id="4166139">m</span>&nbsp;<span class="op" id="4166141">&gt;</span>&nbsp;<span class="ident" id="4166143">n</span>&nbsp;<span class="op" id="4166145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166150">m</span>&nbsp;<span class="op" id="4166152">=</span>&nbsp;<span class="ident" id="4166154">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166162">m</span><span class="op" id="4166163">,</span>&nbsp;<span class="ident" id="4166165">err</span>&nbsp;<span class="op" id="4166169">:=</span>&nbsp;<span class="ident" id="4166172">io</span><span class="op" id="4166174">.</span><span class="ident" id="4166175">ReadFull</span><span class="op" id="4166183">(</span><span class="ident" id="4166184">f</span><span class="op" id="4166185">.</span><span class="ident" id="4166186">r</span><span class="op" id="4166187">,</span>&nbsp;<span class="ident" id="4166189">f</span><span class="op" id="4166190">.</span><span class="ident" id="4166191">hist</span><span class="op" id="4166195">[</span><span class="ident" id="4166196">f</span><span class="op" id="4166197">.</span><span class="ident" id="4166198">hp</span><span class="op" id="4166200">:</span><span class="ident" id="4166201">f</span><span class="op" id="4166202">.</span><span class="ident" id="4166203">hp</span><span class="op" id="4166205">+</span><span class="ident" id="4166206">m</span><span class="op" id="4166207">]</span><span class="op" id="4166208">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166212">f</span><span class="op" id="4166213">.</span><span class="ident" id="4166214">roffset</span>&nbsp;<span class="op" id="4166222">+=</span>&nbsp;<span class="ident" id="4166225">int64</span><span class="op" id="4166230">(</span><span class="ident" id="4166231">m</span><span class="op" id="4166232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166236">if</span>&nbsp;<span class="ident" id="4166239">err</span>&nbsp;<span class="op" id="4166243">!=</span>&nbsp;<span class="ident" id="4166246">nil</span>&nbsp;<span class="op" id="4166250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166255">f</span><span class="op" id="4166256">.</span><span class="ident" id="4166257">err</span>&nbsp;<span class="op" id="4166261">=</span>&nbsp;<span class="op" id="4166263">&amp;</span><span class="ident" id="4166264">ReadError</span><span class="op" id="4166273">{</span><span class="ident" id="4166274">f</span><span class="op" id="4166275">.</span><span class="ident" id="4166276">roffset</span><span class="op" id="4166283">,</span>&nbsp;<span class="ident" id="4166285">err</span><span class="op" id="4166288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166293">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166302">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166306">n</span>&nbsp;<span class="op" id="4166308">-=</span>&nbsp;<span class="ident" id="4166311">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166315">f</span><span class="op" id="4166316">.</span><span class="ident" id="4166317">hp</span>&nbsp;<span class="op" id="4166320">+=</span>&nbsp;<span class="ident" id="4166323">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166327">if</span>&nbsp;<span class="ident" id="4166330">f</span><span class="op" id="4166331">.</span><span class="ident" id="4166332">hp</span>&nbsp;<span class="op" id="4166335">==</span>&nbsp;<span class="builtinfunc" id="4166338">len</span><span class="op" id="4166341">(</span><span class="ident" id="4166342">f</span><span class="op" id="4166343">.</span><span class="ident" id="4166344">hist</span><span class="op" id="4166348">)</span>&nbsp;<span class="op" id="4166350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166355">f</span><span class="op" id="4166356">.</span><span class="ident" id="4166357">copyLen</span>&nbsp;<span class="op" id="4166365">=</span>&nbsp;<span class="ident" id="4166367">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166372">f</span><span class="op" id="4166373">.</span><span class="ident" id="4166374">flush</span><span class="op" id="4166379">(</span><span class="op" id="4166380">(</span><span class="op" id="4166381">*</span><span class="ident" id="4166382">decompressor</span><span class="op" id="4166394">)</span><span class="op" id="4166395">.</span><span class="ident" id="4166396">copyData</span><span class="op" id="4166404">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166409">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166424">f</span><span class="op" id="4166425">.</span><span class="ident" id="4166426">step</span>&nbsp;<span class="op" id="4166431">=</span>&nbsp;<span class="op" id="4166433">(</span><span class="op" id="4166434">*</span><span class="ident" id="4166435">decompressor</span><span class="op" id="4166447">)</span><span class="op" id="4166448">.</span><span class="ident" id="4166449">nextBlock</span><br>
<span class="lineno"></span><span class="op" id="4166459">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="4166462">func</span>&nbsp;<span class="op" id="4166467">(</span><span class="ident" id="4166468">f</span>&nbsp;<span class="op" id="4166470">*</span><span class="ident" id="4166471">decompressor</span><span class="op" id="4166483">)</span>&nbsp;<span class="ident" id="4166485">setDict</span><span class="op" id="4166492">(</span><span class="ident" id="4166493">dict</span>&nbsp;<span class="op" id="4166498">[</span><span class="op" id="4166499">]</span><span class="builtintype" id="4166500">byte</span><span class="op" id="4166504">)</span>&nbsp;<span class="op" id="4166506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166509">if</span>&nbsp;<span class="builtinfunc" id="4166512">len</span><span class="op" id="4166515">(</span><span class="ident" id="4166516">dict</span><span class="op" id="4166520">)</span>&nbsp;<span class="op" id="4166522">&gt;</span>&nbsp;<span class="builtinfunc" id="4166524">len</span><span class="op" id="4166527">(</span><span class="ident" id="4166528">f</span><span class="op" id="4166529">.</span><span class="ident" id="4166530">hist</span><span class="op" id="4166534">)</span>&nbsp;<span class="op" id="4166536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4166540">//&nbsp;Will&nbsp;only&nbsp;remember&nbsp;the&nbsp;tail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166574">dict</span>&nbsp;<span class="op" id="4166579">=</span>&nbsp;<span class="ident" id="4166581">dict</span><span class="op" id="4166585">[</span><span class="builtinfunc" id="4166586">len</span><span class="op" id="4166589">(</span><span class="ident" id="4166590">dict</span><span class="op" id="4166594">)</span><span class="op" id="4166595">-</span><span class="builtinfunc" id="4166596">len</span><span class="op" id="4166599">(</span><span class="ident" id="4166600">f</span><span class="op" id="4166601">.</span><span class="ident" id="4166602">hist</span><span class="op" id="4166606">)</span><span class="op" id="4166607">:</span><span class="op" id="4166608">]</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166615">f</span><span class="op" id="4166616">.</span><span class="ident" id="4166617">hp</span>&nbsp;<span class="op" id="4166620">=</span>&nbsp;<span class="builtinfunc" id="4166622">copy</span><span class="op" id="4166626">(</span><span class="ident" id="4166627">f</span><span class="op" id="4166628">.</span><span class="ident" id="4166629">hist</span><span class="op" id="4166633">[</span><span class="op" id="4166634">:</span><span class="op" id="4166635">]</span><span class="op" id="4166636">,</span>&nbsp;<span class="ident" id="4166638">dict</span><span class="op" id="4166642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166645">if</span>&nbsp;<span class="ident" id="4166648">f</span><span class="op" id="4166649">.</span><span class="ident" id="4166650">hp</span>&nbsp;<span class="op" id="4166653">==</span>&nbsp;<span class="builtinfunc" id="4166656">len</span><span class="op" id="4166659">(</span><span class="ident" id="4166660">f</span><span class="op" id="4166661">.</span><span class="ident" id="4166662">hist</span><span class="op" id="4166666">)</span>&nbsp;<span class="op" id="4166668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166672">f</span><span class="op" id="4166673">.</span><span class="ident" id="4166674">hp</span>&nbsp;<span class="op" id="4166677">=</span>&nbsp;<span class="num" id="4166679">0</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166683">f</span><span class="op" id="4166684">.</span><span class="ident" id="4166685">hfull</span>&nbsp;<span class="op" id="4166691">=</span>&nbsp;<span class="builtintype" id="4166693">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166702">f</span><span class="op" id="4166703">.</span><span class="ident" id="4166704">hw</span>&nbsp;<span class="op" id="4166707">=</span>&nbsp;<span class="ident" id="4166709">f</span><span class="op" id="4166710">.</span><span class="ident" id="4166711">hp</span><br>
<span class="lineno"></span><span class="op" id="4166714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="keyword" id="4166717">func</span>&nbsp;<span class="op" id="4166722">(</span><span class="ident" id="4166723">f</span>&nbsp;<span class="op" id="4166725">*</span><span class="ident" id="4166726">decompressor</span><span class="op" id="4166738">)</span>&nbsp;<span class="ident" id="4166740">moreBits</span><span class="op" id="4166748">(</span><span class="op" id="4166749">)</span>&nbsp;<span class="builtintype" id="4166751">error</span>&nbsp;<span class="op" id="4166757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166760">c</span><span class="op" id="4166761">,</span>&nbsp;<span class="ident" id="4166763">err</span>&nbsp;<span class="op" id="4166767">:=</span>&nbsp;<span class="ident" id="4166770">f</span><span class="op" id="4166771">.</span><span class="ident" id="4166772">r</span><span class="op" id="4166773">.</span><span class="ident" id="4166774">ReadByte</span><span class="op" id="4166782">(</span><span class="op" id="4166783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166786">if</span>&nbsp;<span class="ident" id="4166789">err</span>&nbsp;<span class="op" id="4166793">!=</span>&nbsp;<span class="ident" id="4166796">nil</span>&nbsp;<span class="op" id="4166800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166804">if</span>&nbsp;<span class="ident" id="4166807">err</span>&nbsp;<span class="op" id="4166811">==</span>&nbsp;<span class="ident" id="4166814">io</span><span class="op" id="4166816">.</span><span class="ident" id="4166817">EOF</span>&nbsp;<span class="op" id="4166821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166826">err</span>&nbsp;<span class="op" id="4166830">=</span>&nbsp;<span class="ident" id="4166832">io</span><span class="op" id="4166834">.</span><span class="ident" id="4166835">ErrUnexpectedEOF</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166858">return</span>&nbsp;<span class="ident" id="4166865">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166873">f</span><span class="op" id="4166874">.</span><span class="ident" id="4166875">roffset</span><span class="op" id="4166882">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166886">f</span><span class="op" id="4166887">.</span><span class="ident" id="4166888">b</span>&nbsp;<span class="op" id="4166890">|=</span>&nbsp;<span class="builtintype" id="4166893">uint32</span><span class="op" id="4166899">(</span><span class="ident" id="4166900">c</span><span class="op" id="4166901">)</span>&nbsp;<span class="op" id="4166903">&lt;&lt;</span>&nbsp;<span class="ident" id="4166906">f</span><span class="op" id="4166907">.</span><span class="ident" id="4166908">nb</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166912">f</span><span class="op" id="4166913">.</span><span class="ident" id="4166914">nb</span>&nbsp;<span class="op" id="4166917">+=</span>&nbsp;<span class="num" id="4166920">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166923">return</span>&nbsp;<span class="ident" id="4166930">nil</span><br>
<span class="lineno"></span><span class="op" id="4166934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4166937">//&nbsp;Read&nbsp;the&nbsp;next&nbsp;Huffman-encoded&nbsp;symbol&nbsp;from&nbsp;f&nbsp;according&nbsp;to&nbsp;h.</span><br>
<span class="lineno">645</span><span class="keyword" id="4167000">func</span>&nbsp;<span class="op" id="4167005">(</span><span class="ident" id="4167006">f</span>&nbsp;<span class="op" id="4167008">*</span><span class="ident" id="4167009">decompressor</span><span class="op" id="4167021">)</span>&nbsp;<span class="ident" id="4167023">huffSym</span><span class="op" id="4167030">(</span><span class="ident" id="4167031">h</span>&nbsp;<span class="op" id="4167033">*</span><span class="ident" id="4167034">huffmanDecoder</span><span class="op" id="4167048">)</span>&nbsp;<span class="op" id="4167050">(</span><span class="builtintype" id="4167051">int</span><span class="op" id="4167054">,</span>&nbsp;<span class="builtintype" id="4167056">error</span><span class="op" id="4167061">)</span>&nbsp;<span class="op" id="4167063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167066">n</span>&nbsp;<span class="op" id="4167068">:=</span>&nbsp;<span class="builtintype" id="4167071">uint</span><span class="op" id="4167075">(</span><span class="ident" id="4167076">h</span><span class="op" id="4167077">.</span><span class="ident" id="4167078">min</span><span class="op" id="4167081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167084">for</span>&nbsp;<span class="op" id="4167088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167092">for</span>&nbsp;<span class="ident" id="4167096">f</span><span class="op" id="4167097">.</span><span class="ident" id="4167098">nb</span>&nbsp;<span class="op" id="4167101">&lt;</span>&nbsp;<span class="ident" id="4167103">n</span>&nbsp;<span class="op" id="4167105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167110">if</span>&nbsp;<span class="ident" id="4167113">err</span>&nbsp;<span class="op" id="4167117">:=</span>&nbsp;<span class="ident" id="4167120">f</span><span class="op" id="4167121">.</span><span class="ident" id="4167122">moreBits</span><span class="op" id="4167130">(</span><span class="op" id="4167131">)</span><span class="op" id="4167132">;</span>&nbsp;<span class="ident" id="4167134">err</span>&nbsp;<span class="op" id="4167138">!=</span>&nbsp;<span class="ident" id="4167141">nil</span>&nbsp;<span class="op" id="4167145">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167151">return</span>&nbsp;<span class="num" id="4167158">0</span><span class="op" id="4167159">,</span>&nbsp;<span class="ident" id="4167161">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167176">chunk</span>&nbsp;<span class="op" id="4167182">:=</span>&nbsp;<span class="ident" id="4167185">h</span><span class="op" id="4167186">.</span><span class="ident" id="4167187">chunks</span><span class="op" id="4167193">[</span><span class="ident" id="4167194">f</span><span class="op" id="4167195">.</span><span class="ident" id="4167196">b</span><span class="op" id="4167197">&amp;</span><span class="op" id="4167198">(</span><span class="ident" id="4167199">huffmanNumChunks</span><span class="op" id="4167215">-</span><span class="num" id="4167216">1</span><span class="op" id="4167217">)</span><span class="op" id="4167218">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167222">n</span>&nbsp;<span class="op" id="4167224">=</span>&nbsp;<span class="builtintype" id="4167226">uint</span><span class="op" id="4167230">(</span><span class="ident" id="4167231">chunk</span>&nbsp;<span class="op" id="4167237">&amp;</span>&nbsp;<span class="ident" id="4167239">huffmanCountMask</span><span class="op" id="4167255">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167259">if</span>&nbsp;<span class="ident" id="4167262">n</span>&nbsp;<span class="op" id="4167264">&gt;</span>&nbsp;<span class="ident" id="4167266">huffmanChunkBits</span>&nbsp;<span class="op" id="4167283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167288">chunk</span>&nbsp;<span class="op" id="4167294">=</span>&nbsp;<span class="ident" id="4167296">h</span><span class="op" id="4167297">.</span><span class="ident" id="4167298">links</span><span class="op" id="4167303">[</span><span class="ident" id="4167304">chunk</span><span class="op" id="4167309">&gt;&gt;</span><span class="ident" id="4167311">huffmanValueShift</span><span class="op" id="4167328">]</span><span class="op" id="4167329">[</span><span class="op" id="4167330">(</span><span class="ident" id="4167331">f</span><span class="op" id="4167332">.</span><span class="ident" id="4167333">b</span><span class="op" id="4167334">&gt;&gt;</span><span class="ident" id="4167336">huffmanChunkBits</span><span class="op" id="4167352">)</span><span class="op" id="4167353">&amp;</span><span class="ident" id="4167354">h</span><span class="op" id="4167355">.</span><span class="ident" id="4167356">linkMask</span><span class="op" id="4167364">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167369">n</span>&nbsp;<span class="op" id="4167371">=</span>&nbsp;<span class="builtintype" id="4167373">uint</span><span class="op" id="4167377">(</span><span class="ident" id="4167378">chunk</span>&nbsp;<span class="op" id="4167384">&amp;</span>&nbsp;<span class="ident" id="4167386">huffmanCountMask</span><span class="op" id="4167402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167407">if</span>&nbsp;<span class="ident" id="4167410">n</span>&nbsp;<span class="op" id="4167412">==</span>&nbsp;<span class="num" id="4167415">0</span>&nbsp;<span class="op" id="4167417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167423">f</span><span class="op" id="4167424">.</span><span class="ident" id="4167425">err</span>&nbsp;<span class="op" id="4167429">=</span>&nbsp;<span class="ident" id="4167431">CorruptInputError</span><span class="op" id="4167448">(</span><span class="ident" id="4167449">f</span><span class="op" id="4167450">.</span><span class="ident" id="4167451">roffset</span><span class="op" id="4167458">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167464">return</span>&nbsp;<span class="num" id="4167471">0</span><span class="op" id="4167472">,</span>&nbsp;<span class="ident" id="4167474">f</span><span class="op" id="4167475">.</span><span class="ident" id="4167476">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167491">if</span>&nbsp;<span class="ident" id="4167494">n</span>&nbsp;<span class="op" id="4167496">&lt;=</span>&nbsp;<span class="ident" id="4167499">f</span><span class="op" id="4167500">.</span><span class="ident" id="4167501">nb</span>&nbsp;<span class="op" id="4167504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167509">f</span><span class="op" id="4167510">.</span><span class="ident" id="4167511">b</span>&nbsp;<span class="op" id="4167513">&gt;&gt;=</span>&nbsp;<span class="ident" id="4167517">n</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167522">f</span><span class="op" id="4167523">.</span><span class="ident" id="4167524">nb</span>&nbsp;<span class="op" id="4167527">-=</span>&nbsp;<span class="ident" id="4167530">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167535">return</span>&nbsp;<span class="builtintype" id="4167542">int</span><span class="op" id="4167545">(</span><span class="ident" id="4167546">chunk</span>&nbsp;<span class="op" id="4167552">&gt;&gt;</span>&nbsp;<span class="ident" id="4167555">huffmanValueShift</span><span class="op" id="4167572">)</span><span class="op" id="4167573">,</span>&nbsp;<span class="ident" id="4167575">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167584">}</span><br>
<span class="lineno"></span><span class="op" id="4167586">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="4167589">//&nbsp;Flush&nbsp;any&nbsp;buffered&nbsp;output&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4167644">func</span>&nbsp;<span class="op" id="4167649">(</span><span class="ident" id="4167650">f</span>&nbsp;<span class="op" id="4167652">*</span><span class="ident" id="4167653">decompressor</span><span class="op" id="4167665">)</span>&nbsp;<span class="ident" id="4167667">flush</span><span class="op" id="4167672">(</span><span class="ident" id="4167673">step</span>&nbsp;<span class="keyword" id="4167678">func</span><span class="op" id="4167682">(</span><span class="op" id="4167683">*</span><span class="ident" id="4167684">decompressor</span><span class="op" id="4167696">)</span><span class="op" id="4167697">)</span>&nbsp;<span class="op" id="4167699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167702">f</span><span class="op" id="4167703">.</span><span class="ident" id="4167704">toRead</span>&nbsp;<span class="op" id="4167711">=</span>&nbsp;<span class="ident" id="4167713">f</span><span class="op" id="4167714">.</span><span class="ident" id="4167715">hist</span><span class="op" id="4167719">[</span><span class="ident" id="4167720">f</span><span class="op" id="4167721">.</span><span class="ident" id="4167722">hw</span><span class="op" id="4167724">:</span><span class="ident" id="4167725">f</span><span class="op" id="4167726">.</span><span class="ident" id="4167727">hp</span><span class="op" id="4167729">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167732">f</span><span class="op" id="4167733">.</span><span class="ident" id="4167734">woffset</span>&nbsp;<span class="op" id="4167742">+=</span>&nbsp;<span class="ident" id="4167745">int64</span><span class="op" id="4167750">(</span><span class="ident" id="4167751">f</span><span class="op" id="4167752">.</span><span class="ident" id="4167753">hp</span>&nbsp;<span class="op" id="4167756">-</span>&nbsp;<span class="ident" id="4167758">f</span><span class="op" id="4167759">.</span><span class="ident" id="4167760">hw</span><span class="op" id="4167762">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167765">f</span><span class="op" id="4167766">.</span><span class="ident" id="4167767">hw</span>&nbsp;<span class="op" id="4167770">=</span>&nbsp;<span class="ident" id="4167772">f</span><span class="op" id="4167773">.</span><span class="ident" id="4167774">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167778">if</span>&nbsp;<span class="ident" id="4167781">f</span><span class="op" id="4167782">.</span><span class="ident" id="4167783">hp</span>&nbsp;<span class="op" id="4167786">==</span>&nbsp;<span class="builtinfunc" id="4167789">len</span><span class="op" id="4167792">(</span><span class="ident" id="4167793">f</span><span class="op" id="4167794">.</span><span class="ident" id="4167795">hist</span><span class="op" id="4167799">)</span>&nbsp;<span class="op" id="4167801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167805">f</span><span class="op" id="4167806">.</span><span class="ident" id="4167807">hp</span>&nbsp;<span class="op" id="4167810">=</span>&nbsp;<span class="num" id="4167812">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167816">f</span><span class="op" id="4167817">.</span><span class="ident" id="4167818">hw</span>&nbsp;<span class="op" id="4167821">=</span>&nbsp;<span class="num" id="4167823">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167827">f</span><span class="op" id="4167828">.</span><span class="ident" id="4167829">hfull</span>&nbsp;<span class="op" id="4167835">=</span>&nbsp;<span class="builtintype" id="4167837">true</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167846">f</span><span class="op" id="4167847">.</span><span class="ident" id="4167848">step</span>&nbsp;<span class="op" id="4167853">=</span>&nbsp;<span class="ident" id="4167855">step</span><br>
<span class="lineno"></span><span class="op" id="4167860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4167863">func</span>&nbsp;<span class="ident" id="4167868">makeReader</span><span class="op" id="4167878">(</span><span class="ident" id="4167879">r</span>&nbsp;<span class="ident" id="4167881">io</span><span class="op" id="4167883">.</span><span class="ident" id="4167884">Reader</span><span class="op" id="4167890">)</span>&nbsp;<span class="ident" id="4167892">Reader</span>&nbsp;<span class="op" id="4167899">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167902">if</span>&nbsp;<span class="ident" id="4167905">rr</span><span class="op" id="4167907">,</span>&nbsp;<span class="ident" id="4167909">ok</span>&nbsp;<span class="op" id="4167912">:=</span>&nbsp;<span class="ident" id="4167915">r</span><span class="op" id="4167916">.</span><span class="op" id="4167917">(</span><span class="ident" id="4167918">Reader</span><span class="op" id="4167924">)</span><span class="op" id="4167925">;</span>&nbsp;<span class="ident" id="4167927">ok</span>&nbsp;<span class="op" id="4167930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167934">return</span>&nbsp;<span class="ident" id="4167941">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167948">return</span>&nbsp;<span class="ident" id="4167955">bufio</span><span class="op" id="4167960">.</span><span class="ident" id="4167961">NewReader</span><span class="op" id="4167970">(</span><span class="ident" id="4167971">r</span><span class="op" id="4167972">)</span><br>
<span class="lineno"></span><span class="op" id="4167974">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="4167977">func</span>&nbsp;<span class="op" id="4167982">(</span><span class="ident" id="4167983">f</span>&nbsp;<span class="op" id="4167985">*</span><span class="ident" id="4167986">decompressor</span><span class="op" id="4167998">)</span>&nbsp;<span class="ident" id="4168000">Reset</span><span class="op" id="4168005">(</span><span class="ident" id="4168006">r</span>&nbsp;<span class="ident" id="4168008">io</span><span class="op" id="4168010">.</span><span class="ident" id="4168011">Reader</span><span class="op" id="4168017">,</span>&nbsp;<span class="ident" id="4168019">dict</span>&nbsp;<span class="op" id="4168024">[</span><span class="op" id="4168025">]</span><span class="builtintype" id="4168026">byte</span><span class="op" id="4168030">)</span>&nbsp;<span class="builtintype" id="4168032">error</span>&nbsp;<span class="op" id="4168038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4168041">*</span><span class="ident" id="4168042">f</span>&nbsp;<span class="op" id="4168044">=</span>&nbsp;<span class="ident" id="4168046">decompressor</span><span class="op" id="4168058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168062">r</span><span class="op" id="4168063">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4168072">makeReader</span><span class="op" id="4168082">(</span><span class="ident" id="4168083">r</span><span class="op" id="4168084">)</span><span class="op" id="4168085">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168089">bits</span><span class="op" id="4168093">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4168099">f</span><span class="op" id="4168100">.</span><span class="ident" id="4168101">bits</span><span class="op" id="4168105">,</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168109">codebits</span><span class="op" id="4168117">:</span>&nbsp;<span class="ident" id="4168119">f</span><span class="op" id="4168120">.</span><span class="ident" id="4168121">codebits</span><span class="op" id="4168129">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168133">hist</span><span class="op" id="4168137">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4168143">f</span><span class="op" id="4168144">.</span><span class="ident" id="4168145">hist</span><span class="op" id="4168149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168153">step</span><span class="op" id="4168157">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4168163">(</span><span class="op" id="4168164">*</span><span class="ident" id="4168165">decompressor</span><span class="op" id="4168177">)</span><span class="op" id="4168178">.</span><span class="ident" id="4168179">nextBlock</span><span class="op" id="4168188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4168191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168194">if</span>&nbsp;<span class="ident" id="4168197">dict</span>&nbsp;<span class="op" id="4168202">!=</span>&nbsp;<span class="ident" id="4168205">nil</span>&nbsp;<span class="op" id="4168209">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168213">f</span><span class="op" id="4168214">.</span><span class="ident" id="4168215">setDict</span><span class="op" id="4168222">(</span><span class="ident" id="4168223">dict</span><span class="op" id="4168227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4168230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168233">return</span>&nbsp;<span class="ident" id="4168240">nil</span><br>
<span class="lineno"></span><span class="op" id="4168244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="4168247">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;ReadCloser&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4168302">//&nbsp;to&nbsp;read&nbsp;the&nbsp;uncompressed&nbsp;version&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4168344">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4168391">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4168453">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser</span><br>
<span class="lineno">710</span><span class="comment" id="4168522">//&nbsp;when&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="4168548">//</span><br>
<span class="lineno"></span><span class="comment" id="4168551">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno"></span><span class="keyword" id="4168617">func</span>&nbsp;<span class="ident" id="4168622">NewReader</span><span class="op" id="4168631">(</span><span class="ident" id="4168632">r</span>&nbsp;<span class="ident" id="4168634">io</span><span class="op" id="4168636">.</span><span class="ident" id="4168637">Reader</span><span class="op" id="4168643">)</span>&nbsp;<span class="ident" id="4168645">io</span><span class="op" id="4168647">.</span><span class="ident" id="4168648">ReadCloser</span>&nbsp;<span class="op" id="4168659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168662">var</span>&nbsp;<span class="ident" id="4168666">f</span>&nbsp;<span class="ident" id="4168668">decompressor</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168682">f</span><span class="op" id="4168683">.</span><span class="ident" id="4168684">bits</span>&nbsp;<span class="op" id="4168689">=</span>&nbsp;<span class="builtinfunc" id="4168691">new</span><span class="op" id="4168694">(</span><span class="op" id="4168695">[</span><span class="ident" id="4168696">maxLit</span>&nbsp;<span class="op" id="4168703">+</span>&nbsp;<span class="ident" id="4168705">maxDist</span><span class="op" id="4168712">]</span><span class="builtintype" id="4168713">int</span><span class="op" id="4168716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168719">f</span><span class="op" id="4168720">.</span><span class="ident" id="4168721">codebits</span>&nbsp;<span class="op" id="4168730">=</span>&nbsp;<span class="builtinfunc" id="4168732">new</span><span class="op" id="4168735">(</span><span class="op" id="4168736">[</span><span class="ident" id="4168737">numCodes</span><span class="op" id="4168745">]</span><span class="builtintype" id="4168746">int</span><span class="op" id="4168749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168752">f</span><span class="op" id="4168753">.</span><span class="ident" id="4168754">r</span>&nbsp;<span class="op" id="4168756">=</span>&nbsp;<span class="ident" id="4168758">makeReader</span><span class="op" id="4168768">(</span><span class="ident" id="4168769">r</span><span class="op" id="4168770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168773">f</span><span class="op" id="4168774">.</span><span class="ident" id="4168775">hist</span>&nbsp;<span class="op" id="4168780">=</span>&nbsp;<span class="builtinfunc" id="4168782">new</span><span class="op" id="4168785">(</span><span class="op" id="4168786">[</span><span class="ident" id="4168787">maxHist</span><span class="op" id="4168794">]</span><span class="builtintype" id="4168795">byte</span><span class="op" id="4168799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168802">f</span><span class="op" id="4168803">.</span><span class="ident" id="4168804">step</span>&nbsp;<span class="op" id="4168809">=</span>&nbsp;<span class="op" id="4168811">(</span><span class="op" id="4168812">*</span><span class="ident" id="4168813">decompressor</span><span class="op" id="4168825">)</span><span class="op" id="4168826">.</span><span class="ident" id="4168827">nextBlock</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168838">return</span>&nbsp;<span class="op" id="4168845">&amp;</span><span class="ident" id="4168846">f</span><br>
<span class="lineno"></span><span class="op" id="4168848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4168851">//&nbsp;NewReaderDict&nbsp;is&nbsp;like&nbsp;NewReader&nbsp;but&nbsp;initializes&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="4168913">//&nbsp;with&nbsp;a&nbsp;preset&nbsp;dictionary.&nbsp;&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;behaves&nbsp;as&nbsp;if</span><br>
<span class="lineno">725</span><span class="comment" id="4168977">//&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;stream&nbsp;started&nbsp;with&nbsp;the&nbsp;given&nbsp;dictionary,</span><br>
<span class="lineno"></span><span class="comment" id="4169044">//&nbsp;which&nbsp;has&nbsp;already&nbsp;been&nbsp;read.&nbsp;&nbsp;NewReaderDict&nbsp;is&nbsp;typically&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4169109">//&nbsp;to&nbsp;read&nbsp;data&nbsp;compressed&nbsp;by&nbsp;NewWriterDict.</span><br>
<span class="lineno"></span><span class="comment" id="4169154">//</span><br>
<span class="lineno"></span><span class="comment" id="4169157">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno">730</span><span class="keyword" id="4169223">func</span>&nbsp;<span class="ident" id="4169228">NewReaderDict</span><span class="op" id="4169241">(</span><span class="ident" id="4169242">r</span>&nbsp;<span class="ident" id="4169244">io</span><span class="op" id="4169246">.</span><span class="ident" id="4169247">Reader</span><span class="op" id="4169253">,</span>&nbsp;<span class="ident" id="4169255">dict</span>&nbsp;<span class="op" id="4169260">[</span><span class="op" id="4169261">]</span><span class="builtintype" id="4169262">byte</span><span class="op" id="4169266">)</span>&nbsp;<span class="ident" id="4169268">io</span><span class="op" id="4169270">.</span><span class="ident" id="4169271">ReadCloser</span>&nbsp;<span class="op" id="4169282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169285">var</span>&nbsp;<span class="ident" id="4169289">f</span>&nbsp;<span class="ident" id="4169291">decompressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169305">f</span><span class="op" id="4169306">.</span><span class="ident" id="4169307">r</span>&nbsp;<span class="op" id="4169309">=</span>&nbsp;<span class="ident" id="4169311">makeReader</span><span class="op" id="4169321">(</span><span class="ident" id="4169322">r</span><span class="op" id="4169323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169326">f</span><span class="op" id="4169327">.</span><span class="ident" id="4169328">hist</span>&nbsp;<span class="op" id="4169333">=</span>&nbsp;<span class="builtinfunc" id="4169335">new</span><span class="op" id="4169338">(</span><span class="op" id="4169339">[</span><span class="ident" id="4169340">maxHist</span><span class="op" id="4169347">]</span><span class="builtintype" id="4169348">byte</span><span class="op" id="4169352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169355">f</span><span class="op" id="4169356">.</span><span class="ident" id="4169357">bits</span>&nbsp;<span class="op" id="4169362">=</span>&nbsp;<span class="builtinfunc" id="4169364">new</span><span class="op" id="4169367">(</span><span class="op" id="4169368">[</span><span class="ident" id="4169369">maxLit</span>&nbsp;<span class="op" id="4169376">+</span>&nbsp;<span class="ident" id="4169378">maxDist</span><span class="op" id="4169385">]</span><span class="builtintype" id="4169386">int</span><span class="op" id="4169389">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169392">f</span><span class="op" id="4169393">.</span><span class="ident" id="4169394">codebits</span>&nbsp;<span class="op" id="4169403">=</span>&nbsp;<span class="builtinfunc" id="4169405">new</span><span class="op" id="4169408">(</span><span class="op" id="4169409">[</span><span class="ident" id="4169410">numCodes</span><span class="op" id="4169418">]</span><span class="builtintype" id="4169419">int</span><span class="op" id="4169422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169425">f</span><span class="op" id="4169426">.</span><span class="ident" id="4169427">step</span>&nbsp;<span class="op" id="4169432">=</span>&nbsp;<span class="op" id="4169434">(</span><span class="op" id="4169435">*</span><span class="ident" id="4169436">decompressor</span><span class="op" id="4169448">)</span><span class="op" id="4169449">.</span><span class="ident" id="4169450">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169461">f</span><span class="op" id="4169462">.</span><span class="ident" id="4169463">setDict</span><span class="op" id="4169470">(</span><span class="ident" id="4169471">dict</span><span class="op" id="4169475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169478">return</span>&nbsp;<span class="op" id="4169485">&amp;</span><span class="ident" id="4169486">f</span><br>
<span class="lineno"></span><span class="op" id="4169488">}</span>
</div>
</body>
</html>
