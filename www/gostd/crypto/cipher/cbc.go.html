<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html" class="current">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4404736">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4404791">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4404845">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4404896">//&nbsp;Cipher&nbsp;block&nbsp;chaining&nbsp;(CBC)&nbsp;mode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4404934">//&nbsp;CBC&nbsp;provides&nbsp;confidentiality&nbsp;by&nbsp;xoring&nbsp;(chaining)&nbsp;each&nbsp;plaintext&nbsp;block</span><br>
<span class="lineno"></span><span class="comment" id="4405008">//&nbsp;with&nbsp;the&nbsp;previous&nbsp;ciphertext&nbsp;block&nbsp;before&nbsp;applying&nbsp;the&nbsp;block&nbsp;cipher.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="4405081">//&nbsp;See&nbsp;NIST&nbsp;SP&nbsp;800-38A,&nbsp;pp&nbsp;10-11</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4405115">package</span>&nbsp;<span class="ident" id="4405123">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4405131">type</span>&nbsp;<span class="ident" id="4405136">cbc</span>&nbsp;<span class="keyword" id="4405140">struct</span>&nbsp;<span class="op" id="4405147">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405150">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405160"><a href="/gostd/crypto/cipher/cipher.go.html#4410698">Block</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405167">blockSize</span>&nbsp;<span class="builtintype" id="4405177">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405182">iv</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4405192">[</span><span class="op" id="4405193">]</span><span class="builtintype" id="4405194">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405200">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4405210">[</span><span class="op" id="4405211">]</span><span class="builtintype" id="4405212">byte</span><br>
<span class="lineno"></span><span class="op" id="4405217">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="4405220">func</span>&nbsp;<span class="ident" id="4405225">newCBC</span><span class="op" id="4405231">(</span><span class="ident" id="4405232">b</span>&nbsp;<span class="ident" id="4405234"><a href="/gostd/crypto/cipher/cipher.go.html#4410698">Block</a></span><span class="op" id="4405239">,</span>&nbsp;<span class="ident" id="4405241">iv</span>&nbsp;<span class="op" id="4405244">[</span><span class="op" id="4405245">]</span><span class="builtintype" id="4405246">byte</span><span class="op" id="4405250">)</span>&nbsp;<span class="op" id="4405252">*</span><span class="ident" id="4405253"><a href="/gostd/crypto/cipher/cbc.go.html#4405136">cbc</a></span>&nbsp;<span class="op" id="4405257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405260">return</span>&nbsp;<span class="op" id="4405267">&amp;</span><span class="ident" id="4405268"><a href="/gostd/crypto/cipher/cbc.go.html#4405136">cbc</a></span><span class="op" id="4405271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405275"><a href="/gostd/crypto/cipher/cbc.go.html#4405150">b</a></span><span class="op" id="4405276">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405286"><a href="/gostd/crypto/cipher/cbc.go.html#4405232">b</a></span><span class="op" id="4405287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405291"><a href="/gostd/crypto/cipher/cbc.go.html#4405167">blockSize</a></span><span class="op" id="4405300">:</span>&nbsp;<span class="ident" id="4405302"><a href="/gostd/crypto/cipher/cbc.go.html#4405232">b</a></span><span class="op" id="4405303">.</span><span class="ident" id="4405304"><a href="/gostd/crypto/cipher/cipher.go.html#4410764">BlockSize</a></span><span class="op" id="4405313">(</span><span class="op" id="4405314">)</span><span class="op" id="4405315">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405319"><a href="/gostd/crypto/cipher/cbc.go.html#4405182">iv</a></span><span class="op" id="4405321">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405330"><a href="/gostd/crypto/cipher/cipher.go.html#4411676">dup</a></span><span class="op" id="4405333">(</span><span class="ident" id="4405334"><a href="/gostd/crypto/cipher/cbc.go.html#4405241">iv</a></span><span class="op" id="4405336">)</span><span class="op" id="4405337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405341"><a href="/gostd/crypto/cipher/cbc.go.html#4405200">tmp</a></span><span class="op" id="4405344">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4405352">make</span><span class="op" id="4405356">(</span><span class="op" id="4405357">[</span><span class="op" id="4405358">]</span><span class="builtintype" id="4405359">byte</span><span class="op" id="4405363">,</span>&nbsp;<span class="ident" id="4405365"><a href="/gostd/crypto/cipher/cbc.go.html#4405232">b</a></span><span class="op" id="4405366">.</span><span class="ident" id="4405367"><a href="/gostd/crypto/cipher/cipher.go.html#4410764">BlockSize</a></span><span class="op" id="4405376">(</span><span class="op" id="4405377">)</span><span class="op" id="4405378">)</span><span class="op" id="4405379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4405382">}</span><br>
<span class="lineno"></span><span class="op" id="4405384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4405387">type</span>&nbsp;<span class="ident" id="4405392">cbcEncrypter</span>&nbsp;<span class="ident" id="4405405"><a href="/gostd/crypto/cipher/cbc.go.html#4405136">cbc</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4405410">//&nbsp;NewCBCEncrypter&nbsp;returns&nbsp;a&nbsp;BlockMode&nbsp;which&nbsp;encrypts&nbsp;in&nbsp;cipher&nbsp;block&nbsp;chaining</span><br>
<span class="lineno"></span><span class="comment" id="4405489">//&nbsp;mode,&nbsp;using&nbsp;the&nbsp;given&nbsp;Block.&nbsp;The&nbsp;length&nbsp;of&nbsp;iv&nbsp;must&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4405562">//&nbsp;Block&#39;s&nbsp;block&nbsp;size.</span><br>
<span class="lineno">35</span><span class="keyword" id="4405585">func</span>&nbsp;<span class="ident" id="4405590">NewCBCEncrypter</span><span class="op" id="4405605">(</span><span class="ident" id="4405606">b</span>&nbsp;<span class="ident" id="4405608"><a href="/gostd/crypto/cipher/cipher.go.html#4410698">Block</a></span><span class="op" id="4405613">,</span>&nbsp;<span class="ident" id="4405615">iv</span>&nbsp;<span class="op" id="4405618">[</span><span class="op" id="4405619">]</span><span class="builtintype" id="4405620">byte</span><span class="op" id="4405624">)</span>&nbsp;<span class="ident" id="4405626"><a href="/gostd/crypto/cipher/cipher.go.html#4411369">BlockMode</a></span>&nbsp;<span class="op" id="4405636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405639">if</span>&nbsp;<span class="builtinfunc" id="4405642">len</span><span class="op" id="4405645">(</span><span class="ident" id="4405646"><a href="/gostd/crypto/cipher/cbc.go.html#4405615">iv</a></span><span class="op" id="4405648">)</span>&nbsp;<span class="op" id="4405650">!=</span>&nbsp;<span class="ident" id="4405653"><a href="/gostd/crypto/cipher/cbc.go.html#4405606">b</a></span><span class="op" id="4405654">.</span><span class="ident" id="4405655"><a href="/gostd/crypto/cipher/cipher.go.html#4410764">BlockSize</a></span><span class="op" id="4405664">(</span><span class="op" id="4405665">)</span>&nbsp;<span class="op" id="4405667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4405671">panic</span><span class="op" id="4405676">(</span><span class="string" id="4405677">&#34;cipher.NewCBCEncrypter:&nbsp;IV&nbsp;length&nbsp;must&nbsp;equal&nbsp;block&nbsp;size&#34;</span><span class="op" id="4405734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4405737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405740">return</span>&nbsp;<span class="op" id="4405747">(</span><span class="op" id="4405748">*</span><span class="ident" id="4405749"><a href="/gostd/crypto/cipher/cbc.go.html#4405392">cbcEncrypter</a></span><span class="op" id="4405761">)</span><span class="op" id="4405762">(</span><span class="ident" id="4405763"><a href="/gostd/crypto/cipher/cbc.go.html#4405225">newCBC</a></span><span class="op" id="4405769">(</span><span class="ident" id="4405770"><a href="/gostd/crypto/cipher/cbc.go.html#4405606">b</a></span><span class="op" id="4405771">,</span>&nbsp;<span class="ident" id="4405773"><a href="/gostd/crypto/cipher/cbc.go.html#4405615">iv</a></span><span class="op" id="4405775">)</span><span class="op" id="4405776">)</span><br>
<span class="lineno">40</span><span class="op" id="4405778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4405781">func</span>&nbsp;<span class="op" id="4405786">(</span><span class="ident" id="4405787">x</span>&nbsp;<span class="op" id="4405789">*</span><span class="ident" id="4405790"><a href="/gostd/crypto/cipher/cbc.go.html#4405392">cbcEncrypter</a></span><span class="op" id="4405802">)</span>&nbsp;<span class="ident" id="4405804">BlockSize</span><span class="op" id="4405813">(</span><span class="op" id="4405814">)</span>&nbsp;<span class="builtintype" id="4405816">int</span>&nbsp;<span class="op" id="4405820">{</span>&nbsp;<span class="keyword" id="4405822">return</span>&nbsp;<span class="ident" id="4405829"><a href="/gostd/crypto/cipher/cbc.go.html#4405787">x</a></span><span class="op" id="4405830">.</span><span class="ident" id="4405831"><a href="/gostd/crypto/cipher/cbc.go.html#4405167">blockSize</a></span>&nbsp;<span class="op" id="4405841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4405844">func</span>&nbsp;<span class="op" id="4405849">(</span><span class="ident" id="4405850">x</span>&nbsp;<span class="op" id="4405852">*</span><span class="ident" id="4405853"><a href="/gostd/crypto/cipher/cbc.go.html#4405392">cbcEncrypter</a></span><span class="op" id="4405865">)</span>&nbsp;<span class="ident" id="4405867">CryptBlocks</span><span class="op" id="4405878">(</span><span class="ident" id="4405879">dst</span><span class="op" id="4405882">,</span>&nbsp;<span class="ident" id="4405884">src</span>&nbsp;<span class="op" id="4405888">[</span><span class="op" id="4405889">]</span><span class="builtintype" id="4405890">byte</span><span class="op" id="4405894">)</span>&nbsp;<span class="op" id="4405896">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405899">if</span>&nbsp;<span class="builtinfunc" id="4405902">len</span><span class="op" id="4405905">(</span><span class="ident" id="4405906"><a href="/gostd/crypto/cipher/cbc.go.html#4405884">src</a></span><span class="op" id="4405909">)</span><span class="op" id="4405910">%</span><span class="ident" id="4405911"><a href="/gostd/crypto/cipher/cbc.go.html#4405850">x</a></span><span class="op" id="4405912">.</span><span class="ident" id="4405913"><a href="/gostd/crypto/cipher/cbc.go.html#4405167">blockSize</a></span>&nbsp;<span class="op" id="4405923">!=</span>&nbsp;<span class="num" id="4405926">0</span>&nbsp;<span class="op" id="4405928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4405932">panic</span><span class="op" id="4405937">(</span><span class="string" id="4405938">&#34;crypto/cipher:&nbsp;input&nbsp;not&nbsp;full&nbsp;blocks&#34;</span><span class="op" id="4405976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4405979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4405982">if</span>&nbsp;<span class="builtinfunc" id="4405985">len</span><span class="op" id="4405988">(</span><span class="ident" id="4405989"><a href="/gostd/crypto/cipher/cbc.go.html#4405879">dst</a></span><span class="op" id="4405992">)</span>&nbsp;<span class="op" id="4405994">&lt;</span>&nbsp;<span class="builtinfunc" id="4405996">len</span><span class="op" id="4405999">(</span><span class="ident" id="4406000"><a href="/gostd/crypto/cipher/cbc.go.html#4405884">src</a></span><span class="op" id="4406003">)</span>&nbsp;<span class="op" id="4406005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4406009">panic</span><span class="op" id="4406014">(</span><span class="string" id="4406015">&#34;crypto/cipher:&nbsp;output&nbsp;smaller&nbsp;than&nbsp;input&#34;</span><span class="op" id="4406057">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4406060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406064">iv</span>&nbsp;<span class="op" id="4406067">:=</span>&nbsp;<span class="ident" id="4406070"><a href="/gostd/crypto/cipher/cbc.go.html#4405850">x</a></span><span class="op" id="4406071">.</span><span class="ident" id="4406072"><a href="/gostd/crypto/cipher/cbc.go.html#4405182">iv</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4406077">for</span>&nbsp;<span class="builtinfunc" id="4406081">len</span><span class="op" id="4406084">(</span><span class="ident" id="4406085"><a href="/gostd/crypto/cipher/cbc.go.html#4405884">src</a></span><span class="op" id="4406088">)</span>&nbsp;<span class="op" id="4406090">&gt;</span>&nbsp;<span class="num" id="4406092">0</span>&nbsp;<span class="op" id="4406094">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4406098">//&nbsp;Write&nbsp;the&nbsp;xor&nbsp;to&nbsp;dst,&nbsp;then&nbsp;encrypt&nbsp;in&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406148"><a href="/gostd/crypto/cipher/xor.go.html#4427201">xorBytes</a></span><span class="op" id="4406156">(</span><span class="ident" id="4406157"><a href="/gostd/crypto/cipher/cbc.go.html#4405879">dst</a></span><span class="op" id="4406160">[</span><span class="op" id="4406161">:</span><span class="ident" id="4406162"><a href="/gostd/crypto/cipher/cbc.go.html#4405850">x</a></span><span class="op" id="4406163">.</span><span class="ident" id="4406164"><a href="/gostd/crypto/cipher/cbc.go.html#4405167">blockSize</a></span><span class="op" id="4406173">]</span><span class="op" id="4406174">,</span>&nbsp;<span class="ident" id="4406176"><a href="/gostd/crypto/cipher/cbc.go.html#4405884">src</a></span><span class="op" id="4406179">[</span><span class="op" id="4406180">:</span><span class="ident" id="4406181"><a href="/gostd/crypto/cipher/cbc.go.html#4405850">x</a></span><span class="op" id="4406182">.</span><span class="ident" id="4406183"><a href="/gostd/crypto/cipher/cbc.go.html#4405167">blockSize</a></span><span class="op" id="4406192">]</span><span class="op" id="4406193">,</span>&nbsp;<span class="ident" id="4406195"><a href="/gostd/crypto/cipher/cbc.go.html#4406064">iv</a></span><span class="op" id="4406197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406201"><a href="/gostd/crypto/cipher/cbc.go.html#4405850">x</a></span><span class="op" id="4406202">.</span><span class="ident" id="4406203"><a href="/gostd/crypto/cipher/cbc.go.html#4405150">b</a></span><span class="op" id="4406204">.</span><span class="ident" id="4406205"><a href="/gostd/crypto/cipher/cipher.go.html#4410882">Encrypt</a></span><span class="op" id="4406212">(</span><span class="ident" id="4406213"><a href="/gostd/crypto/cipher/cbc.go.html#4405879">dst</a></span><span class="op" id="4406216">[</span><span class="op" id="4406217">:</span><span class="ident" id="4406218"><a href="/gostd/crypto/cipher/cbc.go.html#4405850">x</a></span><span class="op" id="4406219">.</span><span class="ident" id="4406220"><a href="/gostd/crypto/cipher/cbc.go.html#4405167">blockSize</a></span><span class="op" id="4406229">]</span><span class="op" id="4406230">,</span>&nbsp;<span class="ident" id="4406232"><a href="/gostd/crypto/cipher/cbc.go.html#4405879">dst</a></span><span class="op" id="4406235">[</span><span class="op" id="4406236">:</span><span class="ident" id="4406237"><a href="/gostd/crypto/cipher/cbc.go.html#4405850">x</a></span><span class="op" id="4406238">.</span><span class="ident" id="4406239"><a href="/gostd/crypto/cipher/cbc.go.html#4405167">blockSize</a></span><span class="op" id="4406248">]</span><span class="op" id="4406249">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4406254">//&nbsp;Move&nbsp;to&nbsp;the&nbsp;next&nbsp;block&nbsp;with&nbsp;this&nbsp;block&nbsp;as&nbsp;the&nbsp;next&nbsp;iv.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406314"><a href="/gostd/crypto/cipher/cbc.go.html#4406064">iv</a></span>&nbsp;<span class="op" id="4406317">=</span>&nbsp;<span class="ident" id="4406319"><a href="/gostd/crypto/cipher/cbc.go.html#4405879">dst</a></span><span class="op" id="4406322">[</span><span class="op" id="4406323">:</span><span class="ident" id="4406324"><a href="/gostd/crypto/cipher/cbc.go.html#4405850">x</a></span><span class="op" id="4406325">.</span><span class="ident" id="4406326"><a href="/gostd/crypto/cipher/cbc.go.html#4405167">blockSize</a></span><span class="op" id="4406335">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406339"><a href="/gostd/crypto/cipher/cbc.go.html#4405884">src</a></span>&nbsp;<span class="op" id="4406343">=</span>&nbsp;<span class="ident" id="4406345"><a href="/gostd/crypto/cipher/cbc.go.html#4405884">src</a></span><span class="op" id="4406348">[</span><span class="ident" id="4406349"><a href="/gostd/crypto/cipher/cbc.go.html#4405850">x</a></span><span class="op" id="4406350">.</span><span class="ident" id="4406351"><a href="/gostd/crypto/cipher/cbc.go.html#4405167">blockSize</a></span><span class="op" id="4406360">:</span><span class="op" id="4406361">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4406365"><a href="/gostd/crypto/cipher/cbc.go.html#4405879">dst</a></span>&nbsp;<span class="op" id="4406369">=</span>&nbsp;<span class="ident" id="4406371"><a href="/gostd/crypto/cipher/cbc.go.html#4405879">dst</a></span><span class="op" id="4406374">[</span><span class="ident" id="4406375"><a href="/gostd/crypto/cipher/cbc.go.html#4405850">x</a></span><span class="op" id="4406376">.</span><span class="ident" id="4406377"><a href="/gostd/crypto/cipher/cbc.go.html#4405167">blockSize</a></span><span class="op" id="4406386">:</span><span class="op" id="4406387">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4406390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4406394">//&nbsp;Save&nbsp;the&nbsp;iv&nbsp;for&nbsp;the&nbsp;next&nbsp;CryptBlocks&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4406441">copy</span><span class="op" id="4406445">(</span><span class="ident" id="4406446"><a href="/gostd/crypto/cipher/cbc.go.html#4405850">x</a></span><span class="op" id="4406447">.</span><span class="ident" id="4406448"><a href="/gostd/crypto/cipher/cbc.go.html#4405182">iv</a></span><span class="op" id="4406450">,</span>&nbsp;<span class="ident" id="4406452"><a href="/gostd/crypto/cipher/cbc.go.html#4406064">iv</a></span><span class="op" id="4406454">)</span><br>
<span class="lineno"></span><span class="op" id="4406456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4406459">func</span>&nbsp;<span class="op" id="4406464">(</span><span class="ident" id="4406465">x</span>&nbsp;<span class="op" id="4406467">*</span><span class="ident" id="4406468"><a href="/gostd/crypto/cipher/cbc.go.html#4405392">cbcEncrypter</a></span><span class="op" id="4406480">)</span>&nbsp;<span class="ident" id="4406482">SetIV</span><span class="op" id="4406487">(</span><span class="ident" id="4406488">iv</span>&nbsp;<span class="op" id="4406491">[</span><span class="op" id="4406492">]</span><span class="builtintype" id="4406493">byte</span><span class="op" id="4406497">)</span>&nbsp;<span class="op" id="4406499">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4406502">if</span>&nbsp;<span class="builtinfunc" id="4406505">len</span><span class="op" id="4406508">(</span><span class="ident" id="4406509"><a href="/gostd/crypto/cipher/cbc.go.html#4406488">iv</a></span><span class="op" id="4406511">)</span>&nbsp;<span class="op" id="4406513">!=</span>&nbsp;<span class="builtinfunc" id="4406516">len</span><span class="op" id="4406519">(</span><span class="ident" id="4406520"><a href="/gostd/crypto/cipher/cbc.go.html#4406465">x</a></span><span class="op" id="4406521">.</span><span class="ident" id="4406522"><a href="/gostd/crypto/cipher/cbc.go.html#4405182">iv</a></span><span class="op" id="4406524">)</span>&nbsp;<span class="op" id="4406526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4406530">panic</span><span class="op" id="4406535">(</span><span class="string" id="4406536">&#34;cipher:&nbsp;incorrect&nbsp;length&nbsp;IV&#34;</span><span class="op" id="4406565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4406568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4406571">copy</span><span class="op" id="4406575">(</span><span class="ident" id="4406576"><a href="/gostd/crypto/cipher/cbc.go.html#4406465">x</a></span><span class="op" id="4406577">.</span><span class="ident" id="4406578"><a href="/gostd/crypto/cipher/cbc.go.html#4405182">iv</a></span><span class="op" id="4406580">,</span>&nbsp;<span class="ident" id="4406582"><a href="/gostd/crypto/cipher/cbc.go.html#4406488">iv</a></span><span class="op" id="4406584">)</span><br>
<span class="lineno"></span><span class="op" id="4406586">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="4406589">type</span>&nbsp;<span class="ident" id="4406594">cbcDecrypter</span>&nbsp;<span class="ident" id="4406607"><a href="/gostd/crypto/cipher/cbc.go.html#4405136">cbc</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4406612">//&nbsp;NewCBCDecrypter&nbsp;returns&nbsp;a&nbsp;BlockMode&nbsp;which&nbsp;decrypts&nbsp;in&nbsp;cipher&nbsp;block&nbsp;chaining</span><br>
<span class="lineno"></span><span class="comment" id="4406691">//&nbsp;mode,&nbsp;using&nbsp;the&nbsp;given&nbsp;Block.&nbsp;The&nbsp;length&nbsp;of&nbsp;iv&nbsp;must&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;the</span><br>
<span class="lineno">80</span><span class="comment" id="4406764">//&nbsp;Block&#39;s&nbsp;block&nbsp;size&nbsp;and&nbsp;must&nbsp;match&nbsp;the&nbsp;iv&nbsp;used&nbsp;to&nbsp;encrypt&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4406834">func</span>&nbsp;<span class="ident" id="4406839">NewCBCDecrypter</span><span class="op" id="4406854">(</span><span class="ident" id="4406855">b</span>&nbsp;<span class="ident" id="4406857"><a href="/gostd/crypto/cipher/cipher.go.html#4410698">Block</a></span><span class="op" id="4406862">,</span>&nbsp;<span class="ident" id="4406864">iv</span>&nbsp;<span class="op" id="4406867">[</span><span class="op" id="4406868">]</span><span class="builtintype" id="4406869">byte</span><span class="op" id="4406873">)</span>&nbsp;<span class="ident" id="4406875"><a href="/gostd/crypto/cipher/cipher.go.html#4411369">BlockMode</a></span>&nbsp;<span class="op" id="4406885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4406888">if</span>&nbsp;<span class="builtinfunc" id="4406891">len</span><span class="op" id="4406894">(</span><span class="ident" id="4406895"><a href="/gostd/crypto/cipher/cbc.go.html#4406864">iv</a></span><span class="op" id="4406897">)</span>&nbsp;<span class="op" id="4406899">!=</span>&nbsp;<span class="ident" id="4406902"><a href="/gostd/crypto/cipher/cbc.go.html#4406855">b</a></span><span class="op" id="4406903">.</span><span class="ident" id="4406904"><a href="/gostd/crypto/cipher/cipher.go.html#4410764">BlockSize</a></span><span class="op" id="4406913">(</span><span class="op" id="4406914">)</span>&nbsp;<span class="op" id="4406916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4406920">panic</span><span class="op" id="4406925">(</span><span class="string" id="4406926">&#34;cipher.NewCBCDecrypter:&nbsp;IV&nbsp;length&nbsp;must&nbsp;equal&nbsp;block&nbsp;size&#34;</span><span class="op" id="4406983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4406986">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4406989">return</span>&nbsp;<span class="op" id="4406996">(</span><span class="op" id="4406997">*</span><span class="ident" id="4406998"><a href="/gostd/crypto/cipher/cbc.go.html#4406594">cbcDecrypter</a></span><span class="op" id="4407010">)</span><span class="op" id="4407011">(</span><span class="ident" id="4407012"><a href="/gostd/crypto/cipher/cbc.go.html#4405225">newCBC</a></span><span class="op" id="4407018">(</span><span class="ident" id="4407019"><a href="/gostd/crypto/cipher/cbc.go.html#4406855">b</a></span><span class="op" id="4407020">,</span>&nbsp;<span class="ident" id="4407022"><a href="/gostd/crypto/cipher/cbc.go.html#4406864">iv</a></span><span class="op" id="4407024">)</span><span class="op" id="4407025">)</span><br>
<span class="lineno"></span><span class="op" id="4407027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4407030">func</span>&nbsp;<span class="op" id="4407035">(</span><span class="ident" id="4407036">x</span>&nbsp;<span class="op" id="4407038">*</span><span class="ident" id="4407039"><a href="/gostd/crypto/cipher/cbc.go.html#4406594">cbcDecrypter</a></span><span class="op" id="4407051">)</span>&nbsp;<span class="ident" id="4407053">BlockSize</span><span class="op" id="4407062">(</span><span class="op" id="4407063">)</span>&nbsp;<span class="builtintype" id="4407065">int</span>&nbsp;<span class="op" id="4407069">{</span>&nbsp;<span class="keyword" id="4407071">return</span>&nbsp;<span class="ident" id="4407078"><a href="/gostd/crypto/cipher/cbc.go.html#4407036">x</a></span><span class="op" id="4407079">.</span><span class="ident" id="4407080"><a href="/gostd/crypto/cipher/cbc.go.html#4405167">blockSize</a></span>&nbsp;<span class="op" id="4407090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="4407093">func</span>&nbsp;<span class="op" id="4407098">(</span><span class="ident" id="4407099">x</span>&nbsp;<span class="op" id="4407101">*</span><span class="ident" id="4407102"><a href="/gostd/crypto/cipher/cbc.go.html#4406594">cbcDecrypter</a></span><span class="op" id="4407114">)</span>&nbsp;<span class="ident" id="4407116">CryptBlocks</span><span class="op" id="4407127">(</span><span class="ident" id="4407128">dst</span><span class="op" id="4407131">,</span>&nbsp;<span class="ident" id="4407133">src</span>&nbsp;<span class="op" id="4407137">[</span><span class="op" id="4407138">]</span><span class="builtintype" id="4407139">byte</span><span class="op" id="4407143">)</span>&nbsp;<span class="op" id="4407145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407148">if</span>&nbsp;<span class="builtinfunc" id="4407151">len</span><span class="op" id="4407154">(</span><span class="ident" id="4407155"><a href="/gostd/crypto/cipher/cbc.go.html#4407133">src</a></span><span class="op" id="4407158">)</span><span class="op" id="4407159">%</span><span class="ident" id="4407160"><a href="/gostd/crypto/cipher/cbc.go.html#4407099">x</a></span><span class="op" id="4407161">.</span><span class="ident" id="4407162"><a href="/gostd/crypto/cipher/cbc.go.html#4405167">blockSize</a></span>&nbsp;<span class="op" id="4407172">!=</span>&nbsp;<span class="num" id="4407175">0</span>&nbsp;<span class="op" id="4407177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4407181">panic</span><span class="op" id="4407186">(</span><span class="string" id="4407187">&#34;crypto/cipher:&nbsp;input&nbsp;not&nbsp;full&nbsp;blocks&#34;</span><span class="op" id="4407225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4407228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407231">if</span>&nbsp;<span class="builtinfunc" id="4407234">len</span><span class="op" id="4407237">(</span><span class="ident" id="4407238"><a href="/gostd/crypto/cipher/cbc.go.html#4407128">dst</a></span><span class="op" id="4407241">)</span>&nbsp;<span class="op" id="4407243">&lt;</span>&nbsp;<span class="builtinfunc" id="4407245">len</span><span class="op" id="4407248">(</span><span class="ident" id="4407249"><a href="/gostd/crypto/cipher/cbc.go.html#4407133">src</a></span><span class="op" id="4407252">)</span>&nbsp;<span class="op" id="4407254">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4407258">panic</span><span class="op" id="4407263">(</span><span class="string" id="4407264">&#34;crypto/cipher:&nbsp;output&nbsp;smaller&nbsp;than&nbsp;input&#34;</span><span class="op" id="4407306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4407309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407312">if</span>&nbsp;<span class="builtinfunc" id="4407315">len</span><span class="op" id="4407318">(</span><span class="ident" id="4407319"><a href="/gostd/crypto/cipher/cbc.go.html#4407133">src</a></span><span class="op" id="4407322">)</span>&nbsp;<span class="op" id="4407324">==</span>&nbsp;<span class="num" id="4407327">0</span>&nbsp;<span class="op" id="4407329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407333">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4407341">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4407345">//&nbsp;For&nbsp;each&nbsp;block,&nbsp;we&nbsp;need&nbsp;to&nbsp;xor&nbsp;the&nbsp;decrypted&nbsp;data&nbsp;with&nbsp;the&nbsp;previous&nbsp;block&#39;s&nbsp;ciphertext&nbsp;(the&nbsp;iv).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4407446">//&nbsp;To&nbsp;avoid&nbsp;making&nbsp;a&nbsp;copy&nbsp;each&nbsp;time,&nbsp;we&nbsp;loop&nbsp;over&nbsp;the&nbsp;blocks&nbsp;BACKWARDS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407519">end</span>&nbsp;<span class="op" id="4407523">:=</span>&nbsp;<span class="builtinfunc" id="4407526">len</span><span class="op" id="4407529">(</span><span class="ident" id="4407530"><a href="/gostd/crypto/cipher/cbc.go.html#4407133">src</a></span><span class="op" id="4407533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407536">start</span>&nbsp;<span class="op" id="4407542">:=</span>&nbsp;<span class="ident" id="4407545"><a href="/gostd/crypto/cipher/cbc.go.html#4407519">end</a></span>&nbsp;<span class="op" id="4407549">-</span>&nbsp;<span class="ident" id="4407551"><a href="/gostd/crypto/cipher/cbc.go.html#4407099">x</a></span><span class="op" id="4407552">.</span><span class="ident" id="4407553"><a href="/gostd/crypto/cipher/cbc.go.html#4405167">blockSize</a></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407564">prev</span>&nbsp;<span class="op" id="4407569">:=</span>&nbsp;<span class="ident" id="4407572"><a href="/gostd/crypto/cipher/cbc.go.html#4407536">start</a></span>&nbsp;<span class="op" id="4407578">-</span>&nbsp;<span class="ident" id="4407580"><a href="/gostd/crypto/cipher/cbc.go.html#4407099">x</a></span><span class="op" id="4407581">.</span><span class="ident" id="4407582"><a href="/gostd/crypto/cipher/cbc.go.html#4405167">blockSize</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4407594">//&nbsp;Copy&nbsp;the&nbsp;last&nbsp;block&nbsp;of&nbsp;ciphertext&nbsp;in&nbsp;preparation&nbsp;as&nbsp;the&nbsp;new&nbsp;iv.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4407662">copy</span><span class="op" id="4407666">(</span><span class="ident" id="4407667"><a href="/gostd/crypto/cipher/cbc.go.html#4407099">x</a></span><span class="op" id="4407668">.</span><span class="ident" id="4407669"><a href="/gostd/crypto/cipher/cbc.go.html#4405200">tmp</a></span><span class="op" id="4407672">,</span>&nbsp;<span class="ident" id="4407674"><a href="/gostd/crypto/cipher/cbc.go.html#4407133">src</a></span><span class="op" id="4407677">[</span><span class="ident" id="4407678"><a href="/gostd/crypto/cipher/cbc.go.html#4407536">start</a></span><span class="op" id="4407683">:</span><span class="ident" id="4407684"><a href="/gostd/crypto/cipher/cbc.go.html#4407519">end</a></span><span class="op" id="4407687">]</span><span class="op" id="4407688">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4407692">//&nbsp;Loop&nbsp;over&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4407731">for</span>&nbsp;<span class="ident" id="4407735"><a href="/gostd/crypto/cipher/cbc.go.html#4407536">start</a></span>&nbsp;<span class="op" id="4407741">&gt;</span>&nbsp;<span class="num" id="4407743">0</span>&nbsp;<span class="op" id="4407745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407749"><a href="/gostd/crypto/cipher/cbc.go.html#4407099">x</a></span><span class="op" id="4407750">.</span><span class="ident" id="4407751"><a href="/gostd/crypto/cipher/cbc.go.html#4405150">b</a></span><span class="op" id="4407752">.</span><span class="ident" id="4407753"><a href="/gostd/crypto/cipher/cipher.go.html#4411009">Decrypt</a></span><span class="op" id="4407760">(</span><span class="ident" id="4407761"><a href="/gostd/crypto/cipher/cbc.go.html#4407128">dst</a></span><span class="op" id="4407764">[</span><span class="ident" id="4407765"><a href="/gostd/crypto/cipher/cbc.go.html#4407536">start</a></span><span class="op" id="4407770">:</span><span class="ident" id="4407771"><a href="/gostd/crypto/cipher/cbc.go.html#4407519">end</a></span><span class="op" id="4407774">]</span><span class="op" id="4407775">,</span>&nbsp;<span class="ident" id="4407777"><a href="/gostd/crypto/cipher/cbc.go.html#4407133">src</a></span><span class="op" id="4407780">[</span><span class="ident" id="4407781"><a href="/gostd/crypto/cipher/cbc.go.html#4407536">start</a></span><span class="op" id="4407786">:</span><span class="ident" id="4407787"><a href="/gostd/crypto/cipher/cbc.go.html#4407519">end</a></span><span class="op" id="4407790">]</span><span class="op" id="4407791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407795"><a href="/gostd/crypto/cipher/xor.go.html#4427201">xorBytes</a></span><span class="op" id="4407803">(</span><span class="ident" id="4407804"><a href="/gostd/crypto/cipher/cbc.go.html#4407128">dst</a></span><span class="op" id="4407807">[</span><span class="ident" id="4407808"><a href="/gostd/crypto/cipher/cbc.go.html#4407536">start</a></span><span class="op" id="4407813">:</span><span class="ident" id="4407814"><a href="/gostd/crypto/cipher/cbc.go.html#4407519">end</a></span><span class="op" id="4407817">]</span><span class="op" id="4407818">,</span>&nbsp;<span class="ident" id="4407820"><a href="/gostd/crypto/cipher/cbc.go.html#4407128">dst</a></span><span class="op" id="4407823">[</span><span class="ident" id="4407824"><a href="/gostd/crypto/cipher/cbc.go.html#4407536">start</a></span><span class="op" id="4407829">:</span><span class="ident" id="4407830"><a href="/gostd/crypto/cipher/cbc.go.html#4407519">end</a></span><span class="op" id="4407833">]</span><span class="op" id="4407834">,</span>&nbsp;<span class="ident" id="4407836"><a href="/gostd/crypto/cipher/cbc.go.html#4407133">src</a></span><span class="op" id="4407839">[</span><span class="ident" id="4407840"><a href="/gostd/crypto/cipher/cbc.go.html#4407564">prev</a></span><span class="op" id="4407844">:</span><span class="ident" id="4407845"><a href="/gostd/crypto/cipher/cbc.go.html#4407536">start</a></span><span class="op" id="4407850">]</span><span class="op" id="4407851">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407856"><a href="/gostd/crypto/cipher/cbc.go.html#4407519">end</a></span>&nbsp;<span class="op" id="4407860">=</span>&nbsp;<span class="ident" id="4407862"><a href="/gostd/crypto/cipher/cbc.go.html#4407536">start</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407870"><a href="/gostd/crypto/cipher/cbc.go.html#4407536">start</a></span>&nbsp;<span class="op" id="4407876">=</span>&nbsp;<span class="ident" id="4407878"><a href="/gostd/crypto/cipher/cbc.go.html#4407564">prev</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407885"><a href="/gostd/crypto/cipher/cbc.go.html#4407564">prev</a></span>&nbsp;<span class="op" id="4407890">-=</span>&nbsp;<span class="ident" id="4407893"><a href="/gostd/crypto/cipher/cbc.go.html#4407099">x</a></span><span class="op" id="4407894">.</span><span class="ident" id="4407895"><a href="/gostd/crypto/cipher/cbc.go.html#4405167">blockSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4407906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4407910">//&nbsp;The&nbsp;first&nbsp;block&nbsp;is&nbsp;special&nbsp;because&nbsp;it&nbsp;uses&nbsp;the&nbsp;saved&nbsp;iv.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407971"><a href="/gostd/crypto/cipher/cbc.go.html#4407099">x</a></span><span class="op" id="4407972">.</span><span class="ident" id="4407973"><a href="/gostd/crypto/cipher/cbc.go.html#4405150">b</a></span><span class="op" id="4407974">.</span><span class="ident" id="4407975"><a href="/gostd/crypto/cipher/cipher.go.html#4411009">Decrypt</a></span><span class="op" id="4407982">(</span><span class="ident" id="4407983"><a href="/gostd/crypto/cipher/cbc.go.html#4407128">dst</a></span><span class="op" id="4407986">[</span><span class="ident" id="4407987"><a href="/gostd/crypto/cipher/cbc.go.html#4407536">start</a></span><span class="op" id="4407992">:</span><span class="ident" id="4407993"><a href="/gostd/crypto/cipher/cbc.go.html#4407519">end</a></span><span class="op" id="4407996">]</span><span class="op" id="4407997">,</span>&nbsp;<span class="ident" id="4407999"><a href="/gostd/crypto/cipher/cbc.go.html#4407133">src</a></span><span class="op" id="4408002">[</span><span class="ident" id="4408003"><a href="/gostd/crypto/cipher/cbc.go.html#4407536">start</a></span><span class="op" id="4408008">:</span><span class="ident" id="4408009"><a href="/gostd/crypto/cipher/cbc.go.html#4407519">end</a></span><span class="op" id="4408012">]</span><span class="op" id="4408013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408016"><a href="/gostd/crypto/cipher/xor.go.html#4427201">xorBytes</a></span><span class="op" id="4408024">(</span><span class="ident" id="4408025"><a href="/gostd/crypto/cipher/cbc.go.html#4407128">dst</a></span><span class="op" id="4408028">[</span><span class="ident" id="4408029"><a href="/gostd/crypto/cipher/cbc.go.html#4407536">start</a></span><span class="op" id="4408034">:</span><span class="ident" id="4408035"><a href="/gostd/crypto/cipher/cbc.go.html#4407519">end</a></span><span class="op" id="4408038">]</span><span class="op" id="4408039">,</span>&nbsp;<span class="ident" id="4408041"><a href="/gostd/crypto/cipher/cbc.go.html#4407128">dst</a></span><span class="op" id="4408044">[</span><span class="ident" id="4408045"><a href="/gostd/crypto/cipher/cbc.go.html#4407536">start</a></span><span class="op" id="4408050">:</span><span class="ident" id="4408051"><a href="/gostd/crypto/cipher/cbc.go.html#4407519">end</a></span><span class="op" id="4408054">]</span><span class="op" id="4408055">,</span>&nbsp;<span class="ident" id="4408057"><a href="/gostd/crypto/cipher/cbc.go.html#4407099">x</a></span><span class="op" id="4408058">.</span><span class="ident" id="4408059"><a href="/gostd/crypto/cipher/cbc.go.html#4405182">iv</a></span><span class="op" id="4408061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4408065">//&nbsp;Set&nbsp;the&nbsp;new&nbsp;iv&nbsp;to&nbsp;the&nbsp;first&nbsp;block&nbsp;we&nbsp;copied&nbsp;earlier.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4408122"><a href="/gostd/crypto/cipher/cbc.go.html#4407099">x</a></span><span class="op" id="4408123">.</span><span class="ident" id="4408124"><a href="/gostd/crypto/cipher/cbc.go.html#4405182">iv</a></span><span class="op" id="4408126">,</span>&nbsp;<span class="ident" id="4408128"><a href="/gostd/crypto/cipher/cbc.go.html#4407099">x</a></span><span class="op" id="4408129">.</span><span class="ident" id="4408130"><a href="/gostd/crypto/cipher/cbc.go.html#4405200">tmp</a></span>&nbsp;<span class="op" id="4408134">=</span>&nbsp;<span class="ident" id="4408136"><a href="/gostd/crypto/cipher/cbc.go.html#4407099">x</a></span><span class="op" id="4408137">.</span><span class="ident" id="4408138"><a href="/gostd/crypto/cipher/cbc.go.html#4405200">tmp</a></span><span class="op" id="4408141">,</span>&nbsp;<span class="ident" id="4408143"><a href="/gostd/crypto/cipher/cbc.go.html#4407099">x</a></span><span class="op" id="4408144">.</span><span class="ident" id="4408145"><a href="/gostd/crypto/cipher/cbc.go.html#4405182">iv</a></span><br>
<span class="lineno"></span><span class="op" id="4408148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4408151">func</span>&nbsp;<span class="op" id="4408156">(</span><span class="ident" id="4408157">x</span>&nbsp;<span class="op" id="4408159">*</span><span class="ident" id="4408160"><a href="/gostd/crypto/cipher/cbc.go.html#4406594">cbcDecrypter</a></span><span class="op" id="4408172">)</span>&nbsp;<span class="ident" id="4408174">SetIV</span><span class="op" id="4408179">(</span><span class="ident" id="4408180">iv</span>&nbsp;<span class="op" id="4408183">[</span><span class="op" id="4408184">]</span><span class="builtintype" id="4408185">byte</span><span class="op" id="4408189">)</span>&nbsp;<span class="op" id="4408191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4408194">if</span>&nbsp;<span class="builtinfunc" id="4408197">len</span><span class="op" id="4408200">(</span><span class="ident" id="4408201"><a href="/gostd/crypto/cipher/cbc.go.html#4408180">iv</a></span><span class="op" id="4408203">)</span>&nbsp;<span class="op" id="4408205">!=</span>&nbsp;<span class="builtinfunc" id="4408208">len</span><span class="op" id="4408211">(</span><span class="ident" id="4408212"><a href="/gostd/crypto/cipher/cbc.go.html#4408157">x</a></span><span class="op" id="4408213">.</span><span class="ident" id="4408214"><a href="/gostd/crypto/cipher/cbc.go.html#4405182">iv</a></span><span class="op" id="4408216">)</span>&nbsp;<span class="op" id="4408218">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4408222">panic</span><span class="op" id="4408227">(</span><span class="string" id="4408228">&#34;cipher:&nbsp;incorrect&nbsp;length&nbsp;IV&#34;</span><span class="op" id="4408257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4408260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4408263">copy</span><span class="op" id="4408267">(</span><span class="ident" id="4408268"><a href="/gostd/crypto/cipher/cbc.go.html#4408157">x</a></span><span class="op" id="4408269">.</span><span class="ident" id="4408270"><a href="/gostd/crypto/cipher/cbc.go.html#4405182">iv</a></span><span class="op" id="4408272">,</span>&nbsp;<span class="ident" id="4408274"><a href="/gostd/crypto/cipher/cbc.go.html#4408180">iv</a></span><span class="op" id="4408276">)</span><br>
<span class="lineno"></span><span class="op" id="4408278">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
