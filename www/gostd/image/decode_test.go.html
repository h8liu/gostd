<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="285797">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="285852">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="285906">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="285957">package</span>&nbsp;<span class="ident" id="285965">image_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="285977">import</span>&nbsp;<span class="op" id="285984">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="285987">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="285996">&#34;image&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="286005">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="286020">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="286026">&#34;testing&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="286038">_</span>&nbsp;<span class="string" id="286040">&#34;image/gif&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="286053">_</span>&nbsp;<span class="string" id="286055">&#34;image/jpeg&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="286069">_</span>&nbsp;<span class="string" id="286071">&#34;image/png&#34;</span><br>
<span class="lineno"></span><span class="op" id="286083">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="286086">type</span>&nbsp;<span class="ident" id="286091">imageTest</span>&nbsp;<span class="keyword" id="286101">struct</span>&nbsp;<span class="op" id="286108">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="286111">goldenFilename</span>&nbsp;<span class="builtintype" id="286126">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="286134">filename</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="286149">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="286157">tolerance</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="286172">int</span><br>
<span class="lineno"></span><span class="op" id="286176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="286179">var</span>&nbsp;<span class="ident" id="286183">imageTests</span>&nbsp;<span class="op" id="286194">=</span>&nbsp;<span class="op" id="286196">[</span><span class="op" id="286197">]</span><span class="ident" id="286198">imageTest</span><span class="op" id="286207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="286210">{</span><span class="string" id="286211">&#34;testdata/video-001.png&#34;</span><span class="op" id="286235">,</span>&nbsp;<span class="string" id="286237">&#34;testdata/video-001.png&#34;</span><span class="op" id="286261">,</span>&nbsp;<span class="num" id="286263">0</span><span class="op" id="286264">}</span><span class="op" id="286265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="286268">//&nbsp;GIF&nbsp;images&nbsp;are&nbsp;restricted&nbsp;to&nbsp;a&nbsp;256-color&nbsp;palette&nbsp;and&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="286340">//&nbsp;to&nbsp;GIF&nbsp;loses&nbsp;significant&nbsp;image&nbsp;quality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="286384">{</span><span class="string" id="286385">&#34;testdata/video-001.png&#34;</span><span class="op" id="286409">,</span>&nbsp;<span class="string" id="286411">&#34;testdata/video-001.gif&#34;</span><span class="op" id="286435">,</span>&nbsp;<span class="num" id="286437">64</span>&nbsp;<span class="op" id="286440">&lt;&lt;</span>&nbsp;<span class="num" id="286443">8</span><span class="op" id="286444">}</span><span class="op" id="286445">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="286448">{</span><span class="string" id="286449">&#34;testdata/video-001.png&#34;</span><span class="op" id="286473">,</span>&nbsp;<span class="string" id="286475">&#34;testdata/video-001.interlaced.gif&#34;</span><span class="op" id="286510">,</span>&nbsp;<span class="num" id="286512">64</span>&nbsp;<span class="op" id="286515">&lt;&lt;</span>&nbsp;<span class="num" id="286518">8</span><span class="op" id="286519">}</span><span class="op" id="286520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="286523">{</span><span class="string" id="286524">&#34;testdata/video-001.png&#34;</span><span class="op" id="286548">,</span>&nbsp;<span class="string" id="286550">&#34;testdata/video-001.5bpp.gif&#34;</span><span class="op" id="286579">,</span>&nbsp;<span class="num" id="286581">128</span>&nbsp;<span class="op" id="286585">&lt;&lt;</span>&nbsp;<span class="num" id="286588">8</span><span class="op" id="286589">}</span><span class="op" id="286590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="286593">//&nbsp;JPEG&nbsp;is&nbsp;a&nbsp;lossy&nbsp;format&nbsp;and&nbsp;hence&nbsp;needs&nbsp;a&nbsp;non-zero&nbsp;tolerance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="286658">{</span><span class="string" id="286659">&#34;testdata/video-001.png&#34;</span><span class="op" id="286683">,</span>&nbsp;<span class="string" id="286685">&#34;testdata/video-001.jpeg&#34;</span><span class="op" id="286710">,</span>&nbsp;<span class="num" id="286712">8</span>&nbsp;<span class="op" id="286714">&lt;&lt;</span>&nbsp;<span class="num" id="286717">8</span><span class="op" id="286718">}</span><span class="op" id="286719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="286722">{</span><span class="string" id="286723">&#34;testdata/video-001.png&#34;</span><span class="op" id="286747">,</span>&nbsp;<span class="string" id="286749">&#34;testdata/video-001.progressive.jpeg&#34;</span><span class="op" id="286786">,</span>&nbsp;<span class="num" id="286788">8</span>&nbsp;<span class="op" id="286790">&lt;&lt;</span>&nbsp;<span class="num" id="286793">8</span><span class="op" id="286794">}</span><span class="op" id="286795">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="286798">//&nbsp;Grayscale&nbsp;images.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="286820">{</span><span class="string" id="286821">&#34;testdata/video-005.gray.png&#34;</span><span class="op" id="286850">,</span>&nbsp;<span class="string" id="286852">&#34;testdata/video-005.gray.jpeg&#34;</span><span class="op" id="286882">,</span>&nbsp;<span class="num" id="286884">8</span>&nbsp;<span class="op" id="286886">&lt;&lt;</span>&nbsp;<span class="num" id="286889">8</span><span class="op" id="286890">}</span><span class="op" id="286891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="286894">{</span><span class="string" id="286895">&#34;testdata/video-005.gray.png&#34;</span><span class="op" id="286924">,</span>&nbsp;<span class="string" id="286926">&#34;testdata/video-005.gray.png&#34;</span><span class="op" id="286955">,</span>&nbsp;<span class="num" id="286957">0</span><span class="op" id="286958">}</span><span class="op" id="286959">,</span><br>
<span class="lineno"></span><span class="op" id="286961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="286964">func</span>&nbsp;<span class="ident" id="286969">decode</span><span class="op" id="286975">(</span><span class="ident" id="286976">filename</span>&nbsp;<span class="builtintype" id="286985">string</span><span class="op" id="286991">)</span>&nbsp;<span class="op" id="286993">(</span><span class="ident" id="286994">image</span><span class="op" id="286999">.</span><span class="ident" id="287000">Image</span><span class="op" id="287005">,</span>&nbsp;<span class="builtintype" id="287007">string</span><span class="op" id="287013">,</span>&nbsp;<span class="builtintype" id="287015">error</span><span class="op" id="287020">)</span>&nbsp;<span class="op" id="287022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="287025">f</span><span class="op" id="287026">,</span>&nbsp;<span class="ident" id="287028">err</span>&nbsp;<span class="op" id="287032">:=</span>&nbsp;<span class="ident" id="287035">os</span><span class="op" id="287037">.</span><span class="ident" id="287038">Open</span><span class="op" id="287042">(</span><span class="ident" id="287043">filename</span><span class="op" id="287051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="287054">if</span>&nbsp;<span class="ident" id="287057">err</span>&nbsp;<span class="op" id="287061">!=</span>&nbsp;<span class="ident" id="287064">nil</span>&nbsp;<span class="op" id="287068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="287072">return</span>&nbsp;<span class="ident" id="287079">nil</span><span class="op" id="287082">,</span>&nbsp;<span class="string" id="287084">&#34;&#34;</span><span class="op" id="287086">,</span>&nbsp;<span class="ident" id="287088">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="287093">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="287096">defer</span>&nbsp;<span class="ident" id="287102">f</span><span class="op" id="287103">.</span><span class="ident" id="287104">Close</span><span class="op" id="287109">(</span><span class="op" id="287110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="287113">return</span>&nbsp;<span class="ident" id="287120">image</span><span class="op" id="287125">.</span><span class="ident" id="287126">Decode</span><span class="op" id="287132">(</span><span class="ident" id="287133">bufio</span><span class="op" id="287138">.</span><span class="ident" id="287139">NewReader</span><span class="op" id="287148">(</span><span class="ident" id="287149">f</span><span class="op" id="287150">)</span><span class="op" id="287151">)</span><br>
<span class="lineno"></span><span class="op" id="287153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="287156">func</span>&nbsp;<span class="ident" id="287161">decodeConfig</span><span class="op" id="287173">(</span><span class="ident" id="287174">filename</span>&nbsp;<span class="builtintype" id="287183">string</span><span class="op" id="287189">)</span>&nbsp;<span class="op" id="287191">(</span><span class="ident" id="287192">image</span><span class="op" id="287197">.</span><span class="ident" id="287198">Config</span><span class="op" id="287204">,</span>&nbsp;<span class="builtintype" id="287206">string</span><span class="op" id="287212">,</span>&nbsp;<span class="builtintype" id="287214">error</span><span class="op" id="287219">)</span>&nbsp;<span class="op" id="287221">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="287224">f</span><span class="op" id="287225">,</span>&nbsp;<span class="ident" id="287227">err</span>&nbsp;<span class="op" id="287231">:=</span>&nbsp;<span class="ident" id="287234">os</span><span class="op" id="287236">.</span><span class="ident" id="287237">Open</span><span class="op" id="287241">(</span><span class="ident" id="287242">filename</span><span class="op" id="287250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="287253">if</span>&nbsp;<span class="ident" id="287256">err</span>&nbsp;<span class="op" id="287260">!=</span>&nbsp;<span class="ident" id="287263">nil</span>&nbsp;<span class="op" id="287267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="287271">return</span>&nbsp;<span class="ident" id="287278">image</span><span class="op" id="287283">.</span><span class="ident" id="287284">Config</span><span class="op" id="287290">{</span><span class="op" id="287291">}</span><span class="op" id="287292">,</span>&nbsp;<span class="string" id="287294">&#34;&#34;</span><span class="op" id="287296">,</span>&nbsp;<span class="ident" id="287298">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="287303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="287306">defer</span>&nbsp;<span class="ident" id="287312">f</span><span class="op" id="287313">.</span><span class="ident" id="287314">Close</span><span class="op" id="287319">(</span><span class="op" id="287320">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="287323">return</span>&nbsp;<span class="ident" id="287330">image</span><span class="op" id="287335">.</span><span class="ident" id="287336">DecodeConfig</span><span class="op" id="287348">(</span><span class="ident" id="287349">bufio</span><span class="op" id="287354">.</span><span class="ident" id="287355">NewReader</span><span class="op" id="287364">(</span><span class="ident" id="287365">f</span><span class="op" id="287366">)</span><span class="op" id="287367">)</span><br>
<span class="lineno"></span><span class="op" id="287369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="287372">func</span>&nbsp;<span class="ident" id="287377">delta</span><span class="op" id="287382">(</span><span class="ident" id="287383">u0</span><span class="op" id="287385">,</span>&nbsp;<span class="ident" id="287387">u1</span>&nbsp;<span class="builtintype" id="287390">uint32</span><span class="op" id="287396">)</span>&nbsp;<span class="builtintype" id="287398">int</span>&nbsp;<span class="op" id="287402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="287405">d</span>&nbsp;<span class="op" id="287407">:=</span>&nbsp;<span class="builtintype" id="287410">int</span><span class="op" id="287413">(</span><span class="ident" id="287414">u0</span><span class="op" id="287416">)</span>&nbsp;<span class="op" id="287418">-</span>&nbsp;<span class="builtintype" id="287420">int</span><span class="op" id="287423">(</span><span class="ident" id="287424">u1</span><span class="op" id="287426">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="287429">if</span>&nbsp;<span class="ident" id="287432">d</span>&nbsp;<span class="op" id="287434">&lt;</span>&nbsp;<span class="num" id="287436">0</span>&nbsp;<span class="op" id="287438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="287442">return</span>&nbsp;<span class="op" id="287449">-</span><span class="ident" id="287450">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="287453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="287456">return</span>&nbsp;<span class="ident" id="287463">d</span><br>
<span class="lineno"></span><span class="op" id="287465">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="287468">func</span>&nbsp;<span class="ident" id="287473">withinTolerance</span><span class="op" id="287488">(</span><span class="ident" id="287489">c0</span><span class="op" id="287491">,</span>&nbsp;<span class="ident" id="287493">c1</span>&nbsp;<span class="ident" id="287496">color</span><span class="op" id="287501">.</span><span class="ident" id="287502">Color</span><span class="op" id="287507">,</span>&nbsp;<span class="ident" id="287509">tolerance</span>&nbsp;<span class="builtintype" id="287519">int</span><span class="op" id="287522">)</span>&nbsp;<span class="builtintype" id="287524">bool</span>&nbsp;<span class="op" id="287529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="287532">r0</span><span class="op" id="287534">,</span>&nbsp;<span class="ident" id="287536">g0</span><span class="op" id="287538">,</span>&nbsp;<span class="ident" id="287540">b0</span><span class="op" id="287542">,</span>&nbsp;<span class="ident" id="287544">a0</span>&nbsp;<span class="op" id="287547">:=</span>&nbsp;<span class="ident" id="287550">c0</span><span class="op" id="287552">.</span><span class="ident" id="287553">RGBA</span><span class="op" id="287557">(</span><span class="op" id="287558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="287561">r1</span><span class="op" id="287563">,</span>&nbsp;<span class="ident" id="287565">g1</span><span class="op" id="287567">,</span>&nbsp;<span class="ident" id="287569">b1</span><span class="op" id="287571">,</span>&nbsp;<span class="ident" id="287573">a1</span>&nbsp;<span class="op" id="287576">:=</span>&nbsp;<span class="ident" id="287579">c1</span><span class="op" id="287581">.</span><span class="ident" id="287582">RGBA</span><span class="op" id="287586">(</span><span class="op" id="287587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="287590">r</span>&nbsp;<span class="op" id="287592">:=</span>&nbsp;<span class="ident" id="287595">delta</span><span class="op" id="287600">(</span><span class="ident" id="287601">r0</span><span class="op" id="287603">,</span>&nbsp;<span class="ident" id="287605">r1</span><span class="op" id="287607">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="287610">g</span>&nbsp;<span class="op" id="287612">:=</span>&nbsp;<span class="ident" id="287615">delta</span><span class="op" id="287620">(</span><span class="ident" id="287621">g0</span><span class="op" id="287623">,</span>&nbsp;<span class="ident" id="287625">g1</span><span class="op" id="287627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="287630">b</span>&nbsp;<span class="op" id="287632">:=</span>&nbsp;<span class="ident" id="287635">delta</span><span class="op" id="287640">(</span><span class="ident" id="287641">b0</span><span class="op" id="287643">,</span>&nbsp;<span class="ident" id="287645">b1</span><span class="op" id="287647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="287650">a</span>&nbsp;<span class="op" id="287652">:=</span>&nbsp;<span class="ident" id="287655">delta</span><span class="op" id="287660">(</span><span class="ident" id="287661">a0</span><span class="op" id="287663">,</span>&nbsp;<span class="ident" id="287665">a1</span><span class="op" id="287667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="287670">return</span>&nbsp;<span class="ident" id="287677">r</span>&nbsp;<span class="op" id="287679">&lt;=</span>&nbsp;<span class="ident" id="287682">tolerance</span>&nbsp;<span class="op" id="287692">&amp;&amp;</span>&nbsp;<span class="ident" id="287695">g</span>&nbsp;<span class="op" id="287697">&lt;=</span>&nbsp;<span class="ident" id="287700">tolerance</span>&nbsp;<span class="op" id="287710">&amp;&amp;</span>&nbsp;<span class="ident" id="287713">b</span>&nbsp;<span class="op" id="287715">&lt;=</span>&nbsp;<span class="ident" id="287718">tolerance</span>&nbsp;<span class="op" id="287728">&amp;&amp;</span>&nbsp;<span class="ident" id="287731">a</span>&nbsp;<span class="op" id="287733">&lt;=</span>&nbsp;<span class="ident" id="287736">tolerance</span><br>
<span class="lineno"></span><span class="op" id="287746">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="287749">func</span>&nbsp;<span class="ident" id="287754">TestDecode</span><span class="op" id="287764">(</span><span class="ident" id="287765">t</span>&nbsp;<span class="op" id="287767">*</span><span class="ident" id="287768">testing</span><span class="op" id="287775">.</span><span class="ident" id="287776">T</span><span class="op" id="287777">)</span>&nbsp;<span class="op" id="287779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="287782">golden</span>&nbsp;<span class="op" id="287789">:=</span>&nbsp;<span class="builtinfunc" id="287792">make</span><span class="op" id="287796">(</span><span class="keyword" id="287797">map</span><span class="op" id="287800">[</span><span class="builtintype" id="287801">string</span><span class="op" id="287807">]</span><span class="ident" id="287808">image</span><span class="op" id="287813">.</span><span class="ident" id="287814">Image</span><span class="op" id="287819">)</span><br>
<span class="lineno"></span><span class="ident" id="287821">loop</span><span class="op" id="287825">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="287828">for</span>&nbsp;<span class="ident" id="287832">_</span><span class="op" id="287833">,</span>&nbsp;<span class="ident" id="287835">it</span>&nbsp;<span class="op" id="287838">:=</span>&nbsp;<span class="keyword" id="287841">range</span>&nbsp;<span class="ident" id="287847">imageTests</span>&nbsp;<span class="op" id="287858">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="287862">g</span>&nbsp;<span class="op" id="287864">:=</span>&nbsp;<span class="ident" id="287867">golden</span><span class="op" id="287873">[</span><span class="ident" id="287874">it</span><span class="op" id="287876">.</span><span class="ident" id="287877">goldenFilename</span><span class="op" id="287891">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="287895">if</span>&nbsp;<span class="ident" id="287898">g</span>&nbsp;<span class="op" id="287900">==</span>&nbsp;<span class="ident" id="287903">nil</span>&nbsp;<span class="op" id="287907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="287912">var</span>&nbsp;<span class="ident" id="287916">err</span>&nbsp;<span class="builtintype" id="287920">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="287929">g</span><span class="op" id="287930">,</span>&nbsp;<span class="ident" id="287932">_</span><span class="op" id="287933">,</span>&nbsp;<span class="ident" id="287935">err</span>&nbsp;<span class="op" id="287939">=</span>&nbsp;<span class="ident" id="287941">decode</span><span class="op" id="287947">(</span><span class="ident" id="287948">it</span><span class="op" id="287950">.</span><span class="ident" id="287951">goldenFilename</span><span class="op" id="287965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="287970">if</span>&nbsp;<span class="ident" id="287973">err</span>&nbsp;<span class="op" id="287977">!=</span>&nbsp;<span class="ident" id="287980">nil</span>&nbsp;<span class="op" id="287984">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="287990">t</span><span class="op" id="287991">.</span><span class="ident" id="287992">Errorf</span><span class="op" id="287998">(</span><span class="string" id="287999">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="288007">,</span>&nbsp;<span class="ident" id="288009">it</span><span class="op" id="288011">.</span><span class="ident" id="288012">goldenFilename</span><span class="op" id="288026">,</span>&nbsp;<span class="ident" id="288028">err</span><span class="op" id="288031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="288037">continue</span>&nbsp;<span class="ident" id="288046">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="288054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="288059">golden</span><span class="op" id="288065">[</span><span class="ident" id="288066">it</span><span class="op" id="288068">.</span><span class="ident" id="288069">goldenFilename</span><span class="op" id="288083">]</span>&nbsp;<span class="op" id="288085">=</span>&nbsp;<span class="ident" id="288087">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="288091">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="288095">m</span><span class="op" id="288096">,</span>&nbsp;<span class="ident" id="288098">imageFormat</span><span class="op" id="288109">,</span>&nbsp;<span class="ident" id="288111">err</span>&nbsp;<span class="op" id="288115">:=</span>&nbsp;<span class="ident" id="288118">decode</span><span class="op" id="288124">(</span><span class="ident" id="288125">it</span><span class="op" id="288127">.</span><span class="ident" id="288128">filename</span><span class="op" id="288136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="288140">if</span>&nbsp;<span class="ident" id="288143">err</span>&nbsp;<span class="op" id="288147">!=</span>&nbsp;<span class="ident" id="288150">nil</span>&nbsp;<span class="op" id="288154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="288159">t</span><span class="op" id="288160">.</span><span class="ident" id="288161">Errorf</span><span class="op" id="288167">(</span><span class="string" id="288168">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="288176">,</span>&nbsp;<span class="ident" id="288178">it</span><span class="op" id="288180">.</span><span class="ident" id="288181">filename</span><span class="op" id="288189">,</span>&nbsp;<span class="ident" id="288191">err</span><span class="op" id="288194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="288199">continue</span>&nbsp;<span class="ident" id="288208">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="288215">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="288219">b</span>&nbsp;<span class="op" id="288221">:=</span>&nbsp;<span class="ident" id="288224">g</span><span class="op" id="288225">.</span><span class="ident" id="288226">Bounds</span><span class="op" id="288232">(</span><span class="op" id="288233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="288237">if</span>&nbsp;<span class="op" id="288240">!</span><span class="ident" id="288241">b</span><span class="op" id="288242">.</span><span class="ident" id="288243">Eq</span><span class="op" id="288245">(</span><span class="ident" id="288246">m</span><span class="op" id="288247">.</span><span class="ident" id="288248">Bounds</span><span class="op" id="288254">(</span><span class="op" id="288255">)</span><span class="op" id="288256">)</span>&nbsp;<span class="op" id="288258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="288263">t</span><span class="op" id="288264">.</span><span class="ident" id="288265">Errorf</span><span class="op" id="288271">(</span><span class="string" id="288272">&#34;%s:&nbsp;want&nbsp;bounds&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="288299">,</span>&nbsp;<span class="ident" id="288301">it</span><span class="op" id="288303">.</span><span class="ident" id="288304">filename</span><span class="op" id="288312">,</span>&nbsp;<span class="ident" id="288314">b</span><span class="op" id="288315">,</span>&nbsp;<span class="ident" id="288317">m</span><span class="op" id="288318">.</span><span class="ident" id="288319">Bounds</span><span class="op" id="288325">(</span><span class="op" id="288326">)</span><span class="op" id="288327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="288332">continue</span>&nbsp;<span class="ident" id="288341">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="288348">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="288352">for</span>&nbsp;<span class="ident" id="288356">y</span>&nbsp;<span class="op" id="288358">:=</span>&nbsp;<span class="ident" id="288361">b</span><span class="op" id="288362">.</span><span class="ident" id="288363">Min</span><span class="op" id="288366">.</span><span class="ident" id="288367">Y</span><span class="op" id="288368">;</span>&nbsp;<span class="ident" id="288370">y</span>&nbsp;<span class="op" id="288372">&lt;</span>&nbsp;<span class="ident" id="288374">b</span><span class="op" id="288375">.</span><span class="ident" id="288376">Max</span><span class="op" id="288379">.</span><span class="ident" id="288380">Y</span><span class="op" id="288381">;</span>&nbsp;<span class="ident" id="288383">y</span><span class="op" id="288384">++</span>&nbsp;<span class="op" id="288387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="288392">for</span>&nbsp;<span class="ident" id="288396">x</span>&nbsp;<span class="op" id="288398">:=</span>&nbsp;<span class="ident" id="288401">b</span><span class="op" id="288402">.</span><span class="ident" id="288403">Min</span><span class="op" id="288406">.</span><span class="ident" id="288407">X</span><span class="op" id="288408">;</span>&nbsp;<span class="ident" id="288410">x</span>&nbsp;<span class="op" id="288412">&lt;</span>&nbsp;<span class="ident" id="288414">b</span><span class="op" id="288415">.</span><span class="ident" id="288416">Max</span><span class="op" id="288419">.</span><span class="ident" id="288420">X</span><span class="op" id="288421">;</span>&nbsp;<span class="ident" id="288423">x</span><span class="op" id="288424">++</span>&nbsp;<span class="op" id="288427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="288433">if</span>&nbsp;<span class="op" id="288436">!</span><span class="ident" id="288437">withinTolerance</span><span class="op" id="288452">(</span><span class="ident" id="288453">g</span><span class="op" id="288454">.</span><span class="ident" id="288455">At</span><span class="op" id="288457">(</span><span class="ident" id="288458">x</span><span class="op" id="288459">,</span>&nbsp;<span class="ident" id="288461">y</span><span class="op" id="288462">)</span><span class="op" id="288463">,</span>&nbsp;<span class="ident" id="288465">m</span><span class="op" id="288466">.</span><span class="ident" id="288467">At</span><span class="op" id="288469">(</span><span class="ident" id="288470">x</span><span class="op" id="288471">,</span>&nbsp;<span class="ident" id="288473">y</span><span class="op" id="288474">)</span><span class="op" id="288475">,</span>&nbsp;<span class="ident" id="288477">it</span><span class="op" id="288479">.</span><span class="ident" id="288480">tolerance</span><span class="op" id="288489">)</span>&nbsp;<span class="op" id="288491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="288498">t</span><span class="op" id="288499">.</span><span class="ident" id="288500">Errorf</span><span class="op" id="288506">(</span><span class="string" id="288507">&#34;%s:&nbsp;at&nbsp;(%d,&nbsp;%d),&nbsp;want&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="288540">,</span>&nbsp;<span class="ident" id="288542">it</span><span class="op" id="288544">.</span><span class="ident" id="288545">filename</span><span class="op" id="288553">,</span>&nbsp;<span class="ident" id="288555">x</span><span class="op" id="288556">,</span>&nbsp;<span class="ident" id="288558">y</span><span class="op" id="288559">,</span>&nbsp;<span class="ident" id="288561">g</span><span class="op" id="288562">.</span><span class="ident" id="288563">At</span><span class="op" id="288565">(</span><span class="ident" id="288566">x</span><span class="op" id="288567">,</span>&nbsp;<span class="ident" id="288569">y</span><span class="op" id="288570">)</span><span class="op" id="288571">,</span>&nbsp;<span class="ident" id="288573">m</span><span class="op" id="288574">.</span><span class="ident" id="288575">At</span><span class="op" id="288577">(</span><span class="ident" id="288578">x</span><span class="op" id="288579">,</span>&nbsp;<span class="ident" id="288581">y</span><span class="op" id="288582">)</span><span class="op" id="288583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="288590">continue</span>&nbsp;<span class="ident" id="288599">loop</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="288608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="288613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="288617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="288621">if</span>&nbsp;<span class="ident" id="288624">imageFormat</span>&nbsp;<span class="op" id="288636">==</span>&nbsp;<span class="string" id="288639">&#34;gif&#34;</span>&nbsp;<span class="op" id="288645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="288650">//&nbsp;Each&nbsp;frame&nbsp;of&nbsp;a&nbsp;GIF&nbsp;can&nbsp;have&nbsp;a&nbsp;frame-local&nbsp;palette&nbsp;override&nbsp;the</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="288720">//&nbsp;GIF-global&nbsp;palette.&nbsp;Thus,&nbsp;image.Decode&nbsp;can&nbsp;yield&nbsp;a&nbsp;different&nbsp;ColorModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="288798">//&nbsp;than&nbsp;image.DecodeConfig.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="288829">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="288840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="288844">c</span><span class="op" id="288845">,</span>&nbsp;<span class="ident" id="288847">_</span><span class="op" id="288848">,</span>&nbsp;<span class="ident" id="288850">err</span>&nbsp;<span class="op" id="288854">:=</span>&nbsp;<span class="ident" id="288857">decodeConfig</span><span class="op" id="288869">(</span><span class="ident" id="288870">it</span><span class="op" id="288872">.</span><span class="ident" id="288873">filename</span><span class="op" id="288881">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="288885">if</span>&nbsp;<span class="ident" id="288888">m</span><span class="op" id="288889">.</span><span class="ident" id="288890">ColorModel</span><span class="op" id="288900">(</span><span class="op" id="288901">)</span>&nbsp;<span class="op" id="288903">!=</span>&nbsp;<span class="ident" id="288906">c</span><span class="op" id="288907">.</span><span class="ident" id="288908">ColorModel</span>&nbsp;<span class="op" id="288919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="288924">t</span><span class="op" id="288925">.</span><span class="ident" id="288926">Errorf</span><span class="op" id="288932">(</span><span class="string" id="288933">&#34;%s:&nbsp;color&nbsp;models&nbsp;differ&#34;</span><span class="op" id="288958">,</span>&nbsp;<span class="ident" id="288960">it</span><span class="op" id="288962">.</span><span class="ident" id="288963">filename</span><span class="op" id="288971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="288976">continue</span>&nbsp;<span class="ident" id="288985">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="288992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="288995">}</span><br>
<span class="lineno">120</span><span class="op" id="288997">}</span>
</div>
</body>
</html>
