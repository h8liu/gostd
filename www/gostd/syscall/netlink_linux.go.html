<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2383590">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2383646">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2383700">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2383751">//&nbsp;Netlink&nbsp;sockets&nbsp;and&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2383784">package</span>&nbsp;<span class="ident" id="2383792">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2383801">import</span>&nbsp;<span class="string" id="2383808">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2383818">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;message&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2383884">func</span>&nbsp;<span class="ident" id="2383889">nlmAlignOf</span><span class="op" id="2383899">(</span><span class="ident" id="2383900">msglen</span>&nbsp;<span class="builtintype" id="2383907">int</span><span class="op" id="2383910">)</span>&nbsp;<span class="builtintype" id="2383912">int</span>&nbsp;<span class="op" id="2383916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383919">return</span>&nbsp;<span class="op" id="2383926">(</span><span class="ident" id="2383927">msglen</span>&nbsp;<span class="op" id="2383934">+</span>&nbsp;<span class="ident" id="2383936">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2383950">-</span>&nbsp;<span class="num" id="2383952">1</span><span class="op" id="2383953">)</span>&nbsp;<span class="op" id="2383955">&amp;</span>&nbsp;<span class="op" id="2383957">^</span><span class="op" id="2383958">(</span><span class="ident" id="2383959">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2383973">-</span>&nbsp;<span class="num" id="2383975">1</span><span class="op" id="2383976">)</span><br>
<span class="lineno"></span><span class="op" id="2383978">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2383981">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute&nbsp;up&nbsp;to&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2384045">//&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2384058">func</span>&nbsp;<span class="ident" id="2384063">rtaAlignOf</span><span class="op" id="2384073">(</span><span class="ident" id="2384074">attrlen</span>&nbsp;<span class="builtintype" id="2384082">int</span><span class="op" id="2384085">)</span>&nbsp;<span class="builtintype" id="2384087">int</span>&nbsp;<span class="op" id="2384091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384094">return</span>&nbsp;<span class="op" id="2384101">(</span><span class="ident" id="2384102">attrlen</span>&nbsp;<span class="op" id="2384110">+</span>&nbsp;<span class="ident" id="2384112">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2384124">-</span>&nbsp;<span class="num" id="2384126">1</span><span class="op" id="2384127">)</span>&nbsp;<span class="op" id="2384129">&amp;</span>&nbsp;<span class="op" id="2384131">^</span><span class="op" id="2384132">(</span><span class="ident" id="2384133">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2384145">-</span>&nbsp;<span class="num" id="2384147">1</span><span class="op" id="2384148">)</span><br>
<span class="lineno">20</span><span class="op" id="2384150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2384153">//&nbsp;NetlinkRouteRequest&nbsp;represents&nbsp;a&nbsp;request&nbsp;message&nbsp;to&nbsp;receive&nbsp;routing</span><br>
<span class="lineno"></span><span class="comment" id="2384224">//&nbsp;and&nbsp;link&nbsp;states&nbsp;from&nbsp;the&nbsp;kernel.</span><br>
<span class="lineno"></span><span class="keyword" id="2384260">type</span>&nbsp;<span class="ident" id="2384265">NetlinkRouteRequest</span>&nbsp;<span class="keyword" id="2384285">struct</span>&nbsp;<span class="op" id="2384292">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2384295">Header</span>&nbsp;<span class="ident" id="2384302">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2384312">Data</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2384319">RtGenmsg</span><br>
<span class="lineno"></span><span class="op" id="2384328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2384331">func</span>&nbsp;<span class="op" id="2384336">(</span><span class="ident" id="2384337">rr</span>&nbsp;<span class="op" id="2384340">*</span><span class="ident" id="2384341">NetlinkRouteRequest</span><span class="op" id="2384360">)</span>&nbsp;<span class="ident" id="2384362">toWireFormat</span><span class="op" id="2384374">(</span><span class="op" id="2384375">)</span>&nbsp;<span class="op" id="2384377">[</span><span class="op" id="2384378">]</span><span class="builtintype" id="2384379">byte</span>&nbsp;<span class="op" id="2384384">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2384387">b</span>&nbsp;<span class="op" id="2384389">:=</span>&nbsp;<span class="builtinfunc" id="2384392">make</span><span class="op" id="2384396">(</span><span class="op" id="2384397">[</span><span class="op" id="2384398">]</span><span class="builtintype" id="2384399">byte</span><span class="op" id="2384403">,</span>&nbsp;<span class="ident" id="2384405">rr</span><span class="op" id="2384407">.</span><span class="ident" id="2384408">Header</span><span class="op" id="2384414">.</span><span class="ident" id="2384415">Len</span><span class="op" id="2384418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2384421">*</span><span class="op" id="2384422">(</span><span class="op" id="2384423">*</span><span class="builtintype" id="2384424">uint32</span><span class="op" id="2384430">)</span><span class="op" id="2384431">(</span><span class="ident" id="2384432">unsafe</span><span class="op" id="2384438">.</span><span class="ident" id="2384439">Pointer</span><span class="op" id="2384446">(</span><span class="op" id="2384447">&amp;</span><span class="ident" id="2384448">b</span><span class="op" id="2384449">[</span><span class="num" id="2384450">0</span><span class="op" id="2384451">:</span><span class="num" id="2384452">4</span><span class="op" id="2384453">]</span><span class="op" id="2384454">[</span><span class="num" id="2384455">0</span><span class="op" id="2384456">]</span><span class="op" id="2384457">)</span><span class="op" id="2384458">)</span>&nbsp;<span class="op" id="2384460">=</span>&nbsp;<span class="ident" id="2384462">rr</span><span class="op" id="2384464">.</span><span class="ident" id="2384465">Header</span><span class="op" id="2384471">.</span><span class="ident" id="2384472">Len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2384477">*</span><span class="op" id="2384478">(</span><span class="op" id="2384479">*</span><span class="builtintype" id="2384480">uint16</span><span class="op" id="2384486">)</span><span class="op" id="2384487">(</span><span class="ident" id="2384488">unsafe</span><span class="op" id="2384494">.</span><span class="ident" id="2384495">Pointer</span><span class="op" id="2384502">(</span><span class="op" id="2384503">&amp;</span><span class="ident" id="2384504">b</span><span class="op" id="2384505">[</span><span class="num" id="2384506">4</span><span class="op" id="2384507">:</span><span class="num" id="2384508">6</span><span class="op" id="2384509">]</span><span class="op" id="2384510">[</span><span class="num" id="2384511">0</span><span class="op" id="2384512">]</span><span class="op" id="2384513">)</span><span class="op" id="2384514">)</span>&nbsp;<span class="op" id="2384516">=</span>&nbsp;<span class="ident" id="2384518">rr</span><span class="op" id="2384520">.</span><span class="ident" id="2384521">Header</span><span class="op" id="2384527">.</span><span class="ident" id="2384528">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2384534">*</span><span class="op" id="2384535">(</span><span class="op" id="2384536">*</span><span class="builtintype" id="2384537">uint16</span><span class="op" id="2384543">)</span><span class="op" id="2384544">(</span><span class="ident" id="2384545">unsafe</span><span class="op" id="2384551">.</span><span class="ident" id="2384552">Pointer</span><span class="op" id="2384559">(</span><span class="op" id="2384560">&amp;</span><span class="ident" id="2384561">b</span><span class="op" id="2384562">[</span><span class="num" id="2384563">6</span><span class="op" id="2384564">:</span><span class="num" id="2384565">8</span><span class="op" id="2384566">]</span><span class="op" id="2384567">[</span><span class="num" id="2384568">0</span><span class="op" id="2384569">]</span><span class="op" id="2384570">)</span><span class="op" id="2384571">)</span>&nbsp;<span class="op" id="2384573">=</span>&nbsp;<span class="ident" id="2384575">rr</span><span class="op" id="2384577">.</span><span class="ident" id="2384578">Header</span><span class="op" id="2384584">.</span><span class="ident" id="2384585">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2384592">*</span><span class="op" id="2384593">(</span><span class="op" id="2384594">*</span><span class="builtintype" id="2384595">uint32</span><span class="op" id="2384601">)</span><span class="op" id="2384602">(</span><span class="ident" id="2384603">unsafe</span><span class="op" id="2384609">.</span><span class="ident" id="2384610">Pointer</span><span class="op" id="2384617">(</span><span class="op" id="2384618">&amp;</span><span class="ident" id="2384619">b</span><span class="op" id="2384620">[</span><span class="num" id="2384621">8</span><span class="op" id="2384622">:</span><span class="num" id="2384623">12</span><span class="op" id="2384625">]</span><span class="op" id="2384626">[</span><span class="num" id="2384627">0</span><span class="op" id="2384628">]</span><span class="op" id="2384629">)</span><span class="op" id="2384630">)</span>&nbsp;<span class="op" id="2384632">=</span>&nbsp;<span class="ident" id="2384634">rr</span><span class="op" id="2384636">.</span><span class="ident" id="2384637">Header</span><span class="op" id="2384643">.</span><span class="ident" id="2384644">Seq</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2384649">*</span><span class="op" id="2384650">(</span><span class="op" id="2384651">*</span><span class="builtintype" id="2384652">uint32</span><span class="op" id="2384658">)</span><span class="op" id="2384659">(</span><span class="ident" id="2384660">unsafe</span><span class="op" id="2384666">.</span><span class="ident" id="2384667">Pointer</span><span class="op" id="2384674">(</span><span class="op" id="2384675">&amp;</span><span class="ident" id="2384676">b</span><span class="op" id="2384677">[</span><span class="num" id="2384678">12</span><span class="op" id="2384680">:</span><span class="num" id="2384681">16</span><span class="op" id="2384683">]</span><span class="op" id="2384684">[</span><span class="num" id="2384685">0</span><span class="op" id="2384686">]</span><span class="op" id="2384687">)</span><span class="op" id="2384688">)</span>&nbsp;<span class="op" id="2384690">=</span>&nbsp;<span class="ident" id="2384692">rr</span><span class="op" id="2384694">.</span><span class="ident" id="2384695">Header</span><span class="op" id="2384701">.</span><span class="ident" id="2384702">Pid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2384707">b</span><span class="op" id="2384708">[</span><span class="num" id="2384709">16</span><span class="op" id="2384711">]</span>&nbsp;<span class="op" id="2384713">=</span>&nbsp;<span class="builtintype" id="2384715">byte</span><span class="op" id="2384719">(</span><span class="ident" id="2384720">rr</span><span class="op" id="2384722">.</span><span class="ident" id="2384723">Data</span><span class="op" id="2384727">.</span><span class="ident" id="2384728">Family</span><span class="op" id="2384734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2384737">return</span>&nbsp;<span class="ident" id="2384744">b</span><br>
<span class="lineno"></span><span class="op" id="2384746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2384749">func</span>&nbsp;<span class="ident" id="2384754">newNetlinkRouteRequest</span><span class="op" id="2384776">(</span><span class="ident" id="2384777">proto</span><span class="op" id="2384782">,</span>&nbsp;<span class="ident" id="2384784">seq</span><span class="op" id="2384787">,</span>&nbsp;<span class="ident" id="2384789">family</span>&nbsp;<span class="builtintype" id="2384796">int</span><span class="op" id="2384799">)</span>&nbsp;<span class="op" id="2384801">[</span><span class="op" id="2384802">]</span><span class="builtintype" id="2384803">byte</span>&nbsp;<span class="op" id="2384808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2384811">rr</span>&nbsp;<span class="op" id="2384814">:=</span>&nbsp;<span class="op" id="2384817">&amp;</span><span class="ident" id="2384818">NetlinkRouteRequest</span><span class="op" id="2384837">{</span><span class="op" id="2384838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2384841">rr</span><span class="op" id="2384843">.</span><span class="ident" id="2384844">Header</span><span class="op" id="2384850">.</span><span class="ident" id="2384851">Len</span>&nbsp;<span class="op" id="2384855">=</span>&nbsp;<span class="builtintype" id="2384857">uint32</span><span class="op" id="2384863">(</span><span class="ident" id="2384864">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2384877">+</span>&nbsp;<span class="ident" id="2384879">SizeofRtGenmsg</span><span class="op" id="2384893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2384896">rr</span><span class="op" id="2384898">.</span><span class="ident" id="2384899">Header</span><span class="op" id="2384905">.</span><span class="ident" id="2384906">Type</span>&nbsp;<span class="op" id="2384911">=</span>&nbsp;<span class="builtintype" id="2384913">uint16</span><span class="op" id="2384919">(</span><span class="ident" id="2384920">proto</span><span class="op" id="2384925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2384928">rr</span><span class="op" id="2384930">.</span><span class="ident" id="2384931">Header</span><span class="op" id="2384937">.</span><span class="ident" id="2384938">Flags</span>&nbsp;<span class="op" id="2384944">=</span>&nbsp;<span class="ident" id="2384946">NLM_F_DUMP</span>&nbsp;<span class="op" id="2384957">|</span>&nbsp;<span class="ident" id="2384959">NLM_F_REQUEST</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2384974">rr</span><span class="op" id="2384976">.</span><span class="ident" id="2384977">Header</span><span class="op" id="2384983">.</span><span class="ident" id="2384984">Seq</span>&nbsp;<span class="op" id="2384988">=</span>&nbsp;<span class="builtintype" id="2384990">uint32</span><span class="op" id="2384996">(</span><span class="ident" id="2384997">seq</span><span class="op" id="2385000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385003">rr</span><span class="op" id="2385005">.</span><span class="ident" id="2385006">Data</span><span class="op" id="2385010">.</span><span class="ident" id="2385011">Family</span>&nbsp;<span class="op" id="2385018">=</span>&nbsp;<span class="builtintype" id="2385020">uint8</span><span class="op" id="2385025">(</span><span class="ident" id="2385026">family</span><span class="op" id="2385032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385035">return</span>&nbsp;<span class="ident" id="2385042">rr</span><span class="op" id="2385044">.</span><span class="ident" id="2385045">toWireFormat</span><span class="op" id="2385057">(</span><span class="op" id="2385058">)</span><br>
<span class="lineno"></span><span class="op" id="2385060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="2385063">//&nbsp;NetlinkRIB&nbsp;returns&nbsp;routing&nbsp;information&nbsp;base,&nbsp;as&nbsp;known&nbsp;as&nbsp;RIB,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="2385134">//&nbsp;consists&nbsp;of&nbsp;network&nbsp;facility&nbsp;information,&nbsp;states&nbsp;and&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="2385202">func</span>&nbsp;<span class="ident" id="2385207">NetlinkRIB</span><span class="op" id="2385217">(</span><span class="ident" id="2385218">proto</span><span class="op" id="2385223">,</span>&nbsp;<span class="ident" id="2385225">family</span>&nbsp;<span class="builtintype" id="2385232">int</span><span class="op" id="2385235">)</span>&nbsp;<span class="op" id="2385237">(</span><span class="op" id="2385238">[</span><span class="op" id="2385239">]</span><span class="builtintype" id="2385240">byte</span><span class="op" id="2385244">,</span>&nbsp;<span class="builtintype" id="2385246">error</span><span class="op" id="2385251">)</span>&nbsp;<span class="op" id="2385253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385256">s</span><span class="op" id="2385257">,</span>&nbsp;<span class="ident" id="2385259">err</span>&nbsp;<span class="op" id="2385263">:=</span>&nbsp;<span class="ident" id="2385266">Socket</span><span class="op" id="2385272">(</span><span class="ident" id="2385273">AF_NETLINK</span><span class="op" id="2385283">,</span>&nbsp;<span class="ident" id="2385285">SOCK_RAW</span><span class="op" id="2385293">,</span>&nbsp;<span class="ident" id="2385295">NETLINK_ROUTE</span><span class="op" id="2385308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385311">if</span>&nbsp;<span class="ident" id="2385314">err</span>&nbsp;<span class="op" id="2385318">!=</span>&nbsp;<span class="ident" id="2385321">nil</span>&nbsp;<span class="op" id="2385325">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385329">return</span>&nbsp;<span class="ident" id="2385336">nil</span><span class="op" id="2385339">,</span>&nbsp;<span class="ident" id="2385341">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2385346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385349">defer</span>&nbsp;<span class="ident" id="2385355">Close</span><span class="op" id="2385360">(</span><span class="ident" id="2385361">s</span><span class="op" id="2385362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385365">lsa</span>&nbsp;<span class="op" id="2385369">:=</span>&nbsp;<span class="op" id="2385372">&amp;</span><span class="ident" id="2385373">SockaddrNetlink</span><span class="op" id="2385388">{</span><span class="ident" id="2385389">Family</span><span class="op" id="2385395">:</span>&nbsp;<span class="ident" id="2385397">AF_NETLINK</span><span class="op" id="2385407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385410">if</span>&nbsp;<span class="ident" id="2385413">err</span>&nbsp;<span class="op" id="2385417">:=</span>&nbsp;<span class="ident" id="2385420">Bind</span><span class="op" id="2385424">(</span><span class="ident" id="2385425">s</span><span class="op" id="2385426">,</span>&nbsp;<span class="ident" id="2385428">lsa</span><span class="op" id="2385431">)</span><span class="op" id="2385432">;</span>&nbsp;<span class="ident" id="2385434">err</span>&nbsp;<span class="op" id="2385438">!=</span>&nbsp;<span class="ident" id="2385441">nil</span>&nbsp;<span class="op" id="2385445">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385449">return</span>&nbsp;<span class="ident" id="2385456">nil</span><span class="op" id="2385459">,</span>&nbsp;<span class="ident" id="2385461">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2385466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385469">wb</span>&nbsp;<span class="op" id="2385472">:=</span>&nbsp;<span class="ident" id="2385475">newNetlinkRouteRequest</span><span class="op" id="2385497">(</span><span class="ident" id="2385498">proto</span><span class="op" id="2385503">,</span>&nbsp;<span class="num" id="2385505">1</span><span class="op" id="2385506">,</span>&nbsp;<span class="ident" id="2385508">family</span><span class="op" id="2385514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385517">if</span>&nbsp;<span class="ident" id="2385520">err</span>&nbsp;<span class="op" id="2385524">:=</span>&nbsp;<span class="ident" id="2385527">Sendto</span><span class="op" id="2385533">(</span><span class="ident" id="2385534">s</span><span class="op" id="2385535">,</span>&nbsp;<span class="ident" id="2385537">wb</span><span class="op" id="2385539">,</span>&nbsp;<span class="num" id="2385541">0</span><span class="op" id="2385542">,</span>&nbsp;<span class="ident" id="2385544">lsa</span><span class="op" id="2385547">)</span><span class="op" id="2385548">;</span>&nbsp;<span class="ident" id="2385550">err</span>&nbsp;<span class="op" id="2385554">!=</span>&nbsp;<span class="ident" id="2385557">nil</span>&nbsp;<span class="op" id="2385561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385565">return</span>&nbsp;<span class="ident" id="2385572">nil</span><span class="op" id="2385575">,</span>&nbsp;<span class="ident" id="2385577">err</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2385582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385585">var</span>&nbsp;<span class="ident" id="2385589">tab</span>&nbsp;<span class="op" id="2385593">[</span><span class="op" id="2385594">]</span><span class="builtintype" id="2385595">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385601">rbNew</span>&nbsp;<span class="op" id="2385607">:=</span>&nbsp;<span class="builtinfunc" id="2385610">make</span><span class="op" id="2385614">(</span><span class="op" id="2385615">[</span><span class="op" id="2385616">]</span><span class="builtintype" id="2385617">byte</span><span class="op" id="2385621">,</span>&nbsp;<span class="ident" id="2385623">Getpagesize</span><span class="op" id="2385634">(</span><span class="op" id="2385635">)</span><span class="op" id="2385636">)</span><br>
<span class="lineno"></span><span class="ident" id="2385638">done</span><span class="op" id="2385642">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385645">for</span>&nbsp;<span class="op" id="2385649">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385653">rb</span>&nbsp;<span class="op" id="2385656">:=</span>&nbsp;<span class="ident" id="2385659">rbNew</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385667">nr</span><span class="op" id="2385669">,</span>&nbsp;<span class="ident" id="2385671">_</span><span class="op" id="2385672">,</span>&nbsp;<span class="ident" id="2385674">err</span>&nbsp;<span class="op" id="2385678">:=</span>&nbsp;<span class="ident" id="2385681">Recvfrom</span><span class="op" id="2385689">(</span><span class="ident" id="2385690">s</span><span class="op" id="2385691">,</span>&nbsp;<span class="ident" id="2385693">rb</span><span class="op" id="2385695">,</span>&nbsp;<span class="num" id="2385697">0</span><span class="op" id="2385698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385702">if</span>&nbsp;<span class="ident" id="2385705">err</span>&nbsp;<span class="op" id="2385709">!=</span>&nbsp;<span class="ident" id="2385712">nil</span>&nbsp;<span class="op" id="2385716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385721">return</span>&nbsp;<span class="ident" id="2385728">nil</span><span class="op" id="2385731">,</span>&nbsp;<span class="ident" id="2385733">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2385739">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385743">if</span>&nbsp;<span class="ident" id="2385746">nr</span>&nbsp;<span class="op" id="2385749">&lt;</span>&nbsp;<span class="ident" id="2385751">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2385764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385769">return</span>&nbsp;<span class="ident" id="2385776">nil</span><span class="op" id="2385779">,</span>&nbsp;<span class="ident" id="2385781">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2385790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385794">rb</span>&nbsp;<span class="op" id="2385797">=</span>&nbsp;<span class="ident" id="2385799">rb</span><span class="op" id="2385801">[</span><span class="op" id="2385802">:</span><span class="ident" id="2385803">nr</span><span class="op" id="2385805">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385809">tab</span>&nbsp;<span class="op" id="2385813">=</span>&nbsp;<span class="builtinfunc" id="2385815">append</span><span class="op" id="2385821">(</span><span class="ident" id="2385822">tab</span><span class="op" id="2385825">,</span>&nbsp;<span class="ident" id="2385827">rb</span><span class="op" id="2385829">...</span><span class="op" id="2385832">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385836">msgs</span><span class="op" id="2385840">,</span>&nbsp;<span class="ident" id="2385842">err</span>&nbsp;<span class="op" id="2385846">:=</span>&nbsp;<span class="ident" id="2385849">ParseNetlinkMessage</span><span class="op" id="2385868">(</span><span class="ident" id="2385869">rb</span><span class="op" id="2385871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385875">if</span>&nbsp;<span class="ident" id="2385878">err</span>&nbsp;<span class="op" id="2385882">!=</span>&nbsp;<span class="ident" id="2385885">nil</span>&nbsp;<span class="op" id="2385889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385894">return</span>&nbsp;<span class="ident" id="2385901">nil</span><span class="op" id="2385904">,</span>&nbsp;<span class="ident" id="2385906">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2385912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385916">for</span>&nbsp;<span class="ident" id="2385920">_</span><span class="op" id="2385921">,</span>&nbsp;<span class="ident" id="2385923">m</span>&nbsp;<span class="op" id="2385925">:=</span>&nbsp;<span class="keyword" id="2385928">range</span>&nbsp;<span class="ident" id="2385934">msgs</span>&nbsp;<span class="op" id="2385939">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2385944">lsa</span><span class="op" id="2385947">,</span>&nbsp;<span class="ident" id="2385949">err</span>&nbsp;<span class="op" id="2385953">:=</span>&nbsp;<span class="ident" id="2385956">Getsockname</span><span class="op" id="2385967">(</span><span class="ident" id="2385968">s</span><span class="op" id="2385969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385974">if</span>&nbsp;<span class="ident" id="2385977">err</span>&nbsp;<span class="op" id="2385981">!=</span>&nbsp;<span class="ident" id="2385984">nil</span>&nbsp;<span class="op" id="2385988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2385994">return</span>&nbsp;<span class="ident" id="2386001">nil</span><span class="op" id="2386004">,</span>&nbsp;<span class="ident" id="2386006">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2386013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386018">switch</span>&nbsp;<span class="ident" id="2386025">v</span>&nbsp;<span class="op" id="2386027">:=</span>&nbsp;<span class="ident" id="2386030">lsa</span><span class="op" id="2386033">.</span><span class="op" id="2386034">(</span><span class="keyword" id="2386035">type</span><span class="op" id="2386039">)</span>&nbsp;<span class="op" id="2386041">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386046">case</span>&nbsp;<span class="op" id="2386051">*</span><span class="ident" id="2386052">SockaddrNetlink</span><span class="op" id="2386067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386073">if</span>&nbsp;<span class="ident" id="2386076">m</span><span class="op" id="2386077">.</span><span class="ident" id="2386078">Header</span><span class="op" id="2386084">.</span><span class="ident" id="2386085">Seq</span>&nbsp;<span class="op" id="2386089">!=</span>&nbsp;<span class="num" id="2386092">1</span>&nbsp;<span class="op" id="2386094">||</span>&nbsp;<span class="ident" id="2386097">m</span><span class="op" id="2386098">.</span><span class="ident" id="2386099">Header</span><span class="op" id="2386105">.</span><span class="ident" id="2386106">Pid</span>&nbsp;<span class="op" id="2386110">!=</span>&nbsp;<span class="ident" id="2386113">v</span><span class="op" id="2386114">.</span><span class="ident" id="2386115">Pid</span>&nbsp;<span class="op" id="2386119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386126">return</span>&nbsp;<span class="ident" id="2386133">nil</span><span class="op" id="2386136">,</span>&nbsp;<span class="ident" id="2386138">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2386149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386154">default</span><span class="op" id="2386161">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386167">return</span>&nbsp;<span class="ident" id="2386174">nil</span><span class="op" id="2386177">,</span>&nbsp;<span class="ident" id="2386179">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2386189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386194">if</span>&nbsp;<span class="ident" id="2386197">m</span><span class="op" id="2386198">.</span><span class="ident" id="2386199">Header</span><span class="op" id="2386205">.</span><span class="ident" id="2386206">Type</span>&nbsp;<span class="op" id="2386211">==</span>&nbsp;<span class="ident" id="2386214">NLMSG_DONE</span>&nbsp;<span class="op" id="2386225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386231">break</span>&nbsp;<span class="ident" id="2386237">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2386245">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386250">if</span>&nbsp;<span class="ident" id="2386253">m</span><span class="op" id="2386254">.</span><span class="ident" id="2386255">Header</span><span class="op" id="2386261">.</span><span class="ident" id="2386262">Type</span>&nbsp;<span class="op" id="2386267">==</span>&nbsp;<span class="ident" id="2386270">NLMSG_ERROR</span>&nbsp;<span class="op" id="2386282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386288">return</span>&nbsp;<span class="ident" id="2386295">nil</span><span class="op" id="2386298">,</span>&nbsp;<span class="ident" id="2386300">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2386310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2386314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2386317">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386320">return</span>&nbsp;<span class="ident" id="2386327">tab</span><span class="op" id="2386330">,</span>&nbsp;<span class="ident" id="2386332">nil</span><br>
<span class="lineno"></span><span class="op" id="2386336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2386339">//&nbsp;NetlinkMessage&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2386387">type</span>&nbsp;<span class="ident" id="2386392">NetlinkMessage</span>&nbsp;<span class="keyword" id="2386407">struct</span>&nbsp;<span class="op" id="2386414">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2386417">Header</span>&nbsp;<span class="ident" id="2386424">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2386434">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2386441">[</span><span class="op" id="2386442">]</span><span class="builtintype" id="2386443">byte</span><br>
<span class="lineno"></span><span class="op" id="2386448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2386451">//&nbsp;ParseNetlinkMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink&nbsp;messages&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="2386519">//&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the&nbsp;NetlinkMessage&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2386582">func</span>&nbsp;<span class="ident" id="2386587">ParseNetlinkMessage</span><span class="op" id="2386606">(</span><span class="ident" id="2386607">b</span>&nbsp;<span class="op" id="2386609">[</span><span class="op" id="2386610">]</span><span class="builtintype" id="2386611">byte</span><span class="op" id="2386615">)</span>&nbsp;<span class="op" id="2386617">(</span><span class="op" id="2386618">[</span><span class="op" id="2386619">]</span><span class="ident" id="2386620">NetlinkMessage</span><span class="op" id="2386634">,</span>&nbsp;<span class="builtintype" id="2386636">error</span><span class="op" id="2386641">)</span>&nbsp;<span class="op" id="2386643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386646">var</span>&nbsp;<span class="ident" id="2386650">msgs</span>&nbsp;<span class="op" id="2386655">[</span><span class="op" id="2386656">]</span><span class="ident" id="2386657">NetlinkMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386673">for</span>&nbsp;<span class="builtinfunc" id="2386677">len</span><span class="op" id="2386680">(</span><span class="ident" id="2386681">b</span><span class="op" id="2386682">)</span>&nbsp;<span class="op" id="2386684">&gt;=</span>&nbsp;<span class="ident" id="2386687">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2386700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2386704">h</span><span class="op" id="2386705">,</span>&nbsp;<span class="ident" id="2386707">dbuf</span><span class="op" id="2386711">,</span>&nbsp;<span class="ident" id="2386713">dlen</span><span class="op" id="2386717">,</span>&nbsp;<span class="ident" id="2386719">err</span>&nbsp;<span class="op" id="2386723">:=</span>&nbsp;<span class="ident" id="2386726">netlinkMessageHeaderAndData</span><span class="op" id="2386753">(</span><span class="ident" id="2386754">b</span><span class="op" id="2386755">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386759">if</span>&nbsp;<span class="ident" id="2386762">err</span>&nbsp;<span class="op" id="2386766">!=</span>&nbsp;<span class="ident" id="2386769">nil</span>&nbsp;<span class="op" id="2386773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386778">return</span>&nbsp;<span class="ident" id="2386785">nil</span><span class="op" id="2386788">,</span>&nbsp;<span class="ident" id="2386790">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2386796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2386800">m</span>&nbsp;<span class="op" id="2386802">:=</span>&nbsp;<span class="ident" id="2386805">NetlinkMessage</span><span class="op" id="2386819">{</span><span class="ident" id="2386820">Header</span><span class="op" id="2386826">:</span>&nbsp;<span class="op" id="2386828">*</span><span class="ident" id="2386829">h</span><span class="op" id="2386830">,</span>&nbsp;<span class="ident" id="2386832">Data</span><span class="op" id="2386836">:</span>&nbsp;<span class="ident" id="2386838">dbuf</span><span class="op" id="2386842">[</span><span class="op" id="2386843">:</span><span class="builtintype" id="2386844">int</span><span class="op" id="2386847">(</span><span class="ident" id="2386848">h</span><span class="op" id="2386849">.</span><span class="ident" id="2386850">Len</span><span class="op" id="2386853">)</span><span class="op" id="2386854">-</span><span class="ident" id="2386855">NLMSG_HDRLEN</span><span class="op" id="2386867">]</span><span class="op" id="2386868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2386872">msgs</span>&nbsp;<span class="op" id="2386877">=</span>&nbsp;<span class="builtinfunc" id="2386879">append</span><span class="op" id="2386885">(</span><span class="ident" id="2386886">msgs</span><span class="op" id="2386890">,</span>&nbsp;<span class="ident" id="2386892">m</span><span class="op" id="2386893">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2386897">b</span>&nbsp;<span class="op" id="2386899">=</span>&nbsp;<span class="ident" id="2386901">b</span><span class="op" id="2386902">[</span><span class="ident" id="2386903">dlen</span><span class="op" id="2386907">:</span><span class="op" id="2386908">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2386911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2386914">return</span>&nbsp;<span class="ident" id="2386921">msgs</span><span class="op" id="2386925">,</span>&nbsp;<span class="ident" id="2386927">nil</span><br>
<span class="lineno"></span><span class="op" id="2386931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2386934">func</span>&nbsp;<span class="ident" id="2386939">netlinkMessageHeaderAndData</span><span class="op" id="2386966">(</span><span class="ident" id="2386967">b</span>&nbsp;<span class="op" id="2386969">[</span><span class="op" id="2386970">]</span><span class="builtintype" id="2386971">byte</span><span class="op" id="2386975">)</span>&nbsp;<span class="op" id="2386977">(</span><span class="op" id="2386978">*</span><span class="ident" id="2386979">NlMsghdr</span><span class="op" id="2386987">,</span>&nbsp;<span class="op" id="2386989">[</span><span class="op" id="2386990">]</span><span class="builtintype" id="2386991">byte</span><span class="op" id="2386995">,</span>&nbsp;<span class="builtintype" id="2386997">int</span><span class="op" id="2387000">,</span>&nbsp;<span class="builtintype" id="2387002">error</span><span class="op" id="2387007">)</span>&nbsp;<span class="op" id="2387009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2387012">h</span>&nbsp;<span class="op" id="2387014">:=</span>&nbsp;<span class="op" id="2387017">(</span><span class="op" id="2387018">*</span><span class="ident" id="2387019">NlMsghdr</span><span class="op" id="2387027">)</span><span class="op" id="2387028">(</span><span class="ident" id="2387029">unsafe</span><span class="op" id="2387035">.</span><span class="ident" id="2387036">Pointer</span><span class="op" id="2387043">(</span><span class="op" id="2387044">&amp;</span><span class="ident" id="2387045">b</span><span class="op" id="2387046">[</span><span class="num" id="2387047">0</span><span class="op" id="2387048">]</span><span class="op" id="2387049">)</span><span class="op" id="2387050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2387053">if</span>&nbsp;<span class="builtintype" id="2387056">int</span><span class="op" id="2387059">(</span><span class="ident" id="2387060">h</span><span class="op" id="2387061">.</span><span class="ident" id="2387062">Len</span><span class="op" id="2387065">)</span>&nbsp;<span class="op" id="2387067">&lt;</span>&nbsp;<span class="ident" id="2387069">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2387082">||</span>&nbsp;<span class="builtintype" id="2387085">int</span><span class="op" id="2387088">(</span><span class="ident" id="2387089">h</span><span class="op" id="2387090">.</span><span class="ident" id="2387091">Len</span><span class="op" id="2387094">)</span>&nbsp;<span class="op" id="2387096">&gt;</span>&nbsp;<span class="builtinfunc" id="2387098">len</span><span class="op" id="2387101">(</span><span class="ident" id="2387102">b</span><span class="op" id="2387103">)</span>&nbsp;<span class="op" id="2387105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2387109">return</span>&nbsp;<span class="ident" id="2387116">nil</span><span class="op" id="2387119">,</span>&nbsp;<span class="ident" id="2387121">nil</span><span class="op" id="2387124">,</span>&nbsp;<span class="num" id="2387126">0</span><span class="op" id="2387127">,</span>&nbsp;<span class="ident" id="2387129">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2387137">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2387140">return</span>&nbsp;<span class="ident" id="2387147">h</span><span class="op" id="2387148">,</span>&nbsp;<span class="ident" id="2387150">b</span><span class="op" id="2387151">[</span><span class="ident" id="2387152">NLMSG_HDRLEN</span><span class="op" id="2387164">:</span><span class="op" id="2387165">]</span><span class="op" id="2387166">,</span>&nbsp;<span class="ident" id="2387168">nlmAlignOf</span><span class="op" id="2387178">(</span><span class="builtintype" id="2387179">int</span><span class="op" id="2387182">(</span><span class="ident" id="2387183">h</span><span class="op" id="2387184">.</span><span class="ident" id="2387185">Len</span><span class="op" id="2387188">)</span><span class="op" id="2387189">)</span><span class="op" id="2387190">,</span>&nbsp;<span class="ident" id="2387192">nil</span><br>
<span class="lineno"></span><span class="op" id="2387196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2387199">//&nbsp;NetlinkRouteAttr&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="2387257">type</span>&nbsp;<span class="ident" id="2387262">NetlinkRouteAttr</span>&nbsp;<span class="keyword" id="2387279">struct</span>&nbsp;<span class="op" id="2387286">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2387289">Attr</span>&nbsp;&nbsp;<span class="ident" id="2387295">RtAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2387303">Value</span>&nbsp;<span class="op" id="2387309">[</span><span class="op" id="2387310">]</span><span class="builtintype" id="2387311">byte</span><br>
<span class="lineno"></span><span class="op" id="2387316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2387319">//&nbsp;ParseNetlinkRouteAttr&nbsp;parses&nbsp;m&#39;s&nbsp;payload&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink</span><br>
<span class="lineno">145</span><span class="comment" id="2387386">//&nbsp;route&nbsp;attributes&nbsp;and&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2387443">//&nbsp;NetlinkRouteAttr&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2387475">func</span>&nbsp;<span class="ident" id="2387480">ParseNetlinkRouteAttr</span><span class="op" id="2387501">(</span><span class="ident" id="2387502">m</span>&nbsp;<span class="op" id="2387504">*</span><span class="ident" id="2387505">NetlinkMessage</span><span class="op" id="2387519">)</span>&nbsp;<span class="op" id="2387521">(</span><span class="op" id="2387522">[</span><span class="op" id="2387523">]</span><span class="ident" id="2387524">NetlinkRouteAttr</span><span class="op" id="2387540">,</span>&nbsp;<span class="builtintype" id="2387542">error</span><span class="op" id="2387547">)</span>&nbsp;<span class="op" id="2387549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2387552">var</span>&nbsp;<span class="ident" id="2387556">b</span>&nbsp;<span class="op" id="2387558">[</span><span class="op" id="2387559">]</span><span class="builtintype" id="2387560">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2387566">switch</span>&nbsp;<span class="ident" id="2387573">m</span><span class="op" id="2387574">.</span><span class="ident" id="2387575">Header</span><span class="op" id="2387581">.</span><span class="ident" id="2387582">Type</span>&nbsp;<span class="op" id="2387587">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2387590">case</span>&nbsp;<span class="ident" id="2387595">RTM_NEWLINK</span><span class="op" id="2387606">,</span>&nbsp;<span class="ident" id="2387608">RTM_DELLINK</span><span class="op" id="2387619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2387623">b</span>&nbsp;<span class="op" id="2387625">=</span>&nbsp;<span class="ident" id="2387627">m</span><span class="op" id="2387628">.</span><span class="ident" id="2387629">Data</span><span class="op" id="2387633">[</span><span class="ident" id="2387634">SizeofIfInfomsg</span><span class="op" id="2387649">:</span><span class="op" id="2387650">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2387653">case</span>&nbsp;<span class="ident" id="2387658">RTM_NEWADDR</span><span class="op" id="2387669">,</span>&nbsp;<span class="ident" id="2387671">RTM_DELADDR</span><span class="op" id="2387682">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2387686">b</span>&nbsp;<span class="op" id="2387688">=</span>&nbsp;<span class="ident" id="2387690">m</span><span class="op" id="2387691">.</span><span class="ident" id="2387692">Data</span><span class="op" id="2387696">[</span><span class="ident" id="2387697">SizeofIfAddrmsg</span><span class="op" id="2387712">:</span><span class="op" id="2387713">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2387716">case</span>&nbsp;<span class="ident" id="2387721">RTM_NEWROUTE</span><span class="op" id="2387733">,</span>&nbsp;<span class="ident" id="2387735">RTM_DELROUTE</span><span class="op" id="2387747">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2387751">b</span>&nbsp;<span class="op" id="2387753">=</span>&nbsp;<span class="ident" id="2387755">m</span><span class="op" id="2387756">.</span><span class="ident" id="2387757">Data</span><span class="op" id="2387761">[</span><span class="ident" id="2387762">SizeofRtMsg</span><span class="op" id="2387773">:</span><span class="op" id="2387774">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2387777">default</span><span class="op" id="2387784">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2387788">return</span>&nbsp;<span class="ident" id="2387795">nil</span><span class="op" id="2387798">,</span>&nbsp;<span class="ident" id="2387800">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2387808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2387811">var</span>&nbsp;<span class="ident" id="2387815">attrs</span>&nbsp;<span class="op" id="2387821">[</span><span class="op" id="2387822">]</span><span class="ident" id="2387823">NetlinkRouteAttr</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2387841">for</span>&nbsp;<span class="builtinfunc" id="2387845">len</span><span class="op" id="2387848">(</span><span class="ident" id="2387849">b</span><span class="op" id="2387850">)</span>&nbsp;<span class="op" id="2387852">&gt;=</span>&nbsp;<span class="ident" id="2387855">SizeofRtAttr</span>&nbsp;<span class="op" id="2387868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2387872">a</span><span class="op" id="2387873">,</span>&nbsp;<span class="ident" id="2387875">vbuf</span><span class="op" id="2387879">,</span>&nbsp;<span class="ident" id="2387881">alen</span><span class="op" id="2387885">,</span>&nbsp;<span class="ident" id="2387887">err</span>&nbsp;<span class="op" id="2387891">:=</span>&nbsp;<span class="ident" id="2387894">netlinkRouteAttrAndValue</span><span class="op" id="2387918">(</span><span class="ident" id="2387919">b</span><span class="op" id="2387920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2387924">if</span>&nbsp;<span class="ident" id="2387927">err</span>&nbsp;<span class="op" id="2387931">!=</span>&nbsp;<span class="ident" id="2387934">nil</span>&nbsp;<span class="op" id="2387938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2387943">return</span>&nbsp;<span class="ident" id="2387950">nil</span><span class="op" id="2387953">,</span>&nbsp;<span class="ident" id="2387955">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2387961">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2387965">ra</span>&nbsp;<span class="op" id="2387968">:=</span>&nbsp;<span class="ident" id="2387971">NetlinkRouteAttr</span><span class="op" id="2387987">{</span><span class="ident" id="2387988">Attr</span><span class="op" id="2387992">:</span>&nbsp;<span class="op" id="2387994">*</span><span class="ident" id="2387995">a</span><span class="op" id="2387996">,</span>&nbsp;<span class="ident" id="2387998">Value</span><span class="op" id="2388003">:</span>&nbsp;<span class="ident" id="2388005">vbuf</span><span class="op" id="2388009">[</span><span class="op" id="2388010">:</span><span class="builtintype" id="2388011">int</span><span class="op" id="2388014">(</span><span class="ident" id="2388015">a</span><span class="op" id="2388016">.</span><span class="ident" id="2388017">Len</span><span class="op" id="2388020">)</span><span class="op" id="2388021">-</span><span class="ident" id="2388022">SizeofRtAttr</span><span class="op" id="2388034">]</span><span class="op" id="2388035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2388039">attrs</span>&nbsp;<span class="op" id="2388045">=</span>&nbsp;<span class="builtinfunc" id="2388047">append</span><span class="op" id="2388053">(</span><span class="ident" id="2388054">attrs</span><span class="op" id="2388059">,</span>&nbsp;<span class="ident" id="2388061">ra</span><span class="op" id="2388063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2388067">b</span>&nbsp;<span class="op" id="2388069">=</span>&nbsp;<span class="ident" id="2388071">b</span><span class="op" id="2388072">[</span><span class="ident" id="2388073">alen</span><span class="op" id="2388077">:</span><span class="op" id="2388078">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2388081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2388084">return</span>&nbsp;<span class="ident" id="2388091">attrs</span><span class="op" id="2388096">,</span>&nbsp;<span class="ident" id="2388098">nil</span><br>
<span class="lineno">170</span><span class="op" id="2388102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2388105">func</span>&nbsp;<span class="ident" id="2388110">netlinkRouteAttrAndValue</span><span class="op" id="2388134">(</span><span class="ident" id="2388135">b</span>&nbsp;<span class="op" id="2388137">[</span><span class="op" id="2388138">]</span><span class="builtintype" id="2388139">byte</span><span class="op" id="2388143">)</span>&nbsp;<span class="op" id="2388145">(</span><span class="op" id="2388146">*</span><span class="ident" id="2388147">RtAttr</span><span class="op" id="2388153">,</span>&nbsp;<span class="op" id="2388155">[</span><span class="op" id="2388156">]</span><span class="builtintype" id="2388157">byte</span><span class="op" id="2388161">,</span>&nbsp;<span class="builtintype" id="2388163">int</span><span class="op" id="2388166">,</span>&nbsp;<span class="builtintype" id="2388168">error</span><span class="op" id="2388173">)</span>&nbsp;<span class="op" id="2388175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2388178">a</span>&nbsp;<span class="op" id="2388180">:=</span>&nbsp;<span class="op" id="2388183">(</span><span class="op" id="2388184">*</span><span class="ident" id="2388185">RtAttr</span><span class="op" id="2388191">)</span><span class="op" id="2388192">(</span><span class="ident" id="2388193">unsafe</span><span class="op" id="2388199">.</span><span class="ident" id="2388200">Pointer</span><span class="op" id="2388207">(</span><span class="op" id="2388208">&amp;</span><span class="ident" id="2388209">b</span><span class="op" id="2388210">[</span><span class="num" id="2388211">0</span><span class="op" id="2388212">]</span><span class="op" id="2388213">)</span><span class="op" id="2388214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2388217">if</span>&nbsp;<span class="builtintype" id="2388220">int</span><span class="op" id="2388223">(</span><span class="ident" id="2388224">a</span><span class="op" id="2388225">.</span><span class="ident" id="2388226">Len</span><span class="op" id="2388229">)</span>&nbsp;<span class="op" id="2388231">&lt;</span>&nbsp;<span class="ident" id="2388233">SizeofRtAttr</span>&nbsp;<span class="op" id="2388246">||</span>&nbsp;<span class="builtintype" id="2388249">int</span><span class="op" id="2388252">(</span><span class="ident" id="2388253">a</span><span class="op" id="2388254">.</span><span class="ident" id="2388255">Len</span><span class="op" id="2388258">)</span>&nbsp;<span class="op" id="2388260">&gt;</span>&nbsp;<span class="builtinfunc" id="2388262">len</span><span class="op" id="2388265">(</span><span class="ident" id="2388266">b</span><span class="op" id="2388267">)</span>&nbsp;<span class="op" id="2388269">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2388273">return</span>&nbsp;<span class="ident" id="2388280">nil</span><span class="op" id="2388283">,</span>&nbsp;<span class="ident" id="2388285">nil</span><span class="op" id="2388288">,</span>&nbsp;<span class="num" id="2388290">0</span><span class="op" id="2388291">,</span>&nbsp;<span class="ident" id="2388293">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2388301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2388304">return</span>&nbsp;<span class="ident" id="2388311">a</span><span class="op" id="2388312">,</span>&nbsp;<span class="ident" id="2388314">b</span><span class="op" id="2388315">[</span><span class="ident" id="2388316">SizeofRtAttr</span><span class="op" id="2388328">:</span><span class="op" id="2388329">]</span><span class="op" id="2388330">,</span>&nbsp;<span class="ident" id="2388332">rtaAlignOf</span><span class="op" id="2388342">(</span><span class="builtintype" id="2388343">int</span><span class="op" id="2388346">(</span><span class="ident" id="2388347">a</span><span class="op" id="2388348">.</span><span class="ident" id="2388349">Len</span><span class="op" id="2388352">)</span><span class="op" id="2388353">)</span><span class="op" id="2388354">,</span>&nbsp;<span class="ident" id="2388356">nil</span><br>
<span class="lineno"></span><span class="op" id="2388360">}</span>
</div>
</body>
</html>
