<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html" class="current">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4781892">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4781947">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4782001">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4782052">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;host&nbsp;side&nbsp;of&nbsp;CGI&nbsp;(being&nbsp;the&nbsp;webserver</span><br>
<span class="lineno"></span><span class="comment" id="4782118">//&nbsp;parent&nbsp;process).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4782139">//&nbsp;Package&nbsp;cgi&nbsp;implements&nbsp;CGI&nbsp;(Common&nbsp;Gateway&nbsp;Interface)&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="4782209">//&nbsp;in&nbsp;RFC&nbsp;3875.</span><br>
<span class="lineno">10</span><span class="comment" id="4782225">//</span><br>
<span class="lineno"></span><span class="comment" id="4782228">//&nbsp;Note&nbsp;that&nbsp;using&nbsp;CGI&nbsp;means&nbsp;starting&nbsp;a&nbsp;new&nbsp;process&nbsp;to&nbsp;handle&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="4782295">//&nbsp;request,&nbsp;which&nbsp;is&nbsp;typically&nbsp;less&nbsp;efficient&nbsp;than&nbsp;using&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4782354">//&nbsp;long-running&nbsp;server.&nbsp;&nbsp;This&nbsp;package&nbsp;is&nbsp;intended&nbsp;primarily&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4782418">//&nbsp;compatibility&nbsp;with&nbsp;existing&nbsp;systems.</span><br>
<span class="lineno">15</span><span class="keyword" id="4782458">package</span>&nbsp;<span class="ident" id="4782466">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4782471">import</span>&nbsp;<span class="op" id="4782478">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782481">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782490">&#34;fmt&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782497">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782503">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782510">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782522">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782528">&#34;os/exec&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782539">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782556">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782566">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782577">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782588">&#34;strings&#34;</span><br>
<span class="lineno">30</span><span class="op" id="4782598">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4782601">var</span>&nbsp;<span class="ident" id="4782605">trailingPort</span>&nbsp;<span class="op" id="4782618">=</span>&nbsp;<span class="ident" id="4782620">regexp</span><span class="op" id="4782626">.</span><span class="ident" id="4782627">MustCompile</span><span class="op" id="4782638">(</span><span class="string" id="4782639">`:([0-9]+)$`</span><span class="op" id="4782651">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4782654">var</span>&nbsp;<span class="ident" id="4782658">osDefaultInheritEnv</span>&nbsp;<span class="op" id="4782678">=</span>&nbsp;<span class="keyword" id="4782680">map</span><span class="op" id="4782683">[</span><span class="builtintype" id="4782684">string</span><span class="op" id="4782690">]</span><span class="op" id="4782691">[</span><span class="op" id="4782692">]</span><span class="builtintype" id="4782693">string</span><span class="op" id="4782699">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782702">&#34;darwin&#34;</span><span class="op" id="4782710">:</span>&nbsp;&nbsp;<span class="op" id="4782713">{</span><span class="string" id="4782714">&#34;DYLD_LIBRARY_PATH&#34;</span><span class="op" id="4782733">}</span><span class="op" id="4782734">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782737">&#34;freebsd&#34;</span><span class="op" id="4782746">:</span>&nbsp;<span class="op" id="4782748">{</span><span class="string" id="4782749">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="4782766">}</span><span class="op" id="4782767">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782770">&#34;hpux&#34;</span><span class="op" id="4782776">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4782781">{</span><span class="string" id="4782782">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="4782799">,</span>&nbsp;<span class="string" id="4782801">&#34;SHLIB_PATH&#34;</span><span class="op" id="4782813">}</span><span class="op" id="4782814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782817">&#34;irix&#34;</span><span class="op" id="4782823">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4782828">{</span><span class="string" id="4782829">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="4782846">,</span>&nbsp;<span class="string" id="4782848">&#34;LD_LIBRARYN32_PATH&#34;</span><span class="op" id="4782868">,</span>&nbsp;<span class="string" id="4782870">&#34;LD_LIBRARY64_PATH&#34;</span><span class="op" id="4782889">}</span><span class="op" id="4782890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782893">&#34;linux&#34;</span><span class="op" id="4782900">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4782904">{</span><span class="string" id="4782905">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="4782922">}</span><span class="op" id="4782923">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782926">&#34;openbsd&#34;</span><span class="op" id="4782935">:</span>&nbsp;<span class="op" id="4782937">{</span><span class="string" id="4782938">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="4782955">}</span><span class="op" id="4782956">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4782959">&#34;solaris&#34;</span><span class="op" id="4782968">:</span>&nbsp;<span class="op" id="4782970">{</span><span class="string" id="4782971">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="4782988">,</span>&nbsp;<span class="string" id="4782990">&#34;LD_LIBRARY_PATH_32&#34;</span><span class="op" id="4783010">,</span>&nbsp;<span class="string" id="4783012">&#34;LD_LIBRARY_PATH_64&#34;</span><span class="op" id="4783032">}</span><span class="op" id="4783033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4783036">&#34;windows&#34;</span><span class="op" id="4783045">:</span>&nbsp;<span class="op" id="4783047">{</span><span class="string" id="4783048">&#34;SystemRoot&#34;</span><span class="op" id="4783060">,</span>&nbsp;<span class="string" id="4783062">&#34;COMSPEC&#34;</span><span class="op" id="4783071">,</span>&nbsp;<span class="string" id="4783073">&#34;PATHEXT&#34;</span><span class="op" id="4783082">,</span>&nbsp;<span class="string" id="4783084">&#34;WINDIR&#34;</span><span class="op" id="4783092">}</span><span class="op" id="4783093">,</span><br>
<span class="lineno"></span><span class="op" id="4783095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="4783098">//&nbsp;Handler&nbsp;runs&nbsp;an&nbsp;executable&nbsp;in&nbsp;a&nbsp;subprocess&nbsp;with&nbsp;a&nbsp;CGI&nbsp;environment.</span><br>
<span class="lineno"></span><span class="keyword" id="4783168">type</span>&nbsp;<span class="ident" id="4783173">Handler</span>&nbsp;<span class="keyword" id="4783181">struct</span>&nbsp;<span class="op" id="4783188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4783191">Path</span>&nbsp;<span class="builtintype" id="4783196">string</span>&nbsp;<span class="comment" id="4783203">//&nbsp;path&nbsp;to&nbsp;the&nbsp;CGI&nbsp;executable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4783234">Root</span>&nbsp;<span class="builtintype" id="4783239">string</span>&nbsp;<span class="comment" id="4783246">//&nbsp;root&nbsp;URI&nbsp;prefix&nbsp;of&nbsp;handler&nbsp;or&nbsp;empty&nbsp;for&nbsp;&#34;/&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783295">//&nbsp;Dir&nbsp;specifies&nbsp;the&nbsp;CGI&nbsp;executable&#39;s&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783353">//&nbsp;If&nbsp;Dir&nbsp;is&nbsp;empty,&nbsp;the&nbsp;base&nbsp;directory&nbsp;of&nbsp;Path&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783410">//&nbsp;If&nbsp;Path&nbsp;has&nbsp;no&nbsp;base&nbsp;directory,&nbsp;the&nbsp;current&nbsp;working</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783465">//&nbsp;directory&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4783488">Dir</span>&nbsp;<span class="builtintype" id="4783492">string</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4783501">Env</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4783512">[</span><span class="op" id="4783513">]</span><span class="builtintype" id="4783514">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4783524">//&nbsp;extra&nbsp;environment&nbsp;variables&nbsp;to&nbsp;set,&nbsp;if&nbsp;any,&nbsp;as&nbsp;&#34;key=value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4783587">InheritEnv</span>&nbsp;<span class="op" id="4783598">[</span><span class="op" id="4783599">]</span><span class="builtintype" id="4783600">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4783610">//&nbsp;environment&nbsp;variables&nbsp;to&nbsp;inherit&nbsp;from&nbsp;host,&nbsp;as&nbsp;&#34;key&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4783667">Logger</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4783678">*</span><span class="ident" id="4783679">log</span><span class="op" id="4783682">.</span><span class="ident" id="4783683">Logger</span>&nbsp;<span class="comment" id="4783690">//&nbsp;optional&nbsp;log&nbsp;for&nbsp;errors&nbsp;or&nbsp;nil&nbsp;to&nbsp;use&nbsp;log.Print</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4783742">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4783753">[</span><span class="op" id="4783754">]</span><span class="builtintype" id="4783755">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4783765">//&nbsp;optional&nbsp;arguments&nbsp;to&nbsp;pass&nbsp;to&nbsp;child&nbsp;process</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783814">//&nbsp;PathLocationHandler&nbsp;specifies&nbsp;the&nbsp;root&nbsp;http&nbsp;Handler&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783875">//&nbsp;should&nbsp;handle&nbsp;internal&nbsp;redirects&nbsp;when&nbsp;the&nbsp;CGI&nbsp;process</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783933">//&nbsp;returns&nbsp;a&nbsp;Location&nbsp;header&nbsp;value&nbsp;starting&nbsp;with&nbsp;a&nbsp;&#34;/&#34;,&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4783993">//&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;3875&nbsp;ยง&nbsp;6.3.2.&nbsp;This&nbsp;will&nbsp;likely&nbsp;be</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784049">//&nbsp;http.DefaultServeMux.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784075">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784079">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;CGI&nbsp;response&nbsp;with&nbsp;a&nbsp;local&nbsp;URI&nbsp;path&nbsp;is&nbsp;instead&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4784144">//&nbsp;back&nbsp;to&nbsp;the&nbsp;client&nbsp;and&nbsp;not&nbsp;redirected&nbsp;internally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784198">PathLocationHandler</span>&nbsp;<span class="ident" id="4784218">http</span><span class="op" id="4784222">.</span><span class="ident" id="4784223">Handler</span><br>
<span class="lineno">70</span><span class="op" id="4784231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4784234">//&nbsp;removeLeadingDuplicates&nbsp;remove&nbsp;leading&nbsp;duplicate&nbsp;in&nbsp;environments.</span><br>
<span class="lineno"></span><span class="comment" id="4784303">//&nbsp;It&#39;s&nbsp;possible&nbsp;to&nbsp;override&nbsp;environment&nbsp;like&nbsp;following.</span><br>
<span class="lineno"></span><span class="comment" id="4784360">//&nbsp;&nbsp;&nbsp;&nbsp;cgi.Handler{</span><br>
<span class="lineno">75</span><span class="comment" id="4784379">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="4784391">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Env:&nbsp;[]string{&#34;SCRIPT_FILENAME=foo.php&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="4784441">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="keyword" id="4784449">func</span>&nbsp;<span class="ident" id="4784454">removeLeadingDuplicates</span><span class="op" id="4784477">(</span><span class="ident" id="4784478">env</span>&nbsp;<span class="op" id="4784482">[</span><span class="op" id="4784483">]</span><span class="builtintype" id="4784484">string</span><span class="op" id="4784490">)</span>&nbsp;<span class="op" id="4784492">(</span><span class="ident" id="4784493">ret</span>&nbsp;<span class="op" id="4784497">[</span><span class="op" id="4784498">]</span><span class="builtintype" id="4784499">string</span><span class="op" id="4784505">)</span>&nbsp;<span class="op" id="4784507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784510">n</span>&nbsp;<span class="op" id="4784512">:=</span>&nbsp;<span class="builtinfunc" id="4784515">len</span><span class="op" id="4784518">(</span><span class="ident" id="4784519">env</span><span class="op" id="4784522">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4784525">for</span>&nbsp;<span class="ident" id="4784529">i</span>&nbsp;<span class="op" id="4784531">:=</span>&nbsp;<span class="num" id="4784534">0</span><span class="op" id="4784535">;</span>&nbsp;<span class="ident" id="4784537">i</span>&nbsp;<span class="op" id="4784539">&lt;</span>&nbsp;<span class="ident" id="4784541">n</span><span class="op" id="4784542">;</span>&nbsp;<span class="ident" id="4784544">i</span><span class="op" id="4784545">++</span>&nbsp;<span class="op" id="4784548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784552">e</span>&nbsp;<span class="op" id="4784554">:=</span>&nbsp;<span class="ident" id="4784557">env</span><span class="op" id="4784560">[</span><span class="ident" id="4784561">i</span><span class="op" id="4784562">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784566">s</span>&nbsp;<span class="op" id="4784568">:=</span>&nbsp;<span class="ident" id="4784571">strings</span><span class="op" id="4784578">.</span><span class="ident" id="4784579">SplitN</span><span class="op" id="4784585">(</span><span class="ident" id="4784586">e</span><span class="op" id="4784587">,</span>&nbsp;<span class="string" id="4784589">&#34;=&#34;</span><span class="op" id="4784592">,</span>&nbsp;<span class="num" id="4784594">2</span><span class="op" id="4784595">)</span><span class="op" id="4784596">[</span><span class="num" id="4784597">0</span><span class="op" id="4784598">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784602">found</span>&nbsp;<span class="op" id="4784608">:=</span>&nbsp;<span class="builtintype" id="4784611">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4784619">for</span>&nbsp;<span class="ident" id="4784623">j</span>&nbsp;<span class="op" id="4784625">:=</span>&nbsp;<span class="ident" id="4784628">i</span>&nbsp;<span class="op" id="4784630">+</span>&nbsp;<span class="num" id="4784632">1</span><span class="op" id="4784633">;</span>&nbsp;<span class="ident" id="4784635">j</span>&nbsp;<span class="op" id="4784637">&lt;</span>&nbsp;<span class="ident" id="4784639">n</span><span class="op" id="4784640">;</span>&nbsp;<span class="ident" id="4784642">j</span><span class="op" id="4784643">++</span>&nbsp;<span class="op" id="4784646">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4784651">if</span>&nbsp;<span class="ident" id="4784654">s</span>&nbsp;<span class="op" id="4784656">==</span>&nbsp;<span class="ident" id="4784659">strings</span><span class="op" id="4784666">.</span><span class="ident" id="4784667">SplitN</span><span class="op" id="4784673">(</span><span class="ident" id="4784674">env</span><span class="op" id="4784677">[</span><span class="ident" id="4784678">j</span><span class="op" id="4784679">]</span><span class="op" id="4784680">,</span>&nbsp;<span class="string" id="4784682">&#34;=&#34;</span><span class="op" id="4784685">,</span>&nbsp;<span class="num" id="4784687">2</span><span class="op" id="4784688">)</span><span class="op" id="4784689">[</span><span class="num" id="4784690">0</span><span class="op" id="4784691">]</span>&nbsp;<span class="op" id="4784693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784699">found</span>&nbsp;<span class="op" id="4784705">=</span>&nbsp;<span class="builtintype" id="4784707">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4784716">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4784725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4784729">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4784733">if</span>&nbsp;<span class="op" id="4784736">!</span><span class="ident" id="4784737">found</span>&nbsp;<span class="op" id="4784743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784748">ret</span>&nbsp;<span class="op" id="4784752">=</span>&nbsp;<span class="builtinfunc" id="4784754">append</span><span class="op" id="4784760">(</span><span class="ident" id="4784761">ret</span><span class="op" id="4784764">,</span>&nbsp;<span class="ident" id="4784766">e</span><span class="op" id="4784767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4784771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4784774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4784777">return</span><br>
<span class="lineno">95</span><span class="op" id="4784784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4784787">func</span>&nbsp;<span class="op" id="4784792">(</span><span class="ident" id="4784793">h</span>&nbsp;<span class="op" id="4784795">*</span><span class="ident" id="4784796">Handler</span><span class="op" id="4784803">)</span>&nbsp;<span class="ident" id="4784805">ServeHTTP</span><span class="op" id="4784814">(</span><span class="ident" id="4784815">rw</span>&nbsp;<span class="ident" id="4784818">http</span><span class="op" id="4784822">.</span><span class="ident" id="4784823">ResponseWriter</span><span class="op" id="4784837">,</span>&nbsp;<span class="ident" id="4784839">req</span>&nbsp;<span class="op" id="4784843">*</span><span class="ident" id="4784844">http</span><span class="op" id="4784848">.</span><span class="ident" id="4784849">Request</span><span class="op" id="4784856">)</span>&nbsp;<span class="op" id="4784858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784861">root</span>&nbsp;<span class="op" id="4784866">:=</span>&nbsp;<span class="ident" id="4784869">h</span><span class="op" id="4784870">.</span><span class="ident" id="4784871">Root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4784877">if</span>&nbsp;<span class="ident" id="4784880">root</span>&nbsp;<span class="op" id="4784885">==</span>&nbsp;<span class="string" id="4784888">&#34;&#34;</span>&nbsp;<span class="op" id="4784891">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784895">root</span>&nbsp;<span class="op" id="4784900">=</span>&nbsp;<span class="string" id="4784902">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4784907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4784911">if</span>&nbsp;<span class="builtinfunc" id="4784914">len</span><span class="op" id="4784917">(</span><span class="ident" id="4784918">req</span><span class="op" id="4784921">.</span><span class="ident" id="4784922">TransferEncoding</span><span class="op" id="4784938">)</span>&nbsp;<span class="op" id="4784940">&gt;</span>&nbsp;<span class="num" id="4784942">0</span>&nbsp;<span class="op" id="4784944">&amp;&amp;</span>&nbsp;<span class="ident" id="4784947">req</span><span class="op" id="4784950">.</span><span class="ident" id="4784951">TransferEncoding</span><span class="op" id="4784967">[</span><span class="num" id="4784968">0</span><span class="op" id="4784969">]</span>&nbsp;<span class="op" id="4784971">==</span>&nbsp;<span class="string" id="4784974">&#34;chunked&#34;</span>&nbsp;<span class="op" id="4784984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784988">rw</span><span class="op" id="4784990">.</span><span class="ident" id="4784991">WriteHeader</span><span class="op" id="4785002">(</span><span class="ident" id="4785003">http</span><span class="op" id="4785007">.</span><span class="ident" id="4785008">StatusBadRequest</span><span class="op" id="4785024">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785028">rw</span><span class="op" id="4785030">.</span><span class="ident" id="4785031">Write</span><span class="op" id="4785036">(</span><span class="op" id="4785037">[</span><span class="op" id="4785038">]</span><span class="builtintype" id="4785039">byte</span><span class="op" id="4785043">(</span><span class="string" id="4785044">&#34;Chunked&nbsp;request&nbsp;bodies&nbsp;are&nbsp;not&nbsp;supported&nbsp;by&nbsp;CGI.&#34;</span><span class="op" id="4785094">)</span><span class="op" id="4785095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4785099">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4785107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785111">pathInfo</span>&nbsp;<span class="op" id="4785120">:=</span>&nbsp;<span class="ident" id="4785123">req</span><span class="op" id="4785126">.</span><span class="ident" id="4785127">URL</span><span class="op" id="4785130">.</span><span class="ident" id="4785131">Path</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4785137">if</span>&nbsp;<span class="ident" id="4785140">root</span>&nbsp;<span class="op" id="4785145">!=</span>&nbsp;<span class="string" id="4785148">&#34;/&#34;</span>&nbsp;<span class="op" id="4785152">&amp;&amp;</span>&nbsp;<span class="ident" id="4785155">strings</span><span class="op" id="4785162">.</span><span class="ident" id="4785163">HasPrefix</span><span class="op" id="4785172">(</span><span class="ident" id="4785173">pathInfo</span><span class="op" id="4785181">,</span>&nbsp;<span class="ident" id="4785183">root</span><span class="op" id="4785187">)</span>&nbsp;<span class="op" id="4785189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785193">pathInfo</span>&nbsp;<span class="op" id="4785202">=</span>&nbsp;<span class="ident" id="4785204">pathInfo</span><span class="op" id="4785212">[</span><span class="builtinfunc" id="4785213">len</span><span class="op" id="4785216">(</span><span class="ident" id="4785217">root</span><span class="op" id="4785221">)</span><span class="op" id="4785222">:</span><span class="op" id="4785223">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4785226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785230">port</span>&nbsp;<span class="op" id="4785235">:=</span>&nbsp;<span class="string" id="4785238">&#34;80&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4785244">if</span>&nbsp;<span class="ident" id="4785247">matches</span>&nbsp;<span class="op" id="4785255">:=</span>&nbsp;<span class="ident" id="4785258">trailingPort</span><span class="op" id="4785270">.</span><span class="ident" id="4785271">FindStringSubmatch</span><span class="op" id="4785289">(</span><span class="ident" id="4785290">req</span><span class="op" id="4785293">.</span><span class="ident" id="4785294">Host</span><span class="op" id="4785298">)</span><span class="op" id="4785299">;</span>&nbsp;<span class="builtinfunc" id="4785301">len</span><span class="op" id="4785304">(</span><span class="ident" id="4785305">matches</span><span class="op" id="4785312">)</span>&nbsp;<span class="op" id="4785314">!=</span>&nbsp;<span class="num" id="4785317">0</span>&nbsp;<span class="op" id="4785319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785323">port</span>&nbsp;<span class="op" id="4785328">=</span>&nbsp;<span class="ident" id="4785330">matches</span><span class="op" id="4785337">[</span><span class="num" id="4785338">1</span><span class="op" id="4785339">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4785342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785346">env</span>&nbsp;<span class="op" id="4785350">:=</span>&nbsp;<span class="op" id="4785353">[</span><span class="op" id="4785354">]</span><span class="builtintype" id="4785355">string</span><span class="op" id="4785361">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785365">&#34;SERVER_SOFTWARE=go&#34;</span><span class="op" id="4785385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785389">&#34;SERVER_NAME=&#34;</span>&nbsp;<span class="op" id="4785404">+</span>&nbsp;<span class="ident" id="4785406">req</span><span class="op" id="4785409">.</span><span class="ident" id="4785410">Host</span><span class="op" id="4785414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785418">&#34;SERVER_PROTOCOL=HTTP/1.1&#34;</span><span class="op" id="4785444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785448">&#34;HTTP_HOST=&#34;</span>&nbsp;<span class="op" id="4785461">+</span>&nbsp;<span class="ident" id="4785463">req</span><span class="op" id="4785466">.</span><span class="ident" id="4785467">Host</span><span class="op" id="4785471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785475">&#34;GATEWAY_INTERFACE=CGI/1.1&#34;</span><span class="op" id="4785502">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785506">&#34;REQUEST_METHOD=&#34;</span>&nbsp;<span class="op" id="4785524">+</span>&nbsp;<span class="ident" id="4785526">req</span><span class="op" id="4785529">.</span><span class="ident" id="4785530">Method</span><span class="op" id="4785536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785540">&#34;QUERY_STRING=&#34;</span>&nbsp;<span class="op" id="4785556">+</span>&nbsp;<span class="ident" id="4785558">req</span><span class="op" id="4785561">.</span><span class="ident" id="4785562">URL</span><span class="op" id="4785565">.</span><span class="ident" id="4785566">RawQuery</span><span class="op" id="4785574">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785578">&#34;REQUEST_URI=&#34;</span>&nbsp;<span class="op" id="4785593">+</span>&nbsp;<span class="ident" id="4785595">req</span><span class="op" id="4785598">.</span><span class="ident" id="4785599">URL</span><span class="op" id="4785602">.</span><span class="ident" id="4785603">RequestURI</span><span class="op" id="4785613">(</span><span class="op" id="4785614">)</span><span class="op" id="4785615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785619">&#34;PATH_INFO=&#34;</span>&nbsp;<span class="op" id="4785632">+</span>&nbsp;<span class="ident" id="4785634">pathInfo</span><span class="op" id="4785642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785646">&#34;SCRIPT_NAME=&#34;</span>&nbsp;<span class="op" id="4785661">+</span>&nbsp;<span class="ident" id="4785663">root</span><span class="op" id="4785667">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785671">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="4785690">+</span>&nbsp;<span class="ident" id="4785692">h</span><span class="op" id="4785693">.</span><span class="ident" id="4785694">Path</span><span class="op" id="4785698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785702">&#34;REMOTE_ADDR=&#34;</span>&nbsp;<span class="op" id="4785717">+</span>&nbsp;<span class="ident" id="4785719">req</span><span class="op" id="4785722">.</span><span class="ident" id="4785723">RemoteAddr</span><span class="op" id="4785733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785737">&#34;REMOTE_HOST=&#34;</span>&nbsp;<span class="op" id="4785752">+</span>&nbsp;<span class="ident" id="4785754">req</span><span class="op" id="4785757">.</span><span class="ident" id="4785758">RemoteAddr</span><span class="op" id="4785768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4785772">&#34;SERVER_PORT=&#34;</span>&nbsp;<span class="op" id="4785787">+</span>&nbsp;<span class="ident" id="4785789">port</span><span class="op" id="4785793">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4785796">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4785800">if</span>&nbsp;<span class="ident" id="4785803">req</span><span class="op" id="4785806">.</span><span class="ident" id="4785807">TLS</span>&nbsp;<span class="op" id="4785811">!=</span>&nbsp;<span class="ident" id="4785814">nil</span>&nbsp;<span class="op" id="4785818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785822">env</span>&nbsp;<span class="op" id="4785826">=</span>&nbsp;<span class="builtinfunc" id="4785828">append</span><span class="op" id="4785834">(</span><span class="ident" id="4785835">env</span><span class="op" id="4785838">,</span>&nbsp;<span class="string" id="4785840">&#34;HTTPS=on&#34;</span><span class="op" id="4785850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4785853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4785857">for</span>&nbsp;<span class="ident" id="4785861">k</span><span class="op" id="4785862">,</span>&nbsp;<span class="ident" id="4785864">v</span>&nbsp;<span class="op" id="4785866">:=</span>&nbsp;<span class="keyword" id="4785869">range</span>&nbsp;<span class="ident" id="4785875">req</span><span class="op" id="4785878">.</span><span class="ident" id="4785879">Header</span>&nbsp;<span class="op" id="4785886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785890">k</span>&nbsp;<span class="op" id="4785892">=</span>&nbsp;<span class="ident" id="4785894">strings</span><span class="op" id="4785901">.</span><span class="ident" id="4785902">Map</span><span class="op" id="4785905">(</span><span class="ident" id="4785906">upperCaseAndUnderscore</span><span class="op" id="4785928">,</span>&nbsp;<span class="ident" id="4785930">k</span><span class="op" id="4785931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785935">joinStr</span>&nbsp;<span class="op" id="4785943">:=</span>&nbsp;<span class="string" id="4785946">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4785953">if</span>&nbsp;<span class="ident" id="4785956">k</span>&nbsp;<span class="op" id="4785958">==</span>&nbsp;<span class="string" id="4785961">&#34;COOKIE&#34;</span>&nbsp;<span class="op" id="4785970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785975">joinStr</span>&nbsp;<span class="op" id="4785983">=</span>&nbsp;<span class="string" id="4785985">&#34;;&nbsp;&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4785992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4785996">env</span>&nbsp;<span class="op" id="4786000">=</span>&nbsp;<span class="builtinfunc" id="4786002">append</span><span class="op" id="4786008">(</span><span class="ident" id="4786009">env</span><span class="op" id="4786012">,</span>&nbsp;<span class="string" id="4786014">&#34;HTTP_&#34;</span><span class="op" id="4786021">+</span><span class="ident" id="4786022">k</span><span class="op" id="4786023">+</span><span class="string" id="4786024">&#34;=&#34;</span><span class="op" id="4786027">+</span><span class="ident" id="4786028">strings</span><span class="op" id="4786035">.</span><span class="ident" id="4786036">Join</span><span class="op" id="4786040">(</span><span class="ident" id="4786041">v</span><span class="op" id="4786042">,</span>&nbsp;<span class="ident" id="4786044">joinStr</span><span class="op" id="4786051">)</span><span class="op" id="4786052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786059">if</span>&nbsp;<span class="ident" id="4786062">req</span><span class="op" id="4786065">.</span><span class="ident" id="4786066">ContentLength</span>&nbsp;<span class="op" id="4786080">&gt;</span>&nbsp;<span class="num" id="4786082">0</span>&nbsp;<span class="op" id="4786084">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786088">env</span>&nbsp;<span class="op" id="4786092">=</span>&nbsp;<span class="builtinfunc" id="4786094">append</span><span class="op" id="4786100">(</span><span class="ident" id="4786101">env</span><span class="op" id="4786104">,</span>&nbsp;<span class="ident" id="4786106">fmt</span><span class="op" id="4786109">.</span><span class="ident" id="4786110">Sprintf</span><span class="op" id="4786117">(</span><span class="string" id="4786118">&#34;CONTENT_LENGTH=%d&#34;</span><span class="op" id="4786137">,</span>&nbsp;<span class="ident" id="4786139">req</span><span class="op" id="4786142">.</span><span class="ident" id="4786143">ContentLength</span><span class="op" id="4786156">)</span><span class="op" id="4786157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786163">if</span>&nbsp;<span class="ident" id="4786166">ctype</span>&nbsp;<span class="op" id="4786172">:=</span>&nbsp;<span class="ident" id="4786175">req</span><span class="op" id="4786178">.</span><span class="ident" id="4786179">Header</span><span class="op" id="4786185">.</span><span class="ident" id="4786186">Get</span><span class="op" id="4786189">(</span><span class="string" id="4786190">&#34;Content-Type&#34;</span><span class="op" id="4786204">)</span><span class="op" id="4786205">;</span>&nbsp;<span class="ident" id="4786207">ctype</span>&nbsp;<span class="op" id="4786213">!=</span>&nbsp;<span class="string" id="4786216">&#34;&#34;</span>&nbsp;<span class="op" id="4786219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786223">env</span>&nbsp;<span class="op" id="4786227">=</span>&nbsp;<span class="builtinfunc" id="4786229">append</span><span class="op" id="4786235">(</span><span class="ident" id="4786236">env</span><span class="op" id="4786239">,</span>&nbsp;<span class="string" id="4786241">&#34;CONTENT_TYPE=&#34;</span><span class="op" id="4786256">+</span><span class="ident" id="4786257">ctype</span><span class="op" id="4786262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786265">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786269">if</span>&nbsp;<span class="ident" id="4786272">h</span><span class="op" id="4786273">.</span><span class="ident" id="4786274">Env</span>&nbsp;<span class="op" id="4786278">!=</span>&nbsp;<span class="ident" id="4786281">nil</span>&nbsp;<span class="op" id="4786285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786289">env</span>&nbsp;<span class="op" id="4786293">=</span>&nbsp;<span class="builtinfunc" id="4786295">append</span><span class="op" id="4786301">(</span><span class="ident" id="4786302">env</span><span class="op" id="4786305">,</span>&nbsp;<span class="ident" id="4786307">h</span><span class="op" id="4786308">.</span><span class="ident" id="4786309">Env</span><span class="op" id="4786312">...</span><span class="op" id="4786315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786322">envPath</span>&nbsp;<span class="op" id="4786330">:=</span>&nbsp;<span class="ident" id="4786333">os</span><span class="op" id="4786335">.</span><span class="ident" id="4786336">Getenv</span><span class="op" id="4786342">(</span><span class="string" id="4786343">&#34;PATH&#34;</span><span class="op" id="4786349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786352">if</span>&nbsp;<span class="ident" id="4786355">envPath</span>&nbsp;<span class="op" id="4786363">==</span>&nbsp;<span class="string" id="4786366">&#34;&#34;</span>&nbsp;<span class="op" id="4786369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786373">envPath</span>&nbsp;<span class="op" id="4786381">=</span>&nbsp;<span class="string" id="4786383">&#34;/bin:/usr/bin:/usr/ucb:/usr/bsd:/usr/local/bin&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786436">env</span>&nbsp;<span class="op" id="4786440">=</span>&nbsp;<span class="builtinfunc" id="4786442">append</span><span class="op" id="4786448">(</span><span class="ident" id="4786449">env</span><span class="op" id="4786452">,</span>&nbsp;<span class="string" id="4786454">&#34;PATH=&#34;</span><span class="op" id="4786461">+</span><span class="ident" id="4786462">envPath</span><span class="op" id="4786469">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786473">for</span>&nbsp;<span class="ident" id="4786477">_</span><span class="op" id="4786478">,</span>&nbsp;<span class="ident" id="4786480">e</span>&nbsp;<span class="op" id="4786482">:=</span>&nbsp;<span class="keyword" id="4786485">range</span>&nbsp;<span class="ident" id="4786491">h</span><span class="op" id="4786492">.</span><span class="ident" id="4786493">InheritEnv</span>&nbsp;<span class="op" id="4786504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786508">if</span>&nbsp;<span class="ident" id="4786511">v</span>&nbsp;<span class="op" id="4786513">:=</span>&nbsp;<span class="ident" id="4786516">os</span><span class="op" id="4786518">.</span><span class="ident" id="4786519">Getenv</span><span class="op" id="4786525">(</span><span class="ident" id="4786526">e</span><span class="op" id="4786527">)</span><span class="op" id="4786528">;</span>&nbsp;<span class="ident" id="4786530">v</span>&nbsp;<span class="op" id="4786532">!=</span>&nbsp;<span class="string" id="4786535">&#34;&#34;</span>&nbsp;<span class="op" id="4786538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786543">env</span>&nbsp;<span class="op" id="4786547">=</span>&nbsp;<span class="builtinfunc" id="4786549">append</span><span class="op" id="4786555">(</span><span class="ident" id="4786556">env</span><span class="op" id="4786559">,</span>&nbsp;<span class="ident" id="4786561">e</span><span class="op" id="4786562">+</span><span class="string" id="4786563">&#34;=&#34;</span><span class="op" id="4786566">+</span><span class="ident" id="4786567">v</span><span class="op" id="4786568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786572">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786579">for</span>&nbsp;<span class="ident" id="4786583">_</span><span class="op" id="4786584">,</span>&nbsp;<span class="ident" id="4786586">e</span>&nbsp;<span class="op" id="4786588">:=</span>&nbsp;<span class="keyword" id="4786591">range</span>&nbsp;<span class="ident" id="4786597">osDefaultInheritEnv</span><span class="op" id="4786616">[</span><span class="ident" id="4786617">runtime</span><span class="op" id="4786624">.</span><span class="ident" id="4786625">GOOS</span><span class="op" id="4786629">]</span>&nbsp;<span class="op" id="4786631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786635">if</span>&nbsp;<span class="ident" id="4786638">v</span>&nbsp;<span class="op" id="4786640">:=</span>&nbsp;<span class="ident" id="4786643">os</span><span class="op" id="4786645">.</span><span class="ident" id="4786646">Getenv</span><span class="op" id="4786652">(</span><span class="ident" id="4786653">e</span><span class="op" id="4786654">)</span><span class="op" id="4786655">;</span>&nbsp;<span class="ident" id="4786657">v</span>&nbsp;<span class="op" id="4786659">!=</span>&nbsp;<span class="string" id="4786662">&#34;&#34;</span>&nbsp;<span class="op" id="4786665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786670">env</span>&nbsp;<span class="op" id="4786674">=</span>&nbsp;<span class="builtinfunc" id="4786676">append</span><span class="op" id="4786682">(</span><span class="ident" id="4786683">env</span><span class="op" id="4786686">,</span>&nbsp;<span class="ident" id="4786688">e</span><span class="op" id="4786689">+</span><span class="string" id="4786690">&#34;=&#34;</span><span class="op" id="4786693">+</span><span class="ident" id="4786694">v</span><span class="op" id="4786695">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786706">env</span>&nbsp;<span class="op" id="4786710">=</span>&nbsp;<span class="ident" id="4786712">removeLeadingDuplicates</span><span class="op" id="4786735">(</span><span class="ident" id="4786736">env</span><span class="op" id="4786739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786743">var</span>&nbsp;<span class="ident" id="4786747">cwd</span><span class="op" id="4786750">,</span>&nbsp;<span class="ident" id="4786752">path</span>&nbsp;<span class="builtintype" id="4786757">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786765">if</span>&nbsp;<span class="ident" id="4786768">h</span><span class="op" id="4786769">.</span><span class="ident" id="4786770">Dir</span>&nbsp;<span class="op" id="4786774">!=</span>&nbsp;<span class="string" id="4786777">&#34;&#34;</span>&nbsp;<span class="op" id="4786780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786784">path</span>&nbsp;<span class="op" id="4786789">=</span>&nbsp;<span class="ident" id="4786791">h</span><span class="op" id="4786792">.</span><span class="ident" id="4786793">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786800">cwd</span>&nbsp;<span class="op" id="4786804">=</span>&nbsp;<span class="ident" id="4786806">h</span><span class="op" id="4786807">.</span><span class="ident" id="4786808">Dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786813">}</span>&nbsp;<span class="keyword" id="4786815">else</span>&nbsp;<span class="op" id="4786820">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786824">cwd</span><span class="op" id="4786827">,</span>&nbsp;<span class="ident" id="4786829">path</span>&nbsp;<span class="op" id="4786834">=</span>&nbsp;<span class="ident" id="4786836">filepath</span><span class="op" id="4786844">.</span><span class="ident" id="4786845">Split</span><span class="op" id="4786850">(</span><span class="ident" id="4786851">h</span><span class="op" id="4786852">.</span><span class="ident" id="4786853">Path</span><span class="op" id="4786857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4786863">if</span>&nbsp;<span class="ident" id="4786866">cwd</span>&nbsp;<span class="op" id="4786870">==</span>&nbsp;<span class="string" id="4786873">&#34;&#34;</span>&nbsp;<span class="op" id="4786876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786880">cwd</span>&nbsp;<span class="op" id="4786884">=</span>&nbsp;<span class="string" id="4786886">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4786891">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786895">internalError</span>&nbsp;<span class="op" id="4786909">:=</span>&nbsp;<span class="keyword" id="4786912">func</span><span class="op" id="4786916">(</span><span class="ident" id="4786917">err</span>&nbsp;<span class="builtintype" id="4786921">error</span><span class="op" id="4786926">)</span>&nbsp;<span class="op" id="4786928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786932">rw</span><span class="op" id="4786934">.</span><span class="ident" id="4786935">WriteHeader</span><span class="op" id="4786946">(</span><span class="ident" id="4786947">http</span><span class="op" id="4786951">.</span><span class="ident" id="4786952">StatusInternalServerError</span><span class="op" id="4786977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4786981">h</span><span class="op" id="4786982">.</span><span class="ident" id="4786983">printf</span><span class="op" id="4786989">(</span><span class="string" id="4786990">&#34;CGI&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="4787005">,</span>&nbsp;<span class="ident" id="4787007">err</span><span class="op" id="4787010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4787013">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787017">cmd</span>&nbsp;<span class="op" id="4787021">:=</span>&nbsp;<span class="op" id="4787024">&amp;</span><span class="ident" id="4787025">exec</span><span class="op" id="4787029">.</span><span class="ident" id="4787030">Cmd</span><span class="op" id="4787033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787037">Path</span><span class="op" id="4787041">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4787045">path</span><span class="op" id="4787049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787053">Args</span><span class="op" id="4787057">:</span>&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4787061">append</span><span class="op" id="4787067">(</span><span class="op" id="4787068">[</span><span class="op" id="4787069">]</span><span class="builtintype" id="4787070">string</span><span class="op" id="4787076">{</span><span class="ident" id="4787077">h</span><span class="op" id="4787078">.</span><span class="ident" id="4787079">Path</span><span class="op" id="4787083">}</span><span class="op" id="4787084">,</span>&nbsp;<span class="ident" id="4787086">h</span><span class="op" id="4787087">.</span><span class="ident" id="4787088">Args</span><span class="op" id="4787092">...</span><span class="op" id="4787095">)</span><span class="op" id="4787096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787100">Dir</span><span class="op" id="4787103">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4787108">cwd</span><span class="op" id="4787111">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787115">Env</span><span class="op" id="4787118">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4787123">env</span><span class="op" id="4787126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787130">Stderr</span><span class="op" id="4787136">:</span>&nbsp;<span class="ident" id="4787138">os</span><span class="op" id="4787140">.</span><span class="ident" id="4787141">Stderr</span><span class="op" id="4787147">,</span>&nbsp;<span class="comment" id="4787149">//&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4787161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787164">if</span>&nbsp;<span class="ident" id="4787167">req</span><span class="op" id="4787170">.</span><span class="ident" id="4787171">ContentLength</span>&nbsp;<span class="op" id="4787185">!=</span>&nbsp;<span class="num" id="4787188">0</span>&nbsp;<span class="op" id="4787190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787194">cmd</span><span class="op" id="4787197">.</span><span class="ident" id="4787198">Stdin</span>&nbsp;<span class="op" id="4787204">=</span>&nbsp;<span class="ident" id="4787206">req</span><span class="op" id="4787209">.</span><span class="ident" id="4787210">Body</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4787216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787219">stdoutRead</span><span class="op" id="4787229">,</span>&nbsp;<span class="ident" id="4787231">err</span>&nbsp;<span class="op" id="4787235">:=</span>&nbsp;<span class="ident" id="4787238">cmd</span><span class="op" id="4787241">.</span><span class="ident" id="4787242">StdoutPipe</span><span class="op" id="4787252">(</span><span class="op" id="4787253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787256">if</span>&nbsp;<span class="ident" id="4787259">err</span>&nbsp;<span class="op" id="4787263">!=</span>&nbsp;<span class="ident" id="4787266">nil</span>&nbsp;<span class="op" id="4787270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787274">internalError</span><span class="op" id="4787287">(</span><span class="ident" id="4787288">err</span><span class="op" id="4787291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787295">return</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4787303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787307">err</span>&nbsp;<span class="op" id="4787311">=</span>&nbsp;<span class="ident" id="4787313">cmd</span><span class="op" id="4787316">.</span><span class="ident" id="4787317">Start</span><span class="op" id="4787322">(</span><span class="op" id="4787323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787326">if</span>&nbsp;<span class="ident" id="4787329">err</span>&nbsp;<span class="op" id="4787333">!=</span>&nbsp;<span class="ident" id="4787336">nil</span>&nbsp;<span class="op" id="4787340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787344">internalError</span><span class="op" id="4787357">(</span><span class="ident" id="4787358">err</span><span class="op" id="4787361">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787365">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4787373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787376">if</span>&nbsp;<span class="ident" id="4787379">hook</span>&nbsp;<span class="op" id="4787384">:=</span>&nbsp;<span class="ident" id="4787387">testHookStartProcess</span><span class="op" id="4787407">;</span>&nbsp;<span class="ident" id="4787409">hook</span>&nbsp;<span class="op" id="4787414">!=</span>&nbsp;<span class="ident" id="4787417">nil</span>&nbsp;<span class="op" id="4787421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787425">hook</span><span class="op" id="4787429">(</span><span class="ident" id="4787430">cmd</span><span class="op" id="4787433">.</span><span class="ident" id="4787434">Process</span><span class="op" id="4787441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4787444">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787447">defer</span>&nbsp;<span class="ident" id="4787453">cmd</span><span class="op" id="4787456">.</span><span class="ident" id="4787457">Wait</span><span class="op" id="4787461">(</span><span class="op" id="4787462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787465">defer</span>&nbsp;<span class="ident" id="4787471">stdoutRead</span><span class="op" id="4787481">.</span><span class="ident" id="4787482">Close</span><span class="op" id="4787487">(</span><span class="op" id="4787488">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787492">linebody</span>&nbsp;<span class="op" id="4787501">:=</span>&nbsp;<span class="ident" id="4787504">bufio</span><span class="op" id="4787509">.</span><span class="ident" id="4787510">NewReaderSize</span><span class="op" id="4787523">(</span><span class="ident" id="4787524">stdoutRead</span><span class="op" id="4787534">,</span>&nbsp;<span class="num" id="4787536">1024</span><span class="op" id="4787540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787543">headers</span>&nbsp;<span class="op" id="4787551">:=</span>&nbsp;<span class="builtinfunc" id="4787554">make</span><span class="op" id="4787558">(</span><span class="ident" id="4787559">http</span><span class="op" id="4787563">.</span><span class="ident" id="4787564">Header</span><span class="op" id="4787570">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787573">statusCode</span>&nbsp;<span class="op" id="4787584">:=</span>&nbsp;<span class="num" id="4787587">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787590">headerLines</span>&nbsp;<span class="op" id="4787602">:=</span>&nbsp;<span class="num" id="4787605">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787608">sawBlankLine</span>&nbsp;<span class="op" id="4787621">:=</span>&nbsp;<span class="builtintype" id="4787624">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787631">for</span>&nbsp;<span class="op" id="4787635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787639">line</span><span class="op" id="4787643">,</span>&nbsp;<span class="ident" id="4787645">isPrefix</span><span class="op" id="4787653">,</span>&nbsp;<span class="ident" id="4787655">err</span>&nbsp;<span class="op" id="4787659">:=</span>&nbsp;<span class="ident" id="4787662">linebody</span><span class="op" id="4787670">.</span><span class="ident" id="4787671">ReadLine</span><span class="op" id="4787679">(</span><span class="op" id="4787680">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787684">if</span>&nbsp;<span class="ident" id="4787687">isPrefix</span>&nbsp;<span class="op" id="4787696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787701">rw</span><span class="op" id="4787703">.</span><span class="ident" id="4787704">WriteHeader</span><span class="op" id="4787715">(</span><span class="ident" id="4787716">http</span><span class="op" id="4787720">.</span><span class="ident" id="4787721">StatusInternalServerError</span><span class="op" id="4787746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787751">h</span><span class="op" id="4787752">.</span><span class="ident" id="4787753">printf</span><span class="op" id="4787759">(</span><span class="string" id="4787760">&#34;cgi:&nbsp;long&nbsp;header&nbsp;line&nbsp;from&nbsp;subprocess.&#34;</span><span class="op" id="4787800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787805">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4787814">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787818">if</span>&nbsp;<span class="ident" id="4787821">err</span>&nbsp;<span class="op" id="4787825">==</span>&nbsp;<span class="ident" id="4787828">io</span><span class="op" id="4787830">.</span><span class="ident" id="4787831">EOF</span>&nbsp;<span class="op" id="4787835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787840">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4787848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787852">if</span>&nbsp;<span class="ident" id="4787855">err</span>&nbsp;<span class="op" id="4787859">!=</span>&nbsp;<span class="ident" id="4787862">nil</span>&nbsp;<span class="op" id="4787866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787871">rw</span><span class="op" id="4787873">.</span><span class="ident" id="4787874">WriteHeader</span><span class="op" id="4787885">(</span><span class="ident" id="4787886">http</span><span class="op" id="4787890">.</span><span class="ident" id="4787891">StatusInternalServerError</span><span class="op" id="4787916">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4787921">h</span><span class="op" id="4787922">.</span><span class="ident" id="4787923">printf</span><span class="op" id="4787929">(</span><span class="string" id="4787930">&#34;cgi:&nbsp;error&nbsp;reading&nbsp;headers:&nbsp;%v&#34;</span><span class="op" id="4787962">,</span>&nbsp;<span class="ident" id="4787964">err</span><span class="op" id="4787967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787972">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4787981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4787985">if</span>&nbsp;<span class="builtinfunc" id="4787988">len</span><span class="op" id="4787991">(</span><span class="ident" id="4787992">line</span><span class="op" id="4787996">)</span>&nbsp;<span class="op" id="4787998">==</span>&nbsp;<span class="num" id="4788001">0</span>&nbsp;<span class="op" id="4788003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788008">sawBlankLine</span>&nbsp;<span class="op" id="4788021">=</span>&nbsp;<span class="builtintype" id="4788023">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788031">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4788039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788043">headerLines</span><span class="op" id="4788054">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788059">parts</span>&nbsp;<span class="op" id="4788065">:=</span>&nbsp;<span class="ident" id="4788068">strings</span><span class="op" id="4788075">.</span><span class="ident" id="4788076">SplitN</span><span class="op" id="4788082">(</span><span class="builtintype" id="4788083">string</span><span class="op" id="4788089">(</span><span class="ident" id="4788090">line</span><span class="op" id="4788094">)</span><span class="op" id="4788095">,</span>&nbsp;<span class="string" id="4788097">&#34;:&#34;</span><span class="op" id="4788100">,</span>&nbsp;<span class="num" id="4788102">2</span><span class="op" id="4788103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788107">if</span>&nbsp;<span class="builtinfunc" id="4788110">len</span><span class="op" id="4788113">(</span><span class="ident" id="4788114">parts</span><span class="op" id="4788119">)</span>&nbsp;<span class="op" id="4788121">&lt;</span>&nbsp;<span class="num" id="4788123">2</span>&nbsp;<span class="op" id="4788125">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788130">h</span><span class="op" id="4788131">.</span><span class="ident" id="4788132">printf</span><span class="op" id="4788138">(</span><span class="string" id="4788139">&#34;cgi:&nbsp;bogus&nbsp;header&nbsp;line:&nbsp;%s&#34;</span><span class="op" id="4788167">,</span>&nbsp;<span class="builtintype" id="4788169">string</span><span class="op" id="4788175">(</span><span class="ident" id="4788176">line</span><span class="op" id="4788180">)</span><span class="op" id="4788181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788186">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4788197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788201">header</span><span class="op" id="4788207">,</span>&nbsp;<span class="ident" id="4788209">val</span>&nbsp;<span class="op" id="4788213">:=</span>&nbsp;<span class="ident" id="4788216">parts</span><span class="op" id="4788221">[</span><span class="num" id="4788222">0</span><span class="op" id="4788223">]</span><span class="op" id="4788224">,</span>&nbsp;<span class="ident" id="4788226">parts</span><span class="op" id="4788231">[</span><span class="num" id="4788232">1</span><span class="op" id="4788233">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788237">header</span>&nbsp;<span class="op" id="4788244">=</span>&nbsp;<span class="ident" id="4788246">strings</span><span class="op" id="4788253">.</span><span class="ident" id="4788254">TrimSpace</span><span class="op" id="4788263">(</span><span class="ident" id="4788264">header</span><span class="op" id="4788270">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788274">val</span>&nbsp;<span class="op" id="4788278">=</span>&nbsp;<span class="ident" id="4788280">strings</span><span class="op" id="4788287">.</span><span class="ident" id="4788288">TrimSpace</span><span class="op" id="4788297">(</span><span class="ident" id="4788298">val</span><span class="op" id="4788301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788305">switch</span>&nbsp;<span class="op" id="4788312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788316">case</span>&nbsp;<span class="ident" id="4788321">header</span>&nbsp;<span class="op" id="4788328">==</span>&nbsp;<span class="string" id="4788331">&#34;Status&#34;</span><span class="op" id="4788339">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788344">if</span>&nbsp;<span class="builtinfunc" id="4788347">len</span><span class="op" id="4788350">(</span><span class="ident" id="4788351">val</span><span class="op" id="4788354">)</span>&nbsp;<span class="op" id="4788356">&lt;</span>&nbsp;<span class="num" id="4788358">3</span>&nbsp;<span class="op" id="4788360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788366">h</span><span class="op" id="4788367">.</span><span class="ident" id="4788368">printf</span><span class="op" id="4788374">(</span><span class="string" id="4788375">&#34;cgi:&nbsp;bogus&nbsp;status&nbsp;(short):&nbsp;%q&#34;</span><span class="op" id="4788406">,</span>&nbsp;<span class="ident" id="4788408">val</span><span class="op" id="4788411">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788417">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4788427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788432">code</span><span class="op" id="4788436">,</span>&nbsp;<span class="ident" id="4788438">err</span>&nbsp;<span class="op" id="4788442">:=</span>&nbsp;<span class="ident" id="4788445">strconv</span><span class="op" id="4788452">.</span><span class="ident" id="4788453">Atoi</span><span class="op" id="4788457">(</span><span class="ident" id="4788458">val</span><span class="op" id="4788461">[</span><span class="num" id="4788462">0</span><span class="op" id="4788463">:</span><span class="num" id="4788464">3</span><span class="op" id="4788465">]</span><span class="op" id="4788466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788471">if</span>&nbsp;<span class="ident" id="4788474">err</span>&nbsp;<span class="op" id="4788478">!=</span>&nbsp;<span class="ident" id="4788481">nil</span>&nbsp;<span class="op" id="4788485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788491">h</span><span class="op" id="4788492">.</span><span class="ident" id="4788493">printf</span><span class="op" id="4788499">(</span><span class="string" id="4788500">&#34;cgi:&nbsp;bogus&nbsp;status:&nbsp;%q&#34;</span><span class="op" id="4788523">,</span>&nbsp;<span class="ident" id="4788525">val</span><span class="op" id="4788528">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788534">h</span><span class="op" id="4788535">.</span><span class="ident" id="4788536">printf</span><span class="op" id="4788542">(</span><span class="string" id="4788543">&#34;cgi:&nbsp;line&nbsp;was&nbsp;%q&#34;</span><span class="op" id="4788561">,</span>&nbsp;<span class="ident" id="4788563">line</span><span class="op" id="4788567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788573">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4788583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788588">statusCode</span>&nbsp;<span class="op" id="4788599">=</span>&nbsp;<span class="ident" id="4788601">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788608">default</span><span class="op" id="4788615">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788620">headers</span><span class="op" id="4788627">.</span><span class="ident" id="4788628">Add</span><span class="op" id="4788631">(</span><span class="ident" id="4788632">header</span><span class="op" id="4788638">,</span>&nbsp;<span class="ident" id="4788640">val</span><span class="op" id="4788643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4788647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4788650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788653">if</span>&nbsp;<span class="ident" id="4788656">headerLines</span>&nbsp;<span class="op" id="4788668">==</span>&nbsp;<span class="num" id="4788671">0</span>&nbsp;<span class="op" id="4788673">||</span>&nbsp;<span class="op" id="4788676">!</span><span class="ident" id="4788677">sawBlankLine</span>&nbsp;<span class="op" id="4788690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788694">rw</span><span class="op" id="4788696">.</span><span class="ident" id="4788697">WriteHeader</span><span class="op" id="4788708">(</span><span class="ident" id="4788709">http</span><span class="op" id="4788713">.</span><span class="ident" id="4788714">StatusInternalServerError</span><span class="op" id="4788739">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788743">h</span><span class="op" id="4788744">.</span><span class="ident" id="4788745">printf</span><span class="op" id="4788751">(</span><span class="string" id="4788752">&#34;cgi:&nbsp;no&nbsp;headers&#34;</span><span class="op" id="4788769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788773">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4788781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788785">if</span>&nbsp;<span class="ident" id="4788788">loc</span>&nbsp;<span class="op" id="4788792">:=</span>&nbsp;<span class="ident" id="4788795">headers</span><span class="op" id="4788802">.</span><span class="ident" id="4788803">Get</span><span class="op" id="4788806">(</span><span class="string" id="4788807">&#34;Location&#34;</span><span class="op" id="4788817">)</span><span class="op" id="4788818">;</span>&nbsp;<span class="ident" id="4788820">loc</span>&nbsp;<span class="op" id="4788824">!=</span>&nbsp;<span class="string" id="4788827">&#34;&#34;</span>&nbsp;<span class="op" id="4788830">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788834">if</span>&nbsp;<span class="ident" id="4788837">strings</span><span class="op" id="4788844">.</span><span class="ident" id="4788845">HasPrefix</span><span class="op" id="4788854">(</span><span class="ident" id="4788855">loc</span><span class="op" id="4788858">,</span>&nbsp;<span class="string" id="4788860">&#34;/&#34;</span><span class="op" id="4788863">)</span>&nbsp;<span class="op" id="4788865">&amp;&amp;</span>&nbsp;<span class="ident" id="4788868">h</span><span class="op" id="4788869">.</span><span class="ident" id="4788870">PathLocationHandler</span>&nbsp;<span class="op" id="4788890">!=</span>&nbsp;<span class="ident" id="4788893">nil</span>&nbsp;<span class="op" id="4788897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788902">h</span><span class="op" id="4788903">.</span><span class="ident" id="4788904">handleInternalRedirect</span><span class="op" id="4788926">(</span><span class="ident" id="4788927">rw</span><span class="op" id="4788929">,</span>&nbsp;<span class="ident" id="4788931">req</span><span class="op" id="4788934">,</span>&nbsp;<span class="ident" id="4788936">loc</span><span class="op" id="4788939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788944">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4788953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4788957">if</span>&nbsp;<span class="ident" id="4788960">statusCode</span>&nbsp;<span class="op" id="4788971">==</span>&nbsp;<span class="num" id="4788974">0</span>&nbsp;<span class="op" id="4788976">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4788981">statusCode</span>&nbsp;<span class="op" id="4788992">=</span>&nbsp;<span class="ident" id="4788994">http</span><span class="op" id="4788998">.</span><span class="ident" id="4788999">StatusFound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4789013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4789016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789020">if</span>&nbsp;<span class="ident" id="4789023">statusCode</span>&nbsp;<span class="op" id="4789034">==</span>&nbsp;<span class="num" id="4789037">0</span>&nbsp;<span class="op" id="4789039">&amp;&amp;</span>&nbsp;<span class="ident" id="4789042">headers</span><span class="op" id="4789049">.</span><span class="ident" id="4789050">Get</span><span class="op" id="4789053">(</span><span class="string" id="4789054">&#34;Content-Type&#34;</span><span class="op" id="4789068">)</span>&nbsp;<span class="op" id="4789070">==</span>&nbsp;<span class="string" id="4789073">&#34;&#34;</span>&nbsp;<span class="op" id="4789076">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789080">rw</span><span class="op" id="4789082">.</span><span class="ident" id="4789083">WriteHeader</span><span class="op" id="4789094">(</span><span class="ident" id="4789095">http</span><span class="op" id="4789099">.</span><span class="ident" id="4789100">StatusInternalServerError</span><span class="op" id="4789125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789129">h</span><span class="op" id="4789130">.</span><span class="ident" id="4789131">printf</span><span class="op" id="4789137">(</span><span class="string" id="4789138">&#34;cgi:&nbsp;missing&nbsp;required&nbsp;Content-Type&nbsp;in&nbsp;headers&#34;</span><span class="op" id="4789185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789189">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4789197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789201">if</span>&nbsp;<span class="ident" id="4789204">statusCode</span>&nbsp;<span class="op" id="4789215">==</span>&nbsp;<span class="num" id="4789218">0</span>&nbsp;<span class="op" id="4789220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789224">statusCode</span>&nbsp;<span class="op" id="4789235">=</span>&nbsp;<span class="ident" id="4789237">http</span><span class="op" id="4789241">.</span><span class="ident" id="4789242">StatusOK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4789252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789256">//&nbsp;Copy&nbsp;headers&nbsp;to&nbsp;rw&#39;s&nbsp;headers,&nbsp;after&nbsp;we&#39;ve&nbsp;decided&nbsp;not&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789317">//&nbsp;go&nbsp;into&nbsp;handleInternalRedirect,&nbsp;which&nbsp;won&#39;t&nbsp;want&nbsp;its&nbsp;rw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789377">//&nbsp;headers&nbsp;to&nbsp;have&nbsp;been&nbsp;touched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789411">for</span>&nbsp;<span class="ident" id="4789415">k</span><span class="op" id="4789416">,</span>&nbsp;<span class="ident" id="4789418">vv</span>&nbsp;<span class="op" id="4789421">:=</span>&nbsp;<span class="keyword" id="4789424">range</span>&nbsp;<span class="ident" id="4789430">headers</span>&nbsp;<span class="op" id="4789438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789442">for</span>&nbsp;<span class="ident" id="4789446">_</span><span class="op" id="4789447">,</span>&nbsp;<span class="ident" id="4789449">v</span>&nbsp;<span class="op" id="4789451">:=</span>&nbsp;<span class="keyword" id="4789454">range</span>&nbsp;<span class="ident" id="4789460">vv</span>&nbsp;<span class="op" id="4789463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789468">rw</span><span class="op" id="4789470">.</span><span class="ident" id="4789471">Header</span><span class="op" id="4789477">(</span><span class="op" id="4789478">)</span><span class="op" id="4789479">.</span><span class="ident" id="4789480">Add</span><span class="op" id="4789483">(</span><span class="ident" id="4789484">k</span><span class="op" id="4789485">,</span>&nbsp;<span class="ident" id="4789487">v</span><span class="op" id="4789488">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4789492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4789495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789499">rw</span><span class="op" id="4789501">.</span><span class="ident" id="4789502">WriteHeader</span><span class="op" id="4789513">(</span><span class="ident" id="4789514">statusCode</span><span class="op" id="4789524">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789528">_</span><span class="op" id="4789529">,</span>&nbsp;<span class="ident" id="4789531">err</span>&nbsp;<span class="op" id="4789535">=</span>&nbsp;<span class="ident" id="4789537">io</span><span class="op" id="4789539">.</span><span class="ident" id="4789540">Copy</span><span class="op" id="4789544">(</span><span class="ident" id="4789545">rw</span><span class="op" id="4789547">,</span>&nbsp;<span class="ident" id="4789549">linebody</span><span class="op" id="4789557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4789560">if</span>&nbsp;<span class="ident" id="4789563">err</span>&nbsp;<span class="op" id="4789567">!=</span>&nbsp;<span class="ident" id="4789570">nil</span>&nbsp;<span class="op" id="4789574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789578">h</span><span class="op" id="4789579">.</span><span class="ident" id="4789580">printf</span><span class="op" id="4789586">(</span><span class="string" id="4789587">&#34;cgi:&nbsp;copy&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="4789608">,</span>&nbsp;<span class="ident" id="4789610">err</span><span class="op" id="4789613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789617">//&nbsp;And&nbsp;kill&nbsp;the&nbsp;child&nbsp;CGI&nbsp;process&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;hang&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789673">//&nbsp;the&nbsp;deferred&nbsp;cmd.Wait&nbsp;above&nbsp;if&nbsp;the&nbsp;error&nbsp;was&nbsp;just</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789728">//&nbsp;the&nbsp;client&nbsp;(rw)&nbsp;going&nbsp;away.&nbsp;If&nbsp;it&nbsp;was&nbsp;a&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789784">//&nbsp;(because&nbsp;the&nbsp;child&nbsp;died&nbsp;itself),&nbsp;then&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789837">//&nbsp;kill&nbsp;of&nbsp;an&nbsp;already-dead&nbsp;process&nbsp;is&nbsp;harmless&nbsp;(the&nbsp;PID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4789895">//&nbsp;won&#39;t&nbsp;be&nbsp;reused&nbsp;until&nbsp;the&nbsp;Wait&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4789939">cmd</span><span class="op" id="4789942">.</span><span class="ident" id="4789943">Process</span><span class="op" id="4789950">.</span><span class="ident" id="4789951">Kill</span><span class="op" id="4789955">(</span><span class="op" id="4789956">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4789959">}</span><br>
<span class="lineno"></span><span class="op" id="4789961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4789964">func</span>&nbsp;<span class="op" id="4789969">(</span><span class="ident" id="4789970">h</span>&nbsp;<span class="op" id="4789972">*</span><span class="ident" id="4789973">Handler</span><span class="op" id="4789980">)</span>&nbsp;<span class="ident" id="4789982">printf</span><span class="op" id="4789988">(</span><span class="ident" id="4789989">format</span>&nbsp;<span class="builtintype" id="4789996">string</span><span class="op" id="4790002">,</span>&nbsp;<span class="ident" id="4790004">v</span>&nbsp;<span class="op" id="4790006">...</span><span class="keyword" id="4790009">interface</span><span class="op" id="4790018">{</span><span class="op" id="4790019">}</span><span class="op" id="4790020">)</span>&nbsp;<span class="op" id="4790022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4790025">if</span>&nbsp;<span class="ident" id="4790028">h</span><span class="op" id="4790029">.</span><span class="ident" id="4790030">Logger</span>&nbsp;<span class="op" id="4790037">!=</span>&nbsp;<span class="ident" id="4790040">nil</span>&nbsp;<span class="op" id="4790044">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790048">h</span><span class="op" id="4790049">.</span><span class="ident" id="4790050">Logger</span><span class="op" id="4790056">.</span><span class="ident" id="4790057">Printf</span><span class="op" id="4790063">(</span><span class="ident" id="4790064">format</span><span class="op" id="4790070">,</span>&nbsp;<span class="ident" id="4790072">v</span><span class="op" id="4790073">...</span><span class="op" id="4790076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4790079">}</span>&nbsp;<span class="keyword" id="4790081">else</span>&nbsp;<span class="op" id="4790086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790090">log</span><span class="op" id="4790093">.</span><span class="ident" id="4790094">Printf</span><span class="op" id="4790100">(</span><span class="ident" id="4790101">format</span><span class="op" id="4790107">,</span>&nbsp;<span class="ident" id="4790109">v</span><span class="op" id="4790110">...</span><span class="op" id="4790113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4790116">}</span><br>
<span class="lineno"></span><span class="op" id="4790118">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="4790121">func</span>&nbsp;<span class="op" id="4790126">(</span><span class="ident" id="4790127">h</span>&nbsp;<span class="op" id="4790129">*</span><span class="ident" id="4790130">Handler</span><span class="op" id="4790137">)</span>&nbsp;<span class="ident" id="4790139">handleInternalRedirect</span><span class="op" id="4790161">(</span><span class="ident" id="4790162">rw</span>&nbsp;<span class="ident" id="4790165">http</span><span class="op" id="4790169">.</span><span class="ident" id="4790170">ResponseWriter</span><span class="op" id="4790184">,</span>&nbsp;<span class="ident" id="4790186">req</span>&nbsp;<span class="op" id="4790190">*</span><span class="ident" id="4790191">http</span><span class="op" id="4790195">.</span><span class="ident" id="4790196">Request</span><span class="op" id="4790203">,</span>&nbsp;<span class="ident" id="4790205">path</span>&nbsp;<span class="builtintype" id="4790210">string</span><span class="op" id="4790216">)</span>&nbsp;<span class="op" id="4790218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790221">url</span><span class="op" id="4790224">,</span>&nbsp;<span class="ident" id="4790226">err</span>&nbsp;<span class="op" id="4790230">:=</span>&nbsp;<span class="ident" id="4790233">req</span><span class="op" id="4790236">.</span><span class="ident" id="4790237">URL</span><span class="op" id="4790240">.</span><span class="ident" id="4790241">Parse</span><span class="op" id="4790246">(</span><span class="ident" id="4790247">path</span><span class="op" id="4790251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4790254">if</span>&nbsp;<span class="ident" id="4790257">err</span>&nbsp;<span class="op" id="4790261">!=</span>&nbsp;<span class="ident" id="4790264">nil</span>&nbsp;<span class="op" id="4790268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790272">rw</span><span class="op" id="4790274">.</span><span class="ident" id="4790275">WriteHeader</span><span class="op" id="4790286">(</span><span class="ident" id="4790287">http</span><span class="op" id="4790291">.</span><span class="ident" id="4790292">StatusInternalServerError</span><span class="op" id="4790317">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790321">h</span><span class="op" id="4790322">.</span><span class="ident" id="4790323">printf</span><span class="op" id="4790329">(</span><span class="string" id="4790330">&#34;cgi:&nbsp;error&nbsp;resolving&nbsp;local&nbsp;URI&nbsp;path&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="4790374">,</span>&nbsp;<span class="ident" id="4790376">path</span><span class="op" id="4790380">,</span>&nbsp;<span class="ident" id="4790382">err</span><span class="op" id="4790385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4790389">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4790397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790400">//&nbsp;TODO:&nbsp;RFC&nbsp;3875&nbsp;isn&#39;t&nbsp;clear&nbsp;if&nbsp;only&nbsp;GET&nbsp;is&nbsp;supported,&nbsp;but&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790464">//&nbsp;suggests&nbsp;so:&nbsp;&#34;Note&nbsp;that&nbsp;any&nbsp;message-body&nbsp;attached&nbsp;to&nbsp;the</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790525">//&nbsp;request&nbsp;(such&nbsp;as&nbsp;for&nbsp;a&nbsp;POST&nbsp;request)&nbsp;may&nbsp;not&nbsp;be&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790587">//&nbsp;to&nbsp;the&nbsp;resource&nbsp;that&nbsp;is&nbsp;the&nbsp;target&nbsp;of&nbsp;the&nbsp;redirect.&#34;&nbsp;&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790648">//&nbsp;should&nbsp;do&nbsp;some&nbsp;tests&nbsp;against&nbsp;Apache&nbsp;to&nbsp;see&nbsp;how&nbsp;it&nbsp;handles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790710">//&nbsp;POST,&nbsp;HEAD,&nbsp;etc.&nbsp;Does&nbsp;the&nbsp;internal&nbsp;redirect&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790771">//&nbsp;method&nbsp;or&nbsp;just&nbsp;GET?&nbsp;What&nbsp;about&nbsp;incoming&nbsp;headers?</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790824">//&nbsp;(e.g.&nbsp;Cookies)&nbsp;Which&nbsp;headers,&nbsp;if&nbsp;any,&nbsp;are&nbsp;copied&nbsp;into&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790886">//&nbsp;second&nbsp;request?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790906">newReq</span>&nbsp;<span class="op" id="4790913">:=</span>&nbsp;<span class="op" id="4790916">&amp;</span><span class="ident" id="4790917">http</span><span class="op" id="4790921">.</span><span class="ident" id="4790922">Request</span><span class="op" id="4790929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790933">Method</span><span class="op" id="4790939">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4790945">&#34;GET&#34;</span><span class="op" id="4790950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790954">URL</span><span class="op" id="4790957">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790966">url</span><span class="op" id="4790969">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790973">Proto</span><span class="op" id="4790978">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4790985">&#34;HTTP/1.1&#34;</span><span class="op" id="4790995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790999">ProtoMajor</span><span class="op" id="4791009">:</span>&nbsp;<span class="num" id="4791011">1</span><span class="op" id="4791012">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791016">ProtoMinor</span><span class="op" id="4791026">:</span>&nbsp;<span class="num" id="4791028">1</span><span class="op" id="4791029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791033">Header</span><span class="op" id="4791039">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4791045">make</span><span class="op" id="4791049">(</span><span class="ident" id="4791050">http</span><span class="op" id="4791054">.</span><span class="ident" id="4791055">Header</span><span class="op" id="4791061">)</span><span class="op" id="4791062">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791066">Host</span><span class="op" id="4791070">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791078">url</span><span class="op" id="4791081">.</span><span class="ident" id="4791082">Host</span><span class="op" id="4791086">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791090">RemoteAddr</span><span class="op" id="4791100">:</span>&nbsp;<span class="ident" id="4791102">req</span><span class="op" id="4791105">.</span><span class="ident" id="4791106">RemoteAddr</span><span class="op" id="4791116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791120">TLS</span><span class="op" id="4791123">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4791132">req</span><span class="op" id="4791135">.</span><span class="ident" id="4791136">TLS</span><span class="op" id="4791139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4791142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791145">h</span><span class="op" id="4791146">.</span><span class="ident" id="4791147">PathLocationHandler</span><span class="op" id="4791166">.</span><span class="ident" id="4791167">ServeHTTP</span><span class="op" id="4791176">(</span><span class="ident" id="4791177">rw</span><span class="op" id="4791179">,</span>&nbsp;<span class="ident" id="4791181">newReq</span><span class="op" id="4791187">)</span><br>
<span class="lineno"></span><span class="op" id="4791189">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="4791192">func</span>&nbsp;<span class="ident" id="4791197">upperCaseAndUnderscore</span><span class="op" id="4791219">(</span><span class="ident" id="4791220">r</span>&nbsp;<span class="builtintype" id="4791222">rune</span><span class="op" id="4791226">)</span>&nbsp;<span class="builtintype" id="4791228">rune</span>&nbsp;<span class="op" id="4791233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791236">switch</span>&nbsp;<span class="op" id="4791243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791246">case</span>&nbsp;<span class="ident" id="4791251">r</span>&nbsp;<span class="op" id="4791253">&gt;=</span>&nbsp;<span class="string" id="4791256">&#39;a&#39;</span>&nbsp;<span class="op" id="4791260">&amp;&amp;</span>&nbsp;<span class="ident" id="4791263">r</span>&nbsp;<span class="op" id="4791265">&lt;=</span>&nbsp;<span class="string" id="4791268">&#39;z&#39;</span><span class="op" id="4791271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791275">return</span>&nbsp;<span class="ident" id="4791282">r</span>&nbsp;<span class="op" id="4791284">-</span>&nbsp;<span class="op" id="4791286">(</span><span class="string" id="4791287">&#39;a&#39;</span>&nbsp;<span class="op" id="4791291">-</span>&nbsp;<span class="string" id="4791293">&#39;A&#39;</span><span class="op" id="4791296">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791299">case</span>&nbsp;<span class="ident" id="4791304">r</span>&nbsp;<span class="op" id="4791306">==</span>&nbsp;<span class="string" id="4791309">&#39;-&#39;</span><span class="op" id="4791312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791316">return</span>&nbsp;<span class="string" id="4791323">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791328">case</span>&nbsp;<span class="ident" id="4791333">r</span>&nbsp;<span class="op" id="4791335">==</span>&nbsp;<span class="string" id="4791338">&#39;=&#39;</span><span class="op" id="4791341">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791345">//&nbsp;Maybe&nbsp;not&nbsp;part&nbsp;of&nbsp;the&nbsp;CGI&nbsp;&#39;spec&#39;&nbsp;but&nbsp;would&nbsp;mess&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791401">//&nbsp;the&nbsp;environment&nbsp;in&nbsp;any&nbsp;case,&nbsp;as&nbsp;Go&nbsp;represents&nbsp;the</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791456">//&nbsp;environment&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;&#34;key=value&#34;&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791508">return</span>&nbsp;<span class="string" id="4791515">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4791520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791523">//&nbsp;TODO:&nbsp;other&nbsp;transformations&nbsp;in&nbsp;spec&nbsp;or&nbsp;practice?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791576">return</span>&nbsp;<span class="ident" id="4791583">r</span><br>
<span class="lineno">375</span><span class="op" id="4791585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4791588">var</span>&nbsp;<span class="ident" id="4791592">testHookStartProcess</span>&nbsp;<span class="keyword" id="4791613">func</span><span class="op" id="4791617">(</span><span class="op" id="4791618">*</span><span class="ident" id="4791619">os</span><span class="op" id="4791621">.</span><span class="ident" id="4791622">Process</span><span class="op" id="4791629">)</span>&nbsp;<span class="comment" id="4791631">//&nbsp;nil&nbsp;except&nbsp;for&nbsp;some&nbsp;tests</span>
</div>
</body>
</html>
