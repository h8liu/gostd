<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html" class="current">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8201108">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8201163">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8201217">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8201268">package</span>&nbsp;<span class="ident" id="8201276">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8201283">import</span>&nbsp;<span class="op" id="8201290">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8201293">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8201302">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8201318">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8201325">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8201335">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8201338">//&nbsp;equal&nbsp;returns&nbsp;nil&nbsp;if&nbsp;p&nbsp;and&nbsp;q&nbsp;describe&nbsp;the&nbsp;same&nbsp;file&nbsp;set;</span><br>
<span class="lineno">15</span><span class="comment" id="8201398">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;discrepancy.</span><br>
<span class="lineno"></span><span class="keyword" id="8201459">func</span>&nbsp;<span class="ident" id="8201464">equal</span><span class="op" id="8201469">(</span><span class="ident" id="8201470">p</span><span class="op" id="8201471">,</span>&nbsp;<span class="ident" id="8201473">q</span>&nbsp;<span class="op" id="8201475">*</span><span class="ident" id="8201476">FileSet</span><span class="op" id="8201483">)</span>&nbsp;<span class="builtintype" id="8201485">error</span>&nbsp;<span class="op" id="8201491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8201494">if</span>&nbsp;<span class="ident" id="8201497">p</span>&nbsp;<span class="op" id="8201499">==</span>&nbsp;<span class="ident" id="8201502">q</span>&nbsp;<span class="op" id="8201504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8201508">//&nbsp;avoid&nbsp;deadlock&nbsp;if&nbsp;p&nbsp;==&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8201538">return</span>&nbsp;<span class="builtintype" id="8201545">nil</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8201550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8201554">//&nbsp;not&nbsp;strictly&nbsp;needed&nbsp;for&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8201591">p</span><span class="op" id="8201592">.</span><span class="ident" id="8201593">mutex</span><span class="op" id="8201598">.</span><span class="ident" id="8201599">Lock</span><span class="op" id="8201603">(</span><span class="op" id="8201604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8201607">q</span><span class="op" id="8201608">.</span><span class="ident" id="8201609">mutex</span><span class="op" id="8201614">.</span><span class="ident" id="8201615">Lock</span><span class="op" id="8201619">(</span><span class="op" id="8201620">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8201623">defer</span>&nbsp;<span class="ident" id="8201629">q</span><span class="op" id="8201630">.</span><span class="ident" id="8201631">mutex</span><span class="op" id="8201636">.</span><span class="ident" id="8201637">Unlock</span><span class="op" id="8201643">(</span><span class="op" id="8201644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8201647">defer</span>&nbsp;<span class="ident" id="8201653">p</span><span class="op" id="8201654">.</span><span class="ident" id="8201655">mutex</span><span class="op" id="8201660">.</span><span class="ident" id="8201661">Unlock</span><span class="op" id="8201667">(</span><span class="op" id="8201668">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8201672">if</span>&nbsp;<span class="ident" id="8201675">p</span><span class="op" id="8201676">.</span><span class="ident" id="8201677">base</span>&nbsp;<span class="op" id="8201682">!=</span>&nbsp;<span class="ident" id="8201685">q</span><span class="op" id="8201686">.</span><span class="ident" id="8201687">base</span>&nbsp;<span class="op" id="8201692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8201696">return</span>&nbsp;<span class="ident" id="8201703">fmt</span><span class="op" id="8201706">.</span><span class="ident" id="8201707">Errorf</span><span class="op" id="8201713">(</span><span class="string" id="8201714">&#34;different&nbsp;bases:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="8201741">,</span>&nbsp;<span class="ident" id="8201743">p</span><span class="op" id="8201744">.</span><span class="ident" id="8201745">base</span><span class="op" id="8201749">,</span>&nbsp;<span class="ident" id="8201751">q</span><span class="op" id="8201752">.</span><span class="ident" id="8201753">base</span><span class="op" id="8201757">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8201760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8201764">if</span>&nbsp;<span class="builtinfunc" id="8201767">len</span><span class="op" id="8201770">(</span><span class="ident" id="8201771">p</span><span class="op" id="8201772">.</span><span class="ident" id="8201773">files</span><span class="op" id="8201778">)</span>&nbsp;<span class="op" id="8201780">!=</span>&nbsp;<span class="builtinfunc" id="8201783">len</span><span class="op" id="8201786">(</span><span class="ident" id="8201787">q</span><span class="op" id="8201788">.</span><span class="ident" id="8201789">files</span><span class="op" id="8201794">)</span>&nbsp;<span class="op" id="8201796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8201800">return</span>&nbsp;<span class="ident" id="8201807">fmt</span><span class="op" id="8201810">.</span><span class="ident" id="8201811">Errorf</span><span class="op" id="8201817">(</span><span class="string" id="8201818">&#34;different&nbsp;number&nbsp;of&nbsp;files:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="8201855">,</span>&nbsp;<span class="builtinfunc" id="8201857">len</span><span class="op" id="8201860">(</span><span class="ident" id="8201861">p</span><span class="op" id="8201862">.</span><span class="ident" id="8201863">files</span><span class="op" id="8201868">)</span><span class="op" id="8201869">,</span>&nbsp;<span class="builtinfunc" id="8201871">len</span><span class="op" id="8201874">(</span><span class="ident" id="8201875">q</span><span class="op" id="8201876">.</span><span class="ident" id="8201877">files</span><span class="op" id="8201882">)</span><span class="op" id="8201883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8201886">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8201890">for</span>&nbsp;<span class="ident" id="8201894">i</span><span class="op" id="8201895">,</span>&nbsp;<span class="ident" id="8201897">f</span>&nbsp;<span class="op" id="8201899">:=</span>&nbsp;<span class="keyword" id="8201902">range</span>&nbsp;<span class="ident" id="8201908">p</span><span class="op" id="8201909">.</span><span class="ident" id="8201910">files</span>&nbsp;<span class="op" id="8201916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8201920">g</span>&nbsp;<span class="op" id="8201922">:=</span>&nbsp;<span class="ident" id="8201925">q</span><span class="op" id="8201926">.</span><span class="ident" id="8201927">files</span><span class="op" id="8201932">[</span><span class="ident" id="8201933">i</span><span class="op" id="8201934">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8201938">if</span>&nbsp;<span class="ident" id="8201941">f</span><span class="op" id="8201942">.</span><span class="ident" id="8201943">set</span>&nbsp;<span class="op" id="8201947">!=</span>&nbsp;<span class="ident" id="8201950">p</span>&nbsp;<span class="op" id="8201952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8201957">return</span>&nbsp;<span class="ident" id="8201964">fmt</span><span class="op" id="8201967">.</span><span class="ident" id="8201968">Errorf</span><span class="op" id="8201974">(</span><span class="string" id="8201975">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="8201997">,</span>&nbsp;<span class="ident" id="8201999">f</span><span class="op" id="8202000">.</span><span class="ident" id="8202001">name</span><span class="op" id="8202005">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8202009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202013">if</span>&nbsp;<span class="ident" id="8202016">g</span><span class="op" id="8202017">.</span><span class="ident" id="8202018">set</span>&nbsp;<span class="op" id="8202022">!=</span>&nbsp;<span class="ident" id="8202025">q</span>&nbsp;<span class="op" id="8202027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202032">return</span>&nbsp;<span class="ident" id="8202039">fmt</span><span class="op" id="8202042">.</span><span class="ident" id="8202043">Errorf</span><span class="op" id="8202049">(</span><span class="string" id="8202050">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="8202072">,</span>&nbsp;<span class="ident" id="8202074">g</span><span class="op" id="8202075">.</span><span class="ident" id="8202076">name</span><span class="op" id="8202080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8202084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202088">if</span>&nbsp;<span class="ident" id="8202091">f</span><span class="op" id="8202092">.</span><span class="ident" id="8202093">name</span>&nbsp;<span class="op" id="8202098">!=</span>&nbsp;<span class="ident" id="8202101">g</span><span class="op" id="8202102">.</span><span class="ident" id="8202103">name</span>&nbsp;<span class="op" id="8202108">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202113">return</span>&nbsp;<span class="ident" id="8202120">fmt</span><span class="op" id="8202123">.</span><span class="ident" id="8202124">Errorf</span><span class="op" id="8202130">(</span><span class="string" id="8202131">&#34;different&nbsp;filenames:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="8202162">,</span>&nbsp;<span class="ident" id="8202164">f</span><span class="op" id="8202165">.</span><span class="ident" id="8202166">name</span><span class="op" id="8202170">,</span>&nbsp;<span class="ident" id="8202172">g</span><span class="op" id="8202173">.</span><span class="ident" id="8202174">name</span><span class="op" id="8202178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8202182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202186">if</span>&nbsp;<span class="ident" id="8202189">f</span><span class="op" id="8202190">.</span><span class="ident" id="8202191">base</span>&nbsp;<span class="op" id="8202196">!=</span>&nbsp;<span class="ident" id="8202199">g</span><span class="op" id="8202200">.</span><span class="ident" id="8202201">base</span>&nbsp;<span class="op" id="8202206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202211">return</span>&nbsp;<span class="ident" id="8202218">fmt</span><span class="op" id="8202221">.</span><span class="ident" id="8202222">Errorf</span><span class="op" id="8202228">(</span><span class="string" id="8202229">&#34;different&nbsp;base&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="8202262">,</span>&nbsp;<span class="ident" id="8202264">f</span><span class="op" id="8202265">.</span><span class="ident" id="8202266">name</span><span class="op" id="8202270">,</span>&nbsp;<span class="ident" id="8202272">f</span><span class="op" id="8202273">.</span><span class="ident" id="8202274">base</span><span class="op" id="8202278">,</span>&nbsp;<span class="ident" id="8202280">g</span><span class="op" id="8202281">.</span><span class="ident" id="8202282">base</span><span class="op" id="8202286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8202290">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202294">if</span>&nbsp;<span class="ident" id="8202297">f</span><span class="op" id="8202298">.</span><span class="ident" id="8202299">size</span>&nbsp;<span class="op" id="8202304">!=</span>&nbsp;<span class="ident" id="8202307">g</span><span class="op" id="8202308">.</span><span class="ident" id="8202309">size</span>&nbsp;<span class="op" id="8202314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202319">return</span>&nbsp;<span class="ident" id="8202326">fmt</span><span class="op" id="8202329">.</span><span class="ident" id="8202330">Errorf</span><span class="op" id="8202336">(</span><span class="string" id="8202337">&#34;different&nbsp;size&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="8202370">,</span>&nbsp;<span class="ident" id="8202372">f</span><span class="op" id="8202373">.</span><span class="ident" id="8202374">name</span><span class="op" id="8202378">,</span>&nbsp;<span class="ident" id="8202380">f</span><span class="op" id="8202381">.</span><span class="ident" id="8202382">size</span><span class="op" id="8202386">,</span>&nbsp;<span class="ident" id="8202388">g</span><span class="op" id="8202389">.</span><span class="ident" id="8202390">size</span><span class="op" id="8202394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8202398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202402">for</span>&nbsp;<span class="ident" id="8202406">j</span><span class="op" id="8202407">,</span>&nbsp;<span class="ident" id="8202409">l</span>&nbsp;<span class="op" id="8202411">:=</span>&nbsp;<span class="keyword" id="8202414">range</span>&nbsp;<span class="ident" id="8202420">f</span><span class="op" id="8202421">.</span><span class="ident" id="8202422">lines</span>&nbsp;<span class="op" id="8202428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8202433">m</span>&nbsp;<span class="op" id="8202435">:=</span>&nbsp;<span class="ident" id="8202438">g</span><span class="op" id="8202439">.</span><span class="ident" id="8202440">lines</span><span class="op" id="8202445">[</span><span class="ident" id="8202446">j</span><span class="op" id="8202447">]</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202452">if</span>&nbsp;<span class="ident" id="8202455">l</span>&nbsp;<span class="op" id="8202457">!=</span>&nbsp;<span class="ident" id="8202460">m</span>&nbsp;<span class="op" id="8202462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202468">return</span>&nbsp;<span class="ident" id="8202475">fmt</span><span class="op" id="8202478">.</span><span class="ident" id="8202479">Errorf</span><span class="op" id="8202485">(</span><span class="string" id="8202486">&#34;different&nbsp;offsets&nbsp;for&nbsp;%q&#34;</span><span class="op" id="8202512">,</span>&nbsp;<span class="ident" id="8202514">f</span><span class="op" id="8202515">.</span><span class="ident" id="8202516">name</span><span class="op" id="8202520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8202525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8202529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202533">for</span>&nbsp;<span class="ident" id="8202537">j</span><span class="op" id="8202538">,</span>&nbsp;<span class="ident" id="8202540">l</span>&nbsp;<span class="op" id="8202542">:=</span>&nbsp;<span class="keyword" id="8202545">range</span>&nbsp;<span class="ident" id="8202551">f</span><span class="op" id="8202552">.</span><span class="ident" id="8202553">infos</span>&nbsp;<span class="op" id="8202559">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8202564">m</span>&nbsp;<span class="op" id="8202566">:=</span>&nbsp;<span class="ident" id="8202569">g</span><span class="op" id="8202570">.</span><span class="ident" id="8202571">infos</span><span class="op" id="8202576">[</span><span class="ident" id="8202577">j</span><span class="op" id="8202578">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202583">if</span>&nbsp;<span class="ident" id="8202586">l</span><span class="op" id="8202587">.</span><span class="ident" id="8202588">Offset</span>&nbsp;<span class="op" id="8202595">!=</span>&nbsp;<span class="ident" id="8202598">m</span><span class="op" id="8202599">.</span><span class="ident" id="8202600">Offset</span>&nbsp;<span class="op" id="8202607">||</span>&nbsp;<span class="ident" id="8202610">l</span><span class="op" id="8202611">.</span><span class="ident" id="8202612">Filename</span>&nbsp;<span class="op" id="8202621">!=</span>&nbsp;<span class="ident" id="8202624">m</span><span class="op" id="8202625">.</span><span class="ident" id="8202626">Filename</span>&nbsp;<span class="op" id="8202635">||</span>&nbsp;<span class="ident" id="8202638">l</span><span class="op" id="8202639">.</span><span class="ident" id="8202640">Line</span>&nbsp;<span class="op" id="8202645">!=</span>&nbsp;<span class="ident" id="8202648">m</span><span class="op" id="8202649">.</span><span class="ident" id="8202650">Line</span>&nbsp;<span class="op" id="8202655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202661">return</span>&nbsp;<span class="ident" id="8202668">fmt</span><span class="op" id="8202671">.</span><span class="ident" id="8202672">Errorf</span><span class="op" id="8202678">(</span><span class="string" id="8202679">&#34;different&nbsp;infos&nbsp;for&nbsp;%q&#34;</span><span class="op" id="8202703">,</span>&nbsp;<span class="ident" id="8202705">f</span><span class="op" id="8202706">.</span><span class="ident" id="8202707">name</span><span class="op" id="8202711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8202716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8202720">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8202723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8202727">//&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;about&nbsp;.last&nbsp;-&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202777">return</span>&nbsp;<span class="builtintype" id="8202784">nil</span><br>
<span class="lineno"></span><span class="op" id="8202788">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="8202791">func</span>&nbsp;<span class="ident" id="8202796">checkSerialize</span><span class="op" id="8202810">(</span><span class="ident" id="8202811">t</span>&nbsp;<span class="op" id="8202813">*</span><span class="ident" id="8202814">testing</span><span class="op" id="8202821">.</span><span class="ident" id="8202822">T</span><span class="op" id="8202823">,</span>&nbsp;<span class="ident" id="8202825">p</span>&nbsp;<span class="op" id="8202827">*</span><span class="ident" id="8202828">FileSet</span><span class="op" id="8202835">)</span>&nbsp;<span class="op" id="8202837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202840">var</span>&nbsp;<span class="ident" id="8202844">buf</span>&nbsp;<span class="ident" id="8202848">bytes</span><span class="op" id="8202853">.</span><span class="ident" id="8202854">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8202862">encode</span>&nbsp;<span class="op" id="8202869">:=</span>&nbsp;<span class="keyword" id="8202872">func</span><span class="op" id="8202876">(</span><span class="ident" id="8202877">x</span>&nbsp;<span class="keyword" id="8202879">interface</span><span class="op" id="8202888">{</span><span class="op" id="8202889">}</span><span class="op" id="8202890">)</span>&nbsp;<span class="builtintype" id="8202892">error</span>&nbsp;<span class="op" id="8202898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202902">return</span>&nbsp;<span class="ident" id="8202909">gob</span><span class="op" id="8202912">.</span><span class="ident" id="8202913">NewEncoder</span><span class="op" id="8202923">(</span><span class="op" id="8202924">&amp;</span><span class="ident" id="8202925">buf</span><span class="op" id="8202928">)</span><span class="op" id="8202929">.</span><span class="ident" id="8202930">Encode</span><span class="op" id="8202936">(</span><span class="ident" id="8202937">x</span><span class="op" id="8202938">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8202941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8202944">if</span>&nbsp;<span class="ident" id="8202947">err</span>&nbsp;<span class="op" id="8202951">:=</span>&nbsp;<span class="ident" id="8202954">p</span><span class="op" id="8202955">.</span><span class="ident" id="8202956">Write</span><span class="op" id="8202961">(</span><span class="ident" id="8202962">encode</span><span class="op" id="8202968">)</span><span class="op" id="8202969">;</span>&nbsp;<span class="ident" id="8202971">err</span>&nbsp;<span class="op" id="8202975">!=</span>&nbsp;<span class="builtintype" id="8202978">nil</span>&nbsp;<span class="op" id="8202982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8202986">t</span><span class="op" id="8202987">.</span><span class="ident" id="8202988">Errorf</span><span class="op" id="8202994">(</span><span class="string" id="8202995">&#34;writing&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8203023">,</span>&nbsp;<span class="ident" id="8203025">err</span><span class="op" id="8203028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8203032">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8203040">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8203043">q</span>&nbsp;<span class="op" id="8203045">:=</span>&nbsp;<span class="ident" id="8203048">NewFileSet</span><span class="op" id="8203058">(</span><span class="op" id="8203059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8203062">decode</span>&nbsp;<span class="op" id="8203069">:=</span>&nbsp;<span class="keyword" id="8203072">func</span><span class="op" id="8203076">(</span><span class="ident" id="8203077">x</span>&nbsp;<span class="keyword" id="8203079">interface</span><span class="op" id="8203088">{</span><span class="op" id="8203089">}</span><span class="op" id="8203090">)</span>&nbsp;<span class="builtintype" id="8203092">error</span>&nbsp;<span class="op" id="8203098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8203102">return</span>&nbsp;<span class="ident" id="8203109">gob</span><span class="op" id="8203112">.</span><span class="ident" id="8203113">NewDecoder</span><span class="op" id="8203123">(</span><span class="op" id="8203124">&amp;</span><span class="ident" id="8203125">buf</span><span class="op" id="8203128">)</span><span class="op" id="8203129">.</span><span class="ident" id="8203130">Decode</span><span class="op" id="8203136">(</span><span class="ident" id="8203137">x</span><span class="op" id="8203138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8203141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8203144">if</span>&nbsp;<span class="ident" id="8203147">err</span>&nbsp;<span class="op" id="8203151">:=</span>&nbsp;<span class="ident" id="8203154">q</span><span class="op" id="8203155">.</span><span class="ident" id="8203156">Read</span><span class="op" id="8203160">(</span><span class="ident" id="8203161">decode</span><span class="op" id="8203167">)</span><span class="op" id="8203168">;</span>&nbsp;<span class="ident" id="8203170">err</span>&nbsp;<span class="op" id="8203174">!=</span>&nbsp;<span class="builtintype" id="8203177">nil</span>&nbsp;<span class="op" id="8203181">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8203185">t</span><span class="op" id="8203186">.</span><span class="ident" id="8203187">Errorf</span><span class="op" id="8203193">(</span><span class="string" id="8203194">&#34;reading&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8203222">,</span>&nbsp;<span class="ident" id="8203224">err</span><span class="op" id="8203227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8203231">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8203239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8203242">if</span>&nbsp;<span class="ident" id="8203245">err</span>&nbsp;<span class="op" id="8203249">:=</span>&nbsp;<span class="ident" id="8203252">equal</span><span class="op" id="8203257">(</span><span class="ident" id="8203258">p</span><span class="op" id="8203259">,</span>&nbsp;<span class="ident" id="8203261">q</span><span class="op" id="8203262">)</span><span class="op" id="8203263">;</span>&nbsp;<span class="ident" id="8203265">err</span>&nbsp;<span class="op" id="8203269">!=</span>&nbsp;<span class="builtintype" id="8203272">nil</span>&nbsp;<span class="op" id="8203276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8203280">t</span><span class="op" id="8203281">.</span><span class="ident" id="8203282">Errorf</span><span class="op" id="8203288">(</span><span class="string" id="8203289">&#34;filesets&nbsp;not&nbsp;identical:&nbsp;%s&#34;</span><span class="op" id="8203317">,</span>&nbsp;<span class="ident" id="8203319">err</span><span class="op" id="8203322">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8203325">}</span><br>
<span class="lineno"></span><span class="op" id="8203327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8203330">func</span>&nbsp;<span class="ident" id="8203335">TestSerialization</span><span class="op" id="8203352">(</span><span class="ident" id="8203353">t</span>&nbsp;<span class="op" id="8203355">*</span><span class="ident" id="8203356">testing</span><span class="op" id="8203363">.</span><span class="ident" id="8203364">T</span><span class="op" id="8203365">)</span>&nbsp;<span class="op" id="8203367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8203370">p</span>&nbsp;<span class="op" id="8203372">:=</span>&nbsp;<span class="ident" id="8203375">NewFileSet</span><span class="op" id="8203385">(</span><span class="op" id="8203386">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8203389">checkSerialize</span><span class="op" id="8203403">(</span><span class="ident" id="8203404">t</span><span class="op" id="8203405">,</span>&nbsp;<span class="ident" id="8203407">p</span><span class="op" id="8203408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8203411">//&nbsp;add&nbsp;some&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8203430">for</span>&nbsp;<span class="ident" id="8203434">i</span>&nbsp;<span class="op" id="8203436">:=</span>&nbsp;<span class="num" id="8203439">0</span><span class="op" id="8203440">;</span>&nbsp;<span class="ident" id="8203442">i</span>&nbsp;<span class="op" id="8203444">&lt;</span>&nbsp;<span class="num" id="8203446">10</span><span class="op" id="8203448">;</span>&nbsp;<span class="ident" id="8203450">i</span><span class="op" id="8203451">++</span>&nbsp;<span class="op" id="8203454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8203458">f</span>&nbsp;<span class="op" id="8203460">:=</span>&nbsp;<span class="ident" id="8203463">p</span><span class="op" id="8203464">.</span><span class="ident" id="8203465">AddFile</span><span class="op" id="8203472">(</span><span class="ident" id="8203473">fmt</span><span class="op" id="8203476">.</span><span class="ident" id="8203477">Sprintf</span><span class="op" id="8203484">(</span><span class="string" id="8203485">&#34;file%d&#34;</span><span class="op" id="8203493">,</span>&nbsp;<span class="ident" id="8203495">i</span><span class="op" id="8203496">)</span><span class="op" id="8203497">,</span>&nbsp;<span class="ident" id="8203499">p</span><span class="op" id="8203500">.</span><span class="ident" id="8203501">Base</span><span class="op" id="8203505">(</span><span class="op" id="8203506">)</span><span class="op" id="8203507">+</span><span class="ident" id="8203508">i</span><span class="op" id="8203509">,</span>&nbsp;<span class="ident" id="8203511">i</span><span class="op" id="8203512">*</span><span class="num" id="8203513">100</span><span class="op" id="8203516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8203520">checkSerialize</span><span class="op" id="8203534">(</span><span class="ident" id="8203535">t</span><span class="op" id="8203536">,</span>&nbsp;<span class="ident" id="8203538">p</span><span class="op" id="8203539">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8203543">//&nbsp;add&nbsp;some&nbsp;lines&nbsp;and&nbsp;alternative&nbsp;file&nbsp;infos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8203590">line</span>&nbsp;<span class="op" id="8203595">:=</span>&nbsp;<span class="num" id="8203598">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8203605">for</span>&nbsp;<span class="ident" id="8203609">offs</span>&nbsp;<span class="op" id="8203614">:=</span>&nbsp;<span class="num" id="8203617">0</span><span class="op" id="8203618">;</span>&nbsp;<span class="ident" id="8203620">offs</span>&nbsp;<span class="op" id="8203625">&lt;</span>&nbsp;<span class="ident" id="8203627">f</span><span class="op" id="8203628">.</span><span class="ident" id="8203629">Size</span><span class="op" id="8203633">(</span><span class="op" id="8203634">)</span><span class="op" id="8203635">;</span>&nbsp;<span class="ident" id="8203637">offs</span>&nbsp;<span class="op" id="8203642">+=</span>&nbsp;<span class="num" id="8203645">40</span>&nbsp;<span class="op" id="8203648">+</span>&nbsp;<span class="ident" id="8203650">i</span>&nbsp;<span class="op" id="8203652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8203657">f</span><span class="op" id="8203658">.</span><span class="ident" id="8203659">AddLine</span><span class="op" id="8203666">(</span><span class="ident" id="8203667">offs</span><span class="op" id="8203671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8203676">if</span>&nbsp;<span class="ident" id="8203679">offs</span><span class="op" id="8203683">%</span><span class="num" id="8203684">7</span>&nbsp;<span class="op" id="8203686">==</span>&nbsp;<span class="num" id="8203689">0</span>&nbsp;<span class="op" id="8203691">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8203697">f</span><span class="op" id="8203698">.</span><span class="ident" id="8203699">AddLineInfo</span><span class="op" id="8203710">(</span><span class="ident" id="8203711">offs</span><span class="op" id="8203715">,</span>&nbsp;<span class="ident" id="8203717">fmt</span><span class="op" id="8203720">.</span><span class="ident" id="8203721">Sprintf</span><span class="op" id="8203728">(</span><span class="string" id="8203729">&#34;file%d&#34;</span><span class="op" id="8203737">,</span>&nbsp;<span class="ident" id="8203739">offs</span><span class="op" id="8203743">)</span><span class="op" id="8203744">,</span>&nbsp;<span class="ident" id="8203746">line</span><span class="op" id="8203750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8203756">line</span>&nbsp;<span class="op" id="8203761">+=</span>&nbsp;<span class="num" id="8203764">33</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8203770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8203774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8203778">checkSerialize</span><span class="op" id="8203792">(</span><span class="ident" id="8203793">t</span><span class="op" id="8203794">,</span>&nbsp;<span class="ident" id="8203796">p</span><span class="op" id="8203797">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8203800">}</span><br>
<span class="lineno"></span><span class="op" id="8203802">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
