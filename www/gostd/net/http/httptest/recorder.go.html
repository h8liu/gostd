<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html" class="current">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6122079">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6122134">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6122188">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6122239">//&nbsp;Package&nbsp;httptest&nbsp;provides&nbsp;utilities&nbsp;for&nbsp;HTTP&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6122296">package</span>&nbsp;<span class="ident" id="6122304">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6122314">import</span>&nbsp;<span class="op" id="6122321">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6122324">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6122333">&#34;net/http&#34;</span><br>
<span class="lineno"></span><span class="op" id="6122344">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6122347">//&nbsp;ResponseRecorder&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;http.ResponseWriter&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="6122416">//&nbsp;records&nbsp;its&nbsp;mutations&nbsp;for&nbsp;later&nbsp;inspection&nbsp;in&nbsp;tests.</span><br>
<span class="lineno">15</span><span class="keyword" id="6122472">type</span>&nbsp;<span class="ident" id="6122477">ResponseRecorder</span>&nbsp;<span class="keyword" id="6122494">struct</span>&nbsp;<span class="op" id="6122501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122504">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6122514">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6122528">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;code&nbsp;from&nbsp;WriteHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122572">HeaderMap</span>&nbsp;<span class="ident" id="6122582">http</span><span class="op" id="6122586">.</span><span class="ident" id="6122587">Header</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6122596">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122626">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6122636">*</span><span class="ident" id="6122637">bytes</span><span class="op" id="6122642">.</span><span class="ident" id="6122643">Buffer</span>&nbsp;<span class="comment" id="6122650">//&nbsp;if&nbsp;non-nil,&nbsp;the&nbsp;bytes.Buffer&nbsp;to&nbsp;append&nbsp;written&nbsp;data&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122709">Flushed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6122719">bool</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122726">wroteHeader</span>&nbsp;<span class="builtintype" id="6122738">bool</span><br>
<span class="lineno"></span><span class="op" id="6122743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6122746">//&nbsp;NewRecorder&nbsp;returns&nbsp;an&nbsp;initialized&nbsp;ResponseRecorder.</span><br>
<span class="lineno">25</span><span class="keyword" id="6122802">func</span>&nbsp;<span class="ident" id="6122807">NewRecorder</span><span class="op" id="6122818">(</span><span class="op" id="6122819">)</span>&nbsp;<span class="op" id="6122821">*</span><span class="ident" id="6122822">ResponseRecorder</span>&nbsp;<span class="op" id="6122839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6122842">return</span>&nbsp;<span class="op" id="6122849">&amp;</span><span class="ident" id="6122850">ResponseRecorder</span><span class="op" id="6122866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122870">HeaderMap</span><span class="op" id="6122879">:</span>&nbsp;<span class="builtinfunc" id="6122881">make</span><span class="op" id="6122885">(</span><span class="ident" id="6122886">http</span><span class="op" id="6122890">.</span><span class="ident" id="6122891">Header</span><span class="op" id="6122897">)</span><span class="op" id="6122898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122902">Body</span><span class="op" id="6122906">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6122913">new</span><span class="op" id="6122916">(</span><span class="ident" id="6122917">bytes</span><span class="op" id="6122922">.</span><span class="ident" id="6122923">Buffer</span><span class="op" id="6122929">)</span><span class="op" id="6122930">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122934">Code</span><span class="op" id="6122938">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6122945">200</span><span class="op" id="6122948">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6122951">}</span><br>
<span class="lineno"></span><span class="op" id="6122953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6122956">//&nbsp;DefaultRemoteAddr&nbsp;is&nbsp;the&nbsp;default&nbsp;remote&nbsp;address&nbsp;to&nbsp;return&nbsp;in&nbsp;RemoteAddr&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6123034">//&nbsp;an&nbsp;explicit&nbsp;DefaultRemoteAddr&nbsp;isn&#39;t&nbsp;set&nbsp;on&nbsp;ResponseRecorder.</span><br>
<span class="lineno">35</span><span class="keyword" id="6123098">const</span>&nbsp;<span class="ident" id="6123104">DefaultRemoteAddr</span>&nbsp;<span class="op" id="6123122">=</span>&nbsp;<span class="string" id="6123124">&#34;1.2.3.4&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6123135">//&nbsp;Header&nbsp;returns&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="6123175">func</span>&nbsp;<span class="op" id="6123180">(</span><span class="ident" id="6123181">rw</span>&nbsp;<span class="op" id="6123184">*</span><span class="ident" id="6123185">ResponseRecorder</span><span class="op" id="6123201">)</span>&nbsp;<span class="ident" id="6123203">Header</span><span class="op" id="6123209">(</span><span class="op" id="6123210">)</span>&nbsp;<span class="ident" id="6123212">http</span><span class="op" id="6123216">.</span><span class="ident" id="6123217">Header</span>&nbsp;<span class="op" id="6123224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6123227">m</span>&nbsp;<span class="op" id="6123229">:=</span>&nbsp;<span class="ident" id="6123232">rw</span><span class="op" id="6123234">.</span><span class="ident" id="6123235">HeaderMap</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6123246">if</span>&nbsp;<span class="ident" id="6123249">m</span>&nbsp;<span class="op" id="6123251">==</span>&nbsp;<span class="builtintype" id="6123254">nil</span>&nbsp;<span class="op" id="6123258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6123262">m</span>&nbsp;<span class="op" id="6123264">=</span>&nbsp;<span class="builtinfunc" id="6123266">make</span><span class="op" id="6123270">(</span><span class="ident" id="6123271">http</span><span class="op" id="6123275">.</span><span class="ident" id="6123276">Header</span><span class="op" id="6123282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6123286">rw</span><span class="op" id="6123288">.</span><span class="ident" id="6123289">HeaderMap</span>&nbsp;<span class="op" id="6123299">=</span>&nbsp;<span class="ident" id="6123301">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6123304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6123307">return</span>&nbsp;<span class="ident" id="6123314">m</span><br>
<span class="lineno">45</span><span class="op" id="6123316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6123319">//&nbsp;Write&nbsp;always&nbsp;succeeds&nbsp;and&nbsp;writes&nbsp;to&nbsp;rw.Body,&nbsp;if&nbsp;not&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="6123379">func</span>&nbsp;<span class="op" id="6123384">(</span><span class="ident" id="6123385">rw</span>&nbsp;<span class="op" id="6123388">*</span><span class="ident" id="6123389">ResponseRecorder</span><span class="op" id="6123405">)</span>&nbsp;<span class="ident" id="6123407">Write</span><span class="op" id="6123412">(</span><span class="ident" id="6123413">buf</span>&nbsp;<span class="op" id="6123417">[</span><span class="op" id="6123418">]</span><span class="builtintype" id="6123419">byte</span><span class="op" id="6123423">)</span>&nbsp;<span class="op" id="6123425">(</span><span class="builtintype" id="6123426">int</span><span class="op" id="6123429">,</span>&nbsp;<span class="builtintype" id="6123431">error</span><span class="op" id="6123436">)</span>&nbsp;<span class="op" id="6123438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6123441">if</span>&nbsp;<span class="op" id="6123444">!</span><span class="ident" id="6123445">rw</span><span class="op" id="6123447">.</span><span class="ident" id="6123448">wroteHeader</span>&nbsp;<span class="op" id="6123460">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6123464">rw</span><span class="op" id="6123466">.</span><span class="ident" id="6123467">WriteHeader</span><span class="op" id="6123478">(</span><span class="num" id="6123479">200</span><span class="op" id="6123482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6123485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6123488">if</span>&nbsp;<span class="ident" id="6123491">rw</span><span class="op" id="6123493">.</span><span class="ident" id="6123494">Body</span>&nbsp;<span class="op" id="6123499">!=</span>&nbsp;<span class="builtintype" id="6123502">nil</span>&nbsp;<span class="op" id="6123506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6123510">rw</span><span class="op" id="6123512">.</span><span class="ident" id="6123513">Body</span><span class="op" id="6123517">.</span><span class="ident" id="6123518">Write</span><span class="op" id="6123523">(</span><span class="ident" id="6123524">buf</span><span class="op" id="6123527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6123530">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6123533">return</span>&nbsp;<span class="builtinfunc" id="6123540">len</span><span class="op" id="6123543">(</span><span class="ident" id="6123544">buf</span><span class="op" id="6123547">)</span><span class="op" id="6123548">,</span>&nbsp;<span class="builtintype" id="6123550">nil</span><br>
<span class="lineno"></span><span class="op" id="6123554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6123557">//&nbsp;WriteHeader&nbsp;sets&nbsp;rw.Code.</span><br>
<span class="lineno"></span><span class="keyword" id="6123586">func</span>&nbsp;<span class="op" id="6123591">(</span><span class="ident" id="6123592">rw</span>&nbsp;<span class="op" id="6123595">*</span><span class="ident" id="6123596">ResponseRecorder</span><span class="op" id="6123612">)</span>&nbsp;<span class="ident" id="6123614">WriteHeader</span><span class="op" id="6123625">(</span><span class="ident" id="6123626">code</span>&nbsp;<span class="builtintype" id="6123631">int</span><span class="op" id="6123634">)</span>&nbsp;<span class="op" id="6123636">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6123639">if</span>&nbsp;<span class="op" id="6123642">!</span><span class="ident" id="6123643">rw</span><span class="op" id="6123645">.</span><span class="ident" id="6123646">wroteHeader</span>&nbsp;<span class="op" id="6123658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6123662">rw</span><span class="op" id="6123664">.</span><span class="ident" id="6123665">Code</span>&nbsp;<span class="op" id="6123670">=</span>&nbsp;<span class="ident" id="6123672">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6123678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6123681">rw</span><span class="op" id="6123683">.</span><span class="ident" id="6123684">wroteHeader</span>&nbsp;<span class="op" id="6123696">=</span>&nbsp;<span class="builtintype" id="6123698">true</span><br>
<span class="lineno"></span><span class="op" id="6123703">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="6123706">//&nbsp;Flush&nbsp;sets&nbsp;rw.Flushed&nbsp;to&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="6123740">func</span>&nbsp;<span class="op" id="6123745">(</span><span class="ident" id="6123746">rw</span>&nbsp;<span class="op" id="6123749">*</span><span class="ident" id="6123750">ResponseRecorder</span><span class="op" id="6123766">)</span>&nbsp;<span class="ident" id="6123768">Flush</span><span class="op" id="6123773">(</span><span class="op" id="6123774">)</span>&nbsp;<span class="op" id="6123776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6123779">if</span>&nbsp;<span class="op" id="6123782">!</span><span class="ident" id="6123783">rw</span><span class="op" id="6123785">.</span><span class="ident" id="6123786">wroteHeader</span>&nbsp;<span class="op" id="6123798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6123802">rw</span><span class="op" id="6123804">.</span><span class="ident" id="6123805">WriteHeader</span><span class="op" id="6123816">(</span><span class="num" id="6123817">200</span><span class="op" id="6123820">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6123823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6123826">rw</span><span class="op" id="6123828">.</span><span class="ident" id="6123829">Flushed</span>&nbsp;<span class="op" id="6123837">=</span>&nbsp;<span class="builtintype" id="6123839">true</span><br>
<span class="lineno"></span><span class="op" id="6123844">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
