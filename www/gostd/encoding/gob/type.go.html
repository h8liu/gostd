<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5097994">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5098049">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5098103">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5098154">package</span>&nbsp;<span class="ident" id="5098162">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5098167">import</span>&nbsp;<span class="op" id="5098174">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5098177">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5098189">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5098199">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5098206">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5098212">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5098223">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5098231">&#34;sync/atomic&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5098246">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5098257">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5098272">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5098275">//&nbsp;userTypeInfo&nbsp;stores&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;a&nbsp;type&nbsp;the&nbsp;user&nbsp;has&nbsp;handed</span><br>
<span class="lineno">20</span><span class="comment" id="5098357">//&nbsp;to&nbsp;the&nbsp;package.&nbsp;&nbsp;It&#39;s&nbsp;computed&nbsp;once&nbsp;and&nbsp;stored&nbsp;in&nbsp;a&nbsp;map&nbsp;keyed&nbsp;by&nbsp;reflection</span><br>
<span class="lineno"></span><span class="comment" id="5098436">//&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5098445">type</span>&nbsp;<span class="ident" id="5098450">userTypeInfo</span>&nbsp;<span class="keyword" id="5098463">struct</span>&nbsp;<span class="op" id="5098470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098473">user</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5098485">reflect</span><span class="op" id="5098492">.</span><span class="ident" id="5098493">Type</span>&nbsp;<span class="comment" id="5098498">//&nbsp;the&nbsp;type&nbsp;the&nbsp;user&nbsp;handed&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098530">base</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5098542">reflect</span><span class="op" id="5098549">.</span><span class="ident" id="5098550">Type</span>&nbsp;<span class="comment" id="5098555">//&nbsp;the&nbsp;base&nbsp;type&nbsp;after&nbsp;all&nbsp;indirections</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098596">indir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5098608">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5098621">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098671">externalEnc</span>&nbsp;<span class="builtintype" id="5098683">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5098696">//&nbsp;xGob,&nbsp;xBinary,&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098724">externalDec</span>&nbsp;<span class="builtintype" id="5098736">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5098749">//&nbsp;xGob,&nbsp;xBinary&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098776">encIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5098788">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5098801">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098872">decIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5098884">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5098897">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno">30</span><span class="op" id="5098967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5098970">//&nbsp;externalEncoding&nbsp;bits</span><br>
<span class="lineno"></span><span class="keyword" id="5098995">const</span>&nbsp;<span class="op" id="5099001">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099004">xGob</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5099012">=</span>&nbsp;<span class="num" id="5099014">1</span>&nbsp;<span class="op" id="5099016">+</span>&nbsp;<span class="ident" id="5099018">iota</span>&nbsp;<span class="comment" id="5099023">//&nbsp;GobEncoder&nbsp;or&nbsp;GobDecoder</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099052">xBinary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5099071">//&nbsp;encoding.BinaryMarshaler&nbsp;or&nbsp;encoding.BinaryUnmarshaler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099130">xText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5099149">//&nbsp;encoding.TextMarshaler&nbsp;or&nbsp;encoding.TextUnmarshaler</span><br>
<span class="lineno"></span><span class="op" id="5099203">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5099206">var</span>&nbsp;<span class="op" id="5099210">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5099213">//&nbsp;Protected&nbsp;by&nbsp;an&nbsp;RWMutex&nbsp;because&nbsp;we&nbsp;read&nbsp;it&nbsp;a&nbsp;lot&nbsp;and&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5099276">//&nbsp;it&nbsp;only&nbsp;when&nbsp;we&nbsp;see&nbsp;a&nbsp;new&nbsp;type,&nbsp;typically&nbsp;when&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099338">userTypeLock</span>&nbsp;&nbsp;<span class="ident" id="5099352">sync</span><span class="op" id="5099356">.</span><span class="ident" id="5099357">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099366">userTypeCache</span>&nbsp;<span class="op" id="5099380">=</span>&nbsp;<span class="builtinfunc" id="5099382">make</span><span class="op" id="5099386">(</span><span class="keyword" id="5099387">map</span><span class="op" id="5099390">[</span><span class="ident" id="5099391">reflect</span><span class="op" id="5099398">.</span><span class="ident" id="5099399">Type</span><span class="op" id="5099403">]</span><span class="op" id="5099404">*</span><span class="ident" id="5099405">userTypeInfo</span><span class="op" id="5099417">)</span><br>
<span class="lineno"></span><span class="op" id="5099419">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5099422">//&nbsp;validType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="5099510">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;err&nbsp;will&nbsp;be&nbsp;non-nil.&nbsp;&nbsp;To&nbsp;be&nbsp;used&nbsp;when&nbsp;the&nbsp;error&nbsp;handler</span><br>
<span class="lineno"></span><span class="comment" id="5099600">//&nbsp;is&nbsp;not&nbsp;set&nbsp;up.</span><br>
<span class="lineno"></span><span class="keyword" id="5099618">func</span>&nbsp;<span class="ident" id="5099623">validUserType</span><span class="op" id="5099636">(</span><span class="ident" id="5099637">rt</span>&nbsp;<span class="ident" id="5099640">reflect</span><span class="op" id="5099647">.</span><span class="ident" id="5099648">Type</span><span class="op" id="5099652">)</span>&nbsp;<span class="op" id="5099654">(</span><span class="ident" id="5099655">ut</span>&nbsp;<span class="op" id="5099658">*</span><span class="ident" id="5099659">userTypeInfo</span><span class="op" id="5099671">,</span>&nbsp;<span class="ident" id="5099673">err</span>&nbsp;<span class="builtintype" id="5099677">error</span><span class="op" id="5099682">)</span>&nbsp;<span class="op" id="5099684">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099687">userTypeLock</span><span class="op" id="5099699">.</span><span class="ident" id="5099700">RLock</span><span class="op" id="5099705">(</span><span class="op" id="5099706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099709">ut</span>&nbsp;<span class="op" id="5099712">=</span>&nbsp;<span class="ident" id="5099714">userTypeCache</span><span class="op" id="5099727">[</span><span class="ident" id="5099728">rt</span><span class="op" id="5099730">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099733">userTypeLock</span><span class="op" id="5099745">.</span><span class="ident" id="5099746">RUnlock</span><span class="op" id="5099753">(</span><span class="op" id="5099754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099757">if</span>&nbsp;<span class="ident" id="5099760">ut</span>&nbsp;<span class="op" id="5099763">!=</span>&nbsp;<span class="ident" id="5099766">nil</span>&nbsp;<span class="op" id="5099770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099774">return</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5099785">//&nbsp;Now&nbsp;set&nbsp;the&nbsp;value&nbsp;under&nbsp;the&nbsp;write&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099829">userTypeLock</span><span class="op" id="5099841">.</span><span class="ident" id="5099842">Lock</span><span class="op" id="5099846">(</span><span class="op" id="5099847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099850">defer</span>&nbsp;<span class="ident" id="5099856">userTypeLock</span><span class="op" id="5099868">.</span><span class="ident" id="5099869">Unlock</span><span class="op" id="5099875">(</span><span class="op" id="5099876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099879">if</span>&nbsp;<span class="ident" id="5099882">ut</span>&nbsp;<span class="op" id="5099885">=</span>&nbsp;<span class="ident" id="5099887">userTypeCache</span><span class="op" id="5099900">[</span><span class="ident" id="5099901">rt</span><span class="op" id="5099903">]</span><span class="op" id="5099904">;</span>&nbsp;<span class="ident" id="5099906">ut</span>&nbsp;<span class="op" id="5099909">!=</span>&nbsp;<span class="ident" id="5099912">nil</span>&nbsp;<span class="op" id="5099916">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5099920">//&nbsp;Lost&nbsp;the&nbsp;race;&nbsp;not&nbsp;a&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099955">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099966">ut</span>&nbsp;<span class="op" id="5099969">=</span>&nbsp;<span class="builtinfunc" id="5099971">new</span><span class="op" id="5099974">(</span><span class="ident" id="5099975">userTypeInfo</span><span class="op" id="5099987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099990">ut</span><span class="op" id="5099992">.</span><span class="ident" id="5099993">base</span>&nbsp;<span class="op" id="5099998">=</span>&nbsp;<span class="ident" id="5100000">rt</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100004">ut</span><span class="op" id="5100006">.</span><span class="ident" id="5100007">user</span>&nbsp;<span class="op" id="5100012">=</span>&nbsp;<span class="ident" id="5100014">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5100018">//&nbsp;A&nbsp;type&nbsp;that&nbsp;is&nbsp;just&nbsp;a&nbsp;cycle&nbsp;of&nbsp;pointers&nbsp;(such&nbsp;as&nbsp;type&nbsp;T&nbsp;*T)&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5100089">//&nbsp;be&nbsp;represented&nbsp;in&nbsp;gobs,&nbsp;which&nbsp;need&nbsp;some&nbsp;concrete&nbsp;data.&nbsp;&nbsp;We&nbsp;use&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5100158">//&nbsp;cycle&nbsp;detection&nbsp;algorithm&nbsp;from&nbsp;Knuth,&nbsp;Vol&nbsp;2,&nbsp;Section&nbsp;3.1,&nbsp;Ex&nbsp;6,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5100226">//&nbsp;pp&nbsp;539-540.&nbsp;&nbsp;As&nbsp;we&nbsp;step&nbsp;through&nbsp;indirections,&nbsp;run&nbsp;another&nbsp;type&nbsp;at</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5100296">//&nbsp;half&nbsp;speed.&nbsp;If&nbsp;they&nbsp;meet&nbsp;up,&nbsp;there&#39;s&nbsp;a&nbsp;cycle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100346">slowpoke</span>&nbsp;<span class="op" id="5100355">:=</span>&nbsp;<span class="ident" id="5100358">ut</span><span class="op" id="5100360">.</span><span class="ident" id="5100361">base</span>&nbsp;<span class="comment" id="5100366">//&nbsp;walks&nbsp;half&nbsp;as&nbsp;fast&nbsp;as&nbsp;ut.base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100400">for</span>&nbsp;<span class="op" id="5100404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100408">pt</span>&nbsp;<span class="op" id="5100411">:=</span>&nbsp;<span class="ident" id="5100414">ut</span><span class="op" id="5100416">.</span><span class="ident" id="5100417">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100424">if</span>&nbsp;<span class="ident" id="5100427">pt</span><span class="op" id="5100429">.</span><span class="ident" id="5100430">Kind</span><span class="op" id="5100434">(</span><span class="op" id="5100435">)</span>&nbsp;<span class="op" id="5100437">!=</span>&nbsp;<span class="ident" id="5100440">reflect</span><span class="op" id="5100447">.</span><span class="ident" id="5100448">Ptr</span>&nbsp;<span class="op" id="5100452">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100457">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5100465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100469">ut</span><span class="op" id="5100471">.</span><span class="ident" id="5100472">base</span>&nbsp;<span class="op" id="5100477">=</span>&nbsp;<span class="ident" id="5100479">pt</span><span class="op" id="5100481">.</span><span class="ident" id="5100482">Elem</span><span class="op" id="5100486">(</span><span class="op" id="5100487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100491">if</span>&nbsp;<span class="ident" id="5100494">ut</span><span class="op" id="5100496">.</span><span class="ident" id="5100497">base</span>&nbsp;<span class="op" id="5100502">==</span>&nbsp;<span class="ident" id="5100505">slowpoke</span>&nbsp;<span class="op" id="5100514">{</span>&nbsp;<span class="comment" id="5100516">//&nbsp;ut.base&nbsp;lapped&nbsp;slowpoke</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5100546">//&nbsp;recursive&nbsp;pointer&nbsp;type.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100576">return</span>&nbsp;<span class="ident" id="5100583">nil</span><span class="op" id="5100586">,</span>&nbsp;<span class="ident" id="5100588">errors</span><span class="op" id="5100594">.</span><span class="ident" id="5100595">New</span><span class="op" id="5100598">(</span><span class="string" id="5100599">&#34;can&#39;t&nbsp;represent&nbsp;recursive&nbsp;pointer&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5100641">+</span>&nbsp;<span class="ident" id="5100643">ut</span><span class="op" id="5100645">.</span><span class="ident" id="5100646">base</span><span class="op" id="5100650">.</span><span class="ident" id="5100651">String</span><span class="op" id="5100657">(</span><span class="op" id="5100658">)</span><span class="op" id="5100659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5100663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100667">if</span>&nbsp;<span class="ident" id="5100670">ut</span><span class="op" id="5100672">.</span><span class="ident" id="5100673">indir</span><span class="op" id="5100678">%</span><span class="num" id="5100679">2</span>&nbsp;<span class="op" id="5100681">==</span>&nbsp;<span class="num" id="5100684">0</span>&nbsp;<span class="op" id="5100686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100691">slowpoke</span>&nbsp;<span class="op" id="5100700">=</span>&nbsp;<span class="ident" id="5100702">slowpoke</span><span class="op" id="5100710">.</span><span class="ident" id="5100711">Elem</span><span class="op" id="5100715">(</span><span class="op" id="5100716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5100720">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100724">ut</span><span class="op" id="5100726">.</span><span class="ident" id="5100727">indir</span><span class="op" id="5100732">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5100736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100740">if</span>&nbsp;<span class="ident" id="5100743">ok</span><span class="op" id="5100745">,</span>&nbsp;<span class="ident" id="5100747">indir</span>&nbsp;<span class="op" id="5100753">:=</span>&nbsp;<span class="ident" id="5100756">implementsInterface</span><span class="op" id="5100775">(</span><span class="ident" id="5100776">ut</span><span class="op" id="5100778">.</span><span class="ident" id="5100779">user</span><span class="op" id="5100783">,</span>&nbsp;<span class="ident" id="5100785">gobEncoderInterfaceType</span><span class="op" id="5100808">)</span><span class="op" id="5100809">;</span>&nbsp;<span class="ident" id="5100811">ok</span>&nbsp;<span class="op" id="5100814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100818">ut</span><span class="op" id="5100820">.</span><span class="ident" id="5100821">externalEnc</span><span class="op" id="5100832">,</span>&nbsp;<span class="ident" id="5100834">ut</span><span class="op" id="5100836">.</span><span class="ident" id="5100837">encIndir</span>&nbsp;<span class="op" id="5100846">=</span>&nbsp;<span class="ident" id="5100848">xGob</span><span class="op" id="5100852">,</span>&nbsp;<span class="ident" id="5100854">indir</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5100861">}</span>&nbsp;<span class="keyword" id="5100863">else</span>&nbsp;<span class="keyword" id="5100868">if</span>&nbsp;<span class="ident" id="5100871">ok</span><span class="op" id="5100873">,</span>&nbsp;<span class="ident" id="5100875">indir</span>&nbsp;<span class="op" id="5100881">:=</span>&nbsp;<span class="ident" id="5100884">implementsInterface</span><span class="op" id="5100903">(</span><span class="ident" id="5100904">ut</span><span class="op" id="5100906">.</span><span class="ident" id="5100907">user</span><span class="op" id="5100911">,</span>&nbsp;<span class="ident" id="5100913">binaryMarshalerInterfaceType</span><span class="op" id="5100941">)</span><span class="op" id="5100942">;</span>&nbsp;<span class="ident" id="5100944">ok</span>&nbsp;<span class="op" id="5100947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100951">ut</span><span class="op" id="5100953">.</span><span class="ident" id="5100954">externalEnc</span><span class="op" id="5100965">,</span>&nbsp;<span class="ident" id="5100967">ut</span><span class="op" id="5100969">.</span><span class="ident" id="5100970">encIndir</span>&nbsp;<span class="op" id="5100979">=</span>&nbsp;<span class="ident" id="5100981">xBinary</span><span class="op" id="5100988">,</span>&nbsp;<span class="ident" id="5100990">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5100997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5101001">//&nbsp;NOTE(rsc):&nbsp;Would&nbsp;like&nbsp;to&nbsp;allow&nbsp;MarshalText&nbsp;here,&nbsp;but&nbsp;results&nbsp;in&nbsp;incompatibility</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5101085">//&nbsp;with&nbsp;older&nbsp;encodings&nbsp;for&nbsp;net.IP.&nbsp;See&nbsp;golang.org/issue/6760.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5101149">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textMarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5101239">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsput.externalEnc,&nbsp;ut.encIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5101287">//&nbsp;}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5101294">if</span>&nbsp;<span class="ident" id="5101297">ok</span><span class="op" id="5101299">,</span>&nbsp;<span class="ident" id="5101301">indir</span>&nbsp;<span class="op" id="5101307">:=</span>&nbsp;<span class="ident" id="5101310">implementsInterface</span><span class="op" id="5101329">(</span><span class="ident" id="5101330">ut</span><span class="op" id="5101332">.</span><span class="ident" id="5101333">user</span><span class="op" id="5101337">,</span>&nbsp;<span class="ident" id="5101339">gobDecoderInterfaceType</span><span class="op" id="5101362">)</span><span class="op" id="5101363">;</span>&nbsp;<span class="ident" id="5101365">ok</span>&nbsp;<span class="op" id="5101368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101372">ut</span><span class="op" id="5101374">.</span><span class="ident" id="5101375">externalDec</span><span class="op" id="5101386">,</span>&nbsp;<span class="ident" id="5101388">ut</span><span class="op" id="5101390">.</span><span class="ident" id="5101391">decIndir</span>&nbsp;<span class="op" id="5101400">=</span>&nbsp;<span class="ident" id="5101402">xGob</span><span class="op" id="5101406">,</span>&nbsp;<span class="ident" id="5101408">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5101415">}</span>&nbsp;<span class="keyword" id="5101417">else</span>&nbsp;<span class="keyword" id="5101422">if</span>&nbsp;<span class="ident" id="5101425">ok</span><span class="op" id="5101427">,</span>&nbsp;<span class="ident" id="5101429">indir</span>&nbsp;<span class="op" id="5101435">:=</span>&nbsp;<span class="ident" id="5101438">implementsInterface</span><span class="op" id="5101457">(</span><span class="ident" id="5101458">ut</span><span class="op" id="5101460">.</span><span class="ident" id="5101461">user</span><span class="op" id="5101465">,</span>&nbsp;<span class="ident" id="5101467">binaryUnmarshalerInterfaceType</span><span class="op" id="5101497">)</span><span class="op" id="5101498">;</span>&nbsp;<span class="ident" id="5101500">ok</span>&nbsp;<span class="op" id="5101503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101507">ut</span><span class="op" id="5101509">.</span><span class="ident" id="5101510">externalDec</span><span class="op" id="5101521">,</span>&nbsp;<span class="ident" id="5101523">ut</span><span class="op" id="5101525">.</span><span class="ident" id="5101526">decIndir</span>&nbsp;<span class="op" id="5101535">=</span>&nbsp;<span class="ident" id="5101537">xBinary</span><span class="op" id="5101544">,</span>&nbsp;<span class="ident" id="5101546">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5101553">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5101557">//&nbsp;See&nbsp;note&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5101577">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textUnmarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5101669">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsput.externalDec,&nbsp;ut.decIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5101717">//&nbsp;}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101724">userTypeCache</span><span class="op" id="5101737">[</span><span class="ident" id="5101738">rt</span><span class="op" id="5101740">]</span>&nbsp;<span class="op" id="5101742">=</span>&nbsp;<span class="ident" id="5101744">ut</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5101748">return</span><br>
<span class="lineno"></span><span class="op" id="5101755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="5101758">var</span>&nbsp;<span class="op" id="5101762">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101765">gobEncoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5101796">=</span>&nbsp;<span class="ident" id="5101798">reflect</span><span class="op" id="5101805">.</span><span class="ident" id="5101806">TypeOf</span><span class="op" id="5101812">(</span><span class="op" id="5101813">(</span><span class="op" id="5101814">*</span><span class="ident" id="5101815">GobEncoder</span><span class="op" id="5101825">)</span><span class="op" id="5101826">(</span><span class="ident" id="5101827">nil</span><span class="op" id="5101830">)</span><span class="op" id="5101831">)</span><span class="op" id="5101832">.</span><span class="ident" id="5101833">Elem</span><span class="op" id="5101837">(</span><span class="op" id="5101838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101841">gobDecoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5101872">=</span>&nbsp;<span class="ident" id="5101874">reflect</span><span class="op" id="5101881">.</span><span class="ident" id="5101882">TypeOf</span><span class="op" id="5101888">(</span><span class="op" id="5101889">(</span><span class="op" id="5101890">*</span><span class="ident" id="5101891">GobDecoder</span><span class="op" id="5101901">)</span><span class="op" id="5101902">(</span><span class="ident" id="5101903">nil</span><span class="op" id="5101906">)</span><span class="op" id="5101907">)</span><span class="op" id="5101908">.</span><span class="ident" id="5101909">Elem</span><span class="op" id="5101913">(</span><span class="op" id="5101914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101917">binaryMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5101948">=</span>&nbsp;<span class="ident" id="5101950">reflect</span><span class="op" id="5101957">.</span><span class="ident" id="5101958">TypeOf</span><span class="op" id="5101964">(</span><span class="op" id="5101965">(</span><span class="op" id="5101966">*</span><span class="ident" id="5101967">encoding</span><span class="op" id="5101975">.</span><span class="ident" id="5101976">BinaryMarshaler</span><span class="op" id="5101991">)</span><span class="op" id="5101992">(</span><span class="ident" id="5101993">nil</span><span class="op" id="5101996">)</span><span class="op" id="5101997">)</span><span class="op" id="5101998">.</span><span class="ident" id="5101999">Elem</span><span class="op" id="5102003">(</span><span class="op" id="5102004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102007">binaryUnmarshalerInterfaceType</span>&nbsp;<span class="op" id="5102038">=</span>&nbsp;<span class="ident" id="5102040">reflect</span><span class="op" id="5102047">.</span><span class="ident" id="5102048">TypeOf</span><span class="op" id="5102054">(</span><span class="op" id="5102055">(</span><span class="op" id="5102056">*</span><span class="ident" id="5102057">encoding</span><span class="op" id="5102065">.</span><span class="ident" id="5102066">BinaryUnmarshaler</span><span class="op" id="5102083">)</span><span class="op" id="5102084">(</span><span class="ident" id="5102085">nil</span><span class="op" id="5102088">)</span><span class="op" id="5102089">)</span><span class="op" id="5102090">.</span><span class="ident" id="5102091">Elem</span><span class="op" id="5102095">(</span><span class="op" id="5102096">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102099">textMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5102130">=</span>&nbsp;<span class="ident" id="5102132">reflect</span><span class="op" id="5102139">.</span><span class="ident" id="5102140">TypeOf</span><span class="op" id="5102146">(</span><span class="op" id="5102147">(</span><span class="op" id="5102148">*</span><span class="ident" id="5102149">encoding</span><span class="op" id="5102157">.</span><span class="ident" id="5102158">TextMarshaler</span><span class="op" id="5102171">)</span><span class="op" id="5102172">(</span><span class="ident" id="5102173">nil</span><span class="op" id="5102176">)</span><span class="op" id="5102177">)</span><span class="op" id="5102178">.</span><span class="ident" id="5102179">Elem</span><span class="op" id="5102183">(</span><span class="op" id="5102184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102187">textUnmarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5102218">=</span>&nbsp;<span class="ident" id="5102220">reflect</span><span class="op" id="5102227">.</span><span class="ident" id="5102228">TypeOf</span><span class="op" id="5102234">(</span><span class="op" id="5102235">(</span><span class="op" id="5102236">*</span><span class="ident" id="5102237">encoding</span><span class="op" id="5102245">.</span><span class="ident" id="5102246">TextUnmarshaler</span><span class="op" id="5102261">)</span><span class="op" id="5102262">(</span><span class="ident" id="5102263">nil</span><span class="op" id="5102266">)</span><span class="op" id="5102267">)</span><span class="op" id="5102268">.</span><span class="ident" id="5102269">Elem</span><span class="op" id="5102273">(</span><span class="op" id="5102274">)</span><br>
<span class="lineno"></span><span class="op" id="5102276">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5102279">//&nbsp;implementsInterface&nbsp;reports&nbsp;whether&nbsp;the&nbsp;type&nbsp;implements&nbsp;the</span><br>
<span class="lineno">125</span><span class="comment" id="5102342">//&nbsp;gobEncoder/gobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5102378">//&nbsp;It&nbsp;also&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;indirections&nbsp;required&nbsp;to&nbsp;get&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5102447">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="5102466">func</span>&nbsp;<span class="ident" id="5102471">implementsInterface</span><span class="op" id="5102490">(</span><span class="ident" id="5102491">typ</span><span class="op" id="5102494">,</span>&nbsp;<span class="ident" id="5102496">gobEncDecType</span>&nbsp;<span class="ident" id="5102510">reflect</span><span class="op" id="5102517">.</span><span class="ident" id="5102518">Type</span><span class="op" id="5102522">)</span>&nbsp;<span class="op" id="5102524">(</span><span class="ident" id="5102525">success</span>&nbsp;<span class="builtintype" id="5102533">bool</span><span class="op" id="5102537">,</span>&nbsp;<span class="ident" id="5102539">indir</span>&nbsp;<span class="builtintype" id="5102545">int8</span><span class="op" id="5102549">)</span>&nbsp;<span class="op" id="5102551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102554">if</span>&nbsp;<span class="ident" id="5102557">typ</span>&nbsp;<span class="op" id="5102561">==</span>&nbsp;<span class="ident" id="5102564">nil</span>&nbsp;<span class="op" id="5102568">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102572">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5102580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102583">rt</span>&nbsp;<span class="op" id="5102586">:=</span>&nbsp;<span class="ident" id="5102589">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5102594">//&nbsp;The&nbsp;type&nbsp;might&nbsp;be&nbsp;a&nbsp;pointer&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;keep</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5102646">//&nbsp;dereferencing&nbsp;to&nbsp;the&nbsp;base&nbsp;type&nbsp;until&nbsp;we&nbsp;find&nbsp;an&nbsp;implementation.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102714">for</span>&nbsp;<span class="op" id="5102718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102722">if</span>&nbsp;<span class="ident" id="5102725">rt</span><span class="op" id="5102727">.</span><span class="ident" id="5102728">Implements</span><span class="op" id="5102738">(</span><span class="ident" id="5102739">gobEncDecType</span><span class="op" id="5102752">)</span>&nbsp;<span class="op" id="5102754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102759">return</span>&nbsp;<span class="builtintype" id="5102766">true</span><span class="op" id="5102770">,</span>&nbsp;<span class="ident" id="5102772">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5102780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102784">if</span>&nbsp;<span class="ident" id="5102787">p</span>&nbsp;<span class="op" id="5102789">:=</span>&nbsp;<span class="ident" id="5102792">rt</span><span class="op" id="5102794">;</span>&nbsp;<span class="ident" id="5102796">p</span><span class="op" id="5102797">.</span><span class="ident" id="5102798">Kind</span><span class="op" id="5102802">(</span><span class="op" id="5102803">)</span>&nbsp;<span class="op" id="5102805">==</span>&nbsp;<span class="ident" id="5102808">reflect</span><span class="op" id="5102815">.</span><span class="ident" id="5102816">Ptr</span>&nbsp;<span class="op" id="5102820">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102825">indir</span><span class="op" id="5102830">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102836">if</span>&nbsp;<span class="ident" id="5102839">indir</span>&nbsp;<span class="op" id="5102845">&gt;</span>&nbsp;<span class="num" id="5102847">100</span>&nbsp;<span class="op" id="5102851">{</span>&nbsp;<span class="comment" id="5102853">//&nbsp;insane&nbsp;number&nbsp;of&nbsp;indirections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102890">return</span>&nbsp;<span class="builtintype" id="5102897">false</span><span class="op" id="5102902">,</span>&nbsp;<span class="num" id="5102904">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5102909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102914">rt</span>&nbsp;<span class="op" id="5102917">=</span>&nbsp;<span class="ident" id="5102919">p</span><span class="op" id="5102920">.</span><span class="ident" id="5102921">Elem</span><span class="op" id="5102925">(</span><span class="op" id="5102926">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102931">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5102942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102946">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5102953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5102956">//&nbsp;No&nbsp;luck&nbsp;yet,&nbsp;but&nbsp;if&nbsp;this&nbsp;is&nbsp;a&nbsp;base&nbsp;type&nbsp;(non-pointer),&nbsp;the&nbsp;pointer&nbsp;might&nbsp;satisfy.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103042">if</span>&nbsp;<span class="ident" id="5103045">typ</span><span class="op" id="5103048">.</span><span class="ident" id="5103049">Kind</span><span class="op" id="5103053">(</span><span class="op" id="5103054">)</span>&nbsp;<span class="op" id="5103056">!=</span>&nbsp;<span class="ident" id="5103059">reflect</span><span class="op" id="5103066">.</span><span class="ident" id="5103067">Ptr</span>&nbsp;<span class="op" id="5103071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103075">//&nbsp;Not&nbsp;a&nbsp;pointer,&nbsp;but&nbsp;does&nbsp;the&nbsp;pointer&nbsp;work?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103122">if</span>&nbsp;<span class="ident" id="5103125">reflect</span><span class="op" id="5103132">.</span><span class="ident" id="5103133">PtrTo</span><span class="op" id="5103138">(</span><span class="ident" id="5103139">typ</span><span class="op" id="5103142">)</span><span class="op" id="5103143">.</span><span class="ident" id="5103144">Implements</span><span class="op" id="5103154">(</span><span class="ident" id="5103155">gobEncDecType</span><span class="op" id="5103168">)</span>&nbsp;<span class="op" id="5103170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103175">return</span>&nbsp;<span class="builtintype" id="5103182">true</span><span class="op" id="5103186">,</span>&nbsp;<span class="op" id="5103188">-</span><span class="num" id="5103189">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5103193">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5103196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103199">return</span>&nbsp;<span class="builtintype" id="5103206">false</span><span class="op" id="5103211">,</span>&nbsp;<span class="num" id="5103213">0</span><br>
<span class="lineno"></span><span class="op" id="5103215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5103218">//&nbsp;userType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno">160</span><span class="comment" id="5103305">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;it&nbsp;calls&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="5103355">func</span>&nbsp;<span class="ident" id="5103360">userType</span><span class="op" id="5103368">(</span><span class="ident" id="5103369">rt</span>&nbsp;<span class="ident" id="5103372">reflect</span><span class="op" id="5103379">.</span><span class="ident" id="5103380">Type</span><span class="op" id="5103384">)</span>&nbsp;<span class="op" id="5103386">*</span><span class="ident" id="5103387">userTypeInfo</span>&nbsp;<span class="op" id="5103400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103403">ut</span><span class="op" id="5103405">,</span>&nbsp;<span class="ident" id="5103407">err</span>&nbsp;<span class="op" id="5103411">:=</span>&nbsp;<span class="ident" id="5103414">validUserType</span><span class="op" id="5103427">(</span><span class="ident" id="5103428">rt</span><span class="op" id="5103430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103433">if</span>&nbsp;<span class="ident" id="5103436">err</span>&nbsp;<span class="op" id="5103440">!=</span>&nbsp;<span class="ident" id="5103443">nil</span>&nbsp;<span class="op" id="5103447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103451">error_</span><span class="op" id="5103457">(</span><span class="ident" id="5103458">err</span><span class="op" id="5103461">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5103464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103467">return</span>&nbsp;<span class="ident" id="5103474">ut</span><br>
<span class="lineno"></span><span class="op" id="5103477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5103480">//&nbsp;A&nbsp;typeId&nbsp;represents&nbsp;a&nbsp;gob&nbsp;Type&nbsp;as&nbsp;an&nbsp;integer&nbsp;that&nbsp;can&nbsp;be&nbsp;passed&nbsp;on&nbsp;the&nbsp;wire.</span><br>
<span class="lineno">170</span><span class="comment" id="5103560">//&nbsp;Internally,&nbsp;typeIds&nbsp;are&nbsp;used&nbsp;as&nbsp;keys&nbsp;to&nbsp;a&nbsp;map&nbsp;to&nbsp;recover&nbsp;the&nbsp;underlying&nbsp;type&nbsp;info.</span><br>
<span class="lineno"></span><span class="keyword" id="5103646">type</span>&nbsp;<span class="ident" id="5103651">typeId</span>&nbsp;<span class="builtintype" id="5103658">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5103665">var</span>&nbsp;<span class="ident" id="5103669">nextId</span>&nbsp;<span class="ident" id="5103676">typeId</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5103689">//&nbsp;incremented&nbsp;for&nbsp;each&nbsp;new&nbsp;type&nbsp;we&nbsp;build</span><br>
<span class="lineno"></span><span class="keyword" id="5103731">var</span>&nbsp;<span class="ident" id="5103735">typeLock</span>&nbsp;<span class="ident" id="5103744">sync</span><span class="op" id="5103748">.</span><span class="ident" id="5103749">Mutex</span>&nbsp;<span class="comment" id="5103755">//&nbsp;set&nbsp;while&nbsp;building&nbsp;a&nbsp;type</span><br>
<span class="lineno">175</span><span class="keyword" id="5103784">const</span>&nbsp;<span class="ident" id="5103790">firstUserId</span>&nbsp;<span class="op" id="5103802">=</span>&nbsp;<span class="num" id="5103804">64</span>&nbsp;&nbsp;<span class="comment" id="5103808">//&nbsp;lowest&nbsp;id&nbsp;number&nbsp;granted&nbsp;to&nbsp;user</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5103845">type</span>&nbsp;<span class="ident" id="5103850">gobType</span>&nbsp;<span class="keyword" id="5103858">interface</span>&nbsp;<span class="op" id="5103868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103871">id</span><span class="op" id="5103873">(</span><span class="op" id="5103874">)</span>&nbsp;<span class="ident" id="5103876">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103884">setId</span><span class="op" id="5103889">(</span><span class="ident" id="5103890">id</span>&nbsp;<span class="ident" id="5103893">typeId</span><span class="op" id="5103899">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103902">name</span><span class="op" id="5103906">(</span><span class="op" id="5103907">)</span>&nbsp;<span class="builtintype" id="5103909">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5103917">string</span><span class="op" id="5103923">(</span><span class="op" id="5103924">)</span>&nbsp;<span class="builtintype" id="5103926">string</span>&nbsp;<span class="comment" id="5103933">//&nbsp;not&nbsp;public;&nbsp;only&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103968">safeString</span><span class="op" id="5103978">(</span><span class="ident" id="5103979">seen</span>&nbsp;<span class="keyword" id="5103984">map</span><span class="op" id="5103987">[</span><span class="ident" id="5103988">typeId</span><span class="op" id="5103994">]</span><span class="builtintype" id="5103995">bool</span><span class="op" id="5103999">)</span>&nbsp;<span class="builtintype" id="5104001">string</span><br>
<span class="lineno"></span><span class="op" id="5104008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="5104011">var</span>&nbsp;<span class="ident" id="5104015">types</span>&nbsp;<span class="op" id="5104021">=</span>&nbsp;<span class="builtinfunc" id="5104023">make</span><span class="op" id="5104027">(</span><span class="keyword" id="5104028">map</span><span class="op" id="5104031">[</span><span class="ident" id="5104032">reflect</span><span class="op" id="5104039">.</span><span class="ident" id="5104040">Type</span><span class="op" id="5104044">]</span><span class="ident" id="5104045">gobType</span><span class="op" id="5104052">)</span><br>
<span class="lineno"></span><span class="keyword" id="5104054">var</span>&nbsp;<span class="ident" id="5104058">idToType</span>&nbsp;<span class="op" id="5104067">=</span>&nbsp;<span class="builtinfunc" id="5104069">make</span><span class="op" id="5104073">(</span><span class="keyword" id="5104074">map</span><span class="op" id="5104077">[</span><span class="ident" id="5104078">typeId</span><span class="op" id="5104084">]</span><span class="ident" id="5104085">gobType</span><span class="op" id="5104092">)</span><br>
<span class="lineno"></span><span class="keyword" id="5104094">var</span>&nbsp;<span class="ident" id="5104098">builtinIdToType</span>&nbsp;<span class="keyword" id="5104114">map</span><span class="op" id="5104117">[</span><span class="ident" id="5104118">typeId</span><span class="op" id="5104124">]</span><span class="ident" id="5104125">gobType</span>&nbsp;<span class="comment" id="5104133">//&nbsp;set&nbsp;in&nbsp;init()&nbsp;after&nbsp;builtins&nbsp;are&nbsp;established</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5104182">func</span>&nbsp;<span class="ident" id="5104187">setTypeId</span><span class="op" id="5104196">(</span><span class="ident" id="5104197">typ</span>&nbsp;<span class="ident" id="5104201">gobType</span><span class="op" id="5104208">)</span>&nbsp;<span class="op" id="5104210">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5104213">//&nbsp;When&nbsp;building&nbsp;recursive&nbsp;types,&nbsp;someone&nbsp;may&nbsp;get&nbsp;there&nbsp;before&nbsp;us.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104281">if</span>&nbsp;<span class="ident" id="5104284">typ</span><span class="op" id="5104287">.</span><span class="ident" id="5104288">id</span><span class="op" id="5104290">(</span><span class="op" id="5104291">)</span>&nbsp;<span class="op" id="5104293">!=</span>&nbsp;<span class="num" id="5104296">0</span>&nbsp;<span class="op" id="5104298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104302">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5104310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104313">nextId</span><span class="op" id="5104319">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104323">typ</span><span class="op" id="5104326">.</span><span class="ident" id="5104327">setId</span><span class="op" id="5104332">(</span><span class="ident" id="5104333">nextId</span><span class="op" id="5104339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104342">idToType</span><span class="op" id="5104350">[</span><span class="ident" id="5104351">nextId</span><span class="op" id="5104357">]</span>&nbsp;<span class="op" id="5104359">=</span>&nbsp;<span class="ident" id="5104361">typ</span><br>
<span class="lineno"></span><span class="op" id="5104365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5104368">func</span>&nbsp;<span class="op" id="5104373">(</span><span class="ident" id="5104374">t</span>&nbsp;<span class="ident" id="5104376">typeId</span><span class="op" id="5104382">)</span>&nbsp;<span class="ident" id="5104384">gobType</span><span class="op" id="5104391">(</span><span class="op" id="5104392">)</span>&nbsp;<span class="ident" id="5104394">gobType</span>&nbsp;<span class="op" id="5104402">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104405">if</span>&nbsp;<span class="ident" id="5104408">t</span>&nbsp;<span class="op" id="5104410">==</span>&nbsp;<span class="num" id="5104413">0</span>&nbsp;<span class="op" id="5104415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104419">return</span>&nbsp;<span class="ident" id="5104426">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5104431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104434">return</span>&nbsp;<span class="ident" id="5104441">idToType</span><span class="op" id="5104449">[</span><span class="ident" id="5104450">t</span><span class="op" id="5104451">]</span><br>
<span class="lineno"></span><span class="op" id="5104453">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="5104456">//&nbsp;string&nbsp;returns&nbsp;the&nbsp;string&nbsp;representation&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno"></span><span class="keyword" id="5104540">func</span>&nbsp;<span class="op" id="5104545">(</span><span class="ident" id="5104546">t</span>&nbsp;<span class="ident" id="5104548">typeId</span><span class="op" id="5104554">)</span>&nbsp;<span class="builtintype" id="5104556">string</span><span class="op" id="5104562">(</span><span class="op" id="5104563">)</span>&nbsp;<span class="builtintype" id="5104565">string</span>&nbsp;<span class="op" id="5104572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104575">if</span>&nbsp;<span class="ident" id="5104578">t</span><span class="op" id="5104579">.</span><span class="ident" id="5104580">gobType</span><span class="op" id="5104587">(</span><span class="op" id="5104588">)</span>&nbsp;<span class="op" id="5104590">==</span>&nbsp;<span class="ident" id="5104593">nil</span>&nbsp;<span class="op" id="5104597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104601">return</span>&nbsp;<span class="string" id="5104608">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5104617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104620">return</span>&nbsp;<span class="ident" id="5104627">t</span><span class="op" id="5104628">.</span><span class="ident" id="5104629">gobType</span><span class="op" id="5104636">(</span><span class="op" id="5104637">)</span><span class="op" id="5104638">.</span><span class="builtintype" id="5104639">string</span><span class="op" id="5104645">(</span><span class="op" id="5104646">)</span><br>
<span class="lineno"></span><span class="op" id="5104648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5104651">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno">215</span><span class="keyword" id="5104716">func</span>&nbsp;<span class="op" id="5104721">(</span><span class="ident" id="5104722">t</span>&nbsp;<span class="ident" id="5104724">typeId</span><span class="op" id="5104730">)</span>&nbsp;<span class="ident" id="5104732">name</span><span class="op" id="5104736">(</span><span class="op" id="5104737">)</span>&nbsp;<span class="builtintype" id="5104739">string</span>&nbsp;<span class="op" id="5104746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104749">if</span>&nbsp;<span class="ident" id="5104752">t</span><span class="op" id="5104753">.</span><span class="ident" id="5104754">gobType</span><span class="op" id="5104761">(</span><span class="op" id="5104762">)</span>&nbsp;<span class="op" id="5104764">==</span>&nbsp;<span class="ident" id="5104767">nil</span>&nbsp;<span class="op" id="5104771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104775">return</span>&nbsp;<span class="string" id="5104782">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5104791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104794">return</span>&nbsp;<span class="ident" id="5104801">t</span><span class="op" id="5104802">.</span><span class="ident" id="5104803">gobType</span><span class="op" id="5104810">(</span><span class="op" id="5104811">)</span><span class="op" id="5104812">.</span><span class="ident" id="5104813">name</span><span class="op" id="5104817">(</span><span class="op" id="5104818">)</span><br>
<span class="lineno">220</span><span class="op" id="5104820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5104823">//&nbsp;CommonType&nbsp;holds&nbsp;elements&nbsp;of&nbsp;all&nbsp;types.</span><br>
<span class="lineno"></span><span class="comment" id="5104866">//&nbsp;It&nbsp;is&nbsp;a&nbsp;historical&nbsp;artifact,&nbsp;kept&nbsp;for&nbsp;binary&nbsp;compatibility&nbsp;and&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="5104941">//&nbsp;only&nbsp;for&nbsp;the&nbsp;benefit&nbsp;of&nbsp;the&nbsp;package&#39;s&nbsp;encoding&nbsp;of&nbsp;type&nbsp;descriptors.&nbsp;It&nbsp;is</span><br>
<span class="lineno">225</span><span class="comment" id="5105018">//&nbsp;not&nbsp;intended&nbsp;for&nbsp;direct&nbsp;use&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="5105061">type</span>&nbsp;<span class="ident" id="5105066">CommonType</span>&nbsp;<span class="keyword" id="5105077">struct</span>&nbsp;<span class="op" id="5105084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105087">Name</span>&nbsp;<span class="builtintype" id="5105092">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105100">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5105105">typeId</span><br>
<span class="lineno"></span><span class="op" id="5105112">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="5105115">func</span>&nbsp;<span class="op" id="5105120">(</span><span class="ident" id="5105121">t</span>&nbsp;<span class="op" id="5105123">*</span><span class="ident" id="5105124">CommonType</span><span class="op" id="5105134">)</span>&nbsp;<span class="ident" id="5105136">id</span><span class="op" id="5105138">(</span><span class="op" id="5105139">)</span>&nbsp;<span class="ident" id="5105141">typeId</span>&nbsp;<span class="op" id="5105148">{</span>&nbsp;<span class="keyword" id="5105150">return</span>&nbsp;<span class="ident" id="5105157">t</span><span class="op" id="5105158">.</span><span class="ident" id="5105159">Id</span>&nbsp;<span class="op" id="5105162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5105165">func</span>&nbsp;<span class="op" id="5105170">(</span><span class="ident" id="5105171">t</span>&nbsp;<span class="op" id="5105173">*</span><span class="ident" id="5105174">CommonType</span><span class="op" id="5105184">)</span>&nbsp;<span class="ident" id="5105186">setId</span><span class="op" id="5105191">(</span><span class="ident" id="5105192">id</span>&nbsp;<span class="ident" id="5105195">typeId</span><span class="op" id="5105201">)</span>&nbsp;<span class="op" id="5105203">{</span>&nbsp;<span class="ident" id="5105205">t</span><span class="op" id="5105206">.</span><span class="ident" id="5105207">Id</span>&nbsp;<span class="op" id="5105210">=</span>&nbsp;<span class="ident" id="5105212">id</span>&nbsp;<span class="op" id="5105215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="5105218">func</span>&nbsp;<span class="op" id="5105223">(</span><span class="ident" id="5105224">t</span>&nbsp;<span class="op" id="5105226">*</span><span class="ident" id="5105227">CommonType</span><span class="op" id="5105237">)</span>&nbsp;<span class="builtintype" id="5105239">string</span><span class="op" id="5105245">(</span><span class="op" id="5105246">)</span>&nbsp;<span class="builtintype" id="5105248">string</span>&nbsp;<span class="op" id="5105255">{</span>&nbsp;<span class="keyword" id="5105257">return</span>&nbsp;<span class="ident" id="5105264">t</span><span class="op" id="5105265">.</span><span class="ident" id="5105266">Name</span>&nbsp;<span class="op" id="5105271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5105274">func</span>&nbsp;<span class="op" id="5105279">(</span><span class="ident" id="5105280">t</span>&nbsp;<span class="op" id="5105282">*</span><span class="ident" id="5105283">CommonType</span><span class="op" id="5105293">)</span>&nbsp;<span class="ident" id="5105295">safeString</span><span class="op" id="5105305">(</span><span class="ident" id="5105306">seen</span>&nbsp;<span class="keyword" id="5105311">map</span><span class="op" id="5105314">[</span><span class="ident" id="5105315">typeId</span><span class="op" id="5105321">]</span><span class="builtintype" id="5105322">bool</span><span class="op" id="5105326">)</span>&nbsp;<span class="builtintype" id="5105328">string</span>&nbsp;<span class="op" id="5105335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5105338">return</span>&nbsp;<span class="ident" id="5105345">t</span><span class="op" id="5105346">.</span><span class="ident" id="5105347">Name</span><br>
<span class="lineno"></span><span class="op" id="5105352">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="5105355">func</span>&nbsp;<span class="op" id="5105360">(</span><span class="ident" id="5105361">t</span>&nbsp;<span class="op" id="5105363">*</span><span class="ident" id="5105364">CommonType</span><span class="op" id="5105374">)</span>&nbsp;<span class="ident" id="5105376">name</span><span class="op" id="5105380">(</span><span class="op" id="5105381">)</span>&nbsp;<span class="builtintype" id="5105383">string</span>&nbsp;<span class="op" id="5105390">{</span>&nbsp;<span class="keyword" id="5105392">return</span>&nbsp;<span class="ident" id="5105399">t</span><span class="op" id="5105400">.</span><span class="ident" id="5105401">Name</span>&nbsp;<span class="op" id="5105406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5105409">//&nbsp;Create&nbsp;and&nbsp;check&nbsp;predefined&nbsp;types</span><br>
<span class="lineno"></span><span class="comment" id="5105446">//&nbsp;The&nbsp;string&nbsp;for&nbsp;tBytes&nbsp;is&nbsp;&#34;bytes&#34;&nbsp;not&nbsp;&#34;[]byte&#34;&nbsp;to&nbsp;signify&nbsp;its&nbsp;specialness.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="5105524">var</span>&nbsp;<span class="op" id="5105528">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5105531">//&nbsp;Primordial&nbsp;types,&nbsp;needed&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5105583">//&nbsp;Always&nbsp;passed&nbsp;as&nbsp;pointers&nbsp;so&nbsp;the&nbsp;interface{}&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5105637">//&nbsp;goes&nbsp;through&nbsp;without&nbsp;losing&nbsp;its&nbsp;interfaceness.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105688">tBool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5105699">=</span>&nbsp;<span class="ident" id="5105701">bootstrapType</span><span class="op" id="5105714">(</span><span class="string" id="5105715">&#34;bool&#34;</span><span class="op" id="5105721">,</span>&nbsp;<span class="op" id="5105723">(</span><span class="op" id="5105724">*</span><span class="builtintype" id="5105725">bool</span><span class="op" id="5105729">)</span><span class="op" id="5105730">(</span><span class="ident" id="5105731">nil</span><span class="op" id="5105734">)</span><span class="op" id="5105735">,</span>&nbsp;<span class="num" id="5105737">1</span><span class="op" id="5105738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105741">tInt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5105752">=</span>&nbsp;<span class="ident" id="5105754">bootstrapType</span><span class="op" id="5105767">(</span><span class="string" id="5105768">&#34;int&#34;</span><span class="op" id="5105773">,</span>&nbsp;<span class="op" id="5105775">(</span><span class="op" id="5105776">*</span><span class="builtintype" id="5105777">int</span><span class="op" id="5105780">)</span><span class="op" id="5105781">(</span><span class="ident" id="5105782">nil</span><span class="op" id="5105785">)</span><span class="op" id="5105786">,</span>&nbsp;<span class="num" id="5105788">2</span><span class="op" id="5105789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105792">tUint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5105803">=</span>&nbsp;<span class="ident" id="5105805">bootstrapType</span><span class="op" id="5105818">(</span><span class="string" id="5105819">&#34;uint&#34;</span><span class="op" id="5105825">,</span>&nbsp;<span class="op" id="5105827">(</span><span class="op" id="5105828">*</span><span class="builtintype" id="5105829">uint</span><span class="op" id="5105833">)</span><span class="op" id="5105834">(</span><span class="ident" id="5105835">nil</span><span class="op" id="5105838">)</span><span class="op" id="5105839">,</span>&nbsp;<span class="num" id="5105841">3</span><span class="op" id="5105842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105845">tFloat</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5105856">=</span>&nbsp;<span class="ident" id="5105858">bootstrapType</span><span class="op" id="5105871">(</span><span class="string" id="5105872">&#34;float&#34;</span><span class="op" id="5105879">,</span>&nbsp;<span class="op" id="5105881">(</span><span class="op" id="5105882">*</span><span class="builtintype" id="5105883">float64</span><span class="op" id="5105890">)</span><span class="op" id="5105891">(</span><span class="ident" id="5105892">nil</span><span class="op" id="5105895">)</span><span class="op" id="5105896">,</span>&nbsp;<span class="num" id="5105898">4</span><span class="op" id="5105899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105902">tBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5105913">=</span>&nbsp;<span class="ident" id="5105915">bootstrapType</span><span class="op" id="5105928">(</span><span class="string" id="5105929">&#34;bytes&#34;</span><span class="op" id="5105936">,</span>&nbsp;<span class="op" id="5105938">(</span><span class="op" id="5105939">*</span><span class="op" id="5105940">[</span><span class="op" id="5105941">]</span><span class="builtintype" id="5105942">byte</span><span class="op" id="5105946">)</span><span class="op" id="5105947">(</span><span class="ident" id="5105948">nil</span><span class="op" id="5105951">)</span><span class="op" id="5105952">,</span>&nbsp;<span class="num" id="5105954">5</span><span class="op" id="5105955">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105958">tString</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5105969">=</span>&nbsp;<span class="ident" id="5105971">bootstrapType</span><span class="op" id="5105984">(</span><span class="string" id="5105985">&#34;string&#34;</span><span class="op" id="5105993">,</span>&nbsp;<span class="op" id="5105995">(</span><span class="op" id="5105996">*</span><span class="builtintype" id="5105997">string</span><span class="op" id="5106003">)</span><span class="op" id="5106004">(</span><span class="ident" id="5106005">nil</span><span class="op" id="5106008">)</span><span class="op" id="5106009">,</span>&nbsp;<span class="num" id="5106011">6</span><span class="op" id="5106012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106015">tComplex</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5106026">=</span>&nbsp;<span class="ident" id="5106028">bootstrapType</span><span class="op" id="5106041">(</span><span class="string" id="5106042">&#34;complex&#34;</span><span class="op" id="5106051">,</span>&nbsp;<span class="op" id="5106053">(</span><span class="op" id="5106054">*</span><span class="builtintype" id="5106055">complex128</span><span class="op" id="5106065">)</span><span class="op" id="5106066">(</span><span class="ident" id="5106067">nil</span><span class="op" id="5106070">)</span><span class="op" id="5106071">,</span>&nbsp;<span class="num" id="5106073">7</span><span class="op" id="5106074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106077">tInterface</span>&nbsp;<span class="op" id="5106088">=</span>&nbsp;<span class="ident" id="5106090">bootstrapType</span><span class="op" id="5106103">(</span><span class="string" id="5106104">&#34;interface&#34;</span><span class="op" id="5106115">,</span>&nbsp;<span class="op" id="5106117">(</span><span class="op" id="5106118">*</span><span class="keyword" id="5106119">interface</span><span class="op" id="5106128">{</span><span class="op" id="5106129">}</span><span class="op" id="5106130">)</span><span class="op" id="5106131">(</span><span class="ident" id="5106132">nil</span><span class="op" id="5106135">)</span><span class="op" id="5106136">,</span>&nbsp;<span class="num" id="5106138">8</span><span class="op" id="5106139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5106142">//&nbsp;Reserve&nbsp;some&nbsp;Ids&nbsp;for&nbsp;compatible&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106188">tReserved7</span>&nbsp;<span class="op" id="5106199">=</span>&nbsp;<span class="ident" id="5106201">bootstrapType</span><span class="op" id="5106214">(</span><span class="string" id="5106215">&#34;_reserved1&#34;</span><span class="op" id="5106227">,</span>&nbsp;<span class="op" id="5106229">(</span><span class="op" id="5106230">*</span><span class="keyword" id="5106231">struct</span><span class="op" id="5106237">{</span>&nbsp;<span class="ident" id="5106239">r7</span>&nbsp;<span class="builtintype" id="5106242">int</span>&nbsp;<span class="op" id="5106246">}</span><span class="op" id="5106247">)</span><span class="op" id="5106248">(</span><span class="ident" id="5106249">nil</span><span class="op" id="5106252">)</span><span class="op" id="5106253">,</span>&nbsp;<span class="num" id="5106255">9</span><span class="op" id="5106256">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106259">tReserved6</span>&nbsp;<span class="op" id="5106270">=</span>&nbsp;<span class="ident" id="5106272">bootstrapType</span><span class="op" id="5106285">(</span><span class="string" id="5106286">&#34;_reserved1&#34;</span><span class="op" id="5106298">,</span>&nbsp;<span class="op" id="5106300">(</span><span class="op" id="5106301">*</span><span class="keyword" id="5106302">struct</span><span class="op" id="5106308">{</span>&nbsp;<span class="ident" id="5106310">r6</span>&nbsp;<span class="builtintype" id="5106313">int</span>&nbsp;<span class="op" id="5106317">}</span><span class="op" id="5106318">)</span><span class="op" id="5106319">(</span><span class="ident" id="5106320">nil</span><span class="op" id="5106323">)</span><span class="op" id="5106324">,</span>&nbsp;<span class="num" id="5106326">10</span><span class="op" id="5106328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106331">tReserved5</span>&nbsp;<span class="op" id="5106342">=</span>&nbsp;<span class="ident" id="5106344">bootstrapType</span><span class="op" id="5106357">(</span><span class="string" id="5106358">&#34;_reserved1&#34;</span><span class="op" id="5106370">,</span>&nbsp;<span class="op" id="5106372">(</span><span class="op" id="5106373">*</span><span class="keyword" id="5106374">struct</span><span class="op" id="5106380">{</span>&nbsp;<span class="ident" id="5106382">r5</span>&nbsp;<span class="builtintype" id="5106385">int</span>&nbsp;<span class="op" id="5106389">}</span><span class="op" id="5106390">)</span><span class="op" id="5106391">(</span><span class="ident" id="5106392">nil</span><span class="op" id="5106395">)</span><span class="op" id="5106396">,</span>&nbsp;<span class="num" id="5106398">11</span><span class="op" id="5106400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106403">tReserved4</span>&nbsp;<span class="op" id="5106414">=</span>&nbsp;<span class="ident" id="5106416">bootstrapType</span><span class="op" id="5106429">(</span><span class="string" id="5106430">&#34;_reserved1&#34;</span><span class="op" id="5106442">,</span>&nbsp;<span class="op" id="5106444">(</span><span class="op" id="5106445">*</span><span class="keyword" id="5106446">struct</span><span class="op" id="5106452">{</span>&nbsp;<span class="ident" id="5106454">r4</span>&nbsp;<span class="builtintype" id="5106457">int</span>&nbsp;<span class="op" id="5106461">}</span><span class="op" id="5106462">)</span><span class="op" id="5106463">(</span><span class="ident" id="5106464">nil</span><span class="op" id="5106467">)</span><span class="op" id="5106468">,</span>&nbsp;<span class="num" id="5106470">12</span><span class="op" id="5106472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106475">tReserved3</span>&nbsp;<span class="op" id="5106486">=</span>&nbsp;<span class="ident" id="5106488">bootstrapType</span><span class="op" id="5106501">(</span><span class="string" id="5106502">&#34;_reserved1&#34;</span><span class="op" id="5106514">,</span>&nbsp;<span class="op" id="5106516">(</span><span class="op" id="5106517">*</span><span class="keyword" id="5106518">struct</span><span class="op" id="5106524">{</span>&nbsp;<span class="ident" id="5106526">r3</span>&nbsp;<span class="builtintype" id="5106529">int</span>&nbsp;<span class="op" id="5106533">}</span><span class="op" id="5106534">)</span><span class="op" id="5106535">(</span><span class="ident" id="5106536">nil</span><span class="op" id="5106539">)</span><span class="op" id="5106540">,</span>&nbsp;<span class="num" id="5106542">13</span><span class="op" id="5106544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106547">tReserved2</span>&nbsp;<span class="op" id="5106558">=</span>&nbsp;<span class="ident" id="5106560">bootstrapType</span><span class="op" id="5106573">(</span><span class="string" id="5106574">&#34;_reserved1&#34;</span><span class="op" id="5106586">,</span>&nbsp;<span class="op" id="5106588">(</span><span class="op" id="5106589">*</span><span class="keyword" id="5106590">struct</span><span class="op" id="5106596">{</span>&nbsp;<span class="ident" id="5106598">r2</span>&nbsp;<span class="builtintype" id="5106601">int</span>&nbsp;<span class="op" id="5106605">}</span><span class="op" id="5106606">)</span><span class="op" id="5106607">(</span><span class="ident" id="5106608">nil</span><span class="op" id="5106611">)</span><span class="op" id="5106612">,</span>&nbsp;<span class="num" id="5106614">14</span><span class="op" id="5106616">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106619">tReserved1</span>&nbsp;<span class="op" id="5106630">=</span>&nbsp;<span class="ident" id="5106632">bootstrapType</span><span class="op" id="5106645">(</span><span class="string" id="5106646">&#34;_reserved1&#34;</span><span class="op" id="5106658">,</span>&nbsp;<span class="op" id="5106660">(</span><span class="op" id="5106661">*</span><span class="keyword" id="5106662">struct</span><span class="op" id="5106668">{</span>&nbsp;<span class="ident" id="5106670">r1</span>&nbsp;<span class="builtintype" id="5106673">int</span>&nbsp;<span class="op" id="5106677">}</span><span class="op" id="5106678">)</span><span class="op" id="5106679">(</span><span class="ident" id="5106680">nil</span><span class="op" id="5106683">)</span><span class="op" id="5106684">,</span>&nbsp;<span class="num" id="5106686">15</span><span class="op" id="5106688">)</span><br>
<span class="lineno"></span><span class="op" id="5106690">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5106693">//&nbsp;Predefined&nbsp;because&nbsp;it&#39;s&nbsp;needed&nbsp;by&nbsp;the&nbsp;Decoder</span><br>
<span class="lineno"></span><span class="keyword" id="5106742">var</span>&nbsp;<span class="ident" id="5106746">tWireType</span>&nbsp;<span class="op" id="5106756">=</span>&nbsp;<span class="ident" id="5106758">mustGetTypeInfo</span><span class="op" id="5106773">(</span><span class="ident" id="5106774">reflect</span><span class="op" id="5106781">.</span><span class="ident" id="5106782">TypeOf</span><span class="op" id="5106788">(</span><span class="ident" id="5106789">wireType</span><span class="op" id="5106797">{</span><span class="op" id="5106798">}</span><span class="op" id="5106799">)</span><span class="op" id="5106800">)</span><span class="op" id="5106801">.</span><span class="ident" id="5106802">id</span><br>
<span class="lineno">270</span><span class="keyword" id="5106805">var</span>&nbsp;<span class="ident" id="5106809">wireTypeUserInfo</span>&nbsp;<span class="op" id="5106826">*</span><span class="ident" id="5106827">userTypeInfo</span>&nbsp;<span class="comment" id="5106840">//&nbsp;userTypeInfo&nbsp;of&nbsp;(*wireType)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5106872">func</span>&nbsp;<span class="ident" id="5106877">init</span><span class="op" id="5106881">(</span><span class="op" id="5106882">)</span>&nbsp;<span class="op" id="5106884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5106887">//&nbsp;Some&nbsp;magic&nbsp;numbers&nbsp;to&nbsp;make&nbsp;sure&nbsp;there&nbsp;are&nbsp;no&nbsp;surprises.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106947">checkId</span><span class="op" id="5106954">(</span><span class="num" id="5106955">16</span><span class="op" id="5106957">,</span>&nbsp;<span class="ident" id="5106959">tWireType</span><span class="op" id="5106968">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106971">checkId</span><span class="op" id="5106978">(</span><span class="num" id="5106979">17</span><span class="op" id="5106981">,</span>&nbsp;<span class="ident" id="5106983">mustGetTypeInfo</span><span class="op" id="5106998">(</span><span class="ident" id="5106999">reflect</span><span class="op" id="5107006">.</span><span class="ident" id="5107007">TypeOf</span><span class="op" id="5107013">(</span><span class="ident" id="5107014">arrayType</span><span class="op" id="5107023">{</span><span class="op" id="5107024">}</span><span class="op" id="5107025">)</span><span class="op" id="5107026">)</span><span class="op" id="5107027">.</span><span class="ident" id="5107028">id</span><span class="op" id="5107030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107033">checkId</span><span class="op" id="5107040">(</span><span class="num" id="5107041">18</span><span class="op" id="5107043">,</span>&nbsp;<span class="ident" id="5107045">mustGetTypeInfo</span><span class="op" id="5107060">(</span><span class="ident" id="5107061">reflect</span><span class="op" id="5107068">.</span><span class="ident" id="5107069">TypeOf</span><span class="op" id="5107075">(</span><span class="ident" id="5107076">CommonType</span><span class="op" id="5107086">{</span><span class="op" id="5107087">}</span><span class="op" id="5107088">)</span><span class="op" id="5107089">)</span><span class="op" id="5107090">.</span><span class="ident" id="5107091">id</span><span class="op" id="5107093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107096">checkId</span><span class="op" id="5107103">(</span><span class="num" id="5107104">19</span><span class="op" id="5107106">,</span>&nbsp;<span class="ident" id="5107108">mustGetTypeInfo</span><span class="op" id="5107123">(</span><span class="ident" id="5107124">reflect</span><span class="op" id="5107131">.</span><span class="ident" id="5107132">TypeOf</span><span class="op" id="5107138">(</span><span class="ident" id="5107139">sliceType</span><span class="op" id="5107148">{</span><span class="op" id="5107149">}</span><span class="op" id="5107150">)</span><span class="op" id="5107151">)</span><span class="op" id="5107152">.</span><span class="ident" id="5107153">id</span><span class="op" id="5107155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107158">checkId</span><span class="op" id="5107165">(</span><span class="num" id="5107166">20</span><span class="op" id="5107168">,</span>&nbsp;<span class="ident" id="5107170">mustGetTypeInfo</span><span class="op" id="5107185">(</span><span class="ident" id="5107186">reflect</span><span class="op" id="5107193">.</span><span class="ident" id="5107194">TypeOf</span><span class="op" id="5107200">(</span><span class="ident" id="5107201">structType</span><span class="op" id="5107211">{</span><span class="op" id="5107212">}</span><span class="op" id="5107213">)</span><span class="op" id="5107214">)</span><span class="op" id="5107215">.</span><span class="ident" id="5107216">id</span><span class="op" id="5107218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107221">checkId</span><span class="op" id="5107228">(</span><span class="num" id="5107229">21</span><span class="op" id="5107231">,</span>&nbsp;<span class="ident" id="5107233">mustGetTypeInfo</span><span class="op" id="5107248">(</span><span class="ident" id="5107249">reflect</span><span class="op" id="5107256">.</span><span class="ident" id="5107257">TypeOf</span><span class="op" id="5107263">(</span><span class="ident" id="5107264">fieldType</span><span class="op" id="5107273">{</span><span class="op" id="5107274">}</span><span class="op" id="5107275">)</span><span class="op" id="5107276">)</span><span class="op" id="5107277">.</span><span class="ident" id="5107278">id</span><span class="op" id="5107280">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107283">checkId</span><span class="op" id="5107290">(</span><span class="num" id="5107291">23</span><span class="op" id="5107293">,</span>&nbsp;<span class="ident" id="5107295">mustGetTypeInfo</span><span class="op" id="5107310">(</span><span class="ident" id="5107311">reflect</span><span class="op" id="5107318">.</span><span class="ident" id="5107319">TypeOf</span><span class="op" id="5107325">(</span><span class="ident" id="5107326">mapType</span><span class="op" id="5107333">{</span><span class="op" id="5107334">}</span><span class="op" id="5107335">)</span><span class="op" id="5107336">)</span><span class="op" id="5107337">.</span><span class="ident" id="5107338">id</span><span class="op" id="5107340">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107344">builtinIdToType</span>&nbsp;<span class="op" id="5107360">=</span>&nbsp;<span class="builtinfunc" id="5107362">make</span><span class="op" id="5107366">(</span><span class="keyword" id="5107367">map</span><span class="op" id="5107370">[</span><span class="ident" id="5107371">typeId</span><span class="op" id="5107377">]</span><span class="ident" id="5107378">gobType</span><span class="op" id="5107385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107388">for</span>&nbsp;<span class="ident" id="5107392">k</span><span class="op" id="5107393">,</span>&nbsp;<span class="ident" id="5107395">v</span>&nbsp;<span class="op" id="5107397">:=</span>&nbsp;<span class="keyword" id="5107400">range</span>&nbsp;<span class="ident" id="5107406">idToType</span>&nbsp;<span class="op" id="5107415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107419">builtinIdToType</span><span class="op" id="5107434">[</span><span class="ident" id="5107435">k</span><span class="op" id="5107436">]</span>&nbsp;<span class="op" id="5107438">=</span>&nbsp;<span class="ident" id="5107440">v</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5107447">//&nbsp;Move&nbsp;the&nbsp;id&nbsp;space&nbsp;upwards&nbsp;to&nbsp;allow&nbsp;for&nbsp;growth&nbsp;in&nbsp;the&nbsp;predefined&nbsp;world</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5107521">//&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107558">if</span>&nbsp;<span class="ident" id="5107561">nextId</span>&nbsp;<span class="op" id="5107568">&gt;</span>&nbsp;<span class="ident" id="5107570">firstUserId</span>&nbsp;<span class="op" id="5107582">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5107586">panic</span><span class="op" id="5107591">(</span><span class="ident" id="5107592">fmt</span><span class="op" id="5107595">.</span><span class="ident" id="5107596">Sprintln</span><span class="op" id="5107604">(</span><span class="string" id="5107605">&#34;nextId&nbsp;too&nbsp;large:&#34;</span><span class="op" id="5107624">,</span>&nbsp;<span class="ident" id="5107626">nextId</span><span class="op" id="5107632">)</span><span class="op" id="5107633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107639">nextId</span>&nbsp;<span class="op" id="5107646">=</span>&nbsp;<span class="ident" id="5107648">firstUserId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107661">registerBasics</span><span class="op" id="5107675">(</span><span class="op" id="5107676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107679">wireTypeUserInfo</span>&nbsp;<span class="op" id="5107696">=</span>&nbsp;<span class="ident" id="5107698">userType</span><span class="op" id="5107706">(</span><span class="ident" id="5107707">reflect</span><span class="op" id="5107714">.</span><span class="ident" id="5107715">TypeOf</span><span class="op" id="5107721">(</span><span class="op" id="5107722">(</span><span class="op" id="5107723">*</span><span class="ident" id="5107724">wireType</span><span class="op" id="5107732">)</span><span class="op" id="5107733">(</span><span class="ident" id="5107734">nil</span><span class="op" id="5107737">)</span><span class="op" id="5107738">)</span><span class="op" id="5107739">)</span><br>
<span class="lineno">295</span><span class="op" id="5107741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5107744">//&nbsp;Array&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="5107758">type</span>&nbsp;<span class="ident" id="5107763">arrayType</span>&nbsp;<span class="keyword" id="5107773">struct</span>&nbsp;<span class="op" id="5107780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107783">CommonType</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107795">Elem</span>&nbsp;<span class="ident" id="5107800">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107808">Len</span>&nbsp;&nbsp;<span class="builtintype" id="5107813">int</span><br>
<span class="lineno"></span><span class="op" id="5107817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5107820">func</span>&nbsp;<span class="ident" id="5107825">newArrayType</span><span class="op" id="5107837">(</span><span class="ident" id="5107838">name</span>&nbsp;<span class="builtintype" id="5107843">string</span><span class="op" id="5107849">)</span>&nbsp;<span class="op" id="5107851">*</span><span class="ident" id="5107852">arrayType</span>&nbsp;<span class="op" id="5107862">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107865">a</span>&nbsp;<span class="op" id="5107867">:=</span>&nbsp;<span class="op" id="5107870">&amp;</span><span class="ident" id="5107871">arrayType</span><span class="op" id="5107880">{</span><span class="ident" id="5107881">CommonType</span><span class="op" id="5107891">{</span><span class="ident" id="5107892">Name</span><span class="op" id="5107896">:</span>&nbsp;<span class="ident" id="5107898">name</span><span class="op" id="5107902">}</span><span class="op" id="5107903">,</span>&nbsp;<span class="num" id="5107905">0</span><span class="op" id="5107906">,</span>&nbsp;<span class="num" id="5107908">0</span><span class="op" id="5107909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107912">return</span>&nbsp;<span class="ident" id="5107919">a</span><br>
<span class="lineno"></span><span class="op" id="5107921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5107924">func</span>&nbsp;<span class="op" id="5107929">(</span><span class="ident" id="5107930">a</span>&nbsp;<span class="op" id="5107932">*</span><span class="ident" id="5107933">arrayType</span><span class="op" id="5107942">)</span>&nbsp;<span class="ident" id="5107944">init</span><span class="op" id="5107948">(</span><span class="ident" id="5107949">elem</span>&nbsp;<span class="ident" id="5107954">gobType</span><span class="op" id="5107961">,</span>&nbsp;<span class="builtinfunc" id="5107963">len</span>&nbsp;<span class="builtintype" id="5107967">int</span><span class="op" id="5107970">)</span>&nbsp;<span class="op" id="5107972">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5107975">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108050">setTypeId</span><span class="op" id="5108059">(</span><span class="ident" id="5108060">a</span><span class="op" id="5108061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108064">a</span><span class="op" id="5108065">.</span><span class="ident" id="5108066">Elem</span>&nbsp;<span class="op" id="5108071">=</span>&nbsp;<span class="ident" id="5108073">elem</span><span class="op" id="5108077">.</span><span class="ident" id="5108078">id</span><span class="op" id="5108080">(</span><span class="op" id="5108081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108084">a</span><span class="op" id="5108085">.</span><span class="ident" id="5108086">Len</span>&nbsp;<span class="op" id="5108090">=</span>&nbsp;<span class="builtinfunc" id="5108092">len</span><br>
<span class="lineno"></span><span class="op" id="5108096">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="5108099">func</span>&nbsp;<span class="op" id="5108104">(</span><span class="ident" id="5108105">a</span>&nbsp;<span class="op" id="5108107">*</span><span class="ident" id="5108108">arrayType</span><span class="op" id="5108117">)</span>&nbsp;<span class="ident" id="5108119">safeString</span><span class="op" id="5108129">(</span><span class="ident" id="5108130">seen</span>&nbsp;<span class="keyword" id="5108135">map</span><span class="op" id="5108138">[</span><span class="ident" id="5108139">typeId</span><span class="op" id="5108145">]</span><span class="builtintype" id="5108146">bool</span><span class="op" id="5108150">)</span>&nbsp;<span class="builtintype" id="5108152">string</span>&nbsp;<span class="op" id="5108159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108162">if</span>&nbsp;<span class="ident" id="5108165">seen</span><span class="op" id="5108169">[</span><span class="ident" id="5108170">a</span><span class="op" id="5108171">.</span><span class="ident" id="5108172">Id</span><span class="op" id="5108174">]</span>&nbsp;<span class="op" id="5108176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108180">return</span>&nbsp;<span class="ident" id="5108187">a</span><span class="op" id="5108188">.</span><span class="ident" id="5108189">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5108195">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108198">seen</span><span class="op" id="5108202">[</span><span class="ident" id="5108203">a</span><span class="op" id="5108204">.</span><span class="ident" id="5108205">Id</span><span class="op" id="5108207">]</span>&nbsp;<span class="op" id="5108209">=</span>&nbsp;<span class="builtintype" id="5108211">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108217">return</span>&nbsp;<span class="ident" id="5108224">fmt</span><span class="op" id="5108227">.</span><span class="ident" id="5108228">Sprintf</span><span class="op" id="5108235">(</span><span class="string" id="5108236">&#34;[%d]%s&#34;</span><span class="op" id="5108244">,</span>&nbsp;<span class="ident" id="5108246">a</span><span class="op" id="5108247">.</span><span class="ident" id="5108248">Len</span><span class="op" id="5108251">,</span>&nbsp;<span class="ident" id="5108253">a</span><span class="op" id="5108254">.</span><span class="ident" id="5108255">Elem</span><span class="op" id="5108259">.</span><span class="ident" id="5108260">gobType</span><span class="op" id="5108267">(</span><span class="op" id="5108268">)</span><span class="op" id="5108269">.</span><span class="ident" id="5108270">safeString</span><span class="op" id="5108280">(</span><span class="ident" id="5108281">seen</span><span class="op" id="5108285">)</span><span class="op" id="5108286">)</span><br>
<span class="lineno"></span><span class="op" id="5108288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5108291">func</span>&nbsp;<span class="op" id="5108296">(</span><span class="ident" id="5108297">a</span>&nbsp;<span class="op" id="5108299">*</span><span class="ident" id="5108300">arrayType</span><span class="op" id="5108309">)</span>&nbsp;<span class="builtintype" id="5108311">string</span><span class="op" id="5108317">(</span><span class="op" id="5108318">)</span>&nbsp;<span class="builtintype" id="5108320">string</span>&nbsp;<span class="op" id="5108327">{</span>&nbsp;<span class="keyword" id="5108329">return</span>&nbsp;<span class="ident" id="5108336">a</span><span class="op" id="5108337">.</span><span class="ident" id="5108338">safeString</span><span class="op" id="5108348">(</span><span class="builtinfunc" id="5108349">make</span><span class="op" id="5108353">(</span><span class="keyword" id="5108354">map</span><span class="op" id="5108357">[</span><span class="ident" id="5108358">typeId</span><span class="op" id="5108364">]</span><span class="builtintype" id="5108365">bool</span><span class="op" id="5108369">)</span><span class="op" id="5108370">)</span>&nbsp;<span class="op" id="5108372">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="5108375">//&nbsp;GobEncoder&nbsp;type&nbsp;(something&nbsp;that&nbsp;implements&nbsp;the&nbsp;GobEncoder&nbsp;interface)</span><br>
<span class="lineno"></span><span class="keyword" id="5108447">type</span>&nbsp;<span class="ident" id="5108452">gobEncoderType</span>&nbsp;<span class="keyword" id="5108467">struct</span>&nbsp;<span class="op" id="5108474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108477">CommonType</span><br>
<span class="lineno"></span><span class="op" id="5108488">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="5108491">func</span>&nbsp;<span class="ident" id="5108496">newGobEncoderType</span><span class="op" id="5108513">(</span><span class="ident" id="5108514">name</span>&nbsp;<span class="builtintype" id="5108519">string</span><span class="op" id="5108525">)</span>&nbsp;<span class="op" id="5108527">*</span><span class="ident" id="5108528">gobEncoderType</span>&nbsp;<span class="op" id="5108543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108546">g</span>&nbsp;<span class="op" id="5108548">:=</span>&nbsp;<span class="op" id="5108551">&amp;</span><span class="ident" id="5108552">gobEncoderType</span><span class="op" id="5108566">{</span><span class="ident" id="5108567">CommonType</span><span class="op" id="5108577">{</span><span class="ident" id="5108578">Name</span><span class="op" id="5108582">:</span>&nbsp;<span class="ident" id="5108584">name</span><span class="op" id="5108588">}</span><span class="op" id="5108589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108592">setTypeId</span><span class="op" id="5108601">(</span><span class="ident" id="5108602">g</span><span class="op" id="5108603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108606">return</span>&nbsp;<span class="ident" id="5108613">g</span><br>
<span class="lineno">335</span><span class="op" id="5108615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5108618">func</span>&nbsp;<span class="op" id="5108623">(</span><span class="ident" id="5108624">g</span>&nbsp;<span class="op" id="5108626">*</span><span class="ident" id="5108627">gobEncoderType</span><span class="op" id="5108641">)</span>&nbsp;<span class="ident" id="5108643">safeString</span><span class="op" id="5108653">(</span><span class="ident" id="5108654">seen</span>&nbsp;<span class="keyword" id="5108659">map</span><span class="op" id="5108662">[</span><span class="ident" id="5108663">typeId</span><span class="op" id="5108669">]</span><span class="builtintype" id="5108670">bool</span><span class="op" id="5108674">)</span>&nbsp;<span class="builtintype" id="5108676">string</span>&nbsp;<span class="op" id="5108683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108686">return</span>&nbsp;<span class="ident" id="5108693">g</span><span class="op" id="5108694">.</span><span class="ident" id="5108695">Name</span><br>
<span class="lineno"></span><span class="op" id="5108700">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="keyword" id="5108703">func</span>&nbsp;<span class="op" id="5108708">(</span><span class="ident" id="5108709">g</span>&nbsp;<span class="op" id="5108711">*</span><span class="ident" id="5108712">gobEncoderType</span><span class="op" id="5108726">)</span>&nbsp;<span class="builtintype" id="5108728">string</span><span class="op" id="5108734">(</span><span class="op" id="5108735">)</span>&nbsp;<span class="builtintype" id="5108737">string</span>&nbsp;<span class="op" id="5108744">{</span>&nbsp;<span class="keyword" id="5108746">return</span>&nbsp;<span class="ident" id="5108753">g</span><span class="op" id="5108754">.</span><span class="ident" id="5108755">Name</span>&nbsp;<span class="op" id="5108760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5108763">//&nbsp;Map&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="5108775">type</span>&nbsp;<span class="ident" id="5108780">mapType</span>&nbsp;<span class="keyword" id="5108788">struct</span>&nbsp;<span class="op" id="5108795">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108798">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108810">Key</span>&nbsp;&nbsp;<span class="ident" id="5108815">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108823">Elem</span>&nbsp;<span class="ident" id="5108828">typeId</span><br>
<span class="lineno"></span><span class="op" id="5108835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="5108838">func</span>&nbsp;<span class="ident" id="5108843">newMapType</span><span class="op" id="5108853">(</span><span class="ident" id="5108854">name</span>&nbsp;<span class="builtintype" id="5108859">string</span><span class="op" id="5108865">)</span>&nbsp;<span class="op" id="5108867">*</span><span class="ident" id="5108868">mapType</span>&nbsp;<span class="op" id="5108876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108879">m</span>&nbsp;<span class="op" id="5108881">:=</span>&nbsp;<span class="op" id="5108884">&amp;</span><span class="ident" id="5108885">mapType</span><span class="op" id="5108892">{</span><span class="ident" id="5108893">CommonType</span><span class="op" id="5108903">{</span><span class="ident" id="5108904">Name</span><span class="op" id="5108908">:</span>&nbsp;<span class="ident" id="5108910">name</span><span class="op" id="5108914">}</span><span class="op" id="5108915">,</span>&nbsp;<span class="num" id="5108917">0</span><span class="op" id="5108918">,</span>&nbsp;<span class="num" id="5108920">0</span><span class="op" id="5108921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108924">return</span>&nbsp;<span class="ident" id="5108931">m</span><br>
<span class="lineno"></span><span class="op" id="5108933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="5108936">func</span>&nbsp;<span class="op" id="5108941">(</span><span class="ident" id="5108942">m</span>&nbsp;<span class="op" id="5108944">*</span><span class="ident" id="5108945">mapType</span><span class="op" id="5108952">)</span>&nbsp;<span class="ident" id="5108954">init</span><span class="op" id="5108958">(</span><span class="ident" id="5108959">key</span><span class="op" id="5108962">,</span>&nbsp;<span class="ident" id="5108964">elem</span>&nbsp;<span class="ident" id="5108969">gobType</span><span class="op" id="5108976">)</span>&nbsp;<span class="op" id="5108978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5108981">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109056">setTypeId</span><span class="op" id="5109065">(</span><span class="ident" id="5109066">m</span><span class="op" id="5109067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109070">m</span><span class="op" id="5109071">.</span><span class="ident" id="5109072">Key</span>&nbsp;<span class="op" id="5109076">=</span>&nbsp;<span class="ident" id="5109078">key</span><span class="op" id="5109081">.</span><span class="ident" id="5109082">id</span><span class="op" id="5109084">(</span><span class="op" id="5109085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109088">m</span><span class="op" id="5109089">.</span><span class="ident" id="5109090">Elem</span>&nbsp;<span class="op" id="5109095">=</span>&nbsp;<span class="ident" id="5109097">elem</span><span class="op" id="5109101">.</span><span class="ident" id="5109102">id</span><span class="op" id="5109104">(</span><span class="op" id="5109105">)</span><br>
<span class="lineno">360</span><span class="op" id="5109107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5109110">func</span>&nbsp;<span class="op" id="5109115">(</span><span class="ident" id="5109116">m</span>&nbsp;<span class="op" id="5109118">*</span><span class="ident" id="5109119">mapType</span><span class="op" id="5109126">)</span>&nbsp;<span class="ident" id="5109128">safeString</span><span class="op" id="5109138">(</span><span class="ident" id="5109139">seen</span>&nbsp;<span class="keyword" id="5109144">map</span><span class="op" id="5109147">[</span><span class="ident" id="5109148">typeId</span><span class="op" id="5109154">]</span><span class="builtintype" id="5109155">bool</span><span class="op" id="5109159">)</span>&nbsp;<span class="builtintype" id="5109161">string</span>&nbsp;<span class="op" id="5109168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5109171">if</span>&nbsp;<span class="ident" id="5109174">seen</span><span class="op" id="5109178">[</span><span class="ident" id="5109179">m</span><span class="op" id="5109180">.</span><span class="ident" id="5109181">Id</span><span class="op" id="5109183">]</span>&nbsp;<span class="op" id="5109185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5109189">return</span>&nbsp;<span class="ident" id="5109196">m</span><span class="op" id="5109197">.</span><span class="ident" id="5109198">Name</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5109204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109207">seen</span><span class="op" id="5109211">[</span><span class="ident" id="5109212">m</span><span class="op" id="5109213">.</span><span class="ident" id="5109214">Id</span><span class="op" id="5109216">]</span>&nbsp;<span class="op" id="5109218">=</span>&nbsp;<span class="builtintype" id="5109220">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109226">key</span>&nbsp;<span class="op" id="5109230">:=</span>&nbsp;<span class="ident" id="5109233">m</span><span class="op" id="5109234">.</span><span class="ident" id="5109235">Key</span><span class="op" id="5109238">.</span><span class="ident" id="5109239">gobType</span><span class="op" id="5109246">(</span><span class="op" id="5109247">)</span><span class="op" id="5109248">.</span><span class="ident" id="5109249">safeString</span><span class="op" id="5109259">(</span><span class="ident" id="5109260">seen</span><span class="op" id="5109264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109267">elem</span>&nbsp;<span class="op" id="5109272">:=</span>&nbsp;<span class="ident" id="5109275">m</span><span class="op" id="5109276">.</span><span class="ident" id="5109277">Elem</span><span class="op" id="5109281">.</span><span class="ident" id="5109282">gobType</span><span class="op" id="5109289">(</span><span class="op" id="5109290">)</span><span class="op" id="5109291">.</span><span class="ident" id="5109292">safeString</span><span class="op" id="5109302">(</span><span class="ident" id="5109303">seen</span><span class="op" id="5109307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5109310">return</span>&nbsp;<span class="ident" id="5109317">fmt</span><span class="op" id="5109320">.</span><span class="ident" id="5109321">Sprintf</span><span class="op" id="5109328">(</span><span class="string" id="5109329">&#34;map[%s]%s&#34;</span><span class="op" id="5109340">,</span>&nbsp;<span class="ident" id="5109342">key</span><span class="op" id="5109345">,</span>&nbsp;<span class="ident" id="5109347">elem</span><span class="op" id="5109351">)</span><br>
<span class="lineno">370</span><span class="op" id="5109353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5109356">func</span>&nbsp;<span class="op" id="5109361">(</span><span class="ident" id="5109362">m</span>&nbsp;<span class="op" id="5109364">*</span><span class="ident" id="5109365">mapType</span><span class="op" id="5109372">)</span>&nbsp;<span class="builtintype" id="5109374">string</span><span class="op" id="5109380">(</span><span class="op" id="5109381">)</span>&nbsp;<span class="builtintype" id="5109383">string</span>&nbsp;<span class="op" id="5109390">{</span>&nbsp;<span class="keyword" id="5109392">return</span>&nbsp;<span class="ident" id="5109399">m</span><span class="op" id="5109400">.</span><span class="ident" id="5109401">safeString</span><span class="op" id="5109411">(</span><span class="builtinfunc" id="5109412">make</span><span class="op" id="5109416">(</span><span class="keyword" id="5109417">map</span><span class="op" id="5109420">[</span><span class="ident" id="5109421">typeId</span><span class="op" id="5109427">]</span><span class="builtintype" id="5109428">bool</span><span class="op" id="5109432">)</span><span class="op" id="5109433">)</span>&nbsp;<span class="op" id="5109435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5109438">//&nbsp;Slice&nbsp;type</span><br>
<span class="lineno">375</span><span class="keyword" id="5109452">type</span>&nbsp;<span class="ident" id="5109457">sliceType</span>&nbsp;<span class="keyword" id="5109467">struct</span>&nbsp;<span class="op" id="5109474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109477">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109489">Elem</span>&nbsp;<span class="ident" id="5109494">typeId</span><br>
<span class="lineno"></span><span class="op" id="5109501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="5109504">func</span>&nbsp;<span class="ident" id="5109509">newSliceType</span><span class="op" id="5109521">(</span><span class="ident" id="5109522">name</span>&nbsp;<span class="builtintype" id="5109527">string</span><span class="op" id="5109533">)</span>&nbsp;<span class="op" id="5109535">*</span><span class="ident" id="5109536">sliceType</span>&nbsp;<span class="op" id="5109546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109549">s</span>&nbsp;<span class="op" id="5109551">:=</span>&nbsp;<span class="op" id="5109554">&amp;</span><span class="ident" id="5109555">sliceType</span><span class="op" id="5109564">{</span><span class="ident" id="5109565">CommonType</span><span class="op" id="5109575">{</span><span class="ident" id="5109576">Name</span><span class="op" id="5109580">:</span>&nbsp;<span class="ident" id="5109582">name</span><span class="op" id="5109586">}</span><span class="op" id="5109587">,</span>&nbsp;<span class="num" id="5109589">0</span><span class="op" id="5109590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5109593">return</span>&nbsp;<span class="ident" id="5109600">s</span><br>
<span class="lineno"></span><span class="op" id="5109602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="5109605">func</span>&nbsp;<span class="op" id="5109610">(</span><span class="ident" id="5109611">s</span>&nbsp;<span class="op" id="5109613">*</span><span class="ident" id="5109614">sliceType</span><span class="op" id="5109623">)</span>&nbsp;<span class="ident" id="5109625">init</span><span class="op" id="5109629">(</span><span class="ident" id="5109630">elem</span>&nbsp;<span class="ident" id="5109635">gobType</span><span class="op" id="5109642">)</span>&nbsp;<span class="op" id="5109644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5109647">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109722">setTypeId</span><span class="op" id="5109731">(</span><span class="ident" id="5109732">s</span><span class="op" id="5109733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5109736">//&nbsp;See&nbsp;the&nbsp;comments&nbsp;about&nbsp;ids&nbsp;in&nbsp;newTypeObject.&nbsp;Only&nbsp;slices&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5109801">//&nbsp;structs&nbsp;have&nbsp;mutual&nbsp;recursion.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5109836">if</span>&nbsp;<span class="ident" id="5109839">elem</span><span class="op" id="5109843">.</span><span class="ident" id="5109844">id</span><span class="op" id="5109846">(</span><span class="op" id="5109847">)</span>&nbsp;<span class="op" id="5109849">==</span>&nbsp;<span class="num" id="5109852">0</span>&nbsp;<span class="op" id="5109854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109858">setTypeId</span><span class="op" id="5109867">(</span><span class="ident" id="5109868">elem</span><span class="op" id="5109872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5109875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109878">s</span><span class="op" id="5109879">.</span><span class="ident" id="5109880">Elem</span>&nbsp;<span class="op" id="5109885">=</span>&nbsp;<span class="ident" id="5109887">elem</span><span class="op" id="5109891">.</span><span class="ident" id="5109892">id</span><span class="op" id="5109894">(</span><span class="op" id="5109895">)</span><br>
<span class="lineno"></span><span class="op" id="5109897">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="5109900">func</span>&nbsp;<span class="op" id="5109905">(</span><span class="ident" id="5109906">s</span>&nbsp;<span class="op" id="5109908">*</span><span class="ident" id="5109909">sliceType</span><span class="op" id="5109918">)</span>&nbsp;<span class="ident" id="5109920">safeString</span><span class="op" id="5109930">(</span><span class="ident" id="5109931">seen</span>&nbsp;<span class="keyword" id="5109936">map</span><span class="op" id="5109939">[</span><span class="ident" id="5109940">typeId</span><span class="op" id="5109946">]</span><span class="builtintype" id="5109947">bool</span><span class="op" id="5109951">)</span>&nbsp;<span class="builtintype" id="5109953">string</span>&nbsp;<span class="op" id="5109960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5109963">if</span>&nbsp;<span class="ident" id="5109966">seen</span><span class="op" id="5109970">[</span><span class="ident" id="5109971">s</span><span class="op" id="5109972">.</span><span class="ident" id="5109973">Id</span><span class="op" id="5109975">]</span>&nbsp;<span class="op" id="5109977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5109981">return</span>&nbsp;<span class="ident" id="5109988">s</span><span class="op" id="5109989">.</span><span class="ident" id="5109990">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5109996">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109999">seen</span><span class="op" id="5110003">[</span><span class="ident" id="5110004">s</span><span class="op" id="5110005">.</span><span class="ident" id="5110006">Id</span><span class="op" id="5110008">]</span>&nbsp;<span class="op" id="5110010">=</span>&nbsp;<span class="builtintype" id="5110012">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110018">return</span>&nbsp;<span class="ident" id="5110025">fmt</span><span class="op" id="5110028">.</span><span class="ident" id="5110029">Sprintf</span><span class="op" id="5110036">(</span><span class="string" id="5110037">&#34;[]%s&#34;</span><span class="op" id="5110043">,</span>&nbsp;<span class="ident" id="5110045">s</span><span class="op" id="5110046">.</span><span class="ident" id="5110047">Elem</span><span class="op" id="5110051">.</span><span class="ident" id="5110052">gobType</span><span class="op" id="5110059">(</span><span class="op" id="5110060">)</span><span class="op" id="5110061">.</span><span class="ident" id="5110062">safeString</span><span class="op" id="5110072">(</span><span class="ident" id="5110073">seen</span><span class="op" id="5110077">)</span><span class="op" id="5110078">)</span><br>
<span class="lineno"></span><span class="op" id="5110080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5110083">func</span>&nbsp;<span class="op" id="5110088">(</span><span class="ident" id="5110089">s</span>&nbsp;<span class="op" id="5110091">*</span><span class="ident" id="5110092">sliceType</span><span class="op" id="5110101">)</span>&nbsp;<span class="builtintype" id="5110103">string</span><span class="op" id="5110109">(</span><span class="op" id="5110110">)</span>&nbsp;<span class="builtintype" id="5110112">string</span>&nbsp;<span class="op" id="5110119">{</span>&nbsp;<span class="keyword" id="5110121">return</span>&nbsp;<span class="ident" id="5110128">s</span><span class="op" id="5110129">.</span><span class="ident" id="5110130">safeString</span><span class="op" id="5110140">(</span><span class="builtinfunc" id="5110141">make</span><span class="op" id="5110145">(</span><span class="keyword" id="5110146">map</span><span class="op" id="5110149">[</span><span class="ident" id="5110150">typeId</span><span class="op" id="5110156">]</span><span class="builtintype" id="5110157">bool</span><span class="op" id="5110161">)</span><span class="op" id="5110162">)</span>&nbsp;<span class="op" id="5110164">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="5110167">//&nbsp;Struct&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="5110182">type</span>&nbsp;<span class="ident" id="5110187">fieldType</span>&nbsp;<span class="keyword" id="5110197">struct</span>&nbsp;<span class="op" id="5110204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110207">Name</span>&nbsp;<span class="builtintype" id="5110212">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110220">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5110225">typeId</span><br>
<span class="lineno">410</span><span class="op" id="5110232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5110235">type</span>&nbsp;<span class="ident" id="5110240">structType</span>&nbsp;<span class="keyword" id="5110251">struct</span>&nbsp;<span class="op" id="5110258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110261">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110273">Field</span>&nbsp;<span class="op" id="5110279">[</span><span class="op" id="5110280">]</span><span class="op" id="5110281">*</span><span class="ident" id="5110282">fieldType</span><br>
<span class="lineno">415</span><span class="op" id="5110292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5110295">func</span>&nbsp;<span class="op" id="5110300">(</span><span class="ident" id="5110301">s</span>&nbsp;<span class="op" id="5110303">*</span><span class="ident" id="5110304">structType</span><span class="op" id="5110314">)</span>&nbsp;<span class="ident" id="5110316">safeString</span><span class="op" id="5110326">(</span><span class="ident" id="5110327">seen</span>&nbsp;<span class="keyword" id="5110332">map</span><span class="op" id="5110335">[</span><span class="ident" id="5110336">typeId</span><span class="op" id="5110342">]</span><span class="builtintype" id="5110343">bool</span><span class="op" id="5110347">)</span>&nbsp;<span class="builtintype" id="5110349">string</span>&nbsp;<span class="op" id="5110356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110359">if</span>&nbsp;<span class="ident" id="5110362">s</span>&nbsp;<span class="op" id="5110364">==</span>&nbsp;<span class="ident" id="5110367">nil</span>&nbsp;<span class="op" id="5110371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110375">return</span>&nbsp;<span class="string" id="5110382">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5110391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110394">if</span>&nbsp;<span class="ident" id="5110397">_</span><span class="op" id="5110398">,</span>&nbsp;<span class="ident" id="5110400">ok</span>&nbsp;<span class="op" id="5110403">:=</span>&nbsp;<span class="ident" id="5110406">seen</span><span class="op" id="5110410">[</span><span class="ident" id="5110411">s</span><span class="op" id="5110412">.</span><span class="ident" id="5110413">Id</span><span class="op" id="5110415">]</span><span class="op" id="5110416">;</span>&nbsp;<span class="ident" id="5110418">ok</span>&nbsp;<span class="op" id="5110421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110425">return</span>&nbsp;<span class="ident" id="5110432">s</span><span class="op" id="5110433">.</span><span class="ident" id="5110434">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5110440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110443">seen</span><span class="op" id="5110447">[</span><span class="ident" id="5110448">s</span><span class="op" id="5110449">.</span><span class="ident" id="5110450">Id</span><span class="op" id="5110452">]</span>&nbsp;<span class="op" id="5110454">=</span>&nbsp;<span class="builtintype" id="5110456">true</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110462">str</span>&nbsp;<span class="op" id="5110466">:=</span>&nbsp;<span class="ident" id="5110469">s</span><span class="op" id="5110470">.</span><span class="ident" id="5110471">Name</span>&nbsp;<span class="op" id="5110476">+</span>&nbsp;<span class="string" id="5110478">&#34;&nbsp;=&nbsp;struct&nbsp;{&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110494">for</span>&nbsp;<span class="ident" id="5110498">_</span><span class="op" id="5110499">,</span>&nbsp;<span class="ident" id="5110501">f</span>&nbsp;<span class="op" id="5110503">:=</span>&nbsp;<span class="keyword" id="5110506">range</span>&nbsp;<span class="ident" id="5110512">s</span><span class="op" id="5110513">.</span><span class="ident" id="5110514">Field</span>&nbsp;<span class="op" id="5110520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110524">str</span>&nbsp;<span class="op" id="5110528">+=</span>&nbsp;<span class="ident" id="5110531">fmt</span><span class="op" id="5110534">.</span><span class="ident" id="5110535">Sprintf</span><span class="op" id="5110542">(</span><span class="string" id="5110543">&#34;%s&nbsp;%s;&nbsp;&#34;</span><span class="op" id="5110552">,</span>&nbsp;<span class="ident" id="5110554">f</span><span class="op" id="5110555">.</span><span class="ident" id="5110556">Name</span><span class="op" id="5110560">,</span>&nbsp;<span class="ident" id="5110562">f</span><span class="op" id="5110563">.</span><span class="ident" id="5110564">Id</span><span class="op" id="5110566">.</span><span class="ident" id="5110567">gobType</span><span class="op" id="5110574">(</span><span class="op" id="5110575">)</span><span class="op" id="5110576">.</span><span class="ident" id="5110577">safeString</span><span class="op" id="5110587">(</span><span class="ident" id="5110588">seen</span><span class="op" id="5110592">)</span><span class="op" id="5110593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5110596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110599">str</span>&nbsp;<span class="op" id="5110603">+=</span>&nbsp;<span class="string" id="5110606">&#34;}&#34;</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110611">return</span>&nbsp;<span class="ident" id="5110618">str</span><br>
<span class="lineno"></span><span class="op" id="5110622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5110625">func</span>&nbsp;<span class="op" id="5110630">(</span><span class="ident" id="5110631">s</span>&nbsp;<span class="op" id="5110633">*</span><span class="ident" id="5110634">structType</span><span class="op" id="5110644">)</span>&nbsp;<span class="builtintype" id="5110646">string</span><span class="op" id="5110652">(</span><span class="op" id="5110653">)</span>&nbsp;<span class="builtintype" id="5110655">string</span>&nbsp;<span class="op" id="5110662">{</span>&nbsp;<span class="keyword" id="5110664">return</span>&nbsp;<span class="ident" id="5110671">s</span><span class="op" id="5110672">.</span><span class="ident" id="5110673">safeString</span><span class="op" id="5110683">(</span><span class="builtinfunc" id="5110684">make</span><span class="op" id="5110688">(</span><span class="keyword" id="5110689">map</span><span class="op" id="5110692">[</span><span class="ident" id="5110693">typeId</span><span class="op" id="5110699">]</span><span class="builtintype" id="5110700">bool</span><span class="op" id="5110704">)</span><span class="op" id="5110705">)</span>&nbsp;<span class="op" id="5110707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="5110710">func</span>&nbsp;<span class="ident" id="5110715">newStructType</span><span class="op" id="5110728">(</span><span class="ident" id="5110729">name</span>&nbsp;<span class="builtintype" id="5110734">string</span><span class="op" id="5110740">)</span>&nbsp;<span class="op" id="5110742">*</span><span class="ident" id="5110743">structType</span>&nbsp;<span class="op" id="5110754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110757">s</span>&nbsp;<span class="op" id="5110759">:=</span>&nbsp;<span class="op" id="5110762">&amp;</span><span class="ident" id="5110763">structType</span><span class="op" id="5110773">{</span><span class="ident" id="5110774">CommonType</span><span class="op" id="5110784">{</span><span class="ident" id="5110785">Name</span><span class="op" id="5110789">:</span>&nbsp;<span class="ident" id="5110791">name</span><span class="op" id="5110795">}</span><span class="op" id="5110796">,</span>&nbsp;<span class="ident" id="5110798">nil</span><span class="op" id="5110801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5110804">//&nbsp;For&nbsp;historical&nbsp;reasons&nbsp;we&nbsp;set&nbsp;the&nbsp;id&nbsp;here&nbsp;rather&nbsp;than&nbsp;init.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5110868">//&nbsp;See&nbsp;the&nbsp;comment&nbsp;in&nbsp;newTypeObject&nbsp;for&nbsp;details.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110918">setTypeId</span><span class="op" id="5110927">(</span><span class="ident" id="5110928">s</span><span class="op" id="5110929">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110932">return</span>&nbsp;<span class="ident" id="5110939">s</span><br>
<span class="lineno"></span><span class="op" id="5110941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5110944">//&nbsp;newTypeObject&nbsp;allocates&nbsp;a&nbsp;gobType&nbsp;for&nbsp;the&nbsp;reflection&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="5111009">//&nbsp;Unless&nbsp;ut&nbsp;represents&nbsp;a&nbsp;GobEncoder,&nbsp;rt&nbsp;should&nbsp;be&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno">445</span><span class="comment" id="5111074">//&nbsp;of&nbsp;ut.</span><br>
<span class="lineno"></span><span class="comment" id="5111084">//&nbsp;This&nbsp;is&nbsp;only&nbsp;called&nbsp;from&nbsp;the&nbsp;encoding&nbsp;side.&nbsp;The&nbsp;decoding&nbsp;side</span><br>
<span class="lineno"></span><span class="comment" id="5111149">//&nbsp;works&nbsp;through&nbsp;typeIds&nbsp;and&nbsp;userTypeInfos&nbsp;alone.</span><br>
<span class="lineno"></span><span class="keyword" id="5111199">func</span>&nbsp;<span class="ident" id="5111204">newTypeObject</span><span class="op" id="5111217">(</span><span class="ident" id="5111218">name</span>&nbsp;<span class="builtintype" id="5111223">string</span><span class="op" id="5111229">,</span>&nbsp;<span class="ident" id="5111231">ut</span>&nbsp;<span class="op" id="5111234">*</span><span class="ident" id="5111235">userTypeInfo</span><span class="op" id="5111247">,</span>&nbsp;<span class="ident" id="5111249">rt</span>&nbsp;<span class="ident" id="5111252">reflect</span><span class="op" id="5111259">.</span><span class="ident" id="5111260">Type</span><span class="op" id="5111264">)</span>&nbsp;<span class="op" id="5111266">(</span><span class="ident" id="5111267">gobType</span><span class="op" id="5111274">,</span>&nbsp;<span class="builtintype" id="5111276">error</span><span class="op" id="5111281">)</span>&nbsp;<span class="op" id="5111283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5111286">//&nbsp;Does&nbsp;this&nbsp;type&nbsp;implement&nbsp;GobEncoder?</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111327">if</span>&nbsp;<span class="ident" id="5111330">ut</span><span class="op" id="5111332">.</span><span class="ident" id="5111333">externalEnc</span>&nbsp;<span class="op" id="5111345">!=</span>&nbsp;<span class="num" id="5111348">0</span>&nbsp;<span class="op" id="5111350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111354">return</span>&nbsp;<span class="ident" id="5111361">newGobEncoderType</span><span class="op" id="5111378">(</span><span class="ident" id="5111379">name</span><span class="op" id="5111383">)</span><span class="op" id="5111384">,</span>&nbsp;<span class="ident" id="5111386">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5111391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111394">var</span>&nbsp;<span class="ident" id="5111398">err</span>&nbsp;<span class="builtintype" id="5111402">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111409">var</span>&nbsp;<span class="ident" id="5111413">type0</span><span class="op" id="5111418">,</span>&nbsp;<span class="ident" id="5111420">type1</span>&nbsp;<span class="ident" id="5111426">gobType</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111435">defer</span>&nbsp;<span class="keyword" id="5111441">func</span><span class="op" id="5111445">(</span><span class="op" id="5111446">)</span>&nbsp;<span class="op" id="5111448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111452">if</span>&nbsp;<span class="ident" id="5111455">err</span>&nbsp;<span class="op" id="5111459">!=</span>&nbsp;<span class="ident" id="5111462">nil</span>&nbsp;<span class="op" id="5111466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5111471">delete</span><span class="op" id="5111477">(</span><span class="ident" id="5111478">types</span><span class="op" id="5111483">,</span>&nbsp;<span class="ident" id="5111485">rt</span><span class="op" id="5111487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5111491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5111494">}</span><span class="op" id="5111495">(</span><span class="op" id="5111496">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5111499">//&nbsp;Install&nbsp;the&nbsp;top-level&nbsp;type&nbsp;before&nbsp;the&nbsp;subtypes&nbsp;(e.g.&nbsp;struct&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5111570">//&nbsp;fields)&nbsp;so&nbsp;recursive&nbsp;types&nbsp;can&nbsp;be&nbsp;constructed&nbsp;safely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111628">switch</span>&nbsp;<span class="ident" id="5111635">t</span>&nbsp;<span class="op" id="5111637">:=</span>&nbsp;<span class="ident" id="5111640">rt</span><span class="op" id="5111642">;</span>&nbsp;<span class="ident" id="5111644">t</span><span class="op" id="5111645">.</span><span class="ident" id="5111646">Kind</span><span class="op" id="5111650">(</span><span class="op" id="5111651">)</span>&nbsp;<span class="op" id="5111653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5111656">//&nbsp;All&nbsp;basic&nbsp;types&nbsp;are&nbsp;easy:&nbsp;they&nbsp;are&nbsp;predefined.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111707">case</span>&nbsp;<span class="ident" id="5111712">reflect</span><span class="op" id="5111719">.</span><span class="ident" id="5111720">Bool</span><span class="op" id="5111724">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111728">return</span>&nbsp;<span class="ident" id="5111735">tBool</span><span class="op" id="5111740">.</span><span class="ident" id="5111741">gobType</span><span class="op" id="5111748">(</span><span class="op" id="5111749">)</span><span class="op" id="5111750">,</span>&nbsp;<span class="ident" id="5111752">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111758">case</span>&nbsp;<span class="ident" id="5111763">reflect</span><span class="op" id="5111770">.</span><span class="ident" id="5111771">Int</span><span class="op" id="5111774">,</span>&nbsp;<span class="ident" id="5111776">reflect</span><span class="op" id="5111783">.</span><span class="ident" id="5111784">Int8</span><span class="op" id="5111788">,</span>&nbsp;<span class="ident" id="5111790">reflect</span><span class="op" id="5111797">.</span><span class="ident" id="5111798">Int16</span><span class="op" id="5111803">,</span>&nbsp;<span class="ident" id="5111805">reflect</span><span class="op" id="5111812">.</span><span class="ident" id="5111813">Int32</span><span class="op" id="5111818">,</span>&nbsp;<span class="ident" id="5111820">reflect</span><span class="op" id="5111827">.</span><span class="ident" id="5111828">Int64</span><span class="op" id="5111833">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111837">return</span>&nbsp;<span class="ident" id="5111844">tInt</span><span class="op" id="5111848">.</span><span class="ident" id="5111849">gobType</span><span class="op" id="5111856">(</span><span class="op" id="5111857">)</span><span class="op" id="5111858">,</span>&nbsp;<span class="ident" id="5111860">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111866">case</span>&nbsp;<span class="ident" id="5111871">reflect</span><span class="op" id="5111878">.</span><span class="ident" id="5111879">Uint</span><span class="op" id="5111883">,</span>&nbsp;<span class="ident" id="5111885">reflect</span><span class="op" id="5111892">.</span><span class="ident" id="5111893">Uint8</span><span class="op" id="5111898">,</span>&nbsp;<span class="ident" id="5111900">reflect</span><span class="op" id="5111907">.</span><span class="ident" id="5111908">Uint16</span><span class="op" id="5111914">,</span>&nbsp;<span class="ident" id="5111916">reflect</span><span class="op" id="5111923">.</span><span class="ident" id="5111924">Uint32</span><span class="op" id="5111930">,</span>&nbsp;<span class="ident" id="5111932">reflect</span><span class="op" id="5111939">.</span><span class="ident" id="5111940">Uint64</span><span class="op" id="5111946">,</span>&nbsp;<span class="ident" id="5111948">reflect</span><span class="op" id="5111955">.</span><span class="ident" id="5111956">Uintptr</span><span class="op" id="5111963">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111967">return</span>&nbsp;<span class="ident" id="5111974">tUint</span><span class="op" id="5111979">.</span><span class="ident" id="5111980">gobType</span><span class="op" id="5111987">(</span><span class="op" id="5111988">)</span><span class="op" id="5111989">,</span>&nbsp;<span class="ident" id="5111991">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111997">case</span>&nbsp;<span class="ident" id="5112002">reflect</span><span class="op" id="5112009">.</span><span class="ident" id="5112010">Float32</span><span class="op" id="5112017">,</span>&nbsp;<span class="ident" id="5112019">reflect</span><span class="op" id="5112026">.</span><span class="ident" id="5112027">Float64</span><span class="op" id="5112034">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112038">return</span>&nbsp;<span class="ident" id="5112045">tFloat</span><span class="op" id="5112051">.</span><span class="ident" id="5112052">gobType</span><span class="op" id="5112059">(</span><span class="op" id="5112060">)</span><span class="op" id="5112061">,</span>&nbsp;<span class="ident" id="5112063">nil</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112069">case</span>&nbsp;<span class="ident" id="5112074">reflect</span><span class="op" id="5112081">.</span><span class="ident" id="5112082">Complex64</span><span class="op" id="5112091">,</span>&nbsp;<span class="ident" id="5112093">reflect</span><span class="op" id="5112100">.</span><span class="ident" id="5112101">Complex128</span><span class="op" id="5112111">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112115">return</span>&nbsp;<span class="ident" id="5112122">tComplex</span><span class="op" id="5112130">.</span><span class="ident" id="5112131">gobType</span><span class="op" id="5112138">(</span><span class="op" id="5112139">)</span><span class="op" id="5112140">,</span>&nbsp;<span class="ident" id="5112142">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112148">case</span>&nbsp;<span class="ident" id="5112153">reflect</span><span class="op" id="5112160">.</span><span class="ident" id="5112161">String</span><span class="op" id="5112167">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112171">return</span>&nbsp;<span class="ident" id="5112178">tString</span><span class="op" id="5112185">.</span><span class="ident" id="5112186">gobType</span><span class="op" id="5112193">(</span><span class="op" id="5112194">)</span><span class="op" id="5112195">,</span>&nbsp;<span class="ident" id="5112197">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112203">case</span>&nbsp;<span class="ident" id="5112208">reflect</span><span class="op" id="5112215">.</span><span class="ident" id="5112216">Interface</span><span class="op" id="5112225">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112229">return</span>&nbsp;<span class="ident" id="5112236">tInterface</span><span class="op" id="5112246">.</span><span class="ident" id="5112247">gobType</span><span class="op" id="5112254">(</span><span class="op" id="5112255">)</span><span class="op" id="5112256">,</span>&nbsp;<span class="ident" id="5112258">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112264">case</span>&nbsp;<span class="ident" id="5112269">reflect</span><span class="op" id="5112276">.</span><span class="ident" id="5112277">Array</span><span class="op" id="5112282">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112286">at</span>&nbsp;<span class="op" id="5112289">:=</span>&nbsp;<span class="ident" id="5112292">newArrayType</span><span class="op" id="5112304">(</span><span class="ident" id="5112305">name</span><span class="op" id="5112309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112313">types</span><span class="op" id="5112318">[</span><span class="ident" id="5112319">rt</span><span class="op" id="5112321">]</span>&nbsp;<span class="op" id="5112323">=</span>&nbsp;<span class="ident" id="5112325">at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112330">type0</span><span class="op" id="5112335">,</span>&nbsp;<span class="ident" id="5112337">err</span>&nbsp;<span class="op" id="5112341">=</span>&nbsp;<span class="ident" id="5112343">getBaseType</span><span class="op" id="5112354">(</span><span class="string" id="5112355">&#34;&#34;</span><span class="op" id="5112357">,</span>&nbsp;<span class="ident" id="5112359">t</span><span class="op" id="5112360">.</span><span class="ident" id="5112361">Elem</span><span class="op" id="5112365">(</span><span class="op" id="5112366">)</span><span class="op" id="5112367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112371">if</span>&nbsp;<span class="ident" id="5112374">err</span>&nbsp;<span class="op" id="5112378">!=</span>&nbsp;<span class="ident" id="5112381">nil</span>&nbsp;<span class="op" id="5112385">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112390">return</span>&nbsp;<span class="ident" id="5112397">nil</span><span class="op" id="5112400">,</span>&nbsp;<span class="ident" id="5112402">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5112408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112412">//&nbsp;Historical&nbsp;aside:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112435">//&nbsp;For&nbsp;arrays,&nbsp;maps,&nbsp;and&nbsp;slices,&nbsp;we&nbsp;set&nbsp;the&nbsp;type&nbsp;id&nbsp;after&nbsp;the&nbsp;elements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112508">//&nbsp;are&nbsp;constructed.&nbsp;This&nbsp;is&nbsp;to&nbsp;retain&nbsp;the&nbsp;order&nbsp;of&nbsp;type&nbsp;id&nbsp;allocation&nbsp;after</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112586">//&nbsp;a&nbsp;fix&nbsp;made&nbsp;to&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;which&nbsp;changed&nbsp;the&nbsp;order&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112656">//&nbsp;which&nbsp;types&nbsp;are&nbsp;built.&nbsp;&nbsp;Delaying&nbsp;the&nbsp;setting&nbsp;in&nbsp;this&nbsp;way&nbsp;preserves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112728">//&nbsp;type&nbsp;ids&nbsp;while&nbsp;allowing&nbsp;recursive&nbsp;types&nbsp;to&nbsp;be&nbsp;described.&nbsp;Structs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112799">//&nbsp;done&nbsp;below,&nbsp;were&nbsp;already&nbsp;handling&nbsp;recursion&nbsp;correctly&nbsp;so&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112866">//&nbsp;assign&nbsp;the&nbsp;top-level&nbsp;id&nbsp;before&nbsp;those&nbsp;of&nbsp;the&nbsp;field.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112922">at</span><span class="op" id="5112924">.</span><span class="ident" id="5112925">init</span><span class="op" id="5112929">(</span><span class="ident" id="5112930">type0</span><span class="op" id="5112935">,</span>&nbsp;<span class="ident" id="5112937">t</span><span class="op" id="5112938">.</span><span class="ident" id="5112939">Len</span><span class="op" id="5112942">(</span><span class="op" id="5112943">)</span><span class="op" id="5112944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112948">return</span>&nbsp;<span class="ident" id="5112955">at</span><span class="op" id="5112957">,</span>&nbsp;<span class="ident" id="5112959">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112965">case</span>&nbsp;<span class="ident" id="5112970">reflect</span><span class="op" id="5112977">.</span><span class="ident" id="5112978">Map</span><span class="op" id="5112981">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112985">mt</span>&nbsp;<span class="op" id="5112988">:=</span>&nbsp;<span class="ident" id="5112991">newMapType</span><span class="op" id="5113001">(</span><span class="ident" id="5113002">name</span><span class="op" id="5113006">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113010">types</span><span class="op" id="5113015">[</span><span class="ident" id="5113016">rt</span><span class="op" id="5113018">]</span>&nbsp;<span class="op" id="5113020">=</span>&nbsp;<span class="ident" id="5113022">mt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113027">type0</span><span class="op" id="5113032">,</span>&nbsp;<span class="ident" id="5113034">err</span>&nbsp;<span class="op" id="5113038">=</span>&nbsp;<span class="ident" id="5113040">getBaseType</span><span class="op" id="5113051">(</span><span class="string" id="5113052">&#34;&#34;</span><span class="op" id="5113054">,</span>&nbsp;<span class="ident" id="5113056">t</span><span class="op" id="5113057">.</span><span class="ident" id="5113058">Key</span><span class="op" id="5113061">(</span><span class="op" id="5113062">)</span><span class="op" id="5113063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113067">if</span>&nbsp;<span class="ident" id="5113070">err</span>&nbsp;<span class="op" id="5113074">!=</span>&nbsp;<span class="ident" id="5113077">nil</span>&nbsp;<span class="op" id="5113081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113086">return</span>&nbsp;<span class="ident" id="5113093">nil</span><span class="op" id="5113096">,</span>&nbsp;<span class="ident" id="5113098">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5113104">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113108">type1</span><span class="op" id="5113113">,</span>&nbsp;<span class="ident" id="5113115">err</span>&nbsp;<span class="op" id="5113119">=</span>&nbsp;<span class="ident" id="5113121">getBaseType</span><span class="op" id="5113132">(</span><span class="string" id="5113133">&#34;&#34;</span><span class="op" id="5113135">,</span>&nbsp;<span class="ident" id="5113137">t</span><span class="op" id="5113138">.</span><span class="ident" id="5113139">Elem</span><span class="op" id="5113143">(</span><span class="op" id="5113144">)</span><span class="op" id="5113145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113149">if</span>&nbsp;<span class="ident" id="5113152">err</span>&nbsp;<span class="op" id="5113156">!=</span>&nbsp;<span class="ident" id="5113159">nil</span>&nbsp;<span class="op" id="5113163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113168">return</span>&nbsp;<span class="ident" id="5113175">nil</span><span class="op" id="5113178">,</span>&nbsp;<span class="ident" id="5113180">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5113186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113190">mt</span><span class="op" id="5113192">.</span><span class="ident" id="5113193">init</span><span class="op" id="5113197">(</span><span class="ident" id="5113198">type0</span><span class="op" id="5113203">,</span>&nbsp;<span class="ident" id="5113205">type1</span><span class="op" id="5113210">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113214">return</span>&nbsp;<span class="ident" id="5113221">mt</span><span class="op" id="5113223">,</span>&nbsp;<span class="ident" id="5113225">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113231">case</span>&nbsp;<span class="ident" id="5113236">reflect</span><span class="op" id="5113243">.</span><span class="ident" id="5113244">Slice</span><span class="op" id="5113249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113253">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113294">if</span>&nbsp;<span class="ident" id="5113297">t</span><span class="op" id="5113298">.</span><span class="ident" id="5113299">Elem</span><span class="op" id="5113303">(</span><span class="op" id="5113304">)</span><span class="op" id="5113305">.</span><span class="ident" id="5113306">Kind</span><span class="op" id="5113310">(</span><span class="op" id="5113311">)</span>&nbsp;<span class="op" id="5113313">==</span>&nbsp;<span class="ident" id="5113316">reflect</span><span class="op" id="5113323">.</span><span class="ident" id="5113324">Uint8</span>&nbsp;<span class="op" id="5113330">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113335">return</span>&nbsp;<span class="ident" id="5113342">tBytes</span><span class="op" id="5113348">.</span><span class="ident" id="5113349">gobType</span><span class="op" id="5113356">(</span><span class="op" id="5113357">)</span><span class="op" id="5113358">,</span>&nbsp;<span class="ident" id="5113360">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5113366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113370">st</span>&nbsp;<span class="op" id="5113373">:=</span>&nbsp;<span class="ident" id="5113376">newSliceType</span><span class="op" id="5113388">(</span><span class="ident" id="5113389">name</span><span class="op" id="5113393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113397">types</span><span class="op" id="5113402">[</span><span class="ident" id="5113403">rt</span><span class="op" id="5113405">]</span>&nbsp;<span class="op" id="5113407">=</span>&nbsp;<span class="ident" id="5113409">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113414">type0</span><span class="op" id="5113419">,</span>&nbsp;<span class="ident" id="5113421">err</span>&nbsp;<span class="op" id="5113425">=</span>&nbsp;<span class="ident" id="5113427">getBaseType</span><span class="op" id="5113438">(</span><span class="ident" id="5113439">t</span><span class="op" id="5113440">.</span><span class="ident" id="5113441">Elem</span><span class="op" id="5113445">(</span><span class="op" id="5113446">)</span><span class="op" id="5113447">.</span><span class="ident" id="5113448">Name</span><span class="op" id="5113452">(</span><span class="op" id="5113453">)</span><span class="op" id="5113454">,</span>&nbsp;<span class="ident" id="5113456">t</span><span class="op" id="5113457">.</span><span class="ident" id="5113458">Elem</span><span class="op" id="5113462">(</span><span class="op" id="5113463">)</span><span class="op" id="5113464">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113468">if</span>&nbsp;<span class="ident" id="5113471">err</span>&nbsp;<span class="op" id="5113475">!=</span>&nbsp;<span class="ident" id="5113478">nil</span>&nbsp;<span class="op" id="5113482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113487">return</span>&nbsp;<span class="ident" id="5113494">nil</span><span class="op" id="5113497">,</span>&nbsp;<span class="ident" id="5113499">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5113505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113509">st</span><span class="op" id="5113511">.</span><span class="ident" id="5113512">init</span><span class="op" id="5113516">(</span><span class="ident" id="5113517">type0</span><span class="op" id="5113522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113526">return</span>&nbsp;<span class="ident" id="5113533">st</span><span class="op" id="5113535">,</span>&nbsp;<span class="ident" id="5113537">nil</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113543">case</span>&nbsp;<span class="ident" id="5113548">reflect</span><span class="op" id="5113555">.</span><span class="ident" id="5113556">Struct</span><span class="op" id="5113562">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113566">st</span>&nbsp;<span class="op" id="5113569">:=</span>&nbsp;<span class="ident" id="5113572">newStructType</span><span class="op" id="5113585">(</span><span class="ident" id="5113586">name</span><span class="op" id="5113590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113594">types</span><span class="op" id="5113599">[</span><span class="ident" id="5113600">rt</span><span class="op" id="5113602">]</span>&nbsp;<span class="op" id="5113604">=</span>&nbsp;<span class="ident" id="5113606">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113611">idToType</span><span class="op" id="5113619">[</span><span class="ident" id="5113620">st</span><span class="op" id="5113622">.</span><span class="ident" id="5113623">id</span><span class="op" id="5113625">(</span><span class="op" id="5113626">)</span><span class="op" id="5113627">]</span>&nbsp;<span class="op" id="5113629">=</span>&nbsp;<span class="ident" id="5113631">st</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113636">for</span>&nbsp;<span class="ident" id="5113640">i</span>&nbsp;<span class="op" id="5113642">:=</span>&nbsp;<span class="num" id="5113645">0</span><span class="op" id="5113646">;</span>&nbsp;<span class="ident" id="5113648">i</span>&nbsp;<span class="op" id="5113650">&lt;</span>&nbsp;<span class="ident" id="5113652">t</span><span class="op" id="5113653">.</span><span class="ident" id="5113654">NumField</span><span class="op" id="5113662">(</span><span class="op" id="5113663">)</span><span class="op" id="5113664">;</span>&nbsp;<span class="ident" id="5113666">i</span><span class="op" id="5113667">++</span>&nbsp;<span class="op" id="5113670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113675">f</span>&nbsp;<span class="op" id="5113677">:=</span>&nbsp;<span class="ident" id="5113680">t</span><span class="op" id="5113681">.</span><span class="ident" id="5113682">Field</span><span class="op" id="5113687">(</span><span class="ident" id="5113688">i</span><span class="op" id="5113689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113694">if</span>&nbsp;<span class="op" id="5113697">!</span><span class="ident" id="5113698">isSent</span><span class="op" id="5113704">(</span><span class="op" id="5113705">&amp;</span><span class="ident" id="5113706">f</span><span class="op" id="5113707">)</span>&nbsp;<span class="op" id="5113709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113715">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5113727">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113732">typ</span>&nbsp;<span class="op" id="5113736">:=</span>&nbsp;<span class="ident" id="5113739">userType</span><span class="op" id="5113747">(</span><span class="ident" id="5113748">f</span><span class="op" id="5113749">.</span><span class="ident" id="5113750">Type</span><span class="op" id="5113754">)</span><span class="op" id="5113755">.</span><span class="ident" id="5113756">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113764">tname</span>&nbsp;<span class="op" id="5113770">:=</span>&nbsp;<span class="ident" id="5113773">typ</span><span class="op" id="5113776">.</span><span class="ident" id="5113777">Name</span><span class="op" id="5113781">(</span><span class="op" id="5113782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113787">if</span>&nbsp;<span class="ident" id="5113790">tname</span>&nbsp;<span class="op" id="5113796">==</span>&nbsp;<span class="string" id="5113799">&#34;&#34;</span>&nbsp;<span class="op" id="5113802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113808">t</span>&nbsp;<span class="op" id="5113810">:=</span>&nbsp;<span class="ident" id="5113813">userType</span><span class="op" id="5113821">(</span><span class="ident" id="5113822">f</span><span class="op" id="5113823">.</span><span class="ident" id="5113824">Type</span><span class="op" id="5113828">)</span><span class="op" id="5113829">.</span><span class="ident" id="5113830">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113839">tname</span>&nbsp;<span class="op" id="5113845">=</span>&nbsp;<span class="ident" id="5113847">t</span><span class="op" id="5113848">.</span><span class="ident" id="5113849">String</span><span class="op" id="5113855">(</span><span class="op" id="5113856">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5113861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113866">gt</span><span class="op" id="5113868">,</span>&nbsp;<span class="ident" id="5113870">err</span>&nbsp;<span class="op" id="5113874">:=</span>&nbsp;<span class="ident" id="5113877">getBaseType</span><span class="op" id="5113888">(</span><span class="ident" id="5113889">tname</span><span class="op" id="5113894">,</span>&nbsp;<span class="ident" id="5113896">f</span><span class="op" id="5113897">.</span><span class="ident" id="5113898">Type</span><span class="op" id="5113902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113907">if</span>&nbsp;<span class="ident" id="5113910">err</span>&nbsp;<span class="op" id="5113914">!=</span>&nbsp;<span class="ident" id="5113917">nil</span>&nbsp;<span class="op" id="5113921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113927">return</span>&nbsp;<span class="ident" id="5113934">nil</span><span class="op" id="5113937">,</span>&nbsp;<span class="ident" id="5113939">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5113946">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113951">//&nbsp;Some&nbsp;mutually&nbsp;recursive&nbsp;types&nbsp;can&nbsp;cause&nbsp;us&nbsp;to&nbsp;be&nbsp;here&nbsp;while</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114017">//&nbsp;still&nbsp;defining&nbsp;the&nbsp;element.&nbsp;Fix&nbsp;the&nbsp;element&nbsp;type&nbsp;id&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114081">//&nbsp;We&nbsp;could&nbsp;do&nbsp;this&nbsp;more&nbsp;neatly&nbsp;by&nbsp;setting&nbsp;the&nbsp;id&nbsp;at&nbsp;the&nbsp;start&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114150">//&nbsp;building&nbsp;every&nbsp;type,&nbsp;but&nbsp;that&nbsp;would&nbsp;break&nbsp;binary&nbsp;compatibility.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5114220">if</span>&nbsp;<span class="ident" id="5114223">gt</span><span class="op" id="5114225">.</span><span class="ident" id="5114226">id</span><span class="op" id="5114228">(</span><span class="op" id="5114229">)</span>&nbsp;<span class="op" id="5114231">==</span>&nbsp;<span class="num" id="5114234">0</span>&nbsp;<span class="op" id="5114236">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5114242">setTypeId</span><span class="op" id="5114251">(</span><span class="ident" id="5114252">gt</span><span class="op" id="5114254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5114259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5114264">st</span><span class="op" id="5114266">.</span><span class="ident" id="5114267">Field</span>&nbsp;<span class="op" id="5114273">=</span>&nbsp;<span class="builtinfunc" id="5114275">append</span><span class="op" id="5114281">(</span><span class="ident" id="5114282">st</span><span class="op" id="5114284">.</span><span class="ident" id="5114285">Field</span><span class="op" id="5114290">,</span>&nbsp;<span class="op" id="5114292">&amp;</span><span class="ident" id="5114293">fieldType</span><span class="op" id="5114302">{</span><span class="ident" id="5114303">f</span><span class="op" id="5114304">.</span><span class="ident" id="5114305">Name</span><span class="op" id="5114309">,</span>&nbsp;<span class="ident" id="5114311">gt</span><span class="op" id="5114313">.</span><span class="ident" id="5114314">id</span><span class="op" id="5114316">(</span><span class="op" id="5114317">)</span><span class="op" id="5114318">}</span><span class="op" id="5114319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5114323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5114327">return</span>&nbsp;<span class="ident" id="5114334">st</span><span class="op" id="5114336">,</span>&nbsp;<span class="ident" id="5114338">nil</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5114344">default</span><span class="op" id="5114351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5114355">return</span>&nbsp;<span class="ident" id="5114362">nil</span><span class="op" id="5114365">,</span>&nbsp;<span class="ident" id="5114367">errors</span><span class="op" id="5114373">.</span><span class="ident" id="5114374">New</span><span class="op" id="5114377">(</span><span class="string" id="5114378">&#34;gob&nbsp;NewTypeObject&nbsp;can&#39;t&nbsp;handle&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="5114418">+</span>&nbsp;<span class="ident" id="5114420">rt</span><span class="op" id="5114422">.</span><span class="ident" id="5114423">String</span><span class="op" id="5114429">(</span><span class="op" id="5114430">)</span><span class="op" id="5114431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5114434">}</span><br>
<span class="lineno"></span><span class="op" id="5114436">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="5114439">//&nbsp;isExported&nbsp;reports&nbsp;whether&nbsp;this&nbsp;is&nbsp;an&nbsp;exported&nbsp;-&nbsp;upper&nbsp;case&nbsp;-&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5114510">func</span>&nbsp;<span class="ident" id="5114515">isExported</span><span class="op" id="5114525">(</span><span class="ident" id="5114526">name</span>&nbsp;<span class="builtintype" id="5114531">string</span><span class="op" id="5114537">)</span>&nbsp;<span class="builtintype" id="5114539">bool</span>&nbsp;<span class="op" id="5114544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5114547">rune</span><span class="op" id="5114551">,</span>&nbsp;<span class="ident" id="5114553">_</span>&nbsp;<span class="op" id="5114555">:=</span>&nbsp;<span class="ident" id="5114558">utf8</span><span class="op" id="5114562">.</span><span class="ident" id="5114563">DecodeRuneInString</span><span class="op" id="5114581">(</span><span class="ident" id="5114582">name</span><span class="op" id="5114586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5114589">return</span>&nbsp;<span class="ident" id="5114596">unicode</span><span class="op" id="5114603">.</span><span class="ident" id="5114604">IsUpper</span><span class="op" id="5114611">(</span><span class="builtintype" id="5114612">rune</span><span class="op" id="5114616">)</span><br>
<span class="lineno">570</span><span class="op" id="5114618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5114621">//&nbsp;isSent&nbsp;reports&nbsp;whether&nbsp;this&nbsp;struct&nbsp;field&nbsp;is&nbsp;to&nbsp;be&nbsp;transmitted.</span><br>
<span class="lineno"></span><span class="comment" id="5114687">//&nbsp;It&nbsp;will&nbsp;be&nbsp;transmitted&nbsp;only&nbsp;if&nbsp;it&nbsp;is&nbsp;exported&nbsp;and&nbsp;not&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5114765">//&nbsp;or&nbsp;pointer&nbsp;to&nbsp;chan&nbsp;or&nbsp;func.</span><br>
<span class="lineno">575</span><span class="keyword" id="5114796">func</span>&nbsp;<span class="ident" id="5114801">isSent</span><span class="op" id="5114807">(</span><span class="ident" id="5114808">field</span>&nbsp;<span class="op" id="5114814">*</span><span class="ident" id="5114815">reflect</span><span class="op" id="5114822">.</span><span class="ident" id="5114823">StructField</span><span class="op" id="5114834">)</span>&nbsp;<span class="builtintype" id="5114836">bool</span>&nbsp;<span class="op" id="5114841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5114844">if</span>&nbsp;<span class="op" id="5114847">!</span><span class="ident" id="5114848">isExported</span><span class="op" id="5114858">(</span><span class="ident" id="5114859">field</span><span class="op" id="5114864">.</span><span class="ident" id="5114865">Name</span><span class="op" id="5114869">)</span>&nbsp;<span class="op" id="5114871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5114875">return</span>&nbsp;<span class="builtintype" id="5114882">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5114889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114892">//&nbsp;If&nbsp;the&nbsp;field&nbsp;is&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;or&nbsp;pointer&nbsp;thereto,&nbsp;don&#39;t&nbsp;send&nbsp;it.</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114962">//&nbsp;That&nbsp;is,&nbsp;treat&nbsp;it&nbsp;like&nbsp;an&nbsp;unexported&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115010">typ</span>&nbsp;<span class="op" id="5115014">:=</span>&nbsp;<span class="ident" id="5115017">field</span><span class="op" id="5115022">.</span><span class="ident" id="5115023">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115029">for</span>&nbsp;<span class="ident" id="5115033">typ</span><span class="op" id="5115036">.</span><span class="ident" id="5115037">Kind</span><span class="op" id="5115041">(</span><span class="op" id="5115042">)</span>&nbsp;<span class="op" id="5115044">==</span>&nbsp;<span class="ident" id="5115047">reflect</span><span class="op" id="5115054">.</span><span class="ident" id="5115055">Ptr</span>&nbsp;<span class="op" id="5115059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115063">typ</span>&nbsp;<span class="op" id="5115067">=</span>&nbsp;<span class="ident" id="5115069">typ</span><span class="op" id="5115072">.</span><span class="ident" id="5115073">Elem</span><span class="op" id="5115077">(</span><span class="op" id="5115078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5115081">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115084">if</span>&nbsp;<span class="ident" id="5115087">typ</span><span class="op" id="5115090">.</span><span class="ident" id="5115091">Kind</span><span class="op" id="5115095">(</span><span class="op" id="5115096">)</span>&nbsp;<span class="op" id="5115098">==</span>&nbsp;<span class="ident" id="5115101">reflect</span><span class="op" id="5115108">.</span><span class="ident" id="5115109">Chan</span>&nbsp;<span class="op" id="5115114">||</span>&nbsp;<span class="ident" id="5115117">typ</span><span class="op" id="5115120">.</span><span class="ident" id="5115121">Kind</span><span class="op" id="5115125">(</span><span class="op" id="5115126">)</span>&nbsp;<span class="op" id="5115128">==</span>&nbsp;<span class="ident" id="5115131">reflect</span><span class="op" id="5115138">.</span><span class="ident" id="5115139">Func</span>&nbsp;<span class="op" id="5115144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115148">return</span>&nbsp;<span class="builtintype" id="5115155">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5115162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115165">return</span>&nbsp;<span class="builtintype" id="5115172">true</span><br>
<span class="lineno"></span><span class="op" id="5115177">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="5115180">//&nbsp;getBaseType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type&#39;s&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5115263">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="5115289">func</span>&nbsp;<span class="ident" id="5115294">getBaseType</span><span class="op" id="5115305">(</span><span class="ident" id="5115306">name</span>&nbsp;<span class="builtintype" id="5115311">string</span><span class="op" id="5115317">,</span>&nbsp;<span class="ident" id="5115319">rt</span>&nbsp;<span class="ident" id="5115322">reflect</span><span class="op" id="5115329">.</span><span class="ident" id="5115330">Type</span><span class="op" id="5115334">)</span>&nbsp;<span class="op" id="5115336">(</span><span class="ident" id="5115337">gobType</span><span class="op" id="5115344">,</span>&nbsp;<span class="builtintype" id="5115346">error</span><span class="op" id="5115351">)</span>&nbsp;<span class="op" id="5115353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115356">ut</span>&nbsp;<span class="op" id="5115359">:=</span>&nbsp;<span class="ident" id="5115362">userType</span><span class="op" id="5115370">(</span><span class="ident" id="5115371">rt</span><span class="op" id="5115373">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115376">return</span>&nbsp;<span class="ident" id="5115383">getType</span><span class="op" id="5115390">(</span><span class="ident" id="5115391">name</span><span class="op" id="5115395">,</span>&nbsp;<span class="ident" id="5115397">ut</span><span class="op" id="5115399">,</span>&nbsp;<span class="ident" id="5115401">ut</span><span class="op" id="5115403">.</span><span class="ident" id="5115404">base</span><span class="op" id="5115408">)</span><br>
<span class="lineno"></span><span class="op" id="5115410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5115413">//&nbsp;getType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type.</span><br>
<span class="lineno"></span><span class="comment" id="5115480">//&nbsp;Should&nbsp;be&nbsp;called&nbsp;only&nbsp;when&nbsp;handling&nbsp;GobEncoders/Decoders,</span><br>
<span class="lineno">600</span><span class="comment" id="5115541">//&nbsp;which&nbsp;may&nbsp;be&nbsp;pointers.&nbsp;&nbsp;All&nbsp;other&nbsp;types&nbsp;are&nbsp;handled&nbsp;through&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5115608">//&nbsp;base&nbsp;type,&nbsp;never&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="comment" id="5115639">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="5115665">func</span>&nbsp;<span class="ident" id="5115670">getType</span><span class="op" id="5115677">(</span><span class="ident" id="5115678">name</span>&nbsp;<span class="builtintype" id="5115683">string</span><span class="op" id="5115689">,</span>&nbsp;<span class="ident" id="5115691">ut</span>&nbsp;<span class="op" id="5115694">*</span><span class="ident" id="5115695">userTypeInfo</span><span class="op" id="5115707">,</span>&nbsp;<span class="ident" id="5115709">rt</span>&nbsp;<span class="ident" id="5115712">reflect</span><span class="op" id="5115719">.</span><span class="ident" id="5115720">Type</span><span class="op" id="5115724">)</span>&nbsp;<span class="op" id="5115726">(</span><span class="ident" id="5115727">gobType</span><span class="op" id="5115734">,</span>&nbsp;<span class="builtintype" id="5115736">error</span><span class="op" id="5115741">)</span>&nbsp;<span class="op" id="5115743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115746">typ</span><span class="op" id="5115749">,</span>&nbsp;<span class="ident" id="5115751">present</span>&nbsp;<span class="op" id="5115759">:=</span>&nbsp;<span class="ident" id="5115762">types</span><span class="op" id="5115767">[</span><span class="ident" id="5115768">rt</span><span class="op" id="5115770">]</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115773">if</span>&nbsp;<span class="ident" id="5115776">present</span>&nbsp;<span class="op" id="5115784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115788">return</span>&nbsp;<span class="ident" id="5115795">typ</span><span class="op" id="5115798">,</span>&nbsp;<span class="ident" id="5115800">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5115805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115808">typ</span><span class="op" id="5115811">,</span>&nbsp;<span class="ident" id="5115813">err</span>&nbsp;<span class="op" id="5115817">:=</span>&nbsp;<span class="ident" id="5115820">newTypeObject</span><span class="op" id="5115833">(</span><span class="ident" id="5115834">name</span><span class="op" id="5115838">,</span>&nbsp;<span class="ident" id="5115840">ut</span><span class="op" id="5115842">,</span>&nbsp;<span class="ident" id="5115844">rt</span><span class="op" id="5115846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115849">if</span>&nbsp;<span class="ident" id="5115852">err</span>&nbsp;<span class="op" id="5115856">==</span>&nbsp;<span class="ident" id="5115859">nil</span>&nbsp;<span class="op" id="5115863">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115867">types</span><span class="op" id="5115872">[</span><span class="ident" id="5115873">rt</span><span class="op" id="5115875">]</span>&nbsp;<span class="op" id="5115877">=</span>&nbsp;<span class="ident" id="5115879">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5115884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115887">return</span>&nbsp;<span class="ident" id="5115894">typ</span><span class="op" id="5115897">,</span>&nbsp;<span class="ident" id="5115899">err</span><br>
<span class="lineno"></span><span class="op" id="5115903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="keyword" id="5115906">func</span>&nbsp;<span class="ident" id="5115911">checkId</span><span class="op" id="5115918">(</span><span class="ident" id="5115919">want</span><span class="op" id="5115923">,</span>&nbsp;<span class="ident" id="5115925">got</span>&nbsp;<span class="ident" id="5115929">typeId</span><span class="op" id="5115935">)</span>&nbsp;<span class="op" id="5115937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115940">if</span>&nbsp;<span class="ident" id="5115943">want</span>&nbsp;<span class="op" id="5115948">!=</span>&nbsp;<span class="ident" id="5115951">got</span>&nbsp;<span class="op" id="5115955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115959">fmt</span><span class="op" id="5115962">.</span><span class="ident" id="5115963">Fprintf</span><span class="op" id="5115970">(</span><span class="ident" id="5115971">os</span><span class="op" id="5115973">.</span><span class="ident" id="5115974">Stderr</span><span class="op" id="5115980">,</span>&nbsp;<span class="string" id="5115982">&#34;checkId:&nbsp;%d&nbsp;should&nbsp;be&nbsp;%d\n&#34;</span><span class="op" id="5116010">,</span>&nbsp;<span class="builtintype" id="5116012">int</span><span class="op" id="5116015">(</span><span class="ident" id="5116016">got</span><span class="op" id="5116019">)</span><span class="op" id="5116020">,</span>&nbsp;<span class="builtintype" id="5116022">int</span><span class="op" id="5116025">(</span><span class="ident" id="5116026">want</span><span class="op" id="5116030">)</span><span class="op" id="5116031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5116035">panic</span><span class="op" id="5116040">(</span><span class="string" id="5116041">&#34;bootstrap&nbsp;type&nbsp;wrong&nbsp;id:&nbsp;&#34;</span>&nbsp;<span class="op" id="5116069">+</span>&nbsp;<span class="ident" id="5116071">got</span><span class="op" id="5116074">.</span><span class="ident" id="5116075">name</span><span class="op" id="5116079">(</span><span class="op" id="5116080">)</span>&nbsp;<span class="op" id="5116082">+</span>&nbsp;<span class="string" id="5116084">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5116088">+</span>&nbsp;<span class="ident" id="5116090">got</span><span class="op" id="5116093">.</span><span class="builtintype" id="5116094">string</span><span class="op" id="5116100">(</span><span class="op" id="5116101">)</span>&nbsp;<span class="op" id="5116103">+</span>&nbsp;<span class="string" id="5116105">&#34;&nbsp;not&nbsp;&#34;</span>&nbsp;<span class="op" id="5116113">+</span>&nbsp;<span class="ident" id="5116115">want</span><span class="op" id="5116119">.</span><span class="builtintype" id="5116120">string</span><span class="op" id="5116126">(</span><span class="op" id="5116127">)</span><span class="op" id="5116128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5116131">}</span><br>
<span class="lineno">620</span><span class="op" id="5116133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5116136">//&nbsp;used&nbsp;for&nbsp;building&nbsp;the&nbsp;basic&nbsp;types;&nbsp;called&nbsp;only&nbsp;from&nbsp;init().&nbsp;&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="5116213">//&nbsp;interface&nbsp;always&nbsp;refers&nbsp;to&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="keyword" id="5116254">func</span>&nbsp;<span class="ident" id="5116259">bootstrapType</span><span class="op" id="5116272">(</span><span class="ident" id="5116273">name</span>&nbsp;<span class="builtintype" id="5116278">string</span><span class="op" id="5116284">,</span>&nbsp;<span class="ident" id="5116286">e</span>&nbsp;<span class="keyword" id="5116288">interface</span><span class="op" id="5116297">{</span><span class="op" id="5116298">}</span><span class="op" id="5116299">,</span>&nbsp;<span class="ident" id="5116301">expect</span>&nbsp;<span class="ident" id="5116308">typeId</span><span class="op" id="5116314">)</span>&nbsp;<span class="ident" id="5116316">typeId</span>&nbsp;<span class="op" id="5116323">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116326">rt</span>&nbsp;<span class="op" id="5116329">:=</span>&nbsp;<span class="ident" id="5116332">reflect</span><span class="op" id="5116339">.</span><span class="ident" id="5116340">TypeOf</span><span class="op" id="5116346">(</span><span class="ident" id="5116347">e</span><span class="op" id="5116348">)</span><span class="op" id="5116349">.</span><span class="ident" id="5116350">Elem</span><span class="op" id="5116354">(</span><span class="op" id="5116355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116358">_</span><span class="op" id="5116359">,</span>&nbsp;<span class="ident" id="5116361">present</span>&nbsp;<span class="op" id="5116369">:=</span>&nbsp;<span class="ident" id="5116372">types</span><span class="op" id="5116377">[</span><span class="ident" id="5116378">rt</span><span class="op" id="5116380">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116383">if</span>&nbsp;<span class="ident" id="5116386">present</span>&nbsp;<span class="op" id="5116394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5116398">panic</span><span class="op" id="5116403">(</span><span class="string" id="5116404">&#34;bootstrap&nbsp;type&nbsp;already&nbsp;present:&nbsp;&#34;</span>&nbsp;<span class="op" id="5116439">+</span>&nbsp;<span class="ident" id="5116441">name</span>&nbsp;<span class="op" id="5116446">+</span>&nbsp;<span class="string" id="5116448">&#34;,&nbsp;&#34;</span>&nbsp;<span class="op" id="5116453">+</span>&nbsp;<span class="ident" id="5116455">rt</span><span class="op" id="5116457">.</span><span class="ident" id="5116458">String</span><span class="op" id="5116464">(</span><span class="op" id="5116465">)</span><span class="op" id="5116466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5116469">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116472">typ</span>&nbsp;<span class="op" id="5116476">:=</span>&nbsp;<span class="op" id="5116479">&amp;</span><span class="ident" id="5116480">CommonType</span><span class="op" id="5116490">{</span><span class="ident" id="5116491">Name</span><span class="op" id="5116495">:</span>&nbsp;<span class="ident" id="5116497">name</span><span class="op" id="5116501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116504">types</span><span class="op" id="5116509">[</span><span class="ident" id="5116510">rt</span><span class="op" id="5116512">]</span>&nbsp;<span class="op" id="5116514">=</span>&nbsp;<span class="ident" id="5116516">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116521">setTypeId</span><span class="op" id="5116530">(</span><span class="ident" id="5116531">typ</span><span class="op" id="5116534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116537">checkId</span><span class="op" id="5116544">(</span><span class="ident" id="5116545">expect</span><span class="op" id="5116551">,</span>&nbsp;<span class="ident" id="5116553">nextId</span><span class="op" id="5116559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116562">userType</span><span class="op" id="5116570">(</span><span class="ident" id="5116571">rt</span><span class="op" id="5116573">)</span>&nbsp;<span class="comment" id="5116575">//&nbsp;might&nbsp;as&nbsp;well&nbsp;cache&nbsp;it&nbsp;now</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116606">return</span>&nbsp;<span class="ident" id="5116613">nextId</span><br>
<span class="lineno"></span><span class="op" id="5116620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5116623">//&nbsp;Representation&nbsp;of&nbsp;the&nbsp;information&nbsp;we&nbsp;send&nbsp;and&nbsp;receive&nbsp;about&nbsp;this&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5116697">//&nbsp;Each&nbsp;value&nbsp;we&nbsp;send&nbsp;is&nbsp;preceded&nbsp;by&nbsp;its&nbsp;type&nbsp;definition:&nbsp;an&nbsp;encoded&nbsp;int.</span><br>
<span class="lineno">640</span><span class="comment" id="5116771">//&nbsp;However,&nbsp;the&nbsp;very&nbsp;first&nbsp;time&nbsp;we&nbsp;send&nbsp;the&nbsp;value,&nbsp;we&nbsp;first&nbsp;send&nbsp;the&nbsp;pair</span><br>
<span class="lineno"></span><span class="comment" id="5116845">//&nbsp;(-id,&nbsp;wireType).</span><br>
<span class="lineno"></span><span class="comment" id="5116865">//&nbsp;For&nbsp;bootstrapping&nbsp;purposes,&nbsp;we&nbsp;assume&nbsp;that&nbsp;the&nbsp;recipient&nbsp;knows&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="5116935">//&nbsp;to&nbsp;decode&nbsp;a&nbsp;wireType;&nbsp;it&nbsp;is&nbsp;exactly&nbsp;the&nbsp;wireType&nbsp;struct&nbsp;here,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="5117012">//&nbsp;using&nbsp;the&nbsp;gob&nbsp;rules&nbsp;for&nbsp;sending&nbsp;a&nbsp;structure,&nbsp;except&nbsp;that&nbsp;we&nbsp;assume&nbsp;the</span><br>
<span class="lineno">645</span><span class="comment" id="5117086">//&nbsp;ids&nbsp;for&nbsp;wireType&nbsp;and&nbsp;structType&nbsp;etc.&nbsp;are&nbsp;known.&nbsp;&nbsp;The&nbsp;relevant&nbsp;pieces</span><br>
<span class="lineno"></span><span class="comment" id="5117158">//&nbsp;are&nbsp;built&nbsp;in&nbsp;encode.go&#39;s&nbsp;init()&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5117203">//&nbsp;To&nbsp;maintain&nbsp;binary&nbsp;compatibility,&nbsp;if&nbsp;you&nbsp;extend&nbsp;this&nbsp;type,&nbsp;always&nbsp;put</span><br>
<span class="lineno"></span><span class="comment" id="5117276">//&nbsp;the&nbsp;new&nbsp;fields&nbsp;last.</span><br>
<span class="lineno"></span><span class="keyword" id="5117300">type</span>&nbsp;<span class="ident" id="5117305">wireType</span>&nbsp;<span class="keyword" id="5117314">struct</span>&nbsp;<span class="op" id="5117321">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117324">ArrayT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5117341">*</span><span class="ident" id="5117342">arrayType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117353">SliceT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5117370">*</span><span class="ident" id="5117371">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117382">StructT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5117399">*</span><span class="ident" id="5117400">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117412">MapT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5117429">*</span><span class="ident" id="5117430">mapType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117439">GobEncoderT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5117456">*</span><span class="ident" id="5117457">gobEncoderType</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117473">BinaryMarshalerT</span>&nbsp;<span class="op" id="5117490">*</span><span class="ident" id="5117491">gobEncoderType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117507">TextMarshalerT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5117524">*</span><span class="ident" id="5117525">gobEncoderType</span><br>
<span class="lineno"></span><span class="op" id="5117540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5117543">func</span>&nbsp;<span class="op" id="5117548">(</span><span class="ident" id="5117549">w</span>&nbsp;<span class="op" id="5117551">*</span><span class="ident" id="5117552">wireType</span><span class="op" id="5117560">)</span>&nbsp;<span class="builtintype" id="5117562">string</span><span class="op" id="5117568">(</span><span class="op" id="5117569">)</span>&nbsp;<span class="builtintype" id="5117571">string</span>&nbsp;<span class="op" id="5117578">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117581">const</span>&nbsp;<span class="ident" id="5117587">unknown</span>&nbsp;<span class="op" id="5117595">=</span>&nbsp;<span class="string" id="5117597">&#34;unknown&nbsp;type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117613">if</span>&nbsp;<span class="ident" id="5117616">w</span>&nbsp;<span class="op" id="5117618">==</span>&nbsp;<span class="ident" id="5117621">nil</span>&nbsp;<span class="op" id="5117625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117629">return</span>&nbsp;<span class="ident" id="5117636">unknown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117648">switch</span>&nbsp;<span class="op" id="5117655">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117658">case</span>&nbsp;<span class="ident" id="5117663">w</span><span class="op" id="5117664">.</span><span class="ident" id="5117665">ArrayT</span>&nbsp;<span class="op" id="5117672">!=</span>&nbsp;<span class="ident" id="5117675">nil</span><span class="op" id="5117678">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117682">return</span>&nbsp;<span class="ident" id="5117689">w</span><span class="op" id="5117690">.</span><span class="ident" id="5117691">ArrayT</span><span class="op" id="5117697">.</span><span class="ident" id="5117698">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117704">case</span>&nbsp;<span class="ident" id="5117709">w</span><span class="op" id="5117710">.</span><span class="ident" id="5117711">SliceT</span>&nbsp;<span class="op" id="5117718">!=</span>&nbsp;<span class="ident" id="5117721">nil</span><span class="op" id="5117724">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117728">return</span>&nbsp;<span class="ident" id="5117735">w</span><span class="op" id="5117736">.</span><span class="ident" id="5117737">SliceT</span><span class="op" id="5117743">.</span><span class="ident" id="5117744">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117750">case</span>&nbsp;<span class="ident" id="5117755">w</span><span class="op" id="5117756">.</span><span class="ident" id="5117757">StructT</span>&nbsp;<span class="op" id="5117765">!=</span>&nbsp;<span class="ident" id="5117768">nil</span><span class="op" id="5117771">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117775">return</span>&nbsp;<span class="ident" id="5117782">w</span><span class="op" id="5117783">.</span><span class="ident" id="5117784">StructT</span><span class="op" id="5117791">.</span><span class="ident" id="5117792">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117798">case</span>&nbsp;<span class="ident" id="5117803">w</span><span class="op" id="5117804">.</span><span class="ident" id="5117805">MapT</span>&nbsp;<span class="op" id="5117810">!=</span>&nbsp;<span class="ident" id="5117813">nil</span><span class="op" id="5117816">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117820">return</span>&nbsp;<span class="ident" id="5117827">w</span><span class="op" id="5117828">.</span><span class="ident" id="5117829">MapT</span><span class="op" id="5117833">.</span><span class="ident" id="5117834">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117840">case</span>&nbsp;<span class="ident" id="5117845">w</span><span class="op" id="5117846">.</span><span class="ident" id="5117847">GobEncoderT</span>&nbsp;<span class="op" id="5117859">!=</span>&nbsp;<span class="ident" id="5117862">nil</span><span class="op" id="5117865">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117869">return</span>&nbsp;<span class="ident" id="5117876">w</span><span class="op" id="5117877">.</span><span class="ident" id="5117878">GobEncoderT</span><span class="op" id="5117889">.</span><span class="ident" id="5117890">Name</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117896">case</span>&nbsp;<span class="ident" id="5117901">w</span><span class="op" id="5117902">.</span><span class="ident" id="5117903">BinaryMarshalerT</span>&nbsp;<span class="op" id="5117920">!=</span>&nbsp;<span class="ident" id="5117923">nil</span><span class="op" id="5117926">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117930">return</span>&nbsp;<span class="ident" id="5117937">w</span><span class="op" id="5117938">.</span><span class="ident" id="5117939">BinaryMarshalerT</span><span class="op" id="5117955">.</span><span class="ident" id="5117956">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117962">case</span>&nbsp;<span class="ident" id="5117967">w</span><span class="op" id="5117968">.</span><span class="ident" id="5117969">TextMarshalerT</span>&nbsp;<span class="op" id="5117984">!=</span>&nbsp;<span class="ident" id="5117987">nil</span><span class="op" id="5117990">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117994">return</span>&nbsp;<span class="ident" id="5118001">w</span><span class="op" id="5118002">.</span><span class="ident" id="5118003">TextMarshalerT</span><span class="op" id="5118017">.</span><span class="ident" id="5118018">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118024">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118027">return</span>&nbsp;<span class="ident" id="5118034">unknown</span><br>
<span class="lineno"></span><span class="op" id="5118042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5118045">type</span>&nbsp;<span class="ident" id="5118050">typeInfo</span>&nbsp;<span class="keyword" id="5118059">struct</span>&nbsp;<span class="op" id="5118066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118069">id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5118077">typeId</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118085">encInit</span>&nbsp;<span class="ident" id="5118093">sync</span><span class="op" id="5118097">.</span><span class="ident" id="5118098">Mutex</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5118106">//&nbsp;protects&nbsp;creation&nbsp;of&nbsp;encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118139">encoder</span>&nbsp;<span class="ident" id="5118147">atomic</span><span class="op" id="5118153">.</span><span class="ident" id="5118154">Value</span>&nbsp;<span class="comment" id="5118160">//&nbsp;*encEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118175">wire</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5118183">*</span><span class="ident" id="5118184">wireType</span><br>
<span class="lineno"></span><span class="op" id="5118193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">690</span><span class="comment" id="5118196">//&nbsp;typeInfoMap&nbsp;is&nbsp;an&nbsp;atomic&nbsp;pointer&nbsp;to&nbsp;map[reflect.Type]*typeInfo.</span><br>
<span class="lineno"></span><span class="comment" id="5118263">//&nbsp;It&#39;s&nbsp;updated&nbsp;copy-on-write.&nbsp;Readers&nbsp;just&nbsp;do&nbsp;an&nbsp;atomic&nbsp;load</span><br>
<span class="lineno"></span><span class="comment" id="5118325">//&nbsp;to&nbsp;get&nbsp;the&nbsp;current&nbsp;version&nbsp;of&nbsp;the&nbsp;map.&nbsp;Writers&nbsp;make&nbsp;a&nbsp;full&nbsp;copy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5118395">//&nbsp;the&nbsp;map&nbsp;and&nbsp;atomically&nbsp;update&nbsp;the&nbsp;pointer&nbsp;to&nbsp;point&nbsp;to&nbsp;the&nbsp;new&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="5118465">//&nbsp;Under&nbsp;heavy&nbsp;read&nbsp;contention,&nbsp;this&nbsp;is&nbsp;significantly&nbsp;faster&nbsp;than&nbsp;a&nbsp;map</span><br>
<span class="lineno">695</span><span class="comment" id="5118537">//&nbsp;protected&nbsp;by&nbsp;a&nbsp;mutex.</span><br>
<span class="lineno"></span><span class="keyword" id="5118562">var</span>&nbsp;<span class="ident" id="5118566">typeInfoMap</span>&nbsp;<span class="ident" id="5118578">atomic</span><span class="op" id="5118584">.</span><span class="ident" id="5118585">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5118592">func</span>&nbsp;<span class="ident" id="5118597">lookupTypeInfo</span><span class="op" id="5118611">(</span><span class="ident" id="5118612">rt</span>&nbsp;<span class="ident" id="5118615">reflect</span><span class="op" id="5118622">.</span><span class="ident" id="5118623">Type</span><span class="op" id="5118627">)</span>&nbsp;<span class="op" id="5118629">*</span><span class="ident" id="5118630">typeInfo</span>&nbsp;<span class="op" id="5118639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118642">m</span><span class="op" id="5118643">,</span>&nbsp;<span class="ident" id="5118645">_</span>&nbsp;<span class="op" id="5118647">:=</span>&nbsp;<span class="ident" id="5118650">typeInfoMap</span><span class="op" id="5118661">.</span><span class="ident" id="5118662">Load</span><span class="op" id="5118666">(</span><span class="op" id="5118667">)</span><span class="op" id="5118668">.</span><span class="op" id="5118669">(</span><span class="keyword" id="5118670">map</span><span class="op" id="5118673">[</span><span class="ident" id="5118674">reflect</span><span class="op" id="5118681">.</span><span class="ident" id="5118682">Type</span><span class="op" id="5118686">]</span><span class="op" id="5118687">*</span><span class="ident" id="5118688">typeInfo</span><span class="op" id="5118696">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118699">return</span>&nbsp;<span class="ident" id="5118706">m</span><span class="op" id="5118707">[</span><span class="ident" id="5118708">rt</span><span class="op" id="5118710">]</span><br>
<span class="lineno"></span><span class="op" id="5118712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5118715">func</span>&nbsp;<span class="ident" id="5118720">getTypeInfo</span><span class="op" id="5118731">(</span><span class="ident" id="5118732">ut</span>&nbsp;<span class="op" id="5118735">*</span><span class="ident" id="5118736">userTypeInfo</span><span class="op" id="5118748">)</span>&nbsp;<span class="op" id="5118750">(</span><span class="op" id="5118751">*</span><span class="ident" id="5118752">typeInfo</span><span class="op" id="5118760">,</span>&nbsp;<span class="builtintype" id="5118762">error</span><span class="op" id="5118767">)</span>&nbsp;<span class="op" id="5118769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118772">rt</span>&nbsp;<span class="op" id="5118775">:=</span>&nbsp;<span class="ident" id="5118778">ut</span><span class="op" id="5118780">.</span><span class="ident" id="5118781">base</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118787">if</span>&nbsp;<span class="ident" id="5118790">ut</span><span class="op" id="5118792">.</span><span class="ident" id="5118793">externalEnc</span>&nbsp;<span class="op" id="5118805">!=</span>&nbsp;<span class="num" id="5118808">0</span>&nbsp;<span class="op" id="5118810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5118814">//&nbsp;We&nbsp;want&nbsp;the&nbsp;user&nbsp;type,&nbsp;not&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118861">rt</span>&nbsp;<span class="op" id="5118864">=</span>&nbsp;<span class="ident" id="5118866">ut</span><span class="op" id="5118868">.</span><span class="ident" id="5118869">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118878">if</span>&nbsp;<span class="ident" id="5118881">info</span>&nbsp;<span class="op" id="5118886">:=</span>&nbsp;<span class="ident" id="5118889">lookupTypeInfo</span><span class="op" id="5118903">(</span><span class="ident" id="5118904">rt</span><span class="op" id="5118906">)</span><span class="op" id="5118907">;</span>&nbsp;<span class="ident" id="5118909">info</span>&nbsp;<span class="op" id="5118914">!=</span>&nbsp;<span class="ident" id="5118917">nil</span>&nbsp;<span class="op" id="5118921">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118925">return</span>&nbsp;<span class="ident" id="5118932">info</span><span class="op" id="5118936">,</span>&nbsp;<span class="ident" id="5118938">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118946">return</span>&nbsp;<span class="ident" id="5118953">buildTypeInfo</span><span class="op" id="5118966">(</span><span class="ident" id="5118967">ut</span><span class="op" id="5118969">,</span>&nbsp;<span class="ident" id="5118971">rt</span><span class="op" id="5118973">)</span><br>
<span class="lineno"></span><span class="op" id="5118975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">715</span><span class="comment" id="5118978">//&nbsp;buildTypeInfo&nbsp;constructs&nbsp;the&nbsp;type&nbsp;information&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5119040">//&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;type&nbsp;info&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="5119079">func</span>&nbsp;<span class="ident" id="5119084">buildTypeInfo</span><span class="op" id="5119097">(</span><span class="ident" id="5119098">ut</span>&nbsp;<span class="op" id="5119101">*</span><span class="ident" id="5119102">userTypeInfo</span><span class="op" id="5119114">,</span>&nbsp;<span class="ident" id="5119116">rt</span>&nbsp;<span class="ident" id="5119119">reflect</span><span class="op" id="5119126">.</span><span class="ident" id="5119127">Type</span><span class="op" id="5119131">)</span>&nbsp;<span class="op" id="5119133">(</span><span class="op" id="5119134">*</span><span class="ident" id="5119135">typeInfo</span><span class="op" id="5119143">,</span>&nbsp;<span class="builtintype" id="5119145">error</span><span class="op" id="5119150">)</span>&nbsp;<span class="op" id="5119152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119155">typeLock</span><span class="op" id="5119163">.</span><span class="ident" id="5119164">Lock</span><span class="op" id="5119168">(</span><span class="op" id="5119169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119172">defer</span>&nbsp;<span class="ident" id="5119178">typeLock</span><span class="op" id="5119186">.</span><span class="ident" id="5119187">Unlock</span><span class="op" id="5119193">(</span><span class="op" id="5119194">)</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119198">if</span>&nbsp;<span class="ident" id="5119201">info</span>&nbsp;<span class="op" id="5119206">:=</span>&nbsp;<span class="ident" id="5119209">lookupTypeInfo</span><span class="op" id="5119223">(</span><span class="ident" id="5119224">rt</span><span class="op" id="5119226">)</span><span class="op" id="5119227">;</span>&nbsp;<span class="ident" id="5119229">info</span>&nbsp;<span class="op" id="5119234">!=</span>&nbsp;<span class="ident" id="5119237">nil</span>&nbsp;<span class="op" id="5119241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119245">return</span>&nbsp;<span class="ident" id="5119252">info</span><span class="op" id="5119256">,</span>&nbsp;<span class="ident" id="5119258">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119267">gt</span><span class="op" id="5119269">,</span>&nbsp;<span class="ident" id="5119271">err</span>&nbsp;<span class="op" id="5119275">:=</span>&nbsp;<span class="ident" id="5119278">getBaseType</span><span class="op" id="5119289">(</span><span class="ident" id="5119290">rt</span><span class="op" id="5119292">.</span><span class="ident" id="5119293">Name</span><span class="op" id="5119297">(</span><span class="op" id="5119298">)</span><span class="op" id="5119299">,</span>&nbsp;<span class="ident" id="5119301">rt</span><span class="op" id="5119303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119306">if</span>&nbsp;<span class="ident" id="5119309">err</span>&nbsp;<span class="op" id="5119313">!=</span>&nbsp;<span class="ident" id="5119316">nil</span>&nbsp;<span class="op" id="5119320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119324">return</span>&nbsp;<span class="ident" id="5119331">nil</span><span class="op" id="5119334">,</span>&nbsp;<span class="ident" id="5119336">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119344">info</span>&nbsp;<span class="op" id="5119349">:=</span>&nbsp;<span class="op" id="5119352">&amp;</span><span class="ident" id="5119353">typeInfo</span><span class="op" id="5119361">{</span><span class="ident" id="5119362">id</span><span class="op" id="5119364">:</span>&nbsp;<span class="ident" id="5119366">gt</span><span class="op" id="5119368">.</span><span class="ident" id="5119369">id</span><span class="op" id="5119371">(</span><span class="op" id="5119372">)</span><span class="op" id="5119373">}</span><br>
<span class="lineno">730</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119377">if</span>&nbsp;<span class="ident" id="5119380">ut</span><span class="op" id="5119382">.</span><span class="ident" id="5119383">externalEnc</span>&nbsp;<span class="op" id="5119395">!=</span>&nbsp;<span class="num" id="5119398">0</span>&nbsp;<span class="op" id="5119400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119404">userType</span><span class="op" id="5119412">,</span>&nbsp;<span class="ident" id="5119414">err</span>&nbsp;<span class="op" id="5119418">:=</span>&nbsp;<span class="ident" id="5119421">getType</span><span class="op" id="5119428">(</span><span class="ident" id="5119429">rt</span><span class="op" id="5119431">.</span><span class="ident" id="5119432">Name</span><span class="op" id="5119436">(</span><span class="op" id="5119437">)</span><span class="op" id="5119438">,</span>&nbsp;<span class="ident" id="5119440">ut</span><span class="op" id="5119442">,</span>&nbsp;<span class="ident" id="5119444">rt</span><span class="op" id="5119446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119450">if</span>&nbsp;<span class="ident" id="5119453">err</span>&nbsp;<span class="op" id="5119457">!=</span>&nbsp;<span class="ident" id="5119460">nil</span>&nbsp;<span class="op" id="5119464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119469">return</span>&nbsp;<span class="ident" id="5119476">nil</span><span class="op" id="5119479">,</span>&nbsp;<span class="ident" id="5119481">err</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119491">gt</span>&nbsp;<span class="op" id="5119494">:=</span>&nbsp;<span class="ident" id="5119497">userType</span><span class="op" id="5119505">.</span><span class="ident" id="5119506">id</span><span class="op" id="5119508">(</span><span class="op" id="5119509">)</span><span class="op" id="5119510">.</span><span class="ident" id="5119511">gobType</span><span class="op" id="5119518">(</span><span class="op" id="5119519">)</span><span class="op" id="5119520">.</span><span class="op" id="5119521">(</span><span class="op" id="5119522">*</span><span class="ident" id="5119523">gobEncoderType</span><span class="op" id="5119537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119541">switch</span>&nbsp;<span class="ident" id="5119548">ut</span><span class="op" id="5119550">.</span><span class="ident" id="5119551">externalEnc</span>&nbsp;<span class="op" id="5119563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119567">case</span>&nbsp;<span class="ident" id="5119572">xGob</span><span class="op" id="5119576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119581">info</span><span class="op" id="5119585">.</span><span class="ident" id="5119586">wire</span>&nbsp;<span class="op" id="5119591">=</span>&nbsp;<span class="op" id="5119593">&amp;</span><span class="ident" id="5119594">wireType</span><span class="op" id="5119602">{</span><span class="ident" id="5119603">GobEncoderT</span><span class="op" id="5119614">:</span>&nbsp;<span class="ident" id="5119616">gt</span><span class="op" id="5119618">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119622">case</span>&nbsp;<span class="ident" id="5119627">xBinary</span><span class="op" id="5119634">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119639">info</span><span class="op" id="5119643">.</span><span class="ident" id="5119644">wire</span>&nbsp;<span class="op" id="5119649">=</span>&nbsp;<span class="op" id="5119651">&amp;</span><span class="ident" id="5119652">wireType</span><span class="op" id="5119660">{</span><span class="ident" id="5119661">BinaryMarshalerT</span><span class="op" id="5119677">:</span>&nbsp;<span class="ident" id="5119679">gt</span><span class="op" id="5119681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119685">case</span>&nbsp;<span class="ident" id="5119690">xText</span><span class="op" id="5119695">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119700">info</span><span class="op" id="5119704">.</span><span class="ident" id="5119705">wire</span>&nbsp;<span class="op" id="5119710">=</span>&nbsp;<span class="op" id="5119712">&amp;</span><span class="ident" id="5119713">wireType</span><span class="op" id="5119721">{</span><span class="ident" id="5119722">TextMarshalerT</span><span class="op" id="5119736">:</span>&nbsp;<span class="ident" id="5119738">gt</span><span class="op" id="5119740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119744">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119748">rt</span>&nbsp;<span class="op" id="5119751">=</span>&nbsp;<span class="ident" id="5119753">ut</span><span class="op" id="5119755">.</span><span class="ident" id="5119756">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119762">}</span>&nbsp;<span class="keyword" id="5119764">else</span>&nbsp;<span class="op" id="5119769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119773">t</span>&nbsp;<span class="op" id="5119775">:=</span>&nbsp;<span class="ident" id="5119778">info</span><span class="op" id="5119782">.</span><span class="ident" id="5119783">id</span><span class="op" id="5119785">.</span><span class="ident" id="5119786">gobType</span><span class="op" id="5119793">(</span><span class="op" id="5119794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119798">switch</span>&nbsp;<span class="ident" id="5119805">typ</span>&nbsp;<span class="op" id="5119809">:=</span>&nbsp;<span class="ident" id="5119812">rt</span><span class="op" id="5119814">;</span>&nbsp;<span class="ident" id="5119816">typ</span><span class="op" id="5119819">.</span><span class="ident" id="5119820">Kind</span><span class="op" id="5119824">(</span><span class="op" id="5119825">)</span>&nbsp;<span class="op" id="5119827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119831">case</span>&nbsp;<span class="ident" id="5119836">reflect</span><span class="op" id="5119843">.</span><span class="ident" id="5119844">Array</span><span class="op" id="5119849">:</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119854">info</span><span class="op" id="5119858">.</span><span class="ident" id="5119859">wire</span>&nbsp;<span class="op" id="5119864">=</span>&nbsp;<span class="op" id="5119866">&amp;</span><span class="ident" id="5119867">wireType</span><span class="op" id="5119875">{</span><span class="ident" id="5119876">ArrayT</span><span class="op" id="5119882">:</span>&nbsp;<span class="ident" id="5119884">t</span><span class="op" id="5119885">.</span><span class="op" id="5119886">(</span><span class="op" id="5119887">*</span><span class="ident" id="5119888">arrayType</span><span class="op" id="5119897">)</span><span class="op" id="5119898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119902">case</span>&nbsp;<span class="ident" id="5119907">reflect</span><span class="op" id="5119914">.</span><span class="ident" id="5119915">Map</span><span class="op" id="5119918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119923">info</span><span class="op" id="5119927">.</span><span class="ident" id="5119928">wire</span>&nbsp;<span class="op" id="5119933">=</span>&nbsp;<span class="op" id="5119935">&amp;</span><span class="ident" id="5119936">wireType</span><span class="op" id="5119944">{</span><span class="ident" id="5119945">MapT</span><span class="op" id="5119949">:</span>&nbsp;<span class="ident" id="5119951">t</span><span class="op" id="5119952">.</span><span class="op" id="5119953">(</span><span class="op" id="5119954">*</span><span class="ident" id="5119955">mapType</span><span class="op" id="5119962">)</span><span class="op" id="5119963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119967">case</span>&nbsp;<span class="ident" id="5119972">reflect</span><span class="op" id="5119979">.</span><span class="ident" id="5119980">Slice</span><span class="op" id="5119985">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5119990">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;handled&nbsp;separately</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120051">if</span>&nbsp;<span class="ident" id="5120054">typ</span><span class="op" id="5120057">.</span><span class="ident" id="5120058">Elem</span><span class="op" id="5120062">(</span><span class="op" id="5120063">)</span><span class="op" id="5120064">.</span><span class="ident" id="5120065">Kind</span><span class="op" id="5120069">(</span><span class="op" id="5120070">)</span>&nbsp;<span class="op" id="5120072">!=</span>&nbsp;<span class="ident" id="5120075">reflect</span><span class="op" id="5120082">.</span><span class="ident" id="5120083">Uint8</span>&nbsp;<span class="op" id="5120089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120095">info</span><span class="op" id="5120099">.</span><span class="ident" id="5120100">wire</span>&nbsp;<span class="op" id="5120105">=</span>&nbsp;<span class="op" id="5120107">&amp;</span><span class="ident" id="5120108">wireType</span><span class="op" id="5120116">{</span><span class="ident" id="5120117">SliceT</span><span class="op" id="5120123">:</span>&nbsp;<span class="ident" id="5120125">t</span><span class="op" id="5120126">.</span><span class="op" id="5120127">(</span><span class="op" id="5120128">*</span><span class="ident" id="5120129">sliceType</span><span class="op" id="5120138">)</span><span class="op" id="5120139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120148">case</span>&nbsp;<span class="ident" id="5120153">reflect</span><span class="op" id="5120160">.</span><span class="ident" id="5120161">Struct</span><span class="op" id="5120167">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120172">info</span><span class="op" id="5120176">.</span><span class="ident" id="5120177">wire</span>&nbsp;<span class="op" id="5120182">=</span>&nbsp;<span class="op" id="5120184">&amp;</span><span class="ident" id="5120185">wireType</span><span class="op" id="5120193">{</span><span class="ident" id="5120194">StructT</span><span class="op" id="5120201">:</span>&nbsp;<span class="ident" id="5120203">t</span><span class="op" id="5120204">.</span><span class="op" id="5120205">(</span><span class="op" id="5120206">*</span><span class="ident" id="5120207">structType</span><span class="op" id="5120217">)</span><span class="op" id="5120218">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120229">//&nbsp;Create&nbsp;new&nbsp;map&nbsp;with&nbsp;old&nbsp;contents&nbsp;plus&nbsp;new&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120282">newm</span>&nbsp;<span class="op" id="5120287">:=</span>&nbsp;<span class="builtinfunc" id="5120290">make</span><span class="op" id="5120294">(</span><span class="keyword" id="5120295">map</span><span class="op" id="5120298">[</span><span class="ident" id="5120299">reflect</span><span class="op" id="5120306">.</span><span class="ident" id="5120307">Type</span><span class="op" id="5120311">]</span><span class="op" id="5120312">*</span><span class="ident" id="5120313">typeInfo</span><span class="op" id="5120321">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120324">m</span><span class="op" id="5120325">,</span>&nbsp;<span class="ident" id="5120327">_</span>&nbsp;<span class="op" id="5120329">:=</span>&nbsp;<span class="ident" id="5120332">typeInfoMap</span><span class="op" id="5120343">.</span><span class="ident" id="5120344">Load</span><span class="op" id="5120348">(</span><span class="op" id="5120349">)</span><span class="op" id="5120350">.</span><span class="op" id="5120351">(</span><span class="keyword" id="5120352">map</span><span class="op" id="5120355">[</span><span class="ident" id="5120356">reflect</span><span class="op" id="5120363">.</span><span class="ident" id="5120364">Type</span><span class="op" id="5120368">]</span><span class="op" id="5120369">*</span><span class="ident" id="5120370">typeInfo</span><span class="op" id="5120378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120381">for</span>&nbsp;<span class="ident" id="5120385">k</span><span class="op" id="5120386">,</span>&nbsp;<span class="ident" id="5120388">v</span>&nbsp;<span class="op" id="5120390">:=</span>&nbsp;<span class="keyword" id="5120393">range</span>&nbsp;<span class="ident" id="5120399">m</span>&nbsp;<span class="op" id="5120401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120405">newm</span><span class="op" id="5120409">[</span><span class="ident" id="5120410">k</span><span class="op" id="5120411">]</span>&nbsp;<span class="op" id="5120413">=</span>&nbsp;<span class="ident" id="5120415">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120421">newm</span><span class="op" id="5120425">[</span><span class="ident" id="5120426">rt</span><span class="op" id="5120428">]</span>&nbsp;<span class="op" id="5120430">=</span>&nbsp;<span class="ident" id="5120432">info</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120438">typeInfoMap</span><span class="op" id="5120449">.</span><span class="ident" id="5120450">Store</span><span class="op" id="5120455">(</span><span class="ident" id="5120456">newm</span><span class="op" id="5120460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120463">return</span>&nbsp;<span class="ident" id="5120470">info</span><span class="op" id="5120474">,</span>&nbsp;<span class="ident" id="5120476">nil</span><br>
<span class="lineno"></span><span class="op" id="5120480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5120483">//&nbsp;Called&nbsp;only&nbsp;when&nbsp;a&nbsp;panic&nbsp;is&nbsp;acceptable&nbsp;and&nbsp;unexpected.</span><br>
<span class="lineno">775</span><span class="keyword" id="5120541">func</span>&nbsp;<span class="ident" id="5120546">mustGetTypeInfo</span><span class="op" id="5120561">(</span><span class="ident" id="5120562">rt</span>&nbsp;<span class="ident" id="5120565">reflect</span><span class="op" id="5120572">.</span><span class="ident" id="5120573">Type</span><span class="op" id="5120577">)</span>&nbsp;<span class="op" id="5120579">*</span><span class="ident" id="5120580">typeInfo</span>&nbsp;<span class="op" id="5120589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120592">t</span><span class="op" id="5120593">,</span>&nbsp;<span class="ident" id="5120595">err</span>&nbsp;<span class="op" id="5120599">:=</span>&nbsp;<span class="ident" id="5120602">getTypeInfo</span><span class="op" id="5120613">(</span><span class="ident" id="5120614">userType</span><span class="op" id="5120622">(</span><span class="ident" id="5120623">rt</span><span class="op" id="5120625">)</span><span class="op" id="5120626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120629">if</span>&nbsp;<span class="ident" id="5120632">err</span>&nbsp;<span class="op" id="5120636">!=</span>&nbsp;<span class="ident" id="5120639">nil</span>&nbsp;<span class="op" id="5120643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5120647">panic</span><span class="op" id="5120652">(</span><span class="string" id="5120653">&#34;getTypeInfo:&nbsp;&#34;</span>&nbsp;<span class="op" id="5120669">+</span>&nbsp;<span class="ident" id="5120671">err</span><span class="op" id="5120674">.</span><span class="ident" id="5120675">Error</span><span class="op" id="5120680">(</span><span class="op" id="5120681">)</span><span class="op" id="5120682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120685">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120688">return</span>&nbsp;<span class="ident" id="5120695">t</span><br>
<span class="lineno"></span><span class="op" id="5120697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5120700">//&nbsp;GobEncoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="5120769">//&nbsp;representation&nbsp;for&nbsp;encoding&nbsp;values&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder.</span><br>
<span class="lineno">785</span><span class="comment" id="5120841">//&nbsp;A&nbsp;type&nbsp;that&nbsp;implements&nbsp;GobEncoder&nbsp;and&nbsp;GobDecoder&nbsp;has&nbsp;complete</span><br>
<span class="lineno"></span><span class="comment" id="5120906">//&nbsp;control&nbsp;over&nbsp;the&nbsp;representation&nbsp;of&nbsp;its&nbsp;data&nbsp;and&nbsp;may&nbsp;therefore</span><br>
<span class="lineno"></span><span class="comment" id="5120971">//&nbsp;contain&nbsp;things&nbsp;such&nbsp;as&nbsp;private&nbsp;fields,&nbsp;channels,&nbsp;and&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="5121038">//&nbsp;which&nbsp;are&nbsp;not&nbsp;usually&nbsp;transmissible&nbsp;in&nbsp;gob&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="5121093">//</span><br>
<span class="lineno">790</span><span class="comment" id="5121096">//&nbsp;Note:&nbsp;Since&nbsp;gobs&nbsp;can&nbsp;be&nbsp;stored&nbsp;permanently,&nbsp;It&nbsp;is&nbsp;good&nbsp;design</span><br>
<span class="lineno"></span><span class="comment" id="5121161">//&nbsp;to&nbsp;guarantee&nbsp;the&nbsp;encoding&nbsp;used&nbsp;by&nbsp;a&nbsp;GobEncoder&nbsp;is&nbsp;stable&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5121228">//&nbsp;software&nbsp;evolves.&nbsp;&nbsp;For&nbsp;instance,&nbsp;it&nbsp;might&nbsp;make&nbsp;sense&nbsp;for&nbsp;GobEncode</span><br>
<span class="lineno"></span><span class="comment" id="5121298">//&nbsp;to&nbsp;include&nbsp;a&nbsp;version&nbsp;number&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5121346">type</span>&nbsp;<span class="ident" id="5121351">GobEncoder</span>&nbsp;<span class="keyword" id="5121362">interface</span>&nbsp;<span class="op" id="5121372">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5121375">//&nbsp;GobEncode&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;representing&nbsp;the&nbsp;encoding&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5121443">//&nbsp;receiver&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder,&nbsp;usually&nbsp;of&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5121510">//&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121529">GobEncode</span><span class="op" id="5121538">(</span><span class="op" id="5121539">)</span>&nbsp;<span class="op" id="5121541">(</span><span class="op" id="5121542">[</span><span class="op" id="5121543">]</span><span class="builtintype" id="5121544">byte</span><span class="op" id="5121548">,</span>&nbsp;<span class="builtintype" id="5121550">error</span><span class="op" id="5121555">)</span><br>
<span class="lineno"></span><span class="op" id="5121557">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="5121560">//&nbsp;GobDecoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="5121629">//&nbsp;routine&nbsp;for&nbsp;decoding&nbsp;transmitted&nbsp;values&nbsp;sent&nbsp;by&nbsp;a&nbsp;GobEncoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5121694">type</span>&nbsp;<span class="ident" id="5121699">GobDecoder</span>&nbsp;<span class="keyword" id="5121710">interface</span>&nbsp;<span class="op" id="5121720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5121723">//&nbsp;GobDecode&nbsp;overwrites&nbsp;the&nbsp;receiver,&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer,</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5121787">//&nbsp;with&nbsp;the&nbsp;value&nbsp;represented&nbsp;by&nbsp;the&nbsp;byte&nbsp;slice,&nbsp;which&nbsp;was&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5121855">//&nbsp;by&nbsp;GobEncode,&nbsp;usually&nbsp;for&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121909">GobDecode</span><span class="op" id="5121918">(</span><span class="op" id="5121919">[</span><span class="op" id="5121920">]</span><span class="builtintype" id="5121921">byte</span><span class="op" id="5121925">)</span>&nbsp;<span class="builtintype" id="5121927">error</span><br>
<span class="lineno"></span><span class="op" id="5121933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="5121936">var</span>&nbsp;<span class="op" id="5121940">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121943">registerLock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5121962">sync</span><span class="op" id="5121966">.</span><span class="ident" id="5121967">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121976">nameToConcreteType</span>&nbsp;<span class="op" id="5121995">=</span>&nbsp;<span class="builtinfunc" id="5121997">make</span><span class="op" id="5122001">(</span><span class="keyword" id="5122002">map</span><span class="op" id="5122005">[</span><span class="builtintype" id="5122006">string</span><span class="op" id="5122012">]</span><span class="ident" id="5122013">reflect</span><span class="op" id="5122020">.</span><span class="ident" id="5122021">Type</span><span class="op" id="5122025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122028">concreteTypeToName</span>&nbsp;<span class="op" id="5122047">=</span>&nbsp;<span class="builtinfunc" id="5122049">make</span><span class="op" id="5122053">(</span><span class="keyword" id="5122054">map</span><span class="op" id="5122057">[</span><span class="ident" id="5122058">reflect</span><span class="op" id="5122065">.</span><span class="ident" id="5122066">Type</span><span class="op" id="5122070">]</span><span class="builtintype" id="5122071">string</span><span class="op" id="5122077">)</span><br>
<span class="lineno"></span><span class="op" id="5122079">)</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="5122082">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;rather&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5122158">//&nbsp;type&#39;s&nbsp;default.</span><br>
<span class="lineno"></span><span class="keyword" id="5122177">func</span>&nbsp;<span class="ident" id="5122182">RegisterName</span><span class="op" id="5122194">(</span><span class="ident" id="5122195">name</span>&nbsp;<span class="builtintype" id="5122200">string</span><span class="op" id="5122206">,</span>&nbsp;<span class="ident" id="5122208">value</span>&nbsp;<span class="keyword" id="5122214">interface</span><span class="op" id="5122223">{</span><span class="op" id="5122224">}</span><span class="op" id="5122225">)</span>&nbsp;<span class="op" id="5122227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122230">if</span>&nbsp;<span class="ident" id="5122233">name</span>&nbsp;<span class="op" id="5122238">==</span>&nbsp;<span class="string" id="5122241">&#34;&#34;</span>&nbsp;<span class="op" id="5122244">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5122248">//&nbsp;reserved&nbsp;for&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5122270">panic</span><span class="op" id="5122275">(</span><span class="string" id="5122276">&#34;attempt&nbsp;to&nbsp;register&nbsp;empty&nbsp;name&#34;</span><span class="op" id="5122308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122314">registerLock</span><span class="op" id="5122326">.</span><span class="ident" id="5122327">Lock</span><span class="op" id="5122331">(</span><span class="op" id="5122332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122335">defer</span>&nbsp;<span class="ident" id="5122341">registerLock</span><span class="op" id="5122353">.</span><span class="ident" id="5122354">Unlock</span><span class="op" id="5122360">(</span><span class="op" id="5122361">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122364">ut</span>&nbsp;<span class="op" id="5122367">:=</span>&nbsp;<span class="ident" id="5122370">userType</span><span class="op" id="5122378">(</span><span class="ident" id="5122379">reflect</span><span class="op" id="5122386">.</span><span class="ident" id="5122387">TypeOf</span><span class="op" id="5122393">(</span><span class="ident" id="5122394">value</span><span class="op" id="5122399">)</span><span class="op" id="5122400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5122403">//&nbsp;Check&nbsp;for&nbsp;incompatible&nbsp;duplicates.&nbsp;The&nbsp;name&nbsp;must&nbsp;refer&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5122469">//&nbsp;same&nbsp;user&nbsp;type,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122505">if</span>&nbsp;<span class="ident" id="5122508">t</span><span class="op" id="5122509">,</span>&nbsp;<span class="ident" id="5122511">ok</span>&nbsp;<span class="op" id="5122514">:=</span>&nbsp;<span class="ident" id="5122517">nameToConcreteType</span><span class="op" id="5122535">[</span><span class="ident" id="5122536">name</span><span class="op" id="5122540">]</span><span class="op" id="5122541">;</span>&nbsp;<span class="ident" id="5122543">ok</span>&nbsp;<span class="op" id="5122546">&amp;&amp;</span>&nbsp;<span class="ident" id="5122549">t</span>&nbsp;<span class="op" id="5122551">!=</span>&nbsp;<span class="ident" id="5122554">ut</span><span class="op" id="5122556">.</span><span class="ident" id="5122557">user</span>&nbsp;<span class="op" id="5122562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5122566">panic</span><span class="op" id="5122571">(</span><span class="ident" id="5122572">fmt</span><span class="op" id="5122575">.</span><span class="ident" id="5122576">Sprintf</span><span class="op" id="5122583">(</span><span class="string" id="5122584">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;types&nbsp;for&nbsp;%q:&nbsp;%s&nbsp;!=&nbsp;%s&#34;</span><span class="op" id="5122635">,</span>&nbsp;<span class="ident" id="5122637">name</span><span class="op" id="5122641">,</span>&nbsp;<span class="ident" id="5122643">t</span><span class="op" id="5122644">,</span>&nbsp;<span class="ident" id="5122646">ut</span><span class="op" id="5122648">.</span><span class="ident" id="5122649">user</span><span class="op" id="5122653">)</span><span class="op" id="5122654">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122660">if</span>&nbsp;<span class="ident" id="5122663">n</span><span class="op" id="5122664">,</span>&nbsp;<span class="ident" id="5122666">ok</span>&nbsp;<span class="op" id="5122669">:=</span>&nbsp;<span class="ident" id="5122672">concreteTypeToName</span><span class="op" id="5122690">[</span><span class="ident" id="5122691">ut</span><span class="op" id="5122693">.</span><span class="ident" id="5122694">base</span><span class="op" id="5122698">]</span><span class="op" id="5122699">;</span>&nbsp;<span class="ident" id="5122701">ok</span>&nbsp;<span class="op" id="5122704">&amp;&amp;</span>&nbsp;<span class="ident" id="5122707">n</span>&nbsp;<span class="op" id="5122709">!=</span>&nbsp;<span class="ident" id="5122712">name</span>&nbsp;<span class="op" id="5122717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5122721">panic</span><span class="op" id="5122726">(</span><span class="ident" id="5122727">fmt</span><span class="op" id="5122730">.</span><span class="ident" id="5122731">Sprintf</span><span class="op" id="5122738">(</span><span class="string" id="5122739">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;names&nbsp;for&nbsp;%s:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="5122790">,</span>&nbsp;<span class="ident" id="5122792">ut</span><span class="op" id="5122794">.</span><span class="ident" id="5122795">user</span><span class="op" id="5122799">,</span>&nbsp;<span class="ident" id="5122801">n</span><span class="op" id="5122802">,</span>&nbsp;<span class="ident" id="5122804">name</span><span class="op" id="5122808">)</span><span class="op" id="5122809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5122815">//&nbsp;Store&nbsp;the&nbsp;name&nbsp;and&nbsp;type&nbsp;provided&nbsp;by&nbsp;the&nbsp;user....</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122868">nameToConcreteType</span><span class="op" id="5122886">[</span><span class="ident" id="5122887">name</span><span class="op" id="5122891">]</span>&nbsp;<span class="op" id="5122893">=</span>&nbsp;<span class="ident" id="5122895">reflect</span><span class="op" id="5122902">.</span><span class="ident" id="5122903">TypeOf</span><span class="op" id="5122909">(</span><span class="ident" id="5122910">value</span><span class="op" id="5122915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5122918">//&nbsp;but&nbsp;the&nbsp;flattened&nbsp;type&nbsp;in&nbsp;the&nbsp;type&nbsp;table,&nbsp;since&nbsp;that&#39;s&nbsp;what&nbsp;decode&nbsp;needs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122996">concreteTypeToName</span><span class="op" id="5123014">[</span><span class="ident" id="5123015">ut</span><span class="op" id="5123017">.</span><span class="ident" id="5123018">base</span><span class="op" id="5123022">]</span>&nbsp;<span class="op" id="5123024">=</span>&nbsp;<span class="ident" id="5123026">name</span><br>
<span class="lineno"></span><span class="op" id="5123031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="5123034">//&nbsp;Register&nbsp;records&nbsp;a&nbsp;type,&nbsp;identified&nbsp;by&nbsp;a&nbsp;value&nbsp;for&nbsp;that&nbsp;type,&nbsp;under&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5123109">//&nbsp;internal&nbsp;type&nbsp;name.&nbsp;&nbsp;That&nbsp;name&nbsp;will&nbsp;identify&nbsp;the&nbsp;concrete&nbsp;type&nbsp;of&nbsp;a&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5123186">//&nbsp;sent&nbsp;or&nbsp;received&nbsp;as&nbsp;an&nbsp;interface&nbsp;variable.&nbsp;&nbsp;Only&nbsp;types&nbsp;that&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5123257">//&nbsp;transferred&nbsp;as&nbsp;implementations&nbsp;of&nbsp;interface&nbsp;values&nbsp;need&nbsp;to&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span><span class="comment" id="5123334">//&nbsp;Expecting&nbsp;to&nbsp;be&nbsp;used&nbsp;only&nbsp;during&nbsp;initialization,&nbsp;it&nbsp;panics&nbsp;if&nbsp;the&nbsp;mapping</span><br>
<span class="lineno">845</span><span class="comment" id="5123411">//&nbsp;between&nbsp;types&nbsp;and&nbsp;names&nbsp;is&nbsp;not&nbsp;a&nbsp;bijection.</span><br>
<span class="lineno"></span><span class="keyword" id="5123458">func</span>&nbsp;<span class="ident" id="5123463">Register</span><span class="op" id="5123471">(</span><span class="ident" id="5123472">value</span>&nbsp;<span class="keyword" id="5123478">interface</span><span class="op" id="5123487">{</span><span class="op" id="5123488">}</span><span class="op" id="5123489">)</span>&nbsp;<span class="op" id="5123491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123494">//&nbsp;Default&nbsp;to&nbsp;printed&nbsp;representation&nbsp;for&nbsp;unnamed&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123550">rt</span>&nbsp;<span class="op" id="5123553">:=</span>&nbsp;<span class="ident" id="5123556">reflect</span><span class="op" id="5123563">.</span><span class="ident" id="5123564">TypeOf</span><span class="op" id="5123570">(</span><span class="ident" id="5123571">value</span><span class="op" id="5123576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123579">name</span>&nbsp;<span class="op" id="5123584">:=</span>&nbsp;<span class="ident" id="5123587">rt</span><span class="op" id="5123589">.</span><span class="ident" id="5123590">String</span><span class="op" id="5123596">(</span><span class="op" id="5123597">)</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123601">//&nbsp;But&nbsp;for&nbsp;named&nbsp;types&nbsp;(or&nbsp;pointers&nbsp;to&nbsp;them),&nbsp;qualify&nbsp;with&nbsp;import&nbsp;path&nbsp;(but&nbsp;see&nbsp;inner&nbsp;comment).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123698">//&nbsp;Dereference&nbsp;one&nbsp;pointer&nbsp;looking&nbsp;for&nbsp;a&nbsp;named&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123752">star</span>&nbsp;<span class="op" id="5123757">:=</span>&nbsp;<span class="string" id="5123760">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5123764">if</span>&nbsp;<span class="ident" id="5123767">rt</span><span class="op" id="5123769">.</span><span class="ident" id="5123770">Name</span><span class="op" id="5123774">(</span><span class="op" id="5123775">)</span>&nbsp;<span class="op" id="5123777">==</span>&nbsp;<span class="string" id="5123780">&#34;&#34;</span>&nbsp;<span class="op" id="5123783">{</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5123787">if</span>&nbsp;<span class="ident" id="5123790">pt</span>&nbsp;<span class="op" id="5123793">:=</span>&nbsp;<span class="ident" id="5123796">rt</span><span class="op" id="5123798">;</span>&nbsp;<span class="ident" id="5123800">pt</span><span class="op" id="5123802">.</span><span class="ident" id="5123803">Kind</span><span class="op" id="5123807">(</span><span class="op" id="5123808">)</span>&nbsp;<span class="op" id="5123810">==</span>&nbsp;<span class="ident" id="5123813">reflect</span><span class="op" id="5123820">.</span><span class="ident" id="5123821">Ptr</span>&nbsp;<span class="op" id="5123825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123830">star</span>&nbsp;<span class="op" id="5123835">=</span>&nbsp;<span class="string" id="5123837">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123844">//&nbsp;NOTE:&nbsp;The&nbsp;following&nbsp;line&nbsp;should&nbsp;be&nbsp;rt&nbsp;=&nbsp;pt.Elem()&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123913">//&nbsp;what&nbsp;the&nbsp;comment&nbsp;above&nbsp;claims,&nbsp;but&nbsp;fixing&nbsp;it&nbsp;would&nbsp;break&nbsp;compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123990">//&nbsp;with&nbsp;existing&nbsp;gobs.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124016">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124022">//&nbsp;Given&nbsp;package&nbsp;p&nbsp;imported&nbsp;as&nbsp;&#34;full/p&#34;&nbsp;with&nbsp;these&nbsp;definitions:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124089">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124109">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;T1&nbsp;struct&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124142">//&nbsp;this&nbsp;table&nbsp;shows&nbsp;the&nbsp;intended&nbsp;and&nbsp;actual&nbsp;strings&nbsp;used&nbsp;by&nbsp;gob&nbsp;to</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124212">//&nbsp;name&nbsp;the&nbsp;types:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124234">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124240">//&nbsp;Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Correct&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actual&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124289">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124295">//&nbsp;T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124340">//&nbsp;*T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p.T1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124381">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124387">//&nbsp;The&nbsp;missing&nbsp;full&nbsp;path&nbsp;cannot&nbsp;be&nbsp;fixed&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;gob&nbsp;decoders.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124471">rt</span>&nbsp;<span class="op" id="5124474">=</span>&nbsp;<span class="ident" id="5124476">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124481">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124487">if</span>&nbsp;<span class="ident" id="5124490">rt</span><span class="op" id="5124492">.</span><span class="ident" id="5124493">Name</span><span class="op" id="5124497">(</span><span class="op" id="5124498">)</span>&nbsp;<span class="op" id="5124500">!=</span>&nbsp;<span class="string" id="5124503">&#34;&#34;</span>&nbsp;<span class="op" id="5124506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124510">if</span>&nbsp;<span class="ident" id="5124513">rt</span><span class="op" id="5124515">.</span><span class="ident" id="5124516">PkgPath</span><span class="op" id="5124523">(</span><span class="op" id="5124524">)</span>&nbsp;<span class="op" id="5124526">==</span>&nbsp;<span class="string" id="5124529">&#34;&#34;</span>&nbsp;<span class="op" id="5124532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124537">name</span>&nbsp;<span class="op" id="5124542">=</span>&nbsp;<span class="ident" id="5124544">star</span>&nbsp;<span class="op" id="5124549">+</span>&nbsp;<span class="ident" id="5124551">rt</span><span class="op" id="5124553">.</span><span class="ident" id="5124554">Name</span><span class="op" id="5124558">(</span><span class="op" id="5124559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124563">}</span>&nbsp;<span class="keyword" id="5124565">else</span>&nbsp;<span class="op" id="5124570">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124575">name</span>&nbsp;<span class="op" id="5124580">=</span>&nbsp;<span class="ident" id="5124582">star</span>&nbsp;<span class="op" id="5124587">+</span>&nbsp;<span class="ident" id="5124589">rt</span><span class="op" id="5124591">.</span><span class="ident" id="5124592">PkgPath</span><span class="op" id="5124599">(</span><span class="op" id="5124600">)</span>&nbsp;<span class="op" id="5124602">+</span>&nbsp;<span class="string" id="5124604">&#34;.&#34;</span>&nbsp;<span class="op" id="5124608">+</span>&nbsp;<span class="ident" id="5124610">rt</span><span class="op" id="5124612">.</span><span class="ident" id="5124613">Name</span><span class="op" id="5124617">(</span><span class="op" id="5124618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124629">RegisterName</span><span class="op" id="5124641">(</span><span class="ident" id="5124642">name</span><span class="op" id="5124646">,</span>&nbsp;<span class="ident" id="5124648">value</span><span class="op" id="5124653">)</span><br>
<span class="lineno">885</span><span class="op" id="5124655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5124658">func</span>&nbsp;<span class="ident" id="5124663">registerBasics</span><span class="op" id="5124677">(</span><span class="op" id="5124678">)</span>&nbsp;<span class="op" id="5124680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124683">Register</span><span class="op" id="5124691">(</span><span class="builtintype" id="5124692">int</span><span class="op" id="5124695">(</span><span class="num" id="5124696">0</span><span class="op" id="5124697">)</span><span class="op" id="5124698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124701">Register</span><span class="op" id="5124709">(</span><span class="builtintype" id="5124710">int8</span><span class="op" id="5124714">(</span><span class="num" id="5124715">0</span><span class="op" id="5124716">)</span><span class="op" id="5124717">)</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124720">Register</span><span class="op" id="5124728">(</span><span class="builtintype" id="5124729">int16</span><span class="op" id="5124734">(</span><span class="num" id="5124735">0</span><span class="op" id="5124736">)</span><span class="op" id="5124737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124740">Register</span><span class="op" id="5124748">(</span><span class="builtintype" id="5124749">int32</span><span class="op" id="5124754">(</span><span class="num" id="5124755">0</span><span class="op" id="5124756">)</span><span class="op" id="5124757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124760">Register</span><span class="op" id="5124768">(</span><span class="ident" id="5124769">int64</span><span class="op" id="5124774">(</span><span class="num" id="5124775">0</span><span class="op" id="5124776">)</span><span class="op" id="5124777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124780">Register</span><span class="op" id="5124788">(</span><span class="builtintype" id="5124789">uint</span><span class="op" id="5124793">(</span><span class="num" id="5124794">0</span><span class="op" id="5124795">)</span><span class="op" id="5124796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124799">Register</span><span class="op" id="5124807">(</span><span class="builtintype" id="5124808">uint8</span><span class="op" id="5124813">(</span><span class="num" id="5124814">0</span><span class="op" id="5124815">)</span><span class="op" id="5124816">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124819">Register</span><span class="op" id="5124827">(</span><span class="builtintype" id="5124828">uint16</span><span class="op" id="5124834">(</span><span class="num" id="5124835">0</span><span class="op" id="5124836">)</span><span class="op" id="5124837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124840">Register</span><span class="op" id="5124848">(</span><span class="builtintype" id="5124849">uint32</span><span class="op" id="5124855">(</span><span class="num" id="5124856">0</span><span class="op" id="5124857">)</span><span class="op" id="5124858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124861">Register</span><span class="op" id="5124869">(</span><span class="ident" id="5124870">uint64</span><span class="op" id="5124876">(</span><span class="num" id="5124877">0</span><span class="op" id="5124878">)</span><span class="op" id="5124879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124882">Register</span><span class="op" id="5124890">(</span><span class="builtintype" id="5124891">float32</span><span class="op" id="5124898">(</span><span class="num" id="5124899">0</span><span class="op" id="5124900">)</span><span class="op" id="5124901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124904">Register</span><span class="op" id="5124912">(</span><span class="builtintype" id="5124913">float64</span><span class="op" id="5124920">(</span><span class="num" id="5124921">0</span><span class="op" id="5124922">)</span><span class="op" id="5124923">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124926">Register</span><span class="op" id="5124934">(</span><span class="builtintype" id="5124935">complex64</span><span class="op" id="5124944">(</span><span class="num" id="5124945">0i</span><span class="op" id="5124947">)</span><span class="op" id="5124948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124951">Register</span><span class="op" id="5124959">(</span><span class="builtintype" id="5124960">complex128</span><span class="op" id="5124970">(</span><span class="num" id="5124971">0i</span><span class="op" id="5124973">)</span><span class="op" id="5124974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124977">Register</span><span class="op" id="5124985">(</span><span class="builtintype" id="5124986">uintptr</span><span class="op" id="5124993">(</span><span class="num" id="5124994">0</span><span class="op" id="5124995">)</span><span class="op" id="5124996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124999">Register</span><span class="op" id="5125007">(</span><span class="builtintype" id="5125008">false</span><span class="op" id="5125013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125016">Register</span><span class="op" id="5125024">(</span><span class="string" id="5125025">&#34;&#34;</span><span class="op" id="5125027">)</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125030">Register</span><span class="op" id="5125038">(</span><span class="op" id="5125039">[</span><span class="op" id="5125040">]</span><span class="builtintype" id="5125041">byte</span><span class="op" id="5125045">(</span><span class="ident" id="5125046">nil</span><span class="op" id="5125049">)</span><span class="op" id="5125050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125053">Register</span><span class="op" id="5125061">(</span><span class="op" id="5125062">[</span><span class="op" id="5125063">]</span><span class="builtintype" id="5125064">int</span><span class="op" id="5125067">(</span><span class="ident" id="5125068">nil</span><span class="op" id="5125071">)</span><span class="op" id="5125072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125075">Register</span><span class="op" id="5125083">(</span><span class="op" id="5125084">[</span><span class="op" id="5125085">]</span><span class="builtintype" id="5125086">int8</span><span class="op" id="5125090">(</span><span class="ident" id="5125091">nil</span><span class="op" id="5125094">)</span><span class="op" id="5125095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125098">Register</span><span class="op" id="5125106">(</span><span class="op" id="5125107">[</span><span class="op" id="5125108">]</span><span class="builtintype" id="5125109">int16</span><span class="op" id="5125114">(</span><span class="ident" id="5125115">nil</span><span class="op" id="5125118">)</span><span class="op" id="5125119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125122">Register</span><span class="op" id="5125130">(</span><span class="op" id="5125131">[</span><span class="op" id="5125132">]</span><span class="builtintype" id="5125133">int32</span><span class="op" id="5125138">(</span><span class="ident" id="5125139">nil</span><span class="op" id="5125142">)</span><span class="op" id="5125143">)</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125146">Register</span><span class="op" id="5125154">(</span><span class="op" id="5125155">[</span><span class="op" id="5125156">]</span><span class="ident" id="5125157">int64</span><span class="op" id="5125162">(</span><span class="ident" id="5125163">nil</span><span class="op" id="5125166">)</span><span class="op" id="5125167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125170">Register</span><span class="op" id="5125178">(</span><span class="op" id="5125179">[</span><span class="op" id="5125180">]</span><span class="builtintype" id="5125181">uint</span><span class="op" id="5125185">(</span><span class="ident" id="5125186">nil</span><span class="op" id="5125189">)</span><span class="op" id="5125190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125193">Register</span><span class="op" id="5125201">(</span><span class="op" id="5125202">[</span><span class="op" id="5125203">]</span><span class="builtintype" id="5125204">uint8</span><span class="op" id="5125209">(</span><span class="ident" id="5125210">nil</span><span class="op" id="5125213">)</span><span class="op" id="5125214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125217">Register</span><span class="op" id="5125225">(</span><span class="op" id="5125226">[</span><span class="op" id="5125227">]</span><span class="builtintype" id="5125228">uint16</span><span class="op" id="5125234">(</span><span class="ident" id="5125235">nil</span><span class="op" id="5125238">)</span><span class="op" id="5125239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125242">Register</span><span class="op" id="5125250">(</span><span class="op" id="5125251">[</span><span class="op" id="5125252">]</span><span class="builtintype" id="5125253">uint32</span><span class="op" id="5125259">(</span><span class="ident" id="5125260">nil</span><span class="op" id="5125263">)</span><span class="op" id="5125264">)</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125267">Register</span><span class="op" id="5125275">(</span><span class="op" id="5125276">[</span><span class="op" id="5125277">]</span><span class="ident" id="5125278">uint64</span><span class="op" id="5125284">(</span><span class="ident" id="5125285">nil</span><span class="op" id="5125288">)</span><span class="op" id="5125289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125292">Register</span><span class="op" id="5125300">(</span><span class="op" id="5125301">[</span><span class="op" id="5125302">]</span><span class="builtintype" id="5125303">float32</span><span class="op" id="5125310">(</span><span class="ident" id="5125311">nil</span><span class="op" id="5125314">)</span><span class="op" id="5125315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125318">Register</span><span class="op" id="5125326">(</span><span class="op" id="5125327">[</span><span class="op" id="5125328">]</span><span class="builtintype" id="5125329">float64</span><span class="op" id="5125336">(</span><span class="ident" id="5125337">nil</span><span class="op" id="5125340">)</span><span class="op" id="5125341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125344">Register</span><span class="op" id="5125352">(</span><span class="op" id="5125353">[</span><span class="op" id="5125354">]</span><span class="builtintype" id="5125355">complex64</span><span class="op" id="5125364">(</span><span class="ident" id="5125365">nil</span><span class="op" id="5125368">)</span><span class="op" id="5125369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125372">Register</span><span class="op" id="5125380">(</span><span class="op" id="5125381">[</span><span class="op" id="5125382">]</span><span class="builtintype" id="5125383">complex128</span><span class="op" id="5125393">(</span><span class="ident" id="5125394">nil</span><span class="op" id="5125397">)</span><span class="op" id="5125398">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125401">Register</span><span class="op" id="5125409">(</span><span class="op" id="5125410">[</span><span class="op" id="5125411">]</span><span class="builtintype" id="5125412">uintptr</span><span class="op" id="5125419">(</span><span class="ident" id="5125420">nil</span><span class="op" id="5125423">)</span><span class="op" id="5125424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125427">Register</span><span class="op" id="5125435">(</span><span class="op" id="5125436">[</span><span class="op" id="5125437">]</span><span class="builtintype" id="5125438">bool</span><span class="op" id="5125442">(</span><span class="ident" id="5125443">nil</span><span class="op" id="5125446">)</span><span class="op" id="5125447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125450">Register</span><span class="op" id="5125458">(</span><span class="op" id="5125459">[</span><span class="op" id="5125460">]</span><span class="builtintype" id="5125461">string</span><span class="op" id="5125467">(</span><span class="ident" id="5125468">nil</span><span class="op" id="5125471">)</span><span class="op" id="5125472">)</span><br>
<span class="lineno"></span><span class="op" id="5125474">}</span>
</div>
</body>
</html>
