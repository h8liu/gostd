<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5185468">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5185523">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5185577">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5185628">package</span>&nbsp;<span class="ident" id="5185636">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5185643">import</span>&nbsp;<span class="string" id="5185650">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5185658">//&nbsp;A&nbsp;huffmanTree&nbsp;is&nbsp;a&nbsp;binary&nbsp;tree&nbsp;which&nbsp;is&nbsp;navigated,&nbsp;bit-by-bit&nbsp;to&nbsp;reach&nbsp;a</span><br>
<span class="lineno">10</span><span class="comment" id="5185734">//&nbsp;symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="5185745">type</span>&nbsp;<span class="ident" id="5185750">huffmanTree</span>&nbsp;<span class="keyword" id="5185762">struct</span>&nbsp;<span class="op" id="5185769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185772">//&nbsp;nodes&nbsp;contains&nbsp;all&nbsp;the&nbsp;non-leaf&nbsp;nodes&nbsp;in&nbsp;the&nbsp;tree.&nbsp;nodes[0]&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185843">//&nbsp;root&nbsp;of&nbsp;the&nbsp;tree&nbsp;and&nbsp;nextNode&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185916">//&nbsp;of&nbsp;nodes&nbsp;to&nbsp;use&nbsp;when&nbsp;the&nbsp;tree&nbsp;is&nbsp;being&nbsp;constructed.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5185972">nodes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5185981">[</span><span class="op" id="5185982">]</span><span class="ident" id="5185983">huffmanNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5185996">nextNode</span>&nbsp;<span class="builtintype" id="5186005">int</span><br>
<span class="lineno"></span><span class="op" id="5186009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5186012">//&nbsp;A&nbsp;huffmanNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.&nbsp;left&nbsp;and&nbsp;right&nbsp;contain&nbsp;indexes&nbsp;into&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="5186092">//&nbsp;nodes&nbsp;slice&nbsp;of&nbsp;the&nbsp;tree.&nbsp;If&nbsp;left&nbsp;or&nbsp;right&nbsp;is&nbsp;invalidNodeValue&nbsp;then&nbsp;the&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="5186172">//&nbsp;is&nbsp;a&nbsp;left&nbsp;node&nbsp;and&nbsp;its&nbsp;value&nbsp;is&nbsp;in&nbsp;leftValue/rightValue.</span><br>
<span class="lineno"></span><span class="comment" id="5186232">//</span><br>
<span class="lineno"></span><span class="comment" id="5186235">//&nbsp;The&nbsp;symbols&nbsp;are&nbsp;uint16s&nbsp;because&nbsp;bzip2&nbsp;encodes&nbsp;not&nbsp;only&nbsp;MTF&nbsp;indexes&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5186312">//&nbsp;tree,&nbsp;but&nbsp;also&nbsp;two&nbsp;magic&nbsp;values&nbsp;for&nbsp;run-length&nbsp;encoding&nbsp;and&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno">25</span><span class="comment" id="5186390">//&nbsp;Thus&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;256&nbsp;possible&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="5186440">type</span>&nbsp;<span class="ident" id="5186445">huffmanNode</span>&nbsp;<span class="keyword" id="5186457">struct</span>&nbsp;<span class="op" id="5186464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5186467">left</span><span class="op" id="5186471">,</span>&nbsp;<span class="ident" id="5186473">right</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5186489">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5186497">leftValue</span><span class="op" id="5186506">,</span>&nbsp;<span class="ident" id="5186508">rightValue</span>&nbsp;<span class="builtintype" id="5186519">uint16</span><br>
<span class="lineno"></span><span class="op" id="5186526">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5186529">//&nbsp;invalidNodeValue&nbsp;is&nbsp;an&nbsp;invalid&nbsp;index&nbsp;which&nbsp;marks&nbsp;a&nbsp;leaf&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><span class="keyword" id="5186606">const</span>&nbsp;<span class="ident" id="5186612">invalidNodeValue</span>&nbsp;<span class="op" id="5186629">=</span>&nbsp;<span class="num" id="5186631">0xffff</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5186639">//&nbsp;Decode&nbsp;reads&nbsp;bits&nbsp;from&nbsp;the&nbsp;given&nbsp;bitReader&nbsp;and&nbsp;navigates&nbsp;the&nbsp;tree&nbsp;until&nbsp;a</span><br>
<span class="lineno">35</span><span class="comment" id="5186716">//&nbsp;symbol&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="5186736">func</span>&nbsp;<span class="op" id="5186741">(</span><span class="ident" id="5186742">t</span>&nbsp;<span class="op" id="5186744">*</span><span class="ident" id="5186745">huffmanTree</span><span class="op" id="5186756">)</span>&nbsp;<span class="ident" id="5186758">Decode</span><span class="op" id="5186764">(</span><span class="ident" id="5186765">br</span>&nbsp;<span class="op" id="5186768">*</span><span class="ident" id="5186769">bitReader</span><span class="op" id="5186778">)</span>&nbsp;<span class="op" id="5186780">(</span><span class="ident" id="5186781">v</span>&nbsp;<span class="builtintype" id="5186783">uint16</span><span class="op" id="5186789">)</span>&nbsp;<span class="op" id="5186791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5186794">nodeIndex</span>&nbsp;<span class="op" id="5186804">:=</span>&nbsp;<span class="builtintype" id="5186807">uint16</span><span class="op" id="5186813">(</span><span class="num" id="5186814">0</span><span class="op" id="5186815">)</span>&nbsp;<span class="comment" id="5186817">//&nbsp;node&nbsp;0&nbsp;is&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5186854">for</span>&nbsp;<span class="op" id="5186858">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5186862">node</span>&nbsp;<span class="op" id="5186867">:=</span>&nbsp;<span class="op" id="5186870">&amp;</span><span class="ident" id="5186871">t</span><span class="op" id="5186872">.</span><span class="ident" id="5186873">nodes</span><span class="op" id="5186878">[</span><span class="ident" id="5186879">nodeIndex</span><span class="op" id="5186888">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5186892">bit</span><span class="op" id="5186895">,</span>&nbsp;<span class="ident" id="5186897">ok</span>&nbsp;<span class="op" id="5186900">:=</span>&nbsp;<span class="ident" id="5186903">br</span><span class="op" id="5186905">.</span><span class="ident" id="5186906">TryReadBit</span><span class="op" id="5186916">(</span><span class="op" id="5186917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5186921">if</span>&nbsp;<span class="op" id="5186924">!</span><span class="ident" id="5186925">ok</span>&nbsp;<span class="op" id="5186928">&amp;&amp;</span>&nbsp;<span class="ident" id="5186931">br</span><span class="op" id="5186933">.</span><span class="ident" id="5186934">ReadBit</span><span class="op" id="5186941">(</span><span class="op" id="5186942">)</span>&nbsp;<span class="op" id="5186944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5186949">bit</span>&nbsp;<span class="op" id="5186953">=</span>&nbsp;<span class="num" id="5186955">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5186959">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5186963">//&nbsp;bzip2&nbsp;encodes&nbsp;left&nbsp;as&nbsp;a&nbsp;true&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5187002">if</span>&nbsp;<span class="ident" id="5187005">bit</span>&nbsp;<span class="op" id="5187009">!=</span>&nbsp;<span class="num" id="5187012">0</span>&nbsp;<span class="op" id="5187014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5187019">//&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5187030">if</span>&nbsp;<span class="ident" id="5187033">node</span><span class="op" id="5187037">.</span><span class="ident" id="5187038">left</span>&nbsp;<span class="op" id="5187043">==</span>&nbsp;<span class="ident" id="5187046">invalidNodeValue</span>&nbsp;<span class="op" id="5187063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5187069">return</span>&nbsp;<span class="ident" id="5187076">node</span><span class="op" id="5187080">.</span><span class="ident" id="5187081">leftValue</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5187094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5187099">nodeIndex</span>&nbsp;<span class="op" id="5187109">=</span>&nbsp;<span class="ident" id="5187111">node</span><span class="op" id="5187115">.</span><span class="ident" id="5187116">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5187123">}</span>&nbsp;<span class="keyword" id="5187125">else</span>&nbsp;<span class="op" id="5187130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5187135">//&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5187147">if</span>&nbsp;<span class="ident" id="5187150">node</span><span class="op" id="5187154">.</span><span class="ident" id="5187155">right</span>&nbsp;<span class="op" id="5187161">==</span>&nbsp;<span class="ident" id="5187164">invalidNodeValue</span>&nbsp;<span class="op" id="5187181">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5187187">return</span>&nbsp;<span class="ident" id="5187194">node</span><span class="op" id="5187198">.</span><span class="ident" id="5187199">rightValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5187213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5187218">nodeIndex</span>&nbsp;<span class="op" id="5187228">=</span>&nbsp;<span class="ident" id="5187230">node</span><span class="op" id="5187234">.</span><span class="ident" id="5187235">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5187243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5187246">}</span><br>
<span class="lineno">60</span><span class="op" id="5187248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5187251">//&nbsp;newHuffmanTree&nbsp;builds&nbsp;a&nbsp;Huffman&nbsp;tree&nbsp;from&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="5187324">//&nbsp;lengths&nbsp;of&nbsp;each&nbsp;symbol.&nbsp;The&nbsp;maximum&nbsp;code&nbsp;length&nbsp;is&nbsp;32&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="5187387">func</span>&nbsp;<span class="ident" id="5187392">newHuffmanTree</span><span class="op" id="5187406">(</span><span class="ident" id="5187407">lengths</span>&nbsp;<span class="op" id="5187415">[</span><span class="op" id="5187416">]</span><span class="builtintype" id="5187417">uint8</span><span class="op" id="5187422">)</span>&nbsp;<span class="op" id="5187424">(</span><span class="ident" id="5187425">huffmanTree</span><span class="op" id="5187436">,</span>&nbsp;<span class="builtintype" id="5187438">error</span><span class="op" id="5187443">)</span>&nbsp;<span class="op" id="5187445">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5187448">//&nbsp;There&nbsp;are&nbsp;many&nbsp;possible&nbsp;trees&nbsp;that&nbsp;assign&nbsp;the&nbsp;same&nbsp;code&nbsp;length&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5187518">//&nbsp;each&nbsp;symbol&nbsp;(consider&nbsp;reflecting&nbsp;a&nbsp;tree&nbsp;down&nbsp;the&nbsp;middle,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5187583">//&nbsp;example).&nbsp;Since&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5187645">//&nbsp;efficiency&nbsp;of&nbsp;the&nbsp;tree,&nbsp;each&nbsp;of&nbsp;these&nbsp;trees&nbsp;is&nbsp;equally&nbsp;good.&nbsp;In</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5187713">//&nbsp;order&nbsp;to&nbsp;minimize&nbsp;the&nbsp;amount&nbsp;of&nbsp;information&nbsp;needed&nbsp;to&nbsp;build&nbsp;a&nbsp;tree</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5187784">//&nbsp;bzip2&nbsp;uses&nbsp;a&nbsp;canonical&nbsp;tree&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;reconstructed&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5187854">//&nbsp;only&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5187893">if</span>&nbsp;<span class="builtinfunc" id="5187896">len</span><span class="op" id="5187899">(</span><span class="ident" id="5187900">lengths</span><span class="op" id="5187907">)</span>&nbsp;<span class="op" id="5187909">&lt;</span>&nbsp;<span class="num" id="5187911">2</span>&nbsp;<span class="op" id="5187913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5187917">panic</span><span class="op" id="5187922">(</span><span class="string" id="5187923">&#34;newHuffmanTree:&nbsp;too&nbsp;few&nbsp;symbols&#34;</span><span class="op" id="5187956">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5187959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5187963">var</span>&nbsp;<span class="ident" id="5187967">t</span>&nbsp;<span class="ident" id="5187969">huffmanTree</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5187983">//&nbsp;First&nbsp;we&nbsp;sort&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;by&nbsp;ascending&nbsp;code&nbsp;length,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5188055">//&nbsp;using&nbsp;the&nbsp;symbol&nbsp;value&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188097">pairs</span>&nbsp;<span class="op" id="5188103">:=</span>&nbsp;<span class="ident" id="5188106">huffmanSymbolLengthPairs</span><span class="op" id="5188130">(</span><span class="builtinfunc" id="5188131">make</span><span class="op" id="5188135">(</span><span class="op" id="5188136">[</span><span class="op" id="5188137">]</span><span class="ident" id="5188138">huffmanSymbolLengthPair</span><span class="op" id="5188161">,</span>&nbsp;<span class="builtinfunc" id="5188163">len</span><span class="op" id="5188166">(</span><span class="ident" id="5188167">lengths</span><span class="op" id="5188174">)</span><span class="op" id="5188175">)</span><span class="op" id="5188176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5188179">for</span>&nbsp;<span class="ident" id="5188183">i</span><span class="op" id="5188184">,</span>&nbsp;<span class="ident" id="5188186">length</span>&nbsp;<span class="op" id="5188193">:=</span>&nbsp;<span class="keyword" id="5188196">range</span>&nbsp;<span class="ident" id="5188202">lengths</span>&nbsp;<span class="op" id="5188210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188214">pairs</span><span class="op" id="5188219">[</span><span class="ident" id="5188220">i</span><span class="op" id="5188221">]</span><span class="op" id="5188222">.</span><span class="ident" id="5188223">value</span>&nbsp;<span class="op" id="5188229">=</span>&nbsp;<span class="builtintype" id="5188231">uint16</span><span class="op" id="5188237">(</span><span class="ident" id="5188238">i</span><span class="op" id="5188239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188243">pairs</span><span class="op" id="5188248">[</span><span class="ident" id="5188249">i</span><span class="op" id="5188250">]</span><span class="op" id="5188251">.</span><span class="ident" id="5188252">length</span>&nbsp;<span class="op" id="5188259">=</span>&nbsp;<span class="ident" id="5188261">length</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5188269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188273">sort</span><span class="op" id="5188277">.</span><span class="ident" id="5188278">Sort</span><span class="op" id="5188282">(</span><span class="ident" id="5188283">pairs</span><span class="op" id="5188288">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5188292">//&nbsp;Now&nbsp;we&nbsp;assign&nbsp;codes&nbsp;to&nbsp;the&nbsp;symbols,&nbsp;starting&nbsp;with&nbsp;the&nbsp;longest&nbsp;code.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5188364">//&nbsp;We&nbsp;keep&nbsp;the&nbsp;codes&nbsp;packed&nbsp;into&nbsp;a&nbsp;uint32,&nbsp;at&nbsp;the&nbsp;most-significant&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5188437">//&nbsp;So&nbsp;branches&nbsp;are&nbsp;taken&nbsp;from&nbsp;the&nbsp;MSB&nbsp;downwards.&nbsp;This&nbsp;makes&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5188509">//&nbsp;sort&nbsp;them&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188530">code</span>&nbsp;<span class="op" id="5188535">:=</span>&nbsp;<span class="builtintype" id="5188538">uint32</span><span class="op" id="5188544">(</span><span class="num" id="5188545">0</span><span class="op" id="5188546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188549">length</span>&nbsp;<span class="op" id="5188556">:=</span>&nbsp;<span class="builtintype" id="5188559">uint8</span><span class="op" id="5188564">(</span><span class="num" id="5188565">32</span><span class="op" id="5188567">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188571">codes</span>&nbsp;<span class="op" id="5188577">:=</span>&nbsp;<span class="ident" id="5188580">huffmanCodes</span><span class="op" id="5188592">(</span><span class="builtinfunc" id="5188593">make</span><span class="op" id="5188597">(</span><span class="op" id="5188598">[</span><span class="op" id="5188599">]</span><span class="ident" id="5188600">huffmanCode</span><span class="op" id="5188611">,</span>&nbsp;<span class="builtinfunc" id="5188613">len</span><span class="op" id="5188616">(</span><span class="ident" id="5188617">lengths</span><span class="op" id="5188624">)</span><span class="op" id="5188625">)</span><span class="op" id="5188626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5188629">for</span>&nbsp;<span class="ident" id="5188633">i</span>&nbsp;<span class="op" id="5188635">:=</span>&nbsp;<span class="builtinfunc" id="5188638">len</span><span class="op" id="5188641">(</span><span class="ident" id="5188642">pairs</span><span class="op" id="5188647">)</span>&nbsp;<span class="op" id="5188649">-</span>&nbsp;<span class="num" id="5188651">1</span><span class="op" id="5188652">;</span>&nbsp;<span class="ident" id="5188654">i</span>&nbsp;<span class="op" id="5188656">&gt;=</span>&nbsp;<span class="num" id="5188659">0</span><span class="op" id="5188660">;</span>&nbsp;<span class="ident" id="5188662">i</span><span class="op" id="5188663">--</span>&nbsp;<span class="op" id="5188666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5188670">if</span>&nbsp;<span class="ident" id="5188673">length</span>&nbsp;<span class="op" id="5188680">&gt;</span>&nbsp;<span class="ident" id="5188682">pairs</span><span class="op" id="5188687">[</span><span class="ident" id="5188688">i</span><span class="op" id="5188689">]</span><span class="op" id="5188690">.</span><span class="ident" id="5188691">length</span>&nbsp;<span class="op" id="5188698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5188703">//&nbsp;If&nbsp;the&nbsp;code&nbsp;length&nbsp;decreases&nbsp;we&nbsp;shift&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5188759">//&nbsp;zero&nbsp;any&nbsp;bits&nbsp;beyond&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188807">length</span>&nbsp;<span class="op" id="5188814">&gt;&gt;=</span>&nbsp;<span class="num" id="5188818">32</span>&nbsp;<span class="op" id="5188821">-</span>&nbsp;<span class="ident" id="5188823">pairs</span><span class="op" id="5188828">[</span><span class="ident" id="5188829">i</span><span class="op" id="5188830">]</span><span class="op" id="5188831">.</span><span class="ident" id="5188832">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188842">length</span>&nbsp;<span class="op" id="5188849">&lt;&lt;=</span>&nbsp;<span class="num" id="5188853">32</span>&nbsp;<span class="op" id="5188856">-</span>&nbsp;<span class="ident" id="5188858">pairs</span><span class="op" id="5188863">[</span><span class="ident" id="5188864">i</span><span class="op" id="5188865">]</span><span class="op" id="5188866">.</span><span class="ident" id="5188867">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188877">length</span>&nbsp;<span class="op" id="5188884">=</span>&nbsp;<span class="ident" id="5188886">pairs</span><span class="op" id="5188891">[</span><span class="ident" id="5188892">i</span><span class="op" id="5188893">]</span><span class="op" id="5188894">.</span><span class="ident" id="5188895">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5188904">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188908">codes</span><span class="op" id="5188913">[</span><span class="ident" id="5188914">i</span><span class="op" id="5188915">]</span><span class="op" id="5188916">.</span><span class="ident" id="5188917">code</span>&nbsp;<span class="op" id="5188922">=</span>&nbsp;<span class="ident" id="5188924">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188931">codes</span><span class="op" id="5188936">[</span><span class="ident" id="5188937">i</span><span class="op" id="5188938">]</span><span class="op" id="5188939">.</span><span class="ident" id="5188940">codeLen</span>&nbsp;<span class="op" id="5188948">=</span>&nbsp;<span class="ident" id="5188950">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188959">codes</span><span class="op" id="5188964">[</span><span class="ident" id="5188965">i</span><span class="op" id="5188966">]</span><span class="op" id="5188967">.</span><span class="ident" id="5188968">value</span>&nbsp;<span class="op" id="5188974">=</span>&nbsp;<span class="ident" id="5188976">pairs</span><span class="op" id="5188981">[</span><span class="ident" id="5188982">i</span><span class="op" id="5188983">]</span><span class="op" id="5188984">.</span><span class="ident" id="5188985">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5188993">//&nbsp;We&nbsp;need&nbsp;to&nbsp;&#39;increment&#39;&nbsp;the&nbsp;code,&nbsp;which&nbsp;means&nbsp;treating&nbsp;|code|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5189059">//&nbsp;like&nbsp;a&nbsp;|length|&nbsp;bit&nbsp;number.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5189092">code</span>&nbsp;<span class="op" id="5189097">+=</span>&nbsp;<span class="num" id="5189100">1</span>&nbsp;<span class="op" id="5189102">&lt;&lt;</span>&nbsp;<span class="op" id="5189105">(</span><span class="num" id="5189106">32</span>&nbsp;<span class="op" id="5189109">-</span>&nbsp;<span class="ident" id="5189111">length</span><span class="op" id="5189117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5189120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5189124">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;sort&nbsp;by&nbsp;the&nbsp;code&nbsp;so&nbsp;that&nbsp;the&nbsp;left&nbsp;half&nbsp;of&nbsp;each&nbsp;branch&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5189197">//&nbsp;grouped&nbsp;together,&nbsp;recursively.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5189232">sort</span><span class="op" id="5189236">.</span><span class="ident" id="5189237">Sort</span><span class="op" id="5189241">(</span><span class="ident" id="5189242">codes</span><span class="op" id="5189247">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5189251">t</span><span class="op" id="5189252">.</span><span class="ident" id="5189253">nodes</span>&nbsp;<span class="op" id="5189259">=</span>&nbsp;<span class="builtinfunc" id="5189261">make</span><span class="op" id="5189265">(</span><span class="op" id="5189266">[</span><span class="op" id="5189267">]</span><span class="ident" id="5189268">huffmanNode</span><span class="op" id="5189279">,</span>&nbsp;<span class="builtinfunc" id="5189281">len</span><span class="op" id="5189284">(</span><span class="ident" id="5189285">codes</span><span class="op" id="5189290">)</span><span class="op" id="5189291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5189294">_</span><span class="op" id="5189295">,</span>&nbsp;<span class="ident" id="5189297">err</span>&nbsp;<span class="op" id="5189301">:=</span>&nbsp;<span class="ident" id="5189304">buildHuffmanNode</span><span class="op" id="5189320">(</span><span class="op" id="5189321">&amp;</span><span class="ident" id="5189322">t</span><span class="op" id="5189323">,</span>&nbsp;<span class="ident" id="5189325">codes</span><span class="op" id="5189330">,</span>&nbsp;<span class="num" id="5189332">0</span><span class="op" id="5189333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5189336">return</span>&nbsp;<span class="ident" id="5189343">t</span><span class="op" id="5189344">,</span>&nbsp;<span class="ident" id="5189346">err</span><br>
<span class="lineno">120</span><span class="op" id="5189350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5189353">//&nbsp;huffmanSymbolLengthPair&nbsp;contains&nbsp;a&nbsp;symbol&nbsp;and&nbsp;its&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5189419">type</span>&nbsp;<span class="ident" id="5189424">huffmanSymbolLengthPair</span>&nbsp;<span class="keyword" id="5189448">struct</span>&nbsp;<span class="op" id="5189455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5189458">value</span>&nbsp;&nbsp;<span class="builtintype" id="5189465">uint16</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5189473">length</span>&nbsp;<span class="builtintype" id="5189480">uint8</span><br>
<span class="lineno"></span><span class="op" id="5189486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5189489">//&nbsp;huffmanSymbolLengthPair&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno"></span><span class="keyword" id="5189561">type</span>&nbsp;<span class="ident" id="5189566">huffmanSymbolLengthPairs</span>&nbsp;<span class="op" id="5189591">[</span><span class="op" id="5189592">]</span><span class="ident" id="5189593">huffmanSymbolLengthPair</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="5189618">func</span>&nbsp;<span class="op" id="5189623">(</span><span class="ident" id="5189624">h</span>&nbsp;<span class="ident" id="5189626">huffmanSymbolLengthPairs</span><span class="op" id="5189650">)</span>&nbsp;<span class="ident" id="5189652">Len</span><span class="op" id="5189655">(</span><span class="op" id="5189656">)</span>&nbsp;<span class="builtintype" id="5189658">int</span>&nbsp;<span class="op" id="5189662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5189665">return</span>&nbsp;<span class="builtinfunc" id="5189672">len</span><span class="op" id="5189675">(</span><span class="ident" id="5189676">h</span><span class="op" id="5189677">)</span><br>
<span class="lineno"></span><span class="op" id="5189679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="5189682">func</span>&nbsp;<span class="op" id="5189687">(</span><span class="ident" id="5189688">h</span>&nbsp;<span class="ident" id="5189690">huffmanSymbolLengthPairs</span><span class="op" id="5189714">)</span>&nbsp;<span class="ident" id="5189716">Less</span><span class="op" id="5189720">(</span><span class="ident" id="5189721">i</span><span class="op" id="5189722">,</span>&nbsp;<span class="ident" id="5189724">j</span>&nbsp;<span class="builtintype" id="5189726">int</span><span class="op" id="5189729">)</span>&nbsp;<span class="builtintype" id="5189731">bool</span>&nbsp;<span class="op" id="5189736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5189739">if</span>&nbsp;<span class="ident" id="5189742">h</span><span class="op" id="5189743">[</span><span class="ident" id="5189744">i</span><span class="op" id="5189745">]</span><span class="op" id="5189746">.</span><span class="ident" id="5189747">length</span>&nbsp;<span class="op" id="5189754">&lt;</span>&nbsp;<span class="ident" id="5189756">h</span><span class="op" id="5189757">[</span><span class="ident" id="5189758">j</span><span class="op" id="5189759">]</span><span class="op" id="5189760">.</span><span class="ident" id="5189761">length</span>&nbsp;<span class="op" id="5189768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5189772">return</span>&nbsp;<span class="builtintype" id="5189779">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5189785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5189788">if</span>&nbsp;<span class="ident" id="5189791">h</span><span class="op" id="5189792">[</span><span class="ident" id="5189793">i</span><span class="op" id="5189794">]</span><span class="op" id="5189795">.</span><span class="ident" id="5189796">length</span>&nbsp;<span class="op" id="5189803">&gt;</span>&nbsp;<span class="ident" id="5189805">h</span><span class="op" id="5189806">[</span><span class="ident" id="5189807">j</span><span class="op" id="5189808">]</span><span class="op" id="5189809">.</span><span class="ident" id="5189810">length</span>&nbsp;<span class="op" id="5189817">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5189821">return</span>&nbsp;<span class="builtintype" id="5189828">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5189835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5189838">if</span>&nbsp;<span class="ident" id="5189841">h</span><span class="op" id="5189842">[</span><span class="ident" id="5189843">i</span><span class="op" id="5189844">]</span><span class="op" id="5189845">.</span><span class="ident" id="5189846">value</span>&nbsp;<span class="op" id="5189852">&lt;</span>&nbsp;<span class="ident" id="5189854">h</span><span class="op" id="5189855">[</span><span class="ident" id="5189856">j</span><span class="op" id="5189857">]</span><span class="op" id="5189858">.</span><span class="ident" id="5189859">value</span>&nbsp;<span class="op" id="5189865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5189869">return</span>&nbsp;<span class="builtintype" id="5189876">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5189882">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5189885">return</span>&nbsp;<span class="builtintype" id="5189892">false</span><br>
<span class="lineno"></span><span class="op" id="5189898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5189901">func</span>&nbsp;<span class="op" id="5189906">(</span><span class="ident" id="5189907">h</span>&nbsp;<span class="ident" id="5189909">huffmanSymbolLengthPairs</span><span class="op" id="5189933">)</span>&nbsp;<span class="ident" id="5189935">Swap</span><span class="op" id="5189939">(</span><span class="ident" id="5189940">i</span><span class="op" id="5189941">,</span>&nbsp;<span class="ident" id="5189943">j</span>&nbsp;<span class="builtintype" id="5189945">int</span><span class="op" id="5189948">)</span>&nbsp;<span class="op" id="5189950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5189953">h</span><span class="op" id="5189954">[</span><span class="ident" id="5189955">i</span><span class="op" id="5189956">]</span><span class="op" id="5189957">,</span>&nbsp;<span class="ident" id="5189959">h</span><span class="op" id="5189960">[</span><span class="ident" id="5189961">j</span><span class="op" id="5189962">]</span>&nbsp;<span class="op" id="5189964">=</span>&nbsp;<span class="ident" id="5189966">h</span><span class="op" id="5189967">[</span><span class="ident" id="5189968">j</span><span class="op" id="5189969">]</span><span class="op" id="5189970">,</span>&nbsp;<span class="ident" id="5189972">h</span><span class="op" id="5189973">[</span><span class="ident" id="5189974">i</span><span class="op" id="5189975">]</span><br>
<span class="lineno">150</span><span class="op" id="5189977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5189980">//&nbsp;huffmanCode&nbsp;contains&nbsp;a&nbsp;symbol,&nbsp;its&nbsp;code&nbsp;and&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5190040">type</span>&nbsp;<span class="ident" id="5190045">huffmanCode</span>&nbsp;<span class="keyword" id="5190057">struct</span>&nbsp;<span class="op" id="5190064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190067">code</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5190075">uint32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190083">codeLen</span>&nbsp;<span class="builtintype" id="5190091">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190098">value</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5190106">uint16</span><br>
<span class="lineno"></span><span class="op" id="5190113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5190116">//&nbsp;huffmanCodes&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno">160</span><span class="keyword" id="5190177">type</span>&nbsp;<span class="ident" id="5190182">huffmanCodes</span>&nbsp;<span class="op" id="5190195">[</span><span class="op" id="5190196">]</span><span class="ident" id="5190197">huffmanCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5190210">func</span>&nbsp;<span class="op" id="5190215">(</span><span class="ident" id="5190216">n</span>&nbsp;<span class="ident" id="5190218">huffmanCodes</span><span class="op" id="5190230">)</span>&nbsp;<span class="ident" id="5190232">Len</span><span class="op" id="5190235">(</span><span class="op" id="5190236">)</span>&nbsp;<span class="builtintype" id="5190238">int</span>&nbsp;<span class="op" id="5190242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5190245">return</span>&nbsp;<span class="builtinfunc" id="5190252">len</span><span class="op" id="5190255">(</span><span class="ident" id="5190256">n</span><span class="op" id="5190257">)</span><br>
<span class="lineno"></span><span class="op" id="5190259">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="5190262">func</span>&nbsp;<span class="op" id="5190267">(</span><span class="ident" id="5190268">n</span>&nbsp;<span class="ident" id="5190270">huffmanCodes</span><span class="op" id="5190282">)</span>&nbsp;<span class="ident" id="5190284">Less</span><span class="op" id="5190288">(</span><span class="ident" id="5190289">i</span><span class="op" id="5190290">,</span>&nbsp;<span class="ident" id="5190292">j</span>&nbsp;<span class="builtintype" id="5190294">int</span><span class="op" id="5190297">)</span>&nbsp;<span class="builtintype" id="5190299">bool</span>&nbsp;<span class="op" id="5190304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5190307">return</span>&nbsp;<span class="ident" id="5190314">n</span><span class="op" id="5190315">[</span><span class="ident" id="5190316">i</span><span class="op" id="5190317">]</span><span class="op" id="5190318">.</span><span class="ident" id="5190319">code</span>&nbsp;<span class="op" id="5190324">&lt;</span>&nbsp;<span class="ident" id="5190326">n</span><span class="op" id="5190327">[</span><span class="ident" id="5190328">j</span><span class="op" id="5190329">]</span><span class="op" id="5190330">.</span><span class="ident" id="5190331">code</span><br>
<span class="lineno"></span><span class="op" id="5190336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="5190339">func</span>&nbsp;<span class="op" id="5190344">(</span><span class="ident" id="5190345">n</span>&nbsp;<span class="ident" id="5190347">huffmanCodes</span><span class="op" id="5190359">)</span>&nbsp;<span class="ident" id="5190361">Swap</span><span class="op" id="5190365">(</span><span class="ident" id="5190366">i</span><span class="op" id="5190367">,</span>&nbsp;<span class="ident" id="5190369">j</span>&nbsp;<span class="builtintype" id="5190371">int</span><span class="op" id="5190374">)</span>&nbsp;<span class="op" id="5190376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190379">n</span><span class="op" id="5190380">[</span><span class="ident" id="5190381">i</span><span class="op" id="5190382">]</span><span class="op" id="5190383">,</span>&nbsp;<span class="ident" id="5190385">n</span><span class="op" id="5190386">[</span><span class="ident" id="5190387">j</span><span class="op" id="5190388">]</span>&nbsp;<span class="op" id="5190390">=</span>&nbsp;<span class="ident" id="5190392">n</span><span class="op" id="5190393">[</span><span class="ident" id="5190394">j</span><span class="op" id="5190395">]</span><span class="op" id="5190396">,</span>&nbsp;<span class="ident" id="5190398">n</span><span class="op" id="5190399">[</span><span class="ident" id="5190400">i</span><span class="op" id="5190401">]</span><br>
<span class="lineno"></span><span class="op" id="5190403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5190406">//&nbsp;buildHuffmanNode&nbsp;takes&nbsp;a&nbsp;slice&nbsp;of&nbsp;sorted&nbsp;huffmanCodes&nbsp;and&nbsp;builds&nbsp;a&nbsp;node&nbsp;in</span><br>
<span class="lineno">175</span><span class="comment" id="5190484">//&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;at&nbsp;the&nbsp;given&nbsp;level.&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;newly</span><br>
<span class="lineno"></span><span class="comment" id="5190558">//&nbsp;constructed&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="5190579">func</span>&nbsp;<span class="ident" id="5190584">buildHuffmanNode</span><span class="op" id="5190600">(</span><span class="ident" id="5190601">t</span>&nbsp;<span class="op" id="5190603">*</span><span class="ident" id="5190604">huffmanTree</span><span class="op" id="5190615">,</span>&nbsp;<span class="ident" id="5190617">codes</span>&nbsp;<span class="op" id="5190623">[</span><span class="op" id="5190624">]</span><span class="ident" id="5190625">huffmanCode</span><span class="op" id="5190636">,</span>&nbsp;<span class="ident" id="5190638">level</span>&nbsp;<span class="builtintype" id="5190644">uint32</span><span class="op" id="5190650">)</span>&nbsp;<span class="op" id="5190652">(</span><span class="ident" id="5190653">nodeIndex</span>&nbsp;<span class="builtintype" id="5190663">uint16</span><span class="op" id="5190669">,</span>&nbsp;<span class="ident" id="5190671">err</span>&nbsp;<span class="builtintype" id="5190675">error</span><span class="op" id="5190680">)</span>&nbsp;<span class="op" id="5190682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190685">test</span>&nbsp;<span class="op" id="5190690">:=</span>&nbsp;<span class="builtintype" id="5190693">uint32</span><span class="op" id="5190699">(</span><span class="num" id="5190700">1</span><span class="op" id="5190701">)</span>&nbsp;<span class="op" id="5190703">&lt;&lt;</span>&nbsp;<span class="op" id="5190706">(</span><span class="num" id="5190707">31</span>&nbsp;<span class="op" id="5190710">-</span>&nbsp;<span class="ident" id="5190712">level</span><span class="op" id="5190717">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5190721">//&nbsp;We&nbsp;have&nbsp;to&nbsp;search&nbsp;the&nbsp;list&nbsp;of&nbsp;codes&nbsp;to&nbsp;find&nbsp;the&nbsp;divide&nbsp;between&nbsp;the&nbsp;left&nbsp;and&nbsp;right&nbsp;sides.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190814">firstRightIndex</span>&nbsp;<span class="op" id="5190830">:=</span>&nbsp;<span class="builtinfunc" id="5190833">len</span><span class="op" id="5190836">(</span><span class="ident" id="5190837">codes</span><span class="op" id="5190842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5190845">for</span>&nbsp;<span class="ident" id="5190849">i</span><span class="op" id="5190850">,</span>&nbsp;<span class="ident" id="5190852">code</span>&nbsp;<span class="op" id="5190857">:=</span>&nbsp;<span class="keyword" id="5190860">range</span>&nbsp;<span class="ident" id="5190866">codes</span>&nbsp;<span class="op" id="5190872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5190876">if</span>&nbsp;<span class="ident" id="5190879">code</span><span class="op" id="5190883">.</span><span class="ident" id="5190884">code</span><span class="op" id="5190888">&amp;</span><span class="ident" id="5190889">test</span>&nbsp;<span class="op" id="5190894">!=</span>&nbsp;<span class="num" id="5190897">0</span>&nbsp;<span class="op" id="5190899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190904">firstRightIndex</span>&nbsp;<span class="op" id="5190920">=</span>&nbsp;<span class="ident" id="5190922">i</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5190927">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5190935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5190938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190942">left</span>&nbsp;<span class="op" id="5190947">:=</span>&nbsp;<span class="ident" id="5190950">codes</span><span class="op" id="5190955">[</span><span class="op" id="5190956">:</span><span class="ident" id="5190957">firstRightIndex</span><span class="op" id="5190972">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190975">right</span>&nbsp;<span class="op" id="5190981">:=</span>&nbsp;<span class="ident" id="5190984">codes</span><span class="op" id="5190989">[</span><span class="ident" id="5190990">firstRightIndex</span><span class="op" id="5191005">:</span><span class="op" id="5191006">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191010">if</span>&nbsp;<span class="builtinfunc" id="5191013">len</span><span class="op" id="5191016">(</span><span class="ident" id="5191017">left</span><span class="op" id="5191021">)</span>&nbsp;<span class="op" id="5191023">==</span>&nbsp;<span class="num" id="5191026">0</span>&nbsp;<span class="op" id="5191028">||</span>&nbsp;<span class="builtinfunc" id="5191031">len</span><span class="op" id="5191034">(</span><span class="ident" id="5191035">right</span><span class="op" id="5191040">)</span>&nbsp;<span class="op" id="5191042">==</span>&nbsp;<span class="num" id="5191045">0</span>&nbsp;<span class="op" id="5191047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191051">//&nbsp;There&nbsp;is&nbsp;a&nbsp;superfluous&nbsp;level&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;indicating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191116">//&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;encoder.&nbsp;However,&nbsp;this&nbsp;bug&nbsp;has&nbsp;been&nbsp;observed&nbsp;in</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191182">//&nbsp;the&nbsp;wild&nbsp;so&nbsp;we&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191214">//&nbsp;If&nbsp;this&nbsp;function&nbsp;was&nbsp;called&nbsp;recursively&nbsp;then&nbsp;we&nbsp;know&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191277">//&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;because,&nbsp;otherwise,&nbsp;we&nbsp;would&nbsp;have&nbsp;hit&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191340">//&nbsp;&#34;leaf&nbsp;node&#34;&nbsp;case,&nbsp;below,&nbsp;and&nbsp;not&nbsp;recursed.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191388">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191393">//&nbsp;However,&nbsp;for&nbsp;the&nbsp;initial&nbsp;call&nbsp;it&#39;s&nbsp;possible&nbsp;that&nbsp;len(codes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191458">//&nbsp;is&nbsp;zero&nbsp;or&nbsp;one.&nbsp;Both&nbsp;cases&nbsp;are&nbsp;invalid&nbsp;because&nbsp;a&nbsp;zero&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191524">//&nbsp;tree&nbsp;cannot&nbsp;encode&nbsp;anything&nbsp;and&nbsp;a&nbsp;length-1&nbsp;tree&nbsp;can&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191586">//&nbsp;encode&nbsp;EOF&nbsp;and&nbsp;so&nbsp;is&nbsp;superfluous.&nbsp;We&nbsp;reject&nbsp;both.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191641">if</span>&nbsp;<span class="builtinfunc" id="5191644">len</span><span class="op" id="5191647">(</span><span class="ident" id="5191648">codes</span><span class="op" id="5191653">)</span>&nbsp;<span class="op" id="5191655">&lt;</span>&nbsp;<span class="num" id="5191657">2</span>&nbsp;<span class="op" id="5191659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191664">return</span>&nbsp;<span class="num" id="5191671">0</span><span class="op" id="5191672">,</span>&nbsp;<span class="ident" id="5191674">StructuralError</span><span class="op" id="5191689">(</span><span class="string" id="5191690">&#34;empty&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="5191710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5191714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191719">//&nbsp;In&nbsp;this&nbsp;case&nbsp;the&nbsp;recursion&nbsp;doesn&#39;t&nbsp;always&nbsp;reduce&nbsp;the&nbsp;length</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191784">//&nbsp;of&nbsp;codes&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;ensure&nbsp;termination&nbsp;via&nbsp;another</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191843">//&nbsp;mechanism.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191859">if</span>&nbsp;<span class="ident" id="5191862">level</span>&nbsp;<span class="op" id="5191868">==</span>&nbsp;<span class="num" id="5191871">31</span>&nbsp;<span class="op" id="5191874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191879">//&nbsp;Since&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;the&nbsp;only&nbsp;way&nbsp;that&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191936">//&nbsp;can&nbsp;match&nbsp;at&nbsp;all&nbsp;32&nbsp;bits&nbsp;is&nbsp;if&nbsp;they&nbsp;are&nbsp;equal,&nbsp;which</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191995">//&nbsp;is&nbsp;invalid.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;we&nbsp;never&nbsp;enter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5192046">//&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192072">return</span>&nbsp;<span class="num" id="5192079">0</span><span class="op" id="5192080">,</span>&nbsp;<span class="ident" id="5192082">StructuralError</span><span class="op" id="5192097">(</span><span class="string" id="5192098">&#34;equal&nbsp;symbols&nbsp;in&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="5192129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5192133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192138">if</span>&nbsp;<span class="builtinfunc" id="5192141">len</span><span class="op" id="5192144">(</span><span class="ident" id="5192145">left</span><span class="op" id="5192149">)</span>&nbsp;<span class="op" id="5192151">==</span>&nbsp;<span class="num" id="5192154">0</span>&nbsp;<span class="op" id="5192156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192161">return</span>&nbsp;<span class="ident" id="5192168">buildHuffmanNode</span><span class="op" id="5192184">(</span><span class="ident" id="5192185">t</span><span class="op" id="5192186">,</span>&nbsp;<span class="ident" id="5192188">right</span><span class="op" id="5192193">,</span>&nbsp;<span class="ident" id="5192195">level</span><span class="op" id="5192200">+</span><span class="num" id="5192201">1</span><span class="op" id="5192202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5192206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192210">return</span>&nbsp;<span class="ident" id="5192217">buildHuffmanNode</span><span class="op" id="5192233">(</span><span class="ident" id="5192234">t</span><span class="op" id="5192235">,</span>&nbsp;<span class="ident" id="5192237">left</span><span class="op" id="5192241">,</span>&nbsp;<span class="ident" id="5192243">level</span><span class="op" id="5192248">+</span><span class="num" id="5192249">1</span><span class="op" id="5192250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5192253">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5192257">nodeIndex</span>&nbsp;<span class="op" id="5192267">=</span>&nbsp;<span class="builtintype" id="5192269">uint16</span><span class="op" id="5192275">(</span><span class="ident" id="5192276">t</span><span class="op" id="5192277">.</span><span class="ident" id="5192278">nextNode</span><span class="op" id="5192286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5192289">node</span>&nbsp;<span class="op" id="5192294">:=</span>&nbsp;<span class="op" id="5192297">&amp;</span><span class="ident" id="5192298">t</span><span class="op" id="5192299">.</span><span class="ident" id="5192300">nodes</span><span class="op" id="5192305">[</span><span class="ident" id="5192306">t</span><span class="op" id="5192307">.</span><span class="ident" id="5192308">nextNode</span><span class="op" id="5192316">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5192319">t</span><span class="op" id="5192320">.</span><span class="ident" id="5192321">nextNode</span><span class="op" id="5192329">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192334">if</span>&nbsp;<span class="builtinfunc" id="5192337">len</span><span class="op" id="5192340">(</span><span class="ident" id="5192341">left</span><span class="op" id="5192345">)</span>&nbsp;<span class="op" id="5192347">==</span>&nbsp;<span class="num" id="5192350">1</span>&nbsp;<span class="op" id="5192352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5192356">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5192371">node</span><span class="op" id="5192375">.</span><span class="ident" id="5192376">left</span>&nbsp;<span class="op" id="5192381">=</span>&nbsp;<span class="ident" id="5192383">invalidNodeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5192402">node</span><span class="op" id="5192406">.</span><span class="ident" id="5192407">leftValue</span>&nbsp;<span class="op" id="5192417">=</span>&nbsp;<span class="ident" id="5192419">left</span><span class="op" id="5192423">[</span><span class="num" id="5192424">0</span><span class="op" id="5192425">]</span><span class="op" id="5192426">.</span><span class="ident" id="5192427">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5192434">}</span>&nbsp;<span class="keyword" id="5192436">else</span>&nbsp;<span class="op" id="5192441">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5192445">node</span><span class="op" id="5192449">.</span><span class="ident" id="5192450">left</span><span class="op" id="5192454">,</span>&nbsp;<span class="ident" id="5192456">err</span>&nbsp;<span class="op" id="5192460">=</span>&nbsp;<span class="ident" id="5192462">buildHuffmanNode</span><span class="op" id="5192478">(</span><span class="ident" id="5192479">t</span><span class="op" id="5192480">,</span>&nbsp;<span class="ident" id="5192482">left</span><span class="op" id="5192486">,</span>&nbsp;<span class="ident" id="5192488">level</span><span class="op" id="5192493">+</span><span class="num" id="5192494">1</span><span class="op" id="5192495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5192498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192502">if</span>&nbsp;<span class="ident" id="5192505">err</span>&nbsp;<span class="op" id="5192509">!=</span>&nbsp;<span class="ident" id="5192512">nil</span>&nbsp;<span class="op" id="5192516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192520">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5192528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192532">if</span>&nbsp;<span class="builtinfunc" id="5192535">len</span><span class="op" id="5192538">(</span><span class="ident" id="5192539">right</span><span class="op" id="5192544">)</span>&nbsp;<span class="op" id="5192546">==</span>&nbsp;<span class="num" id="5192549">1</span>&nbsp;<span class="op" id="5192551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5192555">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5192570">node</span><span class="op" id="5192574">.</span><span class="ident" id="5192575">right</span>&nbsp;<span class="op" id="5192581">=</span>&nbsp;<span class="ident" id="5192583">invalidNodeValue</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5192602">node</span><span class="op" id="5192606">.</span><span class="ident" id="5192607">rightValue</span>&nbsp;<span class="op" id="5192618">=</span>&nbsp;<span class="ident" id="5192620">right</span><span class="op" id="5192625">[</span><span class="num" id="5192626">0</span><span class="op" id="5192627">]</span><span class="op" id="5192628">.</span><span class="ident" id="5192629">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5192636">}</span>&nbsp;<span class="keyword" id="5192638">else</span>&nbsp;<span class="op" id="5192643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5192647">node</span><span class="op" id="5192651">.</span><span class="ident" id="5192652">right</span><span class="op" id="5192657">,</span>&nbsp;<span class="ident" id="5192659">err</span>&nbsp;<span class="op" id="5192663">=</span>&nbsp;<span class="ident" id="5192665">buildHuffmanNode</span><span class="op" id="5192681">(</span><span class="ident" id="5192682">t</span><span class="op" id="5192683">,</span>&nbsp;<span class="ident" id="5192685">right</span><span class="op" id="5192690">,</span>&nbsp;<span class="ident" id="5192692">level</span><span class="op" id="5192697">+</span><span class="num" id="5192698">1</span><span class="op" id="5192699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5192702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192706">return</span><br>
<span class="lineno"></span><span class="op" id="5192713">}</span>
</div>
</body>
</html>
