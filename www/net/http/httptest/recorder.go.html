<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6296017">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6296072">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6296126">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6296177">//&nbsp;Package&nbsp;httptest&nbsp;provides&nbsp;utilities&nbsp;for&nbsp;HTTP&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6296234">package</span>&nbsp;<span class="ident" id="6296242">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6296252">import</span>&nbsp;<span class="op" id="6296259">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6296262">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6296271">&#34;net/http&#34;</span><br>
<span class="lineno"></span><span class="op" id="6296282">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6296285">//&nbsp;ResponseRecorder&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;http.ResponseWriter&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="6296354">//&nbsp;records&nbsp;its&nbsp;mutations&nbsp;for&nbsp;later&nbsp;inspection&nbsp;in&nbsp;tests.</span><br>
<span class="lineno">15</span><span class="keyword" id="6296410">type</span>&nbsp;<span class="ident" id="6296415">ResponseRecorder</span>&nbsp;<span class="keyword" id="6296432">struct</span>&nbsp;<span class="op" id="6296439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296442">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6296452">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6296466">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;code&nbsp;from&nbsp;WriteHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296510">HeaderMap</span>&nbsp;<span class="ident" id="6296520"><a href="/net/http/httptest/recorder.go.html#6296271">http</a></span><span class="op" id="6296524">.</span><span class="ident" id="6296525">Header</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6296534">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296564">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6296574">*</span><span class="ident" id="6296575"><a href="/net/http/httptest/recorder.go.html#6296262">bytes</a></span><span class="op" id="6296580">.</span><span class="ident" id="6296581">Buffer</span>&nbsp;<span class="comment" id="6296588">//&nbsp;if&nbsp;non-nil,&nbsp;the&nbsp;bytes.Buffer&nbsp;to&nbsp;append&nbsp;written&nbsp;data&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296647">Flushed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6296657">bool</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296664">wroteHeader</span>&nbsp;<span class="builtintype" id="6296676">bool</span><br>
<span class="lineno"></span><span class="op" id="6296681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6296684">//&nbsp;NewRecorder&nbsp;returns&nbsp;an&nbsp;initialized&nbsp;ResponseRecorder.</span><br>
<span class="lineno">25</span><span class="keyword" id="6296740">func</span>&nbsp;<span class="ident" id="6296745">NewRecorder</span><span class="op" id="6296756">(</span><span class="op" id="6296757">)</span>&nbsp;<span class="op" id="6296759">*</span><span class="ident" id="6296760"><a href="/net/http/httptest/recorder.go.html#6296415">ResponseRecorder</a></span>&nbsp;<span class="op" id="6296777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296780">return</span>&nbsp;<span class="op" id="6296787">&amp;</span><span class="ident" id="6296788"><a href="/net/http/httptest/recorder.go.html#6296415">ResponseRecorder</a></span><span class="op" id="6296804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296808">HeaderMap</span><span class="op" id="6296817">:</span>&nbsp;<span class="builtinfunc" id="6296819">make</span><span class="op" id="6296823">(</span><span class="ident" id="6296824"><a href="/net/http/httptest/recorder.go.html#6296271">http</a></span><span class="op" id="6296828">.</span><span class="ident" id="6296829">Header</span><span class="op" id="6296835">)</span><span class="op" id="6296836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296840">Body</span><span class="op" id="6296844">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6296851">new</span><span class="op" id="6296854">(</span><span class="ident" id="6296855"><a href="/net/http/httptest/recorder.go.html#6296262">bytes</a></span><span class="op" id="6296860">.</span><span class="ident" id="6296861">Buffer</span><span class="op" id="6296867">)</span><span class="op" id="6296868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296872">Code</span><span class="op" id="6296876">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6296883">200</span><span class="op" id="6296886">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296889">}</span><br>
<span class="lineno"></span><span class="op" id="6296891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6296894">//&nbsp;DefaultRemoteAddr&nbsp;is&nbsp;the&nbsp;default&nbsp;remote&nbsp;address&nbsp;to&nbsp;return&nbsp;in&nbsp;RemoteAddr&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6296972">//&nbsp;an&nbsp;explicit&nbsp;DefaultRemoteAddr&nbsp;isn&#39;t&nbsp;set&nbsp;on&nbsp;ResponseRecorder.</span><br>
<span class="lineno">35</span><span class="keyword" id="6297036">const</span>&nbsp;<span class="ident" id="6297042">DefaultRemoteAddr</span>&nbsp;<span class="op" id="6297060">=</span>&nbsp;<span class="string" id="6297062">&#34;1.2.3.4&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6297073">//&nbsp;Header&nbsp;returns&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="6297113">func</span>&nbsp;<span class="op" id="6297118">(</span><span class="ident" id="6297119">rw</span>&nbsp;<span class="op" id="6297122">*</span><span class="ident" id="6297123"><a href="/net/http/httptest/recorder.go.html#6296415">ResponseRecorder</a></span><span class="op" id="6297139">)</span>&nbsp;<span class="ident" id="6297141">Header</span><span class="op" id="6297147">(</span><span class="op" id="6297148">)</span>&nbsp;<span class="ident" id="6297150"><a href="/net/http/httptest/recorder.go.html#6296271">http</a></span><span class="op" id="6297154">.</span><span class="ident" id="6297155">Header</span>&nbsp;<span class="op" id="6297162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297165">m</span>&nbsp;<span class="op" id="6297167">:=</span>&nbsp;<span class="ident" id="6297170"><a href="/net/http/httptest/recorder.go.html#6297119">rw</a></span><span class="op" id="6297172">.</span><span class="ident" id="6297173">HeaderMap</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297184">if</span>&nbsp;<span class="ident" id="6297187"><a href="/net/http/httptest/recorder.go.html#6297165">m</a></span>&nbsp;<span class="op" id="6297189">==</span>&nbsp;<span class="ident" id="6297192">nil</span>&nbsp;<span class="op" id="6297196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297200"><a href="/net/http/httptest/recorder.go.html#6297165">m</a></span>&nbsp;<span class="op" id="6297202">=</span>&nbsp;<span class="builtinfunc" id="6297204">make</span><span class="op" id="6297208">(</span><span class="ident" id="6297209"><a href="/net/http/httptest/recorder.go.html#6296271">http</a></span><span class="op" id="6297213">.</span><span class="ident" id="6297214">Header</span><span class="op" id="6297220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297224"><a href="/net/http/httptest/recorder.go.html#6297119">rw</a></span><span class="op" id="6297226">.</span><span class="ident" id="6297227">HeaderMap</span>&nbsp;<span class="op" id="6297237">=</span>&nbsp;<span class="ident" id="6297239"><a href="/net/http/httptest/recorder.go.html#6297165">m</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297245">return</span>&nbsp;<span class="ident" id="6297252"><a href="/net/http/httptest/recorder.go.html#6297165">m</a></span><br>
<span class="lineno">45</span><span class="op" id="6297254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6297257">//&nbsp;Write&nbsp;always&nbsp;succeeds&nbsp;and&nbsp;writes&nbsp;to&nbsp;rw.Body,&nbsp;if&nbsp;not&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="6297317">func</span>&nbsp;<span class="op" id="6297322">(</span><span class="ident" id="6297323">rw</span>&nbsp;<span class="op" id="6297326">*</span><span class="ident" id="6297327"><a href="/net/http/httptest/recorder.go.html#6296415">ResponseRecorder</a></span><span class="op" id="6297343">)</span>&nbsp;<span class="ident" id="6297345">Write</span><span class="op" id="6297350">(</span><span class="ident" id="6297351">buf</span>&nbsp;<span class="op" id="6297355">[</span><span class="op" id="6297356">]</span><span class="builtintype" id="6297357">byte</span><span class="op" id="6297361">)</span>&nbsp;<span class="op" id="6297363">(</span><span class="builtintype" id="6297364">int</span><span class="op" id="6297367">,</span>&nbsp;<span class="builtintype" id="6297369">error</span><span class="op" id="6297374">)</span>&nbsp;<span class="op" id="6297376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297379">if</span>&nbsp;<span class="op" id="6297382">!</span><span class="ident" id="6297383"><a href="/net/http/httptest/recorder.go.html#6297323">rw</a></span><span class="op" id="6297385">.</span><span class="ident" id="6297386">wroteHeader</span>&nbsp;<span class="op" id="6297398">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297402"><a href="/net/http/httptest/recorder.go.html#6297323">rw</a></span><span class="op" id="6297404">.</span><span class="ident" id="6297405">WriteHeader</span><span class="op" id="6297416">(</span><span class="num" id="6297417">200</span><span class="op" id="6297420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297426">if</span>&nbsp;<span class="ident" id="6297429"><a href="/net/http/httptest/recorder.go.html#6297323">rw</a></span><span class="op" id="6297431">.</span><span class="ident" id="6297432">Body</span>&nbsp;<span class="op" id="6297437">!=</span>&nbsp;<span class="ident" id="6297440">nil</span>&nbsp;<span class="op" id="6297444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297448"><a href="/net/http/httptest/recorder.go.html#6297323">rw</a></span><span class="op" id="6297450">.</span><span class="ident" id="6297451">Body</span><span class="op" id="6297455">.</span><span class="ident" id="6297456">Write</span><span class="op" id="6297461">(</span><span class="ident" id="6297462"><a href="/net/http/httptest/recorder.go.html#6297351">buf</a></span><span class="op" id="6297465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297468">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297471">return</span>&nbsp;<span class="builtinfunc" id="6297478">len</span><span class="op" id="6297481">(</span><span class="ident" id="6297482"><a href="/net/http/httptest/recorder.go.html#6297351">buf</a></span><span class="op" id="6297485">)</span><span class="op" id="6297486">,</span>&nbsp;<span class="ident" id="6297488">nil</span><br>
<span class="lineno"></span><span class="op" id="6297492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6297495">//&nbsp;WriteHeader&nbsp;sets&nbsp;rw.Code.</span><br>
<span class="lineno"></span><span class="keyword" id="6297524">func</span>&nbsp;<span class="op" id="6297529">(</span><span class="ident" id="6297530">rw</span>&nbsp;<span class="op" id="6297533">*</span><span class="ident" id="6297534"><a href="/net/http/httptest/recorder.go.html#6296415">ResponseRecorder</a></span><span class="op" id="6297550">)</span>&nbsp;<span class="ident" id="6297552">WriteHeader</span><span class="op" id="6297563">(</span><span class="ident" id="6297564">code</span>&nbsp;<span class="builtintype" id="6297569">int</span><span class="op" id="6297572">)</span>&nbsp;<span class="op" id="6297574">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297577">if</span>&nbsp;<span class="op" id="6297580">!</span><span class="ident" id="6297581"><a href="/net/http/httptest/recorder.go.html#6297530">rw</a></span><span class="op" id="6297583">.</span><span class="ident" id="6297584">wroteHeader</span>&nbsp;<span class="op" id="6297596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297600"><a href="/net/http/httptest/recorder.go.html#6297530">rw</a></span><span class="op" id="6297602">.</span><span class="ident" id="6297603">Code</span>&nbsp;<span class="op" id="6297608">=</span>&nbsp;<span class="ident" id="6297610"><a href="/net/http/httptest/recorder.go.html#6297564">code</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297619"><a href="/net/http/httptest/recorder.go.html#6297530">rw</a></span><span class="op" id="6297621">.</span><span class="ident" id="6297622">wroteHeader</span>&nbsp;<span class="op" id="6297634">=</span>&nbsp;<span class="builtintype" id="6297636">true</span><br>
<span class="lineno"></span><span class="op" id="6297641">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="6297644">//&nbsp;Flush&nbsp;sets&nbsp;rw.Flushed&nbsp;to&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="6297678">func</span>&nbsp;<span class="op" id="6297683">(</span><span class="ident" id="6297684">rw</span>&nbsp;<span class="op" id="6297687">*</span><span class="ident" id="6297688"><a href="/net/http/httptest/recorder.go.html#6296415">ResponseRecorder</a></span><span class="op" id="6297704">)</span>&nbsp;<span class="ident" id="6297706">Flush</span><span class="op" id="6297711">(</span><span class="op" id="6297712">)</span>&nbsp;<span class="op" id="6297714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297717">if</span>&nbsp;<span class="op" id="6297720">!</span><span class="ident" id="6297721"><a href="/net/http/httptest/recorder.go.html#6297684">rw</a></span><span class="op" id="6297723">.</span><span class="ident" id="6297724">wroteHeader</span>&nbsp;<span class="op" id="6297736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297740"><a href="/net/http/httptest/recorder.go.html#6297684">rw</a></span><span class="op" id="6297742">.</span><span class="ident" id="6297743">WriteHeader</span><span class="op" id="6297754">(</span><span class="num" id="6297755">200</span><span class="op" id="6297758">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297764"><a href="/net/http/httptest/recorder.go.html#6297684">rw</a></span><span class="op" id="6297766">.</span><span class="ident" id="6297767">Flushed</span>&nbsp;<span class="op" id="6297775">=</span>&nbsp;<span class="builtintype" id="6297777">true</span><br>
<span class="lineno"></span><span class="op" id="6297782">}</span>
</div>
</body>
</html>
