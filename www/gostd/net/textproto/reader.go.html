<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5085389">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5085445">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5085499">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5085550">package</span>&nbsp;<span class="ident" id="5085558">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5085569">import</span>&nbsp;<span class="op" id="5085576">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5085579">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5085588">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5085597">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5085603">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5085616">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5085627">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5085637">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5085640">//&nbsp;BUG(rsc):&nbsp;To&nbsp;let&nbsp;callers&nbsp;manage&nbsp;exposure&nbsp;to&nbsp;denial&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="5085705">//&nbsp;attacks,&nbsp;Reader&nbsp;should&nbsp;allow&nbsp;them&nbsp;to&nbsp;set&nbsp;and&nbsp;reset&nbsp;a&nbsp;limit&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="5085770">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5085820">//&nbsp;A&nbsp;Reader&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;reading&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="5085884">//&nbsp;or&nbsp;responses&nbsp;from&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5085941">type</span>&nbsp;<span class="ident" id="5085946">Reader</span>&nbsp;<span class="keyword" id="5085953">struct</span>&nbsp;<span class="op" id="5085960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085963">R</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5085967">*</span><span class="ident" id="5085968">bufio</span><span class="op" id="5085973">.</span><span class="ident" id="5085974">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085982">dot</span>&nbsp;<span class="op" id="5085986">*</span><span class="ident" id="5085987">dotReader</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085998">buf</span>&nbsp;<span class="op" id="5086002">[</span><span class="op" id="5086003">]</span><span class="builtintype" id="5086004">byte</span>&nbsp;<span class="comment" id="5086009">//&nbsp;a&nbsp;re-usable&nbsp;buffer&nbsp;for&nbsp;readContinuedLineSlice</span><br>
<span class="lineno"></span><span class="op" id="5086058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5086061">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5086111">func</span>&nbsp;<span class="ident" id="5086116">NewReader</span><span class="op" id="5086125">(</span><span class="ident" id="5086126">r</span>&nbsp;<span class="op" id="5086128">*</span><span class="ident" id="5086129">bufio</span><span class="op" id="5086134">.</span><span class="ident" id="5086135">Reader</span><span class="op" id="5086141">)</span>&nbsp;<span class="op" id="5086143">*</span><span class="ident" id="5086144">Reader</span>&nbsp;<span class="op" id="5086151">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086154">return</span>&nbsp;<span class="op" id="5086161">&amp;</span><span class="ident" id="5086162">Reader</span><span class="op" id="5086168">{</span><span class="ident" id="5086169">R</span><span class="op" id="5086170">:</span>&nbsp;<span class="ident" id="5086172">r</span><span class="op" id="5086173">}</span><br>
<span class="lineno"></span><span class="op" id="5086175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5086178">//&nbsp;ReadLine&nbsp;reads&nbsp;a&nbsp;single&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="5086218">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;\n&nbsp;or&nbsp;\r\n&nbsp;from&nbsp;the&nbsp;returned&nbsp;string.</span><br>
<span class="lineno">35</span><span class="keyword" id="5086276">func</span>&nbsp;<span class="op" id="5086281">(</span><span class="ident" id="5086282">r</span>&nbsp;<span class="op" id="5086284">*</span><span class="ident" id="5086285">Reader</span><span class="op" id="5086291">)</span>&nbsp;<span class="ident" id="5086293">ReadLine</span><span class="op" id="5086301">(</span><span class="op" id="5086302">)</span>&nbsp;<span class="op" id="5086304">(</span><span class="builtintype" id="5086305">string</span><span class="op" id="5086311">,</span>&nbsp;<span class="builtintype" id="5086313">error</span><span class="op" id="5086318">)</span>&nbsp;<span class="op" id="5086320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086323">line</span><span class="op" id="5086327">,</span>&nbsp;<span class="ident" id="5086329">err</span>&nbsp;<span class="op" id="5086333">:=</span>&nbsp;<span class="ident" id="5086336">r</span><span class="op" id="5086337">.</span><span class="ident" id="5086338">readLineSlice</span><span class="op" id="5086351">(</span><span class="op" id="5086352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086355">return</span>&nbsp;<span class="builtintype" id="5086362">string</span><span class="op" id="5086368">(</span><span class="ident" id="5086369">line</span><span class="op" id="5086373">)</span><span class="op" id="5086374">,</span>&nbsp;<span class="ident" id="5086376">err</span><br>
<span class="lineno"></span><span class="op" id="5086380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="5086383">//&nbsp;ReadLineBytes&nbsp;is&nbsp;like&nbsp;ReadLine&nbsp;but&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5086459">func</span>&nbsp;<span class="op" id="5086464">(</span><span class="ident" id="5086465">r</span>&nbsp;<span class="op" id="5086467">*</span><span class="ident" id="5086468">Reader</span><span class="op" id="5086474">)</span>&nbsp;<span class="ident" id="5086476">ReadLineBytes</span><span class="op" id="5086489">(</span><span class="op" id="5086490">)</span>&nbsp;<span class="op" id="5086492">(</span><span class="op" id="5086493">[</span><span class="op" id="5086494">]</span><span class="builtintype" id="5086495">byte</span><span class="op" id="5086499">,</span>&nbsp;<span class="builtintype" id="5086501">error</span><span class="op" id="5086506">)</span>&nbsp;<span class="op" id="5086508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086511">line</span><span class="op" id="5086515">,</span>&nbsp;<span class="ident" id="5086517">err</span>&nbsp;<span class="op" id="5086521">:=</span>&nbsp;<span class="ident" id="5086524">r</span><span class="op" id="5086525">.</span><span class="ident" id="5086526">readLineSlice</span><span class="op" id="5086539">(</span><span class="op" id="5086540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086543">if</span>&nbsp;<span class="ident" id="5086546">line</span>&nbsp;<span class="op" id="5086551">!=</span>&nbsp;<span class="ident" id="5086554">nil</span>&nbsp;<span class="op" id="5086558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086562">buf</span>&nbsp;<span class="op" id="5086566">:=</span>&nbsp;<span class="builtinfunc" id="5086569">make</span><span class="op" id="5086573">(</span><span class="op" id="5086574">[</span><span class="op" id="5086575">]</span><span class="builtintype" id="5086576">byte</span><span class="op" id="5086580">,</span>&nbsp;<span class="builtinfunc" id="5086582">len</span><span class="op" id="5086585">(</span><span class="ident" id="5086586">line</span><span class="op" id="5086590">)</span><span class="op" id="5086591">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5086595">copy</span><span class="op" id="5086599">(</span><span class="ident" id="5086600">buf</span><span class="op" id="5086603">,</span>&nbsp;<span class="ident" id="5086605">line</span><span class="op" id="5086609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086613">line</span>&nbsp;<span class="op" id="5086618">=</span>&nbsp;<span class="ident" id="5086620">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5086625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086628">return</span>&nbsp;<span class="ident" id="5086635">line</span><span class="op" id="5086639">,</span>&nbsp;<span class="ident" id="5086641">err</span><br>
<span class="lineno"></span><span class="op" id="5086645">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5086648">func</span>&nbsp;<span class="op" id="5086653">(</span><span class="ident" id="5086654">r</span>&nbsp;<span class="op" id="5086656">*</span><span class="ident" id="5086657">Reader</span><span class="op" id="5086663">)</span>&nbsp;<span class="ident" id="5086665">readLineSlice</span><span class="op" id="5086678">(</span><span class="op" id="5086679">)</span>&nbsp;<span class="op" id="5086681">(</span><span class="op" id="5086682">[</span><span class="op" id="5086683">]</span><span class="builtintype" id="5086684">byte</span><span class="op" id="5086688">,</span>&nbsp;<span class="builtintype" id="5086690">error</span><span class="op" id="5086695">)</span>&nbsp;<span class="op" id="5086697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086700">r</span><span class="op" id="5086701">.</span><span class="ident" id="5086702">closeDot</span><span class="op" id="5086710">(</span><span class="op" id="5086711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086714">var</span>&nbsp;<span class="ident" id="5086718">line</span>&nbsp;<span class="op" id="5086723">[</span><span class="op" id="5086724">]</span><span class="builtintype" id="5086725">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086731">for</span>&nbsp;<span class="op" id="5086735">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086739">l</span><span class="op" id="5086740">,</span>&nbsp;<span class="ident" id="5086742">more</span><span class="op" id="5086746">,</span>&nbsp;<span class="ident" id="5086748">err</span>&nbsp;<span class="op" id="5086752">:=</span>&nbsp;<span class="ident" id="5086755">r</span><span class="op" id="5086756">.</span><span class="ident" id="5086757">R</span><span class="op" id="5086758">.</span><span class="ident" id="5086759">ReadLine</span><span class="op" id="5086767">(</span><span class="op" id="5086768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086772">if</span>&nbsp;<span class="ident" id="5086775">err</span>&nbsp;<span class="op" id="5086779">!=</span>&nbsp;<span class="ident" id="5086782">nil</span>&nbsp;<span class="op" id="5086786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086791">return</span>&nbsp;<span class="ident" id="5086798">nil</span><span class="op" id="5086801">,</span>&nbsp;<span class="ident" id="5086803">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5086809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5086813">//&nbsp;Avoid&nbsp;the&nbsp;copy&nbsp;if&nbsp;the&nbsp;first&nbsp;call&nbsp;produced&nbsp;a&nbsp;full&nbsp;line.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086873">if</span>&nbsp;<span class="ident" id="5086876">line</span>&nbsp;<span class="op" id="5086881">==</span>&nbsp;<span class="ident" id="5086884">nil</span>&nbsp;<span class="op" id="5086888">&amp;&amp;</span>&nbsp;<span class="op" id="5086891">!</span><span class="ident" id="5086892">more</span>&nbsp;<span class="op" id="5086897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086902">return</span>&nbsp;<span class="ident" id="5086909">l</span><span class="op" id="5086910">,</span>&nbsp;<span class="ident" id="5086912">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5086918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5086922">line</span>&nbsp;<span class="op" id="5086927">=</span>&nbsp;<span class="builtinfunc" id="5086929">append</span><span class="op" id="5086935">(</span><span class="ident" id="5086936">line</span><span class="op" id="5086940">,</span>&nbsp;<span class="ident" id="5086942">l</span><span class="op" id="5086943">...</span><span class="op" id="5086946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086950">if</span>&nbsp;<span class="op" id="5086953">!</span><span class="ident" id="5086954">more</span>&nbsp;<span class="op" id="5086959">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086964">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5086972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5086975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5086978">return</span>&nbsp;<span class="ident" id="5086985">line</span><span class="op" id="5086989">,</span>&nbsp;<span class="ident" id="5086991">nil</span><br>
<span class="lineno"></span><span class="op" id="5086995">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="5086998">//&nbsp;ReadContinuedLine&nbsp;reads&nbsp;a&nbsp;possibly&nbsp;continued&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="5087059">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;trailing&nbsp;ASCII&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="comment" id="5087108">//&nbsp;Lines&nbsp;after&nbsp;the&nbsp;first&nbsp;are&nbsp;considered&nbsp;continuations&nbsp;if&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="5087170">//&nbsp;begin&nbsp;with&nbsp;a&nbsp;space&nbsp;or&nbsp;tab&nbsp;character.&nbsp;&nbsp;In&nbsp;the&nbsp;returned&nbsp;data,</span><br>
<span class="lineno">75</span><span class="comment" id="5087233">//&nbsp;continuation&nbsp;lines&nbsp;are&nbsp;separated&nbsp;from&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5087292">//&nbsp;only&nbsp;by&nbsp;a&nbsp;single&nbsp;space:&nbsp;the&nbsp;newline&nbsp;and&nbsp;leading&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="5087355">//&nbsp;are&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="5087371">//</span><br>
<span class="lineno"></span><span class="comment" id="5087374">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">80</span><span class="comment" id="5087411">//</span><br>
<span class="lineno"></span><span class="comment" id="5087414">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="5087424">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;continued...</span><br>
<span class="lineno"></span><span class="comment" id="5087442">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="5087452">//</span><br>
<span class="lineno">85</span><span class="comment" id="5087455">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;ReadContinuedLine&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;1&nbsp;continued...&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5087528">//&nbsp;and&nbsp;the&nbsp;second&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;2&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5087568">//</span><br>
<span class="lineno"></span><span class="comment" id="5087571">//&nbsp;A&nbsp;line&nbsp;consisting&nbsp;of&nbsp;only&nbsp;white&nbsp;space&nbsp;is&nbsp;never&nbsp;continued.</span><br>
<span class="lineno"></span><span class="comment" id="5087632">//</span><br>
<span class="lineno">90</span><span class="keyword" id="5087635">func</span>&nbsp;<span class="op" id="5087640">(</span><span class="ident" id="5087641">r</span>&nbsp;<span class="op" id="5087643">*</span><span class="ident" id="5087644">Reader</span><span class="op" id="5087650">)</span>&nbsp;<span class="ident" id="5087652">ReadContinuedLine</span><span class="op" id="5087669">(</span><span class="op" id="5087670">)</span>&nbsp;<span class="op" id="5087672">(</span><span class="builtintype" id="5087673">string</span><span class="op" id="5087679">,</span>&nbsp;<span class="builtintype" id="5087681">error</span><span class="op" id="5087686">)</span>&nbsp;<span class="op" id="5087688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087691">line</span><span class="op" id="5087695">,</span>&nbsp;<span class="ident" id="5087697">err</span>&nbsp;<span class="op" id="5087701">:=</span>&nbsp;<span class="ident" id="5087704">r</span><span class="op" id="5087705">.</span><span class="ident" id="5087706">readContinuedLineSlice</span><span class="op" id="5087728">(</span><span class="op" id="5087729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5087732">return</span>&nbsp;<span class="builtintype" id="5087739">string</span><span class="op" id="5087745">(</span><span class="ident" id="5087746">line</span><span class="op" id="5087750">)</span><span class="op" id="5087751">,</span>&nbsp;<span class="ident" id="5087753">err</span><br>
<span class="lineno"></span><span class="op" id="5087757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5087760">//&nbsp;trim&nbsp;returns&nbsp;s&nbsp;with&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;spaces&nbsp;and&nbsp;tabs&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="5087829">//&nbsp;It&nbsp;does&nbsp;not&nbsp;assume&nbsp;Unicode&nbsp;or&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="5087869">func</span>&nbsp;<span class="ident" id="5087874">trim</span><span class="op" id="5087878">(</span><span class="ident" id="5087879">s</span>&nbsp;<span class="op" id="5087881">[</span><span class="op" id="5087882">]</span><span class="builtintype" id="5087883">byte</span><span class="op" id="5087887">)</span>&nbsp;<span class="op" id="5087889">[</span><span class="op" id="5087890">]</span><span class="builtintype" id="5087891">byte</span>&nbsp;<span class="op" id="5087896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087899">i</span>&nbsp;<span class="op" id="5087901">:=</span>&nbsp;<span class="num" id="5087904">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5087907">for</span>&nbsp;<span class="ident" id="5087911">i</span>&nbsp;<span class="op" id="5087913">&lt;</span>&nbsp;<span class="builtinfunc" id="5087915">len</span><span class="op" id="5087918">(</span><span class="ident" id="5087919">s</span><span class="op" id="5087920">)</span>&nbsp;<span class="op" id="5087922">&amp;&amp;</span>&nbsp;<span class="op" id="5087925">(</span><span class="ident" id="5087926">s</span><span class="op" id="5087927">[</span><span class="ident" id="5087928">i</span><span class="op" id="5087929">]</span>&nbsp;<span class="op" id="5087931">==</span>&nbsp;<span class="string" id="5087934">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5087938">||</span>&nbsp;<span class="ident" id="5087941">s</span><span class="op" id="5087942">[</span><span class="ident" id="5087943">i</span><span class="op" id="5087944">]</span>&nbsp;<span class="op" id="5087946">==</span>&nbsp;<span class="string" id="5087949">&#39;\t&#39;</span><span class="op" id="5087953">)</span>&nbsp;<span class="op" id="5087955">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087959">i</span><span class="op" id="5087960">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5087964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087967">n</span>&nbsp;<span class="op" id="5087969">:=</span>&nbsp;<span class="builtinfunc" id="5087972">len</span><span class="op" id="5087975">(</span><span class="ident" id="5087976">s</span><span class="op" id="5087977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5087980">for</span>&nbsp;<span class="ident" id="5087984">n</span>&nbsp;<span class="op" id="5087986">&gt;</span>&nbsp;<span class="ident" id="5087988">i</span>&nbsp;<span class="op" id="5087990">&amp;&amp;</span>&nbsp;<span class="op" id="5087993">(</span><span class="ident" id="5087994">s</span><span class="op" id="5087995">[</span><span class="ident" id="5087996">n</span><span class="op" id="5087997">-</span><span class="num" id="5087998">1</span><span class="op" id="5087999">]</span>&nbsp;<span class="op" id="5088001">==</span>&nbsp;<span class="string" id="5088004">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5088008">||</span>&nbsp;<span class="ident" id="5088011">s</span><span class="op" id="5088012">[</span><span class="ident" id="5088013">n</span><span class="op" id="5088014">-</span><span class="num" id="5088015">1</span><span class="op" id="5088016">]</span>&nbsp;<span class="op" id="5088018">==</span>&nbsp;<span class="string" id="5088021">&#39;\t&#39;</span><span class="op" id="5088025">)</span>&nbsp;<span class="op" id="5088027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088031">n</span><span class="op" id="5088032">--</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5088036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088039">return</span>&nbsp;<span class="ident" id="5088046">s</span><span class="op" id="5088047">[</span><span class="ident" id="5088048">i</span><span class="op" id="5088049">:</span><span class="ident" id="5088050">n</span><span class="op" id="5088051">]</span><br>
<span class="lineno"></span><span class="op" id="5088053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5088056">//&nbsp;ReadContinuedLineBytes&nbsp;is&nbsp;like&nbsp;ReadContinuedLine&nbsp;but</span><br>
<span class="lineno">110</span><span class="comment" id="5088112">//&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5088153">func</span>&nbsp;<span class="op" id="5088158">(</span><span class="ident" id="5088159">r</span>&nbsp;<span class="op" id="5088161">*</span><span class="ident" id="5088162">Reader</span><span class="op" id="5088168">)</span>&nbsp;<span class="ident" id="5088170">ReadContinuedLineBytes</span><span class="op" id="5088192">(</span><span class="op" id="5088193">)</span>&nbsp;<span class="op" id="5088195">(</span><span class="op" id="5088196">[</span><span class="op" id="5088197">]</span><span class="builtintype" id="5088198">byte</span><span class="op" id="5088202">,</span>&nbsp;<span class="builtintype" id="5088204">error</span><span class="op" id="5088209">)</span>&nbsp;<span class="op" id="5088211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088214">line</span><span class="op" id="5088218">,</span>&nbsp;<span class="ident" id="5088220">err</span>&nbsp;<span class="op" id="5088224">:=</span>&nbsp;<span class="ident" id="5088227">r</span><span class="op" id="5088228">.</span><span class="ident" id="5088229">readContinuedLineSlice</span><span class="op" id="5088251">(</span><span class="op" id="5088252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088255">if</span>&nbsp;<span class="ident" id="5088258">line</span>&nbsp;<span class="op" id="5088263">!=</span>&nbsp;<span class="ident" id="5088266">nil</span>&nbsp;<span class="op" id="5088270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088274">buf</span>&nbsp;<span class="op" id="5088278">:=</span>&nbsp;<span class="builtinfunc" id="5088281">make</span><span class="op" id="5088285">(</span><span class="op" id="5088286">[</span><span class="op" id="5088287">]</span><span class="builtintype" id="5088288">byte</span><span class="op" id="5088292">,</span>&nbsp;<span class="builtinfunc" id="5088294">len</span><span class="op" id="5088297">(</span><span class="ident" id="5088298">line</span><span class="op" id="5088302">)</span><span class="op" id="5088303">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5088307">copy</span><span class="op" id="5088311">(</span><span class="ident" id="5088312">buf</span><span class="op" id="5088315">,</span>&nbsp;<span class="ident" id="5088317">line</span><span class="op" id="5088321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088325">line</span>&nbsp;<span class="op" id="5088330">=</span>&nbsp;<span class="ident" id="5088332">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5088337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088340">return</span>&nbsp;<span class="ident" id="5088347">line</span><span class="op" id="5088351">,</span>&nbsp;<span class="ident" id="5088353">err</span><br>
<span class="lineno"></span><span class="op" id="5088357">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="5088360">func</span>&nbsp;<span class="op" id="5088365">(</span><span class="ident" id="5088366">r</span>&nbsp;<span class="op" id="5088368">*</span><span class="ident" id="5088369">Reader</span><span class="op" id="5088375">)</span>&nbsp;<span class="ident" id="5088377">readContinuedLineSlice</span><span class="op" id="5088399">(</span><span class="op" id="5088400">)</span>&nbsp;<span class="op" id="5088402">(</span><span class="op" id="5088403">[</span><span class="op" id="5088404">]</span><span class="builtintype" id="5088405">byte</span><span class="op" id="5088409">,</span>&nbsp;<span class="builtintype" id="5088411">error</span><span class="op" id="5088416">)</span>&nbsp;<span class="op" id="5088418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088421">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088446">line</span><span class="op" id="5088450">,</span>&nbsp;<span class="ident" id="5088452">err</span>&nbsp;<span class="op" id="5088456">:=</span>&nbsp;<span class="ident" id="5088459">r</span><span class="op" id="5088460">.</span><span class="ident" id="5088461">readLineSlice</span><span class="op" id="5088474">(</span><span class="op" id="5088475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088478">if</span>&nbsp;<span class="ident" id="5088481">err</span>&nbsp;<span class="op" id="5088485">!=</span>&nbsp;<span class="ident" id="5088488">nil</span>&nbsp;<span class="op" id="5088492">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088496">return</span>&nbsp;<span class="ident" id="5088503">nil</span><span class="op" id="5088506">,</span>&nbsp;<span class="ident" id="5088508">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5088513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088516">if</span>&nbsp;<span class="builtinfunc" id="5088519">len</span><span class="op" id="5088522">(</span><span class="ident" id="5088523">line</span><span class="op" id="5088527">)</span>&nbsp;<span class="op" id="5088529">==</span>&nbsp;<span class="num" id="5088532">0</span>&nbsp;<span class="op" id="5088534">{</span>&nbsp;<span class="comment" id="5088536">//&nbsp;blank&nbsp;line&nbsp;-&nbsp;no&nbsp;continuation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088570">return</span>&nbsp;<span class="ident" id="5088577">line</span><span class="op" id="5088581">,</span>&nbsp;<span class="ident" id="5088583">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5088588">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088592">//&nbsp;Optimistically&nbsp;assume&nbsp;that&nbsp;we&nbsp;have&nbsp;started&nbsp;to&nbsp;buffer&nbsp;the&nbsp;next&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088663">//&nbsp;and&nbsp;it&nbsp;starts&nbsp;with&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;(the&nbsp;next&nbsp;header&nbsp;key),&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088735">//&nbsp;avoid&nbsp;copying&nbsp;that&nbsp;buffered&nbsp;data&nbsp;around&nbsp;in&nbsp;memory&nbsp;and&nbsp;skipping&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088807">//&nbsp;non-existent&nbsp;whitespace.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088836">if</span>&nbsp;<span class="ident" id="5088839">r</span><span class="op" id="5088840">.</span><span class="ident" id="5088841">R</span><span class="op" id="5088842">.</span><span class="ident" id="5088843">Buffered</span><span class="op" id="5088851">(</span><span class="op" id="5088852">)</span>&nbsp;<span class="op" id="5088854">&gt;</span>&nbsp;<span class="num" id="5088856">1</span>&nbsp;<span class="op" id="5088858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088862">peek</span><span class="op" id="5088866">,</span>&nbsp;<span class="ident" id="5088868">err</span>&nbsp;<span class="op" id="5088872">:=</span>&nbsp;<span class="ident" id="5088875">r</span><span class="op" id="5088876">.</span><span class="ident" id="5088877">R</span><span class="op" id="5088878">.</span><span class="ident" id="5088879">Peek</span><span class="op" id="5088883">(</span><span class="num" id="5088884">1</span><span class="op" id="5088885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088889">if</span>&nbsp;<span class="ident" id="5088892">err</span>&nbsp;<span class="op" id="5088896">==</span>&nbsp;<span class="ident" id="5088899">nil</span>&nbsp;<span class="op" id="5088903">&amp;&amp;</span>&nbsp;<span class="ident" id="5088906">isASCIILetter</span><span class="op" id="5088919">(</span><span class="ident" id="5088920">peek</span><span class="op" id="5088924">[</span><span class="num" id="5088925">0</span><span class="op" id="5088926">]</span><span class="op" id="5088927">)</span>&nbsp;<span class="op" id="5088929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5088934">return</span>&nbsp;<span class="ident" id="5088941">trim</span><span class="op" id="5088945">(</span><span class="ident" id="5088946">line</span><span class="op" id="5088950">)</span><span class="op" id="5088951">,</span>&nbsp;<span class="ident" id="5088953">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5088959">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5088962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088966">//&nbsp;ReadByte&nbsp;or&nbsp;the&nbsp;next&nbsp;readLineSlice&nbsp;will&nbsp;flush&nbsp;the&nbsp;read&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089033">//&nbsp;copy&nbsp;the&nbsp;slice&nbsp;into&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089062">r</span><span class="op" id="5089063">.</span><span class="ident" id="5089064">buf</span>&nbsp;<span class="op" id="5089068">=</span>&nbsp;<span class="builtinfunc" id="5089070">append</span><span class="op" id="5089076">(</span><span class="ident" id="5089077">r</span><span class="op" id="5089078">.</span><span class="ident" id="5089079">buf</span><span class="op" id="5089082">[</span><span class="op" id="5089083">:</span><span class="num" id="5089084">0</span><span class="op" id="5089085">]</span><span class="op" id="5089086">,</span>&nbsp;<span class="ident" id="5089088">trim</span><span class="op" id="5089092">(</span><span class="ident" id="5089093">line</span><span class="op" id="5089097">)</span><span class="op" id="5089098">...</span><span class="op" id="5089101">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089105">//&nbsp;Read&nbsp;continuation&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089134">for</span>&nbsp;<span class="ident" id="5089138">r</span><span class="op" id="5089139">.</span><span class="ident" id="5089140">skipSpace</span><span class="op" id="5089149">(</span><span class="op" id="5089150">)</span>&nbsp;<span class="op" id="5089152">&gt;</span>&nbsp;<span class="num" id="5089154">0</span>&nbsp;<span class="op" id="5089156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089160">line</span><span class="op" id="5089164">,</span>&nbsp;<span class="ident" id="5089166">err</span>&nbsp;<span class="op" id="5089170">:=</span>&nbsp;<span class="ident" id="5089173">r</span><span class="op" id="5089174">.</span><span class="ident" id="5089175">readLineSlice</span><span class="op" id="5089188">(</span><span class="op" id="5089189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089193">if</span>&nbsp;<span class="ident" id="5089196">err</span>&nbsp;<span class="op" id="5089200">!=</span>&nbsp;<span class="ident" id="5089203">nil</span>&nbsp;<span class="op" id="5089207">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089212">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5089220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089224">r</span><span class="op" id="5089225">.</span><span class="ident" id="5089226">buf</span>&nbsp;<span class="op" id="5089230">=</span>&nbsp;<span class="builtinfunc" id="5089232">append</span><span class="op" id="5089238">(</span><span class="ident" id="5089239">r</span><span class="op" id="5089240">.</span><span class="ident" id="5089241">buf</span><span class="op" id="5089244">,</span>&nbsp;<span class="string" id="5089246">&#39;&nbsp;&#39;</span><span class="op" id="5089249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089253">r</span><span class="op" id="5089254">.</span><span class="ident" id="5089255">buf</span>&nbsp;<span class="op" id="5089259">=</span>&nbsp;<span class="builtinfunc" id="5089261">append</span><span class="op" id="5089267">(</span><span class="ident" id="5089268">r</span><span class="op" id="5089269">.</span><span class="ident" id="5089270">buf</span><span class="op" id="5089273">,</span>&nbsp;<span class="ident" id="5089275">line</span><span class="op" id="5089279">...</span><span class="op" id="5089282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5089285">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089288">return</span>&nbsp;<span class="ident" id="5089295">r</span><span class="op" id="5089296">.</span><span class="ident" id="5089297">buf</span><span class="op" id="5089300">,</span>&nbsp;<span class="ident" id="5089302">nil</span><br>
<span class="lineno"></span><span class="op" id="5089306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5089309">//&nbsp;skipSpace&nbsp;skips&nbsp;R&nbsp;over&nbsp;all&nbsp;spaces&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="5089387">func</span>&nbsp;<span class="op" id="5089392">(</span><span class="ident" id="5089393">r</span>&nbsp;<span class="op" id="5089395">*</span><span class="ident" id="5089396">Reader</span><span class="op" id="5089402">)</span>&nbsp;<span class="ident" id="5089404">skipSpace</span><span class="op" id="5089413">(</span><span class="op" id="5089414">)</span>&nbsp;<span class="builtintype" id="5089416">int</span>&nbsp;<span class="op" id="5089420">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089423">n</span>&nbsp;<span class="op" id="5089425">:=</span>&nbsp;<span class="num" id="5089428">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089431">for</span>&nbsp;<span class="op" id="5089435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089439">c</span><span class="op" id="5089440">,</span>&nbsp;<span class="ident" id="5089442">err</span>&nbsp;<span class="op" id="5089446">:=</span>&nbsp;<span class="ident" id="5089449">r</span><span class="op" id="5089450">.</span><span class="ident" id="5089451">R</span><span class="op" id="5089452">.</span><span class="ident" id="5089453">ReadByte</span><span class="op" id="5089461">(</span><span class="op" id="5089462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089466">if</span>&nbsp;<span class="ident" id="5089469">err</span>&nbsp;<span class="op" id="5089473">!=</span>&nbsp;<span class="ident" id="5089476">nil</span>&nbsp;<span class="op" id="5089480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089485">//&nbsp;Bufio&nbsp;will&nbsp;keep&nbsp;err&nbsp;until&nbsp;next&nbsp;read.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089528">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5089536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089540">if</span>&nbsp;<span class="ident" id="5089543">c</span>&nbsp;<span class="op" id="5089545">!=</span>&nbsp;<span class="string" id="5089548">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5089552">&amp;&amp;</span>&nbsp;<span class="ident" id="5089555">c</span>&nbsp;<span class="op" id="5089557">!=</span>&nbsp;<span class="string" id="5089560">&#39;\t&#39;</span>&nbsp;<span class="op" id="5089565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089570">r</span><span class="op" id="5089571">.</span><span class="ident" id="5089572">R</span><span class="op" id="5089573">.</span><span class="ident" id="5089574">UnreadByte</span><span class="op" id="5089584">(</span><span class="op" id="5089585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089590">break</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5089598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089602">n</span><span class="op" id="5089603">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5089607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089610">return</span>&nbsp;<span class="ident" id="5089617">n</span><br>
<span class="lineno"></span><span class="op" id="5089619">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="keyword" id="5089622">func</span>&nbsp;<span class="op" id="5089627">(</span><span class="ident" id="5089628">r</span>&nbsp;<span class="op" id="5089630">*</span><span class="ident" id="5089631">Reader</span><span class="op" id="5089637">)</span>&nbsp;<span class="ident" id="5089639">readCodeLine</span><span class="op" id="5089651">(</span><span class="ident" id="5089652">expectCode</span>&nbsp;<span class="builtintype" id="5089663">int</span><span class="op" id="5089666">)</span>&nbsp;<span class="op" id="5089668">(</span><span class="ident" id="5089669">code</span>&nbsp;<span class="builtintype" id="5089674">int</span><span class="op" id="5089677">,</span>&nbsp;<span class="ident" id="5089679">continued</span>&nbsp;<span class="builtintype" id="5089689">bool</span><span class="op" id="5089693">,</span>&nbsp;<span class="ident" id="5089695">message</span>&nbsp;<span class="builtintype" id="5089703">string</span><span class="op" id="5089709">,</span>&nbsp;<span class="ident" id="5089711">err</span>&nbsp;<span class="builtintype" id="5089715">error</span><span class="op" id="5089720">)</span>&nbsp;<span class="op" id="5089722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089725">line</span><span class="op" id="5089729">,</span>&nbsp;<span class="ident" id="5089731">err</span>&nbsp;<span class="op" id="5089735">:=</span>&nbsp;<span class="ident" id="5089738">r</span><span class="op" id="5089739">.</span><span class="ident" id="5089740">ReadLine</span><span class="op" id="5089748">(</span><span class="op" id="5089749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089752">if</span>&nbsp;<span class="ident" id="5089755">err</span>&nbsp;<span class="op" id="5089759">!=</span>&nbsp;<span class="ident" id="5089762">nil</span>&nbsp;<span class="op" id="5089766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089770">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5089778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089781">return</span>&nbsp;<span class="ident" id="5089788">parseCodeLine</span><span class="op" id="5089801">(</span><span class="ident" id="5089802">line</span><span class="op" id="5089806">,</span>&nbsp;<span class="ident" id="5089808">expectCode</span><span class="op" id="5089818">)</span><br>
<span class="lineno"></span><span class="op" id="5089820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5089823">func</span>&nbsp;<span class="ident" id="5089828">parseCodeLine</span><span class="op" id="5089841">(</span><span class="ident" id="5089842">line</span>&nbsp;<span class="builtintype" id="5089847">string</span><span class="op" id="5089853">,</span>&nbsp;<span class="ident" id="5089855">expectCode</span>&nbsp;<span class="builtintype" id="5089866">int</span><span class="op" id="5089869">)</span>&nbsp;<span class="op" id="5089871">(</span><span class="ident" id="5089872">code</span>&nbsp;<span class="builtintype" id="5089877">int</span><span class="op" id="5089880">,</span>&nbsp;<span class="ident" id="5089882">continued</span>&nbsp;<span class="builtintype" id="5089892">bool</span><span class="op" id="5089896">,</span>&nbsp;<span class="ident" id="5089898">message</span>&nbsp;<span class="builtintype" id="5089906">string</span><span class="op" id="5089912">,</span>&nbsp;<span class="ident" id="5089914">err</span>&nbsp;<span class="builtintype" id="5089918">error</span><span class="op" id="5089923">)</span>&nbsp;<span class="op" id="5089925">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089928">if</span>&nbsp;<span class="builtinfunc" id="5089931">len</span><span class="op" id="5089934">(</span><span class="ident" id="5089935">line</span><span class="op" id="5089939">)</span>&nbsp;<span class="op" id="5089941">&lt;</span>&nbsp;<span class="num" id="5089943">4</span>&nbsp;<span class="op" id="5089945">||</span>&nbsp;<span class="ident" id="5089948">line</span><span class="op" id="5089952">[</span><span class="num" id="5089953">3</span><span class="op" id="5089954">]</span>&nbsp;<span class="op" id="5089956">!=</span>&nbsp;<span class="string" id="5089959">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5089963">&amp;&amp;</span>&nbsp;<span class="ident" id="5089966">line</span><span class="op" id="5089970">[</span><span class="num" id="5089971">3</span><span class="op" id="5089972">]</span>&nbsp;<span class="op" id="5089974">!=</span>&nbsp;<span class="string" id="5089977">&#39;-&#39;</span>&nbsp;<span class="op" id="5089981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089985">err</span>&nbsp;<span class="op" id="5089989">=</span>&nbsp;<span class="ident" id="5089991">ProtocolError</span><span class="op" id="5090004">(</span><span class="string" id="5090005">&#34;short&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="5090024">+</span>&nbsp;<span class="ident" id="5090026">line</span><span class="op" id="5090030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090034">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090045">continued</span>&nbsp;<span class="op" id="5090055">=</span>&nbsp;<span class="ident" id="5090057">line</span><span class="op" id="5090061">[</span><span class="num" id="5090062">3</span><span class="op" id="5090063">]</span>&nbsp;<span class="op" id="5090065">==</span>&nbsp;<span class="string" id="5090068">&#39;-&#39;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090073">code</span><span class="op" id="5090077">,</span>&nbsp;<span class="ident" id="5090079">err</span>&nbsp;<span class="op" id="5090083">=</span>&nbsp;<span class="ident" id="5090085">strconv</span><span class="op" id="5090092">.</span><span class="ident" id="5090093">Atoi</span><span class="op" id="5090097">(</span><span class="ident" id="5090098">line</span><span class="op" id="5090102">[</span><span class="num" id="5090103">0</span><span class="op" id="5090104">:</span><span class="num" id="5090105">3</span><span class="op" id="5090106">]</span><span class="op" id="5090107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090110">if</span>&nbsp;<span class="ident" id="5090113">err</span>&nbsp;<span class="op" id="5090117">!=</span>&nbsp;<span class="ident" id="5090120">nil</span>&nbsp;<span class="op" id="5090124">||</span>&nbsp;<span class="ident" id="5090127">code</span>&nbsp;<span class="op" id="5090132">&lt;</span>&nbsp;<span class="num" id="5090134">100</span>&nbsp;<span class="op" id="5090138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090142">err</span>&nbsp;<span class="op" id="5090146">=</span>&nbsp;<span class="ident" id="5090148">ProtocolError</span><span class="op" id="5090161">(</span><span class="string" id="5090162">&#34;invalid&nbsp;response&nbsp;code:&nbsp;&#34;</span>&nbsp;<span class="op" id="5090188">+</span>&nbsp;<span class="ident" id="5090190">line</span><span class="op" id="5090194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090198">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090206">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090209">message</span>&nbsp;<span class="op" id="5090217">=</span>&nbsp;<span class="ident" id="5090219">line</span><span class="op" id="5090223">[</span><span class="num" id="5090224">4</span><span class="op" id="5090225">:</span><span class="op" id="5090226">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090229">if</span>&nbsp;<span class="num" id="5090232">1</span>&nbsp;<span class="op" id="5090234">&lt;=</span>&nbsp;<span class="ident" id="5090237">expectCode</span>&nbsp;<span class="op" id="5090248">&amp;&amp;</span>&nbsp;<span class="ident" id="5090251">expectCode</span>&nbsp;<span class="op" id="5090262">&lt;</span>&nbsp;<span class="num" id="5090264">10</span>&nbsp;<span class="op" id="5090267">&amp;&amp;</span>&nbsp;<span class="ident" id="5090270">code</span><span class="op" id="5090274">/</span><span class="num" id="5090275">100</span>&nbsp;<span class="op" id="5090279">!=</span>&nbsp;<span class="ident" id="5090282">expectCode</span>&nbsp;<span class="op" id="5090293">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5090298">10</span>&nbsp;<span class="op" id="5090301">&lt;=</span>&nbsp;<span class="ident" id="5090304">expectCode</span>&nbsp;<span class="op" id="5090315">&amp;&amp;</span>&nbsp;<span class="ident" id="5090318">expectCode</span>&nbsp;<span class="op" id="5090329">&lt;</span>&nbsp;<span class="num" id="5090331">100</span>&nbsp;<span class="op" id="5090335">&amp;&amp;</span>&nbsp;<span class="ident" id="5090338">code</span><span class="op" id="5090342">/</span><span class="num" id="5090343">10</span>&nbsp;<span class="op" id="5090346">!=</span>&nbsp;<span class="ident" id="5090349">expectCode</span>&nbsp;<span class="op" id="5090360">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5090365">100</span>&nbsp;<span class="op" id="5090369">&lt;=</span>&nbsp;<span class="ident" id="5090372">expectCode</span>&nbsp;<span class="op" id="5090383">&amp;&amp;</span>&nbsp;<span class="ident" id="5090386">expectCode</span>&nbsp;<span class="op" id="5090397">&lt;</span>&nbsp;<span class="num" id="5090399">1000</span>&nbsp;<span class="op" id="5090404">&amp;&amp;</span>&nbsp;<span class="ident" id="5090407">code</span>&nbsp;<span class="op" id="5090412">!=</span>&nbsp;<span class="ident" id="5090415">expectCode</span>&nbsp;<span class="op" id="5090426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090430">err</span>&nbsp;<span class="op" id="5090434">=</span>&nbsp;<span class="op" id="5090436">&amp;</span><span class="ident" id="5090437">Error</span><span class="op" id="5090442">{</span><span class="ident" id="5090443">code</span><span class="op" id="5090447">,</span>&nbsp;<span class="ident" id="5090449">message</span><span class="op" id="5090456">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090462">return</span><br>
<span class="lineno"></span><span class="op" id="5090469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5090472">//&nbsp;ReadCodeLine&nbsp;reads&nbsp;a&nbsp;response&nbsp;code&nbsp;line&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno">205</span><span class="comment" id="5090527">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="5090543">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code&nbsp;and&nbsp;the&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="5090602">//&nbsp;extends&nbsp;to&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;line.&nbsp;&nbsp;An&nbsp;example&nbsp;of&nbsp;such&nbsp;a&nbsp;line&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="5090669">//&nbsp;&nbsp;&nbsp;&nbsp220&nbsp;plan9.bell-labs.com&nbsp;ESMTP</span><br>
<span class="lineno"></span><span class="comment" id="5090702">//</span><br>
<span class="lineno">210</span><span class="comment" id="5090705">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="5090777">//&nbsp;ReadCodeLine&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="5090840">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5090906">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="5090951">//</span><br>
<span class="lineno">215</span><span class="comment" id="5090954">//&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;multi-line,&nbsp;ReadCodeLine&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="5091019">//</span><br>
<span class="lineno"></span><span class="comment" id="5091022">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="5091083">//</span><br>
<span class="lineno"></span><span class="keyword" id="5091086">func</span>&nbsp;<span class="op" id="5091091">(</span><span class="ident" id="5091092">r</span>&nbsp;<span class="op" id="5091094">*</span><span class="ident" id="5091095">Reader</span><span class="op" id="5091101">)</span>&nbsp;<span class="ident" id="5091103">ReadCodeLine</span><span class="op" id="5091115">(</span><span class="ident" id="5091116">expectCode</span>&nbsp;<span class="builtintype" id="5091127">int</span><span class="op" id="5091130">)</span>&nbsp;<span class="op" id="5091132">(</span><span class="ident" id="5091133">code</span>&nbsp;<span class="builtintype" id="5091138">int</span><span class="op" id="5091141">,</span>&nbsp;<span class="ident" id="5091143">message</span>&nbsp;<span class="builtintype" id="5091151">string</span><span class="op" id="5091157">,</span>&nbsp;<span class="ident" id="5091159">err</span>&nbsp;<span class="builtintype" id="5091163">error</span><span class="op" id="5091168">)</span>&nbsp;<span class="op" id="5091170">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091173">code</span><span class="op" id="5091177">,</span>&nbsp;<span class="ident" id="5091179">continued</span><span class="op" id="5091188">,</span>&nbsp;<span class="ident" id="5091190">message</span><span class="op" id="5091197">,</span>&nbsp;<span class="ident" id="5091199">err</span>&nbsp;<span class="op" id="5091203">:=</span>&nbsp;<span class="ident" id="5091206">r</span><span class="op" id="5091207">.</span><span class="ident" id="5091208">readCodeLine</span><span class="op" id="5091220">(</span><span class="ident" id="5091221">expectCode</span><span class="op" id="5091231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091234">if</span>&nbsp;<span class="ident" id="5091237">err</span>&nbsp;<span class="op" id="5091241">==</span>&nbsp;<span class="ident" id="5091244">nil</span>&nbsp;<span class="op" id="5091248">&amp;&amp;</span>&nbsp;<span class="ident" id="5091251">continued</span>&nbsp;<span class="op" id="5091261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091265">err</span>&nbsp;<span class="op" id="5091269">=</span>&nbsp;<span class="ident" id="5091271">ProtocolError</span><span class="op" id="5091284">(</span><span class="string" id="5091285">&#34;unexpected&nbsp;multi-line&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="5091320">+</span>&nbsp;<span class="ident" id="5091322">message</span><span class="op" id="5091329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5091332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091335">return</span><br>
<span class="lineno">225</span><span class="op" id="5091342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5091345">//&nbsp;ReadResponse&nbsp;reads&nbsp;a&nbsp;multi-line&nbsp;response&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="5091402">//</span><br>
<span class="lineno"></span><span class="comment" id="5091405">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;1</span><br>
<span class="lineno">230</span><span class="comment" id="5091428">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="5091451">//&nbsp;&nbsp;&nbsp;&nbsp...</span><br>
<span class="lineno"></span><span class="comment" id="5091458">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message&nbsp;line&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="5091481">//</span><br>
<span class="lineno"></span><span class="comment" id="5091484">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code.&nbsp;The&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;the</span><br>
<span class="lineno">235</span><span class="comment" id="5091559">//&nbsp;code&nbsp;and&nbsp;a&nbsp;hyphen.&nbsp;The&nbsp;response&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;line&nbsp;that&nbsp;starts</span><br>
<span class="lineno"></span><span class="comment" id="5091630">//&nbsp;with&nbsp;the&nbsp;same&nbsp;code&nbsp;followed&nbsp;by&nbsp;a&nbsp;space.&nbsp;Each&nbsp;line&nbsp;in&nbsp;message&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5091697">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;newline&nbsp;(\n).</span><br>
<span class="lineno"></span><span class="comment" id="5091729">//</span><br>
<span class="lineno"></span><span class="comment" id="5091732">//&nbsp;See&nbsp;page&nbsp;36&nbsp;of&nbsp;RFC&nbsp;959&nbsp;(http://www.ietf.org/rfc/rfc959.txt)&nbsp;for</span><br>
<span class="lineno">240</span><span class="comment" id="5091799">//&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="5091811">//</span><br>
<span class="lineno"></span><span class="comment" id="5091814">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="5091886">//&nbsp;ReadResponse&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="5091949">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno">245</span><span class="comment" id="5092015">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="5092060">//</span><br>
<span class="lineno"></span><span class="comment" id="5092063">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="5092124">//</span><br>
<span class="lineno"></span><span class="keyword" id="5092127">func</span>&nbsp;<span class="op" id="5092132">(</span><span class="ident" id="5092133">r</span>&nbsp;<span class="op" id="5092135">*</span><span class="ident" id="5092136">Reader</span><span class="op" id="5092142">)</span>&nbsp;<span class="ident" id="5092144">ReadResponse</span><span class="op" id="5092156">(</span><span class="ident" id="5092157">expectCode</span>&nbsp;<span class="builtintype" id="5092168">int</span><span class="op" id="5092171">)</span>&nbsp;<span class="op" id="5092173">(</span><span class="ident" id="5092174">code</span>&nbsp;<span class="builtintype" id="5092179">int</span><span class="op" id="5092182">,</span>&nbsp;<span class="ident" id="5092184">message</span>&nbsp;<span class="builtintype" id="5092192">string</span><span class="op" id="5092198">,</span>&nbsp;<span class="ident" id="5092200">err</span>&nbsp;<span class="builtintype" id="5092204">error</span><span class="op" id="5092209">)</span>&nbsp;<span class="op" id="5092211">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092214">code</span><span class="op" id="5092218">,</span>&nbsp;<span class="ident" id="5092220">continued</span><span class="op" id="5092229">,</span>&nbsp;<span class="ident" id="5092231">message</span><span class="op" id="5092238">,</span>&nbsp;<span class="ident" id="5092240">err</span>&nbsp;<span class="op" id="5092244">:=</span>&nbsp;<span class="ident" id="5092247">r</span><span class="op" id="5092248">.</span><span class="ident" id="5092249">readCodeLine</span><span class="op" id="5092261">(</span><span class="ident" id="5092262">expectCode</span><span class="op" id="5092272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092275">for</span>&nbsp;<span class="ident" id="5092279">err</span>&nbsp;<span class="op" id="5092283">==</span>&nbsp;<span class="ident" id="5092286">nil</span>&nbsp;<span class="op" id="5092290">&amp;&amp;</span>&nbsp;<span class="ident" id="5092293">continued</span>&nbsp;<span class="op" id="5092303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092307">line</span><span class="op" id="5092311">,</span>&nbsp;<span class="ident" id="5092313">err</span>&nbsp;<span class="op" id="5092317">:=</span>&nbsp;<span class="ident" id="5092320">r</span><span class="op" id="5092321">.</span><span class="ident" id="5092322">ReadLine</span><span class="op" id="5092330">(</span><span class="op" id="5092331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092335">if</span>&nbsp;<span class="ident" id="5092338">err</span>&nbsp;<span class="op" id="5092342">!=</span>&nbsp;<span class="ident" id="5092345">nil</span>&nbsp;<span class="op" id="5092349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092354">return</span>&nbsp;<span class="num" id="5092361">0</span><span class="op" id="5092362">,</span>&nbsp;<span class="string" id="5092364">&#34;&#34;</span><span class="op" id="5092366">,</span>&nbsp;<span class="ident" id="5092368">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092379">var</span>&nbsp;<span class="ident" id="5092383">code2</span>&nbsp;<span class="builtintype" id="5092389">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092395">var</span>&nbsp;<span class="ident" id="5092399">moreMessage</span>&nbsp;<span class="builtintype" id="5092411">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092420">code2</span><span class="op" id="5092425">,</span>&nbsp;<span class="ident" id="5092427">continued</span><span class="op" id="5092436">,</span>&nbsp;<span class="ident" id="5092438">moreMessage</span><span class="op" id="5092449">,</span>&nbsp;<span class="ident" id="5092451">err</span>&nbsp;<span class="op" id="5092455">=</span>&nbsp;<span class="ident" id="5092457">parseCodeLine</span><span class="op" id="5092470">(</span><span class="ident" id="5092471">line</span><span class="op" id="5092475">,</span>&nbsp;<span class="ident" id="5092477">expectCode</span><span class="op" id="5092487">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092491">if</span>&nbsp;<span class="ident" id="5092494">err</span>&nbsp;<span class="op" id="5092498">!=</span>&nbsp;<span class="ident" id="5092501">nil</span>&nbsp;<span class="op" id="5092505">||</span>&nbsp;<span class="ident" id="5092508">code2</span>&nbsp;<span class="op" id="5092514">!=</span>&nbsp;<span class="ident" id="5092517">code</span>&nbsp;<span class="op" id="5092522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092527">message</span>&nbsp;<span class="op" id="5092535">+=</span>&nbsp;<span class="string" id="5092538">&#34;\n&#34;</span>&nbsp;<span class="op" id="5092543">+</span>&nbsp;<span class="ident" id="5092545">strings</span><span class="op" id="5092552">.</span><span class="ident" id="5092553">TrimRight</span><span class="op" id="5092562">(</span><span class="ident" id="5092563">line</span><span class="op" id="5092567">,</span>&nbsp;<span class="string" id="5092569">&#34;\r\n&#34;</span><span class="op" id="5092575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092580">continued</span>&nbsp;<span class="op" id="5092590">=</span>&nbsp;<span class="builtintype" id="5092592">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092600">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092611">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092615">message</span>&nbsp;<span class="op" id="5092623">+=</span>&nbsp;<span class="string" id="5092626">&#34;\n&#34;</span>&nbsp;<span class="op" id="5092631">+</span>&nbsp;<span class="ident" id="5092633">moreMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092649">return</span><br>
<span class="lineno"></span><span class="op" id="5092656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5092659">//&nbsp;DotReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;that&nbsp;satisfies&nbsp;Reads&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5092724">//&nbsp;decoded&nbsp;text&nbsp;of&nbsp;a&nbsp;dot-encoded&nbsp;block&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5092776">//&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="5092833">//&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5092854">//</span><br>
<span class="lineno">275</span><span class="comment" id="5092857">//&nbsp;Dot&nbsp;encoding&nbsp;is&nbsp;a&nbsp;common&nbsp;framing&nbsp;used&nbsp;for&nbsp;data&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="5092914">//&nbsp;in&nbsp;text&nbsp;protocols&nbsp;such&nbsp;as&nbsp;SMTP.&nbsp;&nbsp;The&nbsp;data&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="5092982">//&nbsp;of&nbsp;lines,&nbsp;each&nbsp;of&nbsp;which&nbsp;ends&nbsp;in&nbsp;&#34;\r\n&#34;.&nbsp;&nbsp;The&nbsp;sequence&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="5093046">//&nbsp;ends&nbsp;at&nbsp;a&nbsp;line&nbsp;containing&nbsp;just&nbsp;a&nbsp;dot:&nbsp;&#34;.\r\n&#34;.&nbsp;&nbsp;Lines&nbsp;beginning</span><br>
<span class="lineno"></span><span class="comment" id="5093113">//&nbsp;with&nbsp;a&nbsp;dot&nbsp;are&nbsp;escaped&nbsp;with&nbsp;an&nbsp;additional&nbsp;dot&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">280</span><span class="comment" id="5093171">//&nbsp;looking&nbsp;like&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="5093212">//</span><br>
<span class="lineno"></span><span class="comment" id="5093215">//&nbsp;The&nbsp;decoded&nbsp;form&nbsp;returned&nbsp;by&nbsp;the&nbsp;Reader&#39;s&nbsp;Read&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="5093272">//&nbsp;rewrites&nbsp;the&nbsp;&#34;\r\n&#34;&nbsp;line&nbsp;endings&nbsp;into&nbsp;the&nbsp;simpler&nbsp;&#34;\n&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5093331">//&nbsp;removes&nbsp;leading&nbsp;dot&nbsp;escapes&nbsp;if&nbsp;present,&nbsp;and&nbsp;stops&nbsp;with&nbsp;error&nbsp;io.EOF</span><br>
<span class="lineno">285</span><span class="comment" id="5093402">//&nbsp;after&nbsp;consuming&nbsp;(and&nbsp;discarding)&nbsp;the&nbsp;end-of-sequence&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="5093464">func</span>&nbsp;<span class="op" id="5093469">(</span><span class="ident" id="5093470">r</span>&nbsp;<span class="op" id="5093472">*</span><span class="ident" id="5093473">Reader</span><span class="op" id="5093479">)</span>&nbsp;<span class="ident" id="5093481">DotReader</span><span class="op" id="5093490">(</span><span class="op" id="5093491">)</span>&nbsp;<span class="ident" id="5093493">io</span><span class="op" id="5093495">.</span><span class="ident" id="5093496">Reader</span>&nbsp;<span class="op" id="5093503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093506">r</span><span class="op" id="5093507">.</span><span class="ident" id="5093508">closeDot</span><span class="op" id="5093516">(</span><span class="op" id="5093517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093520">r</span><span class="op" id="5093521">.</span><span class="ident" id="5093522">dot</span>&nbsp;<span class="op" id="5093526">=</span>&nbsp;<span class="op" id="5093528">&amp;</span><span class="ident" id="5093529">dotReader</span><span class="op" id="5093538">{</span><span class="ident" id="5093539">r</span><span class="op" id="5093540">:</span>&nbsp;<span class="ident" id="5093542">r</span><span class="op" id="5093543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093546">return</span>&nbsp;<span class="ident" id="5093553">r</span><span class="op" id="5093554">.</span><span class="ident" id="5093555">dot</span><br>
<span class="lineno">290</span><span class="op" id="5093559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5093562">type</span>&nbsp;<span class="ident" id="5093567">dotReader</span>&nbsp;<span class="keyword" id="5093577">struct</span>&nbsp;<span class="op" id="5093584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093587">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093593">*</span><span class="ident" id="5093594">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093602">state</span>&nbsp;<span class="builtintype" id="5093608">int</span><br>
<span class="lineno">295</span><span class="op" id="5093612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5093615">//&nbsp;Read&nbsp;satisfies&nbsp;reads&nbsp;by&nbsp;decoding&nbsp;dot-encoded&nbsp;data&nbsp;read&nbsp;from&nbsp;d.r.</span><br>
<span class="lineno"></span><span class="keyword" id="5093683">func</span>&nbsp;<span class="op" id="5093688">(</span><span class="ident" id="5093689">d</span>&nbsp;<span class="op" id="5093691">*</span><span class="ident" id="5093692">dotReader</span><span class="op" id="5093701">)</span>&nbsp;<span class="ident" id="5093703">Read</span><span class="op" id="5093707">(</span><span class="ident" id="5093708">b</span>&nbsp;<span class="op" id="5093710">[</span><span class="op" id="5093711">]</span><span class="builtintype" id="5093712">byte</span><span class="op" id="5093716">)</span>&nbsp;<span class="op" id="5093718">(</span><span class="ident" id="5093719">n</span>&nbsp;<span class="builtintype" id="5093721">int</span><span class="op" id="5093724">,</span>&nbsp;<span class="ident" id="5093726">err</span>&nbsp;<span class="builtintype" id="5093730">error</span><span class="op" id="5093735">)</span>&nbsp;<span class="op" id="5093737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093740">//&nbsp;Run&nbsp;data&nbsp;through&nbsp;a&nbsp;simple&nbsp;state&nbsp;machine&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093787">//&nbsp;elide&nbsp;leading&nbsp;dots,&nbsp;rewrite&nbsp;trailing&nbsp;\r\n&nbsp;into&nbsp;\n,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093842">//&nbsp;and&nbsp;detect&nbsp;ending&nbsp;.\r\n&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093876">const</span>&nbsp;<span class="op" id="5093882">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093886">stateBeginLine</span>&nbsp;<span class="op" id="5093901">=</span>&nbsp;<span class="ident" id="5093903">iota</span>&nbsp;<span class="comment" id="5093908">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093960">stateDot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5093982">//&nbsp;read&nbsp;.&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094015">stateDotCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5094037">//&nbsp;read&nbsp;.\r&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094072">stateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5094094">//&nbsp;read&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094133">stateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5094155">//&nbsp;reading&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094191">stateEOF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5094213">//&nbsp;reached&nbsp;.\r\n&nbsp;end&nbsp;marker&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094247">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094250">br</span>&nbsp;<span class="op" id="5094253">:=</span>&nbsp;<span class="ident" id="5094256">d</span><span class="op" id="5094257">.</span><span class="ident" id="5094258">r</span><span class="op" id="5094259">.</span><span class="ident" id="5094260">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094263">for</span>&nbsp;<span class="ident" id="5094267">n</span>&nbsp;<span class="op" id="5094269">&lt;</span>&nbsp;<span class="builtinfunc" id="5094271">len</span><span class="op" id="5094274">(</span><span class="ident" id="5094275">b</span><span class="op" id="5094276">)</span>&nbsp;<span class="op" id="5094278">&amp;&amp;</span>&nbsp;<span class="ident" id="5094281">d</span><span class="op" id="5094282">.</span><span class="ident" id="5094283">state</span>&nbsp;<span class="op" id="5094289">!=</span>&nbsp;<span class="ident" id="5094292">stateEOF</span>&nbsp;<span class="op" id="5094301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094305">var</span>&nbsp;<span class="ident" id="5094309">c</span>&nbsp;<span class="builtintype" id="5094311">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094318">c</span><span class="op" id="5094319">,</span>&nbsp;<span class="ident" id="5094321">err</span>&nbsp;<span class="op" id="5094325">=</span>&nbsp;<span class="ident" id="5094327">br</span><span class="op" id="5094329">.</span><span class="ident" id="5094330">ReadByte</span><span class="op" id="5094338">(</span><span class="op" id="5094339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094343">if</span>&nbsp;<span class="ident" id="5094346">err</span>&nbsp;<span class="op" id="5094350">!=</span>&nbsp;<span class="ident" id="5094353">nil</span>&nbsp;<span class="op" id="5094357">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094362">if</span>&nbsp;<span class="ident" id="5094365">err</span>&nbsp;<span class="op" id="5094369">==</span>&nbsp;<span class="ident" id="5094372">io</span><span class="op" id="5094374">.</span><span class="ident" id="5094375">EOF</span>&nbsp;<span class="op" id="5094379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094385">err</span>&nbsp;<span class="op" id="5094389">=</span>&nbsp;<span class="ident" id="5094391">io</span><span class="op" id="5094393">.</span><span class="ident" id="5094394">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094419">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094427">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094431">switch</span>&nbsp;<span class="ident" id="5094438">d</span><span class="op" id="5094439">.</span><span class="ident" id="5094440">state</span>&nbsp;<span class="op" id="5094446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094450">case</span>&nbsp;<span class="ident" id="5094455">stateBeginLine</span><span class="op" id="5094469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094474">if</span>&nbsp;<span class="ident" id="5094477">c</span>&nbsp;<span class="op" id="5094479">==</span>&nbsp;<span class="string" id="5094482">&#39;.&#39;</span>&nbsp;<span class="op" id="5094486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094492">d</span><span class="op" id="5094493">.</span><span class="ident" id="5094494">state</span>&nbsp;<span class="op" id="5094500">=</span>&nbsp;<span class="ident" id="5094502">stateDot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094515">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094532">if</span>&nbsp;<span class="ident" id="5094535">c</span>&nbsp;<span class="op" id="5094537">==</span>&nbsp;<span class="string" id="5094540">&#39;\r&#39;</span>&nbsp;<span class="op" id="5094545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094551">d</span><span class="op" id="5094552">.</span><span class="ident" id="5094553">state</span>&nbsp;<span class="op" id="5094559">=</span>&nbsp;<span class="ident" id="5094561">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094573">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094585">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094590">d</span><span class="op" id="5094591">.</span><span class="ident" id="5094592">state</span>&nbsp;<span class="op" id="5094598">=</span>&nbsp;<span class="ident" id="5094600">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094613">case</span>&nbsp;<span class="ident" id="5094618">stateDot</span><span class="op" id="5094626">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094631">if</span>&nbsp;<span class="ident" id="5094634">c</span>&nbsp;<span class="op" id="5094636">==</span>&nbsp;<span class="string" id="5094639">&#39;\r&#39;</span>&nbsp;<span class="op" id="5094644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094650">d</span><span class="op" id="5094651">.</span><span class="ident" id="5094652">state</span>&nbsp;<span class="op" id="5094658">=</span>&nbsp;<span class="ident" id="5094660">stateDotCR</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094675">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094692">if</span>&nbsp;<span class="ident" id="5094695">c</span>&nbsp;<span class="op" id="5094697">==</span>&nbsp;<span class="string" id="5094700">&#39;\n&#39;</span>&nbsp;<span class="op" id="5094705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094711">d</span><span class="op" id="5094712">.</span><span class="ident" id="5094713">state</span>&nbsp;<span class="op" id="5094719">=</span>&nbsp;<span class="ident" id="5094721">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094734">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094751">d</span><span class="op" id="5094752">.</span><span class="ident" id="5094753">state</span>&nbsp;<span class="op" id="5094759">=</span>&nbsp;<span class="ident" id="5094761">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094774">case</span>&nbsp;<span class="ident" id="5094779">stateDotCR</span><span class="op" id="5094789">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094794">if</span>&nbsp;<span class="ident" id="5094797">c</span>&nbsp;<span class="op" id="5094799">==</span>&nbsp;<span class="string" id="5094802">&#39;\n&#39;</span>&nbsp;<span class="op" id="5094807">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094813">d</span><span class="op" id="5094814">.</span><span class="ident" id="5094815">state</span>&nbsp;<span class="op" id="5094821">=</span>&nbsp;<span class="ident" id="5094823">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094836">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094853">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;.\r\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094878">//&nbsp;Consume&nbsp;leading&nbsp;dot&nbsp;and&nbsp;emit&nbsp;saved&nbsp;\r.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094923">br</span><span class="op" id="5094925">.</span><span class="ident" id="5094926">UnreadByte</span><span class="op" id="5094936">(</span><span class="op" id="5094937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094942">c</span>&nbsp;<span class="op" id="5094944">=</span>&nbsp;<span class="string" id="5094946">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094954">d</span><span class="op" id="5094955">.</span><span class="ident" id="5094956">state</span>&nbsp;<span class="op" id="5094962">=</span>&nbsp;<span class="ident" id="5094964">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094977">case</span>&nbsp;<span class="ident" id="5094982">stateCR</span><span class="op" id="5094989">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094994">if</span>&nbsp;<span class="ident" id="5094997">c</span>&nbsp;<span class="op" id="5094999">==</span>&nbsp;<span class="string" id="5095002">&#39;\n&#39;</span>&nbsp;<span class="op" id="5095007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095013">d</span><span class="op" id="5095014">.</span><span class="ident" id="5095015">state</span>&nbsp;<span class="op" id="5095021">=</span>&nbsp;<span class="ident" id="5095023">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095042">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5095056">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;\r\n.&nbsp;&nbsp;Emit&nbsp;saved&nbsp;\r</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095095">br</span><span class="op" id="5095097">.</span><span class="ident" id="5095098">UnreadByte</span><span class="op" id="5095108">(</span><span class="op" id="5095109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095114">c</span>&nbsp;<span class="op" id="5095116">=</span>&nbsp;<span class="string" id="5095118">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095126">d</span><span class="op" id="5095127">.</span><span class="ident" id="5095128">state</span>&nbsp;<span class="op" id="5095134">=</span>&nbsp;<span class="ident" id="5095136">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095149">case</span>&nbsp;<span class="ident" id="5095154">stateData</span><span class="op" id="5095163">:</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095168">if</span>&nbsp;<span class="ident" id="5095171">c</span>&nbsp;<span class="op" id="5095173">==</span>&nbsp;<span class="string" id="5095176">&#39;\r&#39;</span>&nbsp;<span class="op" id="5095181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095187">d</span><span class="op" id="5095188">.</span><span class="ident" id="5095189">state</span>&nbsp;<span class="op" id="5095195">=</span>&nbsp;<span class="ident" id="5095197">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095209">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095226">if</span>&nbsp;<span class="ident" id="5095229">c</span>&nbsp;<span class="op" id="5095231">==</span>&nbsp;<span class="string" id="5095234">&#39;\n&#39;</span>&nbsp;<span class="op" id="5095239">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095245">d</span><span class="op" id="5095246">.</span><span class="ident" id="5095247">state</span>&nbsp;<span class="op" id="5095253">=</span>&nbsp;<span class="ident" id="5095255">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095281">b</span><span class="op" id="5095282">[</span><span class="ident" id="5095283">n</span><span class="op" id="5095284">]</span>&nbsp;<span class="op" id="5095286">=</span>&nbsp;<span class="ident" id="5095288">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095292">n</span><span class="op" id="5095293">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095300">if</span>&nbsp;<span class="ident" id="5095303">err</span>&nbsp;<span class="op" id="5095307">==</span>&nbsp;<span class="ident" id="5095310">nil</span>&nbsp;<span class="op" id="5095314">&amp;&amp;</span>&nbsp;<span class="ident" id="5095317">d</span><span class="op" id="5095318">.</span><span class="ident" id="5095319">state</span>&nbsp;<span class="op" id="5095325">==</span>&nbsp;<span class="ident" id="5095328">stateEOF</span>&nbsp;<span class="op" id="5095337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095341">err</span>&nbsp;<span class="op" id="5095345">=</span>&nbsp;<span class="ident" id="5095347">io</span><span class="op" id="5095349">.</span><span class="ident" id="5095350">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095358">if</span>&nbsp;<span class="ident" id="5095361">err</span>&nbsp;<span class="op" id="5095365">!=</span>&nbsp;<span class="ident" id="5095368">nil</span>&nbsp;<span class="op" id="5095372">&amp;&amp;</span>&nbsp;<span class="ident" id="5095375">d</span><span class="op" id="5095376">.</span><span class="ident" id="5095377">r</span><span class="op" id="5095378">.</span><span class="ident" id="5095379">dot</span>&nbsp;<span class="op" id="5095383">==</span>&nbsp;<span class="ident" id="5095386">d</span>&nbsp;<span class="op" id="5095388">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095392">d</span><span class="op" id="5095393">.</span><span class="ident" id="5095394">r</span><span class="op" id="5095395">.</span><span class="ident" id="5095396">dot</span>&nbsp;<span class="op" id="5095400">=</span>&nbsp;<span class="ident" id="5095402">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095410">return</span><br>
<span class="lineno"></span><span class="op" id="5095417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="5095420">//&nbsp;closeDot&nbsp;drains&nbsp;the&nbsp;current&nbsp;DotReader&nbsp;if&nbsp;any,</span><br>
<span class="lineno"></span><span class="comment" id="5095469">//&nbsp;making&nbsp;sure&nbsp;that&nbsp;it&nbsp;reads&nbsp;until&nbsp;the&nbsp;ending&nbsp;dot&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="5095525">func</span>&nbsp;<span class="op" id="5095530">(</span><span class="ident" id="5095531">r</span>&nbsp;<span class="op" id="5095533">*</span><span class="ident" id="5095534">Reader</span><span class="op" id="5095540">)</span>&nbsp;<span class="ident" id="5095542">closeDot</span><span class="op" id="5095550">(</span><span class="op" id="5095551">)</span>&nbsp;<span class="op" id="5095553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095556">if</span>&nbsp;<span class="ident" id="5095559">r</span><span class="op" id="5095560">.</span><span class="ident" id="5095561">dot</span>&nbsp;<span class="op" id="5095565">==</span>&nbsp;<span class="ident" id="5095568">nil</span>&nbsp;<span class="op" id="5095572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095576">return</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095587">buf</span>&nbsp;<span class="op" id="5095591">:=</span>&nbsp;<span class="builtinfunc" id="5095594">make</span><span class="op" id="5095598">(</span><span class="op" id="5095599">[</span><span class="op" id="5095600">]</span><span class="builtintype" id="5095601">byte</span><span class="op" id="5095605">,</span>&nbsp;<span class="num" id="5095607">128</span><span class="op" id="5095610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095613">for</span>&nbsp;<span class="ident" id="5095617">r</span><span class="op" id="5095618">.</span><span class="ident" id="5095619">dot</span>&nbsp;<span class="op" id="5095623">!=</span>&nbsp;<span class="ident" id="5095626">nil</span>&nbsp;<span class="op" id="5095630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5095634">//&nbsp;When&nbsp;Read&nbsp;reaches&nbsp;EOF&nbsp;or&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5095674">//&nbsp;it&nbsp;will&nbsp;set&nbsp;r.dot&nbsp;==&nbsp;nil.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095705">r</span><span class="op" id="5095706">.</span><span class="ident" id="5095707">dot</span><span class="op" id="5095710">.</span><span class="ident" id="5095711">Read</span><span class="op" id="5095715">(</span><span class="ident" id="5095716">buf</span><span class="op" id="5095719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095722">}</span><br>
<span class="lineno"></span><span class="op" id="5095724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5095727">//&nbsp;ReadDotBytes&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;the&nbsp;decoded&nbsp;data.</span><br>
<span class="lineno">400</span><span class="comment" id="5095794">//</span><br>
<span class="lineno"></span><span class="comment" id="5095797">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5095879">func</span>&nbsp;<span class="op" id="5095884">(</span><span class="ident" id="5095885">r</span>&nbsp;<span class="op" id="5095887">*</span><span class="ident" id="5095888">Reader</span><span class="op" id="5095894">)</span>&nbsp;<span class="ident" id="5095896">ReadDotBytes</span><span class="op" id="5095908">(</span><span class="op" id="5095909">)</span>&nbsp;<span class="op" id="5095911">(</span><span class="op" id="5095912">[</span><span class="op" id="5095913">]</span><span class="builtintype" id="5095914">byte</span><span class="op" id="5095918">,</span>&nbsp;<span class="builtintype" id="5095920">error</span><span class="op" id="5095925">)</span>&nbsp;<span class="op" id="5095927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095930">return</span>&nbsp;<span class="ident" id="5095937">ioutil</span><span class="op" id="5095943">.</span><span class="ident" id="5095944">ReadAll</span><span class="op" id="5095951">(</span><span class="ident" id="5095952">r</span><span class="op" id="5095953">.</span><span class="ident" id="5095954">DotReader</span><span class="op" id="5095963">(</span><span class="op" id="5095964">)</span><span class="op" id="5095965">)</span><br>
<span class="lineno"></span><span class="op" id="5095967">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="5095970">//&nbsp;ReadDotLines&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="5096027">//&nbsp;containing&nbsp;the&nbsp;decoded&nbsp;lines,&nbsp;with&nbsp;the&nbsp;final&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;elided&nbsp;from&nbsp;each.</span><br>
<span class="lineno"></span><span class="comment" id="5096104">//</span><br>
<span class="lineno"></span><span class="comment" id="5096107">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno">410</span><span class="keyword" id="5096189">func</span>&nbsp;<span class="op" id="5096194">(</span><span class="ident" id="5096195">r</span>&nbsp;<span class="op" id="5096197">*</span><span class="ident" id="5096198">Reader</span><span class="op" id="5096204">)</span>&nbsp;<span class="ident" id="5096206">ReadDotLines</span><span class="op" id="5096218">(</span><span class="op" id="5096219">)</span>&nbsp;<span class="op" id="5096221">(</span><span class="op" id="5096222">[</span><span class="op" id="5096223">]</span><span class="builtintype" id="5096224">string</span><span class="op" id="5096230">,</span>&nbsp;<span class="builtintype" id="5096232">error</span><span class="op" id="5096237">)</span>&nbsp;<span class="op" id="5096239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5096242">//&nbsp;We&nbsp;could&nbsp;use&nbsp;ReadDotBytes&nbsp;and&nbsp;then&nbsp;Split&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5096291">//&nbsp;but&nbsp;reading&nbsp;a&nbsp;line&nbsp;at&nbsp;a&nbsp;time&nbsp;avoids&nbsp;needing&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5096341">//&nbsp;large&nbsp;contiguous&nbsp;block&nbsp;of&nbsp;memory&nbsp;and&nbsp;is&nbsp;simpler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5096394">var</span>&nbsp;<span class="ident" id="5096398">v</span>&nbsp;<span class="op" id="5096400">[</span><span class="op" id="5096401">]</span><span class="builtintype" id="5096402">string</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5096410">var</span>&nbsp;<span class="ident" id="5096414">err</span>&nbsp;<span class="builtintype" id="5096418">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5096425">for</span>&nbsp;<span class="op" id="5096429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5096433">var</span>&nbsp;<span class="ident" id="5096437">line</span>&nbsp;<span class="builtintype" id="5096442">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5096451">line</span><span class="op" id="5096455">,</span>&nbsp;<span class="ident" id="5096457">err</span>&nbsp;<span class="op" id="5096461">=</span>&nbsp;<span class="ident" id="5096463">r</span><span class="op" id="5096464">.</span><span class="ident" id="5096465">ReadLine</span><span class="op" id="5096473">(</span><span class="op" id="5096474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5096478">if</span>&nbsp;<span class="ident" id="5096481">err</span>&nbsp;<span class="op" id="5096485">!=</span>&nbsp;<span class="ident" id="5096488">nil</span>&nbsp;<span class="op" id="5096492">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5096497">if</span>&nbsp;<span class="ident" id="5096500">err</span>&nbsp;<span class="op" id="5096504">==</span>&nbsp;<span class="ident" id="5096507">io</span><span class="op" id="5096509">.</span><span class="ident" id="5096510">EOF</span>&nbsp;<span class="op" id="5096514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5096520">err</span>&nbsp;<span class="op" id="5096524">=</span>&nbsp;<span class="ident" id="5096526">io</span><span class="op" id="5096528">.</span><span class="ident" id="5096529">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5096549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5096554">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5096562">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5096567">//&nbsp;Dot&nbsp;by&nbsp;itself&nbsp;marks&nbsp;end;&nbsp;otherwise&nbsp;cut&nbsp;one&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5096620">if</span>&nbsp;<span class="builtinfunc" id="5096623">len</span><span class="op" id="5096626">(</span><span class="ident" id="5096627">line</span><span class="op" id="5096631">)</span>&nbsp;<span class="op" id="5096633">&gt;</span>&nbsp;<span class="num" id="5096635">0</span>&nbsp;<span class="op" id="5096637">&amp;&amp;</span>&nbsp;<span class="ident" id="5096640">line</span><span class="op" id="5096644">[</span><span class="num" id="5096645">0</span><span class="op" id="5096646">]</span>&nbsp;<span class="op" id="5096648">==</span>&nbsp;<span class="string" id="5096651">&#39;.&#39;</span>&nbsp;<span class="op" id="5096655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5096660">if</span>&nbsp;<span class="builtinfunc" id="5096663">len</span><span class="op" id="5096666">(</span><span class="ident" id="5096667">line</span><span class="op" id="5096671">)</span>&nbsp;<span class="op" id="5096673">==</span>&nbsp;<span class="num" id="5096676">1</span>&nbsp;<span class="op" id="5096678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5096684">break</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5096693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5096698">line</span>&nbsp;<span class="op" id="5096703">=</span>&nbsp;<span class="ident" id="5096705">line</span><span class="op" id="5096709">[</span><span class="num" id="5096710">1</span><span class="op" id="5096711">:</span><span class="op" id="5096712">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5096716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5096720">v</span>&nbsp;<span class="op" id="5096722">=</span>&nbsp;<span class="builtinfunc" id="5096724">append</span><span class="op" id="5096730">(</span><span class="ident" id="5096731">v</span><span class="op" id="5096732">,</span>&nbsp;<span class="ident" id="5096734">line</span><span class="op" id="5096738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5096741">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5096744">return</span>&nbsp;<span class="ident" id="5096751">v</span><span class="op" id="5096752">,</span>&nbsp;<span class="ident" id="5096754">err</span><br>
<span class="lineno"></span><span class="op" id="5096758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5096761">//&nbsp;ReadMIMEHeader&nbsp;reads&nbsp;a&nbsp;MIME-style&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5096813">//&nbsp;The&nbsp;header&nbsp;is&nbsp;a&nbsp;sequence&nbsp;of&nbsp;possibly&nbsp;continued&nbsp;Key:&nbsp;Value&nbsp;lines</span><br>
<span class="lineno">440</span><span class="comment" id="5096880">//&nbsp;ending&nbsp;in&nbsp;a&nbsp;blank&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="5096907">//&nbsp;The&nbsp;returned&nbsp;map&nbsp;m&nbsp;maps&nbsp;CanonicalMIMEHeaderKey(key)&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5096967">//&nbsp;sequence&nbsp;of&nbsp;values&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;encountered&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="5097033">//</span><br>
<span class="lineno"></span><span class="comment" id="5097036">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">445</span><span class="comment" id="5097073">//</span><br>
<span class="lineno"></span><span class="comment" id="5097076">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="5097095">//&nbsp;&nbsp;&nbsp;&nbspLong-Key:&nbsp;Even</span><br>
<span class="lineno"></span><span class="comment" id="5097113">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Longer&nbsp;Value</span><br>
<span class="lineno"></span><span class="comment" id="5097136">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;2</span><br>
<span class="lineno">450</span><span class="comment" id="5097155">//</span><br>
<span class="lineno"></span><span class="comment" id="5097158">//&nbsp;Given&nbsp;that&nbsp;input,&nbsp;ReadMIMEHeader&nbsp;returns&nbsp;the&nbsp;map:</span><br>
<span class="lineno"></span><span class="comment" id="5097211">//</span><br>
<span class="lineno"></span><span class="comment" id="5097214">//&nbsp;&nbsp;&nbsp;&nbspmap[string][]string{</span><br>
<span class="lineno"></span><span class="comment" id="5097238">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;My-Key&#34;:&nbsp;{&#34;Value&nbsp;1&#34;,&nbsp;&#34;Value&nbsp;2&#34;},</span><br>
<span class="lineno">455</span><span class="comment" id="5097276">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Long-Key&#34;:&nbsp;{&#34;Even&nbsp;Longer&nbsp;Value&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="5097315">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="5097320">//</span><br>
<span class="lineno"></span><span class="keyword" id="5097323">func</span>&nbsp;<span class="op" id="5097328">(</span><span class="ident" id="5097329">r</span>&nbsp;<span class="op" id="5097331">*</span><span class="ident" id="5097332">Reader</span><span class="op" id="5097338">)</span>&nbsp;<span class="ident" id="5097340">ReadMIMEHeader</span><span class="op" id="5097354">(</span><span class="op" id="5097355">)</span>&nbsp;<span class="op" id="5097357">(</span><span class="ident" id="5097358">MIMEHeader</span><span class="op" id="5097368">,</span>&nbsp;<span class="builtintype" id="5097370">error</span><span class="op" id="5097375">)</span>&nbsp;<span class="op" id="5097377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5097380">//&nbsp;Avoid&nbsp;lots&nbsp;of&nbsp;small&nbsp;slice&nbsp;allocations&nbsp;later&nbsp;by&nbsp;allocating&nbsp;one</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5097446">//&nbsp;large&nbsp;one&nbsp;ahead&nbsp;of&nbsp;time&nbsp;which&nbsp;we&#39;ll&nbsp;cut&nbsp;up&nbsp;into&nbsp;smaller</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5097506">//&nbsp;slices.&nbsp;If&nbsp;this&nbsp;isn&#39;t&nbsp;big&nbsp;enough&nbsp;later,&nbsp;we&nbsp;allocate&nbsp;small&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097574">var</span>&nbsp;<span class="ident" id="5097578">strs</span>&nbsp;<span class="op" id="5097583">[</span><span class="op" id="5097584">]</span><span class="builtintype" id="5097585">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097593">hint</span>&nbsp;<span class="op" id="5097598">:=</span>&nbsp;<span class="ident" id="5097601">r</span><span class="op" id="5097602">.</span><span class="ident" id="5097603">upcomingHeaderNewlines</span><span class="op" id="5097625">(</span><span class="op" id="5097626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097629">if</span>&nbsp;<span class="ident" id="5097632">hint</span>&nbsp;<span class="op" id="5097637">&gt;</span>&nbsp;<span class="num" id="5097639">0</span>&nbsp;<span class="op" id="5097641">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097645">strs</span>&nbsp;<span class="op" id="5097650">=</span>&nbsp;<span class="builtinfunc" id="5097652">make</span><span class="op" id="5097656">(</span><span class="op" id="5097657">[</span><span class="op" id="5097658">]</span><span class="builtintype" id="5097659">string</span><span class="op" id="5097665">,</span>&nbsp;<span class="ident" id="5097667">hint</span><span class="op" id="5097671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5097674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097678">m</span>&nbsp;<span class="op" id="5097680">:=</span>&nbsp;<span class="builtinfunc" id="5097683">make</span><span class="op" id="5097687">(</span><span class="ident" id="5097688">MIMEHeader</span><span class="op" id="5097698">,</span>&nbsp;<span class="ident" id="5097700">hint</span><span class="op" id="5097704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097707">for</span>&nbsp;<span class="op" id="5097711">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097715">kv</span><span class="op" id="5097717">,</span>&nbsp;<span class="ident" id="5097719">err</span>&nbsp;<span class="op" id="5097723">:=</span>&nbsp;<span class="ident" id="5097726">r</span><span class="op" id="5097727">.</span><span class="ident" id="5097728">readContinuedLineSlice</span><span class="op" id="5097750">(</span><span class="op" id="5097751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097755">if</span>&nbsp;<span class="builtinfunc" id="5097758">len</span><span class="op" id="5097761">(</span><span class="ident" id="5097762">kv</span><span class="op" id="5097764">)</span>&nbsp;<span class="op" id="5097766">==</span>&nbsp;<span class="num" id="5097769">0</span>&nbsp;<span class="op" id="5097771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097776">return</span>&nbsp;<span class="ident" id="5097783">m</span><span class="op" id="5097784">,</span>&nbsp;<span class="ident" id="5097786">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5097792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5097797">//&nbsp;Key&nbsp;ends&nbsp;at&nbsp;first&nbsp;colon;&nbsp;should&nbsp;not&nbsp;have&nbsp;spaces&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5097854">//&nbsp;they&nbsp;appear&nbsp;in&nbsp;the&nbsp;wild,&nbsp;violating&nbsp;specs,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5097907">//&nbsp;remove&nbsp;them&nbsp;if&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5097936">i</span>&nbsp;<span class="op" id="5097938">:=</span>&nbsp;<span class="ident" id="5097941">bytes</span><span class="op" id="5097946">.</span><span class="ident" id="5097947">IndexByte</span><span class="op" id="5097956">(</span><span class="ident" id="5097957">kv</span><span class="op" id="5097959">,</span>&nbsp;<span class="string" id="5097961">&#39;:&#39;</span><span class="op" id="5097964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097968">if</span>&nbsp;<span class="ident" id="5097971">i</span>&nbsp;<span class="op" id="5097973">&lt;</span>&nbsp;<span class="num" id="5097975">0</span>&nbsp;<span class="op" id="5097977">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097982">return</span>&nbsp;<span class="ident" id="5097989">m</span><span class="op" id="5097990">,</span>&nbsp;<span class="ident" id="5097992">ProtocolError</span><span class="op" id="5098005">(</span><span class="string" id="5098006">&#34;malformed&nbsp;MIME&nbsp;header&nbsp;line:&nbsp;&#34;</span>&nbsp;<span class="op" id="5098037">+</span>&nbsp;<span class="builtintype" id="5098039">string</span><span class="op" id="5098045">(</span><span class="ident" id="5098046">kv</span><span class="op" id="5098048">)</span><span class="op" id="5098049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098057">endKey</span>&nbsp;<span class="op" id="5098064">:=</span>&nbsp;<span class="ident" id="5098067">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098071">for</span>&nbsp;<span class="ident" id="5098075">endKey</span>&nbsp;<span class="op" id="5098082">&gt;</span>&nbsp;<span class="num" id="5098084">0</span>&nbsp;<span class="op" id="5098086">&amp;&amp;</span>&nbsp;<span class="ident" id="5098089">kv</span><span class="op" id="5098091">[</span><span class="ident" id="5098092">endKey</span><span class="op" id="5098098">-</span><span class="num" id="5098099">1</span><span class="op" id="5098100">]</span>&nbsp;<span class="op" id="5098102">==</span>&nbsp;<span class="string" id="5098105">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5098109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098114">endKey</span><span class="op" id="5098120">--</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098129">key</span>&nbsp;<span class="op" id="5098133">:=</span>&nbsp;<span class="ident" id="5098136">canonicalMIMEHeaderKey</span><span class="op" id="5098158">(</span><span class="ident" id="5098159">kv</span><span class="op" id="5098161">[</span><span class="op" id="5098162">:</span><span class="ident" id="5098163">endKey</span><span class="op" id="5098169">]</span><span class="op" id="5098170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5098175">//&nbsp;Skip&nbsp;initial&nbsp;spaces&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098210">i</span><span class="op" id="5098211">++</span>&nbsp;<span class="comment" id="5098214">//&nbsp;skip&nbsp;colon</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098230">for</span>&nbsp;<span class="ident" id="5098234">i</span>&nbsp;<span class="op" id="5098236">&lt;</span>&nbsp;<span class="builtinfunc" id="5098238">len</span><span class="op" id="5098241">(</span><span class="ident" id="5098242">kv</span><span class="op" id="5098244">)</span>&nbsp;<span class="op" id="5098246">&amp;&amp;</span>&nbsp;<span class="op" id="5098249">(</span><span class="ident" id="5098250">kv</span><span class="op" id="5098252">[</span><span class="ident" id="5098253">i</span><span class="op" id="5098254">]</span>&nbsp;<span class="op" id="5098256">==</span>&nbsp;<span class="string" id="5098259">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5098263">||</span>&nbsp;<span class="ident" id="5098266">kv</span><span class="op" id="5098268">[</span><span class="ident" id="5098269">i</span><span class="op" id="5098270">]</span>&nbsp;<span class="op" id="5098272">==</span>&nbsp;<span class="string" id="5098275">&#39;\t&#39;</span><span class="op" id="5098279">)</span>&nbsp;<span class="op" id="5098281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098286">i</span><span class="op" id="5098287">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098296">value</span>&nbsp;<span class="op" id="5098302">:=</span>&nbsp;<span class="builtintype" id="5098305">string</span><span class="op" id="5098311">(</span><span class="ident" id="5098312">kv</span><span class="op" id="5098314">[</span><span class="ident" id="5098315">i</span><span class="op" id="5098316">:</span><span class="op" id="5098317">]</span><span class="op" id="5098318">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098323">vv</span>&nbsp;<span class="op" id="5098326">:=</span>&nbsp;<span class="ident" id="5098329">m</span><span class="op" id="5098330">[</span><span class="ident" id="5098331">key</span><span class="op" id="5098334">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098338">if</span>&nbsp;<span class="ident" id="5098341">vv</span>&nbsp;<span class="op" id="5098344">==</span>&nbsp;<span class="ident" id="5098347">nil</span>&nbsp;<span class="op" id="5098351">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5098354">len</span><span class="op" id="5098357">(</span><span class="ident" id="5098358">strs</span><span class="op" id="5098362">)</span>&nbsp;<span class="op" id="5098364">&gt;</span>&nbsp;<span class="num" id="5098366">0</span>&nbsp;<span class="op" id="5098368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5098373">//&nbsp;More&nbsp;than&nbsp;likely&nbsp;this&nbsp;will&nbsp;be&nbsp;a&nbsp;single-element&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5098431">//&nbsp;Most&nbsp;headers&nbsp;aren&#39;t&nbsp;multi-valued.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5098471">//&nbsp;Set&nbsp;the&nbsp;capacity&nbsp;on&nbsp;strs[0]&nbsp;to&nbsp;1,&nbsp;so&nbsp;any&nbsp;future&nbsp;append</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5098532">//&nbsp;won&#39;t&nbsp;extend&nbsp;the&nbsp;slice&nbsp;into&nbsp;the&nbsp;other&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098585">vv</span><span class="op" id="5098587">,</span>&nbsp;<span class="ident" id="5098589">strs</span>&nbsp;<span class="op" id="5098594">=</span>&nbsp;<span class="ident" id="5098596">strs</span><span class="op" id="5098600">[</span><span class="op" id="5098601">:</span><span class="num" id="5098602">1</span><span class="op" id="5098603">:</span><span class="num" id="5098604">1</span><span class="op" id="5098605">]</span><span class="op" id="5098606">,</span>&nbsp;<span class="ident" id="5098608">strs</span><span class="op" id="5098612">[</span><span class="num" id="5098613">1</span><span class="op" id="5098614">:</span><span class="op" id="5098615">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098620">vv</span><span class="op" id="5098622">[</span><span class="num" id="5098623">0</span><span class="op" id="5098624">]</span>&nbsp;<span class="op" id="5098626">=</span>&nbsp;<span class="ident" id="5098628">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098637">m</span><span class="op" id="5098638">[</span><span class="ident" id="5098639">key</span><span class="op" id="5098642">]</span>&nbsp;<span class="op" id="5098644">=</span>&nbsp;<span class="ident" id="5098646">vv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098651">}</span>&nbsp;<span class="keyword" id="5098653">else</span>&nbsp;<span class="op" id="5098658">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098663">m</span><span class="op" id="5098664">[</span><span class="ident" id="5098665">key</span><span class="op" id="5098668">]</span>&nbsp;<span class="op" id="5098670">=</span>&nbsp;<span class="builtinfunc" id="5098672">append</span><span class="op" id="5098678">(</span><span class="ident" id="5098679">vv</span><span class="op" id="5098681">,</span>&nbsp;<span class="ident" id="5098683">value</span><span class="op" id="5098688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098697">if</span>&nbsp;<span class="ident" id="5098700">err</span>&nbsp;<span class="op" id="5098704">!=</span>&nbsp;<span class="ident" id="5098707">nil</span>&nbsp;<span class="op" id="5098711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098716">return</span>&nbsp;<span class="ident" id="5098723">m</span><span class="op" id="5098724">,</span>&nbsp;<span class="ident" id="5098726">err</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098735">}</span><br>
<span class="lineno"></span><span class="op" id="5098737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5098740">//&nbsp;upcomingHeaderNewlines&nbsp;returns&nbsp;an&nbsp;approximation&nbsp;of&nbsp;the&nbsp;number&nbsp;of&nbsp;newlines</span><br>
<span class="lineno">515</span><span class="comment" id="5098817">//&nbsp;that&nbsp;will&nbsp;be&nbsp;in&nbsp;this&nbsp;header.&nbsp;If&nbsp;it&nbsp;gets&nbsp;confused,&nbsp;it&nbsp;returns&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="5098884">func</span>&nbsp;<span class="op" id="5098889">(</span><span class="ident" id="5098890">r</span>&nbsp;<span class="op" id="5098892">*</span><span class="ident" id="5098893">Reader</span><span class="op" id="5098899">)</span>&nbsp;<span class="ident" id="5098901">upcomingHeaderNewlines</span><span class="op" id="5098923">(</span><span class="op" id="5098924">)</span>&nbsp;<span class="op" id="5098926">(</span><span class="ident" id="5098927">n</span>&nbsp;<span class="builtintype" id="5098929">int</span><span class="op" id="5098932">)</span>&nbsp;<span class="op" id="5098934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5098937">//&nbsp;Try&nbsp;to&nbsp;determine&nbsp;the&nbsp;&#39;hint&#39;&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098975">r</span><span class="op" id="5098976">.</span><span class="ident" id="5098977">R</span><span class="op" id="5098978">.</span><span class="ident" id="5098979">Peek</span><span class="op" id="5098983">(</span><span class="num" id="5098984">1</span><span class="op" id="5098985">)</span>&nbsp;<span class="comment" id="5098987">//&nbsp;force&nbsp;a&nbsp;buffer&nbsp;load&nbsp;if&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099020">s</span>&nbsp;<span class="op" id="5099022">:=</span>&nbsp;<span class="ident" id="5099025">r</span><span class="op" id="5099026">.</span><span class="ident" id="5099027">R</span><span class="op" id="5099028">.</span><span class="ident" id="5099029">Buffered</span><span class="op" id="5099037">(</span><span class="op" id="5099038">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099041">if</span>&nbsp;<span class="ident" id="5099044">s</span>&nbsp;<span class="op" id="5099046">==</span>&nbsp;<span class="num" id="5099049">0</span>&nbsp;<span class="op" id="5099051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099055">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099066">peek</span><span class="op" id="5099070">,</span>&nbsp;<span class="ident" id="5099072">_</span>&nbsp;<span class="op" id="5099074">:=</span>&nbsp;<span class="ident" id="5099077">r</span><span class="op" id="5099078">.</span><span class="ident" id="5099079">R</span><span class="op" id="5099080">.</span><span class="ident" id="5099081">Peek</span><span class="op" id="5099085">(</span><span class="ident" id="5099086">s</span><span class="op" id="5099087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099090">for</span>&nbsp;<span class="builtinfunc" id="5099094">len</span><span class="op" id="5099097">(</span><span class="ident" id="5099098">peek</span><span class="op" id="5099102">)</span>&nbsp;<span class="op" id="5099104">&gt;</span>&nbsp;<span class="num" id="5099106">0</span>&nbsp;<span class="op" id="5099108">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099112">i</span>&nbsp;<span class="op" id="5099114">:=</span>&nbsp;<span class="ident" id="5099117">bytes</span><span class="op" id="5099122">.</span><span class="ident" id="5099123">IndexByte</span><span class="op" id="5099132">(</span><span class="ident" id="5099133">peek</span><span class="op" id="5099137">,</span>&nbsp;<span class="string" id="5099139">&#39;\n&#39;</span><span class="op" id="5099143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099147">if</span>&nbsp;<span class="ident" id="5099150">i</span>&nbsp;<span class="op" id="5099152">&lt;</span>&nbsp;<span class="num" id="5099154">3</span>&nbsp;<span class="op" id="5099156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5099161">//&nbsp;Not&nbsp;present&nbsp;(-1)&nbsp;or&nbsp;found&nbsp;within&nbsp;the&nbsp;next&nbsp;few&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5099220">//&nbsp;implying&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;(&#34;\r\n\r\n&#34;&nbsp;or&nbsp;&#34;\n\n&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099275">return</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099288">n</span><span class="op" id="5099289">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099294">peek</span>&nbsp;<span class="op" id="5099299">=</span>&nbsp;<span class="ident" id="5099301">peek</span><span class="op" id="5099305">[</span><span class="ident" id="5099306">i</span><span class="op" id="5099307">+</span><span class="num" id="5099308">1</span><span class="op" id="5099309">:</span><span class="op" id="5099310">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099316">return</span><br>
<span class="lineno">535</span><span class="op" id="5099323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5099326">//&nbsp;CanonicalMIMEHeaderKey&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;format&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5099388">//&nbsp;MIME&nbsp;header&nbsp;key&nbsp;s.&nbsp;&nbsp;The&nbsp;canonicalization&nbsp;converts&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="5099451">//&nbsp;letter&nbsp;and&nbsp;any&nbsp;letter&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;to&nbsp;upper&nbsp;case;</span><br>
<span class="lineno">540</span><span class="comment" id="5099510">//&nbsp;the&nbsp;rest&nbsp;are&nbsp;converted&nbsp;to&nbsp;lowercase.&nbsp;&nbsp;For&nbsp;example,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5099568">//&nbsp;canonical&nbsp;key&nbsp;for&nbsp;&#34;accept-encoding&#34;&nbsp;is&nbsp;&#34;Accept-Encoding&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5099629">//&nbsp;MIME&nbsp;header&nbsp;keys&nbsp;are&nbsp;assumed&nbsp;to&nbsp;be&nbsp;ASCII&nbsp;only.</span><br>
<span class="lineno"></span><span class="keyword" id="5099679">func</span>&nbsp;<span class="ident" id="5099684">CanonicalMIMEHeaderKey</span><span class="op" id="5099706">(</span><span class="ident" id="5099707">s</span>&nbsp;<span class="builtintype" id="5099709">string</span><span class="op" id="5099715">)</span>&nbsp;<span class="builtintype" id="5099717">string</span>&nbsp;<span class="op" id="5099724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5099727">//&nbsp;Quick&nbsp;check&nbsp;for&nbsp;canonical&nbsp;encoding.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099767">upper</span>&nbsp;<span class="op" id="5099773">:=</span>&nbsp;<span class="builtintype" id="5099776">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099782">for</span>&nbsp;<span class="ident" id="5099786">i</span>&nbsp;<span class="op" id="5099788">:=</span>&nbsp;<span class="num" id="5099791">0</span><span class="op" id="5099792">;</span>&nbsp;<span class="ident" id="5099794">i</span>&nbsp;<span class="op" id="5099796">&lt;</span>&nbsp;<span class="builtinfunc" id="5099798">len</span><span class="op" id="5099801">(</span><span class="ident" id="5099802">s</span><span class="op" id="5099803">)</span><span class="op" id="5099804">;</span>&nbsp;<span class="ident" id="5099806">i</span><span class="op" id="5099807">++</span>&nbsp;<span class="op" id="5099810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099814">c</span>&nbsp;<span class="op" id="5099816">:=</span>&nbsp;<span class="ident" id="5099819">s</span><span class="op" id="5099820">[</span><span class="ident" id="5099821">i</span><span class="op" id="5099822">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099826">if</span>&nbsp;<span class="ident" id="5099829">upper</span>&nbsp;<span class="op" id="5099835">&amp;&amp;</span>&nbsp;<span class="string" id="5099838">&#39;a&#39;</span>&nbsp;<span class="op" id="5099842">&lt;=</span>&nbsp;<span class="ident" id="5099845">c</span>&nbsp;<span class="op" id="5099847">&amp;&amp;</span>&nbsp;<span class="ident" id="5099850">c</span>&nbsp;<span class="op" id="5099852">&lt;=</span>&nbsp;<span class="string" id="5099855">&#39;z&#39;</span>&nbsp;<span class="op" id="5099859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099864">return</span>&nbsp;<span class="ident" id="5099871">canonicalMIMEHeaderKey</span><span class="op" id="5099893">(</span><span class="op" id="5099894">[</span><span class="op" id="5099895">]</span><span class="builtintype" id="5099896">byte</span><span class="op" id="5099900">(</span><span class="ident" id="5099901">s</span><span class="op" id="5099902">)</span><span class="op" id="5099903">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099911">if</span>&nbsp;<span class="op" id="5099914">!</span><span class="ident" id="5099915">upper</span>&nbsp;<span class="op" id="5099921">&amp;&amp;</span>&nbsp;<span class="string" id="5099924">&#39;A&#39;</span>&nbsp;<span class="op" id="5099928">&lt;=</span>&nbsp;<span class="ident" id="5099931">c</span>&nbsp;<span class="op" id="5099933">&amp;&amp;</span>&nbsp;<span class="ident" id="5099936">c</span>&nbsp;<span class="op" id="5099938">&lt;=</span>&nbsp;<span class="string" id="5099941">&#39;Z&#39;</span>&nbsp;<span class="op" id="5099945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099950">return</span>&nbsp;<span class="ident" id="5099957">canonicalMIMEHeaderKey</span><span class="op" id="5099979">(</span><span class="op" id="5099980">[</span><span class="op" id="5099981">]</span><span class="builtintype" id="5099982">byte</span><span class="op" id="5099986">(</span><span class="ident" id="5099987">s</span><span class="op" id="5099988">)</span><span class="op" id="5099989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099997">upper</span>&nbsp;<span class="op" id="5100003">=</span>&nbsp;<span class="ident" id="5100005">c</span>&nbsp;<span class="op" id="5100007">==</span>&nbsp;<span class="string" id="5100010">&#39;-&#39;</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5100015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100018">return</span>&nbsp;<span class="ident" id="5100025">s</span><br>
<span class="lineno"></span><span class="op" id="5100027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5100030">const</span>&nbsp;<span class="ident" id="5100036">toLower</span>&nbsp;<span class="op" id="5100044">=</span>&nbsp;<span class="string" id="5100046">&#39;a&#39;</span>&nbsp;<span class="op" id="5100050">-</span>&nbsp;<span class="string" id="5100052">&#39;A&#39;</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span><span class="comment" id="5100057">//&nbsp;canonicalMIMEHeaderKey&nbsp;is&nbsp;like&nbsp;CanonicalMIMEHeaderKey&nbsp;but&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5100121">//&nbsp;allowed&nbsp;to&nbsp;mutate&nbsp;the&nbsp;provided&nbsp;byte&nbsp;slice&nbsp;before&nbsp;returning&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5100187">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5100198">func</span>&nbsp;<span class="ident" id="5100203">canonicalMIMEHeaderKey</span><span class="op" id="5100225">(</span><span class="ident" id="5100226">a</span>&nbsp;<span class="op" id="5100228">[</span><span class="op" id="5100229">]</span><span class="builtintype" id="5100230">byte</span><span class="op" id="5100234">)</span>&nbsp;<span class="builtintype" id="5100236">string</span>&nbsp;<span class="op" id="5100243">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100246">upper</span>&nbsp;<span class="op" id="5100252">:=</span>&nbsp;<span class="builtintype" id="5100255">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100261">for</span>&nbsp;<span class="ident" id="5100265">i</span><span class="op" id="5100266">,</span>&nbsp;<span class="ident" id="5100268">c</span>&nbsp;<span class="op" id="5100270">:=</span>&nbsp;<span class="keyword" id="5100273">range</span>&nbsp;<span class="ident" id="5100279">a</span>&nbsp;<span class="op" id="5100281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5100285">//&nbsp;Canonicalize:&nbsp;first&nbsp;letter&nbsp;upper&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5100328">//&nbsp;and&nbsp;upper&nbsp;case&nbsp;after&nbsp;each&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5100365">//&nbsp;(Host,&nbsp;User-Agent,&nbsp;If-Modified-Since).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5100409">//&nbsp;MIME&nbsp;headers&nbsp;are&nbsp;ASCII&nbsp;only,&nbsp;so&nbsp;no&nbsp;Unicode&nbsp;issues.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100465">if</span>&nbsp;<span class="ident" id="5100468">c</span>&nbsp;<span class="op" id="5100470">==</span>&nbsp;<span class="string" id="5100473">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5100477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100482">c</span>&nbsp;<span class="op" id="5100484">=</span>&nbsp;<span class="string" id="5100486">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5100492">}</span>&nbsp;<span class="keyword" id="5100494">else</span>&nbsp;<span class="keyword" id="5100499">if</span>&nbsp;<span class="ident" id="5100502">upper</span>&nbsp;<span class="op" id="5100508">&amp;&amp;</span>&nbsp;<span class="string" id="5100511">&#39;a&#39;</span>&nbsp;<span class="op" id="5100515">&lt;=</span>&nbsp;<span class="ident" id="5100518">c</span>&nbsp;<span class="op" id="5100520">&amp;&amp;</span>&nbsp;<span class="ident" id="5100523">c</span>&nbsp;<span class="op" id="5100525">&lt;=</span>&nbsp;<span class="string" id="5100528">&#39;z&#39;</span>&nbsp;<span class="op" id="5100532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100537">c</span>&nbsp;<span class="op" id="5100539">-=</span>&nbsp;<span class="ident" id="5100542">toLower</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5100552">}</span>&nbsp;<span class="keyword" id="5100554">else</span>&nbsp;<span class="keyword" id="5100559">if</span>&nbsp;<span class="op" id="5100562">!</span><span class="ident" id="5100563">upper</span>&nbsp;<span class="op" id="5100569">&amp;&amp;</span>&nbsp;<span class="string" id="5100572">&#39;A&#39;</span>&nbsp;<span class="op" id="5100576">&lt;=</span>&nbsp;<span class="ident" id="5100579">c</span>&nbsp;<span class="op" id="5100581">&amp;&amp;</span>&nbsp;<span class="ident" id="5100584">c</span>&nbsp;<span class="op" id="5100586">&lt;=</span>&nbsp;<span class="string" id="5100589">&#39;Z&#39;</span>&nbsp;<span class="op" id="5100593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100598">c</span>&nbsp;<span class="op" id="5100600">+=</span>&nbsp;<span class="ident" id="5100603">toLower</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5100613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100617">a</span><span class="op" id="5100618">[</span><span class="ident" id="5100619">i</span><span class="op" id="5100620">]</span>&nbsp;<span class="op" id="5100622">=</span>&nbsp;<span class="ident" id="5100624">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100628">upper</span>&nbsp;<span class="op" id="5100634">=</span>&nbsp;<span class="ident" id="5100636">c</span>&nbsp;<span class="op" id="5100638">==</span>&nbsp;<span class="string" id="5100641">&#39;-&#39;</span>&nbsp;<span class="comment" id="5100645">//&nbsp;for&nbsp;next&nbsp;time</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5100663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5100666">//&nbsp;The&nbsp;compiler&nbsp;recognizes&nbsp;m[string(byteSlice)]&nbsp;as&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5100728">//&nbsp;case,&nbsp;so&nbsp;a&nbsp;copy&nbsp;of&nbsp;a&#39;s&nbsp;bytes&nbsp;into&nbsp;a&nbsp;new&nbsp;string&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5100788">//&nbsp;happen&nbsp;in&nbsp;this&nbsp;map&nbsp;lookup:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100819">if</span>&nbsp;<span class="ident" id="5100822">v</span>&nbsp;<span class="op" id="5100824">:=</span>&nbsp;<span class="ident" id="5100827">commonHeader</span><span class="op" id="5100839">[</span><span class="builtintype" id="5100840">string</span><span class="op" id="5100846">(</span><span class="ident" id="5100847">a</span><span class="op" id="5100848">)</span><span class="op" id="5100849">]</span><span class="op" id="5100850">;</span>&nbsp;<span class="ident" id="5100852">v</span>&nbsp;<span class="op" id="5100854">!=</span>&nbsp;<span class="string" id="5100857">&#34;&#34;</span>&nbsp;<span class="op" id="5100860">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100864">return</span>&nbsp;<span class="ident" id="5100871">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5100874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100877">return</span>&nbsp;<span class="builtintype" id="5100884">string</span><span class="op" id="5100890">(</span><span class="ident" id="5100891">a</span><span class="op" id="5100892">)</span><br>
<span class="lineno"></span><span class="op" id="5100894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="5100897">//&nbsp;commonHeader&nbsp;interns&nbsp;common&nbsp;header&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="5100944">var</span>&nbsp;<span class="ident" id="5100948">commonHeader</span>&nbsp;<span class="op" id="5100961">=</span>&nbsp;<span class="builtinfunc" id="5100963">make</span><span class="op" id="5100967">(</span><span class="keyword" id="5100968">map</span><span class="op" id="5100971">[</span><span class="builtintype" id="5100972">string</span><span class="op" id="5100978">]</span><span class="builtintype" id="5100979">string</span><span class="op" id="5100985">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5100988">func</span>&nbsp;<span class="ident" id="5100993">init</span><span class="op" id="5100997">(</span><span class="op" id="5100998">)</span>&nbsp;<span class="op" id="5101000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5101003">for</span>&nbsp;<span class="ident" id="5101007">_</span><span class="op" id="5101008">,</span>&nbsp;<span class="ident" id="5101010">v</span>&nbsp;<span class="op" id="5101012">:=</span>&nbsp;<span class="keyword" id="5101015">range</span>&nbsp;<span class="op" id="5101021">[</span><span class="op" id="5101022">]</span><span class="builtintype" id="5101023">string</span><span class="op" id="5101029">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101033">&#34;Accept&#34;</span><span class="op" id="5101041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101045">&#34;Accept-Charset&#34;</span><span class="op" id="5101061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101065">&#34;Accept-Encoding&#34;</span><span class="op" id="5101082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101086">&#34;Accept-Language&#34;</span><span class="op" id="5101103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101107">&#34;Accept-Ranges&#34;</span><span class="op" id="5101122">,</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101126">&#34;Cache-Control&#34;</span><span class="op" id="5101141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101145">&#34;Cc&#34;</span><span class="op" id="5101149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101153">&#34;Connection&#34;</span><span class="op" id="5101165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101169">&#34;Content-Id&#34;</span><span class="op" id="5101181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101185">&#34;Content-Language&#34;</span><span class="op" id="5101203">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101207">&#34;Content-Length&#34;</span><span class="op" id="5101223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101227">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="5101254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101258">&#34;Content-Type&#34;</span><span class="op" id="5101272">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101276">&#34;Cookie&#34;</span><span class="op" id="5101284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101288">&#34;Date&#34;</span><span class="op" id="5101294">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101298">&#34;Dkim-Signature&#34;</span><span class="op" id="5101314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101318">&#34;Etag&#34;</span><span class="op" id="5101324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101328">&#34;Expires&#34;</span><span class="op" id="5101337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101341">&#34;From&#34;</span><span class="op" id="5101347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101351">&#34;Host&#34;</span><span class="op" id="5101357">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101361">&#34;If-Modified-Since&#34;</span><span class="op" id="5101380">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101384">&#34;If-None-Match&#34;</span><span class="op" id="5101399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101403">&#34;In-Reply-To&#34;</span><span class="op" id="5101416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101420">&#34;Last-Modified&#34;</span><span class="op" id="5101435">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101439">&#34;Location&#34;</span><span class="op" id="5101449">,</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101453">&#34;Message-Id&#34;</span><span class="op" id="5101465">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101469">&#34;Mime-Version&#34;</span><span class="op" id="5101483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101487">&#34;Pragma&#34;</span><span class="op" id="5101495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101499">&#34;Received&#34;</span><span class="op" id="5101509">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101513">&#34;Return-Path&#34;</span><span class="op" id="5101526">,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101530">&#34;Server&#34;</span><span class="op" id="5101538">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101542">&#34;Set-Cookie&#34;</span><span class="op" id="5101554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101558">&#34;Subject&#34;</span><span class="op" id="5101567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101571">&#34;To&#34;</span><span class="op" id="5101575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101579">&#34;User-Agent&#34;</span><span class="op" id="5101591">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101595">&#34;Via&#34;</span><span class="op" id="5101600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101604">&#34;X-Forwarded-For&#34;</span><span class="op" id="5101621">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101625">&#34;X-Imforwards&#34;</span><span class="op" id="5101639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101643">&#34;X-Powered-By&#34;</span><span class="op" id="5101657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5101660">}</span>&nbsp;<span class="op" id="5101662">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101666">commonHeader</span><span class="op" id="5101678">[</span><span class="ident" id="5101679">v</span><span class="op" id="5101680">]</span>&nbsp;<span class="op" id="5101682">=</span>&nbsp;<span class="ident" id="5101684">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5101687">}</span><br>
<span class="lineno"></span><span class="op" id="5101689">}</span>
</div>
</body>
</html>
