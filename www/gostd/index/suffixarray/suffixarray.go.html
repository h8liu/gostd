<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html" class="current">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3799287">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3799342">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3799396">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3799447">//&nbsp;Package&nbsp;suffixarray&nbsp;implements&nbsp;substring&nbsp;search&nbsp;in&nbsp;logarithmic&nbsp;time&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="3799524">//&nbsp;an&nbsp;in-memory&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="3799554">//</span><br>
<span class="lineno"></span><span class="comment" id="3799557">//&nbsp;Example&nbsp;use:</span><br>
<span class="lineno"></span><span class="comment" id="3799573">//</span><br>
<span class="lineno">10</span><span class="comment" id="3799576">//&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;create&nbsp;index&nbsp;for&nbsp;some&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="3799609">//&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;:=&nbsp;suffixarray.New(data)</span><br>
<span class="lineno"></span><span class="comment" id="3799643">//</span><br>
<span class="lineno"></span><span class="comment" id="3799646">//&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;lookup&nbsp;byte&nbsp;slice&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="3799672">//&nbsp;&nbsp;&nbsp;&nbsp;offsets1&nbsp;:=&nbsp;index.Lookup(s,&nbsp;-1)&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;all&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno">15</span><span class="comment" id="3799757">//&nbsp;&nbsp;&nbsp;&nbsp;offsets2&nbsp;:=&nbsp;index.Lookup(s,&nbsp;3)&nbsp;&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;3&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="3799848">//</span><br>
<span class="lineno"></span><span class="keyword" id="3799851">package</span>&nbsp;<span class="ident" id="3799859">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3799872">import</span>&nbsp;<span class="op" id="3799879">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3799882">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3799891">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3799910">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3799916">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3799926">&#34;sort&#34;</span><br>
<span class="lineno">25</span><span class="op" id="3799933">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3799936">//&nbsp;Index&nbsp;implements&nbsp;a&nbsp;suffix&nbsp;array&nbsp;for&nbsp;fast&nbsp;substring&nbsp;search.</span><br>
<span class="lineno"></span><span class="keyword" id="3799998">type</span>&nbsp;<span class="ident" id="3800003">Index</span>&nbsp;<span class="keyword" id="3800009">struct</span>&nbsp;<span class="op" id="3800016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800019">data</span>&nbsp;<span class="op" id="3800024">[</span><span class="op" id="3800025">]</span><span class="builtintype" id="3800026">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800032">sa</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3800037">[</span><span class="op" id="3800038">]</span><span class="builtintype" id="3800039">int</span>&nbsp;<span class="comment" id="3800043">//&nbsp;suffix&nbsp;array&nbsp;for&nbsp;data;&nbsp;len(sa)&nbsp;==&nbsp;len(data)</span><br>
<span class="lineno"></span><span class="op" id="3800090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3800093">//&nbsp;New&nbsp;creates&nbsp;a&nbsp;new&nbsp;Index&nbsp;for&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="3800130">//&nbsp;Index&nbsp;creation&nbsp;time&nbsp;is&nbsp;O(N*log(N))&nbsp;for&nbsp;N&nbsp;=&nbsp;len(data).</span><br>
<span class="lineno">35</span><span class="keyword" id="3800187">func</span>&nbsp;<span class="ident" id="3800192">New</span><span class="op" id="3800195">(</span><span class="ident" id="3800196">data</span>&nbsp;<span class="op" id="3800201">[</span><span class="op" id="3800202">]</span><span class="builtintype" id="3800203">byte</span><span class="op" id="3800207">)</span>&nbsp;<span class="op" id="3800209">*</span><span class="ident" id="3800210">Index</span>&nbsp;<span class="op" id="3800216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3800219">return</span>&nbsp;<span class="op" id="3800226">&amp;</span><span class="ident" id="3800227">Index</span><span class="op" id="3800232">{</span><span class="ident" id="3800233">data</span><span class="op" id="3800237">,</span>&nbsp;<span class="ident" id="3800239">qsufsort</span><span class="op" id="3800247">(</span><span class="ident" id="3800248">data</span><span class="op" id="3800252">)</span><span class="op" id="3800253">}</span><br>
<span class="lineno"></span><span class="op" id="3800255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3800258">//&nbsp;writeInt&nbsp;writes&nbsp;an&nbsp;int&nbsp;x&nbsp;to&nbsp;w&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">40</span><span class="keyword" id="3800322">func</span>&nbsp;<span class="ident" id="3800327">writeInt</span><span class="op" id="3800335">(</span><span class="ident" id="3800336">w</span>&nbsp;<span class="ident" id="3800338">io</span><span class="op" id="3800340">.</span><span class="ident" id="3800341">Writer</span><span class="op" id="3800347">,</span>&nbsp;<span class="ident" id="3800349">buf</span>&nbsp;<span class="op" id="3800353">[</span><span class="op" id="3800354">]</span><span class="builtintype" id="3800355">byte</span><span class="op" id="3800359">,</span>&nbsp;<span class="ident" id="3800361">x</span>&nbsp;<span class="builtintype" id="3800363">int</span><span class="op" id="3800366">)</span>&nbsp;<span class="builtintype" id="3800368">error</span>&nbsp;<span class="op" id="3800374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800377">binary</span><span class="op" id="3800383">.</span><span class="ident" id="3800384">PutVarint</span><span class="op" id="3800393">(</span><span class="ident" id="3800394">buf</span><span class="op" id="3800397">,</span>&nbsp;<span class="ident" id="3800399">int64</span><span class="op" id="3800404">(</span><span class="ident" id="3800405">x</span><span class="op" id="3800406">)</span><span class="op" id="3800407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800410">_</span><span class="op" id="3800411">,</span>&nbsp;<span class="ident" id="3800413">err</span>&nbsp;<span class="op" id="3800417">:=</span>&nbsp;<span class="ident" id="3800420">w</span><span class="op" id="3800421">.</span><span class="ident" id="3800422">Write</span><span class="op" id="3800427">(</span><span class="ident" id="3800428">buf</span><span class="op" id="3800431">[</span><span class="num" id="3800432">0</span><span class="op" id="3800433">:</span><span class="ident" id="3800434">binary</span><span class="op" id="3800440">.</span><span class="ident" id="3800441">MaxVarintLen64</span><span class="op" id="3800455">]</span><span class="op" id="3800456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3800459">return</span>&nbsp;<span class="ident" id="3800466">err</span><br>
<span class="lineno"></span><span class="op" id="3800470">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3800473">//&nbsp;readInt&nbsp;reads&nbsp;an&nbsp;int&nbsp;x&nbsp;from&nbsp;r&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read&nbsp;and&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3800550">func</span>&nbsp;<span class="ident" id="3800555">readInt</span><span class="op" id="3800562">(</span><span class="ident" id="3800563">r</span>&nbsp;<span class="ident" id="3800565">io</span><span class="op" id="3800567">.</span><span class="ident" id="3800568">Reader</span><span class="op" id="3800574">,</span>&nbsp;<span class="ident" id="3800576">buf</span>&nbsp;<span class="op" id="3800580">[</span><span class="op" id="3800581">]</span><span class="builtintype" id="3800582">byte</span><span class="op" id="3800586">)</span>&nbsp;<span class="op" id="3800588">(</span><span class="builtintype" id="3800589">int</span><span class="op" id="3800592">,</span>&nbsp;<span class="builtintype" id="3800594">error</span><span class="op" id="3800599">)</span>&nbsp;<span class="op" id="3800601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800604">_</span><span class="op" id="3800605">,</span>&nbsp;<span class="ident" id="3800607">err</span>&nbsp;<span class="op" id="3800611">:=</span>&nbsp;<span class="ident" id="3800614">io</span><span class="op" id="3800616">.</span><span class="ident" id="3800617">ReadFull</span><span class="op" id="3800625">(</span><span class="ident" id="3800626">r</span><span class="op" id="3800627">,</span>&nbsp;<span class="ident" id="3800629">buf</span><span class="op" id="3800632">[</span><span class="num" id="3800633">0</span><span class="op" id="3800634">:</span><span class="ident" id="3800635">binary</span><span class="op" id="3800641">.</span><span class="ident" id="3800642">MaxVarintLen64</span><span class="op" id="3800656">]</span><span class="op" id="3800657">)</span>&nbsp;<span class="comment" id="3800659">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;with&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800689">x</span><span class="op" id="3800690">,</span>&nbsp;<span class="ident" id="3800692">_</span>&nbsp;<span class="op" id="3800694">:=</span>&nbsp;<span class="ident" id="3800697">binary</span><span class="op" id="3800703">.</span><span class="ident" id="3800704">Varint</span><span class="op" id="3800710">(</span><span class="ident" id="3800711">buf</span><span class="op" id="3800714">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3800717">return</span>&nbsp;<span class="builtintype" id="3800724">int</span><span class="op" id="3800727">(</span><span class="ident" id="3800728">x</span><span class="op" id="3800729">)</span><span class="op" id="3800730">,</span>&nbsp;<span class="ident" id="3800732">err</span><br>
<span class="lineno"></span><span class="op" id="3800736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3800739">//&nbsp;writeSlice&nbsp;writes&nbsp;data[:n]&nbsp;to&nbsp;w&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="3800789">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">55</span><span class="keyword" id="3800825">func</span>&nbsp;<span class="ident" id="3800830">writeSlice</span><span class="op" id="3800840">(</span><span class="ident" id="3800841">w</span>&nbsp;<span class="ident" id="3800843">io</span><span class="op" id="3800845">.</span><span class="ident" id="3800846">Writer</span><span class="op" id="3800852">,</span>&nbsp;<span class="ident" id="3800854">buf</span>&nbsp;<span class="op" id="3800858">[</span><span class="op" id="3800859">]</span><span class="builtintype" id="3800860">byte</span><span class="op" id="3800864">,</span>&nbsp;<span class="ident" id="3800866">data</span>&nbsp;<span class="op" id="3800871">[</span><span class="op" id="3800872">]</span><span class="builtintype" id="3800873">int</span><span class="op" id="3800876">)</span>&nbsp;<span class="op" id="3800878">(</span><span class="ident" id="3800879">n</span>&nbsp;<span class="builtintype" id="3800881">int</span><span class="op" id="3800884">,</span>&nbsp;<span class="ident" id="3800886">err</span>&nbsp;<span class="builtintype" id="3800890">error</span><span class="op" id="3800895">)</span>&nbsp;<span class="op" id="3800897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3800900">//&nbsp;encode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;fit&nbsp;into&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800944">p</span>&nbsp;<span class="op" id="3800946">:=</span>&nbsp;<span class="ident" id="3800949">binary</span><span class="op" id="3800955">.</span><span class="ident" id="3800956">MaxVarintLen64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3800972">for</span>&nbsp;<span class="op" id="3800976">;</span>&nbsp;<span class="ident" id="3800978">n</span>&nbsp;<span class="op" id="3800980">&lt;</span>&nbsp;<span class="builtinfunc" id="3800982">len</span><span class="op" id="3800985">(</span><span class="ident" id="3800986">data</span><span class="op" id="3800990">)</span>&nbsp;<span class="op" id="3800992">&amp;&amp;</span>&nbsp;<span class="ident" id="3800995">p</span><span class="op" id="3800996">+</span><span class="ident" id="3800997">binary</span><span class="op" id="3801003">.</span><span class="ident" id="3801004">MaxVarintLen64</span>&nbsp;<span class="op" id="3801019">&lt;=</span>&nbsp;<span class="builtinfunc" id="3801022">len</span><span class="op" id="3801025">(</span><span class="ident" id="3801026">buf</span><span class="op" id="3801029">)</span><span class="op" id="3801030">;</span>&nbsp;<span class="ident" id="3801032">n</span><span class="op" id="3801033">++</span>&nbsp;<span class="op" id="3801036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801040">p</span>&nbsp;<span class="op" id="3801042">+=</span>&nbsp;<span class="ident" id="3801045">binary</span><span class="op" id="3801051">.</span><span class="ident" id="3801052">PutUvarint</span><span class="op" id="3801062">(</span><span class="ident" id="3801063">buf</span><span class="op" id="3801066">[</span><span class="ident" id="3801067">p</span><span class="op" id="3801068">:</span><span class="op" id="3801069">]</span><span class="op" id="3801070">,</span>&nbsp;<span class="ident" id="3801072">uint64</span><span class="op" id="3801078">(</span><span class="ident" id="3801079">data</span><span class="op" id="3801083">[</span><span class="ident" id="3801084">n</span><span class="op" id="3801085">]</span><span class="op" id="3801086">)</span><span class="op" id="3801087">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3801090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3801094">//&nbsp;update&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801117">binary</span><span class="op" id="3801123">.</span><span class="ident" id="3801124">PutVarint</span><span class="op" id="3801133">(</span><span class="ident" id="3801134">buf</span><span class="op" id="3801137">,</span>&nbsp;<span class="ident" id="3801139">int64</span><span class="op" id="3801144">(</span><span class="ident" id="3801145">p</span><span class="op" id="3801146">)</span><span class="op" id="3801147">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3801151">//&nbsp;write&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801168">_</span><span class="op" id="3801169">,</span>&nbsp;<span class="ident" id="3801171">err</span>&nbsp;<span class="op" id="3801175">=</span>&nbsp;<span class="ident" id="3801177">w</span><span class="op" id="3801178">.</span><span class="ident" id="3801179">Write</span><span class="op" id="3801184">(</span><span class="ident" id="3801185">buf</span><span class="op" id="3801188">[</span><span class="num" id="3801189">0</span><span class="op" id="3801190">:</span><span class="ident" id="3801191">p</span><span class="op" id="3801192">]</span><span class="op" id="3801193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801196">return</span><br>
<span class="lineno"></span><span class="op" id="3801203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="3801206">//&nbsp;readSlice&nbsp;reads&nbsp;data[:n]&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="3801256">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="3801291">func</span>&nbsp;<span class="ident" id="3801296">readSlice</span><span class="op" id="3801305">(</span><span class="ident" id="3801306">r</span>&nbsp;<span class="ident" id="3801308">io</span><span class="op" id="3801310">.</span><span class="ident" id="3801311">Reader</span><span class="op" id="3801317">,</span>&nbsp;<span class="ident" id="3801319">buf</span>&nbsp;<span class="op" id="3801323">[</span><span class="op" id="3801324">]</span><span class="builtintype" id="3801325">byte</span><span class="op" id="3801329">,</span>&nbsp;<span class="ident" id="3801331">data</span>&nbsp;<span class="op" id="3801336">[</span><span class="op" id="3801337">]</span><span class="builtintype" id="3801338">int</span><span class="op" id="3801341">)</span>&nbsp;<span class="op" id="3801343">(</span><span class="ident" id="3801344">n</span>&nbsp;<span class="builtintype" id="3801346">int</span><span class="op" id="3801349">,</span>&nbsp;<span class="ident" id="3801351">err</span>&nbsp;<span class="builtintype" id="3801355">error</span><span class="op" id="3801360">)</span>&nbsp;<span class="op" id="3801362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3801365">//&nbsp;read&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801386">var</span>&nbsp;<span class="ident" id="3801390">size</span>&nbsp;<span class="builtintype" id="3801395">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801400">size</span><span class="op" id="3801404">,</span>&nbsp;<span class="ident" id="3801406">err</span>&nbsp;<span class="op" id="3801410">=</span>&nbsp;<span class="ident" id="3801412">readInt</span><span class="op" id="3801419">(</span><span class="ident" id="3801420">r</span><span class="op" id="3801421">,</span>&nbsp;<span class="ident" id="3801423">buf</span><span class="op" id="3801426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801429">if</span>&nbsp;<span class="ident" id="3801432">err</span>&nbsp;<span class="op" id="3801436">!=</span>&nbsp;<span class="builtintype" id="3801439">nil</span>&nbsp;<span class="op" id="3801443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801447">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3801455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3801459">//&nbsp;read&nbsp;buffer&nbsp;w/o&nbsp;the&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801488">if</span>&nbsp;<span class="ident" id="3801491">_</span><span class="op" id="3801492">,</span>&nbsp;<span class="ident" id="3801494">err</span>&nbsp;<span class="op" id="3801498">=</span>&nbsp;<span class="ident" id="3801500">io</span><span class="op" id="3801502">.</span><span class="ident" id="3801503">ReadFull</span><span class="op" id="3801511">(</span><span class="ident" id="3801512">r</span><span class="op" id="3801513">,</span>&nbsp;<span class="ident" id="3801515">buf</span><span class="op" id="3801518">[</span><span class="ident" id="3801519">binary</span><span class="op" id="3801525">.</span><span class="ident" id="3801526">MaxVarintLen64</span><span class="op" id="3801540">:</span><span class="ident" id="3801541">size</span><span class="op" id="3801545">]</span><span class="op" id="3801546">)</span><span class="op" id="3801547">;</span>&nbsp;<span class="ident" id="3801549">err</span>&nbsp;<span class="op" id="3801553">!=</span>&nbsp;<span class="builtintype" id="3801556">nil</span>&nbsp;<span class="op" id="3801560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801564">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3801572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3801576">//&nbsp;decode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;present&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801622">for</span>&nbsp;<span class="ident" id="3801626">p</span>&nbsp;<span class="op" id="3801628">:=</span>&nbsp;<span class="ident" id="3801631">binary</span><span class="op" id="3801637">.</span><span class="ident" id="3801638">MaxVarintLen64</span><span class="op" id="3801652">;</span>&nbsp;<span class="ident" id="3801654">p</span>&nbsp;<span class="op" id="3801656">&lt;</span>&nbsp;<span class="ident" id="3801658">size</span><span class="op" id="3801662">;</span>&nbsp;<span class="ident" id="3801664">n</span><span class="op" id="3801665">++</span>&nbsp;<span class="op" id="3801668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801672">x</span><span class="op" id="3801673">,</span>&nbsp;<span class="ident" id="3801675">w</span>&nbsp;<span class="op" id="3801677">:=</span>&nbsp;<span class="ident" id="3801680">binary</span><span class="op" id="3801686">.</span><span class="ident" id="3801687">Uvarint</span><span class="op" id="3801694">(</span><span class="ident" id="3801695">buf</span><span class="op" id="3801698">[</span><span class="ident" id="3801699">p</span><span class="op" id="3801700">:</span><span class="op" id="3801701">]</span><span class="op" id="3801702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801706">data</span><span class="op" id="3801710">[</span><span class="ident" id="3801711">n</span><span class="op" id="3801712">]</span>&nbsp;<span class="op" id="3801714">=</span>&nbsp;<span class="builtintype" id="3801716">int</span><span class="op" id="3801719">(</span><span class="ident" id="3801720">x</span><span class="op" id="3801721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801725">p</span>&nbsp;<span class="op" id="3801727">+=</span>&nbsp;<span class="ident" id="3801730">w</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3801733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801737">return</span><br>
<span class="lineno"></span><span class="op" id="3801744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="3801747">const</span>&nbsp;<span class="ident" id="3801753">bufSize</span>&nbsp;<span class="op" id="3801761">=</span>&nbsp;<span class="num" id="3801763">16</span>&nbsp;<span class="op" id="3801766">&lt;&lt;</span>&nbsp;<span class="num" id="3801769">10</span>&nbsp;<span class="comment" id="3801772">//&nbsp;reasonable&nbsp;for&nbsp;BenchmarkSaveRestore</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3801812">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;index&nbsp;from&nbsp;r&nbsp;into&nbsp;x;&nbsp;x&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3801870">func</span>&nbsp;<span class="op" id="3801875">(</span><span class="ident" id="3801876">x</span>&nbsp;<span class="op" id="3801878">*</span><span class="ident" id="3801879">Index</span><span class="op" id="3801884">)</span>&nbsp;<span class="ident" id="3801886">Read</span><span class="op" id="3801890">(</span><span class="ident" id="3801891">r</span>&nbsp;<span class="ident" id="3801893">io</span><span class="op" id="3801895">.</span><span class="ident" id="3801896">Reader</span><span class="op" id="3801902">)</span>&nbsp;<span class="builtintype" id="3801904">error</span>&nbsp;<span class="op" id="3801910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3801913">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;reads</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801938">buf</span>&nbsp;<span class="op" id="3801942">:=</span>&nbsp;<span class="builtinfunc" id="3801945">make</span><span class="op" id="3801949">(</span><span class="op" id="3801950">[</span><span class="op" id="3801951">]</span><span class="builtintype" id="3801952">byte</span><span class="op" id="3801956">,</span>&nbsp;<span class="ident" id="3801958">bufSize</span><span class="op" id="3801965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3801969">//&nbsp;read&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801985">n</span><span class="op" id="3801986">,</span>&nbsp;<span class="ident" id="3801988">err</span>&nbsp;<span class="op" id="3801992">:=</span>&nbsp;<span class="ident" id="3801995">readInt</span><span class="op" id="3802002">(</span><span class="ident" id="3802003">r</span><span class="op" id="3802004">,</span>&nbsp;<span class="ident" id="3802006">buf</span><span class="op" id="3802009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802012">if</span>&nbsp;<span class="ident" id="3802015">err</span>&nbsp;<span class="op" id="3802019">!=</span>&nbsp;<span class="builtintype" id="3802022">nil</span>&nbsp;<span class="op" id="3802026">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802030">return</span>&nbsp;<span class="ident" id="3802037">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3802046">//&nbsp;allocate&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802065">if</span>&nbsp;<span class="num" id="3802068">2</span><span class="op" id="3802069">*</span><span class="ident" id="3802070">n</span>&nbsp;<span class="op" id="3802072">&lt;</span>&nbsp;<span class="builtinfunc" id="3802074">cap</span><span class="op" id="3802077">(</span><span class="ident" id="3802078">x</span><span class="op" id="3802079">.</span><span class="ident" id="3802080">data</span><span class="op" id="3802084">)</span>&nbsp;<span class="op" id="3802086">||</span>&nbsp;<span class="builtinfunc" id="3802089">cap</span><span class="op" id="3802092">(</span><span class="ident" id="3802093">x</span><span class="op" id="3802094">.</span><span class="ident" id="3802095">data</span><span class="op" id="3802099">)</span>&nbsp;<span class="op" id="3802101">&lt;</span>&nbsp;<span class="ident" id="3802103">n</span>&nbsp;<span class="op" id="3802105">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3802109">//&nbsp;new&nbsp;data&nbsp;is&nbsp;significantly&nbsp;smaller&nbsp;or&nbsp;larger&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3802163">//&nbsp;existing&nbsp;buffers&nbsp;-&nbsp;allocate&nbsp;new&nbsp;ones</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802205">x</span><span class="op" id="3802206">.</span><span class="ident" id="3802207">data</span>&nbsp;<span class="op" id="3802212">=</span>&nbsp;<span class="builtinfunc" id="3802214">make</span><span class="op" id="3802218">(</span><span class="op" id="3802219">[</span><span class="op" id="3802220">]</span><span class="builtintype" id="3802221">byte</span><span class="op" id="3802225">,</span>&nbsp;<span class="ident" id="3802227">n</span><span class="op" id="3802228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802232">x</span><span class="op" id="3802233">.</span><span class="ident" id="3802234">sa</span>&nbsp;<span class="op" id="3802237">=</span>&nbsp;<span class="builtinfunc" id="3802239">make</span><span class="op" id="3802243">(</span><span class="op" id="3802244">[</span><span class="op" id="3802245">]</span><span class="builtintype" id="3802246">int</span><span class="op" id="3802249">,</span>&nbsp;<span class="ident" id="3802251">n</span><span class="op" id="3802252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802255">}</span>&nbsp;<span class="keyword" id="3802257">else</span>&nbsp;<span class="op" id="3802262">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3802266">//&nbsp;re-use&nbsp;existing&nbsp;buffers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802295">x</span><span class="op" id="3802296">.</span><span class="ident" id="3802297">data</span>&nbsp;<span class="op" id="3802302">=</span>&nbsp;<span class="ident" id="3802304">x</span><span class="op" id="3802305">.</span><span class="ident" id="3802306">data</span><span class="op" id="3802310">[</span><span class="num" id="3802311">0</span><span class="op" id="3802312">:</span><span class="ident" id="3802313">n</span><span class="op" id="3802314">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802318">x</span><span class="op" id="3802319">.</span><span class="ident" id="3802320">sa</span>&nbsp;<span class="op" id="3802323">=</span>&nbsp;<span class="ident" id="3802325">x</span><span class="op" id="3802326">.</span><span class="ident" id="3802327">sa</span><span class="op" id="3802329">[</span><span class="num" id="3802330">0</span><span class="op" id="3802331">:</span><span class="ident" id="3802332">n</span><span class="op" id="3802333">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3802340">//&nbsp;read&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802354">if</span>&nbsp;<span class="ident" id="3802357">_</span><span class="op" id="3802358">,</span>&nbsp;<span class="ident" id="3802360">err</span>&nbsp;<span class="op" id="3802364">:=</span>&nbsp;<span class="ident" id="3802367">io</span><span class="op" id="3802369">.</span><span class="ident" id="3802370">ReadFull</span><span class="op" id="3802378">(</span><span class="ident" id="3802379">r</span><span class="op" id="3802380">,</span>&nbsp;<span class="ident" id="3802382">x</span><span class="op" id="3802383">.</span><span class="ident" id="3802384">data</span><span class="op" id="3802388">)</span><span class="op" id="3802389">;</span>&nbsp;<span class="ident" id="3802391">err</span>&nbsp;<span class="op" id="3802395">!=</span>&nbsp;<span class="builtintype" id="3802398">nil</span>&nbsp;<span class="op" id="3802402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802406">return</span>&nbsp;<span class="ident" id="3802413">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3802422">//&nbsp;read&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802437">for</span>&nbsp;<span class="ident" id="3802441">sa</span>&nbsp;<span class="op" id="3802444">:=</span>&nbsp;<span class="ident" id="3802447">x</span><span class="op" id="3802448">.</span><span class="ident" id="3802449">sa</span><span class="op" id="3802451">;</span>&nbsp;<span class="builtinfunc" id="3802453">len</span><span class="op" id="3802456">(</span><span class="ident" id="3802457">sa</span><span class="op" id="3802459">)</span>&nbsp;<span class="op" id="3802461">&gt;</span>&nbsp;<span class="num" id="3802463">0</span><span class="op" id="3802464">;</span>&nbsp;<span class="op" id="3802466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802470">n</span><span class="op" id="3802471">,</span>&nbsp;<span class="ident" id="3802473">err</span>&nbsp;<span class="op" id="3802477">:=</span>&nbsp;<span class="ident" id="3802480">readSlice</span><span class="op" id="3802489">(</span><span class="ident" id="3802490">r</span><span class="op" id="3802491">,</span>&nbsp;<span class="ident" id="3802493">buf</span><span class="op" id="3802496">,</span>&nbsp;<span class="ident" id="3802498">sa</span><span class="op" id="3802500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802504">if</span>&nbsp;<span class="ident" id="3802507">err</span>&nbsp;<span class="op" id="3802511">!=</span>&nbsp;<span class="builtintype" id="3802514">nil</span>&nbsp;<span class="op" id="3802518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802523">return</span>&nbsp;<span class="ident" id="3802530">err</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802540">sa</span>&nbsp;<span class="op" id="3802543">=</span>&nbsp;<span class="ident" id="3802545">sa</span><span class="op" id="3802547">[</span><span class="ident" id="3802548">n</span><span class="op" id="3802549">:</span><span class="op" id="3802550">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802556">return</span>&nbsp;<span class="builtintype" id="3802563">nil</span><br>
<span class="lineno"></span><span class="op" id="3802567">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="3802570">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;index&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3802604">func</span>&nbsp;<span class="op" id="3802609">(</span><span class="ident" id="3802610">x</span>&nbsp;<span class="op" id="3802612">*</span><span class="ident" id="3802613">Index</span><span class="op" id="3802618">)</span>&nbsp;<span class="ident" id="3802620">Write</span><span class="op" id="3802625">(</span><span class="ident" id="3802626">w</span>&nbsp;<span class="ident" id="3802628">io</span><span class="op" id="3802630">.</span><span class="ident" id="3802631">Writer</span><span class="op" id="3802637">)</span>&nbsp;<span class="builtintype" id="3802639">error</span>&nbsp;<span class="op" id="3802645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3802648">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802674">buf</span>&nbsp;<span class="op" id="3802678">:=</span>&nbsp;<span class="builtinfunc" id="3802681">make</span><span class="op" id="3802685">(</span><span class="op" id="3802686">[</span><span class="op" id="3802687">]</span><span class="builtintype" id="3802688">byte</span><span class="op" id="3802692">,</span>&nbsp;<span class="ident" id="3802694">bufSize</span><span class="op" id="3802701">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3802705">//&nbsp;write&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802722">if</span>&nbsp;<span class="ident" id="3802725">err</span>&nbsp;<span class="op" id="3802729">:=</span>&nbsp;<span class="ident" id="3802732">writeInt</span><span class="op" id="3802740">(</span><span class="ident" id="3802741">w</span><span class="op" id="3802742">,</span>&nbsp;<span class="ident" id="3802744">buf</span><span class="op" id="3802747">,</span>&nbsp;<span class="builtinfunc" id="3802749">len</span><span class="op" id="3802752">(</span><span class="ident" id="3802753">x</span><span class="op" id="3802754">.</span><span class="ident" id="3802755">data</span><span class="op" id="3802759">)</span><span class="op" id="3802760">)</span><span class="op" id="3802761">;</span>&nbsp;<span class="ident" id="3802763">err</span>&nbsp;<span class="op" id="3802767">!=</span>&nbsp;<span class="builtintype" id="3802770">nil</span>&nbsp;<span class="op" id="3802774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802778">return</span>&nbsp;<span class="ident" id="3802785">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802790">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3802794">//&nbsp;write&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802809">if</span>&nbsp;<span class="ident" id="3802812">_</span><span class="op" id="3802813">,</span>&nbsp;<span class="ident" id="3802815">err</span>&nbsp;<span class="op" id="3802819">:=</span>&nbsp;<span class="ident" id="3802822">w</span><span class="op" id="3802823">.</span><span class="ident" id="3802824">Write</span><span class="op" id="3802829">(</span><span class="ident" id="3802830">x</span><span class="op" id="3802831">.</span><span class="ident" id="3802832">data</span><span class="op" id="3802836">)</span><span class="op" id="3802837">;</span>&nbsp;<span class="ident" id="3802839">err</span>&nbsp;<span class="op" id="3802843">!=</span>&nbsp;<span class="builtintype" id="3802846">nil</span>&nbsp;<span class="op" id="3802850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802854">return</span>&nbsp;<span class="ident" id="3802861">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802866">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3802870">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802886">for</span>&nbsp;<span class="ident" id="3802890">sa</span>&nbsp;<span class="op" id="3802893">:=</span>&nbsp;<span class="ident" id="3802896">x</span><span class="op" id="3802897">.</span><span class="ident" id="3802898">sa</span><span class="op" id="3802900">;</span>&nbsp;<span class="builtinfunc" id="3802902">len</span><span class="op" id="3802905">(</span><span class="ident" id="3802906">sa</span><span class="op" id="3802908">)</span>&nbsp;<span class="op" id="3802910">&gt;</span>&nbsp;<span class="num" id="3802912">0</span><span class="op" id="3802913">;</span>&nbsp;<span class="op" id="3802915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802919">n</span><span class="op" id="3802920">,</span>&nbsp;<span class="ident" id="3802922">err</span>&nbsp;<span class="op" id="3802926">:=</span>&nbsp;<span class="ident" id="3802929">writeSlice</span><span class="op" id="3802939">(</span><span class="ident" id="3802940">w</span><span class="op" id="3802941">,</span>&nbsp;<span class="ident" id="3802943">buf</span><span class="op" id="3802946">,</span>&nbsp;<span class="ident" id="3802948">sa</span><span class="op" id="3802950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802954">if</span>&nbsp;<span class="ident" id="3802957">err</span>&nbsp;<span class="op" id="3802961">!=</span>&nbsp;<span class="builtintype" id="3802964">nil</span>&nbsp;<span class="op" id="3802968">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802973">return</span>&nbsp;<span class="ident" id="3802980">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802990">sa</span>&nbsp;<span class="op" id="3802993">=</span>&nbsp;<span class="ident" id="3802995">sa</span><span class="op" id="3802997">[</span><span class="ident" id="3802998">n</span><span class="op" id="3802999">:</span><span class="op" id="3803000">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3803003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3803006">return</span>&nbsp;<span class="builtintype" id="3803013">nil</span><br>
<span class="lineno">160</span><span class="op" id="3803017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3803020">//&nbsp;Bytes&nbsp;returns&nbsp;the&nbsp;data&nbsp;over&nbsp;which&nbsp;the&nbsp;index&nbsp;was&nbsp;created.</span><br>
<span class="lineno"></span><span class="comment" id="3803080">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="comment" id="3803108">//</span><br>
<span class="lineno">165</span><span class="keyword" id="3803111">func</span>&nbsp;<span class="op" id="3803116">(</span><span class="ident" id="3803117">x</span>&nbsp;<span class="op" id="3803119">*</span><span class="ident" id="3803120">Index</span><span class="op" id="3803125">)</span>&nbsp;<span class="ident" id="3803127">Bytes</span><span class="op" id="3803132">(</span><span class="op" id="3803133">)</span>&nbsp;<span class="op" id="3803135">[</span><span class="op" id="3803136">]</span><span class="builtintype" id="3803137">byte</span>&nbsp;<span class="op" id="3803142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3803145">return</span>&nbsp;<span class="ident" id="3803152">x</span><span class="op" id="3803153">.</span><span class="ident" id="3803154">data</span><br>
<span class="lineno"></span><span class="op" id="3803159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3803162">func</span>&nbsp;<span class="op" id="3803167">(</span><span class="ident" id="3803168">x</span>&nbsp;<span class="op" id="3803170">*</span><span class="ident" id="3803171">Index</span><span class="op" id="3803176">)</span>&nbsp;<span class="ident" id="3803178">at</span><span class="op" id="3803180">(</span><span class="ident" id="3803181">i</span>&nbsp;<span class="builtintype" id="3803183">int</span><span class="op" id="3803186">)</span>&nbsp;<span class="op" id="3803188">[</span><span class="op" id="3803189">]</span><span class="builtintype" id="3803190">byte</span>&nbsp;<span class="op" id="3803195">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3803198">return</span>&nbsp;<span class="ident" id="3803205">x</span><span class="op" id="3803206">.</span><span class="ident" id="3803207">data</span><span class="op" id="3803211">[</span><span class="ident" id="3803212">x</span><span class="op" id="3803213">.</span><span class="ident" id="3803214">sa</span><span class="op" id="3803216">[</span><span class="ident" id="3803217">i</span><span class="op" id="3803218">]</span><span class="op" id="3803219">:</span><span class="op" id="3803220">]</span><br>
<span class="lineno"></span><span class="op" id="3803222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3803225">//&nbsp;lookupAll&nbsp;returns&nbsp;a&nbsp;slice&nbsp;into&nbsp;the&nbsp;matching&nbsp;region&nbsp;of&nbsp;the&nbsp;index.</span><br>
<span class="lineno"></span><span class="comment" id="3803293">//&nbsp;The&nbsp;runtime&nbsp;is&nbsp;O(log(N)*len(s)).</span><br>
<span class="lineno">175</span><span class="keyword" id="3803329">func</span>&nbsp;<span class="op" id="3803334">(</span><span class="ident" id="3803335">x</span>&nbsp;<span class="op" id="3803337">*</span><span class="ident" id="3803338">Index</span><span class="op" id="3803343">)</span>&nbsp;<span class="ident" id="3803345">lookupAll</span><span class="op" id="3803354">(</span><span class="ident" id="3803355">s</span>&nbsp;<span class="op" id="3803357">[</span><span class="op" id="3803358">]</span><span class="builtintype" id="3803359">byte</span><span class="op" id="3803363">)</span>&nbsp;<span class="op" id="3803365">[</span><span class="op" id="3803366">]</span><span class="builtintype" id="3803367">int</span>&nbsp;<span class="op" id="3803371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3803374">//&nbsp;find&nbsp;matching&nbsp;suffix&nbsp;index&nbsp;range&nbsp;[i:j]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3803417">//&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;where&nbsp;s&nbsp;would&nbsp;be&nbsp;the&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3803470">i</span>&nbsp;<span class="op" id="3803472">:=</span>&nbsp;<span class="ident" id="3803475">sort</span><span class="op" id="3803479">.</span><span class="ident" id="3803480">Search</span><span class="op" id="3803486">(</span><span class="builtinfunc" id="3803487">len</span><span class="op" id="3803490">(</span><span class="ident" id="3803491">x</span><span class="op" id="3803492">.</span><span class="ident" id="3803493">sa</span><span class="op" id="3803495">)</span><span class="op" id="3803496">,</span>&nbsp;<span class="keyword" id="3803498">func</span><span class="op" id="3803502">(</span><span class="ident" id="3803503">i</span>&nbsp;<span class="builtintype" id="3803505">int</span><span class="op" id="3803508">)</span>&nbsp;<span class="builtintype" id="3803510">bool</span>&nbsp;<span class="op" id="3803515">{</span>&nbsp;<span class="keyword" id="3803517">return</span>&nbsp;<span class="ident" id="3803524">bytes</span><span class="op" id="3803529">.</span><span class="ident" id="3803530">Compare</span><span class="op" id="3803537">(</span><span class="ident" id="3803538">x</span><span class="op" id="3803539">.</span><span class="ident" id="3803540">at</span><span class="op" id="3803542">(</span><span class="ident" id="3803543">i</span><span class="op" id="3803544">)</span><span class="op" id="3803545">,</span>&nbsp;<span class="ident" id="3803547">s</span><span class="op" id="3803548">)</span>&nbsp;<span class="op" id="3803550">&gt;=</span>&nbsp;<span class="num" id="3803553">0</span>&nbsp;<span class="op" id="3803555">}</span><span class="op" id="3803556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3803559">//&nbsp;starting&nbsp;at&nbsp;i,&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;at&nbsp;which&nbsp;s&nbsp;is&nbsp;not&nbsp;a&nbsp;prefix</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3803626">j</span>&nbsp;<span class="op" id="3803628">:=</span>&nbsp;<span class="ident" id="3803631">i</span>&nbsp;<span class="op" id="3803633">+</span>&nbsp;<span class="ident" id="3803635">sort</span><span class="op" id="3803639">.</span><span class="ident" id="3803640">Search</span><span class="op" id="3803646">(</span><span class="builtinfunc" id="3803647">len</span><span class="op" id="3803650">(</span><span class="ident" id="3803651">x</span><span class="op" id="3803652">.</span><span class="ident" id="3803653">sa</span><span class="op" id="3803655">)</span><span class="op" id="3803656">-</span><span class="ident" id="3803657">i</span><span class="op" id="3803658">,</span>&nbsp;<span class="keyword" id="3803660">func</span><span class="op" id="3803664">(</span><span class="ident" id="3803665">j</span>&nbsp;<span class="builtintype" id="3803667">int</span><span class="op" id="3803670">)</span>&nbsp;<span class="builtintype" id="3803672">bool</span>&nbsp;<span class="op" id="3803677">{</span>&nbsp;<span class="keyword" id="3803679">return</span>&nbsp;<span class="op" id="3803686">!</span><span class="ident" id="3803687">bytes</span><span class="op" id="3803692">.</span><span class="ident" id="3803693">HasPrefix</span><span class="op" id="3803702">(</span><span class="ident" id="3803703">x</span><span class="op" id="3803704">.</span><span class="ident" id="3803705">at</span><span class="op" id="3803707">(</span><span class="ident" id="3803708">j</span><span class="op" id="3803709">+</span><span class="ident" id="3803710">i</span><span class="op" id="3803711">)</span><span class="op" id="3803712">,</span>&nbsp;<span class="ident" id="3803714">s</span><span class="op" id="3803715">)</span>&nbsp;<span class="op" id="3803717">}</span><span class="op" id="3803718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3803721">return</span>&nbsp;<span class="ident" id="3803728">x</span><span class="op" id="3803729">.</span><span class="ident" id="3803730">sa</span><span class="op" id="3803732">[</span><span class="ident" id="3803733">i</span><span class="op" id="3803734">:</span><span class="ident" id="3803735">j</span><span class="op" id="3803736">]</span><br>
<span class="lineno"></span><span class="op" id="3803738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3803741">//&nbsp;Lookup&nbsp;returns&nbsp;an&nbsp;unsorted&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;n&nbsp;indices&nbsp;where&nbsp;the&nbsp;byte&nbsp;string&nbsp;s</span><br>
<span class="lineno">185</span><span class="comment" id="3803821">//&nbsp;occurs&nbsp;in&nbsp;the&nbsp;indexed&nbsp;data.&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;occurrences&nbsp;are&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="3803892">//&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;s&nbsp;is&nbsp;empty,&nbsp;s&nbsp;is&nbsp;not&nbsp;found,&nbsp;or&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3803955">//&nbsp;Lookup&nbsp;time&nbsp;is&nbsp;O(log(N)*len(s)&nbsp;+&nbsp;len(result))&nbsp;where&nbsp;N&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3804019">//&nbsp;size&nbsp;of&nbsp;the&nbsp;indexed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="3804048">//</span><br>
<span class="lineno">190</span><span class="keyword" id="3804051">func</span>&nbsp;<span class="op" id="3804056">(</span><span class="ident" id="3804057">x</span>&nbsp;<span class="op" id="3804059">*</span><span class="ident" id="3804060">Index</span><span class="op" id="3804065">)</span>&nbsp;<span class="ident" id="3804067">Lookup</span><span class="op" id="3804073">(</span><span class="ident" id="3804074">s</span>&nbsp;<span class="op" id="3804076">[</span><span class="op" id="3804077">]</span><span class="builtintype" id="3804078">byte</span><span class="op" id="3804082">,</span>&nbsp;<span class="ident" id="3804084">n</span>&nbsp;<span class="builtintype" id="3804086">int</span><span class="op" id="3804089">)</span>&nbsp;<span class="op" id="3804091">(</span><span class="ident" id="3804092">result</span>&nbsp;<span class="op" id="3804099">[</span><span class="op" id="3804100">]</span><span class="builtintype" id="3804101">int</span><span class="op" id="3804104">)</span>&nbsp;<span class="op" id="3804106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3804109">if</span>&nbsp;<span class="builtinfunc" id="3804112">len</span><span class="op" id="3804115">(</span><span class="ident" id="3804116">s</span><span class="op" id="3804117">)</span>&nbsp;<span class="op" id="3804119">&gt;</span>&nbsp;<span class="num" id="3804121">0</span>&nbsp;<span class="op" id="3804123">&amp;&amp;</span>&nbsp;<span class="ident" id="3804126">n</span>&nbsp;<span class="op" id="3804128">!=</span>&nbsp;<span class="num" id="3804131">0</span>&nbsp;<span class="op" id="3804133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804137">matches</span>&nbsp;<span class="op" id="3804145">:=</span>&nbsp;<span class="ident" id="3804148">x</span><span class="op" id="3804149">.</span><span class="ident" id="3804150">lookupAll</span><span class="op" id="3804159">(</span><span class="ident" id="3804160">s</span><span class="op" id="3804161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3804165">if</span>&nbsp;<span class="ident" id="3804168">n</span>&nbsp;<span class="op" id="3804170">&lt;</span>&nbsp;<span class="num" id="3804172">0</span>&nbsp;<span class="op" id="3804174">||</span>&nbsp;<span class="builtinfunc" id="3804177">len</span><span class="op" id="3804180">(</span><span class="ident" id="3804181">matches</span><span class="op" id="3804188">)</span>&nbsp;<span class="op" id="3804190">&lt;</span>&nbsp;<span class="ident" id="3804192">n</span>&nbsp;<span class="op" id="3804194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804199">n</span>&nbsp;<span class="op" id="3804201">=</span>&nbsp;<span class="builtinfunc" id="3804203">len</span><span class="op" id="3804206">(</span><span class="ident" id="3804207">matches</span><span class="op" id="3804214">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3804218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3804222">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(matches)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3804250">if</span>&nbsp;<span class="ident" id="3804253">n</span>&nbsp;<span class="op" id="3804255">&gt;</span>&nbsp;<span class="num" id="3804257">0</span>&nbsp;<span class="op" id="3804259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804264">result</span>&nbsp;<span class="op" id="3804271">=</span>&nbsp;<span class="builtinfunc" id="3804273">make</span><span class="op" id="3804277">(</span><span class="op" id="3804278">[</span><span class="op" id="3804279">]</span><span class="builtintype" id="3804280">int</span><span class="op" id="3804283">,</span>&nbsp;<span class="ident" id="3804285">n</span><span class="op" id="3804286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3804291">copy</span><span class="op" id="3804295">(</span><span class="ident" id="3804296">result</span><span class="op" id="3804302">,</span>&nbsp;<span class="ident" id="3804304">matches</span><span class="op" id="3804311">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3804315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3804318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3804321">return</span><br>
<span class="lineno"></span><span class="op" id="3804328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="3804331">//&nbsp;FindAllIndex&nbsp;returns&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;non-overlapping&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3804403">//&nbsp;regular&nbsp;expression&nbsp;r,&nbsp;where&nbsp;a&nbsp;match&nbsp;is&nbsp;a&nbsp;pair&nbsp;of&nbsp;indices&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="3804474">//&nbsp;the&nbsp;matched&nbsp;slice&nbsp;of&nbsp;x.Bytes().&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;matches&nbsp;are&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="3804544">//&nbsp;in&nbsp;successive&nbsp;order.&nbsp;Otherwise,&nbsp;at&nbsp;most&nbsp;n&nbsp;matches&nbsp;are&nbsp;returned&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3804614">//&nbsp;they&nbsp;may&nbsp;not&nbsp;be&nbsp;successive.&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;matches,</span><br>
<span class="lineno">210</span><span class="comment" id="3804688">//&nbsp;or&nbsp;if&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3804705">//</span><br>
<span class="lineno"></span><span class="keyword" id="3804708">func</span>&nbsp;<span class="op" id="3804713">(</span><span class="ident" id="3804714">x</span>&nbsp;<span class="op" id="3804716">*</span><span class="ident" id="3804717">Index</span><span class="op" id="3804722">)</span>&nbsp;<span class="ident" id="3804724">FindAllIndex</span><span class="op" id="3804736">(</span><span class="ident" id="3804737">r</span>&nbsp;<span class="op" id="3804739">*</span><span class="ident" id="3804740">regexp</span><span class="op" id="3804746">.</span><span class="ident" id="3804747">Regexp</span><span class="op" id="3804753">,</span>&nbsp;<span class="ident" id="3804755">n</span>&nbsp;<span class="builtintype" id="3804757">int</span><span class="op" id="3804760">)</span>&nbsp;<span class="op" id="3804762">(</span><span class="ident" id="3804763">result</span>&nbsp;<span class="op" id="3804770">[</span><span class="op" id="3804771">]</span><span class="op" id="3804772">[</span><span class="op" id="3804773">]</span><span class="builtintype" id="3804774">int</span><span class="op" id="3804777">)</span>&nbsp;<span class="op" id="3804779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3804782">//&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix&nbsp;is&nbsp;used&nbsp;to&nbsp;determine&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3804843">//&nbsp;match&nbsp;start&nbsp;indices&nbsp;with&nbsp;Lookup</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804879">prefix</span><span class="op" id="3804885">,</span>&nbsp;<span class="ident" id="3804887">complete</span>&nbsp;<span class="op" id="3804896">:=</span>&nbsp;<span class="ident" id="3804899">r</span><span class="op" id="3804900">.</span><span class="ident" id="3804901">LiteralPrefix</span><span class="op" id="3804914">(</span><span class="op" id="3804915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804918">lit</span>&nbsp;<span class="op" id="3804922">:=</span>&nbsp;<span class="op" id="3804925">[</span><span class="op" id="3804926">]</span><span class="builtintype" id="3804927">byte</span><span class="op" id="3804931">(</span><span class="ident" id="3804932">prefix</span><span class="op" id="3804938">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3804942">//&nbsp;worst-case&nbsp;scenario:&nbsp;no&nbsp;literal&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3804985">if</span>&nbsp;<span class="ident" id="3804988">prefix</span>&nbsp;<span class="op" id="3804995">==</span>&nbsp;<span class="string" id="3804998">&#34;&#34;</span>&nbsp;<span class="op" id="3805001">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3805005">return</span>&nbsp;<span class="ident" id="3805012">r</span><span class="op" id="3805013">.</span><span class="ident" id="3805014">FindAllIndex</span><span class="op" id="3805026">(</span><span class="ident" id="3805027">x</span><span class="op" id="3805028">.</span><span class="ident" id="3805029">data</span><span class="op" id="3805033">,</span>&nbsp;<span class="ident" id="3805035">n</span><span class="op" id="3805036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3805039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805043">//&nbsp;if&nbsp;regexp&nbsp;is&nbsp;a&nbsp;literal&nbsp;just&nbsp;use&nbsp;Lookup&nbsp;and&nbsp;convert&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805102">//&nbsp;result&nbsp;into&nbsp;match&nbsp;pairs</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3805130">if</span>&nbsp;<span class="ident" id="3805133">complete</span>&nbsp;<span class="op" id="3805142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805146">//&nbsp;Lookup&nbsp;returns&nbsp;indices&nbsp;that&nbsp;may&nbsp;belong&nbsp;to&nbsp;overlapping&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805214">//&nbsp;After&nbsp;eliminating&nbsp;them,&nbsp;we&nbsp;may&nbsp;end&nbsp;up&nbsp;with&nbsp;fewer&nbsp;than&nbsp;n&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805284">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;enough&nbsp;at&nbsp;the&nbsp;end,&nbsp;redo&nbsp;the&nbsp;search&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805349">//&nbsp;increased&nbsp;value&nbsp;n1,&nbsp;but&nbsp;only&nbsp;if&nbsp;Lookup&nbsp;returned&nbsp;all&nbsp;the&nbsp;requested</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805420">//&nbsp;indices&nbsp;in&nbsp;the&nbsp;first&nbsp;place&nbsp;(if&nbsp;it&nbsp;returned&nbsp;fewer&nbsp;than&nbsp;that&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805489">//&nbsp;there&nbsp;cannot&nbsp;be&nbsp;more).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3805517">for</span>&nbsp;<span class="ident" id="3805521">n1</span>&nbsp;<span class="op" id="3805524">:=</span>&nbsp;<span class="ident" id="3805527">n</span><span class="op" id="3805528">;</span>&nbsp;<span class="op" id="3805530">;</span>&nbsp;<span class="ident" id="3805532">n1</span>&nbsp;<span class="op" id="3805535">+=</span>&nbsp;<span class="num" id="3805538">2</span>&nbsp;<span class="op" id="3805540">*</span>&nbsp;<span class="op" id="3805542">(</span><span class="ident" id="3805543">n</span>&nbsp;<span class="op" id="3805545">-</span>&nbsp;<span class="builtinfunc" id="3805547">len</span><span class="op" id="3805550">(</span><span class="ident" id="3805551">result</span><span class="op" id="3805557">)</span><span class="op" id="3805558">)</span>&nbsp;<span class="comment" id="3805560">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="3805578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805583">indices</span>&nbsp;<span class="op" id="3805591">:=</span>&nbsp;<span class="ident" id="3805594">x</span><span class="op" id="3805595">.</span><span class="ident" id="3805596">Lookup</span><span class="op" id="3805602">(</span><span class="ident" id="3805603">lit</span><span class="op" id="3805606">,</span>&nbsp;<span class="ident" id="3805608">n1</span><span class="op" id="3805610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3805615">if</span>&nbsp;<span class="builtinfunc" id="3805618">len</span><span class="op" id="3805621">(</span><span class="ident" id="3805622">indices</span><span class="op" id="3805629">)</span>&nbsp;<span class="op" id="3805631">==</span>&nbsp;<span class="num" id="3805634">0</span>&nbsp;<span class="op" id="3805636">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3805642">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3805652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805657">sort</span><span class="op" id="3805661">.</span><span class="ident" id="3805662">Ints</span><span class="op" id="3805666">(</span><span class="ident" id="3805667">indices</span><span class="op" id="3805674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805679">pairs</span>&nbsp;<span class="op" id="3805685">:=</span>&nbsp;<span class="builtinfunc" id="3805688">make</span><span class="op" id="3805692">(</span><span class="op" id="3805693">[</span><span class="op" id="3805694">]</span><span class="builtintype" id="3805695">int</span><span class="op" id="3805698">,</span>&nbsp;<span class="num" id="3805700">2</span><span class="op" id="3805701">*</span><span class="builtinfunc" id="3805702">len</span><span class="op" id="3805705">(</span><span class="ident" id="3805706">indices</span><span class="op" id="3805713">)</span><span class="op" id="3805714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805719">result</span>&nbsp;<span class="op" id="3805726">=</span>&nbsp;<span class="builtinfunc" id="3805728">make</span><span class="op" id="3805732">(</span><span class="op" id="3805733">[</span><span class="op" id="3805734">]</span><span class="op" id="3805735">[</span><span class="op" id="3805736">]</span><span class="builtintype" id="3805737">int</span><span class="op" id="3805740">,</span>&nbsp;<span class="builtinfunc" id="3805742">len</span><span class="op" id="3805745">(</span><span class="ident" id="3805746">indices</span><span class="op" id="3805753">)</span><span class="op" id="3805754">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805759">count</span>&nbsp;<span class="op" id="3805765">:=</span>&nbsp;<span class="num" id="3805768">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805773">prev</span>&nbsp;<span class="op" id="3805778">:=</span>&nbsp;<span class="num" id="3805781">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3805786">for</span>&nbsp;<span class="ident" id="3805790">_</span><span class="op" id="3805791">,</span>&nbsp;<span class="ident" id="3805793">i</span>&nbsp;<span class="op" id="3805795">:=</span>&nbsp;<span class="keyword" id="3805798">range</span>&nbsp;<span class="ident" id="3805804">indices</span>&nbsp;<span class="op" id="3805812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3805818">if</span>&nbsp;<span class="ident" id="3805821">count</span>&nbsp;<span class="op" id="3805827">==</span>&nbsp;<span class="ident" id="3805830">n</span>&nbsp;<span class="op" id="3805832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3805839">break</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3805849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805855">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3805908">if</span>&nbsp;<span class="ident" id="3805911">prev</span>&nbsp;<span class="op" id="3805916">&lt;=</span>&nbsp;<span class="ident" id="3805919">i</span>&nbsp;<span class="op" id="3805921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805928">j</span>&nbsp;<span class="op" id="3805930">:=</span>&nbsp;<span class="num" id="3805933">2</span>&nbsp;<span class="op" id="3805935">*</span>&nbsp;<span class="ident" id="3805937">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805948">pairs</span><span class="op" id="3805953">[</span><span class="ident" id="3805954">j</span><span class="op" id="3805955">+</span><span class="num" id="3805956">0</span><span class="op" id="3805957">]</span>&nbsp;<span class="op" id="3805959">=</span>&nbsp;<span class="ident" id="3805961">i</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805968">pairs</span><span class="op" id="3805973">[</span><span class="ident" id="3805974">j</span><span class="op" id="3805975">+</span><span class="num" id="3805976">1</span><span class="op" id="3805977">]</span>&nbsp;<span class="op" id="3805979">=</span>&nbsp;<span class="ident" id="3805981">i</span>&nbsp;<span class="op" id="3805983">+</span>&nbsp;<span class="builtinfunc" id="3805985">len</span><span class="op" id="3805988">(</span><span class="ident" id="3805989">lit</span><span class="op" id="3805992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805999">result</span><span class="op" id="3806005">[</span><span class="ident" id="3806006">count</span><span class="op" id="3806011">]</span>&nbsp;<span class="op" id="3806013">=</span>&nbsp;<span class="ident" id="3806015">pairs</span><span class="op" id="3806020">[</span><span class="ident" id="3806021">j</span>&nbsp;<span class="op" id="3806023">:</span>&nbsp;<span class="ident" id="3806025">j</span><span class="op" id="3806026">+</span><span class="num" id="3806027">2</span><span class="op" id="3806028">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3806035">count</span><span class="op" id="3806040">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3806048">prev</span>&nbsp;<span class="op" id="3806053">=</span>&nbsp;<span class="ident" id="3806055">i</span>&nbsp;<span class="op" id="3806057">+</span>&nbsp;<span class="builtinfunc" id="3806059">len</span><span class="op" id="3806062">(</span><span class="ident" id="3806063">lit</span><span class="op" id="3806066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3806072">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3806077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3806082">result</span>&nbsp;<span class="op" id="3806089">=</span>&nbsp;<span class="ident" id="3806091">result</span><span class="op" id="3806097">[</span><span class="num" id="3806098">0</span><span class="op" id="3806099">:</span><span class="ident" id="3806100">count</span><span class="op" id="3806105">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3806110">if</span>&nbsp;<span class="builtinfunc" id="3806113">len</span><span class="op" id="3806116">(</span><span class="ident" id="3806117">result</span><span class="op" id="3806123">)</span>&nbsp;<span class="op" id="3806125">&gt;=</span>&nbsp;<span class="ident" id="3806128">n</span>&nbsp;<span class="op" id="3806130">||</span>&nbsp;<span class="builtinfunc" id="3806133">len</span><span class="op" id="3806136">(</span><span class="ident" id="3806137">indices</span><span class="op" id="3806144">)</span>&nbsp;<span class="op" id="3806146">!=</span>&nbsp;<span class="ident" id="3806149">n1</span>&nbsp;<span class="op" id="3806152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3806158">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3806217">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3806251">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3806260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3806264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3806268">if</span>&nbsp;<span class="builtinfunc" id="3806271">len</span><span class="op" id="3806274">(</span><span class="ident" id="3806275">result</span><span class="op" id="3806281">)</span>&nbsp;<span class="op" id="3806283">==</span>&nbsp;<span class="num" id="3806286">0</span>&nbsp;<span class="op" id="3806288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3806293">result</span>&nbsp;<span class="op" id="3806300">=</span>&nbsp;<span class="builtintype" id="3806302">nil</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3806308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3806312">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3806320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3806324">//&nbsp;regexp&nbsp;has&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix;&nbsp;Lookup(lit)&nbsp;computes</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3806388">//&nbsp;the&nbsp;indices&nbsp;of&nbsp;possible&nbsp;complete&nbsp;matches;&nbsp;use&nbsp;these&nbsp;as&nbsp;starting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3806456">//&nbsp;points&nbsp;for&nbsp;anchored&nbsp;searches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3806489">//&nbsp;(regexp&nbsp;&#34;^&#34;&nbsp;matches&nbsp;beginning&nbsp;of&nbsp;input,&nbsp;not&nbsp;beginning&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3806556">r</span>&nbsp;<span class="op" id="3806558">=</span>&nbsp;<span class="ident" id="3806560">regexp</span><span class="op" id="3806566">.</span><span class="ident" id="3806567">MustCompile</span><span class="op" id="3806578">(</span><span class="string" id="3806579">&#34;^&#34;</span>&nbsp;<span class="op" id="3806583">+</span>&nbsp;<span class="ident" id="3806585">r</span><span class="op" id="3806586">.</span><span class="ident" id="3806587">String</span><span class="op" id="3806593">(</span><span class="op" id="3806594">)</span><span class="op" id="3806595">)</span>&nbsp;<span class="comment" id="3806597">//&nbsp;compiles&nbsp;because&nbsp;r&nbsp;compiled</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3806630">//&nbsp;same&nbsp;comment&nbsp;about&nbsp;Lookup&nbsp;applies&nbsp;here&nbsp;as&nbsp;in&nbsp;the&nbsp;loop&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3806694">for</span>&nbsp;<span class="ident" id="3806698">n1</span>&nbsp;<span class="op" id="3806701">:=</span>&nbsp;<span class="ident" id="3806704">n</span><span class="op" id="3806705">;</span>&nbsp;<span class="op" id="3806707">;</span>&nbsp;<span class="ident" id="3806709">n1</span>&nbsp;<span class="op" id="3806712">+=</span>&nbsp;<span class="num" id="3806715">2</span>&nbsp;<span class="op" id="3806717">*</span>&nbsp;<span class="op" id="3806719">(</span><span class="ident" id="3806720">n</span>&nbsp;<span class="op" id="3806722">-</span>&nbsp;<span class="builtinfunc" id="3806724">len</span><span class="op" id="3806727">(</span><span class="ident" id="3806728">result</span><span class="op" id="3806734">)</span><span class="op" id="3806735">)</span>&nbsp;<span class="comment" id="3806737">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="3806755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3806759">indices</span>&nbsp;<span class="op" id="3806767">:=</span>&nbsp;<span class="ident" id="3806770">x</span><span class="op" id="3806771">.</span><span class="ident" id="3806772">Lookup</span><span class="op" id="3806778">(</span><span class="ident" id="3806779">lit</span><span class="op" id="3806782">,</span>&nbsp;<span class="ident" id="3806784">n1</span><span class="op" id="3806786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3806790">if</span>&nbsp;<span class="builtinfunc" id="3806793">len</span><span class="op" id="3806796">(</span><span class="ident" id="3806797">indices</span><span class="op" id="3806804">)</span>&nbsp;<span class="op" id="3806806">==</span>&nbsp;<span class="num" id="3806809">0</span>&nbsp;<span class="op" id="3806811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3806816">return</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3806825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3806829">sort</span><span class="op" id="3806833">.</span><span class="ident" id="3806834">Ints</span><span class="op" id="3806838">(</span><span class="ident" id="3806839">indices</span><span class="op" id="3806846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3806850">result</span>&nbsp;<span class="op" id="3806857">=</span>&nbsp;<span class="ident" id="3806859">result</span><span class="op" id="3806865">[</span><span class="num" id="3806866">0</span><span class="op" id="3806867">:</span><span class="num" id="3806868">0</span><span class="op" id="3806869">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3806873">prev</span>&nbsp;<span class="op" id="3806878">:=</span>&nbsp;<span class="num" id="3806881">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3806885">for</span>&nbsp;<span class="ident" id="3806889">_</span><span class="op" id="3806890">,</span>&nbsp;<span class="ident" id="3806892">i</span>&nbsp;<span class="op" id="3806894">:=</span>&nbsp;<span class="keyword" id="3806897">range</span>&nbsp;<span class="ident" id="3806903">indices</span>&nbsp;<span class="op" id="3806911">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3806916">if</span>&nbsp;<span class="builtinfunc" id="3806919">len</span><span class="op" id="3806922">(</span><span class="ident" id="3806923">result</span><span class="op" id="3806929">)</span>&nbsp;<span class="op" id="3806931">==</span>&nbsp;<span class="ident" id="3806934">n</span>&nbsp;<span class="op" id="3806936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3806942">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3806951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3806956">m</span>&nbsp;<span class="op" id="3806958">:=</span>&nbsp;<span class="ident" id="3806961">r</span><span class="op" id="3806962">.</span><span class="ident" id="3806963">FindIndex</span><span class="op" id="3806972">(</span><span class="ident" id="3806973">x</span><span class="op" id="3806974">.</span><span class="ident" id="3806975">data</span><span class="op" id="3806979">[</span><span class="ident" id="3806980">i</span><span class="op" id="3806981">:</span><span class="op" id="3806982">]</span><span class="op" id="3806983">)</span>&nbsp;<span class="comment" id="3806985">//&nbsp;anchored&nbsp;search&nbsp;-&nbsp;will&nbsp;not&nbsp;run&nbsp;off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3807026">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3807078">if</span>&nbsp;<span class="ident" id="3807081">m</span>&nbsp;<span class="op" id="3807083">!=</span>&nbsp;<span class="builtintype" id="3807086">nil</span>&nbsp;<span class="op" id="3807090">&amp;&amp;</span>&nbsp;<span class="ident" id="3807093">prev</span>&nbsp;<span class="op" id="3807098">&lt;=</span>&nbsp;<span class="ident" id="3807101">i</span>&nbsp;<span class="op" id="3807103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3807109">m</span><span class="op" id="3807110">[</span><span class="num" id="3807111">0</span><span class="op" id="3807112">]</span>&nbsp;<span class="op" id="3807114">=</span>&nbsp;<span class="ident" id="3807116">i</span>&nbsp;<span class="comment" id="3807118">//&nbsp;correct&nbsp;m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3807135">m</span><span class="op" id="3807136">[</span><span class="num" id="3807137">1</span><span class="op" id="3807138">]</span>&nbsp;<span class="op" id="3807140">+=</span>&nbsp;<span class="ident" id="3807143">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3807149">result</span>&nbsp;<span class="op" id="3807156">=</span>&nbsp;<span class="builtinfunc" id="3807158">append</span><span class="op" id="3807164">(</span><span class="ident" id="3807165">result</span><span class="op" id="3807171">,</span>&nbsp;<span class="ident" id="3807173">m</span><span class="op" id="3807174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3807180">prev</span>&nbsp;<span class="op" id="3807185">=</span>&nbsp;<span class="ident" id="3807187">m</span><span class="op" id="3807188">[</span><span class="num" id="3807189">1</span><span class="op" id="3807190">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3807195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3807199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3807203">if</span>&nbsp;<span class="builtinfunc" id="3807206">len</span><span class="op" id="3807209">(</span><span class="ident" id="3807210">result</span><span class="op" id="3807216">)</span>&nbsp;<span class="op" id="3807218">&gt;=</span>&nbsp;<span class="ident" id="3807221">n</span>&nbsp;<span class="op" id="3807223">||</span>&nbsp;<span class="builtinfunc" id="3807226">len</span><span class="op" id="3807229">(</span><span class="ident" id="3807230">indices</span><span class="op" id="3807237">)</span>&nbsp;<span class="op" id="3807239">!=</span>&nbsp;<span class="ident" id="3807242">n1</span>&nbsp;<span class="op" id="3807245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3807250">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3807308">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3807341">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3807349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3807352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3807355">if</span>&nbsp;<span class="builtinfunc" id="3807358">len</span><span class="op" id="3807361">(</span><span class="ident" id="3807362">result</span><span class="op" id="3807368">)</span>&nbsp;<span class="op" id="3807370">==</span>&nbsp;<span class="num" id="3807373">0</span>&nbsp;<span class="op" id="3807375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3807379">result</span>&nbsp;<span class="op" id="3807386">=</span>&nbsp;<span class="builtintype" id="3807388">nil</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3807393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3807396">return</span><br>
<span class="lineno"></span><span class="op" id="3807403">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
