<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/link8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/link8/func.go.html">func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/layout.go.html">layout.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/link.go.html">link.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/linker.go.html">linker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/package.go.html">package.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/pkg_sym.go.html">pkg_sym.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/symbol.go.html">symbol.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/trace_used.go.html">trace_used.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/var.go.html">var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="3673883">package</span>&nbsp;<span class="ident" id="3673891">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3673898">import</span>&nbsp;<span class="op" id="3673905">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3673908">&#34;fmt&#34;</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3673916">&#34;lonnie.io/e8vm/arch8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3673939">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3673942">func</span>&nbsp;<span class="ident" id="3673947">layout</span><span class="op" id="3673953">(</span><span class="ident" id="3673954">used</span>&nbsp;<span class="op" id="3673959">[</span><span class="op" id="3673960">]</span><span class="ident" id="3673961">pkgSym</span><span class="op" id="3673967">)</span>&nbsp;<span class="op" id="3673969">(</span><span class="ident" id="3673970">funcs</span><span class="op" id="3673975">,</span>&nbsp;<span class="ident" id="3673977">vars</span>&nbsp;<span class="op" id="3673982">[</span><span class="op" id="3673983">]</span><span class="ident" id="3673984">pkgSym</span><span class="op" id="3673990">,</span>&nbsp;<span class="ident" id="3673992">e</span>&nbsp;<span class="builtintype" id="3673994">error</span><span class="op" id="3673999">)</span>&nbsp;<span class="op" id="3674001">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674004">//&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674013">pt</span>&nbsp;<span class="op" id="3674016">:=</span>&nbsp;<span class="builtintype" id="3674019">uint32</span><span class="op" id="3674025">(</span><span class="ident" id="3674026">arch8</span><span class="op" id="3674031">.</span><span class="ident" id="3674032">InitPC</span><span class="op" id="3674038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674041">codeMax</span>&nbsp;<span class="op" id="3674049">:=</span>&nbsp;<span class="builtintype" id="3674052">uint32</span><span class="op" id="3674058">(</span><span class="num" id="3674059">0xffffffff</span><span class="op" id="3674069">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674073">for</span>&nbsp;<span class="ident" id="3674077">_</span><span class="op" id="3674078">,</span>&nbsp;<span class="ident" id="3674080">ps</span>&nbsp;<span class="op" id="3674083">:=</span>&nbsp;<span class="keyword" id="3674086">range</span>&nbsp;<span class="ident" id="3674092">used</span>&nbsp;<span class="op" id="3674097">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674101">typ</span>&nbsp;<span class="op" id="3674105">:=</span>&nbsp;<span class="ident" id="3674108">ps</span><span class="op" id="3674110">.</span><span class="ident" id="3674111">Type</span><span class="op" id="3674115">(</span><span class="op" id="3674116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674120">switch</span>&nbsp;<span class="ident" id="3674127">typ</span>&nbsp;<span class="op" id="3674131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674135">case</span>&nbsp;<span class="ident" id="3674140">SymFunc</span><span class="op" id="3674147">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674152">funcs</span>&nbsp;<span class="op" id="3674158">=</span>&nbsp;<span class="builtinfunc" id="3674160">append</span><span class="op" id="3674166">(</span><span class="ident" id="3674167">funcs</span><span class="op" id="3674172">,</span>&nbsp;<span class="ident" id="3674174">ps</span><span class="op" id="3674176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674182">f</span>&nbsp;<span class="op" id="3674184">:=</span>&nbsp;<span class="ident" id="3674187">ps</span><span class="op" id="3674189">.</span><span class="ident" id="3674190">Func</span><span class="op" id="3674194">(</span><span class="op" id="3674195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674200">f</span><span class="op" id="3674201">.</span><span class="ident" id="3674202">addr</span>&nbsp;<span class="op" id="3674207">=</span>&nbsp;<span class="ident" id="3674209">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674215">size</span>&nbsp;<span class="op" id="3674220">:=</span>&nbsp;<span class="ident" id="3674223">f</span><span class="op" id="3674224">.</span><span class="ident" id="3674225">Size</span><span class="op" id="3674229">(</span><span class="op" id="3674230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674235">if</span>&nbsp;<span class="ident" id="3674238">size</span>&nbsp;<span class="op" id="3674243">&gt;</span>&nbsp;<span class="ident" id="3674245">codeMax</span><span class="op" id="3674252">-</span><span class="ident" id="3674253">pt</span>&nbsp;<span class="op" id="3674256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674262">return</span>&nbsp;<span class="ident" id="3674269">nil</span><span class="op" id="3674272">,</span>&nbsp;<span class="ident" id="3674274">nil</span><span class="op" id="3674277">,</span>&nbsp;<span class="ident" id="3674279">fmt</span><span class="op" id="3674282">.</span><span class="ident" id="3674283">Errorf</span><span class="op" id="3674289">(</span><span class="string" id="3674290">&#34;code&nbsp;section&nbsp;too&nbsp;large&#34;</span><span class="op" id="3674314">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674324">pt</span>&nbsp;<span class="op" id="3674327">+=</span>&nbsp;<span class="ident" id="3674330">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674337">case</span>&nbsp;<span class="ident" id="3674342">SymVar</span><span class="op" id="3674348">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674353">vars</span>&nbsp;<span class="op" id="3674358">=</span>&nbsp;<span class="builtinfunc" id="3674360">append</span><span class="op" id="3674366">(</span><span class="ident" id="3674367">vars</span><span class="op" id="3674371">,</span>&nbsp;<span class="ident" id="3674373">ps</span><span class="op" id="3674375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674379">default</span><span class="op" id="3674386">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3674391">panic</span><span class="op" id="3674396">(</span><span class="string" id="3674397">&#34;bug&#34;</span><span class="op" id="3674402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674413">dataMax</span>&nbsp;<span class="op" id="3674421">:=</span>&nbsp;<span class="builtintype" id="3674424">uint32</span><span class="op" id="3674430">(</span><span class="num" id="3674431">0xffffffff</span><span class="op" id="3674441">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674445">for</span>&nbsp;<span class="ident" id="3674449">_</span><span class="op" id="3674450">,</span>&nbsp;<span class="ident" id="3674452">ps</span>&nbsp;<span class="op" id="3674455">:=</span>&nbsp;<span class="keyword" id="3674458">range</span>&nbsp;<span class="ident" id="3674464">vars</span>&nbsp;<span class="op" id="3674469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674473">if</span>&nbsp;<span class="ident" id="3674476">ps</span><span class="op" id="3674478">.</span><span class="ident" id="3674479">Type</span><span class="op" id="3674483">(</span><span class="op" id="3674484">)</span>&nbsp;<span class="op" id="3674486">!=</span>&nbsp;<span class="ident" id="3674489">SymVar</span>&nbsp;<span class="op" id="3674496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3674501">panic</span><span class="op" id="3674506">(</span><span class="string" id="3674507">&#34;bug&#34;</span><span class="op" id="3674512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674516">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674521">v</span>&nbsp;<span class="op" id="3674523">:=</span>&nbsp;<span class="ident" id="3674526">ps</span><span class="op" id="3674528">.</span><span class="ident" id="3674529">Var</span><span class="op" id="3674532">(</span><span class="op" id="3674533">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674538">if</span>&nbsp;<span class="ident" id="3674541">v</span><span class="op" id="3674542">.</span><span class="ident" id="3674543">align</span>&nbsp;<span class="op" id="3674549">&gt;</span>&nbsp;<span class="num" id="3674551">1</span>&nbsp;<span class="op" id="3674553">&amp;&amp;</span>&nbsp;<span class="ident" id="3674556">pt</span><span class="op" id="3674558">%</span><span class="ident" id="3674559">v</span><span class="op" id="3674560">.</span><span class="ident" id="3674561">align</span>&nbsp;<span class="op" id="3674567">!=</span>&nbsp;<span class="num" id="3674570">0</span>&nbsp;<span class="op" id="3674572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674577">v</span><span class="op" id="3674578">.</span><span class="ident" id="3674579">prePad</span>&nbsp;<span class="op" id="3674586">=</span>&nbsp;<span class="ident" id="3674588">v</span><span class="op" id="3674589">.</span><span class="ident" id="3674590">align</span>&nbsp;<span class="op" id="3674596">-</span>&nbsp;<span class="ident" id="3674598">pt</span><span class="op" id="3674600">%</span><span class="ident" id="3674601">v</span><span class="op" id="3674602">.</span><span class="ident" id="3674603">align</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674612">pt</span>&nbsp;<span class="op" id="3674615">+=</span>&nbsp;<span class="ident" id="3674618">v</span><span class="op" id="3674619">.</span><span class="ident" id="3674620">prePad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674633">if</span>&nbsp;<span class="ident" id="3674636">v</span><span class="op" id="3674637">.</span><span class="ident" id="3674638">align</span>&nbsp;<span class="op" id="3674644">&gt;</span>&nbsp;<span class="num" id="3674646">1</span>&nbsp;<span class="op" id="3674648">&amp;&amp;</span>&nbsp;<span class="ident" id="3674651">pt</span><span class="op" id="3674653">%</span><span class="ident" id="3674654">v</span><span class="op" id="3674655">.</span><span class="ident" id="3674656">align</span>&nbsp;<span class="op" id="3674662">!=</span>&nbsp;<span class="num" id="3674665">0</span>&nbsp;<span class="op" id="3674667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3674672">panic</span><span class="op" id="3674677">(</span><span class="string" id="3674678">&#34;bug&#34;</span><span class="op" id="3674683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674687">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674692">v</span><span class="op" id="3674693">.</span><span class="ident" id="3674694">addr</span>&nbsp;<span class="op" id="3674699">=</span>&nbsp;<span class="ident" id="3674701">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674706">size</span>&nbsp;<span class="op" id="3674711">:=</span>&nbsp;<span class="ident" id="3674714">v</span><span class="op" id="3674715">.</span><span class="ident" id="3674716">Size</span><span class="op" id="3674720">(</span><span class="op" id="3674721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674725">if</span>&nbsp;<span class="ident" id="3674728">size</span>&nbsp;<span class="op" id="3674733">&gt;</span>&nbsp;<span class="ident" id="3674735">dataMax</span><span class="op" id="3674742">-</span><span class="ident" id="3674743">pt</span>&nbsp;<span class="op" id="3674746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674751">return</span>&nbsp;<span class="ident" id="3674758">nil</span><span class="op" id="3674761">,</span>&nbsp;<span class="ident" id="3674763">nil</span><span class="op" id="3674766">,</span>&nbsp;<span class="ident" id="3674768">fmt</span><span class="op" id="3674771">.</span><span class="ident" id="3674772">Errorf</span><span class="op" id="3674778">(</span><span class="string" id="3674779">&#34;binary&nbsp;too&nbsp;large&#34;</span><span class="op" id="3674797">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674806">pt</span>&nbsp;<span class="op" id="3674809">+=</span>&nbsp;<span class="ident" id="3674812">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674822">return</span><br>
<span class="lineno"></span><span class="op" id="3674829">}</span>
</div>
</body>
</html>
