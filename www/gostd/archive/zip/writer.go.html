<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6106120">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6106175">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6106229">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6106280">package</span>&nbsp;<span class="ident" id="6106288">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6106293">import</span>&nbsp;<span class="op" id="6106300">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6106303">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6106312">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6106331">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6106341">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6106349">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6106363">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6106368">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6106371">//&nbsp;TODO(adg):&nbsp;support&nbsp;zip&nbsp;file&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="6106411">//&nbsp;TODO(adg):&nbsp;support&nbsp;specifying&nbsp;deflate&nbsp;level</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6106459">//&nbsp;Writer&nbsp;implements&nbsp;a&nbsp;zip&nbsp;file&nbsp;writer.</span><br>
<span class="lineno">20</span><span class="keyword" id="6106499">type</span>&nbsp;<span class="ident" id="6106504">Writer</span>&nbsp;<span class="keyword" id="6106511">struct</span>&nbsp;<span class="op" id="6106518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6106521">cw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6106528">*</span><span class="ident" id="6106529">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6106542">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6106549">[</span><span class="op" id="6106550">]</span><span class="op" id="6106551">*</span><span class="ident" id="6106552">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6106560">last</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6106567">*</span><span class="ident" id="6106568">fileWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6106580">closed</span>&nbsp;<span class="builtintype" id="6106587">bool</span><br>
<span class="lineno">25</span><span class="op" id="6106592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6106595">type</span>&nbsp;<span class="ident" id="6106600">header</span>&nbsp;<span class="keyword" id="6106607">struct</span>&nbsp;<span class="op" id="6106614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6106617">*</span><span class="ident" id="6106618">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6106630">offset</span>&nbsp;<span class="ident" id="6106637">uint64</span><br>
<span class="lineno">30</span><span class="op" id="6106644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6106647">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;a&nbsp;zip&nbsp;file&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6106706">func</span>&nbsp;<span class="ident" id="6106711">NewWriter</span><span class="op" id="6106720">(</span><span class="ident" id="6106721">w</span>&nbsp;<span class="ident" id="6106723">io</span><span class="op" id="6106725">.</span><span class="ident" id="6106726">Writer</span><span class="op" id="6106732">)</span>&nbsp;<span class="op" id="6106734">*</span><span class="ident" id="6106735">Writer</span>&nbsp;<span class="op" id="6106742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6106745">return</span>&nbsp;<span class="op" id="6106752">&amp;</span><span class="ident" id="6106753">Writer</span><span class="op" id="6106759">{</span><span class="ident" id="6106760">cw</span><span class="op" id="6106762">:</span>&nbsp;<span class="op" id="6106764">&amp;</span><span class="ident" id="6106765">countWriter</span><span class="op" id="6106776">{</span><span class="ident" id="6106777">w</span><span class="op" id="6106778">:</span>&nbsp;<span class="ident" id="6106780">bufio</span><span class="op" id="6106785">.</span><span class="ident" id="6106786">NewWriter</span><span class="op" id="6106795">(</span><span class="ident" id="6106796">w</span><span class="op" id="6106797">)</span><span class="op" id="6106798">}</span><span class="op" id="6106799">}</span><br>
<span class="lineno">35</span><span class="op" id="6106801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6106804">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="6106865">//&nbsp;Calling&nbsp;Flush&nbsp;is&nbsp;not&nbsp;normally&nbsp;necessary;&nbsp;calling&nbsp;Close&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="keyword" id="6106938">func</span>&nbsp;<span class="op" id="6106943">(</span><span class="ident" id="6106944">w</span>&nbsp;<span class="op" id="6106946">*</span><span class="ident" id="6106947">Writer</span><span class="op" id="6106953">)</span>&nbsp;<span class="ident" id="6106955">Flush</span><span class="op" id="6106960">(</span><span class="op" id="6106961">)</span>&nbsp;<span class="builtintype" id="6106963">error</span>&nbsp;<span class="op" id="6106969">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6106972">return</span>&nbsp;<span class="ident" id="6106979">w</span><span class="op" id="6106980">.</span><span class="ident" id="6106981">cw</span><span class="op" id="6106983">.</span><span class="ident" id="6106984">w</span><span class="op" id="6106985">.</span><span class="op" id="6106986">(</span><span class="op" id="6106987">*</span><span class="ident" id="6106988">bufio</span><span class="op" id="6106993">.</span><span class="ident" id="6106994">Writer</span><span class="op" id="6107000">)</span><span class="op" id="6107001">.</span><span class="ident" id="6107002">Flush</span><span class="op" id="6107007">(</span><span class="op" id="6107008">)</span><br>
<span class="lineno"></span><span class="op" id="6107010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6107013">//&nbsp;Close&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;zip&nbsp;file&nbsp;by&nbsp;writing&nbsp;the&nbsp;central&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="6107086">//&nbsp;It&nbsp;does&nbsp;not&nbsp;(and&nbsp;can&nbsp;not)&nbsp;close&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">45</span><span class="keyword" id="6107144">func</span>&nbsp;<span class="op" id="6107149">(</span><span class="ident" id="6107150">w</span>&nbsp;<span class="op" id="6107152">*</span><span class="ident" id="6107153">Writer</span><span class="op" id="6107159">)</span>&nbsp;<span class="ident" id="6107161">Close</span><span class="op" id="6107166">(</span><span class="op" id="6107167">)</span>&nbsp;<span class="builtintype" id="6107169">error</span>&nbsp;<span class="op" id="6107175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6107178">if</span>&nbsp;<span class="ident" id="6107181">w</span><span class="op" id="6107182">.</span><span class="ident" id="6107183">last</span>&nbsp;<span class="op" id="6107188">!=</span>&nbsp;<span class="ident" id="6107191">nil</span>&nbsp;<span class="op" id="6107195">&amp;&amp;</span>&nbsp;<span class="op" id="6107198">!</span><span class="ident" id="6107199">w</span><span class="op" id="6107200">.</span><span class="ident" id="6107201">last</span><span class="op" id="6107205">.</span><span class="ident" id="6107206">closed</span>&nbsp;<span class="op" id="6107213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6107217">if</span>&nbsp;<span class="ident" id="6107220">err</span>&nbsp;<span class="op" id="6107224">:=</span>&nbsp;<span class="ident" id="6107227">w</span><span class="op" id="6107228">.</span><span class="ident" id="6107229">last</span><span class="op" id="6107233">.</span><span class="builtinfunc" id="6107234">close</span><span class="op" id="6107239">(</span><span class="op" id="6107240">)</span><span class="op" id="6107241">;</span>&nbsp;<span class="ident" id="6107243">err</span>&nbsp;<span class="op" id="6107247">!=</span>&nbsp;<span class="ident" id="6107250">nil</span>&nbsp;<span class="op" id="6107254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6107259">return</span>&nbsp;<span class="ident" id="6107266">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6107272">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6107276">w</span><span class="op" id="6107277">.</span><span class="ident" id="6107278">last</span>&nbsp;<span class="op" id="6107283">=</span>&nbsp;<span class="ident" id="6107285">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6107290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6107293">if</span>&nbsp;<span class="ident" id="6107296">w</span><span class="op" id="6107297">.</span><span class="ident" id="6107298">closed</span>&nbsp;<span class="op" id="6107305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6107309">return</span>&nbsp;<span class="ident" id="6107316">errors</span><span class="op" id="6107322">.</span><span class="ident" id="6107323">New</span><span class="op" id="6107326">(</span><span class="string" id="6107327">&#34;zip:&nbsp;writer&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="6107353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6107356">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6107359">w</span><span class="op" id="6107360">.</span><span class="ident" id="6107361">closed</span>&nbsp;<span class="op" id="6107368">=</span>&nbsp;<span class="builtintype" id="6107370">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6107377">//&nbsp;write&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6107405">start</span>&nbsp;<span class="op" id="6107411">:=</span>&nbsp;<span class="ident" id="6107414">w</span><span class="op" id="6107415">.</span><span class="ident" id="6107416">cw</span><span class="op" id="6107418">.</span><span class="ident" id="6107419">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6107426">for</span>&nbsp;<span class="ident" id="6107430">_</span><span class="op" id="6107431">,</span>&nbsp;<span class="ident" id="6107433">h</span>&nbsp;<span class="op" id="6107435">:=</span>&nbsp;<span class="keyword" id="6107438">range</span>&nbsp;<span class="ident" id="6107444">w</span><span class="op" id="6107445">.</span><span class="ident" id="6107446">dir</span>&nbsp;<span class="op" id="6107450">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6107454">var</span>&nbsp;<span class="ident" id="6107458">buf</span>&nbsp;<span class="op" id="6107462">[</span><span class="ident" id="6107463">directoryHeaderLen</span><span class="op" id="6107481">]</span><span class="builtintype" id="6107482">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6107489">b</span>&nbsp;<span class="op" id="6107491">:=</span>&nbsp;<span class="ident" id="6107494">writeBuf</span><span class="op" id="6107502">(</span><span class="ident" id="6107503">buf</span><span class="op" id="6107506">[</span><span class="op" id="6107507">:</span><span class="op" id="6107508">]</span><span class="op" id="6107509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6107513">b</span><span class="op" id="6107514">.</span><span class="builtintype" id="6107515">uint32</span><span class="op" id="6107521">(</span><span class="builtintype" id="6107522">uint32</span><span class="op" id="6107528">(</span><span class="ident" id="6107529">directoryHeaderSignature</span><span class="op" id="6107553">)</span><span class="op" id="6107554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6107558">b</span><span class="op" id="6107559">.</span><span class="builtintype" id="6107560">uint16</span><span class="op" id="6107566">(</span><span class="ident" id="6107567">h</span><span class="op" id="6107568">.</span><span class="ident" id="6107569">CreatorVersion</span><span class="op" id="6107583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6107587">b</span><span class="op" id="6107588">.</span><span class="builtintype" id="6107589">uint16</span><span class="op" id="6107595">(</span><span class="ident" id="6107596">h</span><span class="op" id="6107597">.</span><span class="ident" id="6107598">ReaderVersion</span><span class="op" id="6107611">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6107615">b</span><span class="op" id="6107616">.</span><span class="builtintype" id="6107617">uint16</span><span class="op" id="6107623">(</span><span class="ident" id="6107624">h</span><span class="op" id="6107625">.</span><span class="ident" id="6107626">Flags</span><span class="op" id="6107631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6107635">b</span><span class="op" id="6107636">.</span><span class="builtintype" id="6107637">uint16</span><span class="op" id="6107643">(</span><span class="ident" id="6107644">h</span><span class="op" id="6107645">.</span><span class="ident" id="6107646">Method</span><span class="op" id="6107652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6107656">b</span><span class="op" id="6107657">.</span><span class="builtintype" id="6107658">uint16</span><span class="op" id="6107664">(</span><span class="ident" id="6107665">h</span><span class="op" id="6107666">.</span><span class="ident" id="6107667">ModifiedTime</span><span class="op" id="6107679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6107683">b</span><span class="op" id="6107684">.</span><span class="builtintype" id="6107685">uint16</span><span class="op" id="6107691">(</span><span class="ident" id="6107692">h</span><span class="op" id="6107693">.</span><span class="ident" id="6107694">ModifiedDate</span><span class="op" id="6107706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6107710">b</span><span class="op" id="6107711">.</span><span class="builtintype" id="6107712">uint32</span><span class="op" id="6107718">(</span><span class="ident" id="6107719">h</span><span class="op" id="6107720">.</span><span class="ident" id="6107721">CRC32</span><span class="op" id="6107726">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6107730">if</span>&nbsp;<span class="ident" id="6107733">h</span><span class="op" id="6107734">.</span><span class="ident" id="6107735">isZip64</span><span class="op" id="6107742">(</span><span class="op" id="6107743">)</span>&nbsp;<span class="op" id="6107745">||</span>&nbsp;<span class="ident" id="6107748">h</span><span class="op" id="6107749">.</span><span class="ident" id="6107750">offset</span>&nbsp;<span class="op" id="6107757">&gt;</span>&nbsp;<span class="ident" id="6107759">uint32max</span>&nbsp;<span class="op" id="6107769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6107774">//&nbsp;the&nbsp;file&nbsp;needs&nbsp;a&nbsp;zip64&nbsp;header.&nbsp;store&nbsp;maxint&nbsp;in&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6107832">//&nbsp;32&nbsp;bit&nbsp;size&nbsp;fields&nbsp;(and&nbsp;offset&nbsp;later)&nbsp;to&nbsp;signal&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6107895">//&nbsp;zip64&nbsp;extra&nbsp;header&nbsp;should&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6107936">b</span><span class="op" id="6107937">.</span><span class="builtintype" id="6107938">uint32</span><span class="op" id="6107944">(</span><span class="ident" id="6107945">uint32max</span><span class="op" id="6107954">)</span>&nbsp;<span class="comment" id="6107956">//&nbsp;compressed&nbsp;size</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6107978">b</span><span class="op" id="6107979">.</span><span class="builtintype" id="6107980">uint32</span><span class="op" id="6107986">(</span><span class="ident" id="6107987">uint32max</span><span class="op" id="6107996">)</span>&nbsp;<span class="comment" id="6107998">//&nbsp;uncompressed&nbsp;size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6108023">//&nbsp;append&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;block&nbsp;to&nbsp;Extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6108065">var</span>&nbsp;<span class="ident" id="6108069">buf</span>&nbsp;<span class="op" id="6108073">[</span><span class="num" id="6108074">28</span><span class="op" id="6108076">]</span><span class="builtintype" id="6108077">byte</span>&nbsp;<span class="comment" id="6108082">//&nbsp;2x&nbsp;uint16&nbsp;+&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6108110">eb</span>&nbsp;<span class="op" id="6108113">:=</span>&nbsp;<span class="ident" id="6108116">writeBuf</span><span class="op" id="6108124">(</span><span class="ident" id="6108125">buf</span><span class="op" id="6108128">[</span><span class="op" id="6108129">:</span><span class="op" id="6108130">]</span><span class="op" id="6108131">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6108136">eb</span><span class="op" id="6108138">.</span><span class="builtintype" id="6108139">uint16</span><span class="op" id="6108145">(</span><span class="ident" id="6108146">zip64ExtraId</span><span class="op" id="6108158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6108163">eb</span><span class="op" id="6108165">.</span><span class="builtintype" id="6108166">uint16</span><span class="op" id="6108172">(</span><span class="num" id="6108173">24</span><span class="op" id="6108175">)</span>&nbsp;<span class="comment" id="6108177">//&nbsp;size&nbsp;=&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6108200">eb</span><span class="op" id="6108202">.</span><span class="ident" id="6108203">uint64</span><span class="op" id="6108209">(</span><span class="ident" id="6108210">h</span><span class="op" id="6108211">.</span><span class="ident" id="6108212">UncompressedSize64</span><span class="op" id="6108230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6108235">eb</span><span class="op" id="6108237">.</span><span class="ident" id="6108238">uint64</span><span class="op" id="6108244">(</span><span class="ident" id="6108245">h</span><span class="op" id="6108246">.</span><span class="ident" id="6108247">CompressedSize64</span><span class="op" id="6108263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6108268">eb</span><span class="op" id="6108270">.</span><span class="ident" id="6108271">uint64</span><span class="op" id="6108277">(</span><span class="ident" id="6108278">h</span><span class="op" id="6108279">.</span><span class="ident" id="6108280">offset</span><span class="op" id="6108286">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6108291">h</span><span class="op" id="6108292">.</span><span class="ident" id="6108293">Extra</span>&nbsp;<span class="op" id="6108299">=</span>&nbsp;<span class="builtinfunc" id="6108301">append</span><span class="op" id="6108307">(</span><span class="ident" id="6108308">h</span><span class="op" id="6108309">.</span><span class="ident" id="6108310">Extra</span><span class="op" id="6108315">,</span>&nbsp;<span class="ident" id="6108317">buf</span><span class="op" id="6108320">[</span><span class="op" id="6108321">:</span><span class="op" id="6108322">]</span><span class="op" id="6108323">...</span><span class="op" id="6108326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6108330">}</span>&nbsp;<span class="keyword" id="6108332">else</span>&nbsp;<span class="op" id="6108337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6108342">b</span><span class="op" id="6108343">.</span><span class="builtintype" id="6108344">uint32</span><span class="op" id="6108350">(</span><span class="ident" id="6108351">h</span><span class="op" id="6108352">.</span><span class="ident" id="6108353">CompressedSize</span><span class="op" id="6108367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6108372">b</span><span class="op" id="6108373">.</span><span class="builtintype" id="6108374">uint32</span><span class="op" id="6108380">(</span><span class="ident" id="6108381">h</span><span class="op" id="6108382">.</span><span class="ident" id="6108383">UncompressedSize</span><span class="op" id="6108399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6108403">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6108407">b</span><span class="op" id="6108408">.</span><span class="builtintype" id="6108409">uint16</span><span class="op" id="6108415">(</span><span class="builtintype" id="6108416">uint16</span><span class="op" id="6108422">(</span><span class="builtinfunc" id="6108423">len</span><span class="op" id="6108426">(</span><span class="ident" id="6108427">h</span><span class="op" id="6108428">.</span><span class="ident" id="6108429">Name</span><span class="op" id="6108433">)</span><span class="op" id="6108434">)</span><span class="op" id="6108435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6108439">b</span><span class="op" id="6108440">.</span><span class="builtintype" id="6108441">uint16</span><span class="op" id="6108447">(</span><span class="builtintype" id="6108448">uint16</span><span class="op" id="6108454">(</span><span class="builtinfunc" id="6108455">len</span><span class="op" id="6108458">(</span><span class="ident" id="6108459">h</span><span class="op" id="6108460">.</span><span class="ident" id="6108461">Extra</span><span class="op" id="6108466">)</span><span class="op" id="6108467">)</span><span class="op" id="6108468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6108472">b</span><span class="op" id="6108473">.</span><span class="builtintype" id="6108474">uint16</span><span class="op" id="6108480">(</span><span class="builtintype" id="6108481">uint16</span><span class="op" id="6108487">(</span><span class="builtinfunc" id="6108488">len</span><span class="op" id="6108491">(</span><span class="ident" id="6108492">h</span><span class="op" id="6108493">.</span><span class="ident" id="6108494">Comment</span><span class="op" id="6108501">)</span><span class="op" id="6108502">)</span><span class="op" id="6108503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6108507">b</span>&nbsp;<span class="op" id="6108509">=</span>&nbsp;<span class="ident" id="6108511">b</span><span class="op" id="6108512">[</span><span class="num" id="6108513">4</span><span class="op" id="6108514">:</span><span class="op" id="6108515">]</span>&nbsp;<span class="comment" id="6108517">//&nbsp;skip&nbsp;disk&nbsp;number&nbsp;start&nbsp;and&nbsp;internal&nbsp;file&nbsp;attr&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6108580">b</span><span class="op" id="6108581">.</span><span class="builtintype" id="6108582">uint32</span><span class="op" id="6108588">(</span><span class="ident" id="6108589">h</span><span class="op" id="6108590">.</span><span class="ident" id="6108591">ExternalAttrs</span><span class="op" id="6108604">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6108608">if</span>&nbsp;<span class="ident" id="6108611">h</span><span class="op" id="6108612">.</span><span class="ident" id="6108613">offset</span>&nbsp;<span class="op" id="6108620">&gt;</span>&nbsp;<span class="ident" id="6108622">uint32max</span>&nbsp;<span class="op" id="6108632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6108637">b</span><span class="op" id="6108638">.</span><span class="builtintype" id="6108639">uint32</span><span class="op" id="6108645">(</span><span class="ident" id="6108646">uint32max</span><span class="op" id="6108655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6108659">}</span>&nbsp;<span class="keyword" id="6108661">else</span>&nbsp;<span class="op" id="6108666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6108671">b</span><span class="op" id="6108672">.</span><span class="builtintype" id="6108673">uint32</span><span class="op" id="6108679">(</span><span class="builtintype" id="6108680">uint32</span><span class="op" id="6108686">(</span><span class="ident" id="6108687">h</span><span class="op" id="6108688">.</span><span class="ident" id="6108689">offset</span><span class="op" id="6108695">)</span><span class="op" id="6108696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6108700">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6108704">if</span>&nbsp;<span class="ident" id="6108707">_</span><span class="op" id="6108708">,</span>&nbsp;<span class="ident" id="6108710">err</span>&nbsp;<span class="op" id="6108714">:=</span>&nbsp;<span class="ident" id="6108717">w</span><span class="op" id="6108718">.</span><span class="ident" id="6108719">cw</span><span class="op" id="6108721">.</span><span class="ident" id="6108722">Write</span><span class="op" id="6108727">(</span><span class="ident" id="6108728">buf</span><span class="op" id="6108731">[</span><span class="op" id="6108732">:</span><span class="op" id="6108733">]</span><span class="op" id="6108734">)</span><span class="op" id="6108735">;</span>&nbsp;<span class="ident" id="6108737">err</span>&nbsp;<span class="op" id="6108741">!=</span>&nbsp;<span class="ident" id="6108744">nil</span>&nbsp;<span class="op" id="6108748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6108753">return</span>&nbsp;<span class="ident" id="6108760">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6108766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6108770">if</span>&nbsp;<span class="ident" id="6108773">_</span><span class="op" id="6108774">,</span>&nbsp;<span class="ident" id="6108776">err</span>&nbsp;<span class="op" id="6108780">:=</span>&nbsp;<span class="ident" id="6108783">io</span><span class="op" id="6108785">.</span><span class="ident" id="6108786">WriteString</span><span class="op" id="6108797">(</span><span class="ident" id="6108798">w</span><span class="op" id="6108799">.</span><span class="ident" id="6108800">cw</span><span class="op" id="6108802">,</span>&nbsp;<span class="ident" id="6108804">h</span><span class="op" id="6108805">.</span><span class="ident" id="6108806">Name</span><span class="op" id="6108810">)</span><span class="op" id="6108811">;</span>&nbsp;<span class="ident" id="6108813">err</span>&nbsp;<span class="op" id="6108817">!=</span>&nbsp;<span class="ident" id="6108820">nil</span>&nbsp;<span class="op" id="6108824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6108829">return</span>&nbsp;<span class="ident" id="6108836">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6108842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6108846">if</span>&nbsp;<span class="ident" id="6108849">_</span><span class="op" id="6108850">,</span>&nbsp;<span class="ident" id="6108852">err</span>&nbsp;<span class="op" id="6108856">:=</span>&nbsp;<span class="ident" id="6108859">w</span><span class="op" id="6108860">.</span><span class="ident" id="6108861">cw</span><span class="op" id="6108863">.</span><span class="ident" id="6108864">Write</span><span class="op" id="6108869">(</span><span class="ident" id="6108870">h</span><span class="op" id="6108871">.</span><span class="ident" id="6108872">Extra</span><span class="op" id="6108877">)</span><span class="op" id="6108878">;</span>&nbsp;<span class="ident" id="6108880">err</span>&nbsp;<span class="op" id="6108884">!=</span>&nbsp;<span class="ident" id="6108887">nil</span>&nbsp;<span class="op" id="6108891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6108896">return</span>&nbsp;<span class="ident" id="6108903">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6108909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6108913">if</span>&nbsp;<span class="ident" id="6108916">_</span><span class="op" id="6108917">,</span>&nbsp;<span class="ident" id="6108919">err</span>&nbsp;<span class="op" id="6108923">:=</span>&nbsp;<span class="ident" id="6108926">io</span><span class="op" id="6108928">.</span><span class="ident" id="6108929">WriteString</span><span class="op" id="6108940">(</span><span class="ident" id="6108941">w</span><span class="op" id="6108942">.</span><span class="ident" id="6108943">cw</span><span class="op" id="6108945">,</span>&nbsp;<span class="ident" id="6108947">h</span><span class="op" id="6108948">.</span><span class="ident" id="6108949">Comment</span><span class="op" id="6108956">)</span><span class="op" id="6108957">;</span>&nbsp;<span class="ident" id="6108959">err</span>&nbsp;<span class="op" id="6108963">!=</span>&nbsp;<span class="ident" id="6108966">nil</span>&nbsp;<span class="op" id="6108970">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6108975">return</span>&nbsp;<span class="ident" id="6108982">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6108988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6108991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6108994">end</span>&nbsp;<span class="op" id="6108998">:=</span>&nbsp;<span class="ident" id="6109001">w</span><span class="op" id="6109002">.</span><span class="ident" id="6109003">cw</span><span class="op" id="6109005">.</span><span class="ident" id="6109006">count</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6109014">records</span>&nbsp;<span class="op" id="6109022">:=</span>&nbsp;<span class="ident" id="6109025">uint64</span><span class="op" id="6109031">(</span><span class="builtinfunc" id="6109032">len</span><span class="op" id="6109035">(</span><span class="ident" id="6109036">w</span><span class="op" id="6109037">.</span><span class="ident" id="6109038">dir</span><span class="op" id="6109041">)</span><span class="op" id="6109042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6109045">size</span>&nbsp;<span class="op" id="6109050">:=</span>&nbsp;<span class="ident" id="6109053">uint64</span><span class="op" id="6109059">(</span><span class="ident" id="6109060">end</span>&nbsp;<span class="op" id="6109064">-</span>&nbsp;<span class="ident" id="6109066">start</span><span class="op" id="6109071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6109074">offset</span>&nbsp;<span class="op" id="6109081">:=</span>&nbsp;<span class="ident" id="6109084">uint64</span><span class="op" id="6109090">(</span><span class="ident" id="6109091">start</span><span class="op" id="6109096">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6109100">if</span>&nbsp;<span class="ident" id="6109103">records</span>&nbsp;<span class="op" id="6109111">&gt;</span>&nbsp;<span class="ident" id="6109113">uint16max</span>&nbsp;<span class="op" id="6109123">||</span>&nbsp;<span class="ident" id="6109126">size</span>&nbsp;<span class="op" id="6109131">&gt;</span>&nbsp;<span class="ident" id="6109133">uint32max</span>&nbsp;<span class="op" id="6109143">||</span>&nbsp;<span class="ident" id="6109146">offset</span>&nbsp;<span class="op" id="6109153">&gt;</span>&nbsp;<span class="ident" id="6109155">uint32max</span>&nbsp;<span class="op" id="6109165">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6109169">var</span>&nbsp;<span class="ident" id="6109173">buf</span>&nbsp;<span class="op" id="6109177">[</span><span class="ident" id="6109178">directory64EndLen</span>&nbsp;<span class="op" id="6109196">+</span>&nbsp;<span class="ident" id="6109198">directory64LocLen</span><span class="op" id="6109215">]</span><span class="builtintype" id="6109216">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6109223">b</span>&nbsp;<span class="op" id="6109225">:=</span>&nbsp;<span class="ident" id="6109228">writeBuf</span><span class="op" id="6109236">(</span><span class="ident" id="6109237">buf</span><span class="op" id="6109240">[</span><span class="op" id="6109241">:</span><span class="op" id="6109242">]</span><span class="op" id="6109243">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6109248">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6109291">b</span><span class="op" id="6109292">.</span><span class="builtintype" id="6109293">uint32</span><span class="op" id="6109299">(</span><span class="ident" id="6109300">directory64EndSignature</span><span class="op" id="6109323">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6109327">b</span><span class="op" id="6109328">.</span><span class="ident" id="6109329">uint64</span><span class="op" id="6109335">(</span><span class="ident" id="6109336">directory64EndLen</span><span class="op" id="6109353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6109357">b</span><span class="op" id="6109358">.</span><span class="builtintype" id="6109359">uint16</span><span class="op" id="6109365">(</span><span class="ident" id="6109366">zipVersion45</span><span class="op" id="6109378">)</span>&nbsp;<span class="comment" id="6109380">//&nbsp;version&nbsp;made&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6109401">b</span><span class="op" id="6109402">.</span><span class="builtintype" id="6109403">uint16</span><span class="op" id="6109409">(</span><span class="ident" id="6109410">zipVersion45</span><span class="op" id="6109422">)</span>&nbsp;<span class="comment" id="6109424">//&nbsp;version&nbsp;needed&nbsp;to&nbsp;extract</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6109455">b</span><span class="op" id="6109456">.</span><span class="builtintype" id="6109457">uint32</span><span class="op" id="6109463">(</span><span class="num" id="6109464">0</span><span class="op" id="6109465">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6109478">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6109503">b</span><span class="op" id="6109504">.</span><span class="builtintype" id="6109505">uint32</span><span class="op" id="6109511">(</span><span class="num" id="6109512">0</span><span class="op" id="6109513">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6109526">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6109590">b</span><span class="op" id="6109591">.</span><span class="ident" id="6109592">uint64</span><span class="op" id="6109598">(</span><span class="ident" id="6109599">records</span><span class="op" id="6109606">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6109613">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6109680">b</span><span class="op" id="6109681">.</span><span class="ident" id="6109682">uint64</span><span class="op" id="6109688">(</span><span class="ident" id="6109689">records</span><span class="op" id="6109696">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6109703">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6109757">b</span><span class="op" id="6109758">.</span><span class="ident" id="6109759">uint64</span><span class="op" id="6109765">(</span><span class="ident" id="6109766">size</span><span class="op" id="6109770">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6109780">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6109815">b</span><span class="op" id="6109816">.</span><span class="ident" id="6109817">uint64</span><span class="op" id="6109823">(</span><span class="ident" id="6109824">offset</span><span class="op" id="6109830">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6109838">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6109922">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;locator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6109966">b</span><span class="op" id="6109967">.</span><span class="builtintype" id="6109968">uint32</span><span class="op" id="6109974">(</span><span class="ident" id="6109975">directory64LocSignature</span><span class="op" id="6109998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6110002">b</span><span class="op" id="6110003">.</span><span class="builtintype" id="6110004">uint32</span><span class="op" id="6110010">(</span><span class="num" id="6110011">0</span><span class="op" id="6110012">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6110024">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6110101">b</span><span class="op" id="6110102">.</span><span class="ident" id="6110103">uint64</span><span class="op" id="6110109">(</span><span class="ident" id="6110110">uint64</span><span class="op" id="6110116">(</span><span class="ident" id="6110117">end</span><span class="op" id="6110120">)</span><span class="op" id="6110121">)</span>&nbsp;<span class="comment" id="6110123">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6110189">b</span><span class="op" id="6110190">.</span><span class="builtintype" id="6110191">uint32</span><span class="op" id="6110197">(</span><span class="num" id="6110198">1</span><span class="op" id="6110199">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6110211">//&nbsp;total&nbsp;number&nbsp;of&nbsp;disks</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6110239">if</span>&nbsp;<span class="ident" id="6110242">_</span><span class="op" id="6110243">,</span>&nbsp;<span class="ident" id="6110245">err</span>&nbsp;<span class="op" id="6110249">:=</span>&nbsp;<span class="ident" id="6110252">w</span><span class="op" id="6110253">.</span><span class="ident" id="6110254">cw</span><span class="op" id="6110256">.</span><span class="ident" id="6110257">Write</span><span class="op" id="6110262">(</span><span class="ident" id="6110263">buf</span><span class="op" id="6110266">[</span><span class="op" id="6110267">:</span><span class="op" id="6110268">]</span><span class="op" id="6110269">)</span><span class="op" id="6110270">;</span>&nbsp;<span class="ident" id="6110272">err</span>&nbsp;<span class="op" id="6110276">!=</span>&nbsp;<span class="ident" id="6110279">nil</span>&nbsp;<span class="op" id="6110283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6110288">return</span>&nbsp;<span class="ident" id="6110295">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6110301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6110306">//&nbsp;store&nbsp;max&nbsp;values&nbsp;in&nbsp;the&nbsp;regular&nbsp;end&nbsp;record&nbsp;to&nbsp;signal&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6110369">//&nbsp;that&nbsp;the&nbsp;zip64&nbsp;values&nbsp;should&nbsp;be&nbsp;used&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6110419">records</span>&nbsp;<span class="op" id="6110427">=</span>&nbsp;<span class="ident" id="6110429">uint16max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6110441">size</span>&nbsp;<span class="op" id="6110446">=</span>&nbsp;<span class="ident" id="6110448">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6110460">offset</span>&nbsp;<span class="op" id="6110467">=</span>&nbsp;<span class="ident" id="6110469">uint32max</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6110480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6110484">//&nbsp;write&nbsp;end&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6110505">var</span>&nbsp;<span class="ident" id="6110509">buf</span>&nbsp;<span class="op" id="6110513">[</span><span class="ident" id="6110514">directoryEndLen</span><span class="op" id="6110529">]</span><span class="builtintype" id="6110530">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6110536">b</span>&nbsp;<span class="op" id="6110538">:=</span>&nbsp;<span class="ident" id="6110541">writeBuf</span><span class="op" id="6110549">(</span><span class="ident" id="6110550">buf</span><span class="op" id="6110553">[</span><span class="op" id="6110554">:</span><span class="op" id="6110555">]</span><span class="op" id="6110556">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6110559">b</span><span class="op" id="6110560">.</span><span class="builtintype" id="6110561">uint32</span><span class="op" id="6110567">(</span><span class="builtintype" id="6110568">uint32</span><span class="op" id="6110574">(</span><span class="ident" id="6110575">directoryEndSignature</span><span class="op" id="6110596">)</span><span class="op" id="6110597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6110600">b</span>&nbsp;<span class="op" id="6110602">=</span>&nbsp;<span class="ident" id="6110604">b</span><span class="op" id="6110605">[</span><span class="num" id="6110606">4</span><span class="op" id="6110607">:</span><span class="op" id="6110608">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6110626">//&nbsp;skip&nbsp;over&nbsp;disk&nbsp;number&nbsp;and&nbsp;first&nbsp;disk&nbsp;number&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6110686">b</span><span class="op" id="6110687">.</span><span class="builtintype" id="6110688">uint16</span><span class="op" id="6110694">(</span><span class="builtintype" id="6110695">uint16</span><span class="op" id="6110701">(</span><span class="ident" id="6110702">records</span><span class="op" id="6110709">)</span><span class="op" id="6110710">)</span>&nbsp;<span class="comment" id="6110712">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6110744">b</span><span class="op" id="6110745">.</span><span class="builtintype" id="6110746">uint16</span><span class="op" id="6110752">(</span><span class="builtintype" id="6110753">uint16</span><span class="op" id="6110759">(</span><span class="ident" id="6110760">records</span><span class="op" id="6110767">)</span><span class="op" id="6110768">)</span>&nbsp;<span class="comment" id="6110770">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;total</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6110798">b</span><span class="op" id="6110799">.</span><span class="builtintype" id="6110800">uint32</span><span class="op" id="6110806">(</span><span class="builtintype" id="6110807">uint32</span><span class="op" id="6110813">(</span><span class="ident" id="6110814">size</span><span class="op" id="6110818">)</span><span class="op" id="6110819">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6110824">//&nbsp;size&nbsp;of&nbsp;directory</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6110846">b</span><span class="op" id="6110847">.</span><span class="builtintype" id="6110848">uint32</span><span class="op" id="6110854">(</span><span class="builtintype" id="6110855">uint32</span><span class="op" id="6110861">(</span><span class="ident" id="6110862">offset</span><span class="op" id="6110868">)</span><span class="op" id="6110869">)</span>&nbsp;&nbsp;<span class="comment" id="6110872">//&nbsp;start&nbsp;of&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6110895">//&nbsp;skipped&nbsp;size&nbsp;of&nbsp;comment&nbsp;(always&nbsp;zero)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6110937">if</span>&nbsp;<span class="ident" id="6110940">_</span><span class="op" id="6110941">,</span>&nbsp;<span class="ident" id="6110943">err</span>&nbsp;<span class="op" id="6110947">:=</span>&nbsp;<span class="ident" id="6110950">w</span><span class="op" id="6110951">.</span><span class="ident" id="6110952">cw</span><span class="op" id="6110954">.</span><span class="ident" id="6110955">Write</span><span class="op" id="6110960">(</span><span class="ident" id="6110961">buf</span><span class="op" id="6110964">[</span><span class="op" id="6110965">:</span><span class="op" id="6110966">]</span><span class="op" id="6110967">)</span><span class="op" id="6110968">;</span>&nbsp;<span class="ident" id="6110970">err</span>&nbsp;<span class="op" id="6110974">!=</span>&nbsp;<span class="ident" id="6110977">nil</span>&nbsp;<span class="op" id="6110981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6110985">return</span>&nbsp;<span class="ident" id="6110992">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6110997">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6111001">return</span>&nbsp;<span class="ident" id="6111008">w</span><span class="op" id="6111009">.</span><span class="ident" id="6111010">cw</span><span class="op" id="6111012">.</span><span class="ident" id="6111013">w</span><span class="op" id="6111014">.</span><span class="op" id="6111015">(</span><span class="op" id="6111016">*</span><span class="ident" id="6111017">bufio</span><span class="op" id="6111022">.</span><span class="ident" id="6111023">Writer</span><span class="op" id="6111029">)</span><span class="op" id="6111030">.</span><span class="ident" id="6111031">Flush</span><span class="op" id="6111036">(</span><span class="op" id="6111037">)</span><br>
<span class="lineno"></span><span class="op" id="6111039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6111042">//&nbsp;Create&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;name.</span><br>
<span class="lineno">170</span><span class="comment" id="6111105">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="6111174">//&nbsp;The&nbsp;name&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span><span class="comment" id="6111242">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="6111309">//&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="6111321">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno">175</span><span class="comment" id="6111393">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="6111436">func</span>&nbsp;<span class="op" id="6111441">(</span><span class="ident" id="6111442">w</span>&nbsp;<span class="op" id="6111444">*</span><span class="ident" id="6111445">Writer</span><span class="op" id="6111451">)</span>&nbsp;<span class="ident" id="6111453">Create</span><span class="op" id="6111459">(</span><span class="ident" id="6111460">name</span>&nbsp;<span class="builtintype" id="6111465">string</span><span class="op" id="6111471">)</span>&nbsp;<span class="op" id="6111473">(</span><span class="ident" id="6111474">io</span><span class="op" id="6111476">.</span><span class="ident" id="6111477">Writer</span><span class="op" id="6111483">,</span>&nbsp;<span class="builtintype" id="6111485">error</span><span class="op" id="6111490">)</span>&nbsp;<span class="op" id="6111492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6111495">header</span>&nbsp;<span class="op" id="6111502">:=</span>&nbsp;<span class="op" id="6111505">&amp;</span><span class="ident" id="6111506">FileHeader</span><span class="op" id="6111516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6111520">Name</span><span class="op" id="6111524">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6111528">name</span><span class="op" id="6111532">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6111536">Method</span><span class="op" id="6111542">:</span>&nbsp;<span class="ident" id="6111544">Deflate</span><span class="op" id="6111551">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6111554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6111557">return</span>&nbsp;<span class="ident" id="6111564">w</span><span class="op" id="6111565">.</span><span class="ident" id="6111566">CreateHeader</span><span class="op" id="6111578">(</span><span class="ident" id="6111579">header</span><span class="op" id="6111585">)</span><br>
<span class="lineno"></span><span class="op" id="6111587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6111590">//&nbsp;CreateHeader&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;FileHeader</span><br>
<span class="lineno">185</span><span class="comment" id="6111664">//&nbsp;for&nbsp;the&nbsp;file&nbsp;metadata.</span><br>
<span class="lineno"></span><span class="comment" id="6111690">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="6111759">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="6111831">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="6111874">func</span>&nbsp;<span class="op" id="6111879">(</span><span class="ident" id="6111880">w</span>&nbsp;<span class="op" id="6111882">*</span><span class="ident" id="6111883">Writer</span><span class="op" id="6111889">)</span>&nbsp;<span class="ident" id="6111891">CreateHeader</span><span class="op" id="6111903">(</span><span class="ident" id="6111904">fh</span>&nbsp;<span class="op" id="6111907">*</span><span class="ident" id="6111908">FileHeader</span><span class="op" id="6111918">)</span>&nbsp;<span class="op" id="6111920">(</span><span class="ident" id="6111921">io</span><span class="op" id="6111923">.</span><span class="ident" id="6111924">Writer</span><span class="op" id="6111930">,</span>&nbsp;<span class="builtintype" id="6111932">error</span><span class="op" id="6111937">)</span>&nbsp;<span class="op" id="6111939">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6111942">if</span>&nbsp;<span class="ident" id="6111945">w</span><span class="op" id="6111946">.</span><span class="ident" id="6111947">last</span>&nbsp;<span class="op" id="6111952">!=</span>&nbsp;<span class="ident" id="6111955">nil</span>&nbsp;<span class="op" id="6111959">&amp;&amp;</span>&nbsp;<span class="op" id="6111962">!</span><span class="ident" id="6111963">w</span><span class="op" id="6111964">.</span><span class="ident" id="6111965">last</span><span class="op" id="6111969">.</span><span class="ident" id="6111970">closed</span>&nbsp;<span class="op" id="6111977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6111981">if</span>&nbsp;<span class="ident" id="6111984">err</span>&nbsp;<span class="op" id="6111988">:=</span>&nbsp;<span class="ident" id="6111991">w</span><span class="op" id="6111992">.</span><span class="ident" id="6111993">last</span><span class="op" id="6111997">.</span><span class="builtinfunc" id="6111998">close</span><span class="op" id="6112003">(</span><span class="op" id="6112004">)</span><span class="op" id="6112005">;</span>&nbsp;<span class="ident" id="6112007">err</span>&nbsp;<span class="op" id="6112011">!=</span>&nbsp;<span class="ident" id="6112014">nil</span>&nbsp;<span class="op" id="6112018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6112023">return</span>&nbsp;<span class="ident" id="6112030">nil</span><span class="op" id="6112033">,</span>&nbsp;<span class="ident" id="6112035">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6112041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6112044">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112048">fh</span><span class="op" id="6112050">.</span><span class="ident" id="6112051">Flags</span>&nbsp;<span class="op" id="6112057">|=</span>&nbsp;<span class="num" id="6112060">0x8</span>&nbsp;<span class="comment" id="6112064">//&nbsp;we&nbsp;will&nbsp;write&nbsp;a&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112101">fh</span><span class="op" id="6112103">.</span><span class="ident" id="6112104">CreatorVersion</span>&nbsp;<span class="op" id="6112119">=</span>&nbsp;<span class="ident" id="6112121">fh</span><span class="op" id="6112123">.</span><span class="ident" id="6112124">CreatorVersion</span><span class="op" id="6112138">&amp;</span><span class="num" id="6112139">0xff00</span>&nbsp;<span class="op" id="6112146">|</span>&nbsp;<span class="ident" id="6112148">zipVersion20</span>&nbsp;<span class="comment" id="6112161">//&nbsp;preserve&nbsp;compatibility&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112193">fh</span><span class="op" id="6112195">.</span><span class="ident" id="6112196">ReaderVersion</span>&nbsp;<span class="op" id="6112210">=</span>&nbsp;<span class="ident" id="6112212">zipVersion20</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112227">fw</span>&nbsp;<span class="op" id="6112230">:=</span>&nbsp;<span class="op" id="6112233">&amp;</span><span class="ident" id="6112234">fileWriter</span><span class="op" id="6112244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112248">zipw</span><span class="op" id="6112252">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112259">w</span><span class="op" id="6112260">.</span><span class="ident" id="6112261">cw</span><span class="op" id="6112263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112267">compCount</span><span class="op" id="6112276">:</span>&nbsp;<span class="op" id="6112278">&amp;</span><span class="ident" id="6112279">countWriter</span><span class="op" id="6112290">{</span><span class="ident" id="6112291">w</span><span class="op" id="6112292">:</span>&nbsp;<span class="ident" id="6112294">w</span><span class="op" id="6112295">.</span><span class="ident" id="6112296">cw</span><span class="op" id="6112298">}</span><span class="op" id="6112299">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112303">crc32</span><span class="op" id="6112308">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112314">crc32</span><span class="op" id="6112319">.</span><span class="ident" id="6112320">NewIEEE</span><span class="op" id="6112327">(</span><span class="op" id="6112328">)</span><span class="op" id="6112329">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6112332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112335">comp</span>&nbsp;<span class="op" id="6112340">:=</span>&nbsp;<span class="ident" id="6112343">compressor</span><span class="op" id="6112353">(</span><span class="ident" id="6112354">fh</span><span class="op" id="6112356">.</span><span class="ident" id="6112357">Method</span><span class="op" id="6112363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6112366">if</span>&nbsp;<span class="ident" id="6112369">comp</span>&nbsp;<span class="op" id="6112374">==</span>&nbsp;<span class="ident" id="6112377">nil</span>&nbsp;<span class="op" id="6112381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6112385">return</span>&nbsp;<span class="ident" id="6112392">nil</span><span class="op" id="6112395">,</span>&nbsp;<span class="ident" id="6112397">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6112411">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6112414">var</span>&nbsp;<span class="ident" id="6112418">err</span>&nbsp;<span class="builtintype" id="6112422">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112429">fw</span><span class="op" id="6112431">.</span><span class="ident" id="6112432">comp</span><span class="op" id="6112436">,</span>&nbsp;<span class="ident" id="6112438">err</span>&nbsp;<span class="op" id="6112442">=</span>&nbsp;<span class="ident" id="6112444">comp</span><span class="op" id="6112448">(</span><span class="ident" id="6112449">fw</span><span class="op" id="6112451">.</span><span class="ident" id="6112452">compCount</span><span class="op" id="6112461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6112464">if</span>&nbsp;<span class="ident" id="6112467">err</span>&nbsp;<span class="op" id="6112471">!=</span>&nbsp;<span class="ident" id="6112474">nil</span>&nbsp;<span class="op" id="6112478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6112482">return</span>&nbsp;<span class="ident" id="6112489">nil</span><span class="op" id="6112492">,</span>&nbsp;<span class="ident" id="6112494">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6112499">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112502">fw</span><span class="op" id="6112504">.</span><span class="ident" id="6112505">rawCount</span>&nbsp;<span class="op" id="6112514">=</span>&nbsp;<span class="op" id="6112516">&amp;</span><span class="ident" id="6112517">countWriter</span><span class="op" id="6112528">{</span><span class="ident" id="6112529">w</span><span class="op" id="6112530">:</span>&nbsp;<span class="ident" id="6112532">fw</span><span class="op" id="6112534">.</span><span class="ident" id="6112535">comp</span><span class="op" id="6112539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112543">h</span>&nbsp;<span class="op" id="6112545">:=</span>&nbsp;<span class="op" id="6112548">&amp;</span><span class="ident" id="6112549">header</span><span class="op" id="6112555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112559">FileHeader</span><span class="op" id="6112569">:</span>&nbsp;<span class="ident" id="6112571">fh</span><span class="op" id="6112573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112577">offset</span><span class="op" id="6112583">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112589">uint64</span><span class="op" id="6112595">(</span><span class="ident" id="6112596">w</span><span class="op" id="6112597">.</span><span class="ident" id="6112598">cw</span><span class="op" id="6112600">.</span><span class="ident" id="6112601">count</span><span class="op" id="6112606">)</span><span class="op" id="6112607">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6112610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112613">w</span><span class="op" id="6112614">.</span><span class="ident" id="6112615">dir</span>&nbsp;<span class="op" id="6112619">=</span>&nbsp;<span class="builtinfunc" id="6112621">append</span><span class="op" id="6112627">(</span><span class="ident" id="6112628">w</span><span class="op" id="6112629">.</span><span class="ident" id="6112630">dir</span><span class="op" id="6112633">,</span>&nbsp;<span class="ident" id="6112635">h</span><span class="op" id="6112636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112639">fw</span><span class="op" id="6112641">.</span><span class="ident" id="6112642">header</span>&nbsp;<span class="op" id="6112649">=</span>&nbsp;<span class="ident" id="6112651">h</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6112655">if</span>&nbsp;<span class="ident" id="6112658">err</span>&nbsp;<span class="op" id="6112662">:=</span>&nbsp;<span class="ident" id="6112665">writeHeader</span><span class="op" id="6112676">(</span><span class="ident" id="6112677">w</span><span class="op" id="6112678">.</span><span class="ident" id="6112679">cw</span><span class="op" id="6112681">,</span>&nbsp;<span class="ident" id="6112683">fh</span><span class="op" id="6112685">)</span><span class="op" id="6112686">;</span>&nbsp;<span class="ident" id="6112688">err</span>&nbsp;<span class="op" id="6112692">!=</span>&nbsp;<span class="ident" id="6112695">nil</span>&nbsp;<span class="op" id="6112699">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6112703">return</span>&nbsp;<span class="ident" id="6112710">nil</span><span class="op" id="6112713">,</span>&nbsp;<span class="ident" id="6112715">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6112720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112724">w</span><span class="op" id="6112725">.</span><span class="ident" id="6112726">last</span>&nbsp;<span class="op" id="6112731">=</span>&nbsp;<span class="ident" id="6112733">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6112737">return</span>&nbsp;<span class="ident" id="6112744">fw</span><span class="op" id="6112746">,</span>&nbsp;<span class="ident" id="6112748">nil</span><br>
<span class="lineno">230</span><span class="op" id="6112752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6112755">func</span>&nbsp;<span class="ident" id="6112760">writeHeader</span><span class="op" id="6112771">(</span><span class="ident" id="6112772">w</span>&nbsp;<span class="ident" id="6112774">io</span><span class="op" id="6112776">.</span><span class="ident" id="6112777">Writer</span><span class="op" id="6112783">,</span>&nbsp;<span class="ident" id="6112785">h</span>&nbsp;<span class="op" id="6112787">*</span><span class="ident" id="6112788">FileHeader</span><span class="op" id="6112798">)</span>&nbsp;<span class="builtintype" id="6112800">error</span>&nbsp;<span class="op" id="6112806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6112809">var</span>&nbsp;<span class="ident" id="6112813">buf</span>&nbsp;<span class="op" id="6112817">[</span><span class="ident" id="6112818">fileHeaderLen</span><span class="op" id="6112831">]</span><span class="builtintype" id="6112832">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112838">b</span>&nbsp;<span class="op" id="6112840">:=</span>&nbsp;<span class="ident" id="6112843">writeBuf</span><span class="op" id="6112851">(</span><span class="ident" id="6112852">buf</span><span class="op" id="6112855">[</span><span class="op" id="6112856">:</span><span class="op" id="6112857">]</span><span class="op" id="6112858">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112861">b</span><span class="op" id="6112862">.</span><span class="builtintype" id="6112863">uint32</span><span class="op" id="6112869">(</span><span class="builtintype" id="6112870">uint32</span><span class="op" id="6112876">(</span><span class="ident" id="6112877">fileHeaderSignature</span><span class="op" id="6112896">)</span><span class="op" id="6112897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112900">b</span><span class="op" id="6112901">.</span><span class="builtintype" id="6112902">uint16</span><span class="op" id="6112908">(</span><span class="ident" id="6112909">h</span><span class="op" id="6112910">.</span><span class="ident" id="6112911">ReaderVersion</span><span class="op" id="6112924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112927">b</span><span class="op" id="6112928">.</span><span class="builtintype" id="6112929">uint16</span><span class="op" id="6112935">(</span><span class="ident" id="6112936">h</span><span class="op" id="6112937">.</span><span class="ident" id="6112938">Flags</span><span class="op" id="6112943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112946">b</span><span class="op" id="6112947">.</span><span class="builtintype" id="6112948">uint16</span><span class="op" id="6112954">(</span><span class="ident" id="6112955">h</span><span class="op" id="6112956">.</span><span class="ident" id="6112957">Method</span><span class="op" id="6112963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112966">b</span><span class="op" id="6112967">.</span><span class="builtintype" id="6112968">uint16</span><span class="op" id="6112974">(</span><span class="ident" id="6112975">h</span><span class="op" id="6112976">.</span><span class="ident" id="6112977">ModifiedTime</span><span class="op" id="6112989">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6112992">b</span><span class="op" id="6112993">.</span><span class="builtintype" id="6112994">uint16</span><span class="op" id="6113000">(</span><span class="ident" id="6113001">h</span><span class="op" id="6113002">.</span><span class="ident" id="6113003">ModifiedDate</span><span class="op" id="6113015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113018">b</span><span class="op" id="6113019">.</span><span class="builtintype" id="6113020">uint32</span><span class="op" id="6113026">(</span><span class="num" id="6113027">0</span><span class="op" id="6113028">)</span>&nbsp;<span class="comment" id="6113030">//&nbsp;since&nbsp;we&nbsp;are&nbsp;writing&nbsp;a&nbsp;data&nbsp;descriptor&nbsp;crc32,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113080">b</span><span class="op" id="6113081">.</span><span class="builtintype" id="6113082">uint32</span><span class="op" id="6113088">(</span><span class="num" id="6113089">0</span><span class="op" id="6113090">)</span>&nbsp;<span class="comment" id="6113092">//&nbsp;compressed&nbsp;size,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113113">b</span><span class="op" id="6113114">.</span><span class="builtintype" id="6113115">uint32</span><span class="op" id="6113121">(</span><span class="num" id="6113122">0</span><span class="op" id="6113123">)</span>&nbsp;<span class="comment" id="6113125">//&nbsp;and&nbsp;uncompressed&nbsp;size&nbsp;should&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113166">b</span><span class="op" id="6113167">.</span><span class="builtintype" id="6113168">uint16</span><span class="op" id="6113174">(</span><span class="builtintype" id="6113175">uint16</span><span class="op" id="6113181">(</span><span class="builtinfunc" id="6113182">len</span><span class="op" id="6113185">(</span><span class="ident" id="6113186">h</span><span class="op" id="6113187">.</span><span class="ident" id="6113188">Name</span><span class="op" id="6113192">)</span><span class="op" id="6113193">)</span><span class="op" id="6113194">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113197">b</span><span class="op" id="6113198">.</span><span class="builtintype" id="6113199">uint16</span><span class="op" id="6113205">(</span><span class="builtintype" id="6113206">uint16</span><span class="op" id="6113212">(</span><span class="builtinfunc" id="6113213">len</span><span class="op" id="6113216">(</span><span class="ident" id="6113217">h</span><span class="op" id="6113218">.</span><span class="ident" id="6113219">Extra</span><span class="op" id="6113224">)</span><span class="op" id="6113225">)</span><span class="op" id="6113226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6113229">if</span>&nbsp;<span class="ident" id="6113232">_</span><span class="op" id="6113233">,</span>&nbsp;<span class="ident" id="6113235">err</span>&nbsp;<span class="op" id="6113239">:=</span>&nbsp;<span class="ident" id="6113242">w</span><span class="op" id="6113243">.</span><span class="ident" id="6113244">Write</span><span class="op" id="6113249">(</span><span class="ident" id="6113250">buf</span><span class="op" id="6113253">[</span><span class="op" id="6113254">:</span><span class="op" id="6113255">]</span><span class="op" id="6113256">)</span><span class="op" id="6113257">;</span>&nbsp;<span class="ident" id="6113259">err</span>&nbsp;<span class="op" id="6113263">!=</span>&nbsp;<span class="ident" id="6113266">nil</span>&nbsp;<span class="op" id="6113270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6113274">return</span>&nbsp;<span class="ident" id="6113281">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6113286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6113289">if</span>&nbsp;<span class="ident" id="6113292">_</span><span class="op" id="6113293">,</span>&nbsp;<span class="ident" id="6113295">err</span>&nbsp;<span class="op" id="6113299">:=</span>&nbsp;<span class="ident" id="6113302">io</span><span class="op" id="6113304">.</span><span class="ident" id="6113305">WriteString</span><span class="op" id="6113316">(</span><span class="ident" id="6113317">w</span><span class="op" id="6113318">,</span>&nbsp;<span class="ident" id="6113320">h</span><span class="op" id="6113321">.</span><span class="ident" id="6113322">Name</span><span class="op" id="6113326">)</span><span class="op" id="6113327">;</span>&nbsp;<span class="ident" id="6113329">err</span>&nbsp;<span class="op" id="6113333">!=</span>&nbsp;<span class="ident" id="6113336">nil</span>&nbsp;<span class="op" id="6113340">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6113344">return</span>&nbsp;<span class="ident" id="6113351">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6113356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113359">_</span><span class="op" id="6113360">,</span>&nbsp;<span class="ident" id="6113362">err</span>&nbsp;<span class="op" id="6113366">:=</span>&nbsp;<span class="ident" id="6113369">w</span><span class="op" id="6113370">.</span><span class="ident" id="6113371">Write</span><span class="op" id="6113376">(</span><span class="ident" id="6113377">h</span><span class="op" id="6113378">.</span><span class="ident" id="6113379">Extra</span><span class="op" id="6113384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6113387">return</span>&nbsp;<span class="ident" id="6113394">err</span><br>
<span class="lineno"></span><span class="op" id="6113398">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="6113401">type</span>&nbsp;<span class="ident" id="6113406">fileWriter</span>&nbsp;<span class="keyword" id="6113417">struct</span>&nbsp;<span class="op" id="6113424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6113427">*</span><span class="ident" id="6113428">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113436">zipw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113446">io</span><span class="op" id="6113448">.</span><span class="ident" id="6113449">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113457">rawCount</span>&nbsp;&nbsp;<span class="op" id="6113467">*</span><span class="ident" id="6113468">countWriter</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113481">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113491">io</span><span class="op" id="6113493">.</span><span class="ident" id="6113494">WriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113507">compCount</span>&nbsp;<span class="op" id="6113517">*</span><span class="ident" id="6113518">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113531">crc32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113541">hash</span><span class="op" id="6113545">.</span><span class="ident" id="6113546">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113554">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6113564">bool</span><br>
<span class="lineno"></span><span class="op" id="6113569">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="6113572">func</span>&nbsp;<span class="op" id="6113577">(</span><span class="ident" id="6113578">w</span>&nbsp;<span class="op" id="6113580">*</span><span class="ident" id="6113581">fileWriter</span><span class="op" id="6113591">)</span>&nbsp;<span class="ident" id="6113593">Write</span><span class="op" id="6113598">(</span><span class="ident" id="6113599">p</span>&nbsp;<span class="op" id="6113601">[</span><span class="op" id="6113602">]</span><span class="builtintype" id="6113603">byte</span><span class="op" id="6113607">)</span>&nbsp;<span class="op" id="6113609">(</span><span class="builtintype" id="6113610">int</span><span class="op" id="6113613">,</span>&nbsp;<span class="builtintype" id="6113615">error</span><span class="op" id="6113620">)</span>&nbsp;<span class="op" id="6113622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6113625">if</span>&nbsp;<span class="ident" id="6113628">w</span><span class="op" id="6113629">.</span><span class="ident" id="6113630">closed</span>&nbsp;<span class="op" id="6113637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6113641">return</span>&nbsp;<span class="num" id="6113648">0</span><span class="op" id="6113649">,</span>&nbsp;<span class="ident" id="6113651">errors</span><span class="op" id="6113657">.</span><span class="ident" id="6113658">New</span><span class="op" id="6113661">(</span><span class="string" id="6113662">&#34;zip:&nbsp;write&nbsp;to&nbsp;closed&nbsp;file&#34;</span><span class="op" id="6113689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6113692">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113695">w</span><span class="op" id="6113696">.</span><span class="ident" id="6113697">crc32</span><span class="op" id="6113702">.</span><span class="ident" id="6113703">Write</span><span class="op" id="6113708">(</span><span class="ident" id="6113709">p</span><span class="op" id="6113710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6113713">return</span>&nbsp;<span class="ident" id="6113720">w</span><span class="op" id="6113721">.</span><span class="ident" id="6113722">rawCount</span><span class="op" id="6113730">.</span><span class="ident" id="6113731">Write</span><span class="op" id="6113736">(</span><span class="ident" id="6113737">p</span><span class="op" id="6113738">)</span><br>
<span class="lineno"></span><span class="op" id="6113740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6113743">func</span>&nbsp;<span class="op" id="6113748">(</span><span class="ident" id="6113749">w</span>&nbsp;<span class="op" id="6113751">*</span><span class="ident" id="6113752">fileWriter</span><span class="op" id="6113762">)</span>&nbsp;<span class="builtinfunc" id="6113764">close</span><span class="op" id="6113769">(</span><span class="op" id="6113770">)</span>&nbsp;<span class="builtintype" id="6113772">error</span>&nbsp;<span class="op" id="6113778">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6113781">if</span>&nbsp;<span class="ident" id="6113784">w</span><span class="op" id="6113785">.</span><span class="ident" id="6113786">closed</span>&nbsp;<span class="op" id="6113793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6113797">return</span>&nbsp;<span class="ident" id="6113804">errors</span><span class="op" id="6113810">.</span><span class="ident" id="6113811">New</span><span class="op" id="6113814">(</span><span class="string" id="6113815">&#34;zip:&nbsp;file&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="6113839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6113842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113845">w</span><span class="op" id="6113846">.</span><span class="ident" id="6113847">closed</span>&nbsp;<span class="op" id="6113854">=</span>&nbsp;<span class="builtintype" id="6113856">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6113862">if</span>&nbsp;<span class="ident" id="6113865">err</span>&nbsp;<span class="op" id="6113869">:=</span>&nbsp;<span class="ident" id="6113872">w</span><span class="op" id="6113873">.</span><span class="ident" id="6113874">comp</span><span class="op" id="6113878">.</span><span class="ident" id="6113879">Close</span><span class="op" id="6113884">(</span><span class="op" id="6113885">)</span><span class="op" id="6113886">;</span>&nbsp;<span class="ident" id="6113888">err</span>&nbsp;<span class="op" id="6113892">!=</span>&nbsp;<span class="ident" id="6113895">nil</span>&nbsp;<span class="op" id="6113899">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6113903">return</span>&nbsp;<span class="ident" id="6113910">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6113915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6113919">//&nbsp;update&nbsp;FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113941">fh</span>&nbsp;<span class="op" id="6113944">:=</span>&nbsp;<span class="ident" id="6113947">w</span><span class="op" id="6113948">.</span><span class="ident" id="6113949">header</span><span class="op" id="6113955">.</span><span class="ident" id="6113956">FileHeader</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113968">fh</span><span class="op" id="6113970">.</span><span class="ident" id="6113971">CRC32</span>&nbsp;<span class="op" id="6113977">=</span>&nbsp;<span class="ident" id="6113979">w</span><span class="op" id="6113980">.</span><span class="ident" id="6113981">crc32</span><span class="op" id="6113986">.</span><span class="ident" id="6113987">Sum32</span><span class="op" id="6113992">(</span><span class="op" id="6113993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6113996">fh</span><span class="op" id="6113998">.</span><span class="ident" id="6113999">CompressedSize64</span>&nbsp;<span class="op" id="6114016">=</span>&nbsp;<span class="ident" id="6114018">uint64</span><span class="op" id="6114024">(</span><span class="ident" id="6114025">w</span><span class="op" id="6114026">.</span><span class="ident" id="6114027">compCount</span><span class="op" id="6114036">.</span><span class="ident" id="6114037">count</span><span class="op" id="6114042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6114045">fh</span><span class="op" id="6114047">.</span><span class="ident" id="6114048">UncompressedSize64</span>&nbsp;<span class="op" id="6114067">=</span>&nbsp;<span class="ident" id="6114069">uint64</span><span class="op" id="6114075">(</span><span class="ident" id="6114076">w</span><span class="op" id="6114077">.</span><span class="ident" id="6114078">rawCount</span><span class="op" id="6114086">.</span><span class="ident" id="6114087">count</span><span class="op" id="6114092">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6114096">if</span>&nbsp;<span class="ident" id="6114099">fh</span><span class="op" id="6114101">.</span><span class="ident" id="6114102">isZip64</span><span class="op" id="6114109">(</span><span class="op" id="6114110">)</span>&nbsp;<span class="op" id="6114112">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6114116">fh</span><span class="op" id="6114118">.</span><span class="ident" id="6114119">CompressedSize</span>&nbsp;<span class="op" id="6114134">=</span>&nbsp;<span class="ident" id="6114136">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6114148">fh</span><span class="op" id="6114150">.</span><span class="ident" id="6114151">UncompressedSize</span>&nbsp;<span class="op" id="6114168">=</span>&nbsp;<span class="ident" id="6114170">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6114182">fh</span><span class="op" id="6114184">.</span><span class="ident" id="6114185">ReaderVersion</span>&nbsp;<span class="op" id="6114199">=</span>&nbsp;<span class="ident" id="6114201">zipVersion45</span>&nbsp;<span class="comment" id="6114214">//&nbsp;requires&nbsp;4.5&nbsp;-&nbsp;File&nbsp;uses&nbsp;ZIP64&nbsp;format&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6114267">}</span>&nbsp;<span class="keyword" id="6114269">else</span>&nbsp;<span class="op" id="6114274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6114278">fh</span><span class="op" id="6114280">.</span><span class="ident" id="6114281">CompressedSize</span>&nbsp;<span class="op" id="6114296">=</span>&nbsp;<span class="builtintype" id="6114298">uint32</span><span class="op" id="6114304">(</span><span class="ident" id="6114305">fh</span><span class="op" id="6114307">.</span><span class="ident" id="6114308">CompressedSize64</span><span class="op" id="6114324">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6114328">fh</span><span class="op" id="6114330">.</span><span class="ident" id="6114331">UncompressedSize</span>&nbsp;<span class="op" id="6114348">=</span>&nbsp;<span class="builtintype" id="6114350">uint32</span><span class="op" id="6114356">(</span><span class="ident" id="6114357">fh</span><span class="op" id="6114359">.</span><span class="ident" id="6114360">UncompressedSize64</span><span class="op" id="6114378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6114381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6114385">//&nbsp;Write&nbsp;data&nbsp;descriptor.&nbsp;This&nbsp;is&nbsp;more&nbsp;complicated&nbsp;than&nbsp;one&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6114452">//&nbsp;think,&nbsp;see&nbsp;e.g.&nbsp;comments&nbsp;in&nbsp;zipfile.c:putextended()&nbsp;and</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6114512">//&nbsp;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7073588.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6114576">//&nbsp;The&nbsp;approach&nbsp;here&nbsp;is&nbsp;to&nbsp;write&nbsp;8&nbsp;byte&nbsp;sizes&nbsp;if&nbsp;needed&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6114641">//&nbsp;adding&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;in&nbsp;the&nbsp;local&nbsp;header&nbsp;(too&nbsp;late&nbsp;anyway).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6114705">var</span>&nbsp;<span class="ident" id="6114709">buf</span>&nbsp;<span class="op" id="6114713">[</span><span class="op" id="6114714">]</span><span class="builtintype" id="6114715">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6114721">if</span>&nbsp;<span class="ident" id="6114724">fh</span><span class="op" id="6114726">.</span><span class="ident" id="6114727">isZip64</span><span class="op" id="6114734">(</span><span class="op" id="6114735">)</span>&nbsp;<span class="op" id="6114737">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6114741">buf</span>&nbsp;<span class="op" id="6114745">=</span>&nbsp;<span class="builtinfunc" id="6114747">make</span><span class="op" id="6114751">(</span><span class="op" id="6114752">[</span><span class="op" id="6114753">]</span><span class="builtintype" id="6114754">byte</span><span class="op" id="6114758">,</span>&nbsp;<span class="ident" id="6114760">dataDescriptor64Len</span><span class="op" id="6114779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6114782">}</span>&nbsp;<span class="keyword" id="6114784">else</span>&nbsp;<span class="op" id="6114789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6114793">buf</span>&nbsp;<span class="op" id="6114797">=</span>&nbsp;<span class="builtinfunc" id="6114799">make</span><span class="op" id="6114803">(</span><span class="op" id="6114804">[</span><span class="op" id="6114805">]</span><span class="builtintype" id="6114806">byte</span><span class="op" id="6114810">,</span>&nbsp;<span class="ident" id="6114812">dataDescriptorLen</span><span class="op" id="6114829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6114832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6114835">b</span>&nbsp;<span class="op" id="6114837">:=</span>&nbsp;<span class="ident" id="6114840">writeBuf</span><span class="op" id="6114848">(</span><span class="ident" id="6114849">buf</span><span class="op" id="6114852">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6114855">b</span><span class="op" id="6114856">.</span><span class="builtintype" id="6114857">uint32</span><span class="op" id="6114863">(</span><span class="ident" id="6114864">dataDescriptorSignature</span><span class="op" id="6114887">)</span>&nbsp;<span class="comment" id="6114889">//&nbsp;de-facto&nbsp;standard,&nbsp;required&nbsp;by&nbsp;OS&nbsp;X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6114929">b</span><span class="op" id="6114930">.</span><span class="builtintype" id="6114931">uint32</span><span class="op" id="6114937">(</span><span class="ident" id="6114938">fh</span><span class="op" id="6114940">.</span><span class="ident" id="6114941">CRC32</span><span class="op" id="6114946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6114949">if</span>&nbsp;<span class="ident" id="6114952">fh</span><span class="op" id="6114954">.</span><span class="ident" id="6114955">isZip64</span><span class="op" id="6114962">(</span><span class="op" id="6114963">)</span>&nbsp;<span class="op" id="6114965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6114969">b</span><span class="op" id="6114970">.</span><span class="ident" id="6114971">uint64</span><span class="op" id="6114977">(</span><span class="ident" id="6114978">fh</span><span class="op" id="6114980">.</span><span class="ident" id="6114981">CompressedSize64</span><span class="op" id="6114997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6115001">b</span><span class="op" id="6115002">.</span><span class="ident" id="6115003">uint64</span><span class="op" id="6115009">(</span><span class="ident" id="6115010">fh</span><span class="op" id="6115012">.</span><span class="ident" id="6115013">UncompressedSize64</span><span class="op" id="6115031">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6115034">}</span>&nbsp;<span class="keyword" id="6115036">else</span>&nbsp;<span class="op" id="6115041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6115045">b</span><span class="op" id="6115046">.</span><span class="builtintype" id="6115047">uint32</span><span class="op" id="6115053">(</span><span class="ident" id="6115054">fh</span><span class="op" id="6115056">.</span><span class="ident" id="6115057">CompressedSize</span><span class="op" id="6115071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6115075">b</span><span class="op" id="6115076">.</span><span class="builtintype" id="6115077">uint32</span><span class="op" id="6115083">(</span><span class="ident" id="6115084">fh</span><span class="op" id="6115086">.</span><span class="ident" id="6115087">UncompressedSize</span><span class="op" id="6115103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6115106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6115109">_</span><span class="op" id="6115110">,</span>&nbsp;<span class="ident" id="6115112">err</span>&nbsp;<span class="op" id="6115116">:=</span>&nbsp;<span class="ident" id="6115119">w</span><span class="op" id="6115120">.</span><span class="ident" id="6115121">zipw</span><span class="op" id="6115125">.</span><span class="ident" id="6115126">Write</span><span class="op" id="6115131">(</span><span class="ident" id="6115132">buf</span><span class="op" id="6115135">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6115138">return</span>&nbsp;<span class="ident" id="6115145">err</span><br>
<span class="lineno"></span><span class="op" id="6115149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6115152">type</span>&nbsp;<span class="ident" id="6115157">countWriter</span>&nbsp;<span class="keyword" id="6115169">struct</span>&nbsp;<span class="op" id="6115176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6115179">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6115185">io</span><span class="op" id="6115187">.</span><span class="ident" id="6115188">Writer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6115196">count</span>&nbsp;<span class="ident" id="6115202">int64</span><br>
<span class="lineno"></span><span class="op" id="6115208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6115211">func</span>&nbsp;<span class="op" id="6115216">(</span><span class="ident" id="6115217">w</span>&nbsp;<span class="op" id="6115219">*</span><span class="ident" id="6115220">countWriter</span><span class="op" id="6115231">)</span>&nbsp;<span class="ident" id="6115233">Write</span><span class="op" id="6115238">(</span><span class="ident" id="6115239">p</span>&nbsp;<span class="op" id="6115241">[</span><span class="op" id="6115242">]</span><span class="builtintype" id="6115243">byte</span><span class="op" id="6115247">)</span>&nbsp;<span class="op" id="6115249">(</span><span class="builtintype" id="6115250">int</span><span class="op" id="6115253">,</span>&nbsp;<span class="builtintype" id="6115255">error</span><span class="op" id="6115260">)</span>&nbsp;<span class="op" id="6115262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6115265">n</span><span class="op" id="6115266">,</span>&nbsp;<span class="ident" id="6115268">err</span>&nbsp;<span class="op" id="6115272">:=</span>&nbsp;<span class="ident" id="6115275">w</span><span class="op" id="6115276">.</span><span class="ident" id="6115277">w</span><span class="op" id="6115278">.</span><span class="ident" id="6115279">Write</span><span class="op" id="6115284">(</span><span class="ident" id="6115285">p</span><span class="op" id="6115286">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6115289">w</span><span class="op" id="6115290">.</span><span class="ident" id="6115291">count</span>&nbsp;<span class="op" id="6115297">+=</span>&nbsp;<span class="ident" id="6115300">int64</span><span class="op" id="6115305">(</span><span class="ident" id="6115306">n</span><span class="op" id="6115307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6115310">return</span>&nbsp;<span class="ident" id="6115317">n</span><span class="op" id="6115318">,</span>&nbsp;<span class="ident" id="6115320">err</span><br>
<span class="lineno"></span><span class="op" id="6115324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6115327">type</span>&nbsp;<span class="ident" id="6115332">nopCloser</span>&nbsp;<span class="keyword" id="6115342">struct</span>&nbsp;<span class="op" id="6115349">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6115352">io</span><span class="op" id="6115354">.</span><span class="ident" id="6115355">Writer</span><br>
<span class="lineno"></span><span class="op" id="6115362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6115365">func</span>&nbsp;<span class="op" id="6115370">(</span><span class="ident" id="6115371">w</span>&nbsp;<span class="ident" id="6115373">nopCloser</span><span class="op" id="6115382">)</span>&nbsp;<span class="ident" id="6115384">Close</span><span class="op" id="6115389">(</span><span class="op" id="6115390">)</span>&nbsp;<span class="builtintype" id="6115392">error</span>&nbsp;<span class="op" id="6115398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6115401">return</span>&nbsp;<span class="ident" id="6115408">nil</span><br>
<span class="lineno">340</span><span class="op" id="6115412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6115415">type</span>&nbsp;<span class="ident" id="6115420">writeBuf</span>&nbsp;<span class="op" id="6115429">[</span><span class="op" id="6115430">]</span><span class="builtintype" id="6115431">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6115437">func</span>&nbsp;<span class="op" id="6115442">(</span><span class="ident" id="6115443">b</span>&nbsp;<span class="op" id="6115445">*</span><span class="ident" id="6115446">writeBuf</span><span class="op" id="6115454">)</span>&nbsp;<span class="builtintype" id="6115456">uint16</span><span class="op" id="6115462">(</span><span class="ident" id="6115463">v</span>&nbsp;<span class="builtintype" id="6115465">uint16</span><span class="op" id="6115471">)</span>&nbsp;<span class="op" id="6115473">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6115476">binary</span><span class="op" id="6115482">.</span><span class="ident" id="6115483">LittleEndian</span><span class="op" id="6115495">.</span><span class="ident" id="6115496">PutUint16</span><span class="op" id="6115505">(</span><span class="op" id="6115506">*</span><span class="ident" id="6115507">b</span><span class="op" id="6115508">,</span>&nbsp;<span class="ident" id="6115510">v</span><span class="op" id="6115511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6115514">*</span><span class="ident" id="6115515">b</span>&nbsp;<span class="op" id="6115517">=</span>&nbsp;<span class="op" id="6115519">(</span><span class="op" id="6115520">*</span><span class="ident" id="6115521">b</span><span class="op" id="6115522">)</span><span class="op" id="6115523">[</span><span class="num" id="6115524">2</span><span class="op" id="6115525">:</span><span class="op" id="6115526">]</span><br>
<span class="lineno"></span><span class="op" id="6115528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6115531">func</span>&nbsp;<span class="op" id="6115536">(</span><span class="ident" id="6115537">b</span>&nbsp;<span class="op" id="6115539">*</span><span class="ident" id="6115540">writeBuf</span><span class="op" id="6115548">)</span>&nbsp;<span class="builtintype" id="6115550">uint32</span><span class="op" id="6115556">(</span><span class="ident" id="6115557">v</span>&nbsp;<span class="builtintype" id="6115559">uint32</span><span class="op" id="6115565">)</span>&nbsp;<span class="op" id="6115567">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6115570">binary</span><span class="op" id="6115576">.</span><span class="ident" id="6115577">LittleEndian</span><span class="op" id="6115589">.</span><span class="ident" id="6115590">PutUint32</span><span class="op" id="6115599">(</span><span class="op" id="6115600">*</span><span class="ident" id="6115601">b</span><span class="op" id="6115602">,</span>&nbsp;<span class="ident" id="6115604">v</span><span class="op" id="6115605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6115608">*</span><span class="ident" id="6115609">b</span>&nbsp;<span class="op" id="6115611">=</span>&nbsp;<span class="op" id="6115613">(</span><span class="op" id="6115614">*</span><span class="ident" id="6115615">b</span><span class="op" id="6115616">)</span><span class="op" id="6115617">[</span><span class="num" id="6115618">4</span><span class="op" id="6115619">:</span><span class="op" id="6115620">]</span><br>
<span class="lineno"></span><span class="op" id="6115622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6115625">func</span>&nbsp;<span class="op" id="6115630">(</span><span class="ident" id="6115631">b</span>&nbsp;<span class="op" id="6115633">*</span><span class="ident" id="6115634">writeBuf</span><span class="op" id="6115642">)</span>&nbsp;<span class="ident" id="6115644">uint64</span><span class="op" id="6115650">(</span><span class="ident" id="6115651">v</span>&nbsp;<span class="ident" id="6115653">uint64</span><span class="op" id="6115659">)</span>&nbsp;<span class="op" id="6115661">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6115664">binary</span><span class="op" id="6115670">.</span><span class="ident" id="6115671">LittleEndian</span><span class="op" id="6115683">.</span><span class="ident" id="6115684">PutUint64</span><span class="op" id="6115693">(</span><span class="op" id="6115694">*</span><span class="ident" id="6115695">b</span><span class="op" id="6115696">,</span>&nbsp;<span class="ident" id="6115698">v</span><span class="op" id="6115699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6115702">*</span><span class="ident" id="6115703">b</span>&nbsp;<span class="op" id="6115705">=</span>&nbsp;<span class="op" id="6115707">(</span><span class="op" id="6115708">*</span><span class="ident" id="6115709">b</span><span class="op" id="6115710">)</span><span class="op" id="6115711">[</span><span class="num" id="6115712">8</span><span class="op" id="6115713">:</span><span class="op" id="6115714">]</span><br>
<span class="lineno"></span><span class="op" id="6115716">}</span>
</div>
</body>
</html>
