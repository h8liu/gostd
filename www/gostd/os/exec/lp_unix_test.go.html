<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/exec</h2>
<ul>
<li><a href="/gostd/os/exec/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/exec/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/os/exec/lp_test.go.html">lp_test.go</a></li>
<li><a href="/gostd/os/exec/lp_unix.go.html">lp_unix.go</a></li>
<li><a href="/gostd/os/exec/lp_unix_test.go.html" class="current">lp_unix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6673039">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6673095">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6673149">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6673200">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6673265">package</span>&nbsp;<span class="ident" id="6673273">exec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6673279">import</span>&nbsp;<span class="op" id="6673286">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6673289">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6673302">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6673308">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6673318">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6673321">func</span>&nbsp;<span class="ident" id="6673326">TestLookPathUnixEmptyPath</span><span class="op" id="6673351">(</span><span class="ident" id="6673352">t</span>&nbsp;<span class="op" id="6673354">*</span><span class="ident" id="6673355">testing</span><span class="op" id="6673362">.</span><span class="ident" id="6673363">T</span><span class="op" id="6673364">)</span>&nbsp;<span class="op" id="6673366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673369">tmp</span><span class="op" id="6673372">,</span>&nbsp;<span class="ident" id="6673374">err</span>&nbsp;<span class="op" id="6673378">:=</span>&nbsp;<span class="ident" id="6673381">ioutil</span><span class="op" id="6673387">.</span><span class="ident" id="6673388">TempDir</span><span class="op" id="6673395">(</span><span class="string" id="6673396">&#34;&#34;</span><span class="op" id="6673398">,</span>&nbsp;<span class="string" id="6673400">&#34;TestLookPathUnixEmptyPath&#34;</span><span class="op" id="6673427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6673430">if</span>&nbsp;<span class="ident" id="6673433">err</span>&nbsp;<span class="op" id="6673437">!=</span>&nbsp;<span class="ident" id="6673440">nil</span>&nbsp;<span class="op" id="6673444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673448">t</span><span class="op" id="6673449">.</span><span class="ident" id="6673450">Fatal</span><span class="op" id="6673455">(</span><span class="string" id="6673456">&#34;TempDir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6673474">,</span>&nbsp;<span class="ident" id="6673476">err</span><span class="op" id="6673479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6673482">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6673485">defer</span>&nbsp;<span class="ident" id="6673491">os</span><span class="op" id="6673493">.</span><span class="ident" id="6673494">RemoveAll</span><span class="op" id="6673503">(</span><span class="ident" id="6673504">tmp</span><span class="op" id="6673507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673510">wd</span><span class="op" id="6673512">,</span>&nbsp;<span class="ident" id="6673514">err</span>&nbsp;<span class="op" id="6673518">:=</span>&nbsp;<span class="ident" id="6673521">os</span><span class="op" id="6673523">.</span><span class="ident" id="6673524">Getwd</span><span class="op" id="6673529">(</span><span class="op" id="6673530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6673533">if</span>&nbsp;<span class="ident" id="6673536">err</span>&nbsp;<span class="op" id="6673540">!=</span>&nbsp;<span class="ident" id="6673543">nil</span>&nbsp;<span class="op" id="6673547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673551">t</span><span class="op" id="6673552">.</span><span class="ident" id="6673553">Fatal</span><span class="op" id="6673558">(</span><span class="string" id="6673559">&#34;Getwd&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6673575">,</span>&nbsp;<span class="ident" id="6673577">err</span><span class="op" id="6673580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6673583">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673586">err</span>&nbsp;<span class="op" id="6673590">=</span>&nbsp;<span class="ident" id="6673592">os</span><span class="op" id="6673594">.</span><span class="ident" id="6673595">Chdir</span><span class="op" id="6673600">(</span><span class="ident" id="6673601">tmp</span><span class="op" id="6673604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6673607">if</span>&nbsp;<span class="ident" id="6673610">err</span>&nbsp;<span class="op" id="6673614">!=</span>&nbsp;<span class="ident" id="6673617">nil</span>&nbsp;<span class="op" id="6673621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673625">t</span><span class="op" id="6673626">.</span><span class="ident" id="6673627">Fatal</span><span class="op" id="6673632">(</span><span class="string" id="6673633">&#34;Chdir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6673649">,</span>&nbsp;<span class="ident" id="6673651">err</span><span class="op" id="6673654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6673657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6673660">defer</span>&nbsp;<span class="ident" id="6673666">os</span><span class="op" id="6673668">.</span><span class="ident" id="6673669">Chdir</span><span class="op" id="6673674">(</span><span class="ident" id="6673675">wd</span><span class="op" id="6673677">)</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673681">f</span><span class="op" id="6673682">,</span>&nbsp;<span class="ident" id="6673684">err</span>&nbsp;<span class="op" id="6673688">:=</span>&nbsp;<span class="ident" id="6673691">os</span><span class="op" id="6673693">.</span><span class="ident" id="6673694">OpenFile</span><span class="op" id="6673702">(</span><span class="string" id="6673703">&#34;exec_me&#34;</span><span class="op" id="6673712">,</span>&nbsp;<span class="ident" id="6673714">os</span><span class="op" id="6673716">.</span><span class="ident" id="6673717">O_CREATE</span><span class="op" id="6673725">|</span><span class="ident" id="6673726">os</span><span class="op" id="6673728">.</span><span class="ident" id="6673729">O_EXCL</span><span class="op" id="6673735">,</span>&nbsp;<span class="num" id="6673737">0700</span><span class="op" id="6673741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6673744">if</span>&nbsp;<span class="ident" id="6673747">err</span>&nbsp;<span class="op" id="6673751">!=</span>&nbsp;<span class="ident" id="6673754">nil</span>&nbsp;<span class="op" id="6673758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673762">t</span><span class="op" id="6673763">.</span><span class="ident" id="6673764">Fatal</span><span class="op" id="6673769">(</span><span class="string" id="6673770">&#34;OpenFile&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6673789">,</span>&nbsp;<span class="ident" id="6673791">err</span><span class="op" id="6673794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6673797">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673800">err</span>&nbsp;<span class="op" id="6673804">=</span>&nbsp;<span class="ident" id="6673806">f</span><span class="op" id="6673807">.</span><span class="ident" id="6673808">Close</span><span class="op" id="6673813">(</span><span class="op" id="6673814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6673817">if</span>&nbsp;<span class="ident" id="6673820">err</span>&nbsp;<span class="op" id="6673824">!=</span>&nbsp;<span class="ident" id="6673827">nil</span>&nbsp;<span class="op" id="6673831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673835">t</span><span class="op" id="6673836">.</span><span class="ident" id="6673837">Fatal</span><span class="op" id="6673842">(</span><span class="string" id="6673843">&#34;Close&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6673859">,</span>&nbsp;<span class="ident" id="6673861">err</span><span class="op" id="6673864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6673867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673871">pathenv</span>&nbsp;<span class="op" id="6673879">:=</span>&nbsp;<span class="ident" id="6673882">os</span><span class="op" id="6673884">.</span><span class="ident" id="6673885">Getenv</span><span class="op" id="6673891">(</span><span class="string" id="6673892">&#34;PATH&#34;</span><span class="op" id="6673898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6673901">defer</span>&nbsp;<span class="ident" id="6673907">os</span><span class="op" id="6673909">.</span><span class="ident" id="6673910">Setenv</span><span class="op" id="6673916">(</span><span class="string" id="6673917">&#34;PATH&#34;</span><span class="op" id="6673923">,</span>&nbsp;<span class="ident" id="6673925">pathenv</span><span class="op" id="6673932">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673936">err</span>&nbsp;<span class="op" id="6673940">=</span>&nbsp;<span class="ident" id="6673942">os</span><span class="op" id="6673944">.</span><span class="ident" id="6673945">Setenv</span><span class="op" id="6673951">(</span><span class="string" id="6673952">&#34;PATH&#34;</span><span class="op" id="6673958">,</span>&nbsp;<span class="string" id="6673960">&#34;&#34;</span><span class="op" id="6673962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6673965">if</span>&nbsp;<span class="ident" id="6673968">err</span>&nbsp;<span class="op" id="6673972">!=</span>&nbsp;<span class="ident" id="6673975">nil</span>&nbsp;<span class="op" id="6673979">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673983">t</span><span class="op" id="6673984">.</span><span class="ident" id="6673985">Fatal</span><span class="op" id="6673990">(</span><span class="string" id="6673991">&#34;Setenv&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6674008">,</span>&nbsp;<span class="ident" id="6674010">err</span><span class="op" id="6674013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6674020">path</span><span class="op" id="6674024">,</span>&nbsp;<span class="ident" id="6674026">err</span>&nbsp;<span class="op" id="6674030">:=</span>&nbsp;<span class="ident" id="6674033">LookPath</span><span class="op" id="6674041">(</span><span class="string" id="6674042">&#34;exec_me&#34;</span><span class="op" id="6674051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6674054">if</span>&nbsp;<span class="ident" id="6674057">err</span>&nbsp;<span class="op" id="6674061">==</span>&nbsp;<span class="ident" id="6674064">nil</span>&nbsp;<span class="op" id="6674068">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6674072">t</span><span class="op" id="6674073">.</span><span class="ident" id="6674074">Fatal</span><span class="op" id="6674079">(</span><span class="string" id="6674080">&#34;LookPath&nbsp;found&nbsp;exec_me&nbsp;in&nbsp;empty&nbsp;$PATH&#34;</span><span class="op" id="6674119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6674125">if</span>&nbsp;<span class="ident" id="6674128">path</span>&nbsp;<span class="op" id="6674133">!=</span>&nbsp;<span class="string" id="6674136">&#34;&#34;</span>&nbsp;<span class="op" id="6674139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6674143">t</span><span class="op" id="6674144">.</span><span class="ident" id="6674145">Fatalf</span><span class="op" id="6674151">(</span><span class="string" id="6674152">&#34;LookPath&nbsp;path&nbsp;==&nbsp;%q&nbsp;when&nbsp;err&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="6674189">,</span>&nbsp;<span class="ident" id="6674191">path</span><span class="op" id="6674195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674198">}</span><br>
<span class="lineno">55</span><span class="op" id="6674200">}</span>
</div>
</body>
</html>
