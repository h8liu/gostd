<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html" class="current">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7678055">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7678111">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7678165">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7678216">//&nbsp;+build&nbsp;!nacl,!plan9,!windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7678249">package</span>&nbsp;<span class="ident" id="7678257">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7678262">import</span>&nbsp;<span class="op" id="7678269">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7678272">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7678281">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7678287">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7678298">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7678309">&#34;syscall&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7678320">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7678331">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7678338">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7678341">func</span>&nbsp;<span class="ident" id="7678346">TestReadUnixgramWithUnnamedSocket</span><span class="op" id="7678379">(</span><span class="ident" id="7678380">t</span>&nbsp;<span class="op" id="7678382">*</span><span class="ident" id="7678383">testing</span><span class="op" id="7678390">.</span><span class="ident" id="7678391">T</span><span class="op" id="7678392">)</span>&nbsp;<span class="op" id="7678394">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678397">addr</span>&nbsp;<span class="op" id="7678402">:=</span>&nbsp;<span class="ident" id="7678405">testUnixAddr</span><span class="op" id="7678417">(</span><span class="op" id="7678418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678421">la</span><span class="op" id="7678423">,</span>&nbsp;<span class="ident" id="7678425">err</span>&nbsp;<span class="op" id="7678429">:=</span>&nbsp;<span class="ident" id="7678432">ResolveUnixAddr</span><span class="op" id="7678447">(</span><span class="string" id="7678448">&#34;unixgram&#34;</span><span class="op" id="7678458">,</span>&nbsp;<span class="ident" id="7678460">addr</span><span class="op" id="7678464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7678467">if</span>&nbsp;<span class="ident" id="7678470">err</span>&nbsp;<span class="op" id="7678474">!=</span>&nbsp;<span class="ident" id="7678477">nil</span>&nbsp;<span class="op" id="7678481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678485">t</span><span class="op" id="7678486">.</span><span class="ident" id="7678487">Fatalf</span><span class="op" id="7678493">(</span><span class="string" id="7678494">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7678522">,</span>&nbsp;<span class="ident" id="7678524">err</span><span class="op" id="7678527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7678530">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678533">c</span><span class="op" id="7678534">,</span>&nbsp;<span class="ident" id="7678536">err</span>&nbsp;<span class="op" id="7678540">:=</span>&nbsp;<span class="ident" id="7678543">ListenUnixgram</span><span class="op" id="7678557">(</span><span class="string" id="7678558">&#34;unixgram&#34;</span><span class="op" id="7678568">,</span>&nbsp;<span class="ident" id="7678570">la</span><span class="op" id="7678572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7678575">if</span>&nbsp;<span class="ident" id="7678578">err</span>&nbsp;<span class="op" id="7678582">!=</span>&nbsp;<span class="ident" id="7678585">nil</span>&nbsp;<span class="op" id="7678589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678593">t</span><span class="op" id="7678594">.</span><span class="ident" id="7678595">Fatalf</span><span class="op" id="7678601">(</span><span class="string" id="7678602">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7678629">,</span>&nbsp;<span class="ident" id="7678631">err</span><span class="op" id="7678634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7678637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7678640">defer</span>&nbsp;<span class="keyword" id="7678646">func</span><span class="op" id="7678650">(</span><span class="op" id="7678651">)</span>&nbsp;<span class="op" id="7678653">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678657">c</span><span class="op" id="7678658">.</span><span class="ident" id="7678659">Close</span><span class="op" id="7678664">(</span><span class="op" id="7678665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678669">os</span><span class="op" id="7678671">.</span><span class="ident" id="7678672">Remove</span><span class="op" id="7678678">(</span><span class="ident" id="7678679">addr</span><span class="op" id="7678683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7678686">}</span><span class="op" id="7678687">(</span><span class="op" id="7678688">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678692">off</span>&nbsp;<span class="op" id="7678696">:=</span>&nbsp;<span class="builtinfunc" id="7678699">make</span><span class="op" id="7678703">(</span><span class="keyword" id="7678704">chan</span>&nbsp;<span class="builtintype" id="7678709">bool</span><span class="op" id="7678713">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678716">data</span>&nbsp;<span class="op" id="7678721">:=</span>&nbsp;<span class="op" id="7678724">[</span><span class="num" id="7678725">5</span><span class="op" id="7678726">]</span><span class="builtintype" id="7678727">byte</span><span class="op" id="7678731">{</span><span class="num" id="7678732">1</span><span class="op" id="7678733">,</span>&nbsp;<span class="num" id="7678735">2</span><span class="op" id="7678736">,</span>&nbsp;<span class="num" id="7678738">3</span><span class="op" id="7678739">,</span>&nbsp;<span class="num" id="7678741">4</span><span class="op" id="7678742">,</span>&nbsp;<span class="num" id="7678744">5</span><span class="op" id="7678745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7678748">go</span>&nbsp;<span class="keyword" id="7678751">func</span><span class="op" id="7678755">(</span><span class="op" id="7678756">)</span>&nbsp;<span class="op" id="7678758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7678762">defer</span>&nbsp;<span class="keyword" id="7678768">func</span><span class="op" id="7678772">(</span><span class="op" id="7678773">)</span>&nbsp;<span class="op" id="7678775">{</span>&nbsp;<span class="ident" id="7678777">off</span>&nbsp;<span class="op" id="7678781">&lt;-</span>&nbsp;<span class="builtintype" id="7678784">true</span>&nbsp;<span class="op" id="7678789">}</span><span class="op" id="7678790">(</span><span class="op" id="7678791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678795">s</span><span class="op" id="7678796">,</span>&nbsp;<span class="ident" id="7678798">err</span>&nbsp;<span class="op" id="7678802">:=</span>&nbsp;<span class="ident" id="7678805">syscall</span><span class="op" id="7678812">.</span><span class="ident" id="7678813">Socket</span><span class="op" id="7678819">(</span><span class="ident" id="7678820">syscall</span><span class="op" id="7678827">.</span><span class="ident" id="7678828">AF_UNIX</span><span class="op" id="7678835">,</span>&nbsp;<span class="ident" id="7678837">syscall</span><span class="op" id="7678844">.</span><span class="ident" id="7678845">SOCK_DGRAM</span><span class="op" id="7678855">,</span>&nbsp;<span class="num" id="7678857">0</span><span class="op" id="7678858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7678862">if</span>&nbsp;<span class="ident" id="7678865">err</span>&nbsp;<span class="op" id="7678869">!=</span>&nbsp;<span class="ident" id="7678872">nil</span>&nbsp;<span class="op" id="7678876">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678881">t</span><span class="op" id="7678882">.</span><span class="ident" id="7678883">Errorf</span><span class="op" id="7678889">(</span><span class="string" id="7678890">&#34;syscall.Socket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7678917">,</span>&nbsp;<span class="ident" id="7678919">err</span><span class="op" id="7678922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7678927">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7678936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7678940">defer</span>&nbsp;<span class="ident" id="7678946">syscall</span><span class="op" id="7678953">.</span><span class="ident" id="7678954">Close</span><span class="op" id="7678959">(</span><span class="ident" id="7678960">s</span><span class="op" id="7678961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678965">rsa</span>&nbsp;<span class="op" id="7678969">:=</span>&nbsp;<span class="op" id="7678972">&amp;</span><span class="ident" id="7678973">syscall</span><span class="op" id="7678980">.</span><span class="ident" id="7678981">SockaddrUnix</span><span class="op" id="7678993">{</span><span class="ident" id="7678994">Name</span><span class="op" id="7678998">:</span>&nbsp;<span class="ident" id="7679000">addr</span><span class="op" id="7679004">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7679008">if</span>&nbsp;<span class="ident" id="7679011">err</span>&nbsp;<span class="op" id="7679015">:=</span>&nbsp;<span class="ident" id="7679018">syscall</span><span class="op" id="7679025">.</span><span class="ident" id="7679026">Sendto</span><span class="op" id="7679032">(</span><span class="ident" id="7679033">s</span><span class="op" id="7679034">,</span>&nbsp;<span class="ident" id="7679036">data</span><span class="op" id="7679040">[</span><span class="op" id="7679041">:</span><span class="op" id="7679042">]</span><span class="op" id="7679043">,</span>&nbsp;<span class="num" id="7679045">0</span><span class="op" id="7679046">,</span>&nbsp;<span class="ident" id="7679048">rsa</span><span class="op" id="7679051">)</span><span class="op" id="7679052">;</span>&nbsp;<span class="ident" id="7679054">err</span>&nbsp;<span class="op" id="7679058">!=</span>&nbsp;<span class="ident" id="7679061">nil</span>&nbsp;<span class="op" id="7679065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679070">t</span><span class="op" id="7679071">.</span><span class="ident" id="7679072">Errorf</span><span class="op" id="7679078">(</span><span class="string" id="7679079">&#34;syscall.Sendto&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7679106">,</span>&nbsp;<span class="ident" id="7679108">err</span><span class="op" id="7679111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7679116">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7679125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7679128">}</span><span class="op" id="7679129">(</span><span class="op" id="7679130">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7679134">&lt;-</span><span class="ident" id="7679136">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679141">b</span>&nbsp;<span class="op" id="7679143">:=</span>&nbsp;<span class="builtinfunc" id="7679146">make</span><span class="op" id="7679150">(</span><span class="op" id="7679151">[</span><span class="op" id="7679152">]</span><span class="builtintype" id="7679153">byte</span><span class="op" id="7679157">,</span>&nbsp;<span class="num" id="7679159">64</span><span class="op" id="7679161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679164">c</span><span class="op" id="7679165">.</span><span class="ident" id="7679166">SetReadDeadline</span><span class="op" id="7679181">(</span><span class="ident" id="7679182">time</span><span class="op" id="7679186">.</span><span class="ident" id="7679187">Now</span><span class="op" id="7679190">(</span><span class="op" id="7679191">)</span><span class="op" id="7679192">.</span><span class="ident" id="7679193">Add</span><span class="op" id="7679196">(</span><span class="num" id="7679197">100</span>&nbsp;<span class="op" id="7679201">*</span>&nbsp;<span class="ident" id="7679203">time</span><span class="op" id="7679207">.</span><span class="ident" id="7679208">Millisecond</span><span class="op" id="7679219">)</span><span class="op" id="7679220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679223">n</span><span class="op" id="7679224">,</span>&nbsp;<span class="ident" id="7679226">from</span><span class="op" id="7679230">,</span>&nbsp;<span class="ident" id="7679232">err</span>&nbsp;<span class="op" id="7679236">:=</span>&nbsp;<span class="ident" id="7679239">c</span><span class="op" id="7679240">.</span><span class="ident" id="7679241">ReadFrom</span><span class="op" id="7679249">(</span><span class="ident" id="7679250">b</span><span class="op" id="7679251">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7679254">if</span>&nbsp;<span class="ident" id="7679257">err</span>&nbsp;<span class="op" id="7679261">!=</span>&nbsp;<span class="ident" id="7679264">nil</span>&nbsp;<span class="op" id="7679268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679272">t</span><span class="op" id="7679273">.</span><span class="ident" id="7679274">Fatalf</span><span class="op" id="7679280">(</span><span class="string" id="7679281">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7679311">,</span>&nbsp;<span class="ident" id="7679313">err</span><span class="op" id="7679316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7679319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7679322">if</span>&nbsp;<span class="ident" id="7679325">from</span>&nbsp;<span class="op" id="7679330">!=</span>&nbsp;<span class="ident" id="7679333">nil</span>&nbsp;<span class="op" id="7679337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679341">t</span><span class="op" id="7679342">.</span><span class="ident" id="7679343">Fatalf</span><span class="op" id="7679349">(</span><span class="string" id="7679350">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="7679374">,</span>&nbsp;<span class="ident" id="7679376">from</span><span class="op" id="7679380">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7679383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7679386">if</span>&nbsp;<span class="op" id="7679389">!</span><span class="ident" id="7679390">bytes</span><span class="op" id="7679395">.</span><span class="ident" id="7679396">Equal</span><span class="op" id="7679401">(</span><span class="ident" id="7679402">b</span><span class="op" id="7679403">[</span><span class="op" id="7679404">:</span><span class="ident" id="7679405">n</span><span class="op" id="7679406">]</span><span class="op" id="7679407">,</span>&nbsp;<span class="ident" id="7679409">data</span><span class="op" id="7679413">[</span><span class="op" id="7679414">:</span><span class="op" id="7679415">]</span><span class="op" id="7679416">)</span>&nbsp;<span class="op" id="7679418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679422">t</span><span class="op" id="7679423">.</span><span class="ident" id="7679424">Fatalf</span><span class="op" id="7679430">(</span><span class="string" id="7679431">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7679448">,</span>&nbsp;<span class="ident" id="7679450">b</span><span class="op" id="7679451">[</span><span class="op" id="7679452">:</span><span class="ident" id="7679453">n</span><span class="op" id="7679454">]</span><span class="op" id="7679455">,</span>&nbsp;<span class="ident" id="7679457">data</span><span class="op" id="7679461">[</span><span class="op" id="7679462">:</span><span class="op" id="7679463">]</span><span class="op" id="7679464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7679467">}</span><br>
<span class="lineno"></span><span class="op" id="7679469">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="7679472">func</span>&nbsp;<span class="ident" id="7679477">TestReadUnixgramWithZeroBytesBuffer</span><span class="op" id="7679512">(</span><span class="ident" id="7679513">t</span>&nbsp;<span class="op" id="7679515">*</span><span class="ident" id="7679516">testing</span><span class="op" id="7679523">.</span><span class="ident" id="7679524">T</span><span class="op" id="7679525">)</span>&nbsp;<span class="op" id="7679527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7679530">//&nbsp;issue&nbsp;4352:&nbsp;Recvfrom&nbsp;failed&nbsp;with&nbsp;&#34;address&nbsp;family&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7679587">//&nbsp;supported&nbsp;by&nbsp;protocol&nbsp;family&#34;&nbsp;if&nbsp;zero-length&nbsp;buffer&nbsp;provided</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679653">addr</span>&nbsp;<span class="op" id="7679658">:=</span>&nbsp;<span class="ident" id="7679661">testUnixAddr</span><span class="op" id="7679673">(</span><span class="op" id="7679674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679677">la</span><span class="op" id="7679679">,</span>&nbsp;<span class="ident" id="7679681">err</span>&nbsp;<span class="op" id="7679685">:=</span>&nbsp;<span class="ident" id="7679688">ResolveUnixAddr</span><span class="op" id="7679703">(</span><span class="string" id="7679704">&#34;unixgram&#34;</span><span class="op" id="7679714">,</span>&nbsp;<span class="ident" id="7679716">addr</span><span class="op" id="7679720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7679723">if</span>&nbsp;<span class="ident" id="7679726">err</span>&nbsp;<span class="op" id="7679730">!=</span>&nbsp;<span class="ident" id="7679733">nil</span>&nbsp;<span class="op" id="7679737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679741">t</span><span class="op" id="7679742">.</span><span class="ident" id="7679743">Fatalf</span><span class="op" id="7679749">(</span><span class="string" id="7679750">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7679778">,</span>&nbsp;<span class="ident" id="7679780">err</span><span class="op" id="7679783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7679786">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679789">c</span><span class="op" id="7679790">,</span>&nbsp;<span class="ident" id="7679792">err</span>&nbsp;<span class="op" id="7679796">:=</span>&nbsp;<span class="ident" id="7679799">ListenUnixgram</span><span class="op" id="7679813">(</span><span class="string" id="7679814">&#34;unixgram&#34;</span><span class="op" id="7679824">,</span>&nbsp;<span class="ident" id="7679826">la</span><span class="op" id="7679828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7679831">if</span>&nbsp;<span class="ident" id="7679834">err</span>&nbsp;<span class="op" id="7679838">!=</span>&nbsp;<span class="ident" id="7679841">nil</span>&nbsp;<span class="op" id="7679845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679849">t</span><span class="op" id="7679850">.</span><span class="ident" id="7679851">Fatalf</span><span class="op" id="7679857">(</span><span class="string" id="7679858">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7679885">,</span>&nbsp;<span class="ident" id="7679887">err</span><span class="op" id="7679890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7679893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7679896">defer</span>&nbsp;<span class="keyword" id="7679902">func</span><span class="op" id="7679906">(</span><span class="op" id="7679907">)</span>&nbsp;<span class="op" id="7679909">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679913">c</span><span class="op" id="7679914">.</span><span class="ident" id="7679915">Close</span><span class="op" id="7679920">(</span><span class="op" id="7679921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679925">os</span><span class="op" id="7679927">.</span><span class="ident" id="7679928">Remove</span><span class="op" id="7679934">(</span><span class="ident" id="7679935">addr</span><span class="op" id="7679939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7679942">}</span><span class="op" id="7679943">(</span><span class="op" id="7679944">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679948">off</span>&nbsp;<span class="op" id="7679952">:=</span>&nbsp;<span class="builtinfunc" id="7679955">make</span><span class="op" id="7679959">(</span><span class="keyword" id="7679960">chan</span>&nbsp;<span class="builtintype" id="7679965">bool</span><span class="op" id="7679969">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7679972">go</span>&nbsp;<span class="keyword" id="7679975">func</span><span class="op" id="7679979">(</span><span class="op" id="7679980">)</span>&nbsp;<span class="op" id="7679982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7679986">defer</span>&nbsp;<span class="keyword" id="7679992">func</span><span class="op" id="7679996">(</span><span class="op" id="7679997">)</span>&nbsp;<span class="op" id="7679999">{</span>&nbsp;<span class="ident" id="7680001">off</span>&nbsp;<span class="op" id="7680005">&lt;-</span>&nbsp;<span class="builtintype" id="7680008">true</span>&nbsp;<span class="op" id="7680013">}</span><span class="op" id="7680014">(</span><span class="op" id="7680015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680019">c</span><span class="op" id="7680020">,</span>&nbsp;<span class="ident" id="7680022">err</span>&nbsp;<span class="op" id="7680026">:=</span>&nbsp;<span class="ident" id="7680029">DialUnix</span><span class="op" id="7680037">(</span><span class="string" id="7680038">&#34;unixgram&#34;</span><span class="op" id="7680048">,</span>&nbsp;<span class="ident" id="7680050">nil</span><span class="op" id="7680053">,</span>&nbsp;<span class="ident" id="7680055">la</span><span class="op" id="7680057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680061">if</span>&nbsp;<span class="ident" id="7680064">err</span>&nbsp;<span class="op" id="7680068">!=</span>&nbsp;<span class="ident" id="7680071">nil</span>&nbsp;<span class="op" id="7680075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680080">t</span><span class="op" id="7680081">.</span><span class="ident" id="7680082">Errorf</span><span class="op" id="7680088">(</span><span class="string" id="7680089">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7680110">,</span>&nbsp;<span class="ident" id="7680112">err</span><span class="op" id="7680115">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680120">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680133">defer</span>&nbsp;<span class="ident" id="7680139">c</span><span class="op" id="7680140">.</span><span class="ident" id="7680141">Close</span><span class="op" id="7680146">(</span><span class="op" id="7680147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680151">if</span>&nbsp;<span class="ident" id="7680154">_</span><span class="op" id="7680155">,</span>&nbsp;<span class="ident" id="7680157">err</span>&nbsp;<span class="op" id="7680161">:=</span>&nbsp;<span class="ident" id="7680164">c</span><span class="op" id="7680165">.</span><span class="ident" id="7680166">Write</span><span class="op" id="7680171">(</span><span class="op" id="7680172">[</span><span class="op" id="7680173">]</span><span class="builtintype" id="7680174">byte</span><span class="op" id="7680178">{</span><span class="num" id="7680179">1</span><span class="op" id="7680180">,</span>&nbsp;<span class="num" id="7680182">2</span><span class="op" id="7680183">,</span>&nbsp;<span class="num" id="7680185">3</span><span class="op" id="7680186">,</span>&nbsp;<span class="num" id="7680188">4</span><span class="op" id="7680189">,</span>&nbsp;<span class="num" id="7680191">5</span><span class="op" id="7680192">}</span><span class="op" id="7680193">)</span><span class="op" id="7680194">;</span>&nbsp;<span class="ident" id="7680196">err</span>&nbsp;<span class="op" id="7680200">!=</span>&nbsp;<span class="ident" id="7680203">nil</span>&nbsp;<span class="op" id="7680207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680212">t</span><span class="op" id="7680213">.</span><span class="ident" id="7680214">Errorf</span><span class="op" id="7680220">(</span><span class="string" id="7680221">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7680248">,</span>&nbsp;<span class="ident" id="7680250">err</span><span class="op" id="7680253">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680258">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680270">}</span><span class="op" id="7680271">(</span><span class="op" id="7680272">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680276">&lt;-</span><span class="ident" id="7680278">off</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680283">c</span><span class="op" id="7680284">.</span><span class="ident" id="7680285">SetReadDeadline</span><span class="op" id="7680300">(</span><span class="ident" id="7680301">time</span><span class="op" id="7680305">.</span><span class="ident" id="7680306">Now</span><span class="op" id="7680309">(</span><span class="op" id="7680310">)</span><span class="op" id="7680311">.</span><span class="ident" id="7680312">Add</span><span class="op" id="7680315">(</span><span class="num" id="7680316">100</span>&nbsp;<span class="op" id="7680320">*</span>&nbsp;<span class="ident" id="7680322">time</span><span class="op" id="7680326">.</span><span class="ident" id="7680327">Millisecond</span><span class="op" id="7680338">)</span><span class="op" id="7680339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680342">_</span><span class="op" id="7680343">,</span>&nbsp;<span class="ident" id="7680345">from</span><span class="op" id="7680349">,</span>&nbsp;<span class="ident" id="7680351">err</span>&nbsp;<span class="op" id="7680355">:=</span>&nbsp;<span class="ident" id="7680358">c</span><span class="op" id="7680359">.</span><span class="ident" id="7680360">ReadFrom</span><span class="op" id="7680368">(</span><span class="ident" id="7680369">nil</span><span class="op" id="7680372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680375">if</span>&nbsp;<span class="ident" id="7680378">err</span>&nbsp;<span class="op" id="7680382">!=</span>&nbsp;<span class="ident" id="7680385">nil</span>&nbsp;<span class="op" id="7680389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680393">t</span><span class="op" id="7680394">.</span><span class="ident" id="7680395">Fatalf</span><span class="op" id="7680401">(</span><span class="string" id="7680402">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7680432">,</span>&nbsp;<span class="ident" id="7680434">err</span><span class="op" id="7680437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680440">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680443">if</span>&nbsp;<span class="ident" id="7680446">from</span>&nbsp;<span class="op" id="7680451">!=</span>&nbsp;<span class="ident" id="7680454">nil</span>&nbsp;<span class="op" id="7680458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680462">t</span><span class="op" id="7680463">.</span><span class="ident" id="7680464">Fatalf</span><span class="op" id="7680470">(</span><span class="string" id="7680471">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="7680495">,</span>&nbsp;<span class="ident" id="7680497">from</span><span class="op" id="7680501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680504">}</span><br>
<span class="lineno"></span><span class="op" id="7680506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="7680509">func</span>&nbsp;<span class="ident" id="7680514">TestUnixgramAutobind</span><span class="op" id="7680534">(</span><span class="ident" id="7680535">t</span>&nbsp;<span class="op" id="7680537">*</span><span class="ident" id="7680538">testing</span><span class="op" id="7680545">.</span><span class="ident" id="7680546">T</span><span class="op" id="7680547">)</span>&nbsp;<span class="op" id="7680549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680552">if</span>&nbsp;<span class="ident" id="7680555">runtime</span><span class="op" id="7680562">.</span><span class="ident" id="7680563">GOOS</span>&nbsp;<span class="op" id="7680568">!=</span>&nbsp;<span class="string" id="7680571">&#34;linux&#34;</span>&nbsp;<span class="op" id="7680579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680583">t</span><span class="op" id="7680584">.</span><span class="ident" id="7680585">Skip</span><span class="op" id="7680589">(</span><span class="string" id="7680590">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="7680624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680631">laddr</span>&nbsp;<span class="op" id="7680637">:=</span>&nbsp;<span class="op" id="7680640">&amp;</span><span class="ident" id="7680641">UnixAddr</span><span class="op" id="7680649">{</span><span class="ident" id="7680650">Name</span><span class="op" id="7680654">:</span>&nbsp;<span class="string" id="7680656">&#34;&#34;</span><span class="op" id="7680658">,</span>&nbsp;<span class="ident" id="7680660">Net</span><span class="op" id="7680663">:</span>&nbsp;<span class="string" id="7680665">&#34;unixgram&#34;</span><span class="op" id="7680675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680678">c1</span><span class="op" id="7680680">,</span>&nbsp;<span class="ident" id="7680682">err</span>&nbsp;<span class="op" id="7680686">:=</span>&nbsp;<span class="ident" id="7680689">ListenUnixgram</span><span class="op" id="7680703">(</span><span class="string" id="7680704">&#34;unixgram&#34;</span><span class="op" id="7680714">,</span>&nbsp;<span class="ident" id="7680716">laddr</span><span class="op" id="7680721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680724">if</span>&nbsp;<span class="ident" id="7680727">err</span>&nbsp;<span class="op" id="7680731">!=</span>&nbsp;<span class="ident" id="7680734">nil</span>&nbsp;<span class="op" id="7680738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680742">t</span><span class="op" id="7680743">.</span><span class="ident" id="7680744">Fatalf</span><span class="op" id="7680750">(</span><span class="string" id="7680751">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7680778">,</span>&nbsp;<span class="ident" id="7680780">err</span><span class="op" id="7680783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680786">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680789">defer</span>&nbsp;<span class="ident" id="7680795">c1</span><span class="op" id="7680797">.</span><span class="ident" id="7680798">Close</span><span class="op" id="7680803">(</span><span class="op" id="7680804">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7680808">//&nbsp;retrieve&nbsp;the&nbsp;autobind&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680842">autoAddr</span>&nbsp;<span class="op" id="7680851">:=</span>&nbsp;<span class="ident" id="7680854">c1</span><span class="op" id="7680856">.</span><span class="ident" id="7680857">LocalAddr</span><span class="op" id="7680866">(</span><span class="op" id="7680867">)</span><span class="op" id="7680868">.</span><span class="op" id="7680869">(</span><span class="op" id="7680870">*</span><span class="ident" id="7680871">UnixAddr</span><span class="op" id="7680879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680882">if</span>&nbsp;<span class="builtinfunc" id="7680885">len</span><span class="op" id="7680888">(</span><span class="ident" id="7680889">autoAddr</span><span class="op" id="7680897">.</span><span class="ident" id="7680898">Name</span><span class="op" id="7680902">)</span>&nbsp;<span class="op" id="7680904">&lt;=</span>&nbsp;<span class="num" id="7680907">1</span>&nbsp;<span class="op" id="7680909">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680913">t</span><span class="op" id="7680914">.</span><span class="ident" id="7680915">Fatalf</span><span class="op" id="7680921">(</span><span class="string" id="7680922">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="7680952">,</span>&nbsp;<span class="ident" id="7680954">autoAddr</span><span class="op" id="7680962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680968">if</span>&nbsp;<span class="ident" id="7680971">autoAddr</span><span class="op" id="7680979">.</span><span class="ident" id="7680980">Name</span><span class="op" id="7680984">[</span><span class="num" id="7680985">0</span><span class="op" id="7680986">]</span>&nbsp;<span class="op" id="7680988">!=</span>&nbsp;<span class="string" id="7680991">&#39;@&#39;</span>&nbsp;<span class="op" id="7680995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680999">t</span><span class="op" id="7681000">.</span><span class="ident" id="7681001">Fatalf</span><span class="op" id="7681007">(</span><span class="string" id="7681008">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="7681038">,</span>&nbsp;<span class="ident" id="7681040">autoAddr</span><span class="op" id="7681048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681051">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681055">c2</span><span class="op" id="7681057">,</span>&nbsp;<span class="ident" id="7681059">err</span>&nbsp;<span class="op" id="7681063">:=</span>&nbsp;<span class="ident" id="7681066">DialUnix</span><span class="op" id="7681074">(</span><span class="string" id="7681075">&#34;unixgram&#34;</span><span class="op" id="7681085">,</span>&nbsp;<span class="ident" id="7681087">nil</span><span class="op" id="7681090">,</span>&nbsp;<span class="ident" id="7681092">autoAddr</span><span class="op" id="7681100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681103">if</span>&nbsp;<span class="ident" id="7681106">err</span>&nbsp;<span class="op" id="7681110">!=</span>&nbsp;<span class="ident" id="7681113">nil</span>&nbsp;<span class="op" id="7681117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681121">t</span><span class="op" id="7681122">.</span><span class="ident" id="7681123">Fatalf</span><span class="op" id="7681129">(</span><span class="string" id="7681130">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7681151">,</span>&nbsp;<span class="ident" id="7681153">err</span><span class="op" id="7681156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681159">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681162">defer</span>&nbsp;<span class="ident" id="7681168">c2</span><span class="op" id="7681170">.</span><span class="ident" id="7681171">Close</span><span class="op" id="7681176">(</span><span class="op" id="7681177">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681181">if</span>&nbsp;<span class="op" id="7681184">!</span><span class="ident" id="7681185">reflect</span><span class="op" id="7681192">.</span><span class="ident" id="7681193">DeepEqual</span><span class="op" id="7681202">(</span><span class="ident" id="7681203">c1</span><span class="op" id="7681205">.</span><span class="ident" id="7681206">LocalAddr</span><span class="op" id="7681215">(</span><span class="op" id="7681216">)</span><span class="op" id="7681217">,</span>&nbsp;<span class="ident" id="7681219">c2</span><span class="op" id="7681221">.</span><span class="ident" id="7681222">RemoteAddr</span><span class="op" id="7681232">(</span><span class="op" id="7681233">)</span><span class="op" id="7681234">)</span>&nbsp;<span class="op" id="7681236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681240">t</span><span class="op" id="7681241">.</span><span class="ident" id="7681242">Fatalf</span><span class="op" id="7681248">(</span><span class="string" id="7681249">&#34;expected&nbsp;autobind&nbsp;address&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7681287">,</span>&nbsp;<span class="ident" id="7681289">c1</span><span class="op" id="7681291">.</span><span class="ident" id="7681292">LocalAddr</span><span class="op" id="7681301">(</span><span class="op" id="7681302">)</span><span class="op" id="7681303">,</span>&nbsp;<span class="ident" id="7681305">c2</span><span class="op" id="7681307">.</span><span class="ident" id="7681308">RemoteAddr</span><span class="op" id="7681318">(</span><span class="op" id="7681319">)</span><span class="op" id="7681320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681323">}</span><br>
<span class="lineno">140</span><span class="op" id="7681325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7681328">func</span>&nbsp;<span class="ident" id="7681333">TestUnixAutobindClose</span><span class="op" id="7681354">(</span><span class="ident" id="7681355">t</span>&nbsp;<span class="op" id="7681357">*</span><span class="ident" id="7681358">testing</span><span class="op" id="7681365">.</span><span class="ident" id="7681366">T</span><span class="op" id="7681367">)</span>&nbsp;<span class="op" id="7681369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681372">if</span>&nbsp;<span class="ident" id="7681375">runtime</span><span class="op" id="7681382">.</span><span class="ident" id="7681383">GOOS</span>&nbsp;<span class="op" id="7681388">!=</span>&nbsp;<span class="string" id="7681391">&#34;linux&#34;</span>&nbsp;<span class="op" id="7681399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681403">t</span><span class="op" id="7681404">.</span><span class="ident" id="7681405">Skip</span><span class="op" id="7681409">(</span><span class="string" id="7681410">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="7681444">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681450">laddr</span>&nbsp;<span class="op" id="7681456">:=</span>&nbsp;<span class="op" id="7681459">&amp;</span><span class="ident" id="7681460">UnixAddr</span><span class="op" id="7681468">{</span><span class="ident" id="7681469">Name</span><span class="op" id="7681473">:</span>&nbsp;<span class="string" id="7681475">&#34;&#34;</span><span class="op" id="7681477">,</span>&nbsp;<span class="ident" id="7681479">Net</span><span class="op" id="7681482">:</span>&nbsp;<span class="string" id="7681484">&#34;unix&#34;</span><span class="op" id="7681490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681493">ln</span><span class="op" id="7681495">,</span>&nbsp;<span class="ident" id="7681497">err</span>&nbsp;<span class="op" id="7681501">:=</span>&nbsp;<span class="ident" id="7681504">ListenUnix</span><span class="op" id="7681514">(</span><span class="string" id="7681515">&#34;unix&#34;</span><span class="op" id="7681521">,</span>&nbsp;<span class="ident" id="7681523">laddr</span><span class="op" id="7681528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681531">if</span>&nbsp;<span class="ident" id="7681534">err</span>&nbsp;<span class="op" id="7681538">!=</span>&nbsp;<span class="ident" id="7681541">nil</span>&nbsp;<span class="op" id="7681545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681549">t</span><span class="op" id="7681550">.</span><span class="ident" id="7681551">Fatalf</span><span class="op" id="7681557">(</span><span class="string" id="7681558">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7681581">,</span>&nbsp;<span class="ident" id="7681583">err</span><span class="op" id="7681586">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681592">ln</span><span class="op" id="7681594">.</span><span class="ident" id="7681595">Close</span><span class="op" id="7681600">(</span><span class="op" id="7681601">)</span><br>
<span class="lineno"></span><span class="op" id="7681603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7681606">func</span>&nbsp;<span class="ident" id="7681611">TestUnixgramWrite</span><span class="op" id="7681628">(</span><span class="ident" id="7681629">t</span>&nbsp;<span class="op" id="7681631">*</span><span class="ident" id="7681632">testing</span><span class="op" id="7681639">.</span><span class="ident" id="7681640">T</span><span class="op" id="7681641">)</span>&nbsp;<span class="op" id="7681643">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681646">addr</span>&nbsp;<span class="op" id="7681651">:=</span>&nbsp;<span class="ident" id="7681654">testUnixAddr</span><span class="op" id="7681666">(</span><span class="op" id="7681667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681670">laddr</span><span class="op" id="7681675">,</span>&nbsp;<span class="ident" id="7681677">err</span>&nbsp;<span class="op" id="7681681">:=</span>&nbsp;<span class="ident" id="7681684">ResolveUnixAddr</span><span class="op" id="7681699">(</span><span class="string" id="7681700">&#34;unixgram&#34;</span><span class="op" id="7681710">,</span>&nbsp;<span class="ident" id="7681712">addr</span><span class="op" id="7681716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681719">if</span>&nbsp;<span class="ident" id="7681722">err</span>&nbsp;<span class="op" id="7681726">!=</span>&nbsp;<span class="ident" id="7681729">nil</span>&nbsp;<span class="op" id="7681733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681737">t</span><span class="op" id="7681738">.</span><span class="ident" id="7681739">Fatalf</span><span class="op" id="7681745">(</span><span class="string" id="7681746">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7681774">,</span>&nbsp;<span class="ident" id="7681776">err</span><span class="op" id="7681779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681782">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681785">c</span><span class="op" id="7681786">,</span>&nbsp;<span class="ident" id="7681788">err</span>&nbsp;<span class="op" id="7681792">:=</span>&nbsp;<span class="ident" id="7681795">ListenPacket</span><span class="op" id="7681807">(</span><span class="string" id="7681808">&#34;unixgram&#34;</span><span class="op" id="7681818">,</span>&nbsp;<span class="ident" id="7681820">addr</span><span class="op" id="7681824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681827">if</span>&nbsp;<span class="ident" id="7681830">err</span>&nbsp;<span class="op" id="7681834">!=</span>&nbsp;<span class="ident" id="7681837">nil</span>&nbsp;<span class="op" id="7681841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681845">t</span><span class="op" id="7681846">.</span><span class="ident" id="7681847">Fatalf</span><span class="op" id="7681853">(</span><span class="string" id="7681854">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7681879">,</span>&nbsp;<span class="ident" id="7681881">err</span><span class="op" id="7681884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681890">defer</span>&nbsp;<span class="ident" id="7681896">os</span><span class="op" id="7681898">.</span><span class="ident" id="7681899">Remove</span><span class="op" id="7681905">(</span><span class="ident" id="7681906">addr</span><span class="op" id="7681910">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681913">defer</span>&nbsp;<span class="ident" id="7681919">c</span><span class="op" id="7681920">.</span><span class="ident" id="7681921">Close</span><span class="op" id="7681926">(</span><span class="op" id="7681927">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681931">testUnixgramWriteConn</span><span class="op" id="7681952">(</span><span class="ident" id="7681953">t</span><span class="op" id="7681954">,</span>&nbsp;<span class="ident" id="7681956">laddr</span><span class="op" id="7681961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681964">testUnixgramWritePacketConn</span><span class="op" id="7681991">(</span><span class="ident" id="7681992">t</span><span class="op" id="7681993">,</span>&nbsp;<span class="ident" id="7681995">laddr</span><span class="op" id="7682000">)</span><br>
<span class="lineno"></span><span class="op" id="7682002">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="7682005">func</span>&nbsp;<span class="ident" id="7682010">testUnixgramWriteConn</span><span class="op" id="7682031">(</span><span class="ident" id="7682032">t</span>&nbsp;<span class="op" id="7682034">*</span><span class="ident" id="7682035">testing</span><span class="op" id="7682042">.</span><span class="ident" id="7682043">T</span><span class="op" id="7682044">,</span>&nbsp;<span class="ident" id="7682046">raddr</span>&nbsp;<span class="op" id="7682052">*</span><span class="ident" id="7682053">UnixAddr</span><span class="op" id="7682061">)</span>&nbsp;<span class="op" id="7682063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682066">c</span><span class="op" id="7682067">,</span>&nbsp;<span class="ident" id="7682069">err</span>&nbsp;<span class="op" id="7682073">:=</span>&nbsp;<span class="ident" id="7682076">Dial</span><span class="op" id="7682080">(</span><span class="string" id="7682081">&#34;unixgram&#34;</span><span class="op" id="7682091">,</span>&nbsp;<span class="ident" id="7682093">raddr</span><span class="op" id="7682098">.</span><span class="ident" id="7682099">String</span><span class="op" id="7682105">(</span><span class="op" id="7682106">)</span><span class="op" id="7682107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682110">if</span>&nbsp;<span class="ident" id="7682113">err</span>&nbsp;<span class="op" id="7682117">!=</span>&nbsp;<span class="ident" id="7682120">nil</span>&nbsp;<span class="op" id="7682124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682128">t</span><span class="op" id="7682129">.</span><span class="ident" id="7682130">Fatalf</span><span class="op" id="7682136">(</span><span class="string" id="7682137">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7682154">,</span>&nbsp;<span class="ident" id="7682156">err</span><span class="op" id="7682159">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682165">defer</span>&nbsp;<span class="ident" id="7682171">c</span><span class="op" id="7682172">.</span><span class="ident" id="7682173">Close</span><span class="op" id="7682178">(</span><span class="op" id="7682179">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682183">if</span>&nbsp;<span class="ident" id="7682186">_</span><span class="op" id="7682187">,</span>&nbsp;<span class="ident" id="7682189">err</span>&nbsp;<span class="op" id="7682193">:=</span>&nbsp;<span class="ident" id="7682196">c</span><span class="op" id="7682197">.</span><span class="op" id="7682198">(</span><span class="op" id="7682199">*</span><span class="ident" id="7682200">UnixConn</span><span class="op" id="7682208">)</span><span class="op" id="7682209">.</span><span class="ident" id="7682210">WriteToUnix</span><span class="op" id="7682221">(</span><span class="op" id="7682222">[</span><span class="op" id="7682223">]</span><span class="builtintype" id="7682224">byte</span><span class="op" id="7682228">(</span><span class="string" id="7682229">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7682262">)</span><span class="op" id="7682263">,</span>&nbsp;<span class="ident" id="7682265">raddr</span><span class="op" id="7682270">)</span><span class="op" id="7682271">;</span>&nbsp;<span class="ident" id="7682273">err</span>&nbsp;<span class="op" id="7682277">==</span>&nbsp;<span class="ident" id="7682280">nil</span>&nbsp;<span class="op" id="7682284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682288">t</span><span class="op" id="7682289">.</span><span class="ident" id="7682290">Fatal</span><span class="op" id="7682295">(</span><span class="string" id="7682296">&#34;WriteToUnix&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7682321">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682324">}</span>&nbsp;<span class="keyword" id="7682326">else</span>&nbsp;<span class="keyword" id="7682331">if</span>&nbsp;<span class="ident" id="7682334">err</span><span class="op" id="7682337">.</span><span class="op" id="7682338">(</span><span class="op" id="7682339">*</span><span class="ident" id="7682340">OpError</span><span class="op" id="7682347">)</span><span class="op" id="7682348">.</span><span class="ident" id="7682349">Err</span>&nbsp;<span class="op" id="7682353">!=</span>&nbsp;<span class="ident" id="7682356">ErrWriteToConnected</span>&nbsp;<span class="op" id="7682376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682380">t</span><span class="op" id="7682381">.</span><span class="ident" id="7682382">Fatalf</span><span class="op" id="7682388">(</span><span class="string" id="7682389">&#34;WriteToUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="7682441">,</span>&nbsp;<span class="ident" id="7682443">err</span><span class="op" id="7682446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682452">if</span>&nbsp;<span class="ident" id="7682455">_</span><span class="op" id="7682456">,</span>&nbsp;<span class="ident" id="7682458">err</span>&nbsp;<span class="op" id="7682462">=</span>&nbsp;<span class="ident" id="7682464">c</span><span class="op" id="7682465">.</span><span class="op" id="7682466">(</span><span class="op" id="7682467">*</span><span class="ident" id="7682468">UnixConn</span><span class="op" id="7682476">)</span><span class="op" id="7682477">.</span><span class="ident" id="7682478">WriteTo</span><span class="op" id="7682485">(</span><span class="op" id="7682486">[</span><span class="op" id="7682487">]</span><span class="builtintype" id="7682488">byte</span><span class="op" id="7682492">(</span><span class="string" id="7682493">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7682526">)</span><span class="op" id="7682527">,</span>&nbsp;<span class="ident" id="7682529">raddr</span><span class="op" id="7682534">)</span><span class="op" id="7682535">;</span>&nbsp;<span class="ident" id="7682537">err</span>&nbsp;<span class="op" id="7682541">==</span>&nbsp;<span class="ident" id="7682544">nil</span>&nbsp;<span class="op" id="7682548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682552">t</span><span class="op" id="7682553">.</span><span class="ident" id="7682554">Fatal</span><span class="op" id="7682559">(</span><span class="string" id="7682560">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7682581">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682584">}</span>&nbsp;<span class="keyword" id="7682586">else</span>&nbsp;<span class="keyword" id="7682591">if</span>&nbsp;<span class="ident" id="7682594">err</span><span class="op" id="7682597">.</span><span class="op" id="7682598">(</span><span class="op" id="7682599">*</span><span class="ident" id="7682600">OpError</span><span class="op" id="7682607">)</span><span class="op" id="7682608">.</span><span class="ident" id="7682609">Err</span>&nbsp;<span class="op" id="7682613">!=</span>&nbsp;<span class="ident" id="7682616">ErrWriteToConnected</span>&nbsp;<span class="op" id="7682636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682640">t</span><span class="op" id="7682641">.</span><span class="ident" id="7682642">Fatalf</span><span class="op" id="7682648">(</span><span class="string" id="7682649">&#34;WriteTo&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="7682697">,</span>&nbsp;<span class="ident" id="7682699">err</span><span class="op" id="7682702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682708">if</span>&nbsp;<span class="ident" id="7682711">_</span><span class="op" id="7682712">,</span>&nbsp;<span class="ident" id="7682714">_</span><span class="op" id="7682715">,</span>&nbsp;<span class="ident" id="7682717">err</span>&nbsp;<span class="op" id="7682721">=</span>&nbsp;<span class="ident" id="7682723">c</span><span class="op" id="7682724">.</span><span class="op" id="7682725">(</span><span class="op" id="7682726">*</span><span class="ident" id="7682727">UnixConn</span><span class="op" id="7682735">)</span><span class="op" id="7682736">.</span><span class="ident" id="7682737">WriteMsgUnix</span><span class="op" id="7682749">(</span><span class="op" id="7682750">[</span><span class="op" id="7682751">]</span><span class="builtintype" id="7682752">byte</span><span class="op" id="7682756">(</span><span class="string" id="7682757">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7682790">)</span><span class="op" id="7682791">,</span>&nbsp;<span class="ident" id="7682793">nil</span><span class="op" id="7682796">,</span>&nbsp;<span class="ident" id="7682798">raddr</span><span class="op" id="7682803">)</span><span class="op" id="7682804">;</span>&nbsp;<span class="ident" id="7682806">err</span>&nbsp;<span class="op" id="7682810">==</span>&nbsp;<span class="ident" id="7682813">nil</span>&nbsp;<span class="op" id="7682817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682821">t</span><span class="op" id="7682822">.</span><span class="ident" id="7682823">Fatal</span><span class="op" id="7682828">(</span><span class="string" id="7682829">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7682850">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682853">}</span>&nbsp;<span class="keyword" id="7682855">else</span>&nbsp;<span class="keyword" id="7682860">if</span>&nbsp;<span class="ident" id="7682863">err</span><span class="op" id="7682866">.</span><span class="op" id="7682867">(</span><span class="op" id="7682868">*</span><span class="ident" id="7682869">OpError</span><span class="op" id="7682876">)</span><span class="op" id="7682877">.</span><span class="ident" id="7682878">Err</span>&nbsp;<span class="op" id="7682882">!=</span>&nbsp;<span class="ident" id="7682885">ErrWriteToConnected</span>&nbsp;<span class="op" id="7682905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682909">t</span><span class="op" id="7682910">.</span><span class="ident" id="7682911">Fatalf</span><span class="op" id="7682917">(</span><span class="string" id="7682918">&#34;WriteMsgUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="7682971">,</span>&nbsp;<span class="ident" id="7682973">err</span><span class="op" id="7682976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682982">if</span>&nbsp;<span class="ident" id="7682985">_</span><span class="op" id="7682986">,</span>&nbsp;<span class="ident" id="7682988">err</span>&nbsp;<span class="op" id="7682992">:=</span>&nbsp;<span class="ident" id="7682995">c</span><span class="op" id="7682996">.</span><span class="ident" id="7682997">Write</span><span class="op" id="7683002">(</span><span class="op" id="7683003">[</span><span class="op" id="7683004">]</span><span class="builtintype" id="7683005">byte</span><span class="op" id="7683009">(</span><span class="string" id="7683010">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7683043">)</span><span class="op" id="7683044">)</span><span class="op" id="7683045">;</span>&nbsp;<span class="ident" id="7683047">err</span>&nbsp;<span class="op" id="7683051">!=</span>&nbsp;<span class="ident" id="7683054">nil</span>&nbsp;<span class="op" id="7683058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683062">t</span><span class="op" id="7683063">.</span><span class="ident" id="7683064">Fatalf</span><span class="op" id="7683070">(</span><span class="string" id="7683071">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7683089">,</span>&nbsp;<span class="ident" id="7683091">err</span><span class="op" id="7683094">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683097">}</span><br>
<span class="lineno"></span><span class="op" id="7683099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7683102">func</span>&nbsp;<span class="ident" id="7683107">testUnixgramWritePacketConn</span><span class="op" id="7683134">(</span><span class="ident" id="7683135">t</span>&nbsp;<span class="op" id="7683137">*</span><span class="ident" id="7683138">testing</span><span class="op" id="7683145">.</span><span class="ident" id="7683146">T</span><span class="op" id="7683147">,</span>&nbsp;<span class="ident" id="7683149">raddr</span>&nbsp;<span class="op" id="7683155">*</span><span class="ident" id="7683156">UnixAddr</span><span class="op" id="7683164">)</span>&nbsp;<span class="op" id="7683166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683169">addr</span>&nbsp;<span class="op" id="7683174">:=</span>&nbsp;<span class="ident" id="7683177">testUnixAddr</span><span class="op" id="7683189">(</span><span class="op" id="7683190">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683193">c</span><span class="op" id="7683194">,</span>&nbsp;<span class="ident" id="7683196">err</span>&nbsp;<span class="op" id="7683200">:=</span>&nbsp;<span class="ident" id="7683203">ListenPacket</span><span class="op" id="7683215">(</span><span class="string" id="7683216">&#34;unixgram&#34;</span><span class="op" id="7683226">,</span>&nbsp;<span class="ident" id="7683228">addr</span><span class="op" id="7683232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683235">if</span>&nbsp;<span class="ident" id="7683238">err</span>&nbsp;<span class="op" id="7683242">!=</span>&nbsp;<span class="ident" id="7683245">nil</span>&nbsp;<span class="op" id="7683249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683253">t</span><span class="op" id="7683254">.</span><span class="ident" id="7683255">Fatalf</span><span class="op" id="7683261">(</span><span class="string" id="7683262">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7683287">,</span>&nbsp;<span class="ident" id="7683289">err</span><span class="op" id="7683292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683298">defer</span>&nbsp;<span class="ident" id="7683304">os</span><span class="op" id="7683306">.</span><span class="ident" id="7683307">Remove</span><span class="op" id="7683313">(</span><span class="ident" id="7683314">addr</span><span class="op" id="7683318">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683321">defer</span>&nbsp;<span class="ident" id="7683327">c</span><span class="op" id="7683328">.</span><span class="ident" id="7683329">Close</span><span class="op" id="7683334">(</span><span class="op" id="7683335">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683339">if</span>&nbsp;<span class="ident" id="7683342">_</span><span class="op" id="7683343">,</span>&nbsp;<span class="ident" id="7683345">err</span>&nbsp;<span class="op" id="7683349">:=</span>&nbsp;<span class="ident" id="7683352">c</span><span class="op" id="7683353">.</span><span class="op" id="7683354">(</span><span class="op" id="7683355">*</span><span class="ident" id="7683356">UnixConn</span><span class="op" id="7683364">)</span><span class="op" id="7683365">.</span><span class="ident" id="7683366">WriteToUnix</span><span class="op" id="7683377">(</span><span class="op" id="7683378">[</span><span class="op" id="7683379">]</span><span class="builtintype" id="7683380">byte</span><span class="op" id="7683384">(</span><span class="string" id="7683385">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7683413">)</span><span class="op" id="7683414">,</span>&nbsp;<span class="ident" id="7683416">raddr</span><span class="op" id="7683421">)</span><span class="op" id="7683422">;</span>&nbsp;<span class="ident" id="7683424">err</span>&nbsp;<span class="op" id="7683428">!=</span>&nbsp;<span class="ident" id="7683431">nil</span>&nbsp;<span class="op" id="7683435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683439">t</span><span class="op" id="7683440">.</span><span class="ident" id="7683441">Fatalf</span><span class="op" id="7683447">(</span><span class="string" id="7683448">&#34;WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7683472">,</span>&nbsp;<span class="ident" id="7683474">err</span><span class="op" id="7683477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683480">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683483">if</span>&nbsp;<span class="ident" id="7683486">_</span><span class="op" id="7683487">,</span>&nbsp;<span class="ident" id="7683489">err</span>&nbsp;<span class="op" id="7683493">:=</span>&nbsp;<span class="ident" id="7683496">c</span><span class="op" id="7683497">.</span><span class="ident" id="7683498">WriteTo</span><span class="op" id="7683505">(</span><span class="op" id="7683506">[</span><span class="op" id="7683507">]</span><span class="builtintype" id="7683508">byte</span><span class="op" id="7683512">(</span><span class="string" id="7683513">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7683541">)</span><span class="op" id="7683542">,</span>&nbsp;<span class="ident" id="7683544">raddr</span><span class="op" id="7683549">)</span><span class="op" id="7683550">;</span>&nbsp;<span class="ident" id="7683552">err</span>&nbsp;<span class="op" id="7683556">!=</span>&nbsp;<span class="ident" id="7683559">nil</span>&nbsp;<span class="op" id="7683563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683567">t</span><span class="op" id="7683568">.</span><span class="ident" id="7683569">Fatalf</span><span class="op" id="7683575">(</span><span class="string" id="7683576">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7683596">,</span>&nbsp;<span class="ident" id="7683598">err</span><span class="op" id="7683601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683607">if</span>&nbsp;<span class="ident" id="7683610">_</span><span class="op" id="7683611">,</span>&nbsp;<span class="ident" id="7683613">_</span><span class="op" id="7683614">,</span>&nbsp;<span class="ident" id="7683616">err</span>&nbsp;<span class="op" id="7683620">:=</span>&nbsp;<span class="ident" id="7683623">c</span><span class="op" id="7683624">.</span><span class="op" id="7683625">(</span><span class="op" id="7683626">*</span><span class="ident" id="7683627">UnixConn</span><span class="op" id="7683635">)</span><span class="op" id="7683636">.</span><span class="ident" id="7683637">WriteMsgUnix</span><span class="op" id="7683649">(</span><span class="op" id="7683650">[</span><span class="op" id="7683651">]</span><span class="builtintype" id="7683652">byte</span><span class="op" id="7683656">(</span><span class="string" id="7683657">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7683685">)</span><span class="op" id="7683686">,</span>&nbsp;<span class="ident" id="7683688">nil</span><span class="op" id="7683691">,</span>&nbsp;<span class="ident" id="7683693">raddr</span><span class="op" id="7683698">)</span><span class="op" id="7683699">;</span>&nbsp;<span class="ident" id="7683701">err</span>&nbsp;<span class="op" id="7683705">!=</span>&nbsp;<span class="ident" id="7683708">nil</span>&nbsp;<span class="op" id="7683712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683716">t</span><span class="op" id="7683717">.</span><span class="ident" id="7683718">Fatalf</span><span class="op" id="7683724">(</span><span class="string" id="7683725">&#34;WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7683750">,</span>&nbsp;<span class="ident" id="7683752">err</span><span class="op" id="7683755">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683761">if</span>&nbsp;<span class="ident" id="7683764">_</span><span class="op" id="7683765">,</span>&nbsp;<span class="ident" id="7683767">err</span>&nbsp;<span class="op" id="7683771">:=</span>&nbsp;<span class="ident" id="7683774">c</span><span class="op" id="7683775">.</span><span class="op" id="7683776">(</span><span class="op" id="7683777">*</span><span class="ident" id="7683778">UnixConn</span><span class="op" id="7683786">)</span><span class="op" id="7683787">.</span><span class="ident" id="7683788">Write</span><span class="op" id="7683793">(</span><span class="op" id="7683794">[</span><span class="op" id="7683795">]</span><span class="builtintype" id="7683796">byte</span><span class="op" id="7683800">(</span><span class="string" id="7683801">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7683829">)</span><span class="op" id="7683830">)</span><span class="op" id="7683831">;</span>&nbsp;<span class="ident" id="7683833">err</span>&nbsp;<span class="op" id="7683837">==</span>&nbsp;<span class="ident" id="7683840">nil</span>&nbsp;<span class="op" id="7683844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683848">t</span><span class="op" id="7683849">.</span><span class="ident" id="7683850">Fatal</span><span class="op" id="7683855">(</span><span class="string" id="7683856">&#34;Write&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7683875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683878">}</span><br>
<span class="lineno"></span><span class="op" id="7683880">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="7683883">func</span>&nbsp;<span class="ident" id="7683888">TestUnixConnLocalAndRemoteNames</span><span class="op" id="7683919">(</span><span class="ident" id="7683920">t</span>&nbsp;<span class="op" id="7683922">*</span><span class="ident" id="7683923">testing</span><span class="op" id="7683930">.</span><span class="ident" id="7683931">T</span><span class="op" id="7683932">)</span>&nbsp;<span class="op" id="7683934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683937">for</span>&nbsp;<span class="ident" id="7683941">_</span><span class="op" id="7683942">,</span>&nbsp;<span class="ident" id="7683944">laddr</span>&nbsp;<span class="op" id="7683950">:=</span>&nbsp;<span class="keyword" id="7683953">range</span>&nbsp;<span class="op" id="7683959">[</span><span class="op" id="7683960">]</span><span class="builtintype" id="7683961">string</span><span class="op" id="7683967">{</span><span class="string" id="7683968">&#34;&#34;</span><span class="op" id="7683970">,</span>&nbsp;<span class="ident" id="7683972">testUnixAddr</span><span class="op" id="7683984">(</span><span class="op" id="7683985">)</span><span class="op" id="7683986">}</span>&nbsp;<span class="op" id="7683988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683992">laddr</span>&nbsp;<span class="op" id="7683998">:=</span>&nbsp;<span class="ident" id="7684001">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684009">taddr</span>&nbsp;<span class="op" id="7684015">:=</span>&nbsp;<span class="ident" id="7684018">testUnixAddr</span><span class="op" id="7684030">(</span><span class="op" id="7684031">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684035">ta</span><span class="op" id="7684037">,</span>&nbsp;<span class="ident" id="7684039">err</span>&nbsp;<span class="op" id="7684043">:=</span>&nbsp;<span class="ident" id="7684046">ResolveUnixAddr</span><span class="op" id="7684061">(</span><span class="string" id="7684062">&#34;unix&#34;</span><span class="op" id="7684068">,</span>&nbsp;<span class="ident" id="7684070">taddr</span><span class="op" id="7684075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684079">if</span>&nbsp;<span class="ident" id="7684082">err</span>&nbsp;<span class="op" id="7684086">!=</span>&nbsp;<span class="ident" id="7684089">nil</span>&nbsp;<span class="op" id="7684093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684098">t</span><span class="op" id="7684099">.</span><span class="ident" id="7684100">Fatalf</span><span class="op" id="7684106">(</span><span class="string" id="7684107">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7684135">,</span>&nbsp;<span class="ident" id="7684137">err</span><span class="op" id="7684140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684148">ln</span><span class="op" id="7684150">,</span>&nbsp;<span class="ident" id="7684152">err</span>&nbsp;<span class="op" id="7684156">:=</span>&nbsp;<span class="ident" id="7684159">ListenUnix</span><span class="op" id="7684169">(</span><span class="string" id="7684170">&#34;unix&#34;</span><span class="op" id="7684176">,</span>&nbsp;<span class="ident" id="7684178">ta</span><span class="op" id="7684180">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684184">if</span>&nbsp;<span class="ident" id="7684187">err</span>&nbsp;<span class="op" id="7684191">!=</span>&nbsp;<span class="ident" id="7684194">nil</span>&nbsp;<span class="op" id="7684198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684203">t</span><span class="op" id="7684204">.</span><span class="ident" id="7684205">Fatalf</span><span class="op" id="7684211">(</span><span class="string" id="7684212">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7684235">,</span>&nbsp;<span class="ident" id="7684237">err</span><span class="op" id="7684240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684248">defer</span>&nbsp;<span class="keyword" id="7684254">func</span><span class="op" id="7684258">(</span><span class="op" id="7684259">)</span>&nbsp;<span class="op" id="7684261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684266">ln</span><span class="op" id="7684268">.</span><span class="ident" id="7684269">Close</span><span class="op" id="7684274">(</span><span class="op" id="7684275">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684280">os</span><span class="op" id="7684282">.</span><span class="ident" id="7684283">Remove</span><span class="op" id="7684289">(</span><span class="ident" id="7684290">taddr</span><span class="op" id="7684295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684299">}</span><span class="op" id="7684300">(</span><span class="op" id="7684301">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684306">done</span>&nbsp;<span class="op" id="7684311">:=</span>&nbsp;<span class="builtinfunc" id="7684314">make</span><span class="op" id="7684318">(</span><span class="keyword" id="7684319">chan</span>&nbsp;<span class="builtintype" id="7684324">int</span><span class="op" id="7684327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684331">go</span>&nbsp;<span class="ident" id="7684334">transponder</span><span class="op" id="7684345">(</span><span class="ident" id="7684346">t</span><span class="op" id="7684347">,</span>&nbsp;<span class="ident" id="7684349">ln</span><span class="op" id="7684351">,</span>&nbsp;<span class="ident" id="7684353">done</span><span class="op" id="7684357">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684362">la</span><span class="op" id="7684364">,</span>&nbsp;<span class="ident" id="7684366">err</span>&nbsp;<span class="op" id="7684370">:=</span>&nbsp;<span class="ident" id="7684373">ResolveUnixAddr</span><span class="op" id="7684388">(</span><span class="string" id="7684389">&#34;unix&#34;</span><span class="op" id="7684395">,</span>&nbsp;<span class="ident" id="7684397">laddr</span><span class="op" id="7684402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684406">if</span>&nbsp;<span class="ident" id="7684409">err</span>&nbsp;<span class="op" id="7684413">!=</span>&nbsp;<span class="ident" id="7684416">nil</span>&nbsp;<span class="op" id="7684420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684425">t</span><span class="op" id="7684426">.</span><span class="ident" id="7684427">Fatalf</span><span class="op" id="7684433">(</span><span class="string" id="7684434">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7684462">,</span>&nbsp;<span class="ident" id="7684464">err</span><span class="op" id="7684467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684471">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684475">c</span><span class="op" id="7684476">,</span>&nbsp;<span class="ident" id="7684478">err</span>&nbsp;<span class="op" id="7684482">:=</span>&nbsp;<span class="ident" id="7684485">DialUnix</span><span class="op" id="7684493">(</span><span class="string" id="7684494">&#34;unix&#34;</span><span class="op" id="7684500">,</span>&nbsp;<span class="ident" id="7684502">la</span><span class="op" id="7684504">,</span>&nbsp;<span class="ident" id="7684506">ta</span><span class="op" id="7684508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684512">if</span>&nbsp;<span class="ident" id="7684515">err</span>&nbsp;<span class="op" id="7684519">!=</span>&nbsp;<span class="ident" id="7684522">nil</span>&nbsp;<span class="op" id="7684526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684531">t</span><span class="op" id="7684532">.</span><span class="ident" id="7684533">Fatalf</span><span class="op" id="7684539">(</span><span class="string" id="7684540">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7684561">,</span>&nbsp;<span class="ident" id="7684563">err</span><span class="op" id="7684566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684574">defer</span>&nbsp;<span class="keyword" id="7684580">func</span><span class="op" id="7684584">(</span><span class="op" id="7684585">)</span>&nbsp;<span class="op" id="7684587">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684592">c</span><span class="op" id="7684593">.</span><span class="ident" id="7684594">Close</span><span class="op" id="7684599">(</span><span class="op" id="7684600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684605">if</span>&nbsp;<span class="ident" id="7684608">la</span>&nbsp;<span class="op" id="7684611">!=</span>&nbsp;<span class="ident" id="7684614">nil</span>&nbsp;<span class="op" id="7684618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684624">defer</span>&nbsp;<span class="ident" id="7684630">os</span><span class="op" id="7684632">.</span><span class="ident" id="7684633">Remove</span><span class="op" id="7684639">(</span><span class="ident" id="7684640">laddr</span><span class="op" id="7684645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684654">}</span><span class="op" id="7684655">(</span><span class="op" id="7684656">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684660">if</span>&nbsp;<span class="ident" id="7684663">_</span><span class="op" id="7684664">,</span>&nbsp;<span class="ident" id="7684666">err</span>&nbsp;<span class="op" id="7684670">:=</span>&nbsp;<span class="ident" id="7684673">c</span><span class="op" id="7684674">.</span><span class="ident" id="7684675">Write</span><span class="op" id="7684680">(</span><span class="op" id="7684681">[</span><span class="op" id="7684682">]</span><span class="builtintype" id="7684683">byte</span><span class="op" id="7684687">(</span><span class="string" id="7684688">&#34;UNIXCONN&nbsp;LOCAL&nbsp;AND&nbsp;REMOTE&nbsp;NAME&nbsp;TEST&#34;</span><span class="op" id="7684725">)</span><span class="op" id="7684726">)</span><span class="op" id="7684727">;</span>&nbsp;<span class="ident" id="7684729">err</span>&nbsp;<span class="op" id="7684733">!=</span>&nbsp;<span class="ident" id="7684736">nil</span>&nbsp;<span class="op" id="7684740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684745">t</span><span class="op" id="7684746">.</span><span class="ident" id="7684747">Fatalf</span><span class="op" id="7684753">(</span><span class="string" id="7684754">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7684781">,</span>&nbsp;<span class="ident" id="7684783">err</span><span class="op" id="7684786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684795">switch</span>&nbsp;<span class="ident" id="7684802">runtime</span><span class="op" id="7684809">.</span><span class="ident" id="7684810">GOOS</span>&nbsp;<span class="op" id="7684815">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684819">case</span>&nbsp;<span class="string" id="7684824">&#34;android&#34;</span><span class="op" id="7684833">,</span>&nbsp;<span class="string" id="7684835">&#34;linux&#34;</span><span class="op" id="7684842">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684847">if</span>&nbsp;<span class="ident" id="7684850">laddr</span>&nbsp;<span class="op" id="7684856">==</span>&nbsp;<span class="string" id="7684859">&#34;&#34;</span>&nbsp;<span class="op" id="7684862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684868">laddr</span>&nbsp;<span class="op" id="7684874">=</span>&nbsp;<span class="string" id="7684876">&#34;@&#34;</span>&nbsp;<span class="comment" id="7684880">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684907">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684911">var</span>&nbsp;<span class="ident" id="7684915">connAddrs</span>&nbsp;<span class="op" id="7684925">=</span>&nbsp;<span class="op" id="7684927">[</span><span class="num" id="7684928">3</span><span class="op" id="7684929">]</span><span class="keyword" id="7684930">struct</span><span class="op" id="7684936">{</span>&nbsp;<span class="ident" id="7684938">got</span><span class="op" id="7684941">,</span>&nbsp;<span class="ident" id="7684943">want</span>&nbsp;<span class="ident" id="7684948">Addr</span>&nbsp;<span class="op" id="7684953">}</span><span class="op" id="7684954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684959">{</span><span class="ident" id="7684960">ln</span><span class="op" id="7684962">.</span><span class="ident" id="7684963">Addr</span><span class="op" id="7684967">(</span><span class="op" id="7684968">)</span><span class="op" id="7684969">,</span>&nbsp;<span class="ident" id="7684971">ta</span><span class="op" id="7684973">}</span><span class="op" id="7684974">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684979">{</span><span class="ident" id="7684980">c</span><span class="op" id="7684981">.</span><span class="ident" id="7684982">LocalAddr</span><span class="op" id="7684991">(</span><span class="op" id="7684992">)</span><span class="op" id="7684993">,</span>&nbsp;<span class="op" id="7684995">&amp;</span><span class="ident" id="7684996">UnixAddr</span><span class="op" id="7685004">{</span><span class="ident" id="7685005">Name</span><span class="op" id="7685009">:</span>&nbsp;<span class="ident" id="7685011">laddr</span><span class="op" id="7685016">,</span>&nbsp;<span class="ident" id="7685018">Net</span><span class="op" id="7685021">:</span>&nbsp;<span class="string" id="7685023">&#34;unix&#34;</span><span class="op" id="7685029">}</span><span class="op" id="7685030">}</span><span class="op" id="7685031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685036">{</span><span class="ident" id="7685037">c</span><span class="op" id="7685038">.</span><span class="ident" id="7685039">RemoteAddr</span><span class="op" id="7685049">(</span><span class="op" id="7685050">)</span><span class="op" id="7685051">,</span>&nbsp;<span class="ident" id="7685053">ta</span><span class="op" id="7685055">}</span><span class="op" id="7685056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685060">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685064">for</span>&nbsp;<span class="ident" id="7685068">_</span><span class="op" id="7685069">,</span>&nbsp;<span class="ident" id="7685071">ca</span>&nbsp;<span class="op" id="7685074">:=</span>&nbsp;<span class="keyword" id="7685077">range</span>&nbsp;<span class="ident" id="7685083">connAddrs</span>&nbsp;<span class="op" id="7685093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685098">if</span>&nbsp;<span class="op" id="7685101">!</span><span class="ident" id="7685102">reflect</span><span class="op" id="7685109">.</span><span class="ident" id="7685110">DeepEqual</span><span class="op" id="7685119">(</span><span class="ident" id="7685120">ca</span><span class="op" id="7685122">.</span><span class="ident" id="7685123">got</span><span class="op" id="7685126">,</span>&nbsp;<span class="ident" id="7685128">ca</span><span class="op" id="7685130">.</span><span class="ident" id="7685131">want</span><span class="op" id="7685135">)</span>&nbsp;<span class="op" id="7685137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685143">t</span><span class="op" id="7685144">.</span><span class="ident" id="7685145">Fatalf</span><span class="op" id="7685151">(</span><span class="string" id="7685152">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="7685175">,</span>&nbsp;<span class="ident" id="7685177">ca</span><span class="op" id="7685179">.</span><span class="ident" id="7685180">got</span><span class="op" id="7685183">,</span>&nbsp;<span class="ident" id="7685185">ca</span><span class="op" id="7685187">.</span><span class="ident" id="7685188">want</span><span class="op" id="7685192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685201">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685206">&lt;-</span><span class="ident" id="7685208">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685214">}</span><br>
<span class="lineno"></span><span class="op" id="7685216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="7685219">func</span>&nbsp;<span class="ident" id="7685224">TestUnixgramConnLocalAndRemoteNames</span><span class="op" id="7685259">(</span><span class="ident" id="7685260">t</span>&nbsp;<span class="op" id="7685262">*</span><span class="ident" id="7685263">testing</span><span class="op" id="7685270">.</span><span class="ident" id="7685271">T</span><span class="op" id="7685272">)</span>&nbsp;<span class="op" id="7685274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685277">for</span>&nbsp;<span class="ident" id="7685281">_</span><span class="op" id="7685282">,</span>&nbsp;<span class="ident" id="7685284">laddr</span>&nbsp;<span class="op" id="7685290">:=</span>&nbsp;<span class="keyword" id="7685293">range</span>&nbsp;<span class="op" id="7685299">[</span><span class="op" id="7685300">]</span><span class="builtintype" id="7685301">string</span><span class="op" id="7685307">{</span><span class="string" id="7685308">&#34;&#34;</span><span class="op" id="7685310">,</span>&nbsp;<span class="ident" id="7685312">testUnixAddr</span><span class="op" id="7685324">(</span><span class="op" id="7685325">)</span><span class="op" id="7685326">}</span>&nbsp;<span class="op" id="7685328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685332">laddr</span>&nbsp;<span class="op" id="7685338">:=</span>&nbsp;<span class="ident" id="7685341">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685349">taddr</span>&nbsp;<span class="op" id="7685355">:=</span>&nbsp;<span class="ident" id="7685358">testUnixAddr</span><span class="op" id="7685370">(</span><span class="op" id="7685371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685375">ta</span><span class="op" id="7685377">,</span>&nbsp;<span class="ident" id="7685379">err</span>&nbsp;<span class="op" id="7685383">:=</span>&nbsp;<span class="ident" id="7685386">ResolveUnixAddr</span><span class="op" id="7685401">(</span><span class="string" id="7685402">&#34;unixgram&#34;</span><span class="op" id="7685412">,</span>&nbsp;<span class="ident" id="7685414">taddr</span><span class="op" id="7685419">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685423">if</span>&nbsp;<span class="ident" id="7685426">err</span>&nbsp;<span class="op" id="7685430">!=</span>&nbsp;<span class="ident" id="7685433">nil</span>&nbsp;<span class="op" id="7685437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685442">t</span><span class="op" id="7685443">.</span><span class="ident" id="7685444">Fatalf</span><span class="op" id="7685450">(</span><span class="string" id="7685451">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7685479">,</span>&nbsp;<span class="ident" id="7685481">err</span><span class="op" id="7685484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685492">c1</span><span class="op" id="7685494">,</span>&nbsp;<span class="ident" id="7685496">err</span>&nbsp;<span class="op" id="7685500">:=</span>&nbsp;<span class="ident" id="7685503">ListenUnixgram</span><span class="op" id="7685517">(</span><span class="string" id="7685518">&#34;unixgram&#34;</span><span class="op" id="7685528">,</span>&nbsp;<span class="ident" id="7685530">ta</span><span class="op" id="7685532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685536">if</span>&nbsp;<span class="ident" id="7685539">err</span>&nbsp;<span class="op" id="7685543">!=</span>&nbsp;<span class="ident" id="7685546">nil</span>&nbsp;<span class="op" id="7685550">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685555">t</span><span class="op" id="7685556">.</span><span class="ident" id="7685557">Fatalf</span><span class="op" id="7685563">(</span><span class="string" id="7685564">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7685591">,</span>&nbsp;<span class="ident" id="7685593">err</span><span class="op" id="7685596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685604">defer</span>&nbsp;<span class="keyword" id="7685610">func</span><span class="op" id="7685614">(</span><span class="op" id="7685615">)</span>&nbsp;<span class="op" id="7685617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685622">c1</span><span class="op" id="7685624">.</span><span class="ident" id="7685625">Close</span><span class="op" id="7685630">(</span><span class="op" id="7685631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685636">os</span><span class="op" id="7685638">.</span><span class="ident" id="7685639">Remove</span><span class="op" id="7685645">(</span><span class="ident" id="7685646">taddr</span><span class="op" id="7685651">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685655">}</span><span class="op" id="7685656">(</span><span class="op" id="7685657">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685662">var</span>&nbsp;<span class="ident" id="7685666">la</span>&nbsp;<span class="op" id="7685669">*</span><span class="ident" id="7685670">UnixAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685681">if</span>&nbsp;<span class="ident" id="7685684">laddr</span>&nbsp;<span class="op" id="7685690">!=</span>&nbsp;<span class="string" id="7685693">&#34;&#34;</span>&nbsp;<span class="op" id="7685696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685701">if</span>&nbsp;<span class="ident" id="7685704">la</span><span class="op" id="7685706">,</span>&nbsp;<span class="ident" id="7685708">err</span>&nbsp;<span class="op" id="7685712">=</span>&nbsp;<span class="ident" id="7685714">ResolveUnixAddr</span><span class="op" id="7685729">(</span><span class="string" id="7685730">&#34;unixgram&#34;</span><span class="op" id="7685740">,</span>&nbsp;<span class="ident" id="7685742">laddr</span><span class="op" id="7685747">)</span><span class="op" id="7685748">;</span>&nbsp;<span class="ident" id="7685750">err</span>&nbsp;<span class="op" id="7685754">!=</span>&nbsp;<span class="ident" id="7685757">nil</span>&nbsp;<span class="op" id="7685761">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685767">t</span><span class="op" id="7685768">.</span><span class="ident" id="7685769">Fatalf</span><span class="op" id="7685775">(</span><span class="string" id="7685776">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7685804">,</span>&nbsp;<span class="ident" id="7685806">err</span><span class="op" id="7685809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685822">c2</span><span class="op" id="7685824">,</span>&nbsp;<span class="ident" id="7685826">err</span>&nbsp;<span class="op" id="7685830">:=</span>&nbsp;<span class="ident" id="7685833">DialUnix</span><span class="op" id="7685841">(</span><span class="string" id="7685842">&#34;unixgram&#34;</span><span class="op" id="7685852">,</span>&nbsp;<span class="ident" id="7685854">la</span><span class="op" id="7685856">,</span>&nbsp;<span class="ident" id="7685858">ta</span><span class="op" id="7685860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685864">if</span>&nbsp;<span class="ident" id="7685867">err</span>&nbsp;<span class="op" id="7685871">!=</span>&nbsp;<span class="ident" id="7685874">nil</span>&nbsp;<span class="op" id="7685878">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685883">t</span><span class="op" id="7685884">.</span><span class="ident" id="7685885">Fatalf</span><span class="op" id="7685891">(</span><span class="string" id="7685892">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7685913">,</span>&nbsp;<span class="ident" id="7685915">err</span><span class="op" id="7685918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685926">defer</span>&nbsp;<span class="keyword" id="7685932">func</span><span class="op" id="7685936">(</span><span class="op" id="7685937">)</span>&nbsp;<span class="op" id="7685939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685944">c2</span><span class="op" id="7685946">.</span><span class="ident" id="7685947">Close</span><span class="op" id="7685952">(</span><span class="op" id="7685953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685958">if</span>&nbsp;<span class="ident" id="7685961">la</span>&nbsp;<span class="op" id="7685964">!=</span>&nbsp;<span class="ident" id="7685967">nil</span>&nbsp;<span class="op" id="7685971">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685977">defer</span>&nbsp;<span class="ident" id="7685983">os</span><span class="op" id="7685985">.</span><span class="ident" id="7685986">Remove</span><span class="op" id="7685992">(</span><span class="ident" id="7685993">laddr</span><span class="op" id="7685998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686007">}</span><span class="op" id="7686008">(</span><span class="op" id="7686009">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686014">switch</span>&nbsp;<span class="ident" id="7686021">runtime</span><span class="op" id="7686028">.</span><span class="ident" id="7686029">GOOS</span>&nbsp;<span class="op" id="7686034">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686038">case</span>&nbsp;<span class="string" id="7686043">&#34;android&#34;</span><span class="op" id="7686052">,</span>&nbsp;<span class="string" id="7686054">&#34;linux&#34;</span><span class="op" id="7686061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686066">if</span>&nbsp;<span class="ident" id="7686069">laddr</span>&nbsp;<span class="op" id="7686075">==</span>&nbsp;<span class="string" id="7686078">&#34;&#34;</span>&nbsp;<span class="op" id="7686081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686087">laddr</span>&nbsp;<span class="op" id="7686093">=</span>&nbsp;<span class="string" id="7686095">&#34;@&#34;</span>&nbsp;<span class="comment" id="7686099">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686126">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686131">var</span>&nbsp;<span class="ident" id="7686135">connAddrs</span>&nbsp;<span class="op" id="7686145">=</span>&nbsp;<span class="op" id="7686147">[</span><span class="num" id="7686148">4</span><span class="op" id="7686149">]</span><span class="keyword" id="7686150">struct</span><span class="op" id="7686156">{</span>&nbsp;<span class="ident" id="7686158">got</span><span class="op" id="7686161">,</span>&nbsp;<span class="ident" id="7686163">want</span>&nbsp;<span class="ident" id="7686168">Addr</span>&nbsp;<span class="op" id="7686173">}</span><span class="op" id="7686174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686179">{</span><span class="ident" id="7686180">c1</span><span class="op" id="7686182">.</span><span class="ident" id="7686183">LocalAddr</span><span class="op" id="7686192">(</span><span class="op" id="7686193">)</span><span class="op" id="7686194">,</span>&nbsp;<span class="ident" id="7686196">ta</span><span class="op" id="7686198">}</span><span class="op" id="7686199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686204">{</span><span class="ident" id="7686205">c1</span><span class="op" id="7686207">.</span><span class="ident" id="7686208">RemoteAddr</span><span class="op" id="7686218">(</span><span class="op" id="7686219">)</span><span class="op" id="7686220">,</span>&nbsp;<span class="ident" id="7686222">nil</span><span class="op" id="7686225">}</span><span class="op" id="7686226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686231">{</span><span class="ident" id="7686232">c2</span><span class="op" id="7686234">.</span><span class="ident" id="7686235">LocalAddr</span><span class="op" id="7686244">(</span><span class="op" id="7686245">)</span><span class="op" id="7686246">,</span>&nbsp;<span class="op" id="7686248">&amp;</span><span class="ident" id="7686249">UnixAddr</span><span class="op" id="7686257">{</span><span class="ident" id="7686258">Name</span><span class="op" id="7686262">:</span>&nbsp;<span class="ident" id="7686264">laddr</span><span class="op" id="7686269">,</span>&nbsp;<span class="ident" id="7686271">Net</span><span class="op" id="7686274">:</span>&nbsp;<span class="string" id="7686276">&#34;unixgram&#34;</span><span class="op" id="7686286">}</span><span class="op" id="7686287">}</span><span class="op" id="7686288">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686293">{</span><span class="ident" id="7686294">c2</span><span class="op" id="7686296">.</span><span class="ident" id="7686297">RemoteAddr</span><span class="op" id="7686307">(</span><span class="op" id="7686308">)</span><span class="op" id="7686309">,</span>&nbsp;<span class="ident" id="7686311">ta</span><span class="op" id="7686313">}</span><span class="op" id="7686314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686322">for</span>&nbsp;<span class="ident" id="7686326">_</span><span class="op" id="7686327">,</span>&nbsp;<span class="ident" id="7686329">ca</span>&nbsp;<span class="op" id="7686332">:=</span>&nbsp;<span class="keyword" id="7686335">range</span>&nbsp;<span class="ident" id="7686341">connAddrs</span>&nbsp;<span class="op" id="7686351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686356">if</span>&nbsp;<span class="op" id="7686359">!</span><span class="ident" id="7686360">reflect</span><span class="op" id="7686367">.</span><span class="ident" id="7686368">DeepEqual</span><span class="op" id="7686377">(</span><span class="ident" id="7686378">ca</span><span class="op" id="7686380">.</span><span class="ident" id="7686381">got</span><span class="op" id="7686384">,</span>&nbsp;<span class="ident" id="7686386">ca</span><span class="op" id="7686388">.</span><span class="ident" id="7686389">want</span><span class="op" id="7686393">)</span>&nbsp;<span class="op" id="7686395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686401">t</span><span class="op" id="7686402">.</span><span class="ident" id="7686403">Fatalf</span><span class="op" id="7686409">(</span><span class="string" id="7686410">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="7686433">,</span>&nbsp;<span class="ident" id="7686435">ca</span><span class="op" id="7686437">.</span><span class="ident" id="7686438">got</span><span class="op" id="7686441">,</span>&nbsp;<span class="ident" id="7686443">ca</span><span class="op" id="7686445">.</span><span class="ident" id="7686446">want</span><span class="op" id="7686450">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686462">}</span><br>
<span class="lineno"></span><span class="op" id="7686464">}</span>
</div>
</body>
</html>
