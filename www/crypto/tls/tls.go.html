<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4248878">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4248933">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4248987">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4249038">//&nbsp;Package&nbsp;tls&nbsp;partially&nbsp;implements&nbsp;TLS&nbsp;1.2,&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;5246.</span><br>
<span class="lineno"></span><span class="keyword" id="4249109">package</span>&nbsp;<span class="ident" id="4249117">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4249122">import</span>&nbsp;<span class="op" id="4249129">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4249132">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4249142">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4249158">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4249172">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4249187">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4249203">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4249213">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4249226">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4249233">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4249244">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4249251">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4249254">//&nbsp;Server&nbsp;returns&nbsp;a&nbsp;new&nbsp;TLS&nbsp;server&nbsp;side&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="4249305">//&nbsp;using&nbsp;conn&nbsp;as&nbsp;the&nbsp;underlying&nbsp;transport.</span><br>
<span class="lineno"></span><span class="comment" id="4249348">//&nbsp;The&nbsp;configuration&nbsp;config&nbsp;must&nbsp;be&nbsp;non-nil&nbsp;and&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4249406">//&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno">25</span><span class="keyword" id="4249435">func</span>&nbsp;<span class="ident" id="4249440">Server</span><span class="op" id="4249446">(</span><span class="ident" id="4249447">conn</span>&nbsp;<span class="ident" id="4249452"><a href="/crypto/tls/tls.go.html#4249226">net</a></span><span class="op" id="4249455">.</span><span class="ident" id="4249456">Conn</span><span class="op" id="4249460">,</span>&nbsp;<span class="ident" id="4249462">config</span>&nbsp;<span class="op" id="4249469">*</span><span class="ident" id="4249470"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="4249476">)</span>&nbsp;<span class="op" id="4249478">*</span><span class="ident" id="4249479"><a href="/crypto/tls/conn.go.html#4127599">Conn</a></span>&nbsp;<span class="op" id="4249484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4249487">return</span>&nbsp;<span class="op" id="4249494">&amp;</span><span class="ident" id="4249495"><a href="/crypto/tls/conn.go.html#4127599">Conn</a></span><span class="op" id="4249499">{</span><span class="ident" id="4249500">conn</span><span class="op" id="4249504">:</span>&nbsp;<span class="ident" id="4249506"><a href="/crypto/tls/tls.go.html#4249447">conn</a></span><span class="op" id="4249510">,</span>&nbsp;<span class="ident" id="4249512">config</span><span class="op" id="4249518">:</span>&nbsp;<span class="ident" id="4249520"><a href="/crypto/tls/tls.go.html#4249462">config</a></span><span class="op" id="4249526">}</span><br>
<span class="lineno"></span><span class="op" id="4249528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4249531">//&nbsp;Client&nbsp;returns&nbsp;a&nbsp;new&nbsp;TLS&nbsp;client&nbsp;side&nbsp;connection</span><br>
<span class="lineno">30</span><span class="comment" id="4249582">//&nbsp;using&nbsp;conn&nbsp;as&nbsp;the&nbsp;underlying&nbsp;transport.</span><br>
<span class="lineno"></span><span class="comment" id="4249625">//&nbsp;The&nbsp;config&nbsp;cannot&nbsp;be&nbsp;nil:&nbsp;users&nbsp;must&nbsp;set&nbsp;either&nbsp;ServerName&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4249690">//&nbsp;InsecureSkipVerify&nbsp;in&nbsp;the&nbsp;config.</span><br>
<span class="lineno"></span><span class="keyword" id="4249727">func</span>&nbsp;<span class="ident" id="4249732">Client</span><span class="op" id="4249738">(</span><span class="ident" id="4249739">conn</span>&nbsp;<span class="ident" id="4249744"><a href="/crypto/tls/tls.go.html#4249226">net</a></span><span class="op" id="4249747">.</span><span class="ident" id="4249748">Conn</span><span class="op" id="4249752">,</span>&nbsp;<span class="ident" id="4249754">config</span>&nbsp;<span class="op" id="4249761">*</span><span class="ident" id="4249762"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="4249768">)</span>&nbsp;<span class="op" id="4249770">*</span><span class="ident" id="4249771"><a href="/crypto/tls/conn.go.html#4127599">Conn</a></span>&nbsp;<span class="op" id="4249776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4249779">return</span>&nbsp;<span class="op" id="4249786">&amp;</span><span class="ident" id="4249787"><a href="/crypto/tls/conn.go.html#4127599">Conn</a></span><span class="op" id="4249791">{</span><span class="ident" id="4249792">conn</span><span class="op" id="4249796">:</span>&nbsp;<span class="ident" id="4249798"><a href="/crypto/tls/tls.go.html#4249739">conn</a></span><span class="op" id="4249802">,</span>&nbsp;<span class="ident" id="4249804">config</span><span class="op" id="4249810">:</span>&nbsp;<span class="ident" id="4249812"><a href="/crypto/tls/tls.go.html#4249754">config</a></span><span class="op" id="4249818">,</span>&nbsp;<span class="ident" id="4249820">isClient</span><span class="op" id="4249828">:</span>&nbsp;<span class="ident" id="4249830">true</span><span class="op" id="4249834">}</span><br>
<span class="lineno">35</span><span class="op" id="4249836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4249839">//&nbsp;A&nbsp;listener&nbsp;implements&nbsp;a&nbsp;network&nbsp;listener&nbsp;(net.Listener)&nbsp;for&nbsp;TLS&nbsp;connections.</span><br>
<span class="lineno"></span><span class="keyword" id="4249919">type</span>&nbsp;<span class="ident" id="4249924">listener</span>&nbsp;<span class="keyword" id="4249933">struct</span>&nbsp;<span class="op" id="4249940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4249943"><a href="/crypto/tls/tls.go.html#4249226">net</a></span><span class="op" id="4249946">.</span><span class="ident" id="4249947">Listener</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4249957">config</span>&nbsp;<span class="op" id="4249964">*</span><span class="ident" id="4249965"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><br>
<span class="lineno"></span><span class="op" id="4249972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4249975">//&nbsp;Accept&nbsp;waits&nbsp;for&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;incoming&nbsp;TLS&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4250041">//&nbsp;The&nbsp;returned&nbsp;connection&nbsp;c&nbsp;is&nbsp;a&nbsp;*tls.Conn.</span><br>
<span class="lineno">45</span><span class="keyword" id="4250086">func</span>&nbsp;<span class="op" id="4250091">(</span><span class="ident" id="4250092">l</span>&nbsp;<span class="op" id="4250094">*</span><span class="ident" id="4250095"><a href="/crypto/tls/tls.go.html#4249924">listener</a></span><span class="op" id="4250103">)</span>&nbsp;<span class="ident" id="4250105">Accept</span><span class="op" id="4250111">(</span><span class="op" id="4250112">)</span>&nbsp;<span class="op" id="4250114">(</span><span class="ident" id="4250115">c</span>&nbsp;<span class="ident" id="4250117"><a href="/crypto/tls/tls.go.html#4249226">net</a></span><span class="op" id="4250120">.</span><span class="ident" id="4250121">Conn</span><span class="op" id="4250125">,</span>&nbsp;<span class="ident" id="4250127">err</span>&nbsp;<span class="builtintype" id="4250131">error</span><span class="op" id="4250136">)</span>&nbsp;<span class="op" id="4250138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250141"><a href="/crypto/tls/tls.go.html#4250115">c</a></span><span class="op" id="4250142">,</span>&nbsp;<span class="ident" id="4250144"><a href="/crypto/tls/tls.go.html#4250127">err</a></span>&nbsp;<span class="op" id="4250148">=</span>&nbsp;<span class="ident" id="4250150"><a href="/crypto/tls/tls.go.html#4250092">l</a></span><span class="op" id="4250151">.</span><span class="ident" id="4250152">Listener</span><span class="op" id="4250160">.</span><span class="ident" id="4250161">Accept</span><span class="op" id="4250167">(</span><span class="op" id="4250168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250171">if</span>&nbsp;<span class="ident" id="4250174"><a href="/crypto/tls/tls.go.html#4250127">err</a></span>&nbsp;<span class="op" id="4250178">!=</span>&nbsp;<span class="ident" id="4250181">nil</span>&nbsp;<span class="op" id="4250185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250189">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4250197">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250200"><a href="/crypto/tls/tls.go.html#4250115">c</a></span>&nbsp;<span class="op" id="4250202">=</span>&nbsp;<span class="ident" id="4250204"><a href="/crypto/tls/tls.go.html#4249440">Server</a></span><span class="op" id="4250210">(</span><span class="ident" id="4250211"><a href="/crypto/tls/tls.go.html#4250115">c</a></span><span class="op" id="4250212">,</span>&nbsp;<span class="ident" id="4250214"><a href="/crypto/tls/tls.go.html#4250092">l</a></span><span class="op" id="4250215">.</span><span class="ident" id="4250216">config</span><span class="op" id="4250222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250225">return</span><br>
<span class="lineno"></span><span class="op" id="4250232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4250235">//&nbsp;NewListener&nbsp;creates&nbsp;a&nbsp;Listener&nbsp;which&nbsp;accepts&nbsp;connections&nbsp;from&nbsp;an&nbsp;inner</span><br>
<span class="lineno">55</span><span class="comment" id="4250309">//&nbsp;Listener&nbsp;and&nbsp;wraps&nbsp;each&nbsp;connection&nbsp;with&nbsp;Server.</span><br>
<span class="lineno"></span><span class="comment" id="4250360">//&nbsp;The&nbsp;configuration&nbsp;config&nbsp;must&nbsp;be&nbsp;non-nil&nbsp;and&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4250418">//&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="4250447">func</span>&nbsp;<span class="ident" id="4250452">NewListener</span><span class="op" id="4250463">(</span><span class="ident" id="4250464">inner</span>&nbsp;<span class="ident" id="4250470"><a href="/crypto/tls/tls.go.html#4249226">net</a></span><span class="op" id="4250473">.</span><span class="ident" id="4250474">Listener</span><span class="op" id="4250482">,</span>&nbsp;<span class="ident" id="4250484">config</span>&nbsp;<span class="op" id="4250491">*</span><span class="ident" id="4250492"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="4250498">)</span>&nbsp;<span class="ident" id="4250500"><a href="/crypto/tls/tls.go.html#4249226">net</a></span><span class="op" id="4250503">.</span><span class="ident" id="4250504">Listener</span>&nbsp;<span class="op" id="4250513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250516">l</span>&nbsp;<span class="op" id="4250518">:=</span>&nbsp;<span class="builtinfunc" id="4250521">new</span><span class="op" id="4250524">(</span><span class="ident" id="4250525"><a href="/crypto/tls/tls.go.html#4249924">listener</a></span><span class="op" id="4250533">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250536"><a href="/crypto/tls/tls.go.html#4250516">l</a></span><span class="op" id="4250537">.</span><span class="ident" id="4250538">Listener</span>&nbsp;<span class="op" id="4250547">=</span>&nbsp;<span class="ident" id="4250549"><a href="/crypto/tls/tls.go.html#4250464">inner</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250556"><a href="/crypto/tls/tls.go.html#4250516">l</a></span><span class="op" id="4250557">.</span><span class="ident" id="4250558">config</span>&nbsp;<span class="op" id="4250565">=</span>&nbsp;<span class="ident" id="4250567"><a href="/crypto/tls/tls.go.html#4250484">config</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250575">return</span>&nbsp;<span class="ident" id="4250582"><a href="/crypto/tls/tls.go.html#4250516">l</a></span><br>
<span class="lineno"></span><span class="op" id="4250584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4250587">//&nbsp;Listen&nbsp;creates&nbsp;a&nbsp;TLS&nbsp;listener&nbsp;accepting&nbsp;connections&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4250649">//&nbsp;given&nbsp;network&nbsp;address&nbsp;using&nbsp;net.Listen.</span><br>
<span class="lineno"></span><span class="comment" id="4250692">//&nbsp;The&nbsp;configuration&nbsp;config&nbsp;must&nbsp;be&nbsp;non-nil&nbsp;and&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4250750">//&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="4250779">func</span>&nbsp;<span class="ident" id="4250784">Listen</span><span class="op" id="4250790">(</span><span class="ident" id="4250791">network</span><span class="op" id="4250798">,</span>&nbsp;<span class="ident" id="4250800">laddr</span>&nbsp;<span class="builtintype" id="4250806">string</span><span class="op" id="4250812">,</span>&nbsp;<span class="ident" id="4250814">config</span>&nbsp;<span class="op" id="4250821">*</span><span class="ident" id="4250822"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="4250828">)</span>&nbsp;<span class="op" id="4250830">(</span><span class="ident" id="4250831"><a href="/crypto/tls/tls.go.html#4249226">net</a></span><span class="op" id="4250834">.</span><span class="ident" id="4250835">Listener</span><span class="op" id="4250843">,</span>&nbsp;<span class="builtintype" id="4250845">error</span><span class="op" id="4250850">)</span>&nbsp;<span class="op" id="4250852">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250855">if</span>&nbsp;<span class="ident" id="4250858"><a href="/crypto/tls/tls.go.html#4250814">config</a></span>&nbsp;<span class="op" id="4250865">==</span>&nbsp;<span class="ident" id="4250868">nil</span>&nbsp;<span class="op" id="4250872">||</span>&nbsp;<span class="builtinfunc" id="4250875">len</span><span class="op" id="4250878">(</span><span class="ident" id="4250879"><a href="/crypto/tls/tls.go.html#4250814">config</a></span><span class="op" id="4250885">.</span><span class="ident" id="4250886">Certificates</span><span class="op" id="4250898">)</span>&nbsp;<span class="op" id="4250900">==</span>&nbsp;<span class="num" id="4250903">0</span>&nbsp;<span class="op" id="4250905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250909">return</span>&nbsp;<span class="ident" id="4250916">nil</span><span class="op" id="4250919">,</span>&nbsp;<span class="ident" id="4250921"><a href="/crypto/tls/tls.go.html#4249203">errors</a></span><span class="op" id="4250927">.</span><span class="ident" id="4250928">New</span><span class="op" id="4250931">(</span><span class="string" id="4250932">&#34;tls.Listen:&nbsp;no&nbsp;certificates&nbsp;in&nbsp;configuration&#34;</span><span class="op" id="4250978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4250981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250984">l</span><span class="op" id="4250985">,</span>&nbsp;<span class="ident" id="4250987">err</span>&nbsp;<span class="op" id="4250991">:=</span>&nbsp;<span class="ident" id="4250994"><a href="/crypto/tls/tls.go.html#4249226">net</a></span><span class="op" id="4250997">.</span><span class="ident" id="4250998">Listen</span><span class="op" id="4251004">(</span><span class="ident" id="4251005"><a href="/crypto/tls/tls.go.html#4250791">network</a></span><span class="op" id="4251012">,</span>&nbsp;<span class="ident" id="4251014"><a href="/crypto/tls/tls.go.html#4250800">laddr</a></span><span class="op" id="4251019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4251022">if</span>&nbsp;<span class="ident" id="4251025"><a href="/crypto/tls/tls.go.html#4250987">err</a></span>&nbsp;<span class="op" id="4251029">!=</span>&nbsp;<span class="ident" id="4251032">nil</span>&nbsp;<span class="op" id="4251036">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4251040">return</span>&nbsp;<span class="ident" id="4251047">nil</span><span class="op" id="4251050">,</span>&nbsp;<span class="ident" id="4251052"><a href="/crypto/tls/tls.go.html#4250987">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4251057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4251060">return</span>&nbsp;<span class="ident" id="4251067"><a href="/crypto/tls/tls.go.html#4250452">NewListener</a></span><span class="op" id="4251078">(</span><span class="ident" id="4251079"><a href="/crypto/tls/tls.go.html#4250984">l</a></span><span class="op" id="4251080">,</span>&nbsp;<span class="ident" id="4251082"><a href="/crypto/tls/tls.go.html#4250814">config</a></span><span class="op" id="4251088">)</span><span class="op" id="4251089">,</span>&nbsp;<span class="ident" id="4251091">nil</span><br>
<span class="lineno"></span><span class="op" id="4251095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4251098">type</span>&nbsp;<span class="ident" id="4251103">timeoutError</span>&nbsp;<span class="keyword" id="4251116">struct</span><span class="op" id="4251122">{</span><span class="op" id="4251123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4251126">func</span>&nbsp;<span class="op" id="4251131">(</span><span class="ident" id="4251132"><a href="/crypto/tls/tls.go.html#4251103">timeoutError</a></span><span class="op" id="4251144">)</span>&nbsp;<span class="ident" id="4251146">Error</span><span class="op" id="4251151">(</span><span class="op" id="4251152">)</span>&nbsp;<span class="builtintype" id="4251154">string</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4251163">{</span>&nbsp;<span class="keyword" id="4251165">return</span>&nbsp;<span class="string" id="4251172">&#34;tls:&nbsp;DialWithDialer&nbsp;timed&nbsp;out&#34;</span>&nbsp;<span class="op" id="4251204">}</span><br>
<span class="lineno"></span><span class="keyword" id="4251206">func</span>&nbsp;<span class="op" id="4251211">(</span><span class="ident" id="4251212"><a href="/crypto/tls/tls.go.html#4251103">timeoutError</a></span><span class="op" id="4251224">)</span>&nbsp;<span class="ident" id="4251226">Timeout</span><span class="op" id="4251233">(</span><span class="op" id="4251234">)</span>&nbsp;<span class="builtintype" id="4251236">bool</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4251243">{</span>&nbsp;<span class="keyword" id="4251245">return</span>&nbsp;<span class="ident" id="4251252">true</span>&nbsp;<span class="op" id="4251257">}</span><br>
<span class="lineno"></span><span class="keyword" id="4251259">func</span>&nbsp;<span class="op" id="4251264">(</span><span class="ident" id="4251265"><a href="/crypto/tls/tls.go.html#4251103">timeoutError</a></span><span class="op" id="4251277">)</span>&nbsp;<span class="ident" id="4251279">Temporary</span><span class="op" id="4251288">(</span><span class="op" id="4251289">)</span>&nbsp;<span class="builtintype" id="4251291">bool</span>&nbsp;<span class="op" id="4251296">{</span>&nbsp;<span class="keyword" id="4251298">return</span>&nbsp;<span class="ident" id="4251305">true</span>&nbsp;<span class="op" id="4251310">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4251313">//&nbsp;DialWithDialer&nbsp;connects&nbsp;to&nbsp;the&nbsp;given&nbsp;network&nbsp;address&nbsp;using&nbsp;dialer.Dial&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4251391">//&nbsp;then&nbsp;initiates&nbsp;a&nbsp;TLS&nbsp;handshake,&nbsp;returning&nbsp;the&nbsp;resulting&nbsp;TLS&nbsp;connection.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="4251470">//&nbsp;timeout&nbsp;or&nbsp;deadline&nbsp;given&nbsp;in&nbsp;the&nbsp;dialer&nbsp;apply&nbsp;to&nbsp;connection&nbsp;and&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="4251541">//&nbsp;handshake&nbsp;as&nbsp;a&nbsp;whole.</span><br>
<span class="lineno">90</span><span class="comment" id="4251566">//</span><br>
<span class="lineno"></span><span class="comment" id="4251569">//&nbsp;DialWithDialer&nbsp;interprets&nbsp;a&nbsp;nil&nbsp;configuration&nbsp;as&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="4251644">//&nbsp;configuration;&nbsp;see&nbsp;the&nbsp;documentation&nbsp;of&nbsp;Config&nbsp;for&nbsp;the&nbsp;defaults.</span><br>
<span class="lineno"></span><span class="keyword" id="4251712">func</span>&nbsp;<span class="ident" id="4251717">DialWithDialer</span><span class="op" id="4251731">(</span><span class="ident" id="4251732">dialer</span>&nbsp;<span class="op" id="4251739">*</span><span class="ident" id="4251740"><a href="/crypto/tls/tls.go.html#4249226">net</a></span><span class="op" id="4251743">.</span><span class="ident" id="4251744">Dialer</span><span class="op" id="4251750">,</span>&nbsp;<span class="ident" id="4251752">network</span><span class="op" id="4251759">,</span>&nbsp;<span class="ident" id="4251761">addr</span>&nbsp;<span class="builtintype" id="4251766">string</span><span class="op" id="4251772">,</span>&nbsp;<span class="ident" id="4251774">config</span>&nbsp;<span class="op" id="4251781">*</span><span class="ident" id="4251782"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="4251788">)</span>&nbsp;<span class="op" id="4251790">(</span><span class="op" id="4251791">*</span><span class="ident" id="4251792"><a href="/crypto/tls/conn.go.html#4127599">Conn</a></span><span class="op" id="4251796">,</span>&nbsp;<span class="builtintype" id="4251798">error</span><span class="op" id="4251803">)</span>&nbsp;<span class="op" id="4251805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4251808">//&nbsp;We&nbsp;want&nbsp;the&nbsp;Timeout&nbsp;and&nbsp;Deadline&nbsp;values&nbsp;from&nbsp;dialer&nbsp;to&nbsp;cover&nbsp;the</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4251877">//&nbsp;whole&nbsp;process:&nbsp;TCP&nbsp;connection&nbsp;and&nbsp;TLS&nbsp;handshake.&nbsp;This&nbsp;means&nbsp;that&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4251949">//&nbsp;also&nbsp;need&nbsp;to&nbsp;start&nbsp;our&nbsp;own&nbsp;timers&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4251992">timeout</span>&nbsp;<span class="op" id="4252000">:=</span>&nbsp;<span class="ident" id="4252003"><a href="/crypto/tls/tls.go.html#4251732">dialer</a></span><span class="op" id="4252009">.</span><span class="ident" id="4252010">Timeout</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4252020">if</span>&nbsp;<span class="op" id="4252023">!</span><span class="ident" id="4252024"><a href="/crypto/tls/tls.go.html#4251732">dialer</a></span><span class="op" id="4252030">.</span><span class="ident" id="4252031">Deadline</span><span class="op" id="4252039">.</span><span class="ident" id="4252040">IsZero</span><span class="op" id="4252046">(</span><span class="op" id="4252047">)</span>&nbsp;<span class="op" id="4252049">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4252053">deadlineTimeout</span>&nbsp;<span class="op" id="4252069">:=</span>&nbsp;<span class="ident" id="4252072"><a href="/crypto/tls/tls.go.html#4251732">dialer</a></span><span class="op" id="4252078">.</span><span class="ident" id="4252079">Deadline</span><span class="op" id="4252087">.</span><span class="ident" id="4252088">Sub</span><span class="op" id="4252091">(</span><span class="ident" id="4252092"><a href="/crypto/tls/tls.go.html#4249244">time</a></span><span class="op" id="4252096">.</span><span class="ident" id="4252097">Now</span><span class="op" id="4252100">(</span><span class="op" id="4252101">)</span><span class="op" id="4252102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4252106">if</span>&nbsp;<span class="ident" id="4252109"><a href="/crypto/tls/tls.go.html#4251992">timeout</a></span>&nbsp;<span class="op" id="4252117">==</span>&nbsp;<span class="num" id="4252120">0</span>&nbsp;<span class="op" id="4252122">||</span>&nbsp;<span class="ident" id="4252125"><a href="/crypto/tls/tls.go.html#4252053">deadlineTimeout</a></span>&nbsp;<span class="op" id="4252141">&lt;</span>&nbsp;<span class="ident" id="4252143"><a href="/crypto/tls/tls.go.html#4251992">timeout</a></span>&nbsp;<span class="op" id="4252151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4252156"><a href="/crypto/tls/tls.go.html#4251992">timeout</a></span>&nbsp;<span class="op" id="4252164">=</span>&nbsp;<span class="ident" id="4252166"><a href="/crypto/tls/tls.go.html#4252053">deadlineTimeout</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4252184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4252187">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4252191">var</span>&nbsp;<span class="ident" id="4252195">errChannel</span>&nbsp;<span class="keyword" id="4252206">chan</span>&nbsp;<span class="builtintype" id="4252211">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4252219">if</span>&nbsp;<span class="ident" id="4252222"><a href="/crypto/tls/tls.go.html#4251992">timeout</a></span>&nbsp;<span class="op" id="4252230">!=</span>&nbsp;<span class="num" id="4252233">0</span>&nbsp;<span class="op" id="4252235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4252239"><a href="/crypto/tls/tls.go.html#4252195">errChannel</a></span>&nbsp;<span class="op" id="4252250">=</span>&nbsp;<span class="builtinfunc" id="4252252">make</span><span class="op" id="4252256">(</span><span class="keyword" id="4252257">chan</span>&nbsp;<span class="builtintype" id="4252262">error</span><span class="op" id="4252267">,</span>&nbsp;<span class="num" id="4252269">2</span><span class="op" id="4252270">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4252274"><a href="/crypto/tls/tls.go.html#4249244">time</a></span><span class="op" id="4252278">.</span><span class="ident" id="4252279">AfterFunc</span><span class="op" id="4252288">(</span><span class="ident" id="4252289"><a href="/crypto/tls/tls.go.html#4251992">timeout</a></span><span class="op" id="4252296">,</span>&nbsp;<span class="keyword" id="4252298">func</span><span class="op" id="4252302">(</span><span class="op" id="4252303">)</span>&nbsp;<span class="op" id="4252305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4252310"><a href="/crypto/tls/tls.go.html#4252195">errChannel</a></span>&nbsp;<span class="op" id="4252321">&lt;-</span>&nbsp;<span class="ident" id="4252324"><a href="/crypto/tls/tls.go.html#4251103">timeoutError</a></span><span class="op" id="4252336">{</span><span class="op" id="4252337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4252341">}</span><span class="op" id="4252342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4252345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4252349">rawConn</span><span class="op" id="4252356">,</span>&nbsp;<span class="ident" id="4252358">err</span>&nbsp;<span class="op" id="4252362">:=</span>&nbsp;<span class="ident" id="4252365"><a href="/crypto/tls/tls.go.html#4251732">dialer</a></span><span class="op" id="4252371">.</span><span class="ident" id="4252372">Dial</span><span class="op" id="4252376">(</span><span class="ident" id="4252377"><a href="/crypto/tls/tls.go.html#4251752">network</a></span><span class="op" id="4252384">,</span>&nbsp;<span class="ident" id="4252386"><a href="/crypto/tls/tls.go.html#4251761">addr</a></span><span class="op" id="4252390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4252393">if</span>&nbsp;<span class="ident" id="4252396"><a href="/crypto/tls/tls.go.html#4252358">err</a></span>&nbsp;<span class="op" id="4252400">!=</span>&nbsp;<span class="ident" id="4252403">nil</span>&nbsp;<span class="op" id="4252407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4252411">return</span>&nbsp;<span class="ident" id="4252418">nil</span><span class="op" id="4252421">,</span>&nbsp;<span class="ident" id="4252423"><a href="/crypto/tls/tls.go.html#4252358">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4252428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4252432">colonPos</span>&nbsp;<span class="op" id="4252441">:=</span>&nbsp;<span class="ident" id="4252444"><a href="/crypto/tls/tls.go.html#4249233">strings</a></span><span class="op" id="4252451">.</span><span class="ident" id="4252452">LastIndex</span><span class="op" id="4252461">(</span><span class="ident" id="4252462"><a href="/crypto/tls/tls.go.html#4251761">addr</a></span><span class="op" id="4252466">,</span>&nbsp;<span class="string" id="4252468">&#34;:&#34;</span><span class="op" id="4252471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4252474">if</span>&nbsp;<span class="ident" id="4252477"><a href="/crypto/tls/tls.go.html#4252432">colonPos</a></span>&nbsp;<span class="op" id="4252486">==</span>&nbsp;<span class="op" id="4252489">-</span><span class="num" id="4252490">1</span>&nbsp;<span class="op" id="4252492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4252496"><a href="/crypto/tls/tls.go.html#4252432">colonPos</a></span>&nbsp;<span class="op" id="4252505">=</span>&nbsp;<span class="builtinfunc" id="4252507">len</span><span class="op" id="4252510">(</span><span class="ident" id="4252511"><a href="/crypto/tls/tls.go.html#4251761">addr</a></span><span class="op" id="4252515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4252518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4252521">hostname</span>&nbsp;<span class="op" id="4252530">:=</span>&nbsp;<span class="ident" id="4252533"><a href="/crypto/tls/tls.go.html#4251761">addr</a></span><span class="op" id="4252537">[</span><span class="op" id="4252538">:</span><span class="ident" id="4252539"><a href="/crypto/tls/tls.go.html#4252432">colonPos</a></span><span class="op" id="4252547">]</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4252551">if</span>&nbsp;<span class="ident" id="4252554"><a href="/crypto/tls/tls.go.html#4251774">config</a></span>&nbsp;<span class="op" id="4252561">==</span>&nbsp;<span class="ident" id="4252564">nil</span>&nbsp;<span class="op" id="4252568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4252572"><a href="/crypto/tls/tls.go.html#4251774">config</a></span>&nbsp;<span class="op" id="4252579">=</span>&nbsp;<span class="ident" id="4252581"><a href="/crypto/tls/common.go.html#4126594">defaultConfig</a></span><span class="op" id="4252594">(</span><span class="op" id="4252595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4252598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4252601">//&nbsp;If&nbsp;no&nbsp;ServerName&nbsp;is&nbsp;set,&nbsp;infer&nbsp;the&nbsp;ServerName</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4252651">//&nbsp;from&nbsp;the&nbsp;hostname&nbsp;we&#39;re&nbsp;connecting&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4252694">if</span>&nbsp;<span class="ident" id="4252697"><a href="/crypto/tls/tls.go.html#4251774">config</a></span><span class="op" id="4252703">.</span><span class="ident" id="4252704">ServerName</span>&nbsp;<span class="op" id="4252715">==</span>&nbsp;<span class="string" id="4252718">&#34;&#34;</span>&nbsp;<span class="op" id="4252721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4252725">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;to&nbsp;avoid&nbsp;polluting&nbsp;argument&nbsp;or&nbsp;default.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4252782">c</span>&nbsp;<span class="op" id="4252784">:=</span>&nbsp;<span class="op" id="4252787">*</span><span class="ident" id="4252788"><a href="/crypto/tls/tls.go.html#4251774">config</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4252797"><a href="/crypto/tls/tls.go.html#4252782">c</a></span><span class="op" id="4252798">.</span><span class="ident" id="4252799">ServerName</span>&nbsp;<span class="op" id="4252810">=</span>&nbsp;<span class="ident" id="4252812"><a href="/crypto/tls/tls.go.html#4252521">hostname</a></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4252823"><a href="/crypto/tls/tls.go.html#4251774">config</a></span>&nbsp;<span class="op" id="4252830">=</span>&nbsp;<span class="op" id="4252832">&amp;</span><span class="ident" id="4252833"><a href="/crypto/tls/tls.go.html#4252782">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4252836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4252840">conn</span>&nbsp;<span class="op" id="4252845">:=</span>&nbsp;<span class="ident" id="4252848"><a href="/crypto/tls/tls.go.html#4249732">Client</a></span><span class="op" id="4252854">(</span><span class="ident" id="4252855"><a href="/crypto/tls/tls.go.html#4252349">rawConn</a></span><span class="op" id="4252862">,</span>&nbsp;<span class="ident" id="4252864"><a href="/crypto/tls/tls.go.html#4251774">config</a></span><span class="op" id="4252870">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4252874">if</span>&nbsp;<span class="ident" id="4252877"><a href="/crypto/tls/tls.go.html#4251992">timeout</a></span>&nbsp;<span class="op" id="4252885">==</span>&nbsp;<span class="num" id="4252888">0</span>&nbsp;<span class="op" id="4252890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4252894"><a href="/crypto/tls/tls.go.html#4252358">err</a></span>&nbsp;<span class="op" id="4252898">=</span>&nbsp;<span class="ident" id="4252900"><a href="/crypto/tls/tls.go.html#4252840">conn</a></span><span class="op" id="4252904">.</span><span class="ident" id="4252905">Handshake</span><span class="op" id="4252914">(</span><span class="op" id="4252915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4252918">}</span>&nbsp;<span class="keyword" id="4252920">else</span>&nbsp;<span class="op" id="4252925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4252929">go</span>&nbsp;<span class="keyword" id="4252932">func</span><span class="op" id="4252936">(</span><span class="op" id="4252937">)</span>&nbsp;<span class="op" id="4252939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4252944"><a href="/crypto/tls/tls.go.html#4252195">errChannel</a></span>&nbsp;<span class="op" id="4252955">&lt;-</span>&nbsp;<span class="ident" id="4252958"><a href="/crypto/tls/tls.go.html#4252840">conn</a></span><span class="op" id="4252962">.</span><span class="ident" id="4252963">Handshake</span><span class="op" id="4252972">(</span><span class="op" id="4252973">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4252977">}</span><span class="op" id="4252978">(</span><span class="op" id="4252979">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4252984"><a href="/crypto/tls/tls.go.html#4252358">err</a></span>&nbsp;<span class="op" id="4252988">=</span>&nbsp;<span class="op" id="4252990">&lt;-</span><span class="ident" id="4252992"><a href="/crypto/tls/tls.go.html#4252195">errChannel</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4253004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253008">if</span>&nbsp;<span class="ident" id="4253011"><a href="/crypto/tls/tls.go.html#4252358">err</a></span>&nbsp;<span class="op" id="4253015">!=</span>&nbsp;<span class="ident" id="4253018">nil</span>&nbsp;<span class="op" id="4253022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253026"><a href="/crypto/tls/tls.go.html#4252349">rawConn</a></span><span class="op" id="4253033">.</span><span class="ident" id="4253034">Close</span><span class="op" id="4253039">(</span><span class="op" id="4253040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253044">return</span>&nbsp;<span class="ident" id="4253051">nil</span><span class="op" id="4253054">,</span>&nbsp;<span class="ident" id="4253056"><a href="/crypto/tls/tls.go.html#4252358">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4253061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253065">return</span>&nbsp;<span class="ident" id="4253072"><a href="/crypto/tls/tls.go.html#4252840">conn</a></span><span class="op" id="4253076">,</span>&nbsp;<span class="ident" id="4253078">nil</span><br>
<span class="lineno"></span><span class="op" id="4253082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4253085">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;given&nbsp;network&nbsp;address&nbsp;using&nbsp;net.Dial</span><br>
<span class="lineno"></span><span class="comment" id="4253146">//&nbsp;and&nbsp;then&nbsp;initiates&nbsp;a&nbsp;TLS&nbsp;handshake,&nbsp;returning&nbsp;the&nbsp;resulting</span><br>
<span class="lineno">160</span><span class="comment" id="4253209">//&nbsp;TLS&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4253228">//&nbsp;Dial&nbsp;interprets&nbsp;a&nbsp;nil&nbsp;configuration&nbsp;as&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4253284">//&nbsp;the&nbsp;zero&nbsp;configuration;&nbsp;see&nbsp;the&nbsp;documentation&nbsp;of&nbsp;Config</span><br>
<span class="lineno"></span><span class="comment" id="4253343">//&nbsp;for&nbsp;the&nbsp;defaults.</span><br>
<span class="lineno"></span><span class="keyword" id="4253364">func</span>&nbsp;<span class="ident" id="4253369">Dial</span><span class="op" id="4253373">(</span><span class="ident" id="4253374">network</span><span class="op" id="4253381">,</span>&nbsp;<span class="ident" id="4253383">addr</span>&nbsp;<span class="builtintype" id="4253388">string</span><span class="op" id="4253394">,</span>&nbsp;<span class="ident" id="4253396">config</span>&nbsp;<span class="op" id="4253403">*</span><span class="ident" id="4253404"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="4253410">)</span>&nbsp;<span class="op" id="4253412">(</span><span class="op" id="4253413">*</span><span class="ident" id="4253414"><a href="/crypto/tls/conn.go.html#4127599">Conn</a></span><span class="op" id="4253418">,</span>&nbsp;<span class="builtintype" id="4253420">error</span><span class="op" id="4253425">)</span>&nbsp;<span class="op" id="4253427">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253430">return</span>&nbsp;<span class="ident" id="4253437"><a href="/crypto/tls/tls.go.html#4251717">DialWithDialer</a></span><span class="op" id="4253451">(</span><span class="builtinfunc" id="4253452">new</span><span class="op" id="4253455">(</span><span class="ident" id="4253456"><a href="/crypto/tls/tls.go.html#4249226">net</a></span><span class="op" id="4253459">.</span><span class="ident" id="4253460">Dialer</span><span class="op" id="4253466">)</span><span class="op" id="4253467">,</span>&nbsp;<span class="ident" id="4253469"><a href="/crypto/tls/tls.go.html#4253374">network</a></span><span class="op" id="4253476">,</span>&nbsp;<span class="ident" id="4253478"><a href="/crypto/tls/tls.go.html#4253383">addr</a></span><span class="op" id="4253482">,</span>&nbsp;<span class="ident" id="4253484"><a href="/crypto/tls/tls.go.html#4253396">config</a></span><span class="op" id="4253490">)</span><br>
<span class="lineno"></span><span class="op" id="4253492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4253495">//&nbsp;LoadX509KeyPair&nbsp;reads&nbsp;and&nbsp;parses&nbsp;a&nbsp;public/private&nbsp;key&nbsp;pair&nbsp;from&nbsp;a&nbsp;pair&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4253572">//&nbsp;files.&nbsp;The&nbsp;files&nbsp;must&nbsp;contain&nbsp;PEM&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno">170</span><span class="keyword" id="4253623">func</span>&nbsp;<span class="ident" id="4253628">LoadX509KeyPair</span><span class="op" id="4253643">(</span><span class="ident" id="4253644">certFile</span><span class="op" id="4253652">,</span>&nbsp;<span class="ident" id="4253654">keyFile</span>&nbsp;<span class="builtintype" id="4253662">string</span><span class="op" id="4253668">)</span>&nbsp;<span class="op" id="4253670">(</span><span class="ident" id="4253671">cert</span>&nbsp;<span class="ident" id="4253676"><a href="/crypto/tls/common.go.html#4123683">Certificate</a></span><span class="op" id="4253687">,</span>&nbsp;<span class="ident" id="4253689">err</span>&nbsp;<span class="builtintype" id="4253693">error</span><span class="op" id="4253698">)</span>&nbsp;<span class="op" id="4253700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253703">certPEMBlock</span><span class="op" id="4253715">,</span>&nbsp;<span class="ident" id="4253717"><a href="/crypto/tls/tls.go.html#4253689">err</a></span>&nbsp;<span class="op" id="4253721">:=</span>&nbsp;<span class="ident" id="4253724"><a href="/crypto/tls/tls.go.html#4249213">ioutil</a></span><span class="op" id="4253730">.</span><span class="ident" id="4253731">ReadFile</span><span class="op" id="4253739">(</span><span class="ident" id="4253740"><a href="/crypto/tls/tls.go.html#4253644">certFile</a></span><span class="op" id="4253748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253751">if</span>&nbsp;<span class="ident" id="4253754"><a href="/crypto/tls/tls.go.html#4253689">err</a></span>&nbsp;<span class="op" id="4253758">!=</span>&nbsp;<span class="ident" id="4253761">nil</span>&nbsp;<span class="op" id="4253765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253769">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4253777">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4253780">keyPEMBlock</span><span class="op" id="4253791">,</span>&nbsp;<span class="ident" id="4253793"><a href="/crypto/tls/tls.go.html#4253689">err</a></span>&nbsp;<span class="op" id="4253797">:=</span>&nbsp;<span class="ident" id="4253800"><a href="/crypto/tls/tls.go.html#4249213">ioutil</a></span><span class="op" id="4253806">.</span><span class="ident" id="4253807">ReadFile</span><span class="op" id="4253815">(</span><span class="ident" id="4253816"><a href="/crypto/tls/tls.go.html#4253654">keyFile</a></span><span class="op" id="4253823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253826">if</span>&nbsp;<span class="ident" id="4253829"><a href="/crypto/tls/tls.go.html#4253689">err</a></span>&nbsp;<span class="op" id="4253833">!=</span>&nbsp;<span class="ident" id="4253836">nil</span>&nbsp;<span class="op" id="4253840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253844">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4253852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4253855">return</span>&nbsp;<span class="ident" id="4253862"><a href="/crypto/tls/tls.go.html#4253993">X509KeyPair</a></span><span class="op" id="4253873">(</span><span class="ident" id="4253874"><a href="/crypto/tls/tls.go.html#4253703">certPEMBlock</a></span><span class="op" id="4253886">,</span>&nbsp;<span class="ident" id="4253888"><a href="/crypto/tls/tls.go.html#4253780">keyPEMBlock</a></span><span class="op" id="4253899">)</span><br>
<span class="lineno">180</span><span class="op" id="4253901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4253904">//&nbsp;X509KeyPair&nbsp;parses&nbsp;a&nbsp;public/private&nbsp;key&nbsp;pair&nbsp;from&nbsp;a&nbsp;pair&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4253967">//&nbsp;PEM&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4253988">func</span>&nbsp;<span class="ident" id="4253993">X509KeyPair</span><span class="op" id="4254004">(</span><span class="ident" id="4254005">certPEMBlock</span><span class="op" id="4254017">,</span>&nbsp;<span class="ident" id="4254019">keyPEMBlock</span>&nbsp;<span class="op" id="4254031">[</span><span class="op" id="4254032">]</span><span class="builtintype" id="4254033">byte</span><span class="op" id="4254037">)</span>&nbsp;<span class="op" id="4254039">(</span><span class="ident" id="4254040">cert</span>&nbsp;<span class="ident" id="4254045"><a href="/crypto/tls/common.go.html#4123683">Certificate</a></span><span class="op" id="4254056">,</span>&nbsp;<span class="ident" id="4254058">err</span>&nbsp;<span class="builtintype" id="4254062">error</span><span class="op" id="4254067">)</span>&nbsp;<span class="op" id="4254069">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254072">var</span>&nbsp;<span class="ident" id="4254076">certDERBlock</span>&nbsp;<span class="op" id="4254089">*</span><span class="ident" id="4254090"><a href="/crypto/tls/tls.go.html#4249187">pem</a></span><span class="op" id="4254093">.</span><span class="ident" id="4254094">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254101">for</span>&nbsp;<span class="op" id="4254105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254109"><a href="/crypto/tls/tls.go.html#4254076">certDERBlock</a></span><span class="op" id="4254121">,</span>&nbsp;<span class="ident" id="4254123"><a href="/crypto/tls/tls.go.html#4254005">certPEMBlock</a></span>&nbsp;<span class="op" id="4254136">=</span>&nbsp;<span class="ident" id="4254138"><a href="/crypto/tls/tls.go.html#4249187">pem</a></span><span class="op" id="4254141">.</span><span class="ident" id="4254142">Decode</span><span class="op" id="4254148">(</span><span class="ident" id="4254149"><a href="/crypto/tls/tls.go.html#4254005">certPEMBlock</a></span><span class="op" id="4254161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254165">if</span>&nbsp;<span class="ident" id="4254168"><a href="/crypto/tls/tls.go.html#4254076">certDERBlock</a></span>&nbsp;<span class="op" id="4254181">==</span>&nbsp;<span class="ident" id="4254184">nil</span>&nbsp;<span class="op" id="4254188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254193">break</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4254201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254205">if</span>&nbsp;<span class="ident" id="4254208"><a href="/crypto/tls/tls.go.html#4254076">certDERBlock</a></span><span class="op" id="4254220">.</span><span class="ident" id="4254221">Type</span>&nbsp;<span class="op" id="4254226">==</span>&nbsp;<span class="string" id="4254229">&#34;CERTIFICATE&#34;</span>&nbsp;<span class="op" id="4254243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254248"><a href="/crypto/tls/tls.go.html#4254040">cert</a></span><span class="op" id="4254252">.</span><span class="ident" id="4254253">Certificate</span>&nbsp;<span class="op" id="4254265">=</span>&nbsp;<span class="builtinfunc" id="4254267">append</span><span class="op" id="4254273">(</span><span class="ident" id="4254274"><a href="/crypto/tls/tls.go.html#4254040">cert</a></span><span class="op" id="4254278">.</span><span class="ident" id="4254279">Certificate</span><span class="op" id="4254290">,</span>&nbsp;<span class="ident" id="4254292"><a href="/crypto/tls/tls.go.html#4254076">certDERBlock</a></span><span class="op" id="4254304">.</span><span class="ident" id="4254305">Bytes</span><span class="op" id="4254310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4254314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4254317">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254321">if</span>&nbsp;<span class="builtinfunc" id="4254324">len</span><span class="op" id="4254327">(</span><span class="ident" id="4254328"><a href="/crypto/tls/tls.go.html#4254040">cert</a></span><span class="op" id="4254332">.</span><span class="ident" id="4254333">Certificate</span><span class="op" id="4254344">)</span>&nbsp;<span class="op" id="4254346">==</span>&nbsp;<span class="num" id="4254349">0</span>&nbsp;<span class="op" id="4254351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254355"><a href="/crypto/tls/tls.go.html#4254058">err</a></span>&nbsp;<span class="op" id="4254359">=</span>&nbsp;<span class="ident" id="4254361"><a href="/crypto/tls/tls.go.html#4249203">errors</a></span><span class="op" id="4254367">.</span><span class="ident" id="4254368">New</span><span class="op" id="4254371">(</span><span class="string" id="4254372">&#34;crypto/tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;certificate&nbsp;PEM&nbsp;data&#34;</span><span class="op" id="4254422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254426">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4254434">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254438">var</span>&nbsp;<span class="ident" id="4254442">keyDERBlock</span>&nbsp;<span class="op" id="4254454">*</span><span class="ident" id="4254455"><a href="/crypto/tls/tls.go.html#4249187">pem</a></span><span class="op" id="4254458">.</span><span class="ident" id="4254459">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254466">for</span>&nbsp;<span class="op" id="4254470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254474"><a href="/crypto/tls/tls.go.html#4254442">keyDERBlock</a></span><span class="op" id="4254485">,</span>&nbsp;<span class="ident" id="4254487"><a href="/crypto/tls/tls.go.html#4254019">keyPEMBlock</a></span>&nbsp;<span class="op" id="4254499">=</span>&nbsp;<span class="ident" id="4254501"><a href="/crypto/tls/tls.go.html#4249187">pem</a></span><span class="op" id="4254504">.</span><span class="ident" id="4254505">Decode</span><span class="op" id="4254511">(</span><span class="ident" id="4254512"><a href="/crypto/tls/tls.go.html#4254019">keyPEMBlock</a></span><span class="op" id="4254523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254527">if</span>&nbsp;<span class="ident" id="4254530"><a href="/crypto/tls/tls.go.html#4254442">keyDERBlock</a></span>&nbsp;<span class="op" id="4254542">==</span>&nbsp;<span class="ident" id="4254545">nil</span>&nbsp;<span class="op" id="4254549">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254554"><a href="/crypto/tls/tls.go.html#4254058">err</a></span>&nbsp;<span class="op" id="4254558">=</span>&nbsp;<span class="ident" id="4254560"><a href="/crypto/tls/tls.go.html#4249203">errors</a></span><span class="op" id="4254566">.</span><span class="ident" id="4254567">New</span><span class="op" id="4254570">(</span><span class="string" id="4254571">&#34;crypto/tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;key&nbsp;PEM&nbsp;data&#34;</span><span class="op" id="4254613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254618">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4254627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254631">if</span>&nbsp;<span class="ident" id="4254634"><a href="/crypto/tls/tls.go.html#4254442">keyDERBlock</a></span><span class="op" id="4254645">.</span><span class="ident" id="4254646">Type</span>&nbsp;<span class="op" id="4254651">==</span>&nbsp;<span class="string" id="4254654">&#34;PRIVATE&nbsp;KEY&#34;</span>&nbsp;<span class="op" id="4254668">||</span>&nbsp;<span class="ident" id="4254671"><a href="/crypto/tls/tls.go.html#4249233">strings</a></span><span class="op" id="4254678">.</span><span class="ident" id="4254679">HasSuffix</span><span class="op" id="4254688">(</span><span class="ident" id="4254689"><a href="/crypto/tls/tls.go.html#4254442">keyDERBlock</a></span><span class="op" id="4254700">.</span><span class="ident" id="4254701">Type</span><span class="op" id="4254705">,</span>&nbsp;<span class="string" id="4254707">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="4254721">)</span>&nbsp;<span class="op" id="4254723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254728">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4254736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4254739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254743"><a href="/crypto/tls/tls.go.html#4254040">cert</a></span><span class="op" id="4254747">.</span><span class="ident" id="4254748">PrivateKey</span><span class="op" id="4254758">,</span>&nbsp;<span class="ident" id="4254760"><a href="/crypto/tls/tls.go.html#4254058">err</a></span>&nbsp;<span class="op" id="4254764">=</span>&nbsp;<span class="ident" id="4254766"><a href="/crypto/tls/tls.go.html#4256054">parsePrivateKey</a></span><span class="op" id="4254781">(</span><span class="ident" id="4254782"><a href="/crypto/tls/tls.go.html#4254442">keyDERBlock</a></span><span class="op" id="4254793">.</span><span class="ident" id="4254794">Bytes</span><span class="op" id="4254799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254802">if</span>&nbsp;<span class="ident" id="4254805"><a href="/crypto/tls/tls.go.html#4254058">err</a></span>&nbsp;<span class="op" id="4254809">!=</span>&nbsp;<span class="ident" id="4254812">nil</span>&nbsp;<span class="op" id="4254816">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254820">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4254828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4254832">//&nbsp;We&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;parse&nbsp;the&nbsp;public&nbsp;key&nbsp;for&nbsp;TLS,&nbsp;but&nbsp;we&nbsp;so&nbsp;do&nbsp;anyway</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4254903">//&nbsp;to&nbsp;check&nbsp;that&nbsp;it&nbsp;looks&nbsp;sane&nbsp;and&nbsp;matches&nbsp;the&nbsp;private&nbsp;key.</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254964">x509Cert</span><span class="op" id="4254972">,</span>&nbsp;<span class="ident" id="4254974"><a href="/crypto/tls/tls.go.html#4254058">err</a></span>&nbsp;<span class="op" id="4254978">:=</span>&nbsp;<span class="ident" id="4254981"><a href="/crypto/tls/tls.go.html#4249172">x509</a></span><span class="op" id="4254985">.</span><span class="ident" id="4254986">ParseCertificate</span><span class="op" id="4255002">(</span><span class="ident" id="4255003"><a href="/crypto/tls/tls.go.html#4254040">cert</a></span><span class="op" id="4255007">.</span><span class="ident" id="4255008">Certificate</span><span class="op" id="4255019">[</span><span class="num" id="4255020">0</span><span class="op" id="4255021">]</span><span class="op" id="4255022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255025">if</span>&nbsp;<span class="ident" id="4255028"><a href="/crypto/tls/tls.go.html#4254058">err</a></span>&nbsp;<span class="op" id="4255032">!=</span>&nbsp;<span class="ident" id="4255035">nil</span>&nbsp;<span class="op" id="4255039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255043">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4255051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255055">switch</span>&nbsp;<span class="ident" id="4255062">pub</span>&nbsp;<span class="op" id="4255066">:=</span>&nbsp;<span class="ident" id="4255069"><a href="/crypto/tls/tls.go.html#4254964">x509Cert</a></span><span class="op" id="4255077">.</span><span class="ident" id="4255078">PublicKey</span><span class="op" id="4255087">.</span><span class="op" id="4255088">(</span><span class="keyword" id="4255089">type</span><span class="op" id="4255093">)</span>&nbsp;<span class="op" id="4255095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255098">case</span>&nbsp;<span class="op" id="4255103">*</span><span class="ident" id="4255104"><a href="/crypto/tls/tls.go.html#4249158">rsa</a></span><span class="op" id="4255107">.</span><span class="ident" id="4255108">PublicKey</span><span class="op" id="4255117">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255121">priv</span><span class="op" id="4255125">,</span>&nbsp;<span class="ident" id="4255127">ok</span>&nbsp;<span class="op" id="4255130">:=</span>&nbsp;<span class="ident" id="4255133"><a href="/crypto/tls/tls.go.html#4254040">cert</a></span><span class="op" id="4255137">.</span><span class="ident" id="4255138">PrivateKey</span><span class="op" id="4255148">.</span><span class="op" id="4255149">(</span><span class="op" id="4255150">*</span><span class="ident" id="4255151"><a href="/crypto/tls/tls.go.html#4249158">rsa</a></span><span class="op" id="4255154">.</span><span class="ident" id="4255155">PrivateKey</span><span class="op" id="4255165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255169">if</span>&nbsp;<span class="op" id="4255172">!</span><span class="ident" id="4255173"><a href="/crypto/tls/tls.go.html#4255127">ok</a></span>&nbsp;<span class="op" id="4255176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255181"><a href="/crypto/tls/tls.go.html#4254058">err</a></span>&nbsp;<span class="op" id="4255185">=</span>&nbsp;<span class="ident" id="4255187"><a href="/crypto/tls/tls.go.html#4249203">errors</a></span><span class="op" id="4255193">.</span><span class="ident" id="4255194">New</span><span class="op" id="4255197">(</span><span class="string" id="4255198">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;type&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&nbsp;type&#34;</span><span class="op" id="4255259">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255264">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4255273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255277">if</span>&nbsp;<span class="ident" id="4255280"><a href="/crypto/tls/tls.go.html#4255062">pub</a></span><span class="op" id="4255283">.</span><span class="ident" id="4255284">N</span><span class="op" id="4255285">.</span><span class="ident" id="4255286">Cmp</span><span class="op" id="4255289">(</span><span class="ident" id="4255290"><a href="/crypto/tls/tls.go.html#4255121">priv</a></span><span class="op" id="4255294">.</span><span class="ident" id="4255295">N</span><span class="op" id="4255296">)</span>&nbsp;<span class="op" id="4255298">!=</span>&nbsp;<span class="num" id="4255301">0</span>&nbsp;<span class="op" id="4255303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255308"><a href="/crypto/tls/tls.go.html#4254058">err</a></span>&nbsp;<span class="op" id="4255312">=</span>&nbsp;<span class="ident" id="4255314"><a href="/crypto/tls/tls.go.html#4249203">errors</a></span><span class="op" id="4255320">.</span><span class="ident" id="4255321">New</span><span class="op" id="4255324">(</span><span class="string" id="4255325">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&#34;</span><span class="op" id="4255376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255381">return</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4255390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255393">case</span>&nbsp;<span class="op" id="4255398">*</span><span class="ident" id="4255399"><a href="/crypto/tls/tls.go.html#4249142">ecdsa</a></span><span class="op" id="4255404">.</span><span class="ident" id="4255405">PublicKey</span><span class="op" id="4255414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255418">priv</span><span class="op" id="4255422">,</span>&nbsp;<span class="ident" id="4255424">ok</span>&nbsp;<span class="op" id="4255427">:=</span>&nbsp;<span class="ident" id="4255430"><a href="/crypto/tls/tls.go.html#4254040">cert</a></span><span class="op" id="4255434">.</span><span class="ident" id="4255435">PrivateKey</span><span class="op" id="4255445">.</span><span class="op" id="4255446">(</span><span class="op" id="4255447">*</span><span class="ident" id="4255448"><a href="/crypto/tls/tls.go.html#4249142">ecdsa</a></span><span class="op" id="4255453">.</span><span class="ident" id="4255454">PrivateKey</span><span class="op" id="4255464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255468">if</span>&nbsp;<span class="op" id="4255471">!</span><span class="ident" id="4255472"><a href="/crypto/tls/tls.go.html#4255424">ok</a></span>&nbsp;<span class="op" id="4255475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255480"><a href="/crypto/tls/tls.go.html#4254058">err</a></span>&nbsp;<span class="op" id="4255484">=</span>&nbsp;<span class="ident" id="4255486"><a href="/crypto/tls/tls.go.html#4249203">errors</a></span><span class="op" id="4255492">.</span><span class="ident" id="4255493">New</span><span class="op" id="4255496">(</span><span class="string" id="4255497">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;type&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&nbsp;type&#34;</span><span class="op" id="4255558">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255563">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4255573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255577">if</span>&nbsp;<span class="ident" id="4255580"><a href="/crypto/tls/tls.go.html#4255062">pub</a></span><span class="op" id="4255583">.</span><span class="ident" id="4255584">X</span><span class="op" id="4255585">.</span><span class="ident" id="4255586">Cmp</span><span class="op" id="4255589">(</span><span class="ident" id="4255590"><a href="/crypto/tls/tls.go.html#4255418">priv</a></span><span class="op" id="4255594">.</span><span class="ident" id="4255595">X</span><span class="op" id="4255596">)</span>&nbsp;<span class="op" id="4255598">!=</span>&nbsp;<span class="num" id="4255601">0</span>&nbsp;<span class="op" id="4255603">||</span>&nbsp;<span class="ident" id="4255606"><a href="/crypto/tls/tls.go.html#4255062">pub</a></span><span class="op" id="4255609">.</span><span class="ident" id="4255610">Y</span><span class="op" id="4255611">.</span><span class="ident" id="4255612">Cmp</span><span class="op" id="4255615">(</span><span class="ident" id="4255616"><a href="/crypto/tls/tls.go.html#4255418">priv</a></span><span class="op" id="4255620">.</span><span class="ident" id="4255621">Y</span><span class="op" id="4255622">)</span>&nbsp;<span class="op" id="4255624">!=</span>&nbsp;<span class="num" id="4255627">0</span>&nbsp;<span class="op" id="4255629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255634"><a href="/crypto/tls/tls.go.html#4254058">err</a></span>&nbsp;<span class="op" id="4255638">=</span>&nbsp;<span class="ident" id="4255640"><a href="/crypto/tls/tls.go.html#4249203">errors</a></span><span class="op" id="4255646">.</span><span class="ident" id="4255647">New</span><span class="op" id="4255650">(</span><span class="string" id="4255651">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&#34;</span><span class="op" id="4255702">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255707">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4255716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255719">default</span><span class="op" id="4255726">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255730"><a href="/crypto/tls/tls.go.html#4254058">err</a></span>&nbsp;<span class="op" id="4255734">=</span>&nbsp;<span class="ident" id="4255736"><a href="/crypto/tls/tls.go.html#4249203">errors</a></span><span class="op" id="4255742">.</span><span class="ident" id="4255743">New</span><span class="op" id="4255746">(</span><span class="string" id="4255747">&#34;crypto/tls:&nbsp;unknown&nbsp;public&nbsp;key&nbsp;algorithm&#34;</span><span class="op" id="4255789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255793">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4255801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255805">return</span><br>
<span class="lineno"></span><span class="op" id="4255812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="4255815">//&nbsp;Attempt&nbsp;to&nbsp;parse&nbsp;the&nbsp;given&nbsp;private&nbsp;key&nbsp;DER&nbsp;block.&nbsp;OpenSSL&nbsp;0.9.8&nbsp;generates</span><br>
<span class="lineno"></span><span class="comment" id="4255892">//&nbsp;PKCS#1&nbsp;private&nbsp;keys&nbsp;by&nbsp;default,&nbsp;while&nbsp;OpenSSL&nbsp;1.0.0&nbsp;generates&nbsp;PKCS#8&nbsp;keys.</span><br>
<span class="lineno"></span><span class="comment" id="4255970">//&nbsp;OpenSSL&nbsp;ecparam&nbsp;generates&nbsp;SEC1&nbsp;EC&nbsp;private&nbsp;keys&nbsp;for&nbsp;ECDSA.&nbsp;We&nbsp;try&nbsp;all&nbsp;three.</span><br>
<span class="lineno"></span><span class="keyword" id="4256049">func</span>&nbsp;<span class="ident" id="4256054">parsePrivateKey</span><span class="op" id="4256069">(</span><span class="ident" id="4256070">der</span>&nbsp;<span class="op" id="4256074">[</span><span class="op" id="4256075">]</span><span class="builtintype" id="4256076">byte</span><span class="op" id="4256080">)</span>&nbsp;<span class="op" id="4256082">(</span><span class="ident" id="4256083"><a href="/crypto/tls/tls.go.html#4249132">crypto</a></span><span class="op" id="4256089">.</span><span class="ident" id="4256090">PrivateKey</span><span class="op" id="4256100">,</span>&nbsp;<span class="builtintype" id="4256102">error</span><span class="op" id="4256107">)</span>&nbsp;<span class="op" id="4256109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256112">if</span>&nbsp;<span class="ident" id="4256115">key</span><span class="op" id="4256118">,</span>&nbsp;<span class="ident" id="4256120">err</span>&nbsp;<span class="op" id="4256124">:=</span>&nbsp;<span class="ident" id="4256127"><a href="/crypto/tls/tls.go.html#4249172">x509</a></span><span class="op" id="4256131">.</span><span class="ident" id="4256132">ParsePKCS1PrivateKey</span><span class="op" id="4256152">(</span><span class="ident" id="4256153"><a href="/crypto/tls/tls.go.html#4256070">der</a></span><span class="op" id="4256156">)</span><span class="op" id="4256157">;</span>&nbsp;<span class="ident" id="4256159"><a href="/crypto/tls/tls.go.html#4256120">err</a></span>&nbsp;<span class="op" id="4256163">==</span>&nbsp;<span class="ident" id="4256166">nil</span>&nbsp;<span class="op" id="4256170">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256174">return</span>&nbsp;<span class="ident" id="4256181"><a href="/crypto/tls/tls.go.html#4256115">key</a></span><span class="op" id="4256184">,</span>&nbsp;<span class="ident" id="4256186">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256194">if</span>&nbsp;<span class="ident" id="4256197">key</span><span class="op" id="4256200">,</span>&nbsp;<span class="ident" id="4256202">err</span>&nbsp;<span class="op" id="4256206">:=</span>&nbsp;<span class="ident" id="4256209"><a href="/crypto/tls/tls.go.html#4249172">x509</a></span><span class="op" id="4256213">.</span><span class="ident" id="4256214">ParsePKCS8PrivateKey</span><span class="op" id="4256234">(</span><span class="ident" id="4256235"><a href="/crypto/tls/tls.go.html#4256070">der</a></span><span class="op" id="4256238">)</span><span class="op" id="4256239">;</span>&nbsp;<span class="ident" id="4256241"><a href="/crypto/tls/tls.go.html#4256202">err</a></span>&nbsp;<span class="op" id="4256245">==</span>&nbsp;<span class="ident" id="4256248">nil</span>&nbsp;<span class="op" id="4256252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256256">switch</span>&nbsp;<span class="ident" id="4256263">key</span>&nbsp;<span class="op" id="4256267">:=</span>&nbsp;<span class="ident" id="4256270"><a href="/crypto/tls/tls.go.html#4256197">key</a></span><span class="op" id="4256273">.</span><span class="op" id="4256274">(</span><span class="keyword" id="4256275">type</span><span class="op" id="4256279">)</span>&nbsp;<span class="op" id="4256281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256285">case</span>&nbsp;<span class="op" id="4256290">*</span><span class="ident" id="4256291"><a href="/crypto/tls/tls.go.html#4249158">rsa</a></span><span class="op" id="4256294">.</span><span class="ident" id="4256295">PrivateKey</span><span class="op" id="4256305">,</span>&nbsp;<span class="op" id="4256307">*</span><span class="ident" id="4256308"><a href="/crypto/tls/tls.go.html#4249142">ecdsa</a></span><span class="op" id="4256313">.</span><span class="ident" id="4256314">PrivateKey</span><span class="op" id="4256324">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256329">return</span>&nbsp;<span class="ident" id="4256336"><a href="/crypto/tls/tls.go.html#4256263">key</a></span><span class="op" id="4256339">,</span>&nbsp;<span class="ident" id="4256341">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256347">default</span><span class="op" id="4256354">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256359">return</span>&nbsp;<span class="ident" id="4256366">nil</span><span class="op" id="4256369">,</span>&nbsp;<span class="ident" id="4256371"><a href="/crypto/tls/tls.go.html#4249203">errors</a></span><span class="op" id="4256377">.</span><span class="ident" id="4256378">New</span><span class="op" id="4256381">(</span><span class="string" id="4256382">&#34;crypto/tls:&nbsp;found&nbsp;unknown&nbsp;private&nbsp;key&nbsp;type&nbsp;in&nbsp;PKCS#8&nbsp;wrapping&#34;</span><span class="op" id="4256445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256452">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256455">if</span>&nbsp;<span class="ident" id="4256458">key</span><span class="op" id="4256461">,</span>&nbsp;<span class="ident" id="4256463">err</span>&nbsp;<span class="op" id="4256467">:=</span>&nbsp;<span class="ident" id="4256470"><a href="/crypto/tls/tls.go.html#4249172">x509</a></span><span class="op" id="4256474">.</span><span class="ident" id="4256475">ParseECPrivateKey</span><span class="op" id="4256492">(</span><span class="ident" id="4256493"><a href="/crypto/tls/tls.go.html#4256070">der</a></span><span class="op" id="4256496">)</span><span class="op" id="4256497">;</span>&nbsp;<span class="ident" id="4256499"><a href="/crypto/tls/tls.go.html#4256463">err</a></span>&nbsp;<span class="op" id="4256503">==</span>&nbsp;<span class="ident" id="4256506">nil</span>&nbsp;<span class="op" id="4256510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256514">return</span>&nbsp;<span class="ident" id="4256521"><a href="/crypto/tls/tls.go.html#4256458">key</a></span><span class="op" id="4256524">,</span>&nbsp;<span class="ident" id="4256526">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256535">return</span>&nbsp;<span class="ident" id="4256542">nil</span><span class="op" id="4256545">,</span>&nbsp;<span class="ident" id="4256547"><a href="/crypto/tls/tls.go.html#4249203">errors</a></span><span class="op" id="4256553">.</span><span class="ident" id="4256554">New</span><span class="op" id="4256557">(</span><span class="string" id="4256558">&#34;crypto/tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;private&nbsp;key&#34;</span><span class="op" id="4256599">)</span><br>
<span class="lineno">275</span><span class="op" id="4256601">}</span>
</div>
</body>
</html>
