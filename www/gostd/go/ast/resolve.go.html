<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html" class="current">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3253290">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3253345">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3253399">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3253450">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;NewPackage.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3253487">package</span>&nbsp;<span class="ident" id="3253495">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3253500">import</span>&nbsp;<span class="op" id="3253507">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3253510">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3253517">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3253531">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3253543">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="3253553">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3253556">type</span>&nbsp;<span class="ident" id="3253561">pkgBuilder</span>&nbsp;<span class="keyword" id="3253572">struct</span>&nbsp;<span class="op" id="3253579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3253582">fset</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3253589">*</span><span class="ident" id="3253590">token</span><span class="op" id="3253595">.</span><span class="ident" id="3253596">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3253605">errors</span>&nbsp;<span class="ident" id="3253612">scanner</span><span class="op" id="3253619">.</span><span class="ident" id="3253620">ErrorList</span><br>
<span class="lineno"></span><span class="op" id="3253630">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3253633">func</span>&nbsp;<span class="op" id="3253638">(</span><span class="ident" id="3253639">p</span>&nbsp;<span class="op" id="3253641">*</span><span class="ident" id="3253642">pkgBuilder</span><span class="op" id="3253652">)</span>&nbsp;<span class="builtintype" id="3253654">error</span><span class="op" id="3253659">(</span><span class="ident" id="3253660">pos</span>&nbsp;<span class="ident" id="3253664">token</span><span class="op" id="3253669">.</span><span class="ident" id="3253670">Pos</span><span class="op" id="3253673">,</span>&nbsp;<span class="ident" id="3253675">msg</span>&nbsp;<span class="builtintype" id="3253679">string</span><span class="op" id="3253685">)</span>&nbsp;<span class="op" id="3253687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3253690">p</span><span class="op" id="3253691">.</span><span class="ident" id="3253692">errors</span><span class="op" id="3253698">.</span><span class="ident" id="3253699">Add</span><span class="op" id="3253702">(</span><span class="ident" id="3253703">p</span><span class="op" id="3253704">.</span><span class="ident" id="3253705">fset</span><span class="op" id="3253709">.</span><span class="ident" id="3253710">Position</span><span class="op" id="3253718">(</span><span class="ident" id="3253719">pos</span><span class="op" id="3253722">)</span><span class="op" id="3253723">,</span>&nbsp;<span class="ident" id="3253725">msg</span><span class="op" id="3253728">)</span><br>
<span class="lineno"></span><span class="op" id="3253730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3253733">func</span>&nbsp;<span class="op" id="3253738">(</span><span class="ident" id="3253739">p</span>&nbsp;<span class="op" id="3253741">*</span><span class="ident" id="3253742">pkgBuilder</span><span class="op" id="3253752">)</span>&nbsp;<span class="ident" id="3253754">errorf</span><span class="op" id="3253760">(</span><span class="ident" id="3253761">pos</span>&nbsp;<span class="ident" id="3253765">token</span><span class="op" id="3253770">.</span><span class="ident" id="3253771">Pos</span><span class="op" id="3253774">,</span>&nbsp;<span class="ident" id="3253776">format</span>&nbsp;<span class="builtintype" id="3253783">string</span><span class="op" id="3253789">,</span>&nbsp;<span class="ident" id="3253791">args</span>&nbsp;<span class="op" id="3253796">...</span><span class="keyword" id="3253799">interface</span><span class="op" id="3253808">{</span><span class="op" id="3253809">}</span><span class="op" id="3253810">)</span>&nbsp;<span class="op" id="3253812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3253815">p</span><span class="op" id="3253816">.</span><span class="builtintype" id="3253817">error</span><span class="op" id="3253822">(</span><span class="ident" id="3253823">pos</span><span class="op" id="3253826">,</span>&nbsp;<span class="ident" id="3253828">fmt</span><span class="op" id="3253831">.</span><span class="ident" id="3253832">Sprintf</span><span class="op" id="3253839">(</span><span class="ident" id="3253840">format</span><span class="op" id="3253846">,</span>&nbsp;<span class="ident" id="3253848">args</span><span class="op" id="3253852">...</span><span class="op" id="3253855">)</span><span class="op" id="3253856">)</span><br>
<span class="lineno"></span><span class="op" id="3253858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3253861">func</span>&nbsp;<span class="op" id="3253866">(</span><span class="ident" id="3253867">p</span>&nbsp;<span class="op" id="3253869">*</span><span class="ident" id="3253870">pkgBuilder</span><span class="op" id="3253880">)</span>&nbsp;<span class="ident" id="3253882">declare</span><span class="op" id="3253889">(</span><span class="ident" id="3253890">scope</span><span class="op" id="3253895">,</span>&nbsp;<span class="ident" id="3253897">altScope</span>&nbsp;<span class="op" id="3253906">*</span><span class="ident" id="3253907">Scope</span><span class="op" id="3253912">,</span>&nbsp;<span class="ident" id="3253914">obj</span>&nbsp;<span class="op" id="3253918">*</span><span class="ident" id="3253919">Object</span><span class="op" id="3253925">)</span>&nbsp;<span class="op" id="3253927">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3253930">alt</span>&nbsp;<span class="op" id="3253934">:=</span>&nbsp;<span class="ident" id="3253937">scope</span><span class="op" id="3253942">.</span><span class="ident" id="3253943">Insert</span><span class="op" id="3253949">(</span><span class="ident" id="3253950">obj</span><span class="op" id="3253953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3253956">if</span>&nbsp;<span class="ident" id="3253959">alt</span>&nbsp;<span class="op" id="3253963">==</span>&nbsp;<span class="builtintype" id="3253966">nil</span>&nbsp;<span class="op" id="3253970">&amp;&amp;</span>&nbsp;<span class="ident" id="3253973">altScope</span>&nbsp;<span class="op" id="3253982">!=</span>&nbsp;<span class="builtintype" id="3253985">nil</span>&nbsp;<span class="op" id="3253989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3253993">//&nbsp;see&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;conflicting&nbsp;declaration&nbsp;in&nbsp;altScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3254052">alt</span>&nbsp;<span class="op" id="3254056">=</span>&nbsp;<span class="ident" id="3254058">altScope</span><span class="op" id="3254066">.</span><span class="ident" id="3254067">Lookup</span><span class="op" id="3254073">(</span><span class="ident" id="3254074">obj</span><span class="op" id="3254077">.</span><span class="ident" id="3254078">Name</span><span class="op" id="3254082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3254085">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3254088">if</span>&nbsp;<span class="ident" id="3254091">alt</span>&nbsp;<span class="op" id="3254095">!=</span>&nbsp;<span class="builtintype" id="3254098">nil</span>&nbsp;<span class="op" id="3254102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3254106">prevDecl</span>&nbsp;<span class="op" id="3254115">:=</span>&nbsp;<span class="string" id="3254118">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3254123">if</span>&nbsp;<span class="ident" id="3254126">pos</span>&nbsp;<span class="op" id="3254130">:=</span>&nbsp;<span class="ident" id="3254133">alt</span><span class="op" id="3254136">.</span><span class="ident" id="3254137">Pos</span><span class="op" id="3254140">(</span><span class="op" id="3254141">)</span><span class="op" id="3254142">;</span>&nbsp;<span class="ident" id="3254144">pos</span><span class="op" id="3254147">.</span><span class="ident" id="3254148">IsValid</span><span class="op" id="3254155">(</span><span class="op" id="3254156">)</span>&nbsp;<span class="op" id="3254158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3254163">prevDecl</span>&nbsp;<span class="op" id="3254172">=</span>&nbsp;<span class="ident" id="3254174">fmt</span><span class="op" id="3254177">.</span><span class="ident" id="3254178">Sprintf</span><span class="op" id="3254185">(</span><span class="string" id="3254186">&#34;\n\tprevious&nbsp;declaration&nbsp;at&nbsp;%s&#34;</span><span class="op" id="3254218">,</span>&nbsp;<span class="ident" id="3254220">p</span><span class="op" id="3254221">.</span><span class="ident" id="3254222">fset</span><span class="op" id="3254226">.</span><span class="ident" id="3254227">Position</span><span class="op" id="3254235">(</span><span class="ident" id="3254236">pos</span><span class="op" id="3254239">)</span><span class="op" id="3254240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3254244">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3254248">p</span><span class="op" id="3254249">.</span><span class="builtintype" id="3254250">error</span><span class="op" id="3254255">(</span><span class="ident" id="3254256">obj</span><span class="op" id="3254259">.</span><span class="ident" id="3254260">Pos</span><span class="op" id="3254263">(</span><span class="op" id="3254264">)</span><span class="op" id="3254265">,</span>&nbsp;<span class="ident" id="3254267">fmt</span><span class="op" id="3254270">.</span><span class="ident" id="3254271">Sprintf</span><span class="op" id="3254278">(</span><span class="string" id="3254279">&#34;%s&nbsp;redeclared&nbsp;in&nbsp;this&nbsp;block%s&#34;</span><span class="op" id="3254310">,</span>&nbsp;<span class="ident" id="3254312">obj</span><span class="op" id="3254315">.</span><span class="ident" id="3254316">Name</span><span class="op" id="3254320">,</span>&nbsp;<span class="ident" id="3254322">prevDecl</span><span class="op" id="3254330">)</span><span class="op" id="3254331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3254334">}</span><br>
<span class="lineno"></span><span class="op" id="3254336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3254339">func</span>&nbsp;<span class="ident" id="3254344">resolve</span><span class="op" id="3254351">(</span><span class="ident" id="3254352">scope</span>&nbsp;<span class="op" id="3254358">*</span><span class="ident" id="3254359">Scope</span><span class="op" id="3254364">,</span>&nbsp;<span class="ident" id="3254366">ident</span>&nbsp;<span class="op" id="3254372">*</span><span class="ident" id="3254373">Ident</span><span class="op" id="3254378">)</span>&nbsp;<span class="builtintype" id="3254380">bool</span>&nbsp;<span class="op" id="3254385">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3254388">for</span>&nbsp;<span class="op" id="3254392">;</span>&nbsp;<span class="ident" id="3254394">scope</span>&nbsp;<span class="op" id="3254400">!=</span>&nbsp;<span class="builtintype" id="3254403">nil</span><span class="op" id="3254406">;</span>&nbsp;<span class="ident" id="3254408">scope</span>&nbsp;<span class="op" id="3254414">=</span>&nbsp;<span class="ident" id="3254416">scope</span><span class="op" id="3254421">.</span><span class="ident" id="3254422">Outer</span>&nbsp;<span class="op" id="3254428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3254432">if</span>&nbsp;<span class="ident" id="3254435">obj</span>&nbsp;<span class="op" id="3254439">:=</span>&nbsp;<span class="ident" id="3254442">scope</span><span class="op" id="3254447">.</span><span class="ident" id="3254448">Lookup</span><span class="op" id="3254454">(</span><span class="ident" id="3254455">ident</span><span class="op" id="3254460">.</span><span class="ident" id="3254461">Name</span><span class="op" id="3254465">)</span><span class="op" id="3254466">;</span>&nbsp;<span class="ident" id="3254468">obj</span>&nbsp;<span class="op" id="3254472">!=</span>&nbsp;<span class="builtintype" id="3254475">nil</span>&nbsp;<span class="op" id="3254479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3254484">ident</span><span class="op" id="3254489">.</span><span class="ident" id="3254490">Obj</span>&nbsp;<span class="op" id="3254494">=</span>&nbsp;<span class="ident" id="3254496">obj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3254503">return</span>&nbsp;<span class="builtintype" id="3254510">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3254517">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3254520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3254523">return</span>&nbsp;<span class="builtintype" id="3254530">false</span><br>
<span class="lineno"></span><span class="op" id="3254536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3254539">//&nbsp;An&nbsp;Importer&nbsp;resolves&nbsp;import&nbsp;paths&nbsp;to&nbsp;package&nbsp;Objects.</span><br>
<span class="lineno">55</span><span class="comment" id="3254596">//&nbsp;The&nbsp;imports&nbsp;map&nbsp;records&nbsp;the&nbsp;packages&nbsp;already&nbsp;imported,</span><br>
<span class="lineno"></span><span class="comment" id="3254654">//&nbsp;indexed&nbsp;by&nbsp;package&nbsp;id&nbsp;(canonical&nbsp;import&nbsp;path).</span><br>
<span class="lineno"></span><span class="comment" id="3254704">//&nbsp;An&nbsp;Importer&nbsp;must&nbsp;determine&nbsp;the&nbsp;canonical&nbsp;import&nbsp;path&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3254764">//&nbsp;check&nbsp;the&nbsp;map&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;is&nbsp;already&nbsp;present&nbsp;in&nbsp;the&nbsp;imports&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="3254833">//&nbsp;If&nbsp;so,&nbsp;the&nbsp;Importer&nbsp;can&nbsp;return&nbsp;the&nbsp;map&nbsp;entry.&nbsp;&nbsp;Otherwise,&nbsp;the</span><br>
<span class="lineno">60</span><span class="comment" id="3254898">//&nbsp;Importer&nbsp;should&nbsp;load&nbsp;the&nbsp;package&nbsp;data&nbsp;for&nbsp;the&nbsp;given&nbsp;path&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="3254963">//&nbsp;a&nbsp;new&nbsp;*Object&nbsp;(pkg),&nbsp;record&nbsp;pkg&nbsp;in&nbsp;the&nbsp;imports&nbsp;map,&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="3255027">//&nbsp;return&nbsp;pkg.</span><br>
<span class="lineno"></span><span class="keyword" id="3255042">type</span>&nbsp;<span class="ident" id="3255047">Importer</span>&nbsp;<span class="keyword" id="3255056">func</span><span class="op" id="3255060">(</span><span class="ident" id="3255061">imports</span>&nbsp;<span class="keyword" id="3255069">map</span><span class="op" id="3255072">[</span><span class="builtintype" id="3255073">string</span><span class="op" id="3255079">]</span><span class="op" id="3255080">*</span><span class="ident" id="3255081">Object</span><span class="op" id="3255087">,</span>&nbsp;<span class="ident" id="3255089">path</span>&nbsp;<span class="builtintype" id="3255094">string</span><span class="op" id="3255100">)</span>&nbsp;<span class="op" id="3255102">(</span><span class="ident" id="3255103">pkg</span>&nbsp;<span class="op" id="3255107">*</span><span class="ident" id="3255108">Object</span><span class="op" id="3255114">,</span>&nbsp;<span class="ident" id="3255116">err</span>&nbsp;<span class="builtintype" id="3255120">error</span><span class="op" id="3255125">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3255128">//&nbsp;NewPackage&nbsp;creates&nbsp;a&nbsp;new&nbsp;Package&nbsp;node&nbsp;from&nbsp;a&nbsp;set&nbsp;of&nbsp;File&nbsp;nodes.&nbsp;It&nbsp;resolves</span><br>
<span class="lineno"></span><span class="comment" id="3255207">//&nbsp;unresolved&nbsp;identifiers&nbsp;across&nbsp;files&nbsp;and&nbsp;updates&nbsp;each&nbsp;file&#39;s&nbsp;Unresolved&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="3255286">//&nbsp;accordingly.&nbsp;If&nbsp;a&nbsp;non-nil&nbsp;importer&nbsp;and&nbsp;universe&nbsp;scope&nbsp;are&nbsp;provided,&nbsp;they&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3255366">//&nbsp;used&nbsp;to&nbsp;resolve&nbsp;identifiers&nbsp;not&nbsp;declared&nbsp;in&nbsp;any&nbsp;of&nbsp;the&nbsp;package&nbsp;files.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="3255443">//&nbsp;remaining&nbsp;unresolved&nbsp;identifiers&nbsp;are&nbsp;reported&nbsp;as&nbsp;undeclared.&nbsp;If&nbsp;the&nbsp;files</span><br>
<span class="lineno">70</span><span class="comment" id="3255520">//&nbsp;belong&nbsp;to&nbsp;different&nbsp;packages,&nbsp;one&nbsp;package&nbsp;name&nbsp;is&nbsp;selected&nbsp;and&nbsp;files&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3255597">//&nbsp;different&nbsp;package&nbsp;names&nbsp;are&nbsp;reported&nbsp;and&nbsp;then&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3255655">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;package&nbsp;node&nbsp;and&nbsp;a&nbsp;scanner.ErrorList&nbsp;if&nbsp;there&nbsp;were&nbsp;errors.</span><br>
<span class="lineno"></span><span class="comment" id="3255733">//</span><br>
<span class="lineno"></span><span class="keyword" id="3255736">func</span>&nbsp;<span class="ident" id="3255741">NewPackage</span><span class="op" id="3255751">(</span><span class="ident" id="3255752">fset</span>&nbsp;<span class="op" id="3255757">*</span><span class="ident" id="3255758">token</span><span class="op" id="3255763">.</span><span class="ident" id="3255764">FileSet</span><span class="op" id="3255771">,</span>&nbsp;<span class="ident" id="3255773">files</span>&nbsp;<span class="keyword" id="3255779">map</span><span class="op" id="3255782">[</span><span class="builtintype" id="3255783">string</span><span class="op" id="3255789">]</span><span class="op" id="3255790">*</span><span class="ident" id="3255791">File</span><span class="op" id="3255795">,</span>&nbsp;<span class="ident" id="3255797">importer</span>&nbsp;<span class="ident" id="3255806">Importer</span><span class="op" id="3255814">,</span>&nbsp;<span class="ident" id="3255816">universe</span>&nbsp;<span class="op" id="3255825">*</span><span class="ident" id="3255826">Scope</span><span class="op" id="3255831">)</span>&nbsp;<span class="op" id="3255833">(</span><span class="op" id="3255834">*</span><span class="ident" id="3255835">Package</span><span class="op" id="3255842">,</span>&nbsp;<span class="builtintype" id="3255844">error</span><span class="op" id="3255849">)</span>&nbsp;<span class="op" id="3255851">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3255854">var</span>&nbsp;<span class="ident" id="3255858">p</span>&nbsp;<span class="ident" id="3255860">pkgBuilder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3255872">p</span><span class="op" id="3255873">.</span><span class="ident" id="3255874">fset</span>&nbsp;<span class="op" id="3255879">=</span>&nbsp;<span class="ident" id="3255881">fset</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3255888">//&nbsp;complete&nbsp;package&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3255915">pkgName</span>&nbsp;<span class="op" id="3255923">:=</span>&nbsp;<span class="string" id="3255926">&#34;&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3255930">pkgScope</span>&nbsp;<span class="op" id="3255939">:=</span>&nbsp;<span class="ident" id="3255942">NewScope</span><span class="op" id="3255950">(</span><span class="ident" id="3255951">universe</span><span class="op" id="3255959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3255962">for</span>&nbsp;<span class="ident" id="3255966">_</span><span class="op" id="3255967">,</span>&nbsp;<span class="ident" id="3255969">file</span>&nbsp;<span class="op" id="3255974">:=</span>&nbsp;<span class="keyword" id="3255977">range</span>&nbsp;<span class="ident" id="3255983">files</span>&nbsp;<span class="op" id="3255989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3255993">//&nbsp;package&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3256023">switch</span>&nbsp;<span class="ident" id="3256030">name</span>&nbsp;<span class="op" id="3256035">:=</span>&nbsp;<span class="ident" id="3256038">file</span><span class="op" id="3256042">.</span><span class="ident" id="3256043">Name</span><span class="op" id="3256047">.</span><span class="ident" id="3256048">Name</span><span class="op" id="3256052">;</span>&nbsp;<span class="op" id="3256054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3256058">case</span>&nbsp;<span class="ident" id="3256063">pkgName</span>&nbsp;<span class="op" id="3256071">==</span>&nbsp;<span class="string" id="3256074">&#34;&#34;</span><span class="op" id="3256076">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3256081">pkgName</span>&nbsp;<span class="op" id="3256089">=</span>&nbsp;<span class="ident" id="3256091">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3256098">case</span>&nbsp;<span class="ident" id="3256103">name</span>&nbsp;<span class="op" id="3256108">!=</span>&nbsp;<span class="ident" id="3256111">pkgName</span><span class="op" id="3256118">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3256123">p</span><span class="op" id="3256124">.</span><span class="ident" id="3256125">errorf</span><span class="op" id="3256131">(</span><span class="ident" id="3256132">file</span><span class="op" id="3256136">.</span><span class="ident" id="3256137">Package</span><span class="op" id="3256144">,</span>&nbsp;<span class="string" id="3256146">&#34;package&nbsp;%s;&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="3256171">,</span>&nbsp;<span class="ident" id="3256173">name</span><span class="op" id="3256177">,</span>&nbsp;<span class="ident" id="3256179">pkgName</span><span class="op" id="3256186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3256191">continue</span>&nbsp;<span class="comment" id="3256200">//&nbsp;ignore&nbsp;this&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3256222">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3256227">//&nbsp;collect&nbsp;top-level&nbsp;file&nbsp;objects&nbsp;in&nbsp;package&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3256280">for</span>&nbsp;<span class="ident" id="3256284">_</span><span class="op" id="3256285">,</span>&nbsp;<span class="ident" id="3256287">obj</span>&nbsp;<span class="op" id="3256291">:=</span>&nbsp;<span class="keyword" id="3256294">range</span>&nbsp;<span class="ident" id="3256300">file</span><span class="op" id="3256304">.</span><span class="ident" id="3256305">Scope</span><span class="op" id="3256310">.</span><span class="ident" id="3256311">Objects</span>&nbsp;<span class="op" id="3256319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3256324">p</span><span class="op" id="3256325">.</span><span class="ident" id="3256326">declare</span><span class="op" id="3256333">(</span><span class="ident" id="3256334">pkgScope</span><span class="op" id="3256342">,</span>&nbsp;<span class="builtintype" id="3256344">nil</span><span class="op" id="3256347">,</span>&nbsp;<span class="ident" id="3256349">obj</span><span class="op" id="3256352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3256356">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3256359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3256363">//&nbsp;package&nbsp;global&nbsp;mapping&nbsp;of&nbsp;imported&nbsp;package&nbsp;ids&nbsp;to&nbsp;package&nbsp;objects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3256433">imports</span>&nbsp;<span class="op" id="3256441">:=</span>&nbsp;<span class="builtinfunc" id="3256444">make</span><span class="op" id="3256448">(</span><span class="keyword" id="3256449">map</span><span class="op" id="3256452">[</span><span class="builtintype" id="3256453">string</span><span class="op" id="3256459">]</span><span class="op" id="3256460">*</span><span class="ident" id="3256461">Object</span><span class="op" id="3256467">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3256471">//&nbsp;complete&nbsp;file&nbsp;scopes&nbsp;with&nbsp;imports&nbsp;and&nbsp;resolve&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3256533">for</span>&nbsp;<span class="ident" id="3256537">_</span><span class="op" id="3256538">,</span>&nbsp;<span class="ident" id="3256540">file</span>&nbsp;<span class="op" id="3256545">:=</span>&nbsp;<span class="keyword" id="3256548">range</span>&nbsp;<span class="ident" id="3256554">files</span>&nbsp;<span class="op" id="3256560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3256564">//&nbsp;ignore&nbsp;file&nbsp;if&nbsp;it&nbsp;belongs&nbsp;to&nbsp;a&nbsp;different&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3256618">//&nbsp;(error&nbsp;has&nbsp;already&nbsp;been&nbsp;reported)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3256657">if</span>&nbsp;<span class="ident" id="3256660">file</span><span class="op" id="3256664">.</span><span class="ident" id="3256665">Name</span><span class="op" id="3256669">.</span><span class="ident" id="3256670">Name</span>&nbsp;<span class="op" id="3256675">!=</span>&nbsp;<span class="ident" id="3256678">pkgName</span>&nbsp;<span class="op" id="3256686">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3256691">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3256702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3256707">//&nbsp;build&nbsp;file&nbsp;scope&nbsp;by&nbsp;processing&nbsp;all&nbsp;imports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3256755">importErrors</span>&nbsp;<span class="op" id="3256768">:=</span>&nbsp;<span class="builtintype" id="3256771">false</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3256779">fileScope</span>&nbsp;<span class="op" id="3256789">:=</span>&nbsp;<span class="ident" id="3256792">NewScope</span><span class="op" id="3256800">(</span><span class="ident" id="3256801">pkgScope</span><span class="op" id="3256809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3256813">for</span>&nbsp;<span class="ident" id="3256817">_</span><span class="op" id="3256818">,</span>&nbsp;<span class="ident" id="3256820">spec</span>&nbsp;<span class="op" id="3256825">:=</span>&nbsp;<span class="keyword" id="3256828">range</span>&nbsp;<span class="ident" id="3256834">file</span><span class="op" id="3256838">.</span><span class="ident" id="3256839">Imports</span>&nbsp;<span class="op" id="3256847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3256852">if</span>&nbsp;<span class="ident" id="3256855">importer</span>&nbsp;<span class="op" id="3256864">==</span>&nbsp;<span class="builtintype" id="3256867">nil</span>&nbsp;<span class="op" id="3256871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3256877">importErrors</span>&nbsp;<span class="op" id="3256890">=</span>&nbsp;<span class="builtintype" id="3256892">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3256901">continue</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3256913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3256918">path</span><span class="op" id="3256922">,</span>&nbsp;<span class="ident" id="3256924">_</span>&nbsp;<span class="op" id="3256926">:=</span>&nbsp;<span class="ident" id="3256929">strconv</span><span class="op" id="3256936">.</span><span class="ident" id="3256937">Unquote</span><span class="op" id="3256944">(</span><span class="ident" id="3256945">spec</span><span class="op" id="3256949">.</span><span class="ident" id="3256950">Path</span><span class="op" id="3256954">.</span><span class="ident" id="3256955">Value</span><span class="op" id="3256960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3256965">pkg</span><span class="op" id="3256968">,</span>&nbsp;<span class="ident" id="3256970">err</span>&nbsp;<span class="op" id="3256974">:=</span>&nbsp;<span class="ident" id="3256977">importer</span><span class="op" id="3256985">(</span><span class="ident" id="3256986">imports</span><span class="op" id="3256993">,</span>&nbsp;<span class="ident" id="3256995">path</span><span class="op" id="3256999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257004">if</span>&nbsp;<span class="ident" id="3257007">err</span>&nbsp;<span class="op" id="3257011">!=</span>&nbsp;<span class="builtintype" id="3257014">nil</span>&nbsp;<span class="op" id="3257018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257024">p</span><span class="op" id="3257025">.</span><span class="ident" id="3257026">errorf</span><span class="op" id="3257032">(</span><span class="ident" id="3257033">spec</span><span class="op" id="3257037">.</span><span class="ident" id="3257038">Path</span><span class="op" id="3257042">.</span><span class="ident" id="3257043">Pos</span><span class="op" id="3257046">(</span><span class="op" id="3257047">)</span><span class="op" id="3257048">,</span>&nbsp;<span class="string" id="3257050">&#34;could&nbsp;not&nbsp;import&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="3257076">,</span>&nbsp;<span class="ident" id="3257078">path</span><span class="op" id="3257082">,</span>&nbsp;<span class="ident" id="3257084">err</span><span class="op" id="3257087">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257093">importErrors</span>&nbsp;<span class="op" id="3257106">=</span>&nbsp;<span class="builtintype" id="3257108">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257117">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3257129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3257134">//&nbsp;TODO(gri)&nbsp;If&nbsp;a&nbsp;local&nbsp;package&nbsp;name&nbsp;!=&nbsp;&#34;.&#34;&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3257194">//&nbsp;global&nbsp;identifier&nbsp;resolution&nbsp;could&nbsp;proceed&nbsp;even&nbsp;if&nbsp;the</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3257255">//&nbsp;import&nbsp;failed.&nbsp;Consider&nbsp;adjusting&nbsp;the&nbsp;logic&nbsp;here&nbsp;a&nbsp;bit.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3257318">//&nbsp;local&nbsp;name&nbsp;overrides&nbsp;imported&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257367">name</span>&nbsp;<span class="op" id="3257372">:=</span>&nbsp;<span class="ident" id="3257375">pkg</span><span class="op" id="3257378">.</span><span class="ident" id="3257379">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257387">if</span>&nbsp;<span class="ident" id="3257390">spec</span><span class="op" id="3257394">.</span><span class="ident" id="3257395">Name</span>&nbsp;<span class="op" id="3257400">!=</span>&nbsp;<span class="builtintype" id="3257403">nil</span>&nbsp;<span class="op" id="3257407">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257413">name</span>&nbsp;<span class="op" id="3257418">=</span>&nbsp;<span class="ident" id="3257420">spec</span><span class="op" id="3257424">.</span><span class="ident" id="3257425">Name</span><span class="op" id="3257429">.</span><span class="ident" id="3257430">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3257438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3257444">//&nbsp;add&nbsp;import&nbsp;to&nbsp;file&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257475">if</span>&nbsp;<span class="ident" id="3257478">name</span>&nbsp;<span class="op" id="3257483">==</span>&nbsp;<span class="string" id="3257486">&#34;.&#34;</span>&nbsp;<span class="op" id="3257490">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3257496">//&nbsp;merge&nbsp;imported&nbsp;scope&nbsp;with&nbsp;file&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257540">for</span>&nbsp;<span class="ident" id="3257544">_</span><span class="op" id="3257545">,</span>&nbsp;<span class="ident" id="3257547">obj</span>&nbsp;<span class="op" id="3257551">:=</span>&nbsp;<span class="keyword" id="3257554">range</span>&nbsp;<span class="ident" id="3257560">pkg</span><span class="op" id="3257563">.</span><span class="ident" id="3257564">Data</span><span class="op" id="3257568">.</span><span class="op" id="3257569">(</span><span class="op" id="3257570">*</span><span class="ident" id="3257571">Scope</span><span class="op" id="3257576">)</span><span class="op" id="3257577">.</span><span class="ident" id="3257578">Objects</span>&nbsp;<span class="op" id="3257586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257593">p</span><span class="op" id="3257594">.</span><span class="ident" id="3257595">declare</span><span class="op" id="3257602">(</span><span class="ident" id="3257603">fileScope</span><span class="op" id="3257612">,</span>&nbsp;<span class="ident" id="3257614">pkgScope</span><span class="op" id="3257622">,</span>&nbsp;<span class="ident" id="3257624">obj</span><span class="op" id="3257627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3257633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3257638">}</span>&nbsp;<span class="keyword" id="3257640">else</span>&nbsp;<span class="keyword" id="3257645">if</span>&nbsp;<span class="ident" id="3257648">name</span>&nbsp;<span class="op" id="3257653">!=</span>&nbsp;<span class="string" id="3257656">&#34;_&#34;</span>&nbsp;<span class="op" id="3257660">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3257666">//&nbsp;declare&nbsp;imported&nbsp;package&nbsp;object&nbsp;in&nbsp;file&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3257719">//&nbsp;(do&nbsp;not&nbsp;re-use&nbsp;pkg&nbsp;in&nbsp;the&nbsp;file&nbsp;scope&nbsp;but&nbsp;create</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3257774">//&nbsp;a&nbsp;new&nbsp;object&nbsp;instead;&nbsp;the&nbsp;Decl&nbsp;field&nbsp;is&nbsp;different</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3257831">//&nbsp;for&nbsp;different&nbsp;files)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257859">obj</span>&nbsp;<span class="op" id="3257863">:=</span>&nbsp;<span class="ident" id="3257866">NewObj</span><span class="op" id="3257872">(</span><span class="ident" id="3257873">Pkg</span><span class="op" id="3257876">,</span>&nbsp;<span class="ident" id="3257878">name</span><span class="op" id="3257882">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257888">obj</span><span class="op" id="3257891">.</span><span class="ident" id="3257892">Decl</span>&nbsp;<span class="op" id="3257897">=</span>&nbsp;<span class="ident" id="3257899">spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257908">obj</span><span class="op" id="3257911">.</span><span class="ident" id="3257912">Data</span>&nbsp;<span class="op" id="3257917">=</span>&nbsp;<span class="ident" id="3257919">pkg</span><span class="op" id="3257922">.</span><span class="ident" id="3257923">Data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257932">p</span><span class="op" id="3257933">.</span><span class="ident" id="3257934">declare</span><span class="op" id="3257941">(</span><span class="ident" id="3257942">fileScope</span><span class="op" id="3257951">,</span>&nbsp;<span class="ident" id="3257953">pkgScope</span><span class="op" id="3257961">,</span>&nbsp;<span class="ident" id="3257963">obj</span><span class="op" id="3257966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3257971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3257975">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3257980">//&nbsp;resolve&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258005">if</span>&nbsp;<span class="ident" id="3258008">importErrors</span>&nbsp;<span class="op" id="3258021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3258026">//&nbsp;don&#39;t&nbsp;use&nbsp;the&nbsp;universe&nbsp;scope&nbsp;without&nbsp;correct&nbsp;imports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3258085">//&nbsp;(objects&nbsp;in&nbsp;the&nbsp;universe&nbsp;may&nbsp;be&nbsp;shadowed&nbsp;by&nbsp;imports;</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3258144">//&nbsp;with&nbsp;missing&nbsp;imports,&nbsp;identifiers&nbsp;might&nbsp;get&nbsp;resolved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3258203">//&nbsp;incorrectly&nbsp;to&nbsp;universe&nbsp;objects)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258242">pkgScope</span><span class="op" id="3258250">.</span><span class="ident" id="3258251">Outer</span>&nbsp;<span class="op" id="3258257">=</span>&nbsp;<span class="builtintype" id="3258259">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3258265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258269">i</span>&nbsp;<span class="op" id="3258271">:=</span>&nbsp;<span class="num" id="3258274">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258278">for</span>&nbsp;<span class="ident" id="3258282">_</span><span class="op" id="3258283">,</span>&nbsp;<span class="ident" id="3258285">ident</span>&nbsp;<span class="op" id="3258291">:=</span>&nbsp;<span class="keyword" id="3258294">range</span>&nbsp;<span class="ident" id="3258300">file</span><span class="op" id="3258304">.</span><span class="ident" id="3258305">Unresolved</span>&nbsp;<span class="op" id="3258316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258321">if</span>&nbsp;<span class="op" id="3258324">!</span><span class="ident" id="3258325">resolve</span><span class="op" id="3258332">(</span><span class="ident" id="3258333">fileScope</span><span class="op" id="3258342">,</span>&nbsp;<span class="ident" id="3258344">ident</span><span class="op" id="3258349">)</span>&nbsp;<span class="op" id="3258351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258357">p</span><span class="op" id="3258358">.</span><span class="ident" id="3258359">errorf</span><span class="op" id="3258365">(</span><span class="ident" id="3258366">ident</span><span class="op" id="3258371">.</span><span class="ident" id="3258372">Pos</span><span class="op" id="3258375">(</span><span class="op" id="3258376">)</span><span class="op" id="3258377">,</span>&nbsp;<span class="string" id="3258379">&#34;undeclared&nbsp;name:&nbsp;%s&#34;</span><span class="op" id="3258400">,</span>&nbsp;<span class="ident" id="3258402">ident</span><span class="op" id="3258407">.</span><span class="ident" id="3258408">Name</span><span class="op" id="3258412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258418">file</span><span class="op" id="3258422">.</span><span class="ident" id="3258423">Unresolved</span><span class="op" id="3258433">[</span><span class="ident" id="3258434">i</span><span class="op" id="3258435">]</span>&nbsp;<span class="op" id="3258437">=</span>&nbsp;<span class="ident" id="3258439">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258449">i</span><span class="op" id="3258450">++</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3258456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3258461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258465">file</span><span class="op" id="3258469">.</span><span class="ident" id="3258470">Unresolved</span>&nbsp;<span class="op" id="3258481">=</span>&nbsp;<span class="ident" id="3258483">file</span><span class="op" id="3258487">.</span><span class="ident" id="3258488">Unresolved</span><span class="op" id="3258498">[</span><span class="num" id="3258499">0</span><span class="op" id="3258500">:</span><span class="ident" id="3258501">i</span><span class="op" id="3258502">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258506">pkgScope</span><span class="op" id="3258514">.</span><span class="ident" id="3258515">Outer</span>&nbsp;<span class="op" id="3258521">=</span>&nbsp;<span class="ident" id="3258523">universe</span>&nbsp;<span class="comment" id="3258532">//&nbsp;reset&nbsp;universe&nbsp;scope</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3258557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258561">p</span><span class="op" id="3258562">.</span><span class="ident" id="3258563">errors</span><span class="op" id="3258569">.</span><span class="ident" id="3258570">Sort</span><span class="op" id="3258574">(</span><span class="op" id="3258575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258578">return</span>&nbsp;<span class="op" id="3258585">&amp;</span><span class="ident" id="3258586">Package</span><span class="op" id="3258593">{</span><span class="ident" id="3258594">pkgName</span><span class="op" id="3258601">,</span>&nbsp;<span class="ident" id="3258603">pkgScope</span><span class="op" id="3258611">,</span>&nbsp;<span class="ident" id="3258613">imports</span><span class="op" id="3258620">,</span>&nbsp;<span class="ident" id="3258622">files</span><span class="op" id="3258627">}</span><span class="op" id="3258628">,</span>&nbsp;<span class="ident" id="3258630">p</span><span class="op" id="3258631">.</span><span class="ident" id="3258632">errors</span><span class="op" id="3258638">.</span><span class="ident" id="3258639">Err</span><span class="op" id="3258642">(</span><span class="op" id="3258643">)</span><br>
<span class="lineno"></span><span class="op" id="3258645">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
