<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/xml</h2>
<ul>
<li><a href="/gostd/encoding/xml/atom_test.go.html">atom_test.go</a></li>
<li><a href="/gostd/encoding/xml/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/xml/marshal.go.html">marshal.go</a></li>
<li><a href="/gostd/encoding/xml/marshal_test.go.html">marshal_test.go</a></li>
<li><a href="/gostd/encoding/xml/read.go.html">read.go</a></li>
<li><a href="/gostd/encoding/xml/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/encoding/xml/typeinfo.go.html">typeinfo.go</a></li>
<li><a href="/gostd/encoding/xml/xml.go.html">xml.go</a></li>
<li><a href="/gostd/encoding/xml/xml_test.go.html">xml_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6120338">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6120394">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6120448">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6120499">package</span>&nbsp;<span class="ident" id="6120507">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6120512">import</span>&nbsp;<span class="op" id="6120519">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6120522">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6120529">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6120540">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6120551">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6120558">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6120561">//&nbsp;typeInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;type.</span><br>
<span class="lineno">15</span><span class="keyword" id="6120625">type</span>&nbsp;<span class="ident" id="6120630">typeInfo</span>&nbsp;<span class="keyword" id="6120639">struct</span>&nbsp;<span class="op" id="6120646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120649">xmlname</span>&nbsp;<span class="op" id="6120657">*</span><span class="ident" id="6120658">fieldInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120669">fields</span>&nbsp;&nbsp;<span class="op" id="6120677">[</span><span class="op" id="6120678">]</span><span class="ident" id="6120679">fieldInfo</span><br>
<span class="lineno"></span><span class="op" id="6120689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="6120692">//&nbsp;fieldInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="6120765">type</span>&nbsp;<span class="ident" id="6120770">fieldInfo</span>&nbsp;<span class="keyword" id="6120780">struct</span>&nbsp;<span class="op" id="6120787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120790">idx</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6120798">[</span><span class="op" id="6120799">]</span><span class="builtintype" id="6120800">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120805">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6120813">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120821">xmlns</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6120829">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120837">flags</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6120845">fieldFlags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120857">parents</span>&nbsp;<span class="op" id="6120865">[</span><span class="op" id="6120866">]</span><span class="builtintype" id="6120867">string</span><br>
<span class="lineno"></span><span class="op" id="6120874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6120877">type</span>&nbsp;<span class="ident" id="6120882">fieldFlags</span>&nbsp;<span class="builtintype" id="6120893">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="6120898">const</span>&nbsp;<span class="op" id="6120904">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120907">fElement</span>&nbsp;<span class="ident" id="6120916">fieldFlags</span>&nbsp;<span class="op" id="6120927">=</span>&nbsp;<span class="num" id="6120929">1</span>&nbsp;<span class="op" id="6120931">&lt;&lt;</span>&nbsp;<span class="ident" id="6120934">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120940">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120947">fCharData</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120958">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120969">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120979">fAny</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120986">fOmitEmpty</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120999">fMode</span>&nbsp;<span class="op" id="6121005">=</span>&nbsp;<span class="ident" id="6121007">fElement</span>&nbsp;<span class="op" id="6121016">|</span>&nbsp;<span class="ident" id="6121018">fAttr</span>&nbsp;<span class="op" id="6121024">|</span>&nbsp;<span class="ident" id="6121026">fCharData</span>&nbsp;<span class="op" id="6121036">|</span>&nbsp;<span class="ident" id="6121038">fInnerXml</span>&nbsp;<span class="op" id="6121048">|</span>&nbsp;<span class="ident" id="6121050">fComment</span>&nbsp;<span class="op" id="6121059">|</span>&nbsp;<span class="ident" id="6121061">fAny</span><br>
<span class="lineno"></span><span class="op" id="6121066">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6121069">var</span>&nbsp;<span class="ident" id="6121073">tinfoMap</span>&nbsp;<span class="op" id="6121082">=</span>&nbsp;<span class="builtinfunc" id="6121084">make</span><span class="op" id="6121088">(</span><span class="keyword" id="6121089">map</span><span class="op" id="6121092">[</span><span class="ident" id="6121093">reflect</span><span class="op" id="6121100">.</span><span class="ident" id="6121101">Type</span><span class="op" id="6121105">]</span><span class="op" id="6121106">*</span><span class="ident" id="6121107">typeInfo</span><span class="op" id="6121115">)</span><br>
<span class="lineno">45</span><span class="keyword" id="6121117">var</span>&nbsp;<span class="ident" id="6121121">tinfoLock</span>&nbsp;<span class="ident" id="6121131">sync</span><span class="op" id="6121135">.</span><span class="ident" id="6121136">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6121145">var</span>&nbsp;<span class="ident" id="6121149">nameType</span>&nbsp;<span class="op" id="6121158">=</span>&nbsp;<span class="ident" id="6121160">reflect</span><span class="op" id="6121167">.</span><span class="ident" id="6121168">TypeOf</span><span class="op" id="6121174">(</span><span class="ident" id="6121175">Name</span><span class="op" id="6121179">{</span><span class="op" id="6121180">}</span><span class="op" id="6121181">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6121184">//&nbsp;getTypeInfo&nbsp;returns&nbsp;the&nbsp;typeInfo&nbsp;structure&nbsp;with&nbsp;details&nbsp;necessary</span><br>
<span class="lineno">50</span><span class="comment" id="6121253">//&nbsp;for&nbsp;marshalling&nbsp;and&nbsp;unmarshalling&nbsp;typ.</span><br>
<span class="lineno"></span><span class="keyword" id="6121295">func</span>&nbsp;<span class="ident" id="6121300">getTypeInfo</span><span class="op" id="6121311">(</span><span class="ident" id="6121312">typ</span>&nbsp;<span class="ident" id="6121316">reflect</span><span class="op" id="6121323">.</span><span class="ident" id="6121324">Type</span><span class="op" id="6121328">)</span>&nbsp;<span class="op" id="6121330">(</span><span class="op" id="6121331">*</span><span class="ident" id="6121332">typeInfo</span><span class="op" id="6121340">,</span>&nbsp;<span class="builtintype" id="6121342">error</span><span class="op" id="6121347">)</span>&nbsp;<span class="op" id="6121349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6121352">tinfoLock</span><span class="op" id="6121361">.</span><span class="ident" id="6121362">RLock</span><span class="op" id="6121367">(</span><span class="op" id="6121368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6121371">tinfo</span><span class="op" id="6121376">,</span>&nbsp;<span class="ident" id="6121378">ok</span>&nbsp;<span class="op" id="6121381">:=</span>&nbsp;<span class="ident" id="6121384">tinfoMap</span><span class="op" id="6121392">[</span><span class="ident" id="6121393">typ</span><span class="op" id="6121396">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6121399">tinfoLock</span><span class="op" id="6121408">.</span><span class="ident" id="6121409">RUnlock</span><span class="op" id="6121416">(</span><span class="op" id="6121417">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6121420">if</span>&nbsp;<span class="ident" id="6121423">ok</span>&nbsp;<span class="op" id="6121426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6121430">return</span>&nbsp;<span class="ident" id="6121437">tinfo</span><span class="op" id="6121442">,</span>&nbsp;<span class="ident" id="6121444">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6121449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6121452">tinfo</span>&nbsp;<span class="op" id="6121458">=</span>&nbsp;<span class="op" id="6121460">&amp;</span><span class="ident" id="6121461">typeInfo</span><span class="op" id="6121469">{</span><span class="op" id="6121470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6121473">if</span>&nbsp;<span class="ident" id="6121476">typ</span><span class="op" id="6121479">.</span><span class="ident" id="6121480">Kind</span><span class="op" id="6121484">(</span><span class="op" id="6121485">)</span>&nbsp;<span class="op" id="6121487">==</span>&nbsp;<span class="ident" id="6121490">reflect</span><span class="op" id="6121497">.</span><span class="ident" id="6121498">Struct</span>&nbsp;<span class="op" id="6121505">&amp;&amp;</span>&nbsp;<span class="ident" id="6121508">typ</span>&nbsp;<span class="op" id="6121512">!=</span>&nbsp;<span class="ident" id="6121515">nameType</span>&nbsp;<span class="op" id="6121524">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6121528">n</span>&nbsp;<span class="op" id="6121530">:=</span>&nbsp;<span class="ident" id="6121533">typ</span><span class="op" id="6121536">.</span><span class="ident" id="6121537">NumField</span><span class="op" id="6121545">(</span><span class="op" id="6121546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6121550">for</span>&nbsp;<span class="ident" id="6121554">i</span>&nbsp;<span class="op" id="6121556">:=</span>&nbsp;<span class="num" id="6121559">0</span><span class="op" id="6121560">;</span>&nbsp;<span class="ident" id="6121562">i</span>&nbsp;<span class="op" id="6121564">&lt;</span>&nbsp;<span class="ident" id="6121566">n</span><span class="op" id="6121567">;</span>&nbsp;<span class="ident" id="6121569">i</span><span class="op" id="6121570">++</span>&nbsp;<span class="op" id="6121573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6121578">f</span>&nbsp;<span class="op" id="6121580">:=</span>&nbsp;<span class="ident" id="6121583">typ</span><span class="op" id="6121586">.</span><span class="ident" id="6121587">Field</span><span class="op" id="6121592">(</span><span class="ident" id="6121593">i</span><span class="op" id="6121594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6121599">if</span>&nbsp;<span class="ident" id="6121602">f</span><span class="op" id="6121603">.</span><span class="ident" id="6121604">PkgPath</span>&nbsp;<span class="op" id="6121612">!=</span>&nbsp;<span class="string" id="6121615">&#34;&#34;</span>&nbsp;<span class="op" id="6121618">||</span>&nbsp;<span class="ident" id="6121621">f</span><span class="op" id="6121622">.</span><span class="ident" id="6121623">Tag</span><span class="op" id="6121626">.</span><span class="ident" id="6121627">Get</span><span class="op" id="6121630">(</span><span class="string" id="6121631">&#34;xml&#34;</span><span class="op" id="6121636">)</span>&nbsp;<span class="op" id="6121638">==</span>&nbsp;<span class="string" id="6121641">&#34;-&#34;</span>&nbsp;<span class="op" id="6121645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6121651">continue</span>&nbsp;<span class="comment" id="6121660">//&nbsp;Private&nbsp;field</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6121680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6121686">//&nbsp;For&nbsp;embedded&nbsp;structs,&nbsp;embed&nbsp;its&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6121732">if</span>&nbsp;<span class="ident" id="6121735">f</span><span class="op" id="6121736">.</span><span class="ident" id="6121737">Anonymous</span>&nbsp;<span class="op" id="6121747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6121753">t</span>&nbsp;<span class="op" id="6121755">:=</span>&nbsp;<span class="ident" id="6121758">f</span><span class="op" id="6121759">.</span><span class="ident" id="6121760">Type</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6121769">if</span>&nbsp;<span class="ident" id="6121772">t</span><span class="op" id="6121773">.</span><span class="ident" id="6121774">Kind</span><span class="op" id="6121778">(</span><span class="op" id="6121779">)</span>&nbsp;<span class="op" id="6121781">==</span>&nbsp;<span class="ident" id="6121784">reflect</span><span class="op" id="6121791">.</span><span class="ident" id="6121792">Ptr</span>&nbsp;<span class="op" id="6121796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6121803">t</span>&nbsp;<span class="op" id="6121805">=</span>&nbsp;<span class="ident" id="6121807">t</span><span class="op" id="6121808">.</span><span class="ident" id="6121809">Elem</span><span class="op" id="6121813">(</span><span class="op" id="6121814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6121820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6121826">if</span>&nbsp;<span class="ident" id="6121829">t</span><span class="op" id="6121830">.</span><span class="ident" id="6121831">Kind</span><span class="op" id="6121835">(</span><span class="op" id="6121836">)</span>&nbsp;<span class="op" id="6121838">==</span>&nbsp;<span class="ident" id="6121841">reflect</span><span class="op" id="6121848">.</span><span class="ident" id="6121849">Struct</span>&nbsp;<span class="op" id="6121856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6121863">inner</span><span class="op" id="6121868">,</span>&nbsp;<span class="ident" id="6121870">err</span>&nbsp;<span class="op" id="6121874">:=</span>&nbsp;<span class="ident" id="6121877">getTypeInfo</span><span class="op" id="6121888">(</span><span class="ident" id="6121889">t</span><span class="op" id="6121890">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6121897">if</span>&nbsp;<span class="ident" id="6121900">err</span>&nbsp;<span class="op" id="6121904">!=</span>&nbsp;<span class="ident" id="6121907">nil</span>&nbsp;<span class="op" id="6121911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6121919">return</span>&nbsp;<span class="ident" id="6121926">nil</span><span class="op" id="6121929">,</span>&nbsp;<span class="ident" id="6121931">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6121940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6121947">if</span>&nbsp;<span class="ident" id="6121950">tinfo</span><span class="op" id="6121955">.</span><span class="ident" id="6121956">xmlname</span>&nbsp;<span class="op" id="6121964">==</span>&nbsp;<span class="ident" id="6121967">nil</span>&nbsp;<span class="op" id="6121971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6121979">tinfo</span><span class="op" id="6121984">.</span><span class="ident" id="6121985">xmlname</span>&nbsp;<span class="op" id="6121993">=</span>&nbsp;<span class="ident" id="6121995">inner</span><span class="op" id="6122000">.</span><span class="ident" id="6122001">xmlname</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6122014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6122021">for</span>&nbsp;<span class="ident" id="6122025">_</span><span class="op" id="6122026">,</span>&nbsp;<span class="ident" id="6122028">finfo</span>&nbsp;<span class="op" id="6122034">:=</span>&nbsp;<span class="keyword" id="6122037">range</span>&nbsp;<span class="ident" id="6122043">inner</span><span class="op" id="6122048">.</span><span class="ident" id="6122049">fields</span>&nbsp;<span class="op" id="6122056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122064">finfo</span><span class="op" id="6122069">.</span><span class="ident" id="6122070">idx</span>&nbsp;<span class="op" id="6122074">=</span>&nbsp;<span class="builtinfunc" id="6122076">append</span><span class="op" id="6122082">(</span><span class="op" id="6122083">[</span><span class="op" id="6122084">]</span><span class="builtintype" id="6122085">int</span><span class="op" id="6122088">{</span><span class="ident" id="6122089">i</span><span class="op" id="6122090">}</span><span class="op" id="6122091">,</span>&nbsp;<span class="ident" id="6122093">finfo</span><span class="op" id="6122098">.</span><span class="ident" id="6122099">idx</span><span class="op" id="6122102">...</span><span class="op" id="6122105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6122113">if</span>&nbsp;<span class="ident" id="6122116">err</span>&nbsp;<span class="op" id="6122120">:=</span>&nbsp;<span class="ident" id="6122123">addFieldInfo</span><span class="op" id="6122135">(</span><span class="ident" id="6122136">typ</span><span class="op" id="6122139">,</span>&nbsp;<span class="ident" id="6122141">tinfo</span><span class="op" id="6122146">,</span>&nbsp;<span class="op" id="6122148">&amp;</span><span class="ident" id="6122149">finfo</span><span class="op" id="6122154">)</span><span class="op" id="6122155">;</span>&nbsp;<span class="ident" id="6122157">err</span>&nbsp;<span class="op" id="6122161">!=</span>&nbsp;<span class="ident" id="6122164">nil</span>&nbsp;<span class="op" id="6122168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6122177">return</span>&nbsp;<span class="ident" id="6122184">nil</span><span class="op" id="6122187">,</span>&nbsp;<span class="ident" id="6122189">err</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6122199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6122206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6122213">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6122226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6122231">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122237">finfo</span><span class="op" id="6122242">,</span>&nbsp;<span class="ident" id="6122244">err</span>&nbsp;<span class="op" id="6122248">:=</span>&nbsp;<span class="ident" id="6122251">structFieldInfo</span><span class="op" id="6122266">(</span><span class="ident" id="6122267">typ</span><span class="op" id="6122270">,</span>&nbsp;<span class="op" id="6122272">&amp;</span><span class="ident" id="6122273">f</span><span class="op" id="6122274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6122279">if</span>&nbsp;<span class="ident" id="6122282">err</span>&nbsp;<span class="op" id="6122286">!=</span>&nbsp;<span class="ident" id="6122289">nil</span>&nbsp;<span class="op" id="6122293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6122299">return</span>&nbsp;<span class="ident" id="6122306">nil</span><span class="op" id="6122309">,</span>&nbsp;<span class="ident" id="6122311">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6122318">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6122324">if</span>&nbsp;<span class="ident" id="6122327">f</span><span class="op" id="6122328">.</span><span class="ident" id="6122329">Name</span>&nbsp;<span class="op" id="6122334">==</span>&nbsp;<span class="string" id="6122337">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6122347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122353">tinfo</span><span class="op" id="6122358">.</span><span class="ident" id="6122359">xmlname</span>&nbsp;<span class="op" id="6122367">=</span>&nbsp;<span class="ident" id="6122369">finfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6122379">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6122391">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6122397">//&nbsp;Add&nbsp;the&nbsp;field&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;conflict&nbsp;with&nbsp;other&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6122459">if</span>&nbsp;<span class="ident" id="6122462">err</span>&nbsp;<span class="op" id="6122466">:=</span>&nbsp;<span class="ident" id="6122469">addFieldInfo</span><span class="op" id="6122481">(</span><span class="ident" id="6122482">typ</span><span class="op" id="6122485">,</span>&nbsp;<span class="ident" id="6122487">tinfo</span><span class="op" id="6122492">,</span>&nbsp;<span class="ident" id="6122494">finfo</span><span class="op" id="6122499">)</span><span class="op" id="6122500">;</span>&nbsp;<span class="ident" id="6122502">err</span>&nbsp;<span class="op" id="6122506">!=</span>&nbsp;<span class="ident" id="6122509">nil</span>&nbsp;<span class="op" id="6122513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6122519">return</span>&nbsp;<span class="ident" id="6122526">nil</span><span class="op" id="6122529">,</span>&nbsp;<span class="ident" id="6122531">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6122538">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6122542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6122545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122548">tinfoLock</span><span class="op" id="6122557">.</span><span class="ident" id="6122558">Lock</span><span class="op" id="6122562">(</span><span class="op" id="6122563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122566">tinfoMap</span><span class="op" id="6122574">[</span><span class="ident" id="6122575">typ</span><span class="op" id="6122578">]</span>&nbsp;<span class="op" id="6122580">=</span>&nbsp;<span class="ident" id="6122582">tinfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122589">tinfoLock</span><span class="op" id="6122598">.</span><span class="ident" id="6122599">Unlock</span><span class="op" id="6122605">(</span><span class="op" id="6122606">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6122609">return</span>&nbsp;<span class="ident" id="6122616">tinfo</span><span class="op" id="6122621">,</span>&nbsp;<span class="ident" id="6122623">nil</span><br>
<span class="lineno"></span><span class="op" id="6122627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6122630">//&nbsp;structFieldInfo&nbsp;builds&nbsp;and&nbsp;returns&nbsp;a&nbsp;fieldInfo&nbsp;for&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="6122687">func</span>&nbsp;<span class="ident" id="6122692">structFieldInfo</span><span class="op" id="6122707">(</span><span class="ident" id="6122708">typ</span>&nbsp;<span class="ident" id="6122712">reflect</span><span class="op" id="6122719">.</span><span class="ident" id="6122720">Type</span><span class="op" id="6122724">,</span>&nbsp;<span class="ident" id="6122726">f</span>&nbsp;<span class="op" id="6122728">*</span><span class="ident" id="6122729">reflect</span><span class="op" id="6122736">.</span><span class="ident" id="6122737">StructField</span><span class="op" id="6122748">)</span>&nbsp;<span class="op" id="6122750">(</span><span class="op" id="6122751">*</span><span class="ident" id="6122752">fieldInfo</span><span class="op" id="6122761">,</span>&nbsp;<span class="builtintype" id="6122763">error</span><span class="op" id="6122768">)</span>&nbsp;<span class="op" id="6122770">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122773">finfo</span>&nbsp;<span class="op" id="6122779">:=</span>&nbsp;<span class="op" id="6122782">&amp;</span><span class="ident" id="6122783">fieldInfo</span><span class="op" id="6122792">{</span><span class="ident" id="6122793">idx</span><span class="op" id="6122796">:</span>&nbsp;<span class="ident" id="6122798">f</span><span class="op" id="6122799">.</span><span class="ident" id="6122800">Index</span><span class="op" id="6122805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6122809">//&nbsp;Split&nbsp;the&nbsp;tag&nbsp;from&nbsp;the&nbsp;xml&nbsp;namespace&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122864">tag</span>&nbsp;<span class="op" id="6122868">:=</span>&nbsp;<span class="ident" id="6122871">f</span><span class="op" id="6122872">.</span><span class="ident" id="6122873">Tag</span><span class="op" id="6122876">.</span><span class="ident" id="6122877">Get</span><span class="op" id="6122880">(</span><span class="string" id="6122881">&#34;xml&#34;</span><span class="op" id="6122886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6122889">if</span>&nbsp;<span class="ident" id="6122892">i</span>&nbsp;<span class="op" id="6122894">:=</span>&nbsp;<span class="ident" id="6122897">strings</span><span class="op" id="6122904">.</span><span class="ident" id="6122905">Index</span><span class="op" id="6122910">(</span><span class="ident" id="6122911">tag</span><span class="op" id="6122914">,</span>&nbsp;<span class="string" id="6122916">&#34;&nbsp;&#34;</span><span class="op" id="6122919">)</span><span class="op" id="6122920">;</span>&nbsp;<span class="ident" id="6122922">i</span>&nbsp;<span class="op" id="6122924">&gt;=</span>&nbsp;<span class="num" id="6122927">0</span>&nbsp;<span class="op" id="6122929">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122933">finfo</span><span class="op" id="6122938">.</span><span class="ident" id="6122939">xmlns</span><span class="op" id="6122944">,</span>&nbsp;<span class="ident" id="6122946">tag</span>&nbsp;<span class="op" id="6122950">=</span>&nbsp;<span class="ident" id="6122952">tag</span><span class="op" id="6122955">[</span><span class="op" id="6122956">:</span><span class="ident" id="6122957">i</span><span class="op" id="6122958">]</span><span class="op" id="6122959">,</span>&nbsp;<span class="ident" id="6122961">tag</span><span class="op" id="6122964">[</span><span class="ident" id="6122965">i</span><span class="op" id="6122966">+</span><span class="num" id="6122967">1</span><span class="op" id="6122968">:</span><span class="op" id="6122969">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6122972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6122976">//&nbsp;Parse&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122993">tokens</span>&nbsp;<span class="op" id="6123000">:=</span>&nbsp;<span class="ident" id="6123003">strings</span><span class="op" id="6123010">.</span><span class="ident" id="6123011">Split</span><span class="op" id="6123016">(</span><span class="ident" id="6123017">tag</span><span class="op" id="6123020">,</span>&nbsp;<span class="string" id="6123022">&#34;,&#34;</span><span class="op" id="6123025">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123028">if</span>&nbsp;<span class="builtinfunc" id="6123031">len</span><span class="op" id="6123034">(</span><span class="ident" id="6123035">tokens</span><span class="op" id="6123041">)</span>&nbsp;<span class="op" id="6123043">==</span>&nbsp;<span class="num" id="6123046">1</span>&nbsp;<span class="op" id="6123048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123052">finfo</span><span class="op" id="6123057">.</span><span class="ident" id="6123058">flags</span>&nbsp;<span class="op" id="6123064">=</span>&nbsp;<span class="ident" id="6123066">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6123076">}</span>&nbsp;<span class="keyword" id="6123078">else</span>&nbsp;<span class="op" id="6123083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123087">tag</span>&nbsp;<span class="op" id="6123091">=</span>&nbsp;<span class="ident" id="6123093">tokens</span><span class="op" id="6123099">[</span><span class="num" id="6123100">0</span><span class="op" id="6123101">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123105">for</span>&nbsp;<span class="ident" id="6123109">_</span><span class="op" id="6123110">,</span>&nbsp;<span class="ident" id="6123112">flag</span>&nbsp;<span class="op" id="6123117">:=</span>&nbsp;<span class="keyword" id="6123120">range</span>&nbsp;<span class="ident" id="6123126">tokens</span><span class="op" id="6123132">[</span><span class="num" id="6123133">1</span><span class="op" id="6123134">:</span><span class="op" id="6123135">]</span>&nbsp;<span class="op" id="6123137">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123142">switch</span>&nbsp;<span class="ident" id="6123149">flag</span>&nbsp;<span class="op" id="6123154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123159">case</span>&nbsp;<span class="string" id="6123164">&#34;attr&#34;</span><span class="op" id="6123170">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123176">finfo</span><span class="op" id="6123181">.</span><span class="ident" id="6123182">flags</span>&nbsp;<span class="op" id="6123188">|=</span>&nbsp;<span class="ident" id="6123191">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123200">case</span>&nbsp;<span class="string" id="6123205">&#34;chardata&#34;</span><span class="op" id="6123215">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123221">finfo</span><span class="op" id="6123226">.</span><span class="ident" id="6123227">flags</span>&nbsp;<span class="op" id="6123233">|=</span>&nbsp;<span class="ident" id="6123236">fCharData</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123249">case</span>&nbsp;<span class="string" id="6123254">&#34;innerxml&#34;</span><span class="op" id="6123264">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123270">finfo</span><span class="op" id="6123275">.</span><span class="ident" id="6123276">flags</span>&nbsp;<span class="op" id="6123282">|=</span>&nbsp;<span class="ident" id="6123285">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123298">case</span>&nbsp;<span class="string" id="6123303">&#34;comment&#34;</span><span class="op" id="6123312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123318">finfo</span><span class="op" id="6123323">.</span><span class="ident" id="6123324">flags</span>&nbsp;<span class="op" id="6123330">|=</span>&nbsp;<span class="ident" id="6123333">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123345">case</span>&nbsp;<span class="string" id="6123350">&#34;any&#34;</span><span class="op" id="6123355">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123361">finfo</span><span class="op" id="6123366">.</span><span class="ident" id="6123367">flags</span>&nbsp;<span class="op" id="6123373">|=</span>&nbsp;<span class="ident" id="6123376">fAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123384">case</span>&nbsp;<span class="string" id="6123389">&#34;omitempty&#34;</span><span class="op" id="6123400">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123406">finfo</span><span class="op" id="6123411">.</span><span class="ident" id="6123412">flags</span>&nbsp;<span class="op" id="6123418">|=</span>&nbsp;<span class="ident" id="6123421">fOmitEmpty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6123435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6123439">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6123444">//&nbsp;Validate&nbsp;the&nbsp;flags&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123474">valid</span>&nbsp;<span class="op" id="6123480">:=</span>&nbsp;<span class="builtintype" id="6123483">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123490">switch</span>&nbsp;<span class="ident" id="6123497">mode</span>&nbsp;<span class="op" id="6123502">:=</span>&nbsp;<span class="ident" id="6123505">finfo</span><span class="op" id="6123510">.</span><span class="ident" id="6123511">flags</span>&nbsp;<span class="op" id="6123517">&amp;</span>&nbsp;<span class="ident" id="6123519">fMode</span><span class="op" id="6123524">;</span>&nbsp;<span class="ident" id="6123526">mode</span>&nbsp;<span class="op" id="6123531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123535">case</span>&nbsp;<span class="num" id="6123540">0</span><span class="op" id="6123541">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123546">finfo</span><span class="op" id="6123551">.</span><span class="ident" id="6123552">flags</span>&nbsp;<span class="op" id="6123558">|=</span>&nbsp;<span class="ident" id="6123561">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123572">case</span>&nbsp;<span class="ident" id="6123577">fAttr</span><span class="op" id="6123582">,</span>&nbsp;<span class="ident" id="6123584">fCharData</span><span class="op" id="6123593">,</span>&nbsp;<span class="ident" id="6123595">fInnerXml</span><span class="op" id="6123604">,</span>&nbsp;<span class="ident" id="6123606">fComment</span><span class="op" id="6123614">,</span>&nbsp;<span class="ident" id="6123616">fAny</span><span class="op" id="6123620">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123625">if</span>&nbsp;<span class="ident" id="6123628">f</span><span class="op" id="6123629">.</span><span class="ident" id="6123630">Name</span>&nbsp;<span class="op" id="6123635">==</span>&nbsp;<span class="string" id="6123638">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6123648">||</span>&nbsp;<span class="ident" id="6123651">tag</span>&nbsp;<span class="op" id="6123655">!=</span>&nbsp;<span class="string" id="6123658">&#34;&#34;</span>&nbsp;<span class="op" id="6123661">&amp;&amp;</span>&nbsp;<span class="ident" id="6123664">mode</span>&nbsp;<span class="op" id="6123669">!=</span>&nbsp;<span class="ident" id="6123672">fAttr</span>&nbsp;<span class="op" id="6123678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123684">valid</span>&nbsp;<span class="op" id="6123690">=</span>&nbsp;<span class="builtintype" id="6123692">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6123701">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123705">default</span><span class="op" id="6123712">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6123717">//&nbsp;This&nbsp;will&nbsp;also&nbsp;catch&nbsp;multiple&nbsp;modes&nbsp;in&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123778">valid</span>&nbsp;<span class="op" id="6123784">=</span>&nbsp;<span class="builtintype" id="6123786">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6123794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123798">if</span>&nbsp;<span class="ident" id="6123801">finfo</span><span class="op" id="6123806">.</span><span class="ident" id="6123807">flags</span><span class="op" id="6123812">&amp;</span><span class="ident" id="6123813">fMode</span>&nbsp;<span class="op" id="6123819">==</span>&nbsp;<span class="ident" id="6123822">fAny</span>&nbsp;<span class="op" id="6123827">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123832">finfo</span><span class="op" id="6123837">.</span><span class="ident" id="6123838">flags</span>&nbsp;<span class="op" id="6123844">|=</span>&nbsp;<span class="ident" id="6123847">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6123858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123862">if</span>&nbsp;<span class="ident" id="6123865">finfo</span><span class="op" id="6123870">.</span><span class="ident" id="6123871">flags</span><span class="op" id="6123876">&amp;</span><span class="ident" id="6123877">fOmitEmpty</span>&nbsp;<span class="op" id="6123888">!=</span>&nbsp;<span class="num" id="6123891">0</span>&nbsp;<span class="op" id="6123893">&amp;&amp;</span>&nbsp;<span class="ident" id="6123896">finfo</span><span class="op" id="6123901">.</span><span class="ident" id="6123902">flags</span><span class="op" id="6123907">&amp;</span><span class="op" id="6123908">(</span><span class="ident" id="6123909">fElement</span><span class="op" id="6123917">|</span><span class="ident" id="6123918">fAttr</span><span class="op" id="6123923">)</span>&nbsp;<span class="op" id="6123925">==</span>&nbsp;<span class="num" id="6123928">0</span>&nbsp;<span class="op" id="6123930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123935">valid</span>&nbsp;<span class="op" id="6123941">=</span>&nbsp;<span class="builtintype" id="6123943">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6123951">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123955">if</span>&nbsp;<span class="op" id="6123958">!</span><span class="ident" id="6123959">valid</span>&nbsp;<span class="op" id="6123965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123970">return</span>&nbsp;<span class="ident" id="6123977">nil</span><span class="op" id="6123980">,</span>&nbsp;<span class="ident" id="6123982">fmt</span><span class="op" id="6123985">.</span><span class="ident" id="6123986">Errorf</span><span class="op" id="6123992">(</span><span class="string" id="6123993">&#34;xml:&nbsp;invalid&nbsp;tag&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="6124038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124044">f</span><span class="op" id="6124045">.</span><span class="ident" id="6124046">Name</span><span class="op" id="6124050">,</span>&nbsp;<span class="ident" id="6124052">typ</span><span class="op" id="6124055">,</span>&nbsp;<span class="ident" id="6124057">f</span><span class="op" id="6124058">.</span><span class="ident" id="6124059">Tag</span><span class="op" id="6124062">.</span><span class="ident" id="6124063">Get</span><span class="op" id="6124066">(</span><span class="string" id="6124067">&#34;xml&#34;</span><span class="op" id="6124072">)</span><span class="op" id="6124073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6124077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6124080">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6124084">//&nbsp;Use&nbsp;of&nbsp;xmlns&nbsp;without&nbsp;a&nbsp;name&nbsp;is&nbsp;not&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6124132">if</span>&nbsp;<span class="ident" id="6124135">finfo</span><span class="op" id="6124140">.</span><span class="ident" id="6124141">xmlns</span>&nbsp;<span class="op" id="6124147">!=</span>&nbsp;<span class="string" id="6124150">&#34;&#34;</span>&nbsp;<span class="op" id="6124153">&amp;&amp;</span>&nbsp;<span class="ident" id="6124156">tag</span>&nbsp;<span class="op" id="6124160">==</span>&nbsp;<span class="string" id="6124163">&#34;&#34;</span>&nbsp;<span class="op" id="6124166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6124170">return</span>&nbsp;<span class="ident" id="6124177">nil</span><span class="op" id="6124180">,</span>&nbsp;<span class="ident" id="6124182">fmt</span><span class="op" id="6124185">.</span><span class="ident" id="6124186">Errorf</span><span class="op" id="6124192">(</span><span class="string" id="6124193">&#34;xml:&nbsp;namespace&nbsp;without&nbsp;name&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="6124249">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124254">f</span><span class="op" id="6124255">.</span><span class="ident" id="6124256">Name</span><span class="op" id="6124260">,</span>&nbsp;<span class="ident" id="6124262">typ</span><span class="op" id="6124265">,</span>&nbsp;<span class="ident" id="6124267">f</span><span class="op" id="6124268">.</span><span class="ident" id="6124269">Tag</span><span class="op" id="6124272">.</span><span class="ident" id="6124273">Get</span><span class="op" id="6124276">(</span><span class="string" id="6124277">&#34;xml&#34;</span><span class="op" id="6124282">)</span><span class="op" id="6124283">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6124286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6124290">if</span>&nbsp;<span class="ident" id="6124293">f</span><span class="op" id="6124294">.</span><span class="ident" id="6124295">Name</span>&nbsp;<span class="op" id="6124300">==</span>&nbsp;<span class="string" id="6124303">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6124313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6124317">//&nbsp;The&nbsp;XMLName&nbsp;field&nbsp;records&nbsp;the&nbsp;XML&nbsp;element&nbsp;name.&nbsp;Don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6124376">//&nbsp;process&nbsp;it&nbsp;as&nbsp;usual&nbsp;because&nbsp;its&nbsp;name&nbsp;should&nbsp;default&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6124436">//&nbsp;empty&nbsp;rather&nbsp;than&nbsp;to&nbsp;the&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124478">finfo</span><span class="op" id="6124483">.</span><span class="ident" id="6124484">name</span>&nbsp;<span class="op" id="6124489">=</span>&nbsp;<span class="ident" id="6124491">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6124497">return</span>&nbsp;<span class="ident" id="6124504">finfo</span><span class="op" id="6124509">,</span>&nbsp;<span class="ident" id="6124511">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6124516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6124520">if</span>&nbsp;<span class="ident" id="6124523">tag</span>&nbsp;<span class="op" id="6124527">==</span>&nbsp;<span class="string" id="6124530">&#34;&#34;</span>&nbsp;<span class="op" id="6124533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6124537">//&nbsp;If&nbsp;the&nbsp;name&nbsp;part&nbsp;of&nbsp;the&nbsp;tag&nbsp;is&nbsp;completely&nbsp;empty,&nbsp;get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6124595">//&nbsp;default&nbsp;from&nbsp;XMLName&nbsp;of&nbsp;underlying&nbsp;struct&nbsp;if&nbsp;feasible,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6124655">//&nbsp;or&nbsp;field&nbsp;name&nbsp;otherwise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6124685">if</span>&nbsp;<span class="ident" id="6124688">xmlname</span>&nbsp;<span class="op" id="6124696">:=</span>&nbsp;<span class="ident" id="6124699">lookupXMLName</span><span class="op" id="6124712">(</span><span class="ident" id="6124713">f</span><span class="op" id="6124714">.</span><span class="ident" id="6124715">Type</span><span class="op" id="6124719">)</span><span class="op" id="6124720">;</span>&nbsp;<span class="ident" id="6124722">xmlname</span>&nbsp;<span class="op" id="6124730">!=</span>&nbsp;<span class="ident" id="6124733">nil</span>&nbsp;<span class="op" id="6124737">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124742">finfo</span><span class="op" id="6124747">.</span><span class="ident" id="6124748">xmlns</span><span class="op" id="6124753">,</span>&nbsp;<span class="ident" id="6124755">finfo</span><span class="op" id="6124760">.</span><span class="ident" id="6124761">name</span>&nbsp;<span class="op" id="6124766">=</span>&nbsp;<span class="ident" id="6124768">xmlname</span><span class="op" id="6124775">.</span><span class="ident" id="6124776">xmlns</span><span class="op" id="6124781">,</span>&nbsp;<span class="ident" id="6124783">xmlname</span><span class="op" id="6124790">.</span><span class="ident" id="6124791">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6124798">}</span>&nbsp;<span class="keyword" id="6124800">else</span>&nbsp;<span class="op" id="6124805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124810">finfo</span><span class="op" id="6124815">.</span><span class="ident" id="6124816">name</span>&nbsp;<span class="op" id="6124821">=</span>&nbsp;<span class="ident" id="6124823">f</span><span class="op" id="6124824">.</span><span class="ident" id="6124825">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6124832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6124836">return</span>&nbsp;<span class="ident" id="6124843">finfo</span><span class="op" id="6124848">,</span>&nbsp;<span class="ident" id="6124850">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6124855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6124859">//&nbsp;Prepare&nbsp;field&nbsp;name&nbsp;and&nbsp;parents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124895">parents</span>&nbsp;<span class="op" id="6124903">:=</span>&nbsp;<span class="ident" id="6124906">strings</span><span class="op" id="6124913">.</span><span class="ident" id="6124914">Split</span><span class="op" id="6124919">(</span><span class="ident" id="6124920">tag</span><span class="op" id="6124923">,</span>&nbsp;<span class="string" id="6124925">&#34;&gt;&#34;</span><span class="op" id="6124928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6124931">if</span>&nbsp;<span class="ident" id="6124934">parents</span><span class="op" id="6124941">[</span><span class="num" id="6124942">0</span><span class="op" id="6124943">]</span>&nbsp;<span class="op" id="6124945">==</span>&nbsp;<span class="string" id="6124948">&#34;&#34;</span>&nbsp;<span class="op" id="6124951">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124955">parents</span><span class="op" id="6124962">[</span><span class="num" id="6124963">0</span><span class="op" id="6124964">]</span>&nbsp;<span class="op" id="6124966">=</span>&nbsp;<span class="ident" id="6124968">f</span><span class="op" id="6124969">.</span><span class="ident" id="6124970">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6124976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6124979">if</span>&nbsp;<span class="ident" id="6124982">parents</span><span class="op" id="6124989">[</span><span class="builtinfunc" id="6124990">len</span><span class="op" id="6124993">(</span><span class="ident" id="6124994">parents</span><span class="op" id="6125001">)</span><span class="op" id="6125002">-</span><span class="num" id="6125003">1</span><span class="op" id="6125004">]</span>&nbsp;<span class="op" id="6125006">==</span>&nbsp;<span class="string" id="6125009">&#34;&#34;</span>&nbsp;<span class="op" id="6125012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6125016">return</span>&nbsp;<span class="ident" id="6125023">nil</span><span class="op" id="6125026">,</span>&nbsp;<span class="ident" id="6125028">fmt</span><span class="op" id="6125031">.</span><span class="ident" id="6125032">Errorf</span><span class="op" id="6125038">(</span><span class="string" id="6125039">&#34;xml:&nbsp;trailing&nbsp;&#39;&gt;&#39;&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="6125081">,</span>&nbsp;<span class="ident" id="6125083">f</span><span class="op" id="6125084">.</span><span class="ident" id="6125085">Name</span><span class="op" id="6125089">,</span>&nbsp;<span class="ident" id="6125091">typ</span><span class="op" id="6125094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6125097">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6125100">finfo</span><span class="op" id="6125105">.</span><span class="ident" id="6125106">name</span>&nbsp;<span class="op" id="6125111">=</span>&nbsp;<span class="ident" id="6125113">parents</span><span class="op" id="6125120">[</span><span class="builtinfunc" id="6125121">len</span><span class="op" id="6125124">(</span><span class="ident" id="6125125">parents</span><span class="op" id="6125132">)</span><span class="op" id="6125133">-</span><span class="num" id="6125134">1</span><span class="op" id="6125135">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6125138">if</span>&nbsp;<span class="builtinfunc" id="6125141">len</span><span class="op" id="6125144">(</span><span class="ident" id="6125145">parents</span><span class="op" id="6125152">)</span>&nbsp;<span class="op" id="6125154">&gt;</span>&nbsp;<span class="num" id="6125156">1</span>&nbsp;<span class="op" id="6125158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6125162">if</span>&nbsp;<span class="op" id="6125165">(</span><span class="ident" id="6125166">finfo</span><span class="op" id="6125171">.</span><span class="ident" id="6125172">flags</span>&nbsp;<span class="op" id="6125178">&amp;</span>&nbsp;<span class="ident" id="6125180">fElement</span><span class="op" id="6125188">)</span>&nbsp;<span class="op" id="6125190">==</span>&nbsp;<span class="num" id="6125193">0</span>&nbsp;<span class="op" id="6125195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6125200">return</span>&nbsp;<span class="ident" id="6125207">nil</span><span class="op" id="6125210">,</span>&nbsp;<span class="ident" id="6125212">fmt</span><span class="op" id="6125215">.</span><span class="ident" id="6125216">Errorf</span><span class="op" id="6125222">(</span><span class="string" id="6125223">&#34;xml:&nbsp;%s&nbsp;chain&nbsp;not&nbsp;valid&nbsp;with&nbsp;%s&nbsp;flag&#34;</span><span class="op" id="6125261">,</span>&nbsp;<span class="ident" id="6125263">tag</span><span class="op" id="6125266">,</span>&nbsp;<span class="ident" id="6125268">strings</span><span class="op" id="6125275">.</span><span class="ident" id="6125276">Join</span><span class="op" id="6125280">(</span><span class="ident" id="6125281">tokens</span><span class="op" id="6125287">[</span><span class="num" id="6125288">1</span><span class="op" id="6125289">:</span><span class="op" id="6125290">]</span><span class="op" id="6125291">,</span>&nbsp;<span class="string" id="6125293">&#34;,&#34;</span><span class="op" id="6125296">)</span><span class="op" id="6125297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6125301">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6125305">finfo</span><span class="op" id="6125310">.</span><span class="ident" id="6125311">parents</span>&nbsp;<span class="op" id="6125319">=</span>&nbsp;<span class="ident" id="6125321">parents</span><span class="op" id="6125328">[</span><span class="op" id="6125329">:</span><span class="builtinfunc" id="6125330">len</span><span class="op" id="6125333">(</span><span class="ident" id="6125334">parents</span><span class="op" id="6125341">)</span><span class="op" id="6125342">-</span><span class="num" id="6125343">1</span><span class="op" id="6125344">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6125347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6125351">//&nbsp;If&nbsp;the&nbsp;field&nbsp;type&nbsp;has&nbsp;an&nbsp;XMLName&nbsp;field,&nbsp;the&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6125416">//&nbsp;so&nbsp;that&nbsp;the&nbsp;behavior&nbsp;of&nbsp;both&nbsp;marshalling&nbsp;and&nbsp;unmarshalling</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6125479">//&nbsp;is&nbsp;straightforward&nbsp;and&nbsp;unambiguous.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6125519">if</span>&nbsp;<span class="ident" id="6125522">finfo</span><span class="op" id="6125527">.</span><span class="ident" id="6125528">flags</span><span class="op" id="6125533">&amp;</span><span class="ident" id="6125534">fElement</span>&nbsp;<span class="op" id="6125543">!=</span>&nbsp;<span class="num" id="6125546">0</span>&nbsp;<span class="op" id="6125548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6125552">ftyp</span>&nbsp;<span class="op" id="6125557">:=</span>&nbsp;<span class="ident" id="6125560">f</span><span class="op" id="6125561">.</span><span class="ident" id="6125562">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6125569">xmlname</span>&nbsp;<span class="op" id="6125577">:=</span>&nbsp;<span class="ident" id="6125580">lookupXMLName</span><span class="op" id="6125593">(</span><span class="ident" id="6125594">ftyp</span><span class="op" id="6125598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6125602">if</span>&nbsp;<span class="ident" id="6125605">xmlname</span>&nbsp;<span class="op" id="6125613">!=</span>&nbsp;<span class="ident" id="6125616">nil</span>&nbsp;<span class="op" id="6125620">&amp;&amp;</span>&nbsp;<span class="ident" id="6125623">xmlname</span><span class="op" id="6125630">.</span><span class="ident" id="6125631">name</span>&nbsp;<span class="op" id="6125636">!=</span>&nbsp;<span class="ident" id="6125639">finfo</span><span class="op" id="6125644">.</span><span class="ident" id="6125645">name</span>&nbsp;<span class="op" id="6125650">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6125655">return</span>&nbsp;<span class="ident" id="6125662">nil</span><span class="op" id="6125665">,</span>&nbsp;<span class="ident" id="6125667">fmt</span><span class="op" id="6125670">.</span><span class="ident" id="6125671">Errorf</span><span class="op" id="6125677">(</span><span class="string" id="6125678">&#34;xml:&nbsp;name&nbsp;%q&nbsp;in&nbsp;tag&nbsp;of&nbsp;%s.%s&nbsp;conflicts&nbsp;with&nbsp;name&nbsp;%q&nbsp;in&nbsp;%s.XMLName&#34;</span><span class="op" id="6125745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6125751">finfo</span><span class="op" id="6125756">.</span><span class="ident" id="6125757">name</span><span class="op" id="6125761">,</span>&nbsp;<span class="ident" id="6125763">typ</span><span class="op" id="6125766">,</span>&nbsp;<span class="ident" id="6125768">f</span><span class="op" id="6125769">.</span><span class="ident" id="6125770">Name</span><span class="op" id="6125774">,</span>&nbsp;<span class="ident" id="6125776">xmlname</span><span class="op" id="6125783">.</span><span class="ident" id="6125784">name</span><span class="op" id="6125788">,</span>&nbsp;<span class="ident" id="6125790">ftyp</span><span class="op" id="6125794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6125798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6125801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6125804">return</span>&nbsp;<span class="ident" id="6125811">finfo</span><span class="op" id="6125816">,</span>&nbsp;<span class="ident" id="6125818">nil</span><br>
<span class="lineno">225</span><span class="op" id="6125822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6125825">//&nbsp;lookupXMLName&nbsp;returns&nbsp;the&nbsp;fieldInfo&nbsp;for&nbsp;typ&#39;s&nbsp;XMLName&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="6125888">//&nbsp;in&nbsp;case&nbsp;it&nbsp;exists&nbsp;and&nbsp;has&nbsp;a&nbsp;valid&nbsp;xml&nbsp;field&nbsp;tag,&nbsp;otherwise</span><br>
<span class="lineno"></span><span class="comment" id="6125950">//&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">230</span><span class="keyword" id="6125969">func</span>&nbsp;<span class="ident" id="6125974">lookupXMLName</span><span class="op" id="6125987">(</span><span class="ident" id="6125988">typ</span>&nbsp;<span class="ident" id="6125992">reflect</span><span class="op" id="6125999">.</span><span class="ident" id="6126000">Type</span><span class="op" id="6126004">)</span>&nbsp;<span class="op" id="6126006">(</span><span class="ident" id="6126007">xmlname</span>&nbsp;<span class="op" id="6126015">*</span><span class="ident" id="6126016">fieldInfo</span><span class="op" id="6126025">)</span>&nbsp;<span class="op" id="6126027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126030">for</span>&nbsp;<span class="ident" id="6126034">typ</span><span class="op" id="6126037">.</span><span class="ident" id="6126038">Kind</span><span class="op" id="6126042">(</span><span class="op" id="6126043">)</span>&nbsp;<span class="op" id="6126045">==</span>&nbsp;<span class="ident" id="6126048">reflect</span><span class="op" id="6126055">.</span><span class="ident" id="6126056">Ptr</span>&nbsp;<span class="op" id="6126060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6126064">typ</span>&nbsp;<span class="op" id="6126068">=</span>&nbsp;<span class="ident" id="6126070">typ</span><span class="op" id="6126073">.</span><span class="ident" id="6126074">Elem</span><span class="op" id="6126078">(</span><span class="op" id="6126079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6126082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126085">if</span>&nbsp;<span class="ident" id="6126088">typ</span><span class="op" id="6126091">.</span><span class="ident" id="6126092">Kind</span><span class="op" id="6126096">(</span><span class="op" id="6126097">)</span>&nbsp;<span class="op" id="6126099">!=</span>&nbsp;<span class="ident" id="6126102">reflect</span><span class="op" id="6126109">.</span><span class="ident" id="6126110">Struct</span>&nbsp;<span class="op" id="6126117">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126121">return</span>&nbsp;<span class="ident" id="6126128">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6126133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126136">for</span>&nbsp;<span class="ident" id="6126140">i</span><span class="op" id="6126141">,</span>&nbsp;<span class="ident" id="6126143">n</span>&nbsp;<span class="op" id="6126145">:=</span>&nbsp;<span class="num" id="6126148">0</span><span class="op" id="6126149">,</span>&nbsp;<span class="ident" id="6126151">typ</span><span class="op" id="6126154">.</span><span class="ident" id="6126155">NumField</span><span class="op" id="6126163">(</span><span class="op" id="6126164">)</span><span class="op" id="6126165">;</span>&nbsp;<span class="ident" id="6126167">i</span>&nbsp;<span class="op" id="6126169">&lt;</span>&nbsp;<span class="ident" id="6126171">n</span><span class="op" id="6126172">;</span>&nbsp;<span class="ident" id="6126174">i</span><span class="op" id="6126175">++</span>&nbsp;<span class="op" id="6126178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6126182">f</span>&nbsp;<span class="op" id="6126184">:=</span>&nbsp;<span class="ident" id="6126187">typ</span><span class="op" id="6126190">.</span><span class="ident" id="6126191">Field</span><span class="op" id="6126196">(</span><span class="ident" id="6126197">i</span><span class="op" id="6126198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126202">if</span>&nbsp;<span class="ident" id="6126205">f</span><span class="op" id="6126206">.</span><span class="ident" id="6126207">Name</span>&nbsp;<span class="op" id="6126212">!=</span>&nbsp;<span class="string" id="6126215">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6126225">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126230">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6126241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6126245">finfo</span><span class="op" id="6126250">,</span>&nbsp;<span class="ident" id="6126252">err</span>&nbsp;<span class="op" id="6126256">:=</span>&nbsp;<span class="ident" id="6126259">structFieldInfo</span><span class="op" id="6126274">(</span><span class="ident" id="6126275">typ</span><span class="op" id="6126278">,</span>&nbsp;<span class="op" id="6126280">&amp;</span><span class="ident" id="6126281">f</span><span class="op" id="6126282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126286">if</span>&nbsp;<span class="ident" id="6126289">finfo</span><span class="op" id="6126294">.</span><span class="ident" id="6126295">name</span>&nbsp;<span class="op" id="6126300">!=</span>&nbsp;<span class="string" id="6126303">&#34;&#34;</span>&nbsp;<span class="op" id="6126306">&amp;&amp;</span>&nbsp;<span class="ident" id="6126309">err</span>&nbsp;<span class="op" id="6126313">==</span>&nbsp;<span class="ident" id="6126316">nil</span>&nbsp;<span class="op" id="6126320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126325">return</span>&nbsp;<span class="ident" id="6126332">finfo</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6126340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6126344">//&nbsp;Also&nbsp;consider&nbsp;errors&nbsp;as&nbsp;a&nbsp;non-existent&nbsp;field&nbsp;tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6126398">//&nbsp;and&nbsp;let&nbsp;getTypeInfo&nbsp;itself&nbsp;report&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126448">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6126455">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126458">return</span>&nbsp;<span class="ident" id="6126465">nil</span><br>
<span class="lineno"></span><span class="op" id="6126469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6126472">func</span>&nbsp;<span class="ident" id="6126477">min</span><span class="op" id="6126480">(</span><span class="ident" id="6126481">a</span><span class="op" id="6126482">,</span>&nbsp;<span class="ident" id="6126484">b</span>&nbsp;<span class="builtintype" id="6126486">int</span><span class="op" id="6126489">)</span>&nbsp;<span class="builtintype" id="6126491">int</span>&nbsp;<span class="op" id="6126495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126498">if</span>&nbsp;<span class="ident" id="6126501">a</span>&nbsp;<span class="op" id="6126503">&lt;=</span>&nbsp;<span class="ident" id="6126506">b</span>&nbsp;<span class="op" id="6126508">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126512">return</span>&nbsp;<span class="ident" id="6126519">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6126522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126525">return</span>&nbsp;<span class="ident" id="6126532">b</span><br>
<span class="lineno"></span><span class="op" id="6126534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="6126537">//&nbsp;addFieldInfo&nbsp;adds&nbsp;finfo&nbsp;to&nbsp;tinfo.fields&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="6126596">//&nbsp;conflicts,&nbsp;or&nbsp;if&nbsp;conflicts&nbsp;arise&nbsp;from&nbsp;previous&nbsp;fields&nbsp;that&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="6126663">//&nbsp;obtained&nbsp;from&nbsp;deeper&nbsp;embedded&nbsp;structures&nbsp;than&nbsp;finfo.&nbsp;In&nbsp;the&nbsp;latter</span><br>
<span class="lineno"></span><span class="comment" id="6126733">//&nbsp;case,&nbsp;the&nbsp;conflicting&nbsp;entries&nbsp;are&nbsp;dropped.</span><br>
<span class="lineno"></span><span class="comment" id="6126779">//&nbsp;A&nbsp;conflict&nbsp;occurs&nbsp;when&nbsp;the&nbsp;path&nbsp;(parent&nbsp;+&nbsp;name)&nbsp;to&nbsp;a&nbsp;field&nbsp;is</span><br>
<span class="lineno">265</span><span class="comment" id="6126844">//&nbsp;itself&nbsp;a&nbsp;prefix&nbsp;of&nbsp;another&nbsp;path,&nbsp;or&nbsp;when&nbsp;two&nbsp;paths&nbsp;match&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="comment" id="6126913">//&nbsp;It&nbsp;is&nbsp;okay&nbsp;for&nbsp;field&nbsp;paths&nbsp;to&nbsp;share&nbsp;a&nbsp;common,&nbsp;shorter&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6126978">func</span>&nbsp;<span class="ident" id="6126983">addFieldInfo</span><span class="op" id="6126995">(</span><span class="ident" id="6126996">typ</span>&nbsp;<span class="ident" id="6127000">reflect</span><span class="op" id="6127007">.</span><span class="ident" id="6127008">Type</span><span class="op" id="6127012">,</span>&nbsp;<span class="ident" id="6127014">tinfo</span>&nbsp;<span class="op" id="6127020">*</span><span class="ident" id="6127021">typeInfo</span><span class="op" id="6127029">,</span>&nbsp;<span class="ident" id="6127031">newf</span>&nbsp;<span class="op" id="6127036">*</span><span class="ident" id="6127037">fieldInfo</span><span class="op" id="6127046">)</span>&nbsp;<span class="builtintype" id="6127048">error</span>&nbsp;<span class="op" id="6127054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127057">var</span>&nbsp;<span class="ident" id="6127061">conflicts</span>&nbsp;<span class="op" id="6127071">[</span><span class="op" id="6127072">]</span><span class="builtintype" id="6127073">int</span><br>
<span class="lineno"></span><span class="ident" id="6127077">Loop</span><span class="op" id="6127081">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6127084">//&nbsp;First,&nbsp;figure&nbsp;all&nbsp;conflicts.&nbsp;Most&nbsp;working&nbsp;code&nbsp;will&nbsp;have&nbsp;none.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127151">for</span>&nbsp;<span class="ident" id="6127155">i</span>&nbsp;<span class="op" id="6127157">:=</span>&nbsp;<span class="keyword" id="6127160">range</span>&nbsp;<span class="ident" id="6127166">tinfo</span><span class="op" id="6127171">.</span><span class="ident" id="6127172">fields</span>&nbsp;<span class="op" id="6127179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6127183">oldf</span>&nbsp;<span class="op" id="6127188">:=</span>&nbsp;<span class="op" id="6127191">&amp;</span><span class="ident" id="6127192">tinfo</span><span class="op" id="6127197">.</span><span class="ident" id="6127198">fields</span><span class="op" id="6127204">[</span><span class="ident" id="6127205">i</span><span class="op" id="6127206">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127210">if</span>&nbsp;<span class="ident" id="6127213">oldf</span><span class="op" id="6127217">.</span><span class="ident" id="6127218">flags</span><span class="op" id="6127223">&amp;</span><span class="ident" id="6127224">fMode</span>&nbsp;<span class="op" id="6127230">!=</span>&nbsp;<span class="ident" id="6127233">newf</span><span class="op" id="6127237">.</span><span class="ident" id="6127238">flags</span><span class="op" id="6127243">&amp;</span><span class="ident" id="6127244">fMode</span>&nbsp;<span class="op" id="6127250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127255">continue</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6127266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127270">if</span>&nbsp;<span class="ident" id="6127273">oldf</span><span class="op" id="6127277">.</span><span class="ident" id="6127278">xmlns</span>&nbsp;<span class="op" id="6127284">!=</span>&nbsp;<span class="string" id="6127287">&#34;&#34;</span>&nbsp;<span class="op" id="6127290">&amp;&amp;</span>&nbsp;<span class="ident" id="6127293">newf</span><span class="op" id="6127297">.</span><span class="ident" id="6127298">xmlns</span>&nbsp;<span class="op" id="6127304">!=</span>&nbsp;<span class="string" id="6127307">&#34;&#34;</span>&nbsp;<span class="op" id="6127310">&amp;&amp;</span>&nbsp;<span class="ident" id="6127313">oldf</span><span class="op" id="6127317">.</span><span class="ident" id="6127318">xmlns</span>&nbsp;<span class="op" id="6127324">!=</span>&nbsp;<span class="ident" id="6127327">newf</span><span class="op" id="6127331">.</span><span class="ident" id="6127332">xmlns</span>&nbsp;<span class="op" id="6127338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127343">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6127354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6127358">minl</span>&nbsp;<span class="op" id="6127363">:=</span>&nbsp;<span class="ident" id="6127366">min</span><span class="op" id="6127369">(</span><span class="builtinfunc" id="6127370">len</span><span class="op" id="6127373">(</span><span class="ident" id="6127374">newf</span><span class="op" id="6127378">.</span><span class="ident" id="6127379">parents</span><span class="op" id="6127386">)</span><span class="op" id="6127387">,</span>&nbsp;<span class="builtinfunc" id="6127389">len</span><span class="op" id="6127392">(</span><span class="ident" id="6127393">oldf</span><span class="op" id="6127397">.</span><span class="ident" id="6127398">parents</span><span class="op" id="6127405">)</span><span class="op" id="6127406">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127410">for</span>&nbsp;<span class="ident" id="6127414">p</span>&nbsp;<span class="op" id="6127416">:=</span>&nbsp;<span class="num" id="6127419">0</span><span class="op" id="6127420">;</span>&nbsp;<span class="ident" id="6127422">p</span>&nbsp;<span class="op" id="6127424">&lt;</span>&nbsp;<span class="ident" id="6127426">minl</span><span class="op" id="6127430">;</span>&nbsp;<span class="ident" id="6127432">p</span><span class="op" id="6127433">++</span>&nbsp;<span class="op" id="6127436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127441">if</span>&nbsp;<span class="ident" id="6127444">oldf</span><span class="op" id="6127448">.</span><span class="ident" id="6127449">parents</span><span class="op" id="6127456">[</span><span class="ident" id="6127457">p</span><span class="op" id="6127458">]</span>&nbsp;<span class="op" id="6127460">!=</span>&nbsp;<span class="ident" id="6127463">newf</span><span class="op" id="6127467">.</span><span class="ident" id="6127468">parents</span><span class="op" id="6127475">[</span><span class="ident" id="6127476">p</span><span class="op" id="6127477">]</span>&nbsp;<span class="op" id="6127479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127485">continue</span>&nbsp;<span class="ident" id="6127494">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6127502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6127506">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127510">if</span>&nbsp;<span class="builtinfunc" id="6127513">len</span><span class="op" id="6127516">(</span><span class="ident" id="6127517">oldf</span><span class="op" id="6127521">.</span><span class="ident" id="6127522">parents</span><span class="op" id="6127529">)</span>&nbsp;<span class="op" id="6127531">&gt;</span>&nbsp;<span class="builtinfunc" id="6127533">len</span><span class="op" id="6127536">(</span><span class="ident" id="6127537">newf</span><span class="op" id="6127541">.</span><span class="ident" id="6127542">parents</span><span class="op" id="6127549">)</span>&nbsp;<span class="op" id="6127551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127556">if</span>&nbsp;<span class="ident" id="6127559">oldf</span><span class="op" id="6127563">.</span><span class="ident" id="6127564">parents</span><span class="op" id="6127571">[</span><span class="builtinfunc" id="6127572">len</span><span class="op" id="6127575">(</span><span class="ident" id="6127576">newf</span><span class="op" id="6127580">.</span><span class="ident" id="6127581">parents</span><span class="op" id="6127588">)</span><span class="op" id="6127589">]</span>&nbsp;<span class="op" id="6127591">==</span>&nbsp;<span class="ident" id="6127594">newf</span><span class="op" id="6127598">.</span><span class="ident" id="6127599">name</span>&nbsp;<span class="op" id="6127604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6127610">conflicts</span>&nbsp;<span class="op" id="6127620">=</span>&nbsp;<span class="builtinfunc" id="6127622">append</span><span class="op" id="6127628">(</span><span class="ident" id="6127629">conflicts</span><span class="op" id="6127638">,</span>&nbsp;<span class="ident" id="6127640">i</span><span class="op" id="6127641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6127646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6127650">}</span>&nbsp;<span class="keyword" id="6127652">else</span>&nbsp;<span class="keyword" id="6127657">if</span>&nbsp;<span class="builtinfunc" id="6127660">len</span><span class="op" id="6127663">(</span><span class="ident" id="6127664">oldf</span><span class="op" id="6127668">.</span><span class="ident" id="6127669">parents</span><span class="op" id="6127676">)</span>&nbsp;<span class="op" id="6127678">&lt;</span>&nbsp;<span class="builtinfunc" id="6127680">len</span><span class="op" id="6127683">(</span><span class="ident" id="6127684">newf</span><span class="op" id="6127688">.</span><span class="ident" id="6127689">parents</span><span class="op" id="6127696">)</span>&nbsp;<span class="op" id="6127698">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127703">if</span>&nbsp;<span class="ident" id="6127706">newf</span><span class="op" id="6127710">.</span><span class="ident" id="6127711">parents</span><span class="op" id="6127718">[</span><span class="builtinfunc" id="6127719">len</span><span class="op" id="6127722">(</span><span class="ident" id="6127723">oldf</span><span class="op" id="6127727">.</span><span class="ident" id="6127728">parents</span><span class="op" id="6127735">)</span><span class="op" id="6127736">]</span>&nbsp;<span class="op" id="6127738">==</span>&nbsp;<span class="ident" id="6127741">oldf</span><span class="op" id="6127745">.</span><span class="ident" id="6127746">name</span>&nbsp;<span class="op" id="6127751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6127757">conflicts</span>&nbsp;<span class="op" id="6127767">=</span>&nbsp;<span class="builtinfunc" id="6127769">append</span><span class="op" id="6127775">(</span><span class="ident" id="6127776">conflicts</span><span class="op" id="6127785">,</span>&nbsp;<span class="ident" id="6127787">i</span><span class="op" id="6127788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6127793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6127797">}</span>&nbsp;<span class="keyword" id="6127799">else</span>&nbsp;<span class="op" id="6127804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127809">if</span>&nbsp;<span class="ident" id="6127812">newf</span><span class="op" id="6127816">.</span><span class="ident" id="6127817">name</span>&nbsp;<span class="op" id="6127822">==</span>&nbsp;<span class="ident" id="6127825">oldf</span><span class="op" id="6127829">.</span><span class="ident" id="6127830">name</span>&nbsp;<span class="op" id="6127835">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6127841">conflicts</span>&nbsp;<span class="op" id="6127851">=</span>&nbsp;<span class="builtinfunc" id="6127853">append</span><span class="op" id="6127859">(</span><span class="ident" id="6127860">conflicts</span><span class="op" id="6127869">,</span>&nbsp;<span class="ident" id="6127871">i</span><span class="op" id="6127872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6127877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6127881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6127884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6127887">//&nbsp;Without&nbsp;conflicts,&nbsp;add&nbsp;the&nbsp;new&nbsp;field&nbsp;and&nbsp;return.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127940">if</span>&nbsp;<span class="ident" id="6127943">conflicts</span>&nbsp;<span class="op" id="6127953">==</span>&nbsp;<span class="ident" id="6127956">nil</span>&nbsp;<span class="op" id="6127960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6127964">tinfo</span><span class="op" id="6127969">.</span><span class="ident" id="6127970">fields</span>&nbsp;<span class="op" id="6127977">=</span>&nbsp;<span class="builtinfunc" id="6127979">append</span><span class="op" id="6127985">(</span><span class="ident" id="6127986">tinfo</span><span class="op" id="6127991">.</span><span class="ident" id="6127992">fields</span><span class="op" id="6127998">,</span>&nbsp;<span class="op" id="6128000">*</span><span class="ident" id="6128001">newf</span><span class="op" id="6128005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6128009">return</span>&nbsp;<span class="ident" id="6128016">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6128021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6128025">//&nbsp;If&nbsp;any&nbsp;conflict&nbsp;is&nbsp;shallower,&nbsp;ignore&nbsp;the&nbsp;new&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6128081">//&nbsp;This&nbsp;matches&nbsp;the&nbsp;Go&nbsp;field&nbsp;resolution&nbsp;on&nbsp;embedding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6128136">for</span>&nbsp;<span class="ident" id="6128140">_</span><span class="op" id="6128141">,</span>&nbsp;<span class="ident" id="6128143">i</span>&nbsp;<span class="op" id="6128145">:=</span>&nbsp;<span class="keyword" id="6128148">range</span>&nbsp;<span class="ident" id="6128154">conflicts</span>&nbsp;<span class="op" id="6128164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6128168">if</span>&nbsp;<span class="builtinfunc" id="6128171">len</span><span class="op" id="6128174">(</span><span class="ident" id="6128175">tinfo</span><span class="op" id="6128180">.</span><span class="ident" id="6128181">fields</span><span class="op" id="6128187">[</span><span class="ident" id="6128188">i</span><span class="op" id="6128189">]</span><span class="op" id="6128190">.</span><span class="ident" id="6128191">idx</span><span class="op" id="6128194">)</span>&nbsp;<span class="op" id="6128196">&lt;</span>&nbsp;<span class="builtinfunc" id="6128198">len</span><span class="op" id="6128201">(</span><span class="ident" id="6128202">newf</span><span class="op" id="6128206">.</span><span class="ident" id="6128207">idx</span><span class="op" id="6128210">)</span>&nbsp;<span class="op" id="6128212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6128217">return</span>&nbsp;<span class="ident" id="6128224">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6128230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6128233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6128237">//&nbsp;Otherwise,&nbsp;if&nbsp;any&nbsp;of&nbsp;them&nbsp;is&nbsp;at&nbsp;the&nbsp;same&nbsp;depth&nbsp;level,&nbsp;it&#39;s&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6128310">for</span>&nbsp;<span class="ident" id="6128314">_</span><span class="op" id="6128315">,</span>&nbsp;<span class="ident" id="6128317">i</span>&nbsp;<span class="op" id="6128319">:=</span>&nbsp;<span class="keyword" id="6128322">range</span>&nbsp;<span class="ident" id="6128328">conflicts</span>&nbsp;<span class="op" id="6128338">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128342">oldf</span>&nbsp;<span class="op" id="6128347">:=</span>&nbsp;<span class="op" id="6128350">&amp;</span><span class="ident" id="6128351">tinfo</span><span class="op" id="6128356">.</span><span class="ident" id="6128357">fields</span><span class="op" id="6128363">[</span><span class="ident" id="6128364">i</span><span class="op" id="6128365">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6128369">if</span>&nbsp;<span class="builtinfunc" id="6128372">len</span><span class="op" id="6128375">(</span><span class="ident" id="6128376">oldf</span><span class="op" id="6128380">.</span><span class="ident" id="6128381">idx</span><span class="op" id="6128384">)</span>&nbsp;<span class="op" id="6128386">==</span>&nbsp;<span class="builtinfunc" id="6128389">len</span><span class="op" id="6128392">(</span><span class="ident" id="6128393">newf</span><span class="op" id="6128397">.</span><span class="ident" id="6128398">idx</span><span class="op" id="6128401">)</span>&nbsp;<span class="op" id="6128403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128408">f1</span>&nbsp;<span class="op" id="6128411">:=</span>&nbsp;<span class="ident" id="6128414">typ</span><span class="op" id="6128417">.</span><span class="ident" id="6128418">FieldByIndex</span><span class="op" id="6128430">(</span><span class="ident" id="6128431">oldf</span><span class="op" id="6128435">.</span><span class="ident" id="6128436">idx</span><span class="op" id="6128439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128444">f2</span>&nbsp;<span class="op" id="6128447">:=</span>&nbsp;<span class="ident" id="6128450">typ</span><span class="op" id="6128453">.</span><span class="ident" id="6128454">FieldByIndex</span><span class="op" id="6128466">(</span><span class="ident" id="6128467">newf</span><span class="op" id="6128471">.</span><span class="ident" id="6128472">idx</span><span class="op" id="6128475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6128480">return</span>&nbsp;<span class="op" id="6128487">&amp;</span><span class="ident" id="6128488">TagPathError</span><span class="op" id="6128500">{</span><span class="ident" id="6128501">typ</span><span class="op" id="6128504">,</span>&nbsp;<span class="ident" id="6128506">f1</span><span class="op" id="6128508">.</span><span class="ident" id="6128509">Name</span><span class="op" id="6128513">,</span>&nbsp;<span class="ident" id="6128515">f1</span><span class="op" id="6128517">.</span><span class="ident" id="6128518">Tag</span><span class="op" id="6128521">.</span><span class="ident" id="6128522">Get</span><span class="op" id="6128525">(</span><span class="string" id="6128526">&#34;xml&#34;</span><span class="op" id="6128531">)</span><span class="op" id="6128532">,</span>&nbsp;<span class="ident" id="6128534">f2</span><span class="op" id="6128536">.</span><span class="ident" id="6128537">Name</span><span class="op" id="6128541">,</span>&nbsp;<span class="ident" id="6128543">f2</span><span class="op" id="6128545">.</span><span class="ident" id="6128546">Tag</span><span class="op" id="6128549">.</span><span class="ident" id="6128550">Get</span><span class="op" id="6128553">(</span><span class="string" id="6128554">&#34;xml&#34;</span><span class="op" id="6128559">)</span><span class="op" id="6128560">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6128564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6128567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6128571">//&nbsp;Otherwise,&nbsp;the&nbsp;new&nbsp;field&nbsp;is&nbsp;shallower,&nbsp;and&nbsp;thus&nbsp;takes&nbsp;precedence,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6128641">//&nbsp;so&nbsp;drop&nbsp;the&nbsp;conflicting&nbsp;fields&nbsp;from&nbsp;tinfo&nbsp;and&nbsp;append&nbsp;the&nbsp;new&nbsp;one.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6128711">for</span>&nbsp;<span class="ident" id="6128715">c</span>&nbsp;<span class="op" id="6128717">:=</span>&nbsp;<span class="builtinfunc" id="6128720">len</span><span class="op" id="6128723">(</span><span class="ident" id="6128724">conflicts</span><span class="op" id="6128733">)</span>&nbsp;<span class="op" id="6128735">-</span>&nbsp;<span class="num" id="6128737">1</span><span class="op" id="6128738">;</span>&nbsp;<span class="ident" id="6128740">c</span>&nbsp;<span class="op" id="6128742">&gt;=</span>&nbsp;<span class="num" id="6128745">0</span><span class="op" id="6128746">;</span>&nbsp;<span class="ident" id="6128748">c</span><span class="op" id="6128749">--</span>&nbsp;<span class="op" id="6128752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128756">i</span>&nbsp;<span class="op" id="6128758">:=</span>&nbsp;<span class="ident" id="6128761">conflicts</span><span class="op" id="6128770">[</span><span class="ident" id="6128771">c</span><span class="op" id="6128772">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6128776">copy</span><span class="op" id="6128780">(</span><span class="ident" id="6128781">tinfo</span><span class="op" id="6128786">.</span><span class="ident" id="6128787">fields</span><span class="op" id="6128793">[</span><span class="ident" id="6128794">i</span><span class="op" id="6128795">:</span><span class="op" id="6128796">]</span><span class="op" id="6128797">,</span>&nbsp;<span class="ident" id="6128799">tinfo</span><span class="op" id="6128804">.</span><span class="ident" id="6128805">fields</span><span class="op" id="6128811">[</span><span class="ident" id="6128812">i</span><span class="op" id="6128813">+</span><span class="num" id="6128814">1</span><span class="op" id="6128815">:</span><span class="op" id="6128816">]</span><span class="op" id="6128817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128821">tinfo</span><span class="op" id="6128826">.</span><span class="ident" id="6128827">fields</span>&nbsp;<span class="op" id="6128834">=</span>&nbsp;<span class="ident" id="6128836">tinfo</span><span class="op" id="6128841">.</span><span class="ident" id="6128842">fields</span><span class="op" id="6128848">[</span><span class="op" id="6128849">:</span><span class="builtinfunc" id="6128850">len</span><span class="op" id="6128853">(</span><span class="ident" id="6128854">tinfo</span><span class="op" id="6128859">.</span><span class="ident" id="6128860">fields</span><span class="op" id="6128866">)</span><span class="op" id="6128867">-</span><span class="num" id="6128868">1</span><span class="op" id="6128869">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6128872">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128875">tinfo</span><span class="op" id="6128880">.</span><span class="ident" id="6128881">fields</span>&nbsp;<span class="op" id="6128888">=</span>&nbsp;<span class="builtinfunc" id="6128890">append</span><span class="op" id="6128896">(</span><span class="ident" id="6128897">tinfo</span><span class="op" id="6128902">.</span><span class="ident" id="6128903">fields</span><span class="op" id="6128909">,</span>&nbsp;<span class="op" id="6128911">*</span><span class="ident" id="6128912">newf</span><span class="op" id="6128916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6128919">return</span>&nbsp;<span class="ident" id="6128926">nil</span><br>
<span class="lineno"></span><span class="op" id="6128930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6128933">//&nbsp;A&nbsp;TagPathError&nbsp;represents&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;unmarshalling&nbsp;process</span><br>
<span class="lineno">335</span><span class="comment" id="6129000">//&nbsp;caused&nbsp;by&nbsp;the&nbsp;use&nbsp;of&nbsp;field&nbsp;tags&nbsp;with&nbsp;conflicting&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="6129059">type</span>&nbsp;<span class="ident" id="6129064">TagPathError</span>&nbsp;<span class="keyword" id="6129077">struct</span>&nbsp;<span class="op" id="6129084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6129087">Struct</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6129100">reflect</span><span class="op" id="6129107">.</span><span class="ident" id="6129108">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6129114">Field1</span><span class="op" id="6129120">,</span>&nbsp;<span class="ident" id="6129122">Tag1</span>&nbsp;<span class="builtintype" id="6129127">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6129135">Field2</span><span class="op" id="6129141">,</span>&nbsp;<span class="ident" id="6129143">Tag2</span>&nbsp;<span class="builtintype" id="6129148">string</span><br>
<span class="lineno">340</span><span class="op" id="6129155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6129158">func</span>&nbsp;<span class="op" id="6129163">(</span><span class="ident" id="6129164">e</span>&nbsp;<span class="op" id="6129166">*</span><span class="ident" id="6129167">TagPathError</span><span class="op" id="6129179">)</span>&nbsp;<span class="ident" id="6129181">Error</span><span class="op" id="6129186">(</span><span class="op" id="6129187">)</span>&nbsp;<span class="builtintype" id="6129189">string</span>&nbsp;<span class="op" id="6129196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6129199">return</span>&nbsp;<span class="ident" id="6129206">fmt</span><span class="op" id="6129209">.</span><span class="ident" id="6129210">Sprintf</span><span class="op" id="6129217">(</span><span class="string" id="6129218">&#34;%s&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&nbsp;conflicts&nbsp;with&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&#34;</span><span class="op" id="6129279">,</span>&nbsp;<span class="ident" id="6129281">e</span><span class="op" id="6129282">.</span><span class="ident" id="6129283">Struct</span><span class="op" id="6129289">,</span>&nbsp;<span class="ident" id="6129291">e</span><span class="op" id="6129292">.</span><span class="ident" id="6129293">Field1</span><span class="op" id="6129299">,</span>&nbsp;<span class="ident" id="6129301">e</span><span class="op" id="6129302">.</span><span class="ident" id="6129303">Tag1</span><span class="op" id="6129307">,</span>&nbsp;<span class="ident" id="6129309">e</span><span class="op" id="6129310">.</span><span class="ident" id="6129311">Field2</span><span class="op" id="6129317">,</span>&nbsp;<span class="ident" id="6129319">e</span><span class="op" id="6129320">.</span><span class="ident" id="6129321">Tag2</span><span class="op" id="6129325">)</span><br>
<span class="lineno"></span><span class="op" id="6129327">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="comment" id="6129330">//&nbsp;value&nbsp;returns&nbsp;v&#39;s&nbsp;field&nbsp;value&nbsp;corresponding&nbsp;to&nbsp;finfo.</span><br>
<span class="lineno"></span><span class="comment" id="6129387">//&nbsp;It&#39;s&nbsp;equivalent&nbsp;to&nbsp;v.FieldByIndex(finfo.idx),&nbsp;but&nbsp;initializes</span><br>
<span class="lineno"></span><span class="comment" id="6129452">//&nbsp;and&nbsp;dereferences&nbsp;pointers&nbsp;as&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="6129495">func</span>&nbsp;<span class="op" id="6129500">(</span><span class="ident" id="6129501">finfo</span>&nbsp;<span class="op" id="6129507">*</span><span class="ident" id="6129508">fieldInfo</span><span class="op" id="6129517">)</span>&nbsp;<span class="ident" id="6129519">value</span><span class="op" id="6129524">(</span><span class="ident" id="6129525">v</span>&nbsp;<span class="ident" id="6129527">reflect</span><span class="op" id="6129534">.</span><span class="ident" id="6129535">Value</span><span class="op" id="6129540">)</span>&nbsp;<span class="ident" id="6129542">reflect</span><span class="op" id="6129549">.</span><span class="ident" id="6129550">Value</span>&nbsp;<span class="op" id="6129556">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6129559">for</span>&nbsp;<span class="ident" id="6129563">i</span><span class="op" id="6129564">,</span>&nbsp;<span class="ident" id="6129566">x</span>&nbsp;<span class="op" id="6129568">:=</span>&nbsp;<span class="keyword" id="6129571">range</span>&nbsp;<span class="ident" id="6129577">finfo</span><span class="op" id="6129582">.</span><span class="ident" id="6129583">idx</span>&nbsp;<span class="op" id="6129587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6129591">if</span>&nbsp;<span class="ident" id="6129594">i</span>&nbsp;<span class="op" id="6129596">&gt;</span>&nbsp;<span class="num" id="6129598">0</span>&nbsp;<span class="op" id="6129600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6129605">t</span>&nbsp;<span class="op" id="6129607">:=</span>&nbsp;<span class="ident" id="6129610">v</span><span class="op" id="6129611">.</span><span class="ident" id="6129612">Type</span><span class="op" id="6129616">(</span><span class="op" id="6129617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6129622">if</span>&nbsp;<span class="ident" id="6129625">t</span><span class="op" id="6129626">.</span><span class="ident" id="6129627">Kind</span><span class="op" id="6129631">(</span><span class="op" id="6129632">)</span>&nbsp;<span class="op" id="6129634">==</span>&nbsp;<span class="ident" id="6129637">reflect</span><span class="op" id="6129644">.</span><span class="ident" id="6129645">Ptr</span>&nbsp;<span class="op" id="6129649">&amp;&amp;</span>&nbsp;<span class="ident" id="6129652">t</span><span class="op" id="6129653">.</span><span class="ident" id="6129654">Elem</span><span class="op" id="6129658">(</span><span class="op" id="6129659">)</span><span class="op" id="6129660">.</span><span class="ident" id="6129661">Kind</span><span class="op" id="6129665">(</span><span class="op" id="6129666">)</span>&nbsp;<span class="op" id="6129668">==</span>&nbsp;<span class="ident" id="6129671">reflect</span><span class="op" id="6129678">.</span><span class="ident" id="6129679">Struct</span>&nbsp;<span class="op" id="6129686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6129692">if</span>&nbsp;<span class="ident" id="6129695">v</span><span class="op" id="6129696">.</span><span class="ident" id="6129697">IsNil</span><span class="op" id="6129702">(</span><span class="op" id="6129703">)</span>&nbsp;<span class="op" id="6129705">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6129712">v</span><span class="op" id="6129713">.</span><span class="ident" id="6129714">Set</span><span class="op" id="6129717">(</span><span class="ident" id="6129718">reflect</span><span class="op" id="6129725">.</span><span class="ident" id="6129726">New</span><span class="op" id="6129729">(</span><span class="ident" id="6129730">v</span><span class="op" id="6129731">.</span><span class="ident" id="6129732">Type</span><span class="op" id="6129736">(</span><span class="op" id="6129737">)</span><span class="op" id="6129738">.</span><span class="ident" id="6129739">Elem</span><span class="op" id="6129743">(</span><span class="op" id="6129744">)</span><span class="op" id="6129745">)</span><span class="op" id="6129746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6129752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6129758">v</span>&nbsp;<span class="op" id="6129760">=</span>&nbsp;<span class="ident" id="6129762">v</span><span class="op" id="6129763">.</span><span class="ident" id="6129764">Elem</span><span class="op" id="6129768">(</span><span class="op" id="6129769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6129774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6129778">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6129782">v</span>&nbsp;<span class="op" id="6129784">=</span>&nbsp;<span class="ident" id="6129786">v</span><span class="op" id="6129787">.</span><span class="ident" id="6129788">Field</span><span class="op" id="6129793">(</span><span class="ident" id="6129794">x</span><span class="op" id="6129795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6129798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6129801">return</span>&nbsp;<span class="ident" id="6129808">v</span><br>
<span class="lineno"></span><span class="op" id="6129810">}</span>
</div>
</body>
</html>
