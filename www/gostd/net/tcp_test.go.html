<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html" class="current">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6763301">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6763356">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6763410">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6763461">package</span>&nbsp;<span class="ident" id="6763469">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6763474">import</span>&nbsp;<span class="op" id="6763481">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6763484">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6763491">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6763497">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6763508">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6763519">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6763527">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6763538">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6763545">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6763548">func</span>&nbsp;<span class="ident" id="6763553">BenchmarkTCP4OneShot</span><span class="op" id="6763573">(</span><span class="ident" id="6763574">b</span>&nbsp;<span class="op" id="6763576">*</span><span class="ident" id="6763577"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6763584">.</span><span class="ident" id="6763585"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="6763586">)</span>&nbsp;<span class="op" id="6763588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6763591"><a href="/gostd/net/tcp_test.go.html#6764525">benchmarkTCP</a></span><span class="op" id="6763603">(</span><span class="ident" id="6763604"><a href="/gostd/net/tcp_test.go.html#6763574">b</a></span><span class="op" id="6763605">,</span>&nbsp;<span class="builtintype" id="6763607">false</span><span class="op" id="6763612">,</span>&nbsp;<span class="builtintype" id="6763614">false</span><span class="op" id="6763619">,</span>&nbsp;<span class="string" id="6763621">&#34;127.0.0.1:0&#34;</span><span class="op" id="6763634">)</span><br>
<span class="lineno"></span><span class="op" id="6763636">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6763639">func</span>&nbsp;<span class="ident" id="6763644">BenchmarkTCP4OneShotTimeout</span><span class="op" id="6763671">(</span><span class="ident" id="6763672">b</span>&nbsp;<span class="op" id="6763674">*</span><span class="ident" id="6763675"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6763682">.</span><span class="ident" id="6763683"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="6763684">)</span>&nbsp;<span class="op" id="6763686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6763689"><a href="/gostd/net/tcp_test.go.html#6764525">benchmarkTCP</a></span><span class="op" id="6763701">(</span><span class="ident" id="6763702"><a href="/gostd/net/tcp_test.go.html#6763672">b</a></span><span class="op" id="6763703">,</span>&nbsp;<span class="builtintype" id="6763705">false</span><span class="op" id="6763710">,</span>&nbsp;<span class="builtintype" id="6763712">true</span><span class="op" id="6763716">,</span>&nbsp;<span class="string" id="6763718">&#34;127.0.0.1:0&#34;</span><span class="op" id="6763731">)</span><br>
<span class="lineno"></span><span class="op" id="6763733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6763736">func</span>&nbsp;<span class="ident" id="6763741">BenchmarkTCP4Persistent</span><span class="op" id="6763764">(</span><span class="ident" id="6763765">b</span>&nbsp;<span class="op" id="6763767">*</span><span class="ident" id="6763768"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6763775">.</span><span class="ident" id="6763776"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="6763777">)</span>&nbsp;<span class="op" id="6763779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6763782"><a href="/gostd/net/tcp_test.go.html#6764525">benchmarkTCP</a></span><span class="op" id="6763794">(</span><span class="ident" id="6763795"><a href="/gostd/net/tcp_test.go.html#6763765">b</a></span><span class="op" id="6763796">,</span>&nbsp;<span class="builtintype" id="6763798">true</span><span class="op" id="6763802">,</span>&nbsp;<span class="builtintype" id="6763804">false</span><span class="op" id="6763809">,</span>&nbsp;<span class="string" id="6763811">&#34;127.0.0.1:0&#34;</span><span class="op" id="6763824">)</span><br>
<span class="lineno"></span><span class="op" id="6763826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6763829">func</span>&nbsp;<span class="ident" id="6763834">BenchmarkTCP4PersistentTimeout</span><span class="op" id="6763864">(</span><span class="ident" id="6763865">b</span>&nbsp;<span class="op" id="6763867">*</span><span class="ident" id="6763868"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6763875">.</span><span class="ident" id="6763876"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="6763877">)</span>&nbsp;<span class="op" id="6763879">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6763882"><a href="/gostd/net/tcp_test.go.html#6764525">benchmarkTCP</a></span><span class="op" id="6763894">(</span><span class="ident" id="6763895"><a href="/gostd/net/tcp_test.go.html#6763865">b</a></span><span class="op" id="6763896">,</span>&nbsp;<span class="builtintype" id="6763898">true</span><span class="op" id="6763902">,</span>&nbsp;<span class="builtintype" id="6763904">true</span><span class="op" id="6763908">,</span>&nbsp;<span class="string" id="6763910">&#34;127.0.0.1:0&#34;</span><span class="op" id="6763923">)</span><br>
<span class="lineno"></span><span class="op" id="6763925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6763928">func</span>&nbsp;<span class="ident" id="6763933">BenchmarkTCP6OneShot</span><span class="op" id="6763953">(</span><span class="ident" id="6763954">b</span>&nbsp;<span class="op" id="6763956">*</span><span class="ident" id="6763957"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6763964">.</span><span class="ident" id="6763965"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="6763966">)</span>&nbsp;<span class="op" id="6763968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6763971">if</span>&nbsp;<span class="op" id="6763974">!</span><span class="ident" id="6763975"><a href="/gostd/net/ipsock.go.html#3309710">supportsIPv6</a></span>&nbsp;<span class="op" id="6763988">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6763992"><a href="/gostd/net/tcp_test.go.html#6763954">b</a></span><span class="op" id="6763993">.</span><span class="ident" id="6763994"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="6763998">(</span><span class="string" id="6763999">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6764022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6764025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764028"><a href="/gostd/net/tcp_test.go.html#6764525">benchmarkTCP</a></span><span class="op" id="6764040">(</span><span class="ident" id="6764041"><a href="/gostd/net/tcp_test.go.html#6763954">b</a></span><span class="op" id="6764042">,</span>&nbsp;<span class="builtintype" id="6764044">false</span><span class="op" id="6764049">,</span>&nbsp;<span class="builtintype" id="6764051">false</span><span class="op" id="6764056">,</span>&nbsp;<span class="string" id="6764058">&#34;[::1]:0&#34;</span><span class="op" id="6764067">)</span><br>
<span class="lineno"></span><span class="op" id="6764069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="6764072">func</span>&nbsp;<span class="ident" id="6764077">BenchmarkTCP6OneShotTimeout</span><span class="op" id="6764104">(</span><span class="ident" id="6764105">b</span>&nbsp;<span class="op" id="6764107">*</span><span class="ident" id="6764108"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6764115">.</span><span class="ident" id="6764116"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="6764117">)</span>&nbsp;<span class="op" id="6764119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6764122">if</span>&nbsp;<span class="op" id="6764125">!</span><span class="ident" id="6764126"><a href="/gostd/net/ipsock.go.html#3309710">supportsIPv6</a></span>&nbsp;<span class="op" id="6764139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764143"><a href="/gostd/net/tcp_test.go.html#6764105">b</a></span><span class="op" id="6764144">.</span><span class="ident" id="6764145"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="6764149">(</span><span class="string" id="6764150">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6764173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6764176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764179"><a href="/gostd/net/tcp_test.go.html#6764525">benchmarkTCP</a></span><span class="op" id="6764191">(</span><span class="ident" id="6764192"><a href="/gostd/net/tcp_test.go.html#6764105">b</a></span><span class="op" id="6764193">,</span>&nbsp;<span class="builtintype" id="6764195">false</span><span class="op" id="6764200">,</span>&nbsp;<span class="builtintype" id="6764202">true</span><span class="op" id="6764206">,</span>&nbsp;<span class="string" id="6764208">&#34;[::1]:0&#34;</span><span class="op" id="6764217">)</span><br>
<span class="lineno">45</span><span class="op" id="6764219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6764222">func</span>&nbsp;<span class="ident" id="6764227">BenchmarkTCP6Persistent</span><span class="op" id="6764250">(</span><span class="ident" id="6764251">b</span>&nbsp;<span class="op" id="6764253">*</span><span class="ident" id="6764254"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6764261">.</span><span class="ident" id="6764262"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="6764263">)</span>&nbsp;<span class="op" id="6764265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6764268">if</span>&nbsp;<span class="op" id="6764271">!</span><span class="ident" id="6764272"><a href="/gostd/net/ipsock.go.html#3309710">supportsIPv6</a></span>&nbsp;<span class="op" id="6764285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764289"><a href="/gostd/net/tcp_test.go.html#6764251">b</a></span><span class="op" id="6764290">.</span><span class="ident" id="6764291"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="6764295">(</span><span class="string" id="6764296">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6764319">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6764322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764325"><a href="/gostd/net/tcp_test.go.html#6764525">benchmarkTCP</a></span><span class="op" id="6764337">(</span><span class="ident" id="6764338"><a href="/gostd/net/tcp_test.go.html#6764251">b</a></span><span class="op" id="6764339">,</span>&nbsp;<span class="builtintype" id="6764341">true</span><span class="op" id="6764345">,</span>&nbsp;<span class="builtintype" id="6764347">false</span><span class="op" id="6764352">,</span>&nbsp;<span class="string" id="6764354">&#34;[::1]:0&#34;</span><span class="op" id="6764363">)</span><br>
<span class="lineno"></span><span class="op" id="6764365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6764368">func</span>&nbsp;<span class="ident" id="6764373">BenchmarkTCP6PersistentTimeout</span><span class="op" id="6764403">(</span><span class="ident" id="6764404">b</span>&nbsp;<span class="op" id="6764406">*</span><span class="ident" id="6764407"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6764414">.</span><span class="ident" id="6764415"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="6764416">)</span>&nbsp;<span class="op" id="6764418">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6764421">if</span>&nbsp;<span class="op" id="6764424">!</span><span class="ident" id="6764425"><a href="/gostd/net/ipsock.go.html#3309710">supportsIPv6</a></span>&nbsp;<span class="op" id="6764438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764442"><a href="/gostd/net/tcp_test.go.html#6764404">b</a></span><span class="op" id="6764443">.</span><span class="ident" id="6764444"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="6764448">(</span><span class="string" id="6764449">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6764472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6764475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764478"><a href="/gostd/net/tcp_test.go.html#6764525">benchmarkTCP</a></span><span class="op" id="6764490">(</span><span class="ident" id="6764491"><a href="/gostd/net/tcp_test.go.html#6764404">b</a></span><span class="op" id="6764492">,</span>&nbsp;<span class="builtintype" id="6764494">true</span><span class="op" id="6764498">,</span>&nbsp;<span class="builtintype" id="6764500">true</span><span class="op" id="6764504">,</span>&nbsp;<span class="string" id="6764506">&#34;[::1]:0&#34;</span><span class="op" id="6764515">)</span><br>
<span class="lineno"></span><span class="op" id="6764517">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="6764520">func</span>&nbsp;<span class="ident" id="6764525">benchmarkTCP</span><span class="op" id="6764537">(</span><span class="ident" id="6764538">b</span>&nbsp;<span class="op" id="6764540">*</span><span class="ident" id="6764541"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6764548">.</span><span class="ident" id="6764549"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="6764550">,</span>&nbsp;<span class="ident" id="6764552">persistent</span><span class="op" id="6764562">,</span>&nbsp;<span class="ident" id="6764564">timeout</span>&nbsp;<span class="builtintype" id="6764572">bool</span><span class="op" id="6764576">,</span>&nbsp;<span class="ident" id="6764578">laddr</span>&nbsp;<span class="builtintype" id="6764584">string</span><span class="op" id="6764590">)</span>&nbsp;<span class="op" id="6764592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6764595">const</span>&nbsp;<span class="ident" id="6764601">msgLen</span>&nbsp;<span class="op" id="6764608">=</span>&nbsp;<span class="num" id="6764610">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764615">conns</span>&nbsp;<span class="op" id="6764621">:=</span>&nbsp;<span class="ident" id="6764624"><a href="/gostd/net/tcp_test.go.html#6764538">b</a></span><span class="op" id="6764625">.</span><span class="ident" id="6764626"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764629">numConcurrent</span>&nbsp;<span class="op" id="6764643">:=</span>&nbsp;<span class="ident" id="6764646"><a href="/gostd/net/tcp_test.go.html#6763508">runtime</a></span><span class="op" id="6764653">.</span><span class="ident" id="6764654"><a href="/gostd/runtime/debug.go.html#1521359">GOMAXPROCS</a></span><span class="op" id="6764664">(</span><span class="op" id="6764665">-</span><span class="num" id="6764666">1</span><span class="op" id="6764667">)</span>&nbsp;<span class="op" id="6764669">*</span>&nbsp;<span class="num" id="6764671">2</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764674">msgs</span>&nbsp;<span class="op" id="6764679">:=</span>&nbsp;<span class="num" id="6764682">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6764685">if</span>&nbsp;<span class="ident" id="6764688"><a href="/gostd/net/tcp_test.go.html#6764552">persistent</a></span>&nbsp;<span class="op" id="6764699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764703"><a href="/gostd/net/tcp_test.go.html#6764615">conns</a></span>&nbsp;<span class="op" id="6764709">=</span>&nbsp;<span class="ident" id="6764711"><a href="/gostd/net/tcp_test.go.html#6764629">numConcurrent</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764727"><a href="/gostd/net/tcp_test.go.html#6764674">msgs</a></span>&nbsp;<span class="op" id="6764732">=</span>&nbsp;<span class="ident" id="6764734"><a href="/gostd/net/tcp_test.go.html#6764538">b</a></span><span class="op" id="6764735">.</span><span class="ident" id="6764736"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span>&nbsp;<span class="op" id="6764738">/</span>&nbsp;<span class="ident" id="6764740"><a href="/gostd/net/tcp_test.go.html#6764615">conns</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6764748">if</span>&nbsp;<span class="ident" id="6764751"><a href="/gostd/net/tcp_test.go.html#6764674">msgs</a></span>&nbsp;<span class="op" id="6764756">==</span>&nbsp;<span class="num" id="6764759">0</span>&nbsp;<span class="op" id="6764761">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764766"><a href="/gostd/net/tcp_test.go.html#6764674">msgs</a></span>&nbsp;<span class="op" id="6764771">=</span>&nbsp;<span class="num" id="6764773">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6764777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6764781">if</span>&nbsp;<span class="ident" id="6764784"><a href="/gostd/net/tcp_test.go.html#6764615">conns</a></span>&nbsp;<span class="op" id="6764790">&gt;</span>&nbsp;<span class="ident" id="6764792"><a href="/gostd/net/tcp_test.go.html#6764538">b</a></span><span class="op" id="6764793">.</span><span class="ident" id="6764794"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span>&nbsp;<span class="op" id="6764796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764801"><a href="/gostd/net/tcp_test.go.html#6764615">conns</a></span>&nbsp;<span class="op" id="6764807">=</span>&nbsp;<span class="ident" id="6764809"><a href="/gostd/net/tcp_test.go.html#6764538">b</a></span><span class="op" id="6764810">.</span><span class="ident" id="6764811"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6764815">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6764818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764821">sendMsg</span>&nbsp;<span class="op" id="6764829">:=</span>&nbsp;<span class="keyword" id="6764832">func</span><span class="op" id="6764836">(</span><span class="ident" id="6764837">c</span>&nbsp;<span class="ident" id="6764839"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6764843">,</span>&nbsp;<span class="ident" id="6764845">buf</span>&nbsp;<span class="op" id="6764849">[</span><span class="op" id="6764850">]</span><span class="builtintype" id="6764851">byte</span><span class="op" id="6764855">)</span>&nbsp;<span class="builtintype" id="6764857">bool</span>&nbsp;<span class="op" id="6764862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764866">n</span><span class="op" id="6764867">,</span>&nbsp;<span class="ident" id="6764869">err</span>&nbsp;<span class="op" id="6764873">:=</span>&nbsp;<span class="ident" id="6764876"><a href="/gostd/net/tcp_test.go.html#6764837">c</a></span><span class="op" id="6764877">.</span><span class="ident" id="6764878"><a href="/gostd/net/net.go.html#3334839">Write</a></span><span class="op" id="6764883">(</span><span class="ident" id="6764884"><a href="/gostd/net/tcp_test.go.html#6764845">buf</a></span><span class="op" id="6764887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6764891">if</span>&nbsp;<span class="ident" id="6764894"><a href="/gostd/net/tcp_test.go.html#6764866">n</a></span>&nbsp;<span class="op" id="6764896">!=</span>&nbsp;<span class="builtinfunc" id="6764899">len</span><span class="op" id="6764902">(</span><span class="ident" id="6764903"><a href="/gostd/net/tcp_test.go.html#6764845">buf</a></span><span class="op" id="6764906">)</span>&nbsp;<span class="op" id="6764908">||</span>&nbsp;<span class="ident" id="6764911"><a href="/gostd/net/tcp_test.go.html#6764869">err</a></span>&nbsp;<span class="op" id="6764915">!=</span>&nbsp;<span class="builtintype" id="6764918">nil</span>&nbsp;<span class="op" id="6764922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764927"><a href="/gostd/net/tcp_test.go.html#6764538">b</a></span><span class="op" id="6764928">.</span><span class="ident" id="6764929"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="6764933">(</span><span class="string" id="6764934">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6764952">,</span>&nbsp;<span class="ident" id="6764954"><a href="/gostd/net/tcp_test.go.html#6764869">err</a></span><span class="op" id="6764957">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6764962">return</span>&nbsp;<span class="builtintype" id="6764969">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6764977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6764981">return</span>&nbsp;<span class="builtintype" id="6764988">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6764994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6764997">recvMsg</span>&nbsp;<span class="op" id="6765005">:=</span>&nbsp;<span class="keyword" id="6765008">func</span><span class="op" id="6765012">(</span><span class="ident" id="6765013">c</span>&nbsp;<span class="ident" id="6765015"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6765019">,</span>&nbsp;<span class="ident" id="6765021">buf</span>&nbsp;<span class="op" id="6765025">[</span><span class="op" id="6765026">]</span><span class="builtintype" id="6765027">byte</span><span class="op" id="6765031">)</span>&nbsp;<span class="builtintype" id="6765033">bool</span>&nbsp;<span class="op" id="6765038">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765042">for</span>&nbsp;<span class="ident" id="6765046">read</span>&nbsp;<span class="op" id="6765051">:=</span>&nbsp;<span class="num" id="6765054">0</span><span class="op" id="6765055">;</span>&nbsp;<span class="ident" id="6765057"><a href="/gostd/net/tcp_test.go.html#6765046">read</a></span>&nbsp;<span class="op" id="6765062">!=</span>&nbsp;<span class="builtinfunc" id="6765065">len</span><span class="op" id="6765068">(</span><span class="ident" id="6765069"><a href="/gostd/net/tcp_test.go.html#6765021">buf</a></span><span class="op" id="6765072">)</span><span class="op" id="6765073">;</span>&nbsp;<span class="op" id="6765075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6765080">n</span><span class="op" id="6765081">,</span>&nbsp;<span class="ident" id="6765083">err</span>&nbsp;<span class="op" id="6765087">:=</span>&nbsp;<span class="ident" id="6765090"><a href="/gostd/net/tcp_test.go.html#6765013">c</a></span><span class="op" id="6765091">.</span><span class="ident" id="6765092"><a href="/gostd/net/net.go.html#3334618">Read</a></span><span class="op" id="6765096">(</span><span class="ident" id="6765097"><a href="/gostd/net/tcp_test.go.html#6765021">buf</a></span><span class="op" id="6765100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6765105"><a href="/gostd/net/tcp_test.go.html#6765046">read</a></span>&nbsp;<span class="op" id="6765110">+=</span>&nbsp;<span class="ident" id="6765113"><a href="/gostd/net/tcp_test.go.html#6765080">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765118">if</span>&nbsp;<span class="ident" id="6765121"><a href="/gostd/net/tcp_test.go.html#6765083">err</a></span>&nbsp;<span class="op" id="6765125">!=</span>&nbsp;<span class="builtintype" id="6765128">nil</span>&nbsp;<span class="op" id="6765132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6765138"><a href="/gostd/net/tcp_test.go.html#6764538">b</a></span><span class="op" id="6765139">.</span><span class="ident" id="6765140"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="6765144">(</span><span class="string" id="6765145">&#34;Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6765162">,</span>&nbsp;<span class="ident" id="6765164"><a href="/gostd/net/tcp_test.go.html#6765083">err</a></span><span class="op" id="6765167">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765173">return</span>&nbsp;<span class="builtintype" id="6765180">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6765189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6765193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765197">return</span>&nbsp;<span class="builtintype" id="6765204">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6765210">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6765213">ln</span><span class="op" id="6765215">,</span>&nbsp;<span class="ident" id="6765217">err</span>&nbsp;<span class="op" id="6765221">:=</span>&nbsp;<span class="ident" id="6765224"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="6765230">(</span><span class="string" id="6765231">&#34;tcp&#34;</span><span class="op" id="6765236">,</span>&nbsp;<span class="ident" id="6765238"><a href="/gostd/net/tcp_test.go.html#6764578">laddr</a></span><span class="op" id="6765243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765246">if</span>&nbsp;<span class="ident" id="6765249"><a href="/gostd/net/tcp_test.go.html#6765217">err</a></span>&nbsp;<span class="op" id="6765253">!=</span>&nbsp;<span class="builtintype" id="6765256">nil</span>&nbsp;<span class="op" id="6765260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6765264"><a href="/gostd/net/tcp_test.go.html#6764538">b</a></span><span class="op" id="6765265">.</span><span class="ident" id="6765266"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6765272">(</span><span class="string" id="6765273">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6765292">,</span>&nbsp;<span class="ident" id="6765294"><a href="/gostd/net/tcp_test.go.html#6765217">err</a></span><span class="op" id="6765297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6765300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765303">defer</span>&nbsp;<span class="ident" id="6765309"><a href="/gostd/net/tcp_test.go.html#6765213">ln</a></span><span class="op" id="6765311">.</span><span class="ident" id="6765312"><a href="/gostd/net/net.go.html#3340928">Close</a></span><span class="op" id="6765317">(</span><span class="op" id="6765318">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6765321">serverSem</span>&nbsp;<span class="op" id="6765331">:=</span>&nbsp;<span class="builtinfunc" id="6765334">make</span><span class="op" id="6765338">(</span><span class="keyword" id="6765339">chan</span>&nbsp;<span class="builtintype" id="6765344">bool</span><span class="op" id="6765348">,</span>&nbsp;<span class="ident" id="6765350"><a href="/gostd/net/tcp_test.go.html#6764629">numConcurrent</a></span><span class="op" id="6765363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6765366">//&nbsp;Acceptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765380">go</span>&nbsp;<span class="keyword" id="6765383">func</span><span class="op" id="6765387">(</span><span class="op" id="6765388">)</span>&nbsp;<span class="op" id="6765390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765394">for</span>&nbsp;<span class="op" id="6765398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6765403">c</span><span class="op" id="6765404">,</span>&nbsp;<span class="ident" id="6765406">err</span>&nbsp;<span class="op" id="6765410">:=</span>&nbsp;<span class="ident" id="6765413"><a href="/gostd/net/tcp_test.go.html#6765213">ln</a></span><span class="op" id="6765415">.</span><span class="ident" id="6765416"><a href="/gostd/net/net.go.html#3340795">Accept</a></span><span class="op" id="6765422">(</span><span class="op" id="6765423">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765428">if</span>&nbsp;<span class="ident" id="6765431"><a href="/gostd/net/tcp_test.go.html#6765406">err</a></span>&nbsp;<span class="op" id="6765435">!=</span>&nbsp;<span class="builtintype" id="6765438">nil</span>&nbsp;<span class="op" id="6765442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765448">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6765457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6765462"><a href="/gostd/net/tcp_test.go.html#6765321">serverSem</a></span>&nbsp;<span class="op" id="6765472">&lt;-</span>&nbsp;<span class="builtintype" id="6765475">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6765483">//&nbsp;Server&nbsp;connection.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765508">go</span>&nbsp;<span class="keyword" id="6765511">func</span><span class="op" id="6765515">(</span><span class="ident" id="6765516">c</span>&nbsp;<span class="ident" id="6765518"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6765522">)</span>&nbsp;<span class="op" id="6765524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765530">defer</span>&nbsp;<span class="keyword" id="6765536">func</span><span class="op" id="6765540">(</span><span class="op" id="6765541">)</span>&nbsp;<span class="op" id="6765543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6765550"><a href="/gostd/net/tcp_test.go.html#6765516">c</a></span><span class="op" id="6765551">.</span><span class="ident" id="6765552"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6765557">(</span><span class="op" id="6765558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6765565">&lt;-</span><span class="ident" id="6765567"><a href="/gostd/net/tcp_test.go.html#6765321">serverSem</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6765581">}</span><span class="op" id="6765582">(</span><span class="op" id="6765583">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765589">if</span>&nbsp;<span class="ident" id="6765592"><a href="/gostd/net/tcp_test.go.html#6764564">timeout</a></span>&nbsp;<span class="op" id="6765600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6765607"><a href="/gostd/net/tcp_test.go.html#6765516">c</a></span><span class="op" id="6765608">.</span><span class="ident" id="6765609"><a href="/gostd/net/net.go.html#3335726">SetDeadline</a></span><span class="op" id="6765620">(</span><span class="ident" id="6765621"><a href="/gostd/net/tcp_test.go.html#6763538">time</a></span><span class="op" id="6765625">.</span><span class="ident" id="6765626"><a href="/gostd/time/time.go.html#2743088">Now</a></span><span class="op" id="6765629">(</span><span class="op" id="6765630">)</span><span class="op" id="6765631">.</span><span class="ident" id="6765632"><a href="/gostd/time/time.go.html#2738615">Add</a></span><span class="op" id="6765635">(</span><span class="ident" id="6765636"><a href="/gostd/net/tcp_test.go.html#6763538">time</a></span><span class="op" id="6765640">.</span><span class="ident" id="6765641"><a href="/gostd/time/time.go.html#2734941">Hour</a></span><span class="op" id="6765645">)</span><span class="op" id="6765646">)</span>&nbsp;<span class="comment" id="6765648">//&nbsp;Not&nbsp;intended&nbsp;to&nbsp;fire.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6765677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765683">var</span>&nbsp;<span class="ident" id="6765687">buf</span>&nbsp;<span class="op" id="6765691">[</span><span class="ident" id="6765692"><a href="/gostd/net/tcp_test.go.html#6764601">msgLen</a></span><span class="op" id="6765698">]</span><span class="builtintype" id="6765699">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765708">for</span>&nbsp;<span class="ident" id="6765712">m</span>&nbsp;<span class="op" id="6765714">:=</span>&nbsp;<span class="num" id="6765717">0</span><span class="op" id="6765718">;</span>&nbsp;<span class="ident" id="6765720"><a href="/gostd/net/tcp_test.go.html#6765712">m</a></span>&nbsp;<span class="op" id="6765722">&lt;</span>&nbsp;<span class="ident" id="6765724"><a href="/gostd/net/tcp_test.go.html#6764674">msgs</a></span><span class="op" id="6765728">;</span>&nbsp;<span class="ident" id="6765730"><a href="/gostd/net/tcp_test.go.html#6765712">m</a></span><span class="op" id="6765731">++</span>&nbsp;<span class="op" id="6765734">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765741">if</span>&nbsp;<span class="op" id="6765744">!</span><span class="ident" id="6765745"><a href="/gostd/net/tcp_test.go.html#6764997">recvMsg</a></span><span class="op" id="6765752">(</span><span class="ident" id="6765753"><a href="/gostd/net/tcp_test.go.html#6765516">c</a></span><span class="op" id="6765754">,</span>&nbsp;<span class="ident" id="6765756"><a href="/gostd/net/tcp_test.go.html#6765687">buf</a></span><span class="op" id="6765759">[</span><span class="op" id="6765760">:</span><span class="op" id="6765761">]</span><span class="op" id="6765762">)</span>&nbsp;<span class="op" id="6765764">||</span>&nbsp;<span class="op" id="6765767">!</span><span class="ident" id="6765768"><a href="/gostd/net/tcp_test.go.html#6764821">sendMsg</a></span><span class="op" id="6765775">(</span><span class="ident" id="6765776"><a href="/gostd/net/tcp_test.go.html#6765516">c</a></span><span class="op" id="6765777">,</span>&nbsp;<span class="ident" id="6765779"><a href="/gostd/net/tcp_test.go.html#6765687">buf</a></span><span class="op" id="6765782">[</span><span class="op" id="6765783">:</span><span class="op" id="6765784">]</span><span class="op" id="6765785">)</span>&nbsp;<span class="op" id="6765787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765795">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6765806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6765812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6765817">}</span><span class="op" id="6765818">(</span><span class="ident" id="6765819"><a href="/gostd/net/tcp_test.go.html#6765403">c</a></span><span class="op" id="6765820">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6765824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6765827">}</span><span class="op" id="6765828">(</span><span class="op" id="6765829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6765832">clientSem</span>&nbsp;<span class="op" id="6765842">:=</span>&nbsp;<span class="builtinfunc" id="6765845">make</span><span class="op" id="6765849">(</span><span class="keyword" id="6765850">chan</span>&nbsp;<span class="builtintype" id="6765855">bool</span><span class="op" id="6765859">,</span>&nbsp;<span class="ident" id="6765861"><a href="/gostd/net/tcp_test.go.html#6764629">numConcurrent</a></span><span class="op" id="6765874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765877">for</span>&nbsp;<span class="ident" id="6765881">i</span>&nbsp;<span class="op" id="6765883">:=</span>&nbsp;<span class="num" id="6765886">0</span><span class="op" id="6765887">;</span>&nbsp;<span class="ident" id="6765889"><a href="/gostd/net/tcp_test.go.html#6765881">i</a></span>&nbsp;<span class="op" id="6765891">&lt;</span>&nbsp;<span class="ident" id="6765893"><a href="/gostd/net/tcp_test.go.html#6764615">conns</a></span><span class="op" id="6765898">;</span>&nbsp;<span class="ident" id="6765900"><a href="/gostd/net/tcp_test.go.html#6765881">i</a></span><span class="op" id="6765901">++</span>&nbsp;<span class="op" id="6765904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6765908"><a href="/gostd/net/tcp_test.go.html#6765832">clientSem</a></span>&nbsp;<span class="op" id="6765918">&lt;-</span>&nbsp;<span class="builtintype" id="6765921">true</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6765928">//&nbsp;Client&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765952">go</span>&nbsp;<span class="keyword" id="6765955">func</span><span class="op" id="6765959">(</span><span class="op" id="6765960">)</span>&nbsp;<span class="op" id="6765962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6765967">defer</span>&nbsp;<span class="keyword" id="6765973">func</span><span class="op" id="6765977">(</span><span class="op" id="6765978">)</span>&nbsp;<span class="op" id="6765980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6765986">&lt;-</span><span class="ident" id="6765988"><a href="/gostd/net/tcp_test.go.html#6765832">clientSem</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6766001">}</span><span class="op" id="6766002">(</span><span class="op" id="6766003">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6766008">c</span><span class="op" id="6766009">,</span>&nbsp;<span class="ident" id="6766011">err</span>&nbsp;<span class="op" id="6766015">:=</span>&nbsp;<span class="ident" id="6766018"><a href="/gostd/net/dial.go.html#3203459">Dial</a></span><span class="op" id="6766022">(</span><span class="string" id="6766023">&#34;tcp&#34;</span><span class="op" id="6766028">,</span>&nbsp;<span class="ident" id="6766030"><a href="/gostd/net/tcp_test.go.html#6765213">ln</a></span><span class="op" id="6766032">.</span><span class="ident" id="6766033"><a href="/gostd/net/net.go.html#3340993">Addr</a></span><span class="op" id="6766037">(</span><span class="op" id="6766038">)</span><span class="op" id="6766039">.</span><span class="ident" id="6766040"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="6766046">(</span><span class="op" id="6766047">)</span><span class="op" id="6766048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6766053">if</span>&nbsp;<span class="ident" id="6766056"><a href="/gostd/net/tcp_test.go.html#6766011">err</a></span>&nbsp;<span class="op" id="6766060">!=</span>&nbsp;<span class="builtintype" id="6766063">nil</span>&nbsp;<span class="op" id="6766067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6766073"><a href="/gostd/net/tcp_test.go.html#6764538">b</a></span><span class="op" id="6766074">.</span><span class="ident" id="6766075"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="6766079">(</span><span class="string" id="6766080">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6766097">,</span>&nbsp;<span class="ident" id="6766099"><a href="/gostd/net/tcp_test.go.html#6766011">err</a></span><span class="op" id="6766102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6766108">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6766118">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6766123">defer</span>&nbsp;<span class="ident" id="6766129"><a href="/gostd/net/tcp_test.go.html#6766008">c</a></span><span class="op" id="6766130">.</span><span class="ident" id="6766131"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6766136">(</span><span class="op" id="6766137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6766142">if</span>&nbsp;<span class="ident" id="6766145"><a href="/gostd/net/tcp_test.go.html#6764564">timeout</a></span>&nbsp;<span class="op" id="6766153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6766159"><a href="/gostd/net/tcp_test.go.html#6766008">c</a></span><span class="op" id="6766160">.</span><span class="ident" id="6766161"><a href="/gostd/net/net.go.html#3335726">SetDeadline</a></span><span class="op" id="6766172">(</span><span class="ident" id="6766173"><a href="/gostd/net/tcp_test.go.html#6763538">time</a></span><span class="op" id="6766177">.</span><span class="ident" id="6766178"><a href="/gostd/time/time.go.html#2743088">Now</a></span><span class="op" id="6766181">(</span><span class="op" id="6766182">)</span><span class="op" id="6766183">.</span><span class="ident" id="6766184"><a href="/gostd/time/time.go.html#2738615">Add</a></span><span class="op" id="6766187">(</span><span class="ident" id="6766188"><a href="/gostd/net/tcp_test.go.html#6763538">time</a></span><span class="op" id="6766192">.</span><span class="ident" id="6766193"><a href="/gostd/time/time.go.html#2734941">Hour</a></span><span class="op" id="6766197">)</span><span class="op" id="6766198">)</span>&nbsp;<span class="comment" id="6766200">//&nbsp;Not&nbsp;intended&nbsp;to&nbsp;fire.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6766228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6766233">var</span>&nbsp;<span class="ident" id="6766237">buf</span>&nbsp;<span class="op" id="6766241">[</span><span class="ident" id="6766242"><a href="/gostd/net/tcp_test.go.html#6764601">msgLen</a></span><span class="op" id="6766248">]</span><span class="builtintype" id="6766249">byte</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6766257">for</span>&nbsp;<span class="ident" id="6766261">m</span>&nbsp;<span class="op" id="6766263">:=</span>&nbsp;<span class="num" id="6766266">0</span><span class="op" id="6766267">;</span>&nbsp;<span class="ident" id="6766269"><a href="/gostd/net/tcp_test.go.html#6766261">m</a></span>&nbsp;<span class="op" id="6766271">&lt;</span>&nbsp;<span class="ident" id="6766273"><a href="/gostd/net/tcp_test.go.html#6764674">msgs</a></span><span class="op" id="6766277">;</span>&nbsp;<span class="ident" id="6766279"><a href="/gostd/net/tcp_test.go.html#6766261">m</a></span><span class="op" id="6766280">++</span>&nbsp;<span class="op" id="6766283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6766289">if</span>&nbsp;<span class="op" id="6766292">!</span><span class="ident" id="6766293"><a href="/gostd/net/tcp_test.go.html#6764821">sendMsg</a></span><span class="op" id="6766300">(</span><span class="ident" id="6766301"><a href="/gostd/net/tcp_test.go.html#6766008">c</a></span><span class="op" id="6766302">,</span>&nbsp;<span class="ident" id="6766304"><a href="/gostd/net/tcp_test.go.html#6766237">buf</a></span><span class="op" id="6766307">[</span><span class="op" id="6766308">:</span><span class="op" id="6766309">]</span><span class="op" id="6766310">)</span>&nbsp;<span class="op" id="6766312">||</span>&nbsp;<span class="op" id="6766315">!</span><span class="ident" id="6766316"><a href="/gostd/net/tcp_test.go.html#6764997">recvMsg</a></span><span class="op" id="6766323">(</span><span class="ident" id="6766324"><a href="/gostd/net/tcp_test.go.html#6766008">c</a></span><span class="op" id="6766325">,</span>&nbsp;<span class="ident" id="6766327"><a href="/gostd/net/tcp_test.go.html#6766237">buf</a></span><span class="op" id="6766330">[</span><span class="op" id="6766331">:</span><span class="op" id="6766332">]</span><span class="op" id="6766333">)</span>&nbsp;<span class="op" id="6766335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6766342">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6766352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6766357">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6766361">}</span><span class="op" id="6766362">(</span><span class="op" id="6766363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6766366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6766369">for</span>&nbsp;<span class="ident" id="6766373">i</span>&nbsp;<span class="op" id="6766375">:=</span>&nbsp;<span class="num" id="6766378">0</span><span class="op" id="6766379">;</span>&nbsp;<span class="ident" id="6766381"><a href="/gostd/net/tcp_test.go.html#6766373">i</a></span>&nbsp;<span class="op" id="6766383">&lt;</span>&nbsp;<span class="ident" id="6766385"><a href="/gostd/net/tcp_test.go.html#6764629">numConcurrent</a></span><span class="op" id="6766398">;</span>&nbsp;<span class="ident" id="6766400"><a href="/gostd/net/tcp_test.go.html#6766373">i</a></span><span class="op" id="6766401">++</span>&nbsp;<span class="op" id="6766404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6766408"><a href="/gostd/net/tcp_test.go.html#6765832">clientSem</a></span>&nbsp;<span class="op" id="6766418">&lt;-</span>&nbsp;<span class="builtintype" id="6766421">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6766428"><a href="/gostd/net/tcp_test.go.html#6765321">serverSem</a></span>&nbsp;<span class="op" id="6766438">&lt;-</span>&nbsp;<span class="builtintype" id="6766441">true</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6766447">}</span><br>
<span class="lineno"></span><span class="op" id="6766449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6766452">func</span>&nbsp;<span class="ident" id="6766457">BenchmarkTCP4ConcurrentReadWrite</span><span class="op" id="6766489">(</span><span class="ident" id="6766490">b</span>&nbsp;<span class="op" id="6766492">*</span><span class="ident" id="6766493"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6766500">.</span><span class="ident" id="6766501"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="6766502">)</span>&nbsp;<span class="op" id="6766504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6766507"><a href="/gostd/net/tcp_test.go.html#6766726">benchmarkTCPConcurrentReadWrite</a></span><span class="op" id="6766538">(</span><span class="ident" id="6766539"><a href="/gostd/net/tcp_test.go.html#6766490">b</a></span><span class="op" id="6766540">,</span>&nbsp;<span class="string" id="6766542">&#34;127.0.0.1:0&#34;</span><span class="op" id="6766555">)</span><br>
<span class="lineno">160</span><span class="op" id="6766557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6766560">func</span>&nbsp;<span class="ident" id="6766565">BenchmarkTCP6ConcurrentReadWrite</span><span class="op" id="6766597">(</span><span class="ident" id="6766598">b</span>&nbsp;<span class="op" id="6766600">*</span><span class="ident" id="6766601"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6766608">.</span><span class="ident" id="6766609"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="6766610">)</span>&nbsp;<span class="op" id="6766612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6766615">if</span>&nbsp;<span class="op" id="6766618">!</span><span class="ident" id="6766619"><a href="/gostd/net/ipsock.go.html#3309710">supportsIPv6</a></span>&nbsp;<span class="op" id="6766632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6766636"><a href="/gostd/net/tcp_test.go.html#6766598">b</a></span><span class="op" id="6766637">.</span><span class="ident" id="6766638"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="6766642">(</span><span class="string" id="6766643">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6766666">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6766669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6766672"><a href="/gostd/net/tcp_test.go.html#6766726">benchmarkTCPConcurrentReadWrite</a></span><span class="op" id="6766703">(</span><span class="ident" id="6766704"><a href="/gostd/net/tcp_test.go.html#6766598">b</a></span><span class="op" id="6766705">,</span>&nbsp;<span class="string" id="6766707">&#34;[::1]:0&#34;</span><span class="op" id="6766716">)</span><br>
<span class="lineno"></span><span class="op" id="6766718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6766721">func</span>&nbsp;<span class="ident" id="6766726">benchmarkTCPConcurrentReadWrite</span><span class="op" id="6766757">(</span><span class="ident" id="6766758">b</span>&nbsp;<span class="op" id="6766760">*</span><span class="ident" id="6766761"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6766768">.</span><span class="ident" id="6766769"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="6766770">,</span>&nbsp;<span class="ident" id="6766772">laddr</span>&nbsp;<span class="builtintype" id="6766778">string</span><span class="op" id="6766784">)</span>&nbsp;<span class="op" id="6766786">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6766789">//&nbsp;The&nbsp;benchmark&nbsp;creates&nbsp;GOMAXPROCS&nbsp;client/server&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6766847">//&nbsp;Each&nbsp;pair&nbsp;creates&nbsp;4&nbsp;goroutines:&nbsp;client&nbsp;reader/writer&nbsp;and&nbsp;server&nbsp;reader/writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6766930">//&nbsp;The&nbsp;benchmark&nbsp;stresses&nbsp;concurrent&nbsp;reading&nbsp;and&nbsp;writing&nbsp;to&nbsp;the&nbsp;same&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6767012">//&nbsp;Such&nbsp;pattern&nbsp;is&nbsp;used&nbsp;in&nbsp;net/http&nbsp;and&nbsp;net/rpc.</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767063"><a href="/gostd/net/tcp_test.go.html#6766758">b</a></span><span class="op" id="6767064">.</span><span class="ident" id="6767065"><a href="/gostd/testing/benchmark.go.html#5452096">StopTimer</a></span><span class="op" id="6767074">(</span><span class="op" id="6767075">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767079">P</span>&nbsp;<span class="op" id="6767081">:=</span>&nbsp;<span class="ident" id="6767084"><a href="/gostd/net/tcp_test.go.html#6763508">runtime</a></span><span class="op" id="6767091">.</span><span class="ident" id="6767092"><a href="/gostd/runtime/debug.go.html#1521359">GOMAXPROCS</a></span><span class="op" id="6767102">(</span><span class="num" id="6767103">0</span><span class="op" id="6767104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767107">N</span>&nbsp;<span class="op" id="6767109">:=</span>&nbsp;<span class="ident" id="6767112"><a href="/gostd/net/tcp_test.go.html#6766758">b</a></span><span class="op" id="6767113">.</span><span class="ident" id="6767114"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span>&nbsp;<span class="op" id="6767116">/</span>&nbsp;<span class="ident" id="6767118"><a href="/gostd/net/tcp_test.go.html#6767079">P</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767121">W</span>&nbsp;<span class="op" id="6767123">:=</span>&nbsp;<span class="num" id="6767126">1000</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6767133">//&nbsp;Setup&nbsp;P&nbsp;client/server&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767172">clients</span>&nbsp;<span class="op" id="6767180">:=</span>&nbsp;<span class="builtinfunc" id="6767183">make</span><span class="op" id="6767187">(</span><span class="op" id="6767188">[</span><span class="op" id="6767189">]</span><span class="ident" id="6767190"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6767194">,</span>&nbsp;<span class="ident" id="6767196"><a href="/gostd/net/tcp_test.go.html#6767079">P</a></span><span class="op" id="6767197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767200">servers</span>&nbsp;<span class="op" id="6767208">:=</span>&nbsp;<span class="builtinfunc" id="6767211">make</span><span class="op" id="6767215">(</span><span class="op" id="6767216">[</span><span class="op" id="6767217">]</span><span class="ident" id="6767218"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6767222">,</span>&nbsp;<span class="ident" id="6767224"><a href="/gostd/net/tcp_test.go.html#6767079">P</a></span><span class="op" id="6767225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767228">ln</span><span class="op" id="6767230">,</span>&nbsp;<span class="ident" id="6767232">err</span>&nbsp;<span class="op" id="6767236">:=</span>&nbsp;<span class="ident" id="6767239"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="6767245">(</span><span class="string" id="6767246">&#34;tcp&#34;</span><span class="op" id="6767251">,</span>&nbsp;<span class="ident" id="6767253"><a href="/gostd/net/tcp_test.go.html#6766772">laddr</a></span><span class="op" id="6767258">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6767261">if</span>&nbsp;<span class="ident" id="6767264"><a href="/gostd/net/tcp_test.go.html#6767232">err</a></span>&nbsp;<span class="op" id="6767268">!=</span>&nbsp;<span class="builtintype" id="6767271">nil</span>&nbsp;<span class="op" id="6767275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767279"><a href="/gostd/net/tcp_test.go.html#6766758">b</a></span><span class="op" id="6767280">.</span><span class="ident" id="6767281"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6767287">(</span><span class="string" id="6767288">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6767307">,</span>&nbsp;<span class="ident" id="6767309"><a href="/gostd/net/tcp_test.go.html#6767232">err</a></span><span class="op" id="6767312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6767315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6767318">defer</span>&nbsp;<span class="ident" id="6767324"><a href="/gostd/net/tcp_test.go.html#6767228">ln</a></span><span class="op" id="6767326">.</span><span class="ident" id="6767327"><a href="/gostd/net/net.go.html#3340928">Close</a></span><span class="op" id="6767332">(</span><span class="op" id="6767333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767336">done</span>&nbsp;<span class="op" id="6767341">:=</span>&nbsp;<span class="builtinfunc" id="6767344">make</span><span class="op" id="6767348">(</span><span class="keyword" id="6767349">chan</span>&nbsp;<span class="builtintype" id="6767354">bool</span><span class="op" id="6767358">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6767361">go</span>&nbsp;<span class="keyword" id="6767364">func</span><span class="op" id="6767368">(</span><span class="op" id="6767369">)</span>&nbsp;<span class="op" id="6767371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6767375">for</span>&nbsp;<span class="ident" id="6767379">p</span>&nbsp;<span class="op" id="6767381">:=</span>&nbsp;<span class="num" id="6767384">0</span><span class="op" id="6767385">;</span>&nbsp;<span class="ident" id="6767387"><a href="/gostd/net/tcp_test.go.html#6767379">p</a></span>&nbsp;<span class="op" id="6767389">&lt;</span>&nbsp;<span class="ident" id="6767391"><a href="/gostd/net/tcp_test.go.html#6767079">P</a></span><span class="op" id="6767392">;</span>&nbsp;<span class="ident" id="6767394"><a href="/gostd/net/tcp_test.go.html#6767379">p</a></span><span class="op" id="6767395">++</span>&nbsp;<span class="op" id="6767398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767403">s</span><span class="op" id="6767404">,</span>&nbsp;<span class="ident" id="6767406">err</span>&nbsp;<span class="op" id="6767410">:=</span>&nbsp;<span class="ident" id="6767413"><a href="/gostd/net/tcp_test.go.html#6767228">ln</a></span><span class="op" id="6767415">.</span><span class="ident" id="6767416"><a href="/gostd/net/net.go.html#3340795">Accept</a></span><span class="op" id="6767422">(</span><span class="op" id="6767423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6767428">if</span>&nbsp;<span class="ident" id="6767431"><a href="/gostd/net/tcp_test.go.html#6767406">err</a></span>&nbsp;<span class="op" id="6767435">!=</span>&nbsp;<span class="builtintype" id="6767438">nil</span>&nbsp;<span class="op" id="6767442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767448"><a href="/gostd/net/tcp_test.go.html#6766758">b</a></span><span class="op" id="6767449">.</span><span class="ident" id="6767450"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6767456">(</span><span class="string" id="6767457">&#34;Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6767476">,</span>&nbsp;<span class="ident" id="6767478"><a href="/gostd/net/tcp_test.go.html#6767406">err</a></span><span class="op" id="6767481">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6767487">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6767497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767502"><a href="/gostd/net/tcp_test.go.html#6767200">servers</a></span><span class="op" id="6767509">[</span><span class="ident" id="6767510"><a href="/gostd/net/tcp_test.go.html#6767379">p</a></span><span class="op" id="6767511">]</span>&nbsp;<span class="op" id="6767513">=</span>&nbsp;<span class="ident" id="6767515"><a href="/gostd/net/tcp_test.go.html#6767403">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6767519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767523"><a href="/gostd/net/tcp_test.go.html#6767336">done</a></span>&nbsp;<span class="op" id="6767528">&lt;-</span>&nbsp;<span class="builtintype" id="6767531">true</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6767537">}</span><span class="op" id="6767538">(</span><span class="op" id="6767539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6767542">for</span>&nbsp;<span class="ident" id="6767546">p</span>&nbsp;<span class="op" id="6767548">:=</span>&nbsp;<span class="num" id="6767551">0</span><span class="op" id="6767552">;</span>&nbsp;<span class="ident" id="6767554"><a href="/gostd/net/tcp_test.go.html#6767546">p</a></span>&nbsp;<span class="op" id="6767556">&lt;</span>&nbsp;<span class="ident" id="6767558"><a href="/gostd/net/tcp_test.go.html#6767079">P</a></span><span class="op" id="6767559">;</span>&nbsp;<span class="ident" id="6767561"><a href="/gostd/net/tcp_test.go.html#6767546">p</a></span><span class="op" id="6767562">++</span>&nbsp;<span class="op" id="6767565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767569">c</span><span class="op" id="6767570">,</span>&nbsp;<span class="ident" id="6767572">err</span>&nbsp;<span class="op" id="6767576">:=</span>&nbsp;<span class="ident" id="6767579"><a href="/gostd/net/dial.go.html#3203459">Dial</a></span><span class="op" id="6767583">(</span><span class="string" id="6767584">&#34;tcp&#34;</span><span class="op" id="6767589">,</span>&nbsp;<span class="ident" id="6767591"><a href="/gostd/net/tcp_test.go.html#6767228">ln</a></span><span class="op" id="6767593">.</span><span class="ident" id="6767594"><a href="/gostd/net/net.go.html#3340993">Addr</a></span><span class="op" id="6767598">(</span><span class="op" id="6767599">)</span><span class="op" id="6767600">.</span><span class="ident" id="6767601"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="6767607">(</span><span class="op" id="6767608">)</span><span class="op" id="6767609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6767613">if</span>&nbsp;<span class="ident" id="6767616"><a href="/gostd/net/tcp_test.go.html#6767572">err</a></span>&nbsp;<span class="op" id="6767620">!=</span>&nbsp;<span class="builtintype" id="6767623">nil</span>&nbsp;<span class="op" id="6767627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767632"><a href="/gostd/net/tcp_test.go.html#6766758">b</a></span><span class="op" id="6767633">.</span><span class="ident" id="6767634"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6767640">(</span><span class="string" id="6767641">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6767658">,</span>&nbsp;<span class="ident" id="6767660"><a href="/gostd/net/tcp_test.go.html#6767572">err</a></span><span class="op" id="6767663">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6767667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767671"><a href="/gostd/net/tcp_test.go.html#6767172">clients</a></span><span class="op" id="6767678">[</span><span class="ident" id="6767679"><a href="/gostd/net/tcp_test.go.html#6767546">p</a></span><span class="op" id="6767680">]</span>&nbsp;<span class="op" id="6767682">=</span>&nbsp;<span class="ident" id="6767684"><a href="/gostd/net/tcp_test.go.html#6767569">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6767687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6767690">&lt;-</span><span class="ident" id="6767692"><a href="/gostd/net/tcp_test.go.html#6767336">done</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767699"><a href="/gostd/net/tcp_test.go.html#6766758">b</a></span><span class="op" id="6767700">.</span><span class="ident" id="6767701"><a href="/gostd/testing/benchmark.go.html#5451749">StartTimer</a></span><span class="op" id="6767711">(</span><span class="op" id="6767712">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6767716">var</span>&nbsp;<span class="ident" id="6767720">wg</span>&nbsp;<span class="ident" id="6767723"><a href="/gostd/net/tcp_test.go.html#6763519">sync</a></span><span class="op" id="6767727">.</span><span class="ident" id="6767728"><a href="/gostd/sync/waitgroup.go.html#1459933">WaitGroup</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767739"><a href="/gostd/net/tcp_test.go.html#6767720">wg</a></span><span class="op" id="6767741">.</span><span class="ident" id="6767742"><a href="/gostd/sync/waitgroup.go.html#1461154">Add</a></span><span class="op" id="6767745">(</span><span class="num" id="6767746">4</span>&nbsp;<span class="op" id="6767748">*</span>&nbsp;<span class="ident" id="6767750"><a href="/gostd/net/tcp_test.go.html#6767079">P</a></span><span class="op" id="6767751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6767754">for</span>&nbsp;<span class="ident" id="6767758">p</span>&nbsp;<span class="op" id="6767760">:=</span>&nbsp;<span class="num" id="6767763">0</span><span class="op" id="6767764">;</span>&nbsp;<span class="ident" id="6767766"><a href="/gostd/net/tcp_test.go.html#6767758">p</a></span>&nbsp;<span class="op" id="6767768">&lt;</span>&nbsp;<span class="ident" id="6767770"><a href="/gostd/net/tcp_test.go.html#6767079">P</a></span><span class="op" id="6767771">;</span>&nbsp;<span class="ident" id="6767773"><a href="/gostd/net/tcp_test.go.html#6767758">p</a></span><span class="op" id="6767774">++</span>&nbsp;<span class="op" id="6767777">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6767781">//&nbsp;Client&nbsp;writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6767801">go</span>&nbsp;<span class="keyword" id="6767804">func</span><span class="op" id="6767808">(</span><span class="ident" id="6767809">c</span>&nbsp;<span class="ident" id="6767811"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6767815">)</span>&nbsp;<span class="op" id="6767817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6767822">defer</span>&nbsp;<span class="ident" id="6767828"><a href="/gostd/net/tcp_test.go.html#6767720">wg</a></span><span class="op" id="6767830">.</span><span class="ident" id="6767831"><a href="/gostd/sync/waitgroup.go.html#1462065">Done</a></span><span class="op" id="6767835">(</span><span class="op" id="6767836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6767841">var</span>&nbsp;<span class="ident" id="6767845">buf</span>&nbsp;<span class="op" id="6767849">[</span><span class="num" id="6767850">1</span><span class="op" id="6767851">]</span><span class="builtintype" id="6767852">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6767860">for</span>&nbsp;<span class="ident" id="6767864">i</span>&nbsp;<span class="op" id="6767866">:=</span>&nbsp;<span class="num" id="6767869">0</span><span class="op" id="6767870">;</span>&nbsp;<span class="ident" id="6767872"><a href="/gostd/net/tcp_test.go.html#6767864">i</a></span>&nbsp;<span class="op" id="6767874">&lt;</span>&nbsp;<span class="ident" id="6767876"><a href="/gostd/net/tcp_test.go.html#6767107">N</a></span><span class="op" id="6767877">;</span>&nbsp;<span class="ident" id="6767879"><a href="/gostd/net/tcp_test.go.html#6767864">i</a></span><span class="op" id="6767880">++</span>&nbsp;<span class="op" id="6767883">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767889">v</span>&nbsp;<span class="op" id="6767891">:=</span>&nbsp;<span class="builtintype" id="6767894">byte</span><span class="op" id="6767898">(</span><span class="ident" id="6767899"><a href="/gostd/net/tcp_test.go.html#6767864">i</a></span><span class="op" id="6767900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6767906">for</span>&nbsp;<span class="ident" id="6767910">w</span>&nbsp;<span class="op" id="6767912">:=</span>&nbsp;<span class="num" id="6767915">0</span><span class="op" id="6767916">;</span>&nbsp;<span class="ident" id="6767918"><a href="/gostd/net/tcp_test.go.html#6767910">w</a></span>&nbsp;<span class="op" id="6767920">&lt;</span>&nbsp;<span class="ident" id="6767922"><a href="/gostd/net/tcp_test.go.html#6767121">W</a></span><span class="op" id="6767923">;</span>&nbsp;<span class="ident" id="6767925"><a href="/gostd/net/tcp_test.go.html#6767910">w</a></span><span class="op" id="6767926">++</span>&nbsp;<span class="op" id="6767929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767936"><a href="/gostd/net/tcp_test.go.html#6767889">v</a></span>&nbsp;<span class="op" id="6767938">*=</span>&nbsp;<span class="ident" id="6767941"><a href="/gostd/net/tcp_test.go.html#6767889">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6767947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767953"><a href="/gostd/net/tcp_test.go.html#6767845">buf</a></span><span class="op" id="6767956">[</span><span class="num" id="6767957">0</span><span class="op" id="6767958">]</span>&nbsp;<span class="op" id="6767960">=</span>&nbsp;<span class="ident" id="6767962"><a href="/gostd/net/tcp_test.go.html#6767889">v</a></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6767968">_</span><span class="op" id="6767969">,</span>&nbsp;<span class="ident" id="6767971">err</span>&nbsp;<span class="op" id="6767975">:=</span>&nbsp;<span class="ident" id="6767978"><a href="/gostd/net/tcp_test.go.html#6767809">c</a></span><span class="op" id="6767979">.</span><span class="ident" id="6767980"><a href="/gostd/net/net.go.html#3334839">Write</a></span><span class="op" id="6767985">(</span><span class="ident" id="6767986"><a href="/gostd/net/tcp_test.go.html#6767845">buf</a></span><span class="op" id="6767989">[</span><span class="op" id="6767990">:</span><span class="op" id="6767991">]</span><span class="op" id="6767992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6767998">if</span>&nbsp;<span class="ident" id="6768001"><a href="/gostd/net/tcp_test.go.html#6767971">err</a></span>&nbsp;<span class="op" id="6768005">!=</span>&nbsp;<span class="builtintype" id="6768008">nil</span>&nbsp;<span class="op" id="6768012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6768019"><a href="/gostd/net/tcp_test.go.html#6766758">b</a></span><span class="op" id="6768020">.</span><span class="ident" id="6768021"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6768027">(</span><span class="string" id="6768028">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6768046">,</span>&nbsp;<span class="ident" id="6768048"><a href="/gostd/net/tcp_test.go.html#6767971">err</a></span><span class="op" id="6768051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768058">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6768069">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6768074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6768078">}</span><span class="op" id="6768079">(</span><span class="ident" id="6768080"><a href="/gostd/net/tcp_test.go.html#6767172">clients</a></span><span class="op" id="6768087">[</span><span class="ident" id="6768088"><a href="/gostd/net/tcp_test.go.html#6767758">p</a></span><span class="op" id="6768089">]</span><span class="op" id="6768090">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6768095">//&nbsp;Pipe&nbsp;between&nbsp;server&nbsp;reader&nbsp;and&nbsp;server&nbsp;writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6768146">pipe</span>&nbsp;<span class="op" id="6768151">:=</span>&nbsp;<span class="builtinfunc" id="6768154">make</span><span class="op" id="6768158">(</span><span class="keyword" id="6768159">chan</span>&nbsp;<span class="builtintype" id="6768164">byte</span><span class="op" id="6768168">,</span>&nbsp;<span class="num" id="6768170">128</span><span class="op" id="6768173">)</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6768178">//&nbsp;Server&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768198">go</span>&nbsp;<span class="keyword" id="6768201">func</span><span class="op" id="6768205">(</span><span class="ident" id="6768206">s</span>&nbsp;<span class="ident" id="6768208"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6768212">)</span>&nbsp;<span class="op" id="6768214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768219">defer</span>&nbsp;<span class="ident" id="6768225"><a href="/gostd/net/tcp_test.go.html#6767720">wg</a></span><span class="op" id="6768227">.</span><span class="ident" id="6768228"><a href="/gostd/sync/waitgroup.go.html#1462065">Done</a></span><span class="op" id="6768232">(</span><span class="op" id="6768233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768238">var</span>&nbsp;<span class="ident" id="6768242">buf</span>&nbsp;<span class="op" id="6768246">[</span><span class="num" id="6768247">1</span><span class="op" id="6768248">]</span><span class="builtintype" id="6768249">byte</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768257">for</span>&nbsp;<span class="ident" id="6768261">i</span>&nbsp;<span class="op" id="6768263">:=</span>&nbsp;<span class="num" id="6768266">0</span><span class="op" id="6768267">;</span>&nbsp;<span class="ident" id="6768269"><a href="/gostd/net/tcp_test.go.html#6768261">i</a></span>&nbsp;<span class="op" id="6768271">&lt;</span>&nbsp;<span class="ident" id="6768273"><a href="/gostd/net/tcp_test.go.html#6767107">N</a></span><span class="op" id="6768274">;</span>&nbsp;<span class="ident" id="6768276"><a href="/gostd/net/tcp_test.go.html#6768261">i</a></span><span class="op" id="6768277">++</span>&nbsp;<span class="op" id="6768280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6768286">_</span><span class="op" id="6768287">,</span>&nbsp;<span class="ident" id="6768289">err</span>&nbsp;<span class="op" id="6768293">:=</span>&nbsp;<span class="ident" id="6768296"><a href="/gostd/net/tcp_test.go.html#6768206">s</a></span><span class="op" id="6768297">.</span><span class="ident" id="6768298"><a href="/gostd/net/net.go.html#3334618">Read</a></span><span class="op" id="6768302">(</span><span class="ident" id="6768303"><a href="/gostd/net/tcp_test.go.html#6768242">buf</a></span><span class="op" id="6768306">[</span><span class="op" id="6768307">:</span><span class="op" id="6768308">]</span><span class="op" id="6768309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768315">if</span>&nbsp;<span class="ident" id="6768318"><a href="/gostd/net/tcp_test.go.html#6768289">err</a></span>&nbsp;<span class="op" id="6768322">!=</span>&nbsp;<span class="builtintype" id="6768325">nil</span>&nbsp;<span class="op" id="6768329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6768336"><a href="/gostd/net/tcp_test.go.html#6766758">b</a></span><span class="op" id="6768337">.</span><span class="ident" id="6768338"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6768344">(</span><span class="string" id="6768345">&#34;Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6768362">,</span>&nbsp;<span class="ident" id="6768364"><a href="/gostd/net/tcp_test.go.html#6768289">err</a></span><span class="op" id="6768367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768374">return</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6768385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6768391"><a href="/gostd/net/tcp_test.go.html#6768146">pipe</a></span>&nbsp;<span class="op" id="6768396">&lt;-</span>&nbsp;<span class="ident" id="6768399"><a href="/gostd/net/tcp_test.go.html#6768242">buf</a></span><span class="op" id="6768402">[</span><span class="num" id="6768403">0</span><span class="op" id="6768404">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6768409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6768413">}</span><span class="op" id="6768414">(</span><span class="ident" id="6768415"><a href="/gostd/net/tcp_test.go.html#6767200">servers</a></span><span class="op" id="6768422">[</span><span class="ident" id="6768423"><a href="/gostd/net/tcp_test.go.html#6767758">p</a></span><span class="op" id="6768424">]</span><span class="op" id="6768425">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6768430">//&nbsp;Server&nbsp;writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768450">go</span>&nbsp;<span class="keyword" id="6768453">func</span><span class="op" id="6768457">(</span><span class="ident" id="6768458">s</span>&nbsp;<span class="ident" id="6768460"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6768464">)</span>&nbsp;<span class="op" id="6768466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768471">defer</span>&nbsp;<span class="ident" id="6768477"><a href="/gostd/net/tcp_test.go.html#6767720">wg</a></span><span class="op" id="6768479">.</span><span class="ident" id="6768480"><a href="/gostd/sync/waitgroup.go.html#1462065">Done</a></span><span class="op" id="6768484">(</span><span class="op" id="6768485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768490">var</span>&nbsp;<span class="ident" id="6768494">buf</span>&nbsp;<span class="op" id="6768498">[</span><span class="num" id="6768499">1</span><span class="op" id="6768500">]</span><span class="builtintype" id="6768501">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768509">for</span>&nbsp;<span class="ident" id="6768513">i</span>&nbsp;<span class="op" id="6768515">:=</span>&nbsp;<span class="num" id="6768518">0</span><span class="op" id="6768519">;</span>&nbsp;<span class="ident" id="6768521"><a href="/gostd/net/tcp_test.go.html#6768513">i</a></span>&nbsp;<span class="op" id="6768523">&lt;</span>&nbsp;<span class="ident" id="6768525"><a href="/gostd/net/tcp_test.go.html#6767107">N</a></span><span class="op" id="6768526">;</span>&nbsp;<span class="ident" id="6768528"><a href="/gostd/net/tcp_test.go.html#6768513">i</a></span><span class="op" id="6768529">++</span>&nbsp;<span class="op" id="6768532">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6768538">v</span>&nbsp;<span class="op" id="6768540">:=</span>&nbsp;<span class="op" id="6768543">&lt;-</span><span class="ident" id="6768545"><a href="/gostd/net/tcp_test.go.html#6768146">pipe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768554">for</span>&nbsp;<span class="ident" id="6768558">w</span>&nbsp;<span class="op" id="6768560">:=</span>&nbsp;<span class="num" id="6768563">0</span><span class="op" id="6768564">;</span>&nbsp;<span class="ident" id="6768566"><a href="/gostd/net/tcp_test.go.html#6768558">w</a></span>&nbsp;<span class="op" id="6768568">&lt;</span>&nbsp;<span class="ident" id="6768570"><a href="/gostd/net/tcp_test.go.html#6767121">W</a></span><span class="op" id="6768571">;</span>&nbsp;<span class="ident" id="6768573"><a href="/gostd/net/tcp_test.go.html#6768558">w</a></span><span class="op" id="6768574">++</span>&nbsp;<span class="op" id="6768577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6768584"><a href="/gostd/net/tcp_test.go.html#6768538">v</a></span>&nbsp;<span class="op" id="6768586">*=</span>&nbsp;<span class="ident" id="6768589"><a href="/gostd/net/tcp_test.go.html#6768538">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6768595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6768601"><a href="/gostd/net/tcp_test.go.html#6768494">buf</a></span><span class="op" id="6768604">[</span><span class="num" id="6768605">0</span><span class="op" id="6768606">]</span>&nbsp;<span class="op" id="6768608">=</span>&nbsp;<span class="ident" id="6768610"><a href="/gostd/net/tcp_test.go.html#6768538">v</a></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6768616">_</span><span class="op" id="6768617">,</span>&nbsp;<span class="ident" id="6768619">err</span>&nbsp;<span class="op" id="6768623">:=</span>&nbsp;<span class="ident" id="6768626"><a href="/gostd/net/tcp_test.go.html#6768458">s</a></span><span class="op" id="6768627">.</span><span class="ident" id="6768628"><a href="/gostd/net/net.go.html#3334839">Write</a></span><span class="op" id="6768633">(</span><span class="ident" id="6768634"><a href="/gostd/net/tcp_test.go.html#6768494">buf</a></span><span class="op" id="6768637">[</span><span class="op" id="6768638">:</span><span class="op" id="6768639">]</span><span class="op" id="6768640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768646">if</span>&nbsp;<span class="ident" id="6768649"><a href="/gostd/net/tcp_test.go.html#6768619">err</a></span>&nbsp;<span class="op" id="6768653">!=</span>&nbsp;<span class="builtintype" id="6768656">nil</span>&nbsp;<span class="op" id="6768660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6768667"><a href="/gostd/net/tcp_test.go.html#6766758">b</a></span><span class="op" id="6768668">.</span><span class="ident" id="6768669"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6768675">(</span><span class="string" id="6768676">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6768694">,</span>&nbsp;<span class="ident" id="6768696"><a href="/gostd/net/tcp_test.go.html#6768619">err</a></span><span class="op" id="6768699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768706">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6768717">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6768722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6768727"><a href="/gostd/net/tcp_test.go.html#6768458">s</a></span><span class="op" id="6768728">.</span><span class="ident" id="6768729"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6768734">(</span><span class="op" id="6768735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6768739">}</span><span class="op" id="6768740">(</span><span class="ident" id="6768741"><a href="/gostd/net/tcp_test.go.html#6767200">servers</a></span><span class="op" id="6768748">[</span><span class="ident" id="6768749"><a href="/gostd/net/tcp_test.go.html#6767758">p</a></span><span class="op" id="6768750">]</span><span class="op" id="6768751">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6768756">//&nbsp;Client&nbsp;reader.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768776">go</span>&nbsp;<span class="keyword" id="6768779">func</span><span class="op" id="6768783">(</span><span class="ident" id="6768784">c</span>&nbsp;<span class="ident" id="6768786"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6768790">)</span>&nbsp;<span class="op" id="6768792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768797">defer</span>&nbsp;<span class="ident" id="6768803"><a href="/gostd/net/tcp_test.go.html#6767720">wg</a></span><span class="op" id="6768805">.</span><span class="ident" id="6768806"><a href="/gostd/sync/waitgroup.go.html#1462065">Done</a></span><span class="op" id="6768810">(</span><span class="op" id="6768811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768816">var</span>&nbsp;<span class="ident" id="6768820">buf</span>&nbsp;<span class="op" id="6768824">[</span><span class="num" id="6768825">1</span><span class="op" id="6768826">]</span><span class="builtintype" id="6768827">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768835">for</span>&nbsp;<span class="ident" id="6768839">i</span>&nbsp;<span class="op" id="6768841">:=</span>&nbsp;<span class="num" id="6768844">0</span><span class="op" id="6768845">;</span>&nbsp;<span class="ident" id="6768847"><a href="/gostd/net/tcp_test.go.html#6768839">i</a></span>&nbsp;<span class="op" id="6768849">&lt;</span>&nbsp;<span class="ident" id="6768851"><a href="/gostd/net/tcp_test.go.html#6767107">N</a></span><span class="op" id="6768852">;</span>&nbsp;<span class="ident" id="6768854"><a href="/gostd/net/tcp_test.go.html#6768839">i</a></span><span class="op" id="6768855">++</span>&nbsp;<span class="op" id="6768858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6768864">_</span><span class="op" id="6768865">,</span>&nbsp;<span class="ident" id="6768867">err</span>&nbsp;<span class="op" id="6768871">:=</span>&nbsp;<span class="ident" id="6768874"><a href="/gostd/net/tcp_test.go.html#6768784">c</a></span><span class="op" id="6768875">.</span><span class="ident" id="6768876"><a href="/gostd/net/net.go.html#3334618">Read</a></span><span class="op" id="6768880">(</span><span class="ident" id="6768881"><a href="/gostd/net/tcp_test.go.html#6768820">buf</a></span><span class="op" id="6768884">[</span><span class="op" id="6768885">:</span><span class="op" id="6768886">]</span><span class="op" id="6768887">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768893">if</span>&nbsp;<span class="ident" id="6768896"><a href="/gostd/net/tcp_test.go.html#6768867">err</a></span>&nbsp;<span class="op" id="6768900">!=</span>&nbsp;<span class="builtintype" id="6768903">nil</span>&nbsp;<span class="op" id="6768907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6768914"><a href="/gostd/net/tcp_test.go.html#6766758">b</a></span><span class="op" id="6768915">.</span><span class="ident" id="6768916"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6768922">(</span><span class="string" id="6768923">&#34;Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6768940">,</span>&nbsp;<span class="ident" id="6768942"><a href="/gostd/net/tcp_test.go.html#6768867">err</a></span><span class="op" id="6768945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6768952">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6768963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6768968">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6768973"><a href="/gostd/net/tcp_test.go.html#6768784">c</a></span><span class="op" id="6768974">.</span><span class="ident" id="6768975"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6768980">(</span><span class="op" id="6768981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6768985">}</span><span class="op" id="6768986">(</span><span class="ident" id="6768987"><a href="/gostd/net/tcp_test.go.html#6767172">clients</a></span><span class="op" id="6768994">[</span><span class="ident" id="6768995"><a href="/gostd/net/tcp_test.go.html#6767758">p</a></span><span class="op" id="6768996">]</span><span class="op" id="6768997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6769000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6769003"><a href="/gostd/net/tcp_test.go.html#6767720">wg</a></span><span class="op" id="6769005">.</span><span class="ident" id="6769006"><a href="/gostd/sync/waitgroup.go.html#1462162">Wait</a></span><span class="op" id="6769010">(</span><span class="op" id="6769011">)</span><br>
<span class="lineno"></span><span class="op" id="6769013">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="6769016">type</span>&nbsp;<span class="ident" id="6769021">resolveTCPAddrTest</span>&nbsp;<span class="keyword" id="6769040">struct</span>&nbsp;<span class="op" id="6769047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6769050">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6769064">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6769072">litAddrOrName</span>&nbsp;<span class="builtintype" id="6769086">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6769094">addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6769108">*</span><span class="ident" id="6769109"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6769118">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6769132">error</span><br>
<span class="lineno"></span><span class="op" id="6769138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6769141">var</span>&nbsp;<span class="ident" id="6769145">resolveTCPAddrTests</span>&nbsp;<span class="op" id="6769165">=</span>&nbsp;<span class="op" id="6769167">[</span><span class="op" id="6769168">]</span><span class="ident" id="6769169"><a href="/gostd/net/tcp_test.go.html#6769021">resolveTCPAddrTest</a></span><span class="op" id="6769187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6769190">{</span><span class="string" id="6769191">&#34;tcp&#34;</span><span class="op" id="6769196">,</span>&nbsp;<span class="string" id="6769198">&#34;127.0.0.1:0&#34;</span><span class="op" id="6769211">,</span>&nbsp;<span class="op" id="6769213">&amp;</span><span class="ident" id="6769214"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6769221">{</span><span class="ident" id="6769222"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6769224">:</span>&nbsp;<span class="ident" id="6769226"><a href="/gostd/net/ip.go.html#3286541">IPv4</a></span><span class="op" id="6769230">(</span><span class="num" id="6769231">127</span><span class="op" id="6769234">,</span>&nbsp;<span class="num" id="6769236">0</span><span class="op" id="6769237">,</span>&nbsp;<span class="num" id="6769239">0</span><span class="op" id="6769240">,</span>&nbsp;<span class="num" id="6769242">1</span><span class="op" id="6769243">)</span><span class="op" id="6769244">,</span>&nbsp;<span class="ident" id="6769246"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6769250">:</span>&nbsp;<span class="num" id="6769252">0</span><span class="op" id="6769253">}</span><span class="op" id="6769254">,</span>&nbsp;<span class="builtintype" id="6769256">nil</span><span class="op" id="6769259">}</span><span class="op" id="6769260">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6769263">{</span><span class="string" id="6769264">&#34;tcp4&#34;</span><span class="op" id="6769270">,</span>&nbsp;<span class="string" id="6769272">&#34;127.0.0.1:65535&#34;</span><span class="op" id="6769289">,</span>&nbsp;<span class="op" id="6769291">&amp;</span><span class="ident" id="6769292"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6769299">{</span><span class="ident" id="6769300"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6769302">:</span>&nbsp;<span class="ident" id="6769304"><a href="/gostd/net/ip.go.html#3286541">IPv4</a></span><span class="op" id="6769308">(</span><span class="num" id="6769309">127</span><span class="op" id="6769312">,</span>&nbsp;<span class="num" id="6769314">0</span><span class="op" id="6769315">,</span>&nbsp;<span class="num" id="6769317">0</span><span class="op" id="6769318">,</span>&nbsp;<span class="num" id="6769320">1</span><span class="op" id="6769321">)</span><span class="op" id="6769322">,</span>&nbsp;<span class="ident" id="6769324"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6769328">:</span>&nbsp;<span class="num" id="6769330">65535</span><span class="op" id="6769335">}</span><span class="op" id="6769336">,</span>&nbsp;<span class="builtintype" id="6769338">nil</span><span class="op" id="6769341">}</span><span class="op" id="6769342">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6769346">{</span><span class="string" id="6769347">&#34;tcp&#34;</span><span class="op" id="6769352">,</span>&nbsp;<span class="string" id="6769354">&#34;[::1]:1&#34;</span><span class="op" id="6769363">,</span>&nbsp;<span class="op" id="6769365">&amp;</span><span class="ident" id="6769366"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6769373">{</span><span class="ident" id="6769374"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6769376">:</span>&nbsp;<span class="ident" id="6769378"><a href="/gostd/net/ip.go.html#3299857">ParseIP</a></span><span class="op" id="6769385">(</span><span class="string" id="6769386">&#34;::1&#34;</span><span class="op" id="6769391">)</span><span class="op" id="6769392">,</span>&nbsp;<span class="ident" id="6769394"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6769398">:</span>&nbsp;<span class="num" id="6769400">1</span><span class="op" id="6769401">}</span><span class="op" id="6769402">,</span>&nbsp;<span class="builtintype" id="6769404">nil</span><span class="op" id="6769407">}</span><span class="op" id="6769408">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6769411">{</span><span class="string" id="6769412">&#34;tcp6&#34;</span><span class="op" id="6769418">,</span>&nbsp;<span class="string" id="6769420">&#34;[::1]:65534&#34;</span><span class="op" id="6769433">,</span>&nbsp;<span class="op" id="6769435">&amp;</span><span class="ident" id="6769436"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6769443">{</span><span class="ident" id="6769444"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6769446">:</span>&nbsp;<span class="ident" id="6769448"><a href="/gostd/net/ip.go.html#3299857">ParseIP</a></span><span class="op" id="6769455">(</span><span class="string" id="6769456">&#34;::1&#34;</span><span class="op" id="6769461">)</span><span class="op" id="6769462">,</span>&nbsp;<span class="ident" id="6769464"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6769468">:</span>&nbsp;<span class="num" id="6769470">65534</span><span class="op" id="6769475">}</span><span class="op" id="6769476">,</span>&nbsp;<span class="builtintype" id="6769478">nil</span><span class="op" id="6769481">}</span><span class="op" id="6769482">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6769486">{</span><span class="string" id="6769487">&#34;tcp&#34;</span><span class="op" id="6769492">,</span>&nbsp;<span class="string" id="6769494">&#34;[::1%en0]:1&#34;</span><span class="op" id="6769507">,</span>&nbsp;<span class="op" id="6769509">&amp;</span><span class="ident" id="6769510"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6769517">{</span><span class="ident" id="6769518"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6769520">:</span>&nbsp;<span class="ident" id="6769522"><a href="/gostd/net/ip.go.html#3299857">ParseIP</a></span><span class="op" id="6769529">(</span><span class="string" id="6769530">&#34;::1&#34;</span><span class="op" id="6769535">)</span><span class="op" id="6769536">,</span>&nbsp;<span class="ident" id="6769538"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6769542">:</span>&nbsp;<span class="num" id="6769544">1</span><span class="op" id="6769545">,</span>&nbsp;<span class="ident" id="6769547"><a href="/gostd/net/tcpsock.go.html#3373506">Zone</a></span><span class="op" id="6769551">:</span>&nbsp;<span class="string" id="6769553">&#34;en0&#34;</span><span class="op" id="6769558">}</span><span class="op" id="6769559">,</span>&nbsp;<span class="builtintype" id="6769561">nil</span><span class="op" id="6769564">}</span><span class="op" id="6769565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6769568">{</span><span class="string" id="6769569">&#34;tcp6&#34;</span><span class="op" id="6769575">,</span>&nbsp;<span class="string" id="6769577">&#34;[::1%911]:2&#34;</span><span class="op" id="6769590">,</span>&nbsp;<span class="op" id="6769592">&amp;</span><span class="ident" id="6769593"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6769600">{</span><span class="ident" id="6769601"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6769603">:</span>&nbsp;<span class="ident" id="6769605"><a href="/gostd/net/ip.go.html#3299857">ParseIP</a></span><span class="op" id="6769612">(</span><span class="string" id="6769613">&#34;::1&#34;</span><span class="op" id="6769618">)</span><span class="op" id="6769619">,</span>&nbsp;<span class="ident" id="6769621"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6769625">:</span>&nbsp;<span class="num" id="6769627">2</span><span class="op" id="6769628">,</span>&nbsp;<span class="ident" id="6769630"><a href="/gostd/net/tcpsock.go.html#3373506">Zone</a></span><span class="op" id="6769634">:</span>&nbsp;<span class="string" id="6769636">&#34;911&#34;</span><span class="op" id="6769641">}</span><span class="op" id="6769642">,</span>&nbsp;<span class="builtintype" id="6769644">nil</span><span class="op" id="6769647">}</span><span class="op" id="6769648">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6769652">{</span><span class="string" id="6769653">&#34;&#34;</span><span class="op" id="6769655">,</span>&nbsp;<span class="string" id="6769657">&#34;127.0.0.1:0&#34;</span><span class="op" id="6769670">,</span>&nbsp;<span class="op" id="6769672">&amp;</span><span class="ident" id="6769673"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6769680">{</span><span class="ident" id="6769681"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6769683">:</span>&nbsp;<span class="ident" id="6769685"><a href="/gostd/net/ip.go.html#3286541">IPv4</a></span><span class="op" id="6769689">(</span><span class="num" id="6769690">127</span><span class="op" id="6769693">,</span>&nbsp;<span class="num" id="6769695">0</span><span class="op" id="6769696">,</span>&nbsp;<span class="num" id="6769698">0</span><span class="op" id="6769699">,</span>&nbsp;<span class="num" id="6769701">1</span><span class="op" id="6769702">)</span><span class="op" id="6769703">,</span>&nbsp;<span class="ident" id="6769705"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6769709">:</span>&nbsp;<span class="num" id="6769711">0</span><span class="op" id="6769712">}</span><span class="op" id="6769713">,</span>&nbsp;<span class="builtintype" id="6769715">nil</span><span class="op" id="6769718">}</span><span class="op" id="6769719">,</span>&nbsp;<span class="comment" id="6769721">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6769741">{</span><span class="string" id="6769742">&#34;&#34;</span><span class="op" id="6769744">,</span>&nbsp;<span class="string" id="6769746">&#34;[::1]:0&#34;</span><span class="op" id="6769755">,</span>&nbsp;<span class="op" id="6769757">&amp;</span><span class="ident" id="6769758"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6769765">{</span><span class="ident" id="6769766"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6769768">:</span>&nbsp;<span class="ident" id="6769770"><a href="/gostd/net/ip.go.html#3299857">ParseIP</a></span><span class="op" id="6769777">(</span><span class="string" id="6769778">&#34;::1&#34;</span><span class="op" id="6769783">)</span><span class="op" id="6769784">,</span>&nbsp;<span class="ident" id="6769786"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6769790">:</span>&nbsp;<span class="num" id="6769792">0</span><span class="op" id="6769793">}</span><span class="op" id="6769794">,</span>&nbsp;<span class="builtintype" id="6769796">nil</span><span class="op" id="6769799">}</span><span class="op" id="6769800">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6769810">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6769831">{</span><span class="string" id="6769832">&#34;tcp&#34;</span><span class="op" id="6769837">,</span>&nbsp;<span class="string" id="6769839">&#34;:12345&#34;</span><span class="op" id="6769847">,</span>&nbsp;<span class="op" id="6769849">&amp;</span><span class="ident" id="6769850"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6769857">{</span><span class="ident" id="6769858"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6769862">:</span>&nbsp;<span class="num" id="6769864">12345</span><span class="op" id="6769869">}</span><span class="op" id="6769870">,</span>&nbsp;<span class="builtintype" id="6769872">nil</span><span class="op" id="6769875">}</span><span class="op" id="6769876">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6769880">{</span><span class="string" id="6769881">&#34;http&#34;</span><span class="op" id="6769887">,</span>&nbsp;<span class="string" id="6769889">&#34;127.0.0.1:0&#34;</span><span class="op" id="6769902">,</span>&nbsp;<span class="builtintype" id="6769904">nil</span><span class="op" id="6769907">,</span>&nbsp;<span class="ident" id="6769909"><a href="/gostd/net/net.go.html#3342949">UnknownNetworkError</a></span><span class="op" id="6769928">(</span><span class="string" id="6769929">&#34;http&#34;</span><span class="op" id="6769935">)</span><span class="op" id="6769936">}</span><span class="op" id="6769937">,</span><br>
<span class="lineno"></span><span class="op" id="6769939">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="6769942">func</span>&nbsp;<span class="ident" id="6769947">init</span><span class="op" id="6769951">(</span><span class="op" id="6769952">)</span>&nbsp;<span class="op" id="6769954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6769957">if</span>&nbsp;<span class="ident" id="6769960">ifi</span>&nbsp;<span class="op" id="6769964">:=</span>&nbsp;<span class="ident" id="6769967"><a href="/gostd/net/interface_test.go.html#6670502">loopbackInterface</a></span><span class="op" id="6769984">(</span><span class="op" id="6769985">)</span><span class="op" id="6769986">;</span>&nbsp;<span class="ident" id="6769988"><a href="/gostd/net/tcp_test.go.html#6769960">ifi</a></span>&nbsp;<span class="op" id="6769992">!=</span>&nbsp;<span class="builtintype" id="6769995">nil</span>&nbsp;<span class="op" id="6769999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6770003">index</span>&nbsp;<span class="op" id="6770009">:=</span>&nbsp;<span class="ident" id="6770012"><a href="/gostd/net/tcp_test.go.html#6763484">fmt</a></span><span class="op" id="6770015">.</span><span class="ident" id="6770016"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="6770023">(</span><span class="string" id="6770024">&#34;%v&#34;</span><span class="op" id="6770028">,</span>&nbsp;<span class="ident" id="6770030"><a href="/gostd/net/tcp_test.go.html#6769960">ifi</a></span><span class="op" id="6770033">.</span><span class="ident" id="6770034"><a href="/gostd/net/interface.go.html#3275485">Index</a></span><span class="op" id="6770039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6770043"><a href="/gostd/net/tcp_test.go.html#6769145">resolveTCPAddrTests</a></span>&nbsp;<span class="op" id="6770063">=</span>&nbsp;<span class="builtinfunc" id="6770065">append</span><span class="op" id="6770071">(</span><span class="ident" id="6770072"><a href="/gostd/net/tcp_test.go.html#6769145">resolveTCPAddrTests</a></span><span class="op" id="6770091">,</span>&nbsp;<span class="op" id="6770093">[</span><span class="op" id="6770094">]</span><span class="ident" id="6770095"><a href="/gostd/net/tcp_test.go.html#6769021">resolveTCPAddrTest</a></span><span class="op" id="6770113">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6770118">{</span><span class="string" id="6770119">&#34;tcp6&#34;</span><span class="op" id="6770125">,</span>&nbsp;<span class="string" id="6770127">&#34;[fe80::1%&#34;</span>&nbsp;<span class="op" id="6770139">+</span>&nbsp;<span class="ident" id="6770141"><a href="/gostd/net/tcp_test.go.html#6769960">ifi</a></span><span class="op" id="6770144">.</span><span class="ident" id="6770145"><a href="/gostd/net/interface.go.html#3275627">Name</a></span>&nbsp;<span class="op" id="6770150">+</span>&nbsp;<span class="string" id="6770152">&#34;]:3&#34;</span><span class="op" id="6770157">,</span>&nbsp;<span class="op" id="6770159">&amp;</span><span class="ident" id="6770160"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6770167">{</span><span class="ident" id="6770168"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6770170">:</span>&nbsp;<span class="ident" id="6770172"><a href="/gostd/net/ip.go.html#3299857">ParseIP</a></span><span class="op" id="6770179">(</span><span class="string" id="6770180">&#34;fe80::1&#34;</span><span class="op" id="6770189">)</span><span class="op" id="6770190">,</span>&nbsp;<span class="ident" id="6770192"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6770196">:</span>&nbsp;<span class="num" id="6770198">3</span><span class="op" id="6770199">,</span>&nbsp;<span class="ident" id="6770201"><a href="/gostd/net/tcpsock.go.html#3373506">Zone</a></span><span class="op" id="6770205">:</span>&nbsp;<span class="ident" id="6770207"><a href="/gostd/net/ipsock.go.html#3317149">zoneToString</a></span><span class="op" id="6770219">(</span><span class="ident" id="6770220"><a href="/gostd/net/tcp_test.go.html#6769960">ifi</a></span><span class="op" id="6770223">.</span><span class="ident" id="6770224"><a href="/gostd/net/interface.go.html#3275485">Index</a></span><span class="op" id="6770229">)</span><span class="op" id="6770230">}</span><span class="op" id="6770231">,</span>&nbsp;<span class="builtintype" id="6770233">nil</span><span class="op" id="6770236">}</span><span class="op" id="6770237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6770242">{</span><span class="string" id="6770243">&#34;tcp6&#34;</span><span class="op" id="6770249">,</span>&nbsp;<span class="string" id="6770251">&#34;[fe80::1%&#34;</span>&nbsp;<span class="op" id="6770263">+</span>&nbsp;<span class="ident" id="6770265"><a href="/gostd/net/tcp_test.go.html#6770003">index</a></span>&nbsp;<span class="op" id="6770271">+</span>&nbsp;<span class="string" id="6770273">&#34;]:4&#34;</span><span class="op" id="6770278">,</span>&nbsp;<span class="op" id="6770280">&amp;</span><span class="ident" id="6770281"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6770288">{</span><span class="ident" id="6770289"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6770291">:</span>&nbsp;<span class="ident" id="6770293"><a href="/gostd/net/ip.go.html#3299857">ParseIP</a></span><span class="op" id="6770300">(</span><span class="string" id="6770301">&#34;fe80::1&#34;</span><span class="op" id="6770310">)</span><span class="op" id="6770311">,</span>&nbsp;<span class="ident" id="6770313"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6770317">:</span>&nbsp;<span class="num" id="6770319">4</span><span class="op" id="6770320">,</span>&nbsp;<span class="ident" id="6770322"><a href="/gostd/net/tcpsock.go.html#3373506">Zone</a></span><span class="op" id="6770326">:</span>&nbsp;<span class="ident" id="6770328"><a href="/gostd/net/tcp_test.go.html#6770003">index</a></span><span class="op" id="6770333">}</span><span class="op" id="6770334">,</span>&nbsp;<span class="builtintype" id="6770336">nil</span><span class="op" id="6770339">}</span><span class="op" id="6770340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6770344">}</span><span class="op" id="6770345">...</span><span class="op" id="6770348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6770351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6770354">if</span>&nbsp;<span class="ident" id="6770357">ips</span><span class="op" id="6770360">,</span>&nbsp;<span class="ident" id="6770362">err</span>&nbsp;<span class="op" id="6770366">:=</span>&nbsp;<span class="ident" id="6770369"><a href="/gostd/net/lookup.go.html#3324041">LookupIP</a></span><span class="op" id="6770377">(</span><span class="string" id="6770378">&#34;localhost&#34;</span><span class="op" id="6770389">)</span><span class="op" id="6770390">;</span>&nbsp;<span class="ident" id="6770392"><a href="/gostd/net/tcp_test.go.html#6770362">err</a></span>&nbsp;<span class="op" id="6770396">==</span>&nbsp;<span class="builtintype" id="6770399">nil</span>&nbsp;<span class="op" id="6770403">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6770406">len</span><span class="op" id="6770409">(</span><span class="ident" id="6770410"><a href="/gostd/net/tcp_test.go.html#6770357">ips</a></span><span class="op" id="6770413">)</span>&nbsp;<span class="op" id="6770415">&gt;</span>&nbsp;<span class="num" id="6770417">1</span>&nbsp;<span class="op" id="6770419">&amp;&amp;</span>&nbsp;<span class="ident" id="6770422"><a href="/gostd/net/ipsock.go.html#3309600">supportsIPv4</a></span>&nbsp;<span class="op" id="6770435">&amp;&amp;</span>&nbsp;<span class="ident" id="6770438"><a href="/gostd/net/ipsock.go.html#3309710">supportsIPv6</a></span>&nbsp;<span class="op" id="6770451">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6770455"><a href="/gostd/net/tcp_test.go.html#6769145">resolveTCPAddrTests</a></span>&nbsp;<span class="op" id="6770475">=</span>&nbsp;<span class="builtinfunc" id="6770477">append</span><span class="op" id="6770483">(</span><span class="ident" id="6770484"><a href="/gostd/net/tcp_test.go.html#6769145">resolveTCPAddrTests</a></span><span class="op" id="6770503">,</span>&nbsp;<span class="op" id="6770505">[</span><span class="op" id="6770506">]</span><span class="ident" id="6770507"><a href="/gostd/net/tcp_test.go.html#6769021">resolveTCPAddrTest</a></span><span class="op" id="6770525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6770530">{</span><span class="string" id="6770531">&#34;tcp&#34;</span><span class="op" id="6770536">,</span>&nbsp;<span class="string" id="6770538">&#34;localhost:5&#34;</span><span class="op" id="6770551">,</span>&nbsp;<span class="op" id="6770553">&amp;</span><span class="ident" id="6770554"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6770561">{</span><span class="ident" id="6770562"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6770564">:</span>&nbsp;<span class="ident" id="6770566"><a href="/gostd/net/ip.go.html#3286541">IPv4</a></span><span class="op" id="6770570">(</span><span class="num" id="6770571">127</span><span class="op" id="6770574">,</span>&nbsp;<span class="num" id="6770576">0</span><span class="op" id="6770577">,</span>&nbsp;<span class="num" id="6770579">0</span><span class="op" id="6770580">,</span>&nbsp;<span class="num" id="6770582">1</span><span class="op" id="6770583">)</span><span class="op" id="6770584">,</span>&nbsp;<span class="ident" id="6770586"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6770590">:</span>&nbsp;<span class="num" id="6770592">5</span><span class="op" id="6770593">}</span><span class="op" id="6770594">,</span>&nbsp;<span class="builtintype" id="6770596">nil</span><span class="op" id="6770599">}</span><span class="op" id="6770600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6770605">{</span><span class="string" id="6770606">&#34;tcp4&#34;</span><span class="op" id="6770612">,</span>&nbsp;<span class="string" id="6770614">&#34;localhost:6&#34;</span><span class="op" id="6770627">,</span>&nbsp;<span class="op" id="6770629">&amp;</span><span class="ident" id="6770630"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6770637">{</span><span class="ident" id="6770638"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6770640">:</span>&nbsp;<span class="ident" id="6770642"><a href="/gostd/net/ip.go.html#3286541">IPv4</a></span><span class="op" id="6770646">(</span><span class="num" id="6770647">127</span><span class="op" id="6770650">,</span>&nbsp;<span class="num" id="6770652">0</span><span class="op" id="6770653">,</span>&nbsp;<span class="num" id="6770655">0</span><span class="op" id="6770656">,</span>&nbsp;<span class="num" id="6770658">1</span><span class="op" id="6770659">)</span><span class="op" id="6770660">,</span>&nbsp;<span class="ident" id="6770662"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6770666">:</span>&nbsp;<span class="num" id="6770668">6</span><span class="op" id="6770669">}</span><span class="op" id="6770670">,</span>&nbsp;<span class="builtintype" id="6770672">nil</span><span class="op" id="6770675">}</span><span class="op" id="6770676">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6770681">{</span><span class="string" id="6770682">&#34;tcp6&#34;</span><span class="op" id="6770688">,</span>&nbsp;<span class="string" id="6770690">&#34;localhost:7&#34;</span><span class="op" id="6770703">,</span>&nbsp;<span class="op" id="6770705">&amp;</span><span class="ident" id="6770706"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6770713">{</span><span class="ident" id="6770714"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6770716">:</span>&nbsp;<span class="ident" id="6770718"><a href="/gostd/net/ip.go.html#3287912">IPv6loopback</a></span><span class="op" id="6770730">,</span>&nbsp;<span class="ident" id="6770732"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6770736">:</span>&nbsp;<span class="num" id="6770738">7</span><span class="op" id="6770739">}</span><span class="op" id="6770740">,</span>&nbsp;<span class="builtintype" id="6770742">nil</span><span class="op" id="6770745">}</span><span class="op" id="6770746">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6770750">}</span><span class="op" id="6770751">...</span><span class="op" id="6770754">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6770757">}</span><br>
<span class="lineno"></span><span class="op" id="6770759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6770762">func</span>&nbsp;<span class="ident" id="6770767">TestResolveTCPAddr</span><span class="op" id="6770785">(</span><span class="ident" id="6770786">t</span>&nbsp;<span class="op" id="6770788">*</span><span class="ident" id="6770789"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6770796">.</span><span class="ident" id="6770797"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6770798">)</span>&nbsp;<span class="op" id="6770800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6770803">for</span>&nbsp;<span class="ident" id="6770807">_</span><span class="op" id="6770808">,</span>&nbsp;<span class="ident" id="6770810">tt</span>&nbsp;<span class="op" id="6770813">:=</span>&nbsp;<span class="keyword" id="6770816">range</span>&nbsp;<span class="ident" id="6770822"><a href="/gostd/net/tcp_test.go.html#6769145">resolveTCPAddrTests</a></span>&nbsp;<span class="op" id="6770842">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6770846">addr</span><span class="op" id="6770850">,</span>&nbsp;<span class="ident" id="6770852">err</span>&nbsp;<span class="op" id="6770856">:=</span>&nbsp;<span class="ident" id="6770859"><a href="/gostd/net/tcpsock.go.html#3374317">ResolveTCPAddr</a></span><span class="op" id="6770873">(</span><span class="ident" id="6770874"><a href="/gostd/net/tcp_test.go.html#6770810">tt</a></span><span class="op" id="6770876">.</span><span class="ident" id="6770877"><a href="/gostd/net/tcp_test.go.html#6769050">net</a></span><span class="op" id="6770880">,</span>&nbsp;<span class="ident" id="6770882"><a href="/gostd/net/tcp_test.go.html#6770810">tt</a></span><span class="op" id="6770884">.</span><span class="ident" id="6770885"><a href="/gostd/net/tcp_test.go.html#6769072">litAddrOrName</a></span><span class="op" id="6770898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6770902">if</span>&nbsp;<span class="ident" id="6770905"><a href="/gostd/net/tcp_test.go.html#6770852">err</a></span>&nbsp;<span class="op" id="6770909">!=</span>&nbsp;<span class="ident" id="6770912"><a href="/gostd/net/tcp_test.go.html#6770810">tt</a></span><span class="op" id="6770914">.</span><span class="ident" id="6770915"><a href="/gostd/net/tcp_test.go.html#6769118">err</a></span>&nbsp;<span class="op" id="6770919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6770924"><a href="/gostd/net/tcp_test.go.html#6770786">t</a></span><span class="op" id="6770925">.</span><span class="ident" id="6770926"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6770932">(</span><span class="string" id="6770933">&#34;ResolveTCPAddr(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6770968">,</span>&nbsp;<span class="ident" id="6770970"><a href="/gostd/net/tcp_test.go.html#6770810">tt</a></span><span class="op" id="6770972">.</span><span class="ident" id="6770973"><a href="/gostd/net/tcp_test.go.html#6769050">net</a></span><span class="op" id="6770976">,</span>&nbsp;<span class="ident" id="6770978"><a href="/gostd/net/tcp_test.go.html#6770810">tt</a></span><span class="op" id="6770980">.</span><span class="ident" id="6770981"><a href="/gostd/net/tcp_test.go.html#6769072">litAddrOrName</a></span><span class="op" id="6770994">,</span>&nbsp;<span class="ident" id="6770996"><a href="/gostd/net/tcp_test.go.html#6770852">err</a></span><span class="op" id="6770999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6771003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6771007">if</span>&nbsp;<span class="op" id="6771010">!</span><span class="ident" id="6771011"><a href="/gostd/net/tcp_test.go.html#6763497">reflect</a></span><span class="op" id="6771018">.</span><span class="ident" id="6771019"><a href="/gostd/reflect/deepequal.go.html#2775472">DeepEqual</a></span><span class="op" id="6771028">(</span><span class="ident" id="6771029"><a href="/gostd/net/tcp_test.go.html#6770846">addr</a></span><span class="op" id="6771033">,</span>&nbsp;<span class="ident" id="6771035"><a href="/gostd/net/tcp_test.go.html#6770810">tt</a></span><span class="op" id="6771037">.</span><span class="ident" id="6771038"><a href="/gostd/net/tcp_test.go.html#6769094">addr</a></span><span class="op" id="6771042">)</span>&nbsp;<span class="op" id="6771044">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6771049"><a href="/gostd/net/tcp_test.go.html#6770786">t</a></span><span class="op" id="6771050">.</span><span class="ident" id="6771051"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6771057">(</span><span class="string" id="6771058">&#34;ResolveTCPAddr(%q,&nbsp;%q)&nbsp;=&nbsp;%#v,&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="6771098">,</span>&nbsp;<span class="ident" id="6771100"><a href="/gostd/net/tcp_test.go.html#6770810">tt</a></span><span class="op" id="6771102">.</span><span class="ident" id="6771103"><a href="/gostd/net/tcp_test.go.html#6769050">net</a></span><span class="op" id="6771106">,</span>&nbsp;<span class="ident" id="6771108"><a href="/gostd/net/tcp_test.go.html#6770810">tt</a></span><span class="op" id="6771110">.</span><span class="ident" id="6771111"><a href="/gostd/net/tcp_test.go.html#6769072">litAddrOrName</a></span><span class="op" id="6771124">,</span>&nbsp;<span class="ident" id="6771126"><a href="/gostd/net/tcp_test.go.html#6770846">addr</a></span><span class="op" id="6771130">,</span>&nbsp;<span class="ident" id="6771132"><a href="/gostd/net/tcp_test.go.html#6770810">tt</a></span><span class="op" id="6771134">.</span><span class="ident" id="6771135"><a href="/gostd/net/tcp_test.go.html#6769094">addr</a></span><span class="op" id="6771139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6771143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6771147">if</span>&nbsp;<span class="ident" id="6771150"><a href="/gostd/net/tcp_test.go.html#6770852">err</a></span>&nbsp;<span class="op" id="6771154">==</span>&nbsp;<span class="builtintype" id="6771157">nil</span>&nbsp;<span class="op" id="6771161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6771166">str</span>&nbsp;<span class="op" id="6771170">:=</span>&nbsp;<span class="ident" id="6771173"><a href="/gostd/net/tcp_test.go.html#6770846">addr</a></span><span class="op" id="6771177">.</span><span class="ident" id="6771178"><a href="/gostd/net/tcpsock.go.html#3373677">String</a></span><span class="op" id="6771184">(</span><span class="op" id="6771185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6771190">addr1</span><span class="op" id="6771195">,</span>&nbsp;<span class="ident" id="6771197">err</span>&nbsp;<span class="op" id="6771201">:=</span>&nbsp;<span class="ident" id="6771204"><a href="/gostd/net/tcpsock.go.html#3374317">ResolveTCPAddr</a></span><span class="op" id="6771218">(</span><span class="ident" id="6771219"><a href="/gostd/net/tcp_test.go.html#6770810">tt</a></span><span class="op" id="6771221">.</span><span class="ident" id="6771222"><a href="/gostd/net/tcp_test.go.html#6769050">net</a></span><span class="op" id="6771225">,</span>&nbsp;<span class="ident" id="6771227"><a href="/gostd/net/tcp_test.go.html#6771166">str</a></span><span class="op" id="6771230">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6771235">if</span>&nbsp;<span class="ident" id="6771238"><a href="/gostd/net/tcp_test.go.html#6771197">err</a></span>&nbsp;<span class="op" id="6771242">!=</span>&nbsp;<span class="builtintype" id="6771245">nil</span>&nbsp;<span class="op" id="6771249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6771255"><a href="/gostd/net/tcp_test.go.html#6770786">t</a></span><span class="op" id="6771256">.</span><span class="ident" id="6771257"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6771263">(</span><span class="string" id="6771264">&#34;ResolveTCPAddr(%q,&nbsp;%q)&nbsp;[from&nbsp;%q]:&nbsp;%v&#34;</span><span class="op" id="6771302">,</span>&nbsp;<span class="ident" id="6771304"><a href="/gostd/net/tcp_test.go.html#6770810">tt</a></span><span class="op" id="6771306">.</span><span class="ident" id="6771307"><a href="/gostd/net/tcp_test.go.html#6769050">net</a></span><span class="op" id="6771310">,</span>&nbsp;<span class="ident" id="6771312"><a href="/gostd/net/tcp_test.go.html#6771166">str</a></span><span class="op" id="6771315">,</span>&nbsp;<span class="ident" id="6771317"><a href="/gostd/net/tcp_test.go.html#6770810">tt</a></span><span class="op" id="6771319">.</span><span class="ident" id="6771320"><a href="/gostd/net/tcp_test.go.html#6769072">litAddrOrName</a></span><span class="op" id="6771333">,</span>&nbsp;<span class="ident" id="6771335"><a href="/gostd/net/tcp_test.go.html#6771197">err</a></span><span class="op" id="6771338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6771343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6771348">if</span>&nbsp;<span class="op" id="6771351">!</span><span class="ident" id="6771352"><a href="/gostd/net/tcp_test.go.html#6763497">reflect</a></span><span class="op" id="6771359">.</span><span class="ident" id="6771360"><a href="/gostd/reflect/deepequal.go.html#2775472">DeepEqual</a></span><span class="op" id="6771369">(</span><span class="ident" id="6771370"><a href="/gostd/net/tcp_test.go.html#6771190">addr1</a></span><span class="op" id="6771375">,</span>&nbsp;<span class="ident" id="6771377"><a href="/gostd/net/tcp_test.go.html#6770846">addr</a></span><span class="op" id="6771381">)</span>&nbsp;<span class="op" id="6771383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6771389"><a href="/gostd/net/tcp_test.go.html#6770786">t</a></span><span class="op" id="6771390">.</span><span class="ident" id="6771391"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6771397">(</span><span class="string" id="6771398">&#34;ResolveTCPAddr(%q,&nbsp;%q)&nbsp;[from&nbsp;%q]&nbsp;=&nbsp;%#v,&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="6771448">,</span>&nbsp;<span class="ident" id="6771450"><a href="/gostd/net/tcp_test.go.html#6770810">tt</a></span><span class="op" id="6771452">.</span><span class="ident" id="6771453"><a href="/gostd/net/tcp_test.go.html#6769050">net</a></span><span class="op" id="6771456">,</span>&nbsp;<span class="ident" id="6771458"><a href="/gostd/net/tcp_test.go.html#6771166">str</a></span><span class="op" id="6771461">,</span>&nbsp;<span class="ident" id="6771463"><a href="/gostd/net/tcp_test.go.html#6770810">tt</a></span><span class="op" id="6771465">.</span><span class="ident" id="6771466"><a href="/gostd/net/tcp_test.go.html#6769072">litAddrOrName</a></span><span class="op" id="6771479">,</span>&nbsp;<span class="ident" id="6771481"><a href="/gostd/net/tcp_test.go.html#6771190">addr1</a></span><span class="op" id="6771486">,</span>&nbsp;<span class="ident" id="6771488"><a href="/gostd/net/tcp_test.go.html#6770846">addr</a></span><span class="op" id="6771492">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6771497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6771501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6771504">}</span><br>
<span class="lineno"></span><span class="op" id="6771506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="6771509">var</span>&nbsp;<span class="ident" id="6771513">tcpListenerNameTests</span>&nbsp;<span class="op" id="6771534">=</span>&nbsp;<span class="op" id="6771536">[</span><span class="op" id="6771537">]</span><span class="keyword" id="6771538">struct</span>&nbsp;<span class="op" id="6771545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6771548">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6771554">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6771562">laddr</span>&nbsp;<span class="op" id="6771568">*</span><span class="ident" id="6771569"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><br>
<span class="lineno"></span><span class="op" id="6771577">}</span><span class="op" id="6771578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6771581">{</span><span class="string" id="6771582">&#34;tcp4&#34;</span><span class="op" id="6771588">,</span>&nbsp;<span class="op" id="6771590">&amp;</span><span class="ident" id="6771591"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6771598">{</span><span class="ident" id="6771599"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6771601">:</span>&nbsp;<span class="ident" id="6771603"><a href="/gostd/net/ip.go.html#3286541">IPv4</a></span><span class="op" id="6771607">(</span><span class="num" id="6771608">127</span><span class="op" id="6771611">,</span>&nbsp;<span class="num" id="6771613">0</span><span class="op" id="6771614">,</span>&nbsp;<span class="num" id="6771616">0</span><span class="op" id="6771617">,</span>&nbsp;<span class="num" id="6771619">1</span><span class="op" id="6771620">)</span><span class="op" id="6771621">}</span><span class="op" id="6771622">}</span><span class="op" id="6771623">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6771626">{</span><span class="string" id="6771627">&#34;tcp4&#34;</span><span class="op" id="6771633">,</span>&nbsp;<span class="op" id="6771635">&amp;</span><span class="ident" id="6771636"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6771643">{</span><span class="op" id="6771644">}</span><span class="op" id="6771645">}</span><span class="op" id="6771646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6771649">{</span><span class="string" id="6771650">&#34;tcp4&#34;</span><span class="op" id="6771656">,</span>&nbsp;<span class="builtintype" id="6771658">nil</span><span class="op" id="6771661">}</span><span class="op" id="6771662">,</span><br>
<span class="lineno"></span><span class="op" id="6771664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6771667">func</span>&nbsp;<span class="ident" id="6771672">TestTCPListenerName</span><span class="op" id="6771691">(</span><span class="ident" id="6771692">t</span>&nbsp;<span class="op" id="6771694">*</span><span class="ident" id="6771695"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6771702">.</span><span class="ident" id="6771703"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6771704">)</span>&nbsp;<span class="op" id="6771706">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6771709">if</span>&nbsp;<span class="ident" id="6771712"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6771719">.</span><span class="ident" id="6771720"><a href="/gostd/testing/testing.go.html#5475359">Short</a></span><span class="op" id="6771725">(</span><span class="op" id="6771726">)</span>&nbsp;<span class="op" id="6771728">||</span>&nbsp;<span class="op" id="6771731">!</span><span class="op" id="6771732">*</span><span class="ident" id="6771733"><a href="/gostd/net/lookup_test.go.html#6707430">testExternal</a></span>&nbsp;<span class="op" id="6771746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6771750"><a href="/gostd/net/tcp_test.go.html#6771692">t</a></span><span class="op" id="6771751">.</span><span class="ident" id="6771752"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="6771756">(</span><span class="string" id="6771757">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6771798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6771801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6771805">for</span>&nbsp;<span class="ident" id="6771809">_</span><span class="op" id="6771810">,</span>&nbsp;<span class="ident" id="6771812">tt</span>&nbsp;<span class="op" id="6771815">:=</span>&nbsp;<span class="keyword" id="6771818">range</span>&nbsp;<span class="ident" id="6771824"><a href="/gostd/net/tcp_test.go.html#6771513">tcpListenerNameTests</a></span>&nbsp;<span class="op" id="6771845">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6771849">ln</span><span class="op" id="6771851">,</span>&nbsp;<span class="ident" id="6771853">err</span>&nbsp;<span class="op" id="6771857">:=</span>&nbsp;<span class="ident" id="6771860"><a href="/gostd/net/tcpsock_posix.go.html#3383816">ListenTCP</a></span><span class="op" id="6771869">(</span><span class="ident" id="6771870"><a href="/gostd/net/tcp_test.go.html#6771812">tt</a></span><span class="op" id="6771872">.</span><span class="ident" id="6771873"><a href="/gostd/net/tcp_test.go.html#6771548">net</a></span><span class="op" id="6771876">,</span>&nbsp;<span class="ident" id="6771878"><a href="/gostd/net/tcp_test.go.html#6771812">tt</a></span><span class="op" id="6771880">.</span><span class="ident" id="6771881"><a href="/gostd/net/tcp_test.go.html#6771562">laddr</a></span><span class="op" id="6771886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6771890">if</span>&nbsp;<span class="ident" id="6771893"><a href="/gostd/net/tcp_test.go.html#6771853">err</a></span>&nbsp;<span class="op" id="6771897">!=</span>&nbsp;<span class="builtintype" id="6771900">nil</span>&nbsp;<span class="op" id="6771904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6771909"><a href="/gostd/net/tcp_test.go.html#6771692">t</a></span><span class="op" id="6771910">.</span><span class="ident" id="6771911"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6771917">(</span><span class="string" id="6771918">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6771940">,</span>&nbsp;<span class="ident" id="6771942"><a href="/gostd/net/tcp_test.go.html#6771853">err</a></span><span class="op" id="6771945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6771949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6771953">defer</span>&nbsp;<span class="ident" id="6771959"><a href="/gostd/net/tcp_test.go.html#6771849">ln</a></span><span class="op" id="6771961">.</span><span class="ident" id="6771962"><a href="/gostd/net/tcpsock_posix.go.html#3382598">Close</a></span><span class="op" id="6771967">(</span><span class="op" id="6771968">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6771972">la</span>&nbsp;<span class="op" id="6771975">:=</span>&nbsp;<span class="ident" id="6771978"><a href="/gostd/net/tcp_test.go.html#6771849">ln</a></span><span class="op" id="6771980">.</span><span class="ident" id="6771981"><a href="/gostd/net/tcpsock_posix.go.html#3382777">Addr</a></span><span class="op" id="6771985">(</span><span class="op" id="6771986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6771990">if</span>&nbsp;<span class="ident" id="6771993">a</span><span class="op" id="6771994">,</span>&nbsp;<span class="ident" id="6771996">ok</span>&nbsp;<span class="op" id="6771999">:=</span>&nbsp;<span class="ident" id="6772002"><a href="/gostd/net/tcp_test.go.html#6771972">la</a></span><span class="op" id="6772004">.</span><span class="op" id="6772005">(</span><span class="op" id="6772006">*</span><span class="ident" id="6772007"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6772014">)</span><span class="op" id="6772015">;</span>&nbsp;<span class="op" id="6772017">!</span><span class="ident" id="6772018"><a href="/gostd/net/tcp_test.go.html#6771996">ok</a></span>&nbsp;<span class="op" id="6772021">||</span>&nbsp;<span class="ident" id="6772024"><a href="/gostd/net/tcp_test.go.html#6771993">a</a></span><span class="op" id="6772025">.</span><span class="ident" id="6772026"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span>&nbsp;<span class="op" id="6772031">==</span>&nbsp;<span class="num" id="6772034">0</span>&nbsp;<span class="op" id="6772036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6772041"><a href="/gostd/net/tcp_test.go.html#6771692">t</a></span><span class="op" id="6772042">.</span><span class="ident" id="6772043"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6772049">(</span><span class="string" id="6772050">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;non-zero&nbsp;port&nbsp;number&#34;</span><span class="op" id="6772111">,</span>&nbsp;<span class="ident" id="6772113"><a href="/gostd/net/tcp_test.go.html#6771972">la</a></span><span class="op" id="6772115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6772119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6772122">}</span><br>
<span class="lineno">375</span><span class="op" id="6772124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6772127">func</span>&nbsp;<span class="ident" id="6772132">TestIPv6LinkLocalUnicastTCP</span><span class="op" id="6772159">(</span><span class="ident" id="6772160">t</span>&nbsp;<span class="op" id="6772162">*</span><span class="ident" id="6772163"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6772170">.</span><span class="ident" id="6772171"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6772172">)</span>&nbsp;<span class="op" id="6772174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6772177">if</span>&nbsp;<span class="ident" id="6772180"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6772187">.</span><span class="ident" id="6772188"><a href="/gostd/testing/testing.go.html#5475359">Short</a></span><span class="op" id="6772193">(</span><span class="op" id="6772194">)</span>&nbsp;<span class="op" id="6772196">||</span>&nbsp;<span class="op" id="6772199">!</span><span class="op" id="6772200">*</span><span class="ident" id="6772201"><a href="/gostd/net/lookup_test.go.html#6707430">testExternal</a></span>&nbsp;<span class="op" id="6772214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6772218"><a href="/gostd/net/tcp_test.go.html#6772160">t</a></span><span class="op" id="6772219">.</span><span class="ident" id="6772220"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="6772224">(</span><span class="string" id="6772225">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6772266">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6772269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6772272">if</span>&nbsp;<span class="op" id="6772275">!</span><span class="ident" id="6772276"><a href="/gostd/net/ipsock.go.html#3309710">supportsIPv6</a></span>&nbsp;<span class="op" id="6772289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6772293"><a href="/gostd/net/tcp_test.go.html#6772160">t</a></span><span class="op" id="6772294">.</span><span class="ident" id="6772295"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="6772299">(</span><span class="string" id="6772300">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6772323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6772326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6772329">ifi</span>&nbsp;<span class="op" id="6772333">:=</span>&nbsp;<span class="ident" id="6772336"><a href="/gostd/net/interface_test.go.html#6670502">loopbackInterface</a></span><span class="op" id="6772353">(</span><span class="op" id="6772354">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6772357">if</span>&nbsp;<span class="ident" id="6772360"><a href="/gostd/net/tcp_test.go.html#6772329">ifi</a></span>&nbsp;<span class="op" id="6772364">==</span>&nbsp;<span class="builtintype" id="6772367">nil</span>&nbsp;<span class="op" id="6772371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6772375"><a href="/gostd/net/tcp_test.go.html#6772160">t</a></span><span class="op" id="6772376">.</span><span class="ident" id="6772377"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="6772381">(</span><span class="string" id="6772382">&#34;loopback&nbsp;interface&nbsp;not&nbsp;found&#34;</span><span class="op" id="6772412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6772415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6772418">laddr</span>&nbsp;<span class="op" id="6772424">:=</span>&nbsp;<span class="ident" id="6772427"><a href="/gostd/net/interface_test.go.html#6670889">ipv6LinkLocalUnicastAddr</a></span><span class="op" id="6772451">(</span><span class="ident" id="6772452"><a href="/gostd/net/tcp_test.go.html#6772329">ifi</a></span><span class="op" id="6772455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6772458">if</span>&nbsp;<span class="ident" id="6772461"><a href="/gostd/net/tcp_test.go.html#6772418">laddr</a></span>&nbsp;<span class="op" id="6772467">==</span>&nbsp;<span class="string" id="6772470">&#34;&#34;</span>&nbsp;<span class="op" id="6772473">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6772477"><a href="/gostd/net/tcp_test.go.html#6772160">t</a></span><span class="op" id="6772478">.</span><span class="ident" id="6772479"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="6772483">(</span><span class="string" id="6772484">&#34;ipv6&nbsp;unicast&nbsp;address&nbsp;on&nbsp;loopback&nbsp;not&nbsp;found&#34;</span><span class="op" id="6772528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6772531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6772535">type</span>&nbsp;<span class="ident" id="6772540">test</span>&nbsp;<span class="keyword" id="6772545">struct</span>&nbsp;<span class="op" id="6772552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6772556">net</span><span class="op" id="6772559">,</span>&nbsp;<span class="ident" id="6772561">addr</span>&nbsp;&nbsp;<span class="builtintype" id="6772567">string</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6772576">nameLookup</span>&nbsp;<span class="builtintype" id="6772587">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6772593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6772596">var</span>&nbsp;<span class="ident" id="6772600">tests</span>&nbsp;<span class="op" id="6772606">=</span>&nbsp;<span class="op" id="6772608">[</span><span class="op" id="6772609">]</span><span class="ident" id="6772610"><a href="/gostd/net/tcp_test.go.html#6772540">test</a></span><span class="op" id="6772614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6772618">{</span><span class="string" id="6772619">&#34;tcp&#34;</span><span class="op" id="6772624">,</span>&nbsp;<span class="string" id="6772626">&#34;[&#34;</span>&nbsp;<span class="op" id="6772630">+</span>&nbsp;<span class="ident" id="6772632"><a href="/gostd/net/tcp_test.go.html#6772418">laddr</a></span>&nbsp;<span class="op" id="6772638">+</span>&nbsp;<span class="string" id="6772640">&#34;%&#34;</span>&nbsp;<span class="op" id="6772644">+</span>&nbsp;<span class="ident" id="6772646"><a href="/gostd/net/tcp_test.go.html#6772329">ifi</a></span><span class="op" id="6772649">.</span><span class="ident" id="6772650"><a href="/gostd/net/interface.go.html#3275627">Name</a></span>&nbsp;<span class="op" id="6772655">+</span>&nbsp;<span class="string" id="6772657">&#34;]:0&#34;</span><span class="op" id="6772662">,</span>&nbsp;<span class="builtintype" id="6772664">false</span><span class="op" id="6772669">}</span><span class="op" id="6772670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6772674">{</span><span class="string" id="6772675">&#34;tcp6&#34;</span><span class="op" id="6772681">,</span>&nbsp;<span class="string" id="6772683">&#34;[&#34;</span>&nbsp;<span class="op" id="6772687">+</span>&nbsp;<span class="ident" id="6772689"><a href="/gostd/net/tcp_test.go.html#6772418">laddr</a></span>&nbsp;<span class="op" id="6772695">+</span>&nbsp;<span class="string" id="6772697">&#34;%&#34;</span>&nbsp;<span class="op" id="6772701">+</span>&nbsp;<span class="ident" id="6772703"><a href="/gostd/net/tcp_test.go.html#6772329">ifi</a></span><span class="op" id="6772706">.</span><span class="ident" id="6772707"><a href="/gostd/net/interface.go.html#3275627">Name</a></span>&nbsp;<span class="op" id="6772712">+</span>&nbsp;<span class="string" id="6772714">&#34;]:0&#34;</span><span class="op" id="6772719">,</span>&nbsp;<span class="builtintype" id="6772721">false</span><span class="op" id="6772726">}</span><span class="op" id="6772727">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6772730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6772733">switch</span>&nbsp;<span class="ident" id="6772740"><a href="/gostd/net/tcp_test.go.html#6763508">runtime</a></span><span class="op" id="6772747">.</span><span class="ident" id="6772748"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span>&nbsp;<span class="op" id="6772753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6772756">case</span>&nbsp;<span class="string" id="6772761">&#34;darwin&#34;</span><span class="op" id="6772769">,</span>&nbsp;<span class="string" id="6772771">&#34;freebsd&#34;</span><span class="op" id="6772780">,</span>&nbsp;<span class="string" id="6772782">&#34;openbsd&#34;</span><span class="op" id="6772791">,</span>&nbsp;<span class="string" id="6772793">&#34;netbsd&#34;</span><span class="op" id="6772801">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6772805"><a href="/gostd/net/tcp_test.go.html#6772600">tests</a></span>&nbsp;<span class="op" id="6772811">=</span>&nbsp;<span class="builtinfunc" id="6772813">append</span><span class="op" id="6772819">(</span><span class="ident" id="6772820"><a href="/gostd/net/tcp_test.go.html#6772600">tests</a></span><span class="op" id="6772825">,</span>&nbsp;<span class="op" id="6772827">[</span><span class="op" id="6772828">]</span><span class="ident" id="6772829"><a href="/gostd/net/tcp_test.go.html#6772540">test</a></span><span class="op" id="6772833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6772838">{</span><span class="string" id="6772839">&#34;tcp&#34;</span><span class="op" id="6772844">,</span>&nbsp;<span class="string" id="6772846">&#34;[localhost%&#34;</span>&nbsp;<span class="op" id="6772860">+</span>&nbsp;<span class="ident" id="6772862"><a href="/gostd/net/tcp_test.go.html#6772329">ifi</a></span><span class="op" id="6772865">.</span><span class="ident" id="6772866"><a href="/gostd/net/interface.go.html#3275627">Name</a></span>&nbsp;<span class="op" id="6772871">+</span>&nbsp;<span class="string" id="6772873">&#34;]:0&#34;</span><span class="op" id="6772878">,</span>&nbsp;<span class="builtintype" id="6772880">true</span><span class="op" id="6772884">}</span><span class="op" id="6772885">,</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6772890">{</span><span class="string" id="6772891">&#34;tcp6&#34;</span><span class="op" id="6772897">,</span>&nbsp;<span class="string" id="6772899">&#34;[localhost%&#34;</span>&nbsp;<span class="op" id="6772913">+</span>&nbsp;<span class="ident" id="6772915"><a href="/gostd/net/tcp_test.go.html#6772329">ifi</a></span><span class="op" id="6772918">.</span><span class="ident" id="6772919"><a href="/gostd/net/interface.go.html#3275627">Name</a></span>&nbsp;<span class="op" id="6772924">+</span>&nbsp;<span class="string" id="6772926">&#34;]:0&#34;</span><span class="op" id="6772931">,</span>&nbsp;<span class="builtintype" id="6772933">true</span><span class="op" id="6772937">}</span><span class="op" id="6772938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6772942">}</span><span class="op" id="6772943">...</span><span class="op" id="6772946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6772949">case</span>&nbsp;<span class="string" id="6772954">&#34;linux&#34;</span><span class="op" id="6772961">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6772965"><a href="/gostd/net/tcp_test.go.html#6772600">tests</a></span>&nbsp;<span class="op" id="6772971">=</span>&nbsp;<span class="builtinfunc" id="6772973">append</span><span class="op" id="6772979">(</span><span class="ident" id="6772980"><a href="/gostd/net/tcp_test.go.html#6772600">tests</a></span><span class="op" id="6772985">,</span>&nbsp;<span class="op" id="6772987">[</span><span class="op" id="6772988">]</span><span class="ident" id="6772989"><a href="/gostd/net/tcp_test.go.html#6772540">test</a></span><span class="op" id="6772993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6772998">{</span><span class="string" id="6772999">&#34;tcp&#34;</span><span class="op" id="6773004">,</span>&nbsp;<span class="string" id="6773006">&#34;[ip6-localhost%&#34;</span>&nbsp;<span class="op" id="6773024">+</span>&nbsp;<span class="ident" id="6773026"><a href="/gostd/net/tcp_test.go.html#6772329">ifi</a></span><span class="op" id="6773029">.</span><span class="ident" id="6773030"><a href="/gostd/net/interface.go.html#3275627">Name</a></span>&nbsp;<span class="op" id="6773035">+</span>&nbsp;<span class="string" id="6773037">&#34;]:0&#34;</span><span class="op" id="6773042">,</span>&nbsp;<span class="builtintype" id="6773044">true</span><span class="op" id="6773048">}</span><span class="op" id="6773049">,</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6773054">{</span><span class="string" id="6773055">&#34;tcp6&#34;</span><span class="op" id="6773061">,</span>&nbsp;<span class="string" id="6773063">&#34;[ip6-localhost%&#34;</span>&nbsp;<span class="op" id="6773081">+</span>&nbsp;<span class="ident" id="6773083"><a href="/gostd/net/tcp_test.go.html#6772329">ifi</a></span><span class="op" id="6773086">.</span><span class="ident" id="6773087"><a href="/gostd/net/interface.go.html#3275627">Name</a></span>&nbsp;<span class="op" id="6773092">+</span>&nbsp;<span class="string" id="6773094">&#34;]:0&#34;</span><span class="op" id="6773099">,</span>&nbsp;<span class="builtintype" id="6773101">true</span><span class="op" id="6773105">}</span><span class="op" id="6773106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6773110">}</span><span class="op" id="6773111">...</span><span class="op" id="6773114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6773117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6773120">for</span>&nbsp;<span class="ident" id="6773124">_</span><span class="op" id="6773125">,</span>&nbsp;<span class="ident" id="6773127">tt</span>&nbsp;<span class="op" id="6773130">:=</span>&nbsp;<span class="keyword" id="6773133">range</span>&nbsp;<span class="ident" id="6773139"><a href="/gostd/net/tcp_test.go.html#6772600">tests</a></span>&nbsp;<span class="op" id="6773145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6773149">ln</span><span class="op" id="6773151">,</span>&nbsp;<span class="ident" id="6773153">err</span>&nbsp;<span class="op" id="6773157">:=</span>&nbsp;<span class="ident" id="6773160"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="6773166">(</span><span class="ident" id="6773167"><a href="/gostd/net/tcp_test.go.html#6773127">tt</a></span><span class="op" id="6773169">.</span><span class="ident" id="6773170"><a href="/gostd/net/tcp_test.go.html#6772556">net</a></span><span class="op" id="6773173">,</span>&nbsp;<span class="ident" id="6773175"><a href="/gostd/net/tcp_test.go.html#6773127">tt</a></span><span class="op" id="6773177">.</span><span class="ident" id="6773178"><a href="/gostd/net/tcp_test.go.html#6772561">addr</a></span><span class="op" id="6773182">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6773186">if</span>&nbsp;<span class="ident" id="6773189"><a href="/gostd/net/tcp_test.go.html#6773153">err</a></span>&nbsp;<span class="op" id="6773193">!=</span>&nbsp;<span class="builtintype" id="6773196">nil</span>&nbsp;<span class="op" id="6773200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6773205">//&nbsp;It&nbsp;might&nbsp;return&nbsp;&#34;LookupHost&nbsp;returned&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6773251">//&nbsp;suitable&nbsp;address&#34;&nbsp;error&nbsp;on&nbsp;some&nbsp;platforms.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6773300"><a href="/gostd/net/tcp_test.go.html#6772160">t</a></span><span class="op" id="6773301">.</span><span class="ident" id="6773302"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="6773306">(</span><span class="string" id="6773307">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6773326">,</span>&nbsp;<span class="ident" id="6773328"><a href="/gostd/net/tcp_test.go.html#6773153">err</a></span><span class="op" id="6773331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6773336">continue</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6773347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6773351">defer</span>&nbsp;<span class="ident" id="6773357"><a href="/gostd/net/tcp_test.go.html#6773149">ln</a></span><span class="op" id="6773359">.</span><span class="ident" id="6773360"><a href="/gostd/net/net.go.html#3340928">Close</a></span><span class="op" id="6773365">(</span><span class="op" id="6773366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6773370">if</span>&nbsp;<span class="ident" id="6773373">la</span><span class="op" id="6773375">,</span>&nbsp;<span class="ident" id="6773377">ok</span>&nbsp;<span class="op" id="6773380">:=</span>&nbsp;<span class="ident" id="6773383"><a href="/gostd/net/tcp_test.go.html#6773149">ln</a></span><span class="op" id="6773385">.</span><span class="ident" id="6773386"><a href="/gostd/net/net.go.html#3340993">Addr</a></span><span class="op" id="6773390">(</span><span class="op" id="6773391">)</span><span class="op" id="6773392">.</span><span class="op" id="6773393">(</span><span class="op" id="6773394">*</span><span class="ident" id="6773395"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6773402">)</span><span class="op" id="6773403">;</span>&nbsp;<span class="op" id="6773405">!</span><span class="ident" id="6773406"><a href="/gostd/net/tcp_test.go.html#6773377">ok</a></span>&nbsp;<span class="op" id="6773409">||</span>&nbsp;<span class="op" id="6773412">!</span><span class="ident" id="6773413"><a href="/gostd/net/tcp_test.go.html#6773127">tt</a></span><span class="op" id="6773415">.</span><span class="ident" id="6773416"><a href="/gostd/net/tcp_test.go.html#6772576">nameLookup</a></span>&nbsp;<span class="op" id="6773427">&amp;&amp;</span>&nbsp;<span class="ident" id="6773430"><a href="/gostd/net/tcp_test.go.html#6773373">la</a></span><span class="op" id="6773432">.</span><span class="ident" id="6773433"><a href="/gostd/net/tcpsock.go.html#3373506">Zone</a></span>&nbsp;<span class="op" id="6773438">==</span>&nbsp;<span class="string" id="6773441">&#34;&#34;</span>&nbsp;<span class="op" id="6773444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6773449"><a href="/gostd/net/tcp_test.go.html#6772160">t</a></span><span class="op" id="6773450">.</span><span class="ident" id="6773451"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6773457">(</span><span class="string" id="6773458">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="6773514">,</span>&nbsp;<span class="ident" id="6773516"><a href="/gostd/net/tcp_test.go.html#6773373">la</a></span><span class="op" id="6773518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6773522">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6773527">done</span>&nbsp;<span class="op" id="6773532">:=</span>&nbsp;<span class="builtinfunc" id="6773535">make</span><span class="op" id="6773539">(</span><span class="keyword" id="6773540">chan</span>&nbsp;<span class="builtintype" id="6773545">int</span><span class="op" id="6773548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6773552">go</span>&nbsp;<span class="ident" id="6773555"><a href="/gostd/net/conn_test.go.html#6620185">transponder</a></span><span class="op" id="6773566">(</span><span class="ident" id="6773567"><a href="/gostd/net/tcp_test.go.html#6772160">t</a></span><span class="op" id="6773568">,</span>&nbsp;<span class="ident" id="6773570"><a href="/gostd/net/tcp_test.go.html#6773149">ln</a></span><span class="op" id="6773572">,</span>&nbsp;<span class="ident" id="6773574"><a href="/gostd/net/tcp_test.go.html#6773527">done</a></span><span class="op" id="6773578">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6773583">c</span><span class="op" id="6773584">,</span>&nbsp;<span class="ident" id="6773586"><a href="/gostd/net/tcp_test.go.html#6773153">err</a></span>&nbsp;<span class="op" id="6773590">:=</span>&nbsp;<span class="ident" id="6773593"><a href="/gostd/net/dial.go.html#3203459">Dial</a></span><span class="op" id="6773597">(</span><span class="ident" id="6773598"><a href="/gostd/net/tcp_test.go.html#6773127">tt</a></span><span class="op" id="6773600">.</span><span class="ident" id="6773601"><a href="/gostd/net/tcp_test.go.html#6772556">net</a></span><span class="op" id="6773604">,</span>&nbsp;<span class="ident" id="6773606"><a href="/gostd/net/tcp_test.go.html#6773149">ln</a></span><span class="op" id="6773608">.</span><span class="ident" id="6773609"><a href="/gostd/net/net.go.html#3340993">Addr</a></span><span class="op" id="6773613">(</span><span class="op" id="6773614">)</span><span class="op" id="6773615">.</span><span class="ident" id="6773616"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="6773622">(</span><span class="op" id="6773623">)</span><span class="op" id="6773624">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6773628">if</span>&nbsp;<span class="ident" id="6773631"><a href="/gostd/net/tcp_test.go.html#6773153">err</a></span>&nbsp;<span class="op" id="6773635">!=</span>&nbsp;<span class="builtintype" id="6773638">nil</span>&nbsp;<span class="op" id="6773642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6773647"><a href="/gostd/net/tcp_test.go.html#6772160">t</a></span><span class="op" id="6773648">.</span><span class="ident" id="6773649"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6773655">(</span><span class="string" id="6773656">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6773673">,</span>&nbsp;<span class="ident" id="6773675"><a href="/gostd/net/tcp_test.go.html#6773153">err</a></span><span class="op" id="6773678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6773682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6773686">defer</span>&nbsp;<span class="ident" id="6773692"><a href="/gostd/net/tcp_test.go.html#6773583">c</a></span><span class="op" id="6773693">.</span><span class="ident" id="6773694"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6773699">(</span><span class="op" id="6773700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6773704">if</span>&nbsp;<span class="ident" id="6773707">la</span><span class="op" id="6773709">,</span>&nbsp;<span class="ident" id="6773711">ok</span>&nbsp;<span class="op" id="6773714">:=</span>&nbsp;<span class="ident" id="6773717"><a href="/gostd/net/tcp_test.go.html#6773583">c</a></span><span class="op" id="6773718">.</span><span class="ident" id="6773719"><a href="/gostd/net/net.go.html#3335052">LocalAddr</a></span><span class="op" id="6773728">(</span><span class="op" id="6773729">)</span><span class="op" id="6773730">.</span><span class="op" id="6773731">(</span><span class="op" id="6773732">*</span><span class="ident" id="6773733"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6773740">)</span><span class="op" id="6773741">;</span>&nbsp;<span class="op" id="6773743">!</span><span class="ident" id="6773744"><a href="/gostd/net/tcp_test.go.html#6773711">ok</a></span>&nbsp;<span class="op" id="6773747">||</span>&nbsp;<span class="op" id="6773750">!</span><span class="ident" id="6773751"><a href="/gostd/net/tcp_test.go.html#6773127">tt</a></span><span class="op" id="6773753">.</span><span class="ident" id="6773754"><a href="/gostd/net/tcp_test.go.html#6772576">nameLookup</a></span>&nbsp;<span class="op" id="6773765">&amp;&amp;</span>&nbsp;<span class="ident" id="6773768"><a href="/gostd/net/tcp_test.go.html#6773707">la</a></span><span class="op" id="6773770">.</span><span class="ident" id="6773771"><a href="/gostd/net/tcpsock.go.html#3373506">Zone</a></span>&nbsp;<span class="op" id="6773776">==</span>&nbsp;<span class="string" id="6773779">&#34;&#34;</span>&nbsp;<span class="op" id="6773782">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6773787"><a href="/gostd/net/tcp_test.go.html#6772160">t</a></span><span class="op" id="6773788">.</span><span class="ident" id="6773789"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6773795">(</span><span class="string" id="6773796">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="6773852">,</span>&nbsp;<span class="ident" id="6773854"><a href="/gostd/net/tcp_test.go.html#6773707">la</a></span><span class="op" id="6773856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6773860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6773864">if</span>&nbsp;<span class="ident" id="6773867">ra</span><span class="op" id="6773869">,</span>&nbsp;<span class="ident" id="6773871">ok</span>&nbsp;<span class="op" id="6773874">:=</span>&nbsp;<span class="ident" id="6773877"><a href="/gostd/net/tcp_test.go.html#6773583">c</a></span><span class="op" id="6773878">.</span><span class="ident" id="6773879"><a href="/gostd/net/net.go.html#3335122">RemoteAddr</a></span><span class="op" id="6773889">(</span><span class="op" id="6773890">)</span><span class="op" id="6773891">.</span><span class="op" id="6773892">(</span><span class="op" id="6773893">*</span><span class="ident" id="6773894"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6773901">)</span><span class="op" id="6773902">;</span>&nbsp;<span class="op" id="6773904">!</span><span class="ident" id="6773905"><a href="/gostd/net/tcp_test.go.html#6773871">ok</a></span>&nbsp;<span class="op" id="6773908">||</span>&nbsp;<span class="op" id="6773911">!</span><span class="ident" id="6773912"><a href="/gostd/net/tcp_test.go.html#6773127">tt</a></span><span class="op" id="6773914">.</span><span class="ident" id="6773915"><a href="/gostd/net/tcp_test.go.html#6772576">nameLookup</a></span>&nbsp;<span class="op" id="6773926">&amp;&amp;</span>&nbsp;<span class="ident" id="6773929"><a href="/gostd/net/tcp_test.go.html#6773867">ra</a></span><span class="op" id="6773931">.</span><span class="ident" id="6773932"><a href="/gostd/net/tcpsock.go.html#3373506">Zone</a></span>&nbsp;<span class="op" id="6773937">==</span>&nbsp;<span class="string" id="6773940">&#34;&#34;</span>&nbsp;<span class="op" id="6773943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6773948"><a href="/gostd/net/tcp_test.go.html#6772160">t</a></span><span class="op" id="6773949">.</span><span class="ident" id="6773950"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6773956">(</span><span class="string" id="6773957">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="6774013">,</span>&nbsp;<span class="ident" id="6774015"><a href="/gostd/net/tcp_test.go.html#6773867">ra</a></span><span class="op" id="6774017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6774021">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6774026">if</span>&nbsp;<span class="ident" id="6774029">_</span><span class="op" id="6774030">,</span>&nbsp;<span class="ident" id="6774032">err</span>&nbsp;<span class="op" id="6774036">:=</span>&nbsp;<span class="ident" id="6774039"><a href="/gostd/net/tcp_test.go.html#6773583">c</a></span><span class="op" id="6774040">.</span><span class="ident" id="6774041"><a href="/gostd/net/net.go.html#3334839">Write</a></span><span class="op" id="6774046">(</span><span class="op" id="6774047">[</span><span class="op" id="6774048">]</span><span class="builtintype" id="6774049">byte</span><span class="op" id="6774053">(</span><span class="string" id="6774054">&#34;TCP&nbsp;OVER&nbsp;IPV6&nbsp;LINKLOCAL&nbsp;TEST&#34;</span><span class="op" id="6774084">)</span><span class="op" id="6774085">)</span><span class="op" id="6774086">;</span>&nbsp;<span class="ident" id="6774088"><a href="/gostd/net/tcp_test.go.html#6774032">err</a></span>&nbsp;<span class="op" id="6774092">!=</span>&nbsp;<span class="builtintype" id="6774095">nil</span>&nbsp;<span class="op" id="6774099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774104"><a href="/gostd/net/tcp_test.go.html#6772160">t</a></span><span class="op" id="6774105">.</span><span class="ident" id="6774106"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6774112">(</span><span class="string" id="6774113">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6774136">,</span>&nbsp;<span class="ident" id="6774138"><a href="/gostd/net/tcp_test.go.html#6774032">err</a></span><span class="op" id="6774141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6774145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774149">b</span>&nbsp;<span class="op" id="6774151">:=</span>&nbsp;<span class="builtinfunc" id="6774154">make</span><span class="op" id="6774158">(</span><span class="op" id="6774159">[</span><span class="op" id="6774160">]</span><span class="builtintype" id="6774161">byte</span><span class="op" id="6774165">,</span>&nbsp;<span class="num" id="6774167">32</span><span class="op" id="6774169">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6774173">if</span>&nbsp;<span class="ident" id="6774176">_</span><span class="op" id="6774177">,</span>&nbsp;<span class="ident" id="6774179">err</span>&nbsp;<span class="op" id="6774183">:=</span>&nbsp;<span class="ident" id="6774186"><a href="/gostd/net/tcp_test.go.html#6773583">c</a></span><span class="op" id="6774187">.</span><span class="ident" id="6774188"><a href="/gostd/net/net.go.html#3334618">Read</a></span><span class="op" id="6774192">(</span><span class="ident" id="6774193"><a href="/gostd/net/tcp_test.go.html#6774149">b</a></span><span class="op" id="6774194">)</span><span class="op" id="6774195">;</span>&nbsp;<span class="ident" id="6774197"><a href="/gostd/net/tcp_test.go.html#6774179">err</a></span>&nbsp;<span class="op" id="6774201">!=</span>&nbsp;<span class="builtintype" id="6774204">nil</span>&nbsp;<span class="op" id="6774208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774213"><a href="/gostd/net/tcp_test.go.html#6772160">t</a></span><span class="op" id="6774214">.</span><span class="ident" id="6774215"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6774221">(</span><span class="string" id="6774222">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6774244">,</span>&nbsp;<span class="ident" id="6774246"><a href="/gostd/net/tcp_test.go.html#6774179">err</a></span><span class="op" id="6774249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6774253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6774258">&lt;-</span><span class="ident" id="6774260"><a href="/gostd/net/tcp_test.go.html#6773527">done</a></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6774266">}</span><br>
<span class="lineno"></span><span class="op" id="6774268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6774271">func</span>&nbsp;<span class="ident" id="6774276">TestTCPConcurrentAccept</span><span class="op" id="6774299">(</span><span class="ident" id="6774300">t</span>&nbsp;<span class="op" id="6774302">*</span><span class="ident" id="6774303"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6774310">.</span><span class="ident" id="6774311"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6774312">)</span>&nbsp;<span class="op" id="6774314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6774317">defer</span>&nbsp;<span class="ident" id="6774323"><a href="/gostd/net/tcp_test.go.html#6763508">runtime</a></span><span class="op" id="6774330">.</span><span class="ident" id="6774331"><a href="/gostd/runtime/debug.go.html#1521359">GOMAXPROCS</a></span><span class="op" id="6774341">(</span><span class="ident" id="6774342"><a href="/gostd/net/tcp_test.go.html#6763508">runtime</a></span><span class="op" id="6774349">.</span><span class="ident" id="6774350"><a href="/gostd/runtime/debug.go.html#1521359">GOMAXPROCS</a></span><span class="op" id="6774360">(</span><span class="num" id="6774361">4</span><span class="op" id="6774362">)</span><span class="op" id="6774363">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774366">ln</span><span class="op" id="6774368">,</span>&nbsp;<span class="ident" id="6774370">err</span>&nbsp;<span class="op" id="6774374">:=</span>&nbsp;<span class="ident" id="6774377"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="6774383">(</span><span class="string" id="6774384">&#34;tcp&#34;</span><span class="op" id="6774389">,</span>&nbsp;<span class="string" id="6774391">&#34;127.0.0.1:0&#34;</span><span class="op" id="6774404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6774407">if</span>&nbsp;<span class="ident" id="6774410"><a href="/gostd/net/tcp_test.go.html#6774370">err</a></span>&nbsp;<span class="op" id="6774414">!=</span>&nbsp;<span class="builtintype" id="6774417">nil</span>&nbsp;<span class="op" id="6774421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774425"><a href="/gostd/net/tcp_test.go.html#6774300">t</a></span><span class="op" id="6774426">.</span><span class="ident" id="6774427"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6774433">(</span><span class="string" id="6774434">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6774453">,</span>&nbsp;<span class="ident" id="6774455"><a href="/gostd/net/tcp_test.go.html#6774370">err</a></span><span class="op" id="6774458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6774461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6774464">const</span>&nbsp;<span class="ident" id="6774470">N</span>&nbsp;<span class="op" id="6774472">=</span>&nbsp;<span class="num" id="6774474">10</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6774478">var</span>&nbsp;<span class="ident" id="6774482">wg</span>&nbsp;<span class="ident" id="6774485"><a href="/gostd/net/tcp_test.go.html#6763519">sync</a></span><span class="op" id="6774489">.</span><span class="ident" id="6774490"><a href="/gostd/sync/waitgroup.go.html#1459933">WaitGroup</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774501"><a href="/gostd/net/tcp_test.go.html#6774482">wg</a></span><span class="op" id="6774503">.</span><span class="ident" id="6774504"><a href="/gostd/sync/waitgroup.go.html#1461154">Add</a></span><span class="op" id="6774507">(</span><span class="ident" id="6774508"><a href="/gostd/net/tcp_test.go.html#6774470">N</a></span><span class="op" id="6774509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6774512">for</span>&nbsp;<span class="ident" id="6774516">i</span>&nbsp;<span class="op" id="6774518">:=</span>&nbsp;<span class="num" id="6774521">0</span><span class="op" id="6774522">;</span>&nbsp;<span class="ident" id="6774524"><a href="/gostd/net/tcp_test.go.html#6774516">i</a></span>&nbsp;<span class="op" id="6774526">&lt;</span>&nbsp;<span class="ident" id="6774528"><a href="/gostd/net/tcp_test.go.html#6774470">N</a></span><span class="op" id="6774529">;</span>&nbsp;<span class="ident" id="6774531"><a href="/gostd/net/tcp_test.go.html#6774516">i</a></span><span class="op" id="6774532">++</span>&nbsp;<span class="op" id="6774535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6774539">go</span>&nbsp;<span class="keyword" id="6774542">func</span><span class="op" id="6774546">(</span><span class="op" id="6774547">)</span>&nbsp;<span class="op" id="6774549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6774554">for</span>&nbsp;<span class="op" id="6774558">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774564">c</span><span class="op" id="6774565">,</span>&nbsp;<span class="ident" id="6774567">err</span>&nbsp;<span class="op" id="6774571">:=</span>&nbsp;<span class="ident" id="6774574"><a href="/gostd/net/tcp_test.go.html#6774366">ln</a></span><span class="op" id="6774576">.</span><span class="ident" id="6774577"><a href="/gostd/net/net.go.html#3340795">Accept</a></span><span class="op" id="6774583">(</span><span class="op" id="6774584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6774590">if</span>&nbsp;<span class="ident" id="6774593"><a href="/gostd/net/tcp_test.go.html#6774567">err</a></span>&nbsp;<span class="op" id="6774597">!=</span>&nbsp;<span class="builtintype" id="6774600">nil</span>&nbsp;<span class="op" id="6774604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6774611">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6774621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774627"><a href="/gostd/net/tcp_test.go.html#6774564">c</a></span><span class="op" id="6774628">.</span><span class="ident" id="6774629"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6774634">(</span><span class="op" id="6774635">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6774640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774645"><a href="/gostd/net/tcp_test.go.html#6774482">wg</a></span><span class="op" id="6774647">.</span><span class="ident" id="6774648"><a href="/gostd/sync/waitgroup.go.html#1462065">Done</a></span><span class="op" id="6774652">(</span><span class="op" id="6774653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6774657">}</span><span class="op" id="6774658">(</span><span class="op" id="6774659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6774662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774665">attempts</span>&nbsp;<span class="op" id="6774674">:=</span>&nbsp;<span class="num" id="6774677">10</span>&nbsp;<span class="op" id="6774680">*</span>&nbsp;<span class="ident" id="6774682"><a href="/gostd/net/tcp_test.go.html#6774470">N</a></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774685">fails</span>&nbsp;<span class="op" id="6774691">:=</span>&nbsp;<span class="num" id="6774694">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774697">d</span>&nbsp;<span class="op" id="6774699">:=</span>&nbsp;<span class="op" id="6774702">&amp;</span><span class="ident" id="6774703"><a href="/gostd/net/dial.go.html#3199756">Dialer</a></span><span class="op" id="6774709">{</span><span class="ident" id="6774710"><a href="/gostd/net/dial.go.html#3200103">Timeout</a></span><span class="op" id="6774717">:</span>&nbsp;<span class="num" id="6774719">200</span>&nbsp;<span class="op" id="6774723">*</span>&nbsp;<span class="ident" id="6774725"><a href="/gostd/net/tcp_test.go.html#6763538">time</a></span><span class="op" id="6774729">.</span><span class="ident" id="6774730"><a href="/gostd/time/time.go.html#2734819">Millisecond</a></span><span class="op" id="6774741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6774744">for</span>&nbsp;<span class="ident" id="6774748">i</span>&nbsp;<span class="op" id="6774750">:=</span>&nbsp;<span class="num" id="6774753">0</span><span class="op" id="6774754">;</span>&nbsp;<span class="ident" id="6774756"><a href="/gostd/net/tcp_test.go.html#6774748">i</a></span>&nbsp;<span class="op" id="6774758">&lt;</span>&nbsp;<span class="ident" id="6774760"><a href="/gostd/net/tcp_test.go.html#6774665">attempts</a></span><span class="op" id="6774768">;</span>&nbsp;<span class="ident" id="6774770"><a href="/gostd/net/tcp_test.go.html#6774748">i</a></span><span class="op" id="6774771">++</span>&nbsp;<span class="op" id="6774774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774778">c</span><span class="op" id="6774779">,</span>&nbsp;<span class="ident" id="6774781">err</span>&nbsp;<span class="op" id="6774785">:=</span>&nbsp;<span class="ident" id="6774788"><a href="/gostd/net/tcp_test.go.html#6774697">d</a></span><span class="op" id="6774789">.</span><span class="ident" id="6774790"><a href="/gostd/net/dial.go.html#3203959">Dial</a></span><span class="op" id="6774794">(</span><span class="string" id="6774795">&#34;tcp&#34;</span><span class="op" id="6774800">,</span>&nbsp;<span class="ident" id="6774802"><a href="/gostd/net/tcp_test.go.html#6774366">ln</a></span><span class="op" id="6774804">.</span><span class="ident" id="6774805"><a href="/gostd/net/net.go.html#3340993">Addr</a></span><span class="op" id="6774809">(</span><span class="op" id="6774810">)</span><span class="op" id="6774811">.</span><span class="ident" id="6774812"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="6774818">(</span><span class="op" id="6774819">)</span><span class="op" id="6774820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6774824">if</span>&nbsp;<span class="ident" id="6774827"><a href="/gostd/net/tcp_test.go.html#6774781">err</a></span>&nbsp;<span class="op" id="6774831">!=</span>&nbsp;<span class="builtintype" id="6774834">nil</span>&nbsp;<span class="op" id="6774838">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774843"><a href="/gostd/net/tcp_test.go.html#6774685">fails</a></span><span class="op" id="6774848">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6774853">}</span>&nbsp;<span class="keyword" id="6774855">else</span>&nbsp;<span class="op" id="6774860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774865"><a href="/gostd/net/tcp_test.go.html#6774778">c</a></span><span class="op" id="6774866">.</span><span class="ident" id="6774867"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6774872">(</span><span class="op" id="6774873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6774877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6774880">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774883"><a href="/gostd/net/tcp_test.go.html#6774366">ln</a></span><span class="op" id="6774885">.</span><span class="ident" id="6774886"><a href="/gostd/net/net.go.html#3340928">Close</a></span><span class="op" id="6774891">(</span><span class="op" id="6774892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774895"><a href="/gostd/net/tcp_test.go.html#6774482">wg</a></span><span class="op" id="6774897">.</span><span class="ident" id="6774898"><a href="/gostd/sync/waitgroup.go.html#1462162">Wait</a></span><span class="op" id="6774902">(</span><span class="op" id="6774903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6774906">if</span>&nbsp;<span class="ident" id="6774909"><a href="/gostd/net/tcp_test.go.html#6774685">fails</a></span>&nbsp;<span class="op" id="6774915">&gt;</span>&nbsp;<span class="ident" id="6774917"><a href="/gostd/net/tcp_test.go.html#6774665">attempts</a></span><span class="op" id="6774925">/</span><span class="num" id="6774926">9</span>&nbsp;<span class="op" id="6774928">{</span>&nbsp;<span class="comment" id="6774930">//&nbsp;see&nbsp;issues&nbsp;7400&nbsp;and&nbsp;7541</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6774960"><a href="/gostd/net/tcp_test.go.html#6774300">t</a></span><span class="op" id="6774961">.</span><span class="ident" id="6774962"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6774968">(</span><span class="string" id="6774969">&#34;too&nbsp;many&nbsp;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6774995">,</span>&nbsp;<span class="ident" id="6774997"><a href="/gostd/net/tcp_test.go.html#6774685">fails</a></span><span class="op" id="6775002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6775005">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775008">if</span>&nbsp;<span class="ident" id="6775011"><a href="/gostd/net/tcp_test.go.html#6774685">fails</a></span>&nbsp;<span class="op" id="6775017">&gt;</span>&nbsp;<span class="num" id="6775019">0</span>&nbsp;<span class="op" id="6775021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775025"><a href="/gostd/net/tcp_test.go.html#6774300">t</a></span><span class="op" id="6775026">.</span><span class="ident" id="6775027"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="6775031">(</span><span class="string" id="6775032">&#34;#&nbsp;of&nbsp;failed&nbsp;Dials:&nbsp;%v&#34;</span><span class="op" id="6775055">,</span>&nbsp;<span class="ident" id="6775057"><a href="/gostd/net/tcp_test.go.html#6774685">fails</a></span><span class="op" id="6775062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6775065">}</span><br>
<span class="lineno"></span><span class="op" id="6775067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="keyword" id="6775070">func</span>&nbsp;<span class="ident" id="6775075">TestTCPReadWriteMallocs</span><span class="op" id="6775098">(</span><span class="ident" id="6775099">t</span>&nbsp;<span class="op" id="6775101">*</span><span class="ident" id="6775102"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6775109">.</span><span class="ident" id="6775110"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6775111">)</span>&nbsp;<span class="op" id="6775113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775116">if</span>&nbsp;<span class="ident" id="6775119"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6775126">.</span><span class="ident" id="6775127"><a href="/gostd/testing/testing.go.html#5475359">Short</a></span><span class="op" id="6775132">(</span><span class="op" id="6775133">)</span>&nbsp;<span class="op" id="6775135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775139"><a href="/gostd/net/tcp_test.go.html#6775099">t</a></span><span class="op" id="6775140">.</span><span class="ident" id="6775141"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="6775145">(</span><span class="string" id="6775146">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6775183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6775186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775189">ln</span><span class="op" id="6775191">,</span>&nbsp;<span class="ident" id="6775193">err</span>&nbsp;<span class="op" id="6775197">:=</span>&nbsp;<span class="ident" id="6775200"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="6775206">(</span><span class="string" id="6775207">&#34;tcp&#34;</span><span class="op" id="6775212">,</span>&nbsp;<span class="string" id="6775214">&#34;127.0.0.1:0&#34;</span><span class="op" id="6775227">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775230">if</span>&nbsp;<span class="ident" id="6775233"><a href="/gostd/net/tcp_test.go.html#6775193">err</a></span>&nbsp;<span class="op" id="6775237">!=</span>&nbsp;<span class="builtintype" id="6775240">nil</span>&nbsp;<span class="op" id="6775244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775248"><a href="/gostd/net/tcp_test.go.html#6775099">t</a></span><span class="op" id="6775249">.</span><span class="ident" id="6775250"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6775256">(</span><span class="string" id="6775257">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6775276">,</span>&nbsp;<span class="ident" id="6775278"><a href="/gostd/net/tcp_test.go.html#6775193">err</a></span><span class="op" id="6775281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6775284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775287">defer</span>&nbsp;<span class="ident" id="6775293"><a href="/gostd/net/tcp_test.go.html#6775189">ln</a></span><span class="op" id="6775295">.</span><span class="ident" id="6775296"><a href="/gostd/net/net.go.html#3340928">Close</a></span><span class="op" id="6775301">(</span><span class="op" id="6775302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775305">var</span>&nbsp;<span class="ident" id="6775309">server</span>&nbsp;<span class="ident" id="6775316"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775322">errc</span>&nbsp;<span class="op" id="6775327">:=</span>&nbsp;<span class="builtinfunc" id="6775330">make</span><span class="op" id="6775334">(</span><span class="keyword" id="6775335">chan</span>&nbsp;<span class="builtintype" id="6775340">error</span><span class="op" id="6775345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775348">go</span>&nbsp;<span class="keyword" id="6775351">func</span><span class="op" id="6775355">(</span><span class="op" id="6775356">)</span>&nbsp;<span class="op" id="6775358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775362">var</span>&nbsp;<span class="ident" id="6775366">err</span>&nbsp;<span class="builtintype" id="6775370">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775378"><a href="/gostd/net/tcp_test.go.html#6775309">server</a></span><span class="op" id="6775384">,</span>&nbsp;<span class="ident" id="6775386"><a href="/gostd/net/tcp_test.go.html#6775366">err</a></span>&nbsp;<span class="op" id="6775390">=</span>&nbsp;<span class="ident" id="6775392"><a href="/gostd/net/tcp_test.go.html#6775189">ln</a></span><span class="op" id="6775394">.</span><span class="ident" id="6775395"><a href="/gostd/net/net.go.html#3340795">Accept</a></span><span class="op" id="6775401">(</span><span class="op" id="6775402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775406"><a href="/gostd/net/tcp_test.go.html#6775322">errc</a></span>&nbsp;<span class="op" id="6775411">&lt;-</span>&nbsp;<span class="ident" id="6775414"><a href="/gostd/net/tcp_test.go.html#6775366">err</a></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6775419">}</span><span class="op" id="6775420">(</span><span class="op" id="6775421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775424">client</span><span class="op" id="6775430">,</span>&nbsp;<span class="ident" id="6775432"><a href="/gostd/net/tcp_test.go.html#6775193">err</a></span>&nbsp;<span class="op" id="6775436">:=</span>&nbsp;<span class="ident" id="6775439"><a href="/gostd/net/dial.go.html#3203459">Dial</a></span><span class="op" id="6775443">(</span><span class="string" id="6775444">&#34;tcp&#34;</span><span class="op" id="6775449">,</span>&nbsp;<span class="ident" id="6775451"><a href="/gostd/net/tcp_test.go.html#6775189">ln</a></span><span class="op" id="6775453">.</span><span class="ident" id="6775454"><a href="/gostd/net/net.go.html#3340993">Addr</a></span><span class="op" id="6775458">(</span><span class="op" id="6775459">)</span><span class="op" id="6775460">.</span><span class="ident" id="6775461"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="6775467">(</span><span class="op" id="6775468">)</span><span class="op" id="6775469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775472">if</span>&nbsp;<span class="ident" id="6775475"><a href="/gostd/net/tcp_test.go.html#6775193">err</a></span>&nbsp;<span class="op" id="6775479">!=</span>&nbsp;<span class="builtintype" id="6775482">nil</span>&nbsp;<span class="op" id="6775486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775490"><a href="/gostd/net/tcp_test.go.html#6775099">t</a></span><span class="op" id="6775491">.</span><span class="ident" id="6775492"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6775498">(</span><span class="string" id="6775499">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6775516">,</span>&nbsp;<span class="ident" id="6775518"><a href="/gostd/net/tcp_test.go.html#6775193">err</a></span><span class="op" id="6775521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6775524">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775527">if</span>&nbsp;<span class="ident" id="6775530">err</span>&nbsp;<span class="op" id="6775534">:=</span>&nbsp;<span class="op" id="6775537">&lt;-</span><span class="ident" id="6775539"><a href="/gostd/net/tcp_test.go.html#6775322">errc</a></span><span class="op" id="6775543">;</span>&nbsp;<span class="ident" id="6775545"><a href="/gostd/net/tcp_test.go.html#6775530">err</a></span>&nbsp;<span class="op" id="6775549">!=</span>&nbsp;<span class="builtintype" id="6775552">nil</span>&nbsp;<span class="op" id="6775556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775560"><a href="/gostd/net/tcp_test.go.html#6775099">t</a></span><span class="op" id="6775561">.</span><span class="ident" id="6775562"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6775568">(</span><span class="string" id="6775569">&#34;Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6775588">,</span>&nbsp;<span class="ident" id="6775590"><a href="/gostd/net/tcp_test.go.html#6775530">err</a></span><span class="op" id="6775593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6775596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775599">defer</span>&nbsp;<span class="ident" id="6775605"><a href="/gostd/net/tcp_test.go.html#6775309">server</a></span><span class="op" id="6775611">.</span><span class="ident" id="6775612"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6775617">(</span><span class="op" id="6775618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775621">var</span>&nbsp;<span class="ident" id="6775625">buf</span>&nbsp;<span class="op" id="6775629">[</span><span class="num" id="6775630">128</span><span class="op" id="6775633">]</span><span class="builtintype" id="6775634">byte</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775640">mallocs</span>&nbsp;<span class="op" id="6775648">:=</span>&nbsp;<span class="ident" id="6775651"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6775658">.</span><span class="ident" id="6775659"><a href="/gostd/testing/allocs.go.html#5449197">AllocsPerRun</a></span><span class="op" id="6775671">(</span><span class="num" id="6775672">1000</span><span class="op" id="6775676">,</span>&nbsp;<span class="keyword" id="6775678">func</span><span class="op" id="6775682">(</span><span class="op" id="6775683">)</span>&nbsp;<span class="op" id="6775685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775689">_</span><span class="op" id="6775690">,</span>&nbsp;<span class="ident" id="6775692">err</span>&nbsp;<span class="op" id="6775696">:=</span>&nbsp;<span class="ident" id="6775699"><a href="/gostd/net/tcp_test.go.html#6775309">server</a></span><span class="op" id="6775705">.</span><span class="ident" id="6775706"><a href="/gostd/net/net.go.html#3334839">Write</a></span><span class="op" id="6775711">(</span><span class="ident" id="6775712"><a href="/gostd/net/tcp_test.go.html#6775625">buf</a></span><span class="op" id="6775715">[</span><span class="op" id="6775716">:</span><span class="op" id="6775717">]</span><span class="op" id="6775718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775722">if</span>&nbsp;<span class="ident" id="6775725"><a href="/gostd/net/tcp_test.go.html#6775692">err</a></span>&nbsp;<span class="op" id="6775729">!=</span>&nbsp;<span class="builtintype" id="6775732">nil</span>&nbsp;<span class="op" id="6775736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775741"><a href="/gostd/net/tcp_test.go.html#6775099">t</a></span><span class="op" id="6775742">.</span><span class="ident" id="6775743"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6775749">(</span><span class="string" id="6775750">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6775768">,</span>&nbsp;<span class="ident" id="6775770"><a href="/gostd/net/tcp_test.go.html#6775692">err</a></span><span class="op" id="6775773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6775777">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775781">_</span><span class="op" id="6775782">,</span>&nbsp;<span class="ident" id="6775784"><a href="/gostd/net/tcp_test.go.html#6775692">err</a></span>&nbsp;<span class="op" id="6775788">=</span>&nbsp;<span class="ident" id="6775790"><a href="/gostd/net/tcp_test.go.html#6763491">io</a></span><span class="op" id="6775792">.</span><span class="ident" id="6775793"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="6775801">(</span><span class="ident" id="6775802"><a href="/gostd/net/tcp_test.go.html#6775424">client</a></span><span class="op" id="6775808">,</span>&nbsp;<span class="ident" id="6775810"><a href="/gostd/net/tcp_test.go.html#6775625">buf</a></span><span class="op" id="6775813">[</span><span class="op" id="6775814">:</span><span class="op" id="6775815">]</span><span class="op" id="6775816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775820">if</span>&nbsp;<span class="ident" id="6775823"><a href="/gostd/net/tcp_test.go.html#6775692">err</a></span>&nbsp;<span class="op" id="6775827">!=</span>&nbsp;<span class="builtintype" id="6775830">nil</span>&nbsp;<span class="op" id="6775834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775839"><a href="/gostd/net/tcp_test.go.html#6775099">t</a></span><span class="op" id="6775840">.</span><span class="ident" id="6775841"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6775847">(</span><span class="string" id="6775848">&#34;Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6775865">,</span>&nbsp;<span class="ident" id="6775867"><a href="/gostd/net/tcp_test.go.html#6775692">err</a></span><span class="op" id="6775870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6775874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6775877">}</span><span class="op" id="6775878">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775881">if</span>&nbsp;<span class="ident" id="6775884"><a href="/gostd/net/tcp_test.go.html#6775640">mallocs</a></span>&nbsp;<span class="op" id="6775892">&gt;</span>&nbsp;<span class="num" id="6775894">0</span>&nbsp;<span class="op" id="6775896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6775900"><a href="/gostd/net/tcp_test.go.html#6775099">t</a></span><span class="op" id="6775901">.</span><span class="ident" id="6775902"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6775908">(</span><span class="string" id="6775909">&#34;Got&nbsp;%v&nbsp;allocs,&nbsp;want&nbsp;0&#34;</span><span class="op" id="6775932">,</span>&nbsp;<span class="ident" id="6775934"><a href="/gostd/net/tcp_test.go.html#6775640">mallocs</a></span><span class="op" id="6775941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6775944">}</span><br>
<span class="lineno"></span><span class="op" id="6775946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="6775949">func</span>&nbsp;<span class="ident" id="6775954">TestTCPStress</span><span class="op" id="6775967">(</span><span class="ident" id="6775968">t</span>&nbsp;<span class="op" id="6775970">*</span><span class="ident" id="6775971"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6775978">.</span><span class="ident" id="6775979"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6775980">)</span>&nbsp;<span class="op" id="6775982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6775985">const</span>&nbsp;<span class="ident" id="6775991">conns</span>&nbsp;<span class="op" id="6775997">=</span>&nbsp;<span class="num" id="6775999">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776002">const</span>&nbsp;<span class="ident" id="6776008">msgLen</span>&nbsp;<span class="op" id="6776015">=</span>&nbsp;<span class="num" id="6776017">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776022">msgs</span>&nbsp;<span class="op" id="6776027">:=</span>&nbsp;<span class="builtintype" id="6776030">int</span><span class="op" id="6776033">(</span><span class="num" id="6776034">1e4</span><span class="op" id="6776037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776040">if</span>&nbsp;<span class="ident" id="6776043"><a href="/gostd/net/tcp_test.go.html#6763527">testing</a></span><span class="op" id="6776050">.</span><span class="ident" id="6776051"><a href="/gostd/testing/testing.go.html#5475359">Short</a></span><span class="op" id="6776056">(</span><span class="op" id="6776057">)</span>&nbsp;<span class="op" id="6776059">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776063"><a href="/gostd/net/tcp_test.go.html#6776022">msgs</a></span>&nbsp;<span class="op" id="6776068">=</span>&nbsp;<span class="num" id="6776070">1e2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776079">sendMsg</span>&nbsp;<span class="op" id="6776087">:=</span>&nbsp;<span class="keyword" id="6776090">func</span><span class="op" id="6776094">(</span><span class="ident" id="6776095">c</span>&nbsp;<span class="ident" id="6776097"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6776101">,</span>&nbsp;<span class="ident" id="6776103">buf</span>&nbsp;<span class="op" id="6776107">[</span><span class="op" id="6776108">]</span><span class="builtintype" id="6776109">byte</span><span class="op" id="6776113">)</span>&nbsp;<span class="builtintype" id="6776115">bool</span>&nbsp;<span class="op" id="6776120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776124">n</span><span class="op" id="6776125">,</span>&nbsp;<span class="ident" id="6776127">err</span>&nbsp;<span class="op" id="6776131">:=</span>&nbsp;<span class="ident" id="6776134"><a href="/gostd/net/tcp_test.go.html#6776095">c</a></span><span class="op" id="6776135">.</span><span class="ident" id="6776136"><a href="/gostd/net/net.go.html#3334839">Write</a></span><span class="op" id="6776141">(</span><span class="ident" id="6776142"><a href="/gostd/net/tcp_test.go.html#6776103">buf</a></span><span class="op" id="6776145">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776149">if</span>&nbsp;<span class="ident" id="6776152"><a href="/gostd/net/tcp_test.go.html#6776124">n</a></span>&nbsp;<span class="op" id="6776154">!=</span>&nbsp;<span class="builtinfunc" id="6776157">len</span><span class="op" id="6776160">(</span><span class="ident" id="6776161"><a href="/gostd/net/tcp_test.go.html#6776103">buf</a></span><span class="op" id="6776164">)</span>&nbsp;<span class="op" id="6776166">||</span>&nbsp;<span class="ident" id="6776169"><a href="/gostd/net/tcp_test.go.html#6776127">err</a></span>&nbsp;<span class="op" id="6776173">!=</span>&nbsp;<span class="builtintype" id="6776176">nil</span>&nbsp;<span class="op" id="6776180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776185"><a href="/gostd/net/tcp_test.go.html#6775968">t</a></span><span class="op" id="6776186">.</span><span class="ident" id="6776187"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="6776191">(</span><span class="string" id="6776192">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6776210">,</span>&nbsp;<span class="ident" id="6776212"><a href="/gostd/net/tcp_test.go.html#6776127">err</a></span><span class="op" id="6776215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776220">return</span>&nbsp;<span class="builtintype" id="6776227">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776239">return</span>&nbsp;<span class="builtintype" id="6776246">true</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776255">recvMsg</span>&nbsp;<span class="op" id="6776263">:=</span>&nbsp;<span class="keyword" id="6776266">func</span><span class="op" id="6776270">(</span><span class="ident" id="6776271">c</span>&nbsp;<span class="ident" id="6776273"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6776277">,</span>&nbsp;<span class="ident" id="6776279">buf</span>&nbsp;<span class="op" id="6776283">[</span><span class="op" id="6776284">]</span><span class="builtintype" id="6776285">byte</span><span class="op" id="6776289">)</span>&nbsp;<span class="builtintype" id="6776291">bool</span>&nbsp;<span class="op" id="6776296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776300">for</span>&nbsp;<span class="ident" id="6776304">read</span>&nbsp;<span class="op" id="6776309">:=</span>&nbsp;<span class="num" id="6776312">0</span><span class="op" id="6776313">;</span>&nbsp;<span class="ident" id="6776315"><a href="/gostd/net/tcp_test.go.html#6776304">read</a></span>&nbsp;<span class="op" id="6776320">!=</span>&nbsp;<span class="builtinfunc" id="6776323">len</span><span class="op" id="6776326">(</span><span class="ident" id="6776327"><a href="/gostd/net/tcp_test.go.html#6776279">buf</a></span><span class="op" id="6776330">)</span><span class="op" id="6776331">;</span>&nbsp;<span class="op" id="6776333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776338">n</span><span class="op" id="6776339">,</span>&nbsp;<span class="ident" id="6776341">err</span>&nbsp;<span class="op" id="6776345">:=</span>&nbsp;<span class="ident" id="6776348"><a href="/gostd/net/tcp_test.go.html#6776271">c</a></span><span class="op" id="6776349">.</span><span class="ident" id="6776350"><a href="/gostd/net/net.go.html#3334618">Read</a></span><span class="op" id="6776354">(</span><span class="ident" id="6776355"><a href="/gostd/net/tcp_test.go.html#6776279">buf</a></span><span class="op" id="6776358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776363"><a href="/gostd/net/tcp_test.go.html#6776304">read</a></span>&nbsp;<span class="op" id="6776368">+=</span>&nbsp;<span class="ident" id="6776371"><a href="/gostd/net/tcp_test.go.html#6776338">n</a></span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776376">if</span>&nbsp;<span class="ident" id="6776379"><a href="/gostd/net/tcp_test.go.html#6776341">err</a></span>&nbsp;<span class="op" id="6776383">!=</span>&nbsp;<span class="builtintype" id="6776386">nil</span>&nbsp;<span class="op" id="6776390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776396"><a href="/gostd/net/tcp_test.go.html#6775968">t</a></span><span class="op" id="6776397">.</span><span class="ident" id="6776398"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="6776402">(</span><span class="string" id="6776403">&#34;Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6776420">,</span>&nbsp;<span class="ident" id="6776422"><a href="/gostd/net/tcp_test.go.html#6776341">err</a></span><span class="op" id="6776425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776431">return</span>&nbsp;<span class="builtintype" id="6776438">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776451">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776455">return</span>&nbsp;<span class="builtintype" id="6776462">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776472">ln</span><span class="op" id="6776474">,</span>&nbsp;<span class="ident" id="6776476">err</span>&nbsp;<span class="op" id="6776480">:=</span>&nbsp;<span class="ident" id="6776483"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="6776489">(</span><span class="string" id="6776490">&#34;tcp&#34;</span><span class="op" id="6776495">,</span>&nbsp;<span class="string" id="6776497">&#34;127.0.0.1:0&#34;</span><span class="op" id="6776510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776513">if</span>&nbsp;<span class="ident" id="6776516"><a href="/gostd/net/tcp_test.go.html#6776476">err</a></span>&nbsp;<span class="op" id="6776520">!=</span>&nbsp;<span class="builtintype" id="6776523">nil</span>&nbsp;<span class="op" id="6776527">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776531"><a href="/gostd/net/tcp_test.go.html#6775968">t</a></span><span class="op" id="6776532">.</span><span class="ident" id="6776533"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6776539">(</span><span class="string" id="6776540">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6776559">,</span>&nbsp;<span class="ident" id="6776561"><a href="/gostd/net/tcp_test.go.html#6776476">err</a></span><span class="op" id="6776564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776570">defer</span>&nbsp;<span class="ident" id="6776576"><a href="/gostd/net/tcp_test.go.html#6776472">ln</a></span><span class="op" id="6776578">.</span><span class="ident" id="6776579"><a href="/gostd/net/net.go.html#3340928">Close</a></span><span class="op" id="6776584">(</span><span class="op" id="6776585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6776588">//&nbsp;Acceptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776602">go</span>&nbsp;<span class="keyword" id="6776605">func</span><span class="op" id="6776609">(</span><span class="op" id="6776610">)</span>&nbsp;<span class="op" id="6776612">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776616">for</span>&nbsp;<span class="op" id="6776620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776625">c</span><span class="op" id="6776626">,</span>&nbsp;<span class="ident" id="6776628">err</span>&nbsp;<span class="op" id="6776632">:=</span>&nbsp;<span class="ident" id="6776635"><a href="/gostd/net/tcp_test.go.html#6776472">ln</a></span><span class="op" id="6776637">.</span><span class="ident" id="6776638"><a href="/gostd/net/net.go.html#3340795">Accept</a></span><span class="op" id="6776644">(</span><span class="op" id="6776645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776650">if</span>&nbsp;<span class="ident" id="6776653"><a href="/gostd/net/tcp_test.go.html#6776628">err</a></span>&nbsp;<span class="op" id="6776657">!=</span>&nbsp;<span class="builtintype" id="6776660">nil</span>&nbsp;<span class="op" id="6776664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776670">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776679">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6776684">//&nbsp;Server&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776709">go</span>&nbsp;<span class="keyword" id="6776712">func</span><span class="op" id="6776716">(</span><span class="ident" id="6776717">c</span>&nbsp;<span class="ident" id="6776719"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6776723">)</span>&nbsp;<span class="op" id="6776725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776731">defer</span>&nbsp;<span class="ident" id="6776737"><a href="/gostd/net/tcp_test.go.html#6776717">c</a></span><span class="op" id="6776738">.</span><span class="ident" id="6776739"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6776744">(</span><span class="op" id="6776745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776751">var</span>&nbsp;<span class="ident" id="6776755">buf</span>&nbsp;<span class="op" id="6776759">[</span><span class="ident" id="6776760"><a href="/gostd/net/tcp_test.go.html#6776008">msgLen</a></span><span class="op" id="6776766">]</span><span class="builtintype" id="6776767">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776776">for</span>&nbsp;<span class="ident" id="6776780">m</span>&nbsp;<span class="op" id="6776782">:=</span>&nbsp;<span class="num" id="6776785">0</span><span class="op" id="6776786">;</span>&nbsp;<span class="ident" id="6776788"><a href="/gostd/net/tcp_test.go.html#6776780">m</a></span>&nbsp;<span class="op" id="6776790">&lt;</span>&nbsp;<span class="ident" id="6776792"><a href="/gostd/net/tcp_test.go.html#6776022">msgs</a></span><span class="op" id="6776796">;</span>&nbsp;<span class="ident" id="6776798"><a href="/gostd/net/tcp_test.go.html#6776780">m</a></span><span class="op" id="6776799">++</span>&nbsp;<span class="op" id="6776802">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776809">if</span>&nbsp;<span class="op" id="6776812">!</span><span class="ident" id="6776813"><a href="/gostd/net/tcp_test.go.html#6776255">recvMsg</a></span><span class="op" id="6776820">(</span><span class="ident" id="6776821"><a href="/gostd/net/tcp_test.go.html#6776717">c</a></span><span class="op" id="6776822">,</span>&nbsp;<span class="ident" id="6776824"><a href="/gostd/net/tcp_test.go.html#6776755">buf</a></span><span class="op" id="6776827">[</span><span class="op" id="6776828">:</span><span class="op" id="6776829">]</span><span class="op" id="6776830">)</span>&nbsp;<span class="op" id="6776832">||</span>&nbsp;<span class="op" id="6776835">!</span><span class="ident" id="6776836"><a href="/gostd/net/tcp_test.go.html#6776079">sendMsg</a></span><span class="op" id="6776843">(</span><span class="ident" id="6776844"><a href="/gostd/net/tcp_test.go.html#6776717">c</a></span><span class="op" id="6776845">,</span>&nbsp;<span class="ident" id="6776847"><a href="/gostd/net/tcp_test.go.html#6776755">buf</a></span><span class="op" id="6776850">[</span><span class="op" id="6776851">:</span><span class="op" id="6776852">]</span><span class="op" id="6776853">)</span>&nbsp;<span class="op" id="6776855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776863">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776885">}</span><span class="op" id="6776886">(</span><span class="ident" id="6776887"><a href="/gostd/net/tcp_test.go.html#6776625">c</a></span><span class="op" id="6776888">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776895">}</span><span class="op" id="6776896">(</span><span class="op" id="6776897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6776900">done</span>&nbsp;<span class="op" id="6776905">:=</span>&nbsp;<span class="builtinfunc" id="6776908">make</span><span class="op" id="6776912">(</span><span class="keyword" id="6776913">chan</span>&nbsp;<span class="builtintype" id="6776918">bool</span><span class="op" id="6776922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776925">for</span>&nbsp;<span class="ident" id="6776929">i</span>&nbsp;<span class="op" id="6776931">:=</span>&nbsp;<span class="num" id="6776934">0</span><span class="op" id="6776935">;</span>&nbsp;<span class="ident" id="6776937"><a href="/gostd/net/tcp_test.go.html#6776929">i</a></span>&nbsp;<span class="op" id="6776939">&lt;</span>&nbsp;<span class="ident" id="6776941"><a href="/gostd/net/tcp_test.go.html#6775991">conns</a></span><span class="op" id="6776946">;</span>&nbsp;<span class="ident" id="6776948"><a href="/gostd/net/tcp_test.go.html#6776929">i</a></span><span class="op" id="6776949">++</span>&nbsp;<span class="op" id="6776952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6776956">//&nbsp;Client&nbsp;connection.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776980">go</span>&nbsp;<span class="keyword" id="6776983">func</span><span class="op" id="6776987">(</span><span class="op" id="6776988">)</span>&nbsp;<span class="op" id="6776990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6776995">defer</span>&nbsp;<span class="keyword" id="6777001">func</span><span class="op" id="6777005">(</span><span class="op" id="6777006">)</span>&nbsp;<span class="op" id="6777008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777014"><a href="/gostd/net/tcp_test.go.html#6776900">done</a></span>&nbsp;<span class="op" id="6777019">&lt;-</span>&nbsp;<span class="builtintype" id="6777022">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6777030">}</span><span class="op" id="6777031">(</span><span class="op" id="6777032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777037">c</span><span class="op" id="6777038">,</span>&nbsp;<span class="ident" id="6777040">err</span>&nbsp;<span class="op" id="6777044">:=</span>&nbsp;<span class="ident" id="6777047"><a href="/gostd/net/dial.go.html#3203459">Dial</a></span><span class="op" id="6777051">(</span><span class="string" id="6777052">&#34;tcp&#34;</span><span class="op" id="6777057">,</span>&nbsp;<span class="ident" id="6777059"><a href="/gostd/net/tcp_test.go.html#6776472">ln</a></span><span class="op" id="6777061">.</span><span class="ident" id="6777062"><a href="/gostd/net/net.go.html#3340993">Addr</a></span><span class="op" id="6777066">(</span><span class="op" id="6777067">)</span><span class="op" id="6777068">.</span><span class="ident" id="6777069"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="6777075">(</span><span class="op" id="6777076">)</span><span class="op" id="6777077">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6777082">if</span>&nbsp;<span class="ident" id="6777085"><a href="/gostd/net/tcp_test.go.html#6777040">err</a></span>&nbsp;<span class="op" id="6777089">!=</span>&nbsp;<span class="builtintype" id="6777092">nil</span>&nbsp;<span class="op" id="6777096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6777102"><a href="/gostd/net/tcp_test.go.html#6775968">t</a></span><span class="op" id="6777103">.</span><span class="ident" id="6777104"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="6777108">(</span><span class="string" id="6777109">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6777126">,</span>&nbsp;<span class="ident" id="6777128"><a href="/gostd/net/tcp_test.go.html#6777040">err</a></span><span class="op" id="6777131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6777137">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6777147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6777152">defer</span>&nbsp;<span class="ident" id="6777158"><a href="/gostd/net/tcp_test.go.html#6777037">c</a></span><span class="op" id="6777159">.</span><span class="ident" id="6777160"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6777165">(</span><span class="op" id="6777166">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6777171">var</span>&nbsp;<span class="ident" id="6777175">buf</span>&nbsp;<span class="op" id="6777179">[</span><span class="ident" id="6777180"><a href="/gostd/net/tcp_test.go.html#6776008">msgLen</a></span><span class="op" id="6777186">]</span><span class="builtintype" id="6777187">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6777195">for</span>&nbsp;<span class="ident" id="6777199">m</span>&nbsp;<span class="op" id="6777201">:=</span>&nbsp;<span class="num" id="6777204">0</span><span class="op" id="6777205">;</span>&nbsp;<span class="ident" id="6777207"><a href="/gostd/net/tcp_test.go.html#6777199">m</a></span>&nbsp;<span class="op" id="6777209">&lt;</span>&nbsp;<span class="ident" id="6777211"><a href="/gostd/net/tcp_test.go.html#6776022">msgs</a></span><span class="op" id="6777215">;</span>&nbsp;<span class="ident" id="6777217"><a href="/gostd/net/tcp_test.go.html#6777199">m</a></span><span class="op" id="6777218">++</span>&nbsp;<span class="op" id="6777221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6777227">if</span>&nbsp;<span class="op" id="6777230">!</span><span class="ident" id="6777231"><a href="/gostd/net/tcp_test.go.html#6776079">sendMsg</a></span><span class="op" id="6777238">(</span><span class="ident" id="6777239"><a href="/gostd/net/tcp_test.go.html#6777037">c</a></span><span class="op" id="6777240">,</span>&nbsp;<span class="ident" id="6777242"><a href="/gostd/net/tcp_test.go.html#6777175">buf</a></span><span class="op" id="6777245">[</span><span class="op" id="6777246">:</span><span class="op" id="6777247">]</span><span class="op" id="6777248">)</span>&nbsp;<span class="op" id="6777250">||</span>&nbsp;<span class="op" id="6777253">!</span><span class="ident" id="6777254"><a href="/gostd/net/tcp_test.go.html#6776255">recvMsg</a></span><span class="op" id="6777261">(</span><span class="ident" id="6777262"><a href="/gostd/net/tcp_test.go.html#6777037">c</a></span><span class="op" id="6777263">,</span>&nbsp;<span class="ident" id="6777265"><a href="/gostd/net/tcp_test.go.html#6777175">buf</a></span><span class="op" id="6777268">[</span><span class="op" id="6777269">:</span><span class="op" id="6777270">]</span><span class="op" id="6777271">)</span>&nbsp;<span class="op" id="6777273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6777280">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6777290">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6777295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6777299">}</span><span class="op" id="6777300">(</span><span class="op" id="6777301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6777304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6777307">for</span>&nbsp;<span class="ident" id="6777311">i</span>&nbsp;<span class="op" id="6777313">:=</span>&nbsp;<span class="num" id="6777316">0</span><span class="op" id="6777317">;</span>&nbsp;<span class="ident" id="6777319"><a href="/gostd/net/tcp_test.go.html#6777311">i</a></span>&nbsp;<span class="op" id="6777321">&lt;</span>&nbsp;<span class="ident" id="6777323"><a href="/gostd/net/tcp_test.go.html#6775991">conns</a></span><span class="op" id="6777328">;</span>&nbsp;<span class="ident" id="6777330"><a href="/gostd/net/tcp_test.go.html#6777311">i</a></span><span class="op" id="6777331">++</span>&nbsp;<span class="op" id="6777334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6777338">&lt;-</span><span class="ident" id="6777340"><a href="/gostd/net/tcp_test.go.html#6776900">done</a></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6777346">}</span><br>
<span class="lineno"></span><span class="op" id="6777348">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
