<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html" class="current">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3863340">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3863396">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3863450">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3863501">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3863579">package</span>&nbsp;<span class="ident" id="3863587">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3863592">import</span>&nbsp;<span class="op" id="3863599">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3863602">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3863613">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3863620">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3863623">func</span>&nbsp;<span class="ident" id="3863628">sockaddrToUDP</span><span class="op" id="3863641">(</span><span class="ident" id="3863642">sa</span>&nbsp;<span class="ident" id="3863645">syscall</span><span class="op" id="3863652">.</span><span class="ident" id="3863653">Sockaddr</span><span class="op" id="3863661">)</span>&nbsp;<span class="ident" id="3863663">Addr</span>&nbsp;<span class="op" id="3863668">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3863671">switch</span>&nbsp;<span class="ident" id="3863678">sa</span>&nbsp;<span class="op" id="3863681">:=</span>&nbsp;<span class="ident" id="3863684">sa</span><span class="op" id="3863686">.</span><span class="op" id="3863687">(</span><span class="keyword" id="3863688">type</span><span class="op" id="3863692">)</span>&nbsp;<span class="op" id="3863694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3863697">case</span>&nbsp;<span class="op" id="3863702">*</span><span class="ident" id="3863703">syscall</span><span class="op" id="3863710">.</span><span class="ident" id="3863711">SockaddrInet4</span><span class="op" id="3863724">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3863728">return</span>&nbsp;<span class="op" id="3863735">&amp;</span><span class="ident" id="3863736">UDPAddr</span><span class="op" id="3863743">{</span><span class="ident" id="3863744">IP</span><span class="op" id="3863746">:</span>&nbsp;<span class="ident" id="3863748">sa</span><span class="op" id="3863750">.</span><span class="ident" id="3863751">Addr</span><span class="op" id="3863755">[</span><span class="num" id="3863756">0</span><span class="op" id="3863757">:</span><span class="op" id="3863758">]</span><span class="op" id="3863759">,</span>&nbsp;<span class="ident" id="3863761">Port</span><span class="op" id="3863765">:</span>&nbsp;<span class="ident" id="3863767">sa</span><span class="op" id="3863769">.</span><span class="ident" id="3863770">Port</span><span class="op" id="3863774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3863777">case</span>&nbsp;<span class="op" id="3863782">*</span><span class="ident" id="3863783">syscall</span><span class="op" id="3863790">.</span><span class="ident" id="3863791">SockaddrInet6</span><span class="op" id="3863804">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3863808">return</span>&nbsp;<span class="op" id="3863815">&amp;</span><span class="ident" id="3863816">UDPAddr</span><span class="op" id="3863823">{</span><span class="ident" id="3863824">IP</span><span class="op" id="3863826">:</span>&nbsp;<span class="ident" id="3863828">sa</span><span class="op" id="3863830">.</span><span class="ident" id="3863831">Addr</span><span class="op" id="3863835">[</span><span class="num" id="3863836">0</span><span class="op" id="3863837">:</span><span class="op" id="3863838">]</span><span class="op" id="3863839">,</span>&nbsp;<span class="ident" id="3863841">Port</span><span class="op" id="3863845">:</span>&nbsp;<span class="ident" id="3863847">sa</span><span class="op" id="3863849">.</span><span class="ident" id="3863850">Port</span><span class="op" id="3863854">,</span>&nbsp;<span class="ident" id="3863856">Zone</span><span class="op" id="3863860">:</span>&nbsp;<span class="ident" id="3863862">zoneToString</span><span class="op" id="3863874">(</span><span class="builtintype" id="3863875">int</span><span class="op" id="3863878">(</span><span class="ident" id="3863879">sa</span><span class="op" id="3863881">.</span><span class="ident" id="3863882">ZoneId</span><span class="op" id="3863888">)</span><span class="op" id="3863889">)</span><span class="op" id="3863890">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3863893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3863896">return</span>&nbsp;<span class="builtintype" id="3863903">nil</span><br>
<span class="lineno"></span><span class="op" id="3863907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3863910">func</span>&nbsp;<span class="op" id="3863915">(</span><span class="ident" id="3863916">a</span>&nbsp;<span class="op" id="3863918">*</span><span class="ident" id="3863919">UDPAddr</span><span class="op" id="3863926">)</span>&nbsp;<span class="ident" id="3863928">family</span><span class="op" id="3863934">(</span><span class="op" id="3863935">)</span>&nbsp;<span class="builtintype" id="3863937">int</span>&nbsp;<span class="op" id="3863941">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3863944">if</span>&nbsp;<span class="ident" id="3863947">a</span>&nbsp;<span class="op" id="3863949">==</span>&nbsp;<span class="builtintype" id="3863952">nil</span>&nbsp;<span class="op" id="3863956">||</span>&nbsp;<span class="builtinfunc" id="3863959">len</span><span class="op" id="3863962">(</span><span class="ident" id="3863963">a</span><span class="op" id="3863964">.</span><span class="ident" id="3863965">IP</span><span class="op" id="3863967">)</span>&nbsp;<span class="op" id="3863969">&lt;=</span>&nbsp;<span class="ident" id="3863972">IPv4len</span>&nbsp;<span class="op" id="3863980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3863984">return</span>&nbsp;<span class="ident" id="3863991">syscall</span><span class="op" id="3863998">.</span><span class="ident" id="3863999">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3864008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864011">if</span>&nbsp;<span class="ident" id="3864014">a</span><span class="op" id="3864015">.</span><span class="ident" id="3864016">IP</span><span class="op" id="3864018">.</span><span class="ident" id="3864019">To4</span><span class="op" id="3864022">(</span><span class="op" id="3864023">)</span>&nbsp;<span class="op" id="3864025">!=</span>&nbsp;<span class="builtintype" id="3864028">nil</span>&nbsp;<span class="op" id="3864032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864036">return</span>&nbsp;<span class="ident" id="3864043">syscall</span><span class="op" id="3864050">.</span><span class="ident" id="3864051">AF_INET</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3864060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864063">return</span>&nbsp;<span class="ident" id="3864070">syscall</span><span class="op" id="3864077">.</span><span class="ident" id="3864078">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="3864087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3864090">func</span>&nbsp;<span class="op" id="3864095">(</span><span class="ident" id="3864096">a</span>&nbsp;<span class="op" id="3864098">*</span><span class="ident" id="3864099">UDPAddr</span><span class="op" id="3864106">)</span>&nbsp;<span class="ident" id="3864108">isWildcard</span><span class="op" id="3864118">(</span><span class="op" id="3864119">)</span>&nbsp;<span class="builtintype" id="3864121">bool</span>&nbsp;<span class="op" id="3864126">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864129">if</span>&nbsp;<span class="ident" id="3864132">a</span>&nbsp;<span class="op" id="3864134">==</span>&nbsp;<span class="builtintype" id="3864137">nil</span>&nbsp;<span class="op" id="3864141">||</span>&nbsp;<span class="ident" id="3864144">a</span><span class="op" id="3864145">.</span><span class="ident" id="3864146">IP</span>&nbsp;<span class="op" id="3864149">==</span>&nbsp;<span class="builtintype" id="3864152">nil</span>&nbsp;<span class="op" id="3864156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864160">return</span>&nbsp;<span class="builtintype" id="3864167">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3864173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864176">return</span>&nbsp;<span class="ident" id="3864183">a</span><span class="op" id="3864184">.</span><span class="ident" id="3864185">IP</span><span class="op" id="3864187">.</span><span class="ident" id="3864188">IsUnspecified</span><span class="op" id="3864201">(</span><span class="op" id="3864202">)</span><br>
<span class="lineno"></span><span class="op" id="3864204">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3864207">func</span>&nbsp;<span class="op" id="3864212">(</span><span class="ident" id="3864213">a</span>&nbsp;<span class="op" id="3864215">*</span><span class="ident" id="3864216">UDPAddr</span><span class="op" id="3864223">)</span>&nbsp;<span class="ident" id="3864225">sockaddr</span><span class="op" id="3864233">(</span><span class="ident" id="3864234">family</span>&nbsp;<span class="builtintype" id="3864241">int</span><span class="op" id="3864244">)</span>&nbsp;<span class="op" id="3864246">(</span><span class="ident" id="3864247">syscall</span><span class="op" id="3864254">.</span><span class="ident" id="3864255">Sockaddr</span><span class="op" id="3864263">,</span>&nbsp;<span class="builtintype" id="3864265">error</span><span class="op" id="3864270">)</span>&nbsp;<span class="op" id="3864272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864275">if</span>&nbsp;<span class="ident" id="3864278">a</span>&nbsp;<span class="op" id="3864280">==</span>&nbsp;<span class="builtintype" id="3864283">nil</span>&nbsp;<span class="op" id="3864287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864291">return</span>&nbsp;<span class="builtintype" id="3864298">nil</span><span class="op" id="3864301">,</span>&nbsp;<span class="builtintype" id="3864303">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3864308">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864311">return</span>&nbsp;<span class="ident" id="3864318">ipToSockaddr</span><span class="op" id="3864330">(</span><span class="ident" id="3864331">family</span><span class="op" id="3864337">,</span>&nbsp;<span class="ident" id="3864339">a</span><span class="op" id="3864340">.</span><span class="ident" id="3864341">IP</span><span class="op" id="3864343">,</span>&nbsp;<span class="ident" id="3864345">a</span><span class="op" id="3864346">.</span><span class="ident" id="3864347">Port</span><span class="op" id="3864351">,</span>&nbsp;<span class="ident" id="3864353">a</span><span class="op" id="3864354">.</span><span class="ident" id="3864355">Zone</span><span class="op" id="3864359">)</span><br>
<span class="lineno"></span><span class="op" id="3864361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3864364">//&nbsp;UDPConn&nbsp;is&nbsp;the&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;and&nbsp;PacketConn&nbsp;interfaces</span><br>
<span class="lineno"></span><span class="comment" id="3864435">//&nbsp;for&nbsp;UDP&nbsp;network&nbsp;connections.</span><br>
<span class="lineno">50</span><span class="keyword" id="3864467">type</span>&nbsp;<span class="ident" id="3864472">UDPConn</span>&nbsp;<span class="keyword" id="3864480">struct</span>&nbsp;<span class="op" id="3864487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864490">conn</span><br>
<span class="lineno"></span><span class="op" id="3864495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3864498">func</span>&nbsp;<span class="ident" id="3864503">newUDPConn</span><span class="op" id="3864513">(</span><span class="ident" id="3864514">fd</span>&nbsp;<span class="op" id="3864517">*</span><span class="ident" id="3864518">netFD</span><span class="op" id="3864523">)</span>&nbsp;<span class="op" id="3864525">*</span><span class="ident" id="3864526">UDPConn</span>&nbsp;<span class="op" id="3864534">{</span>&nbsp;<span class="keyword" id="3864536">return</span>&nbsp;<span class="op" id="3864543">&amp;</span><span class="ident" id="3864544">UDPConn</span><span class="op" id="3864551">{</span><span class="ident" id="3864552">conn</span><span class="op" id="3864556">{</span><span class="ident" id="3864557">fd</span><span class="op" id="3864559">}</span><span class="op" id="3864560">}</span>&nbsp;<span class="op" id="3864562">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="3864565">//&nbsp;ReadFromUDP&nbsp;reads&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3864635">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;return&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3864706">//&nbsp;that&nbsp;was&nbsp;on&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3864733">//</span><br>
<span class="lineno">60</span><span class="comment" id="3864736">//&nbsp;ReadFromUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3864800">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3864867">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3864887">func</span>&nbsp;<span class="op" id="3864892">(</span><span class="ident" id="3864893">c</span>&nbsp;<span class="op" id="3864895">*</span><span class="ident" id="3864896">UDPConn</span><span class="op" id="3864903">)</span>&nbsp;<span class="ident" id="3864905">ReadFromUDP</span><span class="op" id="3864916">(</span><span class="ident" id="3864917">b</span>&nbsp;<span class="op" id="3864919">[</span><span class="op" id="3864920">]</span><span class="builtintype" id="3864921">byte</span><span class="op" id="3864925">)</span>&nbsp;<span class="op" id="3864927">(</span><span class="ident" id="3864928">n</span>&nbsp;<span class="builtintype" id="3864930">int</span><span class="op" id="3864933">,</span>&nbsp;<span class="ident" id="3864935">addr</span>&nbsp;<span class="op" id="3864940">*</span><span class="ident" id="3864941">UDPAddr</span><span class="op" id="3864948">,</span>&nbsp;<span class="ident" id="3864950">err</span>&nbsp;<span class="builtintype" id="3864954">error</span><span class="op" id="3864959">)</span>&nbsp;<span class="op" id="3864961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864964">if</span>&nbsp;<span class="op" id="3864967">!</span><span class="ident" id="3864968">c</span><span class="op" id="3864969">.</span><span class="ident" id="3864970">ok</span><span class="op" id="3864972">(</span><span class="op" id="3864973">)</span>&nbsp;<span class="op" id="3864975">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864979">return</span>&nbsp;<span class="num" id="3864986">0</span><span class="op" id="3864987">,</span>&nbsp;<span class="builtintype" id="3864989">nil</span><span class="op" id="3864992">,</span>&nbsp;<span class="ident" id="3864994">syscall</span><span class="op" id="3865001">.</span><span class="ident" id="3865002">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3865010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865013">n</span><span class="op" id="3865014">,</span>&nbsp;<span class="ident" id="3865016">sa</span><span class="op" id="3865018">,</span>&nbsp;<span class="ident" id="3865020">err</span>&nbsp;<span class="op" id="3865024">:=</span>&nbsp;<span class="ident" id="3865027">c</span><span class="op" id="3865028">.</span><span class="ident" id="3865029">fd</span><span class="op" id="3865031">.</span><span class="ident" id="3865032">readFrom</span><span class="op" id="3865040">(</span><span class="ident" id="3865041">b</span><span class="op" id="3865042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3865045">switch</span>&nbsp;<span class="ident" id="3865052">sa</span>&nbsp;<span class="op" id="3865055">:=</span>&nbsp;<span class="ident" id="3865058">sa</span><span class="op" id="3865060">.</span><span class="op" id="3865061">(</span><span class="keyword" id="3865062">type</span><span class="op" id="3865066">)</span>&nbsp;<span class="op" id="3865068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3865071">case</span>&nbsp;<span class="op" id="3865076">*</span><span class="ident" id="3865077">syscall</span><span class="op" id="3865084">.</span><span class="ident" id="3865085">SockaddrInet4</span><span class="op" id="3865098">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865102">addr</span>&nbsp;<span class="op" id="3865107">=</span>&nbsp;<span class="op" id="3865109">&amp;</span><span class="ident" id="3865110">UDPAddr</span><span class="op" id="3865117">{</span><span class="ident" id="3865118">IP</span><span class="op" id="3865120">:</span>&nbsp;<span class="ident" id="3865122">sa</span><span class="op" id="3865124">.</span><span class="ident" id="3865125">Addr</span><span class="op" id="3865129">[</span><span class="num" id="3865130">0</span><span class="op" id="3865131">:</span><span class="op" id="3865132">]</span><span class="op" id="3865133">,</span>&nbsp;<span class="ident" id="3865135">Port</span><span class="op" id="3865139">:</span>&nbsp;<span class="ident" id="3865141">sa</span><span class="op" id="3865143">.</span><span class="ident" id="3865144">Port</span><span class="op" id="3865148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3865151">case</span>&nbsp;<span class="op" id="3865156">*</span><span class="ident" id="3865157">syscall</span><span class="op" id="3865164">.</span><span class="ident" id="3865165">SockaddrInet6</span><span class="op" id="3865178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865182">addr</span>&nbsp;<span class="op" id="3865187">=</span>&nbsp;<span class="op" id="3865189">&amp;</span><span class="ident" id="3865190">UDPAddr</span><span class="op" id="3865197">{</span><span class="ident" id="3865198">IP</span><span class="op" id="3865200">:</span>&nbsp;<span class="ident" id="3865202">sa</span><span class="op" id="3865204">.</span><span class="ident" id="3865205">Addr</span><span class="op" id="3865209">[</span><span class="num" id="3865210">0</span><span class="op" id="3865211">:</span><span class="op" id="3865212">]</span><span class="op" id="3865213">,</span>&nbsp;<span class="ident" id="3865215">Port</span><span class="op" id="3865219">:</span>&nbsp;<span class="ident" id="3865221">sa</span><span class="op" id="3865223">.</span><span class="ident" id="3865224">Port</span><span class="op" id="3865228">,</span>&nbsp;<span class="ident" id="3865230">Zone</span><span class="op" id="3865234">:</span>&nbsp;<span class="ident" id="3865236">zoneToString</span><span class="op" id="3865248">(</span><span class="builtintype" id="3865249">int</span><span class="op" id="3865252">(</span><span class="ident" id="3865253">sa</span><span class="op" id="3865255">.</span><span class="ident" id="3865256">ZoneId</span><span class="op" id="3865262">)</span><span class="op" id="3865263">)</span><span class="op" id="3865264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3865267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3865270">return</span><br>
<span class="lineno">75</span><span class="op" id="3865277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3865280">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3865335">func</span>&nbsp;<span class="op" id="3865340">(</span><span class="ident" id="3865341">c</span>&nbsp;<span class="op" id="3865343">*</span><span class="ident" id="3865344">UDPConn</span><span class="op" id="3865351">)</span>&nbsp;<span class="ident" id="3865353">ReadFrom</span><span class="op" id="3865361">(</span><span class="ident" id="3865362">b</span>&nbsp;<span class="op" id="3865364">[</span><span class="op" id="3865365">]</span><span class="builtintype" id="3865366">byte</span><span class="op" id="3865370">)</span>&nbsp;<span class="op" id="3865372">(</span><span class="builtintype" id="3865373">int</span><span class="op" id="3865376">,</span>&nbsp;<span class="ident" id="3865378">Addr</span><span class="op" id="3865382">,</span>&nbsp;<span class="builtintype" id="3865384">error</span><span class="op" id="3865389">)</span>&nbsp;<span class="op" id="3865391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3865394">if</span>&nbsp;<span class="op" id="3865397">!</span><span class="ident" id="3865398">c</span><span class="op" id="3865399">.</span><span class="ident" id="3865400">ok</span><span class="op" id="3865402">(</span><span class="op" id="3865403">)</span>&nbsp;<span class="op" id="3865405">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3865409">return</span>&nbsp;<span class="num" id="3865416">0</span><span class="op" id="3865417">,</span>&nbsp;<span class="builtintype" id="3865419">nil</span><span class="op" id="3865422">,</span>&nbsp;<span class="ident" id="3865424">syscall</span><span class="op" id="3865431">.</span><span class="ident" id="3865432">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3865440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865443">n</span><span class="op" id="3865444">,</span>&nbsp;<span class="ident" id="3865446">addr</span><span class="op" id="3865450">,</span>&nbsp;<span class="ident" id="3865452">err</span>&nbsp;<span class="op" id="3865456">:=</span>&nbsp;<span class="ident" id="3865459">c</span><span class="op" id="3865460">.</span><span class="ident" id="3865461">ReadFromUDP</span><span class="op" id="3865472">(</span><span class="ident" id="3865473">b</span><span class="op" id="3865474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3865477">return</span>&nbsp;<span class="ident" id="3865484">n</span><span class="op" id="3865485">,</span>&nbsp;<span class="ident" id="3865487">addr</span><span class="op" id="3865491">.</span><span class="ident" id="3865492">toAddr</span><span class="op" id="3865498">(</span><span class="op" id="3865499">)</span><span class="op" id="3865500">,</span>&nbsp;<span class="ident" id="3865502">err</span><br>
<span class="lineno"></span><span class="op" id="3865506">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3865509">//&nbsp;ReadMsgUDP&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3865577">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3865645">//&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3865713">//&nbsp;flags&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno">90</span><span class="comment" id="3865780">//&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="3865791">func</span>&nbsp;<span class="op" id="3865796">(</span><span class="ident" id="3865797">c</span>&nbsp;<span class="op" id="3865799">*</span><span class="ident" id="3865800">UDPConn</span><span class="op" id="3865807">)</span>&nbsp;<span class="ident" id="3865809">ReadMsgUDP</span><span class="op" id="3865819">(</span><span class="ident" id="3865820">b</span><span class="op" id="3865821">,</span>&nbsp;<span class="ident" id="3865823">oob</span>&nbsp;<span class="op" id="3865827">[</span><span class="op" id="3865828">]</span><span class="builtintype" id="3865829">byte</span><span class="op" id="3865833">)</span>&nbsp;<span class="op" id="3865835">(</span><span class="ident" id="3865836">n</span><span class="op" id="3865837">,</span>&nbsp;<span class="ident" id="3865839">oobn</span><span class="op" id="3865843">,</span>&nbsp;<span class="ident" id="3865845">flags</span>&nbsp;<span class="builtintype" id="3865851">int</span><span class="op" id="3865854">,</span>&nbsp;<span class="ident" id="3865856">addr</span>&nbsp;<span class="op" id="3865861">*</span><span class="ident" id="3865862">UDPAddr</span><span class="op" id="3865869">,</span>&nbsp;<span class="ident" id="3865871">err</span>&nbsp;<span class="builtintype" id="3865875">error</span><span class="op" id="3865880">)</span>&nbsp;<span class="op" id="3865882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3865885">if</span>&nbsp;<span class="op" id="3865888">!</span><span class="ident" id="3865889">c</span><span class="op" id="3865890">.</span><span class="ident" id="3865891">ok</span><span class="op" id="3865893">(</span><span class="op" id="3865894">)</span>&nbsp;<span class="op" id="3865896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3865900">return</span>&nbsp;<span class="num" id="3865907">0</span><span class="op" id="3865908">,</span>&nbsp;<span class="num" id="3865910">0</span><span class="op" id="3865911">,</span>&nbsp;<span class="num" id="3865913">0</span><span class="op" id="3865914">,</span>&nbsp;<span class="builtintype" id="3865916">nil</span><span class="op" id="3865919">,</span>&nbsp;<span class="ident" id="3865921">syscall</span><span class="op" id="3865928">.</span><span class="ident" id="3865929">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3865937">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3865940">var</span>&nbsp;<span class="ident" id="3865944">sa</span>&nbsp;<span class="ident" id="3865947">syscall</span><span class="op" id="3865954">.</span><span class="ident" id="3865955">Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865965">n</span><span class="op" id="3865966">,</span>&nbsp;<span class="ident" id="3865968">oobn</span><span class="op" id="3865972">,</span>&nbsp;<span class="ident" id="3865974">flags</span><span class="op" id="3865979">,</span>&nbsp;<span class="ident" id="3865981">sa</span><span class="op" id="3865983">,</span>&nbsp;<span class="ident" id="3865985">err</span>&nbsp;<span class="op" id="3865989">=</span>&nbsp;<span class="ident" id="3865991">c</span><span class="op" id="3865992">.</span><span class="ident" id="3865993">fd</span><span class="op" id="3865995">.</span><span class="ident" id="3865996">readMsg</span><span class="op" id="3866003">(</span><span class="ident" id="3866004">b</span><span class="op" id="3866005">,</span>&nbsp;<span class="ident" id="3866007">oob</span><span class="op" id="3866010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866013">switch</span>&nbsp;<span class="ident" id="3866020">sa</span>&nbsp;<span class="op" id="3866023">:=</span>&nbsp;<span class="ident" id="3866026">sa</span><span class="op" id="3866028">.</span><span class="op" id="3866029">(</span><span class="keyword" id="3866030">type</span><span class="op" id="3866034">)</span>&nbsp;<span class="op" id="3866036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866039">case</span>&nbsp;<span class="op" id="3866044">*</span><span class="ident" id="3866045">syscall</span><span class="op" id="3866052">.</span><span class="ident" id="3866053">SockaddrInet4</span><span class="op" id="3866066">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3866070">addr</span>&nbsp;<span class="op" id="3866075">=</span>&nbsp;<span class="op" id="3866077">&amp;</span><span class="ident" id="3866078">UDPAddr</span><span class="op" id="3866085">{</span><span class="ident" id="3866086">IP</span><span class="op" id="3866088">:</span>&nbsp;<span class="ident" id="3866090">sa</span><span class="op" id="3866092">.</span><span class="ident" id="3866093">Addr</span><span class="op" id="3866097">[</span><span class="num" id="3866098">0</span><span class="op" id="3866099">:</span><span class="op" id="3866100">]</span><span class="op" id="3866101">,</span>&nbsp;<span class="ident" id="3866103">Port</span><span class="op" id="3866107">:</span>&nbsp;<span class="ident" id="3866109">sa</span><span class="op" id="3866111">.</span><span class="ident" id="3866112">Port</span><span class="op" id="3866116">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866119">case</span>&nbsp;<span class="op" id="3866124">*</span><span class="ident" id="3866125">syscall</span><span class="op" id="3866132">.</span><span class="ident" id="3866133">SockaddrInet6</span><span class="op" id="3866146">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3866150">addr</span>&nbsp;<span class="op" id="3866155">=</span>&nbsp;<span class="op" id="3866157">&amp;</span><span class="ident" id="3866158">UDPAddr</span><span class="op" id="3866165">{</span><span class="ident" id="3866166">IP</span><span class="op" id="3866168">:</span>&nbsp;<span class="ident" id="3866170">sa</span><span class="op" id="3866172">.</span><span class="ident" id="3866173">Addr</span><span class="op" id="3866177">[</span><span class="num" id="3866178">0</span><span class="op" id="3866179">:</span><span class="op" id="3866180">]</span><span class="op" id="3866181">,</span>&nbsp;<span class="ident" id="3866183">Port</span><span class="op" id="3866187">:</span>&nbsp;<span class="ident" id="3866189">sa</span><span class="op" id="3866191">.</span><span class="ident" id="3866192">Port</span><span class="op" id="3866196">,</span>&nbsp;<span class="ident" id="3866198">Zone</span><span class="op" id="3866202">:</span>&nbsp;<span class="ident" id="3866204">zoneToString</span><span class="op" id="3866216">(</span><span class="builtintype" id="3866217">int</span><span class="op" id="3866220">(</span><span class="ident" id="3866221">sa</span><span class="op" id="3866223">.</span><span class="ident" id="3866224">ZoneId</span><span class="op" id="3866230">)</span><span class="op" id="3866231">)</span><span class="op" id="3866232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3866235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866238">return</span><br>
<span class="lineno"></span><span class="op" id="3866245">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="3866248">//&nbsp;WriteToUDP&nbsp;writes&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3866317">//&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3866328">//</span><br>
<span class="lineno"></span><span class="comment" id="3866331">//&nbsp;WriteToUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">110</span><span class="comment" id="3866394">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3866461">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3866530">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3866543">func</span>&nbsp;<span class="op" id="3866548">(</span><span class="ident" id="3866549">c</span>&nbsp;<span class="op" id="3866551">*</span><span class="ident" id="3866552">UDPConn</span><span class="op" id="3866559">)</span>&nbsp;<span class="ident" id="3866561">WriteToUDP</span><span class="op" id="3866571">(</span><span class="ident" id="3866572">b</span>&nbsp;<span class="op" id="3866574">[</span><span class="op" id="3866575">]</span><span class="builtintype" id="3866576">byte</span><span class="op" id="3866580">,</span>&nbsp;<span class="ident" id="3866582">addr</span>&nbsp;<span class="op" id="3866587">*</span><span class="ident" id="3866588">UDPAddr</span><span class="op" id="3866595">)</span>&nbsp;<span class="op" id="3866597">(</span><span class="builtintype" id="3866598">int</span><span class="op" id="3866601">,</span>&nbsp;<span class="builtintype" id="3866603">error</span><span class="op" id="3866608">)</span>&nbsp;<span class="op" id="3866610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866613">if</span>&nbsp;<span class="op" id="3866616">!</span><span class="ident" id="3866617">c</span><span class="op" id="3866618">.</span><span class="ident" id="3866619">ok</span><span class="op" id="3866621">(</span><span class="op" id="3866622">)</span>&nbsp;<span class="op" id="3866624">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866628">return</span>&nbsp;<span class="num" id="3866635">0</span><span class="op" id="3866636">,</span>&nbsp;<span class="ident" id="3866638">syscall</span><span class="op" id="3866645">.</span><span class="ident" id="3866646">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3866654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866657">if</span>&nbsp;<span class="ident" id="3866660">c</span><span class="op" id="3866661">.</span><span class="ident" id="3866662">fd</span><span class="op" id="3866664">.</span><span class="ident" id="3866665">isConnected</span>&nbsp;<span class="op" id="3866677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866681">return</span>&nbsp;<span class="num" id="3866688">0</span><span class="op" id="3866689">,</span>&nbsp;<span class="op" id="3866691">&amp;</span><span class="ident" id="3866692">OpError</span><span class="op" id="3866699">{</span><span class="string" id="3866700">&#34;write&#34;</span><span class="op" id="3866707">,</span>&nbsp;<span class="ident" id="3866709">c</span><span class="op" id="3866710">.</span><span class="ident" id="3866711">fd</span><span class="op" id="3866713">.</span><span class="ident" id="3866714">net</span><span class="op" id="3866717">,</span>&nbsp;<span class="ident" id="3866719">addr</span><span class="op" id="3866723">,</span>&nbsp;<span class="ident" id="3866725">ErrWriteToConnected</span><span class="op" id="3866744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3866747">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866750">if</span>&nbsp;<span class="ident" id="3866753">addr</span>&nbsp;<span class="op" id="3866758">==</span>&nbsp;<span class="builtintype" id="3866761">nil</span>&nbsp;<span class="op" id="3866765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866769">return</span>&nbsp;<span class="num" id="3866776">0</span><span class="op" id="3866777">,</span>&nbsp;<span class="op" id="3866779">&amp;</span><span class="ident" id="3866780">OpError</span><span class="op" id="3866787">{</span><span class="ident" id="3866788">Op</span><span class="op" id="3866790">:</span>&nbsp;<span class="string" id="3866792">&#34;write&#34;</span><span class="op" id="3866799">,</span>&nbsp;<span class="ident" id="3866801">Net</span><span class="op" id="3866804">:</span>&nbsp;<span class="ident" id="3866806">c</span><span class="op" id="3866807">.</span><span class="ident" id="3866808">fd</span><span class="op" id="3866810">.</span><span class="ident" id="3866811">net</span><span class="op" id="3866814">,</span>&nbsp;<span class="ident" id="3866816">Addr</span><span class="op" id="3866820">:</span>&nbsp;<span class="builtintype" id="3866822">nil</span><span class="op" id="3866825">,</span>&nbsp;<span class="ident" id="3866827">Err</span><span class="op" id="3866830">:</span>&nbsp;<span class="ident" id="3866832">errMissingAddress</span><span class="op" id="3866849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3866852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3866855">sa</span><span class="op" id="3866857">,</span>&nbsp;<span class="ident" id="3866859">err</span>&nbsp;<span class="op" id="3866863">:=</span>&nbsp;<span class="ident" id="3866866">addr</span><span class="op" id="3866870">.</span><span class="ident" id="3866871">sockaddr</span><span class="op" id="3866879">(</span><span class="ident" id="3866880">c</span><span class="op" id="3866881">.</span><span class="ident" id="3866882">fd</span><span class="op" id="3866884">.</span><span class="ident" id="3866885">family</span><span class="op" id="3866891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866894">if</span>&nbsp;<span class="ident" id="3866897">err</span>&nbsp;<span class="op" id="3866901">!=</span>&nbsp;<span class="builtintype" id="3866904">nil</span>&nbsp;<span class="op" id="3866908">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866912">return</span>&nbsp;<span class="num" id="3866919">0</span><span class="op" id="3866920">,</span>&nbsp;<span class="op" id="3866922">&amp;</span><span class="ident" id="3866923">OpError</span><span class="op" id="3866930">{</span><span class="string" id="3866931">&#34;write&#34;</span><span class="op" id="3866938">,</span>&nbsp;<span class="ident" id="3866940">c</span><span class="op" id="3866941">.</span><span class="ident" id="3866942">fd</span><span class="op" id="3866944">.</span><span class="ident" id="3866945">net</span><span class="op" id="3866948">,</span>&nbsp;<span class="ident" id="3866950">addr</span><span class="op" id="3866954">,</span>&nbsp;<span class="ident" id="3866956">err</span><span class="op" id="3866959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3866962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866965">return</span>&nbsp;<span class="ident" id="3866972">c</span><span class="op" id="3866973">.</span><span class="ident" id="3866974">fd</span><span class="op" id="3866976">.</span><span class="ident" id="3866977">writeTo</span><span class="op" id="3866984">(</span><span class="ident" id="3866985">b</span><span class="op" id="3866986">,</span>&nbsp;<span class="ident" id="3866988">sa</span><span class="op" id="3866990">)</span><br>
<span class="lineno"></span><span class="op" id="3866992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3866995">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3867048">func</span>&nbsp;<span class="op" id="3867053">(</span><span class="ident" id="3867054">c</span>&nbsp;<span class="op" id="3867056">*</span><span class="ident" id="3867057">UDPConn</span><span class="op" id="3867064">)</span>&nbsp;<span class="ident" id="3867066">WriteTo</span><span class="op" id="3867073">(</span><span class="ident" id="3867074">b</span>&nbsp;<span class="op" id="3867076">[</span><span class="op" id="3867077">]</span><span class="builtintype" id="3867078">byte</span><span class="op" id="3867082">,</span>&nbsp;<span class="ident" id="3867084">addr</span>&nbsp;<span class="ident" id="3867089">Addr</span><span class="op" id="3867093">)</span>&nbsp;<span class="op" id="3867095">(</span><span class="builtintype" id="3867096">int</span><span class="op" id="3867099">,</span>&nbsp;<span class="builtintype" id="3867101">error</span><span class="op" id="3867106">)</span>&nbsp;<span class="op" id="3867108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3867111">if</span>&nbsp;<span class="op" id="3867114">!</span><span class="ident" id="3867115">c</span><span class="op" id="3867116">.</span><span class="ident" id="3867117">ok</span><span class="op" id="3867119">(</span><span class="op" id="3867120">)</span>&nbsp;<span class="op" id="3867122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3867126">return</span>&nbsp;<span class="num" id="3867133">0</span><span class="op" id="3867134">,</span>&nbsp;<span class="ident" id="3867136">syscall</span><span class="op" id="3867143">.</span><span class="ident" id="3867144">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3867152">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3867155">a</span><span class="op" id="3867156">,</span>&nbsp;<span class="ident" id="3867158">ok</span>&nbsp;<span class="op" id="3867161">:=</span>&nbsp;<span class="ident" id="3867164">addr</span><span class="op" id="3867168">.</span><span class="op" id="3867169">(</span><span class="op" id="3867170">*</span><span class="ident" id="3867171">UDPAddr</span><span class="op" id="3867178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3867181">if</span>&nbsp;<span class="op" id="3867184">!</span><span class="ident" id="3867185">ok</span>&nbsp;<span class="op" id="3867188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3867192">return</span>&nbsp;<span class="num" id="3867199">0</span><span class="op" id="3867200">,</span>&nbsp;<span class="op" id="3867202">&amp;</span><span class="ident" id="3867203">OpError</span><span class="op" id="3867210">{</span><span class="string" id="3867211">&#34;write&#34;</span><span class="op" id="3867218">,</span>&nbsp;<span class="ident" id="3867220">c</span><span class="op" id="3867221">.</span><span class="ident" id="3867222">fd</span><span class="op" id="3867224">.</span><span class="ident" id="3867225">net</span><span class="op" id="3867228">,</span>&nbsp;<span class="ident" id="3867230">addr</span><span class="op" id="3867234">,</span>&nbsp;<span class="ident" id="3867236">syscall</span><span class="op" id="3867243">.</span><span class="ident" id="3867244">EINVAL</span><span class="op" id="3867250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3867253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3867256">return</span>&nbsp;<span class="ident" id="3867263">c</span><span class="op" id="3867264">.</span><span class="ident" id="3867265">WriteToUDP</span><span class="op" id="3867275">(</span><span class="ident" id="3867276">b</span><span class="op" id="3867277">,</span>&nbsp;<span class="ident" id="3867279">a</span><span class="op" id="3867280">)</span><br>
<span class="lineno">140</span><span class="op" id="3867282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3867285">//&nbsp;WriteMsgUDP&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3867356">//&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3867423">//&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">145</span><span class="keyword" id="3867475">func</span>&nbsp;<span class="op" id="3867480">(</span><span class="ident" id="3867481">c</span>&nbsp;<span class="op" id="3867483">*</span><span class="ident" id="3867484">UDPConn</span><span class="op" id="3867491">)</span>&nbsp;<span class="ident" id="3867493">WriteMsgUDP</span><span class="op" id="3867504">(</span><span class="ident" id="3867505">b</span><span class="op" id="3867506">,</span>&nbsp;<span class="ident" id="3867508">oob</span>&nbsp;<span class="op" id="3867512">[</span><span class="op" id="3867513">]</span><span class="builtintype" id="3867514">byte</span><span class="op" id="3867518">,</span>&nbsp;<span class="ident" id="3867520">addr</span>&nbsp;<span class="op" id="3867525">*</span><span class="ident" id="3867526">UDPAddr</span><span class="op" id="3867533">)</span>&nbsp;<span class="op" id="3867535">(</span><span class="ident" id="3867536">n</span><span class="op" id="3867537">,</span>&nbsp;<span class="ident" id="3867539">oobn</span>&nbsp;<span class="builtintype" id="3867544">int</span><span class="op" id="3867547">,</span>&nbsp;<span class="ident" id="3867549">err</span>&nbsp;<span class="builtintype" id="3867553">error</span><span class="op" id="3867558">)</span>&nbsp;<span class="op" id="3867560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3867563">if</span>&nbsp;<span class="op" id="3867566">!</span><span class="ident" id="3867567">c</span><span class="op" id="3867568">.</span><span class="ident" id="3867569">ok</span><span class="op" id="3867571">(</span><span class="op" id="3867572">)</span>&nbsp;<span class="op" id="3867574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3867578">return</span>&nbsp;<span class="num" id="3867585">0</span><span class="op" id="3867586">,</span>&nbsp;<span class="num" id="3867588">0</span><span class="op" id="3867589">,</span>&nbsp;<span class="ident" id="3867591">syscall</span><span class="op" id="3867598">.</span><span class="ident" id="3867599">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3867607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3867610">if</span>&nbsp;<span class="ident" id="3867613">c</span><span class="op" id="3867614">.</span><span class="ident" id="3867615">fd</span><span class="op" id="3867617">.</span><span class="ident" id="3867618">isConnected</span>&nbsp;<span class="op" id="3867630">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3867634">return</span>&nbsp;<span class="num" id="3867641">0</span><span class="op" id="3867642">,</span>&nbsp;<span class="num" id="3867644">0</span><span class="op" id="3867645">,</span>&nbsp;<span class="op" id="3867647">&amp;</span><span class="ident" id="3867648">OpError</span><span class="op" id="3867655">{</span><span class="string" id="3867656">&#34;write&#34;</span><span class="op" id="3867663">,</span>&nbsp;<span class="ident" id="3867665">c</span><span class="op" id="3867666">.</span><span class="ident" id="3867667">fd</span><span class="op" id="3867669">.</span><span class="ident" id="3867670">net</span><span class="op" id="3867673">,</span>&nbsp;<span class="ident" id="3867675">addr</span><span class="op" id="3867679">,</span>&nbsp;<span class="ident" id="3867681">ErrWriteToConnected</span><span class="op" id="3867700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3867703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3867706">if</span>&nbsp;<span class="ident" id="3867709">addr</span>&nbsp;<span class="op" id="3867714">==</span>&nbsp;<span class="builtintype" id="3867717">nil</span>&nbsp;<span class="op" id="3867721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3867725">return</span>&nbsp;<span class="num" id="3867732">0</span><span class="op" id="3867733">,</span>&nbsp;<span class="num" id="3867735">0</span><span class="op" id="3867736">,</span>&nbsp;<span class="op" id="3867738">&amp;</span><span class="ident" id="3867739">OpError</span><span class="op" id="3867746">{</span><span class="ident" id="3867747">Op</span><span class="op" id="3867749">:</span>&nbsp;<span class="string" id="3867751">&#34;write&#34;</span><span class="op" id="3867758">,</span>&nbsp;<span class="ident" id="3867760">Net</span><span class="op" id="3867763">:</span>&nbsp;<span class="ident" id="3867765">c</span><span class="op" id="3867766">.</span><span class="ident" id="3867767">fd</span><span class="op" id="3867769">.</span><span class="ident" id="3867770">net</span><span class="op" id="3867773">,</span>&nbsp;<span class="ident" id="3867775">Addr</span><span class="op" id="3867779">:</span>&nbsp;<span class="builtintype" id="3867781">nil</span><span class="op" id="3867784">,</span>&nbsp;<span class="ident" id="3867786">Err</span><span class="op" id="3867789">:</span>&nbsp;<span class="ident" id="3867791">errMissingAddress</span><span class="op" id="3867808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3867811">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3867814">sa</span><span class="op" id="3867816">,</span>&nbsp;<span class="ident" id="3867818">err</span>&nbsp;<span class="op" id="3867822">:=</span>&nbsp;<span class="ident" id="3867825">addr</span><span class="op" id="3867829">.</span><span class="ident" id="3867830">sockaddr</span><span class="op" id="3867838">(</span><span class="ident" id="3867839">c</span><span class="op" id="3867840">.</span><span class="ident" id="3867841">fd</span><span class="op" id="3867843">.</span><span class="ident" id="3867844">family</span><span class="op" id="3867850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3867853">if</span>&nbsp;<span class="ident" id="3867856">err</span>&nbsp;<span class="op" id="3867860">!=</span>&nbsp;<span class="builtintype" id="3867863">nil</span>&nbsp;<span class="op" id="3867867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3867871">return</span>&nbsp;<span class="num" id="3867878">0</span><span class="op" id="3867879">,</span>&nbsp;<span class="num" id="3867881">0</span><span class="op" id="3867882">,</span>&nbsp;<span class="op" id="3867884">&amp;</span><span class="ident" id="3867885">OpError</span><span class="op" id="3867892">{</span><span class="string" id="3867893">&#34;write&#34;</span><span class="op" id="3867900">,</span>&nbsp;<span class="ident" id="3867902">c</span><span class="op" id="3867903">.</span><span class="ident" id="3867904">fd</span><span class="op" id="3867906">.</span><span class="ident" id="3867907">net</span><span class="op" id="3867910">,</span>&nbsp;<span class="ident" id="3867912">addr</span><span class="op" id="3867916">,</span>&nbsp;<span class="ident" id="3867918">err</span><span class="op" id="3867921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3867924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3867927">return</span>&nbsp;<span class="ident" id="3867934">c</span><span class="op" id="3867935">.</span><span class="ident" id="3867936">fd</span><span class="op" id="3867938">.</span><span class="ident" id="3867939">writeMsg</span><span class="op" id="3867947">(</span><span class="ident" id="3867948">b</span><span class="op" id="3867949">,</span>&nbsp;<span class="ident" id="3867951">oob</span><span class="op" id="3867954">,</span>&nbsp;<span class="ident" id="3867956">sa</span><span class="op" id="3867958">)</span><br>
<span class="lineno">160</span><span class="op" id="3867960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3867963">//&nbsp;DialUDP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3868031">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil,&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3868102">//&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno">165</span><span class="keyword" id="3868151">func</span>&nbsp;<span class="ident" id="3868156">DialUDP</span><span class="op" id="3868163">(</span><span class="ident" id="3868164">net</span>&nbsp;<span class="builtintype" id="3868168">string</span><span class="op" id="3868174">,</span>&nbsp;<span class="ident" id="3868176">laddr</span><span class="op" id="3868181">,</span>&nbsp;<span class="ident" id="3868183">raddr</span>&nbsp;<span class="op" id="3868189">*</span><span class="ident" id="3868190">UDPAddr</span><span class="op" id="3868197">)</span>&nbsp;<span class="op" id="3868199">(</span><span class="op" id="3868200">*</span><span class="ident" id="3868201">UDPConn</span><span class="op" id="3868208">,</span>&nbsp;<span class="builtintype" id="3868210">error</span><span class="op" id="3868215">)</span>&nbsp;<span class="op" id="3868217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3868220">switch</span>&nbsp;<span class="ident" id="3868227">net</span>&nbsp;<span class="op" id="3868231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3868234">case</span>&nbsp;<span class="string" id="3868239">&#34;udp&#34;</span><span class="op" id="3868244">,</span>&nbsp;<span class="string" id="3868246">&#34;udp4&#34;</span><span class="op" id="3868252">,</span>&nbsp;<span class="string" id="3868254">&#34;udp6&#34;</span><span class="op" id="3868260">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3868263">default</span><span class="op" id="3868270">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3868274">return</span>&nbsp;<span class="builtintype" id="3868281">nil</span><span class="op" id="3868284">,</span>&nbsp;<span class="op" id="3868286">&amp;</span><span class="ident" id="3868287">OpError</span><span class="op" id="3868294">{</span><span class="ident" id="3868295">Op</span><span class="op" id="3868297">:</span>&nbsp;<span class="string" id="3868299">&#34;dial&#34;</span><span class="op" id="3868305">,</span>&nbsp;<span class="ident" id="3868307">Net</span><span class="op" id="3868310">:</span>&nbsp;<span class="ident" id="3868312">net</span><span class="op" id="3868315">,</span>&nbsp;<span class="ident" id="3868317">Addr</span><span class="op" id="3868321">:</span>&nbsp;<span class="ident" id="3868323">raddr</span><span class="op" id="3868328">,</span>&nbsp;<span class="ident" id="3868330">Err</span><span class="op" id="3868333">:</span>&nbsp;<span class="ident" id="3868335">UnknownNetworkError</span><span class="op" id="3868354">(</span><span class="ident" id="3868355">net</span><span class="op" id="3868358">)</span><span class="op" id="3868359">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3868362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3868365">if</span>&nbsp;<span class="ident" id="3868368">raddr</span>&nbsp;<span class="op" id="3868374">==</span>&nbsp;<span class="builtintype" id="3868377">nil</span>&nbsp;<span class="op" id="3868381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3868385">return</span>&nbsp;<span class="builtintype" id="3868392">nil</span><span class="op" id="3868395">,</span>&nbsp;<span class="op" id="3868397">&amp;</span><span class="ident" id="3868398">OpError</span><span class="op" id="3868405">{</span><span class="ident" id="3868406">Op</span><span class="op" id="3868408">:</span>&nbsp;<span class="string" id="3868410">&#34;dial&#34;</span><span class="op" id="3868416">,</span>&nbsp;<span class="ident" id="3868418">Net</span><span class="op" id="3868421">:</span>&nbsp;<span class="ident" id="3868423">net</span><span class="op" id="3868426">,</span>&nbsp;<span class="ident" id="3868428">Addr</span><span class="op" id="3868432">:</span>&nbsp;<span class="builtintype" id="3868434">nil</span><span class="op" id="3868437">,</span>&nbsp;<span class="ident" id="3868439">Err</span><span class="op" id="3868442">:</span>&nbsp;<span class="ident" id="3868444">errMissingAddress</span><span class="op" id="3868461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3868464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3868467">return</span>&nbsp;<span class="ident" id="3868474">dialUDP</span><span class="op" id="3868481">(</span><span class="ident" id="3868482">net</span><span class="op" id="3868485">,</span>&nbsp;<span class="ident" id="3868487">laddr</span><span class="op" id="3868492">,</span>&nbsp;<span class="ident" id="3868494">raddr</span><span class="op" id="3868499">,</span>&nbsp;<span class="ident" id="3868501">noDeadline</span><span class="op" id="3868511">)</span><br>
<span class="lineno">175</span><span class="op" id="3868513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3868516">func</span>&nbsp;<span class="ident" id="3868521">dialUDP</span><span class="op" id="3868528">(</span><span class="ident" id="3868529">net</span>&nbsp;<span class="builtintype" id="3868533">string</span><span class="op" id="3868539">,</span>&nbsp;<span class="ident" id="3868541">laddr</span><span class="op" id="3868546">,</span>&nbsp;<span class="ident" id="3868548">raddr</span>&nbsp;<span class="op" id="3868554">*</span><span class="ident" id="3868555">UDPAddr</span><span class="op" id="3868562">,</span>&nbsp;<span class="ident" id="3868564">deadline</span>&nbsp;<span class="ident" id="3868573">time</span><span class="op" id="3868577">.</span><span class="ident" id="3868578">Time</span><span class="op" id="3868582">)</span>&nbsp;<span class="op" id="3868584">(</span><span class="op" id="3868585">*</span><span class="ident" id="3868586">UDPConn</span><span class="op" id="3868593">,</span>&nbsp;<span class="builtintype" id="3868595">error</span><span class="op" id="3868600">)</span>&nbsp;<span class="op" id="3868602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3868605">fd</span><span class="op" id="3868607">,</span>&nbsp;<span class="ident" id="3868609">err</span>&nbsp;<span class="op" id="3868613">:=</span>&nbsp;<span class="ident" id="3868616">internetSocket</span><span class="op" id="3868630">(</span><span class="ident" id="3868631">net</span><span class="op" id="3868634">,</span>&nbsp;<span class="ident" id="3868636">laddr</span><span class="op" id="3868641">,</span>&nbsp;<span class="ident" id="3868643">raddr</span><span class="op" id="3868648">,</span>&nbsp;<span class="ident" id="3868650">deadline</span><span class="op" id="3868658">,</span>&nbsp;<span class="ident" id="3868660">syscall</span><span class="op" id="3868667">.</span><span class="ident" id="3868668">SOCK_DGRAM</span><span class="op" id="3868678">,</span>&nbsp;<span class="num" id="3868680">0</span><span class="op" id="3868681">,</span>&nbsp;<span class="string" id="3868683">&#34;dial&#34;</span><span class="op" id="3868689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3868692">if</span>&nbsp;<span class="ident" id="3868695">err</span>&nbsp;<span class="op" id="3868699">!=</span>&nbsp;<span class="builtintype" id="3868702">nil</span>&nbsp;<span class="op" id="3868706">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3868710">return</span>&nbsp;<span class="builtintype" id="3868717">nil</span><span class="op" id="3868720">,</span>&nbsp;<span class="op" id="3868722">&amp;</span><span class="ident" id="3868723">OpError</span><span class="op" id="3868730">{</span><span class="ident" id="3868731">Op</span><span class="op" id="3868733">:</span>&nbsp;<span class="string" id="3868735">&#34;dial&#34;</span><span class="op" id="3868741">,</span>&nbsp;<span class="ident" id="3868743">Net</span><span class="op" id="3868746">:</span>&nbsp;<span class="ident" id="3868748">net</span><span class="op" id="3868751">,</span>&nbsp;<span class="ident" id="3868753">Addr</span><span class="op" id="3868757">:</span>&nbsp;<span class="ident" id="3868759">raddr</span><span class="op" id="3868764">,</span>&nbsp;<span class="ident" id="3868766">Err</span><span class="op" id="3868769">:</span>&nbsp;<span class="ident" id="3868771">err</span><span class="op" id="3868774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3868777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3868780">return</span>&nbsp;<span class="ident" id="3868787">newUDPConn</span><span class="op" id="3868797">(</span><span class="ident" id="3868798">fd</span><span class="op" id="3868800">)</span><span class="op" id="3868801">,</span>&nbsp;<span class="builtintype" id="3868803">nil</span><br>
<span class="lineno"></span><span class="op" id="3868807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="3868810">//&nbsp;ListenUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;UDP&nbsp;packets&nbsp;addressed&nbsp;to&nbsp;the&nbsp;local</span><br>
<span class="lineno"></span><span class="comment" id="3868879">//&nbsp;address&nbsp;laddr.&nbsp;&nbsp;Net&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="3868950">//&nbsp;a&nbsp;port&nbsp;of&nbsp;0,&nbsp;ListenUDP&nbsp;will&nbsp;choose&nbsp;an&nbsp;available&nbsp;port.</span><br>
<span class="lineno"></span><span class="comment" id="3869007">//&nbsp;The&nbsp;LocalAddr&nbsp;method&nbsp;of&nbsp;the&nbsp;returned&nbsp;UDPConn&nbsp;can&nbsp;be&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3869070">//&nbsp;discover&nbsp;the&nbsp;port.&nbsp;&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo</span><br>
<span class="lineno">190</span><span class="comment" id="3869140">//&nbsp;methods&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;UDP&nbsp;packets&nbsp;with&nbsp;per-packet</span><br>
<span class="lineno"></span><span class="comment" id="3869211">//&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3869226">func</span>&nbsp;<span class="ident" id="3869231">ListenUDP</span><span class="op" id="3869240">(</span><span class="ident" id="3869241">net</span>&nbsp;<span class="builtintype" id="3869245">string</span><span class="op" id="3869251">,</span>&nbsp;<span class="ident" id="3869253">laddr</span>&nbsp;<span class="op" id="3869259">*</span><span class="ident" id="3869260">UDPAddr</span><span class="op" id="3869267">)</span>&nbsp;<span class="op" id="3869269">(</span><span class="op" id="3869270">*</span><span class="ident" id="3869271">UDPConn</span><span class="op" id="3869278">,</span>&nbsp;<span class="builtintype" id="3869280">error</span><span class="op" id="3869285">)</span>&nbsp;<span class="op" id="3869287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3869290">switch</span>&nbsp;<span class="ident" id="3869297">net</span>&nbsp;<span class="op" id="3869301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3869304">case</span>&nbsp;<span class="string" id="3869309">&#34;udp&#34;</span><span class="op" id="3869314">,</span>&nbsp;<span class="string" id="3869316">&#34;udp4&#34;</span><span class="op" id="3869322">,</span>&nbsp;<span class="string" id="3869324">&#34;udp6&#34;</span><span class="op" id="3869330">:</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3869333">default</span><span class="op" id="3869340">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3869344">return</span>&nbsp;<span class="builtintype" id="3869351">nil</span><span class="op" id="3869354">,</span>&nbsp;<span class="op" id="3869356">&amp;</span><span class="ident" id="3869357">OpError</span><span class="op" id="3869364">{</span><span class="ident" id="3869365">Op</span><span class="op" id="3869367">:</span>&nbsp;<span class="string" id="3869369">&#34;listen&#34;</span><span class="op" id="3869377">,</span>&nbsp;<span class="ident" id="3869379">Net</span><span class="op" id="3869382">:</span>&nbsp;<span class="ident" id="3869384">net</span><span class="op" id="3869387">,</span>&nbsp;<span class="ident" id="3869389">Addr</span><span class="op" id="3869393">:</span>&nbsp;<span class="ident" id="3869395">laddr</span><span class="op" id="3869400">,</span>&nbsp;<span class="ident" id="3869402">Err</span><span class="op" id="3869405">:</span>&nbsp;<span class="ident" id="3869407">UnknownNetworkError</span><span class="op" id="3869426">(</span><span class="ident" id="3869427">net</span><span class="op" id="3869430">)</span><span class="op" id="3869431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3869434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3869437">if</span>&nbsp;<span class="ident" id="3869440">laddr</span>&nbsp;<span class="op" id="3869446">==</span>&nbsp;<span class="builtintype" id="3869449">nil</span>&nbsp;<span class="op" id="3869453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3869457">laddr</span>&nbsp;<span class="op" id="3869463">=</span>&nbsp;<span class="op" id="3869465">&amp;</span><span class="ident" id="3869466">UDPAddr</span><span class="op" id="3869473">{</span><span class="op" id="3869474">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3869477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3869480">fd</span><span class="op" id="3869482">,</span>&nbsp;<span class="ident" id="3869484">err</span>&nbsp;<span class="op" id="3869488">:=</span>&nbsp;<span class="ident" id="3869491">internetSocket</span><span class="op" id="3869505">(</span><span class="ident" id="3869506">net</span><span class="op" id="3869509">,</span>&nbsp;<span class="ident" id="3869511">laddr</span><span class="op" id="3869516">,</span>&nbsp;<span class="builtintype" id="3869518">nil</span><span class="op" id="3869521">,</span>&nbsp;<span class="ident" id="3869523">noDeadline</span><span class="op" id="3869533">,</span>&nbsp;<span class="ident" id="3869535">syscall</span><span class="op" id="3869542">.</span><span class="ident" id="3869543">SOCK_DGRAM</span><span class="op" id="3869553">,</span>&nbsp;<span class="num" id="3869555">0</span><span class="op" id="3869556">,</span>&nbsp;<span class="string" id="3869558">&#34;listen&#34;</span><span class="op" id="3869566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3869569">if</span>&nbsp;<span class="ident" id="3869572">err</span>&nbsp;<span class="op" id="3869576">!=</span>&nbsp;<span class="builtintype" id="3869579">nil</span>&nbsp;<span class="op" id="3869583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3869587">return</span>&nbsp;<span class="builtintype" id="3869594">nil</span><span class="op" id="3869597">,</span>&nbsp;<span class="op" id="3869599">&amp;</span><span class="ident" id="3869600">OpError</span><span class="op" id="3869607">{</span><span class="ident" id="3869608">Op</span><span class="op" id="3869610">:</span>&nbsp;<span class="string" id="3869612">&#34;listen&#34;</span><span class="op" id="3869620">,</span>&nbsp;<span class="ident" id="3869622">Net</span><span class="op" id="3869625">:</span>&nbsp;<span class="ident" id="3869627">net</span><span class="op" id="3869630">,</span>&nbsp;<span class="ident" id="3869632">Addr</span><span class="op" id="3869636">:</span>&nbsp;<span class="ident" id="3869638">laddr</span><span class="op" id="3869643">,</span>&nbsp;<span class="ident" id="3869645">Err</span><span class="op" id="3869648">:</span>&nbsp;<span class="ident" id="3869650">err</span><span class="op" id="3869653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3869656">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3869659">return</span>&nbsp;<span class="ident" id="3869666">newUDPConn</span><span class="op" id="3869676">(</span><span class="ident" id="3869677">fd</span><span class="op" id="3869679">)</span><span class="op" id="3869680">,</span>&nbsp;<span class="builtintype" id="3869682">nil</span><br>
<span class="lineno"></span><span class="op" id="3869686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3869689">//&nbsp;ListenMulticastUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;multicast&nbsp;UDP&nbsp;packets</span><br>
<span class="lineno"></span><span class="comment" id="3869754">//&nbsp;addressed&nbsp;to&nbsp;the&nbsp;group&nbsp;address&nbsp;gaddr&nbsp;on&nbsp;ifi,&nbsp;which&nbsp;specifies&nbsp;the</span><br>
<span class="lineno">210</span><span class="comment" id="3869822">//&nbsp;interface&nbsp;to&nbsp;join.&nbsp;&nbsp;ListenMulticastUDP&nbsp;uses&nbsp;default&nbsp;multicast</span><br>
<span class="lineno"></span><span class="comment" id="3869887">//&nbsp;interface&nbsp;if&nbsp;ifi&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3869915">func</span>&nbsp;<span class="ident" id="3869920">ListenMulticastUDP</span><span class="op" id="3869938">(</span><span class="ident" id="3869939">net</span>&nbsp;<span class="builtintype" id="3869943">string</span><span class="op" id="3869949">,</span>&nbsp;<span class="ident" id="3869951">ifi</span>&nbsp;<span class="op" id="3869955">*</span><span class="ident" id="3869956">Interface</span><span class="op" id="3869965">,</span>&nbsp;<span class="ident" id="3869967">gaddr</span>&nbsp;<span class="op" id="3869973">*</span><span class="ident" id="3869974">UDPAddr</span><span class="op" id="3869981">)</span>&nbsp;<span class="op" id="3869983">(</span><span class="op" id="3869984">*</span><span class="ident" id="3869985">UDPConn</span><span class="op" id="3869992">,</span>&nbsp;<span class="builtintype" id="3869994">error</span><span class="op" id="3869999">)</span>&nbsp;<span class="op" id="3870001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3870004">switch</span>&nbsp;<span class="ident" id="3870011">net</span>&nbsp;<span class="op" id="3870015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3870018">case</span>&nbsp;<span class="string" id="3870023">&#34;udp&#34;</span><span class="op" id="3870028">,</span>&nbsp;<span class="string" id="3870030">&#34;udp4&#34;</span><span class="op" id="3870036">,</span>&nbsp;<span class="string" id="3870038">&#34;udp6&#34;</span><span class="op" id="3870044">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3870047">default</span><span class="op" id="3870054">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3870058">return</span>&nbsp;<span class="builtintype" id="3870065">nil</span><span class="op" id="3870068">,</span>&nbsp;<span class="op" id="3870070">&amp;</span><span class="ident" id="3870071">OpError</span><span class="op" id="3870078">{</span><span class="ident" id="3870079">Op</span><span class="op" id="3870081">:</span>&nbsp;<span class="string" id="3870083">&#34;listen&#34;</span><span class="op" id="3870091">,</span>&nbsp;<span class="ident" id="3870093">Net</span><span class="op" id="3870096">:</span>&nbsp;<span class="ident" id="3870098">net</span><span class="op" id="3870101">,</span>&nbsp;<span class="ident" id="3870103">Addr</span><span class="op" id="3870107">:</span>&nbsp;<span class="ident" id="3870109">gaddr</span><span class="op" id="3870114">,</span>&nbsp;<span class="ident" id="3870116">Err</span><span class="op" id="3870119">:</span>&nbsp;<span class="ident" id="3870121">UnknownNetworkError</span><span class="op" id="3870140">(</span><span class="ident" id="3870141">net</span><span class="op" id="3870144">)</span><span class="op" id="3870145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3870148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3870151">if</span>&nbsp;<span class="ident" id="3870154">gaddr</span>&nbsp;<span class="op" id="3870160">==</span>&nbsp;<span class="builtintype" id="3870163">nil</span>&nbsp;<span class="op" id="3870167">||</span>&nbsp;<span class="ident" id="3870170">gaddr</span><span class="op" id="3870175">.</span><span class="ident" id="3870176">IP</span>&nbsp;<span class="op" id="3870179">==</span>&nbsp;<span class="builtintype" id="3870182">nil</span>&nbsp;<span class="op" id="3870186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3870190">return</span>&nbsp;<span class="builtintype" id="3870197">nil</span><span class="op" id="3870200">,</span>&nbsp;<span class="op" id="3870202">&amp;</span><span class="ident" id="3870203">OpError</span><span class="op" id="3870210">{</span><span class="ident" id="3870211">Op</span><span class="op" id="3870213">:</span>&nbsp;<span class="string" id="3870215">&#34;listen&#34;</span><span class="op" id="3870223">,</span>&nbsp;<span class="ident" id="3870225">Net</span><span class="op" id="3870228">:</span>&nbsp;<span class="ident" id="3870230">net</span><span class="op" id="3870233">,</span>&nbsp;<span class="ident" id="3870235">Addr</span><span class="op" id="3870239">:</span>&nbsp;<span class="builtintype" id="3870241">nil</span><span class="op" id="3870244">,</span>&nbsp;<span class="ident" id="3870246">Err</span><span class="op" id="3870249">:</span>&nbsp;<span class="ident" id="3870251">errMissingAddress</span><span class="op" id="3870268">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3870271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3870274">fd</span><span class="op" id="3870276">,</span>&nbsp;<span class="ident" id="3870278">err</span>&nbsp;<span class="op" id="3870282">:=</span>&nbsp;<span class="ident" id="3870285">internetSocket</span><span class="op" id="3870299">(</span><span class="ident" id="3870300">net</span><span class="op" id="3870303">,</span>&nbsp;<span class="ident" id="3870305">gaddr</span><span class="op" id="3870310">,</span>&nbsp;<span class="builtintype" id="3870312">nil</span><span class="op" id="3870315">,</span>&nbsp;<span class="ident" id="3870317">noDeadline</span><span class="op" id="3870327">,</span>&nbsp;<span class="ident" id="3870329">syscall</span><span class="op" id="3870336">.</span><span class="ident" id="3870337">SOCK_DGRAM</span><span class="op" id="3870347">,</span>&nbsp;<span class="num" id="3870349">0</span><span class="op" id="3870350">,</span>&nbsp;<span class="string" id="3870352">&#34;listen&#34;</span><span class="op" id="3870360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3870363">if</span>&nbsp;<span class="ident" id="3870366">err</span>&nbsp;<span class="op" id="3870370">!=</span>&nbsp;<span class="builtintype" id="3870373">nil</span>&nbsp;<span class="op" id="3870377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3870381">return</span>&nbsp;<span class="builtintype" id="3870388">nil</span><span class="op" id="3870391">,</span>&nbsp;<span class="op" id="3870393">&amp;</span><span class="ident" id="3870394">OpError</span><span class="op" id="3870401">{</span><span class="ident" id="3870402">Op</span><span class="op" id="3870404">:</span>&nbsp;<span class="string" id="3870406">&#34;listen&#34;</span><span class="op" id="3870414">,</span>&nbsp;<span class="ident" id="3870416">Net</span><span class="op" id="3870419">:</span>&nbsp;<span class="ident" id="3870421">net</span><span class="op" id="3870424">,</span>&nbsp;<span class="ident" id="3870426">Addr</span><span class="op" id="3870430">:</span>&nbsp;<span class="ident" id="3870432">gaddr</span><span class="op" id="3870437">,</span>&nbsp;<span class="ident" id="3870439">Err</span><span class="op" id="3870442">:</span>&nbsp;<span class="ident" id="3870444">err</span><span class="op" id="3870447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3870450">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3870453">c</span>&nbsp;<span class="op" id="3870455">:=</span>&nbsp;<span class="ident" id="3870458">newUDPConn</span><span class="op" id="3870468">(</span><span class="ident" id="3870469">fd</span><span class="op" id="3870471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3870474">if</span>&nbsp;<span class="ident" id="3870477">ip4</span>&nbsp;<span class="op" id="3870481">:=</span>&nbsp;<span class="ident" id="3870484">gaddr</span><span class="op" id="3870489">.</span><span class="ident" id="3870490">IP</span><span class="op" id="3870492">.</span><span class="ident" id="3870493">To4</span><span class="op" id="3870496">(</span><span class="op" id="3870497">)</span><span class="op" id="3870498">;</span>&nbsp;<span class="ident" id="3870500">ip4</span>&nbsp;<span class="op" id="3870504">!=</span>&nbsp;<span class="builtintype" id="3870507">nil</span>&nbsp;<span class="op" id="3870511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3870515">if</span>&nbsp;<span class="ident" id="3870518">err</span>&nbsp;<span class="op" id="3870522">:=</span>&nbsp;<span class="ident" id="3870525">listenIPv4MulticastUDP</span><span class="op" id="3870547">(</span><span class="ident" id="3870548">c</span><span class="op" id="3870549">,</span>&nbsp;<span class="ident" id="3870551">ifi</span><span class="op" id="3870554">,</span>&nbsp;<span class="ident" id="3870556">ip4</span><span class="op" id="3870559">)</span><span class="op" id="3870560">;</span>&nbsp;<span class="ident" id="3870562">err</span>&nbsp;<span class="op" id="3870566">!=</span>&nbsp;<span class="builtintype" id="3870569">nil</span>&nbsp;<span class="op" id="3870573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3870578">c</span><span class="op" id="3870579">.</span><span class="ident" id="3870580">Close</span><span class="op" id="3870585">(</span><span class="op" id="3870586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3870591">return</span>&nbsp;<span class="builtintype" id="3870598">nil</span><span class="op" id="3870601">,</span>&nbsp;<span class="op" id="3870603">&amp;</span><span class="ident" id="3870604">OpError</span><span class="op" id="3870611">{</span><span class="ident" id="3870612">Op</span><span class="op" id="3870614">:</span>&nbsp;<span class="string" id="3870616">&#34;listen&#34;</span><span class="op" id="3870624">,</span>&nbsp;<span class="ident" id="3870626">Net</span><span class="op" id="3870629">:</span>&nbsp;<span class="ident" id="3870631">net</span><span class="op" id="3870634">,</span>&nbsp;<span class="ident" id="3870636">Addr</span><span class="op" id="3870640">:</span>&nbsp;<span class="op" id="3870642">&amp;</span><span class="ident" id="3870643">IPAddr</span><span class="op" id="3870649">{</span><span class="ident" id="3870650">IP</span><span class="op" id="3870652">:</span>&nbsp;<span class="ident" id="3870654">ip4</span><span class="op" id="3870657">}</span><span class="op" id="3870658">,</span>&nbsp;<span class="ident" id="3870660">Err</span><span class="op" id="3870663">:</span>&nbsp;<span class="ident" id="3870665">err</span><span class="op" id="3870668">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3870672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3870675">}</span>&nbsp;<span class="keyword" id="3870677">else</span>&nbsp;<span class="op" id="3870682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3870686">if</span>&nbsp;<span class="ident" id="3870689">err</span>&nbsp;<span class="op" id="3870693">:=</span>&nbsp;<span class="ident" id="3870696">listenIPv6MulticastUDP</span><span class="op" id="3870718">(</span><span class="ident" id="3870719">c</span><span class="op" id="3870720">,</span>&nbsp;<span class="ident" id="3870722">ifi</span><span class="op" id="3870725">,</span>&nbsp;<span class="ident" id="3870727">gaddr</span><span class="op" id="3870732">.</span><span class="ident" id="3870733">IP</span><span class="op" id="3870735">)</span><span class="op" id="3870736">;</span>&nbsp;<span class="ident" id="3870738">err</span>&nbsp;<span class="op" id="3870742">!=</span>&nbsp;<span class="builtintype" id="3870745">nil</span>&nbsp;<span class="op" id="3870749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3870754">c</span><span class="op" id="3870755">.</span><span class="ident" id="3870756">Close</span><span class="op" id="3870761">(</span><span class="op" id="3870762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3870767">return</span>&nbsp;<span class="builtintype" id="3870774">nil</span><span class="op" id="3870777">,</span>&nbsp;<span class="op" id="3870779">&amp;</span><span class="ident" id="3870780">OpError</span><span class="op" id="3870787">{</span><span class="ident" id="3870788">Op</span><span class="op" id="3870790">:</span>&nbsp;<span class="string" id="3870792">&#34;listen&#34;</span><span class="op" id="3870800">,</span>&nbsp;<span class="ident" id="3870802">Net</span><span class="op" id="3870805">:</span>&nbsp;<span class="ident" id="3870807">net</span><span class="op" id="3870810">,</span>&nbsp;<span class="ident" id="3870812">Addr</span><span class="op" id="3870816">:</span>&nbsp;<span class="op" id="3870818">&amp;</span><span class="ident" id="3870819">IPAddr</span><span class="op" id="3870825">{</span><span class="ident" id="3870826">IP</span><span class="op" id="3870828">:</span>&nbsp;<span class="ident" id="3870830">gaddr</span><span class="op" id="3870835">.</span><span class="ident" id="3870836">IP</span><span class="op" id="3870838">}</span><span class="op" id="3870839">,</span>&nbsp;<span class="ident" id="3870841">Err</span><span class="op" id="3870844">:</span>&nbsp;<span class="ident" id="3870846">err</span><span class="op" id="3870849">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3870853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3870856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3870859">return</span>&nbsp;<span class="ident" id="3870866">c</span><span class="op" id="3870867">,</span>&nbsp;<span class="builtintype" id="3870869">nil</span><br>
<span class="lineno"></span><span class="op" id="3870873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="3870876">func</span>&nbsp;<span class="ident" id="3870881">listenIPv4MulticastUDP</span><span class="op" id="3870903">(</span><span class="ident" id="3870904">c</span>&nbsp;<span class="op" id="3870906">*</span><span class="ident" id="3870907">UDPConn</span><span class="op" id="3870914">,</span>&nbsp;<span class="ident" id="3870916">ifi</span>&nbsp;<span class="op" id="3870920">*</span><span class="ident" id="3870921">Interface</span><span class="op" id="3870930">,</span>&nbsp;<span class="ident" id="3870932">ip</span>&nbsp;<span class="ident" id="3870935">IP</span><span class="op" id="3870937">)</span>&nbsp;<span class="builtintype" id="3870939">error</span>&nbsp;<span class="op" id="3870945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3870948">if</span>&nbsp;<span class="ident" id="3870951">ifi</span>&nbsp;<span class="op" id="3870955">!=</span>&nbsp;<span class="builtintype" id="3870958">nil</span>&nbsp;<span class="op" id="3870962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3870966">if</span>&nbsp;<span class="ident" id="3870969">err</span>&nbsp;<span class="op" id="3870973">:=</span>&nbsp;<span class="ident" id="3870976">setIPv4MulticastInterface</span><span class="op" id="3871001">(</span><span class="ident" id="3871002">c</span><span class="op" id="3871003">.</span><span class="ident" id="3871004">fd</span><span class="op" id="3871006">,</span>&nbsp;<span class="ident" id="3871008">ifi</span><span class="op" id="3871011">)</span><span class="op" id="3871012">;</span>&nbsp;<span class="ident" id="3871014">err</span>&nbsp;<span class="op" id="3871018">!=</span>&nbsp;<span class="builtintype" id="3871021">nil</span>&nbsp;<span class="op" id="3871025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3871030">return</span>&nbsp;<span class="ident" id="3871037">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3871043">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3871046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3871049">if</span>&nbsp;<span class="ident" id="3871052">err</span>&nbsp;<span class="op" id="3871056">:=</span>&nbsp;<span class="ident" id="3871059">setIPv4MulticastLoopback</span><span class="op" id="3871083">(</span><span class="ident" id="3871084">c</span><span class="op" id="3871085">.</span><span class="ident" id="3871086">fd</span><span class="op" id="3871088">,</span>&nbsp;<span class="builtintype" id="3871090">false</span><span class="op" id="3871095">)</span><span class="op" id="3871096">;</span>&nbsp;<span class="ident" id="3871098">err</span>&nbsp;<span class="op" id="3871102">!=</span>&nbsp;<span class="builtintype" id="3871105">nil</span>&nbsp;<span class="op" id="3871109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3871113">return</span>&nbsp;<span class="ident" id="3871120">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3871125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3871128">if</span>&nbsp;<span class="ident" id="3871131">err</span>&nbsp;<span class="op" id="3871135">:=</span>&nbsp;<span class="ident" id="3871138">joinIPv4Group</span><span class="op" id="3871151">(</span><span class="ident" id="3871152">c</span><span class="op" id="3871153">.</span><span class="ident" id="3871154">fd</span><span class="op" id="3871156">,</span>&nbsp;<span class="ident" id="3871158">ifi</span><span class="op" id="3871161">,</span>&nbsp;<span class="ident" id="3871163">ip</span><span class="op" id="3871165">)</span><span class="op" id="3871166">;</span>&nbsp;<span class="ident" id="3871168">err</span>&nbsp;<span class="op" id="3871172">!=</span>&nbsp;<span class="builtintype" id="3871175">nil</span>&nbsp;<span class="op" id="3871179">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3871183">return</span>&nbsp;<span class="ident" id="3871190">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3871195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3871198">return</span>&nbsp;<span class="builtintype" id="3871205">nil</span><br>
<span class="lineno"></span><span class="op" id="3871209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="3871212">func</span>&nbsp;<span class="ident" id="3871217">listenIPv6MulticastUDP</span><span class="op" id="3871239">(</span><span class="ident" id="3871240">c</span>&nbsp;<span class="op" id="3871242">*</span><span class="ident" id="3871243">UDPConn</span><span class="op" id="3871250">,</span>&nbsp;<span class="ident" id="3871252">ifi</span>&nbsp;<span class="op" id="3871256">*</span><span class="ident" id="3871257">Interface</span><span class="op" id="3871266">,</span>&nbsp;<span class="ident" id="3871268">ip</span>&nbsp;<span class="ident" id="3871271">IP</span><span class="op" id="3871273">)</span>&nbsp;<span class="builtintype" id="3871275">error</span>&nbsp;<span class="op" id="3871281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3871284">if</span>&nbsp;<span class="ident" id="3871287">ifi</span>&nbsp;<span class="op" id="3871291">!=</span>&nbsp;<span class="builtintype" id="3871294">nil</span>&nbsp;<span class="op" id="3871298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3871302">if</span>&nbsp;<span class="ident" id="3871305">err</span>&nbsp;<span class="op" id="3871309">:=</span>&nbsp;<span class="ident" id="3871312">setIPv6MulticastInterface</span><span class="op" id="3871337">(</span><span class="ident" id="3871338">c</span><span class="op" id="3871339">.</span><span class="ident" id="3871340">fd</span><span class="op" id="3871342">,</span>&nbsp;<span class="ident" id="3871344">ifi</span><span class="op" id="3871347">)</span><span class="op" id="3871348">;</span>&nbsp;<span class="ident" id="3871350">err</span>&nbsp;<span class="op" id="3871354">!=</span>&nbsp;<span class="builtintype" id="3871357">nil</span>&nbsp;<span class="op" id="3871361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3871366">return</span>&nbsp;<span class="ident" id="3871373">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3871379">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3871382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3871385">if</span>&nbsp;<span class="ident" id="3871388">err</span>&nbsp;<span class="op" id="3871392">:=</span>&nbsp;<span class="ident" id="3871395">setIPv6MulticastLoopback</span><span class="op" id="3871419">(</span><span class="ident" id="3871420">c</span><span class="op" id="3871421">.</span><span class="ident" id="3871422">fd</span><span class="op" id="3871424">,</span>&nbsp;<span class="builtintype" id="3871426">false</span><span class="op" id="3871431">)</span><span class="op" id="3871432">;</span>&nbsp;<span class="ident" id="3871434">err</span>&nbsp;<span class="op" id="3871438">!=</span>&nbsp;<span class="builtintype" id="3871441">nil</span>&nbsp;<span class="op" id="3871445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3871449">return</span>&nbsp;<span class="ident" id="3871456">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3871461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3871464">if</span>&nbsp;<span class="ident" id="3871467">err</span>&nbsp;<span class="op" id="3871471">:=</span>&nbsp;<span class="ident" id="3871474">joinIPv6Group</span><span class="op" id="3871487">(</span><span class="ident" id="3871488">c</span><span class="op" id="3871489">.</span><span class="ident" id="3871490">fd</span><span class="op" id="3871492">,</span>&nbsp;<span class="ident" id="3871494">ifi</span><span class="op" id="3871497">,</span>&nbsp;<span class="ident" id="3871499">ip</span><span class="op" id="3871501">)</span><span class="op" id="3871502">;</span>&nbsp;<span class="ident" id="3871504">err</span>&nbsp;<span class="op" id="3871508">!=</span>&nbsp;<span class="builtintype" id="3871511">nil</span>&nbsp;<span class="op" id="3871515">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3871519">return</span>&nbsp;<span class="ident" id="3871526">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3871531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3871534">return</span>&nbsp;<span class="builtintype" id="3871541">nil</span><br>
<span class="lineno"></span><span class="op" id="3871545">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
