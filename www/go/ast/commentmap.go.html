<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5883699">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5883754">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5883808">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5883859">package</span>&nbsp;<span class="ident" id="5883867">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5883872">import</span>&nbsp;<span class="op" id="5883879">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5883882">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5883891">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5883898">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5883910">&#34;sort&#34;</span><br>
<span class="lineno"></span><span class="op" id="5883917">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5883920">type</span>&nbsp;<span class="ident" id="5883925">byPos</span>&nbsp;<span class="op" id="5883931">[</span><span class="op" id="5883932">]</span><span class="op" id="5883933">*</span><span class="ident" id="5883934"><a href="/go/ast/ast.go.html#5854728">CommentGroup</a></span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="5883948">func</span>&nbsp;<span class="op" id="5883953">(</span><span class="ident" id="5883954">a</span>&nbsp;<span class="ident" id="5883956"><a href="/go/ast/commentmap.go.html#5883925">byPos</a></span><span class="op" id="5883961">)</span>&nbsp;<span class="ident" id="5883963">Len</span><span class="op" id="5883966">(</span><span class="op" id="5883967">)</span>&nbsp;<span class="builtintype" id="5883969">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5883983">{</span>&nbsp;<span class="keyword" id="5883985">return</span>&nbsp;<span class="builtinfunc" id="5883992">len</span><span class="op" id="5883995">(</span><span class="ident" id="5883996"><a href="/go/ast/commentmap.go.html#5883954">a</a></span><span class="op" id="5883997">)</span>&nbsp;<span class="op" id="5883999">}</span><br>
<span class="lineno"></span><span class="keyword" id="5884001">func</span>&nbsp;<span class="op" id="5884006">(</span><span class="ident" id="5884007">a</span>&nbsp;<span class="ident" id="5884009"><a href="/go/ast/commentmap.go.html#5883925">byPos</a></span><span class="op" id="5884014">)</span>&nbsp;<span class="ident" id="5884016">Less</span><span class="op" id="5884020">(</span><span class="ident" id="5884021">i</span><span class="op" id="5884022">,</span>&nbsp;<span class="ident" id="5884024">j</span>&nbsp;<span class="builtintype" id="5884026">int</span><span class="op" id="5884029">)</span>&nbsp;<span class="builtintype" id="5884031">bool</span>&nbsp;<span class="op" id="5884036">{</span>&nbsp;<span class="keyword" id="5884038">return</span>&nbsp;<span class="ident" id="5884045"><a href="/go/ast/commentmap.go.html#5884007">a</a></span><span class="op" id="5884046">[</span><span class="ident" id="5884047"><a href="/go/ast/commentmap.go.html#5884021">i</a></span><span class="op" id="5884048">]</span><span class="op" id="5884049">.</span><span class="ident" id="5884050">Pos</span><span class="op" id="5884053">(</span><span class="op" id="5884054">)</span>&nbsp;<span class="op" id="5884056">&lt;</span>&nbsp;<span class="ident" id="5884058"><a href="/go/ast/commentmap.go.html#5884007">a</a></span><span class="op" id="5884059">[</span><span class="ident" id="5884060"><a href="/go/ast/commentmap.go.html#5884024">j</a></span><span class="op" id="5884061">]</span><span class="op" id="5884062">.</span><span class="ident" id="5884063">Pos</span><span class="op" id="5884066">(</span><span class="op" id="5884067">)</span>&nbsp;<span class="op" id="5884069">}</span><br>
<span class="lineno"></span><span class="keyword" id="5884071">func</span>&nbsp;<span class="op" id="5884076">(</span><span class="ident" id="5884077">a</span>&nbsp;<span class="ident" id="5884079"><a href="/go/ast/commentmap.go.html#5883925">byPos</a></span><span class="op" id="5884084">)</span>&nbsp;<span class="ident" id="5884086">Swap</span><span class="op" id="5884090">(</span><span class="ident" id="5884091">i</span><span class="op" id="5884092">,</span>&nbsp;<span class="ident" id="5884094">j</span>&nbsp;<span class="builtintype" id="5884096">int</span><span class="op" id="5884099">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5884106">{</span>&nbsp;<span class="ident" id="5884108"><a href="/go/ast/commentmap.go.html#5884077">a</a></span><span class="op" id="5884109">[</span><span class="ident" id="5884110"><a href="/go/ast/commentmap.go.html#5884091">i</a></span><span class="op" id="5884111">]</span><span class="op" id="5884112">,</span>&nbsp;<span class="ident" id="5884114"><a href="/go/ast/commentmap.go.html#5884077">a</a></span><span class="op" id="5884115">[</span><span class="ident" id="5884116"><a href="/go/ast/commentmap.go.html#5884094">j</a></span><span class="op" id="5884117">]</span>&nbsp;<span class="op" id="5884119">=</span>&nbsp;<span class="ident" id="5884121"><a href="/go/ast/commentmap.go.html#5884077">a</a></span><span class="op" id="5884122">[</span><span class="ident" id="5884123"><a href="/go/ast/commentmap.go.html#5884094">j</a></span><span class="op" id="5884124">]</span><span class="op" id="5884125">,</span>&nbsp;<span class="ident" id="5884127"><a href="/go/ast/commentmap.go.html#5884077">a</a></span><span class="op" id="5884128">[</span><span class="ident" id="5884129"><a href="/go/ast/commentmap.go.html#5884091">i</a></span><span class="op" id="5884130">]</span>&nbsp;<span class="op" id="5884132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5884135">//&nbsp;sortComments&nbsp;sorts&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="5884201">//</span><br>
<span class="lineno"></span><span class="keyword" id="5884204">func</span>&nbsp;<span class="ident" id="5884209">sortComments</span><span class="op" id="5884221">(</span><span class="ident" id="5884222">list</span>&nbsp;<span class="op" id="5884227">[</span><span class="op" id="5884228">]</span><span class="op" id="5884229">*</span><span class="ident" id="5884230"><a href="/go/ast/ast.go.html#5854728">CommentGroup</a></span><span class="op" id="5884242">)</span>&nbsp;<span class="op" id="5884244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5884247">//&nbsp;TODO(gri):&nbsp;Does&nbsp;it&nbsp;make&nbsp;sense&nbsp;to&nbsp;check&nbsp;for&nbsp;sorted-ness</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5884306">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first&nbsp;(because&nbsp;we&nbsp;know&nbsp;that&nbsp;sorted-ness&nbsp;is</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5884364">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;very&nbsp;likely)?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5884393">if</span>&nbsp;<span class="ident" id="5884396">orderedList</span>&nbsp;<span class="op" id="5884408">:=</span>&nbsp;<span class="ident" id="5884411"><a href="/go/ast/commentmap.go.html#5883925">byPos</a></span><span class="op" id="5884416">(</span><span class="ident" id="5884417"><a href="/go/ast/commentmap.go.html#5884222">list</a></span><span class="op" id="5884421">)</span><span class="op" id="5884422">;</span>&nbsp;<span class="op" id="5884424">!</span><span class="ident" id="5884425"><a href="/go/ast/commentmap.go.html#5883910">sort</a></span><span class="op" id="5884429">.</span><span class="ident" id="5884430">IsSorted</span><span class="op" id="5884438">(</span><span class="ident" id="5884439"><a href="/go/ast/commentmap.go.html#5884396">orderedList</a></span><span class="op" id="5884450">)</span>&nbsp;<span class="op" id="5884452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884456"><a href="/go/ast/commentmap.go.html#5883910">sort</a></span><span class="op" id="5884460">.</span><span class="ident" id="5884461">Sort</span><span class="op" id="5884465">(</span><span class="ident" id="5884466"><a href="/go/ast/commentmap.go.html#5884396">orderedList</a></span><span class="op" id="5884477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5884480">}</span><br>
<span class="lineno"></span><span class="op" id="5884482">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5884485">//&nbsp;A&nbsp;CommentMap&nbsp;maps&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="5884546">//&nbsp;associated&nbsp;with&nbsp;it.&nbsp;See&nbsp;NewCommentMap&nbsp;for&nbsp;a&nbsp;description&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5884608">//&nbsp;the&nbsp;association.</span><br>
<span class="lineno"></span><span class="comment" id="5884628">//</span><br>
<span class="lineno">35</span><span class="keyword" id="5884631">type</span>&nbsp;<span class="ident" id="5884636">CommentMap</span>&nbsp;<span class="keyword" id="5884647">map</span><span class="op" id="5884650">[</span><span class="ident" id="5884651"><a href="/go/ast/ast.go.html#5853708">Node</a></span><span class="op" id="5884655">]</span><span class="op" id="5884656">[</span><span class="op" id="5884657">]</span><span class="op" id="5884658">*</span><span class="ident" id="5884659"><a href="/go/ast/ast.go.html#5854728">CommentGroup</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5884673">func</span>&nbsp;<span class="op" id="5884678">(</span><span class="ident" id="5884679">cmap</span>&nbsp;<span class="ident" id="5884684"><a href="/go/ast/commentmap.go.html#5884636">CommentMap</a></span><span class="op" id="5884694">)</span>&nbsp;<span class="ident" id="5884696">addComment</span><span class="op" id="5884706">(</span><span class="ident" id="5884707">n</span>&nbsp;<span class="ident" id="5884709"><a href="/go/ast/ast.go.html#5853708">Node</a></span><span class="op" id="5884713">,</span>&nbsp;<span class="ident" id="5884715">c</span>&nbsp;<span class="op" id="5884717">*</span><span class="ident" id="5884718"><a href="/go/ast/ast.go.html#5854728">CommentGroup</a></span><span class="op" id="5884730">)</span>&nbsp;<span class="op" id="5884732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884735">list</span>&nbsp;<span class="op" id="5884740">:=</span>&nbsp;<span class="ident" id="5884743"><a href="/go/ast/commentmap.go.html#5884679">cmap</a></span><span class="op" id="5884747">[</span><span class="ident" id="5884748"><a href="/go/ast/commentmap.go.html#5884707">n</a></span><span class="op" id="5884749">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5884752">if</span>&nbsp;<span class="builtinfunc" id="5884755">len</span><span class="op" id="5884758">(</span><span class="ident" id="5884759"><a href="/go/ast/commentmap.go.html#5884735">list</a></span><span class="op" id="5884763">)</span>&nbsp;<span class="op" id="5884765">==</span>&nbsp;<span class="num" id="5884768">0</span>&nbsp;<span class="op" id="5884770">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884774"><a href="/go/ast/commentmap.go.html#5884735">list</a></span>&nbsp;<span class="op" id="5884779">=</span>&nbsp;<span class="op" id="5884781">[</span><span class="op" id="5884782">]</span><span class="op" id="5884783">*</span><span class="ident" id="5884784"><a href="/go/ast/ast.go.html#5854728">CommentGroup</a></span><span class="op" id="5884796">{</span><span class="ident" id="5884797"><a href="/go/ast/commentmap.go.html#5884715">c</a></span><span class="op" id="5884798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5884801">}</span>&nbsp;<span class="keyword" id="5884803">else</span>&nbsp;<span class="op" id="5884808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884812"><a href="/go/ast/commentmap.go.html#5884735">list</a></span>&nbsp;<span class="op" id="5884817">=</span>&nbsp;<span class="builtinfunc" id="5884819">append</span><span class="op" id="5884825">(</span><span class="ident" id="5884826"><a href="/go/ast/commentmap.go.html#5884735">list</a></span><span class="op" id="5884830">,</span>&nbsp;<span class="ident" id="5884832"><a href="/go/ast/commentmap.go.html#5884715">c</a></span><span class="op" id="5884833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5884836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884839"><a href="/go/ast/commentmap.go.html#5884679">cmap</a></span><span class="op" id="5884843">[</span><span class="ident" id="5884844"><a href="/go/ast/commentmap.go.html#5884707">n</a></span><span class="op" id="5884845">]</span>&nbsp;<span class="op" id="5884847">=</span>&nbsp;<span class="ident" id="5884849"><a href="/go/ast/commentmap.go.html#5884735">list</a></span><br>
<span class="lineno">45</span><span class="op" id="5884854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5884857">type</span>&nbsp;<span class="ident" id="5884862">byInterval</span>&nbsp;<span class="op" id="5884873">[</span><span class="op" id="5884874">]</span><span class="ident" id="5884875"><a href="/go/ast/ast.go.html#5853708">Node</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5884881">func</span>&nbsp;<span class="op" id="5884886">(</span><span class="ident" id="5884887">a</span>&nbsp;<span class="ident" id="5884889"><a href="/go/ast/commentmap.go.html#5884862">byInterval</a></span><span class="op" id="5884899">)</span>&nbsp;<span class="ident" id="5884901">Len</span><span class="op" id="5884904">(</span><span class="op" id="5884905">)</span>&nbsp;<span class="builtintype" id="5884907">int</span>&nbsp;<span class="op" id="5884911">{</span>&nbsp;<span class="keyword" id="5884913">return</span>&nbsp;<span class="builtinfunc" id="5884920">len</span><span class="op" id="5884923">(</span><span class="ident" id="5884924"><a href="/go/ast/commentmap.go.html#5884887">a</a></span><span class="op" id="5884925">)</span>&nbsp;<span class="op" id="5884927">}</span><br>
<span class="lineno">50</span><span class="keyword" id="5884929">func</span>&nbsp;<span class="op" id="5884934">(</span><span class="ident" id="5884935">a</span>&nbsp;<span class="ident" id="5884937"><a href="/go/ast/commentmap.go.html#5884862">byInterval</a></span><span class="op" id="5884947">)</span>&nbsp;<span class="ident" id="5884949">Less</span><span class="op" id="5884953">(</span><span class="ident" id="5884954">i</span><span class="op" id="5884955">,</span>&nbsp;<span class="ident" id="5884957">j</span>&nbsp;<span class="builtintype" id="5884959">int</span><span class="op" id="5884962">)</span>&nbsp;<span class="builtintype" id="5884964">bool</span>&nbsp;<span class="op" id="5884969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884972">pi</span><span class="op" id="5884974">,</span>&nbsp;<span class="ident" id="5884976">pj</span>&nbsp;<span class="op" id="5884979">:=</span>&nbsp;<span class="ident" id="5884982"><a href="/go/ast/commentmap.go.html#5884935">a</a></span><span class="op" id="5884983">[</span><span class="ident" id="5884984"><a href="/go/ast/commentmap.go.html#5884954">i</a></span><span class="op" id="5884985">]</span><span class="op" id="5884986">.</span><span class="ident" id="5884987">Pos</span><span class="op" id="5884990">(</span><span class="op" id="5884991">)</span><span class="op" id="5884992">,</span>&nbsp;<span class="ident" id="5884994"><a href="/go/ast/commentmap.go.html#5884935">a</a></span><span class="op" id="5884995">[</span><span class="ident" id="5884996"><a href="/go/ast/commentmap.go.html#5884957">j</a></span><span class="op" id="5884997">]</span><span class="op" id="5884998">.</span><span class="ident" id="5884999">Pos</span><span class="op" id="5885002">(</span><span class="op" id="5885003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5885006">return</span>&nbsp;<span class="ident" id="5885013"><a href="/go/ast/commentmap.go.html#5884972">pi</a></span>&nbsp;<span class="op" id="5885016">&lt;</span>&nbsp;<span class="ident" id="5885018"><a href="/go/ast/commentmap.go.html#5884976">pj</a></span>&nbsp;<span class="op" id="5885021">||</span>&nbsp;<span class="ident" id="5885024"><a href="/go/ast/commentmap.go.html#5884972">pi</a></span>&nbsp;<span class="op" id="5885027">==</span>&nbsp;<span class="ident" id="5885030"><a href="/go/ast/commentmap.go.html#5884976">pj</a></span>&nbsp;<span class="op" id="5885033">&amp;&amp;</span>&nbsp;<span class="ident" id="5885036"><a href="/go/ast/commentmap.go.html#5884935">a</a></span><span class="op" id="5885037">[</span><span class="ident" id="5885038"><a href="/go/ast/commentmap.go.html#5884954">i</a></span><span class="op" id="5885039">]</span><span class="op" id="5885040">.</span><span class="ident" id="5885041">End</span><span class="op" id="5885044">(</span><span class="op" id="5885045">)</span>&nbsp;<span class="op" id="5885047">&gt;</span>&nbsp;<span class="ident" id="5885049"><a href="/go/ast/commentmap.go.html#5884935">a</a></span><span class="op" id="5885050">[</span><span class="ident" id="5885051"><a href="/go/ast/commentmap.go.html#5884957">j</a></span><span class="op" id="5885052">]</span><span class="op" id="5885053">.</span><span class="ident" id="5885054">End</span><span class="op" id="5885057">(</span><span class="op" id="5885058">)</span><br>
<span class="lineno"></span><span class="op" id="5885060">}</span><br>
<span class="lineno"></span><span class="keyword" id="5885062">func</span>&nbsp;<span class="op" id="5885067">(</span><span class="ident" id="5885068">a</span>&nbsp;<span class="ident" id="5885070"><a href="/go/ast/commentmap.go.html#5884862">byInterval</a></span><span class="op" id="5885080">)</span>&nbsp;<span class="ident" id="5885082">Swap</span><span class="op" id="5885086">(</span><span class="ident" id="5885087">i</span><span class="op" id="5885088">,</span>&nbsp;<span class="ident" id="5885090">j</span>&nbsp;<span class="builtintype" id="5885092">int</span><span class="op" id="5885095">)</span>&nbsp;<span class="op" id="5885097">{</span>&nbsp;<span class="ident" id="5885099"><a href="/go/ast/commentmap.go.html#5885068">a</a></span><span class="op" id="5885100">[</span><span class="ident" id="5885101"><a href="/go/ast/commentmap.go.html#5885087">i</a></span><span class="op" id="5885102">]</span><span class="op" id="5885103">,</span>&nbsp;<span class="ident" id="5885105"><a href="/go/ast/commentmap.go.html#5885068">a</a></span><span class="op" id="5885106">[</span><span class="ident" id="5885107"><a href="/go/ast/commentmap.go.html#5885090">j</a></span><span class="op" id="5885108">]</span>&nbsp;<span class="op" id="5885110">=</span>&nbsp;<span class="ident" id="5885112"><a href="/go/ast/commentmap.go.html#5885068">a</a></span><span class="op" id="5885113">[</span><span class="ident" id="5885114"><a href="/go/ast/commentmap.go.html#5885090">j</a></span><span class="op" id="5885115">]</span><span class="op" id="5885116">,</span>&nbsp;<span class="ident" id="5885118"><a href="/go/ast/commentmap.go.html#5885068">a</a></span><span class="op" id="5885119">[</span><span class="ident" id="5885120"><a href="/go/ast/commentmap.go.html#5885087">i</a></span><span class="op" id="5885121">]</span>&nbsp;<span class="op" id="5885123">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="5885126">//&nbsp;nodeList&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;n&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="5885194">//</span><br>
<span class="lineno"></span><span class="keyword" id="5885197">func</span>&nbsp;<span class="ident" id="5885202">nodeList</span><span class="op" id="5885210">(</span><span class="ident" id="5885211">n</span>&nbsp;<span class="ident" id="5885213"><a href="/go/ast/ast.go.html#5853708">Node</a></span><span class="op" id="5885217">)</span>&nbsp;<span class="op" id="5885219">[</span><span class="op" id="5885220">]</span><span class="ident" id="5885221"><a href="/go/ast/ast.go.html#5853708">Node</a></span>&nbsp;<span class="op" id="5885226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5885229">var</span>&nbsp;<span class="ident" id="5885233">list</span>&nbsp;<span class="op" id="5885238">[</span><span class="op" id="5885239">]</span><span class="ident" id="5885240"><a href="/go/ast/ast.go.html#5853708">Node</a></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5885246"><a href="/go/ast/walk.go.html#5932125">Inspect</a></span><span class="op" id="5885253">(</span><span class="ident" id="5885254"><a href="/go/ast/commentmap.go.html#5885211">n</a></span><span class="op" id="5885255">,</span>&nbsp;<span class="keyword" id="5885257">func</span><span class="op" id="5885261">(</span><span class="ident" id="5885262">n</span>&nbsp;<span class="ident" id="5885264"><a href="/go/ast/ast.go.html#5853708">Node</a></span><span class="op" id="5885268">)</span>&nbsp;<span class="builtintype" id="5885270">bool</span>&nbsp;<span class="op" id="5885275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5885279">//&nbsp;don&#39;t&nbsp;collect&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5885307">switch</span>&nbsp;<span class="ident" id="5885314"><a href="/go/ast/commentmap.go.html#5885262">n</a></span><span class="op" id="5885315">.</span><span class="op" id="5885316">(</span><span class="keyword" id="5885317">type</span><span class="op" id="5885321">)</span>&nbsp;<span class="op" id="5885323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5885327">case</span>&nbsp;<span class="ident" id="5885332">nil</span><span class="op" id="5885335">,</span>&nbsp;<span class="op" id="5885337">*</span><span class="ident" id="5885338"><a href="/go/ast/ast.go.html#5854728">CommentGroup</a></span><span class="op" id="5885350">,</span>&nbsp;<span class="op" id="5885352">*</span><span class="ident" id="5885353"><a href="/go/ast/ast.go.html#5854330">Comment</a></span><span class="op" id="5885360">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5885365">return</span>&nbsp;<span class="ident" id="5885372">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5885380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5885384"><a href="/go/ast/commentmap.go.html#5885233">list</a></span>&nbsp;<span class="op" id="5885389">=</span>&nbsp;<span class="builtinfunc" id="5885391">append</span><span class="op" id="5885397">(</span><span class="ident" id="5885398"><a href="/go/ast/commentmap.go.html#5885233">list</a></span><span class="op" id="5885402">,</span>&nbsp;<span class="ident" id="5885404"><a href="/go/ast/commentmap.go.html#5885262">n</a></span><span class="op" id="5885405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5885409">return</span>&nbsp;<span class="ident" id="5885416">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5885422">}</span><span class="op" id="5885423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5885426">//&nbsp;Note:&nbsp;The&nbsp;current&nbsp;implementation&nbsp;assumes&nbsp;that&nbsp;Inspect&nbsp;traverses&nbsp;the</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5885498">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AST&nbsp;in&nbsp;depth-first&nbsp;and&nbsp;thus&nbsp;_source_&nbsp;order.&nbsp;If&nbsp;AST&nbsp;traversal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5885569">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;does&nbsp;not&nbsp;follow&nbsp;source&nbsp;order,&nbsp;the&nbsp;sorting&nbsp;call&nbsp;below&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5885640">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5885660">//&nbsp;sort.Sort(byInterval(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5885692">return</span>&nbsp;<span class="ident" id="5885699"><a href="/go/ast/commentmap.go.html#5885233">list</a></span><br>
<span class="lineno">75</span><span class="op" id="5885704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5885707">//&nbsp;A&nbsp;commentListReader&nbsp;helps&nbsp;iterating&nbsp;through&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups.</span><br>
<span class="lineno"></span><span class="comment" id="5885780">//</span><br>
<span class="lineno"></span><span class="keyword" id="5885783">type</span>&nbsp;<span class="ident" id="5885788">commentListReader</span>&nbsp;<span class="keyword" id="5885806">struct</span>&nbsp;<span class="op" id="5885813">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5885816">fset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5885825">*</span><span class="ident" id="5885826"><a href="/go/ast/commentmap.go.html#5883898">token</a></span><span class="op" id="5885831">.</span><span class="ident" id="5885832">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5885841">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5885850">[</span><span class="op" id="5885851">]</span><span class="op" id="5885852">*</span><span class="ident" id="5885853"><a href="/go/ast/ast.go.html#5854728">CommentGroup</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5885867">index</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5885876">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5885881">comment</span>&nbsp;&nbsp;<span class="op" id="5885890">*</span><span class="ident" id="5885891"><a href="/go/ast/ast.go.html#5854728">CommentGroup</a></span>&nbsp;&nbsp;<span class="comment" id="5885905">//&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5885940">pos</span><span class="op" id="5885943">,</span>&nbsp;<span class="ident" id="5885945">end</span>&nbsp;<span class="ident" id="5885949"><a href="/go/ast/commentmap.go.html#5883898">token</a></span><span class="op" id="5885954">.</span><span class="ident" id="5885955">Position</span>&nbsp;<span class="comment" id="5885964">//&nbsp;source&nbsp;interval&nbsp;of&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno">85</span><span class="op" id="5886017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5886020">func</span>&nbsp;<span class="op" id="5886025">(</span><span class="ident" id="5886026">r</span>&nbsp;<span class="op" id="5886028">*</span><span class="ident" id="5886029"><a href="/go/ast/commentmap.go.html#5885788">commentListReader</a></span><span class="op" id="5886046">)</span>&nbsp;<span class="ident" id="5886048">eol</span><span class="op" id="5886051">(</span><span class="op" id="5886052">)</span>&nbsp;<span class="builtintype" id="5886054">bool</span>&nbsp;<span class="op" id="5886059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5886062">return</span>&nbsp;<span class="ident" id="5886069"><a href="/go/ast/commentmap.go.html#5886026">r</a></span><span class="op" id="5886070">.</span><span class="ident" id="5886071">index</span>&nbsp;<span class="op" id="5886077">&gt;=</span>&nbsp;<span class="builtinfunc" id="5886080">len</span><span class="op" id="5886083">(</span><span class="ident" id="5886084"><a href="/go/ast/commentmap.go.html#5886026">r</a></span><span class="op" id="5886085">.</span><span class="ident" id="5886086">list</span><span class="op" id="5886090">)</span><br>
<span class="lineno"></span><span class="op" id="5886092">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="5886095">func</span>&nbsp;<span class="op" id="5886100">(</span><span class="ident" id="5886101">r</span>&nbsp;<span class="op" id="5886103">*</span><span class="ident" id="5886104"><a href="/go/ast/commentmap.go.html#5885788">commentListReader</a></span><span class="op" id="5886121">)</span>&nbsp;<span class="ident" id="5886123">next</span><span class="op" id="5886127">(</span><span class="op" id="5886128">)</span>&nbsp;<span class="op" id="5886130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5886133">if</span>&nbsp;<span class="op" id="5886136">!</span><span class="ident" id="5886137"><a href="/go/ast/commentmap.go.html#5886101">r</a></span><span class="op" id="5886138">.</span><span class="ident" id="5886139">eol</span><span class="op" id="5886142">(</span><span class="op" id="5886143">)</span>&nbsp;<span class="op" id="5886145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5886149"><a href="/go/ast/commentmap.go.html#5886101">r</a></span><span class="op" id="5886150">.</span><span class="ident" id="5886151">comment</span>&nbsp;<span class="op" id="5886159">=</span>&nbsp;<span class="ident" id="5886161"><a href="/go/ast/commentmap.go.html#5886101">r</a></span><span class="op" id="5886162">.</span><span class="ident" id="5886163">list</span><span class="op" id="5886167">[</span><span class="ident" id="5886168"><a href="/go/ast/commentmap.go.html#5886101">r</a></span><span class="op" id="5886169">.</span><span class="ident" id="5886170">index</span><span class="op" id="5886175">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5886179"><a href="/go/ast/commentmap.go.html#5886101">r</a></span><span class="op" id="5886180">.</span><span class="ident" id="5886181">pos</span>&nbsp;<span class="op" id="5886185">=</span>&nbsp;<span class="ident" id="5886187"><a href="/go/ast/commentmap.go.html#5886101">r</a></span><span class="op" id="5886188">.</span><span class="ident" id="5886189">fset</span><span class="op" id="5886193">.</span><span class="ident" id="5886194">Position</span><span class="op" id="5886202">(</span><span class="ident" id="5886203"><a href="/go/ast/commentmap.go.html#5886101">r</a></span><span class="op" id="5886204">.</span><span class="ident" id="5886205">comment</span><span class="op" id="5886212">.</span><span class="ident" id="5886213">Pos</span><span class="op" id="5886216">(</span><span class="op" id="5886217">)</span><span class="op" id="5886218">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5886222"><a href="/go/ast/commentmap.go.html#5886101">r</a></span><span class="op" id="5886223">.</span><span class="ident" id="5886224">end</span>&nbsp;<span class="op" id="5886228">=</span>&nbsp;<span class="ident" id="5886230"><a href="/go/ast/commentmap.go.html#5886101">r</a></span><span class="op" id="5886231">.</span><span class="ident" id="5886232">fset</span><span class="op" id="5886236">.</span><span class="ident" id="5886237">Position</span><span class="op" id="5886245">(</span><span class="ident" id="5886246"><a href="/go/ast/commentmap.go.html#5886101">r</a></span><span class="op" id="5886247">.</span><span class="ident" id="5886248">comment</span><span class="op" id="5886255">.</span><span class="ident" id="5886256">End</span><span class="op" id="5886259">(</span><span class="op" id="5886260">)</span><span class="op" id="5886261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5886265"><a href="/go/ast/commentmap.go.html#5886101">r</a></span><span class="op" id="5886266">.</span><span class="ident" id="5886267">index</span><span class="op" id="5886272">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5886276">}</span><br>
<span class="lineno"></span><span class="op" id="5886278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="5886281">//&nbsp;A&nbsp;nodeStack&nbsp;keeps&nbsp;track&nbsp;of&nbsp;nested&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="5886325">//&nbsp;A&nbsp;node&nbsp;lower&nbsp;on&nbsp;the&nbsp;stack&nbsp;lexically&nbsp;contains&nbsp;the&nbsp;nodes&nbsp;higher&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="5886404">//</span><br>
<span class="lineno"></span><span class="keyword" id="5886407">type</span>&nbsp;<span class="ident" id="5886412">nodeStack</span>&nbsp;<span class="op" id="5886422">[</span><span class="op" id="5886423">]</span><span class="ident" id="5886424"><a href="/go/ast/ast.go.html#5853708">Node</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5886430">//&nbsp;push&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="5886484">//&nbsp;and&nbsp;then&nbsp;pushes&nbsp;n&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="5886519">//</span><br>
<span class="lineno"></span><span class="keyword" id="5886522">func</span>&nbsp;<span class="op" id="5886527">(</span><span class="ident" id="5886528">s</span>&nbsp;<span class="op" id="5886530">*</span><span class="ident" id="5886531"><a href="/go/ast/commentmap.go.html#5886412">nodeStack</a></span><span class="op" id="5886540">)</span>&nbsp;<span class="ident" id="5886542">push</span><span class="op" id="5886546">(</span><span class="ident" id="5886547">n</span>&nbsp;<span class="ident" id="5886549"><a href="/go/ast/ast.go.html#5853708">Node</a></span><span class="op" id="5886553">)</span>&nbsp;<span class="op" id="5886555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5886558"><a href="/go/ast/commentmap.go.html#5886528">s</a></span><span class="op" id="5886559">.</span><span class="ident" id="5886560">pop</span><span class="op" id="5886563">(</span><span class="ident" id="5886564"><a href="/go/ast/commentmap.go.html#5886547">n</a></span><span class="op" id="5886565">.</span><span class="ident" id="5886566">Pos</span><span class="op" id="5886569">(</span><span class="op" id="5886570">)</span><span class="op" id="5886571">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5886574">*</span><span class="ident" id="5886575"><a href="/go/ast/commentmap.go.html#5886528">s</a></span>&nbsp;<span class="op" id="5886577">=</span>&nbsp;<span class="builtinfunc" id="5886579">append</span><span class="op" id="5886585">(</span><span class="op" id="5886586">(</span><span class="op" id="5886587">*</span><span class="ident" id="5886588"><a href="/go/ast/commentmap.go.html#5886528">s</a></span><span class="op" id="5886589">)</span><span class="op" id="5886590">,</span>&nbsp;<span class="ident" id="5886592"><a href="/go/ast/commentmap.go.html#5886547">n</a></span><span class="op" id="5886593">)</span><br>
<span class="lineno"></span><span class="op" id="5886595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5886598">//&nbsp;pop&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="5886653">//&nbsp;(i.e.,&nbsp;whose&nbsp;lexical&nbsp;extent&nbsp;has&nbsp;ended&nbsp;before&nbsp;or&nbsp;at&nbsp;pos).</span><br>
<span class="lineno">115</span><span class="comment" id="5886713">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;last&nbsp;node&nbsp;popped.</span><br>
<span class="lineno"></span><span class="comment" id="5886749">//</span><br>
<span class="lineno"></span><span class="keyword" id="5886752">func</span>&nbsp;<span class="op" id="5886757">(</span><span class="ident" id="5886758">s</span>&nbsp;<span class="op" id="5886760">*</span><span class="ident" id="5886761"><a href="/go/ast/commentmap.go.html#5886412">nodeStack</a></span><span class="op" id="5886770">)</span>&nbsp;<span class="ident" id="5886772">pop</span><span class="op" id="5886775">(</span><span class="ident" id="5886776">pos</span>&nbsp;<span class="ident" id="5886780"><a href="/go/ast/commentmap.go.html#5883898">token</a></span><span class="op" id="5886785">.</span><span class="ident" id="5886786">Pos</span><span class="op" id="5886789">)</span>&nbsp;<span class="op" id="5886791">(</span><span class="ident" id="5886792">top</span>&nbsp;<span class="ident" id="5886796"><a href="/go/ast/ast.go.html#5853708">Node</a></span><span class="op" id="5886800">)</span>&nbsp;<span class="op" id="5886802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5886805">i</span>&nbsp;<span class="op" id="5886807">:=</span>&nbsp;<span class="builtinfunc" id="5886810">len</span><span class="op" id="5886813">(</span><span class="op" id="5886814">*</span><span class="ident" id="5886815"><a href="/go/ast/commentmap.go.html#5886758">s</a></span><span class="op" id="5886816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5886819">for</span>&nbsp;<span class="ident" id="5886823"><a href="/go/ast/commentmap.go.html#5886805">i</a></span>&nbsp;<span class="op" id="5886825">&gt;</span>&nbsp;<span class="num" id="5886827">0</span>&nbsp;<span class="op" id="5886829">&amp;&amp;</span>&nbsp;<span class="op" id="5886832">(</span><span class="op" id="5886833">*</span><span class="ident" id="5886834"><a href="/go/ast/commentmap.go.html#5886758">s</a></span><span class="op" id="5886835">)</span><span class="op" id="5886836">[</span><span class="ident" id="5886837"><a href="/go/ast/commentmap.go.html#5886805">i</a></span><span class="op" id="5886838">-</span><span class="num" id="5886839">1</span><span class="op" id="5886840">]</span><span class="op" id="5886841">.</span><span class="ident" id="5886842">End</span><span class="op" id="5886845">(</span><span class="op" id="5886846">)</span>&nbsp;<span class="op" id="5886848">&lt;=</span>&nbsp;<span class="ident" id="5886851"><a href="/go/ast/commentmap.go.html#5886776">pos</a></span>&nbsp;<span class="op" id="5886855">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5886859"><a href="/go/ast/commentmap.go.html#5886792">top</a></span>&nbsp;<span class="op" id="5886863">=</span>&nbsp;<span class="op" id="5886865">(</span><span class="op" id="5886866">*</span><span class="ident" id="5886867"><a href="/go/ast/commentmap.go.html#5886758">s</a></span><span class="op" id="5886868">)</span><span class="op" id="5886869">[</span><span class="ident" id="5886870"><a href="/go/ast/commentmap.go.html#5886805">i</a></span><span class="op" id="5886871">-</span><span class="num" id="5886872">1</span><span class="op" id="5886873">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5886877"><a href="/go/ast/commentmap.go.html#5886805">i</a></span><span class="op" id="5886878">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5886882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5886885">*</span><span class="ident" id="5886886"><a href="/go/ast/commentmap.go.html#5886758">s</a></span>&nbsp;<span class="op" id="5886888">=</span>&nbsp;<span class="op" id="5886890">(</span><span class="op" id="5886891">*</span><span class="ident" id="5886892"><a href="/go/ast/commentmap.go.html#5886758">s</a></span><span class="op" id="5886893">)</span><span class="op" id="5886894">[</span><span class="num" id="5886895">0</span><span class="op" id="5886896">:</span><span class="ident" id="5886897"><a href="/go/ast/commentmap.go.html#5886805">i</a></span><span class="op" id="5886898">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5886901">return</span>&nbsp;<span class="ident" id="5886908"><a href="/go/ast/commentmap.go.html#5886792">top</a></span><br>
<span class="lineno">125</span><span class="op" id="5886912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5886915">//&nbsp;NewCommentMap&nbsp;creates&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;by&nbsp;associating&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="5886988">//&nbsp;of&nbsp;the&nbsp;comments&nbsp;list&nbsp;with&nbsp;the&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="5887057">//</span><br>
<span class="lineno">130</span><span class="comment" id="5887060">//&nbsp;A&nbsp;comment&nbsp;group&nbsp;g&nbsp;is&nbsp;associated&nbsp;with&nbsp;a&nbsp;node&nbsp;n&nbsp;if:</span><br>
<span class="lineno"></span><span class="comment" id="5887113">//</span><br>
<span class="lineno"></span><span class="comment" id="5887116">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;n&nbsp;ends</span><br>
<span class="lineno"></span><span class="comment" id="5887159">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;following&nbsp;n,&nbsp;and&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5887225">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;least&nbsp;one&nbsp;empty&nbsp;line&nbsp;after&nbsp;g&nbsp;and&nbsp;before&nbsp;the&nbsp;next&nbsp;node</span><br>
<span class="lineno">135</span><span class="comment" id="5887289">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;before&nbsp;n&nbsp;and&nbsp;is&nbsp;not&nbsp;associated&nbsp;to&nbsp;the&nbsp;node&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="5887357">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;via&nbsp;the&nbsp;previous&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="5887387">//</span><br>
<span class="lineno"></span><span class="comment" id="5887390">//&nbsp;NewCommentMap&nbsp;tries&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;&#34;largest&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5887459">//&nbsp;node&nbsp;possible:&nbsp;For&nbsp;instance,&nbsp;if&nbsp;the&nbsp;comment&nbsp;is&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno">140</span><span class="comment" id="5887524">//&nbsp;trailing&nbsp;an&nbsp;assignment,&nbsp;the&nbsp;comment&nbsp;is&nbsp;associated&nbsp;with&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="5887593">//&nbsp;assignment&nbsp;rather&nbsp;than&nbsp;just&nbsp;the&nbsp;last&nbsp;operand&nbsp;in&nbsp;the&nbsp;assignment.</span><br>
<span class="lineno"></span><span class="comment" id="5887660">//</span><br>
<span class="lineno"></span><span class="keyword" id="5887663">func</span>&nbsp;<span class="ident" id="5887668">NewCommentMap</span><span class="op" id="5887681">(</span><span class="ident" id="5887682">fset</span>&nbsp;<span class="op" id="5887687">*</span><span class="ident" id="5887688"><a href="/go/ast/commentmap.go.html#5883898">token</a></span><span class="op" id="5887693">.</span><span class="ident" id="5887694">FileSet</span><span class="op" id="5887701">,</span>&nbsp;<span class="ident" id="5887703">node</span>&nbsp;<span class="ident" id="5887708"><a href="/go/ast/ast.go.html#5853708">Node</a></span><span class="op" id="5887712">,</span>&nbsp;<span class="ident" id="5887714">comments</span>&nbsp;<span class="op" id="5887723">[</span><span class="op" id="5887724">]</span><span class="op" id="5887725">*</span><span class="ident" id="5887726"><a href="/go/ast/ast.go.html#5854728">CommentGroup</a></span><span class="op" id="5887738">)</span>&nbsp;<span class="ident" id="5887740"><a href="/go/ast/commentmap.go.html#5884636">CommentMap</a></span>&nbsp;<span class="op" id="5887751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5887754">if</span>&nbsp;<span class="builtinfunc" id="5887757">len</span><span class="op" id="5887760">(</span><span class="ident" id="5887761"><a href="/go/ast/commentmap.go.html#5887714">comments</a></span><span class="op" id="5887769">)</span>&nbsp;<span class="op" id="5887771">==</span>&nbsp;<span class="num" id="5887774">0</span>&nbsp;<span class="op" id="5887776">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5887780">return</span>&nbsp;<span class="ident" id="5887787">nil</span>&nbsp;<span class="comment" id="5887791">//&nbsp;no&nbsp;comments&nbsp;to&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5887814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887818">cmap</span>&nbsp;<span class="op" id="5887823">:=</span>&nbsp;<span class="builtinfunc" id="5887826">make</span><span class="op" id="5887830">(</span><span class="ident" id="5887831"><a href="/go/ast/commentmap.go.html#5884636">CommentMap</a></span><span class="op" id="5887841">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5887845">//&nbsp;set&nbsp;up&nbsp;comment&nbsp;reader&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887873">tmp</span>&nbsp;<span class="op" id="5887877">:=</span>&nbsp;<span class="builtinfunc" id="5887880">make</span><span class="op" id="5887884">(</span><span class="op" id="5887885">[</span><span class="op" id="5887886">]</span><span class="op" id="5887887">*</span><span class="ident" id="5887888"><a href="/go/ast/ast.go.html#5854728">CommentGroup</a></span><span class="op" id="5887900">,</span>&nbsp;<span class="builtinfunc" id="5887902">len</span><span class="op" id="5887905">(</span><span class="ident" id="5887906"><a href="/go/ast/commentmap.go.html#5887714">comments</a></span><span class="op" id="5887914">)</span><span class="op" id="5887915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5887918">copy</span><span class="op" id="5887922">(</span><span class="ident" id="5887923"><a href="/go/ast/commentmap.go.html#5887873">tmp</a></span><span class="op" id="5887926">,</span>&nbsp;<span class="ident" id="5887928"><a href="/go/ast/commentmap.go.html#5887714">comments</a></span><span class="op" id="5887936">)</span>&nbsp;<span class="comment" id="5887938">//&nbsp;don&#39;t&nbsp;change&nbsp;incoming&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887973"><a href="/go/ast/commentmap.go.html#5884209">sortComments</a></span><span class="op" id="5887985">(</span><span class="ident" id="5887986"><a href="/go/ast/commentmap.go.html#5887873">tmp</a></span><span class="op" id="5887989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887992">r</span>&nbsp;<span class="op" id="5887994">:=</span>&nbsp;<span class="ident" id="5887997"><a href="/go/ast/commentmap.go.html#5885788">commentListReader</a></span><span class="op" id="5888014">{</span><span class="ident" id="5888015">fset</span><span class="op" id="5888019">:</span>&nbsp;<span class="ident" id="5888021"><a href="/go/ast/commentmap.go.html#5887682">fset</a></span><span class="op" id="5888025">,</span>&nbsp;<span class="ident" id="5888027">list</span><span class="op" id="5888031">:</span>&nbsp;<span class="ident" id="5888033"><a href="/go/ast/commentmap.go.html#5887873">tmp</a></span><span class="op" id="5888036">}</span>&nbsp;<span class="comment" id="5888038">//&nbsp;!r.eol()&nbsp;because&nbsp;len(comments)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888077"><a href="/go/ast/commentmap.go.html#5887992">r</a></span><span class="op" id="5888078">.</span><span class="ident" id="5888079">next</span><span class="op" id="5888083">(</span><span class="op" id="5888084">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5888088">//&nbsp;create&nbsp;node&nbsp;list&nbsp;in&nbsp;lexical&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888126">nodes</span>&nbsp;<span class="op" id="5888132">:=</span>&nbsp;<span class="ident" id="5888135"><a href="/go/ast/commentmap.go.html#5885202">nodeList</a></span><span class="op" id="5888143">(</span><span class="ident" id="5888144"><a href="/go/ast/commentmap.go.html#5887703">node</a></span><span class="op" id="5888148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888151"><a href="/go/ast/commentmap.go.html#5888126">nodes</a></span>&nbsp;<span class="op" id="5888157">=</span>&nbsp;<span class="builtinfunc" id="5888159">append</span><span class="op" id="5888165">(</span><span class="ident" id="5888166"><a href="/go/ast/commentmap.go.html#5888126">nodes</a></span><span class="op" id="5888171">,</span>&nbsp;<span class="ident" id="5888173">nil</span><span class="op" id="5888176">)</span>&nbsp;<span class="comment" id="5888178">//&nbsp;append&nbsp;sentinel</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5888199">//&nbsp;set&nbsp;up&nbsp;iteration&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5888230">var</span>&nbsp;<span class="op" id="5888234">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888238">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888244"><a href="/go/ast/ast.go.html#5853708">Node</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5888259">//&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888278">pend</span>&nbsp;&nbsp;<span class="ident" id="5888284"><a href="/go/ast/commentmap.go.html#5883898">token</a></span><span class="op" id="5888289">.</span><span class="ident" id="5888290">Position</span>&nbsp;<span class="comment" id="5888299">//&nbsp;end&nbsp;of&nbsp;p</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888313">pg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888319"><a href="/go/ast/ast.go.html#5853708">Node</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5888334">//&nbsp;previous&nbsp;node&nbsp;group&nbsp;(enclosing&nbsp;nodes&nbsp;of&nbsp;&#34;importance&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888393">pgend</span>&nbsp;<span class="ident" id="5888399"><a href="/go/ast/commentmap.go.html#5883898">token</a></span><span class="op" id="5888404">.</span><span class="ident" id="5888405">Position</span>&nbsp;<span class="comment" id="5888414">//&nbsp;end&nbsp;of&nbsp;pg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888429">stack</span>&nbsp;<span class="ident" id="5888435"><a href="/go/ast/commentmap.go.html#5886412">nodeStack</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5888450">//&nbsp;stack&nbsp;of&nbsp;node&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5888475">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5888479">for</span>&nbsp;<span class="ident" id="5888483">_</span><span class="op" id="5888484">,</span>&nbsp;<span class="ident" id="5888486">q</span>&nbsp;<span class="op" id="5888488">:=</span>&nbsp;<span class="keyword" id="5888491">range</span>&nbsp;<span class="ident" id="5888497"><a href="/go/ast/commentmap.go.html#5888126">nodes</a></span>&nbsp;<span class="op" id="5888503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5888507">var</span>&nbsp;<span class="ident" id="5888511">qpos</span>&nbsp;<span class="ident" id="5888516"><a href="/go/ast/commentmap.go.html#5883898">token</a></span><span class="op" id="5888521">.</span><span class="ident" id="5888522">Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5888533">if</span>&nbsp;<span class="ident" id="5888536"><a href="/go/ast/commentmap.go.html#5888486">q</a></span>&nbsp;<span class="op" id="5888538">!=</span>&nbsp;<span class="ident" id="5888541">nil</span>&nbsp;<span class="op" id="5888545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888550"><a href="/go/ast/commentmap.go.html#5888511">qpos</a></span>&nbsp;<span class="op" id="5888555">=</span>&nbsp;<span class="ident" id="5888557"><a href="/go/ast/commentmap.go.html#5887682">fset</a></span><span class="op" id="5888561">.</span><span class="ident" id="5888562">Position</span><span class="op" id="5888570">(</span><span class="ident" id="5888571"><a href="/go/ast/commentmap.go.html#5888486">q</a></span><span class="op" id="5888572">.</span><span class="ident" id="5888573">Pos</span><span class="op" id="5888576">(</span><span class="op" id="5888577">)</span><span class="op" id="5888578">)</span>&nbsp;<span class="comment" id="5888580">//&nbsp;current&nbsp;node&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5888607">}</span>&nbsp;<span class="keyword" id="5888609">else</span>&nbsp;<span class="op" id="5888614">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5888619">//&nbsp;set&nbsp;fake&nbsp;sentinel&nbsp;position&nbsp;to&nbsp;infinity&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5888672">//&nbsp;all&nbsp;comments&nbsp;get&nbsp;processed&nbsp;before&nbsp;the&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5888725">const</span>&nbsp;<span class="ident" id="5888731">infinity</span>&nbsp;<span class="op" id="5888740">=</span>&nbsp;<span class="num" id="5888742">1</span>&nbsp;<span class="op" id="5888744">&lt;&lt;</span>&nbsp;<span class="num" id="5888747">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888753"><a href="/go/ast/commentmap.go.html#5888511">qpos</a></span><span class="op" id="5888757">.</span><span class="ident" id="5888758">Offset</span>&nbsp;<span class="op" id="5888765">=</span>&nbsp;<span class="ident" id="5888767"><a href="/go/ast/commentmap.go.html#5888731">infinity</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888779"><a href="/go/ast/commentmap.go.html#5888511">qpos</a></span><span class="op" id="5888783">.</span><span class="ident" id="5888784">Line</span>&nbsp;<span class="op" id="5888789">=</span>&nbsp;<span class="ident" id="5888791"><a href="/go/ast/commentmap.go.html#5888731">infinity</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5888802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5888807">//&nbsp;process&nbsp;comments&nbsp;before&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5888849">for</span>&nbsp;<span class="ident" id="5888853"><a href="/go/ast/commentmap.go.html#5887992">r</a></span><span class="op" id="5888854">.</span><span class="ident" id="5888855">end</span><span class="op" id="5888858">.</span><span class="ident" id="5888859">Offset</span>&nbsp;<span class="op" id="5888866">&lt;=</span>&nbsp;<span class="ident" id="5888869"><a href="/go/ast/commentmap.go.html#5888511">qpos</a></span><span class="op" id="5888873">.</span><span class="ident" id="5888874">Offset</span>&nbsp;<span class="op" id="5888881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5888886">//&nbsp;determine&nbsp;recent&nbsp;node&nbsp;group</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5888920">if</span>&nbsp;<span class="ident" id="5888923">top</span>&nbsp;<span class="op" id="5888927">:=</span>&nbsp;<span class="ident" id="5888930"><a href="/go/ast/commentmap.go.html#5888429">stack</a></span><span class="op" id="5888935">.</span><span class="ident" id="5888936">pop</span><span class="op" id="5888939">(</span><span class="ident" id="5888940"><a href="/go/ast/commentmap.go.html#5887992">r</a></span><span class="op" id="5888941">.</span><span class="ident" id="5888942">comment</span><span class="op" id="5888949">.</span><span class="ident" id="5888950">Pos</span><span class="op" id="5888953">(</span><span class="op" id="5888954">)</span><span class="op" id="5888955">)</span><span class="op" id="5888956">;</span>&nbsp;<span class="ident" id="5888958"><a href="/go/ast/commentmap.go.html#5888923">top</a></span>&nbsp;<span class="op" id="5888962">!=</span>&nbsp;<span class="ident" id="5888965">nil</span>&nbsp;<span class="op" id="5888969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888975"><a href="/go/ast/commentmap.go.html#5888313">pg</a></span>&nbsp;<span class="op" id="5888978">=</span>&nbsp;<span class="ident" id="5888980"><a href="/go/ast/commentmap.go.html#5888923">top</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888988"><a href="/go/ast/commentmap.go.html#5888393">pgend</a></span>&nbsp;<span class="op" id="5888994">=</span>&nbsp;<span class="ident" id="5888996"><a href="/go/ast/commentmap.go.html#5887682">fset</a></span><span class="op" id="5889000">.</span><span class="ident" id="5889001">Position</span><span class="op" id="5889009">(</span><span class="ident" id="5889010"><a href="/go/ast/commentmap.go.html#5888313">pg</a></span><span class="op" id="5889012">.</span><span class="ident" id="5889013">End</span><span class="op" id="5889016">(</span><span class="op" id="5889017">)</span><span class="op" id="5889018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5889023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5889028">//&nbsp;Try&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;first&nbsp;with&nbsp;a&nbsp;node&nbsp;group</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5889085">//&nbsp;(i.e.,&nbsp;a&nbsp;node&nbsp;of&nbsp;&#34;importance&#34;&nbsp;such&nbsp;as&nbsp;a&nbsp;declaration);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5889145">//&nbsp;if&nbsp;that&nbsp;fails,&nbsp;try&nbsp;to&nbsp;associate&nbsp;it&nbsp;with&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5889207">//&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5889219">//&nbsp;TODO(gri)&nbsp;try&nbsp;to&nbsp;simplify&nbsp;the&nbsp;logic&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5889267">var</span>&nbsp;<span class="ident" id="5889271">assoc</span>&nbsp;<span class="ident" id="5889277"><a href="/go/ast/ast.go.html#5853708">Node</a></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5889285">switch</span>&nbsp;<span class="op" id="5889292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5889297">case</span>&nbsp;<span class="ident" id="5889302"><a href="/go/ast/commentmap.go.html#5888313">pg</a></span>&nbsp;<span class="op" id="5889305">!=</span>&nbsp;<span class="ident" id="5889308">nil</span>&nbsp;<span class="op" id="5889312">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5889319">(</span><span class="ident" id="5889320"><a href="/go/ast/commentmap.go.html#5888393">pgend</a></span><span class="op" id="5889325">.</span><span class="ident" id="5889326">Line</span>&nbsp;<span class="op" id="5889331">==</span>&nbsp;<span class="ident" id="5889334"><a href="/go/ast/commentmap.go.html#5887992">r</a></span><span class="op" id="5889335">.</span><span class="ident" id="5889336">pos</span><span class="op" id="5889339">.</span><span class="ident" id="5889340">Line</span>&nbsp;<span class="op" id="5889345">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889353"><a href="/go/ast/commentmap.go.html#5888393">pgend</a></span><span class="op" id="5889358">.</span><span class="ident" id="5889359">Line</span><span class="op" id="5889363">+</span><span class="num" id="5889364">1</span>&nbsp;<span class="op" id="5889366">==</span>&nbsp;<span class="ident" id="5889369"><a href="/go/ast/commentmap.go.html#5887992">r</a></span><span class="op" id="5889370">.</span><span class="ident" id="5889371">pos</span><span class="op" id="5889374">.</span><span class="ident" id="5889375">Line</span>&nbsp;<span class="op" id="5889380">&amp;&amp;</span>&nbsp;<span class="ident" id="5889383"><a href="/go/ast/commentmap.go.html#5887992">r</a></span><span class="op" id="5889384">.</span><span class="ident" id="5889385">end</span><span class="op" id="5889388">.</span><span class="ident" id="5889389">Line</span><span class="op" id="5889393">+</span><span class="num" id="5889394">1</span>&nbsp;<span class="op" id="5889396">&lt;</span>&nbsp;<span class="ident" id="5889398"><a href="/go/ast/commentmap.go.html#5888511">qpos</a></span><span class="op" id="5889402">.</span><span class="ident" id="5889403">Line</span><span class="op" id="5889407">)</span><span class="op" id="5889408">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5889414">//&nbsp;1)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;previous&nbsp;node&nbsp;group&nbsp;ends,&nbsp;or</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5889484">//&nbsp;2)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5889543">//&nbsp;&nbsp;&nbsp;&nbsp;previous&nbsp;node&nbsp;group&nbsp;and&nbsp;there&nbsp;is&nbsp;an&nbsp;empty&nbsp;line&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5889607">//&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5889634">//&nbsp;=&gt;&nbsp;associate&nbsp;comment&nbsp;with&nbsp;previous&nbsp;node&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889687"><a href="/go/ast/commentmap.go.html#5889271">assoc</a></span>&nbsp;<span class="op" id="5889693">=</span>&nbsp;<span class="ident" id="5889695"><a href="/go/ast/commentmap.go.html#5888313">pg</a></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5889701">case</span>&nbsp;<span class="ident" id="5889706"><a href="/go/ast/commentmap.go.html#5888238">p</a></span>&nbsp;<span class="op" id="5889708">!=</span>&nbsp;<span class="ident" id="5889711">nil</span>&nbsp;<span class="op" id="5889715">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5889722">(</span><span class="ident" id="5889723"><a href="/go/ast/commentmap.go.html#5888278">pend</a></span><span class="op" id="5889727">.</span><span class="ident" id="5889728">Line</span>&nbsp;<span class="op" id="5889733">==</span>&nbsp;<span class="ident" id="5889736"><a href="/go/ast/commentmap.go.html#5887992">r</a></span><span class="op" id="5889737">.</span><span class="ident" id="5889738">pos</span><span class="op" id="5889741">.</span><span class="ident" id="5889742">Line</span>&nbsp;<span class="op" id="5889747">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889755"><a href="/go/ast/commentmap.go.html#5888278">pend</a></span><span class="op" id="5889759">.</span><span class="ident" id="5889760">Line</span><span class="op" id="5889764">+</span><span class="num" id="5889765">1</span>&nbsp;<span class="op" id="5889767">==</span>&nbsp;<span class="ident" id="5889770"><a href="/go/ast/commentmap.go.html#5887992">r</a></span><span class="op" id="5889771">.</span><span class="ident" id="5889772">pos</span><span class="op" id="5889775">.</span><span class="ident" id="5889776">Line</span>&nbsp;<span class="op" id="5889781">&amp;&amp;</span>&nbsp;<span class="ident" id="5889784"><a href="/go/ast/commentmap.go.html#5887992">r</a></span><span class="op" id="5889785">.</span><span class="ident" id="5889786">end</span><span class="op" id="5889789">.</span><span class="ident" id="5889790">Line</span><span class="op" id="5889794">+</span><span class="num" id="5889795">1</span>&nbsp;<span class="op" id="5889797">&lt;</span>&nbsp;<span class="ident" id="5889799"><a href="/go/ast/commentmap.go.html#5888511">qpos</a></span><span class="op" id="5889803">.</span><span class="ident" id="5889804">Line</span>&nbsp;<span class="op" id="5889809">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889817"><a href="/go/ast/commentmap.go.html#5888486">q</a></span>&nbsp;<span class="op" id="5889819">==</span>&nbsp;<span class="ident" id="5889822">nil</span><span class="op" id="5889825">)</span><span class="op" id="5889826">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5889832">//&nbsp;same&nbsp;rules&nbsp;apply&nbsp;as&nbsp;above&nbsp;for&nbsp;p&nbsp;rather&nbsp;than&nbsp;pg,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5889887">//&nbsp;but&nbsp;also&nbsp;associate&nbsp;with&nbsp;p&nbsp;if&nbsp;we&nbsp;are&nbsp;at&nbsp;the&nbsp;end&nbsp;(q&nbsp;==&nbsp;nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889952"><a href="/go/ast/commentmap.go.html#5889271">assoc</a></span>&nbsp;<span class="op" id="5889958">=</span>&nbsp;<span class="ident" id="5889960"><a href="/go/ast/commentmap.go.html#5888238">p</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5889965">default</span><span class="op" id="5889972">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5889978">//&nbsp;otherwise,&nbsp;associate&nbsp;comment&nbsp;with&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890032">if</span>&nbsp;<span class="ident" id="5890035"><a href="/go/ast/commentmap.go.html#5888486">q</a></span>&nbsp;<span class="op" id="5890037">==</span>&nbsp;<span class="ident" id="5890040">nil</span>&nbsp;<span class="op" id="5890044">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5890051">//&nbsp;we&nbsp;can&nbsp;only&nbsp;reach&nbsp;here&nbsp;if&nbsp;there&nbsp;was&nbsp;no&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5890100">//&nbsp;which&nbsp;would&nbsp;imply&nbsp;that&nbsp;there&nbsp;were&nbsp;no&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5890151">panic</span><span class="op" id="5890156">(</span><span class="string" id="5890157">&#34;internal&nbsp;error:&nbsp;no&nbsp;comments&nbsp;should&nbsp;be&nbsp;associated&nbsp;with&nbsp;sentinel&#34;</span><span class="op" id="5890221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5890227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890233"><a href="/go/ast/commentmap.go.html#5889271">assoc</a></span>&nbsp;<span class="op" id="5890239">=</span>&nbsp;<span class="ident" id="5890241"><a href="/go/ast/commentmap.go.html#5888486">q</a></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5890246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890251"><a href="/go/ast/commentmap.go.html#5887818">cmap</a></span><span class="op" id="5890255">.</span><span class="ident" id="5890256">addComment</span><span class="op" id="5890266">(</span><span class="ident" id="5890267"><a href="/go/ast/commentmap.go.html#5889271">assoc</a></span><span class="op" id="5890272">,</span>&nbsp;<span class="ident" id="5890274"><a href="/go/ast/commentmap.go.html#5887992">r</a></span><span class="op" id="5890275">.</span><span class="ident" id="5890276">comment</span><span class="op" id="5890283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890288">if</span>&nbsp;<span class="ident" id="5890291"><a href="/go/ast/commentmap.go.html#5887992">r</a></span><span class="op" id="5890292">.</span><span class="ident" id="5890293">eol</span><span class="op" id="5890296">(</span><span class="op" id="5890297">)</span>&nbsp;<span class="op" id="5890299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890305">return</span>&nbsp;<span class="ident" id="5890312"><a href="/go/ast/commentmap.go.html#5887818">cmap</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5890320">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890325"><a href="/go/ast/commentmap.go.html#5887992">r</a></span><span class="op" id="5890326">.</span><span class="ident" id="5890327">next</span><span class="op" id="5890331">(</span><span class="op" id="5890332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5890336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5890341">//&nbsp;update&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890367"><a href="/go/ast/commentmap.go.html#5888238">p</a></span>&nbsp;<span class="op" id="5890369">=</span>&nbsp;<span class="ident" id="5890371"><a href="/go/ast/commentmap.go.html#5888486">q</a></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890375"><a href="/go/ast/commentmap.go.html#5888278">pend</a></span>&nbsp;<span class="op" id="5890380">=</span>&nbsp;<span class="ident" id="5890382"><a href="/go/ast/commentmap.go.html#5887682">fset</a></span><span class="op" id="5890386">.</span><span class="ident" id="5890387">Position</span><span class="op" id="5890395">(</span><span class="ident" id="5890396"><a href="/go/ast/commentmap.go.html#5888238">p</a></span><span class="op" id="5890397">.</span><span class="ident" id="5890398">End</span><span class="op" id="5890401">(</span><span class="op" id="5890402">)</span><span class="op" id="5890403">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5890408">//&nbsp;update&nbsp;previous&nbsp;node&nbsp;group&nbsp;if&nbsp;we&nbsp;see&nbsp;an&nbsp;&#34;important&#34;&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890470">switch</span>&nbsp;<span class="ident" id="5890477"><a href="/go/ast/commentmap.go.html#5888486">q</a></span><span class="op" id="5890478">.</span><span class="op" id="5890479">(</span><span class="keyword" id="5890480">type</span><span class="op" id="5890484">)</span>&nbsp;<span class="op" id="5890486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890490">case</span>&nbsp;<span class="op" id="5890495">*</span><span class="ident" id="5890496"><a href="/go/ast/ast.go.html#5882563">File</a></span><span class="op" id="5890500">,</span>&nbsp;<span class="op" id="5890502">*</span><span class="ident" id="5890503"><a href="/go/ast/ast.go.html#5856952">Field</a></span><span class="op" id="5890508">,</span>&nbsp;<span class="ident" id="5890510"><a href="/go/ast/ast.go.html#5854126">Decl</a></span><span class="op" id="5890514">,</span>&nbsp;<span class="ident" id="5890516"><a href="/go/ast/ast.go.html#5878202">Spec</a></span><span class="op" id="5890520">,</span>&nbsp;<span class="ident" id="5890522"><a href="/go/ast/ast.go.html#5854028">Stmt</a></span><span class="op" id="5890526">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890531"><a href="/go/ast/commentmap.go.html#5888429">stack</a></span><span class="op" id="5890536">.</span><span class="ident" id="5890537">push</span><span class="op" id="5890541">(</span><span class="ident" id="5890542"><a href="/go/ast/commentmap.go.html#5888486">q</a></span><span class="op" id="5890543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5890547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5890550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890554">return</span>&nbsp;<span class="ident" id="5890561"><a href="/go/ast/commentmap.go.html#5887818">cmap</a></span><br>
<span class="lineno">240</span><span class="op" id="5890566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5890569">//&nbsp;Update&nbsp;replaces&nbsp;an&nbsp;old&nbsp;node&nbsp;in&nbsp;the&nbsp;comment&nbsp;map&nbsp;with&nbsp;the&nbsp;new&nbsp;node</span><br>
<span class="lineno"></span><span class="comment" id="5890637">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;node.&nbsp;Comments&nbsp;that&nbsp;were&nbsp;associated&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5890705">//&nbsp;old&nbsp;node&nbsp;are&nbsp;associated&nbsp;with&nbsp;the&nbsp;new&nbsp;node.</span><br>
<span class="lineno">245</span><span class="comment" id="5890751">//</span><br>
<span class="lineno"></span><span class="keyword" id="5890754">func</span>&nbsp;<span class="op" id="5890759">(</span><span class="ident" id="5890760">cmap</span>&nbsp;<span class="ident" id="5890765"><a href="/go/ast/commentmap.go.html#5884636">CommentMap</a></span><span class="op" id="5890775">)</span>&nbsp;<span class="ident" id="5890777">Update</span><span class="op" id="5890783">(</span><span class="ident" id="5890784">old</span><span class="op" id="5890787">,</span>&nbsp;<span class="builtinfunc" id="5890789">new</span>&nbsp;<span class="ident" id="5890793"><a href="/go/ast/ast.go.html#5853708">Node</a></span><span class="op" id="5890797">)</span>&nbsp;<span class="ident" id="5890799"><a href="/go/ast/ast.go.html#5853708">Node</a></span>&nbsp;<span class="op" id="5890804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890807">if</span>&nbsp;<span class="ident" id="5890810">list</span>&nbsp;<span class="op" id="5890815">:=</span>&nbsp;<span class="ident" id="5890818"><a href="/go/ast/commentmap.go.html#5890760">cmap</a></span><span class="op" id="5890822">[</span><span class="ident" id="5890823"><a href="/go/ast/commentmap.go.html#5890784">old</a></span><span class="op" id="5890826">]</span><span class="op" id="5890827">;</span>&nbsp;<span class="builtinfunc" id="5890829">len</span><span class="op" id="5890832">(</span><span class="ident" id="5890833"><a href="/go/ast/commentmap.go.html#5890810">list</a></span><span class="op" id="5890837">)</span>&nbsp;<span class="op" id="5890839">&gt;</span>&nbsp;<span class="num" id="5890841">0</span>&nbsp;<span class="op" id="5890843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5890847">delete</span><span class="op" id="5890853">(</span><span class="ident" id="5890854"><a href="/go/ast/commentmap.go.html#5890760">cmap</a></span><span class="op" id="5890858">,</span>&nbsp;<span class="ident" id="5890860"><a href="/go/ast/commentmap.go.html#5890784">old</a></span><span class="op" id="5890863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890867"><a href="/go/ast/commentmap.go.html#5890760">cmap</a></span><span class="op" id="5890871">[</span><span class="builtinfunc" id="5890872"><a href="/go/ast/commentmap.go.html#5890789">new</a></span><span class="op" id="5890875">]</span>&nbsp;<span class="op" id="5890877">=</span>&nbsp;<span class="builtinfunc" id="5890879">append</span><span class="op" id="5890885">(</span><span class="ident" id="5890886"><a href="/go/ast/commentmap.go.html#5890760">cmap</a></span><span class="op" id="5890890">[</span><span class="builtinfunc" id="5890891"><a href="/go/ast/commentmap.go.html#5890789">new</a></span><span class="op" id="5890894">]</span><span class="op" id="5890895">,</span>&nbsp;<span class="ident" id="5890897"><a href="/go/ast/commentmap.go.html#5890810">list</a></span><span class="op" id="5890901">...</span><span class="op" id="5890904">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5890907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890910">return</span>&nbsp;<span class="builtinfunc" id="5890917"><a href="/go/ast/commentmap.go.html#5890789">new</a></span><br>
<span class="lineno"></span><span class="op" id="5890921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5890924">//&nbsp;Filter&nbsp;returns&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;consisting&nbsp;of&nbsp;only&nbsp;those</span><br>
<span class="lineno">255</span><span class="comment" id="5890985">//&nbsp;entries&nbsp;of&nbsp;cmap&nbsp;for&nbsp;which&nbsp;a&nbsp;corresponding&nbsp;node&nbsp;exists&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5891045">//&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="5891075">//</span><br>
<span class="lineno"></span><span class="keyword" id="5891078">func</span>&nbsp;<span class="op" id="5891083">(</span><span class="ident" id="5891084">cmap</span>&nbsp;<span class="ident" id="5891089"><a href="/go/ast/commentmap.go.html#5884636">CommentMap</a></span><span class="op" id="5891099">)</span>&nbsp;<span class="ident" id="5891101">Filter</span><span class="op" id="5891107">(</span><span class="ident" id="5891108">node</span>&nbsp;<span class="ident" id="5891113"><a href="/go/ast/ast.go.html#5853708">Node</a></span><span class="op" id="5891117">)</span>&nbsp;<span class="ident" id="5891119"><a href="/go/ast/commentmap.go.html#5884636">CommentMap</a></span>&nbsp;<span class="op" id="5891130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5891133">umap</span>&nbsp;<span class="op" id="5891138">:=</span>&nbsp;<span class="builtinfunc" id="5891141">make</span><span class="op" id="5891145">(</span><span class="ident" id="5891146"><a href="/go/ast/commentmap.go.html#5884636">CommentMap</a></span><span class="op" id="5891156">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5891159"><a href="/go/ast/walk.go.html#5932125">Inspect</a></span><span class="op" id="5891166">(</span><span class="ident" id="5891167"><a href="/go/ast/commentmap.go.html#5891108">node</a></span><span class="op" id="5891171">,</span>&nbsp;<span class="keyword" id="5891173">func</span><span class="op" id="5891177">(</span><span class="ident" id="5891178">n</span>&nbsp;<span class="ident" id="5891180"><a href="/go/ast/ast.go.html#5853708">Node</a></span><span class="op" id="5891184">)</span>&nbsp;<span class="builtintype" id="5891186">bool</span>&nbsp;<span class="op" id="5891191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891195">if</span>&nbsp;<span class="ident" id="5891198">g</span>&nbsp;<span class="op" id="5891200">:=</span>&nbsp;<span class="ident" id="5891203"><a href="/go/ast/commentmap.go.html#5891084">cmap</a></span><span class="op" id="5891207">[</span><span class="ident" id="5891208"><a href="/go/ast/commentmap.go.html#5891178">n</a></span><span class="op" id="5891209">]</span><span class="op" id="5891210">;</span>&nbsp;<span class="builtinfunc" id="5891212">len</span><span class="op" id="5891215">(</span><span class="ident" id="5891216"><a href="/go/ast/commentmap.go.html#5891198">g</a></span><span class="op" id="5891217">)</span>&nbsp;<span class="op" id="5891219">&gt;</span>&nbsp;<span class="num" id="5891221">0</span>&nbsp;<span class="op" id="5891223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5891228"><a href="/go/ast/commentmap.go.html#5891133">umap</a></span><span class="op" id="5891232">[</span><span class="ident" id="5891233"><a href="/go/ast/commentmap.go.html#5891178">n</a></span><span class="op" id="5891234">]</span>&nbsp;<span class="op" id="5891236">=</span>&nbsp;<span class="ident" id="5891238"><a href="/go/ast/commentmap.go.html#5891198">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5891242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891246">return</span>&nbsp;<span class="ident" id="5891253">true</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5891259">}</span><span class="op" id="5891260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891263">return</span>&nbsp;<span class="ident" id="5891270"><a href="/go/ast/commentmap.go.html#5891133">umap</a></span><br>
<span class="lineno"></span><span class="op" id="5891275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5891278">//&nbsp;Comments&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;the&nbsp;comment&nbsp;map.</span><br>
<span class="lineno">270</span><span class="comment" id="5891345">//&nbsp;The&nbsp;result&nbsp;is&nbsp;sorted&nbsp;is&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="5891386">//</span><br>
<span class="lineno"></span><span class="keyword" id="5891389">func</span>&nbsp;<span class="op" id="5891394">(</span><span class="ident" id="5891395">cmap</span>&nbsp;<span class="ident" id="5891400"><a href="/go/ast/commentmap.go.html#5884636">CommentMap</a></span><span class="op" id="5891410">)</span>&nbsp;<span class="ident" id="5891412">Comments</span><span class="op" id="5891420">(</span><span class="op" id="5891421">)</span>&nbsp;<span class="op" id="5891423">[</span><span class="op" id="5891424">]</span><span class="op" id="5891425">*</span><span class="ident" id="5891426"><a href="/go/ast/ast.go.html#5854728">CommentGroup</a></span>&nbsp;<span class="op" id="5891439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5891442">list</span>&nbsp;<span class="op" id="5891447">:=</span>&nbsp;<span class="builtinfunc" id="5891450">make</span><span class="op" id="5891454">(</span><span class="op" id="5891455">[</span><span class="op" id="5891456">]</span><span class="op" id="5891457">*</span><span class="ident" id="5891458"><a href="/go/ast/ast.go.html#5854728">CommentGroup</a></span><span class="op" id="5891470">,</span>&nbsp;<span class="num" id="5891472">0</span><span class="op" id="5891473">,</span>&nbsp;<span class="builtinfunc" id="5891475">len</span><span class="op" id="5891478">(</span><span class="ident" id="5891479"><a href="/go/ast/commentmap.go.html#5891395">cmap</a></span><span class="op" id="5891483">)</span><span class="op" id="5891484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891487">for</span>&nbsp;<span class="ident" id="5891491">_</span><span class="op" id="5891492">,</span>&nbsp;<span class="ident" id="5891494">e</span>&nbsp;<span class="op" id="5891496">:=</span>&nbsp;<span class="keyword" id="5891499">range</span>&nbsp;<span class="ident" id="5891505"><a href="/go/ast/commentmap.go.html#5891395">cmap</a></span>&nbsp;<span class="op" id="5891510">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5891514"><a href="/go/ast/commentmap.go.html#5891442">list</a></span>&nbsp;<span class="op" id="5891519">=</span>&nbsp;<span class="builtinfunc" id="5891521">append</span><span class="op" id="5891527">(</span><span class="ident" id="5891528"><a href="/go/ast/commentmap.go.html#5891442">list</a></span><span class="op" id="5891532">,</span>&nbsp;<span class="ident" id="5891534"><a href="/go/ast/commentmap.go.html#5891494">e</a></span><span class="op" id="5891535">...</span><span class="op" id="5891538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5891541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5891544"><a href="/go/ast/commentmap.go.html#5884209">sortComments</a></span><span class="op" id="5891556">(</span><span class="ident" id="5891557"><a href="/go/ast/commentmap.go.html#5891442">list</a></span><span class="op" id="5891561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891564">return</span>&nbsp;<span class="ident" id="5891571"><a href="/go/ast/commentmap.go.html#5891442">list</a></span><br>
<span class="lineno"></span><span class="op" id="5891576">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="5891579">func</span>&nbsp;<span class="ident" id="5891584">summary</span><span class="op" id="5891591">(</span><span class="ident" id="5891592">list</span>&nbsp;<span class="op" id="5891597">[</span><span class="op" id="5891598">]</span><span class="op" id="5891599">*</span><span class="ident" id="5891600"><a href="/go/ast/ast.go.html#5854728">CommentGroup</a></span><span class="op" id="5891612">)</span>&nbsp;<span class="builtintype" id="5891614">string</span>&nbsp;<span class="op" id="5891621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891624">const</span>&nbsp;<span class="ident" id="5891630">maxLen</span>&nbsp;<span class="op" id="5891637">=</span>&nbsp;<span class="num" id="5891639">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891643">var</span>&nbsp;<span class="ident" id="5891647">buf</span>&nbsp;<span class="ident" id="5891651"><a href="/go/ast/commentmap.go.html#5883882">bytes</a></span><span class="op" id="5891656">.</span><span class="ident" id="5891657">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5891666">//&nbsp;collect&nbsp;comments&nbsp;text</span><br>
<span class="lineno"></span><span class="ident" id="5891691">loop</span><span class="op" id="5891695">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891698">for</span>&nbsp;<span class="ident" id="5891702">_</span><span class="op" id="5891703">,</span>&nbsp;<span class="ident" id="5891705">group</span>&nbsp;<span class="op" id="5891711">:=</span>&nbsp;<span class="keyword" id="5891714">range</span>&nbsp;<span class="ident" id="5891720"><a href="/go/ast/commentmap.go.html#5891592">list</a></span>&nbsp;<span class="op" id="5891725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5891729">//&nbsp;Note:&nbsp;CommentGroup.Text()&nbsp;does&nbsp;too&nbsp;much&nbsp;work&nbsp;for&nbsp;what&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5891791">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;need&nbsp;and&nbsp;would&nbsp;only&nbsp;replace&nbsp;this&nbsp;innermost&nbsp;loop.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5891851">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Just&nbsp;do&nbsp;it&nbsp;explicitly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891885">for</span>&nbsp;<span class="ident" id="5891889">_</span><span class="op" id="5891890">,</span>&nbsp;<span class="ident" id="5891892">comment</span>&nbsp;<span class="op" id="5891900">:=</span>&nbsp;<span class="keyword" id="5891903">range</span>&nbsp;<span class="ident" id="5891909"><a href="/go/ast/commentmap.go.html#5891705">group</a></span><span class="op" id="5891914">.</span><span class="ident" id="5891915">List</span>&nbsp;<span class="op" id="5891920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891925">if</span>&nbsp;<span class="ident" id="5891928"><a href="/go/ast/commentmap.go.html#5891647">buf</a></span><span class="op" id="5891931">.</span><span class="ident" id="5891932">Len</span><span class="op" id="5891935">(</span><span class="op" id="5891936">)</span>&nbsp;<span class="op" id="5891938">&gt;=</span>&nbsp;<span class="ident" id="5891941"><a href="/go/ast/commentmap.go.html#5891630">maxLen</a></span>&nbsp;<span class="op" id="5891948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891954">break</span>&nbsp;<span class="ident" id="5891960">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5891968">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5891973"><a href="/go/ast/commentmap.go.html#5891647">buf</a></span><span class="op" id="5891976">.</span><span class="ident" id="5891977">WriteString</span><span class="op" id="5891988">(</span><span class="ident" id="5891989"><a href="/go/ast/commentmap.go.html#5891892">comment</a></span><span class="op" id="5891996">.</span><span class="ident" id="5891997">Text</span><span class="op" id="5892001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5892005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5892008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5892012">//&nbsp;truncate&nbsp;if&nbsp;too&nbsp;long</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892037">if</span>&nbsp;<span class="ident" id="5892040"><a href="/go/ast/commentmap.go.html#5891647">buf</a></span><span class="op" id="5892043">.</span><span class="ident" id="5892044">Len</span><span class="op" id="5892047">(</span><span class="op" id="5892048">)</span>&nbsp;<span class="op" id="5892050">&gt;</span>&nbsp;<span class="ident" id="5892052"><a href="/go/ast/commentmap.go.html#5891630">maxLen</a></span>&nbsp;<span class="op" id="5892059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892063"><a href="/go/ast/commentmap.go.html#5891647">buf</a></span><span class="op" id="5892066">.</span><span class="ident" id="5892067">Truncate</span><span class="op" id="5892075">(</span><span class="ident" id="5892076"><a href="/go/ast/commentmap.go.html#5891630">maxLen</a></span>&nbsp;<span class="op" id="5892083">-</span>&nbsp;<span class="num" id="5892085">3</span><span class="op" id="5892086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892090"><a href="/go/ast/commentmap.go.html#5891647">buf</a></span><span class="op" id="5892093">.</span><span class="ident" id="5892094">WriteString</span><span class="op" id="5892105">(</span><span class="string" id="5892106">&#34;...&#34;</span><span class="op" id="5892111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5892114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5892118">//&nbsp;replace&nbsp;any&nbsp;invisibles&nbsp;with&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892157">bytes</span>&nbsp;<span class="op" id="5892163">:=</span>&nbsp;<span class="ident" id="5892166"><a href="/go/ast/commentmap.go.html#5891647">buf</a></span><span class="op" id="5892169">.</span><span class="ident" id="5892170">Bytes</span><span class="op" id="5892175">(</span><span class="op" id="5892176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892179">for</span>&nbsp;<span class="ident" id="5892183">i</span><span class="op" id="5892184">,</span>&nbsp;<span class="ident" id="5892186">b</span>&nbsp;<span class="op" id="5892188">:=</span>&nbsp;<span class="keyword" id="5892191">range</span>&nbsp;<span class="ident" id="5892197"><a href="/go/ast/commentmap.go.html#5892157">bytes</a></span>&nbsp;<span class="op" id="5892203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892207">switch</span>&nbsp;<span class="ident" id="5892214"><a href="/go/ast/commentmap.go.html#5892186">b</a></span>&nbsp;<span class="op" id="5892216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892220">case</span>&nbsp;<span class="string" id="5892225">&#39;\t&#39;</span><span class="op" id="5892229">,</span>&nbsp;<span class="string" id="5892231">&#39;\n&#39;</span><span class="op" id="5892235">,</span>&nbsp;<span class="string" id="5892237">&#39;\r&#39;</span><span class="op" id="5892241">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892246"><a href="/go/ast/commentmap.go.html#5892157">bytes</a></span><span class="op" id="5892251">[</span><span class="ident" id="5892252"><a href="/go/ast/commentmap.go.html#5892183">i</a></span><span class="op" id="5892253">]</span>&nbsp;<span class="op" id="5892255">=</span>&nbsp;<span class="string" id="5892257">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5892263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5892266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892270">return</span>&nbsp;<span class="builtintype" id="5892277">string</span><span class="op" id="5892283">(</span><span class="ident" id="5892284"><a href="/go/ast/commentmap.go.html#5892157">bytes</a></span><span class="op" id="5892289">)</span><br>
<span class="lineno">315</span><span class="op" id="5892291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5892294">func</span>&nbsp;<span class="op" id="5892299">(</span><span class="ident" id="5892300">cmap</span>&nbsp;<span class="ident" id="5892305"><a href="/go/ast/commentmap.go.html#5884636">CommentMap</a></span><span class="op" id="5892315">)</span>&nbsp;<span class="ident" id="5892317">String</span><span class="op" id="5892323">(</span><span class="op" id="5892324">)</span>&nbsp;<span class="builtintype" id="5892326">string</span>&nbsp;<span class="op" id="5892333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892336">var</span>&nbsp;<span class="ident" id="5892340">buf</span>&nbsp;<span class="ident" id="5892344"><a href="/go/ast/commentmap.go.html#5883882">bytes</a></span><span class="op" id="5892349">.</span><span class="ident" id="5892350">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892358"><a href="/go/ast/commentmap.go.html#5883891">fmt</a></span><span class="op" id="5892361">.</span><span class="ident" id="5892362">Fprintln</span><span class="op" id="5892370">(</span><span class="op" id="5892371">&amp;</span><span class="ident" id="5892372"><a href="/go/ast/commentmap.go.html#5892340">buf</a></span><span class="op" id="5892375">,</span>&nbsp;<span class="string" id="5892377">&#34;CommentMap&nbsp;{&#34;</span><span class="op" id="5892391">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892394">for</span>&nbsp;<span class="ident" id="5892398">node</span><span class="op" id="5892402">,</span>&nbsp;<span class="ident" id="5892404">comment</span>&nbsp;<span class="op" id="5892412">:=</span>&nbsp;<span class="keyword" id="5892415">range</span>&nbsp;<span class="ident" id="5892421"><a href="/go/ast/commentmap.go.html#5892300">cmap</a></span>&nbsp;<span class="op" id="5892426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5892430">//&nbsp;print&nbsp;name&nbsp;of&nbsp;identifiers;&nbsp;print&nbsp;node&nbsp;type&nbsp;for&nbsp;other&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892494">var</span>&nbsp;<span class="ident" id="5892498">s</span>&nbsp;<span class="builtintype" id="5892500">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892509">if</span>&nbsp;<span class="ident" id="5892512">ident</span><span class="op" id="5892517">,</span>&nbsp;<span class="ident" id="5892519">ok</span>&nbsp;<span class="op" id="5892522">:=</span>&nbsp;<span class="ident" id="5892525"><a href="/go/ast/commentmap.go.html#5892398">node</a></span><span class="op" id="5892529">.</span><span class="op" id="5892530">(</span><span class="op" id="5892531">*</span><span class="ident" id="5892532"><a href="/go/ast/ast.go.html#5858933">Ident</a></span><span class="op" id="5892537">)</span><span class="op" id="5892538">;</span>&nbsp;<span class="ident" id="5892540"><a href="/go/ast/commentmap.go.html#5892519">ok</a></span>&nbsp;<span class="op" id="5892543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892548"><a href="/go/ast/commentmap.go.html#5892498">s</a></span>&nbsp;<span class="op" id="5892550">=</span>&nbsp;<span class="ident" id="5892552"><a href="/go/ast/commentmap.go.html#5892512">ident</a></span><span class="op" id="5892557">.</span><span class="ident" id="5892558">Name</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5892565">}</span>&nbsp;<span class="keyword" id="5892567">else</span>&nbsp;<span class="op" id="5892572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892577"><a href="/go/ast/commentmap.go.html#5892498">s</a></span>&nbsp;<span class="op" id="5892579">=</span>&nbsp;<span class="ident" id="5892581"><a href="/go/ast/commentmap.go.html#5883891">fmt</a></span><span class="op" id="5892584">.</span><span class="ident" id="5892585">Sprintf</span><span class="op" id="5892592">(</span><span class="string" id="5892593">&#34;%T&#34;</span><span class="op" id="5892597">,</span>&nbsp;<span class="ident" id="5892599"><a href="/go/ast/commentmap.go.html#5892398">node</a></span><span class="op" id="5892603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5892607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892611"><a href="/go/ast/commentmap.go.html#5883891">fmt</a></span><span class="op" id="5892614">.</span><span class="ident" id="5892615">Fprintf</span><span class="op" id="5892622">(</span><span class="op" id="5892623">&amp;</span><span class="ident" id="5892624"><a href="/go/ast/commentmap.go.html#5892340">buf</a></span><span class="op" id="5892627">,</span>&nbsp;<span class="string" id="5892629">&#34;\t%p&nbsp;&nbsp;%20s:&nbsp;&nbsp;%s\n&#34;</span><span class="op" id="5892648">,</span>&nbsp;<span class="ident" id="5892650"><a href="/go/ast/commentmap.go.html#5892398">node</a></span><span class="op" id="5892654">,</span>&nbsp;<span class="ident" id="5892656"><a href="/go/ast/commentmap.go.html#5892498">s</a></span><span class="op" id="5892657">,</span>&nbsp;<span class="ident" id="5892659"><a href="/go/ast/commentmap.go.html#5891584">summary</a></span><span class="op" id="5892666">(</span><span class="ident" id="5892667"><a href="/go/ast/commentmap.go.html#5892404">comment</a></span><span class="op" id="5892674">)</span><span class="op" id="5892675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5892678">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892681"><a href="/go/ast/commentmap.go.html#5883891">fmt</a></span><span class="op" id="5892684">.</span><span class="ident" id="5892685">Fprintln</span><span class="op" id="5892693">(</span><span class="op" id="5892694">&amp;</span><span class="ident" id="5892695"><a href="/go/ast/commentmap.go.html#5892340">buf</a></span><span class="op" id="5892698">,</span>&nbsp;<span class="string" id="5892700">&#34;}&#34;</span><span class="op" id="5892703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892706">return</span>&nbsp;<span class="ident" id="5892713"><a href="/go/ast/commentmap.go.html#5892340">buf</a></span><span class="op" id="5892716">.</span><span class="ident" id="5892717">String</span><span class="op" id="5892723">(</span><span class="op" id="5892724">)</span><br>
<span class="lineno"></span><span class="op" id="5892726">}</span>
</div>
</body>
</html>
