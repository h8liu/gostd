<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3357658">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3357713">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3357767">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3357818">package</span>&nbsp;<span class="ident" id="3357826">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3357836">import</span>&nbsp;<span class="op" id="3357843">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3357846">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3357855">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3357862">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3357872">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3357875">//&nbsp;urlFilter&nbsp;returns&nbsp;its&nbsp;input&nbsp;unless&nbsp;it&nbsp;contains&nbsp;an&nbsp;unsafe&nbsp;protocol&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="3357953">//&nbsp;case&nbsp;it&nbsp;defangs&nbsp;the&nbsp;entire&nbsp;URL.</span><br>
<span class="lineno">15</span><span class="keyword" id="3357988">func</span>&nbsp;<span class="ident" id="3357993">urlFilter</span><span class="op" id="3358002">(</span><span class="ident" id="3358003">args</span>&nbsp;<span class="op" id="3358008">...</span><span class="keyword" id="3358011">interface</span><span class="op" id="3358020">{</span><span class="op" id="3358021">}</span><span class="op" id="3358022">)</span>&nbsp;<span class="builtintype" id="3358024">string</span>&nbsp;<span class="op" id="3358031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358034">s</span><span class="op" id="3358035">,</span>&nbsp;<span class="ident" id="3358037">t</span>&nbsp;<span class="op" id="3358039">:=</span>&nbsp;<span class="ident" id="3358042"><a href="/html/template/content.go.html#3256165">stringify</a></span><span class="op" id="3358051">(</span><span class="ident" id="3358052"><a href="/html/template/url.go.html#3358003">args</a></span><span class="op" id="3358056">...</span><span class="op" id="3358059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358062">if</span>&nbsp;<span class="ident" id="3358065"><a href="/html/template/url.go.html#3358037">t</a></span>&nbsp;<span class="op" id="3358067">==</span>&nbsp;<span class="ident" id="3358070"><a href="/html/template/content.go.html#3254768">contentTypeURL</a></span>&nbsp;<span class="op" id="3358085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358089">return</span>&nbsp;<span class="ident" id="3358096"><a href="/html/template/url.go.html#3358034">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3358099">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358102">if</span>&nbsp;<span class="ident" id="3358105">i</span>&nbsp;<span class="op" id="3358107">:=</span>&nbsp;<span class="ident" id="3358110"><a href="/html/template/url.go.html#3357862">strings</a></span><span class="op" id="3358117">.</span><span class="ident" id="3358118">IndexRune</span><span class="op" id="3358127">(</span><span class="ident" id="3358128"><a href="/html/template/url.go.html#3358034">s</a></span><span class="op" id="3358129">,</span>&nbsp;<span class="string" id="3358131">&#39;:&#39;</span><span class="op" id="3358134">)</span><span class="op" id="3358135">;</span>&nbsp;<span class="ident" id="3358137"><a href="/html/template/url.go.html#3358105">i</a></span>&nbsp;<span class="op" id="3358139">&gt;=</span>&nbsp;<span class="num" id="3358142">0</span>&nbsp;<span class="op" id="3358144">&amp;&amp;</span>&nbsp;<span class="ident" id="3358147"><a href="/html/template/url.go.html#3357862">strings</a></span><span class="op" id="3358154">.</span><span class="ident" id="3358155">IndexRune</span><span class="op" id="3358164">(</span><span class="ident" id="3358165"><a href="/html/template/url.go.html#3358034">s</a></span><span class="op" id="3358166">[</span><span class="op" id="3358167">:</span><span class="ident" id="3358168"><a href="/html/template/url.go.html#3358105">i</a></span><span class="op" id="3358169">]</span><span class="op" id="3358170">,</span>&nbsp;<span class="string" id="3358172">&#39;/&#39;</span><span class="op" id="3358175">)</span>&nbsp;<span class="op" id="3358177">&lt;</span>&nbsp;<span class="num" id="3358179">0</span>&nbsp;<span class="op" id="3358181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358185">protocol</span>&nbsp;<span class="op" id="3358194">:=</span>&nbsp;<span class="ident" id="3358197"><a href="/html/template/url.go.html#3357862">strings</a></span><span class="op" id="3358204">.</span><span class="ident" id="3358205">ToLower</span><span class="op" id="3358212">(</span><span class="ident" id="3358213"><a href="/html/template/url.go.html#3358034">s</a></span><span class="op" id="3358214">[</span><span class="op" id="3358215">:</span><span class="ident" id="3358216"><a href="/html/template/url.go.html#3358105">i</a></span><span class="op" id="3358217">]</span><span class="op" id="3358218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358222">if</span>&nbsp;<span class="ident" id="3358225"><a href="/html/template/url.go.html#3358185">protocol</a></span>&nbsp;<span class="op" id="3358234">!=</span>&nbsp;<span class="string" id="3358237">&#34;http&#34;</span>&nbsp;<span class="op" id="3358244">&amp;&amp;</span>&nbsp;<span class="ident" id="3358247"><a href="/html/template/url.go.html#3358185">protocol</a></span>&nbsp;<span class="op" id="3358256">!=</span>&nbsp;<span class="string" id="3358259">&#34;https&#34;</span>&nbsp;<span class="op" id="3358267">&amp;&amp;</span>&nbsp;<span class="ident" id="3358270"><a href="/html/template/url.go.html#3358185">protocol</a></span>&nbsp;<span class="op" id="3358279">!=</span>&nbsp;<span class="string" id="3358282">&#34;mailto&#34;</span>&nbsp;<span class="op" id="3358291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358296">return</span>&nbsp;<span class="string" id="3358303">&#34;#&#34;</span>&nbsp;<span class="op" id="3358307">+</span>&nbsp;<span class="ident" id="3358309"><a href="/html/template/escape.go.html#3291940">filterFailsafe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3358326">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3358329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358332">return</span>&nbsp;<span class="ident" id="3358339"><a href="/html/template/url.go.html#3358034">s</a></span><br>
<span class="lineno"></span><span class="op" id="3358341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3358344">//&nbsp;urlEscaper&nbsp;produces&nbsp;an&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno">30</span><span class="comment" id="3358414">//&nbsp;The&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;without&nbsp;further&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="keyword" id="3358491">func</span>&nbsp;<span class="ident" id="3358496">urlEscaper</span><span class="op" id="3358506">(</span><span class="ident" id="3358507">args</span>&nbsp;<span class="op" id="3358512">...</span><span class="keyword" id="3358515">interface</span><span class="op" id="3358524">{</span><span class="op" id="3358525">}</span><span class="op" id="3358526">)</span>&nbsp;<span class="builtintype" id="3358528">string</span>&nbsp;<span class="op" id="3358535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358538">return</span>&nbsp;<span class="ident" id="3358545"><a href="/html/template/url.go.html#3359093">urlProcessor</a></span><span class="op" id="3358557">(</span><span class="ident" id="3358558">false</span><span class="op" id="3358563">,</span>&nbsp;<span class="ident" id="3358565"><a href="/html/template/url.go.html#3358507">args</a></span><span class="op" id="3358569">...</span><span class="op" id="3358572">)</span><br>
<span class="lineno"></span><span class="op" id="3358574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3358577">//&nbsp;urlEscaper&nbsp;normalizes&nbsp;URL&nbsp;content&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;a&nbsp;quote-delimited</span><br>
<span class="lineno"></span><span class="comment" id="3358657">//&nbsp;string&nbsp;or&nbsp;parenthesis&nbsp;delimited&nbsp;url(...).</span><br>
<span class="lineno"></span><span class="comment" id="3358702">//&nbsp;The&nbsp;normalizer&nbsp;does&nbsp;not&nbsp;encode&nbsp;all&nbsp;HTML&nbsp;specials.&nbsp;Specifically,&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3358781">//&nbsp;encode&nbsp;&#39;&amp;&#39;&nbsp;so&nbsp;correct&nbsp;embedding&nbsp;in&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;requires&nbsp;escaping&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3358858">//&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;&#39;&amp;amp;&#39;.</span><br>
<span class="lineno">40</span><span class="keyword" id="3358877">func</span>&nbsp;<span class="ident" id="3358882">urlNormalizer</span><span class="op" id="3358895">(</span><span class="ident" id="3358896">args</span>&nbsp;<span class="op" id="3358901">...</span><span class="keyword" id="3358904">interface</span><span class="op" id="3358913">{</span><span class="op" id="3358914">}</span><span class="op" id="3358915">)</span>&nbsp;<span class="builtintype" id="3358917">string</span>&nbsp;<span class="op" id="3358924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358927">return</span>&nbsp;<span class="ident" id="3358934"><a href="/html/template/url.go.html#3359093">urlProcessor</a></span><span class="op" id="3358946">(</span><span class="ident" id="3358947">true</span><span class="op" id="3358951">,</span>&nbsp;<span class="ident" id="3358953"><a href="/html/template/url.go.html#3358896">args</a></span><span class="op" id="3358957">...</span><span class="op" id="3358960">)</span><br>
<span class="lineno"></span><span class="op" id="3358962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3358965">//&nbsp;urlProcessor&nbsp;normalizes&nbsp;(when&nbsp;norm&nbsp;is&nbsp;true)&nbsp;or&nbsp;escapes&nbsp;its&nbsp;input&nbsp;to&nbsp;produce</span><br>
<span class="lineno">45</span><span class="comment" id="3359044">//&nbsp;a&nbsp;valid&nbsp;hierarchical&nbsp;or&nbsp;opaque&nbsp;URL&nbsp;part.</span><br>
<span class="lineno"></span><span class="keyword" id="3359088">func</span>&nbsp;<span class="ident" id="3359093">urlProcessor</span><span class="op" id="3359105">(</span><span class="ident" id="3359106">norm</span>&nbsp;<span class="builtintype" id="3359111">bool</span><span class="op" id="3359115">,</span>&nbsp;<span class="ident" id="3359117">args</span>&nbsp;<span class="op" id="3359122">...</span><span class="keyword" id="3359125">interface</span><span class="op" id="3359134">{</span><span class="op" id="3359135">}</span><span class="op" id="3359136">)</span>&nbsp;<span class="builtintype" id="3359138">string</span>&nbsp;<span class="op" id="3359145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359148">s</span><span class="op" id="3359149">,</span>&nbsp;<span class="ident" id="3359151">t</span>&nbsp;<span class="op" id="3359153">:=</span>&nbsp;<span class="ident" id="3359156"><a href="/html/template/content.go.html#3256165">stringify</a></span><span class="op" id="3359165">(</span><span class="ident" id="3359166"><a href="/html/template/url.go.html#3359117">args</a></span><span class="op" id="3359170">...</span><span class="op" id="3359173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359176">if</span>&nbsp;<span class="ident" id="3359179"><a href="/html/template/url.go.html#3359151">t</a></span>&nbsp;<span class="op" id="3359181">==</span>&nbsp;<span class="ident" id="3359184"><a href="/html/template/content.go.html#3254768">contentTypeURL</a></span>&nbsp;<span class="op" id="3359199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359203"><a href="/html/template/url.go.html#3359106">norm</a></span>&nbsp;<span class="op" id="3359208">=</span>&nbsp;<span class="ident" id="3359210">true</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3359216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359219">var</span>&nbsp;<span class="ident" id="3359223">b</span>&nbsp;<span class="ident" id="3359225"><a href="/html/template/url.go.html#3357846">bytes</a></span><span class="op" id="3359230">.</span><span class="ident" id="3359231">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359239">written</span>&nbsp;<span class="op" id="3359247">:=</span>&nbsp;<span class="num" id="3359250">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359253">//&nbsp;The&nbsp;byte&nbsp;loop&nbsp;below&nbsp;assumes&nbsp;that&nbsp;all&nbsp;URLs&nbsp;use&nbsp;UTF-8&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359316">//&nbsp;content-encoding.&nbsp;This&nbsp;is&nbsp;similar&nbsp;to&nbsp;the&nbsp;URI&nbsp;to&nbsp;IRI&nbsp;encoding&nbsp;scheme</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359388">//&nbsp;defined&nbsp;in&nbsp;section&nbsp;3.1&nbsp;of&nbsp;&nbsp;RFC&nbsp;3987,&nbsp;and&nbsp;behaves&nbsp;the&nbsp;same&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359457">//&nbsp;EcmaScript&nbsp;builtin&nbsp;encodeURIComponent.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359500">//&nbsp;It&nbsp;should&nbsp;not&nbsp;cause&nbsp;any&nbsp;misencoding&nbsp;of&nbsp;URLs&nbsp;in&nbsp;pages&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359562">//&nbsp;Content-type:&nbsp;text/html;charset=UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359605">for</span>&nbsp;<span class="ident" id="3359609">i</span><span class="op" id="3359610">,</span>&nbsp;<span class="ident" id="3359612">n</span>&nbsp;<span class="op" id="3359614">:=</span>&nbsp;<span class="num" id="3359617">0</span><span class="op" id="3359618">,</span>&nbsp;<span class="builtinfunc" id="3359620">len</span><span class="op" id="3359623">(</span><span class="ident" id="3359624"><a href="/html/template/url.go.html#3359148">s</a></span><span class="op" id="3359625">)</span><span class="op" id="3359626">;</span>&nbsp;<span class="ident" id="3359628"><a href="/html/template/url.go.html#3359609">i</a></span>&nbsp;<span class="op" id="3359630">&lt;</span>&nbsp;<span class="ident" id="3359632"><a href="/html/template/url.go.html#3359612">n</a></span><span class="op" id="3359633">;</span>&nbsp;<span class="ident" id="3359635"><a href="/html/template/url.go.html#3359609">i</a></span><span class="op" id="3359636">++</span>&nbsp;<span class="op" id="3359639">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359643">c</span>&nbsp;<span class="op" id="3359645">:=</span>&nbsp;<span class="ident" id="3359648"><a href="/html/template/url.go.html#3359148">s</a></span><span class="op" id="3359649">[</span><span class="ident" id="3359650"><a href="/html/template/url.go.html#3359609">i</a></span><span class="op" id="3359651">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359655">switch</span>&nbsp;<span class="ident" id="3359662"><a href="/html/template/url.go.html#3359643">c</a></span>&nbsp;<span class="op" id="3359664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359668">//&nbsp;Single&nbsp;quote&nbsp;and&nbsp;parens&nbsp;are&nbsp;sub-delims&nbsp;in&nbsp;RFC&nbsp;3986,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359732">//&nbsp;escape&nbsp;them&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359789">//&nbsp;quoted&nbsp;attributes&nbsp;and&nbsp;unquoted&nbsp;CSS&nbsp;url(...)&nbsp;constructs.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359850">//&nbsp;Single&nbsp;quotes&nbsp;are&nbsp;reserved&nbsp;in&nbsp;URLs,&nbsp;but&nbsp;are&nbsp;only&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359912">//&nbsp;the&nbsp;obsolete&nbsp;&#34;mark&#34;&nbsp;rule&nbsp;in&nbsp;an&nbsp;appendix&nbsp;in&nbsp;RFC&nbsp;3986</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359969">//&nbsp;so&nbsp;can&nbsp;be&nbsp;safely&nbsp;encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360000">case</span>&nbsp;<span class="string" id="3360005">&#39;!&#39;</span><span class="op" id="3360008">,</span>&nbsp;<span class="string" id="3360010">&#39;#&#39;</span><span class="op" id="3360013">,</span>&nbsp;<span class="string" id="3360015">&#39;$&#39;</span><span class="op" id="3360018">,</span>&nbsp;<span class="string" id="3360020">&#39;&amp;&#39;</span><span class="op" id="3360023">,</span>&nbsp;<span class="string" id="3360025">&#39;*&#39;</span><span class="op" id="3360028">,</span>&nbsp;<span class="string" id="3360030">&#39;+&#39;</span><span class="op" id="3360033">,</span>&nbsp;<span class="string" id="3360035">&#39;,&#39;</span><span class="op" id="3360038">,</span>&nbsp;<span class="string" id="3360040">&#39;/&#39;</span><span class="op" id="3360043">,</span>&nbsp;<span class="string" id="3360045">&#39;:&#39;</span><span class="op" id="3360048">,</span>&nbsp;<span class="string" id="3360050">&#39;;&#39;</span><span class="op" id="3360053">,</span>&nbsp;<span class="string" id="3360055">&#39;=&#39;</span><span class="op" id="3360058">,</span>&nbsp;<span class="string" id="3360060">&#39;?&#39;</span><span class="op" id="3360063">,</span>&nbsp;<span class="string" id="3360065">&#39;@&#39;</span><span class="op" id="3360068">,</span>&nbsp;<span class="string" id="3360070">&#39;[&#39;</span><span class="op" id="3360073">,</span>&nbsp;<span class="string" id="3360075">&#39;]&#39;</span><span class="op" id="3360078">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360083">if</span>&nbsp;<span class="ident" id="3360086"><a href="/html/template/url.go.html#3359106">norm</a></span>&nbsp;<span class="op" id="3360091">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360097">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3360113">//&nbsp;Unreserved&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986&nbsp;sec&nbsp;2.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3360159">//&nbsp;&#34;For&nbsp;consistency,&nbsp;percent-encoded&nbsp;octets&nbsp;in&nbsp;the&nbsp;ranges&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3360222">//&nbsp;ALPHA&nbsp;(%41-%5A&nbsp;and&nbsp;%61-%7A),&nbsp;DIGIT&nbsp;(%30-%39),&nbsp;hyphen&nbsp;(%2D),</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3360287">//&nbsp;period&nbsp;(%2E),&nbsp;underscore&nbsp;(%5F),&nbsp;or&nbsp;tilde&nbsp;(%7E)&nbsp;should&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3360353">//&nbsp;created&nbsp;by&nbsp;URI&nbsp;producers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360383">case</span>&nbsp;<span class="string" id="3360388">&#39;-&#39;</span><span class="op" id="3360391">,</span>&nbsp;<span class="string" id="3360393">&#39;.&#39;</span><span class="op" id="3360396">,</span>&nbsp;<span class="string" id="3360398">&#39;_&#39;</span><span class="op" id="3360401">,</span>&nbsp;<span class="string" id="3360403">&#39;~&#39;</span><span class="op" id="3360406">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360411">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360422">case</span>&nbsp;<span class="string" id="3360427">&#39;%&#39;</span><span class="op" id="3360430">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3360435">//&nbsp;When&nbsp;normalizing&nbsp;do&nbsp;not&nbsp;re-encode&nbsp;valid&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360490">if</span>&nbsp;<span class="ident" id="3360493"><a href="/html/template/url.go.html#3359106">norm</a></span>&nbsp;<span class="op" id="3360498">&amp;&amp;</span>&nbsp;<span class="ident" id="3360501"><a href="/html/template/url.go.html#3359609">i</a></span><span class="op" id="3360502">+</span><span class="num" id="3360503">2</span>&nbsp;<span class="op" id="3360505">&lt;</span>&nbsp;<span class="builtinfunc" id="3360507">len</span><span class="op" id="3360510">(</span><span class="ident" id="3360511"><a href="/html/template/url.go.html#3359148">s</a></span><span class="op" id="3360512">)</span>&nbsp;<span class="op" id="3360514">&amp;&amp;</span>&nbsp;<span class="ident" id="3360517"><a href="/html/template/css.go.html#3269978">isHex</a></span><span class="op" id="3360522">(</span><span class="ident" id="3360523"><a href="/html/template/url.go.html#3359148">s</a></span><span class="op" id="3360524">[</span><span class="ident" id="3360525"><a href="/html/template/url.go.html#3359609">i</a></span><span class="op" id="3360526">+</span><span class="num" id="3360527">1</span><span class="op" id="3360528">]</span><span class="op" id="3360529">)</span>&nbsp;<span class="op" id="3360531">&amp;&amp;</span>&nbsp;<span class="ident" id="3360534"><a href="/html/template/css.go.html#3269978">isHex</a></span><span class="op" id="3360539">(</span><span class="ident" id="3360540"><a href="/html/template/url.go.html#3359148">s</a></span><span class="op" id="3360541">[</span><span class="ident" id="3360542"><a href="/html/template/url.go.html#3359609">i</a></span><span class="op" id="3360543">+</span><span class="num" id="3360544">2</span><span class="op" id="3360545">]</span><span class="op" id="3360546">)</span>&nbsp;<span class="op" id="3360548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360554">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360570">default</span><span class="op" id="3360577">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3360582">//&nbsp;Unreserved&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986&nbsp;sec&nbsp;2.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360629">if</span>&nbsp;<span class="string" id="3360632">&#39;a&#39;</span>&nbsp;<span class="op" id="3360636">&lt;=</span>&nbsp;<span class="ident" id="3360639"><a href="/html/template/url.go.html#3359643">c</a></span>&nbsp;<span class="op" id="3360641">&amp;&amp;</span>&nbsp;<span class="ident" id="3360644"><a href="/html/template/url.go.html#3359643">c</a></span>&nbsp;<span class="op" id="3360646">&lt;=</span>&nbsp;<span class="string" id="3360649">&#39;z&#39;</span>&nbsp;<span class="op" id="3360653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360659">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360676">if</span>&nbsp;<span class="string" id="3360679">&#39;A&#39;</span>&nbsp;<span class="op" id="3360683">&lt;=</span>&nbsp;<span class="ident" id="3360686"><a href="/html/template/url.go.html#3359643">c</a></span>&nbsp;<span class="op" id="3360688">&amp;&amp;</span>&nbsp;<span class="ident" id="3360691"><a href="/html/template/url.go.html#3359643">c</a></span>&nbsp;<span class="op" id="3360693">&lt;=</span>&nbsp;<span class="string" id="3360696">&#39;Z&#39;</span>&nbsp;<span class="op" id="3360700">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360706">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360723">if</span>&nbsp;<span class="string" id="3360726">&#39;0&#39;</span>&nbsp;<span class="op" id="3360730">&lt;=</span>&nbsp;<span class="ident" id="3360733"><a href="/html/template/url.go.html#3359643">c</a></span>&nbsp;<span class="op" id="3360735">&amp;&amp;</span>&nbsp;<span class="ident" id="3360738"><a href="/html/template/url.go.html#3359643">c</a></span>&nbsp;<span class="op" id="3360740">&lt;=</span>&nbsp;<span class="string" id="3360743">&#39;9&#39;</span>&nbsp;<span class="op" id="3360747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360753">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360765">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360773"><a href="/html/template/url.go.html#3359223">b</a></span><span class="op" id="3360774">.</span><span class="ident" id="3360775">WriteString</span><span class="op" id="3360786">(</span><span class="ident" id="3360787"><a href="/html/template/url.go.html#3359148">s</a></span><span class="op" id="3360788">[</span><span class="ident" id="3360789"><a href="/html/template/url.go.html#3359239">written</a></span><span class="op" id="3360796">:</span><span class="ident" id="3360797"><a href="/html/template/url.go.html#3359609">i</a></span><span class="op" id="3360798">]</span><span class="op" id="3360799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360803"><a href="/html/template/url.go.html#3357855">fmt</a></span><span class="op" id="3360806">.</span><span class="ident" id="3360807">Fprintf</span><span class="op" id="3360814">(</span><span class="op" id="3360815">&amp;</span><span class="ident" id="3360816"><a href="/html/template/url.go.html#3359223">b</a></span><span class="op" id="3360817">,</span>&nbsp;<span class="string" id="3360819">&#34;%%%02x&#34;</span><span class="op" id="3360827">,</span>&nbsp;<span class="ident" id="3360829"><a href="/html/template/url.go.html#3359643">c</a></span><span class="op" id="3360830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360834"><a href="/html/template/url.go.html#3359239">written</a></span>&nbsp;<span class="op" id="3360842">=</span>&nbsp;<span class="ident" id="3360844"><a href="/html/template/url.go.html#3359609">i</a></span>&nbsp;<span class="op" id="3360846">+</span>&nbsp;<span class="num" id="3360848">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360851">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360854">if</span>&nbsp;<span class="ident" id="3360857"><a href="/html/template/url.go.html#3359239">written</a></span>&nbsp;<span class="op" id="3360865">==</span>&nbsp;<span class="num" id="3360868">0</span>&nbsp;<span class="op" id="3360870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360874">return</span>&nbsp;<span class="ident" id="3360881"><a href="/html/template/url.go.html#3359148">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360887"><a href="/html/template/url.go.html#3359223">b</a></span><span class="op" id="3360888">.</span><span class="ident" id="3360889">WriteString</span><span class="op" id="3360900">(</span><span class="ident" id="3360901"><a href="/html/template/url.go.html#3359148">s</a></span><span class="op" id="3360902">[</span><span class="ident" id="3360903"><a href="/html/template/url.go.html#3359239">written</a></span><span class="op" id="3360910">:</span><span class="op" id="3360911">]</span><span class="op" id="3360912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360915">return</span>&nbsp;<span class="ident" id="3360922"><a href="/html/template/url.go.html#3359223">b</a></span><span class="op" id="3360923">.</span><span class="ident" id="3360924">String</span><span class="op" id="3360930">(</span><span class="op" id="3360931">)</span><br>
<span class="lineno">105</span><span class="op" id="3360933">}</span>
</div>
</body>
</html>
