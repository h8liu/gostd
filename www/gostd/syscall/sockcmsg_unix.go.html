<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html" class="current">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2540491">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2540547">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2540601">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2540652">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2540717">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2540745">package</span>&nbsp;<span class="ident" id="2540753">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2540762">import</span>&nbsp;<span class="string" id="2540769">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2540779">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;raw&nbsp;sockaddr&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2540842">func</span>&nbsp;<span class="ident" id="2540847">cmsgAlignOf</span><span class="op" id="2540858">(</span><span class="ident" id="2540859">salen</span>&nbsp;<span class="builtintype" id="2540865">int</span><span class="op" id="2540868">)</span>&nbsp;<span class="builtintype" id="2540870">int</span>&nbsp;<span class="op" id="2540874">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2540877">salign</span>&nbsp;<span class="op" id="2540884">:=</span>&nbsp;<span class="ident" id="2540887">sizeofPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2540898">//&nbsp;NOTE:&nbsp;It&nbsp;seems&nbsp;like&nbsp;64-bit&nbsp;Darwin&nbsp;and&nbsp;DragonFly&nbsp;BSD&nbsp;kernels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2540962">//&nbsp;still&nbsp;require&nbsp;32-bit&nbsp;aligned&nbsp;access&nbsp;to&nbsp;network&nbsp;subsystem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2541024">if</span>&nbsp;<span class="ident" id="2541027">darwin64Bit</span>&nbsp;<span class="op" id="2541039">||</span>&nbsp;<span class="ident" id="2541042">dragonfly64Bit</span>&nbsp;<span class="op" id="2541057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2541061">salign</span>&nbsp;<span class="op" id="2541068">=</span>&nbsp;<span class="num" id="2541070">4</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2541073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2541076">return</span>&nbsp;<span class="op" id="2541083">(</span><span class="ident" id="2541084">salen</span>&nbsp;<span class="op" id="2541090">+</span>&nbsp;<span class="ident" id="2541092">salign</span>&nbsp;<span class="op" id="2541099">-</span>&nbsp;<span class="num" id="2541101">1</span><span class="op" id="2541102">)</span>&nbsp;<span class="op" id="2541104">&amp;</span>&nbsp;<span class="op" id="2541106">^</span><span class="op" id="2541107">(</span><span class="ident" id="2541108">salign</span>&nbsp;<span class="op" id="2541115">-</span>&nbsp;<span class="num" id="2541117">1</span><span class="op" id="2541118">)</span><br>
<span class="lineno"></span><span class="op" id="2541120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2541123">//&nbsp;CmsgLen&nbsp;returns&nbsp;the&nbsp;value&nbsp;to&nbsp;store&nbsp;in&nbsp;the&nbsp;Len&nbsp;field&nbsp;of&nbsp;the&nbsp;Cmsghdr</span><br>
<span class="lineno">25</span><span class="comment" id="2541193">//&nbsp;structure,&nbsp;taking&nbsp;into&nbsp;account&nbsp;any&nbsp;necessary&nbsp;alignment.</span><br>
<span class="lineno"></span><span class="keyword" id="2541252">func</span>&nbsp;<span class="ident" id="2541257">CmsgLen</span><span class="op" id="2541264">(</span><span class="ident" id="2541265">datalen</span>&nbsp;<span class="builtintype" id="2541273">int</span><span class="op" id="2541276">)</span>&nbsp;<span class="builtintype" id="2541278">int</span>&nbsp;<span class="op" id="2541282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2541285">return</span>&nbsp;<span class="ident" id="2541292">cmsgAlignOf</span><span class="op" id="2541303">(</span><span class="ident" id="2541304">SizeofCmsghdr</span><span class="op" id="2541317">)</span>&nbsp;<span class="op" id="2541319">+</span>&nbsp;<span class="ident" id="2541321">datalen</span><br>
<span class="lineno"></span><span class="op" id="2541329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2541332">//&nbsp;CmsgSpace&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;an&nbsp;ancillary&nbsp;element&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="2541399">//&nbsp;payload&nbsp;of&nbsp;the&nbsp;passed&nbsp;data&nbsp;length&nbsp;occupies.</span><br>
<span class="lineno"></span><span class="keyword" id="2541446">func</span>&nbsp;<span class="ident" id="2541451">CmsgSpace</span><span class="op" id="2541460">(</span><span class="ident" id="2541461">datalen</span>&nbsp;<span class="builtintype" id="2541469">int</span><span class="op" id="2541472">)</span>&nbsp;<span class="builtintype" id="2541474">int</span>&nbsp;<span class="op" id="2541478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2541481">return</span>&nbsp;<span class="ident" id="2541488">cmsgAlignOf</span><span class="op" id="2541499">(</span><span class="ident" id="2541500">SizeofCmsghdr</span><span class="op" id="2541513">)</span>&nbsp;<span class="op" id="2541515">+</span>&nbsp;<span class="ident" id="2541517">cmsgAlignOf</span><span class="op" id="2541528">(</span><span class="ident" id="2541529">datalen</span><span class="op" id="2541536">)</span><br>
<span class="lineno"></span><span class="op" id="2541538">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2541541">func</span>&nbsp;<span class="ident" id="2541546">cmsgData</span><span class="op" id="2541554">(</span><span class="ident" id="2541555">h</span>&nbsp;<span class="op" id="2541557">*</span><span class="ident" id="2541558">Cmsghdr</span><span class="op" id="2541565">)</span>&nbsp;<span class="ident" id="2541567">unsafe</span><span class="op" id="2541573">.</span><span class="ident" id="2541574">Pointer</span>&nbsp;<span class="op" id="2541582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2541585">return</span>&nbsp;<span class="ident" id="2541592">unsafe</span><span class="op" id="2541598">.</span><span class="ident" id="2541599">Pointer</span><span class="op" id="2541606">(</span><span class="builtintype" id="2541607">uintptr</span><span class="op" id="2541614">(</span><span class="ident" id="2541615">unsafe</span><span class="op" id="2541621">.</span><span class="ident" id="2541622">Pointer</span><span class="op" id="2541629">(</span><span class="ident" id="2541630">h</span><span class="op" id="2541631">)</span><span class="op" id="2541632">)</span>&nbsp;<span class="op" id="2541634">+</span>&nbsp;<span class="builtintype" id="2541636">uintptr</span><span class="op" id="2541643">(</span><span class="ident" id="2541644">cmsgAlignOf</span><span class="op" id="2541655">(</span><span class="ident" id="2541656">SizeofCmsghdr</span><span class="op" id="2541669">)</span><span class="op" id="2541670">)</span><span class="op" id="2541671">)</span><br>
<span class="lineno"></span><span class="op" id="2541673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2541676">//&nbsp;SocketControlMessage&nbsp;represents&nbsp;a&nbsp;socket&nbsp;control&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2541737">type</span>&nbsp;<span class="ident" id="2541742">SocketControlMessage</span>&nbsp;<span class="keyword" id="2541763">struct</span>&nbsp;<span class="op" id="2541770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2541773">Header</span>&nbsp;<span class="ident" id="2541780">Cmsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2541789">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2541796">[</span><span class="op" id="2541797">]</span><span class="builtintype" id="2541798">byte</span><br>
<span class="lineno"></span><span class="op" id="2541803">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2541806">//&nbsp;ParseSocketControlMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;socket&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="2541874">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="2541887">func</span>&nbsp;<span class="ident" id="2541892">ParseSocketControlMessage</span><span class="op" id="2541917">(</span><span class="ident" id="2541918">b</span>&nbsp;<span class="op" id="2541920">[</span><span class="op" id="2541921">]</span><span class="builtintype" id="2541922">byte</span><span class="op" id="2541926">)</span>&nbsp;<span class="op" id="2541928">(</span><span class="op" id="2541929">[</span><span class="op" id="2541930">]</span><span class="ident" id="2541931">SocketControlMessage</span><span class="op" id="2541951">,</span>&nbsp;<span class="builtintype" id="2541953">error</span><span class="op" id="2541958">)</span>&nbsp;<span class="op" id="2541960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2541963">var</span>&nbsp;<span class="ident" id="2541967">msgs</span>&nbsp;<span class="op" id="2541972">[</span><span class="op" id="2541973">]</span><span class="ident" id="2541974">SocketControlMessage</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2541996">i</span>&nbsp;<span class="op" id="2541998">:=</span>&nbsp;<span class="num" id="2542001">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2542004">for</span>&nbsp;<span class="ident" id="2542008">i</span><span class="op" id="2542009">+</span><span class="ident" id="2542010">CmsgLen</span><span class="op" id="2542017">(</span><span class="num" id="2542018">0</span><span class="op" id="2542019">)</span>&nbsp;<span class="op" id="2542021">&lt;=</span>&nbsp;<span class="builtinfunc" id="2542024">len</span><span class="op" id="2542027">(</span><span class="ident" id="2542028">b</span><span class="op" id="2542029">)</span>&nbsp;<span class="op" id="2542031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2542035">h</span><span class="op" id="2542036">,</span>&nbsp;<span class="ident" id="2542038">dbuf</span><span class="op" id="2542042">,</span>&nbsp;<span class="ident" id="2542044">err</span>&nbsp;<span class="op" id="2542048">:=</span>&nbsp;<span class="ident" id="2542051">socketControlMessageHeaderAndData</span><span class="op" id="2542084">(</span><span class="ident" id="2542085">b</span><span class="op" id="2542086">[</span><span class="ident" id="2542087">i</span><span class="op" id="2542088">:</span><span class="op" id="2542089">]</span><span class="op" id="2542090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2542094">if</span>&nbsp;<span class="ident" id="2542097">err</span>&nbsp;<span class="op" id="2542101">!=</span>&nbsp;<span class="builtintype" id="2542104">nil</span>&nbsp;<span class="op" id="2542108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2542113">return</span>&nbsp;<span class="builtintype" id="2542120">nil</span><span class="op" id="2542123">,</span>&nbsp;<span class="ident" id="2542125">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2542131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2542135">m</span>&nbsp;<span class="op" id="2542137">:=</span>&nbsp;<span class="ident" id="2542140">SocketControlMessage</span><span class="op" id="2542160">{</span><span class="ident" id="2542161">Header</span><span class="op" id="2542167">:</span>&nbsp;<span class="op" id="2542169">*</span><span class="ident" id="2542170">h</span><span class="op" id="2542171">,</span>&nbsp;<span class="ident" id="2542173">Data</span><span class="op" id="2542177">:</span>&nbsp;<span class="ident" id="2542179">dbuf</span><span class="op" id="2542183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2542187">msgs</span>&nbsp;<span class="op" id="2542192">=</span>&nbsp;<span class="builtinfunc" id="2542194">append</span><span class="op" id="2542200">(</span><span class="ident" id="2542201">msgs</span><span class="op" id="2542205">,</span>&nbsp;<span class="ident" id="2542207">m</span><span class="op" id="2542208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2542212">i</span>&nbsp;<span class="op" id="2542214">+=</span>&nbsp;<span class="ident" id="2542217">cmsgAlignOf</span><span class="op" id="2542228">(</span><span class="builtintype" id="2542229">int</span><span class="op" id="2542232">(</span><span class="ident" id="2542233">h</span><span class="op" id="2542234">.</span><span class="ident" id="2542235">Len</span><span class="op" id="2542238">)</span><span class="op" id="2542239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2542242">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2542245">return</span>&nbsp;<span class="ident" id="2542252">msgs</span><span class="op" id="2542256">,</span>&nbsp;<span class="builtintype" id="2542258">nil</span><br>
<span class="lineno"></span><span class="op" id="2542262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2542265">func</span>&nbsp;<span class="ident" id="2542270">socketControlMessageHeaderAndData</span><span class="op" id="2542303">(</span><span class="ident" id="2542304">b</span>&nbsp;<span class="op" id="2542306">[</span><span class="op" id="2542307">]</span><span class="builtintype" id="2542308">byte</span><span class="op" id="2542312">)</span>&nbsp;<span class="op" id="2542314">(</span><span class="op" id="2542315">*</span><span class="ident" id="2542316">Cmsghdr</span><span class="op" id="2542323">,</span>&nbsp;<span class="op" id="2542325">[</span><span class="op" id="2542326">]</span><span class="builtintype" id="2542327">byte</span><span class="op" id="2542331">,</span>&nbsp;<span class="builtintype" id="2542333">error</span><span class="op" id="2542338">)</span>&nbsp;<span class="op" id="2542340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2542343">h</span>&nbsp;<span class="op" id="2542345">:=</span>&nbsp;<span class="op" id="2542348">(</span><span class="op" id="2542349">*</span><span class="ident" id="2542350">Cmsghdr</span><span class="op" id="2542357">)</span><span class="op" id="2542358">(</span><span class="ident" id="2542359">unsafe</span><span class="op" id="2542365">.</span><span class="ident" id="2542366">Pointer</span><span class="op" id="2542373">(</span><span class="op" id="2542374">&amp;</span><span class="ident" id="2542375">b</span><span class="op" id="2542376">[</span><span class="num" id="2542377">0</span><span class="op" id="2542378">]</span><span class="op" id="2542379">)</span><span class="op" id="2542380">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2542383">if</span>&nbsp;<span class="ident" id="2542386">h</span><span class="op" id="2542387">.</span><span class="ident" id="2542388">Len</span>&nbsp;<span class="op" id="2542392">&lt;</span>&nbsp;<span class="ident" id="2542394">SizeofCmsghdr</span>&nbsp;<span class="op" id="2542408">||</span>&nbsp;<span class="builtintype" id="2542411">int</span><span class="op" id="2542414">(</span><span class="ident" id="2542415">h</span><span class="op" id="2542416">.</span><span class="ident" id="2542417">Len</span><span class="op" id="2542420">)</span>&nbsp;<span class="op" id="2542422">&gt;</span>&nbsp;<span class="builtinfunc" id="2542424">len</span><span class="op" id="2542427">(</span><span class="ident" id="2542428">b</span><span class="op" id="2542429">)</span>&nbsp;<span class="op" id="2542431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2542435">return</span>&nbsp;<span class="builtintype" id="2542442">nil</span><span class="op" id="2542445">,</span>&nbsp;<span class="builtintype" id="2542447">nil</span><span class="op" id="2542450">,</span>&nbsp;<span class="ident" id="2542452">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2542460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2542463">return</span>&nbsp;<span class="ident" id="2542470">h</span><span class="op" id="2542471">,</span>&nbsp;<span class="ident" id="2542473">b</span><span class="op" id="2542474">[</span><span class="ident" id="2542475">cmsgAlignOf</span><span class="op" id="2542486">(</span><span class="ident" id="2542487">SizeofCmsghdr</span><span class="op" id="2542500">)</span><span class="op" id="2542501">:</span><span class="ident" id="2542502">h</span><span class="op" id="2542503">.</span><span class="ident" id="2542504">Len</span><span class="op" id="2542507">]</span><span class="op" id="2542508">,</span>&nbsp;<span class="builtintype" id="2542510">nil</span><br>
<span class="lineno"></span><span class="op" id="2542514">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="2542517">//&nbsp;UnixRights&nbsp;encodes&nbsp;a&nbsp;set&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;into&nbsp;a&nbsp;socket</span><br>
<span class="lineno"></span><span class="comment" id="2542584">//&nbsp;control&nbsp;message&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="2542635">func</span>&nbsp;<span class="ident" id="2542640">UnixRights</span><span class="op" id="2542650">(</span><span class="ident" id="2542651">fds</span>&nbsp;<span class="op" id="2542655">...</span><span class="builtintype" id="2542658">int</span><span class="op" id="2542661">)</span>&nbsp;<span class="op" id="2542663">[</span><span class="op" id="2542664">]</span><span class="builtintype" id="2542665">byte</span>&nbsp;<span class="op" id="2542670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2542673">datalen</span>&nbsp;<span class="op" id="2542681">:=</span>&nbsp;<span class="builtinfunc" id="2542684">len</span><span class="op" id="2542687">(</span><span class="ident" id="2542688">fds</span><span class="op" id="2542691">)</span>&nbsp;<span class="op" id="2542693">*</span>&nbsp;<span class="num" id="2542695">4</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2542698">b</span>&nbsp;<span class="op" id="2542700">:=</span>&nbsp;<span class="builtinfunc" id="2542703">make</span><span class="op" id="2542707">(</span><span class="op" id="2542708">[</span><span class="op" id="2542709">]</span><span class="builtintype" id="2542710">byte</span><span class="op" id="2542714">,</span>&nbsp;<span class="ident" id="2542716">CmsgSpace</span><span class="op" id="2542725">(</span><span class="ident" id="2542726">datalen</span><span class="op" id="2542733">)</span><span class="op" id="2542734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2542737">h</span>&nbsp;<span class="op" id="2542739">:=</span>&nbsp;<span class="op" id="2542742">(</span><span class="op" id="2542743">*</span><span class="ident" id="2542744">Cmsghdr</span><span class="op" id="2542751">)</span><span class="op" id="2542752">(</span><span class="ident" id="2542753">unsafe</span><span class="op" id="2542759">.</span><span class="ident" id="2542760">Pointer</span><span class="op" id="2542767">(</span><span class="op" id="2542768">&amp;</span><span class="ident" id="2542769">b</span><span class="op" id="2542770">[</span><span class="num" id="2542771">0</span><span class="op" id="2542772">]</span><span class="op" id="2542773">)</span><span class="op" id="2542774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2542777">h</span><span class="op" id="2542778">.</span><span class="ident" id="2542779">Level</span>&nbsp;<span class="op" id="2542785">=</span>&nbsp;<span class="ident" id="2542787">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2542799">h</span><span class="op" id="2542800">.</span><span class="ident" id="2542801">Type</span>&nbsp;<span class="op" id="2542806">=</span>&nbsp;<span class="ident" id="2542808">SCM_RIGHTS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2542820">h</span><span class="op" id="2542821">.</span><span class="ident" id="2542822">SetLen</span><span class="op" id="2542828">(</span><span class="ident" id="2542829">CmsgLen</span><span class="op" id="2542836">(</span><span class="ident" id="2542837">datalen</span><span class="op" id="2542844">)</span><span class="op" id="2542845">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2542848">data</span>&nbsp;<span class="op" id="2542853">:=</span>&nbsp;<span class="builtintype" id="2542856">uintptr</span><span class="op" id="2542863">(</span><span class="ident" id="2542864">cmsgData</span><span class="op" id="2542872">(</span><span class="ident" id="2542873">h</span><span class="op" id="2542874">)</span><span class="op" id="2542875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2542878">for</span>&nbsp;<span class="ident" id="2542882">_</span><span class="op" id="2542883">,</span>&nbsp;<span class="ident" id="2542885">fd</span>&nbsp;<span class="op" id="2542888">:=</span>&nbsp;<span class="keyword" id="2542891">range</span>&nbsp;<span class="ident" id="2542897">fds</span>&nbsp;<span class="op" id="2542901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2542905">*</span><span class="op" id="2542906">(</span><span class="op" id="2542907">*</span><span class="builtintype" id="2542908">int32</span><span class="op" id="2542913">)</span><span class="op" id="2542914">(</span><span class="ident" id="2542915">unsafe</span><span class="op" id="2542921">.</span><span class="ident" id="2542922">Pointer</span><span class="op" id="2542929">(</span><span class="ident" id="2542930">data</span><span class="op" id="2542934">)</span><span class="op" id="2542935">)</span>&nbsp;<span class="op" id="2542937">=</span>&nbsp;<span class="builtintype" id="2542939">int32</span><span class="op" id="2542944">(</span><span class="ident" id="2542945">fd</span><span class="op" id="2542947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2542951">data</span>&nbsp;<span class="op" id="2542956">+=</span>&nbsp;<span class="num" id="2542959">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2542962">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2542965">return</span>&nbsp;<span class="ident" id="2542972">b</span><br>
<span class="lineno"></span><span class="op" id="2542974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2542977">//&nbsp;ParseUnixRights&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2543046">//&nbsp;integer&nbsp;array&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;from&nbsp;another&nbsp;process.</span><br>
<span class="lineno">90</span><span class="keyword" id="2543110">func</span>&nbsp;<span class="ident" id="2543115">ParseUnixRights</span><span class="op" id="2543130">(</span><span class="ident" id="2543131">m</span>&nbsp;<span class="op" id="2543133">*</span><span class="ident" id="2543134">SocketControlMessage</span><span class="op" id="2543154">)</span>&nbsp;<span class="op" id="2543156">(</span><span class="op" id="2543157">[</span><span class="op" id="2543158">]</span><span class="builtintype" id="2543159">int</span><span class="op" id="2543162">,</span>&nbsp;<span class="builtintype" id="2543164">error</span><span class="op" id="2543169">)</span>&nbsp;<span class="op" id="2543171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2543174">if</span>&nbsp;<span class="ident" id="2543177">m</span><span class="op" id="2543178">.</span><span class="ident" id="2543179">Header</span><span class="op" id="2543185">.</span><span class="ident" id="2543186">Level</span>&nbsp;<span class="op" id="2543192">!=</span>&nbsp;<span class="ident" id="2543195">SOL_SOCKET</span>&nbsp;<span class="op" id="2543206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2543210">return</span>&nbsp;<span class="builtintype" id="2543217">nil</span><span class="op" id="2543220">,</span>&nbsp;<span class="ident" id="2543222">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2543230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2543233">if</span>&nbsp;<span class="ident" id="2543236">m</span><span class="op" id="2543237">.</span><span class="ident" id="2543238">Header</span><span class="op" id="2543244">.</span><span class="ident" id="2543245">Type</span>&nbsp;<span class="op" id="2543250">!=</span>&nbsp;<span class="ident" id="2543253">SCM_RIGHTS</span>&nbsp;<span class="op" id="2543264">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2543268">return</span>&nbsp;<span class="builtintype" id="2543275">nil</span><span class="op" id="2543278">,</span>&nbsp;<span class="ident" id="2543280">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2543288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2543291">fds</span>&nbsp;<span class="op" id="2543295">:=</span>&nbsp;<span class="builtinfunc" id="2543298">make</span><span class="op" id="2543302">(</span><span class="op" id="2543303">[</span><span class="op" id="2543304">]</span><span class="builtintype" id="2543305">int</span><span class="op" id="2543308">,</span>&nbsp;<span class="builtinfunc" id="2543310">len</span><span class="op" id="2543313">(</span><span class="ident" id="2543314">m</span><span class="op" id="2543315">.</span><span class="ident" id="2543316">Data</span><span class="op" id="2543320">)</span><span class="op" id="2543321">&gt;&gt;</span><span class="num" id="2543323">2</span><span class="op" id="2543324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2543327">for</span>&nbsp;<span class="ident" id="2543331">i</span><span class="op" id="2543332">,</span>&nbsp;<span class="ident" id="2543334">j</span>&nbsp;<span class="op" id="2543336">:=</span>&nbsp;<span class="num" id="2543339">0</span><span class="op" id="2543340">,</span>&nbsp;<span class="num" id="2543342">0</span><span class="op" id="2543343">;</span>&nbsp;<span class="ident" id="2543345">i</span>&nbsp;<span class="op" id="2543347">&lt;</span>&nbsp;<span class="builtinfunc" id="2543349">len</span><span class="op" id="2543352">(</span><span class="ident" id="2543353">m</span><span class="op" id="2543354">.</span><span class="ident" id="2543355">Data</span><span class="op" id="2543359">)</span><span class="op" id="2543360">;</span>&nbsp;<span class="ident" id="2543362">i</span>&nbsp;<span class="op" id="2543364">+=</span>&nbsp;<span class="num" id="2543367">4</span>&nbsp;<span class="op" id="2543369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2543373">fds</span><span class="op" id="2543376">[</span><span class="ident" id="2543377">j</span><span class="op" id="2543378">]</span>&nbsp;<span class="op" id="2543380">=</span>&nbsp;<span class="builtintype" id="2543382">int</span><span class="op" id="2543385">(</span><span class="op" id="2543386">*</span><span class="op" id="2543387">(</span><span class="op" id="2543388">*</span><span class="builtintype" id="2543389">int32</span><span class="op" id="2543394">)</span><span class="op" id="2543395">(</span><span class="ident" id="2543396">unsafe</span><span class="op" id="2543402">.</span><span class="ident" id="2543403">Pointer</span><span class="op" id="2543410">(</span><span class="op" id="2543411">&amp;</span><span class="ident" id="2543412">m</span><span class="op" id="2543413">.</span><span class="ident" id="2543414">Data</span><span class="op" id="2543418">[</span><span class="ident" id="2543419">i</span><span class="op" id="2543420">]</span><span class="op" id="2543421">)</span><span class="op" id="2543422">)</span><span class="op" id="2543423">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2543427">j</span><span class="op" id="2543428">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2543432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2543435">return</span>&nbsp;<span class="ident" id="2543442">fds</span><span class="op" id="2543445">,</span>&nbsp;<span class="builtintype" id="2543447">nil</span><br>
<span class="lineno"></span><span class="op" id="2543451">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
