<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8201096">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8201151">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8201205">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8201256">package</span>&nbsp;<span class="ident" id="8201264">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8201269">import</span>&nbsp;<span class="op" id="8201276">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8201279">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8201287">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8201294">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8201300">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8201311">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8201322">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8201332">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="8201335">//&nbsp;If&nbsp;an&nbsp;IPv6&nbsp;tunnel&nbsp;is&nbsp;running,&nbsp;we&nbsp;can&nbsp;try&nbsp;dialing&nbsp;a&nbsp;real&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="8201408">var</span>&nbsp;<span class="ident" id="8201412">testIPv6</span>&nbsp;<span class="op" id="8201421">=</span>&nbsp;<span class="ident" id="8201423">flag</span><span class="op" id="8201427">.</span><span class="ident" id="8201428">Bool</span><span class="op" id="8201432">(</span><span class="string" id="8201433">&#34;ipv6&#34;</span><span class="op" id="8201439">,</span>&nbsp;<span class="builtintype" id="8201441">false</span><span class="op" id="8201446">,</span>&nbsp;<span class="string" id="8201448">&#34;assume&nbsp;ipv6&nbsp;tunnel&nbsp;is&nbsp;present&#34;</span><span class="op" id="8201479">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8201482">func</span>&nbsp;<span class="ident" id="8201487">TestResolveGoogle</span><span class="op" id="8201504">(</span><span class="ident" id="8201505">t</span>&nbsp;<span class="op" id="8201507">*</span><span class="ident" id="8201508">testing</span><span class="op" id="8201515">.</span><span class="ident" id="8201516">T</span><span class="op" id="8201517">)</span>&nbsp;<span class="op" id="8201519">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8201522">if</span>&nbsp;<span class="ident" id="8201525">testing</span><span class="op" id="8201532">.</span><span class="ident" id="8201533">Short</span><span class="op" id="8201538">(</span><span class="op" id="8201539">)</span>&nbsp;<span class="op" id="8201541">||</span>&nbsp;<span class="op" id="8201544">!</span><span class="op" id="8201545">*</span><span class="ident" id="8201546">testExternal</span>&nbsp;<span class="op" id="8201559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8201563">t</span><span class="op" id="8201564">.</span><span class="ident" id="8201565">Skip</span><span class="op" id="8201569">(</span><span class="string" id="8201570">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="8201611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8201614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8201618">for</span>&nbsp;<span class="ident" id="8201622">_</span><span class="op" id="8201623">,</span>&nbsp;<span class="ident" id="8201625">network</span>&nbsp;<span class="op" id="8201633">:=</span>&nbsp;<span class="keyword" id="8201636">range</span>&nbsp;<span class="op" id="8201642">[</span><span class="op" id="8201643">]</span><span class="builtintype" id="8201644">string</span><span class="op" id="8201650">{</span><span class="string" id="8201651">&#34;tcp&#34;</span><span class="op" id="8201656">,</span>&nbsp;<span class="string" id="8201658">&#34;tcp4&#34;</span><span class="op" id="8201664">,</span>&nbsp;<span class="string" id="8201666">&#34;tcp6&#34;</span><span class="op" id="8201672">}</span>&nbsp;<span class="op" id="8201674">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8201678">addr</span><span class="op" id="8201682">,</span>&nbsp;<span class="ident" id="8201684">err</span>&nbsp;<span class="op" id="8201688">:=</span>&nbsp;<span class="ident" id="8201691">ResolveTCPAddr</span><span class="op" id="8201705">(</span><span class="ident" id="8201706">network</span><span class="op" id="8201713">,</span>&nbsp;<span class="string" id="8201715">&#34;www.google.com:http&#34;</span><span class="op" id="8201736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8201740">if</span>&nbsp;<span class="ident" id="8201743">err</span>&nbsp;<span class="op" id="8201747">!=</span>&nbsp;<span class="ident" id="8201750">nil</span>&nbsp;<span class="op" id="8201754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8201759">if</span>&nbsp;<span class="op" id="8201762">(</span><span class="ident" id="8201763">network</span>&nbsp;<span class="op" id="8201771">==</span>&nbsp;<span class="string" id="8201774">&#34;tcp&#34;</span>&nbsp;<span class="op" id="8201780">||</span>&nbsp;<span class="ident" id="8201783">network</span>&nbsp;<span class="op" id="8201791">==</span>&nbsp;<span class="string" id="8201794">&#34;tcp4&#34;</span><span class="op" id="8201800">)</span>&nbsp;<span class="op" id="8201802">&amp;&amp;</span>&nbsp;<span class="op" id="8201805">!</span><span class="ident" id="8201806">supportsIPv4</span>&nbsp;<span class="op" id="8201819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8201825">t</span><span class="op" id="8201826">.</span><span class="ident" id="8201827">Logf</span><span class="op" id="8201831">(</span><span class="string" id="8201832">&#34;ipv4&nbsp;is&nbsp;not&nbsp;supported:&nbsp;%v&#34;</span><span class="op" id="8201859">,</span>&nbsp;<span class="ident" id="8201861">err</span><span class="op" id="8201864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8201869">}</span>&nbsp;<span class="keyword" id="8201871">else</span>&nbsp;<span class="keyword" id="8201876">if</span>&nbsp;<span class="ident" id="8201879">network</span>&nbsp;<span class="op" id="8201887">==</span>&nbsp;<span class="string" id="8201890">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="8201897">&amp;&amp;</span>&nbsp;<span class="op" id="8201900">!</span><span class="ident" id="8201901">supportsIPv6</span>&nbsp;<span class="op" id="8201914">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8201920">t</span><span class="op" id="8201921">.</span><span class="ident" id="8201922">Logf</span><span class="op" id="8201926">(</span><span class="string" id="8201927">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported:&nbsp;%v&#34;</span><span class="op" id="8201954">,</span>&nbsp;<span class="ident" id="8201956">err</span><span class="op" id="8201959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8201964">}</span>&nbsp;<span class="keyword" id="8201966">else</span>&nbsp;<span class="op" id="8201971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8201977">t</span><span class="op" id="8201978">.</span><span class="ident" id="8201979">Errorf</span><span class="op" id="8201985">(</span><span class="string" id="8201986">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8202013">,</span>&nbsp;<span class="ident" id="8202015">err</span><span class="op" id="8202018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8202023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8202028">continue</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8202039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8202043">if</span>&nbsp;<span class="op" id="8202046">(</span><span class="ident" id="8202047">network</span>&nbsp;<span class="op" id="8202055">==</span>&nbsp;<span class="string" id="8202058">&#34;tcp&#34;</span>&nbsp;<span class="op" id="8202064">||</span>&nbsp;<span class="ident" id="8202067">network</span>&nbsp;<span class="op" id="8202075">==</span>&nbsp;<span class="string" id="8202078">&#34;tcp4&#34;</span><span class="op" id="8202084">)</span>&nbsp;<span class="op" id="8202086">&amp;&amp;</span>&nbsp;<span class="ident" id="8202089">addr</span><span class="op" id="8202093">.</span><span class="ident" id="8202094">IP</span><span class="op" id="8202096">.</span><span class="ident" id="8202097">To4</span><span class="op" id="8202100">(</span><span class="op" id="8202101">)</span>&nbsp;<span class="op" id="8202103">==</span>&nbsp;<span class="ident" id="8202106">nil</span>&nbsp;<span class="op" id="8202110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8202115">t</span><span class="op" id="8202116">.</span><span class="ident" id="8202117">Errorf</span><span class="op" id="8202123">(</span><span class="string" id="8202124">&#34;got&nbsp;%v;&nbsp;expected&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;on&nbsp;%v&#34;</span><span class="op" id="8202164">,</span>&nbsp;<span class="ident" id="8202166">addr</span><span class="op" id="8202170">,</span>&nbsp;<span class="ident" id="8202172">network</span><span class="op" id="8202179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8202183">}</span>&nbsp;<span class="keyword" id="8202185">else</span>&nbsp;<span class="keyword" id="8202190">if</span>&nbsp;<span class="ident" id="8202193">network</span>&nbsp;<span class="op" id="8202201">==</span>&nbsp;<span class="string" id="8202204">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="8202211">&amp;&amp;</span>&nbsp;<span class="op" id="8202214">(</span><span class="ident" id="8202215">addr</span><span class="op" id="8202219">.</span><span class="ident" id="8202220">IP</span><span class="op" id="8202222">.</span><span class="ident" id="8202223">To16</span><span class="op" id="8202227">(</span><span class="op" id="8202228">)</span>&nbsp;<span class="op" id="8202230">==</span>&nbsp;<span class="ident" id="8202233">nil</span>&nbsp;<span class="op" id="8202237">||</span>&nbsp;<span class="ident" id="8202240">addr</span><span class="op" id="8202244">.</span><span class="ident" id="8202245">IP</span><span class="op" id="8202247">.</span><span class="ident" id="8202248">To4</span><span class="op" id="8202251">(</span><span class="op" id="8202252">)</span>&nbsp;<span class="op" id="8202254">!=</span>&nbsp;<span class="ident" id="8202257">nil</span><span class="op" id="8202260">)</span>&nbsp;<span class="op" id="8202262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8202267">t</span><span class="op" id="8202268">.</span><span class="ident" id="8202269">Errorf</span><span class="op" id="8202275">(</span><span class="string" id="8202276">&#34;got&nbsp;%v;&nbsp;expected&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;on&nbsp;%v&#34;</span><span class="op" id="8202316">,</span>&nbsp;<span class="ident" id="8202318">addr</span><span class="op" id="8202322">,</span>&nbsp;<span class="ident" id="8202324">network</span><span class="op" id="8202331">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8202335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8202338">}</span><br>
<span class="lineno"></span><span class="op" id="8202340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8202343">func</span>&nbsp;<span class="ident" id="8202348">TestDialGoogle</span><span class="op" id="8202362">(</span><span class="ident" id="8202363">t</span>&nbsp;<span class="op" id="8202365">*</span><span class="ident" id="8202366">testing</span><span class="op" id="8202373">.</span><span class="ident" id="8202374">T</span><span class="op" id="8202375">)</span>&nbsp;<span class="op" id="8202377">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8202380">if</span>&nbsp;<span class="ident" id="8202383">testing</span><span class="op" id="8202390">.</span><span class="ident" id="8202391">Short</span><span class="op" id="8202396">(</span><span class="op" id="8202397">)</span>&nbsp;<span class="op" id="8202399">||</span>&nbsp;<span class="op" id="8202402">!</span><span class="op" id="8202403">*</span><span class="ident" id="8202404">testExternal</span>&nbsp;<span class="op" id="8202417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8202421">t</span><span class="op" id="8202422">.</span><span class="ident" id="8202423">Skip</span><span class="op" id="8202427">(</span><span class="string" id="8202428">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="8202469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8202472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8202476">d</span>&nbsp;<span class="op" id="8202478">:=</span>&nbsp;<span class="op" id="8202481">&amp;</span><span class="ident" id="8202482">Dialer</span><span class="op" id="8202488">{</span><span class="ident" id="8202489">DualStack</span><span class="op" id="8202498">:</span>&nbsp;<span class="builtintype" id="8202500">true</span><span class="op" id="8202504">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8202507">for</span>&nbsp;<span class="ident" id="8202511">_</span><span class="op" id="8202512">,</span>&nbsp;<span class="ident" id="8202514">network</span>&nbsp;<span class="op" id="8202522">:=</span>&nbsp;<span class="keyword" id="8202525">range</span>&nbsp;<span class="op" id="8202531">[</span><span class="op" id="8202532">]</span><span class="builtintype" id="8202533">string</span><span class="op" id="8202539">{</span><span class="string" id="8202540">&#34;tcp&#34;</span><span class="op" id="8202545">,</span>&nbsp;<span class="string" id="8202547">&#34;tcp4&#34;</span><span class="op" id="8202553">,</span>&nbsp;<span class="string" id="8202555">&#34;tcp6&#34;</span><span class="op" id="8202561">}</span>&nbsp;<span class="op" id="8202563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8202567">if</span>&nbsp;<span class="ident" id="8202570">network</span>&nbsp;<span class="op" id="8202578">==</span>&nbsp;<span class="string" id="8202581">&#34;tcp&#34;</span>&nbsp;<span class="op" id="8202587">&amp;&amp;</span>&nbsp;<span class="op" id="8202590">!</span><span class="ident" id="8202591">supportsIPv4</span>&nbsp;<span class="op" id="8202604">&amp;&amp;</span>&nbsp;<span class="op" id="8202607">!</span><span class="ident" id="8202608">supportsIPv6</span>&nbsp;<span class="op" id="8202621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8202626">t</span><span class="op" id="8202627">.</span><span class="ident" id="8202628">Logf</span><span class="op" id="8202632">(</span><span class="string" id="8202633">&#34;skipping&nbsp;test;&nbsp;both&nbsp;ipv4&nbsp;and&nbsp;ipv6&nbsp;are&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8202686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8202691">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8202702">}</span>&nbsp;<span class="keyword" id="8202704">else</span>&nbsp;<span class="keyword" id="8202709">if</span>&nbsp;<span class="ident" id="8202712">network</span>&nbsp;<span class="op" id="8202720">==</span>&nbsp;<span class="string" id="8202723">&#34;tcp4&#34;</span>&nbsp;<span class="op" id="8202730">&amp;&amp;</span>&nbsp;<span class="op" id="8202733">!</span><span class="ident" id="8202734">supportsIPv4</span>&nbsp;<span class="op" id="8202747">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8202752">t</span><span class="op" id="8202753">.</span><span class="ident" id="8202754">Logf</span><span class="op" id="8202758">(</span><span class="string" id="8202759">&#34;skipping&nbsp;test;&nbsp;ipv4&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8202797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8202802">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8202813">}</span>&nbsp;<span class="keyword" id="8202815">else</span>&nbsp;<span class="keyword" id="8202820">if</span>&nbsp;<span class="ident" id="8202823">network</span>&nbsp;<span class="op" id="8202831">==</span>&nbsp;<span class="string" id="8202834">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="8202841">&amp;&amp;</span>&nbsp;<span class="op" id="8202844">!</span><span class="ident" id="8202845">supportsIPv6</span>&nbsp;<span class="op" id="8202858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8202863">t</span><span class="op" id="8202864">.</span><span class="ident" id="8202865">Logf</span><span class="op" id="8202869">(</span><span class="string" id="8202870">&#34;skipping&nbsp;test;&nbsp;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8202908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8202913">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8202924">}</span>&nbsp;<span class="keyword" id="8202926">else</span>&nbsp;<span class="keyword" id="8202931">if</span>&nbsp;<span class="ident" id="8202934">network</span>&nbsp;<span class="op" id="8202942">==</span>&nbsp;<span class="string" id="8202945">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="8202952">&amp;&amp;</span>&nbsp;<span class="op" id="8202955">!</span><span class="op" id="8202956">*</span><span class="ident" id="8202957">testIPv6</span>&nbsp;<span class="op" id="8202966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8202971">t</span><span class="op" id="8202972">.</span><span class="ident" id="8202973">Logf</span><span class="op" id="8202977">(</span><span class="string" id="8202978">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-ipv6&nbsp;to&nbsp;enable&#34;</span><span class="op" id="8203014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8203019">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8203030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8203034">if</span>&nbsp;<span class="ident" id="8203037">c</span><span class="op" id="8203038">,</span>&nbsp;<span class="ident" id="8203040">err</span>&nbsp;<span class="op" id="8203044">:=</span>&nbsp;<span class="ident" id="8203047">d</span><span class="op" id="8203048">.</span><span class="ident" id="8203049">Dial</span><span class="op" id="8203053">(</span><span class="ident" id="8203054">network</span><span class="op" id="8203061">,</span>&nbsp;<span class="string" id="8203063">&#34;www.google.com:http&#34;</span><span class="op" id="8203084">)</span><span class="op" id="8203085">;</span>&nbsp;<span class="ident" id="8203087">err</span>&nbsp;<span class="op" id="8203091">!=</span>&nbsp;<span class="ident" id="8203094">nil</span>&nbsp;<span class="op" id="8203098">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8203103">t</span><span class="op" id="8203104">.</span><span class="ident" id="8203105">Errorf</span><span class="op" id="8203111">(</span><span class="string" id="8203112">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8203129">,</span>&nbsp;<span class="ident" id="8203131">err</span><span class="op" id="8203134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8203138">}</span>&nbsp;<span class="keyword" id="8203140">else</span>&nbsp;<span class="op" id="8203145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8203150">c</span><span class="op" id="8203151">.</span><span class="ident" id="8203152">Close</span><span class="op" id="8203157">(</span><span class="op" id="8203158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8203162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8203165">}</span><br>
<span class="lineno">70</span><span class="op" id="8203167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8203170">//&nbsp;fd&nbsp;is&nbsp;already&nbsp;connected&nbsp;to&nbsp;the&nbsp;destination,&nbsp;port&nbsp;80.</span><br>
<span class="lineno"></span><span class="comment" id="8203226">//&nbsp;Run&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;to&nbsp;fetch&nbsp;the&nbsp;appropriate&nbsp;page.</span><br>
<span class="lineno"></span><span class="keyword" id="8203280">func</span>&nbsp;<span class="ident" id="8203285">fetchGoogle</span><span class="op" id="8203296">(</span><span class="ident" id="8203297">t</span>&nbsp;<span class="op" id="8203299">*</span><span class="ident" id="8203300">testing</span><span class="op" id="8203307">.</span><span class="ident" id="8203308">T</span><span class="op" id="8203309">,</span>&nbsp;<span class="ident" id="8203311">fd</span>&nbsp;<span class="ident" id="8203314">Conn</span><span class="op" id="8203318">,</span>&nbsp;<span class="ident" id="8203320">network</span><span class="op" id="8203327">,</span>&nbsp;<span class="ident" id="8203329">addr</span>&nbsp;<span class="builtintype" id="8203334">string</span><span class="op" id="8203340">)</span>&nbsp;<span class="op" id="8203342">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8203345">req</span>&nbsp;<span class="op" id="8203349">:=</span>&nbsp;<span class="op" id="8203352">[</span><span class="op" id="8203353">]</span><span class="builtintype" id="8203354">byte</span><span class="op" id="8203358">(</span><span class="string" id="8203359">&#34;GET&nbsp;/robots.txt&nbsp;HTTP/1.0\r\nHost:&nbsp;www.google.com\r\n\r\n&#34;</span><span class="op" id="8203417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8203420">n</span><span class="op" id="8203421">,</span>&nbsp;<span class="ident" id="8203423">err</span>&nbsp;<span class="op" id="8203427">:=</span>&nbsp;<span class="ident" id="8203430">fd</span><span class="op" id="8203432">.</span><span class="ident" id="8203433">Write</span><span class="op" id="8203438">(</span><span class="ident" id="8203439">req</span><span class="op" id="8203442">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8203446">buf</span>&nbsp;<span class="op" id="8203450">:=</span>&nbsp;<span class="builtinfunc" id="8203453">make</span><span class="op" id="8203457">(</span><span class="op" id="8203458">[</span><span class="op" id="8203459">]</span><span class="builtintype" id="8203460">byte</span><span class="op" id="8203464">,</span>&nbsp;<span class="num" id="8203466">1000</span><span class="op" id="8203470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8203473">n</span><span class="op" id="8203474">,</span>&nbsp;<span class="ident" id="8203476">err</span>&nbsp;<span class="op" id="8203480">=</span>&nbsp;<span class="ident" id="8203482">io</span><span class="op" id="8203484">.</span><span class="ident" id="8203485">ReadFull</span><span class="op" id="8203493">(</span><span class="ident" id="8203494">fd</span><span class="op" id="8203496">,</span>&nbsp;<span class="ident" id="8203498">buf</span><span class="op" id="8203501">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8203505">if</span>&nbsp;<span class="ident" id="8203508">n</span>&nbsp;<span class="op" id="8203510">&lt;</span>&nbsp;<span class="num" id="8203512">1000</span>&nbsp;<span class="op" id="8203517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8203521">t</span><span class="op" id="8203522">.</span><span class="ident" id="8203523">Errorf</span><span class="op" id="8203529">(</span><span class="string" id="8203530">&#34;fetchGoogle:&nbsp;short&nbsp;HTTP&nbsp;read&nbsp;from&nbsp;%s&nbsp;%s&nbsp;-&nbsp;%v&#34;</span><span class="op" id="8203576">,</span>&nbsp;<span class="ident" id="8203578">network</span><span class="op" id="8203585">,</span>&nbsp;<span class="ident" id="8203587">addr</span><span class="op" id="8203591">,</span>&nbsp;<span class="ident" id="8203593">err</span><span class="op" id="8203596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8203600">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8203608">}</span><br>
<span class="lineno">85</span><span class="op" id="8203610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8203613">func</span>&nbsp;<span class="ident" id="8203618">doDial</span><span class="op" id="8203624">(</span><span class="ident" id="8203625">t</span>&nbsp;<span class="op" id="8203627">*</span><span class="ident" id="8203628">testing</span><span class="op" id="8203635">.</span><span class="ident" id="8203636">T</span><span class="op" id="8203637">,</span>&nbsp;<span class="ident" id="8203639">network</span><span class="op" id="8203646">,</span>&nbsp;<span class="ident" id="8203648">addr</span>&nbsp;<span class="builtintype" id="8203653">string</span><span class="op" id="8203659">)</span>&nbsp;<span class="op" id="8203661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8203664">fd</span><span class="op" id="8203666">,</span>&nbsp;<span class="ident" id="8203668">err</span>&nbsp;<span class="op" id="8203672">:=</span>&nbsp;<span class="ident" id="8203675">Dial</span><span class="op" id="8203679">(</span><span class="ident" id="8203680">network</span><span class="op" id="8203687">,</span>&nbsp;<span class="ident" id="8203689">addr</span><span class="op" id="8203693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8203696">if</span>&nbsp;<span class="ident" id="8203699">err</span>&nbsp;<span class="op" id="8203703">!=</span>&nbsp;<span class="ident" id="8203706">nil</span>&nbsp;<span class="op" id="8203710">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8203714">t</span><span class="op" id="8203715">.</span><span class="ident" id="8203716">Errorf</span><span class="op" id="8203722">(</span><span class="string" id="8203723">&#34;Dial(%q,&nbsp;%q,&nbsp;%q)&nbsp;=&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="8203749">,</span>&nbsp;<span class="ident" id="8203751">network</span><span class="op" id="8203758">,</span>&nbsp;<span class="string" id="8203760">&#34;&#34;</span><span class="op" id="8203762">,</span>&nbsp;<span class="ident" id="8203764">addr</span><span class="op" id="8203768">,</span>&nbsp;<span class="ident" id="8203770">err</span><span class="op" id="8203773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8203777">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8203785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8203788">fetchGoogle</span><span class="op" id="8203799">(</span><span class="ident" id="8203800">t</span><span class="op" id="8203801">,</span>&nbsp;<span class="ident" id="8203803">fd</span><span class="op" id="8203805">,</span>&nbsp;<span class="ident" id="8203807">network</span><span class="op" id="8203814">,</span>&nbsp;<span class="ident" id="8203816">addr</span><span class="op" id="8203820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8203823">fd</span><span class="op" id="8203825">.</span><span class="ident" id="8203826">Close</span><span class="op" id="8203831">(</span><span class="op" id="8203832">)</span><br>
<span class="lineno">95</span><span class="op" id="8203834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8203837">var</span>&nbsp;<span class="ident" id="8203841">googleaddrsipv4</span>&nbsp;<span class="op" id="8203857">=</span>&nbsp;<span class="op" id="8203859">[</span><span class="op" id="8203860">]</span><span class="builtintype" id="8203861">string</span><span class="op" id="8203867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8203870">&#34;%d.%d.%d.%d:80&#34;</span><span class="op" id="8203886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8203889">&#34;www.google.com:80&#34;</span><span class="op" id="8203908">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8203911">&#34;%d.%d.%d.%d:http&#34;</span><span class="op" id="8203929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8203932">&#34;www.google.com:http&#34;</span><span class="op" id="8203953">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8203956">&#34;%03d.%03d.%03d.%03d:0080&#34;</span><span class="op" id="8203982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8203985">&#34;[::ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="8204010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8204013">&#34;[::ffff:%02x%02x:%02x%02x]:80&#34;</span><span class="op" id="8204044">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8204047">&#34;[0:0:0:0:0000:ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="8204083">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8204086">&#34;[0:0:0:0:000000:ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="8204124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8204127">&#34;[0:0:0:0::ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="8204159">,</span><br>
<span class="lineno"></span><span class="op" id="8204161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="8204164">func</span>&nbsp;<span class="ident" id="8204169">TestDialGoogleIPv4</span><span class="op" id="8204187">(</span><span class="ident" id="8204188">t</span>&nbsp;<span class="op" id="8204190">*</span><span class="ident" id="8204191">testing</span><span class="op" id="8204198">.</span><span class="ident" id="8204199">T</span><span class="op" id="8204200">)</span>&nbsp;<span class="op" id="8204202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8204205">if</span>&nbsp;<span class="ident" id="8204208">testing</span><span class="op" id="8204215">.</span><span class="ident" id="8204216">Short</span><span class="op" id="8204221">(</span><span class="op" id="8204222">)</span>&nbsp;<span class="op" id="8204224">||</span>&nbsp;<span class="op" id="8204227">!</span><span class="op" id="8204228">*</span><span class="ident" id="8204229">testExternal</span>&nbsp;<span class="op" id="8204242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204246">t</span><span class="op" id="8204247">.</span><span class="ident" id="8204248">Skip</span><span class="op" id="8204252">(</span><span class="string" id="8204253">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="8204294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8204297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8204301">//&nbsp;Insert&nbsp;an&nbsp;actual&nbsp;IPv4&nbsp;address&nbsp;for&nbsp;google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8204350">//&nbsp;into&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204370">addrs</span><span class="op" id="8204375">,</span>&nbsp;<span class="ident" id="8204377">err</span>&nbsp;<span class="op" id="8204381">:=</span>&nbsp;<span class="ident" id="8204384">LookupIP</span><span class="op" id="8204392">(</span><span class="string" id="8204393">&#34;www.google.com&#34;</span><span class="op" id="8204409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8204412">if</span>&nbsp;<span class="ident" id="8204415">err</span>&nbsp;<span class="op" id="8204419">!=</span>&nbsp;<span class="ident" id="8204422">nil</span>&nbsp;<span class="op" id="8204426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204430">t</span><span class="op" id="8204431">.</span><span class="ident" id="8204432">Fatalf</span><span class="op" id="8204438">(</span><span class="string" id="8204439">&#34;lookup&nbsp;www.google.com:&nbsp;%v&#34;</span><span class="op" id="8204466">,</span>&nbsp;<span class="ident" id="8204468">err</span><span class="op" id="8204471">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8204474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8204477">var</span>&nbsp;<span class="ident" id="8204481">ip</span>&nbsp;<span class="ident" id="8204484">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8204488">for</span>&nbsp;<span class="ident" id="8204492">_</span><span class="op" id="8204493">,</span>&nbsp;<span class="ident" id="8204495">addr</span>&nbsp;<span class="op" id="8204500">:=</span>&nbsp;<span class="keyword" id="8204503">range</span>&nbsp;<span class="ident" id="8204509">addrs</span>&nbsp;<span class="op" id="8204515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8204519">if</span>&nbsp;<span class="ident" id="8204522">x</span>&nbsp;<span class="op" id="8204524">:=</span>&nbsp;<span class="ident" id="8204527">addr</span><span class="op" id="8204531">.</span><span class="ident" id="8204532">To4</span><span class="op" id="8204535">(</span><span class="op" id="8204536">)</span><span class="op" id="8204537">;</span>&nbsp;<span class="ident" id="8204539">x</span>&nbsp;<span class="op" id="8204541">!=</span>&nbsp;<span class="ident" id="8204544">nil</span>&nbsp;<span class="op" id="8204548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204553">ip</span>&nbsp;<span class="op" id="8204556">=</span>&nbsp;<span class="ident" id="8204558">x</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8204563">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8204571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8204574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8204577">if</span>&nbsp;<span class="ident" id="8204580">ip</span>&nbsp;<span class="op" id="8204583">==</span>&nbsp;<span class="ident" id="8204586">nil</span>&nbsp;<span class="op" id="8204590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204594">t</span><span class="op" id="8204595">.</span><span class="ident" id="8204596">Fatalf</span><span class="op" id="8204602">(</span><span class="string" id="8204603">&#34;no&nbsp;IPv4&nbsp;addresses&nbsp;for&nbsp;www.google.com&#34;</span><span class="op" id="8204641">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8204644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8204648">for</span>&nbsp;<span class="ident" id="8204652">i</span><span class="op" id="8204653">,</span>&nbsp;<span class="ident" id="8204655">s</span>&nbsp;<span class="op" id="8204657">:=</span>&nbsp;<span class="keyword" id="8204660">range</span>&nbsp;<span class="ident" id="8204666">googleaddrsipv4</span>&nbsp;<span class="op" id="8204682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8204686">if</span>&nbsp;<span class="ident" id="8204689">strings</span><span class="op" id="8204696">.</span><span class="ident" id="8204697">Contains</span><span class="op" id="8204705">(</span><span class="ident" id="8204706">s</span><span class="op" id="8204707">,</span>&nbsp;<span class="string" id="8204709">&#34;%&#34;</span><span class="op" id="8204712">)</span>&nbsp;<span class="op" id="8204714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204719">googleaddrsipv4</span><span class="op" id="8204734">[</span><span class="ident" id="8204735">i</span><span class="op" id="8204736">]</span>&nbsp;<span class="op" id="8204738">=</span>&nbsp;<span class="ident" id="8204740">fmt</span><span class="op" id="8204743">.</span><span class="ident" id="8204744">Sprintf</span><span class="op" id="8204751">(</span><span class="ident" id="8204752">s</span><span class="op" id="8204753">,</span>&nbsp;<span class="ident" id="8204755">ip</span><span class="op" id="8204757">[</span><span class="num" id="8204758">0</span><span class="op" id="8204759">]</span><span class="op" id="8204760">,</span>&nbsp;<span class="ident" id="8204762">ip</span><span class="op" id="8204764">[</span><span class="num" id="8204765">1</span><span class="op" id="8204766">]</span><span class="op" id="8204767">,</span>&nbsp;<span class="ident" id="8204769">ip</span><span class="op" id="8204771">[</span><span class="num" id="8204772">2</span><span class="op" id="8204773">]</span><span class="op" id="8204774">,</span>&nbsp;<span class="ident" id="8204776">ip</span><span class="op" id="8204778">[</span><span class="num" id="8204779">3</span><span class="op" id="8204780">]</span><span class="op" id="8204781">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8204785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8204788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8204792">for</span>&nbsp;<span class="ident" id="8204796">i</span>&nbsp;<span class="op" id="8204798">:=</span>&nbsp;<span class="num" id="8204801">0</span><span class="op" id="8204802">;</span>&nbsp;<span class="ident" id="8204804">i</span>&nbsp;<span class="op" id="8204806">&lt;</span>&nbsp;<span class="builtinfunc" id="8204808">len</span><span class="op" id="8204811">(</span><span class="ident" id="8204812">googleaddrsipv4</span><span class="op" id="8204827">)</span><span class="op" id="8204828">;</span>&nbsp;<span class="ident" id="8204830">i</span><span class="op" id="8204831">++</span>&nbsp;<span class="op" id="8204834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204838">addr</span>&nbsp;<span class="op" id="8204843">:=</span>&nbsp;<span class="ident" id="8204846">googleaddrsipv4</span><span class="op" id="8204861">[</span><span class="ident" id="8204862">i</span><span class="op" id="8204863">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8204867">if</span>&nbsp;<span class="ident" id="8204870">addr</span>&nbsp;<span class="op" id="8204875">==</span>&nbsp;<span class="string" id="8204878">&#34;&#34;</span>&nbsp;<span class="op" id="8204881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8204886">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8204897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204901">t</span><span class="op" id="8204902">.</span><span class="ident" id="8204903">Logf</span><span class="op" id="8204907">(</span><span class="string" id="8204908">&#34;--&nbsp;%s&nbsp;--&#34;</span><span class="op" id="8204918">,</span>&nbsp;<span class="ident" id="8204920">addr</span><span class="op" id="8204924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204928">doDial</span><span class="op" id="8204934">(</span><span class="ident" id="8204935">t</span><span class="op" id="8204936">,</span>&nbsp;<span class="string" id="8204938">&#34;tcp&#34;</span><span class="op" id="8204943">,</span>&nbsp;<span class="ident" id="8204945">addr</span><span class="op" id="8204949">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8204953">if</span>&nbsp;<span class="ident" id="8204956">addr</span><span class="op" id="8204960">[</span><span class="num" id="8204961">0</span><span class="op" id="8204962">]</span>&nbsp;<span class="op" id="8204964">!=</span>&nbsp;<span class="string" id="8204967">&#39;[&#39;</span>&nbsp;<span class="op" id="8204971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8204976">doDial</span><span class="op" id="8204982">(</span><span class="ident" id="8204983">t</span><span class="op" id="8204984">,</span>&nbsp;<span class="string" id="8204986">&#34;tcp4&#34;</span><span class="op" id="8204992">,</span>&nbsp;<span class="ident" id="8204994">addr</span><span class="op" id="8204998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8205003">if</span>&nbsp;<span class="ident" id="8205006">supportsIPv6</span>&nbsp;<span class="op" id="8205019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8205025">//&nbsp;make&nbsp;sure&nbsp;syscall.SocketDisableIPv6&nbsp;flag&nbsp;works.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8205080">syscall</span><span class="op" id="8205087">.</span><span class="ident" id="8205088">SocketDisableIPv6</span>&nbsp;<span class="op" id="8205106">=</span>&nbsp;<span class="builtintype" id="8205108">true</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8205117">doDial</span><span class="op" id="8205123">(</span><span class="ident" id="8205124">t</span><span class="op" id="8205125">,</span>&nbsp;<span class="string" id="8205127">&#34;tcp&#34;</span><span class="op" id="8205132">,</span>&nbsp;<span class="ident" id="8205134">addr</span><span class="op" id="8205138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8205144">doDial</span><span class="op" id="8205150">(</span><span class="ident" id="8205151">t</span><span class="op" id="8205152">,</span>&nbsp;<span class="string" id="8205154">&#34;tcp4&#34;</span><span class="op" id="8205160">,</span>&nbsp;<span class="ident" id="8205162">addr</span><span class="op" id="8205166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8205172">syscall</span><span class="op" id="8205179">.</span><span class="ident" id="8205180">SocketDisableIPv6</span>&nbsp;<span class="op" id="8205198">=</span>&nbsp;<span class="builtintype" id="8205200">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8205209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8205213">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8205216">}</span><br>
<span class="lineno"></span><span class="op" id="8205218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8205221">var</span>&nbsp;<span class="ident" id="8205225">googleaddrsipv6</span>&nbsp;<span class="op" id="8205241">=</span>&nbsp;<span class="op" id="8205243">[</span><span class="op" id="8205244">]</span><span class="builtintype" id="8205245">string</span><span class="op" id="8205251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8205254">&#34;[%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x]:80&#34;</span><span class="op" id="8205332">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8205335">&#34;ipv6.google.com:80&#34;</span><span class="op" id="8205355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8205358">&#34;[%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x]:http&#34;</span><span class="op" id="8205438">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8205441">&#34;ipv6.google.com:http&#34;</span><span class="op" id="8205463">,</span><br>
<span class="lineno"></span><span class="op" id="8205465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="8205468">func</span>&nbsp;<span class="ident" id="8205473">TestDialGoogleIPv6</span><span class="op" id="8205491">(</span><span class="ident" id="8205492">t</span>&nbsp;<span class="op" id="8205494">*</span><span class="ident" id="8205495">testing</span><span class="op" id="8205502">.</span><span class="ident" id="8205503">T</span><span class="op" id="8205504">)</span>&nbsp;<span class="op" id="8205506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8205509">if</span>&nbsp;<span class="ident" id="8205512">testing</span><span class="op" id="8205519">.</span><span class="ident" id="8205520">Short</span><span class="op" id="8205525">(</span><span class="op" id="8205526">)</span>&nbsp;<span class="op" id="8205528">||</span>&nbsp;<span class="op" id="8205531">!</span><span class="op" id="8205532">*</span><span class="ident" id="8205533">testExternal</span>&nbsp;<span class="op" id="8205546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8205550">t</span><span class="op" id="8205551">.</span><span class="ident" id="8205552">Skip</span><span class="op" id="8205556">(</span><span class="string" id="8205557">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="8205598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8205601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8205604">//&nbsp;Only&nbsp;run&nbsp;tcp6&nbsp;if&nbsp;the&nbsp;kernel&nbsp;will&nbsp;take&nbsp;it.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8205650">if</span>&nbsp;<span class="op" id="8205653">!</span><span class="ident" id="8205654">supportsIPv6</span>&nbsp;<span class="op" id="8205667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8205671">t</span><span class="op" id="8205672">.</span><span class="ident" id="8205673">Skip</span><span class="op" id="8205677">(</span><span class="string" id="8205678">&#34;skipping&nbsp;test;&nbsp;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8205716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8205719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8205722">if</span>&nbsp;<span class="op" id="8205725">!</span><span class="op" id="8205726">*</span><span class="ident" id="8205727">testIPv6</span>&nbsp;<span class="op" id="8205736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8205740">t</span><span class="op" id="8205741">.</span><span class="ident" id="8205742">Skip</span><span class="op" id="8205746">(</span><span class="string" id="8205747">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-ipv6&nbsp;to&nbsp;enable&#34;</span><span class="op" id="8205783">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8205786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8205790">//&nbsp;Insert&nbsp;an&nbsp;actual&nbsp;IPv6&nbsp;address&nbsp;for&nbsp;ipv6.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8205844">//&nbsp;into&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8205864">addrs</span><span class="op" id="8205869">,</span>&nbsp;<span class="ident" id="8205871">err</span>&nbsp;<span class="op" id="8205875">:=</span>&nbsp;<span class="ident" id="8205878">LookupIP</span><span class="op" id="8205886">(</span><span class="string" id="8205887">&#34;ipv6.google.com&#34;</span><span class="op" id="8205904">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8205907">if</span>&nbsp;<span class="ident" id="8205910">err</span>&nbsp;<span class="op" id="8205914">!=</span>&nbsp;<span class="ident" id="8205917">nil</span>&nbsp;<span class="op" id="8205921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8205925">t</span><span class="op" id="8205926">.</span><span class="ident" id="8205927">Fatalf</span><span class="op" id="8205933">(</span><span class="string" id="8205934">&#34;lookup&nbsp;ipv6.google.com:&nbsp;%v&#34;</span><span class="op" id="8205962">,</span>&nbsp;<span class="ident" id="8205964">err</span><span class="op" id="8205967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8205970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8205973">var</span>&nbsp;<span class="ident" id="8205977">ip</span>&nbsp;<span class="ident" id="8205980">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8205984">for</span>&nbsp;<span class="ident" id="8205988">_</span><span class="op" id="8205989">,</span>&nbsp;<span class="ident" id="8205991">addr</span>&nbsp;<span class="op" id="8205996">:=</span>&nbsp;<span class="keyword" id="8205999">range</span>&nbsp;<span class="ident" id="8206005">addrs</span>&nbsp;<span class="op" id="8206011">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8206015">if</span>&nbsp;<span class="ident" id="8206018">x</span>&nbsp;<span class="op" id="8206020">:=</span>&nbsp;<span class="ident" id="8206023">addr</span><span class="op" id="8206027">.</span><span class="ident" id="8206028">To16</span><span class="op" id="8206032">(</span><span class="op" id="8206033">)</span><span class="op" id="8206034">;</span>&nbsp;<span class="ident" id="8206036">x</span>&nbsp;<span class="op" id="8206038">!=</span>&nbsp;<span class="ident" id="8206041">nil</span>&nbsp;<span class="op" id="8206045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8206050">ip</span>&nbsp;<span class="op" id="8206053">=</span>&nbsp;<span class="ident" id="8206055">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8206060">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8206068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8206071">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8206074">if</span>&nbsp;<span class="ident" id="8206077">ip</span>&nbsp;<span class="op" id="8206080">==</span>&nbsp;<span class="ident" id="8206083">nil</span>&nbsp;<span class="op" id="8206087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8206091">t</span><span class="op" id="8206092">.</span><span class="ident" id="8206093">Fatalf</span><span class="op" id="8206099">(</span><span class="string" id="8206100">&#34;no&nbsp;IPv6&nbsp;addresses&nbsp;for&nbsp;ipv6.google.com&#34;</span><span class="op" id="8206139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8206142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8206146">for</span>&nbsp;<span class="ident" id="8206150">i</span><span class="op" id="8206151">,</span>&nbsp;<span class="ident" id="8206153">s</span>&nbsp;<span class="op" id="8206155">:=</span>&nbsp;<span class="keyword" id="8206158">range</span>&nbsp;<span class="ident" id="8206164">googleaddrsipv6</span>&nbsp;<span class="op" id="8206180">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8206184">if</span>&nbsp;<span class="ident" id="8206187">strings</span><span class="op" id="8206194">.</span><span class="ident" id="8206195">Contains</span><span class="op" id="8206203">(</span><span class="ident" id="8206204">s</span><span class="op" id="8206205">,</span>&nbsp;<span class="string" id="8206207">&#34;%&#34;</span><span class="op" id="8206210">)</span>&nbsp;<span class="op" id="8206212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8206217">googleaddrsipv6</span><span class="op" id="8206232">[</span><span class="ident" id="8206233">i</span><span class="op" id="8206234">]</span>&nbsp;<span class="op" id="8206236">=</span>&nbsp;<span class="ident" id="8206238">fmt</span><span class="op" id="8206241">.</span><span class="ident" id="8206242">Sprintf</span><span class="op" id="8206249">(</span><span class="ident" id="8206250">s</span><span class="op" id="8206251">,</span>&nbsp;<span class="ident" id="8206253">ip</span><span class="op" id="8206255">[</span><span class="num" id="8206256">0</span><span class="op" id="8206257">]</span><span class="op" id="8206258">,</span>&nbsp;<span class="ident" id="8206260">ip</span><span class="op" id="8206262">[</span><span class="num" id="8206263">1</span><span class="op" id="8206264">]</span><span class="op" id="8206265">,</span>&nbsp;<span class="ident" id="8206267">ip</span><span class="op" id="8206269">[</span><span class="num" id="8206270">2</span><span class="op" id="8206271">]</span><span class="op" id="8206272">,</span>&nbsp;<span class="ident" id="8206274">ip</span><span class="op" id="8206276">[</span><span class="num" id="8206277">3</span><span class="op" id="8206278">]</span><span class="op" id="8206279">,</span>&nbsp;<span class="ident" id="8206281">ip</span><span class="op" id="8206283">[</span><span class="num" id="8206284">4</span><span class="op" id="8206285">]</span><span class="op" id="8206286">,</span>&nbsp;<span class="ident" id="8206288">ip</span><span class="op" id="8206290">[</span><span class="num" id="8206291">5</span><span class="op" id="8206292">]</span><span class="op" id="8206293">,</span>&nbsp;<span class="ident" id="8206295">ip</span><span class="op" id="8206297">[</span><span class="num" id="8206298">6</span><span class="op" id="8206299">]</span><span class="op" id="8206300">,</span>&nbsp;<span class="ident" id="8206302">ip</span><span class="op" id="8206304">[</span><span class="num" id="8206305">7</span><span class="op" id="8206306">]</span><span class="op" id="8206307">,</span>&nbsp;<span class="ident" id="8206309">ip</span><span class="op" id="8206311">[</span><span class="num" id="8206312">8</span><span class="op" id="8206313">]</span><span class="op" id="8206314">,</span>&nbsp;<span class="ident" id="8206316">ip</span><span class="op" id="8206318">[</span><span class="num" id="8206319">9</span><span class="op" id="8206320">]</span><span class="op" id="8206321">,</span>&nbsp;<span class="ident" id="8206323">ip</span><span class="op" id="8206325">[</span><span class="num" id="8206326">10</span><span class="op" id="8206328">]</span><span class="op" id="8206329">,</span>&nbsp;<span class="ident" id="8206331">ip</span><span class="op" id="8206333">[</span><span class="num" id="8206334">11</span><span class="op" id="8206336">]</span><span class="op" id="8206337">,</span>&nbsp;<span class="ident" id="8206339">ip</span><span class="op" id="8206341">[</span><span class="num" id="8206342">12</span><span class="op" id="8206344">]</span><span class="op" id="8206345">,</span>&nbsp;<span class="ident" id="8206347">ip</span><span class="op" id="8206349">[</span><span class="num" id="8206350">13</span><span class="op" id="8206352">]</span><span class="op" id="8206353">,</span>&nbsp;<span class="ident" id="8206355">ip</span><span class="op" id="8206357">[</span><span class="num" id="8206358">14</span><span class="op" id="8206360">]</span><span class="op" id="8206361">,</span>&nbsp;<span class="ident" id="8206363">ip</span><span class="op" id="8206365">[</span><span class="num" id="8206366">15</span><span class="op" id="8206368">]</span><span class="op" id="8206369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8206373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8206376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8206380">for</span>&nbsp;<span class="ident" id="8206384">i</span>&nbsp;<span class="op" id="8206386">:=</span>&nbsp;<span class="num" id="8206389">0</span><span class="op" id="8206390">;</span>&nbsp;<span class="ident" id="8206392">i</span>&nbsp;<span class="op" id="8206394">&lt;</span>&nbsp;<span class="builtinfunc" id="8206396">len</span><span class="op" id="8206399">(</span><span class="ident" id="8206400">googleaddrsipv6</span><span class="op" id="8206415">)</span><span class="op" id="8206416">;</span>&nbsp;<span class="ident" id="8206418">i</span><span class="op" id="8206419">++</span>&nbsp;<span class="op" id="8206422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8206426">addr</span>&nbsp;<span class="op" id="8206431">:=</span>&nbsp;<span class="ident" id="8206434">googleaddrsipv6</span><span class="op" id="8206449">[</span><span class="ident" id="8206450">i</span><span class="op" id="8206451">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8206455">if</span>&nbsp;<span class="ident" id="8206458">addr</span>&nbsp;<span class="op" id="8206463">==</span>&nbsp;<span class="string" id="8206466">&#34;&#34;</span>&nbsp;<span class="op" id="8206469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8206474">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8206485">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8206489">t</span><span class="op" id="8206490">.</span><span class="ident" id="8206491">Logf</span><span class="op" id="8206495">(</span><span class="string" id="8206496">&#34;--&nbsp;%s&nbsp;--&#34;</span><span class="op" id="8206506">,</span>&nbsp;<span class="ident" id="8206508">addr</span><span class="op" id="8206512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8206516">doDial</span><span class="op" id="8206522">(</span><span class="ident" id="8206523">t</span><span class="op" id="8206524">,</span>&nbsp;<span class="string" id="8206526">&#34;tcp&#34;</span><span class="op" id="8206531">,</span>&nbsp;<span class="ident" id="8206533">addr</span><span class="op" id="8206537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8206541">doDial</span><span class="op" id="8206547">(</span><span class="ident" id="8206548">t</span><span class="op" id="8206549">,</span>&nbsp;<span class="string" id="8206551">&#34;tcp6&#34;</span><span class="op" id="8206557">,</span>&nbsp;<span class="ident" id="8206559">addr</span><span class="op" id="8206563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8206566">}</span><br>
<span class="lineno"></span><span class="op" id="8206568">}</span>
</div>
</body>
</html>
