<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html" class="current">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3872514">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3872570">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3872624">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3872675">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3872753">package</span>&nbsp;<span class="ident" id="3872761">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3872766">import</span>&nbsp;<span class="op" id="3872773">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3872776">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3872786">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3872792">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3872803">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3872810">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3872813">func</span>&nbsp;<span class="ident" id="3872818">unixSocket</span><span class="op" id="3872828">(</span><span class="ident" id="3872829">net</span>&nbsp;<span class="builtintype" id="3872833">string</span><span class="op" id="3872839">,</span>&nbsp;<span class="ident" id="3872841">laddr</span><span class="op" id="3872846">,</span>&nbsp;<span class="ident" id="3872848">raddr</span>&nbsp;<span class="ident" id="3872854">sockaddr</span><span class="op" id="3872862">,</span>&nbsp;<span class="ident" id="3872864">mode</span>&nbsp;<span class="builtintype" id="3872869">string</span><span class="op" id="3872875">,</span>&nbsp;<span class="ident" id="3872877">deadline</span>&nbsp;<span class="ident" id="3872886">time</span><span class="op" id="3872890">.</span><span class="ident" id="3872891">Time</span><span class="op" id="3872895">)</span>&nbsp;<span class="op" id="3872897">(</span><span class="op" id="3872898">*</span><span class="ident" id="3872899">netFD</span><span class="op" id="3872904">,</span>&nbsp;<span class="builtintype" id="3872906">error</span><span class="op" id="3872911">)</span>&nbsp;<span class="op" id="3872913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3872916">var</span>&nbsp;<span class="ident" id="3872920">sotype</span>&nbsp;<span class="builtintype" id="3872927">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3872932">switch</span>&nbsp;<span class="ident" id="3872939">net</span>&nbsp;<span class="op" id="3872943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3872946">case</span>&nbsp;<span class="string" id="3872951">&#34;unix&#34;</span><span class="op" id="3872957">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3872961">sotype</span>&nbsp;<span class="op" id="3872968">=</span>&nbsp;<span class="ident" id="3872970">syscall</span><span class="op" id="3872977">.</span><span class="ident" id="3872978">SOCK_STREAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3872991">case</span>&nbsp;<span class="string" id="3872996">&#34;unixgram&#34;</span><span class="op" id="3873006">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3873010">sotype</span>&nbsp;<span class="op" id="3873017">=</span>&nbsp;<span class="ident" id="3873019">syscall</span><span class="op" id="3873026">.</span><span class="ident" id="3873027">SOCK_DGRAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873039">case</span>&nbsp;<span class="string" id="3873044">&#34;unixpacket&#34;</span><span class="op" id="3873056">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3873060">sotype</span>&nbsp;<span class="op" id="3873067">=</span>&nbsp;<span class="ident" id="3873069">syscall</span><span class="op" id="3873076">.</span><span class="ident" id="3873077">SOCK_SEQPACKET</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873093">default</span><span class="op" id="3873100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873104">return</span>&nbsp;<span class="builtintype" id="3873111">nil</span><span class="op" id="3873114">,</span>&nbsp;<span class="ident" id="3873116">UnknownNetworkError</span><span class="op" id="3873135">(</span><span class="ident" id="3873136">net</span><span class="op" id="3873139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3873142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873146">switch</span>&nbsp;<span class="ident" id="3873153">mode</span>&nbsp;<span class="op" id="3873158">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873161">case</span>&nbsp;<span class="string" id="3873166">&#34;dial&#34;</span><span class="op" id="3873172">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873176">if</span>&nbsp;<span class="ident" id="3873179">laddr</span>&nbsp;<span class="op" id="3873185">!=</span>&nbsp;<span class="builtintype" id="3873188">nil</span>&nbsp;<span class="op" id="3873192">&amp;&amp;</span>&nbsp;<span class="ident" id="3873195">laddr</span><span class="op" id="3873200">.</span><span class="ident" id="3873201">isWildcard</span><span class="op" id="3873211">(</span><span class="op" id="3873212">)</span>&nbsp;<span class="op" id="3873214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3873219">laddr</span>&nbsp;<span class="op" id="3873225">=</span>&nbsp;<span class="builtintype" id="3873227">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3873233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873237">if</span>&nbsp;<span class="ident" id="3873240">raddr</span>&nbsp;<span class="op" id="3873246">!=</span>&nbsp;<span class="builtintype" id="3873249">nil</span>&nbsp;<span class="op" id="3873253">&amp;&amp;</span>&nbsp;<span class="ident" id="3873256">raddr</span><span class="op" id="3873261">.</span><span class="ident" id="3873262">isWildcard</span><span class="op" id="3873272">(</span><span class="op" id="3873273">)</span>&nbsp;<span class="op" id="3873275">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3873280">raddr</span>&nbsp;<span class="op" id="3873286">=</span>&nbsp;<span class="builtintype" id="3873288">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3873294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873298">if</span>&nbsp;<span class="ident" id="3873301">raddr</span>&nbsp;<span class="op" id="3873307">==</span>&nbsp;<span class="builtintype" id="3873310">nil</span>&nbsp;<span class="op" id="3873314">&amp;&amp;</span>&nbsp;<span class="op" id="3873317">(</span><span class="ident" id="3873318">sotype</span>&nbsp;<span class="op" id="3873325">!=</span>&nbsp;<span class="ident" id="3873328">syscall</span><span class="op" id="3873335">.</span><span class="ident" id="3873336">SOCK_DGRAM</span>&nbsp;<span class="op" id="3873347">||</span>&nbsp;<span class="ident" id="3873350">laddr</span>&nbsp;<span class="op" id="3873356">==</span>&nbsp;<span class="builtintype" id="3873359">nil</span><span class="op" id="3873362">)</span>&nbsp;<span class="op" id="3873364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873369">return</span>&nbsp;<span class="builtintype" id="3873376">nil</span><span class="op" id="3873379">,</span>&nbsp;<span class="ident" id="3873381">errMissingAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3873401">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873404">case</span>&nbsp;<span class="string" id="3873409">&#34;listen&#34;</span><span class="op" id="3873417">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873420">default</span><span class="op" id="3873427">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873431">return</span>&nbsp;<span class="builtintype" id="3873438">nil</span><span class="op" id="3873441">,</span>&nbsp;<span class="ident" id="3873443">errors</span><span class="op" id="3873449">.</span><span class="ident" id="3873450">New</span><span class="op" id="3873453">(</span><span class="string" id="3873454">&#34;unknown&nbsp;mode:&nbsp;&#34;</span>&nbsp;<span class="op" id="3873471">+</span>&nbsp;<span class="ident" id="3873473">mode</span><span class="op" id="3873477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3873480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3873484">fd</span><span class="op" id="3873486">,</span>&nbsp;<span class="ident" id="3873488">err</span>&nbsp;<span class="op" id="3873492">:=</span>&nbsp;<span class="ident" id="3873495">socket</span><span class="op" id="3873501">(</span><span class="ident" id="3873502">net</span><span class="op" id="3873505">,</span>&nbsp;<span class="ident" id="3873507">syscall</span><span class="op" id="3873514">.</span><span class="ident" id="3873515">AF_UNIX</span><span class="op" id="3873522">,</span>&nbsp;<span class="ident" id="3873524">sotype</span><span class="op" id="3873530">,</span>&nbsp;<span class="num" id="3873532">0</span><span class="op" id="3873533">,</span>&nbsp;<span class="builtintype" id="3873535">false</span><span class="op" id="3873540">,</span>&nbsp;<span class="ident" id="3873542">laddr</span><span class="op" id="3873547">,</span>&nbsp;<span class="ident" id="3873549">raddr</span><span class="op" id="3873554">,</span>&nbsp;<span class="ident" id="3873556">deadline</span><span class="op" id="3873564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873567">if</span>&nbsp;<span class="ident" id="3873570">err</span>&nbsp;<span class="op" id="3873574">!=</span>&nbsp;<span class="builtintype" id="3873577">nil</span>&nbsp;<span class="op" id="3873581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873585">return</span>&nbsp;<span class="builtintype" id="3873592">nil</span><span class="op" id="3873595">,</span>&nbsp;<span class="ident" id="3873597">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3873602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873605">return</span>&nbsp;<span class="ident" id="3873612">fd</span><span class="op" id="3873614">,</span>&nbsp;<span class="builtintype" id="3873616">nil</span><br>
<span class="lineno">50</span><span class="op" id="3873620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3873623">func</span>&nbsp;<span class="ident" id="3873628">sockaddrToUnix</span><span class="op" id="3873642">(</span><span class="ident" id="3873643">sa</span>&nbsp;<span class="ident" id="3873646">syscall</span><span class="op" id="3873653">.</span><span class="ident" id="3873654">Sockaddr</span><span class="op" id="3873662">)</span>&nbsp;<span class="ident" id="3873664">Addr</span>&nbsp;<span class="op" id="3873669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873672">if</span>&nbsp;<span class="ident" id="3873675">s</span><span class="op" id="3873676">,</span>&nbsp;<span class="ident" id="3873678">ok</span>&nbsp;<span class="op" id="3873681">:=</span>&nbsp;<span class="ident" id="3873684">sa</span><span class="op" id="3873686">.</span><span class="op" id="3873687">(</span><span class="op" id="3873688">*</span><span class="ident" id="3873689">syscall</span><span class="op" id="3873696">.</span><span class="ident" id="3873697">SockaddrUnix</span><span class="op" id="3873709">)</span><span class="op" id="3873710">;</span>&nbsp;<span class="ident" id="3873712">ok</span>&nbsp;<span class="op" id="3873715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873719">return</span>&nbsp;<span class="op" id="3873726">&amp;</span><span class="ident" id="3873727">UnixAddr</span><span class="op" id="3873735">{</span><span class="ident" id="3873736">Name</span><span class="op" id="3873740">:</span>&nbsp;<span class="ident" id="3873742">s</span><span class="op" id="3873743">.</span><span class="ident" id="3873744">Name</span><span class="op" id="3873748">,</span>&nbsp;<span class="ident" id="3873750">Net</span><span class="op" id="3873753">:</span>&nbsp;<span class="string" id="3873755">&#34;unix&#34;</span><span class="op" id="3873761">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3873764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873767">return</span>&nbsp;<span class="builtintype" id="3873774">nil</span><br>
<span class="lineno"></span><span class="op" id="3873778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3873781">func</span>&nbsp;<span class="ident" id="3873786">sockaddrToUnixgram</span><span class="op" id="3873804">(</span><span class="ident" id="3873805">sa</span>&nbsp;<span class="ident" id="3873808">syscall</span><span class="op" id="3873815">.</span><span class="ident" id="3873816">Sockaddr</span><span class="op" id="3873824">)</span>&nbsp;<span class="ident" id="3873826">Addr</span>&nbsp;<span class="op" id="3873831">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873834">if</span>&nbsp;<span class="ident" id="3873837">s</span><span class="op" id="3873838">,</span>&nbsp;<span class="ident" id="3873840">ok</span>&nbsp;<span class="op" id="3873843">:=</span>&nbsp;<span class="ident" id="3873846">sa</span><span class="op" id="3873848">.</span><span class="op" id="3873849">(</span><span class="op" id="3873850">*</span><span class="ident" id="3873851">syscall</span><span class="op" id="3873858">.</span><span class="ident" id="3873859">SockaddrUnix</span><span class="op" id="3873871">)</span><span class="op" id="3873872">;</span>&nbsp;<span class="ident" id="3873874">ok</span>&nbsp;<span class="op" id="3873877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873881">return</span>&nbsp;<span class="op" id="3873888">&amp;</span><span class="ident" id="3873889">UnixAddr</span><span class="op" id="3873897">{</span><span class="ident" id="3873898">Name</span><span class="op" id="3873902">:</span>&nbsp;<span class="ident" id="3873904">s</span><span class="op" id="3873905">.</span><span class="ident" id="3873906">Name</span><span class="op" id="3873910">,</span>&nbsp;<span class="ident" id="3873912">Net</span><span class="op" id="3873915">:</span>&nbsp;<span class="string" id="3873917">&#34;unixgram&#34;</span><span class="op" id="3873927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3873930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3873933">return</span>&nbsp;<span class="builtintype" id="3873940">nil</span><br>
<span class="lineno"></span><span class="op" id="3873944">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3873947">func</span>&nbsp;<span class="ident" id="3873952">sockaddrToUnixpacket</span><span class="op" id="3873972">(</span><span class="ident" id="3873973">sa</span>&nbsp;<span class="ident" id="3873976">syscall</span><span class="op" id="3873983">.</span><span class="ident" id="3873984">Sockaddr</span><span class="op" id="3873992">)</span>&nbsp;<span class="ident" id="3873994">Addr</span>&nbsp;<span class="op" id="3873999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874002">if</span>&nbsp;<span class="ident" id="3874005">s</span><span class="op" id="3874006">,</span>&nbsp;<span class="ident" id="3874008">ok</span>&nbsp;<span class="op" id="3874011">:=</span>&nbsp;<span class="ident" id="3874014">sa</span><span class="op" id="3874016">.</span><span class="op" id="3874017">(</span><span class="op" id="3874018">*</span><span class="ident" id="3874019">syscall</span><span class="op" id="3874026">.</span><span class="ident" id="3874027">SockaddrUnix</span><span class="op" id="3874039">)</span><span class="op" id="3874040">;</span>&nbsp;<span class="ident" id="3874042">ok</span>&nbsp;<span class="op" id="3874045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874049">return</span>&nbsp;<span class="op" id="3874056">&amp;</span><span class="ident" id="3874057">UnixAddr</span><span class="op" id="3874065">{</span><span class="ident" id="3874066">Name</span><span class="op" id="3874070">:</span>&nbsp;<span class="ident" id="3874072">s</span><span class="op" id="3874073">.</span><span class="ident" id="3874074">Name</span><span class="op" id="3874078">,</span>&nbsp;<span class="ident" id="3874080">Net</span><span class="op" id="3874083">:</span>&nbsp;<span class="string" id="3874085">&#34;unixpacket&#34;</span><span class="op" id="3874097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3874100">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874103">return</span>&nbsp;<span class="builtintype" id="3874110">nil</span><br>
<span class="lineno"></span><span class="op" id="3874114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3874117">func</span>&nbsp;<span class="ident" id="3874122">sotypeToNet</span><span class="op" id="3874133">(</span><span class="ident" id="3874134">sotype</span>&nbsp;<span class="builtintype" id="3874141">int</span><span class="op" id="3874144">)</span>&nbsp;<span class="builtintype" id="3874146">string</span>&nbsp;<span class="op" id="3874153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874156">switch</span>&nbsp;<span class="ident" id="3874163">sotype</span>&nbsp;<span class="op" id="3874170">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874173">case</span>&nbsp;<span class="ident" id="3874178">syscall</span><span class="op" id="3874185">.</span><span class="ident" id="3874186">SOCK_STREAM</span><span class="op" id="3874197">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874201">return</span>&nbsp;<span class="string" id="3874208">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874216">case</span>&nbsp;<span class="ident" id="3874221">syscall</span><span class="op" id="3874228">.</span><span class="ident" id="3874229">SOCK_DGRAM</span><span class="op" id="3874239">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874243">return</span>&nbsp;<span class="string" id="3874250">&#34;unixgram&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874262">case</span>&nbsp;<span class="ident" id="3874267">syscall</span><span class="op" id="3874274">.</span><span class="ident" id="3874275">SOCK_SEQPACKET</span><span class="op" id="3874289">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874293">return</span>&nbsp;<span class="string" id="3874300">&#34;unixpacket&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874314">default</span><span class="op" id="3874321">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3874325">panic</span><span class="op" id="3874330">(</span><span class="string" id="3874331">&#34;sotypeToNet&nbsp;unknown&nbsp;socket&nbsp;type&#34;</span><span class="op" id="3874364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3874367">}</span><br>
<span class="lineno"></span><span class="op" id="3874369">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="3874372">func</span>&nbsp;<span class="op" id="3874377">(</span><span class="ident" id="3874378">a</span>&nbsp;<span class="op" id="3874380">*</span><span class="ident" id="3874381">UnixAddr</span><span class="op" id="3874389">)</span>&nbsp;<span class="ident" id="3874391">family</span><span class="op" id="3874397">(</span><span class="op" id="3874398">)</span>&nbsp;<span class="builtintype" id="3874400">int</span>&nbsp;<span class="op" id="3874404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874407">return</span>&nbsp;<span class="ident" id="3874414">syscall</span><span class="op" id="3874421">.</span><span class="ident" id="3874422">AF_UNIX</span><br>
<span class="lineno"></span><span class="op" id="3874430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3874433">func</span>&nbsp;<span class="op" id="3874438">(</span><span class="ident" id="3874439">a</span>&nbsp;<span class="op" id="3874441">*</span><span class="ident" id="3874442">UnixAddr</span><span class="op" id="3874450">)</span>&nbsp;<span class="ident" id="3874452">isWildcard</span><span class="op" id="3874462">(</span><span class="op" id="3874463">)</span>&nbsp;<span class="builtintype" id="3874465">bool</span>&nbsp;<span class="op" id="3874470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874473">return</span>&nbsp;<span class="ident" id="3874480">a</span>&nbsp;<span class="op" id="3874482">==</span>&nbsp;<span class="builtintype" id="3874485">nil</span>&nbsp;<span class="op" id="3874489">||</span>&nbsp;<span class="ident" id="3874492">a</span><span class="op" id="3874493">.</span><span class="ident" id="3874494">Name</span>&nbsp;<span class="op" id="3874499">==</span>&nbsp;<span class="string" id="3874502">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3874505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3874508">func</span>&nbsp;<span class="op" id="3874513">(</span><span class="ident" id="3874514">a</span>&nbsp;<span class="op" id="3874516">*</span><span class="ident" id="3874517">UnixAddr</span><span class="op" id="3874525">)</span>&nbsp;<span class="ident" id="3874527">sockaddr</span><span class="op" id="3874535">(</span><span class="ident" id="3874536">family</span>&nbsp;<span class="builtintype" id="3874543">int</span><span class="op" id="3874546">)</span>&nbsp;<span class="op" id="3874548">(</span><span class="ident" id="3874549">syscall</span><span class="op" id="3874556">.</span><span class="ident" id="3874557">Sockaddr</span><span class="op" id="3874565">,</span>&nbsp;<span class="builtintype" id="3874567">error</span><span class="op" id="3874572">)</span>&nbsp;<span class="op" id="3874574">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874577">if</span>&nbsp;<span class="ident" id="3874580">a</span>&nbsp;<span class="op" id="3874582">==</span>&nbsp;<span class="builtintype" id="3874585">nil</span>&nbsp;<span class="op" id="3874589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874593">return</span>&nbsp;<span class="builtintype" id="3874600">nil</span><span class="op" id="3874603">,</span>&nbsp;<span class="builtintype" id="3874605">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3874610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3874613">return</span>&nbsp;<span class="op" id="3874620">&amp;</span><span class="ident" id="3874621">syscall</span><span class="op" id="3874628">.</span><span class="ident" id="3874629">SockaddrUnix</span><span class="op" id="3874641">{</span><span class="ident" id="3874642">Name</span><span class="op" id="3874646">:</span>&nbsp;<span class="ident" id="3874648">a</span><span class="op" id="3874649">.</span><span class="ident" id="3874650">Name</span><span class="op" id="3874654">}</span><span class="op" id="3874655">,</span>&nbsp;<span class="builtintype" id="3874657">nil</span><br>
<span class="lineno"></span><span class="op" id="3874661">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="3874664">//&nbsp;UnixConn&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;interface&nbsp;for&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="3874735">//&nbsp;to&nbsp;Unix&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3874762">type</span>&nbsp;<span class="ident" id="3874767">UnixConn</span>&nbsp;<span class="keyword" id="3874776">struct</span>&nbsp;<span class="op" id="3874783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3874786">conn</span><br>
<span class="lineno">105</span><span class="op" id="3874791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3874794">func</span>&nbsp;<span class="ident" id="3874799">newUnixConn</span><span class="op" id="3874810">(</span><span class="ident" id="3874811">fd</span>&nbsp;<span class="op" id="3874814">*</span><span class="ident" id="3874815">netFD</span><span class="op" id="3874820">)</span>&nbsp;<span class="op" id="3874822">*</span><span class="ident" id="3874823">UnixConn</span>&nbsp;<span class="op" id="3874832">{</span>&nbsp;<span class="keyword" id="3874834">return</span>&nbsp;<span class="op" id="3874841">&amp;</span><span class="ident" id="3874842">UnixConn</span><span class="op" id="3874850">{</span><span class="ident" id="3874851">conn</span><span class="op" id="3874855">{</span><span class="ident" id="3874856">fd</span><span class="op" id="3874858">}</span><span class="op" id="3874859">}</span>&nbsp;<span class="op" id="3874861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3874864">//&nbsp;ReadFromUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.&nbsp;&nbsp;It</span><br>
<span class="lineno">110</span><span class="comment" id="3874935">//&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3875006">//&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3875021">//</span><br>
<span class="lineno"></span><span class="comment" id="3875024">//&nbsp;ReadFromUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3875089">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="3875156">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3875176">func</span>&nbsp;<span class="op" id="3875181">(</span><span class="ident" id="3875182">c</span>&nbsp;<span class="op" id="3875184">*</span><span class="ident" id="3875185">UnixConn</span><span class="op" id="3875193">)</span>&nbsp;<span class="ident" id="3875195">ReadFromUnix</span><span class="op" id="3875207">(</span><span class="ident" id="3875208">b</span>&nbsp;<span class="op" id="3875210">[</span><span class="op" id="3875211">]</span><span class="builtintype" id="3875212">byte</span><span class="op" id="3875216">)</span>&nbsp;<span class="op" id="3875218">(</span><span class="ident" id="3875219">n</span>&nbsp;<span class="builtintype" id="3875221">int</span><span class="op" id="3875224">,</span>&nbsp;<span class="ident" id="3875226">addr</span>&nbsp;<span class="op" id="3875231">*</span><span class="ident" id="3875232">UnixAddr</span><span class="op" id="3875240">,</span>&nbsp;<span class="ident" id="3875242">err</span>&nbsp;<span class="builtintype" id="3875246">error</span><span class="op" id="3875251">)</span>&nbsp;<span class="op" id="3875253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875256">if</span>&nbsp;<span class="op" id="3875259">!</span><span class="ident" id="3875260">c</span><span class="op" id="3875261">.</span><span class="ident" id="3875262">ok</span><span class="op" id="3875264">(</span><span class="op" id="3875265">)</span>&nbsp;<span class="op" id="3875267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875271">return</span>&nbsp;<span class="num" id="3875278">0</span><span class="op" id="3875279">,</span>&nbsp;<span class="builtintype" id="3875281">nil</span><span class="op" id="3875284">,</span>&nbsp;<span class="ident" id="3875286">syscall</span><span class="op" id="3875293">.</span><span class="ident" id="3875294">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3875302">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3875305">n</span><span class="op" id="3875306">,</span>&nbsp;<span class="ident" id="3875308">sa</span><span class="op" id="3875310">,</span>&nbsp;<span class="ident" id="3875312">err</span>&nbsp;<span class="op" id="3875316">:=</span>&nbsp;<span class="ident" id="3875319">c</span><span class="op" id="3875320">.</span><span class="ident" id="3875321">fd</span><span class="op" id="3875323">.</span><span class="ident" id="3875324">readFrom</span><span class="op" id="3875332">(</span><span class="ident" id="3875333">b</span><span class="op" id="3875334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875337">switch</span>&nbsp;<span class="ident" id="3875344">sa</span>&nbsp;<span class="op" id="3875347">:=</span>&nbsp;<span class="ident" id="3875350">sa</span><span class="op" id="3875352">.</span><span class="op" id="3875353">(</span><span class="keyword" id="3875354">type</span><span class="op" id="3875358">)</span>&nbsp;<span class="op" id="3875360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875363">case</span>&nbsp;<span class="op" id="3875368">*</span><span class="ident" id="3875369">syscall</span><span class="op" id="3875376">.</span><span class="ident" id="3875377">SockaddrUnix</span><span class="op" id="3875389">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875393">if</span>&nbsp;<span class="ident" id="3875396">sa</span><span class="op" id="3875398">.</span><span class="ident" id="3875399">Name</span>&nbsp;<span class="op" id="3875404">!=</span>&nbsp;<span class="string" id="3875407">&#34;&#34;</span>&nbsp;<span class="op" id="3875410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3875415">addr</span>&nbsp;<span class="op" id="3875420">=</span>&nbsp;<span class="op" id="3875422">&amp;</span><span class="ident" id="3875423">UnixAddr</span><span class="op" id="3875431">{</span><span class="ident" id="3875432">Name</span><span class="op" id="3875436">:</span>&nbsp;<span class="ident" id="3875438">sa</span><span class="op" id="3875440">.</span><span class="ident" id="3875441">Name</span><span class="op" id="3875445">,</span>&nbsp;<span class="ident" id="3875447">Net</span><span class="op" id="3875450">:</span>&nbsp;<span class="ident" id="3875452">sotypeToNet</span><span class="op" id="3875463">(</span><span class="ident" id="3875464">c</span><span class="op" id="3875465">.</span><span class="ident" id="3875466">fd</span><span class="op" id="3875468">.</span><span class="ident" id="3875469">sotype</span><span class="op" id="3875475">)</span><span class="op" id="3875476">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3875480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3875483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875486">return</span><br>
<span class="lineno"></span><span class="op" id="3875493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3875496">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3875551">func</span>&nbsp;<span class="op" id="3875556">(</span><span class="ident" id="3875557">c</span>&nbsp;<span class="op" id="3875559">*</span><span class="ident" id="3875560">UnixConn</span><span class="op" id="3875568">)</span>&nbsp;<span class="ident" id="3875570">ReadFrom</span><span class="op" id="3875578">(</span><span class="ident" id="3875579">b</span>&nbsp;<span class="op" id="3875581">[</span><span class="op" id="3875582">]</span><span class="builtintype" id="3875583">byte</span><span class="op" id="3875587">)</span>&nbsp;<span class="op" id="3875589">(</span><span class="builtintype" id="3875590">int</span><span class="op" id="3875593">,</span>&nbsp;<span class="ident" id="3875595">Addr</span><span class="op" id="3875599">,</span>&nbsp;<span class="builtintype" id="3875601">error</span><span class="op" id="3875606">)</span>&nbsp;<span class="op" id="3875608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875611">if</span>&nbsp;<span class="op" id="3875614">!</span><span class="ident" id="3875615">c</span><span class="op" id="3875616">.</span><span class="ident" id="3875617">ok</span><span class="op" id="3875619">(</span><span class="op" id="3875620">)</span>&nbsp;<span class="op" id="3875622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875626">return</span>&nbsp;<span class="num" id="3875633">0</span><span class="op" id="3875634">,</span>&nbsp;<span class="builtintype" id="3875636">nil</span><span class="op" id="3875639">,</span>&nbsp;<span class="ident" id="3875641">syscall</span><span class="op" id="3875648">.</span><span class="ident" id="3875649">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3875657">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3875660">n</span><span class="op" id="3875661">,</span>&nbsp;<span class="ident" id="3875663">addr</span><span class="op" id="3875667">,</span>&nbsp;<span class="ident" id="3875669">err</span>&nbsp;<span class="op" id="3875673">:=</span>&nbsp;<span class="ident" id="3875676">c</span><span class="op" id="3875677">.</span><span class="ident" id="3875678">ReadFromUnix</span><span class="op" id="3875690">(</span><span class="ident" id="3875691">b</span><span class="op" id="3875692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3875695">return</span>&nbsp;<span class="ident" id="3875702">n</span><span class="op" id="3875703">,</span>&nbsp;<span class="ident" id="3875705">addr</span><span class="op" id="3875709">.</span><span class="ident" id="3875710">toAddr</span><span class="op" id="3875716">(</span><span class="op" id="3875717">)</span><span class="op" id="3875718">,</span>&nbsp;<span class="ident" id="3875720">err</span><br>
<span class="lineno"></span><span class="op" id="3875724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3875727">//&nbsp;ReadMsgUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno">140</span><span class="comment" id="3875796">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3875867">//&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the&nbsp;flags</span><br>
<span class="lineno"></span><span class="comment" id="3875938">//&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet,&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="3876008">func</span>&nbsp;<span class="op" id="3876013">(</span><span class="ident" id="3876014">c</span>&nbsp;<span class="op" id="3876016">*</span><span class="ident" id="3876017">UnixConn</span><span class="op" id="3876025">)</span>&nbsp;<span class="ident" id="3876027">ReadMsgUnix</span><span class="op" id="3876038">(</span><span class="ident" id="3876039">b</span><span class="op" id="3876040">,</span>&nbsp;<span class="ident" id="3876042">oob</span>&nbsp;<span class="op" id="3876046">[</span><span class="op" id="3876047">]</span><span class="builtintype" id="3876048">byte</span><span class="op" id="3876052">)</span>&nbsp;<span class="op" id="3876054">(</span><span class="ident" id="3876055">n</span><span class="op" id="3876056">,</span>&nbsp;<span class="ident" id="3876058">oobn</span><span class="op" id="3876062">,</span>&nbsp;<span class="ident" id="3876064">flags</span>&nbsp;<span class="builtintype" id="3876070">int</span><span class="op" id="3876073">,</span>&nbsp;<span class="ident" id="3876075">addr</span>&nbsp;<span class="op" id="3876080">*</span><span class="ident" id="3876081">UnixAddr</span><span class="op" id="3876089">,</span>&nbsp;<span class="ident" id="3876091">err</span>&nbsp;<span class="builtintype" id="3876095">error</span><span class="op" id="3876100">)</span>&nbsp;<span class="op" id="3876102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876105">if</span>&nbsp;<span class="op" id="3876108">!</span><span class="ident" id="3876109">c</span><span class="op" id="3876110">.</span><span class="ident" id="3876111">ok</span><span class="op" id="3876113">(</span><span class="op" id="3876114">)</span>&nbsp;<span class="op" id="3876116">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876120">return</span>&nbsp;<span class="num" id="3876127">0</span><span class="op" id="3876128">,</span>&nbsp;<span class="num" id="3876130">0</span><span class="op" id="3876131">,</span>&nbsp;<span class="num" id="3876133">0</span><span class="op" id="3876134">,</span>&nbsp;<span class="builtintype" id="3876136">nil</span><span class="op" id="3876139">,</span>&nbsp;<span class="ident" id="3876141">syscall</span><span class="op" id="3876148">.</span><span class="ident" id="3876149">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3876157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3876160">n</span><span class="op" id="3876161">,</span>&nbsp;<span class="ident" id="3876163">oobn</span><span class="op" id="3876167">,</span>&nbsp;<span class="ident" id="3876169">flags</span><span class="op" id="3876174">,</span>&nbsp;<span class="ident" id="3876176">sa</span><span class="op" id="3876178">,</span>&nbsp;<span class="ident" id="3876180">err</span>&nbsp;<span class="op" id="3876184">:=</span>&nbsp;<span class="ident" id="3876187">c</span><span class="op" id="3876188">.</span><span class="ident" id="3876189">fd</span><span class="op" id="3876191">.</span><span class="ident" id="3876192">readMsg</span><span class="op" id="3876199">(</span><span class="ident" id="3876200">b</span><span class="op" id="3876201">,</span>&nbsp;<span class="ident" id="3876203">oob</span><span class="op" id="3876206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876209">switch</span>&nbsp;<span class="ident" id="3876216">sa</span>&nbsp;<span class="op" id="3876219">:=</span>&nbsp;<span class="ident" id="3876222">sa</span><span class="op" id="3876224">.</span><span class="op" id="3876225">(</span><span class="keyword" id="3876226">type</span><span class="op" id="3876230">)</span>&nbsp;<span class="op" id="3876232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876235">case</span>&nbsp;<span class="op" id="3876240">*</span><span class="ident" id="3876241">syscall</span><span class="op" id="3876248">.</span><span class="ident" id="3876249">SockaddrUnix</span><span class="op" id="3876261">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876265">if</span>&nbsp;<span class="ident" id="3876268">sa</span><span class="op" id="3876270">.</span><span class="ident" id="3876271">Name</span>&nbsp;<span class="op" id="3876276">!=</span>&nbsp;<span class="string" id="3876279">&#34;&#34;</span>&nbsp;<span class="op" id="3876282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3876287">addr</span>&nbsp;<span class="op" id="3876292">=</span>&nbsp;<span class="op" id="3876294">&amp;</span><span class="ident" id="3876295">UnixAddr</span><span class="op" id="3876303">{</span><span class="ident" id="3876304">Name</span><span class="op" id="3876308">:</span>&nbsp;<span class="ident" id="3876310">sa</span><span class="op" id="3876312">.</span><span class="ident" id="3876313">Name</span><span class="op" id="3876317">,</span>&nbsp;<span class="ident" id="3876319">Net</span><span class="op" id="3876322">:</span>&nbsp;<span class="ident" id="3876324">sotypeToNet</span><span class="op" id="3876335">(</span><span class="ident" id="3876336">c</span><span class="op" id="3876337">.</span><span class="ident" id="3876338">fd</span><span class="op" id="3876340">.</span><span class="ident" id="3876341">sotype</span><span class="op" id="3876347">)</span><span class="op" id="3876348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3876352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3876355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876358">return</span><br>
<span class="lineno">155</span><span class="op" id="3876365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3876368">//&nbsp;WriteToUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3876442">//</span><br>
<span class="lineno"></span><span class="comment" id="3876445">//&nbsp;WriteToUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">160</span><span class="comment" id="3876509">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3876576">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3876645">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3876658">func</span>&nbsp;<span class="op" id="3876663">(</span><span class="ident" id="3876664">c</span>&nbsp;<span class="op" id="3876666">*</span><span class="ident" id="3876667">UnixConn</span><span class="op" id="3876675">)</span>&nbsp;<span class="ident" id="3876677">WriteToUnix</span><span class="op" id="3876688">(</span><span class="ident" id="3876689">b</span>&nbsp;<span class="op" id="3876691">[</span><span class="op" id="3876692">]</span><span class="builtintype" id="3876693">byte</span><span class="op" id="3876697">,</span>&nbsp;<span class="ident" id="3876699">addr</span>&nbsp;<span class="op" id="3876704">*</span><span class="ident" id="3876705">UnixAddr</span><span class="op" id="3876713">)</span>&nbsp;<span class="op" id="3876715">(</span><span class="ident" id="3876716">n</span>&nbsp;<span class="builtintype" id="3876718">int</span><span class="op" id="3876721">,</span>&nbsp;<span class="ident" id="3876723">err</span>&nbsp;<span class="builtintype" id="3876727">error</span><span class="op" id="3876732">)</span>&nbsp;<span class="op" id="3876734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876737">if</span>&nbsp;<span class="op" id="3876740">!</span><span class="ident" id="3876741">c</span><span class="op" id="3876742">.</span><span class="ident" id="3876743">ok</span><span class="op" id="3876745">(</span><span class="op" id="3876746">)</span>&nbsp;<span class="op" id="3876748">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876752">return</span>&nbsp;<span class="num" id="3876759">0</span><span class="op" id="3876760">,</span>&nbsp;<span class="ident" id="3876762">syscall</span><span class="op" id="3876769">.</span><span class="ident" id="3876770">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3876778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876781">if</span>&nbsp;<span class="ident" id="3876784">c</span><span class="op" id="3876785">.</span><span class="ident" id="3876786">fd</span><span class="op" id="3876788">.</span><span class="ident" id="3876789">isConnected</span>&nbsp;<span class="op" id="3876801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876805">return</span>&nbsp;<span class="num" id="3876812">0</span><span class="op" id="3876813">,</span>&nbsp;<span class="op" id="3876815">&amp;</span><span class="ident" id="3876816">OpError</span><span class="op" id="3876823">{</span><span class="ident" id="3876824">Op</span><span class="op" id="3876826">:</span>&nbsp;<span class="string" id="3876828">&#34;write&#34;</span><span class="op" id="3876835">,</span>&nbsp;<span class="ident" id="3876837">Net</span><span class="op" id="3876840">:</span>&nbsp;<span class="ident" id="3876842">c</span><span class="op" id="3876843">.</span><span class="ident" id="3876844">fd</span><span class="op" id="3876846">.</span><span class="ident" id="3876847">net</span><span class="op" id="3876850">,</span>&nbsp;<span class="ident" id="3876852">Addr</span><span class="op" id="3876856">:</span>&nbsp;<span class="ident" id="3876858">addr</span><span class="op" id="3876862">,</span>&nbsp;<span class="ident" id="3876864">Err</span><span class="op" id="3876867">:</span>&nbsp;<span class="ident" id="3876869">ErrWriteToConnected</span><span class="op" id="3876888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3876891">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876894">if</span>&nbsp;<span class="ident" id="3876897">addr</span>&nbsp;<span class="op" id="3876902">==</span>&nbsp;<span class="builtintype" id="3876905">nil</span>&nbsp;<span class="op" id="3876909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876913">return</span>&nbsp;<span class="num" id="3876920">0</span><span class="op" id="3876921">,</span>&nbsp;<span class="op" id="3876923">&amp;</span><span class="ident" id="3876924">OpError</span><span class="op" id="3876931">{</span><span class="ident" id="3876932">Op</span><span class="op" id="3876934">:</span>&nbsp;<span class="string" id="3876936">&#34;write&#34;</span><span class="op" id="3876943">,</span>&nbsp;<span class="ident" id="3876945">Net</span><span class="op" id="3876948">:</span>&nbsp;<span class="ident" id="3876950">c</span><span class="op" id="3876951">.</span><span class="ident" id="3876952">fd</span><span class="op" id="3876954">.</span><span class="ident" id="3876955">net</span><span class="op" id="3876958">,</span>&nbsp;<span class="ident" id="3876960">Addr</span><span class="op" id="3876964">:</span>&nbsp;<span class="builtintype" id="3876966">nil</span><span class="op" id="3876969">,</span>&nbsp;<span class="ident" id="3876971">Err</span><span class="op" id="3876974">:</span>&nbsp;<span class="ident" id="3876976">errMissingAddress</span><span class="op" id="3876993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3876996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3876999">if</span>&nbsp;<span class="ident" id="3877002">addr</span><span class="op" id="3877006">.</span><span class="ident" id="3877007">Net</span>&nbsp;<span class="op" id="3877011">!=</span>&nbsp;<span class="ident" id="3877014">sotypeToNet</span><span class="op" id="3877025">(</span><span class="ident" id="3877026">c</span><span class="op" id="3877027">.</span><span class="ident" id="3877028">fd</span><span class="op" id="3877030">.</span><span class="ident" id="3877031">sotype</span><span class="op" id="3877037">)</span>&nbsp;<span class="op" id="3877039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877043">return</span>&nbsp;<span class="num" id="3877050">0</span><span class="op" id="3877051">,</span>&nbsp;<span class="ident" id="3877053">syscall</span><span class="op" id="3877060">.</span><span class="ident" id="3877061">EAFNOSUPPORT</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3877075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3877078">sa</span>&nbsp;<span class="op" id="3877081">:=</span>&nbsp;<span class="op" id="3877084">&amp;</span><span class="ident" id="3877085">syscall</span><span class="op" id="3877092">.</span><span class="ident" id="3877093">SockaddrUnix</span><span class="op" id="3877105">{</span><span class="ident" id="3877106">Name</span><span class="op" id="3877110">:</span>&nbsp;<span class="ident" id="3877112">addr</span><span class="op" id="3877116">.</span><span class="ident" id="3877117">Name</span><span class="op" id="3877121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877124">return</span>&nbsp;<span class="ident" id="3877131">c</span><span class="op" id="3877132">.</span><span class="ident" id="3877133">fd</span><span class="op" id="3877135">.</span><span class="ident" id="3877136">writeTo</span><span class="op" id="3877143">(</span><span class="ident" id="3877144">b</span><span class="op" id="3877145">,</span>&nbsp;<span class="ident" id="3877147">sa</span><span class="op" id="3877149">)</span><br>
<span class="lineno"></span><span class="op" id="3877151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="3877154">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3877207">func</span>&nbsp;<span class="op" id="3877212">(</span><span class="ident" id="3877213">c</span>&nbsp;<span class="op" id="3877215">*</span><span class="ident" id="3877216">UnixConn</span><span class="op" id="3877224">)</span>&nbsp;<span class="ident" id="3877226">WriteTo</span><span class="op" id="3877233">(</span><span class="ident" id="3877234">b</span>&nbsp;<span class="op" id="3877236">[</span><span class="op" id="3877237">]</span><span class="builtintype" id="3877238">byte</span><span class="op" id="3877242">,</span>&nbsp;<span class="ident" id="3877244">addr</span>&nbsp;<span class="ident" id="3877249">Addr</span><span class="op" id="3877253">)</span>&nbsp;<span class="op" id="3877255">(</span><span class="ident" id="3877256">n</span>&nbsp;<span class="builtintype" id="3877258">int</span><span class="op" id="3877261">,</span>&nbsp;<span class="ident" id="3877263">err</span>&nbsp;<span class="builtintype" id="3877267">error</span><span class="op" id="3877272">)</span>&nbsp;<span class="op" id="3877274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877277">if</span>&nbsp;<span class="op" id="3877280">!</span><span class="ident" id="3877281">c</span><span class="op" id="3877282">.</span><span class="ident" id="3877283">ok</span><span class="op" id="3877285">(</span><span class="op" id="3877286">)</span>&nbsp;<span class="op" id="3877288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877292">return</span>&nbsp;<span class="num" id="3877299">0</span><span class="op" id="3877300">,</span>&nbsp;<span class="ident" id="3877302">syscall</span><span class="op" id="3877309">.</span><span class="ident" id="3877310">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3877318">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3877321">a</span><span class="op" id="3877322">,</span>&nbsp;<span class="ident" id="3877324">ok</span>&nbsp;<span class="op" id="3877327">:=</span>&nbsp;<span class="ident" id="3877330">addr</span><span class="op" id="3877334">.</span><span class="op" id="3877335">(</span><span class="op" id="3877336">*</span><span class="ident" id="3877337">UnixAddr</span><span class="op" id="3877345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877348">if</span>&nbsp;<span class="op" id="3877351">!</span><span class="ident" id="3877352">ok</span>&nbsp;<span class="op" id="3877355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877359">return</span>&nbsp;<span class="num" id="3877366">0</span><span class="op" id="3877367">,</span>&nbsp;<span class="op" id="3877369">&amp;</span><span class="ident" id="3877370">OpError</span><span class="op" id="3877377">{</span><span class="string" id="3877378">&#34;write&#34;</span><span class="op" id="3877385">,</span>&nbsp;<span class="ident" id="3877387">c</span><span class="op" id="3877388">.</span><span class="ident" id="3877389">fd</span><span class="op" id="3877391">.</span><span class="ident" id="3877392">net</span><span class="op" id="3877395">,</span>&nbsp;<span class="ident" id="3877397">addr</span><span class="op" id="3877401">,</span>&nbsp;<span class="ident" id="3877403">syscall</span><span class="op" id="3877410">.</span><span class="ident" id="3877411">EINVAL</span><span class="op" id="3877417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3877420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877423">return</span>&nbsp;<span class="ident" id="3877430">c</span><span class="op" id="3877431">.</span><span class="ident" id="3877432">WriteToUnix</span><span class="op" id="3877443">(</span><span class="ident" id="3877444">b</span><span class="op" id="3877445">,</span>&nbsp;<span class="ident" id="3877447">a</span><span class="op" id="3877448">)</span><br>
<span class="lineno">190</span><span class="op" id="3877450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3877453">//&nbsp;WriteMsgUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3877520">//&nbsp;from&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3877588">//&nbsp;the&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">195</span><span class="keyword" id="3877644">func</span>&nbsp;<span class="op" id="3877649">(</span><span class="ident" id="3877650">c</span>&nbsp;<span class="op" id="3877652">*</span><span class="ident" id="3877653">UnixConn</span><span class="op" id="3877661">)</span>&nbsp;<span class="ident" id="3877663">WriteMsgUnix</span><span class="op" id="3877675">(</span><span class="ident" id="3877676">b</span><span class="op" id="3877677">,</span>&nbsp;<span class="ident" id="3877679">oob</span>&nbsp;<span class="op" id="3877683">[</span><span class="op" id="3877684">]</span><span class="builtintype" id="3877685">byte</span><span class="op" id="3877689">,</span>&nbsp;<span class="ident" id="3877691">addr</span>&nbsp;<span class="op" id="3877696">*</span><span class="ident" id="3877697">UnixAddr</span><span class="op" id="3877705">)</span>&nbsp;<span class="op" id="3877707">(</span><span class="ident" id="3877708">n</span><span class="op" id="3877709">,</span>&nbsp;<span class="ident" id="3877711">oobn</span>&nbsp;<span class="builtintype" id="3877716">int</span><span class="op" id="3877719">,</span>&nbsp;<span class="ident" id="3877721">err</span>&nbsp;<span class="builtintype" id="3877725">error</span><span class="op" id="3877730">)</span>&nbsp;<span class="op" id="3877732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877735">if</span>&nbsp;<span class="op" id="3877738">!</span><span class="ident" id="3877739">c</span><span class="op" id="3877740">.</span><span class="ident" id="3877741">ok</span><span class="op" id="3877743">(</span><span class="op" id="3877744">)</span>&nbsp;<span class="op" id="3877746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877750">return</span>&nbsp;<span class="num" id="3877757">0</span><span class="op" id="3877758">,</span>&nbsp;<span class="num" id="3877760">0</span><span class="op" id="3877761">,</span>&nbsp;<span class="ident" id="3877763">syscall</span><span class="op" id="3877770">.</span><span class="ident" id="3877771">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3877779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877782">if</span>&nbsp;<span class="ident" id="3877785">c</span><span class="op" id="3877786">.</span><span class="ident" id="3877787">fd</span><span class="op" id="3877789">.</span><span class="ident" id="3877790">sotype</span>&nbsp;<span class="op" id="3877797">==</span>&nbsp;<span class="ident" id="3877800">syscall</span><span class="op" id="3877807">.</span><span class="ident" id="3877808">SOCK_DGRAM</span>&nbsp;<span class="op" id="3877819">&amp;&amp;</span>&nbsp;<span class="ident" id="3877822">c</span><span class="op" id="3877823">.</span><span class="ident" id="3877824">fd</span><span class="op" id="3877826">.</span><span class="ident" id="3877827">isConnected</span>&nbsp;<span class="op" id="3877839">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877843">return</span>&nbsp;<span class="num" id="3877850">0</span><span class="op" id="3877851">,</span>&nbsp;<span class="num" id="3877853">0</span><span class="op" id="3877854">,</span>&nbsp;<span class="op" id="3877856">&amp;</span><span class="ident" id="3877857">OpError</span><span class="op" id="3877864">{</span><span class="ident" id="3877865">Op</span><span class="op" id="3877867">:</span>&nbsp;<span class="string" id="3877869">&#34;write&#34;</span><span class="op" id="3877876">,</span>&nbsp;<span class="ident" id="3877878">Net</span><span class="op" id="3877881">:</span>&nbsp;<span class="ident" id="3877883">c</span><span class="op" id="3877884">.</span><span class="ident" id="3877885">fd</span><span class="op" id="3877887">.</span><span class="ident" id="3877888">net</span><span class="op" id="3877891">,</span>&nbsp;<span class="ident" id="3877893">Addr</span><span class="op" id="3877897">:</span>&nbsp;<span class="ident" id="3877899">addr</span><span class="op" id="3877903">,</span>&nbsp;<span class="ident" id="3877905">Err</span><span class="op" id="3877908">:</span>&nbsp;<span class="ident" id="3877910">ErrWriteToConnected</span><span class="op" id="3877929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3877932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877935">if</span>&nbsp;<span class="ident" id="3877938">addr</span>&nbsp;<span class="op" id="3877943">!=</span>&nbsp;<span class="builtintype" id="3877946">nil</span>&nbsp;<span class="op" id="3877950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877954">if</span>&nbsp;<span class="ident" id="3877957">addr</span><span class="op" id="3877961">.</span><span class="ident" id="3877962">Net</span>&nbsp;<span class="op" id="3877966">!=</span>&nbsp;<span class="ident" id="3877969">sotypeToNet</span><span class="op" id="3877980">(</span><span class="ident" id="3877981">c</span><span class="op" id="3877982">.</span><span class="ident" id="3877983">fd</span><span class="op" id="3877985">.</span><span class="ident" id="3877986">sotype</span><span class="op" id="3877992">)</span>&nbsp;<span class="op" id="3877994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3877999">return</span>&nbsp;<span class="num" id="3878006">0</span><span class="op" id="3878007">,</span>&nbsp;<span class="num" id="3878009">0</span><span class="op" id="3878010">,</span>&nbsp;<span class="ident" id="3878012">syscall</span><span class="op" id="3878019">.</span><span class="ident" id="3878020">EAFNOSUPPORT</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3878035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3878039">sa</span>&nbsp;<span class="op" id="3878042">:=</span>&nbsp;<span class="op" id="3878045">&amp;</span><span class="ident" id="3878046">syscall</span><span class="op" id="3878053">.</span><span class="ident" id="3878054">SockaddrUnix</span><span class="op" id="3878066">{</span><span class="ident" id="3878067">Name</span><span class="op" id="3878071">:</span>&nbsp;<span class="ident" id="3878073">addr</span><span class="op" id="3878077">.</span><span class="ident" id="3878078">Name</span><span class="op" id="3878082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3878086">return</span>&nbsp;<span class="ident" id="3878093">c</span><span class="op" id="3878094">.</span><span class="ident" id="3878095">fd</span><span class="op" id="3878097">.</span><span class="ident" id="3878098">writeMsg</span><span class="op" id="3878106">(</span><span class="ident" id="3878107">b</span><span class="op" id="3878108">,</span>&nbsp;<span class="ident" id="3878110">oob</span><span class="op" id="3878113">,</span>&nbsp;<span class="ident" id="3878115">sa</span><span class="op" id="3878117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3878120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3878123">return</span>&nbsp;<span class="ident" id="3878130">c</span><span class="op" id="3878131">.</span><span class="ident" id="3878132">fd</span><span class="op" id="3878134">.</span><span class="ident" id="3878135">writeMsg</span><span class="op" id="3878143">(</span><span class="ident" id="3878144">b</span><span class="op" id="3878145">,</span>&nbsp;<span class="ident" id="3878147">oob</span><span class="op" id="3878150">,</span>&nbsp;<span class="builtintype" id="3878152">nil</span><span class="op" id="3878155">)</span><br>
<span class="lineno">210</span><span class="op" id="3878157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3878160">//&nbsp;CloseRead&nbsp;shuts&nbsp;down&nbsp;the&nbsp;reading&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3878232">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3878271">func</span>&nbsp;<span class="op" id="3878276">(</span><span class="ident" id="3878277">c</span>&nbsp;<span class="op" id="3878279">*</span><span class="ident" id="3878280">UnixConn</span><span class="op" id="3878288">)</span>&nbsp;<span class="ident" id="3878290">CloseRead</span><span class="op" id="3878299">(</span><span class="op" id="3878300">)</span>&nbsp;<span class="builtintype" id="3878302">error</span>&nbsp;<span class="op" id="3878308">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3878311">if</span>&nbsp;<span class="op" id="3878314">!</span><span class="ident" id="3878315">c</span><span class="op" id="3878316">.</span><span class="ident" id="3878317">ok</span><span class="op" id="3878319">(</span><span class="op" id="3878320">)</span>&nbsp;<span class="op" id="3878322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3878326">return</span>&nbsp;<span class="ident" id="3878333">syscall</span><span class="op" id="3878340">.</span><span class="ident" id="3878341">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3878349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3878352">return</span>&nbsp;<span class="ident" id="3878359">c</span><span class="op" id="3878360">.</span><span class="ident" id="3878361">fd</span><span class="op" id="3878363">.</span><span class="ident" id="3878364">closeRead</span><span class="op" id="3878373">(</span><span class="op" id="3878374">)</span><br>
<span class="lineno"></span><span class="op" id="3878376">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3878379">//&nbsp;CloseWrite&nbsp;shuts&nbsp;down&nbsp;the&nbsp;writing&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3878452">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3878491">func</span>&nbsp;<span class="op" id="3878496">(</span><span class="ident" id="3878497">c</span>&nbsp;<span class="op" id="3878499">*</span><span class="ident" id="3878500">UnixConn</span><span class="op" id="3878508">)</span>&nbsp;<span class="ident" id="3878510">CloseWrite</span><span class="op" id="3878520">(</span><span class="op" id="3878521">)</span>&nbsp;<span class="builtintype" id="3878523">error</span>&nbsp;<span class="op" id="3878529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3878532">if</span>&nbsp;<span class="op" id="3878535">!</span><span class="ident" id="3878536">c</span><span class="op" id="3878537">.</span><span class="ident" id="3878538">ok</span><span class="op" id="3878540">(</span><span class="op" id="3878541">)</span>&nbsp;<span class="op" id="3878543">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3878547">return</span>&nbsp;<span class="ident" id="3878554">syscall</span><span class="op" id="3878561">.</span><span class="ident" id="3878562">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3878570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3878573">return</span>&nbsp;<span class="ident" id="3878580">c</span><span class="op" id="3878581">.</span><span class="ident" id="3878582">fd</span><span class="op" id="3878584">.</span><span class="ident" id="3878585">closeWrite</span><span class="op" id="3878595">(</span><span class="op" id="3878596">)</span><br>
<span class="lineno"></span><span class="op" id="3878598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="3878601">//&nbsp;DialUnix&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3878670">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3878740">//&nbsp;nil,&nbsp;it&nbsp;is&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3878800">func</span>&nbsp;<span class="ident" id="3878805">DialUnix</span><span class="op" id="3878813">(</span><span class="ident" id="3878814">net</span>&nbsp;<span class="builtintype" id="3878818">string</span><span class="op" id="3878824">,</span>&nbsp;<span class="ident" id="3878826">laddr</span><span class="op" id="3878831">,</span>&nbsp;<span class="ident" id="3878833">raddr</span>&nbsp;<span class="op" id="3878839">*</span><span class="ident" id="3878840">UnixAddr</span><span class="op" id="3878848">)</span>&nbsp;<span class="op" id="3878850">(</span><span class="op" id="3878851">*</span><span class="ident" id="3878852">UnixConn</span><span class="op" id="3878860">,</span>&nbsp;<span class="builtintype" id="3878862">error</span><span class="op" id="3878867">)</span>&nbsp;<span class="op" id="3878869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3878872">switch</span>&nbsp;<span class="ident" id="3878879">net</span>&nbsp;<span class="op" id="3878883">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3878886">case</span>&nbsp;<span class="string" id="3878891">&#34;unix&#34;</span><span class="op" id="3878897">,</span>&nbsp;<span class="string" id="3878899">&#34;unixgram&#34;</span><span class="op" id="3878909">,</span>&nbsp;<span class="string" id="3878911">&#34;unixpacket&#34;</span><span class="op" id="3878923">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3878926">default</span><span class="op" id="3878933">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3878937">return</span>&nbsp;<span class="builtintype" id="3878944">nil</span><span class="op" id="3878947">,</span>&nbsp;<span class="op" id="3878949">&amp;</span><span class="ident" id="3878950">OpError</span><span class="op" id="3878957">{</span><span class="ident" id="3878958">Op</span><span class="op" id="3878960">:</span>&nbsp;<span class="string" id="3878962">&#34;dial&#34;</span><span class="op" id="3878968">,</span>&nbsp;<span class="ident" id="3878970">Net</span><span class="op" id="3878973">:</span>&nbsp;<span class="ident" id="3878975">net</span><span class="op" id="3878978">,</span>&nbsp;<span class="ident" id="3878980">Addr</span><span class="op" id="3878984">:</span>&nbsp;<span class="ident" id="3878986">raddr</span><span class="op" id="3878991">,</span>&nbsp;<span class="ident" id="3878993">Err</span><span class="op" id="3878996">:</span>&nbsp;<span class="ident" id="3878998">UnknownNetworkError</span><span class="op" id="3879017">(</span><span class="ident" id="3879018">net</span><span class="op" id="3879021">)</span><span class="op" id="3879022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3879025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3879028">return</span>&nbsp;<span class="ident" id="3879035">dialUnix</span><span class="op" id="3879043">(</span><span class="ident" id="3879044">net</span><span class="op" id="3879047">,</span>&nbsp;<span class="ident" id="3879049">laddr</span><span class="op" id="3879054">,</span>&nbsp;<span class="ident" id="3879056">raddr</span><span class="op" id="3879061">,</span>&nbsp;<span class="ident" id="3879063">noDeadline</span><span class="op" id="3879073">)</span><br>
<span class="lineno">240</span><span class="op" id="3879075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3879078">func</span>&nbsp;<span class="ident" id="3879083">dialUnix</span><span class="op" id="3879091">(</span><span class="ident" id="3879092">net</span>&nbsp;<span class="builtintype" id="3879096">string</span><span class="op" id="3879102">,</span>&nbsp;<span class="ident" id="3879104">laddr</span><span class="op" id="3879109">,</span>&nbsp;<span class="ident" id="3879111">raddr</span>&nbsp;<span class="op" id="3879117">*</span><span class="ident" id="3879118">UnixAddr</span><span class="op" id="3879126">,</span>&nbsp;<span class="ident" id="3879128">deadline</span>&nbsp;<span class="ident" id="3879137">time</span><span class="op" id="3879141">.</span><span class="ident" id="3879142">Time</span><span class="op" id="3879146">)</span>&nbsp;<span class="op" id="3879148">(</span><span class="op" id="3879149">*</span><span class="ident" id="3879150">UnixConn</span><span class="op" id="3879158">,</span>&nbsp;<span class="builtintype" id="3879160">error</span><span class="op" id="3879165">)</span>&nbsp;<span class="op" id="3879167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3879170">fd</span><span class="op" id="3879172">,</span>&nbsp;<span class="ident" id="3879174">err</span>&nbsp;<span class="op" id="3879178">:=</span>&nbsp;<span class="ident" id="3879181">unixSocket</span><span class="op" id="3879191">(</span><span class="ident" id="3879192">net</span><span class="op" id="3879195">,</span>&nbsp;<span class="ident" id="3879197">laddr</span><span class="op" id="3879202">,</span>&nbsp;<span class="ident" id="3879204">raddr</span><span class="op" id="3879209">,</span>&nbsp;<span class="string" id="3879211">&#34;dial&#34;</span><span class="op" id="3879217">,</span>&nbsp;<span class="ident" id="3879219">deadline</span><span class="op" id="3879227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3879230">if</span>&nbsp;<span class="ident" id="3879233">err</span>&nbsp;<span class="op" id="3879237">!=</span>&nbsp;<span class="builtintype" id="3879240">nil</span>&nbsp;<span class="op" id="3879244">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3879248">return</span>&nbsp;<span class="builtintype" id="3879255">nil</span><span class="op" id="3879258">,</span>&nbsp;<span class="op" id="3879260">&amp;</span><span class="ident" id="3879261">OpError</span><span class="op" id="3879268">{</span><span class="ident" id="3879269">Op</span><span class="op" id="3879271">:</span>&nbsp;<span class="string" id="3879273">&#34;dial&#34;</span><span class="op" id="3879279">,</span>&nbsp;<span class="ident" id="3879281">Net</span><span class="op" id="3879284">:</span>&nbsp;<span class="ident" id="3879286">net</span><span class="op" id="3879289">,</span>&nbsp;<span class="ident" id="3879291">Addr</span><span class="op" id="3879295">:</span>&nbsp;<span class="ident" id="3879297">raddr</span><span class="op" id="3879302">,</span>&nbsp;<span class="ident" id="3879304">Err</span><span class="op" id="3879307">:</span>&nbsp;<span class="ident" id="3879309">err</span><span class="op" id="3879312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3879315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3879318">return</span>&nbsp;<span class="ident" id="3879325">newUnixConn</span><span class="op" id="3879336">(</span><span class="ident" id="3879337">fd</span><span class="op" id="3879339">)</span><span class="op" id="3879340">,</span>&nbsp;<span class="builtintype" id="3879342">nil</span><br>
<span class="lineno"></span><span class="op" id="3879346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="3879349">//&nbsp;UnixListener&nbsp;is&nbsp;a&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;listener.&nbsp;&nbsp;Clients&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="3879415">//&nbsp;typically&nbsp;use&nbsp;variables&nbsp;of&nbsp;type&nbsp;Listener&nbsp;instead&nbsp;of&nbsp;assuming&nbsp;Unix</span><br>
<span class="lineno"></span><span class="comment" id="3879484">//&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3879503">type</span>&nbsp;<span class="ident" id="3879508">UnixListener</span>&nbsp;<span class="keyword" id="3879521">struct</span>&nbsp;<span class="op" id="3879528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3879531">fd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3879536">*</span><span class="ident" id="3879537">netFD</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3879544">path</span>&nbsp;<span class="builtintype" id="3879549">string</span><br>
<span class="lineno"></span><span class="op" id="3879556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3879559">//&nbsp;ListenUnix&nbsp;announces&nbsp;on&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;laddr&nbsp;and&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3879629">//&nbsp;Unix&nbsp;listener.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno">260</span><span class="keyword" id="3879696">func</span>&nbsp;<span class="ident" id="3879701">ListenUnix</span><span class="op" id="3879711">(</span><span class="ident" id="3879712">net</span>&nbsp;<span class="builtintype" id="3879716">string</span><span class="op" id="3879722">,</span>&nbsp;<span class="ident" id="3879724">laddr</span>&nbsp;<span class="op" id="3879730">*</span><span class="ident" id="3879731">UnixAddr</span><span class="op" id="3879739">)</span>&nbsp;<span class="op" id="3879741">(</span><span class="op" id="3879742">*</span><span class="ident" id="3879743">UnixListener</span><span class="op" id="3879755">,</span>&nbsp;<span class="builtintype" id="3879757">error</span><span class="op" id="3879762">)</span>&nbsp;<span class="op" id="3879764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3879767">switch</span>&nbsp;<span class="ident" id="3879774">net</span>&nbsp;<span class="op" id="3879778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3879781">case</span>&nbsp;<span class="string" id="3879786">&#34;unix&#34;</span><span class="op" id="3879792">,</span>&nbsp;<span class="string" id="3879794">&#34;unixpacket&#34;</span><span class="op" id="3879806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3879809">default</span><span class="op" id="3879816">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3879820">return</span>&nbsp;<span class="builtintype" id="3879827">nil</span><span class="op" id="3879830">,</span>&nbsp;<span class="op" id="3879832">&amp;</span><span class="ident" id="3879833">OpError</span><span class="op" id="3879840">{</span><span class="ident" id="3879841">Op</span><span class="op" id="3879843">:</span>&nbsp;<span class="string" id="3879845">&#34;listen&#34;</span><span class="op" id="3879853">,</span>&nbsp;<span class="ident" id="3879855">Net</span><span class="op" id="3879858">:</span>&nbsp;<span class="ident" id="3879860">net</span><span class="op" id="3879863">,</span>&nbsp;<span class="ident" id="3879865">Addr</span><span class="op" id="3879869">:</span>&nbsp;<span class="ident" id="3879871">laddr</span><span class="op" id="3879876">,</span>&nbsp;<span class="ident" id="3879878">Err</span><span class="op" id="3879881">:</span>&nbsp;<span class="ident" id="3879883">UnknownNetworkError</span><span class="op" id="3879902">(</span><span class="ident" id="3879903">net</span><span class="op" id="3879906">)</span><span class="op" id="3879907">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3879910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3879913">if</span>&nbsp;<span class="ident" id="3879916">laddr</span>&nbsp;<span class="op" id="3879922">==</span>&nbsp;<span class="builtintype" id="3879925">nil</span>&nbsp;<span class="op" id="3879929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3879933">return</span>&nbsp;<span class="builtintype" id="3879940">nil</span><span class="op" id="3879943">,</span>&nbsp;<span class="op" id="3879945">&amp;</span><span class="ident" id="3879946">OpError</span><span class="op" id="3879953">{</span><span class="ident" id="3879954">Op</span><span class="op" id="3879956">:</span>&nbsp;<span class="string" id="3879958">&#34;listen&#34;</span><span class="op" id="3879966">,</span>&nbsp;<span class="ident" id="3879968">Net</span><span class="op" id="3879971">:</span>&nbsp;<span class="ident" id="3879973">net</span><span class="op" id="3879976">,</span>&nbsp;<span class="ident" id="3879978">Addr</span><span class="op" id="3879982">:</span>&nbsp;<span class="builtintype" id="3879984">nil</span><span class="op" id="3879987">,</span>&nbsp;<span class="ident" id="3879989">Err</span><span class="op" id="3879992">:</span>&nbsp;<span class="ident" id="3879994">errMissingAddress</span><span class="op" id="3880011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3880014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880017">fd</span><span class="op" id="3880019">,</span>&nbsp;<span class="ident" id="3880021">err</span>&nbsp;<span class="op" id="3880025">:=</span>&nbsp;<span class="ident" id="3880028">unixSocket</span><span class="op" id="3880038">(</span><span class="ident" id="3880039">net</span><span class="op" id="3880042">,</span>&nbsp;<span class="ident" id="3880044">laddr</span><span class="op" id="3880049">,</span>&nbsp;<span class="builtintype" id="3880051">nil</span><span class="op" id="3880054">,</span>&nbsp;<span class="string" id="3880056">&#34;listen&#34;</span><span class="op" id="3880064">,</span>&nbsp;<span class="ident" id="3880066">noDeadline</span><span class="op" id="3880076">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880079">if</span>&nbsp;<span class="ident" id="3880082">err</span>&nbsp;<span class="op" id="3880086">!=</span>&nbsp;<span class="builtintype" id="3880089">nil</span>&nbsp;<span class="op" id="3880093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880097">return</span>&nbsp;<span class="builtintype" id="3880104">nil</span><span class="op" id="3880107">,</span>&nbsp;<span class="op" id="3880109">&amp;</span><span class="ident" id="3880110">OpError</span><span class="op" id="3880117">{</span><span class="ident" id="3880118">Op</span><span class="op" id="3880120">:</span>&nbsp;<span class="string" id="3880122">&#34;listen&#34;</span><span class="op" id="3880130">,</span>&nbsp;<span class="ident" id="3880132">Net</span><span class="op" id="3880135">:</span>&nbsp;<span class="ident" id="3880137">net</span><span class="op" id="3880140">,</span>&nbsp;<span class="ident" id="3880142">Addr</span><span class="op" id="3880146">:</span>&nbsp;<span class="ident" id="3880148">laddr</span><span class="op" id="3880153">,</span>&nbsp;<span class="ident" id="3880155">Err</span><span class="op" id="3880158">:</span>&nbsp;<span class="ident" id="3880160">err</span><span class="op" id="3880163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3880166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880169">return</span>&nbsp;<span class="op" id="3880176">&amp;</span><span class="ident" id="3880177">UnixListener</span><span class="op" id="3880189">{</span><span class="ident" id="3880190">fd</span><span class="op" id="3880192">,</span>&nbsp;<span class="ident" id="3880194">fd</span><span class="op" id="3880196">.</span><span class="ident" id="3880197">laddr</span><span class="op" id="3880202">.</span><span class="ident" id="3880203">String</span><span class="op" id="3880209">(</span><span class="op" id="3880210">)</span><span class="op" id="3880211">}</span><span class="op" id="3880212">,</span>&nbsp;<span class="builtintype" id="3880214">nil</span><br>
<span class="lineno"></span><span class="op" id="3880218">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="3880221">//&nbsp;AcceptUnix&nbsp;accepts&nbsp;the&nbsp;next&nbsp;incoming&nbsp;call&nbsp;and&nbsp;returns&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3880286">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3880301">func</span>&nbsp;<span class="op" id="3880306">(</span><span class="ident" id="3880307">l</span>&nbsp;<span class="op" id="3880309">*</span><span class="ident" id="3880310">UnixListener</span><span class="op" id="3880322">)</span>&nbsp;<span class="ident" id="3880324">AcceptUnix</span><span class="op" id="3880334">(</span><span class="op" id="3880335">)</span>&nbsp;<span class="op" id="3880337">(</span><span class="op" id="3880338">*</span><span class="ident" id="3880339">UnixConn</span><span class="op" id="3880347">,</span>&nbsp;<span class="builtintype" id="3880349">error</span><span class="op" id="3880354">)</span>&nbsp;<span class="op" id="3880356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880359">if</span>&nbsp;<span class="ident" id="3880362">l</span>&nbsp;<span class="op" id="3880364">==</span>&nbsp;<span class="builtintype" id="3880367">nil</span>&nbsp;<span class="op" id="3880371">||</span>&nbsp;<span class="ident" id="3880374">l</span><span class="op" id="3880375">.</span><span class="ident" id="3880376">fd</span>&nbsp;<span class="op" id="3880379">==</span>&nbsp;<span class="builtintype" id="3880382">nil</span>&nbsp;<span class="op" id="3880386">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880390">return</span>&nbsp;<span class="builtintype" id="3880397">nil</span><span class="op" id="3880400">,</span>&nbsp;<span class="ident" id="3880402">syscall</span><span class="op" id="3880409">.</span><span class="ident" id="3880410">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3880418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880421">fd</span><span class="op" id="3880423">,</span>&nbsp;<span class="ident" id="3880425">err</span>&nbsp;<span class="op" id="3880429">:=</span>&nbsp;<span class="ident" id="3880432">l</span><span class="op" id="3880433">.</span><span class="ident" id="3880434">fd</span><span class="op" id="3880436">.</span><span class="ident" id="3880437">accept</span><span class="op" id="3880443">(</span><span class="op" id="3880444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880447">if</span>&nbsp;<span class="ident" id="3880450">err</span>&nbsp;<span class="op" id="3880454">!=</span>&nbsp;<span class="builtintype" id="3880457">nil</span>&nbsp;<span class="op" id="3880461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880465">return</span>&nbsp;<span class="builtintype" id="3880472">nil</span><span class="op" id="3880475">,</span>&nbsp;<span class="ident" id="3880477">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3880482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880485">c</span>&nbsp;<span class="op" id="3880487">:=</span>&nbsp;<span class="ident" id="3880490">newUnixConn</span><span class="op" id="3880501">(</span><span class="ident" id="3880502">fd</span><span class="op" id="3880504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880507">return</span>&nbsp;<span class="ident" id="3880514">c</span><span class="op" id="3880515">,</span>&nbsp;<span class="builtintype" id="3880517">nil</span><br>
<span class="lineno"></span><span class="op" id="3880521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="3880524">//&nbsp;Accept&nbsp;implements&nbsp;the&nbsp;Accept&nbsp;method&nbsp;in&nbsp;the&nbsp;Listener&nbsp;interface;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3880593">//&nbsp;waits&nbsp;for&nbsp;the&nbsp;next&nbsp;call&nbsp;and&nbsp;returns&nbsp;a&nbsp;generic&nbsp;Conn.</span><br>
<span class="lineno"></span><span class="keyword" id="3880648">func</span>&nbsp;<span class="op" id="3880653">(</span><span class="ident" id="3880654">l</span>&nbsp;<span class="op" id="3880656">*</span><span class="ident" id="3880657">UnixListener</span><span class="op" id="3880669">)</span>&nbsp;<span class="ident" id="3880671">Accept</span><span class="op" id="3880677">(</span><span class="op" id="3880678">)</span>&nbsp;<span class="op" id="3880680">(</span><span class="ident" id="3880681">c</span>&nbsp;<span class="ident" id="3880683">Conn</span><span class="op" id="3880687">,</span>&nbsp;<span class="ident" id="3880689">err</span>&nbsp;<span class="builtintype" id="3880693">error</span><span class="op" id="3880698">)</span>&nbsp;<span class="op" id="3880700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3880703">c1</span><span class="op" id="3880705">,</span>&nbsp;<span class="ident" id="3880707">err</span>&nbsp;<span class="op" id="3880711">:=</span>&nbsp;<span class="ident" id="3880714">l</span><span class="op" id="3880715">.</span><span class="ident" id="3880716">AcceptUnix</span><span class="op" id="3880726">(</span><span class="op" id="3880727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880730">if</span>&nbsp;<span class="ident" id="3880733">err</span>&nbsp;<span class="op" id="3880737">!=</span>&nbsp;<span class="builtintype" id="3880740">nil</span>&nbsp;<span class="op" id="3880744">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880748">return</span>&nbsp;<span class="builtintype" id="3880755">nil</span><span class="op" id="3880758">,</span>&nbsp;<span class="ident" id="3880760">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3880765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880768">return</span>&nbsp;<span class="ident" id="3880775">c1</span><span class="op" id="3880777">,</span>&nbsp;<span class="builtintype" id="3880779">nil</span><br>
<span class="lineno"></span><span class="op" id="3880783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="3880786">//&nbsp;Close&nbsp;stops&nbsp;listening&nbsp;on&nbsp;the&nbsp;Unix&nbsp;address.&nbsp;&nbsp;Already&nbsp;accepted</span><br>
<span class="lineno"></span><span class="comment" id="3880850">//&nbsp;connections&nbsp;are&nbsp;not&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="3880881">func</span>&nbsp;<span class="op" id="3880886">(</span><span class="ident" id="3880887">l</span>&nbsp;<span class="op" id="3880889">*</span><span class="ident" id="3880890">UnixListener</span><span class="op" id="3880902">)</span>&nbsp;<span class="ident" id="3880904">Close</span><span class="op" id="3880909">(</span><span class="op" id="3880910">)</span>&nbsp;<span class="builtintype" id="3880912">error</span>&nbsp;<span class="op" id="3880918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880921">if</span>&nbsp;<span class="ident" id="3880924">l</span>&nbsp;<span class="op" id="3880926">==</span>&nbsp;<span class="builtintype" id="3880929">nil</span>&nbsp;<span class="op" id="3880933">||</span>&nbsp;<span class="ident" id="3880936">l</span><span class="op" id="3880937">.</span><span class="ident" id="3880938">fd</span>&nbsp;<span class="op" id="3880941">==</span>&nbsp;<span class="builtintype" id="3880944">nil</span>&nbsp;<span class="op" id="3880948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3880952">return</span>&nbsp;<span class="ident" id="3880959">syscall</span><span class="op" id="3880966">.</span><span class="ident" id="3880967">EINVAL</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3880975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3880979">//&nbsp;The&nbsp;operating&nbsp;system&nbsp;doesn&#39;t&nbsp;clean&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3881021">//&nbsp;the&nbsp;file&nbsp;that&nbsp;announcing&nbsp;created,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3881062">//&nbsp;we&nbsp;have&nbsp;to&nbsp;clean&nbsp;it&nbsp;up&nbsp;ourselves.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3881100">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here--we&nbsp;can&#39;t&nbsp;know&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3881143">//&nbsp;sure&nbsp;whether&nbsp;someone&nbsp;else&nbsp;has&nbsp;come&nbsp;along</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3881188">//&nbsp;and&nbsp;replaced&nbsp;our&nbsp;socket&nbsp;name&nbsp;already--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3881231">//&nbsp;but&nbsp;this&nbsp;sequence&nbsp;(remove&nbsp;then&nbsp;close)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3881273">//&nbsp;is&nbsp;at&nbsp;least&nbsp;compatible&nbsp;with&nbsp;the&nbsp;auto-remove</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3881321">//&nbsp;sequence&nbsp;in&nbsp;ListenUnix.&nbsp;&nbsp;It&#39;s&nbsp;only&nbsp;non-Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3881367">//&nbsp;programs&nbsp;that&nbsp;can&nbsp;mess&nbsp;us&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3881401">if</span>&nbsp;<span class="ident" id="3881404">l</span><span class="op" id="3881405">.</span><span class="ident" id="3881406">path</span><span class="op" id="3881410">[</span><span class="num" id="3881411">0</span><span class="op" id="3881412">]</span>&nbsp;<span class="op" id="3881414">!=</span>&nbsp;<span class="string" id="3881417">&#39;@&#39;</span>&nbsp;<span class="op" id="3881421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3881425">syscall</span><span class="op" id="3881432">.</span><span class="ident" id="3881433">Unlink</span><span class="op" id="3881439">(</span><span class="ident" id="3881440">l</span><span class="op" id="3881441">.</span><span class="ident" id="3881442">path</span><span class="op" id="3881446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3881449">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3881452">return</span>&nbsp;<span class="ident" id="3881459">l</span><span class="op" id="3881460">.</span><span class="ident" id="3881461">fd</span><span class="op" id="3881463">.</span><span class="ident" id="3881464">Close</span><span class="op" id="3881469">(</span><span class="op" id="3881470">)</span><br>
<span class="lineno"></span><span class="op" id="3881472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3881475">//&nbsp;Addr&nbsp;returns&nbsp;the&nbsp;listener&#39;s&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3881523">func</span>&nbsp;<span class="op" id="3881528">(</span><span class="ident" id="3881529">l</span>&nbsp;<span class="op" id="3881531">*</span><span class="ident" id="3881532">UnixListener</span><span class="op" id="3881544">)</span>&nbsp;<span class="ident" id="3881546">Addr</span><span class="op" id="3881550">(</span><span class="op" id="3881551">)</span>&nbsp;<span class="ident" id="3881553">Addr</span>&nbsp;<span class="op" id="3881558">{</span>&nbsp;<span class="keyword" id="3881560">return</span>&nbsp;<span class="ident" id="3881567">l</span><span class="op" id="3881568">.</span><span class="ident" id="3881569">fd</span><span class="op" id="3881571">.</span><span class="ident" id="3881572">laddr</span>&nbsp;<span class="op" id="3881578">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="3881581">//&nbsp;SetDeadline&nbsp;sets&nbsp;the&nbsp;deadline&nbsp;associated&nbsp;with&nbsp;the&nbsp;listener.</span><br>
<span class="lineno"></span><span class="comment" id="3881644">//&nbsp;A&nbsp;zero&nbsp;time&nbsp;value&nbsp;disables&nbsp;the&nbsp;deadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3881688">func</span>&nbsp;<span class="op" id="3881693">(</span><span class="ident" id="3881694">l</span>&nbsp;<span class="op" id="3881696">*</span><span class="ident" id="3881697">UnixListener</span><span class="op" id="3881709">)</span>&nbsp;<span class="ident" id="3881711">SetDeadline</span><span class="op" id="3881722">(</span><span class="ident" id="3881723">t</span>&nbsp;<span class="ident" id="3881725">time</span><span class="op" id="3881729">.</span><span class="ident" id="3881730">Time</span><span class="op" id="3881734">)</span>&nbsp;<span class="op" id="3881736">(</span><span class="ident" id="3881737">err</span>&nbsp;<span class="builtintype" id="3881741">error</span><span class="op" id="3881746">)</span>&nbsp;<span class="op" id="3881748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3881751">if</span>&nbsp;<span class="ident" id="3881754">l</span>&nbsp;<span class="op" id="3881756">==</span>&nbsp;<span class="builtintype" id="3881759">nil</span>&nbsp;<span class="op" id="3881763">||</span>&nbsp;<span class="ident" id="3881766">l</span><span class="op" id="3881767">.</span><span class="ident" id="3881768">fd</span>&nbsp;<span class="op" id="3881771">==</span>&nbsp;<span class="builtintype" id="3881774">nil</span>&nbsp;<span class="op" id="3881778">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3881782">return</span>&nbsp;<span class="ident" id="3881789">syscall</span><span class="op" id="3881796">.</span><span class="ident" id="3881797">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3881805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3881808">return</span>&nbsp;<span class="ident" id="3881815">l</span><span class="op" id="3881816">.</span><span class="ident" id="3881817">fd</span><span class="op" id="3881819">.</span><span class="ident" id="3881820">setDeadline</span><span class="op" id="3881831">(</span><span class="ident" id="3881832">t</span><span class="op" id="3881833">)</span><br>
<span class="lineno"></span><span class="op" id="3881835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="3881838">//&nbsp;File&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;underlying&nbsp;os.File,&nbsp;set&nbsp;to&nbsp;blocking</span><br>
<span class="lineno"></span><span class="comment" id="3881904">//&nbsp;mode.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="3881974">//&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;l.</span><br>
<span class="lineno"></span><span class="comment" id="3882039">//</span><br>
<span class="lineno"></span><span class="comment" id="3882042">//&nbsp;The&nbsp;returned&nbsp;os.File&#39;s&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;different&nbsp;from&nbsp;the</span><br>
<span class="lineno">340</span><span class="comment" id="3882106">//&nbsp;connection&#39;s.&nbsp;&nbsp;Attempting&nbsp;to&nbsp;change&nbsp;properties&nbsp;of&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span><span class="comment" id="3882172">//&nbsp;using&nbsp;this&nbsp;duplicate&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;have&nbsp;the&nbsp;desired&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="3882236">func</span>&nbsp;<span class="op" id="3882241">(</span><span class="ident" id="3882242">l</span>&nbsp;<span class="op" id="3882244">*</span><span class="ident" id="3882245">UnixListener</span><span class="op" id="3882257">)</span>&nbsp;<span class="ident" id="3882259">File</span><span class="op" id="3882263">(</span><span class="op" id="3882264">)</span>&nbsp;<span class="op" id="3882266">(</span><span class="ident" id="3882267">f</span>&nbsp;<span class="op" id="3882269">*</span><span class="ident" id="3882270">os</span><span class="op" id="3882272">.</span><span class="ident" id="3882273">File</span><span class="op" id="3882277">,</span>&nbsp;<span class="ident" id="3882279">err</span>&nbsp;<span class="builtintype" id="3882283">error</span><span class="op" id="3882288">)</span>&nbsp;<span class="op" id="3882290">{</span>&nbsp;<span class="keyword" id="3882292">return</span>&nbsp;<span class="ident" id="3882299">l</span><span class="op" id="3882300">.</span><span class="ident" id="3882301">fd</span><span class="op" id="3882303">.</span><span class="ident" id="3882304">dup</span><span class="op" id="3882307">(</span><span class="op" id="3882308">)</span>&nbsp;<span class="op" id="3882310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3882313">//&nbsp;ListenUnixgram&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;Unix&nbsp;datagram&nbsp;packets&nbsp;addressed</span><br>
<span class="lineno">345</span><span class="comment" id="3882384">//&nbsp;to&nbsp;the&nbsp;local&nbsp;address&nbsp;laddr.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3882452">//&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo&nbsp;methods&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3882522">//&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;packets&nbsp;with&nbsp;per-packet&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3882581">func</span>&nbsp;<span class="ident" id="3882586">ListenUnixgram</span><span class="op" id="3882600">(</span><span class="ident" id="3882601">net</span>&nbsp;<span class="builtintype" id="3882605">string</span><span class="op" id="3882611">,</span>&nbsp;<span class="ident" id="3882613">laddr</span>&nbsp;<span class="op" id="3882619">*</span><span class="ident" id="3882620">UnixAddr</span><span class="op" id="3882628">)</span>&nbsp;<span class="op" id="3882630">(</span><span class="op" id="3882631">*</span><span class="ident" id="3882632">UnixConn</span><span class="op" id="3882640">,</span>&nbsp;<span class="builtintype" id="3882642">error</span><span class="op" id="3882647">)</span>&nbsp;<span class="op" id="3882649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3882652">switch</span>&nbsp;<span class="ident" id="3882659">net</span>&nbsp;<span class="op" id="3882663">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3882666">case</span>&nbsp;<span class="string" id="3882671">&#34;unixgram&#34;</span><span class="op" id="3882681">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3882684">default</span><span class="op" id="3882691">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3882695">return</span>&nbsp;<span class="builtintype" id="3882702">nil</span><span class="op" id="3882705">,</span>&nbsp;<span class="op" id="3882707">&amp;</span><span class="ident" id="3882708">OpError</span><span class="op" id="3882715">{</span><span class="ident" id="3882716">Op</span><span class="op" id="3882718">:</span>&nbsp;<span class="string" id="3882720">&#34;listen&#34;</span><span class="op" id="3882728">,</span>&nbsp;<span class="ident" id="3882730">Net</span><span class="op" id="3882733">:</span>&nbsp;<span class="ident" id="3882735">net</span><span class="op" id="3882738">,</span>&nbsp;<span class="ident" id="3882740">Addr</span><span class="op" id="3882744">:</span>&nbsp;<span class="ident" id="3882746">laddr</span><span class="op" id="3882751">,</span>&nbsp;<span class="ident" id="3882753">Err</span><span class="op" id="3882756">:</span>&nbsp;<span class="ident" id="3882758">UnknownNetworkError</span><span class="op" id="3882777">(</span><span class="ident" id="3882778">net</span><span class="op" id="3882781">)</span><span class="op" id="3882782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3882785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3882788">if</span>&nbsp;<span class="ident" id="3882791">laddr</span>&nbsp;<span class="op" id="3882797">==</span>&nbsp;<span class="builtintype" id="3882800">nil</span>&nbsp;<span class="op" id="3882804">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3882808">return</span>&nbsp;<span class="builtintype" id="3882815">nil</span><span class="op" id="3882818">,</span>&nbsp;<span class="op" id="3882820">&amp;</span><span class="ident" id="3882821">OpError</span><span class="op" id="3882828">{</span><span class="ident" id="3882829">Op</span><span class="op" id="3882831">:</span>&nbsp;<span class="string" id="3882833">&#34;listen&#34;</span><span class="op" id="3882841">,</span>&nbsp;<span class="ident" id="3882843">Net</span><span class="op" id="3882846">:</span>&nbsp;<span class="ident" id="3882848">net</span><span class="op" id="3882851">,</span>&nbsp;<span class="ident" id="3882853">Addr</span><span class="op" id="3882857">:</span>&nbsp;<span class="builtintype" id="3882859">nil</span><span class="op" id="3882862">,</span>&nbsp;<span class="ident" id="3882864">Err</span><span class="op" id="3882867">:</span>&nbsp;<span class="ident" id="3882869">errMissingAddress</span><span class="op" id="3882886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3882889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3882892">fd</span><span class="op" id="3882894">,</span>&nbsp;<span class="ident" id="3882896">err</span>&nbsp;<span class="op" id="3882900">:=</span>&nbsp;<span class="ident" id="3882903">unixSocket</span><span class="op" id="3882913">(</span><span class="ident" id="3882914">net</span><span class="op" id="3882917">,</span>&nbsp;<span class="ident" id="3882919">laddr</span><span class="op" id="3882924">,</span>&nbsp;<span class="builtintype" id="3882926">nil</span><span class="op" id="3882929">,</span>&nbsp;<span class="string" id="3882931">&#34;listen&#34;</span><span class="op" id="3882939">,</span>&nbsp;<span class="ident" id="3882941">noDeadline</span><span class="op" id="3882951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3882954">if</span>&nbsp;<span class="ident" id="3882957">err</span>&nbsp;<span class="op" id="3882961">!=</span>&nbsp;<span class="builtintype" id="3882964">nil</span>&nbsp;<span class="op" id="3882968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3882972">return</span>&nbsp;<span class="builtintype" id="3882979">nil</span><span class="op" id="3882982">,</span>&nbsp;<span class="op" id="3882984">&amp;</span><span class="ident" id="3882985">OpError</span><span class="op" id="3882992">{</span><span class="ident" id="3882993">Op</span><span class="op" id="3882995">:</span>&nbsp;<span class="string" id="3882997">&#34;listen&#34;</span><span class="op" id="3883005">,</span>&nbsp;<span class="ident" id="3883007">Net</span><span class="op" id="3883010">:</span>&nbsp;<span class="ident" id="3883012">net</span><span class="op" id="3883015">,</span>&nbsp;<span class="ident" id="3883017">Addr</span><span class="op" id="3883021">:</span>&nbsp;<span class="ident" id="3883023">laddr</span><span class="op" id="3883028">,</span>&nbsp;<span class="ident" id="3883030">Err</span><span class="op" id="3883033">:</span>&nbsp;<span class="ident" id="3883035">err</span><span class="op" id="3883038">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3883041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3883044">return</span>&nbsp;<span class="ident" id="3883051">newUnixConn</span><span class="op" id="3883062">(</span><span class="ident" id="3883063">fd</span><span class="op" id="3883065">)</span><span class="op" id="3883066">,</span>&nbsp;<span class="builtintype" id="3883068">nil</span><br>
<span class="lineno"></span><span class="op" id="3883072">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
