<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5956842">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5956897">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5956951">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5957002">/*<br>
<span class="lineno"></span>Package&nbsp;zip&nbsp;provides&nbsp;support&nbsp;for&nbsp;reading&nbsp;and&nbsp;writing&nbsp;ZIP&nbsp;archives.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>See:&nbsp;http://www.pkware.com/documents/casestudies/APPNOTE.TXT<br>
<span class="lineno"></span><br>
<span class="lineno">10</span>This&nbsp;package&nbsp;does&nbsp;not&nbsp;support&nbsp;disk&nbsp;spanning.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>A&nbsp;note&nbsp;about&nbsp;ZIP64:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>To&nbsp;be&nbsp;backwards&nbsp;compatible&nbsp;the&nbsp;FileHeader&nbsp;has&nbsp;both&nbsp;32&nbsp;and&nbsp;64&nbsp;bit&nbsp;Size<br>
<span class="lineno">15</span>fields.&nbsp;The&nbsp;64&nbsp;bit&nbsp;fields&nbsp;will&nbsp;always&nbsp;contain&nbsp;the&nbsp;correct&nbsp;value&nbsp;and<br>
<span class="lineno"></span>for&nbsp;normal&nbsp;archives&nbsp;both&nbsp;fields&nbsp;will&nbsp;be&nbsp;the&nbsp;same.&nbsp;For&nbsp;files&nbsp;requiring<br>
<span class="lineno"></span>the&nbsp;ZIP64&nbsp;format&nbsp;the&nbsp;32&nbsp;bit&nbsp;fields&nbsp;will&nbsp;be&nbsp;0xffffffff&nbsp;and&nbsp;the&nbsp;64&nbsp;bit<br>
<span class="lineno"></span>fields&nbsp;must&nbsp;be&nbsp;used&nbsp;instead.<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno">20</span><span class="keyword" id="5957511">package</span>&nbsp;<span class="ident" id="5957519">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5957524">import</span>&nbsp;<span class="op" id="5957531">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5957534">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5957540">&#34;path&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5957548">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5957555">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5957558">//&nbsp;Compression&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="5957582">const</span>&nbsp;<span class="op" id="5957588">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957591">Store</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5957599">uint16</span>&nbsp;<span class="op" id="5957606">=</span>&nbsp;<span class="num" id="5957608">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957611">Deflate</span>&nbsp;<span class="builtintype" id="5957619">uint16</span>&nbsp;<span class="op" id="5957626">=</span>&nbsp;<span class="num" id="5957628">8</span><br>
<span class="lineno"></span><span class="op" id="5957630">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5957633">const</span>&nbsp;<span class="op" id="5957639">(</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957642">fileHeaderSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5957667">=</span>&nbsp;<span class="num" id="5957669">0x04034b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957681">directoryHeaderSignature</span>&nbsp;<span class="op" id="5957706">=</span>&nbsp;<span class="num" id="5957708">0x02014b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957720">directoryEndSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5957745">=</span>&nbsp;<span class="num" id="5957747">0x06054b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957759">directory64LocSignature</span>&nbsp;&nbsp;<span class="op" id="5957784">=</span>&nbsp;<span class="num" id="5957786">0x07064b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957798">directory64EndSignature</span>&nbsp;&nbsp;<span class="op" id="5957823">=</span>&nbsp;<span class="num" id="5957825">0x06064b50</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957837">dataDescriptorSignature</span>&nbsp;&nbsp;<span class="op" id="5957862">=</span>&nbsp;<span class="num" id="5957864">0x08074b50</span>&nbsp;<span class="comment" id="5957875">//&nbsp;de-facto&nbsp;standard;&nbsp;required&nbsp;by&nbsp;OS&nbsp;X&nbsp;Finder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957922">fileHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5957947">=</span>&nbsp;<span class="num" id="5957949">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5957960">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957983">directoryHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958008">=</span>&nbsp;<span class="num" id="5958010">46</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5958021">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958054">directoryEndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958079">=</span>&nbsp;<span class="num" id="5958081">22</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5958092">//&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958106">dataDescriptorLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958131">=</span>&nbsp;<span class="num" id="5958133">16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5958144">//&nbsp;four&nbsp;uint32:&nbsp;descriptor&nbsp;signature,&nbsp;crc32,&nbsp;compressed&nbsp;size,&nbsp;size</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958212">dataDescriptor64Len</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958237">=</span>&nbsp;<span class="num" id="5958239">24</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5958250">//&nbsp;descriptor&nbsp;with&nbsp;8&nbsp;byte&nbsp;sizes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958283">directory64LocLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958308">=</span>&nbsp;<span class="num" id="5958310">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5958321">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958325">directory64EndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958350">=</span>&nbsp;<span class="num" id="5958352">56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5958363">//&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958376">//&nbsp;Constants&nbsp;for&nbsp;the&nbsp;first&nbsp;byte&nbsp;in&nbsp;CreatorVersion</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958427">creatorFAT</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958441">=</span>&nbsp;<span class="num" id="5958443">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958446">creatorUnix</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5958460">=</span>&nbsp;<span class="num" id="5958462">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958465">creatorNTFS</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5958479">=</span>&nbsp;<span class="num" id="5958481">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958485">creatorVFAT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5958499">=</span>&nbsp;<span class="num" id="5958501">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958505">creatorMacOSX</span>&nbsp;<span class="op" id="5958519">=</span>&nbsp;<span class="num" id="5958521">19</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958526">//&nbsp;version&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958546">zipVersion20</span>&nbsp;<span class="op" id="5958559">=</span>&nbsp;<span class="num" id="5958561">20</span>&nbsp;<span class="comment" id="5958564">//&nbsp;2.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958572">zipVersion45</span>&nbsp;<span class="op" id="5958585">=</span>&nbsp;<span class="num" id="5958587">45</span>&nbsp;<span class="comment" id="5958590">//&nbsp;4.5&nbsp;(reads&nbsp;and&nbsp;writes&nbsp;zip64&nbsp;archives)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958633">//&nbsp;limits&nbsp;for&nbsp;non&nbsp;zip64&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958664">uint16max</span>&nbsp;<span class="op" id="5958674">=</span>&nbsp;<span class="op" id="5958676">(</span><span class="num" id="5958677">1</span>&nbsp;<span class="op" id="5958679">&lt;&lt;</span>&nbsp;<span class="num" id="5958682">16</span><span class="op" id="5958684">)</span>&nbsp;<span class="op" id="5958686">-</span>&nbsp;<span class="num" id="5958688">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958691">uint32max</span>&nbsp;<span class="op" id="5958701">=</span>&nbsp;<span class="op" id="5958703">(</span><span class="num" id="5958704">1</span>&nbsp;<span class="op" id="5958706">&lt;&lt;</span>&nbsp;<span class="num" id="5958709">32</span><span class="op" id="5958711">)</span>&nbsp;<span class="op" id="5958713">-</span>&nbsp;<span class="num" id="5958715">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958719">//&nbsp;extra&nbsp;header&nbsp;id&#39;s</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958741">zip64ExtraId</span>&nbsp;<span class="op" id="5958754">=</span>&nbsp;<span class="num" id="5958756">0x0001</span>&nbsp;<span class="comment" id="5958763">//&nbsp;zip64&nbsp;Extended&nbsp;Information&nbsp;Extra&nbsp;Field</span><br>
<span class="lineno"></span><span class="op" id="5958805">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5958808">//&nbsp;FileHeader&nbsp;describes&nbsp;a&nbsp;file&nbsp;within&nbsp;a&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5958858">//&nbsp;See&nbsp;the&nbsp;zip&nbsp;spec&nbsp;for&nbsp;details.</span><br>
<span class="lineno">70</span><span class="keyword" id="5958891">type</span>&nbsp;<span class="ident" id="5958896">FileHeader</span>&nbsp;<span class="keyword" id="5958907">struct</span>&nbsp;<span class="op" id="5958914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958917">//&nbsp;Name&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958951">//&nbsp;It&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959014">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959078">//&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959095">Name</span>&nbsp;<span class="builtintype" id="5959100">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959109">CreatorVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5959128">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959136">ReaderVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5959155">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959163">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5959182">uint16</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959190">Method</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5959209">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959217">ModifiedTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5959236">uint16</span>&nbsp;<span class="comment" id="5959243">//&nbsp;MS-DOS&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959259">ModifiedDate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5959278">uint16</span>&nbsp;<span class="comment" id="5959285">//&nbsp;MS-DOS&nbsp;date</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959301">CRC32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5959320">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959328">CompressedSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5959347">uint32</span>&nbsp;<span class="comment" id="5959354">//&nbsp;deprecated;&nbsp;use&nbsp;CompressedSize64</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959391">UncompressedSize</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5959410">uint32</span>&nbsp;<span class="comment" id="5959417">//&nbsp;deprecated;&nbsp;use&nbsp;UncompressedSize64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959456">CompressedSize64</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5959475">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959483">UncompressedSize64</span>&nbsp;<span class="ident" id="5959502">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959510">Extra</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959529">[</span><span class="op" id="5959530">]</span><span class="builtintype" id="5959531">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959537">ExternalAttrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5959556">uint32</span>&nbsp;<span class="comment" id="5959563">//&nbsp;Meaning&nbsp;depends&nbsp;on&nbsp;CreatorVersion</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959601">Comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5959620">string</span><br>
<span class="lineno"></span><span class="op" id="5959627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5959630">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="5959685">func</span>&nbsp;<span class="op" id="5959690">(</span><span class="ident" id="5959691">h</span>&nbsp;<span class="op" id="5959693">*</span><span class="ident" id="5959694">FileHeader</span><span class="op" id="5959704">)</span>&nbsp;<span class="ident" id="5959706">FileInfo</span><span class="op" id="5959714">(</span><span class="op" id="5959715">)</span>&nbsp;<span class="ident" id="5959717">os</span><span class="op" id="5959719">.</span><span class="ident" id="5959720">FileInfo</span>&nbsp;<span class="op" id="5959729">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959732">return</span>&nbsp;<span class="ident" id="5959739">headerFileInfo</span><span class="op" id="5959753">{</span><span class="ident" id="5959754">h</span><span class="op" id="5959755">}</span><br>
<span class="lineno"></span><span class="op" id="5959757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5959760">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="5959802">type</span>&nbsp;<span class="ident" id="5959807">headerFileInfo</span>&nbsp;<span class="keyword" id="5959822">struct</span>&nbsp;<span class="op" id="5959829">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959832">fh</span>&nbsp;<span class="op" id="5959835">*</span><span class="ident" id="5959836">FileHeader</span><br>
<span class="lineno"></span><span class="op" id="5959847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5959850">func</span>&nbsp;<span class="op" id="5959855">(</span><span class="ident" id="5959856">fi</span>&nbsp;<span class="ident" id="5959859">headerFileInfo</span><span class="op" id="5959873">)</span>&nbsp;<span class="ident" id="5959875">Name</span><span class="op" id="5959879">(</span><span class="op" id="5959880">)</span>&nbsp;<span class="builtintype" id="5959882">string</span>&nbsp;<span class="op" id="5959889">{</span>&nbsp;<span class="keyword" id="5959891">return</span>&nbsp;<span class="ident" id="5959898">path</span><span class="op" id="5959902">.</span><span class="ident" id="5959903">Base</span><span class="op" id="5959907">(</span><span class="ident" id="5959908">fi</span><span class="op" id="5959910">.</span><span class="ident" id="5959911">fh</span><span class="op" id="5959913">.</span><span class="ident" id="5959914">Name</span><span class="op" id="5959918">)</span>&nbsp;<span class="op" id="5959920">}</span><br>
<span class="lineno"></span><span class="keyword" id="5959922">func</span>&nbsp;<span class="op" id="5959927">(</span><span class="ident" id="5959928">fi</span>&nbsp;<span class="ident" id="5959931">headerFileInfo</span><span class="op" id="5959945">)</span>&nbsp;<span class="ident" id="5959947">Size</span><span class="op" id="5959951">(</span><span class="op" id="5959952">)</span>&nbsp;<span class="ident" id="5959954">int64</span>&nbsp;<span class="op" id="5959960">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959963">if</span>&nbsp;<span class="ident" id="5959966">fi</span><span class="op" id="5959968">.</span><span class="ident" id="5959969">fh</span><span class="op" id="5959971">.</span><span class="ident" id="5959972">UncompressedSize64</span>&nbsp;<span class="op" id="5959991">&gt;</span>&nbsp;<span class="num" id="5959993">0</span>&nbsp;<span class="op" id="5959995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959999">return</span>&nbsp;<span class="ident" id="5960006">int64</span><span class="op" id="5960011">(</span><span class="ident" id="5960012">fi</span><span class="op" id="5960014">.</span><span class="ident" id="5960015">fh</span><span class="op" id="5960017">.</span><span class="ident" id="5960018">UncompressedSize64</span><span class="op" id="5960036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960042">return</span>&nbsp;<span class="ident" id="5960049">int64</span><span class="op" id="5960054">(</span><span class="ident" id="5960055">fi</span><span class="op" id="5960057">.</span><span class="ident" id="5960058">fh</span><span class="op" id="5960060">.</span><span class="ident" id="5960061">UncompressedSize</span><span class="op" id="5960077">)</span><br>
<span class="lineno"></span><span class="op" id="5960079">}</span><br>
<span class="lineno">110</span><span class="keyword" id="5960081">func</span>&nbsp;<span class="op" id="5960086">(</span><span class="ident" id="5960087">fi</span>&nbsp;<span class="ident" id="5960090">headerFileInfo</span><span class="op" id="5960104">)</span>&nbsp;<span class="ident" id="5960106">IsDir</span><span class="op" id="5960111">(</span><span class="op" id="5960112">)</span>&nbsp;<span class="builtintype" id="5960114">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960126">{</span>&nbsp;<span class="keyword" id="5960128">return</span>&nbsp;<span class="ident" id="5960135">fi</span><span class="op" id="5960137">.</span><span class="ident" id="5960138">Mode</span><span class="op" id="5960142">(</span><span class="op" id="5960143">)</span><span class="op" id="5960144">.</span><span class="ident" id="5960145">IsDir</span><span class="op" id="5960150">(</span><span class="op" id="5960151">)</span>&nbsp;<span class="op" id="5960153">}</span><br>
<span class="lineno"></span><span class="keyword" id="5960155">func</span>&nbsp;<span class="op" id="5960160">(</span><span class="ident" id="5960161">fi</span>&nbsp;<span class="ident" id="5960164">headerFileInfo</span><span class="op" id="5960178">)</span>&nbsp;<span class="ident" id="5960180">ModTime</span><span class="op" id="5960187">(</span><span class="op" id="5960188">)</span>&nbsp;<span class="ident" id="5960190">time</span><span class="op" id="5960194">.</span><span class="ident" id="5960195">Time</span>&nbsp;<span class="op" id="5960200">{</span>&nbsp;<span class="keyword" id="5960202">return</span>&nbsp;<span class="ident" id="5960209">fi</span><span class="op" id="5960211">.</span><span class="ident" id="5960212">fh</span><span class="op" id="5960214">.</span><span class="ident" id="5960215">ModTime</span><span class="op" id="5960222">(</span><span class="op" id="5960223">)</span>&nbsp;<span class="op" id="5960225">}</span><br>
<span class="lineno"></span><span class="keyword" id="5960227">func</span>&nbsp;<span class="op" id="5960232">(</span><span class="ident" id="5960233">fi</span>&nbsp;<span class="ident" id="5960236">headerFileInfo</span><span class="op" id="5960250">)</span>&nbsp;<span class="ident" id="5960252">Mode</span><span class="op" id="5960256">(</span><span class="op" id="5960257">)</span>&nbsp;<span class="ident" id="5960259">os</span><span class="op" id="5960261">.</span><span class="ident" id="5960262">FileMode</span>&nbsp;&nbsp;<span class="op" id="5960272">{</span>&nbsp;<span class="keyword" id="5960274">return</span>&nbsp;<span class="ident" id="5960281">fi</span><span class="op" id="5960283">.</span><span class="ident" id="5960284">fh</span><span class="op" id="5960286">.</span><span class="ident" id="5960287">Mode</span><span class="op" id="5960291">(</span><span class="op" id="5960292">)</span>&nbsp;<span class="op" id="5960294">}</span><br>
<span class="lineno"></span><span class="keyword" id="5960296">func</span>&nbsp;<span class="op" id="5960301">(</span><span class="ident" id="5960302">fi</span>&nbsp;<span class="ident" id="5960305">headerFileInfo</span><span class="op" id="5960319">)</span>&nbsp;<span class="ident" id="5960321">Sys</span><span class="op" id="5960324">(</span><span class="op" id="5960325">)</span>&nbsp;<span class="keyword" id="5960327">interface</span><span class="op" id="5960336">{</span><span class="op" id="5960337">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5960341">{</span>&nbsp;<span class="keyword" id="5960343">return</span>&nbsp;<span class="ident" id="5960350">fi</span><span class="op" id="5960352">.</span><span class="ident" id="5960353">fh</span>&nbsp;<span class="op" id="5960356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5960359">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;FileHeader&nbsp;from&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5960426">//&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="comment" id="5960442">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5960509">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5960580">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">120</span><span class="keyword" id="5960649">func</span>&nbsp;<span class="ident" id="5960654">FileInfoHeader</span><span class="op" id="5960668">(</span><span class="ident" id="5960669">fi</span>&nbsp;<span class="ident" id="5960672">os</span><span class="op" id="5960674">.</span><span class="ident" id="5960675">FileInfo</span><span class="op" id="5960683">)</span>&nbsp;<span class="op" id="5960685">(</span><span class="op" id="5960686">*</span><span class="ident" id="5960687">FileHeader</span><span class="op" id="5960697">,</span>&nbsp;<span class="builtintype" id="5960699">error</span><span class="op" id="5960704">)</span>&nbsp;<span class="op" id="5960706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960709">size</span>&nbsp;<span class="op" id="5960714">:=</span>&nbsp;<span class="ident" id="5960717">fi</span><span class="op" id="5960719">.</span><span class="ident" id="5960720">Size</span><span class="op" id="5960724">(</span><span class="op" id="5960725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960728">fh</span>&nbsp;<span class="op" id="5960731">:=</span>&nbsp;<span class="op" id="5960734">&amp;</span><span class="ident" id="5960735">FileHeader</span><span class="op" id="5960745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960749">Name</span><span class="op" id="5960753">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960769">fi</span><span class="op" id="5960771">.</span><span class="ident" id="5960772">Name</span><span class="op" id="5960776">(</span><span class="op" id="5960777">)</span><span class="op" id="5960778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960782">UncompressedSize64</span><span class="op" id="5960800">:</span>&nbsp;<span class="ident" id="5960802">uint64</span><span class="op" id="5960808">(</span><span class="ident" id="5960809">size</span><span class="op" id="5960813">)</span><span class="op" id="5960814">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960820">fh</span><span class="op" id="5960822">.</span><span class="ident" id="5960823">SetModTime</span><span class="op" id="5960833">(</span><span class="ident" id="5960834">fi</span><span class="op" id="5960836">.</span><span class="ident" id="5960837">ModTime</span><span class="op" id="5960844">(</span><span class="op" id="5960845">)</span><span class="op" id="5960846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960849">fh</span><span class="op" id="5960851">.</span><span class="ident" id="5960852">SetMode</span><span class="op" id="5960859">(</span><span class="ident" id="5960860">fi</span><span class="op" id="5960862">.</span><span class="ident" id="5960863">Mode</span><span class="op" id="5960867">(</span><span class="op" id="5960868">)</span><span class="op" id="5960869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960872">if</span>&nbsp;<span class="ident" id="5960875">fh</span><span class="op" id="5960877">.</span><span class="ident" id="5960878">UncompressedSize64</span>&nbsp;<span class="op" id="5960897">&gt;</span>&nbsp;<span class="ident" id="5960899">uint32max</span>&nbsp;<span class="op" id="5960909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960913">fh</span><span class="op" id="5960915">.</span><span class="ident" id="5960916">UncompressedSize</span>&nbsp;<span class="op" id="5960933">=</span>&nbsp;<span class="ident" id="5960935">uint32max</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960946">}</span>&nbsp;<span class="keyword" id="5960948">else</span>&nbsp;<span class="op" id="5960953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960957">fh</span><span class="op" id="5960959">.</span><span class="ident" id="5960960">UncompressedSize</span>&nbsp;<span class="op" id="5960977">=</span>&nbsp;<span class="builtintype" id="5960979">uint32</span><span class="op" id="5960985">(</span><span class="ident" id="5960986">fh</span><span class="op" id="5960988">.</span><span class="ident" id="5960989">UncompressedSize64</span><span class="op" id="5961007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961013">return</span>&nbsp;<span class="ident" id="5961020">fh</span><span class="op" id="5961022">,</span>&nbsp;<span class="ident" id="5961024">nil</span><br>
<span class="lineno"></span><span class="op" id="5961028">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="5961031">type</span>&nbsp;<span class="ident" id="5961036">directoryEnd</span>&nbsp;<span class="keyword" id="5961049">struct</span>&nbsp;<span class="op" id="5961056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961059">diskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5961078">uint32</span>&nbsp;<span class="comment" id="5961085">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961096">dirDiskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5961115">uint32</span>&nbsp;<span class="comment" id="5961122">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961133">dirRecordsThisDisk</span>&nbsp;<span class="ident" id="5961152">uint64</span>&nbsp;<span class="comment" id="5961159">//&nbsp;unused</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961170">directoryRecords</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5961189">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961197">directorySize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961216">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961224">directoryOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961243">uint64</span>&nbsp;<span class="comment" id="5961250">//&nbsp;relative&nbsp;to&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961271">commentLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5961290">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961298">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5961317">string</span><br>
<span class="lineno">145</span><span class="op" id="5961324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5961327">//&nbsp;msDosTimeToTime&nbsp;converts&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time&nbsp;into&nbsp;a&nbsp;time.Time.</span><br>
<span class="lineno"></span><span class="comment" id="5961397">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="5961422">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724247(v=VS.85).aspx</span><br>
<span class="lineno">150</span><span class="keyword" id="5961493">func</span>&nbsp;<span class="ident" id="5961498">msDosTimeToTime</span><span class="op" id="5961513">(</span><span class="ident" id="5961514">dosDate</span><span class="op" id="5961521">,</span>&nbsp;<span class="ident" id="5961523">dosTime</span>&nbsp;<span class="builtintype" id="5961531">uint16</span><span class="op" id="5961537">)</span>&nbsp;<span class="ident" id="5961539">time</span><span class="op" id="5961543">.</span><span class="ident" id="5961544">Time</span>&nbsp;<span class="op" id="5961549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961552">return</span>&nbsp;<span class="ident" id="5961559">time</span><span class="op" id="5961563">.</span><span class="ident" id="5961564">Date</span><span class="op" id="5961568">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5961572">//&nbsp;date&nbsp;bits&nbsp;0-4:&nbsp;day&nbsp;of&nbsp;month;&nbsp;5-8:&nbsp;month;&nbsp;9-15:&nbsp;years&nbsp;since&nbsp;1980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5961641">int</span><span class="op" id="5961644">(</span><span class="ident" id="5961645">dosDate</span><span class="op" id="5961652">&gt;&gt;</span><span class="num" id="5961654">9</span><span class="op" id="5961655">+</span><span class="num" id="5961656">1980</span><span class="op" id="5961660">)</span><span class="op" id="5961661">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961665">time</span><span class="op" id="5961669">.</span><span class="ident" id="5961670">Month</span><span class="op" id="5961675">(</span><span class="ident" id="5961676">dosDate</span><span class="op" id="5961683">&gt;&gt;</span><span class="num" id="5961685">5</span><span class="op" id="5961686">&amp;</span><span class="num" id="5961687">0xf</span><span class="op" id="5961690">)</span><span class="op" id="5961691">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5961695">int</span><span class="op" id="5961698">(</span><span class="ident" id="5961699">dosDate</span><span class="op" id="5961706">&amp;</span><span class="num" id="5961707">0x1f</span><span class="op" id="5961711">)</span><span class="op" id="5961712">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5961717">//&nbsp;time&nbsp;bits&nbsp;0-4:&nbsp;second/2;&nbsp;5-10:&nbsp;minute;&nbsp;11-15:&nbsp;hour</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5961773">int</span><span class="op" id="5961776">(</span><span class="ident" id="5961777">dosTime</span><span class="op" id="5961784">&gt;&gt;</span><span class="num" id="5961786">11</span><span class="op" id="5961788">)</span><span class="op" id="5961789">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5961793">int</span><span class="op" id="5961796">(</span><span class="ident" id="5961797">dosTime</span><span class="op" id="5961804">&gt;&gt;</span><span class="num" id="5961806">5</span><span class="op" id="5961807">&amp;</span><span class="num" id="5961808">0x3f</span><span class="op" id="5961812">)</span><span class="op" id="5961813">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5961817">int</span><span class="op" id="5961820">(</span><span class="ident" id="5961821">dosTime</span><span class="op" id="5961828">&amp;</span><span class="num" id="5961829">0x1f</span><span class="op" id="5961833">*</span><span class="num" id="5961834">2</span><span class="op" id="5961835">)</span><span class="op" id="5961836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5961840">0</span><span class="op" id="5961841">,</span>&nbsp;<span class="comment" id="5961843">//&nbsp;nanoseconds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961861">time</span><span class="op" id="5961865">.</span><span class="ident" id="5961866">UTC</span><span class="op" id="5961869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961872">)</span><br>
<span class="lineno">165</span><span class="op" id="5961874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5961877">//&nbsp;timeToMsDosTime&nbsp;converts&nbsp;a&nbsp;time.Time&nbsp;to&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="5961945">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="5961970">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724274(v=VS.85).aspx</span><br>
<span class="lineno">170</span><span class="keyword" id="5962041">func</span>&nbsp;<span class="ident" id="5962046">timeToMsDosTime</span><span class="op" id="5962061">(</span><span class="ident" id="5962062">t</span>&nbsp;<span class="ident" id="5962064">time</span><span class="op" id="5962068">.</span><span class="ident" id="5962069">Time</span><span class="op" id="5962073">)</span>&nbsp;<span class="op" id="5962075">(</span><span class="ident" id="5962076">fDate</span>&nbsp;<span class="builtintype" id="5962082">uint16</span><span class="op" id="5962088">,</span>&nbsp;<span class="ident" id="5962090">fTime</span>&nbsp;<span class="builtintype" id="5962096">uint16</span><span class="op" id="5962102">)</span>&nbsp;<span class="op" id="5962104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962107">t</span>&nbsp;<span class="op" id="5962109">=</span>&nbsp;<span class="ident" id="5962111">t</span><span class="op" id="5962112">.</span><span class="ident" id="5962113">In</span><span class="op" id="5962115">(</span><span class="ident" id="5962116">time</span><span class="op" id="5962120">.</span><span class="ident" id="5962121">UTC</span><span class="op" id="5962124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962127">fDate</span>&nbsp;<span class="op" id="5962133">=</span>&nbsp;<span class="builtintype" id="5962135">uint16</span><span class="op" id="5962141">(</span><span class="ident" id="5962142">t</span><span class="op" id="5962143">.</span><span class="ident" id="5962144">Day</span><span class="op" id="5962147">(</span><span class="op" id="5962148">)</span>&nbsp;<span class="op" id="5962150">+</span>&nbsp;<span class="builtintype" id="5962152">int</span><span class="op" id="5962155">(</span><span class="ident" id="5962156">t</span><span class="op" id="5962157">.</span><span class="ident" id="5962158">Month</span><span class="op" id="5962163">(</span><span class="op" id="5962164">)</span><span class="op" id="5962165">)</span><span class="op" id="5962166">&lt;&lt;</span><span class="num" id="5962168">5</span>&nbsp;<span class="op" id="5962170">+</span>&nbsp;<span class="op" id="5962172">(</span><span class="ident" id="5962173">t</span><span class="op" id="5962174">.</span><span class="ident" id="5962175">Year</span><span class="op" id="5962179">(</span><span class="op" id="5962180">)</span><span class="op" id="5962181">-</span><span class="num" id="5962182">1980</span><span class="op" id="5962186">)</span><span class="op" id="5962187">&lt;&lt;</span><span class="num" id="5962189">9</span><span class="op" id="5962190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962193">fTime</span>&nbsp;<span class="op" id="5962199">=</span>&nbsp;<span class="builtintype" id="5962201">uint16</span><span class="op" id="5962207">(</span><span class="ident" id="5962208">t</span><span class="op" id="5962209">.</span><span class="ident" id="5962210">Second</span><span class="op" id="5962216">(</span><span class="op" id="5962217">)</span><span class="op" id="5962218">/</span><span class="num" id="5962219">2</span>&nbsp;<span class="op" id="5962221">+</span>&nbsp;<span class="ident" id="5962223">t</span><span class="op" id="5962224">.</span><span class="ident" id="5962225">Minute</span><span class="op" id="5962231">(</span><span class="op" id="5962232">)</span><span class="op" id="5962233">&lt;&lt;</span><span class="num" id="5962235">5</span>&nbsp;<span class="op" id="5962237">+</span>&nbsp;<span class="ident" id="5962239">t</span><span class="op" id="5962240">.</span><span class="ident" id="5962241">Hour</span><span class="op" id="5962245">(</span><span class="op" id="5962246">)</span><span class="op" id="5962247">&lt;&lt;</span><span class="num" id="5962249">11</span><span class="op" id="5962251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962254">return</span><br>
<span class="lineno">175</span><span class="op" id="5962261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5962264">//&nbsp;ModTime&nbsp;returns&nbsp;the&nbsp;modification&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="5962313">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="keyword" id="5962338">func</span>&nbsp;<span class="op" id="5962343">(</span><span class="ident" id="5962344">h</span>&nbsp;<span class="op" id="5962346">*</span><span class="ident" id="5962347">FileHeader</span><span class="op" id="5962357">)</span>&nbsp;<span class="ident" id="5962359">ModTime</span><span class="op" id="5962366">(</span><span class="op" id="5962367">)</span>&nbsp;<span class="ident" id="5962369">time</span><span class="op" id="5962373">.</span><span class="ident" id="5962374">Time</span>&nbsp;<span class="op" id="5962379">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962382">return</span>&nbsp;<span class="ident" id="5962389">msDosTimeToTime</span><span class="op" id="5962404">(</span><span class="ident" id="5962405">h</span><span class="op" id="5962406">.</span><span class="ident" id="5962407">ModifiedDate</span><span class="op" id="5962419">,</span>&nbsp;<span class="ident" id="5962421">h</span><span class="op" id="5962422">.</span><span class="ident" id="5962423">ModifiedTime</span><span class="op" id="5962435">)</span><br>
<span class="lineno"></span><span class="op" id="5962437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5962440">//&nbsp;SetModTime&nbsp;sets&nbsp;the&nbsp;ModifiedTime&nbsp;and&nbsp;ModifiedDate&nbsp;fields&nbsp;to&nbsp;the&nbsp;given&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="5962526">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno">185</span><span class="keyword" id="5962551">func</span>&nbsp;<span class="op" id="5962556">(</span><span class="ident" id="5962557">h</span>&nbsp;<span class="op" id="5962559">*</span><span class="ident" id="5962560">FileHeader</span><span class="op" id="5962570">)</span>&nbsp;<span class="ident" id="5962572">SetModTime</span><span class="op" id="5962582">(</span><span class="ident" id="5962583">t</span>&nbsp;<span class="ident" id="5962585">time</span><span class="op" id="5962589">.</span><span class="ident" id="5962590">Time</span><span class="op" id="5962594">)</span>&nbsp;<span class="op" id="5962596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962599">h</span><span class="op" id="5962600">.</span><span class="ident" id="5962601">ModifiedDate</span><span class="op" id="5962613">,</span>&nbsp;<span class="ident" id="5962615">h</span><span class="op" id="5962616">.</span><span class="ident" id="5962617">ModifiedTime</span>&nbsp;<span class="op" id="5962630">=</span>&nbsp;<span class="ident" id="5962632">timeToMsDosTime</span><span class="op" id="5962647">(</span><span class="ident" id="5962648">t</span><span class="op" id="5962649">)</span><br>
<span class="lineno"></span><span class="op" id="5962651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5962654">const</span>&nbsp;<span class="op" id="5962660">(</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962663">//&nbsp;Unix&nbsp;constants.&nbsp;The&nbsp;specification&nbsp;doesn&#39;t&nbsp;mention&nbsp;them,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962723">//&nbsp;but&nbsp;these&nbsp;seem&nbsp;to&nbsp;be&nbsp;the&nbsp;values&nbsp;agreed&nbsp;on&nbsp;by&nbsp;tools.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962779">s_IFMT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5962788">=</span>&nbsp;<span class="num" id="5962790">0xf000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962798">s_IFSOCK</span>&nbsp;<span class="op" id="5962807">=</span>&nbsp;<span class="num" id="5962809">0xc000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962817">s_IFLNK</span>&nbsp;&nbsp;<span class="op" id="5962826">=</span>&nbsp;<span class="num" id="5962828">0xa000</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962836">s_IFREG</span>&nbsp;&nbsp;<span class="op" id="5962845">=</span>&nbsp;<span class="num" id="5962847">0x8000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962855">s_IFBLK</span>&nbsp;&nbsp;<span class="op" id="5962864">=</span>&nbsp;<span class="num" id="5962866">0x6000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962874">s_IFDIR</span>&nbsp;&nbsp;<span class="op" id="5962883">=</span>&nbsp;<span class="num" id="5962885">0x4000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962893">s_IFCHR</span>&nbsp;&nbsp;<span class="op" id="5962902">=</span>&nbsp;<span class="num" id="5962904">0x2000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962912">s_IFIFO</span>&nbsp;&nbsp;<span class="op" id="5962921">=</span>&nbsp;<span class="num" id="5962923">0x1000</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962931">s_ISUID</span>&nbsp;&nbsp;<span class="op" id="5962940">=</span>&nbsp;<span class="num" id="5962942">0x800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962949">s_ISGID</span>&nbsp;&nbsp;<span class="op" id="5962958">=</span>&nbsp;<span class="num" id="5962960">0x400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962967">s_ISVTX</span>&nbsp;&nbsp;<span class="op" id="5962976">=</span>&nbsp;<span class="num" id="5962978">0x200</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962986">msdosDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5963000">=</span>&nbsp;<span class="num" id="5963002">0x10</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963008">msdosReadOnly</span>&nbsp;<span class="op" id="5963022">=</span>&nbsp;<span class="num" id="5963024">0x01</span><br>
<span class="lineno"></span><span class="op" id="5963029">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5963032">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="5963097">func</span>&nbsp;<span class="op" id="5963102">(</span><span class="ident" id="5963103">h</span>&nbsp;<span class="op" id="5963105">*</span><span class="ident" id="5963106">FileHeader</span><span class="op" id="5963116">)</span>&nbsp;<span class="ident" id="5963118">Mode</span><span class="op" id="5963122">(</span><span class="op" id="5963123">)</span>&nbsp;<span class="op" id="5963125">(</span><span class="ident" id="5963126">mode</span>&nbsp;<span class="ident" id="5963131">os</span><span class="op" id="5963133">.</span><span class="ident" id="5963134">FileMode</span><span class="op" id="5963142">)</span>&nbsp;<span class="op" id="5963144">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963147">switch</span>&nbsp;<span class="ident" id="5963154">h</span><span class="op" id="5963155">.</span><span class="ident" id="5963156">CreatorVersion</span>&nbsp;<span class="op" id="5963171">&gt;&gt;</span>&nbsp;<span class="num" id="5963174">8</span>&nbsp;<span class="op" id="5963176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963179">case</span>&nbsp;<span class="ident" id="5963184">creatorUnix</span><span class="op" id="5963195">,</span>&nbsp;<span class="ident" id="5963197">creatorMacOSX</span><span class="op" id="5963210">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963214">mode</span>&nbsp;<span class="op" id="5963219">=</span>&nbsp;<span class="ident" id="5963221">unixModeToFileMode</span><span class="op" id="5963239">(</span><span class="ident" id="5963240">h</span><span class="op" id="5963241">.</span><span class="ident" id="5963242">ExternalAttrs</span>&nbsp;<span class="op" id="5963256">&gt;&gt;</span>&nbsp;<span class="num" id="5963259">16</span><span class="op" id="5963261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963264">case</span>&nbsp;<span class="ident" id="5963269">creatorNTFS</span><span class="op" id="5963280">,</span>&nbsp;<span class="ident" id="5963282">creatorVFAT</span><span class="op" id="5963293">,</span>&nbsp;<span class="ident" id="5963295">creatorFAT</span><span class="op" id="5963305">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963309">mode</span>&nbsp;<span class="op" id="5963314">=</span>&nbsp;<span class="ident" id="5963316">msdosModeToFileMode</span><span class="op" id="5963335">(</span><span class="ident" id="5963336">h</span><span class="op" id="5963337">.</span><span class="ident" id="5963338">ExternalAttrs</span><span class="op" id="5963351">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963357">if</span>&nbsp;<span class="builtinfunc" id="5963360">len</span><span class="op" id="5963363">(</span><span class="ident" id="5963364">h</span><span class="op" id="5963365">.</span><span class="ident" id="5963366">Name</span><span class="op" id="5963370">)</span>&nbsp;<span class="op" id="5963372">&gt;</span>&nbsp;<span class="num" id="5963374">0</span>&nbsp;<span class="op" id="5963376">&amp;&amp;</span>&nbsp;<span class="ident" id="5963379">h</span><span class="op" id="5963380">.</span><span class="ident" id="5963381">Name</span><span class="op" id="5963385">[</span><span class="builtinfunc" id="5963386">len</span><span class="op" id="5963389">(</span><span class="ident" id="5963390">h</span><span class="op" id="5963391">.</span><span class="ident" id="5963392">Name</span><span class="op" id="5963396">)</span><span class="op" id="5963397">-</span><span class="num" id="5963398">1</span><span class="op" id="5963399">]</span>&nbsp;<span class="op" id="5963401">==</span>&nbsp;<span class="string" id="5963404">&#39;/&#39;</span>&nbsp;<span class="op" id="5963408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963412">mode</span>&nbsp;<span class="op" id="5963417">|=</span>&nbsp;<span class="ident" id="5963420">os</span><span class="op" id="5963422">.</span><span class="ident" id="5963423">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963435">return</span>&nbsp;<span class="ident" id="5963442">mode</span><br>
<span class="lineno">220</span><span class="op" id="5963447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5963450">//&nbsp;SetMode&nbsp;changes&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="5963518">func</span>&nbsp;<span class="op" id="5963523">(</span><span class="ident" id="5963524">h</span>&nbsp;<span class="op" id="5963526">*</span><span class="ident" id="5963527">FileHeader</span><span class="op" id="5963537">)</span>&nbsp;<span class="ident" id="5963539">SetMode</span><span class="op" id="5963546">(</span><span class="ident" id="5963547">mode</span>&nbsp;<span class="ident" id="5963552">os</span><span class="op" id="5963554">.</span><span class="ident" id="5963555">FileMode</span><span class="op" id="5963563">)</span>&nbsp;<span class="op" id="5963565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963568">h</span><span class="op" id="5963569">.</span><span class="ident" id="5963570">CreatorVersion</span>&nbsp;<span class="op" id="5963585">=</span>&nbsp;<span class="ident" id="5963587">h</span><span class="op" id="5963588">.</span><span class="ident" id="5963589">CreatorVersion</span><span class="op" id="5963603">&amp;</span><span class="num" id="5963604">0xff</span>&nbsp;<span class="op" id="5963609">|</span>&nbsp;<span class="ident" id="5963611">creatorUnix</span><span class="op" id="5963622">&lt;&lt;</span><span class="num" id="5963624">8</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963627">h</span><span class="op" id="5963628">.</span><span class="ident" id="5963629">ExternalAttrs</span>&nbsp;<span class="op" id="5963643">=</span>&nbsp;<span class="ident" id="5963645">fileModeToUnixMode</span><span class="op" id="5963663">(</span><span class="ident" id="5963664">mode</span><span class="op" id="5963668">)</span>&nbsp;<span class="op" id="5963670">&lt;&lt;</span>&nbsp;<span class="num" id="5963673">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5963678">//&nbsp;set&nbsp;MSDOS&nbsp;attributes&nbsp;too,&nbsp;as&nbsp;the&nbsp;original&nbsp;zip&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963734">if</span>&nbsp;<span class="ident" id="5963737">mode</span><span class="op" id="5963741">&amp;</span><span class="ident" id="5963742">os</span><span class="op" id="5963744">.</span><span class="ident" id="5963745">ModeDir</span>&nbsp;<span class="op" id="5963753">!=</span>&nbsp;<span class="num" id="5963756">0</span>&nbsp;<span class="op" id="5963758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963762">h</span><span class="op" id="5963763">.</span><span class="ident" id="5963764">ExternalAttrs</span>&nbsp;<span class="op" id="5963778">|=</span>&nbsp;<span class="ident" id="5963781">msdosDir</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963794">if</span>&nbsp;<span class="ident" id="5963797">mode</span><span class="op" id="5963801">&amp;</span><span class="num" id="5963802">0200</span>&nbsp;<span class="op" id="5963807">==</span>&nbsp;<span class="num" id="5963810">0</span>&nbsp;<span class="op" id="5963812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963816">h</span><span class="op" id="5963817">.</span><span class="ident" id="5963818">ExternalAttrs</span>&nbsp;<span class="op" id="5963832">|=</span>&nbsp;<span class="ident" id="5963835">msdosReadOnly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963850">}</span><br>
<span class="lineno"></span><span class="op" id="5963852">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="5963855">//&nbsp;isZip64&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;size&nbsp;exceeds&nbsp;the&nbsp;32&nbsp;bit&nbsp;limit</span><br>
<span class="lineno"></span><span class="keyword" id="5963921">func</span>&nbsp;<span class="op" id="5963926">(</span><span class="ident" id="5963927">fh</span>&nbsp;<span class="op" id="5963930">*</span><span class="ident" id="5963931">FileHeader</span><span class="op" id="5963941">)</span>&nbsp;<span class="ident" id="5963943">isZip64</span><span class="op" id="5963950">(</span><span class="op" id="5963951">)</span>&nbsp;<span class="builtintype" id="5963953">bool</span>&nbsp;<span class="op" id="5963958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963961">return</span>&nbsp;<span class="ident" id="5963968">fh</span><span class="op" id="5963970">.</span><span class="ident" id="5963971">CompressedSize64</span>&nbsp;<span class="op" id="5963988">&gt;</span>&nbsp;<span class="ident" id="5963990">uint32max</span>&nbsp;<span class="op" id="5964000">||</span>&nbsp;<span class="ident" id="5964003">fh</span><span class="op" id="5964005">.</span><span class="ident" id="5964006">UncompressedSize64</span>&nbsp;<span class="op" id="5964025">&gt;</span>&nbsp;<span class="ident" id="5964027">uint32max</span><br>
<span class="lineno"></span><span class="op" id="5964037">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="5964040">func</span>&nbsp;<span class="ident" id="5964045">msdosModeToFileMode</span><span class="op" id="5964064">(</span><span class="ident" id="5964065">m</span>&nbsp;<span class="builtintype" id="5964067">uint32</span><span class="op" id="5964073">)</span>&nbsp;<span class="op" id="5964075">(</span><span class="ident" id="5964076">mode</span>&nbsp;<span class="ident" id="5964081">os</span><span class="op" id="5964083">.</span><span class="ident" id="5964084">FileMode</span><span class="op" id="5964092">)</span>&nbsp;<span class="op" id="5964094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964097">if</span>&nbsp;<span class="ident" id="5964100">m</span><span class="op" id="5964101">&amp;</span><span class="ident" id="5964102">msdosDir</span>&nbsp;<span class="op" id="5964111">!=</span>&nbsp;<span class="num" id="5964114">0</span>&nbsp;<span class="op" id="5964116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964120">mode</span>&nbsp;<span class="op" id="5964125">=</span>&nbsp;<span class="ident" id="5964127">os</span><span class="op" id="5964129">.</span><span class="ident" id="5964130">ModeDir</span>&nbsp;<span class="op" id="5964138">|</span>&nbsp;<span class="num" id="5964140">0777</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964146">}</span>&nbsp;<span class="keyword" id="5964148">else</span>&nbsp;<span class="op" id="5964153">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964157">mode</span>&nbsp;<span class="op" id="5964162">=</span>&nbsp;<span class="num" id="5964164">0666</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964173">if</span>&nbsp;<span class="ident" id="5964176">m</span><span class="op" id="5964177">&amp;</span><span class="ident" id="5964178">msdosReadOnly</span>&nbsp;<span class="op" id="5964192">!=</span>&nbsp;<span class="num" id="5964195">0</span>&nbsp;<span class="op" id="5964197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964201">mode</span>&nbsp;<span class="op" id="5964206">&amp;^=</span>&nbsp;<span class="num" id="5964210">0222</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964216">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964219">return</span>&nbsp;<span class="ident" id="5964226">mode</span><br>
<span class="lineno"></span><span class="op" id="5964231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5964234">func</span>&nbsp;<span class="ident" id="5964239">fileModeToUnixMode</span><span class="op" id="5964257">(</span><span class="ident" id="5964258">mode</span>&nbsp;<span class="ident" id="5964263">os</span><span class="op" id="5964265">.</span><span class="ident" id="5964266">FileMode</span><span class="op" id="5964274">)</span>&nbsp;<span class="builtintype" id="5964276">uint32</span>&nbsp;<span class="op" id="5964283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964286">var</span>&nbsp;<span class="ident" id="5964290">m</span>&nbsp;<span class="builtintype" id="5964292">uint32</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964300">switch</span>&nbsp;<span class="ident" id="5964307">mode</span>&nbsp;<span class="op" id="5964312">&amp;</span>&nbsp;<span class="ident" id="5964314">os</span><span class="op" id="5964316">.</span><span class="ident" id="5964317">ModeType</span>&nbsp;<span class="op" id="5964326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964329">default</span><span class="op" id="5964336">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964340">m</span>&nbsp;<span class="op" id="5964342">=</span>&nbsp;<span class="ident" id="5964344">s_IFREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964353">case</span>&nbsp;<span class="ident" id="5964358">os</span><span class="op" id="5964360">.</span><span class="ident" id="5964361">ModeDir</span><span class="op" id="5964368">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964372">m</span>&nbsp;<span class="op" id="5964374">=</span>&nbsp;<span class="ident" id="5964376">s_IFDIR</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964385">case</span>&nbsp;<span class="ident" id="5964390">os</span><span class="op" id="5964392">.</span><span class="ident" id="5964393">ModeSymlink</span><span class="op" id="5964404">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964408">m</span>&nbsp;<span class="op" id="5964410">=</span>&nbsp;<span class="ident" id="5964412">s_IFLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964421">case</span>&nbsp;<span class="ident" id="5964426">os</span><span class="op" id="5964428">.</span><span class="ident" id="5964429">ModeNamedPipe</span><span class="op" id="5964442">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964446">m</span>&nbsp;<span class="op" id="5964448">=</span>&nbsp;<span class="ident" id="5964450">s_IFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964459">case</span>&nbsp;<span class="ident" id="5964464">os</span><span class="op" id="5964466">.</span><span class="ident" id="5964467">ModeSocket</span><span class="op" id="5964477">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964481">m</span>&nbsp;<span class="op" id="5964483">=</span>&nbsp;<span class="ident" id="5964485">s_IFSOCK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964495">case</span>&nbsp;<span class="ident" id="5964500">os</span><span class="op" id="5964502">.</span><span class="ident" id="5964503">ModeDevice</span><span class="op" id="5964513">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964517">if</span>&nbsp;<span class="ident" id="5964520">mode</span><span class="op" id="5964524">&amp;</span><span class="ident" id="5964525">os</span><span class="op" id="5964527">.</span><span class="ident" id="5964528">ModeCharDevice</span>&nbsp;<span class="op" id="5964543">!=</span>&nbsp;<span class="num" id="5964546">0</span>&nbsp;<span class="op" id="5964548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964553">m</span>&nbsp;<span class="op" id="5964555">=</span>&nbsp;<span class="ident" id="5964557">s_IFCHR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964567">}</span>&nbsp;<span class="keyword" id="5964569">else</span>&nbsp;<span class="op" id="5964574">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964579">m</span>&nbsp;<span class="op" id="5964581">=</span>&nbsp;<span class="ident" id="5964583">s_IFBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964599">if</span>&nbsp;<span class="ident" id="5964602">mode</span><span class="op" id="5964606">&amp;</span><span class="ident" id="5964607">os</span><span class="op" id="5964609">.</span><span class="ident" id="5964610">ModeSetuid</span>&nbsp;<span class="op" id="5964621">!=</span>&nbsp;<span class="num" id="5964624">0</span>&nbsp;<span class="op" id="5964626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964630">m</span>&nbsp;<span class="op" id="5964632">|=</span>&nbsp;<span class="ident" id="5964635">s_ISUID</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964647">if</span>&nbsp;<span class="ident" id="5964650">mode</span><span class="op" id="5964654">&amp;</span><span class="ident" id="5964655">os</span><span class="op" id="5964657">.</span><span class="ident" id="5964658">ModeSetgid</span>&nbsp;<span class="op" id="5964669">!=</span>&nbsp;<span class="num" id="5964672">0</span>&nbsp;<span class="op" id="5964674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964678">m</span>&nbsp;<span class="op" id="5964680">|=</span>&nbsp;<span class="ident" id="5964683">s_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964695">if</span>&nbsp;<span class="ident" id="5964698">mode</span><span class="op" id="5964702">&amp;</span><span class="ident" id="5964703">os</span><span class="op" id="5964705">.</span><span class="ident" id="5964706">ModeSticky</span>&nbsp;<span class="op" id="5964717">!=</span>&nbsp;<span class="num" id="5964720">0</span>&nbsp;<span class="op" id="5964722">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964726">m</span>&nbsp;<span class="op" id="5964728">|=</span>&nbsp;<span class="ident" id="5964731">s_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964743">return</span>&nbsp;<span class="ident" id="5964750">m</span>&nbsp;<span class="op" id="5964752">|</span>&nbsp;<span class="builtintype" id="5964754">uint32</span><span class="op" id="5964760">(</span><span class="ident" id="5964761">mode</span><span class="op" id="5964765">&amp;</span><span class="num" id="5964766">0777</span><span class="op" id="5964770">)</span><br>
<span class="lineno"></span><span class="op" id="5964772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5964775">func</span>&nbsp;<span class="ident" id="5964780">unixModeToFileMode</span><span class="op" id="5964798">(</span><span class="ident" id="5964799">m</span>&nbsp;<span class="builtintype" id="5964801">uint32</span><span class="op" id="5964807">)</span>&nbsp;<span class="ident" id="5964809">os</span><span class="op" id="5964811">.</span><span class="ident" id="5964812">FileMode</span>&nbsp;<span class="op" id="5964821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964824">mode</span>&nbsp;<span class="op" id="5964829">:=</span>&nbsp;<span class="ident" id="5964832">os</span><span class="op" id="5964834">.</span><span class="ident" id="5964835">FileMode</span><span class="op" id="5964843">(</span><span class="ident" id="5964844">m</span>&nbsp;<span class="op" id="5964846">&amp;</span>&nbsp;<span class="num" id="5964848">0777</span><span class="op" id="5964852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964855">switch</span>&nbsp;<span class="ident" id="5964862">m</span>&nbsp;<span class="op" id="5964864">&amp;</span>&nbsp;<span class="ident" id="5964866">s_IFMT</span>&nbsp;<span class="op" id="5964873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964876">case</span>&nbsp;<span class="ident" id="5964881">s_IFBLK</span><span class="op" id="5964888">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964892">mode</span>&nbsp;<span class="op" id="5964897">|=</span>&nbsp;<span class="ident" id="5964900">os</span><span class="op" id="5964902">.</span><span class="ident" id="5964903">ModeDevice</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964915">case</span>&nbsp;<span class="ident" id="5964920">s_IFCHR</span><span class="op" id="5964927">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964931">mode</span>&nbsp;<span class="op" id="5964936">|=</span>&nbsp;<span class="ident" id="5964939">os</span><span class="op" id="5964941">.</span><span class="ident" id="5964942">ModeDevice</span>&nbsp;<span class="op" id="5964953">|</span>&nbsp;<span class="ident" id="5964955">os</span><span class="op" id="5964957">.</span><span class="ident" id="5964958">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964974">case</span>&nbsp;<span class="ident" id="5964979">s_IFDIR</span><span class="op" id="5964986">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964990">mode</span>&nbsp;<span class="op" id="5964995">|=</span>&nbsp;<span class="ident" id="5964998">os</span><span class="op" id="5965000">.</span><span class="ident" id="5965001">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965010">case</span>&nbsp;<span class="ident" id="5965015">s_IFIFO</span><span class="op" id="5965022">:</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965026">mode</span>&nbsp;<span class="op" id="5965031">|=</span>&nbsp;<span class="ident" id="5965034">os</span><span class="op" id="5965036">.</span><span class="ident" id="5965037">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965052">case</span>&nbsp;<span class="ident" id="5965057">s_IFLNK</span><span class="op" id="5965064">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965068">mode</span>&nbsp;<span class="op" id="5965073">|=</span>&nbsp;<span class="ident" id="5965076">os</span><span class="op" id="5965078">.</span><span class="ident" id="5965079">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965092">case</span>&nbsp;<span class="ident" id="5965097">s_IFREG</span><span class="op" id="5965104">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5965108">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965126">case</span>&nbsp;<span class="ident" id="5965131">s_IFSOCK</span><span class="op" id="5965139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965143">mode</span>&nbsp;<span class="op" id="5965148">|=</span>&nbsp;<span class="ident" id="5965151">os</span><span class="op" id="5965153">.</span><span class="ident" id="5965154">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965169">if</span>&nbsp;<span class="ident" id="5965172">m</span><span class="op" id="5965173">&amp;</span><span class="ident" id="5965174">s_ISGID</span>&nbsp;<span class="op" id="5965182">!=</span>&nbsp;<span class="num" id="5965185">0</span>&nbsp;<span class="op" id="5965187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965191">mode</span>&nbsp;<span class="op" id="5965196">|=</span>&nbsp;<span class="ident" id="5965199">os</span><span class="op" id="5965201">.</span><span class="ident" id="5965202">ModeSetgid</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965217">if</span>&nbsp;<span class="ident" id="5965220">m</span><span class="op" id="5965221">&amp;</span><span class="ident" id="5965222">s_ISUID</span>&nbsp;<span class="op" id="5965230">!=</span>&nbsp;<span class="num" id="5965233">0</span>&nbsp;<span class="op" id="5965235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965239">mode</span>&nbsp;<span class="op" id="5965244">|=</span>&nbsp;<span class="ident" id="5965247">os</span><span class="op" id="5965249">.</span><span class="ident" id="5965250">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965265">if</span>&nbsp;<span class="ident" id="5965268">m</span><span class="op" id="5965269">&amp;</span><span class="ident" id="5965270">s_ISVTX</span>&nbsp;<span class="op" id="5965278">!=</span>&nbsp;<span class="num" id="5965281">0</span>&nbsp;<span class="op" id="5965283">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965287">mode</span>&nbsp;<span class="op" id="5965292">|=</span>&nbsp;<span class="ident" id="5965295">os</span><span class="op" id="5965297">.</span><span class="ident" id="5965298">ModeSticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965313">return</span>&nbsp;<span class="ident" id="5965320">mode</span><br>
<span class="lineno"></span><span class="op" id="5965325">}</span>
</div>
</body>
</html>
