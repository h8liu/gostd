<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html" class="current">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5532807">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5532862">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5532916">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5532967">//&nbsp;This&nbsp;algorithm&nbsp;is&nbsp;based&nbsp;on&nbsp;&#34;Faster&nbsp;Suffix&nbsp;Sorting&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5533021">//&nbsp;&nbsp;&nbsp;by&nbsp;N.&nbsp;Jesper&nbsp;Larsson&nbsp;and&nbsp;Kunihiko&nbsp;Sadakane</span><br>
<span class="lineno"></span><span class="comment" id="5533069">//&nbsp;paper:&nbsp;http://www.larsson.dogma.net/ssrev-tr.pdf</span><br>
<span class="lineno"></span><span class="comment" id="5533121">//&nbsp;code:&nbsp;&nbsp;http://www.larsson.dogma.net/qsufsort.c</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="5533172">//&nbsp;This&nbsp;algorithm&nbsp;computes&nbsp;the&nbsp;suffix&nbsp;array&nbsp;sa&nbsp;by&nbsp;computing&nbsp;its&nbsp;inverse.</span><br>
<span class="lineno"></span><span class="comment" id="5533245">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;in&nbsp;sa&nbsp;are&nbsp;labeled&nbsp;as&nbsp;sorted&nbsp;groups&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5533317">//&nbsp;unsorted&nbsp;groups.&nbsp;For&nbsp;a&nbsp;given&nbsp;pass&nbsp;of&nbsp;the&nbsp;sorter,&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;ordered</span><br>
<span class="lineno"></span><span class="comment" id="5533394">//&nbsp;up&nbsp;to&nbsp;their&nbsp;first&nbsp;h&nbsp;characters,&nbsp;and&nbsp;sa&nbsp;is&nbsp;h-ordered.&nbsp;Suffixes&nbsp;in&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="5533468">//&nbsp;final&nbsp;positions&nbsp;and&nbsp;unambiguously&nbsp;sorted&nbsp;in&nbsp;h-order&nbsp;are&nbsp;in&nbsp;a&nbsp;sorted&nbsp;group.</span><br>
<span class="lineno">15</span><span class="comment" id="5533546">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;with&nbsp;identical&nbsp;first&nbsp;h&nbsp;characters&nbsp;are&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5533621">//&nbsp;unsorted&nbsp;group.&nbsp;In&nbsp;each&nbsp;pass&nbsp;of&nbsp;the&nbsp;algorithm,&nbsp;unsorted&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span><span class="comment" id="5533698">//&nbsp;according&nbsp;to&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;their&nbsp;following&nbsp;suffix.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5533759">//&nbsp;In&nbsp;the&nbsp;implementation,&nbsp;if&nbsp;sa[i]&nbsp;is&nbsp;negative,&nbsp;it&nbsp;indicates&nbsp;that&nbsp;i&nbsp;is</span><br>
<span class="lineno">20</span><span class="comment" id="5533830">//&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;a&nbsp;sorted&nbsp;group&nbsp;of&nbsp;length&nbsp;-sa[i],&nbsp;and&nbsp;can&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="comment" id="5533907">//&nbsp;An&nbsp;unsorted&nbsp;group&nbsp;sa[i:k]&nbsp;is&nbsp;given&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;the&nbsp;index&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5533982">//&nbsp;last&nbsp;element,&nbsp;k-1.&nbsp;The&nbsp;group&nbsp;numbers&nbsp;are&nbsp;stored&nbsp;in&nbsp;the&nbsp;inverse&nbsp;slice&nbsp;(inv),</span><br>
<span class="lineno"></span><span class="comment" id="5534061">//&nbsp;and&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted,&nbsp;this&nbsp;slice&nbsp;is&nbsp;the&nbsp;inverse&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5534137">package</span>&nbsp;<span class="ident" id="5534145">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5534158">import</span>&nbsp;<span class="string" id="5534165">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5534173">func</span>&nbsp;<span class="ident" id="5534178">qsufsort</span><span class="op" id="5534186">(</span><span class="ident" id="5534187">data</span>&nbsp;<span class="op" id="5534192">[</span><span class="op" id="5534193">]</span><span class="builtintype" id="5534194">byte</span><span class="op" id="5534198">)</span>&nbsp;<span class="op" id="5534200">[</span><span class="op" id="5534201">]</span><span class="builtintype" id="5534202">int</span>&nbsp;<span class="op" id="5534206">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534209">//&nbsp;initial&nbsp;sorting&nbsp;by&nbsp;first&nbsp;byte&nbsp;of&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534253">sa</span>&nbsp;<span class="op" id="5534256">:=</span>&nbsp;<span class="ident" id="5534259">sortedByFirstByte</span><span class="op" id="5534276">(</span><span class="ident" id="5534277">data</span><span class="op" id="5534281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534284">if</span>&nbsp;<span class="builtinfunc" id="5534287">len</span><span class="op" id="5534290">(</span><span class="ident" id="5534291">sa</span><span class="op" id="5534293">)</span>&nbsp;<span class="op" id="5534295">&lt;</span>&nbsp;<span class="num" id="5534297">2</span>&nbsp;<span class="op" id="5534299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534303">return</span>&nbsp;<span class="ident" id="5534310">sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534314">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534317">//&nbsp;initialize&nbsp;the&nbsp;group&nbsp;lookup&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534355">//&nbsp;this&nbsp;becomes&nbsp;the&nbsp;inverse&nbsp;of&nbsp;the&nbsp;suffix&nbsp;array&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534431">inv</span>&nbsp;<span class="op" id="5534435">:=</span>&nbsp;<span class="ident" id="5534438">initGroups</span><span class="op" id="5534448">(</span><span class="ident" id="5534449">sa</span><span class="op" id="5534451">,</span>&nbsp;<span class="ident" id="5534453">data</span><span class="op" id="5534457">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534461">//&nbsp;the&nbsp;index&nbsp;starts&nbsp;1-ordered</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534492">sufSortable</span>&nbsp;<span class="op" id="5534504">:=</span>&nbsp;<span class="op" id="5534507">&amp;</span><span class="ident" id="5534508">suffixSortable</span><span class="op" id="5534522">{</span><span class="ident" id="5534523">sa</span><span class="op" id="5534525">:</span>&nbsp;<span class="ident" id="5534527">sa</span><span class="op" id="5534529">,</span>&nbsp;<span class="ident" id="5534531">inv</span><span class="op" id="5534534">:</span>&nbsp;<span class="ident" id="5534536">inv</span><span class="op" id="5534539">,</span>&nbsp;<span class="ident" id="5534541">h</span><span class="op" id="5534542">:</span>&nbsp;<span class="num" id="5534544">1</span><span class="op" id="5534545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534549">for</span>&nbsp;<span class="ident" id="5534553">sa</span><span class="op" id="5534555">[</span><span class="num" id="5534556">0</span><span class="op" id="5534557">]</span>&nbsp;<span class="op" id="5534559">&gt;</span>&nbsp;<span class="op" id="5534561">-</span><span class="builtinfunc" id="5534562">len</span><span class="op" id="5534565">(</span><span class="ident" id="5534566">sa</span><span class="op" id="5534568">)</span>&nbsp;<span class="op" id="5534570">{</span>&nbsp;<span class="comment" id="5534572">//&nbsp;until&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;one&nbsp;big&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534621">//&nbsp;The&nbsp;suffixes&nbsp;are&nbsp;h-ordered,&nbsp;make&nbsp;them&nbsp;2*h-ordered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534676">pi</span>&nbsp;<span class="op" id="5534679">:=</span>&nbsp;<span class="num" id="5534682">0</span>&nbsp;<span class="comment" id="5534684">//&nbsp;pi&nbsp;is&nbsp;first&nbsp;position&nbsp;of&nbsp;first&nbsp;group</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534725">sl</span>&nbsp;<span class="op" id="5534728">:=</span>&nbsp;<span class="num" id="5534731">0</span>&nbsp;<span class="comment" id="5534733">//&nbsp;sl&nbsp;is&nbsp;negated&nbsp;length&nbsp;of&nbsp;sorted&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534776">for</span>&nbsp;<span class="ident" id="5534780">pi</span>&nbsp;<span class="op" id="5534783">&lt;</span>&nbsp;<span class="builtinfunc" id="5534785">len</span><span class="op" id="5534788">(</span><span class="ident" id="5534789">sa</span><span class="op" id="5534791">)</span>&nbsp;<span class="op" id="5534793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534798">if</span>&nbsp;<span class="ident" id="5534801">s</span>&nbsp;<span class="op" id="5534803">:=</span>&nbsp;<span class="ident" id="5534806">sa</span><span class="op" id="5534808">[</span><span class="ident" id="5534809">pi</span><span class="op" id="5534811">]</span><span class="op" id="5534812">;</span>&nbsp;<span class="ident" id="5534814">s</span>&nbsp;<span class="op" id="5534816">&lt;</span>&nbsp;<span class="num" id="5534818">0</span>&nbsp;<span class="op" id="5534820">{</span>&nbsp;<span class="comment" id="5534822">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534855">pi</span>&nbsp;<span class="op" id="5534858">-=</span>&nbsp;<span class="ident" id="5534861">s</span>&nbsp;<span class="comment" id="5534863">//&nbsp;skip&nbsp;over&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534893">sl</span>&nbsp;<span class="op" id="5534896">+=</span>&nbsp;<span class="ident" id="5534899">s</span>&nbsp;<span class="comment" id="5534901">//&nbsp;add&nbsp;negated&nbsp;length&nbsp;to&nbsp;sl</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534932">}</span>&nbsp;<span class="keyword" id="5534934">else</span>&nbsp;<span class="op" id="5534939">{</span>&nbsp;<span class="comment" id="5534941">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534976">if</span>&nbsp;<span class="ident" id="5534979">sl</span>&nbsp;<span class="op" id="5534982">!=</span>&nbsp;<span class="num" id="5534985">0</span>&nbsp;<span class="op" id="5534987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534994">sa</span><span class="op" id="5534996">[</span><span class="ident" id="5534997">pi</span><span class="op" id="5534999">+</span><span class="ident" id="5535000">sl</span><span class="op" id="5535002">]</span>&nbsp;<span class="op" id="5535004">=</span>&nbsp;<span class="ident" id="5535006">sl</span>&nbsp;<span class="comment" id="5535009">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;before&nbsp;pi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535049">sl</span>&nbsp;<span class="op" id="5535052">=</span>&nbsp;<span class="num" id="5535054">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535060">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535066">pk</span>&nbsp;<span class="op" id="5535069">:=</span>&nbsp;<span class="ident" id="5535072">inv</span><span class="op" id="5535075">[</span><span class="ident" id="5535076">s</span><span class="op" id="5535077">]</span>&nbsp;<span class="op" id="5535079">+</span>&nbsp;<span class="num" id="5535081">1</span>&nbsp;<span class="comment" id="5535083">//&nbsp;pk-1&nbsp;is&nbsp;last&nbsp;position&nbsp;of&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535130">sufSortable</span><span class="op" id="5535141">.</span><span class="ident" id="5535142">sa</span>&nbsp;<span class="op" id="5535145">=</span>&nbsp;<span class="ident" id="5535147">sa</span><span class="op" id="5535149">[</span><span class="ident" id="5535150">pi</span><span class="op" id="5535152">:</span><span class="ident" id="5535153">pk</span><span class="op" id="5535155">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535161">sort</span><span class="op" id="5535165">.</span><span class="ident" id="5535166">Sort</span><span class="op" id="5535170">(</span><span class="ident" id="5535171">sufSortable</span><span class="op" id="5535182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535188">sufSortable</span><span class="op" id="5535199">.</span><span class="ident" id="5535200">updateGroups</span><span class="op" id="5535212">(</span><span class="ident" id="5535213">pi</span><span class="op" id="5535215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535221">pi</span>&nbsp;<span class="op" id="5535224">=</span>&nbsp;<span class="ident" id="5535226">pk</span>&nbsp;<span class="comment" id="5535229">//&nbsp;next&nbsp;group</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535254">if</span>&nbsp;<span class="ident" id="5535257">sl</span>&nbsp;<span class="op" id="5535260">!=</span>&nbsp;<span class="num" id="5535263">0</span>&nbsp;<span class="op" id="5535265">{</span>&nbsp;<span class="comment" id="5535267">//&nbsp;if&nbsp;the&nbsp;array&nbsp;ends&nbsp;with&nbsp;a&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535311">sa</span><span class="op" id="5535313">[</span><span class="ident" id="5535314">pi</span><span class="op" id="5535316">+</span><span class="ident" id="5535317">sl</span><span class="op" id="5535319">]</span>&nbsp;<span class="op" id="5535321">=</span>&nbsp;<span class="ident" id="5535323">sl</span>&nbsp;<span class="comment" id="5535326">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;at&nbsp;end&nbsp;of&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535366">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535371">sufSortable</span><span class="op" id="5535382">.</span><span class="ident" id="5535383">h</span>&nbsp;<span class="op" id="5535385">*=</span>&nbsp;<span class="num" id="5535388">2</span>&nbsp;<span class="comment" id="5535390">//&nbsp;double&nbsp;sorted&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535418">for</span>&nbsp;<span class="ident" id="5535422">i</span>&nbsp;<span class="op" id="5535424">:=</span>&nbsp;<span class="keyword" id="5535427">range</span>&nbsp;<span class="ident" id="5535433">sa</span>&nbsp;<span class="op" id="5535436">{</span>&nbsp;<span class="comment" id="5535438">//&nbsp;reconstruct&nbsp;suffix&nbsp;array&nbsp;from&nbsp;inverse</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535481">sa</span><span class="op" id="5535483">[</span><span class="ident" id="5535484">inv</span><span class="op" id="5535487">[</span><span class="ident" id="5535488">i</span><span class="op" id="5535489">]</span><span class="op" id="5535490">]</span>&nbsp;<span class="op" id="5535492">=</span>&nbsp;<span class="ident" id="5535494">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535500">return</span>&nbsp;<span class="ident" id="5535507">sa</span><br>
<span class="lineno"></span><span class="op" id="5535510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5535513">func</span>&nbsp;<span class="ident" id="5535518">sortedByFirstByte</span><span class="op" id="5535535">(</span><span class="ident" id="5535536">data</span>&nbsp;<span class="op" id="5535541">[</span><span class="op" id="5535542">]</span><span class="builtintype" id="5535543">byte</span><span class="op" id="5535547">)</span>&nbsp;<span class="op" id="5535549">[</span><span class="op" id="5535550">]</span><span class="builtintype" id="5535551">int</span>&nbsp;<span class="op" id="5535555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5535558">//&nbsp;total&nbsp;byte&nbsp;counts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535580">var</span>&nbsp;<span class="ident" id="5535584">count</span>&nbsp;<span class="op" id="5535590">[</span><span class="num" id="5535591">256</span><span class="op" id="5535594">]</span><span class="builtintype" id="5535595">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535600">for</span>&nbsp;<span class="ident" id="5535604">_</span><span class="op" id="5535605">,</span>&nbsp;<span class="ident" id="5535607">b</span>&nbsp;<span class="op" id="5535609">:=</span>&nbsp;<span class="keyword" id="5535612">range</span>&nbsp;<span class="ident" id="5535618">data</span>&nbsp;<span class="op" id="5535623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535627">count</span><span class="op" id="5535632">[</span><span class="ident" id="5535633">b</span><span class="op" id="5535634">]</span><span class="op" id="5535635">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5535642">//&nbsp;make&nbsp;count[b]&nbsp;equal&nbsp;index&nbsp;of&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;sorted&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535713">sum</span>&nbsp;<span class="op" id="5535717">:=</span>&nbsp;<span class="num" id="5535720">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535723">for</span>&nbsp;<span class="ident" id="5535727">b</span>&nbsp;<span class="op" id="5535729">:=</span>&nbsp;<span class="keyword" id="5535732">range</span>&nbsp;<span class="ident" id="5535738">count</span>&nbsp;<span class="op" id="5535744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535748">count</span><span class="op" id="5535753">[</span><span class="ident" id="5535754">b</span><span class="op" id="5535755">]</span><span class="op" id="5535756">,</span>&nbsp;<span class="ident" id="5535758">sum</span>&nbsp;<span class="op" id="5535762">=</span>&nbsp;<span class="ident" id="5535764">sum</span><span class="op" id="5535767">,</span>&nbsp;<span class="ident" id="5535769">count</span><span class="op" id="5535774">[</span><span class="ident" id="5535775">b</span><span class="op" id="5535776">]</span><span class="op" id="5535777">+</span><span class="ident" id="5535778">sum</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5535786">//&nbsp;iterate&nbsp;through&nbsp;bytes,&nbsp;placing&nbsp;index&nbsp;into&nbsp;the&nbsp;correct&nbsp;spot&nbsp;in&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535855">sa</span>&nbsp;<span class="op" id="5535858">:=</span>&nbsp;<span class="builtinfunc" id="5535861">make</span><span class="op" id="5535865">(</span><span class="op" id="5535866">[</span><span class="op" id="5535867">]</span><span class="builtintype" id="5535868">int</span><span class="op" id="5535871">,</span>&nbsp;<span class="builtinfunc" id="5535873">len</span><span class="op" id="5535876">(</span><span class="ident" id="5535877">data</span><span class="op" id="5535881">)</span><span class="op" id="5535882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535885">for</span>&nbsp;<span class="ident" id="5535889">i</span><span class="op" id="5535890">,</span>&nbsp;<span class="ident" id="5535892">b</span>&nbsp;<span class="op" id="5535894">:=</span>&nbsp;<span class="keyword" id="5535897">range</span>&nbsp;<span class="ident" id="5535903">data</span>&nbsp;<span class="op" id="5535908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535912">sa</span><span class="op" id="5535914">[</span><span class="ident" id="5535915">count</span><span class="op" id="5535920">[</span><span class="ident" id="5535921">b</span><span class="op" id="5535922">]</span><span class="op" id="5535923">]</span>&nbsp;<span class="op" id="5535925">=</span>&nbsp;<span class="ident" id="5535927">i</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535931">count</span><span class="op" id="5535936">[</span><span class="ident" id="5535937">b</span><span class="op" id="5535938">]</span><span class="op" id="5535939">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535946">return</span>&nbsp;<span class="ident" id="5535953">sa</span><br>
<span class="lineno"></span><span class="op" id="5535956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5535959">func</span>&nbsp;<span class="ident" id="5535964">initGroups</span><span class="op" id="5535974">(</span><span class="ident" id="5535975">sa</span>&nbsp;<span class="op" id="5535978">[</span><span class="op" id="5535979">]</span><span class="builtintype" id="5535980">int</span><span class="op" id="5535983">,</span>&nbsp;<span class="ident" id="5535985">data</span>&nbsp;<span class="op" id="5535990">[</span><span class="op" id="5535991">]</span><span class="builtintype" id="5535992">byte</span><span class="op" id="5535996">)</span>&nbsp;<span class="op" id="5535998">[</span><span class="op" id="5535999">]</span><span class="builtintype" id="5536000">int</span>&nbsp;<span class="op" id="5536004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5536007">//&nbsp;label&nbsp;contiguous&nbsp;same-letter&nbsp;groups&nbsp;with&nbsp;the&nbsp;same&nbsp;group&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536074">inv</span>&nbsp;<span class="op" id="5536078">:=</span>&nbsp;<span class="builtinfunc" id="5536081">make</span><span class="op" id="5536085">(</span><span class="op" id="5536086">[</span><span class="op" id="5536087">]</span><span class="builtintype" id="5536088">int</span><span class="op" id="5536091">,</span>&nbsp;<span class="builtinfunc" id="5536093">len</span><span class="op" id="5536096">(</span><span class="ident" id="5536097">data</span><span class="op" id="5536101">)</span><span class="op" id="5536102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536105">prevGroup</span>&nbsp;<span class="op" id="5536115">:=</span>&nbsp;<span class="builtinfunc" id="5536118">len</span><span class="op" id="5536121">(</span><span class="ident" id="5536122">sa</span><span class="op" id="5536124">)</span>&nbsp;<span class="op" id="5536126">-</span>&nbsp;<span class="num" id="5536128">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536131">groupByte</span>&nbsp;<span class="op" id="5536141">:=</span>&nbsp;<span class="ident" id="5536144">data</span><span class="op" id="5536148">[</span><span class="ident" id="5536149">sa</span><span class="op" id="5536151">[</span><span class="ident" id="5536152">prevGroup</span><span class="op" id="5536161">]</span><span class="op" id="5536162">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536165">for</span>&nbsp;<span class="ident" id="5536169">i</span>&nbsp;<span class="op" id="5536171">:=</span>&nbsp;<span class="builtinfunc" id="5536174">len</span><span class="op" id="5536177">(</span><span class="ident" id="5536178">sa</span><span class="op" id="5536180">)</span>&nbsp;<span class="op" id="5536182">-</span>&nbsp;<span class="num" id="5536184">1</span><span class="op" id="5536185">;</span>&nbsp;<span class="ident" id="5536187">i</span>&nbsp;<span class="op" id="5536189">&gt;=</span>&nbsp;<span class="num" id="5536192">0</span><span class="op" id="5536193">;</span>&nbsp;<span class="ident" id="5536195">i</span><span class="op" id="5536196">--</span>&nbsp;<span class="op" id="5536199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536203">if</span>&nbsp;<span class="ident" id="5536206">b</span>&nbsp;<span class="op" id="5536208">:=</span>&nbsp;<span class="ident" id="5536211">data</span><span class="op" id="5536215">[</span><span class="ident" id="5536216">sa</span><span class="op" id="5536218">[</span><span class="ident" id="5536219">i</span><span class="op" id="5536220">]</span><span class="op" id="5536221">]</span><span class="op" id="5536222">;</span>&nbsp;<span class="ident" id="5536224">b</span>&nbsp;<span class="op" id="5536226">&lt;</span>&nbsp;<span class="ident" id="5536228">groupByte</span>&nbsp;<span class="op" id="5536238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536243">if</span>&nbsp;<span class="ident" id="5536246">prevGroup</span>&nbsp;<span class="op" id="5536256">==</span>&nbsp;<span class="ident" id="5536259">i</span><span class="op" id="5536260">+</span><span class="num" id="5536261">1</span>&nbsp;<span class="op" id="5536263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536269">sa</span><span class="op" id="5536271">[</span><span class="ident" id="5536272">i</span><span class="op" id="5536273">+</span><span class="num" id="5536274">1</span><span class="op" id="5536275">]</span>&nbsp;<span class="op" id="5536277">=</span>&nbsp;<span class="op" id="5536279">-</span><span class="num" id="5536280">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536285">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536290">groupByte</span>&nbsp;<span class="op" id="5536300">=</span>&nbsp;<span class="ident" id="5536302">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536307">prevGroup</span>&nbsp;<span class="op" id="5536317">=</span>&nbsp;<span class="ident" id="5536319">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536327">inv</span><span class="op" id="5536330">[</span><span class="ident" id="5536331">sa</span><span class="op" id="5536333">[</span><span class="ident" id="5536334">i</span><span class="op" id="5536335">]</span><span class="op" id="5536336">]</span>&nbsp;<span class="op" id="5536338">=</span>&nbsp;<span class="ident" id="5536340">prevGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536352">if</span>&nbsp;<span class="ident" id="5536355">prevGroup</span>&nbsp;<span class="op" id="5536365">==</span>&nbsp;<span class="num" id="5536368">0</span>&nbsp;<span class="op" id="5536370">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536375">sa</span><span class="op" id="5536377">[</span><span class="num" id="5536378">0</span><span class="op" id="5536379">]</span>&nbsp;<span class="op" id="5536381">=</span>&nbsp;<span class="op" id="5536383">-</span><span class="num" id="5536384">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5536394">//&nbsp;Separate&nbsp;out&nbsp;the&nbsp;final&nbsp;suffix&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;its&nbsp;group.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5536455">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;to&nbsp;ensure&nbsp;the&nbsp;suffix&nbsp;&#34;a&#34;&nbsp;is&nbsp;before&nbsp;&#34;aba&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5536518">//&nbsp;when&nbsp;using&nbsp;a&nbsp;potentially&nbsp;unstable&nbsp;sort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536562">lastByte</span>&nbsp;<span class="op" id="5536571">:=</span>&nbsp;<span class="ident" id="5536574">data</span><span class="op" id="5536578">[</span><span class="builtinfunc" id="5536579">len</span><span class="op" id="5536582">(</span><span class="ident" id="5536583">data</span><span class="op" id="5536587">)</span><span class="op" id="5536588">-</span><span class="num" id="5536589">1</span><span class="op" id="5536590">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536593">s</span>&nbsp;<span class="op" id="5536595">:=</span>&nbsp;<span class="op" id="5536598">-</span><span class="num" id="5536599">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536602">for</span>&nbsp;<span class="ident" id="5536606">i</span>&nbsp;<span class="op" id="5536608">:=</span>&nbsp;<span class="keyword" id="5536611">range</span>&nbsp;<span class="ident" id="5536617">sa</span>&nbsp;<span class="op" id="5536620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536624">if</span>&nbsp;<span class="ident" id="5536627">sa</span><span class="op" id="5536629">[</span><span class="ident" id="5536630">i</span><span class="op" id="5536631">]</span>&nbsp;<span class="op" id="5536633">&gt;=</span>&nbsp;<span class="num" id="5536636">0</span>&nbsp;<span class="op" id="5536638">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536643">if</span>&nbsp;<span class="ident" id="5536646">data</span><span class="op" id="5536650">[</span><span class="ident" id="5536651">sa</span><span class="op" id="5536653">[</span><span class="ident" id="5536654">i</span><span class="op" id="5536655">]</span><span class="op" id="5536656">]</span>&nbsp;<span class="op" id="5536658">==</span>&nbsp;<span class="ident" id="5536661">lastByte</span>&nbsp;<span class="op" id="5536670">&amp;&amp;</span>&nbsp;<span class="ident" id="5536673">s</span>&nbsp;<span class="op" id="5536675">==</span>&nbsp;<span class="op" id="5536678">-</span><span class="num" id="5536679">1</span>&nbsp;<span class="op" id="5536681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536687">s</span>&nbsp;<span class="op" id="5536689">=</span>&nbsp;<span class="ident" id="5536691">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536701">if</span>&nbsp;<span class="ident" id="5536704">sa</span><span class="op" id="5536706">[</span><span class="ident" id="5536707">i</span><span class="op" id="5536708">]</span>&nbsp;<span class="op" id="5536710">==</span>&nbsp;<span class="builtinfunc" id="5536713">len</span><span class="op" id="5536716">(</span><span class="ident" id="5536717">sa</span><span class="op" id="5536719">)</span><span class="op" id="5536720">-</span><span class="num" id="5536721">1</span>&nbsp;<span class="op" id="5536723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536729">sa</span><span class="op" id="5536731">[</span><span class="ident" id="5536732">i</span><span class="op" id="5536733">]</span><span class="op" id="5536734">,</span>&nbsp;<span class="ident" id="5536736">sa</span><span class="op" id="5536738">[</span><span class="ident" id="5536739">s</span><span class="op" id="5536740">]</span>&nbsp;<span class="op" id="5536742">=</span>&nbsp;<span class="ident" id="5536744">sa</span><span class="op" id="5536746">[</span><span class="ident" id="5536747">s</span><span class="op" id="5536748">]</span><span class="op" id="5536749">,</span>&nbsp;<span class="ident" id="5536751">sa</span><span class="op" id="5536753">[</span><span class="ident" id="5536754">i</span><span class="op" id="5536755">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536761">inv</span><span class="op" id="5536764">[</span><span class="ident" id="5536765">sa</span><span class="op" id="5536767">[</span><span class="ident" id="5536768">s</span><span class="op" id="5536769">]</span><span class="op" id="5536770">]</span>&nbsp;<span class="op" id="5536772">=</span>&nbsp;<span class="ident" id="5536774">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536780">sa</span><span class="op" id="5536782">[</span><span class="ident" id="5536783">s</span><span class="op" id="5536784">]</span>&nbsp;<span class="op" id="5536786">=</span>&nbsp;<span class="op" id="5536788">-</span><span class="num" id="5536789">1</span>&nbsp;<span class="comment" id="5536791">//&nbsp;mark&nbsp;it&nbsp;as&nbsp;an&nbsp;isolated&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536834">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536847">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536853">return</span>&nbsp;<span class="ident" id="5536860">inv</span><br>
<span class="lineno"></span><span class="op" id="5536864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5536867">type</span>&nbsp;<span class="ident" id="5536872">suffixSortable</span>&nbsp;<span class="keyword" id="5536887">struct</span>&nbsp;<span class="op" id="5536894">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536897">sa</span>&nbsp;&nbsp;<span class="op" id="5536901">[</span><span class="op" id="5536902">]</span><span class="builtintype" id="5536903">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536908">inv</span>&nbsp;<span class="op" id="5536912">[</span><span class="op" id="5536913">]</span><span class="builtintype" id="5536914">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536919">h</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5536923">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536928">buf</span>&nbsp;<span class="op" id="5536932">[</span><span class="op" id="5536933">]</span><span class="builtintype" id="5536934">int</span>&nbsp;<span class="comment" id="5536938">//&nbsp;common&nbsp;scratch&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="5536962">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="5536965">func</span>&nbsp;<span class="op" id="5536970">(</span><span class="ident" id="5536971">x</span>&nbsp;<span class="op" id="5536973">*</span><span class="ident" id="5536974">suffixSortable</span><span class="op" id="5536988">)</span>&nbsp;<span class="ident" id="5536990">Len</span><span class="op" id="5536993">(</span><span class="op" id="5536994">)</span>&nbsp;<span class="builtintype" id="5536996">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5537010">{</span>&nbsp;<span class="keyword" id="5537012">return</span>&nbsp;<span class="builtinfunc" id="5537019">len</span><span class="op" id="5537022">(</span><span class="ident" id="5537023">x</span><span class="op" id="5537024">.</span><span class="ident" id="5537025">sa</span><span class="op" id="5537027">)</span>&nbsp;<span class="op" id="5537029">}</span><br>
<span class="lineno"></span><span class="keyword" id="5537031">func</span>&nbsp;<span class="op" id="5537036">(</span><span class="ident" id="5537037">x</span>&nbsp;<span class="op" id="5537039">*</span><span class="ident" id="5537040">suffixSortable</span><span class="op" id="5537054">)</span>&nbsp;<span class="ident" id="5537056">Less</span><span class="op" id="5537060">(</span><span class="ident" id="5537061">i</span><span class="op" id="5537062">,</span>&nbsp;<span class="ident" id="5537064">j</span>&nbsp;<span class="builtintype" id="5537066">int</span><span class="op" id="5537069">)</span>&nbsp;<span class="builtintype" id="5537071">bool</span>&nbsp;<span class="op" id="5537076">{</span>&nbsp;<span class="keyword" id="5537078">return</span>&nbsp;<span class="ident" id="5537085">x</span><span class="op" id="5537086">.</span><span class="ident" id="5537087">inv</span><span class="op" id="5537090">[</span><span class="ident" id="5537091">x</span><span class="op" id="5537092">.</span><span class="ident" id="5537093">sa</span><span class="op" id="5537095">[</span><span class="ident" id="5537096">i</span><span class="op" id="5537097">]</span><span class="op" id="5537098">+</span><span class="ident" id="5537099">x</span><span class="op" id="5537100">.</span><span class="ident" id="5537101">h</span><span class="op" id="5537102">]</span>&nbsp;<span class="op" id="5537104">&lt;</span>&nbsp;<span class="ident" id="5537106">x</span><span class="op" id="5537107">.</span><span class="ident" id="5537108">inv</span><span class="op" id="5537111">[</span><span class="ident" id="5537112">x</span><span class="op" id="5537113">.</span><span class="ident" id="5537114">sa</span><span class="op" id="5537116">[</span><span class="ident" id="5537117">j</span><span class="op" id="5537118">]</span><span class="op" id="5537119">+</span><span class="ident" id="5537120">x</span><span class="op" id="5537121">.</span><span class="ident" id="5537122">h</span><span class="op" id="5537123">]</span>&nbsp;<span class="op" id="5537125">}</span><br>
<span class="lineno"></span><span class="keyword" id="5537127">func</span>&nbsp;<span class="op" id="5537132">(</span><span class="ident" id="5537133">x</span>&nbsp;<span class="op" id="5537135">*</span><span class="ident" id="5537136">suffixSortable</span><span class="op" id="5537150">)</span>&nbsp;<span class="ident" id="5537152">Swap</span><span class="op" id="5537156">(</span><span class="ident" id="5537157">i</span><span class="op" id="5537158">,</span>&nbsp;<span class="ident" id="5537160">j</span>&nbsp;<span class="builtintype" id="5537162">int</span><span class="op" id="5537165">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5537172">{</span>&nbsp;<span class="ident" id="5537174">x</span><span class="op" id="5537175">.</span><span class="ident" id="5537176">sa</span><span class="op" id="5537178">[</span><span class="ident" id="5537179">i</span><span class="op" id="5537180">]</span><span class="op" id="5537181">,</span>&nbsp;<span class="ident" id="5537183">x</span><span class="op" id="5537184">.</span><span class="ident" id="5537185">sa</span><span class="op" id="5537187">[</span><span class="ident" id="5537188">j</span><span class="op" id="5537189">]</span>&nbsp;<span class="op" id="5537191">=</span>&nbsp;<span class="ident" id="5537193">x</span><span class="op" id="5537194">.</span><span class="ident" id="5537195">sa</span><span class="op" id="5537197">[</span><span class="ident" id="5537198">j</span><span class="op" id="5537199">]</span><span class="op" id="5537200">,</span>&nbsp;<span class="ident" id="5537202">x</span><span class="op" id="5537203">.</span><span class="ident" id="5537204">sa</span><span class="op" id="5537206">[</span><span class="ident" id="5537207">i</span><span class="op" id="5537208">]</span>&nbsp;<span class="op" id="5537210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="5537213">func</span>&nbsp;<span class="op" id="5537218">(</span><span class="ident" id="5537219">x</span>&nbsp;<span class="op" id="5537221">*</span><span class="ident" id="5537222">suffixSortable</span><span class="op" id="5537236">)</span>&nbsp;<span class="ident" id="5537238">updateGroups</span><span class="op" id="5537250">(</span><span class="ident" id="5537251">offset</span>&nbsp;<span class="builtintype" id="5537258">int</span><span class="op" id="5537261">)</span>&nbsp;<span class="op" id="5537263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537266">bounds</span>&nbsp;<span class="op" id="5537273">:=</span>&nbsp;<span class="ident" id="5537276">x</span><span class="op" id="5537277">.</span><span class="ident" id="5537278">buf</span><span class="op" id="5537281">[</span><span class="num" id="5537282">0</span><span class="op" id="5537283">:</span><span class="num" id="5537284">0</span><span class="op" id="5537285">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537288">group</span>&nbsp;<span class="op" id="5537294">:=</span>&nbsp;<span class="ident" id="5537297">x</span><span class="op" id="5537298">.</span><span class="ident" id="5537299">inv</span><span class="op" id="5537302">[</span><span class="ident" id="5537303">x</span><span class="op" id="5537304">.</span><span class="ident" id="5537305">sa</span><span class="op" id="5537307">[</span><span class="num" id="5537308">0</span><span class="op" id="5537309">]</span><span class="op" id="5537310">+</span><span class="ident" id="5537311">x</span><span class="op" id="5537312">.</span><span class="ident" id="5537313">h</span><span class="op" id="5537314">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537317">for</span>&nbsp;<span class="ident" id="5537321">i</span>&nbsp;<span class="op" id="5537323">:=</span>&nbsp;<span class="num" id="5537326">1</span><span class="op" id="5537327">;</span>&nbsp;<span class="ident" id="5537329">i</span>&nbsp;<span class="op" id="5537331">&lt;</span>&nbsp;<span class="builtinfunc" id="5537333">len</span><span class="op" id="5537336">(</span><span class="ident" id="5537337">x</span><span class="op" id="5537338">.</span><span class="ident" id="5537339">sa</span><span class="op" id="5537341">)</span><span class="op" id="5537342">;</span>&nbsp;<span class="ident" id="5537344">i</span><span class="op" id="5537345">++</span>&nbsp;<span class="op" id="5537348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537352">if</span>&nbsp;<span class="ident" id="5537355">g</span>&nbsp;<span class="op" id="5537357">:=</span>&nbsp;<span class="ident" id="5537360">x</span><span class="op" id="5537361">.</span><span class="ident" id="5537362">inv</span><span class="op" id="5537365">[</span><span class="ident" id="5537366">x</span><span class="op" id="5537367">.</span><span class="ident" id="5537368">sa</span><span class="op" id="5537370">[</span><span class="ident" id="5537371">i</span><span class="op" id="5537372">]</span><span class="op" id="5537373">+</span><span class="ident" id="5537374">x</span><span class="op" id="5537375">.</span><span class="ident" id="5537376">h</span><span class="op" id="5537377">]</span><span class="op" id="5537378">;</span>&nbsp;<span class="ident" id="5537380">g</span>&nbsp;<span class="op" id="5537382">&gt;</span>&nbsp;<span class="ident" id="5537384">group</span>&nbsp;<span class="op" id="5537390">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537395">bounds</span>&nbsp;<span class="op" id="5537402">=</span>&nbsp;<span class="builtinfunc" id="5537404">append</span><span class="op" id="5537410">(</span><span class="ident" id="5537411">bounds</span><span class="op" id="5537417">,</span>&nbsp;<span class="ident" id="5537419">i</span><span class="op" id="5537420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537425">group</span>&nbsp;<span class="op" id="5537431">=</span>&nbsp;<span class="ident" id="5537433">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537443">bounds</span>&nbsp;<span class="op" id="5537450">=</span>&nbsp;<span class="builtinfunc" id="5537452">append</span><span class="op" id="5537458">(</span><span class="ident" id="5537459">bounds</span><span class="op" id="5537465">,</span>&nbsp;<span class="builtinfunc" id="5537467">len</span><span class="op" id="5537470">(</span><span class="ident" id="5537471">x</span><span class="op" id="5537472">.</span><span class="ident" id="5537473">sa</span><span class="op" id="5537475">)</span><span class="op" id="5537476">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537479">x</span><span class="op" id="5537480">.</span><span class="ident" id="5537481">buf</span>&nbsp;<span class="op" id="5537485">=</span>&nbsp;<span class="ident" id="5537487">bounds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5537496">//&nbsp;update&nbsp;the&nbsp;group&nbsp;numberings&nbsp;after&nbsp;all&nbsp;new&nbsp;groups&nbsp;are&nbsp;determined</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537564">prev</span>&nbsp;<span class="op" id="5537569">:=</span>&nbsp;<span class="num" id="5537572">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537575">for</span>&nbsp;<span class="ident" id="5537579">_</span><span class="op" id="5537580">,</span>&nbsp;<span class="ident" id="5537582">b</span>&nbsp;<span class="op" id="5537584">:=</span>&nbsp;<span class="keyword" id="5537587">range</span>&nbsp;<span class="ident" id="5537593">bounds</span>&nbsp;<span class="op" id="5537600">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537604">for</span>&nbsp;<span class="ident" id="5537608">i</span>&nbsp;<span class="op" id="5537610">:=</span>&nbsp;<span class="ident" id="5537613">prev</span><span class="op" id="5537617">;</span>&nbsp;<span class="ident" id="5537619">i</span>&nbsp;<span class="op" id="5537621">&lt;</span>&nbsp;<span class="ident" id="5537623">b</span><span class="op" id="5537624">;</span>&nbsp;<span class="ident" id="5537626">i</span><span class="op" id="5537627">++</span>&nbsp;<span class="op" id="5537630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537635">x</span><span class="op" id="5537636">.</span><span class="ident" id="5537637">inv</span><span class="op" id="5537640">[</span><span class="ident" id="5537641">x</span><span class="op" id="5537642">.</span><span class="ident" id="5537643">sa</span><span class="op" id="5537645">[</span><span class="ident" id="5537646">i</span><span class="op" id="5537647">]</span><span class="op" id="5537648">]</span>&nbsp;<span class="op" id="5537650">=</span>&nbsp;<span class="ident" id="5537652">offset</span>&nbsp;<span class="op" id="5537659">+</span>&nbsp;<span class="ident" id="5537661">b</span>&nbsp;<span class="op" id="5537663">-</span>&nbsp;<span class="num" id="5537665">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537673">if</span>&nbsp;<span class="ident" id="5537676">b</span><span class="op" id="5537677">-</span><span class="ident" id="5537678">prev</span>&nbsp;<span class="op" id="5537683">==</span>&nbsp;<span class="num" id="5537686">1</span>&nbsp;<span class="op" id="5537688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537693">x</span><span class="op" id="5537694">.</span><span class="ident" id="5537695">sa</span><span class="op" id="5537697">[</span><span class="ident" id="5537698">prev</span><span class="op" id="5537702">]</span>&nbsp;<span class="op" id="5537704">=</span>&nbsp;<span class="op" id="5537706">-</span><span class="num" id="5537707">1</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537715">prev</span>&nbsp;<span class="op" id="5537720">=</span>&nbsp;<span class="ident" id="5537722">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537725">}</span><br>
<span class="lineno"></span><span class="op" id="5537727">}</span>
</div>
</body>
</html>
