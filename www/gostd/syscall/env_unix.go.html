<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html" class="current">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2512063">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2512119">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2512173">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2512224">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2512294">//&nbsp;Unix&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2512326">package</span>&nbsp;<span class="ident" id="2512334">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2512343">import</span>&nbsp;<span class="string" id="2512350">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2512358">var</span>&nbsp;<span class="op" id="2512362">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2512365">//&nbsp;envOnce&nbsp;guards&nbsp;initialization&nbsp;by&nbsp;copyenv,&nbsp;which&nbsp;populates&nbsp;env.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2512432">envOnce</span>&nbsp;<span class="ident" id="2512440">sync</span><span class="op" id="2512444">.</span><span class="ident" id="2512445">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2512452">//&nbsp;envLock&nbsp;guards&nbsp;env&nbsp;and&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2512485">envLock</span>&nbsp;<span class="ident" id="2512493">sync</span><span class="op" id="2512497">.</span><span class="ident" id="2512498">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2512508">//&nbsp;env&nbsp;maps&nbsp;from&nbsp;an&nbsp;environment&nbsp;variable&nbsp;to&nbsp;its&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2512583">env</span>&nbsp;<span class="keyword" id="2512587">map</span><span class="op" id="2512590">[</span><span class="builtintype" id="2512591">string</span><span class="op" id="2512597">]</span><span class="builtintype" id="2512598">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2512604">//&nbsp;envs&nbsp;is&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime.&nbsp;elements&nbsp;are&nbsp;expected&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2512666">//&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;key=value&#34;.&nbsp;An&nbsp;empty&nbsp;string&nbsp;means&nbsp;deleted</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2512728">//&nbsp;(or&nbsp;a&nbsp;duplicate&nbsp;to&nbsp;be&nbsp;ignored).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2512764">envs</span>&nbsp;<span class="op" id="2512769">[</span><span class="op" id="2512770">]</span><span class="builtintype" id="2512771">string</span>&nbsp;<span class="op" id="2512778">=</span>&nbsp;<span class="ident" id="2512780">runtime_envs</span><span class="op" id="2512792">(</span><span class="op" id="2512793">)</span><br>
<span class="lineno"></span><span class="op" id="2512795">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2512798">func</span>&nbsp;<span class="ident" id="2512803">runtime_envs</span><span class="op" id="2512815">(</span><span class="op" id="2512816">)</span>&nbsp;<span class="op" id="2512818">[</span><span class="op" id="2512819">]</span><span class="builtintype" id="2512820">string</span>&nbsp;<span class="comment" id="2512827">//&nbsp;in&nbsp;package&nbsp;runtime</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2512850">//&nbsp;setenv_c&nbsp;and&nbsp;unsetenv_c&nbsp;are&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime&nbsp;but&nbsp;are&nbsp;no-ops</span><br>
<span class="lineno"></span><span class="comment" id="2512920">//&nbsp;if&nbsp;cgo&nbsp;isn&#39;t&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="keyword" id="2512944">func</span>&nbsp;<span class="ident" id="2512949">setenv_c</span><span class="op" id="2512957">(</span><span class="ident" id="2512958">k</span><span class="op" id="2512959">,</span>&nbsp;<span class="ident" id="2512961">v</span>&nbsp;<span class="builtintype" id="2512963">string</span><span class="op" id="2512969">)</span><br>
<span class="lineno"></span><span class="keyword" id="2512971">func</span>&nbsp;<span class="ident" id="2512976">unsetenv_c</span><span class="op" id="2512986">(</span><span class="ident" id="2512987">k</span>&nbsp;<span class="builtintype" id="2512989">string</span><span class="op" id="2512995">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2512998">func</span>&nbsp;<span class="ident" id="2513003">copyenv</span><span class="op" id="2513010">(</span><span class="op" id="2513011">)</span>&nbsp;<span class="op" id="2513013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513016">env</span>&nbsp;<span class="op" id="2513020">=</span>&nbsp;<span class="builtinfunc" id="2513022">make</span><span class="op" id="2513026">(</span><span class="keyword" id="2513027">map</span><span class="op" id="2513030">[</span><span class="builtintype" id="2513031">string</span><span class="op" id="2513037">]</span><span class="builtintype" id="2513038">int</span><span class="op" id="2513041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513044">for</span>&nbsp;<span class="ident" id="2513048">i</span><span class="op" id="2513049">,</span>&nbsp;<span class="ident" id="2513051">s</span>&nbsp;<span class="op" id="2513053">:=</span>&nbsp;<span class="keyword" id="2513056">range</span>&nbsp;<span class="ident" id="2513062">envs</span>&nbsp;<span class="op" id="2513067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513071">for</span>&nbsp;<span class="ident" id="2513075">j</span>&nbsp;<span class="op" id="2513077">:=</span>&nbsp;<span class="num" id="2513080">0</span><span class="op" id="2513081">;</span>&nbsp;<span class="ident" id="2513083">j</span>&nbsp;<span class="op" id="2513085">&lt;</span>&nbsp;<span class="builtinfunc" id="2513087">len</span><span class="op" id="2513090">(</span><span class="ident" id="2513091">s</span><span class="op" id="2513092">)</span><span class="op" id="2513093">;</span>&nbsp;<span class="ident" id="2513095">j</span><span class="op" id="2513096">++</span>&nbsp;<span class="op" id="2513099">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513104">if</span>&nbsp;<span class="ident" id="2513107">s</span><span class="op" id="2513108">[</span><span class="ident" id="2513109">j</span><span class="op" id="2513110">]</span>&nbsp;<span class="op" id="2513112">==</span>&nbsp;<span class="string" id="2513115">&#39;=&#39;</span>&nbsp;<span class="op" id="2513119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513125">key</span>&nbsp;<span class="op" id="2513129">:=</span>&nbsp;<span class="ident" id="2513132">s</span><span class="op" id="2513133">[</span><span class="op" id="2513134">:</span><span class="ident" id="2513135">j</span><span class="op" id="2513136">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513142">if</span>&nbsp;<span class="ident" id="2513145">_</span><span class="op" id="2513146">,</span>&nbsp;<span class="ident" id="2513148">ok</span>&nbsp;<span class="op" id="2513151">:=</span>&nbsp;<span class="ident" id="2513154">env</span><span class="op" id="2513157">[</span><span class="ident" id="2513158">key</span><span class="op" id="2513161">]</span><span class="op" id="2513162">;</span>&nbsp;<span class="op" id="2513164">!</span><span class="ident" id="2513165">ok</span>&nbsp;<span class="op" id="2513168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513175">env</span><span class="op" id="2513178">[</span><span class="ident" id="2513179">key</span><span class="op" id="2513182">]</span>&nbsp;<span class="op" id="2513184">=</span>&nbsp;<span class="ident" id="2513186">i</span>&nbsp;<span class="comment" id="2513188">//&nbsp;first&nbsp;mention&nbsp;of&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2513216">}</span>&nbsp;<span class="keyword" id="2513218">else</span>&nbsp;<span class="op" id="2513223">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2513230">//&nbsp;Clear&nbsp;duplicate&nbsp;keys.&nbsp;This&nbsp;permits&nbsp;Unsetenv&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2513285">//&nbsp;safely&nbsp;delete&nbsp;only&nbsp;the&nbsp;first&nbsp;item&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2513335">//&nbsp;worrying&nbsp;about&nbsp;unshadowing&nbsp;a&nbsp;later&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2513383">//&nbsp;which&nbsp;might&nbsp;be&nbsp;a&nbsp;security&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513426">envs</span><span class="op" id="2513430">[</span><span class="ident" id="2513431">i</span><span class="op" id="2513432">]</span>&nbsp;<span class="op" id="2513434">=</span>&nbsp;<span class="string" id="2513436">&#34;&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2513443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513449">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2513458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2513462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2513465">}</span><br>
<span class="lineno">55</span><span class="op" id="2513467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2513470">func</span>&nbsp;<span class="ident" id="2513475">Unsetenv</span><span class="op" id="2513483">(</span><span class="ident" id="2513484">key</span>&nbsp;<span class="builtintype" id="2513488">string</span><span class="op" id="2513494">)</span>&nbsp;<span class="builtintype" id="2513496">error</span>&nbsp;<span class="op" id="2513502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513505">envOnce</span><span class="op" id="2513512">.</span><span class="ident" id="2513513">Do</span><span class="op" id="2513515">(</span><span class="ident" id="2513516">copyenv</span><span class="op" id="2513523">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513527">envLock</span><span class="op" id="2513534">.</span><span class="ident" id="2513535">Lock</span><span class="op" id="2513539">(</span><span class="op" id="2513540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513543">defer</span>&nbsp;<span class="ident" id="2513549">envLock</span><span class="op" id="2513556">.</span><span class="ident" id="2513557">Unlock</span><span class="op" id="2513563">(</span><span class="op" id="2513564">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513568">if</span>&nbsp;<span class="ident" id="2513571">i</span><span class="op" id="2513572">,</span>&nbsp;<span class="ident" id="2513574">ok</span>&nbsp;<span class="op" id="2513577">:=</span>&nbsp;<span class="ident" id="2513580">env</span><span class="op" id="2513583">[</span><span class="ident" id="2513584">key</span><span class="op" id="2513587">]</span><span class="op" id="2513588">;</span>&nbsp;<span class="ident" id="2513590">ok</span>&nbsp;<span class="op" id="2513593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513597">envs</span><span class="op" id="2513601">[</span><span class="ident" id="2513602">i</span><span class="op" id="2513603">]</span>&nbsp;<span class="op" id="2513605">=</span>&nbsp;<span class="string" id="2513607">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2513612">delete</span><span class="op" id="2513618">(</span><span class="ident" id="2513619">env</span><span class="op" id="2513622">,</span>&nbsp;<span class="ident" id="2513624">key</span><span class="op" id="2513627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2513630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513633">unsetenv_c</span><span class="op" id="2513643">(</span><span class="ident" id="2513644">key</span><span class="op" id="2513647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513650">return</span>&nbsp;<span class="builtintype" id="2513657">nil</span><br>
<span class="lineno"></span><span class="op" id="2513661">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="2513664">func</span>&nbsp;<span class="ident" id="2513669">Getenv</span><span class="op" id="2513675">(</span><span class="ident" id="2513676">key</span>&nbsp;<span class="builtintype" id="2513680">string</span><span class="op" id="2513686">)</span>&nbsp;<span class="op" id="2513688">(</span><span class="ident" id="2513689">value</span>&nbsp;<span class="builtintype" id="2513695">string</span><span class="op" id="2513701">,</span>&nbsp;<span class="ident" id="2513703">found</span>&nbsp;<span class="builtintype" id="2513709">bool</span><span class="op" id="2513713">)</span>&nbsp;<span class="op" id="2513715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513718">envOnce</span><span class="op" id="2513725">.</span><span class="ident" id="2513726">Do</span><span class="op" id="2513728">(</span><span class="ident" id="2513729">copyenv</span><span class="op" id="2513736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513739">if</span>&nbsp;<span class="builtinfunc" id="2513742">len</span><span class="op" id="2513745">(</span><span class="ident" id="2513746">key</span><span class="op" id="2513749">)</span>&nbsp;<span class="op" id="2513751">==</span>&nbsp;<span class="num" id="2513754">0</span>&nbsp;<span class="op" id="2513756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513760">return</span>&nbsp;<span class="string" id="2513767">&#34;&#34;</span><span class="op" id="2513769">,</span>&nbsp;<span class="builtintype" id="2513771">false</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2513778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513782">envLock</span><span class="op" id="2513789">.</span><span class="ident" id="2513790">RLock</span><span class="op" id="2513795">(</span><span class="op" id="2513796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513799">defer</span>&nbsp;<span class="ident" id="2513805">envLock</span><span class="op" id="2513812">.</span><span class="ident" id="2513813">RUnlock</span><span class="op" id="2513820">(</span><span class="op" id="2513821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513825">i</span><span class="op" id="2513826">,</span>&nbsp;<span class="ident" id="2513828">ok</span>&nbsp;<span class="op" id="2513831">:=</span>&nbsp;<span class="ident" id="2513834">env</span><span class="op" id="2513837">[</span><span class="ident" id="2513838">key</span><span class="op" id="2513841">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513844">if</span>&nbsp;<span class="op" id="2513847">!</span><span class="ident" id="2513848">ok</span>&nbsp;<span class="op" id="2513851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513855">return</span>&nbsp;<span class="string" id="2513862">&#34;&#34;</span><span class="op" id="2513864">,</span>&nbsp;<span class="builtintype" id="2513866">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2513873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513876">s</span>&nbsp;<span class="op" id="2513878">:=</span>&nbsp;<span class="ident" id="2513881">envs</span><span class="op" id="2513885">[</span><span class="ident" id="2513886">i</span><span class="op" id="2513887">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513890">for</span>&nbsp;<span class="ident" id="2513894">i</span>&nbsp;<span class="op" id="2513896">:=</span>&nbsp;<span class="num" id="2513899">0</span><span class="op" id="2513900">;</span>&nbsp;<span class="ident" id="2513902">i</span>&nbsp;<span class="op" id="2513904">&lt;</span>&nbsp;<span class="builtinfunc" id="2513906">len</span><span class="op" id="2513909">(</span><span class="ident" id="2513910">s</span><span class="op" id="2513911">)</span><span class="op" id="2513912">;</span>&nbsp;<span class="ident" id="2513914">i</span><span class="op" id="2513915">++</span>&nbsp;<span class="op" id="2513918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513922">if</span>&nbsp;<span class="ident" id="2513925">s</span><span class="op" id="2513926">[</span><span class="ident" id="2513927">i</span><span class="op" id="2513928">]</span>&nbsp;<span class="op" id="2513930">==</span>&nbsp;<span class="string" id="2513933">&#39;=&#39;</span>&nbsp;<span class="op" id="2513937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513942">return</span>&nbsp;<span class="ident" id="2513949">s</span><span class="op" id="2513950">[</span><span class="ident" id="2513951">i</span><span class="op" id="2513952">+</span><span class="num" id="2513953">1</span><span class="op" id="2513954">:</span><span class="op" id="2513955">]</span><span class="op" id="2513956">,</span>&nbsp;<span class="builtintype" id="2513958">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2513965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2513968">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513971">return</span>&nbsp;<span class="string" id="2513978">&#34;&#34;</span><span class="op" id="2513980">,</span>&nbsp;<span class="builtintype" id="2513982">false</span><br>
<span class="lineno"></span><span class="op" id="2513988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2513991">func</span>&nbsp;<span class="ident" id="2513996">Setenv</span><span class="op" id="2514002">(</span><span class="ident" id="2514003">key</span><span class="op" id="2514006">,</span>&nbsp;<span class="ident" id="2514008">value</span>&nbsp;<span class="builtintype" id="2514014">string</span><span class="op" id="2514020">)</span>&nbsp;<span class="builtintype" id="2514022">error</span>&nbsp;<span class="op" id="2514028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514031">envOnce</span><span class="op" id="2514038">.</span><span class="ident" id="2514039">Do</span><span class="op" id="2514041">(</span><span class="ident" id="2514042">copyenv</span><span class="op" id="2514049">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514052">if</span>&nbsp;<span class="builtinfunc" id="2514055">len</span><span class="op" id="2514058">(</span><span class="ident" id="2514059">key</span><span class="op" id="2514062">)</span>&nbsp;<span class="op" id="2514064">==</span>&nbsp;<span class="num" id="2514067">0</span>&nbsp;<span class="op" id="2514069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514073">return</span>&nbsp;<span class="ident" id="2514080">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2514088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514091">for</span>&nbsp;<span class="ident" id="2514095">i</span>&nbsp;<span class="op" id="2514097">:=</span>&nbsp;<span class="num" id="2514100">0</span><span class="op" id="2514101">;</span>&nbsp;<span class="ident" id="2514103">i</span>&nbsp;<span class="op" id="2514105">&lt;</span>&nbsp;<span class="builtinfunc" id="2514107">len</span><span class="op" id="2514110">(</span><span class="ident" id="2514111">key</span><span class="op" id="2514114">)</span><span class="op" id="2514115">;</span>&nbsp;<span class="ident" id="2514117">i</span><span class="op" id="2514118">++</span>&nbsp;<span class="op" id="2514121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514125">if</span>&nbsp;<span class="ident" id="2514128">key</span><span class="op" id="2514131">[</span><span class="ident" id="2514132">i</span><span class="op" id="2514133">]</span>&nbsp;<span class="op" id="2514135">==</span>&nbsp;<span class="string" id="2514138">&#39;=&#39;</span>&nbsp;<span class="op" id="2514142">||</span>&nbsp;<span class="ident" id="2514145">key</span><span class="op" id="2514148">[</span><span class="ident" id="2514149">i</span><span class="op" id="2514150">]</span>&nbsp;<span class="op" id="2514152">==</span>&nbsp;<span class="num" id="2514155">0</span>&nbsp;<span class="op" id="2514157">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514162">return</span>&nbsp;<span class="ident" id="2514169">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2514178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2514181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514184">for</span>&nbsp;<span class="ident" id="2514188">i</span>&nbsp;<span class="op" id="2514190">:=</span>&nbsp;<span class="num" id="2514193">0</span><span class="op" id="2514194">;</span>&nbsp;<span class="ident" id="2514196">i</span>&nbsp;<span class="op" id="2514198">&lt;</span>&nbsp;<span class="builtinfunc" id="2514200">len</span><span class="op" id="2514203">(</span><span class="ident" id="2514204">value</span><span class="op" id="2514209">)</span><span class="op" id="2514210">;</span>&nbsp;<span class="ident" id="2514212">i</span><span class="op" id="2514213">++</span>&nbsp;<span class="op" id="2514216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514220">if</span>&nbsp;<span class="ident" id="2514223">value</span><span class="op" id="2514228">[</span><span class="ident" id="2514229">i</span><span class="op" id="2514230">]</span>&nbsp;<span class="op" id="2514232">==</span>&nbsp;<span class="num" id="2514235">0</span>&nbsp;<span class="op" id="2514237">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514242">return</span>&nbsp;<span class="ident" id="2514249">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2514258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2514261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514265">envLock</span><span class="op" id="2514272">.</span><span class="ident" id="2514273">Lock</span><span class="op" id="2514277">(</span><span class="op" id="2514278">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514281">defer</span>&nbsp;<span class="ident" id="2514287">envLock</span><span class="op" id="2514294">.</span><span class="ident" id="2514295">Unlock</span><span class="op" id="2514301">(</span><span class="op" id="2514302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514306">i</span><span class="op" id="2514307">,</span>&nbsp;<span class="ident" id="2514309">ok</span>&nbsp;<span class="op" id="2514312">:=</span>&nbsp;<span class="ident" id="2514315">env</span><span class="op" id="2514318">[</span><span class="ident" id="2514319">key</span><span class="op" id="2514322">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514325">kv</span>&nbsp;<span class="op" id="2514328">:=</span>&nbsp;<span class="ident" id="2514331">key</span>&nbsp;<span class="op" id="2514335">+</span>&nbsp;<span class="string" id="2514337">&#34;=&#34;</span>&nbsp;<span class="op" id="2514341">+</span>&nbsp;<span class="ident" id="2514343">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514350">if</span>&nbsp;<span class="ident" id="2514353">ok</span>&nbsp;<span class="op" id="2514356">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514360">envs</span><span class="op" id="2514364">[</span><span class="ident" id="2514365">i</span><span class="op" id="2514366">]</span>&nbsp;<span class="op" id="2514368">=</span>&nbsp;<span class="ident" id="2514370">kv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2514374">}</span>&nbsp;<span class="keyword" id="2514376">else</span>&nbsp;<span class="op" id="2514381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514385">i</span>&nbsp;<span class="op" id="2514387">=</span>&nbsp;<span class="builtinfunc" id="2514389">len</span><span class="op" id="2514392">(</span><span class="ident" id="2514393">envs</span><span class="op" id="2514397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514401">envs</span>&nbsp;<span class="op" id="2514406">=</span>&nbsp;<span class="builtinfunc" id="2514408">append</span><span class="op" id="2514414">(</span><span class="ident" id="2514415">envs</span><span class="op" id="2514419">,</span>&nbsp;<span class="ident" id="2514421">kv</span><span class="op" id="2514423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2514426">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514429">env</span><span class="op" id="2514432">[</span><span class="ident" id="2514433">key</span><span class="op" id="2514436">]</span>&nbsp;<span class="op" id="2514438">=</span>&nbsp;<span class="ident" id="2514440">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514443">setenv_c</span><span class="op" id="2514451">(</span><span class="ident" id="2514452">key</span><span class="op" id="2514455">,</span>&nbsp;<span class="ident" id="2514457">value</span><span class="op" id="2514462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514465">return</span>&nbsp;<span class="builtintype" id="2514472">nil</span><br>
<span class="lineno"></span><span class="op" id="2514476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2514479">func</span>&nbsp;<span class="ident" id="2514484">Clearenv</span><span class="op" id="2514492">(</span><span class="op" id="2514493">)</span>&nbsp;<span class="op" id="2514495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514498">envOnce</span><span class="op" id="2514505">.</span><span class="ident" id="2514506">Do</span><span class="op" id="2514508">(</span><span class="ident" id="2514509">copyenv</span><span class="op" id="2514516">)</span>&nbsp;<span class="comment" id="2514518">//&nbsp;prevent&nbsp;copyenv&nbsp;in&nbsp;Getenv/Setenv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514556">envLock</span><span class="op" id="2514563">.</span><span class="ident" id="2514564">Lock</span><span class="op" id="2514568">(</span><span class="op" id="2514569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514572">defer</span>&nbsp;<span class="ident" id="2514578">envLock</span><span class="op" id="2514585">.</span><span class="ident" id="2514586">Unlock</span><span class="op" id="2514592">(</span><span class="op" id="2514593">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514597">for</span>&nbsp;<span class="ident" id="2514601">k</span>&nbsp;<span class="op" id="2514603">:=</span>&nbsp;<span class="keyword" id="2514606">range</span>&nbsp;<span class="ident" id="2514612">env</span>&nbsp;<span class="op" id="2514616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514620">unsetenv_c</span><span class="op" id="2514630">(</span><span class="ident" id="2514631">k</span><span class="op" id="2514632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2514635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514638">env</span>&nbsp;<span class="op" id="2514642">=</span>&nbsp;<span class="builtinfunc" id="2514644">make</span><span class="op" id="2514648">(</span><span class="keyword" id="2514649">map</span><span class="op" id="2514652">[</span><span class="builtintype" id="2514653">string</span><span class="op" id="2514659">]</span><span class="builtintype" id="2514660">int</span><span class="op" id="2514663">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514666">envs</span>&nbsp;<span class="op" id="2514671">=</span>&nbsp;<span class="op" id="2514673">[</span><span class="op" id="2514674">]</span><span class="builtintype" id="2514675">string</span><span class="op" id="2514681">{</span><span class="op" id="2514682">}</span><br>
<span class="lineno"></span><span class="op" id="2514684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2514687">func</span>&nbsp;<span class="ident" id="2514692">Environ</span><span class="op" id="2514699">(</span><span class="op" id="2514700">)</span>&nbsp;<span class="op" id="2514702">[</span><span class="op" id="2514703">]</span><span class="builtintype" id="2514704">string</span>&nbsp;<span class="op" id="2514711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514714">envOnce</span><span class="op" id="2514721">.</span><span class="ident" id="2514722">Do</span><span class="op" id="2514724">(</span><span class="ident" id="2514725">copyenv</span><span class="op" id="2514732">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514735">envLock</span><span class="op" id="2514742">.</span><span class="ident" id="2514743">RLock</span><span class="op" id="2514748">(</span><span class="op" id="2514749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514752">defer</span>&nbsp;<span class="ident" id="2514758">envLock</span><span class="op" id="2514765">.</span><span class="ident" id="2514766">RUnlock</span><span class="op" id="2514773">(</span><span class="op" id="2514774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514777">a</span>&nbsp;<span class="op" id="2514779">:=</span>&nbsp;<span class="builtinfunc" id="2514782">make</span><span class="op" id="2514786">(</span><span class="op" id="2514787">[</span><span class="op" id="2514788">]</span><span class="builtintype" id="2514789">string</span><span class="op" id="2514795">,</span>&nbsp;<span class="num" id="2514797">0</span><span class="op" id="2514798">,</span>&nbsp;<span class="builtinfunc" id="2514800">len</span><span class="op" id="2514803">(</span><span class="ident" id="2514804">envs</span><span class="op" id="2514808">)</span><span class="op" id="2514809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514812">for</span>&nbsp;<span class="ident" id="2514816">_</span><span class="op" id="2514817">,</span>&nbsp;<span class="ident" id="2514819">env</span>&nbsp;<span class="op" id="2514823">:=</span>&nbsp;<span class="keyword" id="2514826">range</span>&nbsp;<span class="ident" id="2514832">envs</span>&nbsp;<span class="op" id="2514837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514841">if</span>&nbsp;<span class="ident" id="2514844">env</span>&nbsp;<span class="op" id="2514848">!=</span>&nbsp;<span class="string" id="2514851">&#34;&#34;</span>&nbsp;<span class="op" id="2514854">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514859">a</span>&nbsp;<span class="op" id="2514861">=</span>&nbsp;<span class="builtinfunc" id="2514863">append</span><span class="op" id="2514869">(</span><span class="ident" id="2514870">a</span><span class="op" id="2514871">,</span>&nbsp;<span class="ident" id="2514873">env</span><span class="op" id="2514876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2514880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2514883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514886">return</span>&nbsp;<span class="ident" id="2514893">a</span><br>
<span class="lineno"></span><span class="op" id="2514895">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
