<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html" class="current">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5125849">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5125904">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5125958">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5126009">package</span>&nbsp;<span class="ident" id="5126017">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5126027">import</span>&nbsp;<span class="op" id="5126034">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5126037">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5126046">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5126053">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5126063">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5126066">//&nbsp;urlFilter&nbsp;returns&nbsp;its&nbsp;input&nbsp;unless&nbsp;it&nbsp;contains&nbsp;an&nbsp;unsafe&nbsp;protocol&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="5126144">//&nbsp;case&nbsp;it&nbsp;defangs&nbsp;the&nbsp;entire&nbsp;URL.</span><br>
<span class="lineno">15</span><span class="keyword" id="5126179">func</span>&nbsp;<span class="ident" id="5126184">urlFilter</span><span class="op" id="5126193">(</span><span class="ident" id="5126194">args</span>&nbsp;<span class="op" id="5126199">...</span><span class="keyword" id="5126202">interface</span><span class="op" id="5126211">{</span><span class="op" id="5126212">}</span><span class="op" id="5126213">)</span>&nbsp;<span class="builtintype" id="5126215">string</span>&nbsp;<span class="op" id="5126222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5126225">s</span><span class="op" id="5126226">,</span>&nbsp;<span class="ident" id="5126228">t</span>&nbsp;<span class="op" id="5126230">:=</span>&nbsp;<span class="ident" id="5126233">stringify</span><span class="op" id="5126242">(</span><span class="ident" id="5126243">args</span><span class="op" id="5126247">...</span><span class="op" id="5126250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5126253">if</span>&nbsp;<span class="ident" id="5126256">t</span>&nbsp;<span class="op" id="5126258">==</span>&nbsp;<span class="ident" id="5126261">contentTypeURL</span>&nbsp;<span class="op" id="5126276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5126280">return</span>&nbsp;<span class="ident" id="5126287">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5126290">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5126293">if</span>&nbsp;<span class="ident" id="5126296">i</span>&nbsp;<span class="op" id="5126298">:=</span>&nbsp;<span class="ident" id="5126301">strings</span><span class="op" id="5126308">.</span><span class="ident" id="5126309">IndexRune</span><span class="op" id="5126318">(</span><span class="ident" id="5126319">s</span><span class="op" id="5126320">,</span>&nbsp;<span class="string" id="5126322">&#39;:&#39;</span><span class="op" id="5126325">)</span><span class="op" id="5126326">;</span>&nbsp;<span class="ident" id="5126328">i</span>&nbsp;<span class="op" id="5126330">&gt;=</span>&nbsp;<span class="num" id="5126333">0</span>&nbsp;<span class="op" id="5126335">&amp;&amp;</span>&nbsp;<span class="ident" id="5126338">strings</span><span class="op" id="5126345">.</span><span class="ident" id="5126346">IndexRune</span><span class="op" id="5126355">(</span><span class="ident" id="5126356">s</span><span class="op" id="5126357">[</span><span class="op" id="5126358">:</span><span class="ident" id="5126359">i</span><span class="op" id="5126360">]</span><span class="op" id="5126361">,</span>&nbsp;<span class="string" id="5126363">&#39;/&#39;</span><span class="op" id="5126366">)</span>&nbsp;<span class="op" id="5126368">&lt;</span>&nbsp;<span class="num" id="5126370">0</span>&nbsp;<span class="op" id="5126372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5126376">protocol</span>&nbsp;<span class="op" id="5126385">:=</span>&nbsp;<span class="ident" id="5126388">strings</span><span class="op" id="5126395">.</span><span class="ident" id="5126396">ToLower</span><span class="op" id="5126403">(</span><span class="ident" id="5126404">s</span><span class="op" id="5126405">[</span><span class="op" id="5126406">:</span><span class="ident" id="5126407">i</span><span class="op" id="5126408">]</span><span class="op" id="5126409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5126413">if</span>&nbsp;<span class="ident" id="5126416">protocol</span>&nbsp;<span class="op" id="5126425">!=</span>&nbsp;<span class="string" id="5126428">&#34;http&#34;</span>&nbsp;<span class="op" id="5126435">&amp;&amp;</span>&nbsp;<span class="ident" id="5126438">protocol</span>&nbsp;<span class="op" id="5126447">!=</span>&nbsp;<span class="string" id="5126450">&#34;https&#34;</span>&nbsp;<span class="op" id="5126458">&amp;&amp;</span>&nbsp;<span class="ident" id="5126461">protocol</span>&nbsp;<span class="op" id="5126470">!=</span>&nbsp;<span class="string" id="5126473">&#34;mailto&#34;</span>&nbsp;<span class="op" id="5126482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5126487">return</span>&nbsp;<span class="string" id="5126494">&#34;#&#34;</span>&nbsp;<span class="op" id="5126498">+</span>&nbsp;<span class="ident" id="5126500">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5126517">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5126520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5126523">return</span>&nbsp;<span class="ident" id="5126530">s</span><br>
<span class="lineno"></span><span class="op" id="5126532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5126535">//&nbsp;urlEscaper&nbsp;produces&nbsp;an&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno">30</span><span class="comment" id="5126605">//&nbsp;The&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;without&nbsp;further&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="keyword" id="5126682">func</span>&nbsp;<span class="ident" id="5126687">urlEscaper</span><span class="op" id="5126697">(</span><span class="ident" id="5126698">args</span>&nbsp;<span class="op" id="5126703">...</span><span class="keyword" id="5126706">interface</span><span class="op" id="5126715">{</span><span class="op" id="5126716">}</span><span class="op" id="5126717">)</span>&nbsp;<span class="builtintype" id="5126719">string</span>&nbsp;<span class="op" id="5126726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5126729">return</span>&nbsp;<span class="ident" id="5126736">urlProcessor</span><span class="op" id="5126748">(</span><span class="builtintype" id="5126749">false</span><span class="op" id="5126754">,</span>&nbsp;<span class="ident" id="5126756">args</span><span class="op" id="5126760">...</span><span class="op" id="5126763">)</span><br>
<span class="lineno"></span><span class="op" id="5126765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5126768">//&nbsp;urlEscaper&nbsp;normalizes&nbsp;URL&nbsp;content&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;a&nbsp;quote-delimited</span><br>
<span class="lineno"></span><span class="comment" id="5126848">//&nbsp;string&nbsp;or&nbsp;parenthesis&nbsp;delimited&nbsp;url(...).</span><br>
<span class="lineno"></span><span class="comment" id="5126893">//&nbsp;The&nbsp;normalizer&nbsp;does&nbsp;not&nbsp;encode&nbsp;all&nbsp;HTML&nbsp;specials.&nbsp;Specifically,&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5126972">//&nbsp;encode&nbsp;&#39;&amp;&#39;&nbsp;so&nbsp;correct&nbsp;embedding&nbsp;in&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;requires&nbsp;escaping&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5127049">//&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;&#39;&amp;amp;&#39;.</span><br>
<span class="lineno">40</span><span class="keyword" id="5127068">func</span>&nbsp;<span class="ident" id="5127073">urlNormalizer</span><span class="op" id="5127086">(</span><span class="ident" id="5127087">args</span>&nbsp;<span class="op" id="5127092">...</span><span class="keyword" id="5127095">interface</span><span class="op" id="5127104">{</span><span class="op" id="5127105">}</span><span class="op" id="5127106">)</span>&nbsp;<span class="builtintype" id="5127108">string</span>&nbsp;<span class="op" id="5127115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5127118">return</span>&nbsp;<span class="ident" id="5127125">urlProcessor</span><span class="op" id="5127137">(</span><span class="builtintype" id="5127138">true</span><span class="op" id="5127142">,</span>&nbsp;<span class="ident" id="5127144">args</span><span class="op" id="5127148">...</span><span class="op" id="5127151">)</span><br>
<span class="lineno"></span><span class="op" id="5127153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5127156">//&nbsp;urlProcessor&nbsp;normalizes&nbsp;(when&nbsp;norm&nbsp;is&nbsp;true)&nbsp;or&nbsp;escapes&nbsp;its&nbsp;input&nbsp;to&nbsp;produce</span><br>
<span class="lineno">45</span><span class="comment" id="5127235">//&nbsp;a&nbsp;valid&nbsp;hierarchical&nbsp;or&nbsp;opaque&nbsp;URL&nbsp;part.</span><br>
<span class="lineno"></span><span class="keyword" id="5127279">func</span>&nbsp;<span class="ident" id="5127284">urlProcessor</span><span class="op" id="5127296">(</span><span class="ident" id="5127297">norm</span>&nbsp;<span class="builtintype" id="5127302">bool</span><span class="op" id="5127306">,</span>&nbsp;<span class="ident" id="5127308">args</span>&nbsp;<span class="op" id="5127313">...</span><span class="keyword" id="5127316">interface</span><span class="op" id="5127325">{</span><span class="op" id="5127326">}</span><span class="op" id="5127327">)</span>&nbsp;<span class="builtintype" id="5127329">string</span>&nbsp;<span class="op" id="5127336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5127339">s</span><span class="op" id="5127340">,</span>&nbsp;<span class="ident" id="5127342">t</span>&nbsp;<span class="op" id="5127344">:=</span>&nbsp;<span class="ident" id="5127347">stringify</span><span class="op" id="5127356">(</span><span class="ident" id="5127357">args</span><span class="op" id="5127361">...</span><span class="op" id="5127364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5127367">if</span>&nbsp;<span class="ident" id="5127370">t</span>&nbsp;<span class="op" id="5127372">==</span>&nbsp;<span class="ident" id="5127375">contentTypeURL</span>&nbsp;<span class="op" id="5127390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5127394">norm</span>&nbsp;<span class="op" id="5127399">=</span>&nbsp;<span class="builtintype" id="5127401">true</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5127407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5127410">var</span>&nbsp;<span class="ident" id="5127414">b</span>&nbsp;<span class="ident" id="5127416">bytes</span><span class="op" id="5127421">.</span><span class="ident" id="5127422">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5127430">written</span>&nbsp;<span class="op" id="5127438">:=</span>&nbsp;<span class="num" id="5127441">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5127444">//&nbsp;The&nbsp;byte&nbsp;loop&nbsp;below&nbsp;assumes&nbsp;that&nbsp;all&nbsp;URLs&nbsp;use&nbsp;UTF-8&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5127507">//&nbsp;content-encoding.&nbsp;This&nbsp;is&nbsp;similar&nbsp;to&nbsp;the&nbsp;URI&nbsp;to&nbsp;IRI&nbsp;encoding&nbsp;scheme</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5127579">//&nbsp;defined&nbsp;in&nbsp;section&nbsp;3.1&nbsp;of&nbsp;&nbsp;RFC&nbsp;3987,&nbsp;and&nbsp;behaves&nbsp;the&nbsp;same&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5127648">//&nbsp;EcmaScript&nbsp;builtin&nbsp;encodeURIComponent.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5127691">//&nbsp;It&nbsp;should&nbsp;not&nbsp;cause&nbsp;any&nbsp;misencoding&nbsp;of&nbsp;URLs&nbsp;in&nbsp;pages&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5127753">//&nbsp;Content-type:&nbsp;text/html;charset=UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5127796">for</span>&nbsp;<span class="ident" id="5127800">i</span><span class="op" id="5127801">,</span>&nbsp;<span class="ident" id="5127803">n</span>&nbsp;<span class="op" id="5127805">:=</span>&nbsp;<span class="num" id="5127808">0</span><span class="op" id="5127809">,</span>&nbsp;<span class="builtinfunc" id="5127811">len</span><span class="op" id="5127814">(</span><span class="ident" id="5127815">s</span><span class="op" id="5127816">)</span><span class="op" id="5127817">;</span>&nbsp;<span class="ident" id="5127819">i</span>&nbsp;<span class="op" id="5127821">&lt;</span>&nbsp;<span class="ident" id="5127823">n</span><span class="op" id="5127824">;</span>&nbsp;<span class="ident" id="5127826">i</span><span class="op" id="5127827">++</span>&nbsp;<span class="op" id="5127830">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5127834">c</span>&nbsp;<span class="op" id="5127836">:=</span>&nbsp;<span class="ident" id="5127839">s</span><span class="op" id="5127840">[</span><span class="ident" id="5127841">i</span><span class="op" id="5127842">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5127846">switch</span>&nbsp;<span class="ident" id="5127853">c</span>&nbsp;<span class="op" id="5127855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5127859">//&nbsp;Single&nbsp;quote&nbsp;and&nbsp;parens&nbsp;are&nbsp;sub-delims&nbsp;in&nbsp;RFC&nbsp;3986,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5127923">//&nbsp;escape&nbsp;them&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5127980">//&nbsp;quoted&nbsp;attributes&nbsp;and&nbsp;unquoted&nbsp;CSS&nbsp;url(...)&nbsp;constructs.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5128041">//&nbsp;Single&nbsp;quotes&nbsp;are&nbsp;reserved&nbsp;in&nbsp;URLs,&nbsp;but&nbsp;are&nbsp;only&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5128103">//&nbsp;the&nbsp;obsolete&nbsp;&#34;mark&#34;&nbsp;rule&nbsp;in&nbsp;an&nbsp;appendix&nbsp;in&nbsp;RFC&nbsp;3986</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5128160">//&nbsp;so&nbsp;can&nbsp;be&nbsp;safely&nbsp;encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5128191">case</span>&nbsp;<span class="string" id="5128196">&#39;!&#39;</span><span class="op" id="5128199">,</span>&nbsp;<span class="string" id="5128201">&#39;#&#39;</span><span class="op" id="5128204">,</span>&nbsp;<span class="string" id="5128206">&#39;$&#39;</span><span class="op" id="5128209">,</span>&nbsp;<span class="string" id="5128211">&#39;&amp;&#39;</span><span class="op" id="5128214">,</span>&nbsp;<span class="string" id="5128216">&#39;*&#39;</span><span class="op" id="5128219">,</span>&nbsp;<span class="string" id="5128221">&#39;+&#39;</span><span class="op" id="5128224">,</span>&nbsp;<span class="string" id="5128226">&#39;,&#39;</span><span class="op" id="5128229">,</span>&nbsp;<span class="string" id="5128231">&#39;/&#39;</span><span class="op" id="5128234">,</span>&nbsp;<span class="string" id="5128236">&#39;:&#39;</span><span class="op" id="5128239">,</span>&nbsp;<span class="string" id="5128241">&#39;;&#39;</span><span class="op" id="5128244">,</span>&nbsp;<span class="string" id="5128246">&#39;=&#39;</span><span class="op" id="5128249">,</span>&nbsp;<span class="string" id="5128251">&#39;?&#39;</span><span class="op" id="5128254">,</span>&nbsp;<span class="string" id="5128256">&#39;@&#39;</span><span class="op" id="5128259">,</span>&nbsp;<span class="string" id="5128261">&#39;[&#39;</span><span class="op" id="5128264">,</span>&nbsp;<span class="string" id="5128266">&#39;]&#39;</span><span class="op" id="5128269">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5128274">if</span>&nbsp;<span class="ident" id="5128277">norm</span>&nbsp;<span class="op" id="5128282">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5128288">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5128300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5128304">//&nbsp;Unreserved&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986&nbsp;sec&nbsp;2.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5128350">//&nbsp;&#34;For&nbsp;consistency,&nbsp;percent-encoded&nbsp;octets&nbsp;in&nbsp;the&nbsp;ranges&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5128413">//&nbsp;ALPHA&nbsp;(%41-%5A&nbsp;and&nbsp;%61-%7A),&nbsp;DIGIT&nbsp;(%30-%39),&nbsp;hyphen&nbsp;(%2D),</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5128478">//&nbsp;period&nbsp;(%2E),&nbsp;underscore&nbsp;(%5F),&nbsp;or&nbsp;tilde&nbsp;(%7E)&nbsp;should&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5128544">//&nbsp;created&nbsp;by&nbsp;URI&nbsp;producers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5128574">case</span>&nbsp;<span class="string" id="5128579">&#39;-&#39;</span><span class="op" id="5128582">,</span>&nbsp;<span class="string" id="5128584">&#39;.&#39;</span><span class="op" id="5128587">,</span>&nbsp;<span class="string" id="5128589">&#39;_&#39;</span><span class="op" id="5128592">,</span>&nbsp;<span class="string" id="5128594">&#39;~&#39;</span><span class="op" id="5128597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5128602">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5128613">case</span>&nbsp;<span class="string" id="5128618">&#39;%&#39;</span><span class="op" id="5128621">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5128626">//&nbsp;When&nbsp;normalizing&nbsp;do&nbsp;not&nbsp;re-encode&nbsp;valid&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5128681">if</span>&nbsp;<span class="ident" id="5128684">norm</span>&nbsp;<span class="op" id="5128689">&amp;&amp;</span>&nbsp;<span class="ident" id="5128692">i</span><span class="op" id="5128693">+</span><span class="num" id="5128694">2</span>&nbsp;<span class="op" id="5128696">&lt;</span>&nbsp;<span class="builtinfunc" id="5128698">len</span><span class="op" id="5128701">(</span><span class="ident" id="5128702">s</span><span class="op" id="5128703">)</span>&nbsp;<span class="op" id="5128705">&amp;&amp;</span>&nbsp;<span class="ident" id="5128708">isHex</span><span class="op" id="5128713">(</span><span class="ident" id="5128714">s</span><span class="op" id="5128715">[</span><span class="ident" id="5128716">i</span><span class="op" id="5128717">+</span><span class="num" id="5128718">1</span><span class="op" id="5128719">]</span><span class="op" id="5128720">)</span>&nbsp;<span class="op" id="5128722">&amp;&amp;</span>&nbsp;<span class="ident" id="5128725">isHex</span><span class="op" id="5128730">(</span><span class="ident" id="5128731">s</span><span class="op" id="5128732">[</span><span class="ident" id="5128733">i</span><span class="op" id="5128734">+</span><span class="num" id="5128735">2</span><span class="op" id="5128736">]</span><span class="op" id="5128737">)</span>&nbsp;<span class="op" id="5128739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5128745">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5128757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5128761">default</span><span class="op" id="5128768">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5128773">//&nbsp;Unreserved&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986&nbsp;sec&nbsp;2.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5128820">if</span>&nbsp;<span class="string" id="5128823">&#39;a&#39;</span>&nbsp;<span class="op" id="5128827">&lt;=</span>&nbsp;<span class="ident" id="5128830">c</span>&nbsp;<span class="op" id="5128832">&amp;&amp;</span>&nbsp;<span class="ident" id="5128835">c</span>&nbsp;<span class="op" id="5128837">&lt;=</span>&nbsp;<span class="string" id="5128840">&#39;z&#39;</span>&nbsp;<span class="op" id="5128844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5128850">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5128862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5128867">if</span>&nbsp;<span class="string" id="5128870">&#39;A&#39;</span>&nbsp;<span class="op" id="5128874">&lt;=</span>&nbsp;<span class="ident" id="5128877">c</span>&nbsp;<span class="op" id="5128879">&amp;&amp;</span>&nbsp;<span class="ident" id="5128882">c</span>&nbsp;<span class="op" id="5128884">&lt;=</span>&nbsp;<span class="string" id="5128887">&#39;Z&#39;</span>&nbsp;<span class="op" id="5128891">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5128897">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5128909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5128914">if</span>&nbsp;<span class="string" id="5128917">&#39;0&#39;</span>&nbsp;<span class="op" id="5128921">&lt;=</span>&nbsp;<span class="ident" id="5128924">c</span>&nbsp;<span class="op" id="5128926">&amp;&amp;</span>&nbsp;<span class="ident" id="5128929">c</span>&nbsp;<span class="op" id="5128931">&lt;=</span>&nbsp;<span class="string" id="5128934">&#39;9&#39;</span>&nbsp;<span class="op" id="5128938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5128944">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5128956">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5128960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5128964">b</span><span class="op" id="5128965">.</span><span class="ident" id="5128966">WriteString</span><span class="op" id="5128977">(</span><span class="ident" id="5128978">s</span><span class="op" id="5128979">[</span><span class="ident" id="5128980">written</span><span class="op" id="5128987">:</span><span class="ident" id="5128988">i</span><span class="op" id="5128989">]</span><span class="op" id="5128990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5128994">fmt</span><span class="op" id="5128997">.</span><span class="ident" id="5128998">Fprintf</span><span class="op" id="5129005">(</span><span class="op" id="5129006">&amp;</span><span class="ident" id="5129007">b</span><span class="op" id="5129008">,</span>&nbsp;<span class="string" id="5129010">&#34;%%%02x&#34;</span><span class="op" id="5129018">,</span>&nbsp;<span class="ident" id="5129020">c</span><span class="op" id="5129021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5129025">written</span>&nbsp;<span class="op" id="5129033">=</span>&nbsp;<span class="ident" id="5129035">i</span>&nbsp;<span class="op" id="5129037">+</span>&nbsp;<span class="num" id="5129039">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5129042">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5129045">if</span>&nbsp;<span class="ident" id="5129048">written</span>&nbsp;<span class="op" id="5129056">==</span>&nbsp;<span class="num" id="5129059">0</span>&nbsp;<span class="op" id="5129061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5129065">return</span>&nbsp;<span class="ident" id="5129072">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5129075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5129078">b</span><span class="op" id="5129079">.</span><span class="ident" id="5129080">WriteString</span><span class="op" id="5129091">(</span><span class="ident" id="5129092">s</span><span class="op" id="5129093">[</span><span class="ident" id="5129094">written</span><span class="op" id="5129101">:</span><span class="op" id="5129102">]</span><span class="op" id="5129103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5129106">return</span>&nbsp;<span class="ident" id="5129113">b</span><span class="op" id="5129114">.</span><span class="ident" id="5129115">String</span><span class="op" id="5129121">(</span><span class="op" id="5129122">)</span><br>
<span class="lineno">105</span><span class="op" id="5129124">}</span>
</div>
</body>
</html>
