<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html" class="current">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5379739">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5379794">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5379848">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5379899">//&nbsp;This&nbsp;algorithm&nbsp;is&nbsp;based&nbsp;on&nbsp;&#34;Faster&nbsp;Suffix&nbsp;Sorting&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5379953">//&nbsp;&nbsp;&nbsp;by&nbsp;N.&nbsp;Jesper&nbsp;Larsson&nbsp;and&nbsp;Kunihiko&nbsp;Sadakane</span><br>
<span class="lineno"></span><span class="comment" id="5380001">//&nbsp;paper:&nbsp;http://www.larsson.dogma.net/ssrev-tr.pdf</span><br>
<span class="lineno"></span><span class="comment" id="5380053">//&nbsp;code:&nbsp;&nbsp;http://www.larsson.dogma.net/qsufsort.c</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="5380104">//&nbsp;This&nbsp;algorithm&nbsp;computes&nbsp;the&nbsp;suffix&nbsp;array&nbsp;sa&nbsp;by&nbsp;computing&nbsp;its&nbsp;inverse.</span><br>
<span class="lineno"></span><span class="comment" id="5380177">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;in&nbsp;sa&nbsp;are&nbsp;labeled&nbsp;as&nbsp;sorted&nbsp;groups&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5380249">//&nbsp;unsorted&nbsp;groups.&nbsp;For&nbsp;a&nbsp;given&nbsp;pass&nbsp;of&nbsp;the&nbsp;sorter,&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;ordered</span><br>
<span class="lineno"></span><span class="comment" id="5380326">//&nbsp;up&nbsp;to&nbsp;their&nbsp;first&nbsp;h&nbsp;characters,&nbsp;and&nbsp;sa&nbsp;is&nbsp;h-ordered.&nbsp;Suffixes&nbsp;in&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="5380400">//&nbsp;final&nbsp;positions&nbsp;and&nbsp;unambiguously&nbsp;sorted&nbsp;in&nbsp;h-order&nbsp;are&nbsp;in&nbsp;a&nbsp;sorted&nbsp;group.</span><br>
<span class="lineno">15</span><span class="comment" id="5380478">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;with&nbsp;identical&nbsp;first&nbsp;h&nbsp;characters&nbsp;are&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5380553">//&nbsp;unsorted&nbsp;group.&nbsp;In&nbsp;each&nbsp;pass&nbsp;of&nbsp;the&nbsp;algorithm,&nbsp;unsorted&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span><span class="comment" id="5380630">//&nbsp;according&nbsp;to&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;their&nbsp;following&nbsp;suffix.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5380691">//&nbsp;In&nbsp;the&nbsp;implementation,&nbsp;if&nbsp;sa[i]&nbsp;is&nbsp;negative,&nbsp;it&nbsp;indicates&nbsp;that&nbsp;i&nbsp;is</span><br>
<span class="lineno">20</span><span class="comment" id="5380762">//&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;a&nbsp;sorted&nbsp;group&nbsp;of&nbsp;length&nbsp;-sa[i],&nbsp;and&nbsp;can&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="comment" id="5380839">//&nbsp;An&nbsp;unsorted&nbsp;group&nbsp;sa[i:k]&nbsp;is&nbsp;given&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;the&nbsp;index&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5380914">//&nbsp;last&nbsp;element,&nbsp;k-1.&nbsp;The&nbsp;group&nbsp;numbers&nbsp;are&nbsp;stored&nbsp;in&nbsp;the&nbsp;inverse&nbsp;slice&nbsp;(inv),</span><br>
<span class="lineno"></span><span class="comment" id="5380993">//&nbsp;and&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted,&nbsp;this&nbsp;slice&nbsp;is&nbsp;the&nbsp;inverse&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5381069">package</span>&nbsp;<span class="ident" id="5381077">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5381090">import</span>&nbsp;<span class="string" id="5381097">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5381105">func</span>&nbsp;<span class="ident" id="5381110">qsufsort</span><span class="op" id="5381118">(</span><span class="ident" id="5381119">data</span>&nbsp;<span class="op" id="5381124">[</span><span class="op" id="5381125">]</span><span class="builtintype" id="5381126">byte</span><span class="op" id="5381130">)</span>&nbsp;<span class="op" id="5381132">[</span><span class="op" id="5381133">]</span><span class="builtintype" id="5381134">int</span>&nbsp;<span class="op" id="5381138">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5381141">//&nbsp;initial&nbsp;sorting&nbsp;by&nbsp;first&nbsp;byte&nbsp;of&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381185">sa</span>&nbsp;<span class="op" id="5381188">:=</span>&nbsp;<span class="ident" id="5381191">sortedByFirstByte</span><span class="op" id="5381208">(</span><span class="ident" id="5381209">data</span><span class="op" id="5381213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381216">if</span>&nbsp;<span class="builtinfunc" id="5381219">len</span><span class="op" id="5381222">(</span><span class="ident" id="5381223">sa</span><span class="op" id="5381225">)</span>&nbsp;<span class="op" id="5381227">&lt;</span>&nbsp;<span class="num" id="5381229">2</span>&nbsp;<span class="op" id="5381231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381235">return</span>&nbsp;<span class="ident" id="5381242">sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5381246">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5381249">//&nbsp;initialize&nbsp;the&nbsp;group&nbsp;lookup&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5381287">//&nbsp;this&nbsp;becomes&nbsp;the&nbsp;inverse&nbsp;of&nbsp;the&nbsp;suffix&nbsp;array&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381363">inv</span>&nbsp;<span class="op" id="5381367">:=</span>&nbsp;<span class="ident" id="5381370">initGroups</span><span class="op" id="5381380">(</span><span class="ident" id="5381381">sa</span><span class="op" id="5381383">,</span>&nbsp;<span class="ident" id="5381385">data</span><span class="op" id="5381389">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5381393">//&nbsp;the&nbsp;index&nbsp;starts&nbsp;1-ordered</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381424">sufSortable</span>&nbsp;<span class="op" id="5381436">:=</span>&nbsp;<span class="op" id="5381439">&amp;</span><span class="ident" id="5381440">suffixSortable</span><span class="op" id="5381454">{</span><span class="ident" id="5381455">sa</span><span class="op" id="5381457">:</span>&nbsp;<span class="ident" id="5381459">sa</span><span class="op" id="5381461">,</span>&nbsp;<span class="ident" id="5381463">inv</span><span class="op" id="5381466">:</span>&nbsp;<span class="ident" id="5381468">inv</span><span class="op" id="5381471">,</span>&nbsp;<span class="ident" id="5381473">h</span><span class="op" id="5381474">:</span>&nbsp;<span class="num" id="5381476">1</span><span class="op" id="5381477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381481">for</span>&nbsp;<span class="ident" id="5381485">sa</span><span class="op" id="5381487">[</span><span class="num" id="5381488">0</span><span class="op" id="5381489">]</span>&nbsp;<span class="op" id="5381491">&gt;</span>&nbsp;<span class="op" id="5381493">-</span><span class="builtinfunc" id="5381494">len</span><span class="op" id="5381497">(</span><span class="ident" id="5381498">sa</span><span class="op" id="5381500">)</span>&nbsp;<span class="op" id="5381502">{</span>&nbsp;<span class="comment" id="5381504">//&nbsp;until&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;one&nbsp;big&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5381553">//&nbsp;The&nbsp;suffixes&nbsp;are&nbsp;h-ordered,&nbsp;make&nbsp;them&nbsp;2*h-ordered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381608">pi</span>&nbsp;<span class="op" id="5381611">:=</span>&nbsp;<span class="num" id="5381614">0</span>&nbsp;<span class="comment" id="5381616">//&nbsp;pi&nbsp;is&nbsp;first&nbsp;position&nbsp;of&nbsp;first&nbsp;group</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381657">sl</span>&nbsp;<span class="op" id="5381660">:=</span>&nbsp;<span class="num" id="5381663">0</span>&nbsp;<span class="comment" id="5381665">//&nbsp;sl&nbsp;is&nbsp;negated&nbsp;length&nbsp;of&nbsp;sorted&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381708">for</span>&nbsp;<span class="ident" id="5381712">pi</span>&nbsp;<span class="op" id="5381715">&lt;</span>&nbsp;<span class="builtinfunc" id="5381717">len</span><span class="op" id="5381720">(</span><span class="ident" id="5381721">sa</span><span class="op" id="5381723">)</span>&nbsp;<span class="op" id="5381725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381730">if</span>&nbsp;<span class="ident" id="5381733">s</span>&nbsp;<span class="op" id="5381735">:=</span>&nbsp;<span class="ident" id="5381738">sa</span><span class="op" id="5381740">[</span><span class="ident" id="5381741">pi</span><span class="op" id="5381743">]</span><span class="op" id="5381744">;</span>&nbsp;<span class="ident" id="5381746">s</span>&nbsp;<span class="op" id="5381748">&lt;</span>&nbsp;<span class="num" id="5381750">0</span>&nbsp;<span class="op" id="5381752">{</span>&nbsp;<span class="comment" id="5381754">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381787">pi</span>&nbsp;<span class="op" id="5381790">-=</span>&nbsp;<span class="ident" id="5381793">s</span>&nbsp;<span class="comment" id="5381795">//&nbsp;skip&nbsp;over&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381825">sl</span>&nbsp;<span class="op" id="5381828">+=</span>&nbsp;<span class="ident" id="5381831">s</span>&nbsp;<span class="comment" id="5381833">//&nbsp;add&nbsp;negated&nbsp;length&nbsp;to&nbsp;sl</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5381864">}</span>&nbsp;<span class="keyword" id="5381866">else</span>&nbsp;<span class="op" id="5381871">{</span>&nbsp;<span class="comment" id="5381873">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381908">if</span>&nbsp;<span class="ident" id="5381911">sl</span>&nbsp;<span class="op" id="5381914">!=</span>&nbsp;<span class="num" id="5381917">0</span>&nbsp;<span class="op" id="5381919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381926">sa</span><span class="op" id="5381928">[</span><span class="ident" id="5381929">pi</span><span class="op" id="5381931">+</span><span class="ident" id="5381932">sl</span><span class="op" id="5381934">]</span>&nbsp;<span class="op" id="5381936">=</span>&nbsp;<span class="ident" id="5381938">sl</span>&nbsp;<span class="comment" id="5381941">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;before&nbsp;pi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381981">sl</span>&nbsp;<span class="op" id="5381984">=</span>&nbsp;<span class="num" id="5381986">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5381992">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381998">pk</span>&nbsp;<span class="op" id="5382001">:=</span>&nbsp;<span class="ident" id="5382004">inv</span><span class="op" id="5382007">[</span><span class="ident" id="5382008">s</span><span class="op" id="5382009">]</span>&nbsp;<span class="op" id="5382011">+</span>&nbsp;<span class="num" id="5382013">1</span>&nbsp;<span class="comment" id="5382015">//&nbsp;pk-1&nbsp;is&nbsp;last&nbsp;position&nbsp;of&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382062">sufSortable</span><span class="op" id="5382073">.</span><span class="ident" id="5382074">sa</span>&nbsp;<span class="op" id="5382077">=</span>&nbsp;<span class="ident" id="5382079">sa</span><span class="op" id="5382081">[</span><span class="ident" id="5382082">pi</span><span class="op" id="5382084">:</span><span class="ident" id="5382085">pk</span><span class="op" id="5382087">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382093">sort</span><span class="op" id="5382097">.</span><span class="ident" id="5382098">Sort</span><span class="op" id="5382102">(</span><span class="ident" id="5382103">sufSortable</span><span class="op" id="5382114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382120">sufSortable</span><span class="op" id="5382131">.</span><span class="ident" id="5382132">updateGroups</span><span class="op" id="5382144">(</span><span class="ident" id="5382145">pi</span><span class="op" id="5382147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382153">pi</span>&nbsp;<span class="op" id="5382156">=</span>&nbsp;<span class="ident" id="5382158">pk</span>&nbsp;<span class="comment" id="5382161">//&nbsp;next&nbsp;group</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382186">if</span>&nbsp;<span class="ident" id="5382189">sl</span>&nbsp;<span class="op" id="5382192">!=</span>&nbsp;<span class="num" id="5382195">0</span>&nbsp;<span class="op" id="5382197">{</span>&nbsp;<span class="comment" id="5382199">//&nbsp;if&nbsp;the&nbsp;array&nbsp;ends&nbsp;with&nbsp;a&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382243">sa</span><span class="op" id="5382245">[</span><span class="ident" id="5382246">pi</span><span class="op" id="5382248">+</span><span class="ident" id="5382249">sl</span><span class="op" id="5382251">]</span>&nbsp;<span class="op" id="5382253">=</span>&nbsp;<span class="ident" id="5382255">sl</span>&nbsp;<span class="comment" id="5382258">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;at&nbsp;end&nbsp;of&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382298">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382303">sufSortable</span><span class="op" id="5382314">.</span><span class="ident" id="5382315">h</span>&nbsp;<span class="op" id="5382317">*=</span>&nbsp;<span class="num" id="5382320">2</span>&nbsp;<span class="comment" id="5382322">//&nbsp;double&nbsp;sorted&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382350">for</span>&nbsp;<span class="ident" id="5382354">i</span>&nbsp;<span class="op" id="5382356">:=</span>&nbsp;<span class="keyword" id="5382359">range</span>&nbsp;<span class="ident" id="5382365">sa</span>&nbsp;<span class="op" id="5382368">{</span>&nbsp;<span class="comment" id="5382370">//&nbsp;reconstruct&nbsp;suffix&nbsp;array&nbsp;from&nbsp;inverse</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382413">sa</span><span class="op" id="5382415">[</span><span class="ident" id="5382416">inv</span><span class="op" id="5382419">[</span><span class="ident" id="5382420">i</span><span class="op" id="5382421">]</span><span class="op" id="5382422">]</span>&nbsp;<span class="op" id="5382424">=</span>&nbsp;<span class="ident" id="5382426">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382432">return</span>&nbsp;<span class="ident" id="5382439">sa</span><br>
<span class="lineno"></span><span class="op" id="5382442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5382445">func</span>&nbsp;<span class="ident" id="5382450">sortedByFirstByte</span><span class="op" id="5382467">(</span><span class="ident" id="5382468">data</span>&nbsp;<span class="op" id="5382473">[</span><span class="op" id="5382474">]</span><span class="builtintype" id="5382475">byte</span><span class="op" id="5382479">)</span>&nbsp;<span class="op" id="5382481">[</span><span class="op" id="5382482">]</span><span class="builtintype" id="5382483">int</span>&nbsp;<span class="op" id="5382487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5382490">//&nbsp;total&nbsp;byte&nbsp;counts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382512">var</span>&nbsp;<span class="ident" id="5382516">count</span>&nbsp;<span class="op" id="5382522">[</span><span class="num" id="5382523">256</span><span class="op" id="5382526">]</span><span class="builtintype" id="5382527">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382532">for</span>&nbsp;<span class="ident" id="5382536">_</span><span class="op" id="5382537">,</span>&nbsp;<span class="ident" id="5382539">b</span>&nbsp;<span class="op" id="5382541">:=</span>&nbsp;<span class="keyword" id="5382544">range</span>&nbsp;<span class="ident" id="5382550">data</span>&nbsp;<span class="op" id="5382555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382559">count</span><span class="op" id="5382564">[</span><span class="ident" id="5382565">b</span><span class="op" id="5382566">]</span><span class="op" id="5382567">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5382574">//&nbsp;make&nbsp;count[b]&nbsp;equal&nbsp;index&nbsp;of&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;sorted&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382645">sum</span>&nbsp;<span class="op" id="5382649">:=</span>&nbsp;<span class="num" id="5382652">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382655">for</span>&nbsp;<span class="ident" id="5382659">b</span>&nbsp;<span class="op" id="5382661">:=</span>&nbsp;<span class="keyword" id="5382664">range</span>&nbsp;<span class="ident" id="5382670">count</span>&nbsp;<span class="op" id="5382676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382680">count</span><span class="op" id="5382685">[</span><span class="ident" id="5382686">b</span><span class="op" id="5382687">]</span><span class="op" id="5382688">,</span>&nbsp;<span class="ident" id="5382690">sum</span>&nbsp;<span class="op" id="5382694">=</span>&nbsp;<span class="ident" id="5382696">sum</span><span class="op" id="5382699">,</span>&nbsp;<span class="ident" id="5382701">count</span><span class="op" id="5382706">[</span><span class="ident" id="5382707">b</span><span class="op" id="5382708">]</span><span class="op" id="5382709">+</span><span class="ident" id="5382710">sum</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5382718">//&nbsp;iterate&nbsp;through&nbsp;bytes,&nbsp;placing&nbsp;index&nbsp;into&nbsp;the&nbsp;correct&nbsp;spot&nbsp;in&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382787">sa</span>&nbsp;<span class="op" id="5382790">:=</span>&nbsp;<span class="builtinfunc" id="5382793">make</span><span class="op" id="5382797">(</span><span class="op" id="5382798">[</span><span class="op" id="5382799">]</span><span class="builtintype" id="5382800">int</span><span class="op" id="5382803">,</span>&nbsp;<span class="builtinfunc" id="5382805">len</span><span class="op" id="5382808">(</span><span class="ident" id="5382809">data</span><span class="op" id="5382813">)</span><span class="op" id="5382814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382817">for</span>&nbsp;<span class="ident" id="5382821">i</span><span class="op" id="5382822">,</span>&nbsp;<span class="ident" id="5382824">b</span>&nbsp;<span class="op" id="5382826">:=</span>&nbsp;<span class="keyword" id="5382829">range</span>&nbsp;<span class="ident" id="5382835">data</span>&nbsp;<span class="op" id="5382840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382844">sa</span><span class="op" id="5382846">[</span><span class="ident" id="5382847">count</span><span class="op" id="5382852">[</span><span class="ident" id="5382853">b</span><span class="op" id="5382854">]</span><span class="op" id="5382855">]</span>&nbsp;<span class="op" id="5382857">=</span>&nbsp;<span class="ident" id="5382859">i</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382863">count</span><span class="op" id="5382868">[</span><span class="ident" id="5382869">b</span><span class="op" id="5382870">]</span><span class="op" id="5382871">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382878">return</span>&nbsp;<span class="ident" id="5382885">sa</span><br>
<span class="lineno"></span><span class="op" id="5382888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5382891">func</span>&nbsp;<span class="ident" id="5382896">initGroups</span><span class="op" id="5382906">(</span><span class="ident" id="5382907">sa</span>&nbsp;<span class="op" id="5382910">[</span><span class="op" id="5382911">]</span><span class="builtintype" id="5382912">int</span><span class="op" id="5382915">,</span>&nbsp;<span class="ident" id="5382917">data</span>&nbsp;<span class="op" id="5382922">[</span><span class="op" id="5382923">]</span><span class="builtintype" id="5382924">byte</span><span class="op" id="5382928">)</span>&nbsp;<span class="op" id="5382930">[</span><span class="op" id="5382931">]</span><span class="builtintype" id="5382932">int</span>&nbsp;<span class="op" id="5382936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5382939">//&nbsp;label&nbsp;contiguous&nbsp;same-letter&nbsp;groups&nbsp;with&nbsp;the&nbsp;same&nbsp;group&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383006">inv</span>&nbsp;<span class="op" id="5383010">:=</span>&nbsp;<span class="builtinfunc" id="5383013">make</span><span class="op" id="5383017">(</span><span class="op" id="5383018">[</span><span class="op" id="5383019">]</span><span class="builtintype" id="5383020">int</span><span class="op" id="5383023">,</span>&nbsp;<span class="builtinfunc" id="5383025">len</span><span class="op" id="5383028">(</span><span class="ident" id="5383029">data</span><span class="op" id="5383033">)</span><span class="op" id="5383034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383037">prevGroup</span>&nbsp;<span class="op" id="5383047">:=</span>&nbsp;<span class="builtinfunc" id="5383050">len</span><span class="op" id="5383053">(</span><span class="ident" id="5383054">sa</span><span class="op" id="5383056">)</span>&nbsp;<span class="op" id="5383058">-</span>&nbsp;<span class="num" id="5383060">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383063">groupByte</span>&nbsp;<span class="op" id="5383073">:=</span>&nbsp;<span class="ident" id="5383076">data</span><span class="op" id="5383080">[</span><span class="ident" id="5383081">sa</span><span class="op" id="5383083">[</span><span class="ident" id="5383084">prevGroup</span><span class="op" id="5383093">]</span><span class="op" id="5383094">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383097">for</span>&nbsp;<span class="ident" id="5383101">i</span>&nbsp;<span class="op" id="5383103">:=</span>&nbsp;<span class="builtinfunc" id="5383106">len</span><span class="op" id="5383109">(</span><span class="ident" id="5383110">sa</span><span class="op" id="5383112">)</span>&nbsp;<span class="op" id="5383114">-</span>&nbsp;<span class="num" id="5383116">1</span><span class="op" id="5383117">;</span>&nbsp;<span class="ident" id="5383119">i</span>&nbsp;<span class="op" id="5383121">&gt;=</span>&nbsp;<span class="num" id="5383124">0</span><span class="op" id="5383125">;</span>&nbsp;<span class="ident" id="5383127">i</span><span class="op" id="5383128">--</span>&nbsp;<span class="op" id="5383131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383135">if</span>&nbsp;<span class="ident" id="5383138">b</span>&nbsp;<span class="op" id="5383140">:=</span>&nbsp;<span class="ident" id="5383143">data</span><span class="op" id="5383147">[</span><span class="ident" id="5383148">sa</span><span class="op" id="5383150">[</span><span class="ident" id="5383151">i</span><span class="op" id="5383152">]</span><span class="op" id="5383153">]</span><span class="op" id="5383154">;</span>&nbsp;<span class="ident" id="5383156">b</span>&nbsp;<span class="op" id="5383158">&lt;</span>&nbsp;<span class="ident" id="5383160">groupByte</span>&nbsp;<span class="op" id="5383170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383175">if</span>&nbsp;<span class="ident" id="5383178">prevGroup</span>&nbsp;<span class="op" id="5383188">==</span>&nbsp;<span class="ident" id="5383191">i</span><span class="op" id="5383192">+</span><span class="num" id="5383193">1</span>&nbsp;<span class="op" id="5383195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383201">sa</span><span class="op" id="5383203">[</span><span class="ident" id="5383204">i</span><span class="op" id="5383205">+</span><span class="num" id="5383206">1</span><span class="op" id="5383207">]</span>&nbsp;<span class="op" id="5383209">=</span>&nbsp;<span class="op" id="5383211">-</span><span class="num" id="5383212">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383217">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383222">groupByte</span>&nbsp;<span class="op" id="5383232">=</span>&nbsp;<span class="ident" id="5383234">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383239">prevGroup</span>&nbsp;<span class="op" id="5383249">=</span>&nbsp;<span class="ident" id="5383251">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383259">inv</span><span class="op" id="5383262">[</span><span class="ident" id="5383263">sa</span><span class="op" id="5383265">[</span><span class="ident" id="5383266">i</span><span class="op" id="5383267">]</span><span class="op" id="5383268">]</span>&nbsp;<span class="op" id="5383270">=</span>&nbsp;<span class="ident" id="5383272">prevGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383284">if</span>&nbsp;<span class="ident" id="5383287">prevGroup</span>&nbsp;<span class="op" id="5383297">==</span>&nbsp;<span class="num" id="5383300">0</span>&nbsp;<span class="op" id="5383302">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383307">sa</span><span class="op" id="5383309">[</span><span class="num" id="5383310">0</span><span class="op" id="5383311">]</span>&nbsp;<span class="op" id="5383313">=</span>&nbsp;<span class="op" id="5383315">-</span><span class="num" id="5383316">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5383326">//&nbsp;Separate&nbsp;out&nbsp;the&nbsp;final&nbsp;suffix&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;its&nbsp;group.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5383387">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;to&nbsp;ensure&nbsp;the&nbsp;suffix&nbsp;&#34;a&#34;&nbsp;is&nbsp;before&nbsp;&#34;aba&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5383450">//&nbsp;when&nbsp;using&nbsp;a&nbsp;potentially&nbsp;unstable&nbsp;sort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383494">lastByte</span>&nbsp;<span class="op" id="5383503">:=</span>&nbsp;<span class="ident" id="5383506">data</span><span class="op" id="5383510">[</span><span class="builtinfunc" id="5383511">len</span><span class="op" id="5383514">(</span><span class="ident" id="5383515">data</span><span class="op" id="5383519">)</span><span class="op" id="5383520">-</span><span class="num" id="5383521">1</span><span class="op" id="5383522">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383525">s</span>&nbsp;<span class="op" id="5383527">:=</span>&nbsp;<span class="op" id="5383530">-</span><span class="num" id="5383531">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383534">for</span>&nbsp;<span class="ident" id="5383538">i</span>&nbsp;<span class="op" id="5383540">:=</span>&nbsp;<span class="keyword" id="5383543">range</span>&nbsp;<span class="ident" id="5383549">sa</span>&nbsp;<span class="op" id="5383552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383556">if</span>&nbsp;<span class="ident" id="5383559">sa</span><span class="op" id="5383561">[</span><span class="ident" id="5383562">i</span><span class="op" id="5383563">]</span>&nbsp;<span class="op" id="5383565">&gt;=</span>&nbsp;<span class="num" id="5383568">0</span>&nbsp;<span class="op" id="5383570">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383575">if</span>&nbsp;<span class="ident" id="5383578">data</span><span class="op" id="5383582">[</span><span class="ident" id="5383583">sa</span><span class="op" id="5383585">[</span><span class="ident" id="5383586">i</span><span class="op" id="5383587">]</span><span class="op" id="5383588">]</span>&nbsp;<span class="op" id="5383590">==</span>&nbsp;<span class="ident" id="5383593">lastByte</span>&nbsp;<span class="op" id="5383602">&amp;&amp;</span>&nbsp;<span class="ident" id="5383605">s</span>&nbsp;<span class="op" id="5383607">==</span>&nbsp;<span class="op" id="5383610">-</span><span class="num" id="5383611">1</span>&nbsp;<span class="op" id="5383613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383619">s</span>&nbsp;<span class="op" id="5383621">=</span>&nbsp;<span class="ident" id="5383623">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383633">if</span>&nbsp;<span class="ident" id="5383636">sa</span><span class="op" id="5383638">[</span><span class="ident" id="5383639">i</span><span class="op" id="5383640">]</span>&nbsp;<span class="op" id="5383642">==</span>&nbsp;<span class="builtinfunc" id="5383645">len</span><span class="op" id="5383648">(</span><span class="ident" id="5383649">sa</span><span class="op" id="5383651">)</span><span class="op" id="5383652">-</span><span class="num" id="5383653">1</span>&nbsp;<span class="op" id="5383655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383661">sa</span><span class="op" id="5383663">[</span><span class="ident" id="5383664">i</span><span class="op" id="5383665">]</span><span class="op" id="5383666">,</span>&nbsp;<span class="ident" id="5383668">sa</span><span class="op" id="5383670">[</span><span class="ident" id="5383671">s</span><span class="op" id="5383672">]</span>&nbsp;<span class="op" id="5383674">=</span>&nbsp;<span class="ident" id="5383676">sa</span><span class="op" id="5383678">[</span><span class="ident" id="5383679">s</span><span class="op" id="5383680">]</span><span class="op" id="5383681">,</span>&nbsp;<span class="ident" id="5383683">sa</span><span class="op" id="5383685">[</span><span class="ident" id="5383686">i</span><span class="op" id="5383687">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383693">inv</span><span class="op" id="5383696">[</span><span class="ident" id="5383697">sa</span><span class="op" id="5383699">[</span><span class="ident" id="5383700">s</span><span class="op" id="5383701">]</span><span class="op" id="5383702">]</span>&nbsp;<span class="op" id="5383704">=</span>&nbsp;<span class="ident" id="5383706">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383712">sa</span><span class="op" id="5383714">[</span><span class="ident" id="5383715">s</span><span class="op" id="5383716">]</span>&nbsp;<span class="op" id="5383718">=</span>&nbsp;<span class="op" id="5383720">-</span><span class="num" id="5383721">1</span>&nbsp;<span class="comment" id="5383723">//&nbsp;mark&nbsp;it&nbsp;as&nbsp;an&nbsp;isolated&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383766">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383779">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383785">return</span>&nbsp;<span class="ident" id="5383792">inv</span><br>
<span class="lineno"></span><span class="op" id="5383796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5383799">type</span>&nbsp;<span class="ident" id="5383804">suffixSortable</span>&nbsp;<span class="keyword" id="5383819">struct</span>&nbsp;<span class="op" id="5383826">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383829">sa</span>&nbsp;&nbsp;<span class="op" id="5383833">[</span><span class="op" id="5383834">]</span><span class="builtintype" id="5383835">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383840">inv</span>&nbsp;<span class="op" id="5383844">[</span><span class="op" id="5383845">]</span><span class="builtintype" id="5383846">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383851">h</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5383855">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383860">buf</span>&nbsp;<span class="op" id="5383864">[</span><span class="op" id="5383865">]</span><span class="builtintype" id="5383866">int</span>&nbsp;<span class="comment" id="5383870">//&nbsp;common&nbsp;scratch&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="5383894">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="5383897">func</span>&nbsp;<span class="op" id="5383902">(</span><span class="ident" id="5383903">x</span>&nbsp;<span class="op" id="5383905">*</span><span class="ident" id="5383906">suffixSortable</span><span class="op" id="5383920">)</span>&nbsp;<span class="ident" id="5383922">Len</span><span class="op" id="5383925">(</span><span class="op" id="5383926">)</span>&nbsp;<span class="builtintype" id="5383928">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383942">{</span>&nbsp;<span class="keyword" id="5383944">return</span>&nbsp;<span class="builtinfunc" id="5383951">len</span><span class="op" id="5383954">(</span><span class="ident" id="5383955">x</span><span class="op" id="5383956">.</span><span class="ident" id="5383957">sa</span><span class="op" id="5383959">)</span>&nbsp;<span class="op" id="5383961">}</span><br>
<span class="lineno"></span><span class="keyword" id="5383963">func</span>&nbsp;<span class="op" id="5383968">(</span><span class="ident" id="5383969">x</span>&nbsp;<span class="op" id="5383971">*</span><span class="ident" id="5383972">suffixSortable</span><span class="op" id="5383986">)</span>&nbsp;<span class="ident" id="5383988">Less</span><span class="op" id="5383992">(</span><span class="ident" id="5383993">i</span><span class="op" id="5383994">,</span>&nbsp;<span class="ident" id="5383996">j</span>&nbsp;<span class="builtintype" id="5383998">int</span><span class="op" id="5384001">)</span>&nbsp;<span class="builtintype" id="5384003">bool</span>&nbsp;<span class="op" id="5384008">{</span>&nbsp;<span class="keyword" id="5384010">return</span>&nbsp;<span class="ident" id="5384017">x</span><span class="op" id="5384018">.</span><span class="ident" id="5384019">inv</span><span class="op" id="5384022">[</span><span class="ident" id="5384023">x</span><span class="op" id="5384024">.</span><span class="ident" id="5384025">sa</span><span class="op" id="5384027">[</span><span class="ident" id="5384028">i</span><span class="op" id="5384029">]</span><span class="op" id="5384030">+</span><span class="ident" id="5384031">x</span><span class="op" id="5384032">.</span><span class="ident" id="5384033">h</span><span class="op" id="5384034">]</span>&nbsp;<span class="op" id="5384036">&lt;</span>&nbsp;<span class="ident" id="5384038">x</span><span class="op" id="5384039">.</span><span class="ident" id="5384040">inv</span><span class="op" id="5384043">[</span><span class="ident" id="5384044">x</span><span class="op" id="5384045">.</span><span class="ident" id="5384046">sa</span><span class="op" id="5384048">[</span><span class="ident" id="5384049">j</span><span class="op" id="5384050">]</span><span class="op" id="5384051">+</span><span class="ident" id="5384052">x</span><span class="op" id="5384053">.</span><span class="ident" id="5384054">h</span><span class="op" id="5384055">]</span>&nbsp;<span class="op" id="5384057">}</span><br>
<span class="lineno"></span><span class="keyword" id="5384059">func</span>&nbsp;<span class="op" id="5384064">(</span><span class="ident" id="5384065">x</span>&nbsp;<span class="op" id="5384067">*</span><span class="ident" id="5384068">suffixSortable</span><span class="op" id="5384082">)</span>&nbsp;<span class="ident" id="5384084">Swap</span><span class="op" id="5384088">(</span><span class="ident" id="5384089">i</span><span class="op" id="5384090">,</span>&nbsp;<span class="ident" id="5384092">j</span>&nbsp;<span class="builtintype" id="5384094">int</span><span class="op" id="5384097">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5384104">{</span>&nbsp;<span class="ident" id="5384106">x</span><span class="op" id="5384107">.</span><span class="ident" id="5384108">sa</span><span class="op" id="5384110">[</span><span class="ident" id="5384111">i</span><span class="op" id="5384112">]</span><span class="op" id="5384113">,</span>&nbsp;<span class="ident" id="5384115">x</span><span class="op" id="5384116">.</span><span class="ident" id="5384117">sa</span><span class="op" id="5384119">[</span><span class="ident" id="5384120">j</span><span class="op" id="5384121">]</span>&nbsp;<span class="op" id="5384123">=</span>&nbsp;<span class="ident" id="5384125">x</span><span class="op" id="5384126">.</span><span class="ident" id="5384127">sa</span><span class="op" id="5384129">[</span><span class="ident" id="5384130">j</span><span class="op" id="5384131">]</span><span class="op" id="5384132">,</span>&nbsp;<span class="ident" id="5384134">x</span><span class="op" id="5384135">.</span><span class="ident" id="5384136">sa</span><span class="op" id="5384138">[</span><span class="ident" id="5384139">i</span><span class="op" id="5384140">]</span>&nbsp;<span class="op" id="5384142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="5384145">func</span>&nbsp;<span class="op" id="5384150">(</span><span class="ident" id="5384151">x</span>&nbsp;<span class="op" id="5384153">*</span><span class="ident" id="5384154">suffixSortable</span><span class="op" id="5384168">)</span>&nbsp;<span class="ident" id="5384170">updateGroups</span><span class="op" id="5384182">(</span><span class="ident" id="5384183">offset</span>&nbsp;<span class="builtintype" id="5384190">int</span><span class="op" id="5384193">)</span>&nbsp;<span class="op" id="5384195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384198">bounds</span>&nbsp;<span class="op" id="5384205">:=</span>&nbsp;<span class="ident" id="5384208">x</span><span class="op" id="5384209">.</span><span class="ident" id="5384210">buf</span><span class="op" id="5384213">[</span><span class="num" id="5384214">0</span><span class="op" id="5384215">:</span><span class="num" id="5384216">0</span><span class="op" id="5384217">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384220">group</span>&nbsp;<span class="op" id="5384226">:=</span>&nbsp;<span class="ident" id="5384229">x</span><span class="op" id="5384230">.</span><span class="ident" id="5384231">inv</span><span class="op" id="5384234">[</span><span class="ident" id="5384235">x</span><span class="op" id="5384236">.</span><span class="ident" id="5384237">sa</span><span class="op" id="5384239">[</span><span class="num" id="5384240">0</span><span class="op" id="5384241">]</span><span class="op" id="5384242">+</span><span class="ident" id="5384243">x</span><span class="op" id="5384244">.</span><span class="ident" id="5384245">h</span><span class="op" id="5384246">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5384249">for</span>&nbsp;<span class="ident" id="5384253">i</span>&nbsp;<span class="op" id="5384255">:=</span>&nbsp;<span class="num" id="5384258">1</span><span class="op" id="5384259">;</span>&nbsp;<span class="ident" id="5384261">i</span>&nbsp;<span class="op" id="5384263">&lt;</span>&nbsp;<span class="builtinfunc" id="5384265">len</span><span class="op" id="5384268">(</span><span class="ident" id="5384269">x</span><span class="op" id="5384270">.</span><span class="ident" id="5384271">sa</span><span class="op" id="5384273">)</span><span class="op" id="5384274">;</span>&nbsp;<span class="ident" id="5384276">i</span><span class="op" id="5384277">++</span>&nbsp;<span class="op" id="5384280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5384284">if</span>&nbsp;<span class="ident" id="5384287">g</span>&nbsp;<span class="op" id="5384289">:=</span>&nbsp;<span class="ident" id="5384292">x</span><span class="op" id="5384293">.</span><span class="ident" id="5384294">inv</span><span class="op" id="5384297">[</span><span class="ident" id="5384298">x</span><span class="op" id="5384299">.</span><span class="ident" id="5384300">sa</span><span class="op" id="5384302">[</span><span class="ident" id="5384303">i</span><span class="op" id="5384304">]</span><span class="op" id="5384305">+</span><span class="ident" id="5384306">x</span><span class="op" id="5384307">.</span><span class="ident" id="5384308">h</span><span class="op" id="5384309">]</span><span class="op" id="5384310">;</span>&nbsp;<span class="ident" id="5384312">g</span>&nbsp;<span class="op" id="5384314">&gt;</span>&nbsp;<span class="ident" id="5384316">group</span>&nbsp;<span class="op" id="5384322">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384327">bounds</span>&nbsp;<span class="op" id="5384334">=</span>&nbsp;<span class="builtinfunc" id="5384336">append</span><span class="op" id="5384342">(</span><span class="ident" id="5384343">bounds</span><span class="op" id="5384349">,</span>&nbsp;<span class="ident" id="5384351">i</span><span class="op" id="5384352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384357">group</span>&nbsp;<span class="op" id="5384363">=</span>&nbsp;<span class="ident" id="5384365">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5384369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5384372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384375">bounds</span>&nbsp;<span class="op" id="5384382">=</span>&nbsp;<span class="builtinfunc" id="5384384">append</span><span class="op" id="5384390">(</span><span class="ident" id="5384391">bounds</span><span class="op" id="5384397">,</span>&nbsp;<span class="builtinfunc" id="5384399">len</span><span class="op" id="5384402">(</span><span class="ident" id="5384403">x</span><span class="op" id="5384404">.</span><span class="ident" id="5384405">sa</span><span class="op" id="5384407">)</span><span class="op" id="5384408">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384411">x</span><span class="op" id="5384412">.</span><span class="ident" id="5384413">buf</span>&nbsp;<span class="op" id="5384417">=</span>&nbsp;<span class="ident" id="5384419">bounds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5384428">//&nbsp;update&nbsp;the&nbsp;group&nbsp;numberings&nbsp;after&nbsp;all&nbsp;new&nbsp;groups&nbsp;are&nbsp;determined</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384496">prev</span>&nbsp;<span class="op" id="5384501">:=</span>&nbsp;<span class="num" id="5384504">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5384507">for</span>&nbsp;<span class="ident" id="5384511">_</span><span class="op" id="5384512">,</span>&nbsp;<span class="ident" id="5384514">b</span>&nbsp;<span class="op" id="5384516">:=</span>&nbsp;<span class="keyword" id="5384519">range</span>&nbsp;<span class="ident" id="5384525">bounds</span>&nbsp;<span class="op" id="5384532">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5384536">for</span>&nbsp;<span class="ident" id="5384540">i</span>&nbsp;<span class="op" id="5384542">:=</span>&nbsp;<span class="ident" id="5384545">prev</span><span class="op" id="5384549">;</span>&nbsp;<span class="ident" id="5384551">i</span>&nbsp;<span class="op" id="5384553">&lt;</span>&nbsp;<span class="ident" id="5384555">b</span><span class="op" id="5384556">;</span>&nbsp;<span class="ident" id="5384558">i</span><span class="op" id="5384559">++</span>&nbsp;<span class="op" id="5384562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384567">x</span><span class="op" id="5384568">.</span><span class="ident" id="5384569">inv</span><span class="op" id="5384572">[</span><span class="ident" id="5384573">x</span><span class="op" id="5384574">.</span><span class="ident" id="5384575">sa</span><span class="op" id="5384577">[</span><span class="ident" id="5384578">i</span><span class="op" id="5384579">]</span><span class="op" id="5384580">]</span>&nbsp;<span class="op" id="5384582">=</span>&nbsp;<span class="ident" id="5384584">offset</span>&nbsp;<span class="op" id="5384591">+</span>&nbsp;<span class="ident" id="5384593">b</span>&nbsp;<span class="op" id="5384595">-</span>&nbsp;<span class="num" id="5384597">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5384601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5384605">if</span>&nbsp;<span class="ident" id="5384608">b</span><span class="op" id="5384609">-</span><span class="ident" id="5384610">prev</span>&nbsp;<span class="op" id="5384615">==</span>&nbsp;<span class="num" id="5384618">1</span>&nbsp;<span class="op" id="5384620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384625">x</span><span class="op" id="5384626">.</span><span class="ident" id="5384627">sa</span><span class="op" id="5384629">[</span><span class="ident" id="5384630">prev</span><span class="op" id="5384634">]</span>&nbsp;<span class="op" id="5384636">=</span>&nbsp;<span class="op" id="5384638">-</span><span class="num" id="5384639">1</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5384643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384647">prev</span>&nbsp;<span class="op" id="5384652">=</span>&nbsp;<span class="ident" id="5384654">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5384657">}</span><br>
<span class="lineno"></span><span class="op" id="5384659">}</span>
</div>
</body>
</html>
