<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5002809">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5002864">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5002918">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5002969">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspPackage&nbsp;rpc&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;exported&nbsp;methods&nbsp;of&nbsp;an&nbsp;object&nbsp;across&nbsp;a<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspnetwork&nbsp;or&nbsp;other&nbsp;I/O&nbsp;connection.&nbsp;&nbsp;A&nbsp;server&nbsp;registers&nbsp;an&nbsp;object,&nbsp;making&nbsp;it&nbsp;visible<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspas&nbsp;a&nbsp;service&nbsp;with&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;object.&nbsp;&nbsp;After&nbsp;registration,&nbsp;exported<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspmethods&nbsp;of&nbsp;the&nbsp;object&nbsp;will&nbsp;be&nbsp;accessible&nbsp;remotely.&nbsp;&nbsp;A&nbsp;server&nbsp;may&nbsp;register&nbsp;multiple<br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbspobjects&nbsp;(services)&nbsp;of&nbsp;different&nbsp;types&nbsp;but&nbsp;it&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;register&nbsp;multiple<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspobjects&nbsp;of&nbsp;the&nbsp;same&nbsp;type.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspOnly&nbsp;methods&nbsp;that&nbsp;satisfy&nbsp;these&nbsp;criteria&nbsp;will&nbsp;be&nbsp;made&nbsp;available&nbsp;for&nbsp;remote&nbsp;access;<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspother&nbsp;methods&nbsp;will&nbsp;be&nbsp;ignored:<br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;method&nbsp;is&nbsp;exported.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;method&nbsp;has&nbsp;two&nbsp;arguments,&nbsp;both&nbsp;exported&nbsp;(or&nbsp;builtin)&nbsp;types.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;method&#39;s&nbsp;second&nbsp;argument&nbsp;is&nbsp;a&nbsp;pointer.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;method&nbsp;has&nbsp;return&nbsp;type&nbsp;error.<br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspIn&nbsp;effect,&nbsp;the&nbsp;method&nbsp;must&nbsp;look&nbsp;schematically&nbsp;like<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;(t&nbsp;*T)&nbsp;MethodName(argType&nbsp;T1,&nbsp;replyType&nbsp;*T2)&nbsp;error<br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbspwhere&nbsp;T,&nbsp;T1&nbsp;and&nbsp;T2&nbsp;can&nbsp;be&nbsp;marshaled&nbsp;by&nbsp;encoding/gob.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThese&nbsp;requirements&nbsp;apply&nbsp;even&nbsp;if&nbsp;a&nbsp;different&nbsp;codec&nbsp;is&nbsp;used.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp(In&nbsp;the&nbsp;future,&nbsp;these&nbsp;requirements&nbsp;may&nbsp;soften&nbsp;for&nbsp;custom&nbsp;codecs.)<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;method&#39;s&nbsp;first&nbsp;argument&nbsp;represents&nbsp;the&nbsp;arguments&nbsp;provided&nbsp;by&nbsp;the&nbsp;caller;&nbsp;the<br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbspsecond&nbsp;argument&nbsp;represents&nbsp;the&nbsp;result&nbsp;parameters&nbsp;to&nbsp;be&nbsp;returned&nbsp;to&nbsp;the&nbsp;caller.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;method&#39;s&nbsp;return&nbsp;value,&nbsp;if&nbsp;non-nil,&nbsp;is&nbsp;passed&nbsp;back&nbsp;as&nbsp;a&nbsp;string&nbsp;that&nbsp;the&nbsp;client<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspsees&nbsp;as&nbsp;if&nbsp;created&nbsp;by&nbsp;errors.New.&nbsp;&nbsp;If&nbsp;an&nbsp;error&nbsp;is&nbsp;returned,&nbsp;the&nbsp;reply&nbsp;parameter<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspwill&nbsp;not&nbsp;be&nbsp;sent&nbsp;back&nbsp;to&nbsp;the&nbsp;client.<br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;server&nbsp;may&nbsp;handle&nbsp;requests&nbsp;on&nbsp;a&nbsp;single&nbsp;connection&nbsp;by&nbsp;calling&nbsp;ServeConn.&nbsp;&nbsp;More<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsptypically&nbsp;it&nbsp;will&nbsp;create&nbsp;a&nbsp;network&nbsp;listener&nbsp;and&nbsp;call&nbsp;Accept&nbsp;or,&nbsp;for&nbsp;an&nbsp;HTTP<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsplistener,&nbsp;HandleHTTP&nbsp;and&nbsp;http.Serve.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspA&nbsp;client&nbsp;wishing&nbsp;to&nbsp;use&nbsp;the&nbsp;service&nbsp;establishes&nbsp;a&nbsp;connection&nbsp;and&nbsp;then&nbsp;invokes<br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbspNewClient&nbsp;on&nbsp;the&nbsp;connection.&nbsp;&nbsp;The&nbsp;convenience&nbsp;function&nbsp;Dial&nbsp;(DialHTTP)&nbsp;performs<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspboth&nbsp;steps&nbsp;for&nbsp;a&nbsp;raw&nbsp;network&nbsp;connection&nbsp;(an&nbsp;HTTP&nbsp;connection).&nbsp;&nbsp;The&nbsp;resulting<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspClient&nbsp;object&nbsp;has&nbsp;two&nbsp;methods,&nbsp;Call&nbsp;and&nbsp;Go,&nbsp;that&nbsp;specify&nbsp;the&nbsp;service&nbsp;and&nbsp;method&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspcall,&nbsp;a&nbsp;pointer&nbsp;containing&nbsp;the&nbsp;arguments,&nbsp;and&nbsp;a&nbsp;pointer&nbsp;to&nbsp;receive&nbsp;the&nbsp;result<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspparameters.<br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;Call&nbsp;method&nbsp;waits&nbsp;for&nbsp;the&nbsp;remote&nbsp;call&nbsp;to&nbsp;complete&nbsp;while&nbsp;the&nbsp;Go&nbsp;method<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsplaunches&nbsp;the&nbsp;call&nbsp;asynchronously&nbsp;and&nbsp;signals&nbsp;completion&nbsp;using&nbsp;the&nbsp;Call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspstructure&#39;s&nbsp;Done&nbsp;channel.<br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbspUnless&nbsp;an&nbsp;explicit&nbsp;codec&nbsp;is&nbsp;set&nbsp;up,&nbsp;package&nbsp;encoding/gob&nbsp;is&nbsp;used&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsptransport&nbsp;the&nbsp;data.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspHere&nbsp;is&nbsp;a&nbsp;simple&nbsp;example.&nbsp;&nbsp;A&nbsp;server&nbsp;wishes&nbsp;to&nbsp;export&nbsp;an&nbsp;object&nbsp;of&nbsp;type&nbsp;Arith:<br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;server<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptype&nbsp;Args&nbsp;struct&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspA,&nbsp;B&nbsp;int<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptype&nbsp;Quotient&nbsp;struct&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspQuo,&nbsp;Rem&nbsp;int<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptype&nbsp;Arith&nbsp;int<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;(t&nbsp;*Arith)&nbsp;Multiply(args&nbsp;*Args,&nbsp;reply&nbsp;*int)&nbsp;error&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp*reply&nbsp;=&nbsp;args.A&nbsp;*&nbsp;args.B<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;nil<br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;(t&nbsp;*Arith)&nbsp;Divide(args&nbsp;*Args,&nbsp;quo&nbsp;*Quotient)&nbsp;error&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;args.B&nbsp;==&nbsp;0&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;errors.New(&#34;divide&nbsp;by&nbsp;zero&#34;)<br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspquo.Quo&nbsp;=&nbsp;args.A&nbsp;/&nbsp;args.B<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspquo.Rem&nbsp;=&nbsp;args.A&nbsp;%&nbsp;args.B<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;nil<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;server&nbsp;calls&nbsp;(for&nbsp;HTTP&nbsp;service):<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsparith&nbsp;:=&nbsp;new(Arith)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsprpc.Register(arith)<br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsprpc.HandleHTTP()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspl,&nbsp;e&nbsp;:=&nbsp;net.Listen(&#34;tcp&#34;,&nbsp;&#34;:1234&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;e&nbsp;!=&nbsp;nil&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Fatal(&#34;listen&nbsp;error:&#34;,&nbsp;e)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;http.Serve(l,&nbsp;nil)<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspAt&nbsp;this&nbsp;point,&nbsp;clients&nbsp;can&nbsp;see&nbsp;a&nbsp;service&nbsp;&#34;Arith&#34;&nbsp;with&nbsp;methods&nbsp;&#34;Arith.Multiply&#34;&nbsp;and<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&#34;Arith.Divide&#34;.&nbsp;&nbsp;To&nbsp;invoke&nbsp;one,&nbsp;a&nbsp;client&nbsp;first&nbsp;dials&nbsp;the&nbsp;server:<br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspclient,&nbsp;err&nbsp;:=&nbsp;rpc.DialHTTP(&#34;tcp&#34;,&nbsp;serverAddress&nbsp;+&nbsp;&#34;:1234&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;err&nbsp;!=&nbsp;nil&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Fatal(&#34;dialing:&#34;,&nbsp;err)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbspThen&nbsp;it&nbsp;can&nbsp;make&nbsp;a&nbsp;remote&nbsp;call:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;Synchronous&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspargs&nbsp;:=&nbsp;&amp;server.Args{7,8}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspvar&nbsp;reply&nbsp;int<br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;client.Call(&#34;Arith.Multiply&#34;,&nbsp;args,&nbsp;&amp;reply)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;err&nbsp;!=&nbsp;nil&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Fatal(&#34;arith&nbsp;error:&#34;,&nbsp;err)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfmt.Printf(&#34;Arith:&nbsp;%d*%d=%d&#34;,&nbsp;args.A,&nbsp;args.B,&nbsp;reply)<br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspor<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;Asynchronous&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspquotient&nbsp;:=&nbsp;new(Quotient)<br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspdivCall&nbsp;:=&nbsp;client.Go(&#34;Arith.Divide&#34;,&nbsp;args,&nbsp;quotient,&nbsp;nil)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreplyCall&nbsp;:=&nbsp;&lt;-divCall.Done&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;will&nbsp;be&nbsp;equal&nbsp;to&nbsp;divCall<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;check&nbsp;errors,&nbsp;print,&nbsp;etc.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspA&nbsp;server&nbsp;implementation&nbsp;will&nbsp;often&nbsp;provide&nbsp;a&nbsp;simple,&nbsp;type-safe&nbsp;wrapper&nbsp;for&nbsp;the<br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbspclient.<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="5006798">package</span>&nbsp;<span class="ident" id="5006806">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5006811">import</span>&nbsp;<span class="op" id="5006818">(</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006821">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006830">&#34;encoding/gob&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006846">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006856">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006862">&#34;log&#34;</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006869">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006876">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006888">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006899">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006910">&#34;sync&#34;</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006918">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006929">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5006944">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5006947">const</span>&nbsp;<span class="op" id="5006953">(</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5006956">//&nbsp;Defaults&nbsp;used&nbsp;by&nbsp;HandleHTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006988">DefaultRPCPath</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5007005">=</span>&nbsp;<span class="string" id="5007007">&#34;/_goRPC_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007019">DefaultDebugPath</span>&nbsp;<span class="op" id="5007036">=</span>&nbsp;<span class="string" id="5007038">&#34;/debug/rpc&#34;</span><br>
<span class="lineno"></span><span class="op" id="5007051">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="5007054">//&nbsp;Precompute&nbsp;the&nbsp;reflect&nbsp;type&nbsp;for&nbsp;error.&nbsp;&nbsp;Can&#39;t&nbsp;use&nbsp;error&nbsp;directly</span><br>
<span class="lineno"></span><span class="comment" id="5007122">//&nbsp;because&nbsp;Typeof&nbsp;takes&nbsp;an&nbsp;empty&nbsp;interface&nbsp;value.&nbsp;&nbsp;This&nbsp;is&nbsp;annoying.</span><br>
<span class="lineno"></span><span class="keyword" id="5007191">var</span>&nbsp;<span class="ident" id="5007195">typeOfError</span>&nbsp;<span class="op" id="5007207">=</span>&nbsp;<span class="ident" id="5007209"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5007216">.</span><span class="ident" id="5007217">TypeOf</span><span class="op" id="5007223">(</span><span class="op" id="5007224">(</span><span class="op" id="5007225">*</span><span class="builtintype" id="5007226">error</span><span class="op" id="5007231">)</span><span class="op" id="5007232">(</span><span class="ident" id="5007233">nil</span><span class="op" id="5007236">)</span><span class="op" id="5007237">)</span><span class="op" id="5007238">.</span><span class="ident" id="5007239">Elem</span><span class="op" id="5007243">(</span><span class="op" id="5007244">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5007247">type</span>&nbsp;<span class="ident" id="5007252">methodType</span>&nbsp;<span class="keyword" id="5007263">struct</span>&nbsp;<span class="op" id="5007270">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007273"><a href="/net/rpc/server.go.html#5006910">sync</a></span><span class="op" id="5007277">.</span><span class="ident" id="5007278">Mutex</span>&nbsp;<span class="comment" id="5007284">//&nbsp;protects&nbsp;counters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007306">method</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007317"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5007324">.</span><span class="ident" id="5007325">Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007333">ArgType</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007344"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5007351">.</span><span class="ident" id="5007352">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007358">ReplyType</span>&nbsp;&nbsp;<span class="ident" id="5007369"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5007376">.</span><span class="ident" id="5007377">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007383">numCalls</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5007394">uint</span><br>
<span class="lineno">155</span><span class="op" id="5007399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5007402">type</span>&nbsp;<span class="ident" id="5007407">service</span>&nbsp;<span class="keyword" id="5007415">struct</span>&nbsp;<span class="op" id="5007422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007425">name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5007432">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5007455">//&nbsp;name&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007475">rcvr</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5007482"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5007489">.</span><span class="ident" id="5007490">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5007505">//&nbsp;receiver&nbsp;of&nbsp;methods&nbsp;for&nbsp;the&nbsp;service</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007545">typ</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007552"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5007559">.</span><span class="ident" id="5007560">Type</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5007575">//&nbsp;type&nbsp;of&nbsp;the&nbsp;receiver</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007600">method</span>&nbsp;<span class="keyword" id="5007607">map</span><span class="op" id="5007610">[</span><span class="builtintype" id="5007611">string</span><span class="op" id="5007617">]</span><span class="op" id="5007618">*</span><span class="ident" id="5007619"><a href="/net/rpc/server.go.html#5007252">methodType</a></span>&nbsp;<span class="comment" id="5007630">//&nbsp;registered&nbsp;methods</span><br>
<span class="lineno"></span><span class="op" id="5007652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5007655">//&nbsp;Request&nbsp;is&nbsp;a&nbsp;header&nbsp;written&nbsp;before&nbsp;every&nbsp;RPC&nbsp;call.&nbsp;&nbsp;It&nbsp;is&nbsp;used&nbsp;internally</span><br>
<span class="lineno">165</span><span class="comment" id="5007732">//&nbsp;but&nbsp;documented&nbsp;here&nbsp;as&nbsp;an&nbsp;aid&nbsp;to&nbsp;debugging,&nbsp;such&nbsp;as&nbsp;when&nbsp;analyzing</span><br>
<span class="lineno"></span><span class="comment" id="5007802">//&nbsp;network&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="5007822">type</span>&nbsp;<span class="ident" id="5007827">Request</span>&nbsp;<span class="keyword" id="5007835">struct</span>&nbsp;<span class="op" id="5007842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007845">ServiceMethod</span>&nbsp;<span class="builtintype" id="5007859">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5007868">//&nbsp;format:&nbsp;&#34;Service.Method&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007897">Seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007911">uint64</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5007920">//&nbsp;sequence&nbsp;number&nbsp;chosen&nbsp;by&nbsp;client</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007957">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5007971">*</span><span class="ident" id="5007972"><a href="/net/rpc/server.go.html#5007827">Request</a></span>&nbsp;<span class="comment" id="5007980">//&nbsp;for&nbsp;free&nbsp;list&nbsp;in&nbsp;Server</span><br>
<span class="lineno"></span><span class="op" id="5008007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5008010">//&nbsp;Response&nbsp;is&nbsp;a&nbsp;header&nbsp;written&nbsp;before&nbsp;every&nbsp;RPC&nbsp;return.&nbsp;&nbsp;It&nbsp;is&nbsp;used&nbsp;internally</span><br>
<span class="lineno"></span><span class="comment" id="5008090">//&nbsp;but&nbsp;documented&nbsp;here&nbsp;as&nbsp;an&nbsp;aid&nbsp;to&nbsp;debugging,&nbsp;such&nbsp;as&nbsp;when&nbsp;analyzing</span><br>
<span class="lineno">175</span><span class="comment" id="5008160">//&nbsp;network&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="5008180">type</span>&nbsp;<span class="ident" id="5008185">Response</span>&nbsp;<span class="keyword" id="5008194">struct</span>&nbsp;<span class="op" id="5008201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008204">ServiceMethod</span>&nbsp;<span class="builtintype" id="5008218">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5008228">//&nbsp;echoes&nbsp;that&nbsp;of&nbsp;the&nbsp;Request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008259">Seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008273">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5008283">//&nbsp;echoes&nbsp;that&nbsp;of&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008314">Error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5008328">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5008338">//&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008357">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5008371">*</span><span class="ident" id="5008372"><a href="/net/rpc/server.go.html#5008185">Response</a></span>&nbsp;<span class="comment" id="5008381">//&nbsp;for&nbsp;free&nbsp;list&nbsp;in&nbsp;Server</span><br>
<span class="lineno"></span><span class="op" id="5008408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5008411">//&nbsp;Server&nbsp;represents&nbsp;an&nbsp;RPC&nbsp;Server.</span><br>
<span class="lineno"></span><span class="keyword" id="5008447">type</span>&nbsp;<span class="ident" id="5008452">Server</span>&nbsp;<span class="keyword" id="5008459">struct</span>&nbsp;<span class="op" id="5008466">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008469">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008480"><a href="/net/rpc/server.go.html#5006910">sync</a></span><span class="op" id="5008484">.</span><span class="ident" id="5008485">RWMutex</span>&nbsp;<span class="comment" id="5008493">//&nbsp;protects&nbsp;the&nbsp;serviceMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008521">serviceMap</span>&nbsp;<span class="keyword" id="5008532">map</span><span class="op" id="5008535">[</span><span class="builtintype" id="5008536">string</span><span class="op" id="5008542">]</span><span class="op" id="5008543">*</span><span class="ident" id="5008544"><a href="/net/rpc/server.go.html#5007407">service</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008553">reqLock</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008564"><a href="/net/rpc/server.go.html#5006910">sync</a></span><span class="op" id="5008568">.</span><span class="ident" id="5008569">Mutex</span>&nbsp;<span class="comment" id="5008575">//&nbsp;protects&nbsp;freeReq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008596">freeReq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5008607">*</span><span class="ident" id="5008608"><a href="/net/rpc/server.go.html#5007827">Request</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008617">respLock</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5008628"><a href="/net/rpc/server.go.html#5006910">sync</a></span><span class="op" id="5008632">.</span><span class="ident" id="5008633">Mutex</span>&nbsp;<span class="comment" id="5008639">//&nbsp;protects&nbsp;freeResp</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008661">freeResp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5008672">*</span><span class="ident" id="5008673"><a href="/net/rpc/server.go.html#5008185">Response</a></span><br>
<span class="lineno"></span><span class="op" id="5008682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5008685">//&nbsp;NewServer&nbsp;returns&nbsp;a&nbsp;new&nbsp;Server.</span><br>
<span class="lineno"></span><span class="keyword" id="5008720">func</span>&nbsp;<span class="ident" id="5008725">NewServer</span><span class="op" id="5008734">(</span><span class="op" id="5008735">)</span>&nbsp;<span class="op" id="5008737">*</span><span class="ident" id="5008738"><a href="/net/rpc/server.go.html#5008452">Server</a></span>&nbsp;<span class="op" id="5008745">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008748">return</span>&nbsp;<span class="op" id="5008755">&amp;</span><span class="ident" id="5008756"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5008762">{</span><span class="ident" id="5008763">serviceMap</span><span class="op" id="5008773">:</span>&nbsp;<span class="builtinfunc" id="5008775">make</span><span class="op" id="5008779">(</span><span class="keyword" id="5008780">map</span><span class="op" id="5008783">[</span><span class="builtintype" id="5008784">string</span><span class="op" id="5008790">]</span><span class="op" id="5008791">*</span><span class="ident" id="5008792"><a href="/net/rpc/server.go.html#5007407">service</a></span><span class="op" id="5008799">)</span><span class="op" id="5008800">}</span><br>
<span class="lineno"></span><span class="op" id="5008802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5008805">//&nbsp;DefaultServer&nbsp;is&nbsp;the&nbsp;default&nbsp;instance&nbsp;of&nbsp;*Server.</span><br>
<span class="lineno"></span><span class="keyword" id="5008858">var</span>&nbsp;<span class="ident" id="5008862">DefaultServer</span>&nbsp;<span class="op" id="5008876">=</span>&nbsp;<span class="ident" id="5008878"><a href="/net/rpc/server.go.html#5008725">NewServer</a></span><span class="op" id="5008887">(</span><span class="op" id="5008888">)</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5008891">//&nbsp;Is&nbsp;this&nbsp;an&nbsp;exported&nbsp;-&nbsp;upper&nbsp;case&nbsp;-&nbsp;name?</span><br>
<span class="lineno"></span><span class="keyword" id="5008935">func</span>&nbsp;<span class="ident" id="5008940">isExported</span><span class="op" id="5008950">(</span><span class="ident" id="5008951">name</span>&nbsp;<span class="builtintype" id="5008956">string</span><span class="op" id="5008962">)</span>&nbsp;<span class="builtintype" id="5008964">bool</span>&nbsp;<span class="op" id="5008969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5008972">rune</span><span class="op" id="5008976">,</span>&nbsp;<span class="ident" id="5008978">_</span>&nbsp;<span class="op" id="5008980">:=</span>&nbsp;<span class="ident" id="5008983"><a href="/net/rpc/server.go.html#5006929">utf8</a></span><span class="op" id="5008987">.</span><span class="ident" id="5008988">DecodeRuneInString</span><span class="op" id="5009006">(</span><span class="ident" id="5009007"><a href="/net/rpc/server.go.html#5008951">name</a></span><span class="op" id="5009011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009014">return</span>&nbsp;<span class="ident" id="5009021"><a href="/net/rpc/server.go.html#5006918">unicode</a></span><span class="op" id="5009028">.</span><span class="ident" id="5009029">IsUpper</span><span class="op" id="5009036">(</span><span class="builtintype" id="5009037"><a href="/net/rpc/server.go.html#5008972">rune</a></span><span class="op" id="5009041">)</span><br>
<span class="lineno">205</span><span class="op" id="5009043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5009046">//&nbsp;Is&nbsp;this&nbsp;type&nbsp;exported&nbsp;or&nbsp;a&nbsp;builtin?</span><br>
<span class="lineno"></span><span class="keyword" id="5009085">func</span>&nbsp;<span class="ident" id="5009090">isExportedOrBuiltinType</span><span class="op" id="5009113">(</span><span class="ident" id="5009114">t</span>&nbsp;<span class="ident" id="5009116"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5009123">.</span><span class="ident" id="5009124">Type</span><span class="op" id="5009128">)</span>&nbsp;<span class="builtintype" id="5009130">bool</span>&nbsp;<span class="op" id="5009135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009138">for</span>&nbsp;<span class="ident" id="5009142"><a href="/net/rpc/server.go.html#5009114">t</a></span><span class="op" id="5009143">.</span><span class="ident" id="5009144">Kind</span><span class="op" id="5009148">(</span><span class="op" id="5009149">)</span>&nbsp;<span class="op" id="5009151">==</span>&nbsp;<span class="ident" id="5009154"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5009161">.</span><span class="ident" id="5009162">Ptr</span>&nbsp;<span class="op" id="5009166">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009170"><a href="/net/rpc/server.go.html#5009114">t</a></span>&nbsp;<span class="op" id="5009172">=</span>&nbsp;<span class="ident" id="5009174"><a href="/net/rpc/server.go.html#5009114">t</a></span><span class="op" id="5009175">.</span><span class="ident" id="5009176">Elem</span><span class="op" id="5009180">(</span><span class="op" id="5009181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5009184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009187">//&nbsp;PkgPath&nbsp;will&nbsp;be&nbsp;non-empty&nbsp;even&nbsp;for&nbsp;an&nbsp;exported&nbsp;type,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009244">//&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;check&nbsp;the&nbsp;type&nbsp;name&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009291">return</span>&nbsp;<span class="ident" id="5009298"><a href="/net/rpc/server.go.html#5008940">isExported</a></span><span class="op" id="5009308">(</span><span class="ident" id="5009309"><a href="/net/rpc/server.go.html#5009114">t</a></span><span class="op" id="5009310">.</span><span class="ident" id="5009311">Name</span><span class="op" id="5009315">(</span><span class="op" id="5009316">)</span><span class="op" id="5009317">)</span>&nbsp;<span class="op" id="5009319">||</span>&nbsp;<span class="ident" id="5009322"><a href="/net/rpc/server.go.html#5009114">t</a></span><span class="op" id="5009323">.</span><span class="ident" id="5009324">PkgPath</span><span class="op" id="5009331">(</span><span class="op" id="5009332">)</span>&nbsp;<span class="op" id="5009334">==</span>&nbsp;<span class="string" id="5009337">&#34;&#34;</span><br>
<span class="lineno">215</span><span class="op" id="5009340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5009343">//&nbsp;Register&nbsp;publishes&nbsp;in&nbsp;the&nbsp;server&nbsp;the&nbsp;set&nbsp;of&nbsp;methods&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5009405">//&nbsp;receiver&nbsp;value&nbsp;that&nbsp;satisfy&nbsp;the&nbsp;following&nbsp;conditions:</span><br>
<span class="lineno"></span><span class="comment" id="5009462">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;exported&nbsp;method</span><br>
<span class="lineno">220</span><span class="comment" id="5009483">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;two&nbsp;arguments,&nbsp;both&nbsp;of&nbsp;exported&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5009525">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;second&nbsp;argument&nbsp;is&nbsp;a&nbsp;pointer</span><br>
<span class="lineno"></span><span class="comment" id="5009563">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;one&nbsp;return&nbsp;value,&nbsp;of&nbsp;type&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5009600">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;not&nbsp;an&nbsp;exported&nbsp;type&nbsp;or&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="5009670">//&nbsp;no&nbsp;suitable&nbsp;methods.&nbsp;It&nbsp;also&nbsp;logs&nbsp;the&nbsp;error&nbsp;using&nbsp;package&nbsp;log.</span><br>
<span class="lineno">225</span><span class="comment" id="5009736">//&nbsp;The&nbsp;client&nbsp;accesses&nbsp;each&nbsp;method&nbsp;using&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;Type.Method&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5009813">//&nbsp;where&nbsp;Type&nbsp;is&nbsp;the&nbsp;receiver&#39;s&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5009860">func</span>&nbsp;<span class="op" id="5009865">(</span><span class="ident" id="5009866">server</span>&nbsp;<span class="op" id="5009873">*</span><span class="ident" id="5009874"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5009880">)</span>&nbsp;<span class="ident" id="5009882">Register</span><span class="op" id="5009890">(</span><span class="ident" id="5009891">rcvr</span>&nbsp;<span class="keyword" id="5009896">interface</span><span class="op" id="5009905">{</span><span class="op" id="5009906">}</span><span class="op" id="5009907">)</span>&nbsp;<span class="builtintype" id="5009909">error</span>&nbsp;<span class="op" id="5009915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009918">return</span>&nbsp;<span class="ident" id="5009925"><a href="/net/rpc/server.go.html#5009866">server</a></span><span class="op" id="5009931">.</span><span class="ident" id="5009932">register</span><span class="op" id="5009940">(</span><span class="ident" id="5009941"><a href="/net/rpc/server.go.html#5009891">rcvr</a></span><span class="op" id="5009945">,</span>&nbsp;<span class="string" id="5009947">&#34;&#34;</span><span class="op" id="5009949">,</span>&nbsp;<span class="ident" id="5009951">false</span><span class="op" id="5009956">)</span><br>
<span class="lineno"></span><span class="op" id="5009958">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="5009961">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5010034">//&nbsp;instead&nbsp;of&nbsp;the&nbsp;receiver&#39;s&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5010078">func</span>&nbsp;<span class="op" id="5010083">(</span><span class="ident" id="5010084">server</span>&nbsp;<span class="op" id="5010091">*</span><span class="ident" id="5010092"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5010098">)</span>&nbsp;<span class="ident" id="5010100">RegisterName</span><span class="op" id="5010112">(</span><span class="ident" id="5010113">name</span>&nbsp;<span class="builtintype" id="5010118">string</span><span class="op" id="5010124">,</span>&nbsp;<span class="ident" id="5010126">rcvr</span>&nbsp;<span class="keyword" id="5010131">interface</span><span class="op" id="5010140">{</span><span class="op" id="5010141">}</span><span class="op" id="5010142">)</span>&nbsp;<span class="builtintype" id="5010144">error</span>&nbsp;<span class="op" id="5010150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010153">return</span>&nbsp;<span class="ident" id="5010160"><a href="/net/rpc/server.go.html#5010084">server</a></span><span class="op" id="5010166">.</span><span class="ident" id="5010167">register</span><span class="op" id="5010175">(</span><span class="ident" id="5010176"><a href="/net/rpc/server.go.html#5010126">rcvr</a></span><span class="op" id="5010180">,</span>&nbsp;<span class="ident" id="5010182"><a href="/net/rpc/server.go.html#5010113">name</a></span><span class="op" id="5010186">,</span>&nbsp;<span class="ident" id="5010188">true</span><span class="op" id="5010192">)</span><br>
<span class="lineno">235</span><span class="op" id="5010194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5010197">func</span>&nbsp;<span class="op" id="5010202">(</span><span class="ident" id="5010203">server</span>&nbsp;<span class="op" id="5010210">*</span><span class="ident" id="5010211"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5010217">)</span>&nbsp;<span class="ident" id="5010219">register</span><span class="op" id="5010227">(</span><span class="ident" id="5010228">rcvr</span>&nbsp;<span class="keyword" id="5010233">interface</span><span class="op" id="5010242">{</span><span class="op" id="5010243">}</span><span class="op" id="5010244">,</span>&nbsp;<span class="ident" id="5010246">name</span>&nbsp;<span class="builtintype" id="5010251">string</span><span class="op" id="5010257">,</span>&nbsp;<span class="ident" id="5010259">useName</span>&nbsp;<span class="builtintype" id="5010267">bool</span><span class="op" id="5010271">)</span>&nbsp;<span class="builtintype" id="5010273">error</span>&nbsp;<span class="op" id="5010279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010282"><a href="/net/rpc/server.go.html#5010203">server</a></span><span class="op" id="5010288">.</span><span class="ident" id="5010289">mu</span><span class="op" id="5010291">.</span><span class="ident" id="5010292">Lock</span><span class="op" id="5010296">(</span><span class="op" id="5010297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010300">defer</span>&nbsp;<span class="ident" id="5010306"><a href="/net/rpc/server.go.html#5010203">server</a></span><span class="op" id="5010312">.</span><span class="ident" id="5010313">mu</span><span class="op" id="5010315">.</span><span class="ident" id="5010316">Unlock</span><span class="op" id="5010322">(</span><span class="op" id="5010323">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010326">if</span>&nbsp;<span class="ident" id="5010329"><a href="/net/rpc/server.go.html#5010203">server</a></span><span class="op" id="5010335">.</span><span class="ident" id="5010336">serviceMap</span>&nbsp;<span class="op" id="5010347">==</span>&nbsp;<span class="ident" id="5010350">nil</span>&nbsp;<span class="op" id="5010354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010358"><a href="/net/rpc/server.go.html#5010203">server</a></span><span class="op" id="5010364">.</span><span class="ident" id="5010365">serviceMap</span>&nbsp;<span class="op" id="5010376">=</span>&nbsp;<span class="builtinfunc" id="5010378">make</span><span class="op" id="5010382">(</span><span class="keyword" id="5010383">map</span><span class="op" id="5010386">[</span><span class="builtintype" id="5010387">string</span><span class="op" id="5010393">]</span><span class="op" id="5010394">*</span><span class="ident" id="5010395"><a href="/net/rpc/server.go.html#5007407">service</a></span><span class="op" id="5010402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010408">s</span>&nbsp;<span class="op" id="5010410">:=</span>&nbsp;<span class="builtinfunc" id="5010413">new</span><span class="op" id="5010416">(</span><span class="ident" id="5010417"><a href="/net/rpc/server.go.html#5007407">service</a></span><span class="op" id="5010424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010427"><a href="/net/rpc/server.go.html#5010408">s</a></span><span class="op" id="5010428">.</span><span class="ident" id="5010429">typ</span>&nbsp;<span class="op" id="5010433">=</span>&nbsp;<span class="ident" id="5010435"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5010442">.</span><span class="ident" id="5010443">TypeOf</span><span class="op" id="5010449">(</span><span class="ident" id="5010450"><a href="/net/rpc/server.go.html#5010228">rcvr</a></span><span class="op" id="5010454">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010457"><a href="/net/rpc/server.go.html#5010408">s</a></span><span class="op" id="5010458">.</span><span class="ident" id="5010459">rcvr</span>&nbsp;<span class="op" id="5010464">=</span>&nbsp;<span class="ident" id="5010466"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5010473">.</span><span class="ident" id="5010474">ValueOf</span><span class="op" id="5010481">(</span><span class="ident" id="5010482"><a href="/net/rpc/server.go.html#5010228">rcvr</a></span><span class="op" id="5010486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010489">sname</span>&nbsp;<span class="op" id="5010495">:=</span>&nbsp;<span class="ident" id="5010498"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5010505">.</span><span class="ident" id="5010506">Indirect</span><span class="op" id="5010514">(</span><span class="ident" id="5010515"><a href="/net/rpc/server.go.html#5010408">s</a></span><span class="op" id="5010516">.</span><span class="ident" id="5010517">rcvr</span><span class="op" id="5010521">)</span><span class="op" id="5010522">.</span><span class="ident" id="5010523">Type</span><span class="op" id="5010527">(</span><span class="op" id="5010528">)</span><span class="op" id="5010529">.</span><span class="ident" id="5010530">Name</span><span class="op" id="5010534">(</span><span class="op" id="5010535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010538">if</span>&nbsp;<span class="ident" id="5010541"><a href="/net/rpc/server.go.html#5010259">useName</a></span>&nbsp;<span class="op" id="5010549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010553"><a href="/net/rpc/server.go.html#5010489">sname</a></span>&nbsp;<span class="op" id="5010559">=</span>&nbsp;<span class="ident" id="5010561"><a href="/net/rpc/server.go.html#5010246">name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010567">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010570">if</span>&nbsp;<span class="ident" id="5010573"><a href="/net/rpc/server.go.html#5010489">sname</a></span>&nbsp;<span class="op" id="5010579">==</span>&nbsp;<span class="string" id="5010582">&#34;&#34;</span>&nbsp;<span class="op" id="5010585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010589">s</span>&nbsp;<span class="op" id="5010591">:=</span>&nbsp;<span class="string" id="5010594">&#34;rpc.Register:&nbsp;no&nbsp;service&nbsp;name&nbsp;for&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5010636">+</span>&nbsp;<span class="ident" id="5010638"><a href="/net/rpc/server.go.html#5010408">s</a></span><span class="op" id="5010639">.</span><span class="ident" id="5010640">typ</span><span class="op" id="5010643">.</span><span class="ident" id="5010644">String</span><span class="op" id="5010650">(</span><span class="op" id="5010651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010655"><a href="/net/rpc/server.go.html#5006862">log</a></span><span class="op" id="5010658">.</span><span class="ident" id="5010659">Print</span><span class="op" id="5010664">(</span><span class="ident" id="5010665"><a href="/net/rpc/server.go.html#5010589">s</a></span><span class="op" id="5010666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010670">return</span>&nbsp;<span class="ident" id="5010677"><a href="/net/rpc/server.go.html#5006846">errors</a></span><span class="op" id="5010683">.</span><span class="ident" id="5010684">New</span><span class="op" id="5010687">(</span><span class="ident" id="5010688"><a href="/net/rpc/server.go.html#5010589">s</a></span><span class="op" id="5010689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010692">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010695">if</span>&nbsp;<span class="op" id="5010698">!</span><span class="ident" id="5010699"><a href="/net/rpc/server.go.html#5008940">isExported</a></span><span class="op" id="5010709">(</span><span class="ident" id="5010710"><a href="/net/rpc/server.go.html#5010489">sname</a></span><span class="op" id="5010715">)</span>&nbsp;<span class="op" id="5010717">&amp;&amp;</span>&nbsp;<span class="op" id="5010720">!</span><span class="ident" id="5010721"><a href="/net/rpc/server.go.html#5010259">useName</a></span>&nbsp;<span class="op" id="5010729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010733">s</span>&nbsp;<span class="op" id="5010735">:=</span>&nbsp;<span class="string" id="5010738">&#34;rpc.Register:&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5010760">+</span>&nbsp;<span class="ident" id="5010762"><a href="/net/rpc/server.go.html#5010489">sname</a></span>&nbsp;<span class="op" id="5010768">+</span>&nbsp;<span class="string" id="5010770">&#34;&nbsp;is&nbsp;not&nbsp;exported&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010791"><a href="/net/rpc/server.go.html#5006862">log</a></span><span class="op" id="5010794">.</span><span class="ident" id="5010795">Print</span><span class="op" id="5010800">(</span><span class="ident" id="5010801"><a href="/net/rpc/server.go.html#5010733">s</a></span><span class="op" id="5010802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010806">return</span>&nbsp;<span class="ident" id="5010813"><a href="/net/rpc/server.go.html#5006846">errors</a></span><span class="op" id="5010819">.</span><span class="ident" id="5010820">New</span><span class="op" id="5010823">(</span><span class="ident" id="5010824"><a href="/net/rpc/server.go.html#5010733">s</a></span><span class="op" id="5010825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010828">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010831">if</span>&nbsp;<span class="ident" id="5010834">_</span><span class="op" id="5010835">,</span>&nbsp;<span class="ident" id="5010837">present</span>&nbsp;<span class="op" id="5010845">:=</span>&nbsp;<span class="ident" id="5010848"><a href="/net/rpc/server.go.html#5010203">server</a></span><span class="op" id="5010854">.</span><span class="ident" id="5010855">serviceMap</span><span class="op" id="5010865">[</span><span class="ident" id="5010866"><a href="/net/rpc/server.go.html#5010489">sname</a></span><span class="op" id="5010871">]</span><span class="op" id="5010872">;</span>&nbsp;<span class="ident" id="5010874"><a href="/net/rpc/server.go.html#5010837">present</a></span>&nbsp;<span class="op" id="5010882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010886">return</span>&nbsp;<span class="ident" id="5010893"><a href="/net/rpc/server.go.html#5006846">errors</a></span><span class="op" id="5010899">.</span><span class="ident" id="5010900">New</span><span class="op" id="5010903">(</span><span class="string" id="5010904">&#34;rpc:&nbsp;service&nbsp;already&nbsp;defined:&nbsp;&#34;</span>&nbsp;<span class="op" id="5010937">+</span>&nbsp;<span class="ident" id="5010939"><a href="/net/rpc/server.go.html#5010489">sname</a></span><span class="op" id="5010944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010950"><a href="/net/rpc/server.go.html#5010408">s</a></span><span class="op" id="5010951">.</span><span class="ident" id="5010952">name</span>&nbsp;<span class="op" id="5010957">=</span>&nbsp;<span class="ident" id="5010959"><a href="/net/rpc/server.go.html#5010489">sname</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5010967">//&nbsp;Install&nbsp;the&nbsp;methods</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010991"><a href="/net/rpc/server.go.html#5010408">s</a></span><span class="op" id="5010992">.</span><span class="ident" id="5010993">method</span>&nbsp;<span class="op" id="5011000">=</span>&nbsp;<span class="ident" id="5011002"><a href="/net/rpc/server.go.html#5011650">suitableMethods</a></span><span class="op" id="5011017">(</span><span class="ident" id="5011018"><a href="/net/rpc/server.go.html#5010408">s</a></span><span class="op" id="5011019">.</span><span class="ident" id="5011020">typ</span><span class="op" id="5011023">,</span>&nbsp;<span class="ident" id="5011025">true</span><span class="op" id="5011029">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011033">if</span>&nbsp;<span class="builtinfunc" id="5011036">len</span><span class="op" id="5011039">(</span><span class="ident" id="5011040"><a href="/net/rpc/server.go.html#5010408">s</a></span><span class="op" id="5011041">.</span><span class="ident" id="5011042">method</span><span class="op" id="5011048">)</span>&nbsp;<span class="op" id="5011050">==</span>&nbsp;<span class="num" id="5011053">0</span>&nbsp;<span class="op" id="5011055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011059">str</span>&nbsp;<span class="op" id="5011063">:=</span>&nbsp;<span class="string" id="5011066">&#34;&#34;</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011072">//&nbsp;To&nbsp;help&nbsp;the&nbsp;user,&nbsp;see&nbsp;if&nbsp;a&nbsp;pointer&nbsp;receiver&nbsp;would&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011133">method</span>&nbsp;<span class="op" id="5011140">:=</span>&nbsp;<span class="ident" id="5011143"><a href="/net/rpc/server.go.html#5011650">suitableMethods</a></span><span class="op" id="5011158">(</span><span class="ident" id="5011159"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5011166">.</span><span class="ident" id="5011167">PtrTo</span><span class="op" id="5011172">(</span><span class="ident" id="5011173"><a href="/net/rpc/server.go.html#5010408">s</a></span><span class="op" id="5011174">.</span><span class="ident" id="5011175">typ</span><span class="op" id="5011178">)</span><span class="op" id="5011179">,</span>&nbsp;<span class="ident" id="5011181">false</span><span class="op" id="5011186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011190">if</span>&nbsp;<span class="builtinfunc" id="5011193">len</span><span class="op" id="5011196">(</span><span class="ident" id="5011197"><a href="/net/rpc/server.go.html#5011133">method</a></span><span class="op" id="5011203">)</span>&nbsp;<span class="op" id="5011205">!=</span>&nbsp;<span class="num" id="5011208">0</span>&nbsp;<span class="op" id="5011210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011215"><a href="/net/rpc/server.go.html#5011059">str</a></span>&nbsp;<span class="op" id="5011219">=</span>&nbsp;<span class="string" id="5011221">&#34;rpc.Register:&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5011243">+</span>&nbsp;<span class="ident" id="5011245"><a href="/net/rpc/server.go.html#5010489">sname</a></span>&nbsp;<span class="op" id="5011251">+</span>&nbsp;<span class="string" id="5011253">&#34;&nbsp;has&nbsp;no&nbsp;exported&nbsp;methods&nbsp;of&nbsp;suitable&nbsp;type&nbsp;(hint:&nbsp;pass&nbsp;a&nbsp;pointer&nbsp;to&nbsp;value&nbsp;of&nbsp;that&nbsp;type)&#34;</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011344">}</span>&nbsp;<span class="keyword" id="5011346">else</span>&nbsp;<span class="op" id="5011351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011356"><a href="/net/rpc/server.go.html#5011059">str</a></span>&nbsp;<span class="op" id="5011360">=</span>&nbsp;<span class="string" id="5011362">&#34;rpc.Register:&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5011384">+</span>&nbsp;<span class="ident" id="5011386"><a href="/net/rpc/server.go.html#5010489">sname</a></span>&nbsp;<span class="op" id="5011392">+</span>&nbsp;<span class="string" id="5011394">&#34;&nbsp;has&nbsp;no&nbsp;exported&nbsp;methods&nbsp;of&nbsp;suitable&nbsp;type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011444"><a href="/net/rpc/server.go.html#5006862">log</a></span><span class="op" id="5011447">.</span><span class="ident" id="5011448">Print</span><span class="op" id="5011453">(</span><span class="ident" id="5011454"><a href="/net/rpc/server.go.html#5011059">str</a></span><span class="op" id="5011457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011461">return</span>&nbsp;<span class="ident" id="5011468"><a href="/net/rpc/server.go.html#5006846">errors</a></span><span class="op" id="5011474">.</span><span class="ident" id="5011475">New</span><span class="op" id="5011478">(</span><span class="ident" id="5011479"><a href="/net/rpc/server.go.html#5011059">str</a></span><span class="op" id="5011482">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011488"><a href="/net/rpc/server.go.html#5010203">server</a></span><span class="op" id="5011494">.</span><span class="ident" id="5011495">serviceMap</span><span class="op" id="5011505">[</span><span class="ident" id="5011506"><a href="/net/rpc/server.go.html#5010408">s</a></span><span class="op" id="5011507">.</span><span class="ident" id="5011508">name</span><span class="op" id="5011512">]</span>&nbsp;<span class="op" id="5011514">=</span>&nbsp;<span class="ident" id="5011516"><a href="/net/rpc/server.go.html#5010408">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011519">return</span>&nbsp;<span class="ident" id="5011526">nil</span><br>
<span class="lineno"></span><span class="op" id="5011530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="5011533">//&nbsp;suitableMethods&nbsp;returns&nbsp;suitable&nbsp;Rpc&nbsp;methods&nbsp;of&nbsp;typ,&nbsp;it&nbsp;will&nbsp;report</span><br>
<span class="lineno"></span><span class="comment" id="5011604">//&nbsp;error&nbsp;using&nbsp;log&nbsp;if&nbsp;reportErr&nbsp;is&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5011645">func</span>&nbsp;<span class="ident" id="5011650">suitableMethods</span><span class="op" id="5011665">(</span><span class="ident" id="5011666">typ</span>&nbsp;<span class="ident" id="5011670"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5011677">.</span><span class="ident" id="5011678">Type</span><span class="op" id="5011682">,</span>&nbsp;<span class="ident" id="5011684">reportErr</span>&nbsp;<span class="builtintype" id="5011694">bool</span><span class="op" id="5011698">)</span>&nbsp;<span class="keyword" id="5011700">map</span><span class="op" id="5011703">[</span><span class="builtintype" id="5011704">string</span><span class="op" id="5011710">]</span><span class="op" id="5011711">*</span><span class="ident" id="5011712"><a href="/net/rpc/server.go.html#5007252">methodType</a></span>&nbsp;<span class="op" id="5011723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011726">methods</span>&nbsp;<span class="op" id="5011734">:=</span>&nbsp;<span class="builtinfunc" id="5011737">make</span><span class="op" id="5011741">(</span><span class="keyword" id="5011742">map</span><span class="op" id="5011745">[</span><span class="builtintype" id="5011746">string</span><span class="op" id="5011752">]</span><span class="op" id="5011753">*</span><span class="ident" id="5011754"><a href="/net/rpc/server.go.html#5007252">methodType</a></span><span class="op" id="5011764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011767">for</span>&nbsp;<span class="ident" id="5011771">m</span>&nbsp;<span class="op" id="5011773">:=</span>&nbsp;<span class="num" id="5011776">0</span><span class="op" id="5011777">;</span>&nbsp;<span class="ident" id="5011779"><a href="/net/rpc/server.go.html#5011771">m</a></span>&nbsp;<span class="op" id="5011781">&lt;</span>&nbsp;<span class="ident" id="5011783"><a href="/net/rpc/server.go.html#5011666">typ</a></span><span class="op" id="5011786">.</span><span class="ident" id="5011787">NumMethod</span><span class="op" id="5011796">(</span><span class="op" id="5011797">)</span><span class="op" id="5011798">;</span>&nbsp;<span class="ident" id="5011800"><a href="/net/rpc/server.go.html#5011771">m</a></span><span class="op" id="5011801">++</span>&nbsp;<span class="op" id="5011804">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011808">method</span>&nbsp;<span class="op" id="5011815">:=</span>&nbsp;<span class="ident" id="5011818"><a href="/net/rpc/server.go.html#5011666">typ</a></span><span class="op" id="5011821">.</span><span class="ident" id="5011822">Method</span><span class="op" id="5011828">(</span><span class="ident" id="5011829"><a href="/net/rpc/server.go.html#5011771">m</a></span><span class="op" id="5011830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011834">mtype</span>&nbsp;<span class="op" id="5011840">:=</span>&nbsp;<span class="ident" id="5011843"><a href="/net/rpc/server.go.html#5011808">method</a></span><span class="op" id="5011849">.</span><span class="ident" id="5011850">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011857">mname</span>&nbsp;<span class="op" id="5011863">:=</span>&nbsp;<span class="ident" id="5011866"><a href="/net/rpc/server.go.html#5011808">method</a></span><span class="op" id="5011872">.</span><span class="ident" id="5011873">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011880">//&nbsp;Method&nbsp;must&nbsp;be&nbsp;exported.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011910">if</span>&nbsp;<span class="ident" id="5011913"><a href="/net/rpc/server.go.html#5011808">method</a></span><span class="op" id="5011919">.</span><span class="ident" id="5011920">PkgPath</span>&nbsp;<span class="op" id="5011928">!=</span>&nbsp;<span class="string" id="5011931">&#34;&#34;</span>&nbsp;<span class="op" id="5011934">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011939">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011954">//&nbsp;Method&nbsp;needs&nbsp;three&nbsp;ins:&nbsp;receiver,&nbsp;*args,&nbsp;*reply.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012008">if</span>&nbsp;<span class="ident" id="5012011"><a href="/net/rpc/server.go.html#5011834">mtype</a></span><span class="op" id="5012016">.</span><span class="ident" id="5012017">NumIn</span><span class="op" id="5012022">(</span><span class="op" id="5012023">)</span>&nbsp;<span class="op" id="5012025">!=</span>&nbsp;<span class="num" id="5012028">3</span>&nbsp;<span class="op" id="5012030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012035">if</span>&nbsp;<span class="ident" id="5012038"><a href="/net/rpc/server.go.html#5011684">reportErr</a></span>&nbsp;<span class="op" id="5012048">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012054"><a href="/net/rpc/server.go.html#5006862">log</a></span><span class="op" id="5012057">.</span><span class="ident" id="5012058">Println</span><span class="op" id="5012065">(</span><span class="string" id="5012066">&#34;method&#34;</span><span class="op" id="5012074">,</span>&nbsp;<span class="ident" id="5012076"><a href="/net/rpc/server.go.html#5011857">mname</a></span><span class="op" id="5012081">,</span>&nbsp;<span class="string" id="5012083">&#34;has&nbsp;wrong&nbsp;number&nbsp;of&nbsp;ins:&#34;</span><span class="op" id="5012109">,</span>&nbsp;<span class="ident" id="5012111"><a href="/net/rpc/server.go.html#5011834">mtype</a></span><span class="op" id="5012116">.</span><span class="ident" id="5012117">NumIn</span><span class="op" id="5012122">(</span><span class="op" id="5012123">)</span><span class="op" id="5012124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012134">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5012149">//&nbsp;First&nbsp;arg&nbsp;need&nbsp;not&nbsp;be&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012187">argType</span>&nbsp;<span class="op" id="5012195">:=</span>&nbsp;<span class="ident" id="5012198"><a href="/net/rpc/server.go.html#5011834">mtype</a></span><span class="op" id="5012203">.</span><span class="ident" id="5012204">In</span><span class="op" id="5012206">(</span><span class="num" id="5012207">1</span><span class="op" id="5012208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012212">if</span>&nbsp;<span class="op" id="5012215">!</span><span class="ident" id="5012216"><a href="/net/rpc/server.go.html#5009090">isExportedOrBuiltinType</a></span><span class="op" id="5012239">(</span><span class="ident" id="5012240"><a href="/net/rpc/server.go.html#5012187">argType</a></span><span class="op" id="5012247">)</span>&nbsp;<span class="op" id="5012249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012254">if</span>&nbsp;<span class="ident" id="5012257"><a href="/net/rpc/server.go.html#5011684">reportErr</a></span>&nbsp;<span class="op" id="5012267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012273"><a href="/net/rpc/server.go.html#5006862">log</a></span><span class="op" id="5012276">.</span><span class="ident" id="5012277">Println</span><span class="op" id="5012284">(</span><span class="ident" id="5012285"><a href="/net/rpc/server.go.html#5011857">mname</a></span><span class="op" id="5012290">,</span>&nbsp;<span class="string" id="5012292">&#34;argument&nbsp;type&nbsp;not&nbsp;exported:&#34;</span><span class="op" id="5012321">,</span>&nbsp;<span class="ident" id="5012323"><a href="/net/rpc/server.go.html#5012187">argType</a></span><span class="op" id="5012330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012335">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012340">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5012355">//&nbsp;Second&nbsp;arg&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012390">replyType</span>&nbsp;<span class="op" id="5012400">:=</span>&nbsp;<span class="ident" id="5012403"><a href="/net/rpc/server.go.html#5011834">mtype</a></span><span class="op" id="5012408">.</span><span class="ident" id="5012409">In</span><span class="op" id="5012411">(</span><span class="num" id="5012412">2</span><span class="op" id="5012413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012417">if</span>&nbsp;<span class="ident" id="5012420"><a href="/net/rpc/server.go.html#5012390">replyType</a></span><span class="op" id="5012429">.</span><span class="ident" id="5012430">Kind</span><span class="op" id="5012434">(</span><span class="op" id="5012435">)</span>&nbsp;<span class="op" id="5012437">!=</span>&nbsp;<span class="ident" id="5012440"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5012447">.</span><span class="ident" id="5012448">Ptr</span>&nbsp;<span class="op" id="5012452">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012457">if</span>&nbsp;<span class="ident" id="5012460"><a href="/net/rpc/server.go.html#5011684">reportErr</a></span>&nbsp;<span class="op" id="5012470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012476"><a href="/net/rpc/server.go.html#5006862">log</a></span><span class="op" id="5012479">.</span><span class="ident" id="5012480">Println</span><span class="op" id="5012487">(</span><span class="string" id="5012488">&#34;method&#34;</span><span class="op" id="5012496">,</span>&nbsp;<span class="ident" id="5012498"><a href="/net/rpc/server.go.html#5011857">mname</a></span><span class="op" id="5012503">,</span>&nbsp;<span class="string" id="5012505">&#34;reply&nbsp;type&nbsp;not&nbsp;a&nbsp;pointer:&#34;</span><span class="op" id="5012532">,</span>&nbsp;<span class="ident" id="5012534"><a href="/net/rpc/server.go.html#5012390">replyType</a></span><span class="op" id="5012543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012553">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012564">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5012568">//&nbsp;Reply&nbsp;type&nbsp;must&nbsp;be&nbsp;exported.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012602">if</span>&nbsp;<span class="op" id="5012605">!</span><span class="ident" id="5012606"><a href="/net/rpc/server.go.html#5009090">isExportedOrBuiltinType</a></span><span class="op" id="5012629">(</span><span class="ident" id="5012630"><a href="/net/rpc/server.go.html#5012390">replyType</a></span><span class="op" id="5012639">)</span>&nbsp;<span class="op" id="5012641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012646">if</span>&nbsp;<span class="ident" id="5012649"><a href="/net/rpc/server.go.html#5011684">reportErr</a></span>&nbsp;<span class="op" id="5012659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012665"><a href="/net/rpc/server.go.html#5006862">log</a></span><span class="op" id="5012668">.</span><span class="ident" id="5012669">Println</span><span class="op" id="5012676">(</span><span class="string" id="5012677">&#34;method&#34;</span><span class="op" id="5012685">,</span>&nbsp;<span class="ident" id="5012687"><a href="/net/rpc/server.go.html#5011857">mname</a></span><span class="op" id="5012692">,</span>&nbsp;<span class="string" id="5012694">&#34;reply&nbsp;type&nbsp;not&nbsp;exported:&#34;</span><span class="op" id="5012720">,</span>&nbsp;<span class="ident" id="5012722"><a href="/net/rpc/server.go.html#5012390">replyType</a></span><span class="op" id="5012731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012736">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012741">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5012756">//&nbsp;Method&nbsp;needs&nbsp;one&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012783">if</span>&nbsp;<span class="ident" id="5012786"><a href="/net/rpc/server.go.html#5011834">mtype</a></span><span class="op" id="5012791">.</span><span class="ident" id="5012792">NumOut</span><span class="op" id="5012798">(</span><span class="op" id="5012799">)</span>&nbsp;<span class="op" id="5012801">!=</span>&nbsp;<span class="num" id="5012804">1</span>&nbsp;<span class="op" id="5012806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012811">if</span>&nbsp;<span class="ident" id="5012814"><a href="/net/rpc/server.go.html#5011684">reportErr</a></span>&nbsp;<span class="op" id="5012824">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012830"><a href="/net/rpc/server.go.html#5006862">log</a></span><span class="op" id="5012833">.</span><span class="ident" id="5012834">Println</span><span class="op" id="5012841">(</span><span class="string" id="5012842">&#34;method&#34;</span><span class="op" id="5012850">,</span>&nbsp;<span class="ident" id="5012852"><a href="/net/rpc/server.go.html#5011857">mname</a></span><span class="op" id="5012857">,</span>&nbsp;<span class="string" id="5012859">&#34;has&nbsp;wrong&nbsp;number&nbsp;of&nbsp;outs:&#34;</span><span class="op" id="5012886">,</span>&nbsp;<span class="ident" id="5012888"><a href="/net/rpc/server.go.html#5011834">mtype</a></span><span class="op" id="5012893">.</span><span class="ident" id="5012894">NumOut</span><span class="op" id="5012900">(</span><span class="op" id="5012901">)</span><span class="op" id="5012902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012912">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5012927">//&nbsp;The&nbsp;return&nbsp;type&nbsp;of&nbsp;the&nbsp;method&nbsp;must&nbsp;be&nbsp;error.</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012977">if</span>&nbsp;<span class="ident" id="5012980">returnType</span>&nbsp;<span class="op" id="5012991">:=</span>&nbsp;<span class="ident" id="5012994"><a href="/net/rpc/server.go.html#5011834">mtype</a></span><span class="op" id="5012999">.</span><span class="ident" id="5013000">Out</span><span class="op" id="5013003">(</span><span class="num" id="5013004">0</span><span class="op" id="5013005">)</span><span class="op" id="5013006">;</span>&nbsp;<span class="ident" id="5013008"><a href="/net/rpc/server.go.html#5012980">returnType</a></span>&nbsp;<span class="op" id="5013019">!=</span>&nbsp;<span class="ident" id="5013022"><a href="/net/rpc/server.go.html#5007195">typeOfError</a></span>&nbsp;<span class="op" id="5013034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013039">if</span>&nbsp;<span class="ident" id="5013042"><a href="/net/rpc/server.go.html#5011684">reportErr</a></span>&nbsp;<span class="op" id="5013052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013058"><a href="/net/rpc/server.go.html#5006862">log</a></span><span class="op" id="5013061">.</span><span class="ident" id="5013062">Println</span><span class="op" id="5013069">(</span><span class="string" id="5013070">&#34;method&#34;</span><span class="op" id="5013078">,</span>&nbsp;<span class="ident" id="5013080"><a href="/net/rpc/server.go.html#5011857">mname</a></span><span class="op" id="5013085">,</span>&nbsp;<span class="string" id="5013087">&#34;returns&#34;</span><span class="op" id="5013096">,</span>&nbsp;<span class="ident" id="5013098"><a href="/net/rpc/server.go.html#5012980">returnType</a></span><span class="op" id="5013108">.</span><span class="ident" id="5013109">String</span><span class="op" id="5013115">(</span><span class="op" id="5013116">)</span><span class="op" id="5013117">,</span>&nbsp;<span class="string" id="5013119">&#34;not&nbsp;error&#34;</span><span class="op" id="5013130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013140">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013155"><a href="/net/rpc/server.go.html#5011726">methods</a></span><span class="op" id="5013162">[</span><span class="ident" id="5013163"><a href="/net/rpc/server.go.html#5011857">mname</a></span><span class="op" id="5013168">]</span>&nbsp;<span class="op" id="5013170">=</span>&nbsp;<span class="op" id="5013172">&amp;</span><span class="ident" id="5013173"><a href="/net/rpc/server.go.html#5007252">methodType</a></span><span class="op" id="5013183">{</span><span class="ident" id="5013184">method</span><span class="op" id="5013190">:</span>&nbsp;<span class="ident" id="5013192"><a href="/net/rpc/server.go.html#5011808">method</a></span><span class="op" id="5013198">,</span>&nbsp;<span class="ident" id="5013200">ArgType</span><span class="op" id="5013207">:</span>&nbsp;<span class="ident" id="5013209"><a href="/net/rpc/server.go.html#5012187">argType</a></span><span class="op" id="5013216">,</span>&nbsp;<span class="ident" id="5013218">ReplyType</span><span class="op" id="5013227">:</span>&nbsp;<span class="ident" id="5013229"><a href="/net/rpc/server.go.html#5012390">replyType</a></span><span class="op" id="5013238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013244">return</span>&nbsp;<span class="ident" id="5013251"><a href="/net/rpc/server.go.html#5011726">methods</a></span><br>
<span class="lineno"></span><span class="op" id="5013259">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="comment" id="5013262">//&nbsp;A&nbsp;value&nbsp;sent&nbsp;as&nbsp;a&nbsp;placeholder&nbsp;for&nbsp;the&nbsp;server&#39;s&nbsp;response&nbsp;value&nbsp;when&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="5013343">//&nbsp;receives&nbsp;an&nbsp;invalid&nbsp;request.&nbsp;It&nbsp;is&nbsp;never&nbsp;decoded&nbsp;by&nbsp;the&nbsp;client&nbsp;since&nbsp;the&nbsp;Response</span><br>
<span class="lineno"></span><span class="comment" id="5013428">//&nbsp;contains&nbsp;an&nbsp;error&nbsp;when&nbsp;it&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="5013466">var</span>&nbsp;<span class="ident" id="5013470">invalidRequest</span>&nbsp;<span class="op" id="5013485">=</span>&nbsp;<span class="keyword" id="5013487">struct</span><span class="op" id="5013493">{</span><span class="op" id="5013494">}</span><span class="op" id="5013495">{</span><span class="op" id="5013496">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span><span class="keyword" id="5013499">func</span>&nbsp;<span class="op" id="5013504">(</span><span class="ident" id="5013505">server</span>&nbsp;<span class="op" id="5013512">*</span><span class="ident" id="5013513"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5013519">)</span>&nbsp;<span class="ident" id="5013521">sendResponse</span><span class="op" id="5013533">(</span><span class="ident" id="5013534">sending</span>&nbsp;<span class="op" id="5013542">*</span><span class="ident" id="5013543"><a href="/net/rpc/server.go.html#5006910">sync</a></span><span class="op" id="5013547">.</span><span class="ident" id="5013548">Mutex</span><span class="op" id="5013553">,</span>&nbsp;<span class="ident" id="5013555">req</span>&nbsp;<span class="op" id="5013559">*</span><span class="ident" id="5013560"><a href="/net/rpc/server.go.html#5007827">Request</a></span><span class="op" id="5013567">,</span>&nbsp;<span class="ident" id="5013569">reply</span>&nbsp;<span class="keyword" id="5013575">interface</span><span class="op" id="5013584">{</span><span class="op" id="5013585">}</span><span class="op" id="5013586">,</span>&nbsp;<span class="ident" id="5013588">codec</span>&nbsp;<span class="ident" id="5013594"><a href="/net/rpc/server.go.html#5021745">ServerCodec</a></span><span class="op" id="5013605">,</span>&nbsp;<span class="ident" id="5013607">errmsg</span>&nbsp;<span class="builtintype" id="5013614">string</span><span class="op" id="5013620">)</span>&nbsp;<span class="op" id="5013622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013625">resp</span>&nbsp;<span class="op" id="5013630">:=</span>&nbsp;<span class="ident" id="5013633"><a href="/net/rpc/server.go.html#5013505">server</a></span><span class="op" id="5013639">.</span><span class="ident" id="5013640">getResponse</span><span class="op" id="5013651">(</span><span class="op" id="5013652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5013655">//&nbsp;Encode&nbsp;the&nbsp;response&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013686"><a href="/net/rpc/server.go.html#5013625">resp</a></span><span class="op" id="5013690">.</span><span class="ident" id="5013691">ServiceMethod</span>&nbsp;<span class="op" id="5013705">=</span>&nbsp;<span class="ident" id="5013707"><a href="/net/rpc/server.go.html#5013555">req</a></span><span class="op" id="5013710">.</span><span class="ident" id="5013711">ServiceMethod</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013726">if</span>&nbsp;<span class="ident" id="5013729"><a href="/net/rpc/server.go.html#5013607">errmsg</a></span>&nbsp;<span class="op" id="5013736">!=</span>&nbsp;<span class="string" id="5013739">&#34;&#34;</span>&nbsp;<span class="op" id="5013742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013746"><a href="/net/rpc/server.go.html#5013625">resp</a></span><span class="op" id="5013750">.</span><span class="ident" id="5013751">Error</span>&nbsp;<span class="op" id="5013757">=</span>&nbsp;<span class="ident" id="5013759"><a href="/net/rpc/server.go.html#5013607">errmsg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013768"><a href="/net/rpc/server.go.html#5013569">reply</a></span>&nbsp;<span class="op" id="5013774">=</span>&nbsp;<span class="ident" id="5013776"><a href="/net/rpc/server.go.html#5013470">invalidRequest</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013795"><a href="/net/rpc/server.go.html#5013625">resp</a></span><span class="op" id="5013799">.</span><span class="ident" id="5013800">Seq</span>&nbsp;<span class="op" id="5013804">=</span>&nbsp;<span class="ident" id="5013806"><a href="/net/rpc/server.go.html#5013555">req</a></span><span class="op" id="5013809">.</span><span class="ident" id="5013810">Seq</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013815"><a href="/net/rpc/server.go.html#5013534">sending</a></span><span class="op" id="5013822">.</span><span class="ident" id="5013823">Lock</span><span class="op" id="5013827">(</span><span class="op" id="5013828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013831">err</span>&nbsp;<span class="op" id="5013835">:=</span>&nbsp;<span class="ident" id="5013838"><a href="/net/rpc/server.go.html#5013588">codec</a></span><span class="op" id="5013843">.</span><span class="ident" id="5013844">WriteResponse</span><span class="op" id="5013857">(</span><span class="ident" id="5013858"><a href="/net/rpc/server.go.html#5013625">resp</a></span><span class="op" id="5013862">,</span>&nbsp;<span class="ident" id="5013864"><a href="/net/rpc/server.go.html#5013569">reply</a></span><span class="op" id="5013869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013872">if</span>&nbsp;<span class="ident" id="5013875"><a href="/net/rpc/debug.go.html#5001451">debugLog</a></span>&nbsp;<span class="op" id="5013884">&amp;&amp;</span>&nbsp;<span class="ident" id="5013887"><a href="/net/rpc/server.go.html#5013831">err</a></span>&nbsp;<span class="op" id="5013891">!=</span>&nbsp;<span class="ident" id="5013894">nil</span>&nbsp;<span class="op" id="5013898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013902"><a href="/net/rpc/server.go.html#5006862">log</a></span><span class="op" id="5013905">.</span><span class="ident" id="5013906">Println</span><span class="op" id="5013913">(</span><span class="string" id="5013914">&#34;rpc:&nbsp;writing&nbsp;response:&#34;</span><span class="op" id="5013938">,</span>&nbsp;<span class="ident" id="5013940"><a href="/net/rpc/server.go.html#5013831">err</a></span><span class="op" id="5013943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013946">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013949"><a href="/net/rpc/server.go.html#5013534">sending</a></span><span class="op" id="5013956">.</span><span class="ident" id="5013957">Unlock</span><span class="op" id="5013963">(</span><span class="op" id="5013964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013967"><a href="/net/rpc/server.go.html#5013505">server</a></span><span class="op" id="5013973">.</span><span class="ident" id="5013974">freeResponse</span><span class="op" id="5013986">(</span><span class="ident" id="5013987"><a href="/net/rpc/server.go.html#5013625">resp</a></span><span class="op" id="5013991">)</span><br>
<span class="lineno"></span><span class="op" id="5013993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5013996">func</span>&nbsp;<span class="op" id="5014001">(</span><span class="ident" id="5014002">m</span>&nbsp;<span class="op" id="5014004">*</span><span class="ident" id="5014005"><a href="/net/rpc/server.go.html#5007252">methodType</a></span><span class="op" id="5014015">)</span>&nbsp;<span class="ident" id="5014017">NumCalls</span><span class="op" id="5014025">(</span><span class="op" id="5014026">)</span>&nbsp;<span class="op" id="5014028">(</span><span class="ident" id="5014029">n</span>&nbsp;<span class="builtintype" id="5014031">uint</span><span class="op" id="5014035">)</span>&nbsp;<span class="op" id="5014037">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014040"><a href="/net/rpc/server.go.html#5014002">m</a></span><span class="op" id="5014041">.</span><span class="ident" id="5014042">Lock</span><span class="op" id="5014046">(</span><span class="op" id="5014047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014050"><a href="/net/rpc/server.go.html#5014029">n</a></span>&nbsp;<span class="op" id="5014052">=</span>&nbsp;<span class="ident" id="5014054"><a href="/net/rpc/server.go.html#5014002">m</a></span><span class="op" id="5014055">.</span><span class="ident" id="5014056">numCalls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014066"><a href="/net/rpc/server.go.html#5014002">m</a></span><span class="op" id="5014067">.</span><span class="ident" id="5014068">Unlock</span><span class="op" id="5014074">(</span><span class="op" id="5014075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014078">return</span>&nbsp;<span class="ident" id="5014085"><a href="/net/rpc/server.go.html#5014029">n</a></span><br>
<span class="lineno"></span><span class="op" id="5014087">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="5014090">func</span>&nbsp;<span class="op" id="5014095">(</span><span class="ident" id="5014096">s</span>&nbsp;<span class="op" id="5014098">*</span><span class="ident" id="5014099"><a href="/net/rpc/server.go.html#5007407">service</a></span><span class="op" id="5014106">)</span>&nbsp;<span class="ident" id="5014108">call</span><span class="op" id="5014112">(</span><span class="ident" id="5014113">server</span>&nbsp;<span class="op" id="5014120">*</span><span class="ident" id="5014121"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5014127">,</span>&nbsp;<span class="ident" id="5014129">sending</span>&nbsp;<span class="op" id="5014137">*</span><span class="ident" id="5014138"><a href="/net/rpc/server.go.html#5006910">sync</a></span><span class="op" id="5014142">.</span><span class="ident" id="5014143">Mutex</span><span class="op" id="5014148">,</span>&nbsp;<span class="ident" id="5014150">mtype</span>&nbsp;<span class="op" id="5014156">*</span><span class="ident" id="5014157"><a href="/net/rpc/server.go.html#5007252">methodType</a></span><span class="op" id="5014167">,</span>&nbsp;<span class="ident" id="5014169">req</span>&nbsp;<span class="op" id="5014173">*</span><span class="ident" id="5014174"><a href="/net/rpc/server.go.html#5007827">Request</a></span><span class="op" id="5014181">,</span>&nbsp;<span class="ident" id="5014183">argv</span><span class="op" id="5014187">,</span>&nbsp;<span class="ident" id="5014189">replyv</span>&nbsp;<span class="ident" id="5014196"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5014203">.</span><span class="ident" id="5014204">Value</span><span class="op" id="5014209">,</span>&nbsp;<span class="ident" id="5014211">codec</span>&nbsp;<span class="ident" id="5014217"><a href="/net/rpc/server.go.html#5021745">ServerCodec</a></span><span class="op" id="5014228">)</span>&nbsp;<span class="op" id="5014230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014233"><a href="/net/rpc/server.go.html#5014150">mtype</a></span><span class="op" id="5014238">.</span><span class="ident" id="5014239">Lock</span><span class="op" id="5014243">(</span><span class="op" id="5014244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014247"><a href="/net/rpc/server.go.html#5014150">mtype</a></span><span class="op" id="5014252">.</span><span class="ident" id="5014253">numCalls</span><span class="op" id="5014261">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014265"><a href="/net/rpc/server.go.html#5014150">mtype</a></span><span class="op" id="5014270">.</span><span class="ident" id="5014271">Unlock</span><span class="op" id="5014277">(</span><span class="op" id="5014278">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014281">function</span>&nbsp;<span class="op" id="5014290">:=</span>&nbsp;<span class="ident" id="5014293"><a href="/net/rpc/server.go.html#5014150">mtype</a></span><span class="op" id="5014298">.</span><span class="ident" id="5014299">method</span><span class="op" id="5014305">.</span><span class="ident" id="5014306">Func</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014312">//&nbsp;Invoke&nbsp;the&nbsp;method,&nbsp;providing&nbsp;a&nbsp;new&nbsp;value&nbsp;for&nbsp;the&nbsp;reply.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014372">returnValues</span>&nbsp;<span class="op" id="5014385">:=</span>&nbsp;<span class="ident" id="5014388"><a href="/net/rpc/server.go.html#5014281">function</a></span><span class="op" id="5014396">.</span><span class="ident" id="5014397">Call</span><span class="op" id="5014401">(</span><span class="op" id="5014402">[</span><span class="op" id="5014403">]</span><span class="ident" id="5014404"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5014411">.</span><span class="ident" id="5014412">Value</span><span class="op" id="5014417">{</span><span class="ident" id="5014418"><a href="/net/rpc/server.go.html#5014096">s</a></span><span class="op" id="5014419">.</span><span class="ident" id="5014420">rcvr</span><span class="op" id="5014424">,</span>&nbsp;<span class="ident" id="5014426"><a href="/net/rpc/server.go.html#5014183">argv</a></span><span class="op" id="5014430">,</span>&nbsp;<span class="ident" id="5014432"><a href="/net/rpc/server.go.html#5014189">replyv</a></span><span class="op" id="5014438">}</span><span class="op" id="5014439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014442">//&nbsp;The&nbsp;return&nbsp;value&nbsp;for&nbsp;the&nbsp;method&nbsp;is&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014491">errInter</span>&nbsp;<span class="op" id="5014500">:=</span>&nbsp;<span class="ident" id="5014503"><a href="/net/rpc/server.go.html#5014372">returnValues</a></span><span class="op" id="5014515">[</span><span class="num" id="5014516">0</span><span class="op" id="5014517">]</span><span class="op" id="5014518">.</span><span class="ident" id="5014519">Interface</span><span class="op" id="5014528">(</span><span class="op" id="5014529">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014532">errmsg</span>&nbsp;<span class="op" id="5014539">:=</span>&nbsp;<span class="string" id="5014542">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014546">if</span>&nbsp;<span class="ident" id="5014549"><a href="/net/rpc/server.go.html#5014491">errInter</a></span>&nbsp;<span class="op" id="5014558">!=</span>&nbsp;<span class="ident" id="5014561">nil</span>&nbsp;<span class="op" id="5014565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014569"><a href="/net/rpc/server.go.html#5014532">errmsg</a></span>&nbsp;<span class="op" id="5014576">=</span>&nbsp;<span class="ident" id="5014578"><a href="/net/rpc/server.go.html#5014491">errInter</a></span><span class="op" id="5014586">.</span><span class="op" id="5014587">(</span><span class="builtintype" id="5014588">error</span><span class="op" id="5014593">)</span><span class="op" id="5014594">.</span><span class="ident" id="5014595">Error</span><span class="op" id="5014600">(</span><span class="op" id="5014601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014607"><a href="/net/rpc/server.go.html#5014113">server</a></span><span class="op" id="5014613">.</span><span class="ident" id="5014614">sendResponse</span><span class="op" id="5014626">(</span><span class="ident" id="5014627"><a href="/net/rpc/server.go.html#5014129">sending</a></span><span class="op" id="5014634">,</span>&nbsp;<span class="ident" id="5014636"><a href="/net/rpc/server.go.html#5014169">req</a></span><span class="op" id="5014639">,</span>&nbsp;<span class="ident" id="5014641"><a href="/net/rpc/server.go.html#5014189">replyv</a></span><span class="op" id="5014647">.</span><span class="ident" id="5014648">Interface</span><span class="op" id="5014657">(</span><span class="op" id="5014658">)</span><span class="op" id="5014659">,</span>&nbsp;<span class="ident" id="5014661"><a href="/net/rpc/server.go.html#5014211">codec</a></span><span class="op" id="5014666">,</span>&nbsp;<span class="ident" id="5014668"><a href="/net/rpc/server.go.html#5014532">errmsg</a></span><span class="op" id="5014674">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014677"><a href="/net/rpc/server.go.html#5014113">server</a></span><span class="op" id="5014683">.</span><span class="ident" id="5014684">freeRequest</span><span class="op" id="5014695">(</span><span class="ident" id="5014696"><a href="/net/rpc/server.go.html#5014169">req</a></span><span class="op" id="5014699">)</span><br>
<span class="lineno"></span><span class="op" id="5014701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5014704">type</span>&nbsp;<span class="ident" id="5014709">gobServerCodec</span>&nbsp;<span class="keyword" id="5014724">struct</span>&nbsp;<span class="op" id="5014731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014734">rwc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014741"><a href="/net/rpc/server.go.html#5006856">io</a></span><span class="op" id="5014743">.</span><span class="ident" id="5014744">ReadWriteCloser</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014761">dec</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5014768">*</span><span class="ident" id="5014769"><a href="/net/rpc/server.go.html#5006830">gob</a></span><span class="op" id="5014772">.</span><span class="ident" id="5014773">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014782">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5014789">*</span><span class="ident" id="5014790"><a href="/net/rpc/server.go.html#5006830">gob</a></span><span class="op" id="5014793">.</span><span class="ident" id="5014794">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014803">encBuf</span>&nbsp;<span class="op" id="5014810">*</span><span class="ident" id="5014811"><a href="/net/rpc/server.go.html#5006821">bufio</a></span><span class="op" id="5014816">.</span><span class="ident" id="5014817">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014825">closed</span>&nbsp;<span class="builtintype" id="5014832">bool</span><br>
<span class="lineno"></span><span class="op" id="5014837">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="keyword" id="5014840">func</span>&nbsp;<span class="op" id="5014845">(</span><span class="ident" id="5014846">c</span>&nbsp;<span class="op" id="5014848">*</span><span class="ident" id="5014849"><a href="/net/rpc/server.go.html#5014709">gobServerCodec</a></span><span class="op" id="5014863">)</span>&nbsp;<span class="ident" id="5014865">ReadRequestHeader</span><span class="op" id="5014882">(</span><span class="ident" id="5014883">r</span>&nbsp;<span class="op" id="5014885">*</span><span class="ident" id="5014886"><a href="/net/rpc/server.go.html#5007827">Request</a></span><span class="op" id="5014893">)</span>&nbsp;<span class="builtintype" id="5014895">error</span>&nbsp;<span class="op" id="5014901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014904">return</span>&nbsp;<span class="ident" id="5014911"><a href="/net/rpc/server.go.html#5014846">c</a></span><span class="op" id="5014912">.</span><span class="ident" id="5014913">dec</span><span class="op" id="5014916">.</span><span class="ident" id="5014917">Decode</span><span class="op" id="5014923">(</span><span class="ident" id="5014924"><a href="/net/rpc/server.go.html#5014883">r</a></span><span class="op" id="5014925">)</span><br>
<span class="lineno"></span><span class="op" id="5014927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="keyword" id="5014930">func</span>&nbsp;<span class="op" id="5014935">(</span><span class="ident" id="5014936">c</span>&nbsp;<span class="op" id="5014938">*</span><span class="ident" id="5014939"><a href="/net/rpc/server.go.html#5014709">gobServerCodec</a></span><span class="op" id="5014953">)</span>&nbsp;<span class="ident" id="5014955">ReadRequestBody</span><span class="op" id="5014970">(</span><span class="ident" id="5014971">body</span>&nbsp;<span class="keyword" id="5014976">interface</span><span class="op" id="5014985">{</span><span class="op" id="5014986">}</span><span class="op" id="5014987">)</span>&nbsp;<span class="builtintype" id="5014989">error</span>&nbsp;<span class="op" id="5014995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014998">return</span>&nbsp;<span class="ident" id="5015005"><a href="/net/rpc/server.go.html#5014936">c</a></span><span class="op" id="5015006">.</span><span class="ident" id="5015007">dec</span><span class="op" id="5015010">.</span><span class="ident" id="5015011">Decode</span><span class="op" id="5015017">(</span><span class="ident" id="5015018"><a href="/net/rpc/server.go.html#5014971">body</a></span><span class="op" id="5015022">)</span><br>
<span class="lineno"></span><span class="op" id="5015024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5015027">func</span>&nbsp;<span class="op" id="5015032">(</span><span class="ident" id="5015033">c</span>&nbsp;<span class="op" id="5015035">*</span><span class="ident" id="5015036"><a href="/net/rpc/server.go.html#5014709">gobServerCodec</a></span><span class="op" id="5015050">)</span>&nbsp;<span class="ident" id="5015052">WriteResponse</span><span class="op" id="5015065">(</span><span class="ident" id="5015066">r</span>&nbsp;<span class="op" id="5015068">*</span><span class="ident" id="5015069"><a href="/net/rpc/server.go.html#5008185">Response</a></span><span class="op" id="5015077">,</span>&nbsp;<span class="ident" id="5015079">body</span>&nbsp;<span class="keyword" id="5015084">interface</span><span class="op" id="5015093">{</span><span class="op" id="5015094">}</span><span class="op" id="5015095">)</span>&nbsp;<span class="op" id="5015097">(</span><span class="ident" id="5015098">err</span>&nbsp;<span class="builtintype" id="5015102">error</span><span class="op" id="5015107">)</span>&nbsp;<span class="op" id="5015109">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015112">if</span>&nbsp;<span class="ident" id="5015115"><a href="/net/rpc/server.go.html#5015098">err</a></span>&nbsp;<span class="op" id="5015119">=</span>&nbsp;<span class="ident" id="5015121"><a href="/net/rpc/server.go.html#5015033">c</a></span><span class="op" id="5015122">.</span><span class="ident" id="5015123">enc</span><span class="op" id="5015126">.</span><span class="ident" id="5015127">Encode</span><span class="op" id="5015133">(</span><span class="ident" id="5015134"><a href="/net/rpc/server.go.html#5015066">r</a></span><span class="op" id="5015135">)</span><span class="op" id="5015136">;</span>&nbsp;<span class="ident" id="5015138"><a href="/net/rpc/server.go.html#5015098">err</a></span>&nbsp;<span class="op" id="5015142">!=</span>&nbsp;<span class="ident" id="5015145">nil</span>&nbsp;<span class="op" id="5015149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015153">if</span>&nbsp;<span class="ident" id="5015156"><a href="/net/rpc/server.go.html#5015033">c</a></span><span class="op" id="5015157">.</span><span class="ident" id="5015158">encBuf</span><span class="op" id="5015164">.</span><span class="ident" id="5015165">Flush</span><span class="op" id="5015170">(</span><span class="op" id="5015171">)</span>&nbsp;<span class="op" id="5015173">==</span>&nbsp;<span class="ident" id="5015176">nil</span>&nbsp;<span class="op" id="5015180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015185">//&nbsp;Gob&nbsp;couldn&#39;t&nbsp;encode&nbsp;the&nbsp;header.&nbsp;Should&nbsp;not&nbsp;happen,&nbsp;so&nbsp;if&nbsp;it&nbsp;does,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015257">//&nbsp;shut&nbsp;down&nbsp;the&nbsp;connection&nbsp;to&nbsp;signal&nbsp;that&nbsp;the&nbsp;connection&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015329"><a href="/net/rpc/server.go.html#5006862">log</a></span><span class="op" id="5015332">.</span><span class="ident" id="5015333">Println</span><span class="op" id="5015340">(</span><span class="string" id="5015341">&#34;rpc:&nbsp;gob&nbsp;error&nbsp;encoding&nbsp;response:&#34;</span><span class="op" id="5015376">,</span>&nbsp;<span class="ident" id="5015378"><a href="/net/rpc/server.go.html#5015098">err</a></span><span class="op" id="5015381">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015386"><a href="/net/rpc/server.go.html#5015033">c</a></span><span class="op" id="5015387">.</span><span class="ident" id="5015388">Close</span><span class="op" id="5015393">(</span><span class="op" id="5015394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015402">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015413">if</span>&nbsp;<span class="ident" id="5015416"><a href="/net/rpc/server.go.html#5015098">err</a></span>&nbsp;<span class="op" id="5015420">=</span>&nbsp;<span class="ident" id="5015422"><a href="/net/rpc/server.go.html#5015033">c</a></span><span class="op" id="5015423">.</span><span class="ident" id="5015424">enc</span><span class="op" id="5015427">.</span><span class="ident" id="5015428">Encode</span><span class="op" id="5015434">(</span><span class="ident" id="5015435"><a href="/net/rpc/server.go.html#5015079">body</a></span><span class="op" id="5015439">)</span><span class="op" id="5015440">;</span>&nbsp;<span class="ident" id="5015442"><a href="/net/rpc/server.go.html#5015098">err</a></span>&nbsp;<span class="op" id="5015446">!=</span>&nbsp;<span class="ident" id="5015449">nil</span>&nbsp;<span class="op" id="5015453">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015457">if</span>&nbsp;<span class="ident" id="5015460"><a href="/net/rpc/server.go.html#5015033">c</a></span><span class="op" id="5015461">.</span><span class="ident" id="5015462">encBuf</span><span class="op" id="5015468">.</span><span class="ident" id="5015469">Flush</span><span class="op" id="5015474">(</span><span class="op" id="5015475">)</span>&nbsp;<span class="op" id="5015477">==</span>&nbsp;<span class="ident" id="5015480">nil</span>&nbsp;<span class="op" id="5015484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015489">//&nbsp;Was&nbsp;a&nbsp;gob&nbsp;problem&nbsp;encoding&nbsp;the&nbsp;body&nbsp;but&nbsp;the&nbsp;header&nbsp;has&nbsp;been&nbsp;written.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015564">//&nbsp;Shut&nbsp;down&nbsp;the&nbsp;connection&nbsp;to&nbsp;signal&nbsp;that&nbsp;the&nbsp;connection&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015636"><a href="/net/rpc/server.go.html#5006862">log</a></span><span class="op" id="5015639">.</span><span class="ident" id="5015640">Println</span><span class="op" id="5015647">(</span><span class="string" id="5015648">&#34;rpc:&nbsp;gob&nbsp;error&nbsp;encoding&nbsp;body:&#34;</span><span class="op" id="5015679">,</span>&nbsp;<span class="ident" id="5015681"><a href="/net/rpc/server.go.html#5015098">err</a></span><span class="op" id="5015684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015689"><a href="/net/rpc/server.go.html#5015033">c</a></span><span class="op" id="5015690">.</span><span class="ident" id="5015691">Close</span><span class="op" id="5015696">(</span><span class="op" id="5015697">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015705">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015716">return</span>&nbsp;<span class="ident" id="5015723"><a href="/net/rpc/server.go.html#5015033">c</a></span><span class="op" id="5015724">.</span><span class="ident" id="5015725">encBuf</span><span class="op" id="5015731">.</span><span class="ident" id="5015732">Flush</span><span class="op" id="5015737">(</span><span class="op" id="5015738">)</span><br>
<span class="lineno"></span><span class="op" id="5015740">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span><span class="keyword" id="5015743">func</span>&nbsp;<span class="op" id="5015748">(</span><span class="ident" id="5015749">c</span>&nbsp;<span class="op" id="5015751">*</span><span class="ident" id="5015752"><a href="/net/rpc/server.go.html#5014709">gobServerCodec</a></span><span class="op" id="5015766">)</span>&nbsp;<span class="ident" id="5015768">Close</span><span class="op" id="5015773">(</span><span class="op" id="5015774">)</span>&nbsp;<span class="builtintype" id="5015776">error</span>&nbsp;<span class="op" id="5015782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015785">if</span>&nbsp;<span class="ident" id="5015788"><a href="/net/rpc/server.go.html#5015749">c</a></span><span class="op" id="5015789">.</span><span class="ident" id="5015790">closed</span>&nbsp;<span class="op" id="5015797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015801">//&nbsp;Only&nbsp;call&nbsp;c.rwc.Close&nbsp;once;&nbsp;otherwise&nbsp;the&nbsp;semantics&nbsp;are&nbsp;undefined.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015873">return</span>&nbsp;<span class="ident" id="5015880">nil</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015888"><a href="/net/rpc/server.go.html#5015749">c</a></span><span class="op" id="5015889">.</span><span class="ident" id="5015890">closed</span>&nbsp;<span class="op" id="5015897">=</span>&nbsp;<span class="ident" id="5015899">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015905">return</span>&nbsp;<span class="ident" id="5015912"><a href="/net/rpc/server.go.html#5015749">c</a></span><span class="op" id="5015913">.</span><span class="ident" id="5015914">rwc</span><span class="op" id="5015917">.</span><span class="ident" id="5015918">Close</span><span class="op" id="5015923">(</span><span class="op" id="5015924">)</span><br>
<span class="lineno"></span><span class="op" id="5015926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="5015929">//&nbsp;ServeConn&nbsp;runs&nbsp;the&nbsp;server&nbsp;on&nbsp;a&nbsp;single&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5015982">//&nbsp;ServeConn&nbsp;blocks,&nbsp;serving&nbsp;the&nbsp;connection&nbsp;until&nbsp;the&nbsp;client&nbsp;hangs&nbsp;up.</span><br>
<span class="lineno"></span><span class="comment" id="5016053">//&nbsp;The&nbsp;caller&nbsp;typically&nbsp;invokes&nbsp;ServeConn&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="5016114">//&nbsp;ServeConn&nbsp;uses&nbsp;the&nbsp;gob&nbsp;wire&nbsp;format&nbsp;(see&nbsp;package&nbsp;gob)&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5016177">//&nbsp;connection.&nbsp;&nbsp;To&nbsp;use&nbsp;an&nbsp;alternate&nbsp;codec,&nbsp;use&nbsp;ServeCodec.</span><br>
<span class="lineno">445</span><span class="keyword" id="5016236">func</span>&nbsp;<span class="op" id="5016241">(</span><span class="ident" id="5016242">server</span>&nbsp;<span class="op" id="5016249">*</span><span class="ident" id="5016250"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5016256">)</span>&nbsp;<span class="ident" id="5016258">ServeConn</span><span class="op" id="5016267">(</span><span class="ident" id="5016268">conn</span>&nbsp;<span class="ident" id="5016273"><a href="/net/rpc/server.go.html#5006856">io</a></span><span class="op" id="5016275">.</span><span class="ident" id="5016276">ReadWriteCloser</span><span class="op" id="5016291">)</span>&nbsp;<span class="op" id="5016293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016296">buf</span>&nbsp;<span class="op" id="5016300">:=</span>&nbsp;<span class="ident" id="5016303"><a href="/net/rpc/server.go.html#5006821">bufio</a></span><span class="op" id="5016308">.</span><span class="ident" id="5016309">NewWriter</span><span class="op" id="5016318">(</span><span class="ident" id="5016319"><a href="/net/rpc/server.go.html#5016268">conn</a></span><span class="op" id="5016323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016326">srv</span>&nbsp;<span class="op" id="5016330">:=</span>&nbsp;<span class="op" id="5016333">&amp;</span><span class="ident" id="5016334"><a href="/net/rpc/server.go.html#5014709">gobServerCodec</a></span><span class="op" id="5016348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016352">rwc</span><span class="op" id="5016355">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5016360"><a href="/net/rpc/server.go.html#5016268">conn</a></span><span class="op" id="5016364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016368">dec</span><span class="op" id="5016371">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5016376"><a href="/net/rpc/server.go.html#5006830">gob</a></span><span class="op" id="5016379">.</span><span class="ident" id="5016380">NewDecoder</span><span class="op" id="5016390">(</span><span class="ident" id="5016391"><a href="/net/rpc/server.go.html#5016268">conn</a></span><span class="op" id="5016395">)</span><span class="op" id="5016396">,</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016400">enc</span><span class="op" id="5016403">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5016408"><a href="/net/rpc/server.go.html#5006830">gob</a></span><span class="op" id="5016411">.</span><span class="ident" id="5016412">NewEncoder</span><span class="op" id="5016422">(</span><span class="ident" id="5016423"><a href="/net/rpc/server.go.html#5016296">buf</a></span><span class="op" id="5016426">)</span><span class="op" id="5016427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016431">encBuf</span><span class="op" id="5016437">:</span>&nbsp;<span class="ident" id="5016439"><a href="/net/rpc/server.go.html#5016296">buf</a></span><span class="op" id="5016442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016448"><a href="/net/rpc/server.go.html#5016242">server</a></span><span class="op" id="5016454">.</span><span class="ident" id="5016455">ServeCodec</span><span class="op" id="5016465">(</span><span class="ident" id="5016466"><a href="/net/rpc/server.go.html#5016326">srv</a></span><span class="op" id="5016469">)</span><br>
<span class="lineno"></span><span class="op" id="5016471">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="5016474">//&nbsp;ServeCodec&nbsp;is&nbsp;like&nbsp;ServeConn&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified&nbsp;codec&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5016538">//&nbsp;decode&nbsp;requests&nbsp;and&nbsp;encode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="5016579">func</span>&nbsp;<span class="op" id="5016584">(</span><span class="ident" id="5016585">server</span>&nbsp;<span class="op" id="5016592">*</span><span class="ident" id="5016593"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5016599">)</span>&nbsp;<span class="ident" id="5016601">ServeCodec</span><span class="op" id="5016611">(</span><span class="ident" id="5016612">codec</span>&nbsp;<span class="ident" id="5016618"><a href="/net/rpc/server.go.html#5021745">ServerCodec</a></span><span class="op" id="5016629">)</span>&nbsp;<span class="op" id="5016631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016634">sending</span>&nbsp;<span class="op" id="5016642">:=</span>&nbsp;<span class="builtinfunc" id="5016645">new</span><span class="op" id="5016648">(</span><span class="ident" id="5016649"><a href="/net/rpc/server.go.html#5006910">sync</a></span><span class="op" id="5016653">.</span><span class="ident" id="5016654">Mutex</span><span class="op" id="5016659">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016662">for</span>&nbsp;<span class="op" id="5016666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016670">service</span><span class="op" id="5016677">,</span>&nbsp;<span class="ident" id="5016679">mtype</span><span class="op" id="5016684">,</span>&nbsp;<span class="ident" id="5016686">req</span><span class="op" id="5016689">,</span>&nbsp;<span class="ident" id="5016691">argv</span><span class="op" id="5016695">,</span>&nbsp;<span class="ident" id="5016697">replyv</span><span class="op" id="5016703">,</span>&nbsp;<span class="ident" id="5016705">keepReading</span><span class="op" id="5016716">,</span>&nbsp;<span class="ident" id="5016718">err</span>&nbsp;<span class="op" id="5016722">:=</span>&nbsp;<span class="ident" id="5016725"><a href="/net/rpc/server.go.html#5016585">server</a></span><span class="op" id="5016731">.</span><span class="ident" id="5016732">readRequest</span><span class="op" id="5016743">(</span><span class="ident" id="5016744"><a href="/net/rpc/server.go.html#5016612">codec</a></span><span class="op" id="5016749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016753">if</span>&nbsp;<span class="ident" id="5016756"><a href="/net/rpc/server.go.html#5016718">err</a></span>&nbsp;<span class="op" id="5016760">!=</span>&nbsp;<span class="ident" id="5016763">nil</span>&nbsp;<span class="op" id="5016767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016772">if</span>&nbsp;<span class="ident" id="5016775"><a href="/net/rpc/debug.go.html#5001451">debugLog</a></span>&nbsp;<span class="op" id="5016784">&amp;&amp;</span>&nbsp;<span class="ident" id="5016787"><a href="/net/rpc/server.go.html#5016718">err</a></span>&nbsp;<span class="op" id="5016791">!=</span>&nbsp;<span class="ident" id="5016794"><a href="/net/rpc/server.go.html#5006856">io</a></span><span class="op" id="5016796">.</span><span class="ident" id="5016797">EOF</span>&nbsp;<span class="op" id="5016801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016807"><a href="/net/rpc/server.go.html#5006862">log</a></span><span class="op" id="5016810">.</span><span class="ident" id="5016811">Println</span><span class="op" id="5016818">(</span><span class="string" id="5016819">&#34;rpc:&#34;</span><span class="op" id="5016825">,</span>&nbsp;<span class="ident" id="5016827"><a href="/net/rpc/server.go.html#5016718">err</a></span><span class="op" id="5016830">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016840">if</span>&nbsp;<span class="op" id="5016843">!</span><span class="ident" id="5016844"><a href="/net/rpc/server.go.html#5016705">keepReading</a></span>&nbsp;<span class="op" id="5016856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016862">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016876">//&nbsp;send&nbsp;a&nbsp;response&nbsp;if&nbsp;we&nbsp;actually&nbsp;managed&nbsp;to&nbsp;read&nbsp;a&nbsp;header.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016939">if</span>&nbsp;<span class="ident" id="5016942"><a href="/net/rpc/server.go.html#5016686">req</a></span>&nbsp;<span class="op" id="5016946">!=</span>&nbsp;<span class="ident" id="5016949">nil</span>&nbsp;<span class="op" id="5016953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016959"><a href="/net/rpc/server.go.html#5016585">server</a></span><span class="op" id="5016965">.</span><span class="ident" id="5016966">sendResponse</span><span class="op" id="5016978">(</span><span class="ident" id="5016979"><a href="/net/rpc/server.go.html#5016634">sending</a></span><span class="op" id="5016986">,</span>&nbsp;<span class="ident" id="5016988"><a href="/net/rpc/server.go.html#5016686">req</a></span><span class="op" id="5016991">,</span>&nbsp;<span class="ident" id="5016993"><a href="/net/rpc/server.go.html#5013470">invalidRequest</a></span><span class="op" id="5017007">,</span>&nbsp;<span class="ident" id="5017009"><a href="/net/rpc/server.go.html#5016612">codec</a></span><span class="op" id="5017014">,</span>&nbsp;<span class="ident" id="5017016"><a href="/net/rpc/server.go.html#5016718">err</a></span><span class="op" id="5017019">.</span><span class="ident" id="5017020">Error</span><span class="op" id="5017025">(</span><span class="op" id="5017026">)</span><span class="op" id="5017027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017033"><a href="/net/rpc/server.go.html#5016585">server</a></span><span class="op" id="5017039">.</span><span class="ident" id="5017040">freeRequest</span><span class="op" id="5017051">(</span><span class="ident" id="5017052"><a href="/net/rpc/server.go.html#5016686">req</a></span><span class="op" id="5017055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017065">continue</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017080">go</span>&nbsp;<span class="ident" id="5017083"><a href="/net/rpc/server.go.html#5016670">service</a></span><span class="op" id="5017090">.</span><span class="ident" id="5017091">call</span><span class="op" id="5017095">(</span><span class="ident" id="5017096"><a href="/net/rpc/server.go.html#5016585">server</a></span><span class="op" id="5017102">,</span>&nbsp;<span class="ident" id="5017104"><a href="/net/rpc/server.go.html#5016634">sending</a></span><span class="op" id="5017111">,</span>&nbsp;<span class="ident" id="5017113"><a href="/net/rpc/server.go.html#5016679">mtype</a></span><span class="op" id="5017118">,</span>&nbsp;<span class="ident" id="5017120"><a href="/net/rpc/server.go.html#5016686">req</a></span><span class="op" id="5017123">,</span>&nbsp;<span class="ident" id="5017125"><a href="/net/rpc/server.go.html#5016691">argv</a></span><span class="op" id="5017129">,</span>&nbsp;<span class="ident" id="5017131"><a href="/net/rpc/server.go.html#5016697">replyv</a></span><span class="op" id="5017137">,</span>&nbsp;<span class="ident" id="5017139"><a href="/net/rpc/server.go.html#5016612">codec</a></span><span class="op" id="5017144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017150"><a href="/net/rpc/server.go.html#5016612">codec</a></span><span class="op" id="5017155">.</span><span class="ident" id="5017156">Close</span><span class="op" id="5017161">(</span><span class="op" id="5017162">)</span><br>
<span class="lineno"></span><span class="op" id="5017164">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="5017167">//&nbsp;ServeRequest&nbsp;is&nbsp;like&nbsp;ServeCodec&nbsp;but&nbsp;synchronously&nbsp;serves&nbsp;a&nbsp;single&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="5017245">//&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;codec&nbsp;upon&nbsp;completion.</span><br>
<span class="lineno"></span><span class="keyword" id="5017293">func</span>&nbsp;<span class="op" id="5017298">(</span><span class="ident" id="5017299">server</span>&nbsp;<span class="op" id="5017306">*</span><span class="ident" id="5017307"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5017313">)</span>&nbsp;<span class="ident" id="5017315">ServeRequest</span><span class="op" id="5017327">(</span><span class="ident" id="5017328">codec</span>&nbsp;<span class="ident" id="5017334"><a href="/net/rpc/server.go.html#5021745">ServerCodec</a></span><span class="op" id="5017345">)</span>&nbsp;<span class="builtintype" id="5017347">error</span>&nbsp;<span class="op" id="5017353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017356">sending</span>&nbsp;<span class="op" id="5017364">:=</span>&nbsp;<span class="builtinfunc" id="5017367">new</span><span class="op" id="5017370">(</span><span class="ident" id="5017371"><a href="/net/rpc/server.go.html#5006910">sync</a></span><span class="op" id="5017375">.</span><span class="ident" id="5017376">Mutex</span><span class="op" id="5017381">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017384">service</span><span class="op" id="5017391">,</span>&nbsp;<span class="ident" id="5017393">mtype</span><span class="op" id="5017398">,</span>&nbsp;<span class="ident" id="5017400">req</span><span class="op" id="5017403">,</span>&nbsp;<span class="ident" id="5017405">argv</span><span class="op" id="5017409">,</span>&nbsp;<span class="ident" id="5017411">replyv</span><span class="op" id="5017417">,</span>&nbsp;<span class="ident" id="5017419">keepReading</span><span class="op" id="5017430">,</span>&nbsp;<span class="ident" id="5017432">err</span>&nbsp;<span class="op" id="5017436">:=</span>&nbsp;<span class="ident" id="5017439"><a href="/net/rpc/server.go.html#5017299">server</a></span><span class="op" id="5017445">.</span><span class="ident" id="5017446">readRequest</span><span class="op" id="5017457">(</span><span class="ident" id="5017458"><a href="/net/rpc/server.go.html#5017328">codec</a></span><span class="op" id="5017463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017466">if</span>&nbsp;<span class="ident" id="5017469"><a href="/net/rpc/server.go.html#5017432">err</a></span>&nbsp;<span class="op" id="5017473">!=</span>&nbsp;<span class="ident" id="5017476">nil</span>&nbsp;<span class="op" id="5017480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017484">if</span>&nbsp;<span class="op" id="5017487">!</span><span class="ident" id="5017488"><a href="/net/rpc/server.go.html#5017419">keepReading</a></span>&nbsp;<span class="op" id="5017500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017505">return</span>&nbsp;<span class="ident" id="5017512"><a href="/net/rpc/server.go.html#5017432">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017518">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5017522">//&nbsp;send&nbsp;a&nbsp;response&nbsp;if&nbsp;we&nbsp;actually&nbsp;managed&nbsp;to&nbsp;read&nbsp;a&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017584">if</span>&nbsp;<span class="ident" id="5017587"><a href="/net/rpc/server.go.html#5017400">req</a></span>&nbsp;<span class="op" id="5017591">!=</span>&nbsp;<span class="ident" id="5017594">nil</span>&nbsp;<span class="op" id="5017598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017603"><a href="/net/rpc/server.go.html#5017299">server</a></span><span class="op" id="5017609">.</span><span class="ident" id="5017610">sendResponse</span><span class="op" id="5017622">(</span><span class="ident" id="5017623"><a href="/net/rpc/server.go.html#5017356">sending</a></span><span class="op" id="5017630">,</span>&nbsp;<span class="ident" id="5017632"><a href="/net/rpc/server.go.html#5017400">req</a></span><span class="op" id="5017635">,</span>&nbsp;<span class="ident" id="5017637"><a href="/net/rpc/server.go.html#5013470">invalidRequest</a></span><span class="op" id="5017651">,</span>&nbsp;<span class="ident" id="5017653"><a href="/net/rpc/server.go.html#5017328">codec</a></span><span class="op" id="5017658">,</span>&nbsp;<span class="ident" id="5017660"><a href="/net/rpc/server.go.html#5017432">err</a></span><span class="op" id="5017663">.</span><span class="ident" id="5017664">Error</span><span class="op" id="5017669">(</span><span class="op" id="5017670">)</span><span class="op" id="5017671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017676"><a href="/net/rpc/server.go.html#5017299">server</a></span><span class="op" id="5017682">.</span><span class="ident" id="5017683">freeRequest</span><span class="op" id="5017694">(</span><span class="ident" id="5017695"><a href="/net/rpc/server.go.html#5017400">req</a></span><span class="op" id="5017698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017702">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017706">return</span>&nbsp;<span class="ident" id="5017713"><a href="/net/rpc/server.go.html#5017432">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017721"><a href="/net/rpc/server.go.html#5017384">service</a></span><span class="op" id="5017728">.</span><span class="ident" id="5017729">call</span><span class="op" id="5017733">(</span><span class="ident" id="5017734"><a href="/net/rpc/server.go.html#5017299">server</a></span><span class="op" id="5017740">,</span>&nbsp;<span class="ident" id="5017742"><a href="/net/rpc/server.go.html#5017356">sending</a></span><span class="op" id="5017749">,</span>&nbsp;<span class="ident" id="5017751"><a href="/net/rpc/server.go.html#5017393">mtype</a></span><span class="op" id="5017756">,</span>&nbsp;<span class="ident" id="5017758"><a href="/net/rpc/server.go.html#5017400">req</a></span><span class="op" id="5017761">,</span>&nbsp;<span class="ident" id="5017763"><a href="/net/rpc/server.go.html#5017405">argv</a></span><span class="op" id="5017767">,</span>&nbsp;<span class="ident" id="5017769"><a href="/net/rpc/server.go.html#5017411">replyv</a></span><span class="op" id="5017775">,</span>&nbsp;<span class="ident" id="5017777"><a href="/net/rpc/server.go.html#5017328">codec</a></span><span class="op" id="5017782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017785">return</span>&nbsp;<span class="ident" id="5017792">nil</span><br>
<span class="lineno"></span><span class="op" id="5017796">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="5017799">func</span>&nbsp;<span class="op" id="5017804">(</span><span class="ident" id="5017805">server</span>&nbsp;<span class="op" id="5017812">*</span><span class="ident" id="5017813"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5017819">)</span>&nbsp;<span class="ident" id="5017821">getRequest</span><span class="op" id="5017831">(</span><span class="op" id="5017832">)</span>&nbsp;<span class="op" id="5017834">*</span><span class="ident" id="5017835"><a href="/net/rpc/server.go.html#5007827">Request</a></span>&nbsp;<span class="op" id="5017843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017846"><a href="/net/rpc/server.go.html#5017805">server</a></span><span class="op" id="5017852">.</span><span class="ident" id="5017853">reqLock</span><span class="op" id="5017860">.</span><span class="ident" id="5017861">Lock</span><span class="op" id="5017865">(</span><span class="op" id="5017866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017869">req</span>&nbsp;<span class="op" id="5017873">:=</span>&nbsp;<span class="ident" id="5017876"><a href="/net/rpc/server.go.html#5017805">server</a></span><span class="op" id="5017882">.</span><span class="ident" id="5017883">freeReq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017892">if</span>&nbsp;<span class="ident" id="5017895"><a href="/net/rpc/server.go.html#5017869">req</a></span>&nbsp;<span class="op" id="5017899">==</span>&nbsp;<span class="ident" id="5017902">nil</span>&nbsp;<span class="op" id="5017906">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017910"><a href="/net/rpc/server.go.html#5017869">req</a></span>&nbsp;<span class="op" id="5017914">=</span>&nbsp;<span class="builtinfunc" id="5017916">new</span><span class="op" id="5017919">(</span><span class="ident" id="5017920"><a href="/net/rpc/server.go.html#5007827">Request</a></span><span class="op" id="5017927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017930">}</span>&nbsp;<span class="keyword" id="5017932">else</span>&nbsp;<span class="op" id="5017937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017941"><a href="/net/rpc/server.go.html#5017805">server</a></span><span class="op" id="5017947">.</span><span class="ident" id="5017948">freeReq</span>&nbsp;<span class="op" id="5017956">=</span>&nbsp;<span class="ident" id="5017958"><a href="/net/rpc/server.go.html#5017869">req</a></span><span class="op" id="5017961">.</span><span class="ident" id="5017962">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017969">*</span><span class="ident" id="5017970"><a href="/net/rpc/server.go.html#5017869">req</a></span>&nbsp;<span class="op" id="5017974">=</span>&nbsp;<span class="ident" id="5017976"><a href="/net/rpc/server.go.html#5007827">Request</a></span><span class="op" id="5017983">{</span><span class="op" id="5017984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017987">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017990"><a href="/net/rpc/server.go.html#5017805">server</a></span><span class="op" id="5017996">.</span><span class="ident" id="5017997">reqLock</span><span class="op" id="5018004">.</span><span class="ident" id="5018005">Unlock</span><span class="op" id="5018011">(</span><span class="op" id="5018012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018015">return</span>&nbsp;<span class="ident" id="5018022"><a href="/net/rpc/server.go.html#5017869">req</a></span><br>
<span class="lineno"></span><span class="op" id="5018026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5018029">func</span>&nbsp;<span class="op" id="5018034">(</span><span class="ident" id="5018035">server</span>&nbsp;<span class="op" id="5018042">*</span><span class="ident" id="5018043"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5018049">)</span>&nbsp;<span class="ident" id="5018051">freeRequest</span><span class="op" id="5018062">(</span><span class="ident" id="5018063">req</span>&nbsp;<span class="op" id="5018067">*</span><span class="ident" id="5018068"><a href="/net/rpc/server.go.html#5007827">Request</a></span><span class="op" id="5018075">)</span>&nbsp;<span class="op" id="5018077">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018080"><a href="/net/rpc/server.go.html#5018035">server</a></span><span class="op" id="5018086">.</span><span class="ident" id="5018087">reqLock</span><span class="op" id="5018094">.</span><span class="ident" id="5018095">Lock</span><span class="op" id="5018099">(</span><span class="op" id="5018100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018103"><a href="/net/rpc/server.go.html#5018063">req</a></span><span class="op" id="5018106">.</span><span class="ident" id="5018107">next</span>&nbsp;<span class="op" id="5018112">=</span>&nbsp;<span class="ident" id="5018114"><a href="/net/rpc/server.go.html#5018035">server</a></span><span class="op" id="5018120">.</span><span class="ident" id="5018121">freeReq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018130"><a href="/net/rpc/server.go.html#5018035">server</a></span><span class="op" id="5018136">.</span><span class="ident" id="5018137">freeReq</span>&nbsp;<span class="op" id="5018145">=</span>&nbsp;<span class="ident" id="5018147"><a href="/net/rpc/server.go.html#5018063">req</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018152"><a href="/net/rpc/server.go.html#5018035">server</a></span><span class="op" id="5018158">.</span><span class="ident" id="5018159">reqLock</span><span class="op" id="5018166">.</span><span class="ident" id="5018167">Unlock</span><span class="op" id="5018173">(</span><span class="op" id="5018174">)</span><br>
<span class="lineno"></span><span class="op" id="5018176">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span><span class="keyword" id="5018179">func</span>&nbsp;<span class="op" id="5018184">(</span><span class="ident" id="5018185">server</span>&nbsp;<span class="op" id="5018192">*</span><span class="ident" id="5018193"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5018199">)</span>&nbsp;<span class="ident" id="5018201">getResponse</span><span class="op" id="5018212">(</span><span class="op" id="5018213">)</span>&nbsp;<span class="op" id="5018215">*</span><span class="ident" id="5018216"><a href="/net/rpc/server.go.html#5008185">Response</a></span>&nbsp;<span class="op" id="5018225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018228"><a href="/net/rpc/server.go.html#5018185">server</a></span><span class="op" id="5018234">.</span><span class="ident" id="5018235">respLock</span><span class="op" id="5018243">.</span><span class="ident" id="5018244">Lock</span><span class="op" id="5018248">(</span><span class="op" id="5018249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018252">resp</span>&nbsp;<span class="op" id="5018257">:=</span>&nbsp;<span class="ident" id="5018260"><a href="/net/rpc/server.go.html#5018185">server</a></span><span class="op" id="5018266">.</span><span class="ident" id="5018267">freeResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018277">if</span>&nbsp;<span class="ident" id="5018280"><a href="/net/rpc/server.go.html#5018252">resp</a></span>&nbsp;<span class="op" id="5018285">==</span>&nbsp;<span class="ident" id="5018288">nil</span>&nbsp;<span class="op" id="5018292">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018296"><a href="/net/rpc/server.go.html#5018252">resp</a></span>&nbsp;<span class="op" id="5018301">=</span>&nbsp;<span class="builtinfunc" id="5018303">new</span><span class="op" id="5018306">(</span><span class="ident" id="5018307"><a href="/net/rpc/server.go.html#5008185">Response</a></span><span class="op" id="5018315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018318">}</span>&nbsp;<span class="keyword" id="5018320">else</span>&nbsp;<span class="op" id="5018325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018329"><a href="/net/rpc/server.go.html#5018185">server</a></span><span class="op" id="5018335">.</span><span class="ident" id="5018336">freeResp</span>&nbsp;<span class="op" id="5018345">=</span>&nbsp;<span class="ident" id="5018347"><a href="/net/rpc/server.go.html#5018252">resp</a></span><span class="op" id="5018351">.</span><span class="ident" id="5018352">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018359">*</span><span class="ident" id="5018360"><a href="/net/rpc/server.go.html#5018252">resp</a></span>&nbsp;<span class="op" id="5018365">=</span>&nbsp;<span class="ident" id="5018367"><a href="/net/rpc/server.go.html#5008185">Response</a></span><span class="op" id="5018375">{</span><span class="op" id="5018376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018379">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018382"><a href="/net/rpc/server.go.html#5018185">server</a></span><span class="op" id="5018388">.</span><span class="ident" id="5018389">respLock</span><span class="op" id="5018397">.</span><span class="ident" id="5018398">Unlock</span><span class="op" id="5018404">(</span><span class="op" id="5018405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018408">return</span>&nbsp;<span class="ident" id="5018415"><a href="/net/rpc/server.go.html#5018252">resp</a></span><br>
<span class="lineno"></span><span class="op" id="5018420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5018423">func</span>&nbsp;<span class="op" id="5018428">(</span><span class="ident" id="5018429">server</span>&nbsp;<span class="op" id="5018436">*</span><span class="ident" id="5018437"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5018443">)</span>&nbsp;<span class="ident" id="5018445">freeResponse</span><span class="op" id="5018457">(</span><span class="ident" id="5018458">resp</span>&nbsp;<span class="op" id="5018463">*</span><span class="ident" id="5018464"><a href="/net/rpc/server.go.html#5008185">Response</a></span><span class="op" id="5018472">)</span>&nbsp;<span class="op" id="5018474">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018477"><a href="/net/rpc/server.go.html#5018429">server</a></span><span class="op" id="5018483">.</span><span class="ident" id="5018484">respLock</span><span class="op" id="5018492">.</span><span class="ident" id="5018493">Lock</span><span class="op" id="5018497">(</span><span class="op" id="5018498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018501"><a href="/net/rpc/server.go.html#5018458">resp</a></span><span class="op" id="5018505">.</span><span class="ident" id="5018506">next</span>&nbsp;<span class="op" id="5018511">=</span>&nbsp;<span class="ident" id="5018513"><a href="/net/rpc/server.go.html#5018429">server</a></span><span class="op" id="5018519">.</span><span class="ident" id="5018520">freeResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018530"><a href="/net/rpc/server.go.html#5018429">server</a></span><span class="op" id="5018536">.</span><span class="ident" id="5018537">freeResp</span>&nbsp;<span class="op" id="5018546">=</span>&nbsp;<span class="ident" id="5018548"><a href="/net/rpc/server.go.html#5018458">resp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018554"><a href="/net/rpc/server.go.html#5018429">server</a></span><span class="op" id="5018560">.</span><span class="ident" id="5018561">respLock</span><span class="op" id="5018569">.</span><span class="ident" id="5018570">Unlock</span><span class="op" id="5018576">(</span><span class="op" id="5018577">)</span><br>
<span class="lineno"></span><span class="op" id="5018579">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span><span class="keyword" id="5018582">func</span>&nbsp;<span class="op" id="5018587">(</span><span class="ident" id="5018588">server</span>&nbsp;<span class="op" id="5018595">*</span><span class="ident" id="5018596"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5018602">)</span>&nbsp;<span class="ident" id="5018604">readRequest</span><span class="op" id="5018615">(</span><span class="ident" id="5018616">codec</span>&nbsp;<span class="ident" id="5018622"><a href="/net/rpc/server.go.html#5021745">ServerCodec</a></span><span class="op" id="5018633">)</span>&nbsp;<span class="op" id="5018635">(</span><span class="ident" id="5018636">service</span>&nbsp;<span class="op" id="5018644">*</span><span class="ident" id="5018645"><a href="/net/rpc/server.go.html#5007407">service</a></span><span class="op" id="5018652">,</span>&nbsp;<span class="ident" id="5018654">mtype</span>&nbsp;<span class="op" id="5018660">*</span><span class="ident" id="5018661"><a href="/net/rpc/server.go.html#5007252">methodType</a></span><span class="op" id="5018671">,</span>&nbsp;<span class="ident" id="5018673">req</span>&nbsp;<span class="op" id="5018677">*</span><span class="ident" id="5018678"><a href="/net/rpc/server.go.html#5007827">Request</a></span><span class="op" id="5018685">,</span>&nbsp;<span class="ident" id="5018687">argv</span><span class="op" id="5018691">,</span>&nbsp;<span class="ident" id="5018693">replyv</span>&nbsp;<span class="ident" id="5018700"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5018707">.</span><span class="ident" id="5018708">Value</span><span class="op" id="5018713">,</span>&nbsp;<span class="ident" id="5018715">keepReading</span>&nbsp;<span class="builtintype" id="5018727">bool</span><span class="op" id="5018731">,</span>&nbsp;<span class="ident" id="5018733">err</span>&nbsp;<span class="builtintype" id="5018737">error</span><span class="op" id="5018742">)</span>&nbsp;<span class="op" id="5018744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018747"><a href="/net/rpc/server.go.html#5018636">service</a></span><span class="op" id="5018754">,</span>&nbsp;<span class="ident" id="5018756"><a href="/net/rpc/server.go.html#5018654">mtype</a></span><span class="op" id="5018761">,</span>&nbsp;<span class="ident" id="5018763"><a href="/net/rpc/server.go.html#5018673">req</a></span><span class="op" id="5018766">,</span>&nbsp;<span class="ident" id="5018768"><a href="/net/rpc/server.go.html#5018715">keepReading</a></span><span class="op" id="5018779">,</span>&nbsp;<span class="ident" id="5018781"><a href="/net/rpc/server.go.html#5018733">err</a></span>&nbsp;<span class="op" id="5018785">=</span>&nbsp;<span class="ident" id="5018787"><a href="/net/rpc/server.go.html#5018588">server</a></span><span class="op" id="5018793">.</span><span class="ident" id="5018794">readRequestHeader</span><span class="op" id="5018811">(</span><span class="ident" id="5018812"><a href="/net/rpc/server.go.html#5018616">codec</a></span><span class="op" id="5018817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018820">if</span>&nbsp;<span class="ident" id="5018823"><a href="/net/rpc/server.go.html#5018733">err</a></span>&nbsp;<span class="op" id="5018827">!=</span>&nbsp;<span class="ident" id="5018830">nil</span>&nbsp;<span class="op" id="5018834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018838">if</span>&nbsp;<span class="op" id="5018841">!</span><span class="ident" id="5018842"><a href="/net/rpc/server.go.html#5018715">keepReading</a></span>&nbsp;<span class="op" id="5018854">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018859">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018872">//&nbsp;discard&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018890"><a href="/net/rpc/server.go.html#5018616">codec</a></span><span class="op" id="5018895">.</span><span class="ident" id="5018896">ReadRequestBody</span><span class="op" id="5018911">(</span><span class="ident" id="5018912">nil</span><span class="op" id="5018915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018919">return</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018931">//&nbsp;Decode&nbsp;the&nbsp;argument&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018962">argIsValue</span>&nbsp;<span class="op" id="5018973">:=</span>&nbsp;<span class="ident" id="5018976">false</span>&nbsp;<span class="comment" id="5018982">//&nbsp;if&nbsp;true,&nbsp;need&nbsp;to&nbsp;indirect&nbsp;before&nbsp;calling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019028">if</span>&nbsp;<span class="ident" id="5019031"><a href="/net/rpc/server.go.html#5018654">mtype</a></span><span class="op" id="5019036">.</span><span class="ident" id="5019037">ArgType</span><span class="op" id="5019044">.</span><span class="ident" id="5019045">Kind</span><span class="op" id="5019049">(</span><span class="op" id="5019050">)</span>&nbsp;<span class="op" id="5019052">==</span>&nbsp;<span class="ident" id="5019055"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5019062">.</span><span class="ident" id="5019063">Ptr</span>&nbsp;<span class="op" id="5019067">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019071"><a href="/net/rpc/server.go.html#5018687">argv</a></span>&nbsp;<span class="op" id="5019076">=</span>&nbsp;<span class="ident" id="5019078"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5019085">.</span><span class="ident" id="5019086">New</span><span class="op" id="5019089">(</span><span class="ident" id="5019090"><a href="/net/rpc/server.go.html#5018654">mtype</a></span><span class="op" id="5019095">.</span><span class="ident" id="5019096">ArgType</span><span class="op" id="5019103">.</span><span class="ident" id="5019104">Elem</span><span class="op" id="5019108">(</span><span class="op" id="5019109">)</span><span class="op" id="5019110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019113">}</span>&nbsp;<span class="keyword" id="5019115">else</span>&nbsp;<span class="op" id="5019120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019124"><a href="/net/rpc/server.go.html#5018687">argv</a></span>&nbsp;<span class="op" id="5019129">=</span>&nbsp;<span class="ident" id="5019131"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5019138">.</span><span class="ident" id="5019139">New</span><span class="op" id="5019142">(</span><span class="ident" id="5019143"><a href="/net/rpc/server.go.html#5018654">mtype</a></span><span class="op" id="5019148">.</span><span class="ident" id="5019149">ArgType</span><span class="op" id="5019156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019160"><a href="/net/rpc/server.go.html#5018962">argIsValue</a></span>&nbsp;<span class="op" id="5019171">=</span>&nbsp;<span class="ident" id="5019173">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019179">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019182">//&nbsp;argv&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;a&nbsp;pointer&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019223">if</span>&nbsp;<span class="ident" id="5019226"><a href="/net/rpc/server.go.html#5018733">err</a></span>&nbsp;<span class="op" id="5019230">=</span>&nbsp;<span class="ident" id="5019232"><a href="/net/rpc/server.go.html#5018616">codec</a></span><span class="op" id="5019237">.</span><span class="ident" id="5019238">ReadRequestBody</span><span class="op" id="5019253">(</span><span class="ident" id="5019254"><a href="/net/rpc/server.go.html#5018687">argv</a></span><span class="op" id="5019258">.</span><span class="ident" id="5019259">Interface</span><span class="op" id="5019268">(</span><span class="op" id="5019269">)</span><span class="op" id="5019270">)</span><span class="op" id="5019271">;</span>&nbsp;<span class="ident" id="5019273"><a href="/net/rpc/server.go.html#5018733">err</a></span>&nbsp;<span class="op" id="5019277">!=</span>&nbsp;<span class="ident" id="5019280">nil</span>&nbsp;<span class="op" id="5019284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019288">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019299">if</span>&nbsp;<span class="ident" id="5019302"><a href="/net/rpc/server.go.html#5018962">argIsValue</a></span>&nbsp;<span class="op" id="5019313">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019317"><a href="/net/rpc/server.go.html#5018687">argv</a></span>&nbsp;<span class="op" id="5019322">=</span>&nbsp;<span class="ident" id="5019324"><a href="/net/rpc/server.go.html#5018687">argv</a></span><span class="op" id="5019328">.</span><span class="ident" id="5019329">Elem</span><span class="op" id="5019333">(</span><span class="op" id="5019334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019341"><a href="/net/rpc/server.go.html#5018693">replyv</a></span>&nbsp;<span class="op" id="5019348">=</span>&nbsp;<span class="ident" id="5019350"><a href="/net/rpc/server.go.html#5006888">reflect</a></span><span class="op" id="5019357">.</span><span class="ident" id="5019358">New</span><span class="op" id="5019361">(</span><span class="ident" id="5019362"><a href="/net/rpc/server.go.html#5018654">mtype</a></span><span class="op" id="5019367">.</span><span class="ident" id="5019368">ReplyType</span><span class="op" id="5019377">.</span><span class="ident" id="5019378">Elem</span><span class="op" id="5019382">(</span><span class="op" id="5019383">)</span><span class="op" id="5019384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019387">return</span><br>
<span class="lineno">570</span><span class="op" id="5019394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5019397">func</span>&nbsp;<span class="op" id="5019402">(</span><span class="ident" id="5019403">server</span>&nbsp;<span class="op" id="5019410">*</span><span class="ident" id="5019411"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5019417">)</span>&nbsp;<span class="ident" id="5019419">readRequestHeader</span><span class="op" id="5019436">(</span><span class="ident" id="5019437">codec</span>&nbsp;<span class="ident" id="5019443"><a href="/net/rpc/server.go.html#5021745">ServerCodec</a></span><span class="op" id="5019454">)</span>&nbsp;<span class="op" id="5019456">(</span><span class="ident" id="5019457">service</span>&nbsp;<span class="op" id="5019465">*</span><span class="ident" id="5019466"><a href="/net/rpc/server.go.html#5007407">service</a></span><span class="op" id="5019473">,</span>&nbsp;<span class="ident" id="5019475">mtype</span>&nbsp;<span class="op" id="5019481">*</span><span class="ident" id="5019482"><a href="/net/rpc/server.go.html#5007252">methodType</a></span><span class="op" id="5019492">,</span>&nbsp;<span class="ident" id="5019494">req</span>&nbsp;<span class="op" id="5019498">*</span><span class="ident" id="5019499"><a href="/net/rpc/server.go.html#5007827">Request</a></span><span class="op" id="5019506">,</span>&nbsp;<span class="ident" id="5019508">keepReading</span>&nbsp;<span class="builtintype" id="5019520">bool</span><span class="op" id="5019524">,</span>&nbsp;<span class="ident" id="5019526">err</span>&nbsp;<span class="builtintype" id="5019530">error</span><span class="op" id="5019535">)</span>&nbsp;<span class="op" id="5019537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019540">//&nbsp;Grab&nbsp;the&nbsp;request&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019569"><a href="/net/rpc/server.go.html#5019494">req</a></span>&nbsp;<span class="op" id="5019573">=</span>&nbsp;<span class="ident" id="5019575"><a href="/net/rpc/server.go.html#5019403">server</a></span><span class="op" id="5019581">.</span><span class="ident" id="5019582">getRequest</span><span class="op" id="5019592">(</span><span class="op" id="5019593">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019596"><a href="/net/rpc/server.go.html#5019526">err</a></span>&nbsp;<span class="op" id="5019600">=</span>&nbsp;<span class="ident" id="5019602"><a href="/net/rpc/server.go.html#5019437">codec</a></span><span class="op" id="5019607">.</span><span class="ident" id="5019608">ReadRequestHeader</span><span class="op" id="5019625">(</span><span class="ident" id="5019626"><a href="/net/rpc/server.go.html#5019494">req</a></span><span class="op" id="5019629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019632">if</span>&nbsp;<span class="ident" id="5019635"><a href="/net/rpc/server.go.html#5019526">err</a></span>&nbsp;<span class="op" id="5019639">!=</span>&nbsp;<span class="ident" id="5019642">nil</span>&nbsp;<span class="op" id="5019646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019650"><a href="/net/rpc/server.go.html#5019494">req</a></span>&nbsp;<span class="op" id="5019654">=</span>&nbsp;<span class="ident" id="5019656">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019662">if</span>&nbsp;<span class="ident" id="5019665"><a href="/net/rpc/server.go.html#5019526">err</a></span>&nbsp;<span class="op" id="5019669">==</span>&nbsp;<span class="ident" id="5019672"><a href="/net/rpc/server.go.html#5006856">io</a></span><span class="op" id="5019674">.</span><span class="ident" id="5019675">EOF</span>&nbsp;<span class="op" id="5019679">||</span>&nbsp;<span class="ident" id="5019682"><a href="/net/rpc/server.go.html#5019526">err</a></span>&nbsp;<span class="op" id="5019686">==</span>&nbsp;<span class="ident" id="5019689"><a href="/net/rpc/server.go.html#5006856">io</a></span><span class="op" id="5019691">.</span><span class="ident" id="5019692">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="5019709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019714">return</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019727"><a href="/net/rpc/server.go.html#5019526">err</a></span>&nbsp;<span class="op" id="5019731">=</span>&nbsp;<span class="ident" id="5019733"><a href="/net/rpc/server.go.html#5006846">errors</a></span><span class="op" id="5019739">.</span><span class="ident" id="5019740">New</span><span class="op" id="5019743">(</span><span class="string" id="5019744">&#34;rpc:&nbsp;server&nbsp;cannot&nbsp;decode&nbsp;request:&nbsp;&#34;</span>&nbsp;<span class="op" id="5019782">+</span>&nbsp;<span class="ident" id="5019784"><a href="/net/rpc/server.go.html#5019526">err</a></span><span class="op" id="5019787">.</span><span class="ident" id="5019788">Error</span><span class="op" id="5019793">(</span><span class="op" id="5019794">)</span><span class="op" id="5019795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019799">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019811">//&nbsp;We&nbsp;read&nbsp;the&nbsp;header&nbsp;successfully.&nbsp;&nbsp;If&nbsp;we&nbsp;see&nbsp;an&nbsp;error&nbsp;now,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019873">//&nbsp;we&nbsp;can&nbsp;still&nbsp;recover&nbsp;and&nbsp;move&nbsp;on&nbsp;to&nbsp;the&nbsp;next&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019931"><a href="/net/rpc/server.go.html#5019508">keepReading</a></span>&nbsp;<span class="op" id="5019943">=</span>&nbsp;<span class="ident" id="5019945">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019952">dot</span>&nbsp;<span class="op" id="5019956">:=</span>&nbsp;<span class="ident" id="5019959"><a href="/net/rpc/server.go.html#5006899">strings</a></span><span class="op" id="5019966">.</span><span class="ident" id="5019967">LastIndex</span><span class="op" id="5019976">(</span><span class="ident" id="5019977"><a href="/net/rpc/server.go.html#5019494">req</a></span><span class="op" id="5019980">.</span><span class="ident" id="5019981">ServiceMethod</span><span class="op" id="5019994">,</span>&nbsp;<span class="string" id="5019996">&#34;.&#34;</span><span class="op" id="5019999">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020002">if</span>&nbsp;<span class="ident" id="5020005"><a href="/net/rpc/server.go.html#5019952">dot</a></span>&nbsp;<span class="op" id="5020009">&lt;</span>&nbsp;<span class="num" id="5020011">0</span>&nbsp;<span class="op" id="5020013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020017"><a href="/net/rpc/server.go.html#5019526">err</a></span>&nbsp;<span class="op" id="5020021">=</span>&nbsp;<span class="ident" id="5020023"><a href="/net/rpc/server.go.html#5006846">errors</a></span><span class="op" id="5020029">.</span><span class="ident" id="5020030">New</span><span class="op" id="5020033">(</span><span class="string" id="5020034">&#34;rpc:&nbsp;service/method&nbsp;request&nbsp;ill-formed:&nbsp;&#34;</span>&nbsp;<span class="op" id="5020077">+</span>&nbsp;<span class="ident" id="5020079"><a href="/net/rpc/server.go.html#5019494">req</a></span><span class="op" id="5020082">.</span><span class="ident" id="5020083">ServiceMethod</span><span class="op" id="5020096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020100">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020111">serviceName</span>&nbsp;<span class="op" id="5020123">:=</span>&nbsp;<span class="ident" id="5020126"><a href="/net/rpc/server.go.html#5019494">req</a></span><span class="op" id="5020129">.</span><span class="ident" id="5020130">ServiceMethod</span><span class="op" id="5020143">[</span><span class="op" id="5020144">:</span><span class="ident" id="5020145"><a href="/net/rpc/server.go.html#5019952">dot</a></span><span class="op" id="5020148">]</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020151">methodName</span>&nbsp;<span class="op" id="5020162">:=</span>&nbsp;<span class="ident" id="5020165"><a href="/net/rpc/server.go.html#5019494">req</a></span><span class="op" id="5020168">.</span><span class="ident" id="5020169">ServiceMethod</span><span class="op" id="5020182">[</span><span class="ident" id="5020183"><a href="/net/rpc/server.go.html#5019952">dot</a></span><span class="op" id="5020186">+</span><span class="num" id="5020187">1</span><span class="op" id="5020188">:</span><span class="op" id="5020189">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5020193">//&nbsp;Look&nbsp;up&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020218"><a href="/net/rpc/server.go.html#5019403">server</a></span><span class="op" id="5020224">.</span><span class="ident" id="5020225">mu</span><span class="op" id="5020227">.</span><span class="ident" id="5020228">RLock</span><span class="op" id="5020233">(</span><span class="op" id="5020234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020237"><a href="/net/rpc/server.go.html#5019457">service</a></span>&nbsp;<span class="op" id="5020245">=</span>&nbsp;<span class="ident" id="5020247"><a href="/net/rpc/server.go.html#5019403">server</a></span><span class="op" id="5020253">.</span><span class="ident" id="5020254">serviceMap</span><span class="op" id="5020264">[</span><span class="ident" id="5020265"><a href="/net/rpc/server.go.html#5020111">serviceName</a></span><span class="op" id="5020276">]</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020279"><a href="/net/rpc/server.go.html#5019403">server</a></span><span class="op" id="5020285">.</span><span class="ident" id="5020286">mu</span><span class="op" id="5020288">.</span><span class="ident" id="5020289">RUnlock</span><span class="op" id="5020296">(</span><span class="op" id="5020297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020300">if</span>&nbsp;<span class="ident" id="5020303"><a href="/net/rpc/server.go.html#5019457">service</a></span>&nbsp;<span class="op" id="5020311">==</span>&nbsp;<span class="ident" id="5020314">nil</span>&nbsp;<span class="op" id="5020318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020322"><a href="/net/rpc/server.go.html#5019526">err</a></span>&nbsp;<span class="op" id="5020326">=</span>&nbsp;<span class="ident" id="5020328"><a href="/net/rpc/server.go.html#5006846">errors</a></span><span class="op" id="5020334">.</span><span class="ident" id="5020335">New</span><span class="op" id="5020338">(</span><span class="string" id="5020339">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;service&nbsp;&#34;</span>&nbsp;<span class="op" id="5020366">+</span>&nbsp;<span class="ident" id="5020368"><a href="/net/rpc/server.go.html#5019494">req</a></span><span class="op" id="5020371">.</span><span class="ident" id="5020372">ServiceMethod</span><span class="op" id="5020385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020389">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020397">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020400"><a href="/net/rpc/server.go.html#5019475">mtype</a></span>&nbsp;<span class="op" id="5020406">=</span>&nbsp;<span class="ident" id="5020408"><a href="/net/rpc/server.go.html#5019457">service</a></span><span class="op" id="5020415">.</span><span class="ident" id="5020416">method</span><span class="op" id="5020422">[</span><span class="ident" id="5020423"><a href="/net/rpc/server.go.html#5020151">methodName</a></span><span class="op" id="5020433">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020436">if</span>&nbsp;<span class="ident" id="5020439"><a href="/net/rpc/server.go.html#5019475">mtype</a></span>&nbsp;<span class="op" id="5020445">==</span>&nbsp;<span class="ident" id="5020448">nil</span>&nbsp;<span class="op" id="5020452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020456"><a href="/net/rpc/server.go.html#5019526">err</a></span>&nbsp;<span class="op" id="5020460">=</span>&nbsp;<span class="ident" id="5020462"><a href="/net/rpc/server.go.html#5006846">errors</a></span><span class="op" id="5020468">.</span><span class="ident" id="5020469">New</span><span class="op" id="5020472">(</span><span class="string" id="5020473">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;&#34;</span>&nbsp;<span class="op" id="5020499">+</span>&nbsp;<span class="ident" id="5020501"><a href="/net/rpc/server.go.html#5019494">req</a></span><span class="op" id="5020504">.</span><span class="ident" id="5020505">ServiceMethod</span><span class="op" id="5020518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020524">return</span><br>
<span class="lineno">610</span><span class="op" id="5020531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5020534">//&nbsp;Accept&nbsp;accepts&nbsp;connections&nbsp;on&nbsp;the&nbsp;listener&nbsp;and&nbsp;serves&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="5020600">//&nbsp;for&nbsp;each&nbsp;incoming&nbsp;connection.&nbsp;&nbsp;Accept&nbsp;blocks;&nbsp;the&nbsp;caller&nbsp;typically</span><br>
<span class="lineno"></span><span class="comment" id="5020670">//&nbsp;invokes&nbsp;it&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno">615</span><span class="keyword" id="5020703">func</span>&nbsp;<span class="op" id="5020708">(</span><span class="ident" id="5020709">server</span>&nbsp;<span class="op" id="5020716">*</span><span class="ident" id="5020717"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5020723">)</span>&nbsp;<span class="ident" id="5020725">Accept</span><span class="op" id="5020731">(</span><span class="ident" id="5020732">lis</span>&nbsp;<span class="ident" id="5020736"><a href="/net/rpc/server.go.html#5006869">net</a></span><span class="op" id="5020739">.</span><span class="ident" id="5020740">Listener</span><span class="op" id="5020748">)</span>&nbsp;<span class="op" id="5020750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020753">for</span>&nbsp;<span class="op" id="5020757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020761">conn</span><span class="op" id="5020765">,</span>&nbsp;<span class="ident" id="5020767">err</span>&nbsp;<span class="op" id="5020771">:=</span>&nbsp;<span class="ident" id="5020774"><a href="/net/rpc/server.go.html#5020732">lis</a></span><span class="op" id="5020777">.</span><span class="ident" id="5020778">Accept</span><span class="op" id="5020784">(</span><span class="op" id="5020785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020789">if</span>&nbsp;<span class="ident" id="5020792"><a href="/net/rpc/server.go.html#5020767">err</a></span>&nbsp;<span class="op" id="5020796">!=</span>&nbsp;<span class="ident" id="5020799">nil</span>&nbsp;<span class="op" id="5020803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020808"><a href="/net/rpc/server.go.html#5006862">log</a></span><span class="op" id="5020811">.</span><span class="ident" id="5020812">Fatal</span><span class="op" id="5020817">(</span><span class="string" id="5020818">&#34;rpc.Serve:&nbsp;accept:&#34;</span><span class="op" id="5020838">,</span>&nbsp;<span class="ident" id="5020840"><a href="/net/rpc/server.go.html#5020767">err</a></span><span class="op" id="5020843">.</span><span class="ident" id="5020844">Error</span><span class="op" id="5020849">(</span><span class="op" id="5020850">)</span><span class="op" id="5020851">)</span>&nbsp;<span class="comment" id="5020853">//&nbsp;TODO(r):&nbsp;exit?</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020877">go</span>&nbsp;<span class="ident" id="5020880"><a href="/net/rpc/server.go.html#5020709">server</a></span><span class="op" id="5020886">.</span><span class="ident" id="5020887">ServeConn</span><span class="op" id="5020896">(</span><span class="ident" id="5020897"><a href="/net/rpc/server.go.html#5020761">conn</a></span><span class="op" id="5020901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020904">}</span><br>
<span class="lineno"></span><span class="op" id="5020906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="5020909">//&nbsp;Register&nbsp;publishes&nbsp;the&nbsp;receiver&#39;s&nbsp;methods&nbsp;in&nbsp;the&nbsp;DefaultServer.</span><br>
<span class="lineno"></span><span class="keyword" id="5020976">func</span>&nbsp;<span class="ident" id="5020981">Register</span><span class="op" id="5020989">(</span><span class="ident" id="5020990">rcvr</span>&nbsp;<span class="keyword" id="5020995">interface</span><span class="op" id="5021004">{</span><span class="op" id="5021005">}</span><span class="op" id="5021006">)</span>&nbsp;<span class="builtintype" id="5021008">error</span>&nbsp;<span class="op" id="5021014">{</span>&nbsp;<span class="keyword" id="5021016">return</span>&nbsp;<span class="ident" id="5021023"><a href="/net/rpc/server.go.html#5008862">DefaultServer</a></span><span class="op" id="5021036">.</span><span class="ident" id="5021037">Register</span><span class="op" id="5021045">(</span><span class="ident" id="5021046"><a href="/net/rpc/server.go.html#5020990">rcvr</a></span><span class="op" id="5021050">)</span>&nbsp;<span class="op" id="5021052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5021055">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5021128">//&nbsp;instead&nbsp;of&nbsp;the&nbsp;receiver&#39;s&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno">630</span><span class="keyword" id="5021172">func</span>&nbsp;<span class="ident" id="5021177">RegisterName</span><span class="op" id="5021189">(</span><span class="ident" id="5021190">name</span>&nbsp;<span class="builtintype" id="5021195">string</span><span class="op" id="5021201">,</span>&nbsp;<span class="ident" id="5021203">rcvr</span>&nbsp;<span class="keyword" id="5021208">interface</span><span class="op" id="5021217">{</span><span class="op" id="5021218">}</span><span class="op" id="5021219">)</span>&nbsp;<span class="builtintype" id="5021221">error</span>&nbsp;<span class="op" id="5021227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021230">return</span>&nbsp;<span class="ident" id="5021237"><a href="/net/rpc/server.go.html#5008862">DefaultServer</a></span><span class="op" id="5021250">.</span><span class="ident" id="5021251">RegisterName</span><span class="op" id="5021263">(</span><span class="ident" id="5021264"><a href="/net/rpc/server.go.html#5021190">name</a></span><span class="op" id="5021268">,</span>&nbsp;<span class="ident" id="5021270"><a href="/net/rpc/server.go.html#5021203">rcvr</a></span><span class="op" id="5021274">)</span><br>
<span class="lineno"></span><span class="op" id="5021276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5021279">//&nbsp;A&nbsp;ServerCodec&nbsp;implements&nbsp;reading&nbsp;of&nbsp;RPC&nbsp;requests&nbsp;and&nbsp;writing&nbsp;of</span><br>
<span class="lineno">635</span><span class="comment" id="5021346">//&nbsp;RPC&nbsp;responses&nbsp;for&nbsp;the&nbsp;server&nbsp;side&nbsp;of&nbsp;an&nbsp;RPC&nbsp;session.</span><br>
<span class="lineno"></span><span class="comment" id="5021402">//&nbsp;The&nbsp;server&nbsp;calls&nbsp;ReadRequestHeader&nbsp;and&nbsp;ReadRequestBody&nbsp;in&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5021469">//&nbsp;to&nbsp;read&nbsp;requests&nbsp;from&nbsp;the&nbsp;connection,&nbsp;and&nbsp;it&nbsp;calls&nbsp;WriteResponse&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5021540">//&nbsp;write&nbsp;a&nbsp;response&nbsp;back.&nbsp;&nbsp;The&nbsp;server&nbsp;calls&nbsp;Close&nbsp;when&nbsp;finished&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5021613">//&nbsp;connection.&nbsp;ReadRequestBody&nbsp;may&nbsp;be&nbsp;called&nbsp;with&nbsp;a&nbsp;nil</span><br>
<span class="lineno">640</span><span class="comment" id="5021669">//&nbsp;argument&nbsp;to&nbsp;force&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;request&nbsp;to&nbsp;be&nbsp;read&nbsp;and&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5021740">type</span>&nbsp;<span class="ident" id="5021745">ServerCodec</span>&nbsp;<span class="keyword" id="5021757">interface</span>&nbsp;<span class="op" id="5021767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021770">ReadRequestHeader</span><span class="op" id="5021787">(</span><span class="op" id="5021788">*</span><span class="ident" id="5021789"><a href="/net/rpc/server.go.html#5007827">Request</a></span><span class="op" id="5021796">)</span>&nbsp;<span class="builtintype" id="5021798">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021805">ReadRequestBody</span><span class="op" id="5021820">(</span><span class="keyword" id="5021821">interface</span><span class="op" id="5021830">{</span><span class="op" id="5021831">}</span><span class="op" id="5021832">)</span>&nbsp;<span class="builtintype" id="5021834">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021841">//&nbsp;WriteResponse&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021915">WriteResponse</span><span class="op" id="5021928">(</span><span class="op" id="5021929">*</span><span class="ident" id="5021930"><a href="/net/rpc/server.go.html#5008185">Response</a></span><span class="op" id="5021938">,</span>&nbsp;<span class="keyword" id="5021940">interface</span><span class="op" id="5021949">{</span><span class="op" id="5021950">}</span><span class="op" id="5021951">)</span>&nbsp;<span class="builtintype" id="5021953">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021961">Close</span><span class="op" id="5021966">(</span><span class="op" id="5021967">)</span>&nbsp;<span class="builtintype" id="5021969">error</span><br>
<span class="lineno"></span><span class="op" id="5021975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span><span class="comment" id="5021978">//&nbsp;ServeConn&nbsp;runs&nbsp;the&nbsp;DefaultServer&nbsp;on&nbsp;a&nbsp;single&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5022038">//&nbsp;ServeConn&nbsp;blocks,&nbsp;serving&nbsp;the&nbsp;connection&nbsp;until&nbsp;the&nbsp;client&nbsp;hangs&nbsp;up.</span><br>
<span class="lineno"></span><span class="comment" id="5022109">//&nbsp;The&nbsp;caller&nbsp;typically&nbsp;invokes&nbsp;ServeConn&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="5022170">//&nbsp;ServeConn&nbsp;uses&nbsp;the&nbsp;gob&nbsp;wire&nbsp;format&nbsp;(see&nbsp;package&nbsp;gob)&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5022233">//&nbsp;connection.&nbsp;&nbsp;To&nbsp;use&nbsp;an&nbsp;alternate&nbsp;codec,&nbsp;use&nbsp;ServeCodec.</span><br>
<span class="lineno">655</span><span class="keyword" id="5022292">func</span>&nbsp;<span class="ident" id="5022297">ServeConn</span><span class="op" id="5022306">(</span><span class="ident" id="5022307">conn</span>&nbsp;<span class="ident" id="5022312"><a href="/net/rpc/server.go.html#5006856">io</a></span><span class="op" id="5022314">.</span><span class="ident" id="5022315">ReadWriteCloser</span><span class="op" id="5022330">)</span>&nbsp;<span class="op" id="5022332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022335"><a href="/net/rpc/server.go.html#5008862">DefaultServer</a></span><span class="op" id="5022348">.</span><span class="ident" id="5022349">ServeConn</span><span class="op" id="5022358">(</span><span class="ident" id="5022359"><a href="/net/rpc/server.go.html#5022307">conn</a></span><span class="op" id="5022363">)</span><br>
<span class="lineno"></span><span class="op" id="5022365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5022368">//&nbsp;ServeCodec&nbsp;is&nbsp;like&nbsp;ServeConn&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified&nbsp;codec&nbsp;to</span><br>
<span class="lineno">660</span><span class="comment" id="5022432">//&nbsp;decode&nbsp;requests&nbsp;and&nbsp;encode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="5022473">func</span>&nbsp;<span class="ident" id="5022478">ServeCodec</span><span class="op" id="5022488">(</span><span class="ident" id="5022489">codec</span>&nbsp;<span class="ident" id="5022495"><a href="/net/rpc/server.go.html#5021745">ServerCodec</a></span><span class="op" id="5022506">)</span>&nbsp;<span class="op" id="5022508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022511"><a href="/net/rpc/server.go.html#5008862">DefaultServer</a></span><span class="op" id="5022524">.</span><span class="ident" id="5022525">ServeCodec</span><span class="op" id="5022535">(</span><span class="ident" id="5022536"><a href="/net/rpc/server.go.html#5022489">codec</a></span><span class="op" id="5022541">)</span><br>
<span class="lineno"></span><span class="op" id="5022543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">665</span><span class="comment" id="5022546">//&nbsp;ServeRequest&nbsp;is&nbsp;like&nbsp;ServeCodec&nbsp;but&nbsp;synchronously&nbsp;serves&nbsp;a&nbsp;single&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="5022624">//&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;codec&nbsp;upon&nbsp;completion.</span><br>
<span class="lineno"></span><span class="keyword" id="5022672">func</span>&nbsp;<span class="ident" id="5022677">ServeRequest</span><span class="op" id="5022689">(</span><span class="ident" id="5022690">codec</span>&nbsp;<span class="ident" id="5022696"><a href="/net/rpc/server.go.html#5021745">ServerCodec</a></span><span class="op" id="5022707">)</span>&nbsp;<span class="builtintype" id="5022709">error</span>&nbsp;<span class="op" id="5022715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022718">return</span>&nbsp;<span class="ident" id="5022725"><a href="/net/rpc/server.go.html#5008862">DefaultServer</a></span><span class="op" id="5022738">.</span><span class="ident" id="5022739">ServeRequest</span><span class="op" id="5022751">(</span><span class="ident" id="5022752"><a href="/net/rpc/server.go.html#5022690">codec</a></span><span class="op" id="5022757">)</span><br>
<span class="lineno"></span><span class="op" id="5022759">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="5022762">//&nbsp;Accept&nbsp;accepts&nbsp;connections&nbsp;on&nbsp;the&nbsp;listener&nbsp;and&nbsp;serves&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="5022828">//&nbsp;to&nbsp;DefaultServer&nbsp;for&nbsp;each&nbsp;incoming&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5022878">//&nbsp;Accept&nbsp;blocks;&nbsp;the&nbsp;caller&nbsp;typically&nbsp;invokes&nbsp;it&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="5022947">func</span>&nbsp;<span class="ident" id="5022952">Accept</span><span class="op" id="5022958">(</span><span class="ident" id="5022959">lis</span>&nbsp;<span class="ident" id="5022963"><a href="/net/rpc/server.go.html#5006869">net</a></span><span class="op" id="5022966">.</span><span class="ident" id="5022967">Listener</span><span class="op" id="5022975">)</span>&nbsp;<span class="op" id="5022977">{</span>&nbsp;<span class="ident" id="5022979"><a href="/net/rpc/server.go.html#5008862">DefaultServer</a></span><span class="op" id="5022992">.</span><span class="ident" id="5022993">Accept</span><span class="op" id="5022999">(</span><span class="ident" id="5023000"><a href="/net/rpc/server.go.html#5022959">lis</a></span><span class="op" id="5023003">)</span>&nbsp;<span class="op" id="5023005">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="comment" id="5023008">//&nbsp;Can&nbsp;connect&nbsp;to&nbsp;RPC&nbsp;service&nbsp;using&nbsp;HTTP&nbsp;CONNECT&nbsp;to&nbsp;rpcPath.</span><br>
<span class="lineno"></span><span class="keyword" id="5023069">var</span>&nbsp;<span class="ident" id="5023073">connected</span>&nbsp;<span class="op" id="5023083">=</span>&nbsp;<span class="string" id="5023085">&#34;200&nbsp;Connected&nbsp;to&nbsp;Go&nbsp;RPC&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5023112">//&nbsp;ServeHTTP&nbsp;implements&nbsp;an&nbsp;http.Handler&nbsp;that&nbsp;answers&nbsp;RPC&nbsp;requests.</span><br>
<span class="lineno">680</span><span class="keyword" id="5023179">func</span>&nbsp;<span class="op" id="5023184">(</span><span class="ident" id="5023185">server</span>&nbsp;<span class="op" id="5023192">*</span><span class="ident" id="5023193"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5023199">)</span>&nbsp;<span class="ident" id="5023201">ServeHTTP</span><span class="op" id="5023210">(</span><span class="ident" id="5023211">w</span>&nbsp;<span class="ident" id="5023213"><a href="/net/rpc/server.go.html#5006876">http</a></span><span class="op" id="5023217">.</span><span class="ident" id="5023218">ResponseWriter</span><span class="op" id="5023232">,</span>&nbsp;<span class="ident" id="5023234">req</span>&nbsp;<span class="op" id="5023238">*</span><span class="ident" id="5023239"><a href="/net/rpc/server.go.html#5006876">http</a></span><span class="op" id="5023243">.</span><span class="ident" id="5023244">Request</span><span class="op" id="5023251">)</span>&nbsp;<span class="op" id="5023253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023256">if</span>&nbsp;<span class="ident" id="5023259"><a href="/net/rpc/server.go.html#5023234">req</a></span><span class="op" id="5023262">.</span><span class="ident" id="5023263">Method</span>&nbsp;<span class="op" id="5023270">!=</span>&nbsp;<span class="string" id="5023273">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="5023283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023287"><a href="/net/rpc/server.go.html#5023211">w</a></span><span class="op" id="5023288">.</span><span class="ident" id="5023289">Header</span><span class="op" id="5023295">(</span><span class="op" id="5023296">)</span><span class="op" id="5023297">.</span><span class="ident" id="5023298">Set</span><span class="op" id="5023301">(</span><span class="string" id="5023302">&#34;Content-Type&#34;</span><span class="op" id="5023316">,</span>&nbsp;<span class="string" id="5023318">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5023345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023349"><a href="/net/rpc/server.go.html#5023211">w</a></span><span class="op" id="5023350">.</span><span class="ident" id="5023351">WriteHeader</span><span class="op" id="5023362">(</span><span class="ident" id="5023363"><a href="/net/rpc/server.go.html#5006876">http</a></span><span class="op" id="5023367">.</span><span class="ident" id="5023368">StatusMethodNotAllowed</span><span class="op" id="5023390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023394"><a href="/net/rpc/server.go.html#5006856">io</a></span><span class="op" id="5023396">.</span><span class="ident" id="5023397">WriteString</span><span class="op" id="5023408">(</span><span class="ident" id="5023409"><a href="/net/rpc/server.go.html#5023211">w</a></span><span class="op" id="5023410">,</span>&nbsp;<span class="string" id="5023412">&#34;405&nbsp;must&nbsp;CONNECT\n&#34;</span><span class="op" id="5023432">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023436">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023447">conn</span><span class="op" id="5023451">,</span>&nbsp;<span class="ident" id="5023453">_</span><span class="op" id="5023454">,</span>&nbsp;<span class="ident" id="5023456">err</span>&nbsp;<span class="op" id="5023460">:=</span>&nbsp;<span class="ident" id="5023463"><a href="/net/rpc/server.go.html#5023211">w</a></span><span class="op" id="5023464">.</span><span class="op" id="5023465">(</span><span class="ident" id="5023466"><a href="/net/rpc/server.go.html#5006876">http</a></span><span class="op" id="5023470">.</span><span class="ident" id="5023471">Hijacker</span><span class="op" id="5023479">)</span><span class="op" id="5023480">.</span><span class="ident" id="5023481">Hijack</span><span class="op" id="5023487">(</span><span class="op" id="5023488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023491">if</span>&nbsp;<span class="ident" id="5023494"><a href="/net/rpc/server.go.html#5023456">err</a></span>&nbsp;<span class="op" id="5023498">!=</span>&nbsp;<span class="ident" id="5023501">nil</span>&nbsp;<span class="op" id="5023505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023509"><a href="/net/rpc/server.go.html#5006862">log</a></span><span class="op" id="5023512">.</span><span class="ident" id="5023513">Print</span><span class="op" id="5023518">(</span><span class="string" id="5023519">&#34;rpc&nbsp;hijacking&nbsp;&#34;</span><span class="op" id="5023535">,</span>&nbsp;<span class="ident" id="5023537"><a href="/net/rpc/server.go.html#5023234">req</a></span><span class="op" id="5023540">.</span><span class="ident" id="5023541">RemoteAddr</span><span class="op" id="5023551">,</span>&nbsp;<span class="string" id="5023553">&#34;:&nbsp;&#34;</span><span class="op" id="5023557">,</span>&nbsp;<span class="ident" id="5023559"><a href="/net/rpc/server.go.html#5023456">err</a></span><span class="op" id="5023562">.</span><span class="ident" id="5023563">Error</span><span class="op" id="5023568">(</span><span class="op" id="5023569">)</span><span class="op" id="5023570">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023574">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023585"><a href="/net/rpc/server.go.html#5006856">io</a></span><span class="op" id="5023587">.</span><span class="ident" id="5023588">WriteString</span><span class="op" id="5023599">(</span><span class="ident" id="5023600"><a href="/net/rpc/server.go.html#5023447">conn</a></span><span class="op" id="5023604">,</span>&nbsp;<span class="string" id="5023606">&#34;HTTP/1.0&nbsp;&#34;</span><span class="op" id="5023617">+</span><span class="ident" id="5023618"><a href="/net/rpc/server.go.html#5023073">connected</a></span><span class="op" id="5023627">+</span><span class="string" id="5023628">&#34;\n\n&#34;</span><span class="op" id="5023634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023637"><a href="/net/rpc/server.go.html#5023185">server</a></span><span class="op" id="5023643">.</span><span class="ident" id="5023644">ServeConn</span><span class="op" id="5023653">(</span><span class="ident" id="5023654"><a href="/net/rpc/server.go.html#5023447">conn</a></span><span class="op" id="5023658">)</span><br>
<span class="lineno"></span><span class="op" id="5023660">}</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span><span class="comment" id="5023663">//&nbsp;HandleHTTP&nbsp;registers&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;for&nbsp;RPC&nbsp;messages&nbsp;on&nbsp;rpcPath,</span><br>
<span class="lineno"></span><span class="comment" id="5023732">//&nbsp;and&nbsp;a&nbsp;debugging&nbsp;handler&nbsp;on&nbsp;debugPath.</span><br>
<span class="lineno"></span><span class="comment" id="5023773">//&nbsp;It&nbsp;is&nbsp;still&nbsp;necessary&nbsp;to&nbsp;invoke&nbsp;http.Serve(),&nbsp;typically&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="5023851">func</span>&nbsp;<span class="op" id="5023856">(</span><span class="ident" id="5023857">server</span>&nbsp;<span class="op" id="5023864">*</span><span class="ident" id="5023865"><a href="/net/rpc/server.go.html#5008452">Server</a></span><span class="op" id="5023871">)</span>&nbsp;<span class="ident" id="5023873">HandleHTTP</span><span class="op" id="5023883">(</span><span class="ident" id="5023884">rpcPath</span><span class="op" id="5023891">,</span>&nbsp;<span class="ident" id="5023893">debugPath</span>&nbsp;<span class="builtintype" id="5023903">string</span><span class="op" id="5023909">)</span>&nbsp;<span class="op" id="5023911">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023914"><a href="/net/rpc/server.go.html#5006876">http</a></span><span class="op" id="5023918">.</span><span class="ident" id="5023919">Handle</span><span class="op" id="5023925">(</span><span class="ident" id="5023926"><a href="/net/rpc/server.go.html#5023884">rpcPath</a></span><span class="op" id="5023933">,</span>&nbsp;<span class="ident" id="5023935"><a href="/net/rpc/server.go.html#5023857">server</a></span><span class="op" id="5023941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023944"><a href="/net/rpc/server.go.html#5006876">http</a></span><span class="op" id="5023948">.</span><span class="ident" id="5023949">Handle</span><span class="op" id="5023955">(</span><span class="ident" id="5023956"><a href="/net/rpc/server.go.html#5023893">debugPath</a></span><span class="op" id="5023965">,</span>&nbsp;<span class="ident" id="5023967"><a href="/net/rpc/debug.go.html#5002094">debugHTTP</a></span><span class="op" id="5023976">{</span><span class="ident" id="5023977"><a href="/net/rpc/server.go.html#5023857">server</a></span><span class="op" id="5023983">}</span><span class="op" id="5023984">)</span><br>
<span class="lineno"></span><span class="op" id="5023986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5023989">//&nbsp;HandleHTTP&nbsp;registers&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;for&nbsp;RPC&nbsp;messages&nbsp;to&nbsp;DefaultServer</span><br>
<span class="lineno">705</span><span class="comment" id="5024063">//&nbsp;on&nbsp;DefaultRPCPath&nbsp;and&nbsp;a&nbsp;debugging&nbsp;handler&nbsp;on&nbsp;DefaultDebugPath.</span><br>
<span class="lineno"></span><span class="comment" id="5024129">//&nbsp;It&nbsp;is&nbsp;still&nbsp;necessary&nbsp;to&nbsp;invoke&nbsp;http.Serve(),&nbsp;typically&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="5024207">func</span>&nbsp;<span class="ident" id="5024212">HandleHTTP</span><span class="op" id="5024222">(</span><span class="op" id="5024223">)</span>&nbsp;<span class="op" id="5024225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024228"><a href="/net/rpc/server.go.html#5008862">DefaultServer</a></span><span class="op" id="5024241">.</span><span class="ident" id="5024242">HandleHTTP</span><span class="op" id="5024252">(</span><span class="ident" id="5024253"><a href="/net/rpc/server.go.html#5006988">DefaultRPCPath</a></span><span class="op" id="5024267">,</span>&nbsp;<span class="ident" id="5024269"><a href="/net/rpc/server.go.html#5007019">DefaultDebugPath</a></span><span class="op" id="5024285">)</span><br>
<span class="lineno"></span><span class="op" id="5024287">}</span>
</div>
</body>
</html>
