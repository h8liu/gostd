<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html" class="current">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3406829">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3406884">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3406938">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3406989">//&nbsp;Package&nbsp;httptest&nbsp;provides&nbsp;utilities&nbsp;for&nbsp;HTTP&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="3407046">package</span>&nbsp;<span class="ident" id="3407054">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3407064">import</span>&nbsp;<span class="op" id="3407071">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3407074">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3407083">&#34;net/http&#34;</span><br>
<span class="lineno"></span><span class="op" id="3407094">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3407097">//&nbsp;ResponseRecorder&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;http.ResponseWriter&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3407166">//&nbsp;records&nbsp;its&nbsp;mutations&nbsp;for&nbsp;later&nbsp;inspection&nbsp;in&nbsp;tests.</span><br>
<span class="lineno">15</span><span class="keyword" id="3407222">type</span>&nbsp;<span class="ident" id="3407227">ResponseRecorder</span>&nbsp;<span class="keyword" id="3407244">struct</span>&nbsp;<span class="op" id="3407251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407254">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3407264">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3407278">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;code&nbsp;from&nbsp;WriteHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407322">HeaderMap</span>&nbsp;<span class="ident" id="3407332">http</span><span class="op" id="3407336">.</span><span class="ident" id="3407337">Header</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3407346">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407376">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3407386">*</span><span class="ident" id="3407387">bytes</span><span class="op" id="3407392">.</span><span class="ident" id="3407393">Buffer</span>&nbsp;<span class="comment" id="3407400">//&nbsp;if&nbsp;non-nil,&nbsp;the&nbsp;bytes.Buffer&nbsp;to&nbsp;append&nbsp;written&nbsp;data&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407459">Flushed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3407469">bool</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407476">wroteHeader</span>&nbsp;<span class="builtintype" id="3407488">bool</span><br>
<span class="lineno"></span><span class="op" id="3407493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3407496">//&nbsp;NewRecorder&nbsp;returns&nbsp;an&nbsp;initialized&nbsp;ResponseRecorder.</span><br>
<span class="lineno">25</span><span class="keyword" id="3407552">func</span>&nbsp;<span class="ident" id="3407557">NewRecorder</span><span class="op" id="3407568">(</span><span class="op" id="3407569">)</span>&nbsp;<span class="op" id="3407571">*</span><span class="ident" id="3407572">ResponseRecorder</span>&nbsp;<span class="op" id="3407589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3407592">return</span>&nbsp;<span class="op" id="3407599">&amp;</span><span class="ident" id="3407600">ResponseRecorder</span><span class="op" id="3407616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407620">HeaderMap</span><span class="op" id="3407629">:</span>&nbsp;<span class="builtinfunc" id="3407631">make</span><span class="op" id="3407635">(</span><span class="ident" id="3407636">http</span><span class="op" id="3407640">.</span><span class="ident" id="3407641">Header</span><span class="op" id="3407647">)</span><span class="op" id="3407648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407652">Body</span><span class="op" id="3407656">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3407663">new</span><span class="op" id="3407666">(</span><span class="ident" id="3407667">bytes</span><span class="op" id="3407672">.</span><span class="ident" id="3407673">Buffer</span><span class="op" id="3407679">)</span><span class="op" id="3407680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407684">Code</span><span class="op" id="3407688">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3407695">200</span><span class="op" id="3407698">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3407701">}</span><br>
<span class="lineno"></span><span class="op" id="3407703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3407706">//&nbsp;DefaultRemoteAddr&nbsp;is&nbsp;the&nbsp;default&nbsp;remote&nbsp;address&nbsp;to&nbsp;return&nbsp;in&nbsp;RemoteAddr&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3407784">//&nbsp;an&nbsp;explicit&nbsp;DefaultRemoteAddr&nbsp;isn&#39;t&nbsp;set&nbsp;on&nbsp;ResponseRecorder.</span><br>
<span class="lineno">35</span><span class="keyword" id="3407848">const</span>&nbsp;<span class="ident" id="3407854">DefaultRemoteAddr</span>&nbsp;<span class="op" id="3407872">=</span>&nbsp;<span class="string" id="3407874">&#34;1.2.3.4&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3407885">//&nbsp;Header&nbsp;returns&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="3407925">func</span>&nbsp;<span class="op" id="3407930">(</span><span class="ident" id="3407931">rw</span>&nbsp;<span class="op" id="3407934">*</span><span class="ident" id="3407935">ResponseRecorder</span><span class="op" id="3407951">)</span>&nbsp;<span class="ident" id="3407953">Header</span><span class="op" id="3407959">(</span><span class="op" id="3407960">)</span>&nbsp;<span class="ident" id="3407962">http</span><span class="op" id="3407966">.</span><span class="ident" id="3407967">Header</span>&nbsp;<span class="op" id="3407974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3407977">m</span>&nbsp;<span class="op" id="3407979">:=</span>&nbsp;<span class="ident" id="3407982">rw</span><span class="op" id="3407984">.</span><span class="ident" id="3407985">HeaderMap</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3407996">if</span>&nbsp;<span class="ident" id="3407999">m</span>&nbsp;<span class="op" id="3408001">==</span>&nbsp;<span class="ident" id="3408004">nil</span>&nbsp;<span class="op" id="3408008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3408012">m</span>&nbsp;<span class="op" id="3408014">=</span>&nbsp;<span class="builtinfunc" id="3408016">make</span><span class="op" id="3408020">(</span><span class="ident" id="3408021">http</span><span class="op" id="3408025">.</span><span class="ident" id="3408026">Header</span><span class="op" id="3408032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3408036">rw</span><span class="op" id="3408038">.</span><span class="ident" id="3408039">HeaderMap</span>&nbsp;<span class="op" id="3408049">=</span>&nbsp;<span class="ident" id="3408051">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3408054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3408057">return</span>&nbsp;<span class="ident" id="3408064">m</span><br>
<span class="lineno">45</span><span class="op" id="3408066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3408069">//&nbsp;Write&nbsp;always&nbsp;succeeds&nbsp;and&nbsp;writes&nbsp;to&nbsp;rw.Body,&nbsp;if&nbsp;not&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3408129">func</span>&nbsp;<span class="op" id="3408134">(</span><span class="ident" id="3408135">rw</span>&nbsp;<span class="op" id="3408138">*</span><span class="ident" id="3408139">ResponseRecorder</span><span class="op" id="3408155">)</span>&nbsp;<span class="ident" id="3408157">Write</span><span class="op" id="3408162">(</span><span class="ident" id="3408163">buf</span>&nbsp;<span class="op" id="3408167">[</span><span class="op" id="3408168">]</span><span class="builtintype" id="3408169">byte</span><span class="op" id="3408173">)</span>&nbsp;<span class="op" id="3408175">(</span><span class="builtintype" id="3408176">int</span><span class="op" id="3408179">,</span>&nbsp;<span class="builtintype" id="3408181">error</span><span class="op" id="3408186">)</span>&nbsp;<span class="op" id="3408188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3408191">if</span>&nbsp;<span class="op" id="3408194">!</span><span class="ident" id="3408195">rw</span><span class="op" id="3408197">.</span><span class="ident" id="3408198">wroteHeader</span>&nbsp;<span class="op" id="3408210">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3408214">rw</span><span class="op" id="3408216">.</span><span class="ident" id="3408217">WriteHeader</span><span class="op" id="3408228">(</span><span class="num" id="3408229">200</span><span class="op" id="3408232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3408235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3408238">if</span>&nbsp;<span class="ident" id="3408241">rw</span><span class="op" id="3408243">.</span><span class="ident" id="3408244">Body</span>&nbsp;<span class="op" id="3408249">!=</span>&nbsp;<span class="ident" id="3408252">nil</span>&nbsp;<span class="op" id="3408256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3408260">rw</span><span class="op" id="3408262">.</span><span class="ident" id="3408263">Body</span><span class="op" id="3408267">.</span><span class="ident" id="3408268">Write</span><span class="op" id="3408273">(</span><span class="ident" id="3408274">buf</span><span class="op" id="3408277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3408280">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3408283">return</span>&nbsp;<span class="builtinfunc" id="3408290">len</span><span class="op" id="3408293">(</span><span class="ident" id="3408294">buf</span><span class="op" id="3408297">)</span><span class="op" id="3408298">,</span>&nbsp;<span class="ident" id="3408300">nil</span><br>
<span class="lineno"></span><span class="op" id="3408304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3408307">//&nbsp;WriteHeader&nbsp;sets&nbsp;rw.Code.</span><br>
<span class="lineno"></span><span class="keyword" id="3408336">func</span>&nbsp;<span class="op" id="3408341">(</span><span class="ident" id="3408342">rw</span>&nbsp;<span class="op" id="3408345">*</span><span class="ident" id="3408346">ResponseRecorder</span><span class="op" id="3408362">)</span>&nbsp;<span class="ident" id="3408364">WriteHeader</span><span class="op" id="3408375">(</span><span class="ident" id="3408376">code</span>&nbsp;<span class="builtintype" id="3408381">int</span><span class="op" id="3408384">)</span>&nbsp;<span class="op" id="3408386">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3408389">if</span>&nbsp;<span class="op" id="3408392">!</span><span class="ident" id="3408393">rw</span><span class="op" id="3408395">.</span><span class="ident" id="3408396">wroteHeader</span>&nbsp;<span class="op" id="3408408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3408412">rw</span><span class="op" id="3408414">.</span><span class="ident" id="3408415">Code</span>&nbsp;<span class="op" id="3408420">=</span>&nbsp;<span class="ident" id="3408422">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3408428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3408431">rw</span><span class="op" id="3408433">.</span><span class="ident" id="3408434">wroteHeader</span>&nbsp;<span class="op" id="3408446">=</span>&nbsp;<span class="builtintype" id="3408448">true</span><br>
<span class="lineno"></span><span class="op" id="3408453">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="3408456">//&nbsp;Flush&nbsp;sets&nbsp;rw.Flushed&nbsp;to&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="3408490">func</span>&nbsp;<span class="op" id="3408495">(</span><span class="ident" id="3408496">rw</span>&nbsp;<span class="op" id="3408499">*</span><span class="ident" id="3408500">ResponseRecorder</span><span class="op" id="3408516">)</span>&nbsp;<span class="ident" id="3408518">Flush</span><span class="op" id="3408523">(</span><span class="op" id="3408524">)</span>&nbsp;<span class="op" id="3408526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3408529">if</span>&nbsp;<span class="op" id="3408532">!</span><span class="ident" id="3408533">rw</span><span class="op" id="3408535">.</span><span class="ident" id="3408536">wroteHeader</span>&nbsp;<span class="op" id="3408548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3408552">rw</span><span class="op" id="3408554">.</span><span class="ident" id="3408555">WriteHeader</span><span class="op" id="3408566">(</span><span class="num" id="3408567">200</span><span class="op" id="3408570">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3408573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3408576">rw</span><span class="op" id="3408578">.</span><span class="ident" id="3408579">Flushed</span>&nbsp;<span class="op" id="3408587">=</span>&nbsp;<span class="builtintype" id="3408589">true</span><br>
<span class="lineno"></span><span class="op" id="3408594">}</span>
</div>
</body>
</html>
