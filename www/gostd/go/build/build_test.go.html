<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/build</h2>
<ul>
<li><a href="/gostd/go/build/build.go.html">build.go</a></li>
<li><a href="/gostd/go/build/build_test.go.html" class="current">build_test.go</a></li>
<li><a href="/gostd/go/build/deps_test.go.html">deps_test.go</a></li>
<li><a href="/gostd/go/build/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/build/read.go.html">read.go</a></li>
<li><a href="/gostd/go/build/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/go/build/syslist.go.html">syslist.go</a></li>
<li><a href="/gostd/go/build/syslist_test.go.html">syslist_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7889586">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7889642">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7889696">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7889747">package</span>&nbsp;<span class="ident" id="7889755">build</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7889762">import</span>&nbsp;<span class="op" id="7889769">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7889772">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7889778">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7889784">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7889801">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7889812">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7889823">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7889834">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7889844">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7889847">func</span>&nbsp;<span class="ident" id="7889852">TestMatch</span><span class="op" id="7889861">(</span><span class="ident" id="7889862">t</span>&nbsp;<span class="op" id="7889864">*</span><span class="ident" id="7889865">testing</span><span class="op" id="7889872">.</span><span class="ident" id="7889873">T</span><span class="op" id="7889874">)</span>&nbsp;<span class="op" id="7889876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889879">ctxt</span>&nbsp;<span class="op" id="7889884">:=</span>&nbsp;<span class="ident" id="7889887">Default</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889896">what</span>&nbsp;<span class="op" id="7889901">:=</span>&nbsp;<span class="string" id="7889904">&#34;default&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889915">match</span>&nbsp;<span class="op" id="7889921">:=</span>&nbsp;<span class="keyword" id="7889924">func</span><span class="op" id="7889928">(</span><span class="ident" id="7889929">tag</span>&nbsp;<span class="builtintype" id="7889933">string</span><span class="op" id="7889939">,</span>&nbsp;<span class="ident" id="7889941">want</span>&nbsp;<span class="keyword" id="7889946">map</span><span class="op" id="7889949">[</span><span class="builtintype" id="7889950">string</span><span class="op" id="7889956">]</span><span class="builtintype" id="7889957">bool</span><span class="op" id="7889961">)</span>&nbsp;<span class="op" id="7889963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7889967">m</span>&nbsp;<span class="op" id="7889969">:=</span>&nbsp;<span class="builtinfunc" id="7889972">make</span><span class="op" id="7889976">(</span><span class="keyword" id="7889977">map</span><span class="op" id="7889980">[</span><span class="builtintype" id="7889981">string</span><span class="op" id="7889987">]</span><span class="builtintype" id="7889988">bool</span><span class="op" id="7889992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7889996">if</span>&nbsp;<span class="op" id="7889999">!</span><span class="ident" id="7890000">ctxt</span><span class="op" id="7890004">.</span><span class="ident" id="7890005">match</span><span class="op" id="7890010">(</span><span class="ident" id="7890011">tag</span><span class="op" id="7890014">,</span>&nbsp;<span class="ident" id="7890016">m</span><span class="op" id="7890017">)</span>&nbsp;<span class="op" id="7890019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890024">t</span><span class="op" id="7890025">.</span><span class="ident" id="7890026">Errorf</span><span class="op" id="7890032">(</span><span class="string" id="7890033">&#34;%s&nbsp;context&nbsp;should&nbsp;match&nbsp;%s,&nbsp;does&nbsp;not&#34;</span><span class="op" id="7890071">,</span>&nbsp;<span class="ident" id="7890073">what</span><span class="op" id="7890077">,</span>&nbsp;<span class="ident" id="7890079">tag</span><span class="op" id="7890082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7890086">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7890090">if</span>&nbsp;<span class="op" id="7890093">!</span><span class="ident" id="7890094">reflect</span><span class="op" id="7890101">.</span><span class="ident" id="7890102">DeepEqual</span><span class="op" id="7890111">(</span><span class="ident" id="7890112">m</span><span class="op" id="7890113">,</span>&nbsp;<span class="ident" id="7890115">want</span><span class="op" id="7890119">)</span>&nbsp;<span class="op" id="7890121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890126">t</span><span class="op" id="7890127">.</span><span class="ident" id="7890128">Errorf</span><span class="op" id="7890134">(</span><span class="string" id="7890135">&#34;%s&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7890158">,</span>&nbsp;<span class="ident" id="7890160">tag</span><span class="op" id="7890163">,</span>&nbsp;<span class="ident" id="7890165">m</span><span class="op" id="7890166">,</span>&nbsp;<span class="ident" id="7890168">want</span><span class="op" id="7890172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7890176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7890179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890182">nomatch</span>&nbsp;<span class="op" id="7890190">:=</span>&nbsp;<span class="keyword" id="7890193">func</span><span class="op" id="7890197">(</span><span class="ident" id="7890198">tag</span>&nbsp;<span class="builtintype" id="7890202">string</span><span class="op" id="7890208">,</span>&nbsp;<span class="ident" id="7890210">want</span>&nbsp;<span class="keyword" id="7890215">map</span><span class="op" id="7890218">[</span><span class="builtintype" id="7890219">string</span><span class="op" id="7890225">]</span><span class="builtintype" id="7890226">bool</span><span class="op" id="7890230">)</span>&nbsp;<span class="op" id="7890232">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890236">m</span>&nbsp;<span class="op" id="7890238">:=</span>&nbsp;<span class="builtinfunc" id="7890241">make</span><span class="op" id="7890245">(</span><span class="keyword" id="7890246">map</span><span class="op" id="7890249">[</span><span class="builtintype" id="7890250">string</span><span class="op" id="7890256">]</span><span class="builtintype" id="7890257">bool</span><span class="op" id="7890261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7890265">if</span>&nbsp;<span class="ident" id="7890268">ctxt</span><span class="op" id="7890272">.</span><span class="ident" id="7890273">match</span><span class="op" id="7890278">(</span><span class="ident" id="7890279">tag</span><span class="op" id="7890282">,</span>&nbsp;<span class="ident" id="7890284">m</span><span class="op" id="7890285">)</span>&nbsp;<span class="op" id="7890287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890292">t</span><span class="op" id="7890293">.</span><span class="ident" id="7890294">Errorf</span><span class="op" id="7890300">(</span><span class="string" id="7890301">&#34;%s&nbsp;context&nbsp;should&nbsp;NOT&nbsp;match&nbsp;%s,&nbsp;does&#34;</span><span class="op" id="7890339">,</span>&nbsp;<span class="ident" id="7890341">what</span><span class="op" id="7890345">,</span>&nbsp;<span class="ident" id="7890347">tag</span><span class="op" id="7890350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7890354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7890358">if</span>&nbsp;<span class="op" id="7890361">!</span><span class="ident" id="7890362">reflect</span><span class="op" id="7890369">.</span><span class="ident" id="7890370">DeepEqual</span><span class="op" id="7890379">(</span><span class="ident" id="7890380">m</span><span class="op" id="7890381">,</span>&nbsp;<span class="ident" id="7890383">want</span><span class="op" id="7890387">)</span>&nbsp;<span class="op" id="7890389">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890394">t</span><span class="op" id="7890395">.</span><span class="ident" id="7890396">Errorf</span><span class="op" id="7890402">(</span><span class="string" id="7890403">&#34;%s&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7890426">,</span>&nbsp;<span class="ident" id="7890428">tag</span><span class="op" id="7890431">,</span>&nbsp;<span class="ident" id="7890433">m</span><span class="op" id="7890434">,</span>&nbsp;<span class="ident" id="7890436">want</span><span class="op" id="7890440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7890444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7890447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890451">match</span><span class="op" id="7890456">(</span><span class="ident" id="7890457">runtime</span><span class="op" id="7890464">.</span><span class="ident" id="7890465">GOOS</span><span class="op" id="7890469">+</span><span class="string" id="7890470">&#34;,&#34;</span><span class="op" id="7890473">+</span><span class="ident" id="7890474">runtime</span><span class="op" id="7890481">.</span><span class="ident" id="7890482">GOARCH</span><span class="op" id="7890488">,</span>&nbsp;<span class="keyword" id="7890490">map</span><span class="op" id="7890493">[</span><span class="builtintype" id="7890494">string</span><span class="op" id="7890500">]</span><span class="builtintype" id="7890501">bool</span><span class="op" id="7890505">{</span><span class="ident" id="7890506">runtime</span><span class="op" id="7890513">.</span><span class="ident" id="7890514">GOOS</span><span class="op" id="7890518">:</span>&nbsp;<span class="builtintype" id="7890520">true</span><span class="op" id="7890524">,</span>&nbsp;<span class="ident" id="7890526">runtime</span><span class="op" id="7890533">.</span><span class="ident" id="7890534">GOARCH</span><span class="op" id="7890540">:</span>&nbsp;<span class="builtintype" id="7890542">true</span><span class="op" id="7890546">}</span><span class="op" id="7890547">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890550">match</span><span class="op" id="7890555">(</span><span class="ident" id="7890556">runtime</span><span class="op" id="7890563">.</span><span class="ident" id="7890564">GOOS</span><span class="op" id="7890568">+</span><span class="string" id="7890569">&#34;,&#34;</span><span class="op" id="7890572">+</span><span class="ident" id="7890573">runtime</span><span class="op" id="7890580">.</span><span class="ident" id="7890581">GOARCH</span><span class="op" id="7890587">+</span><span class="string" id="7890588">&#34;,!foo&#34;</span><span class="op" id="7890595">,</span>&nbsp;<span class="keyword" id="7890597">map</span><span class="op" id="7890600">[</span><span class="builtintype" id="7890601">string</span><span class="op" id="7890607">]</span><span class="builtintype" id="7890608">bool</span><span class="op" id="7890612">{</span><span class="ident" id="7890613">runtime</span><span class="op" id="7890620">.</span><span class="ident" id="7890621">GOOS</span><span class="op" id="7890625">:</span>&nbsp;<span class="builtintype" id="7890627">true</span><span class="op" id="7890631">,</span>&nbsp;<span class="ident" id="7890633">runtime</span><span class="op" id="7890640">.</span><span class="ident" id="7890641">GOARCH</span><span class="op" id="7890647">:</span>&nbsp;<span class="builtintype" id="7890649">true</span><span class="op" id="7890653">,</span>&nbsp;<span class="string" id="7890655">&#34;foo&#34;</span><span class="op" id="7890660">:</span>&nbsp;<span class="builtintype" id="7890662">true</span><span class="op" id="7890666">}</span><span class="op" id="7890667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890670">nomatch</span><span class="op" id="7890677">(</span><span class="ident" id="7890678">runtime</span><span class="op" id="7890685">.</span><span class="ident" id="7890686">GOOS</span><span class="op" id="7890690">+</span><span class="string" id="7890691">&#34;,&#34;</span><span class="op" id="7890694">+</span><span class="ident" id="7890695">runtime</span><span class="op" id="7890702">.</span><span class="ident" id="7890703">GOARCH</span><span class="op" id="7890709">+</span><span class="string" id="7890710">&#34;,foo&#34;</span><span class="op" id="7890716">,</span>&nbsp;<span class="keyword" id="7890718">map</span><span class="op" id="7890721">[</span><span class="builtintype" id="7890722">string</span><span class="op" id="7890728">]</span><span class="builtintype" id="7890729">bool</span><span class="op" id="7890733">{</span><span class="ident" id="7890734">runtime</span><span class="op" id="7890741">.</span><span class="ident" id="7890742">GOOS</span><span class="op" id="7890746">:</span>&nbsp;<span class="builtintype" id="7890748">true</span><span class="op" id="7890752">,</span>&nbsp;<span class="ident" id="7890754">runtime</span><span class="op" id="7890761">.</span><span class="ident" id="7890762">GOARCH</span><span class="op" id="7890768">:</span>&nbsp;<span class="builtintype" id="7890770">true</span><span class="op" id="7890774">,</span>&nbsp;<span class="string" id="7890776">&#34;foo&#34;</span><span class="op" id="7890781">:</span>&nbsp;<span class="builtintype" id="7890783">true</span><span class="op" id="7890787">}</span><span class="op" id="7890788">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890792">what</span>&nbsp;<span class="op" id="7890797">=</span>&nbsp;<span class="string" id="7890799">&#34;modified&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890811">ctxt</span><span class="op" id="7890815">.</span><span class="ident" id="7890816">BuildTags</span>&nbsp;<span class="op" id="7890826">=</span>&nbsp;<span class="op" id="7890828">[</span><span class="op" id="7890829">]</span><span class="builtintype" id="7890830">string</span><span class="op" id="7890836">{</span><span class="string" id="7890837">&#34;foo&#34;</span><span class="op" id="7890842">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890845">match</span><span class="op" id="7890850">(</span><span class="ident" id="7890851">runtime</span><span class="op" id="7890858">.</span><span class="ident" id="7890859">GOOS</span><span class="op" id="7890863">+</span><span class="string" id="7890864">&#34;,&#34;</span><span class="op" id="7890867">+</span><span class="ident" id="7890868">runtime</span><span class="op" id="7890875">.</span><span class="ident" id="7890876">GOARCH</span><span class="op" id="7890882">,</span>&nbsp;<span class="keyword" id="7890884">map</span><span class="op" id="7890887">[</span><span class="builtintype" id="7890888">string</span><span class="op" id="7890894">]</span><span class="builtintype" id="7890895">bool</span><span class="op" id="7890899">{</span><span class="ident" id="7890900">runtime</span><span class="op" id="7890907">.</span><span class="ident" id="7890908">GOOS</span><span class="op" id="7890912">:</span>&nbsp;<span class="builtintype" id="7890914">true</span><span class="op" id="7890918">,</span>&nbsp;<span class="ident" id="7890920">runtime</span><span class="op" id="7890927">.</span><span class="ident" id="7890928">GOARCH</span><span class="op" id="7890934">:</span>&nbsp;<span class="builtintype" id="7890936">true</span><span class="op" id="7890940">}</span><span class="op" id="7890941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890944">match</span><span class="op" id="7890949">(</span><span class="ident" id="7890950">runtime</span><span class="op" id="7890957">.</span><span class="ident" id="7890958">GOOS</span><span class="op" id="7890962">+</span><span class="string" id="7890963">&#34;,&#34;</span><span class="op" id="7890966">+</span><span class="ident" id="7890967">runtime</span><span class="op" id="7890974">.</span><span class="ident" id="7890975">GOARCH</span><span class="op" id="7890981">+</span><span class="string" id="7890982">&#34;,foo&#34;</span><span class="op" id="7890988">,</span>&nbsp;<span class="keyword" id="7890990">map</span><span class="op" id="7890993">[</span><span class="builtintype" id="7890994">string</span><span class="op" id="7891000">]</span><span class="builtintype" id="7891001">bool</span><span class="op" id="7891005">{</span><span class="ident" id="7891006">runtime</span><span class="op" id="7891013">.</span><span class="ident" id="7891014">GOOS</span><span class="op" id="7891018">:</span>&nbsp;<span class="builtintype" id="7891020">true</span><span class="op" id="7891024">,</span>&nbsp;<span class="ident" id="7891026">runtime</span><span class="op" id="7891033">.</span><span class="ident" id="7891034">GOARCH</span><span class="op" id="7891040">:</span>&nbsp;<span class="builtintype" id="7891042">true</span><span class="op" id="7891046">,</span>&nbsp;<span class="string" id="7891048">&#34;foo&#34;</span><span class="op" id="7891053">:</span>&nbsp;<span class="builtintype" id="7891055">true</span><span class="op" id="7891059">}</span><span class="op" id="7891060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891063">nomatch</span><span class="op" id="7891070">(</span><span class="ident" id="7891071">runtime</span><span class="op" id="7891078">.</span><span class="ident" id="7891079">GOOS</span><span class="op" id="7891083">+</span><span class="string" id="7891084">&#34;,&#34;</span><span class="op" id="7891087">+</span><span class="ident" id="7891088">runtime</span><span class="op" id="7891095">.</span><span class="ident" id="7891096">GOARCH</span><span class="op" id="7891102">+</span><span class="string" id="7891103">&#34;,!foo&#34;</span><span class="op" id="7891110">,</span>&nbsp;<span class="keyword" id="7891112">map</span><span class="op" id="7891115">[</span><span class="builtintype" id="7891116">string</span><span class="op" id="7891122">]</span><span class="builtintype" id="7891123">bool</span><span class="op" id="7891127">{</span><span class="ident" id="7891128">runtime</span><span class="op" id="7891135">.</span><span class="ident" id="7891136">GOOS</span><span class="op" id="7891140">:</span>&nbsp;<span class="builtintype" id="7891142">true</span><span class="op" id="7891146">,</span>&nbsp;<span class="ident" id="7891148">runtime</span><span class="op" id="7891155">.</span><span class="ident" id="7891156">GOARCH</span><span class="op" id="7891162">:</span>&nbsp;<span class="builtintype" id="7891164">true</span><span class="op" id="7891168">,</span>&nbsp;<span class="string" id="7891170">&#34;foo&#34;</span><span class="op" id="7891175">:</span>&nbsp;<span class="builtintype" id="7891177">true</span><span class="op" id="7891181">}</span><span class="op" id="7891182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891185">match</span><span class="op" id="7891190">(</span><span class="ident" id="7891191">runtime</span><span class="op" id="7891198">.</span><span class="ident" id="7891199">GOOS</span><span class="op" id="7891203">+</span><span class="string" id="7891204">&#34;,&#34;</span><span class="op" id="7891207">+</span><span class="ident" id="7891208">runtime</span><span class="op" id="7891215">.</span><span class="ident" id="7891216">GOARCH</span><span class="op" id="7891222">+</span><span class="string" id="7891223">&#34;,!bar&#34;</span><span class="op" id="7891230">,</span>&nbsp;<span class="keyword" id="7891232">map</span><span class="op" id="7891235">[</span><span class="builtintype" id="7891236">string</span><span class="op" id="7891242">]</span><span class="builtintype" id="7891243">bool</span><span class="op" id="7891247">{</span><span class="ident" id="7891248">runtime</span><span class="op" id="7891255">.</span><span class="ident" id="7891256">GOOS</span><span class="op" id="7891260">:</span>&nbsp;<span class="builtintype" id="7891262">true</span><span class="op" id="7891266">,</span>&nbsp;<span class="ident" id="7891268">runtime</span><span class="op" id="7891275">.</span><span class="ident" id="7891276">GOARCH</span><span class="op" id="7891282">:</span>&nbsp;<span class="builtintype" id="7891284">true</span><span class="op" id="7891288">,</span>&nbsp;<span class="string" id="7891290">&#34;bar&#34;</span><span class="op" id="7891295">:</span>&nbsp;<span class="builtintype" id="7891297">true</span><span class="op" id="7891301">}</span><span class="op" id="7891302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891305">nomatch</span><span class="op" id="7891312">(</span><span class="ident" id="7891313">runtime</span><span class="op" id="7891320">.</span><span class="ident" id="7891321">GOOS</span><span class="op" id="7891325">+</span><span class="string" id="7891326">&#34;,&#34;</span><span class="op" id="7891329">+</span><span class="ident" id="7891330">runtime</span><span class="op" id="7891337">.</span><span class="ident" id="7891338">GOARCH</span><span class="op" id="7891344">+</span><span class="string" id="7891345">&#34;,bar&#34;</span><span class="op" id="7891351">,</span>&nbsp;<span class="keyword" id="7891353">map</span><span class="op" id="7891356">[</span><span class="builtintype" id="7891357">string</span><span class="op" id="7891363">]</span><span class="builtintype" id="7891364">bool</span><span class="op" id="7891368">{</span><span class="ident" id="7891369">runtime</span><span class="op" id="7891376">.</span><span class="ident" id="7891377">GOOS</span><span class="op" id="7891381">:</span>&nbsp;<span class="builtintype" id="7891383">true</span><span class="op" id="7891387">,</span>&nbsp;<span class="ident" id="7891389">runtime</span><span class="op" id="7891396">.</span><span class="ident" id="7891397">GOARCH</span><span class="op" id="7891403">:</span>&nbsp;<span class="builtintype" id="7891405">true</span><span class="op" id="7891409">,</span>&nbsp;<span class="string" id="7891411">&#34;bar&#34;</span><span class="op" id="7891416">:</span>&nbsp;<span class="builtintype" id="7891418">true</span><span class="op" id="7891422">}</span><span class="op" id="7891423">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891426">nomatch</span><span class="op" id="7891433">(</span><span class="string" id="7891434">&#34;!&#34;</span><span class="op" id="7891437">,</span>&nbsp;<span class="keyword" id="7891439">map</span><span class="op" id="7891442">[</span><span class="builtintype" id="7891443">string</span><span class="op" id="7891449">]</span><span class="builtintype" id="7891450">bool</span><span class="op" id="7891454">{</span><span class="op" id="7891455">}</span><span class="op" id="7891456">)</span><br>
<span class="lineno"></span><span class="op" id="7891458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7891461">func</span>&nbsp;<span class="ident" id="7891466">TestDotSlashImport</span><span class="op" id="7891484">(</span><span class="ident" id="7891485">t</span>&nbsp;<span class="op" id="7891487">*</span><span class="ident" id="7891488">testing</span><span class="op" id="7891495">.</span><span class="ident" id="7891496">T</span><span class="op" id="7891497">)</span>&nbsp;<span class="op" id="7891499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891502">p</span><span class="op" id="7891503">,</span>&nbsp;<span class="ident" id="7891505">err</span>&nbsp;<span class="op" id="7891509">:=</span>&nbsp;<span class="ident" id="7891512">ImportDir</span><span class="op" id="7891521">(</span><span class="string" id="7891522">&#34;testdata/other&#34;</span><span class="op" id="7891538">,</span>&nbsp;<span class="num" id="7891540">0</span><span class="op" id="7891541">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891544">if</span>&nbsp;<span class="ident" id="7891547">err</span>&nbsp;<span class="op" id="7891551">!=</span>&nbsp;<span class="ident" id="7891554">nil</span>&nbsp;<span class="op" id="7891558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891562">t</span><span class="op" id="7891563">.</span><span class="ident" id="7891564">Fatal</span><span class="op" id="7891569">(</span><span class="ident" id="7891570">err</span><span class="op" id="7891573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891579">if</span>&nbsp;<span class="builtinfunc" id="7891582">len</span><span class="op" id="7891585">(</span><span class="ident" id="7891586">p</span><span class="op" id="7891587">.</span><span class="ident" id="7891588">Imports</span><span class="op" id="7891595">)</span>&nbsp;<span class="op" id="7891597">!=</span>&nbsp;<span class="num" id="7891600">1</span>&nbsp;<span class="op" id="7891602">||</span>&nbsp;<span class="ident" id="7891605">p</span><span class="op" id="7891606">.</span><span class="ident" id="7891607">Imports</span><span class="op" id="7891614">[</span><span class="num" id="7891615">0</span><span class="op" id="7891616">]</span>&nbsp;<span class="op" id="7891618">!=</span>&nbsp;<span class="string" id="7891621">&#34;./file&#34;</span>&nbsp;<span class="op" id="7891630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891634">t</span><span class="op" id="7891635">.</span><span class="ident" id="7891636">Fatalf</span><span class="op" id="7891642">(</span><span class="string" id="7891643">&#34;testdata/other:&nbsp;Imports=%v,&nbsp;want&nbsp;[./file]&#34;</span><span class="op" id="7891686">,</span>&nbsp;<span class="ident" id="7891688">p</span><span class="op" id="7891689">.</span><span class="ident" id="7891690">Imports</span><span class="op" id="7891697">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891704">p1</span><span class="op" id="7891706">,</span>&nbsp;<span class="ident" id="7891708">err</span>&nbsp;<span class="op" id="7891712">:=</span>&nbsp;<span class="ident" id="7891715">Import</span><span class="op" id="7891721">(</span><span class="string" id="7891722">&#34;./file&#34;</span><span class="op" id="7891730">,</span>&nbsp;<span class="string" id="7891732">&#34;testdata/other&#34;</span><span class="op" id="7891748">,</span>&nbsp;<span class="num" id="7891750">0</span><span class="op" id="7891751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891754">if</span>&nbsp;<span class="ident" id="7891757">err</span>&nbsp;<span class="op" id="7891761">!=</span>&nbsp;<span class="ident" id="7891764">nil</span>&nbsp;<span class="op" id="7891768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891772">t</span><span class="op" id="7891773">.</span><span class="ident" id="7891774">Fatal</span><span class="op" id="7891779">(</span><span class="ident" id="7891780">err</span><span class="op" id="7891783">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891789">if</span>&nbsp;<span class="ident" id="7891792">p1</span><span class="op" id="7891794">.</span><span class="ident" id="7891795">Name</span>&nbsp;<span class="op" id="7891800">!=</span>&nbsp;<span class="string" id="7891803">&#34;file&#34;</span>&nbsp;<span class="op" id="7891810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891814">t</span><span class="op" id="7891815">.</span><span class="ident" id="7891816">Fatalf</span><span class="op" id="7891822">(</span><span class="string" id="7891823">&#34;./file:&nbsp;Name=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7891849">,</span>&nbsp;<span class="ident" id="7891851">p1</span><span class="op" id="7891853">.</span><span class="ident" id="7891854">Name</span><span class="op" id="7891858">,</span>&nbsp;<span class="string" id="7891860">&#34;file&#34;</span><span class="op" id="7891866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891872">dir</span>&nbsp;<span class="op" id="7891876">:=</span>&nbsp;<span class="ident" id="7891879">filepath</span><span class="op" id="7891887">.</span><span class="ident" id="7891888">Clean</span><span class="op" id="7891893">(</span><span class="string" id="7891894">&#34;testdata/other/file&#34;</span><span class="op" id="7891915">)</span>&nbsp;<span class="comment" id="7891917">//&nbsp;Clean&nbsp;to&nbsp;use&nbsp;\&nbsp;on&nbsp;Windows</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891947">if</span>&nbsp;<span class="ident" id="7891950">p1</span><span class="op" id="7891952">.</span><span class="ident" id="7891953">Dir</span>&nbsp;<span class="op" id="7891957">!=</span>&nbsp;<span class="ident" id="7891960">dir</span>&nbsp;<span class="op" id="7891964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891968">t</span><span class="op" id="7891969">.</span><span class="ident" id="7891970">Fatalf</span><span class="op" id="7891976">(</span><span class="string" id="7891977">&#34;./file:&nbsp;Dir=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7892002">,</span>&nbsp;<span class="ident" id="7892004">p1</span><span class="op" id="7892006">.</span><span class="ident" id="7892007">Name</span><span class="op" id="7892011">,</span>&nbsp;<span class="ident" id="7892013">dir</span><span class="op" id="7892016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892019">}</span><br>
<span class="lineno"></span><span class="op" id="7892021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="7892024">func</span>&nbsp;<span class="ident" id="7892029">TestEmptyImport</span><span class="op" id="7892044">(</span><span class="ident" id="7892045">t</span>&nbsp;<span class="op" id="7892047">*</span><span class="ident" id="7892048">testing</span><span class="op" id="7892055">.</span><span class="ident" id="7892056">T</span><span class="op" id="7892057">)</span>&nbsp;<span class="op" id="7892059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892062">p</span><span class="op" id="7892063">,</span>&nbsp;<span class="ident" id="7892065">err</span>&nbsp;<span class="op" id="7892069">:=</span>&nbsp;<span class="ident" id="7892072">Import</span><span class="op" id="7892078">(</span><span class="string" id="7892079">&#34;&#34;</span><span class="op" id="7892081">,</span>&nbsp;<span class="ident" id="7892083">Default</span><span class="op" id="7892090">.</span><span class="ident" id="7892091">GOROOT</span><span class="op" id="7892097">,</span>&nbsp;<span class="ident" id="7892099">FindOnly</span><span class="op" id="7892107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892110">if</span>&nbsp;<span class="ident" id="7892113">err</span>&nbsp;<span class="op" id="7892117">==</span>&nbsp;<span class="ident" id="7892120">nil</span>&nbsp;<span class="op" id="7892124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892128">t</span><span class="op" id="7892129">.</span><span class="ident" id="7892130">Fatal</span><span class="op" id="7892135">(</span><span class="string" id="7892136">`Import(&#34;&#34;)&nbsp;returned&nbsp;nil&nbsp;error.`</span><span class="op" id="7892168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892171">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892174">if</span>&nbsp;<span class="ident" id="7892177">p</span>&nbsp;<span class="op" id="7892179">==</span>&nbsp;<span class="ident" id="7892182">nil</span>&nbsp;<span class="op" id="7892186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892190">t</span><span class="op" id="7892191">.</span><span class="ident" id="7892192">Fatal</span><span class="op" id="7892197">(</span><span class="string" id="7892198">`Import(&#34;&#34;)&nbsp;returned&nbsp;nil&nbsp;package.`</span><span class="op" id="7892232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892238">if</span>&nbsp;<span class="ident" id="7892241">p</span><span class="op" id="7892242">.</span><span class="ident" id="7892243">ImportPath</span>&nbsp;<span class="op" id="7892254">!=</span>&nbsp;<span class="string" id="7892257">&#34;&#34;</span>&nbsp;<span class="op" id="7892260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892264">t</span><span class="op" id="7892265">.</span><span class="ident" id="7892266">Fatalf</span><span class="op" id="7892272">(</span><span class="string" id="7892273">&#34;ImportPath=%q,&nbsp;want&nbsp;%q.&#34;</span><span class="op" id="7892298">,</span>&nbsp;<span class="ident" id="7892300">p</span><span class="op" id="7892301">.</span><span class="ident" id="7892302">ImportPath</span><span class="op" id="7892312">,</span>&nbsp;<span class="string" id="7892314">&#34;&#34;</span><span class="op" id="7892316">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892319">}</span><br>
<span class="lineno"></span><span class="op" id="7892321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7892324">func</span>&nbsp;<span class="ident" id="7892329">TestEmptyFolderImport</span><span class="op" id="7892350">(</span><span class="ident" id="7892351">t</span>&nbsp;<span class="op" id="7892353">*</span><span class="ident" id="7892354">testing</span><span class="op" id="7892361">.</span><span class="ident" id="7892362">T</span><span class="op" id="7892363">)</span>&nbsp;<span class="op" id="7892365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892368">_</span><span class="op" id="7892369">,</span>&nbsp;<span class="ident" id="7892371">err</span>&nbsp;<span class="op" id="7892375">:=</span>&nbsp;<span class="ident" id="7892378">Import</span><span class="op" id="7892384">(</span><span class="string" id="7892385">&#34;.&#34;</span><span class="op" id="7892388">,</span>&nbsp;<span class="string" id="7892390">&#34;testdata/empty&#34;</span><span class="op" id="7892406">,</span>&nbsp;<span class="num" id="7892408">0</span><span class="op" id="7892409">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892412">if</span>&nbsp;<span class="ident" id="7892415">_</span><span class="op" id="7892416">,</span>&nbsp;<span class="ident" id="7892418">ok</span>&nbsp;<span class="op" id="7892421">:=</span>&nbsp;<span class="ident" id="7892424">err</span><span class="op" id="7892427">.</span><span class="op" id="7892428">(</span><span class="op" id="7892429">*</span><span class="ident" id="7892430">NoGoError</span><span class="op" id="7892439">)</span><span class="op" id="7892440">;</span>&nbsp;<span class="op" id="7892442">!</span><span class="ident" id="7892443">ok</span>&nbsp;<span class="op" id="7892446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892450">t</span><span class="op" id="7892451">.</span><span class="ident" id="7892452">Fatal</span><span class="op" id="7892457">(</span><span class="string" id="7892458">`Import(&#34;testdata/empty&#34;)&nbsp;did&nbsp;not&nbsp;return&nbsp;NoGoError.`</span><span class="op" id="7892510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892513">}</span><br>
<span class="lineno"></span><span class="op" id="7892515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7892518">func</span>&nbsp;<span class="ident" id="7892523">TestMultiplePackageImport</span><span class="op" id="7892548">(</span><span class="ident" id="7892549">t</span>&nbsp;<span class="op" id="7892551">*</span><span class="ident" id="7892552">testing</span><span class="op" id="7892559">.</span><span class="ident" id="7892560">T</span><span class="op" id="7892561">)</span>&nbsp;<span class="op" id="7892563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892566">_</span><span class="op" id="7892567">,</span>&nbsp;<span class="ident" id="7892569">err</span>&nbsp;<span class="op" id="7892573">:=</span>&nbsp;<span class="ident" id="7892576">Import</span><span class="op" id="7892582">(</span><span class="string" id="7892583">&#34;.&#34;</span><span class="op" id="7892586">,</span>&nbsp;<span class="string" id="7892588">&#34;testdata/multi&#34;</span><span class="op" id="7892604">,</span>&nbsp;<span class="num" id="7892606">0</span><span class="op" id="7892607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892610">if</span>&nbsp;<span class="ident" id="7892613">_</span><span class="op" id="7892614">,</span>&nbsp;<span class="ident" id="7892616">ok</span>&nbsp;<span class="op" id="7892619">:=</span>&nbsp;<span class="ident" id="7892622">err</span><span class="op" id="7892625">.</span><span class="op" id="7892626">(</span><span class="op" id="7892627">*</span><span class="ident" id="7892628">MultiplePackageError</span><span class="op" id="7892648">)</span><span class="op" id="7892649">;</span>&nbsp;<span class="op" id="7892651">!</span><span class="ident" id="7892652">ok</span>&nbsp;<span class="op" id="7892655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892659">t</span><span class="op" id="7892660">.</span><span class="ident" id="7892661">Fatal</span><span class="op" id="7892666">(</span><span class="string" id="7892667">`Import(&#34;testdata/multi&#34;)&nbsp;did&nbsp;not&nbsp;return&nbsp;MultiplePackageError.`</span><span class="op" id="7892730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892733">}</span><br>
<span class="lineno">100</span><span class="op" id="7892735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7892738">func</span>&nbsp;<span class="ident" id="7892743">TestLocalDirectory</span><span class="op" id="7892761">(</span><span class="ident" id="7892762">t</span>&nbsp;<span class="op" id="7892764">*</span><span class="ident" id="7892765">testing</span><span class="op" id="7892772">.</span><span class="ident" id="7892773">T</span><span class="op" id="7892774">)</span>&nbsp;<span class="op" id="7892776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892779">cwd</span><span class="op" id="7892782">,</span>&nbsp;<span class="ident" id="7892784">err</span>&nbsp;<span class="op" id="7892788">:=</span>&nbsp;<span class="ident" id="7892791">os</span><span class="op" id="7892793">.</span><span class="ident" id="7892794">Getwd</span><span class="op" id="7892799">(</span><span class="op" id="7892800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892803">if</span>&nbsp;<span class="ident" id="7892806">err</span>&nbsp;<span class="op" id="7892810">!=</span>&nbsp;<span class="ident" id="7892813">nil</span>&nbsp;<span class="op" id="7892817">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892821">t</span><span class="op" id="7892822">.</span><span class="ident" id="7892823">Fatal</span><span class="op" id="7892828">(</span><span class="ident" id="7892829">err</span><span class="op" id="7892832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892839">p</span><span class="op" id="7892840">,</span>&nbsp;<span class="ident" id="7892842">err</span>&nbsp;<span class="op" id="7892846">:=</span>&nbsp;<span class="ident" id="7892849">ImportDir</span><span class="op" id="7892858">(</span><span class="ident" id="7892859">cwd</span><span class="op" id="7892862">,</span>&nbsp;<span class="num" id="7892864">0</span><span class="op" id="7892865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892868">if</span>&nbsp;<span class="ident" id="7892871">err</span>&nbsp;<span class="op" id="7892875">!=</span>&nbsp;<span class="ident" id="7892878">nil</span>&nbsp;<span class="op" id="7892882">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892886">t</span><span class="op" id="7892887">.</span><span class="ident" id="7892888">Fatal</span><span class="op" id="7892893">(</span><span class="ident" id="7892894">err</span><span class="op" id="7892897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892903">if</span>&nbsp;<span class="ident" id="7892906">p</span><span class="op" id="7892907">.</span><span class="ident" id="7892908">ImportPath</span>&nbsp;<span class="op" id="7892919">!=</span>&nbsp;<span class="string" id="7892922">&#34;go/build&#34;</span>&nbsp;<span class="op" id="7892933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892937">t</span><span class="op" id="7892938">.</span><span class="ident" id="7892939">Fatalf</span><span class="op" id="7892945">(</span><span class="string" id="7892946">&#34;ImportPath=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7892970">,</span>&nbsp;<span class="ident" id="7892972">p</span><span class="op" id="7892973">.</span><span class="ident" id="7892974">ImportPath</span><span class="op" id="7892984">,</span>&nbsp;<span class="string" id="7892986">&#34;go/build&#34;</span><span class="op" id="7892996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892999">}</span><br>
<span class="lineno">115</span><span class="op" id="7893001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7893004">func</span>&nbsp;<span class="ident" id="7893009">TestShouldBuild</span><span class="op" id="7893024">(</span><span class="ident" id="7893025">t</span>&nbsp;<span class="op" id="7893027">*</span><span class="ident" id="7893028">testing</span><span class="op" id="7893035">.</span><span class="ident" id="7893036">T</span><span class="op" id="7893037">)</span>&nbsp;<span class="op" id="7893039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893042">const</span>&nbsp;<span class="ident" id="7893048">file1</span>&nbsp;<span class="op" id="7893054">=</span>&nbsp;<span class="string" id="7893056">&#34;//&nbsp;+build&nbsp;tag1\n\n&#34;</span>&nbsp;<span class="op" id="7893077">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7893081">&#34;package&nbsp;main\n&#34;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893099">want1</span>&nbsp;<span class="op" id="7893105">:=</span>&nbsp;<span class="keyword" id="7893108">map</span><span class="op" id="7893111">[</span><span class="builtintype" id="7893112">string</span><span class="op" id="7893118">]</span><span class="builtintype" id="7893119">bool</span><span class="op" id="7893123">{</span><span class="string" id="7893124">&#34;tag1&#34;</span><span class="op" id="7893130">:</span>&nbsp;<span class="builtintype" id="7893132">true</span><span class="op" id="7893136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893140">const</span>&nbsp;<span class="ident" id="7893146">file2</span>&nbsp;<span class="op" id="7893152">=</span>&nbsp;<span class="string" id="7893154">&#34;//&nbsp;+build&nbsp;cgo\n\n&#34;</span>&nbsp;<span class="op" id="7893174">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7893178">&#34;//&nbsp;This&nbsp;package&nbsp;implements&nbsp;parsing&nbsp;of&nbsp;tags&nbsp;like\n&#34;</span>&nbsp;<span class="op" id="7893230">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7893234">&#34;//&nbsp;+build&nbsp;tag1\n&#34;</span>&nbsp;<span class="op" id="7893253">+</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7893257">&#34;package&nbsp;build&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893274">want2</span>&nbsp;<span class="op" id="7893280">:=</span>&nbsp;<span class="keyword" id="7893283">map</span><span class="op" id="7893286">[</span><span class="builtintype" id="7893287">string</span><span class="op" id="7893293">]</span><span class="builtintype" id="7893294">bool</span><span class="op" id="7893298">{</span><span class="string" id="7893299">&#34;cgo&#34;</span><span class="op" id="7893304">:</span>&nbsp;<span class="builtintype" id="7893306">true</span><span class="op" id="7893310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893314">const</span>&nbsp;<span class="ident" id="7893320">file3</span>&nbsp;<span class="op" id="7893326">=</span>&nbsp;<span class="string" id="7893328">&#34;//&nbsp;Copyright&nbsp;The&nbsp;Go&nbsp;Authors.\n\n&#34;</span>&nbsp;<span class="op" id="7893363">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7893367">&#34;package&nbsp;build\n\n&#34;</span>&nbsp;<span class="op" id="7893387">+</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7893391">&#34;//&nbsp;shouldBuild&nbsp;checks&nbsp;tags&nbsp;given&nbsp;by&nbsp;lines&nbsp;of&nbsp;the&nbsp;form\n&#34;</span>&nbsp;<span class="op" id="7893449">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7893453">&#34;//&nbsp;+build&nbsp;tag\n&#34;</span>&nbsp;<span class="op" id="7893471">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7893475">&#34;func&nbsp;shouldBuild(content&nbsp;[]byte)\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893513">want3</span>&nbsp;<span class="op" id="7893519">:=</span>&nbsp;<span class="keyword" id="7893522">map</span><span class="op" id="7893525">[</span><span class="builtintype" id="7893526">string</span><span class="op" id="7893532">]</span><span class="builtintype" id="7893533">bool</span><span class="op" id="7893537">{</span><span class="op" id="7893538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893542">ctx</span>&nbsp;<span class="op" id="7893546">:=</span>&nbsp;<span class="op" id="7893549">&amp;</span><span class="ident" id="7893550">Context</span><span class="op" id="7893557">{</span><span class="ident" id="7893558">BuildTags</span><span class="op" id="7893567">:</span>&nbsp;<span class="op" id="7893569">[</span><span class="op" id="7893570">]</span><span class="builtintype" id="7893571">string</span><span class="op" id="7893577">{</span><span class="string" id="7893578">&#34;tag1&#34;</span><span class="op" id="7893584">}</span><span class="op" id="7893585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893588">m</span>&nbsp;<span class="op" id="7893590">:=</span>&nbsp;<span class="keyword" id="7893593">map</span><span class="op" id="7893596">[</span><span class="builtintype" id="7893597">string</span><span class="op" id="7893603">]</span><span class="builtintype" id="7893604">bool</span><span class="op" id="7893608">{</span><span class="op" id="7893609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893612">if</span>&nbsp;<span class="op" id="7893615">!</span><span class="ident" id="7893616">ctx</span><span class="op" id="7893619">.</span><span class="ident" id="7893620">shouldBuild</span><span class="op" id="7893631">(</span><span class="op" id="7893632">[</span><span class="op" id="7893633">]</span><span class="builtintype" id="7893634">byte</span><span class="op" id="7893638">(</span><span class="ident" id="7893639">file1</span><span class="op" id="7893644">)</span><span class="op" id="7893645">,</span>&nbsp;<span class="ident" id="7893647">m</span><span class="op" id="7893648">)</span>&nbsp;<span class="op" id="7893650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893654">t</span><span class="op" id="7893655">.</span><span class="ident" id="7893656">Errorf</span><span class="op" id="7893662">(</span><span class="string" id="7893663">&#34;shouldBuild(file1)&nbsp;=&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="7893702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893705">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893708">if</span>&nbsp;<span class="op" id="7893711">!</span><span class="ident" id="7893712">reflect</span><span class="op" id="7893719">.</span><span class="ident" id="7893720">DeepEqual</span><span class="op" id="7893729">(</span><span class="ident" id="7893730">m</span><span class="op" id="7893731">,</span>&nbsp;<span class="ident" id="7893733">want1</span><span class="op" id="7893738">)</span>&nbsp;<span class="op" id="7893740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893744">t</span><span class="op" id="7893745">.</span><span class="ident" id="7893746">Errorf</span><span class="op" id="7893752">(</span><span class="string" id="7893753">&#34;shoudBuild(file1)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7893791">,</span>&nbsp;<span class="ident" id="7893793">m</span><span class="op" id="7893794">,</span>&nbsp;<span class="ident" id="7893796">want1</span><span class="op" id="7893801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893808">m</span>&nbsp;<span class="op" id="7893810">=</span>&nbsp;<span class="keyword" id="7893812">map</span><span class="op" id="7893815">[</span><span class="builtintype" id="7893816">string</span><span class="op" id="7893822">]</span><span class="builtintype" id="7893823">bool</span><span class="op" id="7893827">{</span><span class="op" id="7893828">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893831">if</span>&nbsp;<span class="ident" id="7893834">ctx</span><span class="op" id="7893837">.</span><span class="ident" id="7893838">shouldBuild</span><span class="op" id="7893849">(</span><span class="op" id="7893850">[</span><span class="op" id="7893851">]</span><span class="builtintype" id="7893852">byte</span><span class="op" id="7893856">(</span><span class="ident" id="7893857">file2</span><span class="op" id="7893862">)</span><span class="op" id="7893863">,</span>&nbsp;<span class="ident" id="7893865">m</span><span class="op" id="7893866">)</span>&nbsp;<span class="op" id="7893868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893872">t</span><span class="op" id="7893873">.</span><span class="ident" id="7893874">Errorf</span><span class="op" id="7893880">(</span><span class="string" id="7893881">&#34;shouldBuild(file2)&nbsp;=&nbsp;true,&nbsp;want&nbsp;fakse&#34;</span><span class="op" id="7893920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893926">if</span>&nbsp;<span class="op" id="7893929">!</span><span class="ident" id="7893930">reflect</span><span class="op" id="7893937">.</span><span class="ident" id="7893938">DeepEqual</span><span class="op" id="7893947">(</span><span class="ident" id="7893948">m</span><span class="op" id="7893949">,</span>&nbsp;<span class="ident" id="7893951">want2</span><span class="op" id="7893956">)</span>&nbsp;<span class="op" id="7893958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893962">t</span><span class="op" id="7893963">.</span><span class="ident" id="7893964">Errorf</span><span class="op" id="7893970">(</span><span class="string" id="7893971">&#34;shoudBuild(file2)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7894009">,</span>&nbsp;<span class="ident" id="7894011">m</span><span class="op" id="7894012">,</span>&nbsp;<span class="ident" id="7894014">want2</span><span class="op" id="7894019">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894026">m</span>&nbsp;<span class="op" id="7894028">=</span>&nbsp;<span class="keyword" id="7894030">map</span><span class="op" id="7894033">[</span><span class="builtintype" id="7894034">string</span><span class="op" id="7894040">]</span><span class="builtintype" id="7894041">bool</span><span class="op" id="7894045">{</span><span class="op" id="7894046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894049">ctx</span>&nbsp;<span class="op" id="7894053">=</span>&nbsp;<span class="op" id="7894055">&amp;</span><span class="ident" id="7894056">Context</span><span class="op" id="7894063">{</span><span class="ident" id="7894064">BuildTags</span><span class="op" id="7894073">:</span>&nbsp;<span class="ident" id="7894075">nil</span><span class="op" id="7894078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894081">if</span>&nbsp;<span class="op" id="7894084">!</span><span class="ident" id="7894085">ctx</span><span class="op" id="7894088">.</span><span class="ident" id="7894089">shouldBuild</span><span class="op" id="7894100">(</span><span class="op" id="7894101">[</span><span class="op" id="7894102">]</span><span class="builtintype" id="7894103">byte</span><span class="op" id="7894107">(</span><span class="ident" id="7894108">file3</span><span class="op" id="7894113">)</span><span class="op" id="7894114">,</span>&nbsp;<span class="ident" id="7894116">m</span><span class="op" id="7894117">)</span>&nbsp;<span class="op" id="7894119">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894123">t</span><span class="op" id="7894124">.</span><span class="ident" id="7894125">Errorf</span><span class="op" id="7894131">(</span><span class="string" id="7894132">&#34;shouldBuild(file3)&nbsp;=&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="7894171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894177">if</span>&nbsp;<span class="op" id="7894180">!</span><span class="ident" id="7894181">reflect</span><span class="op" id="7894188">.</span><span class="ident" id="7894189">DeepEqual</span><span class="op" id="7894198">(</span><span class="ident" id="7894199">m</span><span class="op" id="7894200">,</span>&nbsp;<span class="ident" id="7894202">want3</span><span class="op" id="7894207">)</span>&nbsp;<span class="op" id="7894209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894213">t</span><span class="op" id="7894214">.</span><span class="ident" id="7894215">Errorf</span><span class="op" id="7894221">(</span><span class="string" id="7894222">&#34;shoudBuild(file3)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7894260">,</span>&nbsp;<span class="ident" id="7894262">m</span><span class="op" id="7894263">,</span>&nbsp;<span class="ident" id="7894265">want3</span><span class="op" id="7894270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894273">}</span><br>
<span class="lineno">160</span><span class="op" id="7894275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7894278">type</span>&nbsp;<span class="ident" id="7894283">readNopCloser</span>&nbsp;<span class="keyword" id="7894297">struct</span>&nbsp;<span class="op" id="7894304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894307">io</span><span class="op" id="7894309">.</span><span class="ident" id="7894310">Reader</span><br>
<span class="lineno"></span><span class="op" id="7894317">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="7894320">func</span>&nbsp;<span class="op" id="7894325">(</span><span class="ident" id="7894326">r</span>&nbsp;<span class="ident" id="7894328">readNopCloser</span><span class="op" id="7894341">)</span>&nbsp;<span class="ident" id="7894343">Close</span><span class="op" id="7894348">(</span><span class="op" id="7894349">)</span>&nbsp;<span class="builtintype" id="7894351">error</span>&nbsp;<span class="op" id="7894357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894360">return</span>&nbsp;<span class="ident" id="7894367">nil</span><br>
<span class="lineno"></span><span class="op" id="7894371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="7894374">var</span>&nbsp;<span class="op" id="7894378">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894381">ctxtP9</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7894393">=</span>&nbsp;<span class="ident" id="7894395">Context</span><span class="op" id="7894402">{</span><span class="ident" id="7894403">GOARCH</span><span class="op" id="7894409">:</span>&nbsp;<span class="string" id="7894411">&#34;arm&#34;</span><span class="op" id="7894416">,</span>&nbsp;<span class="ident" id="7894418">GOOS</span><span class="op" id="7894422">:</span>&nbsp;<span class="string" id="7894424">&#34;plan9&#34;</span><span class="op" id="7894431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894434">ctxtAndroid</span>&nbsp;<span class="op" id="7894446">=</span>&nbsp;<span class="ident" id="7894448">Context</span><span class="op" id="7894455">{</span><span class="ident" id="7894456">GOARCH</span><span class="op" id="7894462">:</span>&nbsp;<span class="string" id="7894464">&#34;arm&#34;</span><span class="op" id="7894469">,</span>&nbsp;<span class="ident" id="7894471">GOOS</span><span class="op" id="7894475">:</span>&nbsp;<span class="string" id="7894477">&#34;android&#34;</span><span class="op" id="7894486">}</span><br>
<span class="lineno"></span><span class="op" id="7894488">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="7894491">var</span>&nbsp;<span class="ident" id="7894495">matchFileTests</span>&nbsp;<span class="op" id="7894510">=</span>&nbsp;<span class="op" id="7894512">[</span><span class="op" id="7894513">]</span><span class="keyword" id="7894514">struct</span>&nbsp;<span class="op" id="7894521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894524">ctxt</span>&nbsp;&nbsp;<span class="ident" id="7894530">Context</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894539">name</span>&nbsp;&nbsp;<span class="builtintype" id="7894545">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894553">data</span>&nbsp;&nbsp;<span class="builtintype" id="7894559">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894567">match</span>&nbsp;<span class="builtintype" id="7894573">bool</span><br>
<span class="lineno">180</span><span class="op" id="7894578">}</span><span class="op" id="7894579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894582">{</span><span class="ident" id="7894583">ctxtP9</span><span class="op" id="7894589">,</span>&nbsp;<span class="string" id="7894591">&#34;foo_arm.go&#34;</span><span class="op" id="7894603">,</span>&nbsp;<span class="string" id="7894605">&#34;&#34;</span><span class="op" id="7894607">,</span>&nbsp;<span class="builtintype" id="7894609">true</span><span class="op" id="7894613">}</span><span class="op" id="7894614">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894617">{</span><span class="ident" id="7894618">ctxtP9</span><span class="op" id="7894624">,</span>&nbsp;<span class="string" id="7894626">&#34;foo1_arm.go&#34;</span><span class="op" id="7894639">,</span>&nbsp;<span class="string" id="7894641">&#34;//&nbsp;+build&nbsp;linux\n\npackage&nbsp;main\n&#34;</span><span class="op" id="7894676">,</span>&nbsp;<span class="builtintype" id="7894678">false</span><span class="op" id="7894683">}</span><span class="op" id="7894684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894687">{</span><span class="ident" id="7894688">ctxtP9</span><span class="op" id="7894694">,</span>&nbsp;<span class="string" id="7894696">&#34;foo_darwin.go&#34;</span><span class="op" id="7894711">,</span>&nbsp;<span class="string" id="7894713">&#34;&#34;</span><span class="op" id="7894715">,</span>&nbsp;<span class="builtintype" id="7894717">false</span><span class="op" id="7894722">}</span><span class="op" id="7894723">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894726">{</span><span class="ident" id="7894727">ctxtP9</span><span class="op" id="7894733">,</span>&nbsp;<span class="string" id="7894735">&#34;foo.go&#34;</span><span class="op" id="7894743">,</span>&nbsp;<span class="string" id="7894745">&#34;&#34;</span><span class="op" id="7894747">,</span>&nbsp;<span class="builtintype" id="7894749">true</span><span class="op" id="7894753">}</span><span class="op" id="7894754">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894757">{</span><span class="ident" id="7894758">ctxtP9</span><span class="op" id="7894764">,</span>&nbsp;<span class="string" id="7894766">&#34;foo1.go&#34;</span><span class="op" id="7894775">,</span>&nbsp;<span class="string" id="7894777">&#34;//&nbsp;+build&nbsp;linux\n\npackage&nbsp;main\n&#34;</span><span class="op" id="7894812">,</span>&nbsp;<span class="builtintype" id="7894814">false</span><span class="op" id="7894819">}</span><span class="op" id="7894820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894823">{</span><span class="ident" id="7894824">ctxtP9</span><span class="op" id="7894830">,</span>&nbsp;<span class="string" id="7894832">&#34;foo.badsuffix&#34;</span><span class="op" id="7894847">,</span>&nbsp;<span class="string" id="7894849">&#34;&#34;</span><span class="op" id="7894851">,</span>&nbsp;<span class="builtintype" id="7894853">false</span><span class="op" id="7894858">}</span><span class="op" id="7894859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894862">{</span><span class="ident" id="7894863">ctxtAndroid</span><span class="op" id="7894874">,</span>&nbsp;<span class="string" id="7894876">&#34;foo_linux.go&#34;</span><span class="op" id="7894890">,</span>&nbsp;<span class="string" id="7894892">&#34;&#34;</span><span class="op" id="7894894">,</span>&nbsp;<span class="builtintype" id="7894896">true</span><span class="op" id="7894900">}</span><span class="op" id="7894901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894904">{</span><span class="ident" id="7894905">ctxtAndroid</span><span class="op" id="7894916">,</span>&nbsp;<span class="string" id="7894918">&#34;foo_android.go&#34;</span><span class="op" id="7894934">,</span>&nbsp;<span class="string" id="7894936">&#34;&#34;</span><span class="op" id="7894938">,</span>&nbsp;<span class="builtintype" id="7894940">true</span><span class="op" id="7894944">}</span><span class="op" id="7894945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894948">{</span><span class="ident" id="7894949">ctxtAndroid</span><span class="op" id="7894960">,</span>&nbsp;<span class="string" id="7894962">&#34;foo_plan9.go&#34;</span><span class="op" id="7894976">,</span>&nbsp;<span class="string" id="7894978">&#34;&#34;</span><span class="op" id="7894980">,</span>&nbsp;<span class="builtintype" id="7894982">false</span><span class="op" id="7894987">}</span><span class="op" id="7894988">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894991">{</span><span class="ident" id="7894992">ctxtAndroid</span><span class="op" id="7895003">,</span>&nbsp;<span class="string" id="7895005">&#34;android.go&#34;</span><span class="op" id="7895017">,</span>&nbsp;<span class="string" id="7895019">&#34;&#34;</span><span class="op" id="7895021">,</span>&nbsp;<span class="builtintype" id="7895023">true</span><span class="op" id="7895027">}</span><span class="op" id="7895028">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895031">{</span><span class="ident" id="7895032">ctxtAndroid</span><span class="op" id="7895043">,</span>&nbsp;<span class="string" id="7895045">&#34;plan9.go&#34;</span><span class="op" id="7895055">,</span>&nbsp;<span class="string" id="7895057">&#34;&#34;</span><span class="op" id="7895059">,</span>&nbsp;<span class="builtintype" id="7895061">true</span><span class="op" id="7895065">}</span><span class="op" id="7895066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895069">{</span><span class="ident" id="7895070">ctxtAndroid</span><span class="op" id="7895081">,</span>&nbsp;<span class="string" id="7895083">&#34;plan9_test.go&#34;</span><span class="op" id="7895098">,</span>&nbsp;<span class="string" id="7895100">&#34;&#34;</span><span class="op" id="7895102">,</span>&nbsp;<span class="builtintype" id="7895104">true</span><span class="op" id="7895108">}</span><span class="op" id="7895109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895112">{</span><span class="ident" id="7895113">ctxtAndroid</span><span class="op" id="7895124">,</span>&nbsp;<span class="string" id="7895126">&#34;arm.s&#34;</span><span class="op" id="7895133">,</span>&nbsp;<span class="string" id="7895135">&#34;&#34;</span><span class="op" id="7895137">,</span>&nbsp;<span class="builtintype" id="7895139">true</span><span class="op" id="7895143">}</span><span class="op" id="7895144">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895147">{</span><span class="ident" id="7895148">ctxtAndroid</span><span class="op" id="7895159">,</span>&nbsp;<span class="string" id="7895161">&#34;amd64.s&#34;</span><span class="op" id="7895170">,</span>&nbsp;<span class="string" id="7895172">&#34;&#34;</span><span class="op" id="7895174">,</span>&nbsp;<span class="builtintype" id="7895176">true</span><span class="op" id="7895180">}</span><span class="op" id="7895181">,</span><br>
<span class="lineno">195</span><span class="op" id="7895183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7895186">func</span>&nbsp;<span class="ident" id="7895191">TestMatchFile</span><span class="op" id="7895204">(</span><span class="ident" id="7895205">t</span>&nbsp;<span class="op" id="7895207">*</span><span class="ident" id="7895208">testing</span><span class="op" id="7895215">.</span><span class="ident" id="7895216">T</span><span class="op" id="7895217">)</span>&nbsp;<span class="op" id="7895219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895222">for</span>&nbsp;<span class="ident" id="7895226">_</span><span class="op" id="7895227">,</span>&nbsp;<span class="ident" id="7895229">tt</span>&nbsp;<span class="op" id="7895232">:=</span>&nbsp;<span class="keyword" id="7895235">range</span>&nbsp;<span class="ident" id="7895241">matchFileTests</span>&nbsp;<span class="op" id="7895256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895260">ctxt</span>&nbsp;<span class="op" id="7895265">:=</span>&nbsp;<span class="ident" id="7895268">tt</span><span class="op" id="7895270">.</span><span class="ident" id="7895271">ctxt</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895278">ctxt</span><span class="op" id="7895282">.</span><span class="ident" id="7895283">OpenFile</span>&nbsp;<span class="op" id="7895292">=</span>&nbsp;<span class="keyword" id="7895294">func</span><span class="op" id="7895298">(</span><span class="ident" id="7895299">path</span>&nbsp;<span class="builtintype" id="7895304">string</span><span class="op" id="7895310">)</span>&nbsp;<span class="op" id="7895312">(</span><span class="ident" id="7895313">r</span>&nbsp;<span class="ident" id="7895315">io</span><span class="op" id="7895317">.</span><span class="ident" id="7895318">ReadCloser</span><span class="op" id="7895328">,</span>&nbsp;<span class="ident" id="7895330">err</span>&nbsp;<span class="builtintype" id="7895334">error</span><span class="op" id="7895339">)</span>&nbsp;<span class="op" id="7895341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895346">if</span>&nbsp;<span class="ident" id="7895349">path</span>&nbsp;<span class="op" id="7895354">!=</span>&nbsp;<span class="string" id="7895357">&#34;x+&#34;</span><span class="op" id="7895361">+</span><span class="ident" id="7895362">tt</span><span class="op" id="7895364">.</span><span class="ident" id="7895365">name</span>&nbsp;<span class="op" id="7895370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895376">t</span><span class="op" id="7895377">.</span><span class="ident" id="7895378">Fatalf</span><span class="op" id="7895384">(</span><span class="string" id="7895385">&#34;OpenFile&nbsp;asked&nbsp;for&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7895421">,</span>&nbsp;<span class="ident" id="7895423">path</span><span class="op" id="7895427">,</span>&nbsp;<span class="string" id="7895429">&#34;x+&#34;</span><span class="op" id="7895433">+</span><span class="ident" id="7895434">tt</span><span class="op" id="7895436">.</span><span class="ident" id="7895437">name</span><span class="op" id="7895441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895451">return</span>&nbsp;<span class="op" id="7895458">&amp;</span><span class="ident" id="7895459">readNopCloser</span><span class="op" id="7895472">{</span><span class="ident" id="7895473">strings</span><span class="op" id="7895480">.</span><span class="ident" id="7895481">NewReader</span><span class="op" id="7895490">(</span><span class="ident" id="7895491">tt</span><span class="op" id="7895493">.</span><span class="ident" id="7895494">data</span><span class="op" id="7895498">)</span><span class="op" id="7895499">}</span><span class="op" id="7895500">,</span>&nbsp;<span class="ident" id="7895502">nil</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895512">ctxt</span><span class="op" id="7895516">.</span><span class="ident" id="7895517">JoinPath</span>&nbsp;<span class="op" id="7895526">=</span>&nbsp;<span class="keyword" id="7895528">func</span><span class="op" id="7895532">(</span><span class="ident" id="7895533">elem</span>&nbsp;<span class="op" id="7895538">...</span><span class="builtintype" id="7895541">string</span><span class="op" id="7895547">)</span>&nbsp;<span class="builtintype" id="7895549">string</span>&nbsp;<span class="op" id="7895556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895561">return</span>&nbsp;<span class="ident" id="7895568">strings</span><span class="op" id="7895575">.</span><span class="ident" id="7895576">Join</span><span class="op" id="7895580">(</span><span class="ident" id="7895581">elem</span><span class="op" id="7895585">,</span>&nbsp;<span class="string" id="7895587">&#34;+&#34;</span><span class="op" id="7895590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895598">match</span><span class="op" id="7895603">,</span>&nbsp;<span class="ident" id="7895605">err</span>&nbsp;<span class="op" id="7895609">:=</span>&nbsp;<span class="ident" id="7895612">ctxt</span><span class="op" id="7895616">.</span><span class="ident" id="7895617">MatchFile</span><span class="op" id="7895626">(</span><span class="string" id="7895627">&#34;x&#34;</span><span class="op" id="7895630">,</span>&nbsp;<span class="ident" id="7895632">tt</span><span class="op" id="7895634">.</span><span class="ident" id="7895635">name</span><span class="op" id="7895639">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895643">if</span>&nbsp;<span class="ident" id="7895646">match</span>&nbsp;<span class="op" id="7895652">!=</span>&nbsp;<span class="ident" id="7895655">tt</span><span class="op" id="7895657">.</span><span class="ident" id="7895658">match</span>&nbsp;<span class="op" id="7895664">||</span>&nbsp;<span class="ident" id="7895667">err</span>&nbsp;<span class="op" id="7895671">!=</span>&nbsp;<span class="ident" id="7895674">nil</span>&nbsp;<span class="op" id="7895678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895683">t</span><span class="op" id="7895684">.</span><span class="ident" id="7895685">Fatalf</span><span class="op" id="7895691">(</span><span class="string" id="7895692">&#34;MatchFile(%q)&nbsp;=&nbsp;%v,&nbsp;%v,&nbsp;want&nbsp;%v,&nbsp;nil&#34;</span><span class="op" id="7895730">,</span>&nbsp;<span class="ident" id="7895732">tt</span><span class="op" id="7895734">.</span><span class="ident" id="7895735">name</span><span class="op" id="7895739">,</span>&nbsp;<span class="ident" id="7895741">match</span><span class="op" id="7895746">,</span>&nbsp;<span class="ident" id="7895748">err</span><span class="op" id="7895751">,</span>&nbsp;<span class="ident" id="7895753">tt</span><span class="op" id="7895755">.</span><span class="ident" id="7895756">match</span><span class="op" id="7895761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895768">}</span><br>
<span class="lineno"></span><span class="op" id="7895770">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="7895773">func</span>&nbsp;<span class="ident" id="7895778">TestImportCmd</span><span class="op" id="7895791">(</span><span class="ident" id="7895792">t</span>&nbsp;<span class="op" id="7895794">*</span><span class="ident" id="7895795">testing</span><span class="op" id="7895802">.</span><span class="ident" id="7895803">T</span><span class="op" id="7895804">)</span>&nbsp;<span class="op" id="7895806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895809">p</span><span class="op" id="7895810">,</span>&nbsp;<span class="ident" id="7895812">err</span>&nbsp;<span class="op" id="7895816">:=</span>&nbsp;<span class="ident" id="7895819">Import</span><span class="op" id="7895825">(</span><span class="string" id="7895826">&#34;cmd/internal/objfile&#34;</span><span class="op" id="7895848">,</span>&nbsp;<span class="string" id="7895850">&#34;&#34;</span><span class="op" id="7895852">,</span>&nbsp;<span class="num" id="7895854">0</span><span class="op" id="7895855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895858">if</span>&nbsp;<span class="ident" id="7895861">err</span>&nbsp;<span class="op" id="7895865">!=</span>&nbsp;<span class="ident" id="7895868">nil</span>&nbsp;<span class="op" id="7895872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895876">t</span><span class="op" id="7895877">.</span><span class="ident" id="7895878">Fatal</span><span class="op" id="7895883">(</span><span class="ident" id="7895884">err</span><span class="op" id="7895887">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895893">if</span>&nbsp;<span class="op" id="7895896">!</span><span class="ident" id="7895897">strings</span><span class="op" id="7895904">.</span><span class="ident" id="7895905">HasSuffix</span><span class="op" id="7895914">(</span><span class="ident" id="7895915">filepath</span><span class="op" id="7895923">.</span><span class="ident" id="7895924">ToSlash</span><span class="op" id="7895931">(</span><span class="ident" id="7895932">p</span><span class="op" id="7895933">.</span><span class="ident" id="7895934">Dir</span><span class="op" id="7895937">)</span><span class="op" id="7895938">,</span>&nbsp;<span class="string" id="7895940">&#34;src/cmd/internal/objfile&#34;</span><span class="op" id="7895966">)</span>&nbsp;<span class="op" id="7895968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895972">t</span><span class="op" id="7895973">.</span><span class="ident" id="7895974">Fatalf</span><span class="op" id="7895980">(</span><span class="string" id="7895981">&#34;Import&nbsp;cmd/internal/objfile&nbsp;returned&nbsp;Dir=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7896035">,</span>&nbsp;<span class="ident" id="7896037">filepath</span><span class="op" id="7896045">.</span><span class="ident" id="7896046">ToSlash</span><span class="op" id="7896053">(</span><span class="ident" id="7896054">p</span><span class="op" id="7896055">.</span><span class="ident" id="7896056">Dir</span><span class="op" id="7896059">)</span><span class="op" id="7896060">,</span>&nbsp;<span class="string" id="7896062">&#34;.../src/cmd/internal/objfile&#34;</span><span class="op" id="7896092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7896095">}</span><br>
<span class="lineno"></span><span class="op" id="7896097">}</span>
</div>
</body>
</html>
