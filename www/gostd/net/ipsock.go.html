<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html" class="current">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3115409">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3115465">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3115519">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3115570">//&nbsp;Internet&nbsp;protocol&nbsp;family&nbsp;sockets</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3115607">package</span>&nbsp;<span class="ident" id="3115615">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3115620">import</span>&nbsp;<span class="op" id="3115627">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3115630">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3115640">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3115647">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3115650">var</span>&nbsp;<span class="op" id="3115654">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3115657">//&nbsp;supportsIPv4&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3115717">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3115747">supportsIPv4</span>&nbsp;<span class="builtintype" id="3115760">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3115767">//&nbsp;supportsIPv6&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv6</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3115827">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3115857">supportsIPv6</span>&nbsp;<span class="builtintype" id="3115870">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3115877">//&nbsp;supportsIPv4map&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3115935">//&nbsp;mapping&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;inside&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;at&nbsp;transport</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3115999">//&nbsp;layer&nbsp;protocols.&nbsp;&nbsp;See&nbsp;RFC&nbsp;4291,&nbsp;RFC&nbsp;4038&nbsp;and&nbsp;RFC&nbsp;3493.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3116058">supportsIPv4map</span>&nbsp;<span class="builtintype" id="3116074">bool</span><br>
<span class="lineno"></span><span class="op" id="3116079">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3116082">func</span>&nbsp;<span class="ident" id="3116087">init</span><span class="op" id="3116091">(</span><span class="op" id="3116092">)</span>&nbsp;<span class="op" id="3116094">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3116097">sysInit</span><span class="op" id="3116104">(</span><span class="op" id="3116105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3116108">supportsIPv4</span>&nbsp;<span class="op" id="3116121">=</span>&nbsp;<span class="ident" id="3116123">probeIPv4Stack</span><span class="op" id="3116137">(</span><span class="op" id="3116138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3116141">supportsIPv6</span><span class="op" id="3116153">,</span>&nbsp;<span class="ident" id="3116155">supportsIPv4map</span>&nbsp;<span class="op" id="3116171">=</span>&nbsp;<span class="ident" id="3116173">probeIPv6Stack</span><span class="op" id="3116187">(</span><span class="op" id="3116188">)</span><br>
<span class="lineno"></span><span class="op" id="3116190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3116193">//&nbsp;A&nbsp;netaddr&nbsp;represents&nbsp;a&nbsp;network&nbsp;endpoint&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3116257">//&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3116288">type</span>&nbsp;<span class="ident" id="3116293">netaddr</span>&nbsp;<span class="keyword" id="3116301">interface</span>&nbsp;<span class="op" id="3116311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3116314">//&nbsp;toAddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;represented&nbsp;in&nbsp;Addr&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3116376">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is&nbsp;nil.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3116432">toAddr</span><span class="op" id="3116438">(</span><span class="op" id="3116439">)</span>&nbsp;<span class="ident" id="3116441">Addr</span><br>
<span class="lineno"></span><span class="op" id="3116446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3116449">//&nbsp;An&nbsp;addrList&nbsp;represents&nbsp;a&nbsp;list&nbsp;of&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3116513">type</span>&nbsp;<span class="ident" id="3116518">addrList</span>&nbsp;<span class="op" id="3116527">[</span><span class="op" id="3116528">]</span><span class="ident" id="3116529">netaddr</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3116538">func</span>&nbsp;<span class="op" id="3116543">(</span><span class="ident" id="3116544">al</span>&nbsp;<span class="ident" id="3116547">addrList</span><span class="op" id="3116555">)</span>&nbsp;<span class="ident" id="3116557">toAddr</span><span class="op" id="3116563">(</span><span class="op" id="3116564">)</span>&nbsp;<span class="ident" id="3116566">Addr</span>&nbsp;<span class="op" id="3116571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3116574">switch</span>&nbsp;<span class="builtinfunc" id="3116581">len</span><span class="op" id="3116584">(</span><span class="ident" id="3116585">al</span><span class="op" id="3116587">)</span>&nbsp;<span class="op" id="3116589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3116592">case</span>&nbsp;<span class="num" id="3116597">0</span><span class="op" id="3116598">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3116602">return</span>&nbsp;<span class="ident" id="3116609">nil</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3116614">case</span>&nbsp;<span class="num" id="3116619">1</span><span class="op" id="3116620">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3116624">return</span>&nbsp;<span class="ident" id="3116631">al</span><span class="op" id="3116633">[</span><span class="num" id="3116634">0</span><span class="op" id="3116635">]</span><span class="op" id="3116636">.</span><span class="ident" id="3116637">toAddr</span><span class="op" id="3116643">(</span><span class="op" id="3116644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3116647">default</span><span class="op" id="3116654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3116658">//&nbsp;For&nbsp;now,&nbsp;we&#39;ll&nbsp;roughly&nbsp;pick&nbsp;first&nbsp;one&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3116709">//&nbsp;considering&nbsp;dealing&nbsp;with&nbsp;any&nbsp;preferences&nbsp;such&nbsp;as</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3116763">//&nbsp;DNS&nbsp;TTL,&nbsp;transport&nbsp;path&nbsp;quality,&nbsp;network&nbsp;routing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3116817">//&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3116835">return</span>&nbsp;<span class="ident" id="3116842">al</span><span class="op" id="3116844">[</span><span class="num" id="3116845">0</span><span class="op" id="3116846">]</span><span class="op" id="3116847">.</span><span class="ident" id="3116848">toAddr</span><span class="op" id="3116854">(</span><span class="op" id="3116855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3116858">}</span><br>
<span class="lineno"></span><span class="op" id="3116860">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3116863">var</span>&nbsp;<span class="ident" id="3116867">errNoSuitableAddress</span>&nbsp;<span class="op" id="3116888">=</span>&nbsp;<span class="ident" id="3116890">errors</span><span class="op" id="3116896">.</span><span class="ident" id="3116897">New</span><span class="op" id="3116900">(</span><span class="string" id="3116901">&#34;no&nbsp;suitable&nbsp;address&nbsp;found&#34;</span><span class="op" id="3116928">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3116931">//&nbsp;firstFavoriteAddr&nbsp;returns&nbsp;an&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3116999">//&nbsp;implement&nbsp;the&nbsp;netaddr&nbsp;interface.&nbsp;Known&nbsp;filters&nbsp;are&nbsp;nil,&nbsp;ipv4only</span><br>
<span class="lineno">65</span><span class="comment" id="3117067">//&nbsp;and&nbsp;ipv6only.&nbsp;It&nbsp;returns&nbsp;any&nbsp;address&nbsp;when&nbsp;filter&nbsp;is&nbsp;nil.&nbsp;The&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="3117138">//&nbsp;contains&nbsp;at&nbsp;least&nbsp;one&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3117190">func</span>&nbsp;<span class="ident" id="3117195">firstFavoriteAddr</span><span class="op" id="3117212">(</span><span class="ident" id="3117213">filter</span>&nbsp;<span class="keyword" id="3117220">func</span><span class="op" id="3117224">(</span><span class="ident" id="3117225">IP</span><span class="op" id="3117227">)</span>&nbsp;<span class="ident" id="3117229">IP</span><span class="op" id="3117231">,</span>&nbsp;<span class="ident" id="3117233">ips</span>&nbsp;<span class="op" id="3117237">[</span><span class="op" id="3117238">]</span><span class="ident" id="3117239">IP</span><span class="op" id="3117241">,</span>&nbsp;<span class="ident" id="3117243">inetaddr</span>&nbsp;<span class="keyword" id="3117252">func</span><span class="op" id="3117256">(</span><span class="ident" id="3117257">IP</span><span class="op" id="3117259">)</span>&nbsp;<span class="ident" id="3117261">netaddr</span><span class="op" id="3117268">)</span>&nbsp;<span class="op" id="3117270">(</span><span class="ident" id="3117271">netaddr</span><span class="op" id="3117278">,</span>&nbsp;<span class="builtintype" id="3117280">error</span><span class="op" id="3117285">)</span>&nbsp;<span class="op" id="3117287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3117290">if</span>&nbsp;<span class="ident" id="3117293">filter</span>&nbsp;<span class="op" id="3117300">!=</span>&nbsp;<span class="ident" id="3117303">nil</span>&nbsp;<span class="op" id="3117307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3117311">return</span>&nbsp;<span class="ident" id="3117318">firstSupportedAddr</span><span class="op" id="3117336">(</span><span class="ident" id="3117337">filter</span><span class="op" id="3117343">,</span>&nbsp;<span class="ident" id="3117345">ips</span><span class="op" id="3117348">,</span>&nbsp;<span class="ident" id="3117350">inetaddr</span><span class="op" id="3117358">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3117361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3117364">var</span>&nbsp;<span class="op" id="3117368">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3117372">ipv4</span><span class="op" id="3117376">,</span>&nbsp;<span class="ident" id="3117378">ipv6</span><span class="op" id="3117382">,</span>&nbsp;<span class="ident" id="3117384">swap</span>&nbsp;<span class="builtintype" id="3117389">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3117396">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3117413">addrList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3117423">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3117426">for</span>&nbsp;<span class="ident" id="3117430">_</span><span class="op" id="3117431">,</span>&nbsp;<span class="ident" id="3117433">ip</span>&nbsp;<span class="op" id="3117436">:=</span>&nbsp;<span class="keyword" id="3117439">range</span>&nbsp;<span class="ident" id="3117445">ips</span>&nbsp;<span class="op" id="3117449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3117453">//&nbsp;We&#39;ll&nbsp;take&nbsp;any&nbsp;IP&nbsp;address,&nbsp;but&nbsp;since&nbsp;the&nbsp;dialing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3117507">//&nbsp;code&nbsp;does&nbsp;not&nbsp;yet&nbsp;try&nbsp;multiple&nbsp;addresses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3117553">//&nbsp;effectively,&nbsp;prefer&nbsp;to&nbsp;use&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3117604">//&nbsp;possible.&nbsp;This&nbsp;is&nbsp;especially&nbsp;relevant&nbsp;if&nbsp;localhost</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3117660">//&nbsp;resolves&nbsp;to&nbsp;[ipv6-localhost,&nbsp;ipv4-localhost].&nbsp;Too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3117715">//&nbsp;much&nbsp;code&nbsp;assumes&nbsp;localhost&nbsp;==&nbsp;ipv4-localhost.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3117767">if</span>&nbsp;<span class="ident" id="3117770">ip4</span>&nbsp;<span class="op" id="3117774">:=</span>&nbsp;<span class="ident" id="3117777">ipv4only</span><span class="op" id="3117785">(</span><span class="ident" id="3117786">ip</span><span class="op" id="3117788">)</span><span class="op" id="3117789">;</span>&nbsp;<span class="ident" id="3117791">ip4</span>&nbsp;<span class="op" id="3117795">!=</span>&nbsp;<span class="ident" id="3117798">nil</span>&nbsp;<span class="op" id="3117802">&amp;&amp;</span>&nbsp;<span class="op" id="3117805">!</span><span class="ident" id="3117806">ipv4</span>&nbsp;<span class="op" id="3117811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3117816">list</span>&nbsp;<span class="op" id="3117821">=</span>&nbsp;<span class="builtinfunc" id="3117823">append</span><span class="op" id="3117829">(</span><span class="ident" id="3117830">list</span><span class="op" id="3117834">,</span>&nbsp;<span class="ident" id="3117836">inetaddr</span><span class="op" id="3117844">(</span><span class="ident" id="3117845">ip4</span><span class="op" id="3117848">)</span><span class="op" id="3117849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3117854">ipv4</span>&nbsp;<span class="op" id="3117859">=</span>&nbsp;<span class="builtintype" id="3117861">true</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3117869">if</span>&nbsp;<span class="ident" id="3117872">ipv6</span>&nbsp;<span class="op" id="3117877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3117883">swap</span>&nbsp;<span class="op" id="3117888">=</span>&nbsp;<span class="builtintype" id="3117890">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3117898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3117902">}</span>&nbsp;<span class="keyword" id="3117904">else</span>&nbsp;<span class="keyword" id="3117909">if</span>&nbsp;<span class="ident" id="3117912">ip6</span>&nbsp;<span class="op" id="3117916">:=</span>&nbsp;<span class="ident" id="3117919">ipv6only</span><span class="op" id="3117927">(</span><span class="ident" id="3117928">ip</span><span class="op" id="3117930">)</span><span class="op" id="3117931">;</span>&nbsp;<span class="ident" id="3117933">ip6</span>&nbsp;<span class="op" id="3117937">!=</span>&nbsp;<span class="ident" id="3117940">nil</span>&nbsp;<span class="op" id="3117944">&amp;&amp;</span>&nbsp;<span class="op" id="3117947">!</span><span class="ident" id="3117948">ipv6</span>&nbsp;<span class="op" id="3117953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3117958">list</span>&nbsp;<span class="op" id="3117963">=</span>&nbsp;<span class="builtinfunc" id="3117965">append</span><span class="op" id="3117971">(</span><span class="ident" id="3117972">list</span><span class="op" id="3117976">,</span>&nbsp;<span class="ident" id="3117978">inetaddr</span><span class="op" id="3117986">(</span><span class="ident" id="3117987">ip6</span><span class="op" id="3117990">)</span><span class="op" id="3117991">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3117996">ipv6</span>&nbsp;<span class="op" id="3118001">=</span>&nbsp;<span class="builtintype" id="3118003">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3118010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118014">if</span>&nbsp;<span class="ident" id="3118017">ipv4</span>&nbsp;<span class="op" id="3118022">&amp;&amp;</span>&nbsp;<span class="ident" id="3118025">ipv6</span>&nbsp;<span class="op" id="3118030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118035">if</span>&nbsp;<span class="ident" id="3118038">swap</span>&nbsp;<span class="op" id="3118043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3118049">list</span><span class="op" id="3118053">[</span><span class="num" id="3118054">0</span><span class="op" id="3118055">]</span><span class="op" id="3118056">,</span>&nbsp;<span class="ident" id="3118058">list</span><span class="op" id="3118062">[</span><span class="num" id="3118063">1</span><span class="op" id="3118064">]</span>&nbsp;<span class="op" id="3118066">=</span>&nbsp;<span class="ident" id="3118068">list</span><span class="op" id="3118072">[</span><span class="num" id="3118073">1</span><span class="op" id="3118074">]</span><span class="op" id="3118075">,</span>&nbsp;<span class="ident" id="3118077">list</span><span class="op" id="3118081">[</span><span class="num" id="3118082">0</span><span class="op" id="3118083">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3118088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118093">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3118101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3118104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118107">switch</span>&nbsp;<span class="builtinfunc" id="3118114">len</span><span class="op" id="3118117">(</span><span class="ident" id="3118118">list</span><span class="op" id="3118122">)</span>&nbsp;<span class="op" id="3118124">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118127">case</span>&nbsp;<span class="num" id="3118132">0</span><span class="op" id="3118133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118137">return</span>&nbsp;<span class="ident" id="3118144">nil</span><span class="op" id="3118147">,</span>&nbsp;<span class="ident" id="3118149">errNoSuitableAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118171">case</span>&nbsp;<span class="num" id="3118176">1</span><span class="op" id="3118177">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118181">return</span>&nbsp;<span class="ident" id="3118188">list</span><span class="op" id="3118192">[</span><span class="num" id="3118193">0</span><span class="op" id="3118194">]</span><span class="op" id="3118195">,</span>&nbsp;<span class="ident" id="3118197">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118202">default</span><span class="op" id="3118209">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118213">return</span>&nbsp;<span class="ident" id="3118220">list</span><span class="op" id="3118224">,</span>&nbsp;<span class="ident" id="3118226">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3118231">}</span><br>
<span class="lineno"></span><span class="op" id="3118233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3118236">func</span>&nbsp;<span class="ident" id="3118241">firstSupportedAddr</span><span class="op" id="3118259">(</span><span class="ident" id="3118260">filter</span>&nbsp;<span class="keyword" id="3118267">func</span><span class="op" id="3118271">(</span><span class="ident" id="3118272">IP</span><span class="op" id="3118274">)</span>&nbsp;<span class="ident" id="3118276">IP</span><span class="op" id="3118278">,</span>&nbsp;<span class="ident" id="3118280">ips</span>&nbsp;<span class="op" id="3118284">[</span><span class="op" id="3118285">]</span><span class="ident" id="3118286">IP</span><span class="op" id="3118288">,</span>&nbsp;<span class="ident" id="3118290">inetaddr</span>&nbsp;<span class="keyword" id="3118299">func</span><span class="op" id="3118303">(</span><span class="ident" id="3118304">IP</span><span class="op" id="3118306">)</span>&nbsp;<span class="ident" id="3118308">netaddr</span><span class="op" id="3118315">)</span>&nbsp;<span class="op" id="3118317">(</span><span class="ident" id="3118318">netaddr</span><span class="op" id="3118325">,</span>&nbsp;<span class="builtintype" id="3118327">error</span><span class="op" id="3118332">)</span>&nbsp;<span class="op" id="3118334">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118337">for</span>&nbsp;<span class="ident" id="3118341">_</span><span class="op" id="3118342">,</span>&nbsp;<span class="ident" id="3118344">ip</span>&nbsp;<span class="op" id="3118347">:=</span>&nbsp;<span class="keyword" id="3118350">range</span>&nbsp;<span class="ident" id="3118356">ips</span>&nbsp;<span class="op" id="3118360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118364">if</span>&nbsp;<span class="ident" id="3118367">ip</span>&nbsp;<span class="op" id="3118370">:=</span>&nbsp;<span class="ident" id="3118373">filter</span><span class="op" id="3118379">(</span><span class="ident" id="3118380">ip</span><span class="op" id="3118382">)</span><span class="op" id="3118383">;</span>&nbsp;<span class="ident" id="3118385">ip</span>&nbsp;<span class="op" id="3118388">!=</span>&nbsp;<span class="ident" id="3118391">nil</span>&nbsp;<span class="op" id="3118395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118400">return</span>&nbsp;<span class="ident" id="3118407">inetaddr</span><span class="op" id="3118415">(</span><span class="ident" id="3118416">ip</span><span class="op" id="3118418">)</span><span class="op" id="3118419">,</span>&nbsp;<span class="ident" id="3118421">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3118427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3118430">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118433">return</span>&nbsp;<span class="ident" id="3118440">nil</span><span class="op" id="3118443">,</span>&nbsp;<span class="ident" id="3118445">errNoSuitableAddress</span><br>
<span class="lineno"></span><span class="op" id="3118466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3118469">//&nbsp;ipv4only&nbsp;returns&nbsp;IPv4&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3118538">//&nbsp;IPv4&nbsp;addressing&nbsp;modes.&nbsp;If&nbsp;ip&nbsp;is&nbsp;an&nbsp;IPv4&nbsp;address,&nbsp;ipv4only&nbsp;returns&nbsp;ip.</span><br>
<span class="lineno">120</span><span class="comment" id="3118611">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3118640">func</span>&nbsp;<span class="ident" id="3118645">ipv4only</span><span class="op" id="3118653">(</span><span class="ident" id="3118654">ip</span>&nbsp;<span class="ident" id="3118657">IP</span><span class="op" id="3118659">)</span>&nbsp;<span class="ident" id="3118661">IP</span>&nbsp;<span class="op" id="3118664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118667">if</span>&nbsp;<span class="ident" id="3118670">supportsIPv4</span>&nbsp;<span class="op" id="3118683">&amp;&amp;</span>&nbsp;<span class="ident" id="3118686">ip</span><span class="op" id="3118688">.</span><span class="ident" id="3118689">To4</span><span class="op" id="3118692">(</span><span class="op" id="3118693">)</span>&nbsp;<span class="op" id="3118695">!=</span>&nbsp;<span class="ident" id="3118698">nil</span>&nbsp;<span class="op" id="3118702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118706">return</span>&nbsp;<span class="ident" id="3118713">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3118717">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118720">return</span>&nbsp;<span class="ident" id="3118727">nil</span><br>
<span class="lineno"></span><span class="op" id="3118731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3118734">//&nbsp;ipv6only&nbsp;returns&nbsp;IPv6&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3118803">//&nbsp;IPv6&nbsp;addressing&nbsp;modes.&nbsp;&nbsp;It&nbsp;returns&nbsp;IPv4-mapped&nbsp;IPv6&nbsp;addresses&nbsp;as</span><br>
<span class="lineno">130</span><span class="comment" id="3118871">//&nbsp;nils&nbsp;and&nbsp;returns&nbsp;other&nbsp;IPv6&nbsp;address&nbsp;types&nbsp;as&nbsp;IPv6&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3118935">func</span>&nbsp;<span class="ident" id="3118940">ipv6only</span><span class="op" id="3118948">(</span><span class="ident" id="3118949">ip</span>&nbsp;<span class="ident" id="3118952">IP</span><span class="op" id="3118954">)</span>&nbsp;<span class="ident" id="3118956">IP</span>&nbsp;<span class="op" id="3118959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3118962">if</span>&nbsp;<span class="ident" id="3118965">supportsIPv6</span>&nbsp;<span class="op" id="3118978">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3118981">len</span><span class="op" id="3118984">(</span><span class="ident" id="3118985">ip</span><span class="op" id="3118987">)</span>&nbsp;<span class="op" id="3118989">==</span>&nbsp;<span class="ident" id="3118992">IPv6len</span>&nbsp;<span class="op" id="3119000">&amp;&amp;</span>&nbsp;<span class="ident" id="3119003">ip</span><span class="op" id="3119005">.</span><span class="ident" id="3119006">To4</span><span class="op" id="3119009">(</span><span class="op" id="3119010">)</span>&nbsp;<span class="op" id="3119012">==</span>&nbsp;<span class="ident" id="3119015">nil</span>&nbsp;<span class="op" id="3119019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3119023">return</span>&nbsp;<span class="ident" id="3119030">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3119034">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3119037">return</span>&nbsp;<span class="ident" id="3119044">nil</span><br>
<span class="lineno"></span><span class="op" id="3119048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3119051">//&nbsp;SplitHostPort&nbsp;splits&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3119118">//&nbsp;&#34;[host]:port&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:port&#34;&nbsp;into&nbsp;host&nbsp;or</span><br>
<span class="lineno">140</span><span class="comment" id="3119175">//&nbsp;ipv6-host%zone&nbsp;and&nbsp;port.&nbsp;&nbsp;A&nbsp;literal&nbsp;address&nbsp;or&nbsp;host&nbsp;name&nbsp;for&nbsp;IPv6</span><br>
<span class="lineno"></span><span class="comment" id="3119244">//&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;square&nbsp;brackets,&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3119302">//&nbsp;&#34;[ipv6-host]:http&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3119350">func</span>&nbsp;<span class="ident" id="3119355">SplitHostPort</span><span class="op" id="3119368">(</span><span class="ident" id="3119369">hostport</span>&nbsp;<span class="builtintype" id="3119378">string</span><span class="op" id="3119384">)</span>&nbsp;<span class="op" id="3119386">(</span><span class="ident" id="3119387">host</span><span class="op" id="3119391">,</span>&nbsp;<span class="ident" id="3119393">port</span>&nbsp;<span class="builtintype" id="3119398">string</span><span class="op" id="3119404">,</span>&nbsp;<span class="ident" id="3119406">err</span>&nbsp;<span class="builtintype" id="3119410">error</span><span class="op" id="3119415">)</span>&nbsp;<span class="op" id="3119417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3119420">j</span><span class="op" id="3119421">,</span>&nbsp;<span class="ident" id="3119423">k</span>&nbsp;<span class="op" id="3119425">:=</span>&nbsp;<span class="num" id="3119428">0</span><span class="op" id="3119429">,</span>&nbsp;<span class="num" id="3119431">0</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3119435">//&nbsp;The&nbsp;port&nbsp;starts&nbsp;after&nbsp;the&nbsp;last&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3119477">i</span>&nbsp;<span class="op" id="3119479">:=</span>&nbsp;<span class="ident" id="3119482">last</span><span class="op" id="3119486">(</span><span class="ident" id="3119487">hostport</span><span class="op" id="3119495">,</span>&nbsp;<span class="string" id="3119497">&#39;:&#39;</span><span class="op" id="3119500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3119503">if</span>&nbsp;<span class="ident" id="3119506">i</span>&nbsp;<span class="op" id="3119508">&lt;</span>&nbsp;<span class="num" id="3119510">0</span>&nbsp;<span class="op" id="3119512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3119516">goto</span>&nbsp;<span class="ident" id="3119521">missingPort</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3119534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3119538">if</span>&nbsp;<span class="ident" id="3119541">hostport</span><span class="op" id="3119549">[</span><span class="num" id="3119550">0</span><span class="op" id="3119551">]</span>&nbsp;<span class="op" id="3119553">==</span>&nbsp;<span class="string" id="3119556">&#39;[&#39;</span>&nbsp;<span class="op" id="3119560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3119564">//&nbsp;Expect&nbsp;the&nbsp;first&nbsp;&#39;]&#39;&nbsp;just&nbsp;before&nbsp;the&nbsp;last&nbsp;&#39;:&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3119616">end</span>&nbsp;<span class="op" id="3119620">:=</span>&nbsp;<span class="ident" id="3119623">byteIndex</span><span class="op" id="3119632">(</span><span class="ident" id="3119633">hostport</span><span class="op" id="3119641">,</span>&nbsp;<span class="string" id="3119643">&#39;]&#39;</span><span class="op" id="3119646">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3119650">if</span>&nbsp;<span class="ident" id="3119653">end</span>&nbsp;<span class="op" id="3119657">&lt;</span>&nbsp;<span class="num" id="3119659">0</span>&nbsp;<span class="op" id="3119661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3119666">err</span>&nbsp;<span class="op" id="3119670">=</span>&nbsp;<span class="op" id="3119672">&amp;</span><span class="ident" id="3119673">AddrError</span><span class="op" id="3119682">{</span><span class="string" id="3119683">&#34;missing&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3119707">,</span>&nbsp;<span class="ident" id="3119709">hostport</span><span class="op" id="3119717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3119722">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3119731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3119735">switch</span>&nbsp;<span class="ident" id="3119742">end</span>&nbsp;<span class="op" id="3119746">+</span>&nbsp;<span class="num" id="3119748">1</span>&nbsp;<span class="op" id="3119750">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3119754">case</span>&nbsp;<span class="builtinfunc" id="3119759">len</span><span class="op" id="3119762">(</span><span class="ident" id="3119763">hostport</span><span class="op" id="3119771">)</span><span class="op" id="3119772">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3119777">//&nbsp;There&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;:&#39;&nbsp;behind&nbsp;the&nbsp;&#39;]&#39;&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3119824">goto</span>&nbsp;<span class="ident" id="3119829">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3119843">case</span>&nbsp;<span class="ident" id="3119848">i</span><span class="op" id="3119849">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3119854">//&nbsp;The&nbsp;expected&nbsp;result.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3119880">default</span><span class="op" id="3119887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3119892">//&nbsp;Either&nbsp;&#39;]&#39;&nbsp;isn&#39;t&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;or&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3119945">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon&nbsp;that&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3119997">if</span>&nbsp;<span class="ident" id="3120000">hostport</span><span class="op" id="3120008">[</span><span class="ident" id="3120009">end</span><span class="op" id="3120012">+</span><span class="num" id="3120013">1</span><span class="op" id="3120014">]</span>&nbsp;<span class="op" id="3120016">==</span>&nbsp;<span class="string" id="3120019">&#39;:&#39;</span>&nbsp;<span class="op" id="3120023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3120029">goto</span>&nbsp;<span class="ident" id="3120034">tooManyColons</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3120051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3120056">goto</span>&nbsp;<span class="ident" id="3120061">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3120075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3120079">host</span>&nbsp;<span class="op" id="3120084">=</span>&nbsp;<span class="ident" id="3120086">hostport</span><span class="op" id="3120094">[</span><span class="num" id="3120095">1</span><span class="op" id="3120096">:</span><span class="ident" id="3120097">end</span><span class="op" id="3120100">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3120104">j</span><span class="op" id="3120105">,</span>&nbsp;<span class="ident" id="3120107">k</span>&nbsp;<span class="op" id="3120109">=</span>&nbsp;<span class="num" id="3120111">1</span><span class="op" id="3120112">,</span>&nbsp;<span class="ident" id="3120114">end</span><span class="op" id="3120117">+</span><span class="num" id="3120118">1</span>&nbsp;<span class="comment" id="3120120">//&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;[&#39;&nbsp;resp.&nbsp;&#39;]&#39;&nbsp;before&nbsp;these&nbsp;positions</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3120178">}</span>&nbsp;<span class="keyword" id="3120180">else</span>&nbsp;<span class="op" id="3120185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3120189">host</span>&nbsp;<span class="op" id="3120194">=</span>&nbsp;<span class="ident" id="3120196">hostport</span><span class="op" id="3120204">[</span><span class="op" id="3120205">:</span><span class="ident" id="3120206">i</span><span class="op" id="3120207">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3120211">if</span>&nbsp;<span class="ident" id="3120214">byteIndex</span><span class="op" id="3120223">(</span><span class="ident" id="3120224">host</span><span class="op" id="3120228">,</span>&nbsp;<span class="string" id="3120230">&#39;:&#39;</span><span class="op" id="3120233">)</span>&nbsp;<span class="op" id="3120235">&gt;=</span>&nbsp;<span class="num" id="3120238">0</span>&nbsp;<span class="op" id="3120240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3120245">goto</span>&nbsp;<span class="ident" id="3120250">tooManyColons</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3120266">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3120270">if</span>&nbsp;<span class="ident" id="3120273">byteIndex</span><span class="op" id="3120282">(</span><span class="ident" id="3120283">host</span><span class="op" id="3120287">,</span>&nbsp;<span class="string" id="3120289">&#39;%&#39;</span><span class="op" id="3120292">)</span>&nbsp;<span class="op" id="3120294">&gt;=</span>&nbsp;<span class="num" id="3120297">0</span>&nbsp;<span class="op" id="3120299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3120304">goto</span>&nbsp;<span class="ident" id="3120309">missingBrackets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3120327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3120330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3120333">if</span>&nbsp;<span class="ident" id="3120336">byteIndex</span><span class="op" id="3120345">(</span><span class="ident" id="3120346">hostport</span><span class="op" id="3120354">[</span><span class="ident" id="3120355">j</span><span class="op" id="3120356">:</span><span class="op" id="3120357">]</span><span class="op" id="3120358">,</span>&nbsp;<span class="string" id="3120360">&#39;[&#39;</span><span class="op" id="3120363">)</span>&nbsp;<span class="op" id="3120365">&gt;=</span>&nbsp;<span class="num" id="3120368">0</span>&nbsp;<span class="op" id="3120370">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3120374">err</span>&nbsp;<span class="op" id="3120378">=</span>&nbsp;<span class="op" id="3120380">&amp;</span><span class="ident" id="3120381">AddrError</span><span class="op" id="3120390">{</span><span class="string" id="3120391">&#34;unexpected&nbsp;&#39;[&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3120418">,</span>&nbsp;<span class="ident" id="3120420">hostport</span><span class="op" id="3120428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3120432">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3120440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3120443">if</span>&nbsp;<span class="ident" id="3120446">byteIndex</span><span class="op" id="3120455">(</span><span class="ident" id="3120456">hostport</span><span class="op" id="3120464">[</span><span class="ident" id="3120465">k</span><span class="op" id="3120466">:</span><span class="op" id="3120467">]</span><span class="op" id="3120468">,</span>&nbsp;<span class="string" id="3120470">&#39;]&#39;</span><span class="op" id="3120473">)</span>&nbsp;<span class="op" id="3120475">&gt;=</span>&nbsp;<span class="num" id="3120478">0</span>&nbsp;<span class="op" id="3120480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3120484">err</span>&nbsp;<span class="op" id="3120488">=</span>&nbsp;<span class="op" id="3120490">&amp;</span><span class="ident" id="3120491">AddrError</span><span class="op" id="3120500">{</span><span class="string" id="3120501">&#34;unexpected&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3120528">,</span>&nbsp;<span class="ident" id="3120530">hostport</span><span class="op" id="3120538">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3120542">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3120550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3120554">port</span>&nbsp;<span class="op" id="3120559">=</span>&nbsp;<span class="ident" id="3120561">hostport</span><span class="op" id="3120569">[</span><span class="ident" id="3120570">i</span><span class="op" id="3120571">+</span><span class="num" id="3120572">1</span><span class="op" id="3120573">:</span><span class="op" id="3120574">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3120577">return</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="ident" id="3120585">missingPort</span><span class="op" id="3120596">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3120599">err</span>&nbsp;<span class="op" id="3120603">=</span>&nbsp;<span class="op" id="3120605">&amp;</span><span class="ident" id="3120606">AddrError</span><span class="op" id="3120615">{</span><span class="string" id="3120616">&#34;missing&nbsp;port&nbsp;in&nbsp;address&#34;</span><span class="op" id="3120641">,</span>&nbsp;<span class="ident" id="3120643">hostport</span><span class="op" id="3120651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3120654">return</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="ident" id="3120662">tooManyColons</span><span class="op" id="3120675">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3120678">err</span>&nbsp;<span class="op" id="3120682">=</span>&nbsp;<span class="op" id="3120684">&amp;</span><span class="ident" id="3120685">AddrError</span><span class="op" id="3120694">{</span><span class="string" id="3120695">&#34;too&nbsp;many&nbsp;colons&nbsp;in&nbsp;address&#34;</span><span class="op" id="3120723">,</span>&nbsp;<span class="ident" id="3120725">hostport</span><span class="op" id="3120733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3120736">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3120744">missingBrackets</span><span class="op" id="3120759">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3120762">err</span>&nbsp;<span class="op" id="3120766">=</span>&nbsp;<span class="op" id="3120768">&amp;</span><span class="ident" id="3120769">AddrError</span><span class="op" id="3120778">{</span><span class="string" id="3120779">&#34;missing&nbsp;brackets&nbsp;in&nbsp;address&#34;</span><span class="op" id="3120808">,</span>&nbsp;<span class="ident" id="3120810">hostport</span><span class="op" id="3120818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3120821">return</span><br>
<span class="lineno"></span><span class="op" id="3120828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3120831">func</span>&nbsp;<span class="ident" id="3120836">splitHostZone</span><span class="op" id="3120849">(</span><span class="ident" id="3120850">s</span>&nbsp;<span class="builtintype" id="3120852">string</span><span class="op" id="3120858">)</span>&nbsp;<span class="op" id="3120860">(</span><span class="ident" id="3120861">host</span><span class="op" id="3120865">,</span>&nbsp;<span class="ident" id="3120867">zone</span>&nbsp;<span class="builtintype" id="3120872">string</span><span class="op" id="3120878">)</span>&nbsp;<span class="op" id="3120880">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3120883">//&nbsp;The&nbsp;IPv6&nbsp;scoped&nbsp;addressing&nbsp;zone&nbsp;identifier&nbsp;starts&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3120947">//&nbsp;last&nbsp;percent&nbsp;sign.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3120970">if</span>&nbsp;<span class="ident" id="3120973">i</span>&nbsp;<span class="op" id="3120975">:=</span>&nbsp;<span class="ident" id="3120978">last</span><span class="op" id="3120982">(</span><span class="ident" id="3120983">s</span><span class="op" id="3120984">,</span>&nbsp;<span class="string" id="3120986">&#39;%&#39;</span><span class="op" id="3120989">)</span><span class="op" id="3120990">;</span>&nbsp;<span class="ident" id="3120992">i</span>&nbsp;<span class="op" id="3120994">&gt;</span>&nbsp;<span class="num" id="3120996">0</span>&nbsp;<span class="op" id="3120998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3121002">host</span><span class="op" id="3121006">,</span>&nbsp;<span class="ident" id="3121008">zone</span>&nbsp;<span class="op" id="3121013">=</span>&nbsp;<span class="ident" id="3121015">s</span><span class="op" id="3121016">[</span><span class="op" id="3121017">:</span><span class="ident" id="3121018">i</span><span class="op" id="3121019">]</span><span class="op" id="3121020">,</span>&nbsp;<span class="ident" id="3121022">s</span><span class="op" id="3121023">[</span><span class="ident" id="3121024">i</span><span class="op" id="3121025">+</span><span class="num" id="3121026">1</span><span class="op" id="3121027">:</span><span class="op" id="3121028">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3121031">}</span>&nbsp;<span class="keyword" id="3121033">else</span>&nbsp;<span class="op" id="3121038">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3121042">host</span>&nbsp;<span class="op" id="3121047">=</span>&nbsp;<span class="ident" id="3121049">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3121052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3121055">return</span><br>
<span class="lineno"></span><span class="op" id="3121062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="3121065">//&nbsp;JoinHostPort&nbsp;combines&nbsp;host&nbsp;and&nbsp;port&nbsp;into&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3121134">//&nbsp;form&nbsp;&#34;host:port&#34;&nbsp;or,&nbsp;if&nbsp;host&nbsp;contains&nbsp;a&nbsp;colon&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,</span><br>
<span class="lineno"></span><span class="comment" id="3121202">//&nbsp;&#34;[host]:port&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3121220">func</span>&nbsp;<span class="ident" id="3121225">JoinHostPort</span><span class="op" id="3121237">(</span><span class="ident" id="3121238">host</span><span class="op" id="3121242">,</span>&nbsp;<span class="ident" id="3121244">port</span>&nbsp;<span class="builtintype" id="3121249">string</span><span class="op" id="3121255">)</span>&nbsp;<span class="builtintype" id="3121257">string</span>&nbsp;<span class="op" id="3121264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3121267">//&nbsp;If&nbsp;host&nbsp;has&nbsp;colons&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,&nbsp;have&nbsp;to&nbsp;bracket&nbsp;it.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3121329">if</span>&nbsp;<span class="ident" id="3121332">byteIndex</span><span class="op" id="3121341">(</span><span class="ident" id="3121342">host</span><span class="op" id="3121346">,</span>&nbsp;<span class="string" id="3121348">&#39;:&#39;</span><span class="op" id="3121351">)</span>&nbsp;<span class="op" id="3121353">&gt;=</span>&nbsp;<span class="num" id="3121356">0</span>&nbsp;<span class="op" id="3121358">||</span>&nbsp;<span class="ident" id="3121361">byteIndex</span><span class="op" id="3121370">(</span><span class="ident" id="3121371">host</span><span class="op" id="3121375">,</span>&nbsp;<span class="string" id="3121377">&#39;%&#39;</span><span class="op" id="3121380">)</span>&nbsp;<span class="op" id="3121382">&gt;=</span>&nbsp;<span class="num" id="3121385">0</span>&nbsp;<span class="op" id="3121387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3121391">return</span>&nbsp;<span class="string" id="3121398">&#34;[&#34;</span>&nbsp;<span class="op" id="3121402">+</span>&nbsp;<span class="ident" id="3121404">host</span>&nbsp;<span class="op" id="3121409">+</span>&nbsp;<span class="string" id="3121411">&#34;]:&#34;</span>&nbsp;<span class="op" id="3121416">+</span>&nbsp;<span class="ident" id="3121418">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3121424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3121427">return</span>&nbsp;<span class="ident" id="3121434">host</span>&nbsp;<span class="op" id="3121439">+</span>&nbsp;<span class="string" id="3121441">&#34;:&#34;</span>&nbsp;<span class="op" id="3121445">+</span>&nbsp;<span class="ident" id="3121447">port</span><br>
<span class="lineno"></span><span class="op" id="3121452">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3121455">//&nbsp;resolveInternetAddr&nbsp;resolves&nbsp;addr&nbsp;that&nbsp;is&nbsp;either&nbsp;a&nbsp;literal&nbsp;IP</span><br>
<span class="lineno"></span><span class="comment" id="3121520">//&nbsp;address&nbsp;or&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;returns&nbsp;an&nbsp;internet&nbsp;protocol&nbsp;family</span><br>
<span class="lineno"></span><span class="comment" id="3121585">//&nbsp;address.&nbsp;It&nbsp;returns&nbsp;a&nbsp;list&nbsp;that&nbsp;contains&nbsp;a&nbsp;pair&nbsp;of&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3121649">//&nbsp;address&nbsp;family&nbsp;addresses&nbsp;when&nbsp;addr&nbsp;is&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;the&nbsp;name&nbsp;has</span><br>
<span class="lineno">235</span><span class="comment" id="3121718">//&nbsp;multiple&nbsp;address&nbsp;family&nbsp;records.&nbsp;The&nbsp;result&nbsp;contains&nbsp;at&nbsp;least&nbsp;one</span><br>
<span class="lineno"></span><span class="comment" id="3121787">//&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3121817">func</span>&nbsp;<span class="ident" id="3121822">resolveInternetAddr</span><span class="op" id="3121841">(</span><span class="ident" id="3121842">net</span><span class="op" id="3121845">,</span>&nbsp;<span class="ident" id="3121847">addr</span>&nbsp;<span class="builtintype" id="3121852">string</span><span class="op" id="3121858">,</span>&nbsp;<span class="ident" id="3121860">deadline</span>&nbsp;<span class="ident" id="3121869">time</span><span class="op" id="3121873">.</span><span class="ident" id="3121874">Time</span><span class="op" id="3121878">)</span>&nbsp;<span class="op" id="3121880">(</span><span class="ident" id="3121881">netaddr</span><span class="op" id="3121888">,</span>&nbsp;<span class="builtintype" id="3121890">error</span><span class="op" id="3121895">)</span>&nbsp;<span class="op" id="3121897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3121900">var</span>&nbsp;<span class="op" id="3121904">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3121908">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3121925">error</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3121933">host</span><span class="op" id="3121937">,</span>&nbsp;<span class="ident" id="3121939">port</span><span class="op" id="3121943">,</span>&nbsp;<span class="ident" id="3121945">zone</span>&nbsp;<span class="builtintype" id="3121950">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3121959">portnum</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3121976">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3121981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3121984">switch</span>&nbsp;<span class="ident" id="3121991">net</span>&nbsp;<span class="op" id="3121995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3121998">case</span>&nbsp;<span class="string" id="3122003">&#34;tcp&#34;</span><span class="op" id="3122008">,</span>&nbsp;<span class="string" id="3122010">&#34;tcp4&#34;</span><span class="op" id="3122016">,</span>&nbsp;<span class="string" id="3122018">&#34;tcp6&#34;</span><span class="op" id="3122024">,</span>&nbsp;<span class="string" id="3122026">&#34;udp&#34;</span><span class="op" id="3122031">,</span>&nbsp;<span class="string" id="3122033">&#34;udp4&#34;</span><span class="op" id="3122039">,</span>&nbsp;<span class="string" id="3122041">&#34;udp6&#34;</span><span class="op" id="3122047">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122051">if</span>&nbsp;<span class="ident" id="3122054">addr</span>&nbsp;<span class="op" id="3122059">!=</span>&nbsp;<span class="string" id="3122062">&#34;&#34;</span>&nbsp;<span class="op" id="3122065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122070">if</span>&nbsp;<span class="ident" id="3122073">host</span><span class="op" id="3122077">,</span>&nbsp;<span class="ident" id="3122079">port</span><span class="op" id="3122083">,</span>&nbsp;<span class="ident" id="3122085">err</span>&nbsp;<span class="op" id="3122089">=</span>&nbsp;<span class="ident" id="3122091">SplitHostPort</span><span class="op" id="3122104">(</span><span class="ident" id="3122105">addr</span><span class="op" id="3122109">)</span><span class="op" id="3122110">;</span>&nbsp;<span class="ident" id="3122112">err</span>&nbsp;<span class="op" id="3122116">!=</span>&nbsp;<span class="ident" id="3122119">nil</span>&nbsp;<span class="op" id="3122123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122129">return</span>&nbsp;<span class="ident" id="3122136">nil</span><span class="op" id="3122139">,</span>&nbsp;<span class="ident" id="3122141">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3122148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122153">if</span>&nbsp;<span class="ident" id="3122156">portnum</span><span class="op" id="3122163">,</span>&nbsp;<span class="ident" id="3122165">err</span>&nbsp;<span class="op" id="3122169">=</span>&nbsp;<span class="ident" id="3122171">parsePort</span><span class="op" id="3122180">(</span><span class="ident" id="3122181">net</span><span class="op" id="3122184">,</span>&nbsp;<span class="ident" id="3122186">port</span><span class="op" id="3122190">)</span><span class="op" id="3122191">;</span>&nbsp;<span class="ident" id="3122193">err</span>&nbsp;<span class="op" id="3122197">!=</span>&nbsp;<span class="ident" id="3122200">nil</span>&nbsp;<span class="op" id="3122204">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122210">return</span>&nbsp;<span class="ident" id="3122217">nil</span><span class="op" id="3122220">,</span>&nbsp;<span class="ident" id="3122222">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3122229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3122233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122236">case</span>&nbsp;<span class="string" id="3122241">&#34;ip&#34;</span><span class="op" id="3122245">,</span>&nbsp;<span class="string" id="3122247">&#34;ip4&#34;</span><span class="op" id="3122252">,</span>&nbsp;<span class="string" id="3122254">&#34;ip6&#34;</span><span class="op" id="3122259">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122263">if</span>&nbsp;<span class="ident" id="3122266">addr</span>&nbsp;<span class="op" id="3122271">!=</span>&nbsp;<span class="string" id="3122274">&#34;&#34;</span>&nbsp;<span class="op" id="3122277">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3122282">host</span>&nbsp;<span class="op" id="3122287">=</span>&nbsp;<span class="ident" id="3122289">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3122296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122299">default</span><span class="op" id="3122306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122310">return</span>&nbsp;<span class="ident" id="3122317">nil</span><span class="op" id="3122320">,</span>&nbsp;<span class="ident" id="3122322">UnknownNetworkError</span><span class="op" id="3122341">(</span><span class="ident" id="3122342">net</span><span class="op" id="3122345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3122348">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3122351">inetaddr</span>&nbsp;<span class="op" id="3122360">:=</span>&nbsp;<span class="keyword" id="3122363">func</span><span class="op" id="3122367">(</span><span class="ident" id="3122368">ip</span>&nbsp;<span class="ident" id="3122371">IP</span><span class="op" id="3122373">)</span>&nbsp;<span class="ident" id="3122375">netaddr</span>&nbsp;<span class="op" id="3122383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122387">switch</span>&nbsp;<span class="ident" id="3122394">net</span>&nbsp;<span class="op" id="3122398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122402">case</span>&nbsp;<span class="string" id="3122407">&#34;tcp&#34;</span><span class="op" id="3122412">,</span>&nbsp;<span class="string" id="3122414">&#34;tcp4&#34;</span><span class="op" id="3122420">,</span>&nbsp;<span class="string" id="3122422">&#34;tcp6&#34;</span><span class="op" id="3122428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122433">return</span>&nbsp;<span class="op" id="3122440">&amp;</span><span class="ident" id="3122441">TCPAddr</span><span class="op" id="3122448">{</span><span class="ident" id="3122449">IP</span><span class="op" id="3122451">:</span>&nbsp;<span class="ident" id="3122453">ip</span><span class="op" id="3122455">,</span>&nbsp;<span class="ident" id="3122457">Port</span><span class="op" id="3122461">:</span>&nbsp;<span class="ident" id="3122463">portnum</span><span class="op" id="3122470">,</span>&nbsp;<span class="ident" id="3122472">Zone</span><span class="op" id="3122476">:</span>&nbsp;<span class="ident" id="3122478">zone</span><span class="op" id="3122482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122486">case</span>&nbsp;<span class="string" id="3122491">&#34;udp&#34;</span><span class="op" id="3122496">,</span>&nbsp;<span class="string" id="3122498">&#34;udp4&#34;</span><span class="op" id="3122504">,</span>&nbsp;<span class="string" id="3122506">&#34;udp6&#34;</span><span class="op" id="3122512">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122517">return</span>&nbsp;<span class="op" id="3122524">&amp;</span><span class="ident" id="3122525">UDPAddr</span><span class="op" id="3122532">{</span><span class="ident" id="3122533">IP</span><span class="op" id="3122535">:</span>&nbsp;<span class="ident" id="3122537">ip</span><span class="op" id="3122539">,</span>&nbsp;<span class="ident" id="3122541">Port</span><span class="op" id="3122545">:</span>&nbsp;<span class="ident" id="3122547">portnum</span><span class="op" id="3122554">,</span>&nbsp;<span class="ident" id="3122556">Zone</span><span class="op" id="3122560">:</span>&nbsp;<span class="ident" id="3122562">zone</span><span class="op" id="3122566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122570">case</span>&nbsp;<span class="string" id="3122575">&#34;ip&#34;</span><span class="op" id="3122579">,</span>&nbsp;<span class="string" id="3122581">&#34;ip4&#34;</span><span class="op" id="3122586">,</span>&nbsp;<span class="string" id="3122588">&#34;ip6&#34;</span><span class="op" id="3122593">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122598">return</span>&nbsp;<span class="op" id="3122605">&amp;</span><span class="ident" id="3122606">IPAddr</span><span class="op" id="3122612">{</span><span class="ident" id="3122613">IP</span><span class="op" id="3122615">:</span>&nbsp;<span class="ident" id="3122617">ip</span><span class="op" id="3122619">,</span>&nbsp;<span class="ident" id="3122621">Zone</span><span class="op" id="3122625">:</span>&nbsp;<span class="ident" id="3122627">zone</span><span class="op" id="3122631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122635">default</span><span class="op" id="3122642">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3122647">panic</span><span class="op" id="3122652">(</span><span class="string" id="3122653">&#34;unexpected&nbsp;network:&nbsp;&#34;</span>&nbsp;<span class="op" id="3122676">+</span>&nbsp;<span class="ident" id="3122678">net</span><span class="op" id="3122681">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3122685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3122688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122691">if</span>&nbsp;<span class="ident" id="3122694">host</span>&nbsp;<span class="op" id="3122699">==</span>&nbsp;<span class="string" id="3122702">&#34;&#34;</span>&nbsp;<span class="op" id="3122705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122709">return</span>&nbsp;<span class="ident" id="3122716">inetaddr</span><span class="op" id="3122724">(</span><span class="ident" id="3122725">nil</span><span class="op" id="3122728">)</span><span class="op" id="3122729">,</span>&nbsp;<span class="ident" id="3122731">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3122736">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3122739">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122772">var</span>&nbsp;<span class="ident" id="3122776">ip</span>&nbsp;<span class="ident" id="3122779">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122783">if</span>&nbsp;<span class="ident" id="3122786">ip</span>&nbsp;<span class="op" id="3122789">=</span>&nbsp;<span class="ident" id="3122791">parseIPv4</span><span class="op" id="3122800">(</span><span class="ident" id="3122801">host</span><span class="op" id="3122805">)</span><span class="op" id="3122806">;</span>&nbsp;<span class="ident" id="3122808">ip</span>&nbsp;<span class="op" id="3122811">!=</span>&nbsp;<span class="ident" id="3122814">nil</span>&nbsp;<span class="op" id="3122818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122822">return</span>&nbsp;<span class="ident" id="3122829">inetaddr</span><span class="op" id="3122837">(</span><span class="ident" id="3122838">ip</span><span class="op" id="3122840">)</span><span class="op" id="3122841">,</span>&nbsp;<span class="ident" id="3122843">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3122848">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122851">if</span>&nbsp;<span class="ident" id="3122854">ip</span><span class="op" id="3122856">,</span>&nbsp;<span class="ident" id="3122858">zone</span>&nbsp;<span class="op" id="3122863">=</span>&nbsp;<span class="ident" id="3122865">parseIPv6</span><span class="op" id="3122874">(</span><span class="ident" id="3122875">host</span><span class="op" id="3122879">,</span>&nbsp;<span class="builtintype" id="3122881">true</span><span class="op" id="3122885">)</span><span class="op" id="3122886">;</span>&nbsp;<span class="ident" id="3122888">ip</span>&nbsp;<span class="op" id="3122891">!=</span>&nbsp;<span class="ident" id="3122894">nil</span>&nbsp;<span class="op" id="3122898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3122902">return</span>&nbsp;<span class="ident" id="3122909">inetaddr</span><span class="op" id="3122917">(</span><span class="ident" id="3122918">ip</span><span class="op" id="3122920">)</span><span class="op" id="3122921">,</span>&nbsp;<span class="ident" id="3122923">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3122928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3122931">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;DNS&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3122954">host</span><span class="op" id="3122958">,</span>&nbsp;<span class="ident" id="3122960">zone</span>&nbsp;<span class="op" id="3122965">=</span>&nbsp;<span class="ident" id="3122967">splitHostZone</span><span class="op" id="3122980">(</span><span class="ident" id="3122981">host</span><span class="op" id="3122985">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3122988">ips</span><span class="op" id="3122991">,</span>&nbsp;<span class="ident" id="3122993">err</span>&nbsp;<span class="op" id="3122997">:=</span>&nbsp;<span class="ident" id="3123000">lookupIPDeadline</span><span class="op" id="3123016">(</span><span class="ident" id="3123017">host</span><span class="op" id="3123021">,</span>&nbsp;<span class="ident" id="3123023">deadline</span><span class="op" id="3123031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3123034">if</span>&nbsp;<span class="ident" id="3123037">err</span>&nbsp;<span class="op" id="3123041">!=</span>&nbsp;<span class="ident" id="3123044">nil</span>&nbsp;<span class="op" id="3123048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3123052">return</span>&nbsp;<span class="ident" id="3123059">nil</span><span class="op" id="3123062">,</span>&nbsp;<span class="ident" id="3123064">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3123069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3123072">var</span>&nbsp;<span class="ident" id="3123076">filter</span>&nbsp;<span class="keyword" id="3123083">func</span><span class="op" id="3123087">(</span><span class="ident" id="3123088">IP</span><span class="op" id="3123090">)</span>&nbsp;<span class="ident" id="3123092">IP</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3123096">if</span>&nbsp;<span class="ident" id="3123099">net</span>&nbsp;<span class="op" id="3123103">!=</span>&nbsp;<span class="string" id="3123106">&#34;&#34;</span>&nbsp;<span class="op" id="3123109">&amp;&amp;</span>&nbsp;<span class="ident" id="3123112">net</span><span class="op" id="3123115">[</span><span class="builtinfunc" id="3123116">len</span><span class="op" id="3123119">(</span><span class="ident" id="3123120">net</span><span class="op" id="3123123">)</span><span class="op" id="3123124">-</span><span class="num" id="3123125">1</span><span class="op" id="3123126">]</span>&nbsp;<span class="op" id="3123128">==</span>&nbsp;<span class="string" id="3123131">&#39;4&#39;</span>&nbsp;<span class="op" id="3123135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3123139">filter</span>&nbsp;<span class="op" id="3123146">=</span>&nbsp;<span class="ident" id="3123148">ipv4only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3123158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3123161">if</span>&nbsp;<span class="ident" id="3123164">net</span>&nbsp;<span class="op" id="3123168">!=</span>&nbsp;<span class="string" id="3123171">&#34;&#34;</span>&nbsp;<span class="op" id="3123174">&amp;&amp;</span>&nbsp;<span class="ident" id="3123177">net</span><span class="op" id="3123180">[</span><span class="builtinfunc" id="3123181">len</span><span class="op" id="3123184">(</span><span class="ident" id="3123185">net</span><span class="op" id="3123188">)</span><span class="op" id="3123189">-</span><span class="num" id="3123190">1</span><span class="op" id="3123191">]</span>&nbsp;<span class="op" id="3123193">==</span>&nbsp;<span class="string" id="3123196">&#39;6&#39;</span>&nbsp;<span class="op" id="3123200">||</span>&nbsp;<span class="ident" id="3123203">zone</span>&nbsp;<span class="op" id="3123208">!=</span>&nbsp;<span class="string" id="3123211">&#34;&#34;</span>&nbsp;<span class="op" id="3123214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3123218">filter</span>&nbsp;<span class="op" id="3123225">=</span>&nbsp;<span class="ident" id="3123227">ipv6only</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3123237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3123240">return</span>&nbsp;<span class="ident" id="3123247">firstFavoriteAddr</span><span class="op" id="3123264">(</span><span class="ident" id="3123265">filter</span><span class="op" id="3123271">,</span>&nbsp;<span class="ident" id="3123273">ips</span><span class="op" id="3123276">,</span>&nbsp;<span class="ident" id="3123278">inetaddr</span><span class="op" id="3123286">)</span><br>
<span class="lineno"></span><span class="op" id="3123288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3123291">func</span>&nbsp;<span class="ident" id="3123296">zoneToString</span><span class="op" id="3123308">(</span><span class="ident" id="3123309">zone</span>&nbsp;<span class="builtintype" id="3123314">int</span><span class="op" id="3123317">)</span>&nbsp;<span class="builtintype" id="3123319">string</span>&nbsp;<span class="op" id="3123326">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3123329">if</span>&nbsp;<span class="ident" id="3123332">zone</span>&nbsp;<span class="op" id="3123337">==</span>&nbsp;<span class="num" id="3123340">0</span>&nbsp;<span class="op" id="3123342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3123346">return</span>&nbsp;<span class="string" id="3123353">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3123357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3123360">if</span>&nbsp;<span class="ident" id="3123363">ifi</span><span class="op" id="3123366">,</span>&nbsp;<span class="ident" id="3123368">err</span>&nbsp;<span class="op" id="3123372">:=</span>&nbsp;<span class="ident" id="3123375">InterfaceByIndex</span><span class="op" id="3123391">(</span><span class="ident" id="3123392">zone</span><span class="op" id="3123396">)</span><span class="op" id="3123397">;</span>&nbsp;<span class="ident" id="3123399">err</span>&nbsp;<span class="op" id="3123403">==</span>&nbsp;<span class="ident" id="3123406">nil</span>&nbsp;<span class="op" id="3123410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3123414">return</span>&nbsp;<span class="ident" id="3123421">ifi</span><span class="op" id="3123424">.</span><span class="ident" id="3123425">Name</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3123431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3123434">return</span>&nbsp;<span class="ident" id="3123441">itod</span><span class="op" id="3123445">(</span><span class="builtintype" id="3123446">uint</span><span class="op" id="3123450">(</span><span class="ident" id="3123451">zone</span><span class="op" id="3123455">)</span><span class="op" id="3123456">)</span><br>
<span class="lineno"></span><span class="op" id="3123458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3123461">func</span>&nbsp;<span class="ident" id="3123466">zoneToInt</span><span class="op" id="3123475">(</span><span class="ident" id="3123476">zone</span>&nbsp;<span class="builtintype" id="3123481">string</span><span class="op" id="3123487">)</span>&nbsp;<span class="builtintype" id="3123489">int</span>&nbsp;<span class="op" id="3123493">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3123496">if</span>&nbsp;<span class="ident" id="3123499">zone</span>&nbsp;<span class="op" id="3123504">==</span>&nbsp;<span class="string" id="3123507">&#34;&#34;</span>&nbsp;<span class="op" id="3123510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3123514">return</span>&nbsp;<span class="num" id="3123521">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3123524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3123527">if</span>&nbsp;<span class="ident" id="3123530">ifi</span><span class="op" id="3123533">,</span>&nbsp;<span class="ident" id="3123535">err</span>&nbsp;<span class="op" id="3123539">:=</span>&nbsp;<span class="ident" id="3123542">InterfaceByName</span><span class="op" id="3123557">(</span><span class="ident" id="3123558">zone</span><span class="op" id="3123562">)</span><span class="op" id="3123563">;</span>&nbsp;<span class="ident" id="3123565">err</span>&nbsp;<span class="op" id="3123569">==</span>&nbsp;<span class="ident" id="3123572">nil</span>&nbsp;<span class="op" id="3123576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3123580">return</span>&nbsp;<span class="ident" id="3123587">ifi</span><span class="op" id="3123590">.</span><span class="ident" id="3123591">Index</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3123598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3123601">n</span><span class="op" id="3123602">,</span>&nbsp;<span class="ident" id="3123604">_</span><span class="op" id="3123605">,</span>&nbsp;<span class="ident" id="3123607">_</span>&nbsp;<span class="op" id="3123609">:=</span>&nbsp;<span class="ident" id="3123612">dtoi</span><span class="op" id="3123616">(</span><span class="ident" id="3123617">zone</span><span class="op" id="3123621">,</span>&nbsp;<span class="num" id="3123623">0</span><span class="op" id="3123624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3123627">return</span>&nbsp;<span class="ident" id="3123634">n</span><br>
<span class="lineno"></span><span class="op" id="3123636">}</span>
</div>
</body>
</html>
