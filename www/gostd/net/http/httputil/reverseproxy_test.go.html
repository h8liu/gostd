<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httputil</h2>
<ul>
<li><a href="/gostd/net/http/httputil/dump.go.html">dump.go</a></li>
<li><a href="/gostd/net/http/httputil/dump_test.go.html">dump_test.go</a></li>
<li><a href="/gostd/net/http/httputil/httputil.go.html">httputil.go</a></li>
<li><a href="/gostd/net/http/httputil/persist.go.html">persist.go</a></li>
<li><a href="/gostd/net/http/httputil/reverseproxy.go.html">reverseproxy.go</a></li>
<li><a href="/gostd/net/http/httputil/reverseproxy_test.go.html" class="current">reverseproxy_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6495842">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6495897">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6495951">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6496002">//&nbsp;Reverse&nbsp;proxy&nbsp;tests.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6496027">package</span>&nbsp;<span class="ident" id="6496035">httputil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6496045">import</span>&nbsp;<span class="op" id="6496052">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6496055">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6496068">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6496080">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6496101">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6496112">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6496123">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6496134">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6496141">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6496144">const</span>&nbsp;<span class="ident" id="6496150">fakeHopHeader</span>&nbsp;<span class="op" id="6496164">=</span>&nbsp;<span class="string" id="6496166">&#34;X-Fake-Hop-Header-For-Test&#34;</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6496196">func</span>&nbsp;<span class="ident" id="6496201">init</span><span class="op" id="6496205">(</span><span class="op" id="6496206">)</span>&nbsp;<span class="op" id="6496208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6496211"><a href="/gostd/net/http/httputil/reverseproxy.go.html#6401854">hopHeaders</a></span>&nbsp;<span class="op" id="6496222">=</span>&nbsp;<span class="builtinfunc" id="6496224">append</span><span class="op" id="6496230">(</span><span class="ident" id="6496231"><a href="/gostd/net/http/httputil/reverseproxy.go.html#6401854">hopHeaders</a></span><span class="op" id="6496241">,</span>&nbsp;<span class="ident" id="6496243"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496150">fakeHopHeader</a></span><span class="op" id="6496256">)</span><br>
<span class="lineno"></span><span class="op" id="6496258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6496261">func</span>&nbsp;<span class="ident" id="6496266">TestReverseProxy</span><span class="op" id="6496282">(</span><span class="ident" id="6496283">t</span>&nbsp;<span class="op" id="6496285">*</span><span class="ident" id="6496286"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496123">testing</a></span><span class="op" id="6496293">.</span><span class="ident" id="6496294"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6496295">)</span>&nbsp;<span class="op" id="6496297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496300">const</span>&nbsp;<span class="ident" id="6496306">backendResponse</span>&nbsp;<span class="op" id="6496322">=</span>&nbsp;<span class="string" id="6496324">&#34;I&nbsp;am&nbsp;the&nbsp;backend&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496344">const</span>&nbsp;<span class="ident" id="6496350">backendStatus</span>&nbsp;<span class="op" id="6496364">=</span>&nbsp;<span class="num" id="6496366">404</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6496371">backend</span>&nbsp;<span class="op" id="6496379">:=</span>&nbsp;<span class="ident" id="6496382"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496080">httptest</a></span><span class="op" id="6496390">.</span><span class="ident" id="6496391"><a href="/gostd/net/http/httptest/server.go.html#6135832">NewServer</a></span><span class="op" id="6496400">(</span><span class="ident" id="6496401"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6496405">.</span><span class="ident" id="6496406"><a href="/gostd/net/http/server.go.html#4205623">HandlerFunc</a></span><span class="op" id="6496417">(</span><span class="keyword" id="6496418">func</span><span class="op" id="6496422">(</span><span class="ident" id="6496423">w</span>&nbsp;<span class="ident" id="6496425"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6496429">.</span><span class="ident" id="6496430"><a href="/gostd/net/http/server.go.html#4170569">ResponseWriter</a></span><span class="op" id="6496444">,</span>&nbsp;<span class="ident" id="6496446">r</span>&nbsp;<span class="op" id="6496448">*</span><span class="ident" id="6496449"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6496453">.</span><span class="ident" id="6496454"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6496461">)</span>&nbsp;<span class="op" id="6496463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496467">if</span>&nbsp;<span class="builtinfunc" id="6496470">len</span><span class="op" id="6496473">(</span><span class="ident" id="6496474"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496446">r</a></span><span class="op" id="6496475">.</span><span class="ident" id="6496476"><a href="/gostd/net/http/request.go.html#4138599">TransferEncoding</a></span><span class="op" id="6496492">)</span>&nbsp;<span class="op" id="6496494">&gt;</span>&nbsp;<span class="num" id="6496496">0</span>&nbsp;<span class="op" id="6496498">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6496503"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496283">t</a></span><span class="op" id="6496504">.</span><span class="ident" id="6496505"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6496511">(</span><span class="string" id="6496512">&#34;backend&nbsp;got&nbsp;unexpected&nbsp;TransferEncoding:&nbsp;%v&#34;</span><span class="op" id="6496557">,</span>&nbsp;<span class="ident" id="6496559"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496446">r</a></span><span class="op" id="6496560">.</span><span class="ident" id="6496561"><a href="/gostd/net/http/request.go.html#4138599">TransferEncoding</a></span><span class="op" id="6496577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6496581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496585">if</span>&nbsp;<span class="ident" id="6496588"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496446">r</a></span><span class="op" id="6496589">.</span><span class="ident" id="6496590"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="6496596">.</span><span class="ident" id="6496597"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="6496600">(</span><span class="string" id="6496601">&#34;X-Forwarded-For&#34;</span><span class="op" id="6496618">)</span>&nbsp;<span class="op" id="6496620">==</span>&nbsp;<span class="string" id="6496623">&#34;&#34;</span>&nbsp;<span class="op" id="6496626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6496631"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496283">t</a></span><span class="op" id="6496632">.</span><span class="ident" id="6496633"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6496639">(</span><span class="string" id="6496640">&#34;didn&#39;t&nbsp;get&nbsp;X-Forwarded-For&nbsp;header&#34;</span><span class="op" id="6496675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6496679">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496683">if</span>&nbsp;<span class="ident" id="6496686">c</span>&nbsp;<span class="op" id="6496688">:=</span>&nbsp;<span class="ident" id="6496691"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496446">r</a></span><span class="op" id="6496692">.</span><span class="ident" id="6496693"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="6496699">.</span><span class="ident" id="6496700"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="6496703">(</span><span class="string" id="6496704">&#34;Connection&#34;</span><span class="op" id="6496716">)</span><span class="op" id="6496717">;</span>&nbsp;<span class="ident" id="6496719"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496686">c</a></span>&nbsp;<span class="op" id="6496721">!=</span>&nbsp;<span class="string" id="6496724">&#34;&#34;</span>&nbsp;<span class="op" id="6496727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6496732"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496283">t</a></span><span class="op" id="6496733">.</span><span class="ident" id="6496734"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6496740">(</span><span class="string" id="6496741">&#34;handler&nbsp;got&nbsp;Connection&nbsp;header&nbsp;value&nbsp;%q&#34;</span><span class="op" id="6496781">,</span>&nbsp;<span class="ident" id="6496783"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496686">c</a></span><span class="op" id="6496784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6496788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496792">if</span>&nbsp;<span class="ident" id="6496795">c</span>&nbsp;<span class="op" id="6496797">:=</span>&nbsp;<span class="ident" id="6496800"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496446">r</a></span><span class="op" id="6496801">.</span><span class="ident" id="6496802"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="6496808">.</span><span class="ident" id="6496809"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="6496812">(</span><span class="string" id="6496813">&#34;Upgrade&#34;</span><span class="op" id="6496822">)</span><span class="op" id="6496823">;</span>&nbsp;<span class="ident" id="6496825"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496795">c</a></span>&nbsp;<span class="op" id="6496827">!=</span>&nbsp;<span class="string" id="6496830">&#34;&#34;</span>&nbsp;<span class="op" id="6496833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6496838"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496283">t</a></span><span class="op" id="6496839">.</span><span class="ident" id="6496840"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6496846">(</span><span class="string" id="6496847">&#34;handler&nbsp;got&nbsp;Upgrade&nbsp;header&nbsp;value&nbsp;%q&#34;</span><span class="op" id="6496884">,</span>&nbsp;<span class="ident" id="6496886"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496795">c</a></span><span class="op" id="6496887">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6496891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496895">if</span>&nbsp;<span class="ident" id="6496898">g</span><span class="op" id="6496899">,</span>&nbsp;<span class="ident" id="6496901">e</span>&nbsp;<span class="op" id="6496903">:=</span>&nbsp;<span class="ident" id="6496906"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496446">r</a></span><span class="op" id="6496907">.</span><span class="ident" id="6496908"><a href="/gostd/net/http/request.go.html#4139164">Host</a></span><span class="op" id="6496912">,</span>&nbsp;<span class="string" id="6496914">&#34;some-name&#34;</span><span class="op" id="6496925">;</span>&nbsp;<span class="ident" id="6496927"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496898">g</a></span>&nbsp;<span class="op" id="6496929">!=</span>&nbsp;<span class="ident" id="6496932"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496901">e</a></span>&nbsp;<span class="op" id="6496934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6496939"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496283">t</a></span><span class="op" id="6496940">.</span><span class="ident" id="6496941"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6496947">(</span><span class="string" id="6496948">&#34;backend&nbsp;got&nbsp;Host&nbsp;header&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6496985">,</span>&nbsp;<span class="ident" id="6496987"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496898">g</a></span><span class="op" id="6496988">,</span>&nbsp;<span class="ident" id="6496990"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496901">e</a></span><span class="op" id="6496991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6496995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6496999"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496423">w</a></span><span class="op" id="6497000">.</span><span class="ident" id="6497001"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="6497007">(</span><span class="op" id="6497008">)</span><span class="op" id="6497009">.</span><span class="ident" id="6497010"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="6497013">(</span><span class="string" id="6497014">&#34;X-Foo&#34;</span><span class="op" id="6497021">,</span>&nbsp;<span class="string" id="6497023">&#34;bar&#34;</span><span class="op" id="6497028">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497032"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496423">w</a></span><span class="op" id="6497033">.</span><span class="ident" id="6497034"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="6497040">(</span><span class="op" id="6497041">)</span><span class="op" id="6497042">.</span><span class="ident" id="6497043"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="6497046">(</span><span class="string" id="6497047">&#34;Upgrade&#34;</span><span class="op" id="6497056">,</span>&nbsp;<span class="string" id="6497058">&#34;foo&#34;</span><span class="op" id="6497063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497067"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496423">w</a></span><span class="op" id="6497068">.</span><span class="ident" id="6497069"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="6497075">(</span><span class="op" id="6497076">)</span><span class="op" id="6497077">.</span><span class="ident" id="6497078"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="6497081">(</span><span class="ident" id="6497082"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496150">fakeHopHeader</a></span><span class="op" id="6497095">,</span>&nbsp;<span class="string" id="6497097">&#34;foo&#34;</span><span class="op" id="6497102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497106"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496423">w</a></span><span class="op" id="6497107">.</span><span class="ident" id="6497108"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="6497114">(</span><span class="op" id="6497115">)</span><span class="op" id="6497116">.</span><span class="ident" id="6497117"><a href="/gostd/net/http/header.go.html#4126266">Add</a></span><span class="op" id="6497120">(</span><span class="string" id="6497121">&#34;X-Multi-Value&#34;</span><span class="op" id="6497136">,</span>&nbsp;<span class="string" id="6497138">&#34;foo&#34;</span><span class="op" id="6497143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497147"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496423">w</a></span><span class="op" id="6497148">.</span><span class="ident" id="6497149"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="6497155">(</span><span class="op" id="6497156">)</span><span class="op" id="6497157">.</span><span class="ident" id="6497158"><a href="/gostd/net/http/header.go.html#4126266">Add</a></span><span class="op" id="6497161">(</span><span class="string" id="6497162">&#34;X-Multi-Value&#34;</span><span class="op" id="6497177">,</span>&nbsp;<span class="string" id="6497179">&#34;bar&#34;</span><span class="op" id="6497184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497188"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6497192">.</span><span class="ident" id="6497193"><a href="/gostd/net/http/cookie.go.html#4098462">SetCookie</a></span><span class="op" id="6497202">(</span><span class="ident" id="6497203"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496423">w</a></span><span class="op" id="6497204">,</span>&nbsp;<span class="op" id="6497206">&amp;</span><span class="ident" id="6497207"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6497211">.</span><span class="ident" id="6497212"><a href="/gostd/net/http/cookie.go.html#4095997">Cookie</a></span><span class="op" id="6497218">{</span><span class="ident" id="6497219"><a href="/gostd/net/http/cookie.go.html#4096014">Name</a></span><span class="op" id="6497223">:</span>&nbsp;<span class="string" id="6497225">&#34;flavor&#34;</span><span class="op" id="6497233">,</span>&nbsp;<span class="ident" id="6497235"><a href="/gostd/net/http/cookie.go.html#4096033">Value</a></span><span class="op" id="6497240">:</span>&nbsp;<span class="string" id="6497242">&#34;chocolateChip&#34;</span><span class="op" id="6497257">}</span><span class="op" id="6497258">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497262"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496423">w</a></span><span class="op" id="6497263">.</span><span class="ident" id="6497264"><a href="/gostd/net/http/server.go.html#4171422">WriteHeader</a></span><span class="op" id="6497275">(</span><span class="ident" id="6497276"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496350">backendStatus</a></span><span class="op" id="6497289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497293"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496423">w</a></span><span class="op" id="6497294">.</span><span class="ident" id="6497295"><a href="/gostd/net/http/server.go.html#4171123">Write</a></span><span class="op" id="6497300">(</span><span class="op" id="6497301">[</span><span class="op" id="6497302">]</span><span class="builtintype" id="6497303">byte</span><span class="op" id="6497307">(</span><span class="ident" id="6497308"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496306">backendResponse</a></span><span class="op" id="6497323">)</span><span class="op" id="6497324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6497327">}</span><span class="op" id="6497328">)</span><span class="op" id="6497329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6497332">defer</span>&nbsp;<span class="ident" id="6497338"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496371">backend</a></span><span class="op" id="6497345">.</span><span class="ident" id="6497346"><a href="/gostd/net/http/httptest/server.go.html#6137960">Close</a></span><span class="op" id="6497351">(</span><span class="op" id="6497352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497355">backendURL</span><span class="op" id="6497365">,</span>&nbsp;<span class="ident" id="6497367">err</span>&nbsp;<span class="op" id="6497371">:=</span>&nbsp;<span class="ident" id="6497374"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496101">url</a></span><span class="op" id="6497377">.</span><span class="ident" id="6497378"><a href="/gostd/net/url/url.go.html#3754169">Parse</a></span><span class="op" id="6497383">(</span><span class="ident" id="6497384"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496371">backend</a></span><span class="op" id="6497391">.</span><span class="ident" id="6497392"><a href="/gostd/net/http/httptest/server.go.html#6134026">URL</a></span><span class="op" id="6497395">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6497398">if</span>&nbsp;<span class="ident" id="6497401"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497367">err</a></span>&nbsp;<span class="op" id="6497405">!=</span>&nbsp;<span class="builtintype" id="6497408">nil</span>&nbsp;<span class="op" id="6497412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497416"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496283">t</a></span><span class="op" id="6497417">.</span><span class="ident" id="6497418"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6497423">(</span><span class="ident" id="6497424"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497367">err</a></span><span class="op" id="6497427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6497430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497433">proxyHandler</span>&nbsp;<span class="op" id="6497446">:=</span>&nbsp;<span class="ident" id="6497449"><a href="/gostd/net/http/httputil/reverseproxy.go.html#6401126">NewSingleHostReverseProxy</a></span><span class="op" id="6497474">(</span><span class="ident" id="6497475"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497355">backendURL</a></span><span class="op" id="6497485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497488">frontend</span>&nbsp;<span class="op" id="6497497">:=</span>&nbsp;<span class="ident" id="6497500"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496080">httptest</a></span><span class="op" id="6497508">.</span><span class="ident" id="6497509"><a href="/gostd/net/http/httptest/server.go.html#6135832">NewServer</a></span><span class="op" id="6497518">(</span><span class="ident" id="6497519"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497433">proxyHandler</a></span><span class="op" id="6497531">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6497534">defer</span>&nbsp;<span class="ident" id="6497540"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497488">frontend</a></span><span class="op" id="6497548">.</span><span class="ident" id="6497549"><a href="/gostd/net/http/httptest/server.go.html#6137960">Close</a></span><span class="op" id="6497554">(</span><span class="op" id="6497555">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497559">getReq</span><span class="op" id="6497565">,</span>&nbsp;<span class="ident" id="6497567">_</span>&nbsp;<span class="op" id="6497569">:=</span>&nbsp;<span class="ident" id="6497572"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6497576">.</span><span class="ident" id="6497577"><a href="/gostd/net/http/request.go.html#4149529">NewRequest</a></span><span class="op" id="6497587">(</span><span class="string" id="6497588">&#34;GET&#34;</span><span class="op" id="6497593">,</span>&nbsp;<span class="ident" id="6497595"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497488">frontend</a></span><span class="op" id="6497603">.</span><span class="ident" id="6497604"><a href="/gostd/net/http/httptest/server.go.html#6134026">URL</a></span><span class="op" id="6497607">,</span>&nbsp;<span class="builtintype" id="6497609">nil</span><span class="op" id="6497612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497615"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497559">getReq</a></span><span class="op" id="6497621">.</span><span class="ident" id="6497622"><a href="/gostd/net/http/request.go.html#4139164">Host</a></span>&nbsp;<span class="op" id="6497627">=</span>&nbsp;<span class="string" id="6497629">&#34;some-name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497642"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497559">getReq</a></span><span class="op" id="6497648">.</span><span class="ident" id="6497649"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="6497655">.</span><span class="ident" id="6497656"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="6497659">(</span><span class="string" id="6497660">&#34;Connection&#34;</span><span class="op" id="6497672">,</span>&nbsp;<span class="string" id="6497674">&#34;close&#34;</span><span class="op" id="6497681">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497684"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497559">getReq</a></span><span class="op" id="6497690">.</span><span class="ident" id="6497691"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="6497697">.</span><span class="ident" id="6497698"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="6497701">(</span><span class="string" id="6497702">&#34;Upgrade&#34;</span><span class="op" id="6497711">,</span>&nbsp;<span class="string" id="6497713">&#34;foo&#34;</span><span class="op" id="6497718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497721"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497559">getReq</a></span><span class="op" id="6497727">.</span><span class="ident" id="6497728"><a href="/gostd/net/http/request.go.html#4138776">Close</a></span>&nbsp;<span class="op" id="6497734">=</span>&nbsp;<span class="builtintype" id="6497736">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497742">res</span><span class="op" id="6497745">,</span>&nbsp;<span class="ident" id="6497747"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497367">err</a></span>&nbsp;<span class="op" id="6497751">:=</span>&nbsp;<span class="ident" id="6497754"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6497758">.</span><span class="ident" id="6497759"><a href="/gostd/net/http/client.go.html#4082381">DefaultClient</a></span><span class="op" id="6497772">.</span><span class="ident" id="6497773"><a href="/gostd/net/http/client.go.html#4085906">Do</a></span><span class="op" id="6497775">(</span><span class="ident" id="6497776"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497559">getReq</a></span><span class="op" id="6497782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6497785">if</span>&nbsp;<span class="ident" id="6497788"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497367">err</a></span>&nbsp;<span class="op" id="6497792">!=</span>&nbsp;<span class="builtintype" id="6497795">nil</span>&nbsp;<span class="op" id="6497799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497803"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496283">t</a></span><span class="op" id="6497804">.</span><span class="ident" id="6497805"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6497811">(</span><span class="string" id="6497812">&#34;Get:&nbsp;%v&#34;</span><span class="op" id="6497821">,</span>&nbsp;<span class="ident" id="6497823"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497367">err</a></span><span class="op" id="6497826">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6497829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6497832">if</span>&nbsp;<span class="ident" id="6497835">g</span><span class="op" id="6497836">,</span>&nbsp;<span class="ident" id="6497838">e</span>&nbsp;<span class="op" id="6497840">:=</span>&nbsp;<span class="ident" id="6497843"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497742">res</a></span><span class="op" id="6497846">.</span><span class="ident" id="6497847"><a href="/gostd/net/http/response.go.html#4161564">StatusCode</a></span><span class="op" id="6497857">,</span>&nbsp;<span class="ident" id="6497859"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496350">backendStatus</a></span><span class="op" id="6497872">;</span>&nbsp;<span class="ident" id="6497874"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497835">g</a></span>&nbsp;<span class="op" id="6497876">!=</span>&nbsp;<span class="ident" id="6497879"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497838">e</a></span>&nbsp;<span class="op" id="6497881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497885"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496283">t</a></span><span class="op" id="6497886">.</span><span class="ident" id="6497887"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6497893">(</span><span class="string" id="6497894">&#34;got&nbsp;res.StatusCode&nbsp;%d;&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6497930">,</span>&nbsp;<span class="ident" id="6497932"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497835">g</a></span><span class="op" id="6497933">,</span>&nbsp;<span class="ident" id="6497935"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497838">e</a></span><span class="op" id="6497936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6497939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6497942">if</span>&nbsp;<span class="ident" id="6497945">g</span><span class="op" id="6497946">,</span>&nbsp;<span class="ident" id="6497948">e</span>&nbsp;<span class="op" id="6497950">:=</span>&nbsp;<span class="ident" id="6497953"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497742">res</a></span><span class="op" id="6497956">.</span><span class="ident" id="6497957"><a href="/gostd/net/http/response.go.html#4162137">Header</a></span><span class="op" id="6497963">.</span><span class="ident" id="6497964"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="6497967">(</span><span class="string" id="6497968">&#34;X-Foo&#34;</span><span class="op" id="6497975">)</span><span class="op" id="6497976">,</span>&nbsp;<span class="string" id="6497978">&#34;bar&#34;</span><span class="op" id="6497983">;</span>&nbsp;<span class="ident" id="6497985"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497945">g</a></span>&nbsp;<span class="op" id="6497987">!=</span>&nbsp;<span class="ident" id="6497990"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497948">e</a></span>&nbsp;<span class="op" id="6497992">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497996"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496283">t</a></span><span class="op" id="6497997">.</span><span class="ident" id="6497998"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6498004">(</span><span class="string" id="6498005">&#34;got&nbsp;X-Foo&nbsp;%q;&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="6498032">,</span>&nbsp;<span class="ident" id="6498034"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497945">g</a></span><span class="op" id="6498035">,</span>&nbsp;<span class="ident" id="6498037"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497948">e</a></span><span class="op" id="6498038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6498041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498044">if</span>&nbsp;<span class="ident" id="6498047">c</span>&nbsp;<span class="op" id="6498049">:=</span>&nbsp;<span class="ident" id="6498052"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497742">res</a></span><span class="op" id="6498055">.</span><span class="ident" id="6498056"><a href="/gostd/net/http/response.go.html#4162137">Header</a></span><span class="op" id="6498062">.</span><span class="ident" id="6498063"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="6498066">(</span><span class="ident" id="6498067"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496150">fakeHopHeader</a></span><span class="op" id="6498080">)</span><span class="op" id="6498081">;</span>&nbsp;<span class="ident" id="6498083"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498047">c</a></span>&nbsp;<span class="op" id="6498085">!=</span>&nbsp;<span class="string" id="6498088">&#34;&#34;</span>&nbsp;<span class="op" id="6498091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6498095"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496283">t</a></span><span class="op" id="6498096">.</span><span class="ident" id="6498097"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6498103">(</span><span class="string" id="6498104">&#34;got&nbsp;%s&nbsp;header&nbsp;value&nbsp;%q&#34;</span><span class="op" id="6498128">,</span>&nbsp;<span class="ident" id="6498130"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496150">fakeHopHeader</a></span><span class="op" id="6498143">,</span>&nbsp;<span class="ident" id="6498145"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498047">c</a></span><span class="op" id="6498146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6498149">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498152">if</span>&nbsp;<span class="ident" id="6498155">g</span><span class="op" id="6498156">,</span>&nbsp;<span class="ident" id="6498158">e</span>&nbsp;<span class="op" id="6498160">:=</span>&nbsp;<span class="builtinfunc" id="6498163">len</span><span class="op" id="6498166">(</span><span class="ident" id="6498167"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497742">res</a></span><span class="op" id="6498170">.</span><span class="ident" id="6498171"><a href="/gostd/net/http/response.go.html#4162137">Header</a></span><span class="op" id="6498177">[</span><span class="string" id="6498178">&#34;X-Multi-Value&#34;</span><span class="op" id="6498193">]</span><span class="op" id="6498194">)</span><span class="op" id="6498195">,</span>&nbsp;<span class="num" id="6498197">2</span><span class="op" id="6498198">;</span>&nbsp;<span class="ident" id="6498200"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498155">g</a></span>&nbsp;<span class="op" id="6498202">!=</span>&nbsp;<span class="ident" id="6498205"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498158">e</a></span>&nbsp;<span class="op" id="6498207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6498211"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496283">t</a></span><span class="op" id="6498212">.</span><span class="ident" id="6498213"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6498219">(</span><span class="string" id="6498220">&#34;got&nbsp;%d&nbsp;X-Multi-Value&nbsp;header&nbsp;values;&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6498269">,</span>&nbsp;<span class="ident" id="6498271"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498155">g</a></span><span class="op" id="6498272">,</span>&nbsp;<span class="ident" id="6498274"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498158">e</a></span><span class="op" id="6498275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6498278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498281">if</span>&nbsp;<span class="ident" id="6498284">g</span><span class="op" id="6498285">,</span>&nbsp;<span class="ident" id="6498287">e</span>&nbsp;<span class="op" id="6498289">:=</span>&nbsp;<span class="builtinfunc" id="6498292">len</span><span class="op" id="6498295">(</span><span class="ident" id="6498296"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497742">res</a></span><span class="op" id="6498299">.</span><span class="ident" id="6498300"><a href="/gostd/net/http/response.go.html#4162137">Header</a></span><span class="op" id="6498306">[</span><span class="string" id="6498307">&#34;Set-Cookie&#34;</span><span class="op" id="6498319">]</span><span class="op" id="6498320">)</span><span class="op" id="6498321">,</span>&nbsp;<span class="num" id="6498323">1</span><span class="op" id="6498324">;</span>&nbsp;<span class="ident" id="6498326"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498284">g</a></span>&nbsp;<span class="op" id="6498328">!=</span>&nbsp;<span class="ident" id="6498331"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498287">e</a></span>&nbsp;<span class="op" id="6498333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6498337"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496283">t</a></span><span class="op" id="6498338">.</span><span class="ident" id="6498339"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6498345">(</span><span class="string" id="6498346">&#34;got&nbsp;%d&nbsp;SetCookies,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6498374">,</span>&nbsp;<span class="ident" id="6498376"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498284">g</a></span><span class="op" id="6498377">,</span>&nbsp;<span class="ident" id="6498379"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498287">e</a></span><span class="op" id="6498380">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6498383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498386">if</span>&nbsp;<span class="ident" id="6498389">cookie</span>&nbsp;<span class="op" id="6498396">:=</span>&nbsp;<span class="ident" id="6498399"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497742">res</a></span><span class="op" id="6498402">.</span><span class="ident" id="6498403"><a href="/gostd/net/http/response.go.html#4163756">Cookies</a></span><span class="op" id="6498410">(</span><span class="op" id="6498411">)</span><span class="op" id="6498412">[</span><span class="num" id="6498413">0</span><span class="op" id="6498414">]</span><span class="op" id="6498415">;</span>&nbsp;<span class="ident" id="6498417"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498389">cookie</a></span><span class="op" id="6498423">.</span><span class="ident" id="6498424"><a href="/gostd/net/http/cookie.go.html#4096014">Name</a></span>&nbsp;<span class="op" id="6498429">!=</span>&nbsp;<span class="string" id="6498432">&#34;flavor&#34;</span>&nbsp;<span class="op" id="6498441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6498445"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496283">t</a></span><span class="op" id="6498446">.</span><span class="ident" id="6498447"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6498453">(</span><span class="string" id="6498454">&#34;unexpected&nbsp;cookie&nbsp;%q&#34;</span><span class="op" id="6498476">,</span>&nbsp;<span class="ident" id="6498478"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498389">cookie</a></span><span class="op" id="6498484">.</span><span class="ident" id="6498485"><a href="/gostd/net/http/cookie.go.html#4096014">Name</a></span><span class="op" id="6498489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6498492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6498495">bodyBytes</span><span class="op" id="6498504">,</span>&nbsp;<span class="ident" id="6498506">_</span>&nbsp;<span class="op" id="6498508">:=</span>&nbsp;<span class="ident" id="6498511"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496055">ioutil</a></span><span class="op" id="6498517">.</span><span class="ident" id="6498518"><a href="/gostd/io/ioutil/ioutil.go.html#3765117">ReadAll</a></span><span class="op" id="6498525">(</span><span class="ident" id="6498526"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6497742">res</a></span><span class="op" id="6498529">.</span><span class="ident" id="6498530"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span><span class="op" id="6498534">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498537">if</span>&nbsp;<span class="ident" id="6498540">g</span><span class="op" id="6498541">,</span>&nbsp;<span class="ident" id="6498543">e</span>&nbsp;<span class="op" id="6498545">:=</span>&nbsp;<span class="builtintype" id="6498548">string</span><span class="op" id="6498554">(</span><span class="ident" id="6498555"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498495">bodyBytes</a></span><span class="op" id="6498564">)</span><span class="op" id="6498565">,</span>&nbsp;<span class="ident" id="6498567"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496306">backendResponse</a></span><span class="op" id="6498582">;</span>&nbsp;<span class="ident" id="6498584"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498540">g</a></span>&nbsp;<span class="op" id="6498586">!=</span>&nbsp;<span class="ident" id="6498589"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498543">e</a></span>&nbsp;<span class="op" id="6498591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6498595"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496283">t</a></span><span class="op" id="6498596">.</span><span class="ident" id="6498597"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6498603">(</span><span class="string" id="6498604">&#34;got&nbsp;body&nbsp;%q;&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="6498630">,</span>&nbsp;<span class="ident" id="6498632"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498540">g</a></span><span class="op" id="6498633">,</span>&nbsp;<span class="ident" id="6498635"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498543">e</a></span><span class="op" id="6498636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6498639">}</span><br>
<span class="lineno"></span><span class="op" id="6498641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6498644">func</span>&nbsp;<span class="ident" id="6498649">TestXForwardedFor</span><span class="op" id="6498666">(</span><span class="ident" id="6498667">t</span>&nbsp;<span class="op" id="6498669">*</span><span class="ident" id="6498670"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496123">testing</a></span><span class="op" id="6498677">.</span><span class="ident" id="6498678"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6498679">)</span>&nbsp;<span class="op" id="6498681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498684">const</span>&nbsp;<span class="ident" id="6498690">prevForwardedFor</span>&nbsp;<span class="op" id="6498707">=</span>&nbsp;<span class="string" id="6498709">&#34;client&nbsp;ip&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498722">const</span>&nbsp;<span class="ident" id="6498728">backendResponse</span>&nbsp;<span class="op" id="6498744">=</span>&nbsp;<span class="string" id="6498746">&#34;I&nbsp;am&nbsp;the&nbsp;backend&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498766">const</span>&nbsp;<span class="ident" id="6498772">backendStatus</span>&nbsp;<span class="op" id="6498786">=</span>&nbsp;<span class="num" id="6498788">404</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6498793">backend</span>&nbsp;<span class="op" id="6498801">:=</span>&nbsp;<span class="ident" id="6498804"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496080">httptest</a></span><span class="op" id="6498812">.</span><span class="ident" id="6498813"><a href="/gostd/net/http/httptest/server.go.html#6135832">NewServer</a></span><span class="op" id="6498822">(</span><span class="ident" id="6498823"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6498827">.</span><span class="ident" id="6498828"><a href="/gostd/net/http/server.go.html#4205623">HandlerFunc</a></span><span class="op" id="6498839">(</span><span class="keyword" id="6498840">func</span><span class="op" id="6498844">(</span><span class="ident" id="6498845">w</span>&nbsp;<span class="ident" id="6498847"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6498851">.</span><span class="ident" id="6498852"><a href="/gostd/net/http/server.go.html#4170569">ResponseWriter</a></span><span class="op" id="6498866">,</span>&nbsp;<span class="ident" id="6498868">r</span>&nbsp;<span class="op" id="6498870">*</span><span class="ident" id="6498871"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6498875">.</span><span class="ident" id="6498876"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6498883">)</span>&nbsp;<span class="op" id="6498885">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498889">if</span>&nbsp;<span class="ident" id="6498892"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498868">r</a></span><span class="op" id="6498893">.</span><span class="ident" id="6498894"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="6498900">.</span><span class="ident" id="6498901"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="6498904">(</span><span class="string" id="6498905">&#34;X-Forwarded-For&#34;</span><span class="op" id="6498922">)</span>&nbsp;<span class="op" id="6498924">==</span>&nbsp;<span class="string" id="6498927">&#34;&#34;</span>&nbsp;<span class="op" id="6498930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6498935"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498667">t</a></span><span class="op" id="6498936">.</span><span class="ident" id="6498937"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6498943">(</span><span class="string" id="6498944">&#34;didn&#39;t&nbsp;get&nbsp;X-Forwarded-For&nbsp;header&#34;</span><span class="op" id="6498979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6498983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498987">if</span>&nbsp;<span class="op" id="6498990">!</span><span class="ident" id="6498991"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496112">strings</a></span><span class="op" id="6498998">.</span><span class="ident" id="6498999"><a href="/gostd/strings/strings.go.html#2968416">Contains</a></span><span class="op" id="6499007">(</span><span class="ident" id="6499008"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498868">r</a></span><span class="op" id="6499009">.</span><span class="ident" id="6499010"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="6499016">.</span><span class="ident" id="6499017"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="6499020">(</span><span class="string" id="6499021">&#34;X-Forwarded-For&#34;</span><span class="op" id="6499038">)</span><span class="op" id="6499039">,</span>&nbsp;<span class="ident" id="6499041"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498690">prevForwardedFor</a></span><span class="op" id="6499057">)</span>&nbsp;<span class="op" id="6499059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499064"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498667">t</a></span><span class="op" id="6499065">.</span><span class="ident" id="6499066"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6499072">(</span><span class="string" id="6499073">&#34;X-Forwarded-For&nbsp;didn&#39;t&nbsp;contain&nbsp;prior&nbsp;data&#34;</span><span class="op" id="6499116">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6499120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499124"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498845">w</a></span><span class="op" id="6499125">.</span><span class="ident" id="6499126"><a href="/gostd/net/http/server.go.html#4171422">WriteHeader</a></span><span class="op" id="6499137">(</span><span class="ident" id="6499138"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498772">backendStatus</a></span><span class="op" id="6499151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499155"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498845">w</a></span><span class="op" id="6499156">.</span><span class="ident" id="6499157"><a href="/gostd/net/http/server.go.html#4171123">Write</a></span><span class="op" id="6499162">(</span><span class="op" id="6499163">[</span><span class="op" id="6499164">]</span><span class="builtintype" id="6499165">byte</span><span class="op" id="6499169">(</span><span class="ident" id="6499170"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498728">backendResponse</a></span><span class="op" id="6499185">)</span><span class="op" id="6499186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6499189">}</span><span class="op" id="6499190">)</span><span class="op" id="6499191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499194">defer</span>&nbsp;<span class="ident" id="6499200"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498793">backend</a></span><span class="op" id="6499207">.</span><span class="ident" id="6499208"><a href="/gostd/net/http/httptest/server.go.html#6137960">Close</a></span><span class="op" id="6499213">(</span><span class="op" id="6499214">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499217">backendURL</span><span class="op" id="6499227">,</span>&nbsp;<span class="ident" id="6499229">err</span>&nbsp;<span class="op" id="6499233">:=</span>&nbsp;<span class="ident" id="6499236"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496101">url</a></span><span class="op" id="6499239">.</span><span class="ident" id="6499240"><a href="/gostd/net/url/url.go.html#3754169">Parse</a></span><span class="op" id="6499245">(</span><span class="ident" id="6499246"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498793">backend</a></span><span class="op" id="6499253">.</span><span class="ident" id="6499254"><a href="/gostd/net/http/httptest/server.go.html#6134026">URL</a></span><span class="op" id="6499257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499260">if</span>&nbsp;<span class="ident" id="6499263"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499229">err</a></span>&nbsp;<span class="op" id="6499267">!=</span>&nbsp;<span class="builtintype" id="6499270">nil</span>&nbsp;<span class="op" id="6499274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499278"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498667">t</a></span><span class="op" id="6499279">.</span><span class="ident" id="6499280"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6499285">(</span><span class="ident" id="6499286"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499229">err</a></span><span class="op" id="6499289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6499292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499295">proxyHandler</span>&nbsp;<span class="op" id="6499308">:=</span>&nbsp;<span class="ident" id="6499311"><a href="/gostd/net/http/httputil/reverseproxy.go.html#6401126">NewSingleHostReverseProxy</a></span><span class="op" id="6499336">(</span><span class="ident" id="6499337"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499217">backendURL</a></span><span class="op" id="6499347">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499350">frontend</span>&nbsp;<span class="op" id="6499359">:=</span>&nbsp;<span class="ident" id="6499362"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496080">httptest</a></span><span class="op" id="6499370">.</span><span class="ident" id="6499371"><a href="/gostd/net/http/httptest/server.go.html#6135832">NewServer</a></span><span class="op" id="6499380">(</span><span class="ident" id="6499381"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499295">proxyHandler</a></span><span class="op" id="6499393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499396">defer</span>&nbsp;<span class="ident" id="6499402"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499350">frontend</a></span><span class="op" id="6499410">.</span><span class="ident" id="6499411"><a href="/gostd/net/http/httptest/server.go.html#6137960">Close</a></span><span class="op" id="6499416">(</span><span class="op" id="6499417">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499421">getReq</span><span class="op" id="6499427">,</span>&nbsp;<span class="ident" id="6499429">_</span>&nbsp;<span class="op" id="6499431">:=</span>&nbsp;<span class="ident" id="6499434"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6499438">.</span><span class="ident" id="6499439"><a href="/gostd/net/http/request.go.html#4149529">NewRequest</a></span><span class="op" id="6499449">(</span><span class="string" id="6499450">&#34;GET&#34;</span><span class="op" id="6499455">,</span>&nbsp;<span class="ident" id="6499457"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499350">frontend</a></span><span class="op" id="6499465">.</span><span class="ident" id="6499466"><a href="/gostd/net/http/httptest/server.go.html#6134026">URL</a></span><span class="op" id="6499469">,</span>&nbsp;<span class="builtintype" id="6499471">nil</span><span class="op" id="6499474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499477"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499421">getReq</a></span><span class="op" id="6499483">.</span><span class="ident" id="6499484"><a href="/gostd/net/http/request.go.html#4139164">Host</a></span>&nbsp;<span class="op" id="6499489">=</span>&nbsp;<span class="string" id="6499491">&#34;some-name&#34;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499504"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499421">getReq</a></span><span class="op" id="6499510">.</span><span class="ident" id="6499511"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="6499517">.</span><span class="ident" id="6499518"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="6499521">(</span><span class="string" id="6499522">&#34;Connection&#34;</span><span class="op" id="6499534">,</span>&nbsp;<span class="string" id="6499536">&#34;close&#34;</span><span class="op" id="6499543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499546"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499421">getReq</a></span><span class="op" id="6499552">.</span><span class="ident" id="6499553"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="6499559">.</span><span class="ident" id="6499560"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="6499563">(</span><span class="string" id="6499564">&#34;X-Forwarded-For&#34;</span><span class="op" id="6499581">,</span>&nbsp;<span class="ident" id="6499583"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498690">prevForwardedFor</a></span><span class="op" id="6499599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499602"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499421">getReq</a></span><span class="op" id="6499608">.</span><span class="ident" id="6499609"><a href="/gostd/net/http/request.go.html#4138776">Close</a></span>&nbsp;<span class="op" id="6499615">=</span>&nbsp;<span class="builtintype" id="6499617">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499623">res</span><span class="op" id="6499626">,</span>&nbsp;<span class="ident" id="6499628"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499229">err</a></span>&nbsp;<span class="op" id="6499632">:=</span>&nbsp;<span class="ident" id="6499635"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6499639">.</span><span class="ident" id="6499640"><a href="/gostd/net/http/client.go.html#4082381">DefaultClient</a></span><span class="op" id="6499653">.</span><span class="ident" id="6499654"><a href="/gostd/net/http/client.go.html#4085906">Do</a></span><span class="op" id="6499656">(</span><span class="ident" id="6499657"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499421">getReq</a></span><span class="op" id="6499663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499666">if</span>&nbsp;<span class="ident" id="6499669"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499229">err</a></span>&nbsp;<span class="op" id="6499673">!=</span>&nbsp;<span class="builtintype" id="6499676">nil</span>&nbsp;<span class="op" id="6499680">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499684"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498667">t</a></span><span class="op" id="6499685">.</span><span class="ident" id="6499686"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6499692">(</span><span class="string" id="6499693">&#34;Get:&nbsp;%v&#34;</span><span class="op" id="6499702">,</span>&nbsp;<span class="ident" id="6499704"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499229">err</a></span><span class="op" id="6499707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6499710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499713">if</span>&nbsp;<span class="ident" id="6499716">g</span><span class="op" id="6499717">,</span>&nbsp;<span class="ident" id="6499719">e</span>&nbsp;<span class="op" id="6499721">:=</span>&nbsp;<span class="ident" id="6499724"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499623">res</a></span><span class="op" id="6499727">.</span><span class="ident" id="6499728"><a href="/gostd/net/http/response.go.html#4161564">StatusCode</a></span><span class="op" id="6499738">,</span>&nbsp;<span class="ident" id="6499740"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498772">backendStatus</a></span><span class="op" id="6499753">;</span>&nbsp;<span class="ident" id="6499755"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499716">g</a></span>&nbsp;<span class="op" id="6499757">!=</span>&nbsp;<span class="ident" id="6499760"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499719">e</a></span>&nbsp;<span class="op" id="6499762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499766"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498667">t</a></span><span class="op" id="6499767">.</span><span class="ident" id="6499768"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6499774">(</span><span class="string" id="6499775">&#34;got&nbsp;res.StatusCode&nbsp;%d;&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6499811">,</span>&nbsp;<span class="ident" id="6499813"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499716">g</a></span><span class="op" id="6499814">,</span>&nbsp;<span class="ident" id="6499816"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499719">e</a></span><span class="op" id="6499817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6499820">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499823">bodyBytes</span><span class="op" id="6499832">,</span>&nbsp;<span class="ident" id="6499834">_</span>&nbsp;<span class="op" id="6499836">:=</span>&nbsp;<span class="ident" id="6499839"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496055">ioutil</a></span><span class="op" id="6499845">.</span><span class="ident" id="6499846"><a href="/gostd/io/ioutil/ioutil.go.html#3765117">ReadAll</a></span><span class="op" id="6499853">(</span><span class="ident" id="6499854"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499623">res</a></span><span class="op" id="6499857">.</span><span class="ident" id="6499858"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span><span class="op" id="6499862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499865">if</span>&nbsp;<span class="ident" id="6499868">g</span><span class="op" id="6499869">,</span>&nbsp;<span class="ident" id="6499871">e</span>&nbsp;<span class="op" id="6499873">:=</span>&nbsp;<span class="builtintype" id="6499876">string</span><span class="op" id="6499882">(</span><span class="ident" id="6499883"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499823">bodyBytes</a></span><span class="op" id="6499892">)</span><span class="op" id="6499893">,</span>&nbsp;<span class="ident" id="6499895"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498728">backendResponse</a></span><span class="op" id="6499910">;</span>&nbsp;<span class="ident" id="6499912"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499868">g</a></span>&nbsp;<span class="op" id="6499914">!=</span>&nbsp;<span class="ident" id="6499917"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499871">e</a></span>&nbsp;<span class="op" id="6499919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499923"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6498667">t</a></span><span class="op" id="6499924">.</span><span class="ident" id="6499925"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6499931">(</span><span class="string" id="6499932">&#34;got&nbsp;body&nbsp;%q;&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="6499958">,</span>&nbsp;<span class="ident" id="6499960"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499868">g</a></span><span class="op" id="6499961">,</span>&nbsp;<span class="ident" id="6499963"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499871">e</a></span><span class="op" id="6499964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6499967">}</span><br>
<span class="lineno"></span><span class="op" id="6499969">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="6499972">var</span>&nbsp;<span class="ident" id="6499976">proxyQueryTests</span>&nbsp;<span class="op" id="6499992">=</span>&nbsp;<span class="op" id="6499994">[</span><span class="op" id="6499995">]</span><span class="keyword" id="6499996">struct</span>&nbsp;<span class="op" id="6500003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500006">baseSuffix</span>&nbsp;<span class="builtintype" id="6500017">string</span>&nbsp;<span class="comment" id="6500024">//&nbsp;suffix&nbsp;to&nbsp;add&nbsp;to&nbsp;backend&nbsp;URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500057">reqSuffix</span>&nbsp;&nbsp;<span class="builtintype" id="6500068">string</span>&nbsp;<span class="comment" id="6500075">//&nbsp;suffix&nbsp;to&nbsp;add&nbsp;to&nbsp;frontend&#39;s&nbsp;request&nbsp;URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500119">want</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6500130">string</span>&nbsp;<span class="comment" id="6500137">//&nbsp;what&nbsp;backend&nbsp;should&nbsp;see&nbsp;for&nbsp;final&nbsp;request&nbsp;URL&nbsp;(without&nbsp;?)</span><br>
<span class="lineno">140</span><span class="op" id="6500198">}</span><span class="op" id="6500199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500202">{</span><span class="string" id="6500203">&#34;&#34;</span><span class="op" id="6500205">,</span>&nbsp;<span class="string" id="6500207">&#34;&#34;</span><span class="op" id="6500209">,</span>&nbsp;<span class="string" id="6500211">&#34;&#34;</span><span class="op" id="6500213">}</span><span class="op" id="6500214">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500217">{</span><span class="string" id="6500218">&#34;?sta=tic&#34;</span><span class="op" id="6500228">,</span>&nbsp;<span class="string" id="6500230">&#34;?us=er&#34;</span><span class="op" id="6500238">,</span>&nbsp;<span class="string" id="6500240">&#34;sta=tic&amp;us=er&#34;</span><span class="op" id="6500255">}</span><span class="op" id="6500256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500259">{</span><span class="string" id="6500260">&#34;&#34;</span><span class="op" id="6500262">,</span>&nbsp;<span class="string" id="6500264">&#34;?us=er&#34;</span><span class="op" id="6500272">,</span>&nbsp;<span class="string" id="6500274">&#34;us=er&#34;</span><span class="op" id="6500281">}</span><span class="op" id="6500282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500285">{</span><span class="string" id="6500286">&#34;?sta=tic&#34;</span><span class="op" id="6500296">,</span>&nbsp;<span class="string" id="6500298">&#34;&#34;</span><span class="op" id="6500300">,</span>&nbsp;<span class="string" id="6500302">&#34;sta=tic&#34;</span><span class="op" id="6500311">}</span><span class="op" id="6500312">,</span><br>
<span class="lineno">145</span><span class="op" id="6500314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6500317">func</span>&nbsp;<span class="ident" id="6500322">TestReverseProxyQuery</span><span class="op" id="6500343">(</span><span class="ident" id="6500344">t</span>&nbsp;<span class="op" id="6500346">*</span><span class="ident" id="6500347"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496123">testing</a></span><span class="op" id="6500354">.</span><span class="ident" id="6500355"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6500356">)</span>&nbsp;<span class="op" id="6500358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500361">backend</span>&nbsp;<span class="op" id="6500369">:=</span>&nbsp;<span class="ident" id="6500372"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496080">httptest</a></span><span class="op" id="6500380">.</span><span class="ident" id="6500381"><a href="/gostd/net/http/httptest/server.go.html#6135832">NewServer</a></span><span class="op" id="6500390">(</span><span class="ident" id="6500391"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6500395">.</span><span class="ident" id="6500396"><a href="/gostd/net/http/server.go.html#4205623">HandlerFunc</a></span><span class="op" id="6500407">(</span><span class="keyword" id="6500408">func</span><span class="op" id="6500412">(</span><span class="ident" id="6500413">w</span>&nbsp;<span class="ident" id="6500415"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6500419">.</span><span class="ident" id="6500420"><a href="/gostd/net/http/server.go.html#4170569">ResponseWriter</a></span><span class="op" id="6500434">,</span>&nbsp;<span class="ident" id="6500436">r</span>&nbsp;<span class="op" id="6500438">*</span><span class="ident" id="6500439"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6500443">.</span><span class="ident" id="6500444"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6500451">)</span>&nbsp;<span class="op" id="6500453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500457"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500413">w</a></span><span class="op" id="6500458">.</span><span class="ident" id="6500459"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="6500465">(</span><span class="op" id="6500466">)</span><span class="op" id="6500467">.</span><span class="ident" id="6500468"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="6500471">(</span><span class="string" id="6500472">&#34;X-Got-Query&#34;</span><span class="op" id="6500485">,</span>&nbsp;<span class="ident" id="6500487"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500436">r</a></span><span class="op" id="6500488">.</span><span class="ident" id="6500489"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="6500492">.</span><span class="ident" id="6500493"><a href="/gostd/net/url/url.go.html#3751383">RawQuery</a></span><span class="op" id="6500501">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500505"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500413">w</a></span><span class="op" id="6500506">.</span><span class="ident" id="6500507"><a href="/gostd/net/http/server.go.html#4171123">Write</a></span><span class="op" id="6500512">(</span><span class="op" id="6500513">[</span><span class="op" id="6500514">]</span><span class="builtintype" id="6500515">byte</span><span class="op" id="6500519">(</span><span class="string" id="6500520">&#34;hi&#34;</span><span class="op" id="6500524">)</span><span class="op" id="6500525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500528">}</span><span class="op" id="6500529">)</span><span class="op" id="6500530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6500533">defer</span>&nbsp;<span class="ident" id="6500539"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500361">backend</a></span><span class="op" id="6500546">.</span><span class="ident" id="6500547"><a href="/gostd/net/http/httptest/server.go.html#6137960">Close</a></span><span class="op" id="6500552">(</span><span class="op" id="6500553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6500557">for</span>&nbsp;<span class="ident" id="6500561">i</span><span class="op" id="6500562">,</span>&nbsp;<span class="ident" id="6500564">tt</span>&nbsp;<span class="op" id="6500567">:=</span>&nbsp;<span class="keyword" id="6500570">range</span>&nbsp;<span class="ident" id="6500576"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6499976">proxyQueryTests</a></span>&nbsp;<span class="op" id="6500592">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500596">backendURL</span><span class="op" id="6500606">,</span>&nbsp;<span class="ident" id="6500608">err</span>&nbsp;<span class="op" id="6500612">:=</span>&nbsp;<span class="ident" id="6500615"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496101">url</a></span><span class="op" id="6500618">.</span><span class="ident" id="6500619"><a href="/gostd/net/url/url.go.html#3754169">Parse</a></span><span class="op" id="6500624">(</span><span class="ident" id="6500625"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500361">backend</a></span><span class="op" id="6500632">.</span><span class="ident" id="6500633"><a href="/gostd/net/http/httptest/server.go.html#6134026">URL</a></span>&nbsp;<span class="op" id="6500637">+</span>&nbsp;<span class="ident" id="6500639"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500564">tt</a></span><span class="op" id="6500641">.</span><span class="ident" id="6500642"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500006">baseSuffix</a></span><span class="op" id="6500652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6500656">if</span>&nbsp;<span class="ident" id="6500659"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500608">err</a></span>&nbsp;<span class="op" id="6500663">!=</span>&nbsp;<span class="builtintype" id="6500666">nil</span>&nbsp;<span class="op" id="6500670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500675"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500344">t</a></span><span class="op" id="6500676">.</span><span class="ident" id="6500677"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6500682">(</span><span class="ident" id="6500683"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500608">err</a></span><span class="op" id="6500686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500694">frontend</span>&nbsp;<span class="op" id="6500703">:=</span>&nbsp;<span class="ident" id="6500706"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496080">httptest</a></span><span class="op" id="6500714">.</span><span class="ident" id="6500715"><a href="/gostd/net/http/httptest/server.go.html#6135832">NewServer</a></span><span class="op" id="6500724">(</span><span class="ident" id="6500725"><a href="/gostd/net/http/httputil/reverseproxy.go.html#6401126">NewSingleHostReverseProxy</a></span><span class="op" id="6500750">(</span><span class="ident" id="6500751"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500596">backendURL</a></span><span class="op" id="6500761">)</span><span class="op" id="6500762">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500766">req</span><span class="op" id="6500769">,</span>&nbsp;<span class="ident" id="6500771">_</span>&nbsp;<span class="op" id="6500773">:=</span>&nbsp;<span class="ident" id="6500776"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6500780">.</span><span class="ident" id="6500781"><a href="/gostd/net/http/request.go.html#4149529">NewRequest</a></span><span class="op" id="6500791">(</span><span class="string" id="6500792">&#34;GET&#34;</span><span class="op" id="6500797">,</span>&nbsp;<span class="ident" id="6500799"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500694">frontend</a></span><span class="op" id="6500807">.</span><span class="ident" id="6500808"><a href="/gostd/net/http/httptest/server.go.html#6134026">URL</a></span><span class="op" id="6500811">+</span><span class="ident" id="6500812"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500564">tt</a></span><span class="op" id="6500814">.</span><span class="ident" id="6500815"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500057">reqSuffix</a></span><span class="op" id="6500824">,</span>&nbsp;<span class="builtintype" id="6500826">nil</span><span class="op" id="6500829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500833"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500766">req</a></span><span class="op" id="6500836">.</span><span class="ident" id="6500837"><a href="/gostd/net/http/request.go.html#4138776">Close</a></span>&nbsp;<span class="op" id="6500843">=</span>&nbsp;<span class="builtintype" id="6500845">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500852">res</span><span class="op" id="6500855">,</span>&nbsp;<span class="ident" id="6500857"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500608">err</a></span>&nbsp;<span class="op" id="6500861">:=</span>&nbsp;<span class="ident" id="6500864"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6500868">.</span><span class="ident" id="6500869"><a href="/gostd/net/http/client.go.html#4082381">DefaultClient</a></span><span class="op" id="6500882">.</span><span class="ident" id="6500883"><a href="/gostd/net/http/client.go.html#4085906">Do</a></span><span class="op" id="6500885">(</span><span class="ident" id="6500886"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500766">req</a></span><span class="op" id="6500889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6500893">if</span>&nbsp;<span class="ident" id="6500896"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500608">err</a></span>&nbsp;<span class="op" id="6500900">!=</span>&nbsp;<span class="builtintype" id="6500903">nil</span>&nbsp;<span class="op" id="6500907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500912"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500344">t</a></span><span class="op" id="6500913">.</span><span class="ident" id="6500914"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6500920">(</span><span class="string" id="6500921">&#34;%d.&nbsp;Get:&nbsp;%v&#34;</span><span class="op" id="6500934">,</span>&nbsp;<span class="ident" id="6500936"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500561">i</a></span><span class="op" id="6500937">,</span>&nbsp;<span class="ident" id="6500939"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500608">err</a></span><span class="op" id="6500942">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6500950">if</span>&nbsp;<span class="ident" id="6500953">g</span><span class="op" id="6500954">,</span>&nbsp;<span class="ident" id="6500956">e</span>&nbsp;<span class="op" id="6500958">:=</span>&nbsp;<span class="ident" id="6500961"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500852">res</a></span><span class="op" id="6500964">.</span><span class="ident" id="6500965"><a href="/gostd/net/http/response.go.html#4162137">Header</a></span><span class="op" id="6500971">.</span><span class="ident" id="6500972"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="6500975">(</span><span class="string" id="6500976">&#34;X-Got-Query&#34;</span><span class="op" id="6500989">)</span><span class="op" id="6500990">,</span>&nbsp;<span class="ident" id="6500992"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500564">tt</a></span><span class="op" id="6500994">.</span><span class="ident" id="6500995"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500119">want</a></span><span class="op" id="6500999">;</span>&nbsp;<span class="ident" id="6501001"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500953">g</a></span>&nbsp;<span class="op" id="6501003">!=</span>&nbsp;<span class="ident" id="6501006"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500956">e</a></span>&nbsp;<span class="op" id="6501008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501013"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500344">t</a></span><span class="op" id="6501014">.</span><span class="ident" id="6501015"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6501021">(</span><span class="string" id="6501022">&#34;%d.&nbsp;got&nbsp;query&nbsp;%q;&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="6501053">,</span>&nbsp;<span class="ident" id="6501055"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500561">i</a></span><span class="op" id="6501056">,</span>&nbsp;<span class="ident" id="6501058"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500953">g</a></span><span class="op" id="6501059">,</span>&nbsp;<span class="ident" id="6501061"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500956">e</a></span><span class="op" id="6501062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6501066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501070"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500852">res</a></span><span class="op" id="6501073">.</span><span class="ident" id="6501074"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span><span class="op" id="6501078">.</span><span class="ident" id="6501079"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="6501084">(</span><span class="op" id="6501085">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501089"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6500694">frontend</a></span><span class="op" id="6501097">.</span><span class="ident" id="6501098"><a href="/gostd/net/http/httptest/server.go.html#6137960">Close</a></span><span class="op" id="6501103">(</span><span class="op" id="6501104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6501107">}</span><br>
<span class="lineno"></span><span class="op" id="6501109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6501112">func</span>&nbsp;<span class="ident" id="6501117">TestReverseProxyFlushInterval</span><span class="op" id="6501146">(</span><span class="ident" id="6501147">t</span>&nbsp;<span class="op" id="6501149">*</span><span class="ident" id="6501150"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496123">testing</a></span><span class="op" id="6501157">.</span><span class="ident" id="6501158"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6501159">)</span>&nbsp;<span class="op" id="6501161">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6501164">const</span>&nbsp;<span class="ident" id="6501170">expected</span>&nbsp;<span class="op" id="6501179">=</span>&nbsp;<span class="string" id="6501181">&#34;hi&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501187">backend</span>&nbsp;<span class="op" id="6501195">:=</span>&nbsp;<span class="ident" id="6501198"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496080">httptest</a></span><span class="op" id="6501206">.</span><span class="ident" id="6501207"><a href="/gostd/net/http/httptest/server.go.html#6135832">NewServer</a></span><span class="op" id="6501216">(</span><span class="ident" id="6501217"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6501221">.</span><span class="ident" id="6501222"><a href="/gostd/net/http/server.go.html#4205623">HandlerFunc</a></span><span class="op" id="6501233">(</span><span class="keyword" id="6501234">func</span><span class="op" id="6501238">(</span><span class="ident" id="6501239">w</span>&nbsp;<span class="ident" id="6501241"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6501245">.</span><span class="ident" id="6501246"><a href="/gostd/net/http/server.go.html#4170569">ResponseWriter</a></span><span class="op" id="6501260">,</span>&nbsp;<span class="ident" id="6501262">r</span>&nbsp;<span class="op" id="6501264">*</span><span class="ident" id="6501265"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6501269">.</span><span class="ident" id="6501270"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6501277">)</span>&nbsp;<span class="op" id="6501279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501283"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501239">w</a></span><span class="op" id="6501284">.</span><span class="ident" id="6501285"><a href="/gostd/net/http/server.go.html#4171123">Write</a></span><span class="op" id="6501290">(</span><span class="op" id="6501291">[</span><span class="op" id="6501292">]</span><span class="builtintype" id="6501293">byte</span><span class="op" id="6501297">(</span><span class="ident" id="6501298"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501170">expected</a></span><span class="op" id="6501306">)</span><span class="op" id="6501307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6501310">}</span><span class="op" id="6501311">)</span><span class="op" id="6501312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6501315">defer</span>&nbsp;<span class="ident" id="6501321"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501187">backend</a></span><span class="op" id="6501328">.</span><span class="ident" id="6501329"><a href="/gostd/net/http/httptest/server.go.html#6137960">Close</a></span><span class="op" id="6501334">(</span><span class="op" id="6501335">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501339">backendURL</span><span class="op" id="6501349">,</span>&nbsp;<span class="ident" id="6501351">err</span>&nbsp;<span class="op" id="6501355">:=</span>&nbsp;<span class="ident" id="6501358"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496101">url</a></span><span class="op" id="6501361">.</span><span class="ident" id="6501362"><a href="/gostd/net/url/url.go.html#3754169">Parse</a></span><span class="op" id="6501367">(</span><span class="ident" id="6501368"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501187">backend</a></span><span class="op" id="6501375">.</span><span class="ident" id="6501376"><a href="/gostd/net/http/httptest/server.go.html#6134026">URL</a></span><span class="op" id="6501379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6501382">if</span>&nbsp;<span class="ident" id="6501385"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501351">err</a></span>&nbsp;<span class="op" id="6501389">!=</span>&nbsp;<span class="builtintype" id="6501392">nil</span>&nbsp;<span class="op" id="6501396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501400"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501147">t</a></span><span class="op" id="6501401">.</span><span class="ident" id="6501402"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6501407">(</span><span class="ident" id="6501408"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501351">err</a></span><span class="op" id="6501411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6501414">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501418">proxyHandler</span>&nbsp;<span class="op" id="6501431">:=</span>&nbsp;<span class="ident" id="6501434"><a href="/gostd/net/http/httputil/reverseproxy.go.html#6401126">NewSingleHostReverseProxy</a></span><span class="op" id="6501459">(</span><span class="ident" id="6501460"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501339">backendURL</a></span><span class="op" id="6501470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501473"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501418">proxyHandler</a></span><span class="op" id="6501485">.</span><span class="ident" id="6501486"><a href="/gostd/net/http/httputil/reverseproxy.go.html#6400386">FlushInterval</a></span>&nbsp;<span class="op" id="6501500">=</span>&nbsp;<span class="ident" id="6501502"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496134">time</a></span><span class="op" id="6501506">.</span><span class="ident" id="6501507"><a href="/gostd/time/time.go.html#2734777">Microsecond</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501521">done</span>&nbsp;<span class="op" id="6501526">:=</span>&nbsp;<span class="builtinfunc" id="6501529">make</span><span class="op" id="6501533">(</span><span class="keyword" id="6501534">chan</span>&nbsp;<span class="builtintype" id="6501539">bool</span><span class="op" id="6501543">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501546"><a href="/gostd/net/http/httputil/reverseproxy.go.html#6399694">onExitFlushLoop</a></span>&nbsp;<span class="op" id="6501562">=</span>&nbsp;<span class="keyword" id="6501564">func</span><span class="op" id="6501568">(</span><span class="op" id="6501569">)</span>&nbsp;<span class="op" id="6501571">{</span>&nbsp;<span class="ident" id="6501573"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501521">done</a></span>&nbsp;<span class="op" id="6501578">&lt;-</span>&nbsp;<span class="builtintype" id="6501581">true</span>&nbsp;<span class="op" id="6501586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6501589">defer</span>&nbsp;<span class="keyword" id="6501595">func</span><span class="op" id="6501599">(</span><span class="op" id="6501600">)</span>&nbsp;<span class="op" id="6501602">{</span>&nbsp;<span class="ident" id="6501604"><a href="/gostd/net/http/httputil/reverseproxy.go.html#6399694">onExitFlushLoop</a></span>&nbsp;<span class="op" id="6501620">=</span>&nbsp;<span class="builtintype" id="6501622">nil</span>&nbsp;<span class="op" id="6501626">}</span><span class="op" id="6501627">(</span><span class="op" id="6501628">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501632">frontend</span>&nbsp;<span class="op" id="6501641">:=</span>&nbsp;<span class="ident" id="6501644"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496080">httptest</a></span><span class="op" id="6501652">.</span><span class="ident" id="6501653"><a href="/gostd/net/http/httptest/server.go.html#6135832">NewServer</a></span><span class="op" id="6501662">(</span><span class="ident" id="6501663"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501418">proxyHandler</a></span><span class="op" id="6501675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6501678">defer</span>&nbsp;<span class="ident" id="6501684"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501632">frontend</a></span><span class="op" id="6501692">.</span><span class="ident" id="6501693"><a href="/gostd/net/http/httptest/server.go.html#6137960">Close</a></span><span class="op" id="6501698">(</span><span class="op" id="6501699">)</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501703">req</span><span class="op" id="6501706">,</span>&nbsp;<span class="ident" id="6501708">_</span>&nbsp;<span class="op" id="6501710">:=</span>&nbsp;<span class="ident" id="6501713"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6501717">.</span><span class="ident" id="6501718"><a href="/gostd/net/http/request.go.html#4149529">NewRequest</a></span><span class="op" id="6501728">(</span><span class="string" id="6501729">&#34;GET&#34;</span><span class="op" id="6501734">,</span>&nbsp;<span class="ident" id="6501736"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501632">frontend</a></span><span class="op" id="6501744">.</span><span class="ident" id="6501745"><a href="/gostd/net/http/httptest/server.go.html#6134026">URL</a></span><span class="op" id="6501748">,</span>&nbsp;<span class="builtintype" id="6501750">nil</span><span class="op" id="6501753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501756"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501703">req</a></span><span class="op" id="6501759">.</span><span class="ident" id="6501760"><a href="/gostd/net/http/request.go.html#4138776">Close</a></span>&nbsp;<span class="op" id="6501766">=</span>&nbsp;<span class="builtintype" id="6501768">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501774">res</span><span class="op" id="6501777">,</span>&nbsp;<span class="ident" id="6501779"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501351">err</a></span>&nbsp;<span class="op" id="6501783">:=</span>&nbsp;<span class="ident" id="6501786"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496068">http</a></span><span class="op" id="6501790">.</span><span class="ident" id="6501791"><a href="/gostd/net/http/client.go.html#4082381">DefaultClient</a></span><span class="op" id="6501804">.</span><span class="ident" id="6501805"><a href="/gostd/net/http/client.go.html#4085906">Do</a></span><span class="op" id="6501807">(</span><span class="ident" id="6501808"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501703">req</a></span><span class="op" id="6501811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6501814">if</span>&nbsp;<span class="ident" id="6501817"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501351">err</a></span>&nbsp;<span class="op" id="6501821">!=</span>&nbsp;<span class="builtintype" id="6501824">nil</span>&nbsp;<span class="op" id="6501828">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501832"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501147">t</a></span><span class="op" id="6501833">.</span><span class="ident" id="6501834"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6501840">(</span><span class="string" id="6501841">&#34;Get:&nbsp;%v&#34;</span><span class="op" id="6501850">,</span>&nbsp;<span class="ident" id="6501852"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501351">err</a></span><span class="op" id="6501855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6501858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6501861">defer</span>&nbsp;<span class="ident" id="6501867"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501774">res</a></span><span class="op" id="6501870">.</span><span class="ident" id="6501871"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span><span class="op" id="6501875">.</span><span class="ident" id="6501876"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="6501881">(</span><span class="op" id="6501882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6501885">if</span>&nbsp;<span class="ident" id="6501888">bodyBytes</span><span class="op" id="6501897">,</span>&nbsp;<span class="ident" id="6501899">_</span>&nbsp;<span class="op" id="6501901">:=</span>&nbsp;<span class="ident" id="6501904"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496055">ioutil</a></span><span class="op" id="6501910">.</span><span class="ident" id="6501911"><a href="/gostd/io/ioutil/ioutil.go.html#3765117">ReadAll</a></span><span class="op" id="6501918">(</span><span class="ident" id="6501919"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501774">res</a></span><span class="op" id="6501922">.</span><span class="ident" id="6501923"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span><span class="op" id="6501927">)</span><span class="op" id="6501928">;</span>&nbsp;<span class="builtintype" id="6501930">string</span><span class="op" id="6501936">(</span><span class="ident" id="6501937"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501888">bodyBytes</a></span><span class="op" id="6501946">)</span>&nbsp;<span class="op" id="6501948">!=</span>&nbsp;<span class="ident" id="6501951"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501170">expected</a></span>&nbsp;<span class="op" id="6501960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501964"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501147">t</a></span><span class="op" id="6501965">.</span><span class="ident" id="6501966"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6501972">(</span><span class="string" id="6501973">&#34;got&nbsp;body&nbsp;%q;&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="6501999">,</span>&nbsp;<span class="ident" id="6502001"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501888">bodyBytes</a></span><span class="op" id="6502010">,</span>&nbsp;<span class="ident" id="6502012"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501170">expected</a></span><span class="op" id="6502020">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6502023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6502027">select</span>&nbsp;<span class="op" id="6502034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6502037">case</span>&nbsp;<span class="op" id="6502042">&lt;-</span><span class="ident" id="6502044"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501521">done</a></span><span class="op" id="6502048">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6502052">//&nbsp;OK</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6502059">case</span>&nbsp;<span class="op" id="6502064">&lt;-</span><span class="ident" id="6502066"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496134">time</a></span><span class="op" id="6502070">.</span><span class="ident" id="6502071"><a href="/gostd/time/sleep.go.html#2716644">After</a></span><span class="op" id="6502076">(</span><span class="num" id="6502077">5</span>&nbsp;<span class="op" id="6502079">*</span>&nbsp;<span class="ident" id="6502081"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6496134">time</a></span><span class="op" id="6502085">.</span><span class="ident" id="6502086"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="6502092">)</span><span class="op" id="6502093">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502097"><a href="/gostd/net/http/httputil/reverseproxy_test.go.html#6501147">t</a></span><span class="op" id="6502098">.</span><span class="ident" id="6502099"><a href="/gostd/testing/testing.go.html#5479963">Error</a></span><span class="op" id="6502104">(</span><span class="string" id="6502105">&#34;maxLatencyWriter&nbsp;flushLoop()&nbsp;never&nbsp;exited&#34;</span><span class="op" id="6502148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6502151">}</span><br>
<span class="lineno"></span><span class="op" id="6502153">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
