<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math</h2>
<ul>
<li><a href="/gostd/math/abs.go.html">abs.go</a></li>
<li><a href="/gostd/math/acosh.go.html">acosh.go</a></li>
<li><a href="/gostd/math/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/math/asin.go.html">asin.go</a></li>
<li><a href="/gostd/math/asinh.go.html">asinh.go</a></li>
<li><a href="/gostd/math/atan.go.html">atan.go</a></li>
<li><a href="/gostd/math/atan2.go.html">atan2.go</a></li>
<li><a href="/gostd/math/atanh.go.html">atanh.go</a></li>
<li><a href="/gostd/math/bits.go.html">bits.go</a></li>
<li><a href="/gostd/math/cbrt.go.html">cbrt.go</a></li>
<li><a href="/gostd/math/const.go.html">const.go</a></li>
<li><a href="/gostd/math/copysign.go.html">copysign.go</a></li>
<li><a href="/gostd/math/dim.go.html">dim.go</a></li>
<li><a href="/gostd/math/erf.go.html">erf.go</a></li>
<li><a href="/gostd/math/exp.go.html">exp.go</a></li>
<li><a href="/gostd/math/expm1.go.html" class="current">expm1.go</a></li>
<li><a href="/gostd/math/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/math/floor.go.html">floor.go</a></li>
<li><a href="/gostd/math/frexp.go.html">frexp.go</a></li>
<li><a href="/gostd/math/gamma.go.html">gamma.go</a></li>
<li><a href="/gostd/math/hypot.go.html">hypot.go</a></li>
<li><a href="/gostd/math/j0.go.html">j0.go</a></li>
<li><a href="/gostd/math/j1.go.html">j1.go</a></li>
<li><a href="/gostd/math/jn.go.html">jn.go</a></li>
<li><a href="/gostd/math/ldexp.go.html">ldexp.go</a></li>
<li><a href="/gostd/math/lgamma.go.html">lgamma.go</a></li>
<li><a href="/gostd/math/log.go.html">log.go</a></li>
<li><a href="/gostd/math/log10.go.html">log10.go</a></li>
<li><a href="/gostd/math/log1p.go.html">log1p.go</a></li>
<li><a href="/gostd/math/logb.go.html">logb.go</a></li>
<li><a href="/gostd/math/mod.go.html">mod.go</a></li>
<li><a href="/gostd/math/modf.go.html">modf.go</a></li>
<li><a href="/gostd/math/nextafter.go.html">nextafter.go</a></li>
<li><a href="/gostd/math/pow.go.html">pow.go</a></li>
<li><a href="/gostd/math/pow10.go.html">pow10.go</a></li>
<li><a href="/gostd/math/remainder.go.html">remainder.go</a></li>
<li><a href="/gostd/math/signbit.go.html">signbit.go</a></li>
<li><a href="/gostd/math/sin.go.html">sin.go</a></li>
<li><a href="/gostd/math/sincos.go.html">sincos.go</a></li>
<li><a href="/gostd/math/sinh.go.html">sinh.go</a></li>
<li><a href="/gostd/math/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/math/tan.go.html">tan.go</a></li>
<li><a href="/gostd/math/tanh.go.html">tanh.go</a></li>
<li><a href="/gostd/math/unsafe.go.html">unsafe.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2128606">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2128661">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2128715">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2128766">package</span>&nbsp;<span class="ident" id="2128774">math</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2128780">//&nbsp;The&nbsp;original&nbsp;C&nbsp;code,&nbsp;the&nbsp;long&nbsp;comment,&nbsp;and&nbsp;the&nbsp;constants</span><br>
<span class="lineno"></span><span class="comment" id="2128840">//&nbsp;below&nbsp;are&nbsp;from&nbsp;FreeBSD&#39;s&nbsp;/usr/src/lib/msun/src/s_expm1.c</span><br>
<span class="lineno"></span><span class="comment" id="2128900">//&nbsp;and&nbsp;came&nbsp;with&nbsp;this&nbsp;notice.&nbsp;&nbsp;The&nbsp;go&nbsp;code&nbsp;is&nbsp;a&nbsp;simplified</span><br>
<span class="lineno">10</span><span class="comment" id="2128959">//&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="2128989">//</span><br>
<span class="lineno"></span><span class="comment" id="2128992">//&nbsp;====================================================</span><br>
<span class="lineno"></span><span class="comment" id="2129048">//&nbsp;Copyright&nbsp;(C)&nbsp;1993&nbsp;by&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2129117">//</span><br>
<span class="lineno">15</span><span class="comment" id="2129120">//&nbsp;Developed&nbsp;at&nbsp;SunPro,&nbsp;a&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;business.</span><br>
<span class="lineno"></span><span class="comment" id="2129179">//&nbsp;Permission&nbsp;to&nbsp;use,&nbsp;copy,&nbsp;modify,&nbsp;and&nbsp;distribute&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="2129235">//&nbsp;software&nbsp;is&nbsp;freely&nbsp;granted,&nbsp;provided&nbsp;that&nbsp;this&nbsp;notice</span><br>
<span class="lineno"></span><span class="comment" id="2129292">//&nbsp;is&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="comment" id="2129309">//&nbsp;====================================================</span><br>
<span class="lineno">20</span><span class="comment" id="2129365">//</span><br>
<span class="lineno"></span><span class="comment" id="2129368">//&nbsp;expm1(x)</span><br>
<span class="lineno"></span><span class="comment" id="2129380">//&nbsp;Returns&nbsp;exp(x)-1,&nbsp;the&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2129431">//</span><br>
<span class="lineno"></span><span class="comment" id="2129434">//&nbsp;Method</span><br>
<span class="lineno">25</span><span class="comment" id="2129444">//&nbsp;&nbsp;&nbsp;1.&nbsp;Argument&nbsp;reduction:</span><br>
<span class="lineno"></span><span class="comment" id="2129472">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Given&nbsp;x,&nbsp;find&nbsp;r&nbsp;and&nbsp;integer&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2129520">//</span><br>
<span class="lineno"></span><span class="comment" id="2129523">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;k*ln2&nbsp;+&nbsp;r,&nbsp;&nbsp;|r|&nbsp;&lt;=&nbsp;0.5*ln2&nbsp;~&nbsp;0.34658</span><br>
<span class="lineno"></span><span class="comment" id="2129581">//</span><br>
<span class="lineno">30</span><span class="comment" id="2129584">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;a&nbsp;correction&nbsp;term&nbsp;c&nbsp;will&nbsp;be&nbsp;computed&nbsp;to&nbsp;compensate</span><br>
<span class="lineno"></span><span class="comment" id="2129648">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;error&nbsp;in&nbsp;r&nbsp;when&nbsp;rounded&nbsp;to&nbsp;a&nbsp;floating-point&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="2129712">//</span><br>
<span class="lineno"></span><span class="comment" id="2129715">//&nbsp;&nbsp;&nbsp;2.&nbsp;Approximating&nbsp;expm1(r)&nbsp;by&nbsp;a&nbsp;special&nbsp;rational&nbsp;function&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="2129780">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;interval&nbsp;[0,0.34658]:</span><br>
<span class="lineno">35</span><span class="comment" id="2129814">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Since</span><br>
<span class="lineno"></span><span class="comment" id="2129828">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;-&nbsp;r**4/360&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2129893">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;define&nbsp;R1(r*r)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2129922">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;*&nbsp;R1(r*r)</span><br>
<span class="lineno"></span><span class="comment" id="2129980">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;is,</span><br>
<span class="lineno">40</span><span class="comment" id="2129997">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(r**2)&nbsp;=&nbsp;6/r&nbsp;*((exp(r)+1)/(exp(r)-1)&nbsp;-&nbsp;2/r)</span><br>
<span class="lineno"></span><span class="comment" id="2130055">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6/r&nbsp;*&nbsp;(&nbsp;1&nbsp;+&nbsp;2.0*(1/(exp(r)-1)&nbsp;-&nbsp;1/r))</span><br>
<span class="lineno"></span><span class="comment" id="2130116">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1&nbsp;-&nbsp;r**2/60&nbsp;+&nbsp;r**4/2520&nbsp;-&nbsp;r**6/100800&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2130183">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;use&nbsp;a&nbsp;special&nbsp;Reme&nbsp;algorithm&nbsp;on&nbsp;[0,0.347]&nbsp;to&nbsp;generate</span><br>
<span class="lineno"></span><span class="comment" id="2130248">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;polynomial&nbsp;of&nbsp;degree&nbsp;5&nbsp;in&nbsp;r*r&nbsp;to&nbsp;approximate&nbsp;R1.&nbsp;The</span><br>
<span class="lineno">45</span><span class="comment" id="2130311">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maximum&nbsp;error&nbsp;of&nbsp;this&nbsp;polynomial&nbsp;approximation&nbsp;is&nbsp;bounded</span><br>
<span class="lineno"></span><span class="comment" id="2130377">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;2**-61.&nbsp;In&nbsp;other&nbsp;words,</span><br>
<span class="lineno"></span><span class="comment" id="2130412">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(z)&nbsp;~&nbsp;1.0&nbsp;+&nbsp;Q1*z&nbsp;+&nbsp;Q2*z**2&nbsp;+&nbsp;Q3*z**3&nbsp;+&nbsp;Q4*z**4&nbsp;+&nbsp;Q5*z**5</span><br>
<span class="lineno"></span><span class="comment" id="2130483">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;&nbsp;&nbsp;Q1&nbsp;&nbsp;=&nbsp;&nbsp;-1.6666666666666567384E-2,</span><br>
<span class="lineno"></span><span class="comment" id="2130533">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q2&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;3.9682539681370365873E-4,</span><br>
<span class="lineno">50</span><span class="comment" id="2130583">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3&nbsp;&nbsp;=&nbsp;&nbsp;-9.9206344733435987357E-6,</span><br>
<span class="lineno"></span><span class="comment" id="2130633">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q4&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;2.5051361420808517002E-7,</span><br>
<span class="lineno"></span><span class="comment" id="2130683">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q5&nbsp;&nbsp;=&nbsp;&nbsp;-6.2843505682382617102E-9;</span><br>
<span class="lineno"></span><span class="comment" id="2130733">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(where&nbsp;z=r*r,&nbsp;and&nbsp;the&nbsp;values&nbsp;of&nbsp;Q1&nbsp;to&nbsp;Q5&nbsp;are&nbsp;listed&nbsp;below)</span><br>
<span class="lineno"></span><span class="comment" id="2130800">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;error&nbsp;bounded&nbsp;by</span><br>
<span class="lineno">55</span><span class="comment" id="2130830">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-61</span><br>
<span class="lineno"></span><span class="comment" id="2130883">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;1.0+Q1*z+...+Q5*z&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;R1(z)&nbsp;|&nbsp;&lt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="2130933">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="2130978">//</span><br>
<span class="lineno"></span><span class="comment" id="2130981">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;exp(r)-1&nbsp;is&nbsp;then&nbsp;computed&nbsp;by&nbsp;the&nbsp;following</span><br>
<span class="lineno">60</span><span class="comment" id="2131043">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specific&nbsp;way&nbsp;which&nbsp;minimize&nbsp;the&nbsp;accumulation&nbsp;rounding&nbsp;error:</span><br>
<span class="lineno"></span><span class="comment" id="2131112">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="2131151">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;3&nbsp;-&nbsp;(R1&nbsp;+&nbsp;R1*r/2)&nbsp;&nbsp;]</span><br>
<span class="lineno"></span><span class="comment" id="2131215">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;r&nbsp;+&nbsp;---&nbsp;+&nbsp;---&nbsp;*&nbsp;[--------------------]</span><br>
<span class="lineno"></span><span class="comment" id="2131279">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]</span><br>
<span class="lineno">65</span><span class="comment" id="2131343">//</span><br>
<span class="lineno"></span><span class="comment" id="2131346">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;compensate&nbsp;the&nbsp;error&nbsp;in&nbsp;the&nbsp;argument&nbsp;reduction,&nbsp;we&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="2131412">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)&nbsp;=&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;expm1(r)*c</span><br>
<span class="lineno"></span><span class="comment" id="2131467">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;r*c</span><br>
<span class="lineno"></span><span class="comment" id="2131515">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thus&nbsp;c+r*c&nbsp;will&nbsp;be&nbsp;added&nbsp;in&nbsp;as&nbsp;the&nbsp;correction&nbsp;terms&nbsp;for</span><br>
<span class="lineno">70</span><span class="comment" id="2131579">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c).&nbsp;Now&nbsp;rearrange&nbsp;the&nbsp;term&nbsp;to&nbsp;avoid&nbsp;optimization</span><br>
<span class="lineno"></span><span class="comment" id="2131644">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;up:</span><br>
<span class="lineno"></span><span class="comment" id="2131662">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2131734">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;R1&nbsp;-&nbsp;&nbsp;(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2131806">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)~r&nbsp;-&nbsp;({r*(---&nbsp;*&nbsp;[--------------------]-c)-c}&nbsp;-&nbsp;---&nbsp;)</span><br>
<span class="lineno">75</span><span class="comment" id="2131878">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2131950">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2132022">//</span><br>
<span class="lineno"></span><span class="comment" id="2132025">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;r&nbsp;-&nbsp;E</span><br>
<span class="lineno"></span><span class="comment" id="2132052">//&nbsp;&nbsp;&nbsp;3.&nbsp;Scale&nbsp;back&nbsp;to&nbsp;obtain&nbsp;expm1(x):</span><br>
<span class="lineno">80</span><span class="comment" id="2132091">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;step&nbsp;1,&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="2132120">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(x)&nbsp;=&nbsp;either&nbsp;2**k*[expm1(r)+1]&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="2132171">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2**k*[expm1(r)&nbsp;+&nbsp;(1-2**-k)]</span><br>
<span class="lineno"></span><span class="comment" id="2132228">//&nbsp;&nbsp;&nbsp;4.&nbsp;Implementation&nbsp;notes:</span><br>
<span class="lineno"></span><span class="comment" id="2132258">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(A).&nbsp;To&nbsp;save&nbsp;one&nbsp;multiplication,&nbsp;we&nbsp;scale&nbsp;the&nbsp;coefficient&nbsp;Qi</span><br>
<span class="lineno">85</span><span class="comment" id="2132327">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;Qi*2**i,&nbsp;and&nbsp;replace&nbsp;z&nbsp;by&nbsp;(x**2)/2.</span><br>
<span class="lineno"></span><span class="comment" id="2132379">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(B).&nbsp;To&nbsp;achieve&nbsp;maximum&nbsp;accuracy,&nbsp;we&nbsp;compute&nbsp;expm1(x)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2132444">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(i)&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0,&nbsp;(raise&nbsp;inexact&nbsp;if&nbsp;x!=inf)</span><br>
<span class="lineno"></span><span class="comment" id="2132515">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ii)&nbsp;&nbsp;if&nbsp;k=0,&nbsp;return&nbsp;r-E</span><br>
<span class="lineno"></span><span class="comment" id="2132550">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iii)&nbsp;if&nbsp;k=-1,&nbsp;return&nbsp;0.5*(r-E)-0.5</span><br>
<span class="lineno">90</span><span class="comment" id="2132596">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iv)&nbsp;&nbsp;if&nbsp;k=1&nbsp;if&nbsp;r&nbsp;&lt;&nbsp;-0.25,&nbsp;return&nbsp;2*((r+0.5)-&nbsp;E)</span><br>
<span class="lineno"></span><span class="comment" id="2132655">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;1.0+2.0*(r-E);</span><br>
<span class="lineno"></span><span class="comment" id="2132715">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(v)&nbsp;&nbsp;&nbsp;if&nbsp;(k&lt;-2||k&gt;56)&nbsp;return&nbsp;2**k(1-(E-r))&nbsp;-&nbsp;1&nbsp;(or&nbsp;exp(x)-1)</span><br>
<span class="lineno"></span><span class="comment" id="2132786">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vi)&nbsp;&nbsp;if&nbsp;k&nbsp;&lt;=&nbsp;20,&nbsp;return&nbsp;2**k((1-2**-k)-(E-r)),&nbsp;else</span><br>
<span class="lineno"></span><span class="comment" id="2132849">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vii)&nbsp;return&nbsp;2**k(1-((E+2**-k)-r))</span><br>
<span class="lineno">95</span><span class="comment" id="2132894">//</span><br>
<span class="lineno"></span><span class="comment" id="2132897">//&nbsp;Special&nbsp;cases:</span><br>
<span class="lineno"></span><span class="comment" id="2132915">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(INF)&nbsp;is&nbsp;INF,&nbsp;expm1(NaN)&nbsp;is&nbsp;NaN;</span><br>
<span class="lineno"></span><span class="comment" id="2132961">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(-INF)&nbsp;is&nbsp;-1,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2132992">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;finite&nbsp;argument,&nbsp;only&nbsp;expm1(0)=0&nbsp;is&nbsp;exact.</span><br>
<span class="lineno">100</span><span class="comment" id="2133047">//</span><br>
<span class="lineno"></span><span class="comment" id="2133050">//&nbsp;Accuracy:</span><br>
<span class="lineno"></span><span class="comment" id="2133063">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;an&nbsp;error&nbsp;analysis,&nbsp;the&nbsp;error&nbsp;is&nbsp;always&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="2133133">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;ulp&nbsp;(unit&nbsp;in&nbsp;the&nbsp;last&nbsp;place).</span><br>
<span class="lineno"></span><span class="comment" id="2133173">//</span><br>
<span class="lineno">105</span><span class="comment" id="2133176">//&nbsp;Misc.&nbsp;info.</span><br>
<span class="lineno"></span><span class="comment" id="2133191">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;IEEE&nbsp;double</span><br>
<span class="lineno"></span><span class="comment" id="2133215">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;7.09782712893383973096e+02&nbsp;then&nbsp;expm1(x)&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="2133285">//</span><br>
<span class="lineno"></span><span class="comment" id="2133288">//&nbsp;Constants:</span><br>
<span class="lineno">110</span><span class="comment" id="2133302">//&nbsp;The&nbsp;hexadecimal&nbsp;values&nbsp;are&nbsp;the&nbsp;intended&nbsp;ones&nbsp;for&nbsp;the&nbsp;following</span><br>
<span class="lineno"></span><span class="comment" id="2133368">//&nbsp;constants.&nbsp;The&nbsp;decimal&nbsp;values&nbsp;may&nbsp;be&nbsp;used,&nbsp;provided&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2133432">//&nbsp;compiler&nbsp;will&nbsp;convert&nbsp;from&nbsp;decimal&nbsp;to&nbsp;binary&nbsp;accurately&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="2133498">//&nbsp;to&nbsp;produce&nbsp;the&nbsp;hexadecimal&nbsp;values&nbsp;shown.</span><br>
<span class="lineno"></span><span class="comment" id="2133542">//</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2133546">//&nbsp;Expm1&nbsp;returns&nbsp;e**x&nbsp;-&nbsp;1,&nbsp;the&nbsp;base-e&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2133610">//&nbsp;It&nbsp;is&nbsp;more&nbsp;accurate&nbsp;than&nbsp;Exp(x)&nbsp;-&nbsp;1&nbsp;when&nbsp;x&nbsp;is&nbsp;near&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="2133670">//</span><br>
<span class="lineno"></span><span class="comment" id="2133673">//&nbsp;Special&nbsp;cases&nbsp;are:</span><br>
<span class="lineno">120</span><span class="comment" id="2133695">//&nbsp;&nbsp;&nbsp;&nbsp;Expm1(+Inf)&nbsp;=&nbsp;+Inf</span><br>
<span class="lineno"></span><span class="comment" id="2133717">//&nbsp;&nbsp;&nbsp;&nbsp;Expm1(-Inf)&nbsp;=&nbsp;-1</span><br>
<span class="lineno"></span><span class="comment" id="2133737">//&nbsp;&nbsp;&nbsp;&nbsp;Expm1(NaN)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="comment" id="2133757">//&nbsp;Very&nbsp;large&nbsp;values&nbsp;overflow&nbsp;to&nbsp;-1&nbsp;or&nbsp;+Inf.</span><br>
<span class="lineno"></span><span class="keyword" id="2133802">func</span>&nbsp;<span class="ident" id="2133807">Expm1</span><span class="op" id="2133812">(</span><span class="ident" id="2133813">x</span>&nbsp;<span class="builtintype" id="2133815">float64</span><span class="op" id="2133822">)</span>&nbsp;<span class="builtintype" id="2133824">float64</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="2133833">func</span>&nbsp;<span class="ident" id="2133838">expm1</span><span class="op" id="2133843">(</span><span class="ident" id="2133844">x</span>&nbsp;<span class="builtintype" id="2133846">float64</span><span class="op" id="2133853">)</span>&nbsp;<span class="builtintype" id="2133855">float64</span>&nbsp;<span class="op" id="2133863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133866">const</span>&nbsp;<span class="op" id="2133872">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2133876">Othreshold</span>&nbsp;<span class="op" id="2133887">=</span>&nbsp;<span class="num" id="2133889">7.09782712893383973096e+02</span>&nbsp;<span class="comment" id="2133916">//&nbsp;0x40862E42FEFA39EF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2133940">Ln2X56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2133951">=</span>&nbsp;<span class="num" id="2133953">3.88162421113569373274e+01</span>&nbsp;<span class="comment" id="2133980">//&nbsp;0x4043687a9f1af2b1</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134004">Ln2HalfX3</span>&nbsp;&nbsp;<span class="op" id="2134015">=</span>&nbsp;<span class="num" id="2134017">1.03972077083991796413e+00</span>&nbsp;<span class="comment" id="2134044">//&nbsp;0x3ff0a2b23f3bab73</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134068">Ln2Half</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2134079">=</span>&nbsp;<span class="num" id="2134081">3.46573590279972654709e-01</span>&nbsp;<span class="comment" id="2134108">//&nbsp;0x3fd62e42fefa39ef</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134132">Ln2Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2134143">=</span>&nbsp;<span class="num" id="2134145">6.93147180369123816490e-01</span>&nbsp;<span class="comment" id="2134172">//&nbsp;0x3fe62e42fee00000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134196">Ln2Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2134207">=</span>&nbsp;<span class="num" id="2134209">1.90821492927058770002e-10</span>&nbsp;<span class="comment" id="2134236">//&nbsp;0x3dea39ef35793c76</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134260">InvLn2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2134271">=</span>&nbsp;<span class="num" id="2134273">1.44269504088896338700e+00</span>&nbsp;<span class="comment" id="2134300">//&nbsp;0x3ff71547652b82fe</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134324">Tiny</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2134335">=</span>&nbsp;<span class="num" id="2134337">1.0</span>&nbsp;<span class="op" id="2134341">/</span>&nbsp;<span class="op" id="2134343">(</span><span class="num" id="2134344">1</span>&nbsp;<span class="op" id="2134346">&lt;&lt;</span>&nbsp;<span class="num" id="2134349">54</span><span class="op" id="2134351">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2134364">//&nbsp;2**-54&nbsp;=&nbsp;0x3c90000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2134397">//&nbsp;scaled&nbsp;coefficients&nbsp;related&nbsp;to&nbsp;expm1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134439">Q1</span>&nbsp;<span class="op" id="2134442">=</span>&nbsp;<span class="op" id="2134444">-</span><span class="num" id="2134445">3.33333333333331316428e-02</span>&nbsp;<span class="comment" id="2134472">//&nbsp;0xBFA11111111110F4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134496">Q2</span>&nbsp;<span class="op" id="2134499">=</span>&nbsp;<span class="num" id="2134501">1.58730158725481460165e-03</span>&nbsp;&nbsp;<span class="comment" id="2134529">//&nbsp;0x3F5A01A019FE5585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134553">Q3</span>&nbsp;<span class="op" id="2134556">=</span>&nbsp;<span class="op" id="2134558">-</span><span class="num" id="2134559">7.93650757867487942473e-05</span>&nbsp;<span class="comment" id="2134586">//&nbsp;0xBF14CE199EAADBB7</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134610">Q4</span>&nbsp;<span class="op" id="2134613">=</span>&nbsp;<span class="num" id="2134615">4.00821782732936239552e-06</span>&nbsp;&nbsp;<span class="comment" id="2134643">//&nbsp;0x3ED0CFCA86E65239</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134667">Q5</span>&nbsp;<span class="op" id="2134670">=</span>&nbsp;<span class="op" id="2134672">-</span><span class="num" id="2134673">2.01099218183624371326e-07</span>&nbsp;<span class="comment" id="2134700">//&nbsp;0xBE8AFDB76E09C32D</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2134723">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2134727">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134745">switch</span>&nbsp;<span class="op" id="2134752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134755">case</span>&nbsp;<span class="ident" id="2134760">IsInf</span><span class="op" id="2134765">(</span><span class="ident" id="2134766">x</span><span class="op" id="2134767">,</span>&nbsp;<span class="num" id="2134769">1</span><span class="op" id="2134770">)</span>&nbsp;<span class="op" id="2134772">||</span>&nbsp;<span class="ident" id="2134775">IsNaN</span><span class="op" id="2134780">(</span><span class="ident" id="2134781">x</span><span class="op" id="2134782">)</span><span class="op" id="2134783">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134787">return</span>&nbsp;<span class="ident" id="2134794">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134797">case</span>&nbsp;<span class="ident" id="2134802">IsInf</span><span class="op" id="2134807">(</span><span class="ident" id="2134808">x</span><span class="op" id="2134809">,</span>&nbsp;<span class="op" id="2134811">-</span><span class="num" id="2134812">1</span><span class="op" id="2134813">)</span><span class="op" id="2134814">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134818">return</span>&nbsp;<span class="op" id="2134825">-</span><span class="num" id="2134826">1</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2134829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134833">absx</span>&nbsp;<span class="op" id="2134838">:=</span>&nbsp;<span class="ident" id="2134841">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134844">sign</span>&nbsp;<span class="op" id="2134849">:=</span>&nbsp;<span class="builtintype" id="2134852">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134859">if</span>&nbsp;<span class="ident" id="2134862">x</span>&nbsp;<span class="op" id="2134864">&lt;</span>&nbsp;<span class="num" id="2134866">0</span>&nbsp;<span class="op" id="2134868">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134872">absx</span>&nbsp;<span class="op" id="2134877">=</span>&nbsp;<span class="op" id="2134879">-</span><span class="ident" id="2134880">absx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134887">sign</span>&nbsp;<span class="op" id="2134892">=</span>&nbsp;<span class="builtintype" id="2134894">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2134900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2134904">//&nbsp;filter&nbsp;out&nbsp;huge&nbsp;argument</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134933">if</span>&nbsp;<span class="ident" id="2134936">absx</span>&nbsp;<span class="op" id="2134941">&gt;=</span>&nbsp;<span class="ident" id="2134944">Ln2X56</span>&nbsp;<span class="op" id="2134951">{</span>&nbsp;<span class="comment" id="2134953">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;56&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134977">if</span>&nbsp;<span class="ident" id="2134980">absx</span>&nbsp;<span class="op" id="2134985">&gt;=</span>&nbsp;<span class="ident" id="2134988">Othreshold</span>&nbsp;<span class="op" id="2134999">{</span>&nbsp;<span class="comment" id="2135001">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;709.78...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135027">return</span>&nbsp;<span class="ident" id="2135034">Inf</span><span class="op" id="2135037">(</span><span class="num" id="2135038">1</span><span class="op" id="2135039">)</span>&nbsp;<span class="comment" id="2135041">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2135055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135059">if</span>&nbsp;<span class="ident" id="2135062">sign</span>&nbsp;<span class="op" id="2135067">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135072">return</span>&nbsp;<span class="op" id="2135079">-</span><span class="num" id="2135080">1</span>&nbsp;<span class="comment" id="2135082">//&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2135112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2135115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2135119">//&nbsp;argument&nbsp;reduction</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135142">var</span>&nbsp;<span class="ident" id="2135146">c</span>&nbsp;<span class="builtintype" id="2135148">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135157">var</span>&nbsp;<span class="ident" id="2135161">k</span>&nbsp;<span class="builtintype" id="2135163">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135168">if</span>&nbsp;<span class="ident" id="2135171">absx</span>&nbsp;<span class="op" id="2135176">&gt;</span>&nbsp;<span class="ident" id="2135178">Ln2Half</span>&nbsp;<span class="op" id="2135186">{</span>&nbsp;<span class="comment" id="2135188">//&nbsp;if&nbsp;&nbsp;|x|&nbsp;&gt;&nbsp;0.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135213">var</span>&nbsp;<span class="ident" id="2135217">hi</span><span class="op" id="2135219">,</span>&nbsp;<span class="ident" id="2135221">lo</span>&nbsp;<span class="builtintype" id="2135224">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135234">if</span>&nbsp;<span class="ident" id="2135237">absx</span>&nbsp;<span class="op" id="2135242">&lt;</span>&nbsp;<span class="ident" id="2135244">Ln2HalfX3</span>&nbsp;<span class="op" id="2135254">{</span>&nbsp;<span class="comment" id="2135256">//&nbsp;and&nbsp;|x|&nbsp;&lt;&nbsp;1.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135282">if</span>&nbsp;<span class="op" id="2135285">!</span><span class="ident" id="2135286">sign</span>&nbsp;<span class="op" id="2135291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135297">hi</span>&nbsp;<span class="op" id="2135300">=</span>&nbsp;<span class="ident" id="2135302">x</span>&nbsp;<span class="op" id="2135304">-</span>&nbsp;<span class="ident" id="2135306">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135316">lo</span>&nbsp;<span class="op" id="2135319">=</span>&nbsp;<span class="ident" id="2135321">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135331">k</span>&nbsp;<span class="op" id="2135333">=</span>&nbsp;<span class="num" id="2135335">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2135340">}</span>&nbsp;<span class="keyword" id="2135342">else</span>&nbsp;<span class="op" id="2135347">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135353">hi</span>&nbsp;<span class="op" id="2135356">=</span>&nbsp;<span class="ident" id="2135358">x</span>&nbsp;<span class="op" id="2135360">+</span>&nbsp;<span class="ident" id="2135362">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135372">lo</span>&nbsp;<span class="op" id="2135375">=</span>&nbsp;<span class="op" id="2135377">-</span><span class="ident" id="2135378">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135388">k</span>&nbsp;<span class="op" id="2135390">=</span>&nbsp;<span class="op" id="2135392">-</span><span class="num" id="2135393">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2135398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2135402">}</span>&nbsp;<span class="keyword" id="2135404">else</span>&nbsp;<span class="op" id="2135409">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135414">if</span>&nbsp;<span class="op" id="2135417">!</span><span class="ident" id="2135418">sign</span>&nbsp;<span class="op" id="2135423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135429">k</span>&nbsp;<span class="op" id="2135431">=</span>&nbsp;<span class="builtintype" id="2135433">int</span><span class="op" id="2135436">(</span><span class="ident" id="2135437">InvLn2</span><span class="op" id="2135443">*</span><span class="ident" id="2135444">x</span>&nbsp;<span class="op" id="2135446">+</span>&nbsp;<span class="num" id="2135448">0.5</span><span class="op" id="2135451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2135456">}</span>&nbsp;<span class="keyword" id="2135458">else</span>&nbsp;<span class="op" id="2135463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135469">k</span>&nbsp;<span class="op" id="2135471">=</span>&nbsp;<span class="builtintype" id="2135473">int</span><span class="op" id="2135476">(</span><span class="ident" id="2135477">InvLn2</span><span class="op" id="2135483">*</span><span class="ident" id="2135484">x</span>&nbsp;<span class="op" id="2135486">-</span>&nbsp;<span class="num" id="2135488">0.5</span><span class="op" id="2135491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2135496">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135501">t</span>&nbsp;<span class="op" id="2135503">:=</span>&nbsp;<span class="builtintype" id="2135506">float64</span><span class="op" id="2135513">(</span><span class="ident" id="2135514">k</span><span class="op" id="2135515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135520">hi</span>&nbsp;<span class="op" id="2135523">=</span>&nbsp;<span class="ident" id="2135525">x</span>&nbsp;<span class="op" id="2135527">-</span>&nbsp;<span class="ident" id="2135529">t</span><span class="op" id="2135530">*</span><span class="ident" id="2135531">Ln2Hi</span>&nbsp;<span class="comment" id="2135537">//&nbsp;t&nbsp;*&nbsp;Ln2Hi&nbsp;is&nbsp;exact&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135567">lo</span>&nbsp;<span class="op" id="2135570">=</span>&nbsp;<span class="ident" id="2135572">t</span>&nbsp;<span class="op" id="2135574">*</span>&nbsp;<span class="ident" id="2135576">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2135584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135588">x</span>&nbsp;<span class="op" id="2135590">=</span>&nbsp;<span class="ident" id="2135592">hi</span>&nbsp;<span class="op" id="2135595">-</span>&nbsp;<span class="ident" id="2135597">lo</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135602">c</span>&nbsp;<span class="op" id="2135604">=</span>&nbsp;<span class="op" id="2135606">(</span><span class="ident" id="2135607">hi</span>&nbsp;<span class="op" id="2135610">-</span>&nbsp;<span class="ident" id="2135612">x</span><span class="op" id="2135613">)</span>&nbsp;<span class="op" id="2135615">-</span>&nbsp;<span class="ident" id="2135617">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2135621">}</span>&nbsp;<span class="keyword" id="2135623">else</span>&nbsp;<span class="keyword" id="2135628">if</span>&nbsp;<span class="ident" id="2135631">absx</span>&nbsp;<span class="op" id="2135636">&lt;</span>&nbsp;<span class="ident" id="2135638">Tiny</span>&nbsp;<span class="op" id="2135643">{</span>&nbsp;<span class="comment" id="2135645">//&nbsp;when&nbsp;|x|&nbsp;&lt;&nbsp;2**-54,&nbsp;return&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135678">return</span>&nbsp;<span class="ident" id="2135685">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2135688">}</span>&nbsp;<span class="keyword" id="2135690">else</span>&nbsp;<span class="op" id="2135695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135699">k</span>&nbsp;<span class="op" id="2135701">=</span>&nbsp;<span class="num" id="2135703">0</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2135706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2135710">//&nbsp;x&nbsp;is&nbsp;now&nbsp;in&nbsp;primary&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135740">hfx</span>&nbsp;<span class="op" id="2135744">:=</span>&nbsp;<span class="num" id="2135747">0.5</span>&nbsp;<span class="op" id="2135751">*</span>&nbsp;<span class="ident" id="2135753">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135756">hxs</span>&nbsp;<span class="op" id="2135760">:=</span>&nbsp;<span class="ident" id="2135763">x</span>&nbsp;<span class="op" id="2135765">*</span>&nbsp;<span class="ident" id="2135767">hfx</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135772">r1</span>&nbsp;<span class="op" id="2135775">:=</span>&nbsp;<span class="num" id="2135778">1</span>&nbsp;<span class="op" id="2135780">+</span>&nbsp;<span class="ident" id="2135782">hxs</span><span class="op" id="2135785">*</span><span class="op" id="2135786">(</span><span class="ident" id="2135787">Q1</span><span class="op" id="2135789">+</span><span class="ident" id="2135790">hxs</span><span class="op" id="2135793">*</span><span class="op" id="2135794">(</span><span class="ident" id="2135795">Q2</span><span class="op" id="2135797">+</span><span class="ident" id="2135798">hxs</span><span class="op" id="2135801">*</span><span class="op" id="2135802">(</span><span class="ident" id="2135803">Q3</span><span class="op" id="2135805">+</span><span class="ident" id="2135806">hxs</span><span class="op" id="2135809">*</span><span class="op" id="2135810">(</span><span class="ident" id="2135811">Q4</span><span class="op" id="2135813">+</span><span class="ident" id="2135814">hxs</span><span class="op" id="2135817">*</span><span class="ident" id="2135818">Q5</span><span class="op" id="2135820">)</span><span class="op" id="2135821">)</span><span class="op" id="2135822">)</span><span class="op" id="2135823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135826">t</span>&nbsp;<span class="op" id="2135828">:=</span>&nbsp;<span class="num" id="2135831">3</span>&nbsp;<span class="op" id="2135833">-</span>&nbsp;<span class="ident" id="2135835">r1</span><span class="op" id="2135837">*</span><span class="ident" id="2135838">hfx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135843">e</span>&nbsp;<span class="op" id="2135845">:=</span>&nbsp;<span class="ident" id="2135848">hxs</span>&nbsp;<span class="op" id="2135852">*</span>&nbsp;<span class="op" id="2135854">(</span><span class="op" id="2135855">(</span><span class="ident" id="2135856">r1</span>&nbsp;<span class="op" id="2135859">-</span>&nbsp;<span class="ident" id="2135861">t</span><span class="op" id="2135862">)</span>&nbsp;<span class="op" id="2135864">/</span>&nbsp;<span class="op" id="2135866">(</span><span class="num" id="2135867">6.0</span>&nbsp;<span class="op" id="2135871">-</span>&nbsp;<span class="ident" id="2135873">x</span><span class="op" id="2135874">*</span><span class="ident" id="2135875">t</span><span class="op" id="2135876">)</span><span class="op" id="2135877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135880">if</span>&nbsp;<span class="ident" id="2135883">k</span>&nbsp;<span class="op" id="2135885">!=</span>&nbsp;<span class="num" id="2135888">0</span>&nbsp;<span class="op" id="2135890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135894">e</span>&nbsp;<span class="op" id="2135896">=</span>&nbsp;<span class="op" id="2135898">(</span><span class="ident" id="2135899">x</span><span class="op" id="2135900">*</span><span class="op" id="2135901">(</span><span class="ident" id="2135902">e</span><span class="op" id="2135903">-</span><span class="ident" id="2135904">c</span><span class="op" id="2135905">)</span>&nbsp;<span class="op" id="2135907">-</span>&nbsp;<span class="ident" id="2135909">c</span><span class="op" id="2135910">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135914">e</span>&nbsp;<span class="op" id="2135916">-=</span>&nbsp;<span class="ident" id="2135919">hxs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135925">switch</span>&nbsp;<span class="op" id="2135932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135936">case</span>&nbsp;<span class="ident" id="2135941">k</span>&nbsp;<span class="op" id="2135943">==</span>&nbsp;<span class="op" id="2135946">-</span><span class="num" id="2135947">1</span><span class="op" id="2135948">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135953">return</span>&nbsp;<span class="num" id="2135960">0.5</span><span class="op" id="2135963">*</span><span class="op" id="2135964">(</span><span class="ident" id="2135965">x</span><span class="op" id="2135966">-</span><span class="ident" id="2135967">e</span><span class="op" id="2135968">)</span>&nbsp;<span class="op" id="2135970">-</span>&nbsp;<span class="num" id="2135972">0.5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135978">case</span>&nbsp;<span class="ident" id="2135983">k</span>&nbsp;<span class="op" id="2135985">==</span>&nbsp;<span class="num" id="2135988">1</span><span class="op" id="2135989">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135994">if</span>&nbsp;<span class="ident" id="2135997">x</span>&nbsp;<span class="op" id="2135999">&lt;</span>&nbsp;<span class="op" id="2136001">-</span><span class="num" id="2136002">0.25</span>&nbsp;<span class="op" id="2136007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2136013">return</span>&nbsp;<span class="op" id="2136020">-</span><span class="num" id="2136021">2</span>&nbsp;<span class="op" id="2136023">*</span>&nbsp;<span class="op" id="2136025">(</span><span class="ident" id="2136026">e</span>&nbsp;<span class="op" id="2136028">-</span>&nbsp;<span class="op" id="2136030">(</span><span class="ident" id="2136031">x</span>&nbsp;<span class="op" id="2136033">+</span>&nbsp;<span class="num" id="2136035">0.5</span><span class="op" id="2136038">)</span><span class="op" id="2136039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2136044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2136049">return</span>&nbsp;<span class="num" id="2136056">1</span>&nbsp;<span class="op" id="2136058">+</span>&nbsp;<span class="num" id="2136060">2</span><span class="op" id="2136061">*</span><span class="op" id="2136062">(</span><span class="ident" id="2136063">x</span><span class="op" id="2136064">-</span><span class="ident" id="2136065">e</span><span class="op" id="2136066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2136070">case</span>&nbsp;<span class="ident" id="2136075">k</span>&nbsp;<span class="op" id="2136077">&lt;=</span>&nbsp;<span class="op" id="2136080">-</span><span class="num" id="2136081">2</span>&nbsp;<span class="op" id="2136083">||</span>&nbsp;<span class="ident" id="2136086">k</span>&nbsp;<span class="op" id="2136088">&gt;</span>&nbsp;<span class="num" id="2136090">56</span><span class="op" id="2136092">:</span>&nbsp;<span class="comment" id="2136094">//&nbsp;suffice&nbsp;to&nbsp;return&nbsp;exp(x)-1</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2136127">y</span>&nbsp;<span class="op" id="2136129">:=</span>&nbsp;<span class="num" id="2136132">1</span>&nbsp;<span class="op" id="2136134">-</span>&nbsp;<span class="op" id="2136136">(</span><span class="ident" id="2136137">e</span>&nbsp;<span class="op" id="2136139">-</span>&nbsp;<span class="ident" id="2136141">x</span><span class="op" id="2136142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2136147">y</span>&nbsp;<span class="op" id="2136149">=</span>&nbsp;<span class="ident" id="2136151">Float64frombits</span><span class="op" id="2136166">(</span><span class="ident" id="2136167">Float64bits</span><span class="op" id="2136178">(</span><span class="ident" id="2136179">y</span><span class="op" id="2136180">)</span>&nbsp;<span class="op" id="2136182">+</span>&nbsp;<span class="ident" id="2136184">uint64</span><span class="op" id="2136190">(</span><span class="ident" id="2136191">k</span><span class="op" id="2136192">)</span><span class="op" id="2136193">&lt;&lt;</span><span class="num" id="2136195">52</span><span class="op" id="2136197">)</span>&nbsp;<span class="comment" id="2136199">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2136227">return</span>&nbsp;<span class="ident" id="2136234">y</span>&nbsp;<span class="op" id="2136236">-</span>&nbsp;<span class="num" id="2136238">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2136242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2136246">if</span>&nbsp;<span class="ident" id="2136249">k</span>&nbsp;<span class="op" id="2136251">&lt;</span>&nbsp;<span class="num" id="2136253">20</span>&nbsp;<span class="op" id="2136256">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2136261">t</span>&nbsp;<span class="op" id="2136263">:=</span>&nbsp;<span class="ident" id="2136266">Float64frombits</span><span class="op" id="2136281">(</span><span class="num" id="2136282">0x3ff0000000000000</span>&nbsp;<span class="op" id="2136301">-</span>&nbsp;<span class="op" id="2136303">(</span><span class="num" id="2136304">0x20000000000000</span>&nbsp;<span class="op" id="2136321">&gt;&gt;</span>&nbsp;<span class="builtintype" id="2136324">uint</span><span class="op" id="2136328">(</span><span class="ident" id="2136329">k</span><span class="op" id="2136330">)</span><span class="op" id="2136331">)</span><span class="op" id="2136332">)</span>&nbsp;<span class="comment" id="2136334">//&nbsp;t=1-2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2136350">y</span>&nbsp;<span class="op" id="2136352">:=</span>&nbsp;<span class="ident" id="2136355">t</span>&nbsp;<span class="op" id="2136357">-</span>&nbsp;<span class="op" id="2136359">(</span><span class="ident" id="2136360">e</span>&nbsp;<span class="op" id="2136362">-</span>&nbsp;<span class="ident" id="2136364">x</span><span class="op" id="2136365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2136370">y</span>&nbsp;<span class="op" id="2136372">=</span>&nbsp;<span class="ident" id="2136374">Float64frombits</span><span class="op" id="2136389">(</span><span class="ident" id="2136390">Float64bits</span><span class="op" id="2136401">(</span><span class="ident" id="2136402">y</span><span class="op" id="2136403">)</span>&nbsp;<span class="op" id="2136405">+</span>&nbsp;<span class="ident" id="2136407">uint64</span><span class="op" id="2136413">(</span><span class="ident" id="2136414">k</span><span class="op" id="2136415">)</span><span class="op" id="2136416">&lt;&lt;</span><span class="num" id="2136418">52</span><span class="op" id="2136420">)</span>&nbsp;<span class="comment" id="2136422">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2136450">return</span>&nbsp;<span class="ident" id="2136457">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2136461">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2136465">t</span>&nbsp;<span class="op" id="2136467">:=</span>&nbsp;<span class="ident" id="2136470">Float64frombits</span><span class="op" id="2136485">(</span><span class="ident" id="2136486">uint64</span><span class="op" id="2136492">(</span><span class="op" id="2136493">(</span><span class="num" id="2136494">0x3ff</span>&nbsp;<span class="op" id="2136500">-</span>&nbsp;<span class="ident" id="2136502">k</span><span class="op" id="2136503">)</span>&nbsp;<span class="op" id="2136505">&lt;&lt;</span>&nbsp;<span class="num" id="2136508">52</span><span class="op" id="2136510">)</span><span class="op" id="2136511">)</span>&nbsp;<span class="comment" id="2136513">//&nbsp;2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2136524">y</span>&nbsp;<span class="op" id="2136526">:=</span>&nbsp;<span class="ident" id="2136529">x</span>&nbsp;<span class="op" id="2136531">-</span>&nbsp;<span class="op" id="2136533">(</span><span class="ident" id="2136534">e</span>&nbsp;<span class="op" id="2136536">+</span>&nbsp;<span class="ident" id="2136538">t</span><span class="op" id="2136539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2136543">y</span>&nbsp;<span class="op" id="2136545">+=</span>&nbsp;<span class="num" id="2136548">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2136552">y</span>&nbsp;<span class="op" id="2136554">=</span>&nbsp;<span class="ident" id="2136556">Float64frombits</span><span class="op" id="2136571">(</span><span class="ident" id="2136572">Float64bits</span><span class="op" id="2136583">(</span><span class="ident" id="2136584">y</span><span class="op" id="2136585">)</span>&nbsp;<span class="op" id="2136587">+</span>&nbsp;<span class="ident" id="2136589">uint64</span><span class="op" id="2136595">(</span><span class="ident" id="2136596">k</span><span class="op" id="2136597">)</span><span class="op" id="2136598">&lt;&lt;</span><span class="num" id="2136600">52</span><span class="op" id="2136602">)</span>&nbsp;<span class="comment" id="2136604">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2136631">return</span>&nbsp;<span class="ident" id="2136638">y</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2136641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2136644">return</span>&nbsp;<span class="ident" id="2136651">x</span>&nbsp;<span class="op" id="2136653">-</span>&nbsp;<span class="op" id="2136655">(</span><span class="ident" id="2136656">x</span><span class="op" id="2136657">*</span><span class="ident" id="2136658">e</span>&nbsp;<span class="op" id="2136660">-</span>&nbsp;<span class="ident" id="2136662">hxs</span><span class="op" id="2136665">)</span>&nbsp;<span class="comment" id="2136667">//&nbsp;c&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="op" id="2136677">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
