<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7017021">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7017076">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7017130">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7017181">package</span>&nbsp;<span class="ident" id="7017189">internal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7017199">import</span>&nbsp;<span class="op" id="7017206">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017209">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017218">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017227">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017234">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017240">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017253">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017264">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7017274">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7017277">func</span>&nbsp;<span class="ident" id="7017282">TestChunk</span><span class="op" id="7017291">(</span><span class="ident" id="7017292">t</span>&nbsp;<span class="op" id="7017294">*</span><span class="ident" id="7017295">testing</span><span class="op" id="7017302">.</span><span class="ident" id="7017303">T</span><span class="op" id="7017304">)</span>&nbsp;<span class="op" id="7017306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017309">var</span>&nbsp;<span class="ident" id="7017313">b</span>&nbsp;<span class="ident" id="7017315">bytes</span><span class="op" id="7017320">.</span><span class="ident" id="7017321">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017330">w</span>&nbsp;<span class="op" id="7017332">:=</span>&nbsp;<span class="ident" id="7017335">NewChunkedWriter</span><span class="op" id="7017351">(</span><span class="op" id="7017352">&amp;</span><span class="ident" id="7017353">b</span><span class="op" id="7017354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017357">const</span>&nbsp;<span class="ident" id="7017363">chunk1</span>&nbsp;<span class="op" id="7017370">=</span>&nbsp;<span class="string" id="7017372">&#34;hello,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017383">const</span>&nbsp;<span class="ident" id="7017389">chunk2</span>&nbsp;<span class="op" id="7017396">=</span>&nbsp;<span class="string" id="7017398">&#34;world!&nbsp;0123456789abcdef&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017425">w</span><span class="op" id="7017426">.</span><span class="ident" id="7017427">Write</span><span class="op" id="7017432">(</span><span class="op" id="7017433">[</span><span class="op" id="7017434">]</span><span class="builtintype" id="7017435">byte</span><span class="op" id="7017439">(</span><span class="ident" id="7017440">chunk1</span><span class="op" id="7017446">)</span><span class="op" id="7017447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017450">w</span><span class="op" id="7017451">.</span><span class="ident" id="7017452">Write</span><span class="op" id="7017457">(</span><span class="op" id="7017458">[</span><span class="op" id="7017459">]</span><span class="builtintype" id="7017460">byte</span><span class="op" id="7017464">(</span><span class="ident" id="7017465">chunk2</span><span class="op" id="7017471">)</span><span class="op" id="7017472">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017475">w</span><span class="op" id="7017476">.</span><span class="ident" id="7017477">Close</span><span class="op" id="7017482">(</span><span class="op" id="7017483">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017487">if</span>&nbsp;<span class="ident" id="7017490">g</span><span class="op" id="7017491">,</span>&nbsp;<span class="ident" id="7017493">e</span>&nbsp;<span class="op" id="7017495">:=</span>&nbsp;<span class="ident" id="7017498">b</span><span class="op" id="7017499">.</span><span class="ident" id="7017500">String</span><span class="op" id="7017506">(</span><span class="op" id="7017507">)</span><span class="op" id="7017508">,</span>&nbsp;<span class="string" id="7017510">&#34;7\r\nhello,&nbsp;\r\n17\r\nworld!&nbsp;0123456789abcdef\r\n0\r\n&#34;</span><span class="op" id="7017566">;</span>&nbsp;<span class="ident" id="7017568">g</span>&nbsp;<span class="op" id="7017570">!=</span>&nbsp;<span class="ident" id="7017573">e</span>&nbsp;<span class="op" id="7017575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017579">t</span><span class="op" id="7017580">.</span><span class="ident" id="7017581">Fatalf</span><span class="op" id="7017587">(</span><span class="string" id="7017588">&#34;chunk&nbsp;writer&nbsp;wrote&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7017620">,</span>&nbsp;<span class="ident" id="7017622">g</span><span class="op" id="7017623">,</span>&nbsp;<span class="ident" id="7017625">e</span><span class="op" id="7017626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7017629">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017633">r</span>&nbsp;<span class="op" id="7017635">:=</span>&nbsp;<span class="ident" id="7017638">NewChunkedReader</span><span class="op" id="7017654">(</span><span class="op" id="7017655">&amp;</span><span class="ident" id="7017656">b</span><span class="op" id="7017657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017660">data</span><span class="op" id="7017664">,</span>&nbsp;<span class="ident" id="7017666">err</span>&nbsp;<span class="op" id="7017670">:=</span>&nbsp;<span class="ident" id="7017673">ioutil</span><span class="op" id="7017679">.</span><span class="ident" id="7017680">ReadAll</span><span class="op" id="7017687">(</span><span class="ident" id="7017688">r</span><span class="op" id="7017689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017692">if</span>&nbsp;<span class="ident" id="7017695">err</span>&nbsp;<span class="op" id="7017699">!=</span>&nbsp;<span class="ident" id="7017702">nil</span>&nbsp;<span class="op" id="7017706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017710">t</span><span class="op" id="7017711">.</span><span class="ident" id="7017712">Logf</span><span class="op" id="7017716">(</span><span class="string" id="7017717">`data:&nbsp;&#34;%s&#34;`</span><span class="op" id="7017729">,</span>&nbsp;<span class="ident" id="7017731">data</span><span class="op" id="7017735">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017739">t</span><span class="op" id="7017740">.</span><span class="ident" id="7017741">Fatalf</span><span class="op" id="7017747">(</span><span class="string" id="7017748">&#34;ReadAll&nbsp;from&nbsp;reader:&nbsp;%v&#34;</span><span class="op" id="7017773">,</span>&nbsp;<span class="ident" id="7017775">err</span><span class="op" id="7017778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7017781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017784">if</span>&nbsp;<span class="ident" id="7017787">g</span><span class="op" id="7017788">,</span>&nbsp;<span class="ident" id="7017790">e</span>&nbsp;<span class="op" id="7017792">:=</span>&nbsp;<span class="builtintype" id="7017795">string</span><span class="op" id="7017801">(</span><span class="ident" id="7017802">data</span><span class="op" id="7017806">)</span><span class="op" id="7017807">,</span>&nbsp;<span class="ident" id="7017809">chunk1</span><span class="op" id="7017815">+</span><span class="ident" id="7017816">chunk2</span><span class="op" id="7017822">;</span>&nbsp;<span class="ident" id="7017824">g</span>&nbsp;<span class="op" id="7017826">!=</span>&nbsp;<span class="ident" id="7017829">e</span>&nbsp;<span class="op" id="7017831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017835">t</span><span class="op" id="7017836">.</span><span class="ident" id="7017837">Errorf</span><span class="op" id="7017843">(</span><span class="string" id="7017844">&#34;chunk&nbsp;reader&nbsp;read&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7017875">,</span>&nbsp;<span class="ident" id="7017877">g</span><span class="op" id="7017878">,</span>&nbsp;<span class="ident" id="7017880">e</span><span class="op" id="7017881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7017884">}</span><br>
<span class="lineno">40</span><span class="op" id="7017886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7017889">func</span>&nbsp;<span class="ident" id="7017894">TestChunkReadMultiple</span><span class="op" id="7017915">(</span><span class="ident" id="7017916">t</span>&nbsp;<span class="op" id="7017918">*</span><span class="ident" id="7017919">testing</span><span class="op" id="7017926">.</span><span class="ident" id="7017927">T</span><span class="op" id="7017928">)</span>&nbsp;<span class="op" id="7017930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7017933">//&nbsp;Bunch&nbsp;of&nbsp;small&nbsp;chunks,&nbsp;all&nbsp;read&nbsp;together.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7017979">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017983">var</span>&nbsp;<span class="ident" id="7017987">b</span>&nbsp;<span class="ident" id="7017989">bytes</span><span class="op" id="7017994">.</span><span class="ident" id="7017995">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018004">w</span>&nbsp;<span class="op" id="7018006">:=</span>&nbsp;<span class="ident" id="7018009">NewChunkedWriter</span><span class="op" id="7018025">(</span><span class="op" id="7018026">&amp;</span><span class="ident" id="7018027">b</span><span class="op" id="7018028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018032">w</span><span class="op" id="7018033">.</span><span class="ident" id="7018034">Write</span><span class="op" id="7018039">(</span><span class="op" id="7018040">[</span><span class="op" id="7018041">]</span><span class="builtintype" id="7018042">byte</span><span class="op" id="7018046">(</span><span class="string" id="7018047">&#34;foo&#34;</span><span class="op" id="7018052">)</span><span class="op" id="7018053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018057">w</span><span class="op" id="7018058">.</span><span class="ident" id="7018059">Write</span><span class="op" id="7018064">(</span><span class="op" id="7018065">[</span><span class="op" id="7018066">]</span><span class="builtintype" id="7018067">byte</span><span class="op" id="7018071">(</span><span class="string" id="7018072">&#34;bar&#34;</span><span class="op" id="7018077">)</span><span class="op" id="7018078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018082">w</span><span class="op" id="7018083">.</span><span class="ident" id="7018084">Close</span><span class="op" id="7018089">(</span><span class="op" id="7018090">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018095">r</span>&nbsp;<span class="op" id="7018097">:=</span>&nbsp;<span class="ident" id="7018100">NewChunkedReader</span><span class="op" id="7018116">(</span><span class="op" id="7018117">&amp;</span><span class="ident" id="7018118">b</span><span class="op" id="7018119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018123">buf</span>&nbsp;<span class="op" id="7018127">:=</span>&nbsp;<span class="builtinfunc" id="7018130">make</span><span class="op" id="7018134">(</span><span class="op" id="7018135">[</span><span class="op" id="7018136">]</span><span class="builtintype" id="7018137">byte</span><span class="op" id="7018141">,</span>&nbsp;<span class="num" id="7018143">10</span><span class="op" id="7018145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018149">n</span><span class="op" id="7018150">,</span>&nbsp;<span class="ident" id="7018152">err</span>&nbsp;<span class="op" id="7018156">:=</span>&nbsp;<span class="ident" id="7018159">r</span><span class="op" id="7018160">.</span><span class="ident" id="7018161">Read</span><span class="op" id="7018165">(</span><span class="ident" id="7018166">buf</span><span class="op" id="7018169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7018173">if</span>&nbsp;<span class="ident" id="7018176">n</span>&nbsp;<span class="op" id="7018178">!=</span>&nbsp;<span class="num" id="7018181">6</span>&nbsp;<span class="op" id="7018183">||</span>&nbsp;<span class="ident" id="7018186">err</span>&nbsp;<span class="op" id="7018190">!=</span>&nbsp;<span class="ident" id="7018193">io</span><span class="op" id="7018195">.</span><span class="ident" id="7018196">EOF</span>&nbsp;<span class="op" id="7018200">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018205">t</span><span class="op" id="7018206">.</span><span class="ident" id="7018207">Errorf</span><span class="op" id="7018213">(</span><span class="string" id="7018214">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;6,&nbsp;EOF&#34;</span><span class="op" id="7018242">,</span>&nbsp;<span class="ident" id="7018244">n</span><span class="op" id="7018245">,</span>&nbsp;<span class="ident" id="7018247">err</span><span class="op" id="7018250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018258">buf</span>&nbsp;<span class="op" id="7018262">=</span>&nbsp;<span class="ident" id="7018264">buf</span><span class="op" id="7018267">[</span><span class="op" id="7018268">:</span><span class="ident" id="7018269">n</span><span class="op" id="7018270">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7018274">if</span>&nbsp;<span class="builtintype" id="7018277">string</span><span class="op" id="7018283">(</span><span class="ident" id="7018284">buf</span><span class="op" id="7018287">)</span>&nbsp;<span class="op" id="7018289">!=</span>&nbsp;<span class="string" id="7018292">&#34;foobar&#34;</span>&nbsp;<span class="op" id="7018301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018306">t</span><span class="op" id="7018307">.</span><span class="ident" id="7018308">Errorf</span><span class="op" id="7018314">(</span><span class="string" id="7018315">&#34;Read&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7018335">,</span>&nbsp;<span class="ident" id="7018337">buf</span><span class="op" id="7018340">,</span>&nbsp;<span class="string" id="7018342">&#34;foobar&#34;</span><span class="op" id="7018350">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7018361">//&nbsp;One&nbsp;big&nbsp;chunk&nbsp;followed&nbsp;by&nbsp;a&nbsp;little&nbsp;chunk,&nbsp;but&nbsp;the&nbsp;small&nbsp;bufio.Reader&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7018439">//&nbsp;should&nbsp;prevent&nbsp;the&nbsp;second&nbsp;chunk&nbsp;header&nbsp;from&nbsp;being&nbsp;read.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7018503">var</span>&nbsp;<span class="ident" id="7018507">b</span>&nbsp;<span class="ident" id="7018509">bytes</span><span class="op" id="7018514">.</span><span class="ident" id="7018515">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018524">w</span>&nbsp;<span class="op" id="7018526">:=</span>&nbsp;<span class="ident" id="7018529">NewChunkedWriter</span><span class="op" id="7018545">(</span><span class="op" id="7018546">&amp;</span><span class="ident" id="7018547">b</span><span class="op" id="7018548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7018552">//&nbsp;fillBufChunk&nbsp;is&nbsp;11&nbsp;bytes&nbsp;+&nbsp;3&nbsp;bytes&nbsp;header&nbsp;+&nbsp;2&nbsp;bytes&nbsp;footer&nbsp;=&nbsp;16&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7018628">//&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;bufio&nbsp;ReaderSize&nbsp;below&nbsp;(the&nbsp;minimum),&nbsp;so&nbsp;even</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7018695">//&nbsp;though&nbsp;we&#39;re&nbsp;going&nbsp;to&nbsp;try&nbsp;to&nbsp;Read&nbsp;with&nbsp;a&nbsp;buffer&nbsp;larger&nbsp;enough&nbsp;to&nbsp;also</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7018770">//&nbsp;receive&nbsp;&#34;foo&#34;,&nbsp;the&nbsp;second&nbsp;chunk&nbsp;header&nbsp;won&#39;t&nbsp;be&nbsp;read&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7018833">const</span>&nbsp;<span class="ident" id="7018839">fillBufChunk</span>&nbsp;<span class="op" id="7018852">=</span>&nbsp;<span class="string" id="7018854">&#34;0123456789a&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7018870">const</span>&nbsp;<span class="ident" id="7018876">shortChunk</span>&nbsp;<span class="op" id="7018887">=</span>&nbsp;<span class="string" id="7018889">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018897">w</span><span class="op" id="7018898">.</span><span class="ident" id="7018899">Write</span><span class="op" id="7018904">(</span><span class="op" id="7018905">[</span><span class="op" id="7018906">]</span><span class="builtintype" id="7018907">byte</span><span class="op" id="7018911">(</span><span class="ident" id="7018912">fillBufChunk</span><span class="op" id="7018924">)</span><span class="op" id="7018925">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018929">w</span><span class="op" id="7018930">.</span><span class="ident" id="7018931">Write</span><span class="op" id="7018936">(</span><span class="op" id="7018937">[</span><span class="op" id="7018938">]</span><span class="builtintype" id="7018939">byte</span><span class="op" id="7018943">(</span><span class="ident" id="7018944">shortChunk</span><span class="op" id="7018954">)</span><span class="op" id="7018955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018959">w</span><span class="op" id="7018960">.</span><span class="ident" id="7018961">Close</span><span class="op" id="7018966">(</span><span class="op" id="7018967">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018972">r</span>&nbsp;<span class="op" id="7018974">:=</span>&nbsp;<span class="ident" id="7018977">NewChunkedReader</span><span class="op" id="7018993">(</span><span class="ident" id="7018994">bufio</span><span class="op" id="7018999">.</span><span class="ident" id="7019000">NewReaderSize</span><span class="op" id="7019013">(</span><span class="op" id="7019014">&amp;</span><span class="ident" id="7019015">b</span><span class="op" id="7019016">,</span>&nbsp;<span class="num" id="7019018">16</span><span class="op" id="7019020">)</span><span class="op" id="7019021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019025">buf</span>&nbsp;<span class="op" id="7019029">:=</span>&nbsp;<span class="builtinfunc" id="7019032">make</span><span class="op" id="7019036">(</span><span class="op" id="7019037">[</span><span class="op" id="7019038">]</span><span class="builtintype" id="7019039">byte</span><span class="op" id="7019043">,</span>&nbsp;<span class="builtinfunc" id="7019045">len</span><span class="op" id="7019048">(</span><span class="ident" id="7019049">fillBufChunk</span><span class="op" id="7019061">)</span><span class="op" id="7019062">+</span><span class="builtinfunc" id="7019063">len</span><span class="op" id="7019066">(</span><span class="ident" id="7019067">shortChunk</span><span class="op" id="7019077">)</span><span class="op" id="7019078">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019082">n</span><span class="op" id="7019083">,</span>&nbsp;<span class="ident" id="7019085">err</span>&nbsp;<span class="op" id="7019089">:=</span>&nbsp;<span class="ident" id="7019092">r</span><span class="op" id="7019093">.</span><span class="ident" id="7019094">Read</span><span class="op" id="7019098">(</span><span class="ident" id="7019099">buf</span><span class="op" id="7019102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019106">if</span>&nbsp;<span class="ident" id="7019109">n</span>&nbsp;<span class="op" id="7019111">!=</span>&nbsp;<span class="builtinfunc" id="7019114">len</span><span class="op" id="7019117">(</span><span class="ident" id="7019118">fillBufChunk</span><span class="op" id="7019130">)</span>&nbsp;<span class="op" id="7019132">||</span>&nbsp;<span class="ident" id="7019135">err</span>&nbsp;<span class="op" id="7019139">!=</span>&nbsp;<span class="ident" id="7019142">nil</span>&nbsp;<span class="op" id="7019146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019151">t</span><span class="op" id="7019152">.</span><span class="ident" id="7019153">Errorf</span><span class="op" id="7019159">(</span><span class="string" id="7019160">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7019189">,</span>&nbsp;<span class="ident" id="7019191">n</span><span class="op" id="7019192">,</span>&nbsp;<span class="ident" id="7019194">err</span><span class="op" id="7019197">,</span>&nbsp;<span class="builtinfunc" id="7019199">len</span><span class="op" id="7019202">(</span><span class="ident" id="7019203">fillBufChunk</span><span class="op" id="7019215">)</span><span class="op" id="7019216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019224">buf</span>&nbsp;<span class="op" id="7019228">=</span>&nbsp;<span class="ident" id="7019230">buf</span><span class="op" id="7019233">[</span><span class="op" id="7019234">:</span><span class="ident" id="7019235">n</span><span class="op" id="7019236">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019240">if</span>&nbsp;<span class="builtintype" id="7019243">string</span><span class="op" id="7019249">(</span><span class="ident" id="7019250">buf</span><span class="op" id="7019253">)</span>&nbsp;<span class="op" id="7019255">!=</span>&nbsp;<span class="ident" id="7019258">fillBufChunk</span>&nbsp;<span class="op" id="7019271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019276">t</span><span class="op" id="7019277">.</span><span class="ident" id="7019278">Errorf</span><span class="op" id="7019284">(</span><span class="string" id="7019285">&#34;Read&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7019305">,</span>&nbsp;<span class="ident" id="7019307">buf</span><span class="op" id="7019310">,</span>&nbsp;<span class="ident" id="7019312">fillBufChunk</span><span class="op" id="7019324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019333">n</span><span class="op" id="7019334">,</span>&nbsp;<span class="ident" id="7019336">err</span>&nbsp;<span class="op" id="7019340">=</span>&nbsp;<span class="ident" id="7019342">r</span><span class="op" id="7019343">.</span><span class="ident" id="7019344">Read</span><span class="op" id="7019348">(</span><span class="ident" id="7019349">buf</span><span class="op" id="7019352">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019356">if</span>&nbsp;<span class="ident" id="7019359">n</span>&nbsp;<span class="op" id="7019361">!=</span>&nbsp;<span class="builtinfunc" id="7019364">len</span><span class="op" id="7019367">(</span><span class="ident" id="7019368">shortChunk</span><span class="op" id="7019378">)</span>&nbsp;<span class="op" id="7019380">||</span>&nbsp;<span class="ident" id="7019383">err</span>&nbsp;<span class="op" id="7019387">!=</span>&nbsp;<span class="ident" id="7019390">io</span><span class="op" id="7019392">.</span><span class="ident" id="7019393">EOF</span>&nbsp;<span class="op" id="7019397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019402">t</span><span class="op" id="7019403">.</span><span class="ident" id="7019404">Errorf</span><span class="op" id="7019410">(</span><span class="string" id="7019411">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;EOF&#34;</span><span class="op" id="7019440">,</span>&nbsp;<span class="ident" id="7019442">n</span><span class="op" id="7019443">,</span>&nbsp;<span class="ident" id="7019445">err</span><span class="op" id="7019448">,</span>&nbsp;<span class="builtinfunc" id="7019450">len</span><span class="op" id="7019453">(</span><span class="ident" id="7019454">shortChunk</span><span class="op" id="7019464">)</span><span class="op" id="7019465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7019476">//&nbsp;And&nbsp;test&nbsp;that&nbsp;we&nbsp;see&nbsp;an&nbsp;EOF&nbsp;chunk,&nbsp;even&nbsp;though&nbsp;our&nbsp;buffer&nbsp;is&nbsp;already&nbsp;full:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019559">r</span>&nbsp;<span class="op" id="7019561">:=</span>&nbsp;<span class="ident" id="7019564">NewChunkedReader</span><span class="op" id="7019580">(</span><span class="ident" id="7019581">bufio</span><span class="op" id="7019586">.</span><span class="ident" id="7019587">NewReader</span><span class="op" id="7019596">(</span><span class="ident" id="7019597">strings</span><span class="op" id="7019604">.</span><span class="ident" id="7019605">NewReader</span><span class="op" id="7019614">(</span><span class="string" id="7019615">&#34;3\r\nfoo\r\n0\r\n&#34;</span><span class="op" id="7019634">)</span><span class="op" id="7019635">)</span><span class="op" id="7019636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019640">buf</span>&nbsp;<span class="op" id="7019644">:=</span>&nbsp;<span class="builtinfunc" id="7019647">make</span><span class="op" id="7019651">(</span><span class="op" id="7019652">[</span><span class="op" id="7019653">]</span><span class="builtintype" id="7019654">byte</span><span class="op" id="7019658">,</span>&nbsp;<span class="num" id="7019660">3</span><span class="op" id="7019661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019665">n</span><span class="op" id="7019666">,</span>&nbsp;<span class="ident" id="7019668">err</span>&nbsp;<span class="op" id="7019672">:=</span>&nbsp;<span class="ident" id="7019675">r</span><span class="op" id="7019676">.</span><span class="ident" id="7019677">Read</span><span class="op" id="7019681">(</span><span class="ident" id="7019682">buf</span><span class="op" id="7019685">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019689">if</span>&nbsp;<span class="ident" id="7019692">n</span>&nbsp;<span class="op" id="7019694">!=</span>&nbsp;<span class="num" id="7019697">3</span>&nbsp;<span class="op" id="7019699">||</span>&nbsp;<span class="ident" id="7019702">err</span>&nbsp;<span class="op" id="7019706">!=</span>&nbsp;<span class="ident" id="7019709">io</span><span class="op" id="7019711">.</span><span class="ident" id="7019712">EOF</span>&nbsp;<span class="op" id="7019716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019721">t</span><span class="op" id="7019722">.</span><span class="ident" id="7019723">Errorf</span><span class="op" id="7019729">(</span><span class="string" id="7019730">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;3,&nbsp;EOF&#34;</span><span class="op" id="7019758">,</span>&nbsp;<span class="ident" id="7019760">n</span><span class="op" id="7019761">,</span>&nbsp;<span class="ident" id="7019763">err</span><span class="op" id="7019766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019774">if</span>&nbsp;<span class="builtintype" id="7019777">string</span><span class="op" id="7019783">(</span><span class="ident" id="7019784">buf</span><span class="op" id="7019787">)</span>&nbsp;<span class="op" id="7019789">!=</span>&nbsp;<span class="string" id="7019792">&#34;foo&#34;</span>&nbsp;<span class="op" id="7019798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019803">t</span><span class="op" id="7019804">.</span><span class="ident" id="7019805">Errorf</span><span class="op" id="7019811">(</span><span class="string" id="7019812">&#34;buf&nbsp;=&nbsp;%q;&nbsp;want&nbsp;foo&#34;</span><span class="op" id="7019832">,</span>&nbsp;<span class="ident" id="7019834">buf</span><span class="op" id="7019837">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019844">}</span><br>
<span class="lineno"></span><span class="op" id="7019846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7019849">func</span>&nbsp;<span class="ident" id="7019854">TestChunkReaderAllocs</span><span class="op" id="7019875">(</span><span class="ident" id="7019876">t</span>&nbsp;<span class="op" id="7019878">*</span><span class="ident" id="7019879">testing</span><span class="op" id="7019886">.</span><span class="ident" id="7019887">T</span><span class="op" id="7019888">)</span>&nbsp;<span class="op" id="7019890">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019893">if</span>&nbsp;<span class="ident" id="7019896">testing</span><span class="op" id="7019903">.</span><span class="ident" id="7019904">Short</span><span class="op" id="7019909">(</span><span class="op" id="7019910">)</span>&nbsp;<span class="op" id="7019912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019916">t</span><span class="op" id="7019917">.</span><span class="ident" id="7019918">Skip</span><span class="op" id="7019922">(</span><span class="string" id="7019923">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7019947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019953">var</span>&nbsp;<span class="ident" id="7019957">buf</span>&nbsp;<span class="ident" id="7019961">bytes</span><span class="op" id="7019966">.</span><span class="ident" id="7019967">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019975">w</span>&nbsp;<span class="op" id="7019977">:=</span>&nbsp;<span class="ident" id="7019980">NewChunkedWriter</span><span class="op" id="7019996">(</span><span class="op" id="7019997">&amp;</span><span class="ident" id="7019998">buf</span><span class="op" id="7020001">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020004">a</span><span class="op" id="7020005">,</span>&nbsp;<span class="ident" id="7020007">b</span><span class="op" id="7020008">,</span>&nbsp;<span class="ident" id="7020010">c</span>&nbsp;<span class="op" id="7020012">:=</span>&nbsp;<span class="op" id="7020015">[</span><span class="op" id="7020016">]</span><span class="builtintype" id="7020017">byte</span><span class="op" id="7020021">(</span><span class="string" id="7020022">&#34;aaaaaa&#34;</span><span class="op" id="7020030">)</span><span class="op" id="7020031">,</span>&nbsp;<span class="op" id="7020033">[</span><span class="op" id="7020034">]</span><span class="builtintype" id="7020035">byte</span><span class="op" id="7020039">(</span><span class="string" id="7020040">&#34;bbbbbbbbbbbb&#34;</span><span class="op" id="7020054">)</span><span class="op" id="7020055">,</span>&nbsp;<span class="op" id="7020057">[</span><span class="op" id="7020058">]</span><span class="builtintype" id="7020059">byte</span><span class="op" id="7020063">(</span><span class="string" id="7020064">&#34;cccccccccccccccccccccccc&#34;</span><span class="op" id="7020090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020093">w</span><span class="op" id="7020094">.</span><span class="ident" id="7020095">Write</span><span class="op" id="7020100">(</span><span class="ident" id="7020101">a</span><span class="op" id="7020102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020105">w</span><span class="op" id="7020106">.</span><span class="ident" id="7020107">Write</span><span class="op" id="7020112">(</span><span class="ident" id="7020113">b</span><span class="op" id="7020114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020117">w</span><span class="op" id="7020118">.</span><span class="ident" id="7020119">Write</span><span class="op" id="7020124">(</span><span class="ident" id="7020125">c</span><span class="op" id="7020126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020129">w</span><span class="op" id="7020130">.</span><span class="ident" id="7020131">Close</span><span class="op" id="7020136">(</span><span class="op" id="7020137">)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020141">readBuf</span>&nbsp;<span class="op" id="7020149">:=</span>&nbsp;<span class="builtinfunc" id="7020152">make</span><span class="op" id="7020156">(</span><span class="op" id="7020157">[</span><span class="op" id="7020158">]</span><span class="builtintype" id="7020159">byte</span><span class="op" id="7020163">,</span>&nbsp;<span class="builtinfunc" id="7020165">len</span><span class="op" id="7020168">(</span><span class="ident" id="7020169">a</span><span class="op" id="7020170">)</span><span class="op" id="7020171">+</span><span class="builtinfunc" id="7020172">len</span><span class="op" id="7020175">(</span><span class="ident" id="7020176">b</span><span class="op" id="7020177">)</span><span class="op" id="7020178">+</span><span class="builtinfunc" id="7020179">len</span><span class="op" id="7020182">(</span><span class="ident" id="7020183">c</span><span class="op" id="7020184">)</span><span class="op" id="7020185">+</span><span class="num" id="7020186">1</span><span class="op" id="7020187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020190">byter</span>&nbsp;<span class="op" id="7020196">:=</span>&nbsp;<span class="ident" id="7020199">bytes</span><span class="op" id="7020204">.</span><span class="ident" id="7020205">NewReader</span><span class="op" id="7020214">(</span><span class="ident" id="7020215">buf</span><span class="op" id="7020218">.</span><span class="ident" id="7020219">Bytes</span><span class="op" id="7020224">(</span><span class="op" id="7020225">)</span><span class="op" id="7020226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020229">bufr</span>&nbsp;<span class="op" id="7020234">:=</span>&nbsp;<span class="ident" id="7020237">bufio</span><span class="op" id="7020242">.</span><span class="ident" id="7020243">NewReader</span><span class="op" id="7020252">(</span><span class="ident" id="7020253">byter</span><span class="op" id="7020258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020261">mallocs</span>&nbsp;<span class="op" id="7020269">:=</span>&nbsp;<span class="ident" id="7020272">testing</span><span class="op" id="7020279">.</span><span class="ident" id="7020280">AllocsPerRun</span><span class="op" id="7020292">(</span><span class="num" id="7020293">100</span><span class="op" id="7020296">,</span>&nbsp;<span class="keyword" id="7020298">func</span><span class="op" id="7020302">(</span><span class="op" id="7020303">)</span>&nbsp;<span class="op" id="7020305">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020309">byter</span><span class="op" id="7020314">.</span><span class="ident" id="7020315">Seek</span><span class="op" id="7020319">(</span><span class="num" id="7020320">0</span><span class="op" id="7020321">,</span>&nbsp;<span class="num" id="7020323">0</span><span class="op" id="7020324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020328">bufr</span><span class="op" id="7020332">.</span><span class="ident" id="7020333">Reset</span><span class="op" id="7020338">(</span><span class="ident" id="7020339">byter</span><span class="op" id="7020344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020348">r</span>&nbsp;<span class="op" id="7020350">:=</span>&nbsp;<span class="ident" id="7020353">NewChunkedReader</span><span class="op" id="7020369">(</span><span class="ident" id="7020370">bufr</span><span class="op" id="7020374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020378">n</span><span class="op" id="7020379">,</span>&nbsp;<span class="ident" id="7020381">err</span>&nbsp;<span class="op" id="7020385">:=</span>&nbsp;<span class="ident" id="7020388">io</span><span class="op" id="7020390">.</span><span class="ident" id="7020391">ReadFull</span><span class="op" id="7020399">(</span><span class="ident" id="7020400">r</span><span class="op" id="7020401">,</span>&nbsp;<span class="ident" id="7020403">readBuf</span><span class="op" id="7020410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020414">if</span>&nbsp;<span class="ident" id="7020417">n</span>&nbsp;<span class="op" id="7020419">!=</span>&nbsp;<span class="builtinfunc" id="7020422">len</span><span class="op" id="7020425">(</span><span class="ident" id="7020426">readBuf</span><span class="op" id="7020433">)</span><span class="op" id="7020434">-</span><span class="num" id="7020435">1</span>&nbsp;<span class="op" id="7020437">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020442">t</span><span class="op" id="7020443">.</span><span class="ident" id="7020444">Fatalf</span><span class="op" id="7020450">(</span><span class="string" id="7020451">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7020475">,</span>&nbsp;<span class="ident" id="7020477">n</span><span class="op" id="7020478">,</span>&nbsp;<span class="builtinfunc" id="7020480">len</span><span class="op" id="7020483">(</span><span class="ident" id="7020484">readBuf</span><span class="op" id="7020491">)</span><span class="op" id="7020492">-</span><span class="num" id="7020493">1</span><span class="op" id="7020494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020502">if</span>&nbsp;<span class="ident" id="7020505">err</span>&nbsp;<span class="op" id="7020509">!=</span>&nbsp;<span class="ident" id="7020512">io</span><span class="op" id="7020514">.</span><span class="ident" id="7020515">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7020532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020537">t</span><span class="op" id="7020538">.</span><span class="ident" id="7020539">Fatalf</span><span class="op" id="7020545">(</span><span class="string" id="7020546">&#34;read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;ErrUnexpectedEOF&#34;</span><span class="op" id="7020586">,</span>&nbsp;<span class="ident" id="7020588">err</span><span class="op" id="7020591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020595">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020598">}</span><span class="op" id="7020599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020602">if</span>&nbsp;<span class="ident" id="7020605">mallocs</span>&nbsp;<span class="op" id="7020613">&gt;</span>&nbsp;<span class="num" id="7020615">1.5</span>&nbsp;<span class="op" id="7020619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020623">t</span><span class="op" id="7020624">.</span><span class="ident" id="7020625">Errorf</span><span class="op" id="7020631">(</span><span class="string" id="7020632">&#34;mallocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7020654">,</span>&nbsp;<span class="ident" id="7020656">mallocs</span><span class="op" id="7020663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020666">}</span><br>
<span class="lineno"></span><span class="op" id="7020668">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="7020671">func</span>&nbsp;<span class="ident" id="7020676">TestParseHexUint</span><span class="op" id="7020692">(</span><span class="ident" id="7020693">t</span>&nbsp;<span class="op" id="7020695">*</span><span class="ident" id="7020696">testing</span><span class="op" id="7020703">.</span><span class="ident" id="7020704">T</span><span class="op" id="7020705">)</span>&nbsp;<span class="op" id="7020707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020710">for</span>&nbsp;<span class="ident" id="7020714">i</span>&nbsp;<span class="op" id="7020716">:=</span>&nbsp;<span class="ident" id="7020719">uint64</span><span class="op" id="7020725">(</span><span class="num" id="7020726">0</span><span class="op" id="7020727">)</span><span class="op" id="7020728">;</span>&nbsp;<span class="ident" id="7020730">i</span>&nbsp;<span class="op" id="7020732">&lt;=</span>&nbsp;<span class="num" id="7020735">1234</span><span class="op" id="7020739">;</span>&nbsp;<span class="ident" id="7020741">i</span><span class="op" id="7020742">++</span>&nbsp;<span class="op" id="7020745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020749">line</span>&nbsp;<span class="op" id="7020754">:=</span>&nbsp;<span class="op" id="7020757">[</span><span class="op" id="7020758">]</span><span class="builtintype" id="7020759">byte</span><span class="op" id="7020763">(</span><span class="ident" id="7020764">fmt</span><span class="op" id="7020767">.</span><span class="ident" id="7020768">Sprintf</span><span class="op" id="7020775">(</span><span class="string" id="7020776">&#34;%x&#34;</span><span class="op" id="7020780">,</span>&nbsp;<span class="ident" id="7020782">i</span><span class="op" id="7020783">)</span><span class="op" id="7020784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020788">got</span><span class="op" id="7020791">,</span>&nbsp;<span class="ident" id="7020793">err</span>&nbsp;<span class="op" id="7020797">:=</span>&nbsp;<span class="ident" id="7020800">parseHexUint</span><span class="op" id="7020812">(</span><span class="ident" id="7020813">line</span><span class="op" id="7020817">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020821">if</span>&nbsp;<span class="ident" id="7020824">err</span>&nbsp;<span class="op" id="7020828">!=</span>&nbsp;<span class="ident" id="7020831">nil</span>&nbsp;<span class="op" id="7020835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020840">t</span><span class="op" id="7020841">.</span><span class="ident" id="7020842">Fatalf</span><span class="op" id="7020848">(</span><span class="string" id="7020849">&#34;on&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7020860">,</span>&nbsp;<span class="ident" id="7020862">i</span><span class="op" id="7020863">,</span>&nbsp;<span class="ident" id="7020865">err</span><span class="op" id="7020868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020876">if</span>&nbsp;<span class="ident" id="7020879">got</span>&nbsp;<span class="op" id="7020883">!=</span>&nbsp;<span class="ident" id="7020886">i</span>&nbsp;<span class="op" id="7020888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020893">t</span><span class="op" id="7020894">.</span><span class="ident" id="7020895">Errorf</span><span class="op" id="7020901">(</span><span class="string" id="7020902">&#34;for&nbsp;input&nbsp;%q&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7020930">,</span>&nbsp;<span class="ident" id="7020932">line</span><span class="op" id="7020936">,</span>&nbsp;<span class="ident" id="7020938">got</span><span class="op" id="7020941">,</span>&nbsp;<span class="ident" id="7020943">i</span><span class="op" id="7020944">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020954">_</span><span class="op" id="7020955">,</span>&nbsp;<span class="ident" id="7020957">err</span>&nbsp;<span class="op" id="7020961">:=</span>&nbsp;<span class="ident" id="7020964">parseHexUint</span><span class="op" id="7020976">(</span><span class="op" id="7020977">[</span><span class="op" id="7020978">]</span><span class="builtintype" id="7020979">byte</span><span class="op" id="7020983">(</span><span class="string" id="7020984">&#34;bogus&#34;</span><span class="op" id="7020991">)</span><span class="op" id="7020992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020995">if</span>&nbsp;<span class="ident" id="7020998">err</span>&nbsp;<span class="op" id="7021002">==</span>&nbsp;<span class="ident" id="7021005">nil</span>&nbsp;<span class="op" id="7021009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021013">t</span><span class="op" id="7021014">.</span><span class="ident" id="7021015">Error</span><span class="op" id="7021020">(</span><span class="string" id="7021021">&#34;expected&nbsp;error&nbsp;on&nbsp;bogus&nbsp;input&#34;</span><span class="op" id="7021052">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021055">}</span><br>
<span class="lineno"></span><span class="op" id="7021057">}</span>
</div>
</body>
</html>
