<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html" class="current">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6554820">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6554875">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6554929">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6554980">package</span>&nbsp;<span class="ident" id="6554988">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6554993">import</span>&nbsp;<span class="op" id="6555000">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6555003">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6555012">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6555019">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6555025">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6555032">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6555043">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6555054">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6555061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6555064">var</span>&nbsp;<span class="ident" id="6555068">rsaCertPEM</span>&nbsp;<span class="op" id="6555079">=</span>&nbsp;<span class="string" id="6555081">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB0zCCAX2gAwIBAgIJAI/M7BYjwB+uMA0GCSqGSIb3DQEBBQUAMEUxCzAJBgNV<br>
<span class="lineno"></span>BAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBX<br>
<span class="lineno">20</span>aWRnaXRzIFB0eSBMdGQwHhcNMTIwOTEyMjE1MjAyWhcNMTUwOTEyMjE1MjAyWjBF<br>
<span class="lineno"></span>MQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwYSW50<br>
<span class="lineno"></span>ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBANLJ<br>
<span class="lineno"></span>hPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wok/4xIA+ui35/MmNa<br>
<span class="lineno"></span>rtNuC+BdZ1tMuVCPFZcCAwEAAaNQME4wHQYDVR0OBBYEFJvKs8RfJaXTH08W+SGv<br>
<span class="lineno">25</span>zQyKn0H8MB8GA1UdIwQYMBaAFJvKs8RfJaXTH08W+SGvzQyKn0H8MAwGA1UdEwQF<br>
<span class="lineno"></span>MAMBAf8wDQYJKoZIhvcNAQEFBQADQQBJlffJHybjDGxRMqaRmDhX0+6v02TUKZsW<br>
<span class="lineno"></span>r5QuVbpQhH6u+0UgcW0jp9QwpxoPTLTWGXEWBBBurxFwiCBhkQ+V<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="6555777">var</span>&nbsp;<span class="ident" id="6555781">rsaKeyPEM</span>&nbsp;<span class="op" id="6555791">=</span>&nbsp;<span class="string" id="6555793">`-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno">35</span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno"></span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">40</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6556294">//&nbsp;keyPEM&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;rsaKeyPEM,&nbsp;but&nbsp;declares&nbsp;itself&nbsp;as&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="6556358">//&nbsp;&#34;PRIVATE&nbsp;KEY&#34;,&nbsp;not&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;.&nbsp;&nbsp;http://golang.org/issue/4477</span><br>
<span class="lineno"></span><span class="keyword" id="6556429">var</span>&nbsp;<span class="ident" id="6556433">keyPEM</span>&nbsp;<span class="op" id="6556440">=</span>&nbsp;<span class="string" id="6556442">`-----BEGIN&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">45</span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno"></span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno">50</span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6556935">var</span>&nbsp;<span class="ident" id="6556939">ecdsaCertPEM</span>&nbsp;<span class="op" id="6556952">=</span>&nbsp;<span class="string" id="6556954">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/jCCAWICCQDscdUxw16XFDAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTI0MDQ4WhcNMTUxMTE0MTI0MDQ4WjBFMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTETMBEGA1UECBMKU29tZS1TdGF0ZTEhMB8GA1UEChMYSW50ZXJuZXQgV2lk<br>
<span class="lineno">60</span>Z2l0cyBQdHkgTHRkMIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQBY9+my9OoeSUR<br>
<span class="lineno"></span>lDQdV/x8LsOuLilthhiS1Tz4aGDHIPwC1mlvnf7fg5lecYpMCrLLhauAc1UJXcgl<br>
<span class="lineno"></span>01xoLuzgtAEAgv2P/jgytzRSpUYvgLBt1UA0leLYBy6mQQbrNEuqT3INapKIcUv8<br>
<span class="lineno"></span>XxYP0xMEUksLPq6Ca+CRSqTtrd/23uTnapkwCQYHKoZIzj0EAQOBigAwgYYCQXJo<br>
<span class="lineno"></span>A7Sl2nLVf+4Iu/tAX/IF4MavARKC4PPHK3zfuGfPR3oCCcsAoz3kAzOeijvd0iXb<br>
<span class="lineno">65</span>H5jBImIxPL4WxQNiBTexAkF8D1EtpYuWdlVQ80/h/f4pBcGiXPqX5h2PQSQY7hP1<br>
<span class="lineno"></span>+jwM1FGS4fREIOvlBYr/SzzQRtwrvrzGYxDEDbsC0ZGRnA==<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="6557711">var</span>&nbsp;<span class="ident" id="6557715">ecdsaKeyPEM</span>&nbsp;<span class="op" id="6557727">=</span>&nbsp;<span class="string" id="6557729">`-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBrsoKp0oqcv6/JovJJDoDVSGWdirrkgCWxrprGlzB9o0X8fV675X0<br>
<span class="lineno">75</span>NwuBenXFfeZvVcwluO7/Q9wkYoPd/t3jGImgBwYFK4EEACOhgYkDgYYABAFj36bL<br>
<span class="lineno"></span>06h5JRGUNB1X/Hwuw64uKW2GGJLVPPhoYMcg/ALWaW+d/t+DmV5xikwKssuFq4Bz<br>
<span class="lineno"></span>VQldyCXTXGgu7OC0AQCC/Y/+ODK3NFKlRi+AsG3VQDSV4tgHLqZBBus0S6pPcg1q<br>
<span class="lineno"></span>kohxS/xfFg/TEwRSSws+roJr4JFKpO2t3/be5OdqmQ==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">80</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6558169">var</span>&nbsp;<span class="ident" id="6558173">keyPairTests</span>&nbsp;<span class="op" id="6558186">=</span>&nbsp;<span class="op" id="6558188">[</span><span class="op" id="6558189">]</span><span class="keyword" id="6558190">struct</span>&nbsp;<span class="op" id="6558197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6558200">algo</span>&nbsp;<span class="builtintype" id="6558205">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6558213">cert</span>&nbsp;<span class="builtintype" id="6558218">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6558226">key</span>&nbsp;&nbsp;<span class="builtintype" id="6558231">string</span><br>
<span class="lineno"></span><span class="op" id="6558238">}</span><span class="op" id="6558239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6558242">{</span><span class="string" id="6558243">&#34;ECDSA&#34;</span><span class="op" id="6558250">,</span>&nbsp;<span class="ident" id="6558252">ecdsaCertPEM</span><span class="op" id="6558264">,</span>&nbsp;<span class="ident" id="6558266">ecdsaKeyPEM</span><span class="op" id="6558277">}</span><span class="op" id="6558278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6558281">{</span><span class="string" id="6558282">&#34;RSA&#34;</span><span class="op" id="6558287">,</span>&nbsp;<span class="ident" id="6558289">rsaCertPEM</span><span class="op" id="6558299">,</span>&nbsp;<span class="ident" id="6558301">rsaKeyPEM</span><span class="op" id="6558310">}</span><span class="op" id="6558311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6558314">{</span><span class="string" id="6558315">&#34;RSA-untyped&#34;</span><span class="op" id="6558328">,</span>&nbsp;<span class="ident" id="6558330">rsaCertPEM</span><span class="op" id="6558340">,</span>&nbsp;<span class="ident" id="6558342">keyPEM</span><span class="op" id="6558348">}</span><span class="op" id="6558349">,</span>&nbsp;<span class="comment" id="6558351">//&nbsp;golang.org/issue/4477</span><br>
<span class="lineno">90</span><span class="op" id="6558376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6558379">func</span>&nbsp;<span class="ident" id="6558384">TestX509KeyPair</span><span class="op" id="6558399">(</span><span class="ident" id="6558400">t</span>&nbsp;<span class="op" id="6558402">*</span><span class="ident" id="6558403">testing</span><span class="op" id="6558410">.</span><span class="ident" id="6558411">T</span><span class="op" id="6558412">)</span>&nbsp;<span class="op" id="6558414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6558417">var</span>&nbsp;<span class="ident" id="6558421">pem</span>&nbsp;<span class="op" id="6558425">[</span><span class="op" id="6558426">]</span><span class="builtintype" id="6558427">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6558433">for</span>&nbsp;<span class="ident" id="6558437">_</span><span class="op" id="6558438">,</span>&nbsp;<span class="ident" id="6558440">test</span>&nbsp;<span class="op" id="6558445">:=</span>&nbsp;<span class="keyword" id="6558448">range</span>&nbsp;<span class="ident" id="6558454">keyPairTests</span>&nbsp;<span class="op" id="6558467">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6558471">pem</span>&nbsp;<span class="op" id="6558475">=</span>&nbsp;<span class="op" id="6558477">[</span><span class="op" id="6558478">]</span><span class="builtintype" id="6558479">byte</span><span class="op" id="6558483">(</span><span class="ident" id="6558484">test</span><span class="op" id="6558488">.</span><span class="ident" id="6558489">cert</span>&nbsp;<span class="op" id="6558494">+</span>&nbsp;<span class="ident" id="6558496">test</span><span class="op" id="6558500">.</span><span class="ident" id="6558501">key</span><span class="op" id="6558504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6558508">if</span>&nbsp;<span class="ident" id="6558511">_</span><span class="op" id="6558512">,</span>&nbsp;<span class="ident" id="6558514">err</span>&nbsp;<span class="op" id="6558518">:=</span>&nbsp;<span class="ident" id="6558521">X509KeyPair</span><span class="op" id="6558532">(</span><span class="ident" id="6558533">pem</span><span class="op" id="6558536">,</span>&nbsp;<span class="ident" id="6558538">pem</span><span class="op" id="6558541">)</span><span class="op" id="6558542">;</span>&nbsp;<span class="ident" id="6558544">err</span>&nbsp;<span class="op" id="6558548">!=</span>&nbsp;<span class="ident" id="6558551">nil</span>&nbsp;<span class="op" id="6558555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6558560">t</span><span class="op" id="6558561">.</span><span class="ident" id="6558562">Errorf</span><span class="op" id="6558568">(</span><span class="string" id="6558569">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;cert&nbsp;followed&nbsp;by&nbsp;%s&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="6558616">,</span>&nbsp;<span class="ident" id="6558618">test</span><span class="op" id="6558622">.</span><span class="ident" id="6558623">algo</span><span class="op" id="6558627">,</span>&nbsp;<span class="ident" id="6558629">test</span><span class="op" id="6558633">.</span><span class="ident" id="6558634">algo</span><span class="op" id="6558638">,</span>&nbsp;<span class="ident" id="6558640">err</span><span class="op" id="6558643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6558647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6558651">pem</span>&nbsp;<span class="op" id="6558655">=</span>&nbsp;<span class="op" id="6558657">[</span><span class="op" id="6558658">]</span><span class="builtintype" id="6558659">byte</span><span class="op" id="6558663">(</span><span class="ident" id="6558664">test</span><span class="op" id="6558668">.</span><span class="ident" id="6558669">key</span>&nbsp;<span class="op" id="6558673">+</span>&nbsp;<span class="ident" id="6558675">test</span><span class="op" id="6558679">.</span><span class="ident" id="6558680">cert</span><span class="op" id="6558684">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6558688">if</span>&nbsp;<span class="ident" id="6558691">_</span><span class="op" id="6558692">,</span>&nbsp;<span class="ident" id="6558694">err</span>&nbsp;<span class="op" id="6558698">:=</span>&nbsp;<span class="ident" id="6558701">X509KeyPair</span><span class="op" id="6558712">(</span><span class="ident" id="6558713">pem</span><span class="op" id="6558716">,</span>&nbsp;<span class="ident" id="6558718">pem</span><span class="op" id="6558721">)</span><span class="op" id="6558722">;</span>&nbsp;<span class="ident" id="6558724">err</span>&nbsp;<span class="op" id="6558728">!=</span>&nbsp;<span class="ident" id="6558731">nil</span>&nbsp;<span class="op" id="6558735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6558740">t</span><span class="op" id="6558741">.</span><span class="ident" id="6558742">Errorf</span><span class="op" id="6558748">(</span><span class="string" id="6558749">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;key&nbsp;followed&nbsp;by&nbsp;%s&nbsp;cert:&nbsp;%s&#34;</span><span class="op" id="6558796">,</span>&nbsp;<span class="ident" id="6558798">test</span><span class="op" id="6558802">.</span><span class="ident" id="6558803">algo</span><span class="op" id="6558807">,</span>&nbsp;<span class="ident" id="6558809">test</span><span class="op" id="6558813">.</span><span class="ident" id="6558814">algo</span><span class="op" id="6558818">,</span>&nbsp;<span class="ident" id="6558820">err</span><span class="op" id="6558823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6558827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6558830">}</span><br>
<span class="lineno"></span><span class="op" id="6558832">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6558835">func</span>&nbsp;<span class="ident" id="6558840">TestX509MixedKeyPair</span><span class="op" id="6558860">(</span><span class="ident" id="6558861">t</span>&nbsp;<span class="op" id="6558863">*</span><span class="ident" id="6558864">testing</span><span class="op" id="6558871">.</span><span class="ident" id="6558872">T</span><span class="op" id="6558873">)</span>&nbsp;<span class="op" id="6558875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6558878">if</span>&nbsp;<span class="ident" id="6558881">_</span><span class="op" id="6558882">,</span>&nbsp;<span class="ident" id="6558884">err</span>&nbsp;<span class="op" id="6558888">:=</span>&nbsp;<span class="ident" id="6558891">X509KeyPair</span><span class="op" id="6558902">(</span><span class="op" id="6558903">[</span><span class="op" id="6558904">]</span><span class="builtintype" id="6558905">byte</span><span class="op" id="6558909">(</span><span class="ident" id="6558910">rsaCertPEM</span><span class="op" id="6558920">)</span><span class="op" id="6558921">,</span>&nbsp;<span class="op" id="6558923">[</span><span class="op" id="6558924">]</span><span class="builtintype" id="6558925">byte</span><span class="op" id="6558929">(</span><span class="ident" id="6558930">ecdsaKeyPEM</span><span class="op" id="6558941">)</span><span class="op" id="6558942">)</span><span class="op" id="6558943">;</span>&nbsp;<span class="ident" id="6558945">err</span>&nbsp;<span class="op" id="6558949">==</span>&nbsp;<span class="ident" id="6558952">nil</span>&nbsp;<span class="op" id="6558956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6558960">t</span><span class="op" id="6558961">.</span><span class="ident" id="6558962">Error</span><span class="op" id="6558967">(</span><span class="string" id="6558968">&#34;Load&nbsp;of&nbsp;RSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;ECDSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="6559026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6559029">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6559032">if</span>&nbsp;<span class="ident" id="6559035">_</span><span class="op" id="6559036">,</span>&nbsp;<span class="ident" id="6559038">err</span>&nbsp;<span class="op" id="6559042">:=</span>&nbsp;<span class="ident" id="6559045">X509KeyPair</span><span class="op" id="6559056">(</span><span class="op" id="6559057">[</span><span class="op" id="6559058">]</span><span class="builtintype" id="6559059">byte</span><span class="op" id="6559063">(</span><span class="ident" id="6559064">ecdsaCertPEM</span><span class="op" id="6559076">)</span><span class="op" id="6559077">,</span>&nbsp;<span class="op" id="6559079">[</span><span class="op" id="6559080">]</span><span class="builtintype" id="6559081">byte</span><span class="op" id="6559085">(</span><span class="ident" id="6559086">rsaKeyPEM</span><span class="op" id="6559095">)</span><span class="op" id="6559096">)</span><span class="op" id="6559097">;</span>&nbsp;<span class="ident" id="6559099">err</span>&nbsp;<span class="op" id="6559103">==</span>&nbsp;<span class="ident" id="6559106">nil</span>&nbsp;<span class="op" id="6559110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6559114">t</span><span class="op" id="6559115">.</span><span class="ident" id="6559116">Error</span><span class="op" id="6559121">(</span><span class="string" id="6559122">&#34;Load&nbsp;of&nbsp;ECDSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;RSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="6559180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6559183">}</span><br>
<span class="lineno"></span><span class="op" id="6559185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="6559188">func</span>&nbsp;<span class="ident" id="6559193">newLocalListener</span><span class="op" id="6559209">(</span><span class="ident" id="6559210">t</span>&nbsp;<span class="op" id="6559212">*</span><span class="ident" id="6559213">testing</span><span class="op" id="6559220">.</span><span class="ident" id="6559221">T</span><span class="op" id="6559222">)</span>&nbsp;<span class="ident" id="6559224">net</span><span class="op" id="6559227">.</span><span class="ident" id="6559228">Listener</span>&nbsp;<span class="op" id="6559237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6559240">ln</span><span class="op" id="6559242">,</span>&nbsp;<span class="ident" id="6559244">err</span>&nbsp;<span class="op" id="6559248">:=</span>&nbsp;<span class="ident" id="6559251">net</span><span class="op" id="6559254">.</span><span class="ident" id="6559255">Listen</span><span class="op" id="6559261">(</span><span class="string" id="6559262">&#34;tcp&#34;</span><span class="op" id="6559267">,</span>&nbsp;<span class="string" id="6559269">&#34;127.0.0.1:0&#34;</span><span class="op" id="6559282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6559285">if</span>&nbsp;<span class="ident" id="6559288">err</span>&nbsp;<span class="op" id="6559292">!=</span>&nbsp;<span class="ident" id="6559295">nil</span>&nbsp;<span class="op" id="6559299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6559303">ln</span><span class="op" id="6559305">,</span>&nbsp;<span class="ident" id="6559307">err</span>&nbsp;<span class="op" id="6559311">=</span>&nbsp;<span class="ident" id="6559313">net</span><span class="op" id="6559316">.</span><span class="ident" id="6559317">Listen</span><span class="op" id="6559323">(</span><span class="string" id="6559324">&#34;tcp6&#34;</span><span class="op" id="6559330">,</span>&nbsp;<span class="string" id="6559332">&#34;[::1]:0&#34;</span><span class="op" id="6559341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6559344">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6559347">if</span>&nbsp;<span class="ident" id="6559350">err</span>&nbsp;<span class="op" id="6559354">!=</span>&nbsp;<span class="ident" id="6559357">nil</span>&nbsp;<span class="op" id="6559361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6559365">t</span><span class="op" id="6559366">.</span><span class="ident" id="6559367">Fatal</span><span class="op" id="6559372">(</span><span class="ident" id="6559373">err</span><span class="op" id="6559376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6559379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6559382">return</span>&nbsp;<span class="ident" id="6559389">ln</span><br>
<span class="lineno"></span><span class="op" id="6559392">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="6559395">func</span>&nbsp;<span class="ident" id="6559400">TestDialTimeout</span><span class="op" id="6559415">(</span><span class="ident" id="6559416">t</span>&nbsp;<span class="op" id="6559418">*</span><span class="ident" id="6559419">testing</span><span class="op" id="6559426">.</span><span class="ident" id="6559427">T</span><span class="op" id="6559428">)</span>&nbsp;<span class="op" id="6559430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6559433">if</span>&nbsp;<span class="ident" id="6559436">testing</span><span class="op" id="6559443">.</span><span class="ident" id="6559444">Short</span><span class="op" id="6559449">(</span><span class="op" id="6559450">)</span>&nbsp;<span class="op" id="6559452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6559456">t</span><span class="op" id="6559457">.</span><span class="ident" id="6559458">Skip</span><span class="op" id="6559462">(</span><span class="string" id="6559463">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6559487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6559490">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6559493">listener</span>&nbsp;<span class="op" id="6559502">:=</span>&nbsp;<span class="ident" id="6559505">newLocalListener</span><span class="op" id="6559521">(</span><span class="ident" id="6559522">t</span><span class="op" id="6559523">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6559527">addr</span>&nbsp;<span class="op" id="6559532">:=</span>&nbsp;<span class="ident" id="6559535">listener</span><span class="op" id="6559543">.</span><span class="ident" id="6559544">Addr</span><span class="op" id="6559548">(</span><span class="op" id="6559549">)</span><span class="op" id="6559550">.</span><span class="ident" id="6559551">String</span><span class="op" id="6559557">(</span><span class="op" id="6559558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6559561">defer</span>&nbsp;<span class="ident" id="6559567">listener</span><span class="op" id="6559575">.</span><span class="ident" id="6559576">Close</span><span class="op" id="6559581">(</span><span class="op" id="6559582">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6559586">complete</span>&nbsp;<span class="op" id="6559595">:=</span>&nbsp;<span class="builtinfunc" id="6559598">make</span><span class="op" id="6559602">(</span><span class="keyword" id="6559603">chan</span>&nbsp;<span class="builtintype" id="6559608">bool</span><span class="op" id="6559612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6559615">defer</span>&nbsp;<span class="builtinfunc" id="6559621">close</span><span class="op" id="6559626">(</span><span class="ident" id="6559627">complete</span><span class="op" id="6559635">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6559639">go</span>&nbsp;<span class="keyword" id="6559642">func</span><span class="op" id="6559646">(</span><span class="op" id="6559647">)</span>&nbsp;<span class="op" id="6559649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6559653">conn</span><span class="op" id="6559657">,</span>&nbsp;<span class="ident" id="6559659">err</span>&nbsp;<span class="op" id="6559663">:=</span>&nbsp;<span class="ident" id="6559666">listener</span><span class="op" id="6559674">.</span><span class="ident" id="6559675">Accept</span><span class="op" id="6559681">(</span><span class="op" id="6559682">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6559686">if</span>&nbsp;<span class="ident" id="6559689">err</span>&nbsp;<span class="op" id="6559693">!=</span>&nbsp;<span class="ident" id="6559696">nil</span>&nbsp;<span class="op" id="6559700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6559705">t</span><span class="op" id="6559706">.</span><span class="ident" id="6559707">Error</span><span class="op" id="6559712">(</span><span class="ident" id="6559713">err</span><span class="op" id="6559716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6559721">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6559730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6559734">&lt;-</span><span class="ident" id="6559736">complete</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6559747">conn</span><span class="op" id="6559751">.</span><span class="ident" id="6559752">Close</span><span class="op" id="6559757">(</span><span class="op" id="6559758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6559761">}</span><span class="op" id="6559762">(</span><span class="op" id="6559763">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6559767">dialer</span>&nbsp;<span class="op" id="6559774">:=</span>&nbsp;<span class="op" id="6559777">&amp;</span><span class="ident" id="6559778">net</span><span class="op" id="6559781">.</span><span class="ident" id="6559782">Dialer</span><span class="op" id="6559788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6559792">Timeout</span><span class="op" id="6559799">:</span>&nbsp;<span class="num" id="6559801">10</span>&nbsp;<span class="op" id="6559804">*</span>&nbsp;<span class="ident" id="6559806">time</span><span class="op" id="6559810">.</span><span class="ident" id="6559811">Millisecond</span><span class="op" id="6559822">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6559825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6559829">var</span>&nbsp;<span class="ident" id="6559833">err</span>&nbsp;<span class="builtintype" id="6559837">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6559844">if</span>&nbsp;<span class="ident" id="6559847">_</span><span class="op" id="6559848">,</span>&nbsp;<span class="ident" id="6559850">err</span>&nbsp;<span class="op" id="6559854">=</span>&nbsp;<span class="ident" id="6559856">DialWithDialer</span><span class="op" id="6559870">(</span><span class="ident" id="6559871">dialer</span><span class="op" id="6559877">,</span>&nbsp;<span class="string" id="6559879">&#34;tcp&#34;</span><span class="op" id="6559884">,</span>&nbsp;<span class="ident" id="6559886">addr</span><span class="op" id="6559890">,</span>&nbsp;<span class="ident" id="6559892">nil</span><span class="op" id="6559895">)</span><span class="op" id="6559896">;</span>&nbsp;<span class="ident" id="6559898">err</span>&nbsp;<span class="op" id="6559902">==</span>&nbsp;<span class="ident" id="6559905">nil</span>&nbsp;<span class="op" id="6559909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6559913">t</span><span class="op" id="6559914">.</span><span class="ident" id="6559915">Fatal</span><span class="op" id="6559920">(</span><span class="string" id="6559921">&#34;DialWithTimeout&nbsp;completed&nbsp;successfully&#34;</span><span class="op" id="6559961">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6559964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6559968">if</span>&nbsp;<span class="op" id="6559971">!</span><span class="ident" id="6559972">strings</span><span class="op" id="6559979">.</span><span class="ident" id="6559980">Contains</span><span class="op" id="6559988">(</span><span class="ident" id="6559989">err</span><span class="op" id="6559992">.</span><span class="ident" id="6559993">Error</span><span class="op" id="6559998">(</span><span class="op" id="6559999">)</span><span class="op" id="6560000">,</span>&nbsp;<span class="string" id="6560002">&#34;timed&nbsp;out&#34;</span><span class="op" id="6560013">)</span>&nbsp;<span class="op" id="6560015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6560019">t</span><span class="op" id="6560020">.</span><span class="ident" id="6560021">Errorf</span><span class="op" id="6560027">(</span><span class="string" id="6560028">&#34;resulting&nbsp;error&nbsp;not&nbsp;a&nbsp;timeout:&nbsp;%s&#34;</span><span class="op" id="6560063">,</span>&nbsp;<span class="ident" id="6560065">err</span><span class="op" id="6560068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6560071">}</span><br>
<span class="lineno">160</span><span class="op" id="6560073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6560076">//&nbsp;tests&nbsp;that&nbsp;Conn.Read&nbsp;returns&nbsp;(non-zero,&nbsp;io.EOF)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6560138">//&nbsp;(non-zero,&nbsp;nil)&nbsp;when&nbsp;a&nbsp;Close&nbsp;(alertCloseNotify)&nbsp;is&nbsp;sitting&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="6560206">//&nbsp;behind&nbsp;the&nbsp;application&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">165</span><span class="keyword" id="6560252">func</span>&nbsp;<span class="ident" id="6560257">TestConnReadNonzeroAndEOF</span><span class="op" id="6560282">(</span><span class="ident" id="6560283">t</span>&nbsp;<span class="op" id="6560285">*</span><span class="ident" id="6560286">testing</span><span class="op" id="6560293">.</span><span class="ident" id="6560294">T</span><span class="op" id="6560295">)</span>&nbsp;<span class="op" id="6560297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6560300">//&nbsp;This&nbsp;test&nbsp;is&nbsp;racy:&nbsp;it&nbsp;assumes&nbsp;that&nbsp;after&nbsp;a&nbsp;write&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6560358">//&nbsp;localhost&nbsp;TCP&nbsp;connection,&nbsp;the&nbsp;peer&nbsp;TCP&nbsp;connection&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6560416">//&nbsp;immediately&nbsp;read&nbsp;it.&nbsp;&nbsp;Because&nbsp;it&#39;s&nbsp;racy,&nbsp;we&nbsp;skip&nbsp;this&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6560479">//&nbsp;in&nbsp;short&nbsp;mode,&nbsp;and&nbsp;then&nbsp;retry&nbsp;it&nbsp;several&nbsp;times&nbsp;with&nbsp;an</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6560538">//&nbsp;increasing&nbsp;sleep&nbsp;in&nbsp;between&nbsp;our&nbsp;final&nbsp;write&nbsp;(via&nbsp;srv.Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6560601">//&nbsp;below)&nbsp;and&nbsp;the&nbsp;following&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6560636">if</span>&nbsp;<span class="ident" id="6560639">testing</span><span class="op" id="6560646">.</span><span class="ident" id="6560647">Short</span><span class="op" id="6560652">(</span><span class="op" id="6560653">)</span>&nbsp;<span class="op" id="6560655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6560659">t</span><span class="op" id="6560660">.</span><span class="ident" id="6560661">Skip</span><span class="op" id="6560665">(</span><span class="string" id="6560666">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6560690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6560693">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6560696">var</span>&nbsp;<span class="ident" id="6560700">err</span>&nbsp;<span class="builtintype" id="6560704">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6560711">for</span>&nbsp;<span class="ident" id="6560715">delay</span>&nbsp;<span class="op" id="6560721">:=</span>&nbsp;<span class="ident" id="6560724">time</span><span class="op" id="6560728">.</span><span class="ident" id="6560729">Millisecond</span><span class="op" id="6560740">;</span>&nbsp;<span class="ident" id="6560742">delay</span>&nbsp;<span class="op" id="6560748">&lt;=</span>&nbsp;<span class="num" id="6560751">64</span><span class="op" id="6560753">*</span><span class="ident" id="6560754">time</span><span class="op" id="6560758">.</span><span class="ident" id="6560759">Millisecond</span><span class="op" id="6560770">;</span>&nbsp;<span class="ident" id="6560772">delay</span>&nbsp;<span class="op" id="6560778">*=</span>&nbsp;<span class="num" id="6560781">2</span>&nbsp;<span class="op" id="6560783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6560787">if</span>&nbsp;<span class="ident" id="6560790">err</span>&nbsp;<span class="op" id="6560794">=</span>&nbsp;<span class="ident" id="6560796">testConnReadNonzeroAndEOF</span><span class="op" id="6560821">(</span><span class="ident" id="6560822">t</span><span class="op" id="6560823">,</span>&nbsp;<span class="ident" id="6560825">delay</span><span class="op" id="6560830">)</span><span class="op" id="6560831">;</span>&nbsp;<span class="ident" id="6560833">err</span>&nbsp;<span class="op" id="6560837">==</span>&nbsp;<span class="ident" id="6560840">nil</span>&nbsp;<span class="op" id="6560844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6560849">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6560858">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6560861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6560864">t</span><span class="op" id="6560865">.</span><span class="ident" id="6560866">Error</span><span class="op" id="6560871">(</span><span class="ident" id="6560872">err</span><span class="op" id="6560875">)</span><br>
<span class="lineno"></span><span class="op" id="6560877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6560880">func</span>&nbsp;<span class="ident" id="6560885">testConnReadNonzeroAndEOF</span><span class="op" id="6560910">(</span><span class="ident" id="6560911">t</span>&nbsp;<span class="op" id="6560913">*</span><span class="ident" id="6560914">testing</span><span class="op" id="6560921">.</span><span class="ident" id="6560922">T</span><span class="op" id="6560923">,</span>&nbsp;<span class="ident" id="6560925">delay</span>&nbsp;<span class="ident" id="6560931">time</span><span class="op" id="6560935">.</span><span class="ident" id="6560936">Duration</span><span class="op" id="6560944">)</span>&nbsp;<span class="builtintype" id="6560946">error</span>&nbsp;<span class="op" id="6560952">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6560955">ln</span>&nbsp;<span class="op" id="6560958">:=</span>&nbsp;<span class="ident" id="6560961">newLocalListener</span><span class="op" id="6560977">(</span><span class="ident" id="6560978">t</span><span class="op" id="6560979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6560982">defer</span>&nbsp;<span class="ident" id="6560988">ln</span><span class="op" id="6560990">.</span><span class="ident" id="6560991">Close</span><span class="op" id="6560996">(</span><span class="op" id="6560997">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561001">srvCh</span>&nbsp;<span class="op" id="6561007">:=</span>&nbsp;<span class="builtinfunc" id="6561010">make</span><span class="op" id="6561014">(</span><span class="keyword" id="6561015">chan</span>&nbsp;<span class="op" id="6561020">*</span><span class="ident" id="6561021">Conn</span><span class="op" id="6561025">,</span>&nbsp;<span class="num" id="6561027">1</span><span class="op" id="6561028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6561031">var</span>&nbsp;<span class="ident" id="6561035">serr</span>&nbsp;<span class="builtintype" id="6561040">error</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6561047">go</span>&nbsp;<span class="keyword" id="6561050">func</span><span class="op" id="6561054">(</span><span class="op" id="6561055">)</span>&nbsp;<span class="op" id="6561057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561061">sconn</span><span class="op" id="6561066">,</span>&nbsp;<span class="ident" id="6561068">err</span>&nbsp;<span class="op" id="6561072">:=</span>&nbsp;<span class="ident" id="6561075">ln</span><span class="op" id="6561077">.</span><span class="ident" id="6561078">Accept</span><span class="op" id="6561084">(</span><span class="op" id="6561085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6561089">if</span>&nbsp;<span class="ident" id="6561092">err</span>&nbsp;<span class="op" id="6561096">!=</span>&nbsp;<span class="ident" id="6561099">nil</span>&nbsp;<span class="op" id="6561103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561108">serr</span>&nbsp;<span class="op" id="6561113">=</span>&nbsp;<span class="ident" id="6561115">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561122">srvCh</span>&nbsp;<span class="op" id="6561128">&lt;-</span>&nbsp;<span class="ident" id="6561131">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6561138">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6561147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561151">serverConfig</span>&nbsp;<span class="op" id="6561164">:=</span>&nbsp;<span class="op" id="6561167">*</span><span class="ident" id="6561168">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561181">srv</span>&nbsp;<span class="op" id="6561185">:=</span>&nbsp;<span class="ident" id="6561188">Server</span><span class="op" id="6561194">(</span><span class="ident" id="6561195">sconn</span><span class="op" id="6561200">,</span>&nbsp;<span class="op" id="6561202">&amp;</span><span class="ident" id="6561203">serverConfig</span><span class="op" id="6561215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6561219">if</span>&nbsp;<span class="ident" id="6561222">err</span>&nbsp;<span class="op" id="6561226">:=</span>&nbsp;<span class="ident" id="6561229">srv</span><span class="op" id="6561232">.</span><span class="ident" id="6561233">Handshake</span><span class="op" id="6561242">(</span><span class="op" id="6561243">)</span><span class="op" id="6561244">;</span>&nbsp;<span class="ident" id="6561246">err</span>&nbsp;<span class="op" id="6561250">!=</span>&nbsp;<span class="ident" id="6561253">nil</span>&nbsp;<span class="op" id="6561257">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561262">serr</span>&nbsp;<span class="op" id="6561267">=</span>&nbsp;<span class="ident" id="6561269">fmt</span><span class="op" id="6561272">.</span><span class="ident" id="6561273">Errorf</span><span class="op" id="6561279">(</span><span class="string" id="6561280">&#34;handshake:&nbsp;%v&#34;</span><span class="op" id="6561295">,</span>&nbsp;<span class="ident" id="6561297">err</span><span class="op" id="6561300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561305">srvCh</span>&nbsp;<span class="op" id="6561311">&lt;-</span>&nbsp;<span class="ident" id="6561314">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6561321">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6561330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561334">srvCh</span>&nbsp;<span class="op" id="6561340">&lt;-</span>&nbsp;<span class="ident" id="6561343">srv</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6561348">}</span><span class="op" id="6561349">(</span><span class="op" id="6561350">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561354">clientConfig</span>&nbsp;<span class="op" id="6561367">:=</span>&nbsp;<span class="op" id="6561370">*</span><span class="ident" id="6561371">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561383">conn</span><span class="op" id="6561387">,</span>&nbsp;<span class="ident" id="6561389">err</span>&nbsp;<span class="op" id="6561393">:=</span>&nbsp;<span class="ident" id="6561396">Dial</span><span class="op" id="6561400">(</span><span class="string" id="6561401">&#34;tcp&#34;</span><span class="op" id="6561406">,</span>&nbsp;<span class="ident" id="6561408">ln</span><span class="op" id="6561410">.</span><span class="ident" id="6561411">Addr</span><span class="op" id="6561415">(</span><span class="op" id="6561416">)</span><span class="op" id="6561417">.</span><span class="ident" id="6561418">String</span><span class="op" id="6561424">(</span><span class="op" id="6561425">)</span><span class="op" id="6561426">,</span>&nbsp;<span class="op" id="6561428">&amp;</span><span class="ident" id="6561429">clientConfig</span><span class="op" id="6561441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6561444">if</span>&nbsp;<span class="ident" id="6561447">err</span>&nbsp;<span class="op" id="6561451">!=</span>&nbsp;<span class="ident" id="6561454">nil</span>&nbsp;<span class="op" id="6561458">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561462">t</span><span class="op" id="6561463">.</span><span class="ident" id="6561464">Fatal</span><span class="op" id="6561469">(</span><span class="ident" id="6561470">err</span><span class="op" id="6561473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6561476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6561479">defer</span>&nbsp;<span class="ident" id="6561485">conn</span><span class="op" id="6561489">.</span><span class="ident" id="6561490">Close</span><span class="op" id="6561495">(</span><span class="op" id="6561496">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561500">srv</span>&nbsp;<span class="op" id="6561504">:=</span>&nbsp;<span class="op" id="6561507">&lt;-</span><span class="ident" id="6561509">srvCh</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6561516">if</span>&nbsp;<span class="ident" id="6561519">srv</span>&nbsp;<span class="op" id="6561523">==</span>&nbsp;<span class="ident" id="6561526">nil</span>&nbsp;<span class="op" id="6561530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6561534">return</span>&nbsp;<span class="ident" id="6561541">serr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6561547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561551">buf</span>&nbsp;<span class="op" id="6561555">:=</span>&nbsp;<span class="builtinfunc" id="6561558">make</span><span class="op" id="6561562">(</span><span class="op" id="6561563">[</span><span class="op" id="6561564">]</span><span class="builtintype" id="6561565">byte</span><span class="op" id="6561569">,</span>&nbsp;<span class="num" id="6561571">6</span><span class="op" id="6561572">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561576">srv</span><span class="op" id="6561579">.</span><span class="ident" id="6561580">Write</span><span class="op" id="6561585">(</span><span class="op" id="6561586">[</span><span class="op" id="6561587">]</span><span class="builtintype" id="6561588">byte</span><span class="op" id="6561592">(</span><span class="string" id="6561593">&#34;foobar&#34;</span><span class="op" id="6561601">)</span><span class="op" id="6561602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561605">n</span><span class="op" id="6561606">,</span>&nbsp;<span class="ident" id="6561608">err</span>&nbsp;<span class="op" id="6561612">:=</span>&nbsp;<span class="ident" id="6561615">conn</span><span class="op" id="6561619">.</span><span class="ident" id="6561620">Read</span><span class="op" id="6561624">(</span><span class="ident" id="6561625">buf</span><span class="op" id="6561628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6561631">if</span>&nbsp;<span class="ident" id="6561634">n</span>&nbsp;<span class="op" id="6561636">!=</span>&nbsp;<span class="num" id="6561639">6</span>&nbsp;<span class="op" id="6561641">||</span>&nbsp;<span class="ident" id="6561644">err</span>&nbsp;<span class="op" id="6561648">!=</span>&nbsp;<span class="ident" id="6561651">nil</span>&nbsp;<span class="op" id="6561655">||</span>&nbsp;<span class="builtintype" id="6561658">string</span><span class="op" id="6561664">(</span><span class="ident" id="6561665">buf</span><span class="op" id="6561668">)</span>&nbsp;<span class="op" id="6561670">!=</span>&nbsp;<span class="string" id="6561673">&#34;foobar&#34;</span>&nbsp;<span class="op" id="6561682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6561686">return</span>&nbsp;<span class="ident" id="6561693">fmt</span><span class="op" id="6561696">.</span><span class="ident" id="6561697">Errorf</span><span class="op" id="6561703">(</span><span class="string" id="6561704">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;data&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;nil,&nbsp;foobar&#34;</span><span class="op" id="6561749">,</span>&nbsp;<span class="ident" id="6561751">n</span><span class="op" id="6561752">,</span>&nbsp;<span class="ident" id="6561754">err</span><span class="op" id="6561757">,</span>&nbsp;<span class="ident" id="6561759">buf</span><span class="op" id="6561762">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6561765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561769">srv</span><span class="op" id="6561772">.</span><span class="ident" id="6561773">Write</span><span class="op" id="6561778">(</span><span class="op" id="6561779">[</span><span class="op" id="6561780">]</span><span class="builtintype" id="6561781">byte</span><span class="op" id="6561785">(</span><span class="string" id="6561786">&#34;abcdef&#34;</span><span class="op" id="6561794">)</span><span class="op" id="6561795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561798">srv</span><span class="op" id="6561801">.</span><span class="ident" id="6561802">Close</span><span class="op" id="6561807">(</span><span class="op" id="6561808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561811">time</span><span class="op" id="6561815">.</span><span class="ident" id="6561816">Sleep</span><span class="op" id="6561821">(</span><span class="ident" id="6561822">delay</span><span class="op" id="6561827">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6561830">n</span><span class="op" id="6561831">,</span>&nbsp;<span class="ident" id="6561833">err</span>&nbsp;<span class="op" id="6561837">=</span>&nbsp;<span class="ident" id="6561839">conn</span><span class="op" id="6561843">.</span><span class="ident" id="6561844">Read</span><span class="op" id="6561848">(</span><span class="ident" id="6561849">buf</span><span class="op" id="6561852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6561855">if</span>&nbsp;<span class="ident" id="6561858">n</span>&nbsp;<span class="op" id="6561860">!=</span>&nbsp;<span class="num" id="6561863">6</span>&nbsp;<span class="op" id="6561865">||</span>&nbsp;<span class="builtintype" id="6561868">string</span><span class="op" id="6561874">(</span><span class="ident" id="6561875">buf</span><span class="op" id="6561878">)</span>&nbsp;<span class="op" id="6561880">!=</span>&nbsp;<span class="string" id="6561883">&#34;abcdef&#34;</span>&nbsp;<span class="op" id="6561892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6561896">return</span>&nbsp;<span class="ident" id="6561903">fmt</span><span class="op" id="6561906">.</span><span class="ident" id="6561907">Errorf</span><span class="op" id="6561913">(</span><span class="string" id="6561914">&#34;Read&nbsp;=&nbsp;%d,&nbsp;buf=&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;abcdef&#34;</span><span class="op" id="6561950">,</span>&nbsp;<span class="ident" id="6561952">n</span><span class="op" id="6561953">,</span>&nbsp;<span class="ident" id="6561955">buf</span><span class="op" id="6561958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6561961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6561964">if</span>&nbsp;<span class="ident" id="6561967">err</span>&nbsp;<span class="op" id="6561971">!=</span>&nbsp;<span class="ident" id="6561974">io</span><span class="op" id="6561976">.</span><span class="ident" id="6561977">EOF</span>&nbsp;<span class="op" id="6561981">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6561985">return</span>&nbsp;<span class="ident" id="6561992">fmt</span><span class="op" id="6561995">.</span><span class="ident" id="6561996">Errorf</span><span class="op" id="6562002">(</span><span class="string" id="6562003">&#34;Second&nbsp;Read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="6562040">,</span>&nbsp;<span class="ident" id="6562042">err</span><span class="op" id="6562045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6562048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6562051">return</span>&nbsp;<span class="ident" id="6562058">nil</span><br>
<span class="lineno"></span><span class="op" id="6562062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="6562065">func</span>&nbsp;<span class="ident" id="6562070">TestTLSUniqueMatches</span><span class="op" id="6562090">(</span><span class="ident" id="6562091">t</span>&nbsp;<span class="op" id="6562093">*</span><span class="ident" id="6562094">testing</span><span class="op" id="6562101">.</span><span class="ident" id="6562102">T</span><span class="op" id="6562103">)</span>&nbsp;<span class="op" id="6562105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562108">ln</span>&nbsp;<span class="op" id="6562111">:=</span>&nbsp;<span class="ident" id="6562114">newLocalListener</span><span class="op" id="6562130">(</span><span class="ident" id="6562131">t</span><span class="op" id="6562132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6562135">defer</span>&nbsp;<span class="ident" id="6562141">ln</span><span class="op" id="6562143">.</span><span class="ident" id="6562144">Close</span><span class="op" id="6562149">(</span><span class="op" id="6562150">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562154">serverTLSUniques</span>&nbsp;<span class="op" id="6562171">:=</span>&nbsp;<span class="builtinfunc" id="6562174">make</span><span class="op" id="6562178">(</span><span class="keyword" id="6562179">chan</span>&nbsp;<span class="op" id="6562184">[</span><span class="op" id="6562185">]</span><span class="builtintype" id="6562186">byte</span><span class="op" id="6562190">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6562193">go</span>&nbsp;<span class="keyword" id="6562196">func</span><span class="op" id="6562200">(</span><span class="op" id="6562201">)</span>&nbsp;<span class="op" id="6562203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6562207">for</span>&nbsp;<span class="ident" id="6562211">i</span>&nbsp;<span class="op" id="6562213">:=</span>&nbsp;<span class="num" id="6562216">0</span><span class="op" id="6562217">;</span>&nbsp;<span class="ident" id="6562219">i</span>&nbsp;<span class="op" id="6562221">&lt;</span>&nbsp;<span class="num" id="6562223">2</span><span class="op" id="6562224">;</span>&nbsp;<span class="ident" id="6562226">i</span><span class="op" id="6562227">++</span>&nbsp;<span class="op" id="6562230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562235">sconn</span><span class="op" id="6562240">,</span>&nbsp;<span class="ident" id="6562242">err</span>&nbsp;<span class="op" id="6562246">:=</span>&nbsp;<span class="ident" id="6562249">ln</span><span class="op" id="6562251">.</span><span class="ident" id="6562252">Accept</span><span class="op" id="6562258">(</span><span class="op" id="6562259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6562264">if</span>&nbsp;<span class="ident" id="6562267">err</span>&nbsp;<span class="op" id="6562271">!=</span>&nbsp;<span class="ident" id="6562274">nil</span>&nbsp;<span class="op" id="6562278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562284">t</span><span class="op" id="6562285">.</span><span class="ident" id="6562286">Fatal</span><span class="op" id="6562291">(</span><span class="ident" id="6562292">err</span><span class="op" id="6562295">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6562300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562305">serverConfig</span>&nbsp;<span class="op" id="6562318">:=</span>&nbsp;<span class="op" id="6562321">*</span><span class="ident" id="6562322">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562336">srv</span>&nbsp;<span class="op" id="6562340">:=</span>&nbsp;<span class="ident" id="6562343">Server</span><span class="op" id="6562349">(</span><span class="ident" id="6562350">sconn</span><span class="op" id="6562355">,</span>&nbsp;<span class="op" id="6562357">&amp;</span><span class="ident" id="6562358">serverConfig</span><span class="op" id="6562370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6562375">if</span>&nbsp;<span class="ident" id="6562378">err</span>&nbsp;<span class="op" id="6562382">:=</span>&nbsp;<span class="ident" id="6562385">srv</span><span class="op" id="6562388">.</span><span class="ident" id="6562389">Handshake</span><span class="op" id="6562398">(</span><span class="op" id="6562399">)</span><span class="op" id="6562400">;</span>&nbsp;<span class="ident" id="6562402">err</span>&nbsp;<span class="op" id="6562406">!=</span>&nbsp;<span class="ident" id="6562409">nil</span>&nbsp;<span class="op" id="6562413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562419">t</span><span class="op" id="6562420">.</span><span class="ident" id="6562421">Fatal</span><span class="op" id="6562426">(</span><span class="ident" id="6562427">err</span><span class="op" id="6562430">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6562435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562440">serverTLSUniques</span>&nbsp;<span class="op" id="6562457">&lt;-</span>&nbsp;<span class="ident" id="6562460">srv</span><span class="op" id="6562463">.</span><span class="ident" id="6562464">ConnectionState</span><span class="op" id="6562479">(</span><span class="op" id="6562480">)</span><span class="op" id="6562481">.</span><span class="ident" id="6562482">TLSUnique</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6562494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6562497">}</span><span class="op" id="6562498">(</span><span class="op" id="6562499">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562503">clientConfig</span>&nbsp;<span class="op" id="6562516">:=</span>&nbsp;<span class="op" id="6562519">*</span><span class="ident" id="6562520">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562532">clientConfig</span><span class="op" id="6562544">.</span><span class="ident" id="6562545">ClientSessionCache</span>&nbsp;<span class="op" id="6562564">=</span>&nbsp;<span class="ident" id="6562566">NewLRUClientSessionCache</span><span class="op" id="6562590">(</span><span class="num" id="6562591">1</span><span class="op" id="6562592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562595">conn</span><span class="op" id="6562599">,</span>&nbsp;<span class="ident" id="6562601">err</span>&nbsp;<span class="op" id="6562605">:=</span>&nbsp;<span class="ident" id="6562608">Dial</span><span class="op" id="6562612">(</span><span class="string" id="6562613">&#34;tcp&#34;</span><span class="op" id="6562618">,</span>&nbsp;<span class="ident" id="6562620">ln</span><span class="op" id="6562622">.</span><span class="ident" id="6562623">Addr</span><span class="op" id="6562627">(</span><span class="op" id="6562628">)</span><span class="op" id="6562629">.</span><span class="ident" id="6562630">String</span><span class="op" id="6562636">(</span><span class="op" id="6562637">)</span><span class="op" id="6562638">,</span>&nbsp;<span class="op" id="6562640">&amp;</span><span class="ident" id="6562641">clientConfig</span><span class="op" id="6562653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6562656">if</span>&nbsp;<span class="ident" id="6562659">err</span>&nbsp;<span class="op" id="6562663">!=</span>&nbsp;<span class="ident" id="6562666">nil</span>&nbsp;<span class="op" id="6562670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562674">t</span><span class="op" id="6562675">.</span><span class="ident" id="6562676">Fatal</span><span class="op" id="6562681">(</span><span class="ident" id="6562682">err</span><span class="op" id="6562685">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6562688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6562691">if</span>&nbsp;<span class="op" id="6562694">!</span><span class="ident" id="6562695">bytes</span><span class="op" id="6562700">.</span><span class="ident" id="6562701">Equal</span><span class="op" id="6562706">(</span><span class="ident" id="6562707">conn</span><span class="op" id="6562711">.</span><span class="ident" id="6562712">ConnectionState</span><span class="op" id="6562727">(</span><span class="op" id="6562728">)</span><span class="op" id="6562729">.</span><span class="ident" id="6562730">TLSUnique</span><span class="op" id="6562739">,</span>&nbsp;<span class="op" id="6562741">&lt;-</span><span class="ident" id="6562743">serverTLSUniques</span><span class="op" id="6562759">)</span>&nbsp;<span class="op" id="6562761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562765">t</span><span class="op" id="6562766">.</span><span class="ident" id="6562767">Error</span><span class="op" id="6562772">(</span><span class="string" id="6562773">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&#34;</span><span class="op" id="6562816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6562819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562822">conn</span><span class="op" id="6562826">.</span><span class="ident" id="6562827">Close</span><span class="op" id="6562832">(</span><span class="op" id="6562833">)</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562837">conn</span><span class="op" id="6562841">,</span>&nbsp;<span class="ident" id="6562843">err</span>&nbsp;<span class="op" id="6562847">=</span>&nbsp;<span class="ident" id="6562849">Dial</span><span class="op" id="6562853">(</span><span class="string" id="6562854">&#34;tcp&#34;</span><span class="op" id="6562859">,</span>&nbsp;<span class="ident" id="6562861">ln</span><span class="op" id="6562863">.</span><span class="ident" id="6562864">Addr</span><span class="op" id="6562868">(</span><span class="op" id="6562869">)</span><span class="op" id="6562870">.</span><span class="ident" id="6562871">String</span><span class="op" id="6562877">(</span><span class="op" id="6562878">)</span><span class="op" id="6562879">,</span>&nbsp;<span class="op" id="6562881">&amp;</span><span class="ident" id="6562882">clientConfig</span><span class="op" id="6562894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6562897">if</span>&nbsp;<span class="ident" id="6562900">err</span>&nbsp;<span class="op" id="6562904">!=</span>&nbsp;<span class="ident" id="6562907">nil</span>&nbsp;<span class="op" id="6562911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562915">t</span><span class="op" id="6562916">.</span><span class="ident" id="6562917">Fatal</span><span class="op" id="6562922">(</span><span class="ident" id="6562923">err</span><span class="op" id="6562926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6562929">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6562932">defer</span>&nbsp;<span class="ident" id="6562938">conn</span><span class="op" id="6562942">.</span><span class="ident" id="6562943">Close</span><span class="op" id="6562948">(</span><span class="op" id="6562949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6562952">if</span>&nbsp;<span class="op" id="6562955">!</span><span class="ident" id="6562956">conn</span><span class="op" id="6562960">.</span><span class="ident" id="6562961">ConnectionState</span><span class="op" id="6562976">(</span><span class="op" id="6562977">)</span><span class="op" id="6562978">.</span><span class="ident" id="6562979">DidResume</span>&nbsp;<span class="op" id="6562989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562993">t</span><span class="op" id="6562994">.</span><span class="ident" id="6562995">Error</span><span class="op" id="6563000">(</span><span class="string" id="6563001">&#34;second&nbsp;session&nbsp;did&nbsp;not&nbsp;use&nbsp;resumption&#34;</span><span class="op" id="6563040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6563043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6563046">if</span>&nbsp;<span class="op" id="6563049">!</span><span class="ident" id="6563050">bytes</span><span class="op" id="6563055">.</span><span class="ident" id="6563056">Equal</span><span class="op" id="6563061">(</span><span class="ident" id="6563062">conn</span><span class="op" id="6563066">.</span><span class="ident" id="6563067">ConnectionState</span><span class="op" id="6563082">(</span><span class="op" id="6563083">)</span><span class="op" id="6563084">.</span><span class="ident" id="6563085">TLSUnique</span><span class="op" id="6563094">,</span>&nbsp;<span class="op" id="6563096">&lt;-</span><span class="ident" id="6563098">serverTLSUniques</span><span class="op" id="6563114">)</span>&nbsp;<span class="op" id="6563116">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563120">t</span><span class="op" id="6563121">.</span><span class="ident" id="6563122">Error</span><span class="op" id="6563127">(</span><span class="string" id="6563128">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&nbsp;when&nbsp;session&nbsp;resumption&nbsp;is&nbsp;used&#34;</span><span class="op" id="6563203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6563206">}</span><br>
<span class="lineno"></span><span class="op" id="6563208">}</span>
</div>
</body>
</html>
