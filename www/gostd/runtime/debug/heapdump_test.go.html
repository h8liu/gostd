<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8477732">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8477787">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8477841">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8477892">package</span>&nbsp;<span class="ident" id="8477900">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8477907">import</span>&nbsp;<span class="op" id="8477914">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8477917">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8477930">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8477936">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8477947">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8477957">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8477960">func</span>&nbsp;<span class="ident" id="8477965">TestWriteHeapDumpNonempty</span><span class="op" id="8477990">(</span><span class="ident" id="8477991">t</span>&nbsp;<span class="op" id="8477993">*</span><span class="ident" id="8477994">testing</span><span class="op" id="8478001">.</span><span class="ident" id="8478002">T</span><span class="op" id="8478003">)</span>&nbsp;<span class="op" id="8478005">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8478008">if</span>&nbsp;<span class="ident" id="8478011">runtime</span><span class="op" id="8478018">.</span><span class="ident" id="8478019">GOOS</span>&nbsp;<span class="op" id="8478024">==</span>&nbsp;<span class="string" id="8478027">&#34;nacl&#34;</span>&nbsp;<span class="op" id="8478034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478038">t</span><span class="op" id="8478039">.</span><span class="ident" id="8478040">Skip</span><span class="op" id="8478044">(</span><span class="string" id="8478045">&#34;WriteHeapDump&nbsp;is&nbsp;not&nbsp;available&nbsp;on&nbsp;NaCl.&#34;</span><span class="op" id="8478086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8478089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478092">f</span><span class="op" id="8478093">,</span>&nbsp;<span class="ident" id="8478095">err</span>&nbsp;<span class="op" id="8478099">:=</span>&nbsp;<span class="ident" id="8478102">ioutil</span><span class="op" id="8478108">.</span><span class="ident" id="8478109">TempFile</span><span class="op" id="8478117">(</span><span class="string" id="8478118">&#34;&#34;</span><span class="op" id="8478120">,</span>&nbsp;<span class="string" id="8478122">&#34;heapdumptest&#34;</span><span class="op" id="8478136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8478139">if</span>&nbsp;<span class="ident" id="8478142">err</span>&nbsp;<span class="op" id="8478146">!=</span>&nbsp;<span class="ident" id="8478149">nil</span>&nbsp;<span class="op" id="8478153">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478157">t</span><span class="op" id="8478158">.</span><span class="ident" id="8478159">Fatalf</span><span class="op" id="8478165">(</span><span class="string" id="8478166">&#34;TempFile&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8478187">,</span>&nbsp;<span class="ident" id="8478189">err</span><span class="op" id="8478192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8478195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8478198">defer</span>&nbsp;<span class="ident" id="8478204">os</span><span class="op" id="8478206">.</span><span class="ident" id="8478207">Remove</span><span class="op" id="8478213">(</span><span class="ident" id="8478214">f</span><span class="op" id="8478215">.</span><span class="ident" id="8478216">Name</span><span class="op" id="8478220">(</span><span class="op" id="8478221">)</span><span class="op" id="8478222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8478225">defer</span>&nbsp;<span class="ident" id="8478231">f</span><span class="op" id="8478232">.</span><span class="ident" id="8478233">Close</span><span class="op" id="8478238">(</span><span class="op" id="8478239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478242">WriteHeapDump</span><span class="op" id="8478255">(</span><span class="ident" id="8478256">f</span><span class="op" id="8478257">.</span><span class="ident" id="8478258">Fd</span><span class="op" id="8478260">(</span><span class="op" id="8478261">)</span><span class="op" id="8478262">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478265">fi</span><span class="op" id="8478267">,</span>&nbsp;<span class="ident" id="8478269">err</span>&nbsp;<span class="op" id="8478273">:=</span>&nbsp;<span class="ident" id="8478276">f</span><span class="op" id="8478277">.</span><span class="ident" id="8478278">Stat</span><span class="op" id="8478282">(</span><span class="op" id="8478283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8478286">if</span>&nbsp;<span class="ident" id="8478289">err</span>&nbsp;<span class="op" id="8478293">!=</span>&nbsp;<span class="ident" id="8478296">nil</span>&nbsp;<span class="op" id="8478300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478304">t</span><span class="op" id="8478305">.</span><span class="ident" id="8478306">Fatalf</span><span class="op" id="8478312">(</span><span class="string" id="8478313">&#34;Stat&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8478330">,</span>&nbsp;<span class="ident" id="8478332">err</span><span class="op" id="8478335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8478338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8478341">const</span>&nbsp;<span class="ident" id="8478347">minSize</span>&nbsp;<span class="op" id="8478355">=</span>&nbsp;<span class="num" id="8478357">1</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8478360">if</span>&nbsp;<span class="ident" id="8478363">size</span>&nbsp;<span class="op" id="8478368">:=</span>&nbsp;<span class="ident" id="8478371">fi</span><span class="op" id="8478373">.</span><span class="ident" id="8478374">Size</span><span class="op" id="8478378">(</span><span class="op" id="8478379">)</span><span class="op" id="8478380">;</span>&nbsp;<span class="ident" id="8478382">size</span>&nbsp;<span class="op" id="8478387">&lt;</span>&nbsp;<span class="ident" id="8478389">minSize</span>&nbsp;<span class="op" id="8478397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478401">t</span><span class="op" id="8478402">.</span><span class="ident" id="8478403">Fatalf</span><span class="op" id="8478409">(</span><span class="string" id="8478410">&#34;Heap&nbsp;dump&nbsp;size&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;at&nbsp;least&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="8478463">,</span>&nbsp;<span class="ident" id="8478465">size</span><span class="op" id="8478469">,</span>&nbsp;<span class="ident" id="8478471">minSize</span><span class="op" id="8478478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8478481">}</span><br>
<span class="lineno"></span><span class="op" id="8478483">}</span>
</div>
</body>
</html>
