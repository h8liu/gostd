<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4723932">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4723987">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4724041">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4724092">package</span>&nbsp;<span class="ident" id="4724100">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4724105">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;PSS&nbsp;signature&nbsp;scheme&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="4724159">//</span><br>
<span class="lineno"></span><span class="comment" id="4724162">//&nbsp;[1]&nbsp;http://www.rsa.com/rsalabs/pkcs/files/h11300-wp-pkcs-1v2-2-rsa-cryptography-standard.pdf</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4724259">import</span>&nbsp;<span class="op" id="4724266">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4724269">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4724278">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4724288">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4724298">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4724306">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4724312">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4724323">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4724326">func</span>&nbsp;<span class="ident" id="4724331">emsaPSSEncode</span><span class="op" id="4724344">(</span><span class="ident" id="4724345">mHash</span>&nbsp;<span class="op" id="4724351">[</span><span class="op" id="4724352">]</span><span class="builtintype" id="4724353">byte</span><span class="op" id="4724357">,</span>&nbsp;<span class="ident" id="4724359">emBits</span>&nbsp;<span class="builtintype" id="4724366">int</span><span class="op" id="4724369">,</span>&nbsp;<span class="ident" id="4724371">salt</span>&nbsp;<span class="op" id="4724376">[</span><span class="op" id="4724377">]</span><span class="builtintype" id="4724378">byte</span><span class="op" id="4724382">,</span>&nbsp;<span class="ident" id="4724384">hash</span>&nbsp;<span class="ident" id="4724389">hash</span><span class="op" id="4724393">.</span><span class="ident" id="4724394">Hash</span><span class="op" id="4724398">)</span>&nbsp;<span class="op" id="4724400">(</span><span class="op" id="4724401">[</span><span class="op" id="4724402">]</span><span class="builtintype" id="4724403">byte</span><span class="op" id="4724407">,</span>&nbsp;<span class="builtintype" id="4724409">error</span><span class="op" id="4724414">)</span>&nbsp;<span class="op" id="4724416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4724419">//&nbsp;See&nbsp;[1],&nbsp;section&nbsp;9.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4724446">hLen</span>&nbsp;<span class="op" id="4724451">:=</span>&nbsp;<span class="ident" id="4724454">hash</span><span class="op" id="4724458">.</span><span class="ident" id="4724459">Size</span><span class="op" id="4724463">(</span><span class="op" id="4724464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4724467">sLen</span>&nbsp;<span class="op" id="4724472">:=</span>&nbsp;<span class="builtinfunc" id="4724475">len</span><span class="op" id="4724478">(</span><span class="ident" id="4724479">salt</span><span class="op" id="4724483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4724486">emLen</span>&nbsp;<span class="op" id="4724492">:=</span>&nbsp;<span class="op" id="4724495">(</span><span class="ident" id="4724496">emBits</span>&nbsp;<span class="op" id="4724503">+</span>&nbsp;<span class="num" id="4724505">7</span><span class="op" id="4724506">)</span>&nbsp;<span class="op" id="4724508">/</span>&nbsp;<span class="num" id="4724510">8</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4724514">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4724586">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;message&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4724657">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4724681">//</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4724685">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4724747">if</span>&nbsp;<span class="builtinfunc" id="4724750">len</span><span class="op" id="4724753">(</span><span class="ident" id="4724754">mHash</span><span class="op" id="4724759">)</span>&nbsp;<span class="op" id="4724761">!=</span>&nbsp;<span class="ident" id="4724764">hLen</span>&nbsp;<span class="op" id="4724769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4724773">return</span>&nbsp;<span class="ident" id="4724780">nil</span><span class="op" id="4724783">,</span>&nbsp;<span class="ident" id="4724785">errors</span><span class="op" id="4724791">.</span><span class="ident" id="4724792">New</span><span class="op" id="4724795">(</span><span class="string" id="4724796">&#34;crypto/rsa:&nbsp;input&nbsp;must&nbsp;be&nbsp;hashed&nbsp;message&#34;</span><span class="op" id="4724838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4724841">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4724845">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;encoding&nbsp;error&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4724916">if</span>&nbsp;<span class="ident" id="4724919">emLen</span>&nbsp;<span class="op" id="4724925">&lt;</span>&nbsp;<span class="ident" id="4724927">hLen</span><span class="op" id="4724931">+</span><span class="ident" id="4724932">sLen</span><span class="op" id="4724936">+</span><span class="num" id="4724937">2</span>&nbsp;<span class="op" id="4724939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4724943">return</span>&nbsp;<span class="ident" id="4724950">nil</span><span class="op" id="4724953">,</span>&nbsp;<span class="ident" id="4724955">errors</span><span class="op" id="4724961">.</span><span class="ident" id="4724962">New</span><span class="op" id="4724965">(</span><span class="string" id="4724966">&#34;crypto/rsa:&nbsp;encoding&nbsp;error&#34;</span><span class="op" id="4724994">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4724997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4725001">em</span>&nbsp;<span class="op" id="4725004">:=</span>&nbsp;<span class="builtinfunc" id="4725007">make</span><span class="op" id="4725011">(</span><span class="op" id="4725012">[</span><span class="op" id="4725013">]</span><span class="builtintype" id="4725014">byte</span><span class="op" id="4725018">,</span>&nbsp;<span class="ident" id="4725020">emLen</span><span class="op" id="4725025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4725028">db</span>&nbsp;<span class="op" id="4725031">:=</span>&nbsp;<span class="ident" id="4725034">em</span><span class="op" id="4725036">[</span><span class="op" id="4725037">:</span><span class="ident" id="4725038">emLen</span><span class="op" id="4725043">-</span><span class="ident" id="4725044">sLen</span><span class="op" id="4725048">-</span><span class="ident" id="4725049">hLen</span><span class="op" id="4725053">-</span><span class="num" id="4725054">2</span><span class="op" id="4725055">+</span><span class="num" id="4725056">1</span><span class="op" id="4725057">+</span><span class="ident" id="4725058">sLen</span><span class="op" id="4725062">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4725065">h</span>&nbsp;<span class="op" id="4725067">:=</span>&nbsp;<span class="ident" id="4725070">em</span><span class="op" id="4725072">[</span><span class="ident" id="4725073">emLen</span><span class="op" id="4725078">-</span><span class="ident" id="4725079">sLen</span><span class="op" id="4725083">-</span><span class="ident" id="4725084">hLen</span><span class="op" id="4725088">-</span><span class="num" id="4725089">2</span><span class="op" id="4725090">+</span><span class="num" id="4725091">1</span><span class="op" id="4725092">+</span><span class="ident" id="4725093">sLen</span>&nbsp;<span class="op" id="4725098">:</span>&nbsp;<span class="ident" id="4725100">emLen</span><span class="op" id="4725105">-</span><span class="num" id="4725106">1</span><span class="op" id="4725107">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725111">//&nbsp;4.&nbsp;&nbsp;Generate&nbsp;a&nbsp;random&nbsp;octet&nbsp;string&nbsp;salt&nbsp;of&nbsp;length&nbsp;sLen;&nbsp;if&nbsp;sLen&nbsp;=&nbsp;0,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725184">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;salt&nbsp;is&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725223">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725227">//&nbsp;5.&nbsp;&nbsp;Let</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725239">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725300">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725304">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725371">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725400">//</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725404">//&nbsp;6.&nbsp;&nbsp;Let&nbsp;H&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4725463">var</span>&nbsp;<span class="ident" id="4725467">prefix</span>&nbsp;<span class="op" id="4725474">[</span><span class="num" id="4725475">8</span><span class="op" id="4725476">]</span><span class="builtintype" id="4725477">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4725484">hash</span><span class="op" id="4725488">.</span><span class="ident" id="4725489">Write</span><span class="op" id="4725494">(</span><span class="ident" id="4725495">prefix</span><span class="op" id="4725501">[</span><span class="op" id="4725502">:</span><span class="op" id="4725503">]</span><span class="op" id="4725504">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4725507">hash</span><span class="op" id="4725511">.</span><span class="ident" id="4725512">Write</span><span class="op" id="4725517">(</span><span class="ident" id="4725518">mHash</span><span class="op" id="4725523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4725526">hash</span><span class="op" id="4725530">.</span><span class="ident" id="4725531">Write</span><span class="op" id="4725536">(</span><span class="ident" id="4725537">salt</span><span class="op" id="4725541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4725545">h</span>&nbsp;<span class="op" id="4725547">=</span>&nbsp;<span class="ident" id="4725549">hash</span><span class="op" id="4725553">.</span><span class="ident" id="4725554">Sum</span><span class="op" id="4725557">(</span><span class="ident" id="4725558">h</span><span class="op" id="4725559">[</span><span class="op" id="4725560">:</span><span class="num" id="4725561">0</span><span class="op" id="4725562">]</span><span class="op" id="4725563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4725566">hash</span><span class="op" id="4725570">.</span><span class="ident" id="4725571">Reset</span><span class="op" id="4725576">(</span><span class="op" id="4725577">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725581">//&nbsp;7.&nbsp;&nbsp;Generate&nbsp;an&nbsp;octet&nbsp;string&nbsp;PS&nbsp;consisting&nbsp;of&nbsp;emLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725655">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zero&nbsp;octets.&nbsp;&nbsp;The&nbsp;length&nbsp;of&nbsp;PS&nbsp;may&nbsp;be&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725704">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725708">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;PS&nbsp;||&nbsp;0x01&nbsp;||&nbsp;salt;&nbsp;DB&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725777">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4725804">db</span><span class="op" id="4725806">[</span><span class="ident" id="4725807">emLen</span><span class="op" id="4725812">-</span><span class="ident" id="4725813">sLen</span><span class="op" id="4725817">-</span><span class="ident" id="4725818">hLen</span><span class="op" id="4725822">-</span><span class="num" id="4725823">2</span><span class="op" id="4725824">]</span>&nbsp;<span class="op" id="4725826">=</span>&nbsp;<span class="num" id="4725828">0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4725834">copy</span><span class="op" id="4725838">(</span><span class="ident" id="4725839">db</span><span class="op" id="4725841">[</span><span class="ident" id="4725842">emLen</span><span class="op" id="4725847">-</span><span class="ident" id="4725848">sLen</span><span class="op" id="4725852">-</span><span class="ident" id="4725853">hLen</span><span class="op" id="4725857">-</span><span class="num" id="4725858">1</span><span class="op" id="4725859">:</span><span class="op" id="4725860">]</span><span class="op" id="4725861">,</span>&nbsp;<span class="ident" id="4725863">salt</span><span class="op" id="4725867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725871">//&nbsp;9.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725918">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725922">//&nbsp;10.&nbsp;Let&nbsp;maskedDB&nbsp;=&nbsp;DB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4725962">mgf1XOR</span><span class="op" id="4725969">(</span><span class="ident" id="4725970">db</span><span class="op" id="4725972">,</span>&nbsp;<span class="ident" id="4725974">hash</span><span class="op" id="4725978">,</span>&nbsp;<span class="ident" id="4725980">h</span><span class="op" id="4725981">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4725985">//&nbsp;11.&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4726059">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4726086">db</span><span class="op" id="4726088">[</span><span class="num" id="4726089">0</span><span class="op" id="4726090">]</span>&nbsp;<span class="op" id="4726092">&amp;=</span>&nbsp;<span class="op" id="4726095">(</span><span class="num" id="4726096">0xFF</span>&nbsp;<span class="op" id="4726101">&gt;&gt;</span>&nbsp;<span class="builtintype" id="4726104">uint</span><span class="op" id="4726108">(</span><span class="num" id="4726109">8</span><span class="op" id="4726110">*</span><span class="ident" id="4726111">emLen</span><span class="op" id="4726116">-</span><span class="ident" id="4726117">emBits</span><span class="op" id="4726123">)</span><span class="op" id="4726124">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4726128">//&nbsp;12.&nbsp;Let&nbsp;EM&nbsp;=&nbsp;maskedDB&nbsp;||&nbsp;H&nbsp;||&nbsp;0xbc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4726168">em</span><span class="op" id="4726170">[</span><span class="ident" id="4726171">emLen</span><span class="op" id="4726176">-</span><span class="num" id="4726177">1</span><span class="op" id="4726178">]</span>&nbsp;<span class="op" id="4726180">=</span>&nbsp;<span class="num" id="4726182">0xBC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4726189">//&nbsp;13.&nbsp;Output&nbsp;EM.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4726208">return</span>&nbsp;<span class="ident" id="4726215">em</span><span class="op" id="4726217">,</span>&nbsp;<span class="ident" id="4726219">nil</span><br>
<span class="lineno"></span><span class="op" id="4726223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4726226">func</span>&nbsp;<span class="ident" id="4726231">emsaPSSVerify</span><span class="op" id="4726244">(</span><span class="ident" id="4726245">mHash</span><span class="op" id="4726250">,</span>&nbsp;<span class="ident" id="4726252">em</span>&nbsp;<span class="op" id="4726255">[</span><span class="op" id="4726256">]</span><span class="builtintype" id="4726257">byte</span><span class="op" id="4726261">,</span>&nbsp;<span class="ident" id="4726263">emBits</span><span class="op" id="4726269">,</span>&nbsp;<span class="ident" id="4726271">sLen</span>&nbsp;<span class="builtintype" id="4726276">int</span><span class="op" id="4726279">,</span>&nbsp;<span class="ident" id="4726281">hash</span>&nbsp;<span class="ident" id="4726286">hash</span><span class="op" id="4726290">.</span><span class="ident" id="4726291">Hash</span><span class="op" id="4726295">)</span>&nbsp;<span class="builtintype" id="4726297">error</span>&nbsp;<span class="op" id="4726303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4726306">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4726378">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;inconsistent&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4726451">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4726469">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4726473">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4726534">hLen</span>&nbsp;<span class="op" id="4726539">:=</span>&nbsp;<span class="ident" id="4726542">hash</span><span class="op" id="4726546">.</span><span class="ident" id="4726547">Size</span><span class="op" id="4726551">(</span><span class="op" id="4726552">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4726555">if</span>&nbsp;<span class="ident" id="4726558">hLen</span>&nbsp;<span class="op" id="4726563">!=</span>&nbsp;<span class="builtinfunc" id="4726566">len</span><span class="op" id="4726569">(</span><span class="ident" id="4726570">mHash</span><span class="op" id="4726575">)</span>&nbsp;<span class="op" id="4726577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4726581">return</span>&nbsp;<span class="ident" id="4726588">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4726605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4726609">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4726677">emLen</span>&nbsp;<span class="op" id="4726683">:=</span>&nbsp;<span class="op" id="4726686">(</span><span class="ident" id="4726687">emBits</span>&nbsp;<span class="op" id="4726694">+</span>&nbsp;<span class="num" id="4726696">7</span><span class="op" id="4726697">)</span>&nbsp;<span class="op" id="4726699">/</span>&nbsp;<span class="num" id="4726701">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4726704">if</span>&nbsp;<span class="ident" id="4726707">emLen</span>&nbsp;<span class="op" id="4726713">&lt;</span>&nbsp;<span class="ident" id="4726715">hLen</span><span class="op" id="4726719">+</span><span class="ident" id="4726720">sLen</span><span class="op" id="4726724">+</span><span class="num" id="4726725">2</span>&nbsp;<span class="op" id="4726727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4726731">return</span>&nbsp;<span class="ident" id="4726738">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4726755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4726759">//&nbsp;4.&nbsp;&nbsp;If&nbsp;the&nbsp;rightmost&nbsp;octet&nbsp;of&nbsp;EM&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4726828">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbc,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4726874">if</span>&nbsp;<span class="ident" id="4726877">em</span><span class="op" id="4726879">[</span><span class="builtinfunc" id="4726880">len</span><span class="op" id="4726883">(</span><span class="ident" id="4726884">em</span><span class="op" id="4726886">)</span><span class="op" id="4726887">-</span><span class="num" id="4726888">1</span><span class="op" id="4726889">]</span>&nbsp;<span class="op" id="4726891">!=</span>&nbsp;<span class="num" id="4726894">0xBC</span>&nbsp;<span class="op" id="4726899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4726903">return</span>&nbsp;<span class="ident" id="4726910">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4726927">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4726931">//&nbsp;5.&nbsp;&nbsp;Let&nbsp;maskedDB&nbsp;be&nbsp;the&nbsp;leftmost&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1&nbsp;octets&nbsp;of&nbsp;EM,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4727003">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;H&nbsp;be&nbsp;the&nbsp;next&nbsp;hLen&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4727042">db</span>&nbsp;<span class="op" id="4727045">:=</span>&nbsp;<span class="ident" id="4727048">em</span><span class="op" id="4727050">[</span><span class="op" id="4727051">:</span><span class="ident" id="4727052">emLen</span><span class="op" id="4727057">-</span><span class="ident" id="4727058">hLen</span><span class="op" id="4727062">-</span><span class="num" id="4727063">1</span><span class="op" id="4727064">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4727067">h</span>&nbsp;<span class="op" id="4727069">:=</span>&nbsp;<span class="ident" id="4727072">em</span><span class="op" id="4727074">[</span><span class="ident" id="4727075">emLen</span><span class="op" id="4727080">-</span><span class="ident" id="4727081">hLen</span><span class="op" id="4727085">-</span><span class="num" id="4727086">1</span>&nbsp;<span class="op" id="4727088">:</span>&nbsp;<span class="builtinfunc" id="4727090">len</span><span class="op" id="4727093">(</span><span class="ident" id="4727094">em</span><span class="op" id="4727096">)</span><span class="op" id="4727097">-</span><span class="num" id="4727098">1</span><span class="op" id="4727099">]</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4727103">//&nbsp;6.&nbsp;&nbsp;If&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4727176">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;are&nbsp;not&nbsp;all&nbsp;equal&nbsp;to&nbsp;zero,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4727246">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4727260">if</span>&nbsp;<span class="ident" id="4727263">em</span><span class="op" id="4727265">[</span><span class="num" id="4727266">0</span><span class="op" id="4727267">]</span><span class="op" id="4727268">&amp;</span><span class="op" id="4727269">(</span><span class="num" id="4727270">0xFF</span><span class="op" id="4727274">&lt;&lt;</span><span class="builtintype" id="4727276">uint</span><span class="op" id="4727280">(</span><span class="num" id="4727281">8</span><span class="op" id="4727282">-</span><span class="op" id="4727283">(</span><span class="num" id="4727284">8</span><span class="op" id="4727285">*</span><span class="ident" id="4727286">emLen</span><span class="op" id="4727291">-</span><span class="ident" id="4727292">emBits</span><span class="op" id="4727298">)</span><span class="op" id="4727299">)</span><span class="op" id="4727300">)</span>&nbsp;<span class="op" id="4727302">!=</span>&nbsp;<span class="num" id="4727305">0</span>&nbsp;<span class="op" id="4727307">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4727311">return</span>&nbsp;<span class="ident" id="4727318">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4727335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4727339">//&nbsp;7.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4727386">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4727390">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;maskedDB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4727429">mgf1XOR</span><span class="op" id="4727436">(</span><span class="ident" id="4727437">db</span><span class="op" id="4727439">,</span>&nbsp;<span class="ident" id="4727441">hash</span><span class="op" id="4727445">,</span>&nbsp;<span class="ident" id="4727447">h</span><span class="op" id="4727448">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4727452">//&nbsp;9.&nbsp;&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in&nbsp;DB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4727529">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;zero.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4727546">db</span><span class="op" id="4727548">[</span><span class="num" id="4727549">0</span><span class="op" id="4727550">]</span>&nbsp;<span class="op" id="4727552">&amp;=</span>&nbsp;<span class="op" id="4727555">(</span><span class="num" id="4727556">0xFF</span>&nbsp;<span class="op" id="4727561">&gt;&gt;</span>&nbsp;<span class="builtintype" id="4727564">uint</span><span class="op" id="4727568">(</span><span class="num" id="4727569">8</span><span class="op" id="4727570">*</span><span class="ident" id="4727571">emLen</span><span class="op" id="4727576">-</span><span class="ident" id="4727577">emBits</span><span class="op" id="4727583">)</span><span class="op" id="4727584">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4727588">if</span>&nbsp;<span class="ident" id="4727591">sLen</span>&nbsp;<span class="op" id="4727596">==</span>&nbsp;<span class="ident" id="4727599">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="4727617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4727620">FindSaltLength</span><span class="op" id="4727634">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4727638">for</span>&nbsp;<span class="ident" id="4727642">sLen</span>&nbsp;<span class="op" id="4727647">=</span>&nbsp;<span class="ident" id="4727649">emLen</span>&nbsp;<span class="op" id="4727655">-</span>&nbsp;<span class="op" id="4727657">(</span><span class="ident" id="4727658">hLen</span>&nbsp;<span class="op" id="4727663">+</span>&nbsp;<span class="num" id="4727665">2</span><span class="op" id="4727666">)</span><span class="op" id="4727667">;</span>&nbsp;<span class="ident" id="4727669">sLen</span>&nbsp;<span class="op" id="4727674">&gt;=</span>&nbsp;<span class="num" id="4727677">0</span><span class="op" id="4727678">;</span>&nbsp;<span class="ident" id="4727680">sLen</span><span class="op" id="4727684">--</span>&nbsp;<span class="op" id="4727687">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4727692">switch</span>&nbsp;<span class="ident" id="4727699">db</span><span class="op" id="4727701">[</span><span class="ident" id="4727702">emLen</span><span class="op" id="4727707">-</span><span class="ident" id="4727708">hLen</span><span class="op" id="4727712">-</span><span class="ident" id="4727713">sLen</span><span class="op" id="4727717">-</span><span class="num" id="4727718">2</span><span class="op" id="4727719">]</span>&nbsp;<span class="op" id="4727721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4727726">case</span>&nbsp;<span class="num" id="4727731">1</span><span class="op" id="4727732">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4727738">break</span>&nbsp;<span class="ident" id="4727744">FindSaltLength</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4727762">case</span>&nbsp;<span class="num" id="4727767">0</span><span class="op" id="4727768">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4727774">continue</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4727786">default</span><span class="op" id="4727793">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4727799">return</span>&nbsp;<span class="ident" id="4727806">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4727825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4727829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4727833">if</span>&nbsp;<span class="ident" id="4727836">sLen</span>&nbsp;<span class="op" id="4727841">&lt;</span>&nbsp;<span class="num" id="4727843">0</span>&nbsp;<span class="op" id="4727845">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4727850">return</span>&nbsp;<span class="ident" id="4727857">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4727875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4727878">}</span>&nbsp;<span class="keyword" id="4727880">else</span>&nbsp;<span class="op" id="4727885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4727889">//&nbsp;10.&nbsp;If&nbsp;the&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;2&nbsp;leftmost&nbsp;octets&nbsp;of&nbsp;DB&nbsp;are&nbsp;not&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4727964">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;if&nbsp;the&nbsp;octet&nbsp;at&nbsp;position&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;1&nbsp;(the&nbsp;leftmost</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4728039">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;is&nbsp;&#34;position&nbsp;1&#34;)&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value&nbsp;0x01,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4728112">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4728153">for</span>&nbsp;<span class="ident" id="4728157">_</span><span class="op" id="4728158">,</span>&nbsp;<span class="ident" id="4728160">e</span>&nbsp;<span class="op" id="4728162">:=</span>&nbsp;<span class="keyword" id="4728165">range</span>&nbsp;<span class="ident" id="4728171">db</span><span class="op" id="4728173">[</span><span class="op" id="4728174">:</span><span class="ident" id="4728175">emLen</span><span class="op" id="4728180">-</span><span class="ident" id="4728181">hLen</span><span class="op" id="4728185">-</span><span class="ident" id="4728186">sLen</span><span class="op" id="4728190">-</span><span class="num" id="4728191">2</span><span class="op" id="4728192">]</span>&nbsp;<span class="op" id="4728194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4728199">if</span>&nbsp;<span class="ident" id="4728202">e</span>&nbsp;<span class="op" id="4728204">!=</span>&nbsp;<span class="num" id="4728207">0x00</span>&nbsp;<span class="op" id="4728212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4728218">return</span>&nbsp;<span class="ident" id="4728225">ErrVerification</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4728244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4728248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4728252">if</span>&nbsp;<span class="ident" id="4728255">db</span><span class="op" id="4728257">[</span><span class="ident" id="4728258">emLen</span><span class="op" id="4728263">-</span><span class="ident" id="4728264">hLen</span><span class="op" id="4728268">-</span><span class="ident" id="4728269">sLen</span><span class="op" id="4728273">-</span><span class="num" id="4728274">2</span><span class="op" id="4728275">]</span>&nbsp;<span class="op" id="4728277">!=</span>&nbsp;<span class="num" id="4728280">0x01</span>&nbsp;<span class="op" id="4728285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4728290">return</span>&nbsp;<span class="ident" id="4728297">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4728315">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4728318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4728322">//&nbsp;11.&nbsp;&nbsp;Let&nbsp;salt&nbsp;be&nbsp;the&nbsp;last&nbsp;sLen&nbsp;octets&nbsp;of&nbsp;DB.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4728371">salt</span>&nbsp;<span class="op" id="4728376">:=</span>&nbsp;<span class="ident" id="4728379">db</span><span class="op" id="4728381">[</span><span class="builtinfunc" id="4728382">len</span><span class="op" id="4728385">(</span><span class="ident" id="4728386">db</span><span class="op" id="4728388">)</span><span class="op" id="4728389">-</span><span class="ident" id="4728390">sLen</span><span class="op" id="4728394">:</span><span class="op" id="4728395">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4728399">//&nbsp;12.&nbsp;&nbsp;Let</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4728412">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt&nbsp;;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4728477">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4728544">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4728573">//</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4728577">//&nbsp;13.&nbsp;Let&nbsp;H&#39;&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4728636">var</span>&nbsp;<span class="ident" id="4728640">prefix</span>&nbsp;<span class="op" id="4728647">[</span><span class="num" id="4728648">8</span><span class="op" id="4728649">]</span><span class="builtintype" id="4728650">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4728656">hash</span><span class="op" id="4728660">.</span><span class="ident" id="4728661">Write</span><span class="op" id="4728666">(</span><span class="ident" id="4728667">prefix</span><span class="op" id="4728673">[</span><span class="op" id="4728674">:</span><span class="op" id="4728675">]</span><span class="op" id="4728676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4728679">hash</span><span class="op" id="4728683">.</span><span class="ident" id="4728684">Write</span><span class="op" id="4728689">(</span><span class="ident" id="4728690">mHash</span><span class="op" id="4728695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4728698">hash</span><span class="op" id="4728702">.</span><span class="ident" id="4728703">Write</span><span class="op" id="4728708">(</span><span class="ident" id="4728709">salt</span><span class="op" id="4728713">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4728717">h0</span>&nbsp;<span class="op" id="4728720">:=</span>&nbsp;<span class="ident" id="4728723">hash</span><span class="op" id="4728727">.</span><span class="ident" id="4728728">Sum</span><span class="op" id="4728731">(</span><span class="ident" id="4728732">nil</span><span class="op" id="4728735">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4728739">//&nbsp;14.&nbsp;If&nbsp;H&nbsp;=&nbsp;H&#39;,&nbsp;output&nbsp;&#34;consistent.&#34;&nbsp;Otherwise,&nbsp;output&nbsp;&#34;inconsistent.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4728813">if</span>&nbsp;<span class="op" id="4728816">!</span><span class="ident" id="4728817">bytes</span><span class="op" id="4728822">.</span><span class="ident" id="4728823">Equal</span><span class="op" id="4728828">(</span><span class="ident" id="4728829">h0</span><span class="op" id="4728831">,</span>&nbsp;<span class="ident" id="4728833">h</span><span class="op" id="4728834">)</span>&nbsp;<span class="op" id="4728836">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4728840">return</span>&nbsp;<span class="ident" id="4728847">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4728864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4728867">return</span>&nbsp;<span class="ident" id="4728874">nil</span><br>
<span class="lineno"></span><span class="op" id="4728878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4728881">//&nbsp;signPSSWithSalt&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;PSS&nbsp;[1]&nbsp;with&nbsp;specified&nbsp;salt.</span><br>
<span class="lineno"></span><span class="comment" id="4728970">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4729048">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;salt&nbsp;is&nbsp;a&nbsp;random&nbsp;sequence&nbsp;of&nbsp;bytes&nbsp;whose&nbsp;length&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4729128">//&nbsp;later&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="4729167">func</span>&nbsp;<span class="ident" id="4729172">signPSSWithSalt</span><span class="op" id="4729187">(</span><span class="ident" id="4729188">rand</span>&nbsp;<span class="ident" id="4729193">io</span><span class="op" id="4729195">.</span><span class="ident" id="4729196">Reader</span><span class="op" id="4729202">,</span>&nbsp;<span class="ident" id="4729204">priv</span>&nbsp;<span class="op" id="4729209">*</span><span class="ident" id="4729210">PrivateKey</span><span class="op" id="4729220">,</span>&nbsp;<span class="ident" id="4729222">hash</span>&nbsp;<span class="ident" id="4729227">crypto</span><span class="op" id="4729233">.</span><span class="ident" id="4729234">Hash</span><span class="op" id="4729238">,</span>&nbsp;<span class="ident" id="4729240">hashed</span><span class="op" id="4729246">,</span>&nbsp;<span class="ident" id="4729248">salt</span>&nbsp;<span class="op" id="4729253">[</span><span class="op" id="4729254">]</span><span class="builtintype" id="4729255">byte</span><span class="op" id="4729259">)</span>&nbsp;<span class="op" id="4729261">(</span><span class="ident" id="4729262">s</span>&nbsp;<span class="op" id="4729264">[</span><span class="op" id="4729265">]</span><span class="builtintype" id="4729266">byte</span><span class="op" id="4729270">,</span>&nbsp;<span class="ident" id="4729272">err</span>&nbsp;<span class="builtintype" id="4729276">error</span><span class="op" id="4729281">)</span>&nbsp;<span class="op" id="4729283">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729286">nBits</span>&nbsp;<span class="op" id="4729292">:=</span>&nbsp;<span class="ident" id="4729295">priv</span><span class="op" id="4729299">.</span><span class="ident" id="4729300">N</span><span class="op" id="4729301">.</span><span class="ident" id="4729302">BitLen</span><span class="op" id="4729308">(</span><span class="op" id="4729309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729312">em</span><span class="op" id="4729314">,</span>&nbsp;<span class="ident" id="4729316">err</span>&nbsp;<span class="op" id="4729320">:=</span>&nbsp;<span class="ident" id="4729323">emsaPSSEncode</span><span class="op" id="4729336">(</span><span class="ident" id="4729337">hashed</span><span class="op" id="4729343">,</span>&nbsp;<span class="ident" id="4729345">nBits</span><span class="op" id="4729350">-</span><span class="num" id="4729351">1</span><span class="op" id="4729352">,</span>&nbsp;<span class="ident" id="4729354">salt</span><span class="op" id="4729358">,</span>&nbsp;<span class="ident" id="4729360">hash</span><span class="op" id="4729364">.</span><span class="ident" id="4729365">New</span><span class="op" id="4729368">(</span><span class="op" id="4729369">)</span><span class="op" id="4729370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4729373">if</span>&nbsp;<span class="ident" id="4729376">err</span>&nbsp;<span class="op" id="4729380">!=</span>&nbsp;<span class="ident" id="4729383">nil</span>&nbsp;<span class="op" id="4729387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4729391">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4729399">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729402">m</span>&nbsp;<span class="op" id="4729404">:=</span>&nbsp;<span class="builtinfunc" id="4729407">new</span><span class="op" id="4729410">(</span><span class="ident" id="4729411">big</span><span class="op" id="4729414">.</span><span class="ident" id="4729415">Int</span><span class="op" id="4729418">)</span><span class="op" id="4729419">.</span><span class="ident" id="4729420">SetBytes</span><span class="op" id="4729428">(</span><span class="ident" id="4729429">em</span><span class="op" id="4729431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729434">c</span><span class="op" id="4729435">,</span>&nbsp;<span class="ident" id="4729437">err</span>&nbsp;<span class="op" id="4729441">:=</span>&nbsp;<span class="ident" id="4729444">decrypt</span><span class="op" id="4729451">(</span><span class="ident" id="4729452">rand</span><span class="op" id="4729456">,</span>&nbsp;<span class="ident" id="4729458">priv</span><span class="op" id="4729462">,</span>&nbsp;<span class="ident" id="4729464">m</span><span class="op" id="4729465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4729468">if</span>&nbsp;<span class="ident" id="4729471">err</span>&nbsp;<span class="op" id="4729475">!=</span>&nbsp;<span class="ident" id="4729478">nil</span>&nbsp;<span class="op" id="4729482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4729486">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4729494">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729497">s</span>&nbsp;<span class="op" id="4729499">=</span>&nbsp;<span class="builtinfunc" id="4729501">make</span><span class="op" id="4729505">(</span><span class="op" id="4729506">[</span><span class="op" id="4729507">]</span><span class="builtintype" id="4729508">byte</span><span class="op" id="4729512">,</span>&nbsp;<span class="op" id="4729514">(</span><span class="ident" id="4729515">nBits</span><span class="op" id="4729520">+</span><span class="num" id="4729521">7</span><span class="op" id="4729522">)</span><span class="op" id="4729523">/</span><span class="num" id="4729524">8</span><span class="op" id="4729525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729528">copyWithLeftPad</span><span class="op" id="4729543">(</span><span class="ident" id="4729544">s</span><span class="op" id="4729545">,</span>&nbsp;<span class="ident" id="4729547">c</span><span class="op" id="4729548">.</span><span class="ident" id="4729549">Bytes</span><span class="op" id="4729554">(</span><span class="op" id="4729555">)</span><span class="op" id="4729556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4729559">return</span><br>
<span class="lineno"></span><span class="op" id="4729566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="4729569">const</span>&nbsp;<span class="op" id="4729575">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4729578">//&nbsp;PSSSaltLengthAuto&nbsp;causes&nbsp;the&nbsp;salt&nbsp;in&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;to&nbsp;be&nbsp;as&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4729650">//&nbsp;as&nbsp;possible&nbsp;when&nbsp;signing,&nbsp;and&nbsp;to&nbsp;be&nbsp;auto-detected&nbsp;when&nbsp;verifying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729720">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="4729738">=</span>&nbsp;<span class="num" id="4729740">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4729743">//&nbsp;PSSSaltLengthEqualsHash&nbsp;causes&nbsp;the&nbsp;salt&nbsp;length&nbsp;to&nbsp;equal&nbsp;the&nbsp;length</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4729814">//&nbsp;of&nbsp;the&nbsp;hash&nbsp;used&nbsp;in&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729853">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="4729877">=</span>&nbsp;<span class="op" id="4729879">-</span><span class="num" id="4729880">1</span><br>
<span class="lineno"></span><span class="op" id="4729882">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4729885">//&nbsp;PSSOptions&nbsp;contains&nbsp;options&nbsp;for&nbsp;creating&nbsp;and&nbsp;verifying&nbsp;PSS&nbsp;signatures.</span><br>
<span class="lineno">220</span><span class="keyword" id="4729959">type</span>&nbsp;<span class="ident" id="4729964">PSSOptions</span>&nbsp;<span class="keyword" id="4729975">struct</span>&nbsp;<span class="op" id="4729982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4729985">//&nbsp;SaltLength&nbsp;controls&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;salt&nbsp;used&nbsp;in&nbsp;the&nbsp;PSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4730048">//&nbsp;signature.&nbsp;It&nbsp;can&nbsp;either&nbsp;be&nbsp;a&nbsp;number&nbsp;of&nbsp;bytes,&nbsp;or&nbsp;one&nbsp;of&nbsp;the&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4730121">//&nbsp;PSSSaltLength&nbsp;constants.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4730150">SaltLength</span>&nbsp;<span class="builtintype" id="4730161">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4730167">//&nbsp;Hash,&nbsp;if&nbsp;not&nbsp;zero,&nbsp;overrides&nbsp;the&nbsp;hash&nbsp;function&nbsp;passed&nbsp;to&nbsp;SignPSS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4730237">//&nbsp;This&nbsp;is&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;specify&nbsp;the&nbsp;hash&nbsp;function&nbsp;when&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4730306">//&nbsp;crypto.Signer&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4730335">Hash</span>&nbsp;<span class="ident" id="4730340">crypto</span><span class="op" id="4730346">.</span><span class="ident" id="4730347">Hash</span><br>
<span class="lineno">230</span><span class="op" id="4730352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4730355">//&nbsp;HashFunc&nbsp;returns&nbsp;pssOpts.Hash&nbsp;so&nbsp;that&nbsp;PSSOptions&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="4730418">//&nbsp;crypto.SignerOpts.</span><br>
<span class="lineno"></span><span class="keyword" id="4730440">func</span>&nbsp;<span class="op" id="4730445">(</span><span class="ident" id="4730446">pssOpts</span>&nbsp;<span class="op" id="4730454">*</span><span class="ident" id="4730455">PSSOptions</span><span class="op" id="4730465">)</span>&nbsp;<span class="ident" id="4730467">HashFunc</span><span class="op" id="4730475">(</span><span class="op" id="4730476">)</span>&nbsp;<span class="ident" id="4730478">crypto</span><span class="op" id="4730484">.</span><span class="ident" id="4730485">Hash</span>&nbsp;<span class="op" id="4730490">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4730493">return</span>&nbsp;<span class="ident" id="4730500">pssOpts</span><span class="op" id="4730507">.</span><span class="ident" id="4730508">Hash</span><br>
<span class="lineno"></span><span class="op" id="4730513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4730516">func</span>&nbsp;<span class="op" id="4730521">(</span><span class="ident" id="4730522">opts</span>&nbsp;<span class="op" id="4730527">*</span><span class="ident" id="4730528">PSSOptions</span><span class="op" id="4730538">)</span>&nbsp;<span class="ident" id="4730540">saltLength</span><span class="op" id="4730550">(</span><span class="op" id="4730551">)</span>&nbsp;<span class="builtintype" id="4730553">int</span>&nbsp;<span class="op" id="4730557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4730560">if</span>&nbsp;<span class="ident" id="4730563">opts</span>&nbsp;<span class="op" id="4730568">==</span>&nbsp;<span class="ident" id="4730571">nil</span>&nbsp;<span class="op" id="4730575">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4730579">return</span>&nbsp;<span class="ident" id="4730586">PSSSaltLengthAuto</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4730605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4730608">return</span>&nbsp;<span class="ident" id="4730615">opts</span><span class="op" id="4730619">.</span><span class="ident" id="4730620">SaltLength</span><br>
<span class="lineno"></span><span class="op" id="4730631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="4730634">//&nbsp;SignPSS&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;RSASSA-PSS&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="4730702">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4730780">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="4730857">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4730879">func</span>&nbsp;<span class="ident" id="4730884">SignPSS</span><span class="op" id="4730891">(</span><span class="ident" id="4730892">rand</span>&nbsp;<span class="ident" id="4730897">io</span><span class="op" id="4730899">.</span><span class="ident" id="4730900">Reader</span><span class="op" id="4730906">,</span>&nbsp;<span class="ident" id="4730908">priv</span>&nbsp;<span class="op" id="4730913">*</span><span class="ident" id="4730914">PrivateKey</span><span class="op" id="4730924">,</span>&nbsp;<span class="ident" id="4730926">hash</span>&nbsp;<span class="ident" id="4730931">crypto</span><span class="op" id="4730937">.</span><span class="ident" id="4730938">Hash</span><span class="op" id="4730942">,</span>&nbsp;<span class="ident" id="4730944">hashed</span>&nbsp;<span class="op" id="4730951">[</span><span class="op" id="4730952">]</span><span class="builtintype" id="4730953">byte</span><span class="op" id="4730957">,</span>&nbsp;<span class="ident" id="4730959">opts</span>&nbsp;<span class="op" id="4730964">*</span><span class="ident" id="4730965">PSSOptions</span><span class="op" id="4730975">)</span>&nbsp;<span class="op" id="4730977">(</span><span class="ident" id="4730978">s</span>&nbsp;<span class="op" id="4730980">[</span><span class="op" id="4730981">]</span><span class="builtintype" id="4730982">byte</span><span class="op" id="4730986">,</span>&nbsp;<span class="ident" id="4730988">err</span>&nbsp;<span class="builtintype" id="4730992">error</span><span class="op" id="4730997">)</span>&nbsp;<span class="op" id="4730999">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4731002">saltLength</span>&nbsp;<span class="op" id="4731013">:=</span>&nbsp;<span class="ident" id="4731016">opts</span><span class="op" id="4731020">.</span><span class="ident" id="4731021">saltLength</span><span class="op" id="4731031">(</span><span class="op" id="4731032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731035">switch</span>&nbsp;<span class="ident" id="4731042">saltLength</span>&nbsp;<span class="op" id="4731053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731056">case</span>&nbsp;<span class="ident" id="4731061">PSSSaltLengthAuto</span><span class="op" id="4731078">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4731082">saltLength</span>&nbsp;<span class="op" id="4731093">=</span>&nbsp;<span class="op" id="4731095">(</span><span class="ident" id="4731096">priv</span><span class="op" id="4731100">.</span><span class="ident" id="4731101">N</span><span class="op" id="4731102">.</span><span class="ident" id="4731103">BitLen</span><span class="op" id="4731109">(</span><span class="op" id="4731110">)</span><span class="op" id="4731111">+</span><span class="num" id="4731112">7</span><span class="op" id="4731113">)</span><span class="op" id="4731114">/</span><span class="num" id="4731115">8</span>&nbsp;<span class="op" id="4731117">-</span>&nbsp;<span class="num" id="4731119">2</span>&nbsp;<span class="op" id="4731121">-</span>&nbsp;<span class="ident" id="4731123">hash</span><span class="op" id="4731127">.</span><span class="ident" id="4731128">Size</span><span class="op" id="4731132">(</span><span class="op" id="4731133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731136">case</span>&nbsp;<span class="ident" id="4731141">PSSSaltLengthEqualsHash</span><span class="op" id="4731164">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4731168">saltLength</span>&nbsp;<span class="op" id="4731179">=</span>&nbsp;<span class="ident" id="4731181">hash</span><span class="op" id="4731185">.</span><span class="ident" id="4731186">Size</span><span class="op" id="4731190">(</span><span class="op" id="4731191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4731194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731198">if</span>&nbsp;<span class="ident" id="4731201">opts</span><span class="op" id="4731205">.</span><span class="ident" id="4731206">Hash</span>&nbsp;<span class="op" id="4731211">!=</span>&nbsp;<span class="num" id="4731214">0</span>&nbsp;<span class="op" id="4731216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4731220">hash</span>&nbsp;<span class="op" id="4731225">=</span>&nbsp;<span class="ident" id="4731227">opts</span><span class="op" id="4731231">.</span><span class="ident" id="4731232">Hash</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4731238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4731242">salt</span>&nbsp;<span class="op" id="4731247">:=</span>&nbsp;<span class="builtinfunc" id="4731250">make</span><span class="op" id="4731254">(</span><span class="op" id="4731255">[</span><span class="op" id="4731256">]</span><span class="builtintype" id="4731257">byte</span><span class="op" id="4731261">,</span>&nbsp;<span class="ident" id="4731263">saltLength</span><span class="op" id="4731273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731276">if</span>&nbsp;<span class="ident" id="4731279">_</span><span class="op" id="4731280">,</span>&nbsp;<span class="ident" id="4731282">err</span>&nbsp;<span class="op" id="4731286">=</span>&nbsp;<span class="ident" id="4731288">io</span><span class="op" id="4731290">.</span><span class="ident" id="4731291">ReadFull</span><span class="op" id="4731299">(</span><span class="ident" id="4731300">rand</span><span class="op" id="4731304">,</span>&nbsp;<span class="ident" id="4731306">salt</span><span class="op" id="4731310">)</span><span class="op" id="4731311">;</span>&nbsp;<span class="ident" id="4731313">err</span>&nbsp;<span class="op" id="4731317">!=</span>&nbsp;<span class="ident" id="4731320">nil</span>&nbsp;<span class="op" id="4731324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731328">return</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4731336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731339">return</span>&nbsp;<span class="ident" id="4731346">signPSSWithSalt</span><span class="op" id="4731361">(</span><span class="ident" id="4731362">rand</span><span class="op" id="4731366">,</span>&nbsp;<span class="ident" id="4731368">priv</span><span class="op" id="4731372">,</span>&nbsp;<span class="ident" id="4731374">hash</span><span class="op" id="4731378">,</span>&nbsp;<span class="ident" id="4731380">hashed</span><span class="op" id="4731386">,</span>&nbsp;<span class="ident" id="4731388">salt</span><span class="op" id="4731392">)</span><br>
<span class="lineno"></span><span class="op" id="4731394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4731397">//&nbsp;VerifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature.</span><br>
<span class="lineno">270</span><span class="comment" id="4731436">//&nbsp;hashed&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the&nbsp;given&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="4731510">//&nbsp;function&nbsp;and&nbsp;sig&nbsp;is&nbsp;the&nbsp;signature.&nbsp;A&nbsp;valid&nbsp;signature&nbsp;is&nbsp;indicated&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4731582">//&nbsp;returning&nbsp;a&nbsp;nil&nbsp;error.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="4731661">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4731683">func</span>&nbsp;<span class="ident" id="4731688">VerifyPSS</span><span class="op" id="4731697">(</span><span class="ident" id="4731698">pub</span>&nbsp;<span class="op" id="4731702">*</span><span class="ident" id="4731703">PublicKey</span><span class="op" id="4731712">,</span>&nbsp;<span class="ident" id="4731714">hash</span>&nbsp;<span class="ident" id="4731719">crypto</span><span class="op" id="4731725">.</span><span class="ident" id="4731726">Hash</span><span class="op" id="4731730">,</span>&nbsp;<span class="ident" id="4731732">hashed</span>&nbsp;<span class="op" id="4731739">[</span><span class="op" id="4731740">]</span><span class="builtintype" id="4731741">byte</span><span class="op" id="4731745">,</span>&nbsp;<span class="ident" id="4731747">sig</span>&nbsp;<span class="op" id="4731751">[</span><span class="op" id="4731752">]</span><span class="builtintype" id="4731753">byte</span><span class="op" id="4731757">,</span>&nbsp;<span class="ident" id="4731759">opts</span>&nbsp;<span class="op" id="4731764">*</span><span class="ident" id="4731765">PSSOptions</span><span class="op" id="4731775">)</span>&nbsp;<span class="builtintype" id="4731777">error</span>&nbsp;<span class="op" id="4731783">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731786">return</span>&nbsp;<span class="ident" id="4731793">verifyPSS</span><span class="op" id="4731802">(</span><span class="ident" id="4731803">pub</span><span class="op" id="4731806">,</span>&nbsp;<span class="ident" id="4731808">hash</span><span class="op" id="4731812">,</span>&nbsp;<span class="ident" id="4731814">hashed</span><span class="op" id="4731820">,</span>&nbsp;<span class="ident" id="4731822">sig</span><span class="op" id="4731825">,</span>&nbsp;<span class="ident" id="4731827">opts</span><span class="op" id="4731831">.</span><span class="ident" id="4731832">saltLength</span><span class="op" id="4731842">(</span><span class="op" id="4731843">)</span><span class="op" id="4731844">)</span><br>
<span class="lineno"></span><span class="op" id="4731846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4731849">//&nbsp;verifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;with&nbsp;the&nbsp;given&nbsp;salt&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="4731915">func</span>&nbsp;<span class="ident" id="4731920">verifyPSS</span><span class="op" id="4731929">(</span><span class="ident" id="4731930">pub</span>&nbsp;<span class="op" id="4731934">*</span><span class="ident" id="4731935">PublicKey</span><span class="op" id="4731944">,</span>&nbsp;<span class="ident" id="4731946">hash</span>&nbsp;<span class="ident" id="4731951">crypto</span><span class="op" id="4731957">.</span><span class="ident" id="4731958">Hash</span><span class="op" id="4731962">,</span>&nbsp;<span class="ident" id="4731964">hashed</span>&nbsp;<span class="op" id="4731971">[</span><span class="op" id="4731972">]</span><span class="builtintype" id="4731973">byte</span><span class="op" id="4731977">,</span>&nbsp;<span class="ident" id="4731979">sig</span>&nbsp;<span class="op" id="4731983">[</span><span class="op" id="4731984">]</span><span class="builtintype" id="4731985">byte</span><span class="op" id="4731989">,</span>&nbsp;<span class="ident" id="4731991">saltLen</span>&nbsp;<span class="builtintype" id="4731999">int</span><span class="op" id="4732002">)</span>&nbsp;<span class="builtintype" id="4732004">error</span>&nbsp;<span class="op" id="4732010">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732013">nBits</span>&nbsp;<span class="op" id="4732019">:=</span>&nbsp;<span class="ident" id="4732022">pub</span><span class="op" id="4732025">.</span><span class="ident" id="4732026">N</span><span class="op" id="4732027">.</span><span class="ident" id="4732028">BitLen</span><span class="op" id="4732034">(</span><span class="op" id="4732035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732038">if</span>&nbsp;<span class="builtinfunc" id="4732041">len</span><span class="op" id="4732044">(</span><span class="ident" id="4732045">sig</span><span class="op" id="4732048">)</span>&nbsp;<span class="op" id="4732050">!=</span>&nbsp;<span class="op" id="4732053">(</span><span class="ident" id="4732054">nBits</span><span class="op" id="4732059">+</span><span class="num" id="4732060">7</span><span class="op" id="4732061">)</span><span class="op" id="4732062">/</span><span class="num" id="4732063">8</span>&nbsp;<span class="op" id="4732065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732069">return</span>&nbsp;<span class="ident" id="4732076">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4732093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732096">s</span>&nbsp;<span class="op" id="4732098">:=</span>&nbsp;<span class="builtinfunc" id="4732101">new</span><span class="op" id="4732104">(</span><span class="ident" id="4732105">big</span><span class="op" id="4732108">.</span><span class="ident" id="4732109">Int</span><span class="op" id="4732112">)</span><span class="op" id="4732113">.</span><span class="ident" id="4732114">SetBytes</span><span class="op" id="4732122">(</span><span class="ident" id="4732123">sig</span><span class="op" id="4732126">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732129">m</span>&nbsp;<span class="op" id="4732131">:=</span>&nbsp;<span class="ident" id="4732134">encrypt</span><span class="op" id="4732141">(</span><span class="builtinfunc" id="4732142">new</span><span class="op" id="4732145">(</span><span class="ident" id="4732146">big</span><span class="op" id="4732149">.</span><span class="ident" id="4732150">Int</span><span class="op" id="4732153">)</span><span class="op" id="4732154">,</span>&nbsp;<span class="ident" id="4732156">pub</span><span class="op" id="4732159">,</span>&nbsp;<span class="ident" id="4732161">s</span><span class="op" id="4732162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732165">emBits</span>&nbsp;<span class="op" id="4732172">:=</span>&nbsp;<span class="ident" id="4732175">nBits</span>&nbsp;<span class="op" id="4732181">-</span>&nbsp;<span class="num" id="4732183">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732186">emLen</span>&nbsp;<span class="op" id="4732192">:=</span>&nbsp;<span class="op" id="4732195">(</span><span class="ident" id="4732196">emBits</span>&nbsp;<span class="op" id="4732203">+</span>&nbsp;<span class="num" id="4732205">7</span><span class="op" id="4732206">)</span>&nbsp;<span class="op" id="4732208">/</span>&nbsp;<span class="num" id="4732210">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732213">if</span>&nbsp;<span class="ident" id="4732216">emLen</span>&nbsp;<span class="op" id="4732222">&lt;</span>&nbsp;<span class="builtinfunc" id="4732224">len</span><span class="op" id="4732227">(</span><span class="ident" id="4732228">m</span><span class="op" id="4732229">.</span><span class="ident" id="4732230">Bytes</span><span class="op" id="4732235">(</span><span class="op" id="4732236">)</span><span class="op" id="4732237">)</span>&nbsp;<span class="op" id="4732239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732243">return</span>&nbsp;<span class="ident" id="4732250">ErrVerification</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4732267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732270">em</span>&nbsp;<span class="op" id="4732273">:=</span>&nbsp;<span class="builtinfunc" id="4732276">make</span><span class="op" id="4732280">(</span><span class="op" id="4732281">[</span><span class="op" id="4732282">]</span><span class="builtintype" id="4732283">byte</span><span class="op" id="4732287">,</span>&nbsp;<span class="ident" id="4732289">emLen</span><span class="op" id="4732294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732297">copyWithLeftPad</span><span class="op" id="4732312">(</span><span class="ident" id="4732313">em</span><span class="op" id="4732315">,</span>&nbsp;<span class="ident" id="4732317">m</span><span class="op" id="4732318">.</span><span class="ident" id="4732319">Bytes</span><span class="op" id="4732324">(</span><span class="op" id="4732325">)</span><span class="op" id="4732326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732329">if</span>&nbsp;<span class="ident" id="4732332">saltLen</span>&nbsp;<span class="op" id="4732340">==</span>&nbsp;<span class="ident" id="4732343">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="4732367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732371">saltLen</span>&nbsp;<span class="op" id="4732379">=</span>&nbsp;<span class="ident" id="4732381">hash</span><span class="op" id="4732385">.</span><span class="ident" id="4732386">Size</span><span class="op" id="4732390">(</span><span class="op" id="4732391">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4732394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732397">return</span>&nbsp;<span class="ident" id="4732404">emsaPSSVerify</span><span class="op" id="4732417">(</span><span class="ident" id="4732418">hashed</span><span class="op" id="4732424">,</span>&nbsp;<span class="ident" id="4732426">em</span><span class="op" id="4732428">,</span>&nbsp;<span class="ident" id="4732430">emBits</span><span class="op" id="4732436">,</span>&nbsp;<span class="ident" id="4732438">saltLen</span><span class="op" id="4732445">,</span>&nbsp;<span class="ident" id="4732447">hash</span><span class="op" id="4732451">.</span><span class="ident" id="4732452">New</span><span class="op" id="4732455">(</span><span class="op" id="4732456">)</span><span class="op" id="4732457">)</span><br>
<span class="lineno"></span><span class="op" id="4732459">}</span>
</div>
</body>
</html>
