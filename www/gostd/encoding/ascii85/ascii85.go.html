<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html" class="current">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5544868">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5544923">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5544977">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5545028">//&nbsp;Package&nbsp;ascii85&nbsp;implements&nbsp;the&nbsp;ascii85&nbsp;data&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="5545084">//&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;btoa&nbsp;tool&nbsp;and&nbsp;Adobe&#39;s&nbsp;PostScript&nbsp;and&nbsp;PDF&nbsp;document&nbsp;formats.</span><br>
<span class="lineno"></span><span class="keyword" id="5545161">package</span>&nbsp;<span class="ident" id="5545169">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5545178">import</span>&nbsp;<span class="op" id="5545185">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5545188">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5545194">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="5545204">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5545207">/*<br>
<span class="lineno">15</span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5545226">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;into&nbsp;at&nbsp;most&nbsp;MaxEncodedLen(len(src))</span><br>
<span class="lineno"></span><span class="comment" id="5545285">//&nbsp;bytes&nbsp;of&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;actual&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">20</span><span class="comment" id="5545348">//</span><br>
<span class="lineno"></span><span class="comment" id="5545351">//&nbsp;The&nbsp;encoding&nbsp;handles&nbsp;4-byte&nbsp;chunks,&nbsp;using&nbsp;a&nbsp;special&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="5545415">//&nbsp;for&nbsp;the&nbsp;last&nbsp;fragment,&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="5545481">//&nbsp;individual&nbsp;blocks&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5545553">//</span><br>
<span class="lineno">25</span><span class="comment" id="5545556">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="5545620">//&nbsp;Encode&nbsp;does&nbsp;not&nbsp;add&nbsp;these.</span><br>
<span class="lineno"></span><span class="keyword" id="5545650">func</span>&nbsp;<span class="ident" id="5545655">Encode</span><span class="op" id="5545661">(</span><span class="ident" id="5545662">dst</span><span class="op" id="5545665">,</span>&nbsp;<span class="ident" id="5545667">src</span>&nbsp;<span class="op" id="5545671">[</span><span class="op" id="5545672">]</span><span class="builtintype" id="5545673">byte</span><span class="op" id="5545677">)</span>&nbsp;<span class="builtintype" id="5545679">int</span>&nbsp;<span class="op" id="5545683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5545686">if</span>&nbsp;<span class="builtinfunc" id="5545689">len</span><span class="op" id="5545692">(</span><span class="ident" id="5545693">src</span><span class="op" id="5545696">)</span>&nbsp;<span class="op" id="5545698">==</span>&nbsp;<span class="num" id="5545701">0</span>&nbsp;<span class="op" id="5545703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5545707">return</span>&nbsp;<span class="num" id="5545714">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5545717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5545721">n</span>&nbsp;<span class="op" id="5545723">:=</span>&nbsp;<span class="num" id="5545726">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5545729">for</span>&nbsp;<span class="builtinfunc" id="5545733">len</span><span class="op" id="5545736">(</span><span class="ident" id="5545737">src</span><span class="op" id="5545740">)</span>&nbsp;<span class="op" id="5545742">&gt;</span>&nbsp;<span class="num" id="5545744">0</span>&nbsp;<span class="op" id="5545746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5545750">dst</span><span class="op" id="5545753">[</span><span class="num" id="5545754">0</span><span class="op" id="5545755">]</span>&nbsp;<span class="op" id="5545757">=</span>&nbsp;<span class="num" id="5545759">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5545763">dst</span><span class="op" id="5545766">[</span><span class="num" id="5545767">1</span><span class="op" id="5545768">]</span>&nbsp;<span class="op" id="5545770">=</span>&nbsp;<span class="num" id="5545772">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5545776">dst</span><span class="op" id="5545779">[</span><span class="num" id="5545780">2</span><span class="op" id="5545781">]</span>&nbsp;<span class="op" id="5545783">=</span>&nbsp;<span class="num" id="5545785">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5545789">dst</span><span class="op" id="5545792">[</span><span class="num" id="5545793">3</span><span class="op" id="5545794">]</span>&nbsp;<span class="op" id="5545796">=</span>&nbsp;<span class="num" id="5545798">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5545802">dst</span><span class="op" id="5545805">[</span><span class="num" id="5545806">4</span><span class="op" id="5545807">]</span>&nbsp;<span class="op" id="5545809">=</span>&nbsp;<span class="num" id="5545811">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5545816">//&nbsp;Unpack&nbsp;4&nbsp;bytes&nbsp;into&nbsp;uint32&nbsp;to&nbsp;repack&nbsp;into&nbsp;base&nbsp;85&nbsp;5-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5545879">var</span>&nbsp;<span class="ident" id="5545883">v</span>&nbsp;<span class="builtintype" id="5545885">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5545894">switch</span>&nbsp;<span class="builtinfunc" id="5545901">len</span><span class="op" id="5545904">(</span><span class="ident" id="5545905">src</span><span class="op" id="5545908">)</span>&nbsp;<span class="op" id="5545910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5545914">default</span><span class="op" id="5545921">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5545926">v</span>&nbsp;<span class="op" id="5545928">|=</span>&nbsp;<span class="builtintype" id="5545931">uint32</span><span class="op" id="5545937">(</span><span class="ident" id="5545938">src</span><span class="op" id="5545941">[</span><span class="num" id="5545942">3</span><span class="op" id="5545943">]</span><span class="op" id="5545944">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5545949">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5545963">case</span>&nbsp;<span class="num" id="5545968">3</span><span class="op" id="5545969">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5545974">v</span>&nbsp;<span class="op" id="5545976">|=</span>&nbsp;<span class="builtintype" id="5545979">uint32</span><span class="op" id="5545985">(</span><span class="ident" id="5545986">src</span><span class="op" id="5545989">[</span><span class="num" id="5545990">2</span><span class="op" id="5545991">]</span><span class="op" id="5545992">)</span>&nbsp;<span class="op" id="5545994">&lt;&lt;</span>&nbsp;<span class="num" id="5545997">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5546002">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5546016">case</span>&nbsp;<span class="num" id="5546021">2</span><span class="op" id="5546022">:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546027">v</span>&nbsp;<span class="op" id="5546029">|=</span>&nbsp;<span class="builtintype" id="5546032">uint32</span><span class="op" id="5546038">(</span><span class="ident" id="5546039">src</span><span class="op" id="5546042">[</span><span class="num" id="5546043">1</span><span class="op" id="5546044">]</span><span class="op" id="5546045">)</span>&nbsp;<span class="op" id="5546047">&lt;&lt;</span>&nbsp;<span class="num" id="5546050">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5546056">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5546070">case</span>&nbsp;<span class="num" id="5546075">1</span><span class="op" id="5546076">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546081">v</span>&nbsp;<span class="op" id="5546083">|=</span>&nbsp;<span class="builtintype" id="5546086">uint32</span><span class="op" id="5546092">(</span><span class="ident" id="5546093">src</span><span class="op" id="5546096">[</span><span class="num" id="5546097">0</span><span class="op" id="5546098">]</span><span class="op" id="5546099">)</span>&nbsp;<span class="op" id="5546101">&lt;&lt;</span>&nbsp;<span class="num" id="5546104">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546109">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5546114">//&nbsp;Special&nbsp;case:&nbsp;zero&nbsp;(!!!!!)&nbsp;shortens&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5546161">if</span>&nbsp;<span class="ident" id="5546164">v</span>&nbsp;<span class="op" id="5546166">==</span>&nbsp;<span class="num" id="5546169">0</span>&nbsp;<span class="op" id="5546171">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5546174">len</span><span class="op" id="5546177">(</span><span class="ident" id="5546178">src</span><span class="op" id="5546181">)</span>&nbsp;<span class="op" id="5546183">&gt;=</span>&nbsp;<span class="num" id="5546186">4</span>&nbsp;<span class="op" id="5546188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546193">dst</span><span class="op" id="5546196">[</span><span class="num" id="5546197">0</span><span class="op" id="5546198">]</span>&nbsp;<span class="op" id="5546200">=</span>&nbsp;<span class="string" id="5546202">&#39;z&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546209">dst</span>&nbsp;<span class="op" id="5546213">=</span>&nbsp;<span class="ident" id="5546215">dst</span><span class="op" id="5546218">[</span><span class="num" id="5546219">1</span><span class="op" id="5546220">:</span><span class="op" id="5546221">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546226">src</span>&nbsp;<span class="op" id="5546230">=</span>&nbsp;<span class="ident" id="5546232">src</span><span class="op" id="5546235">[</span><span class="num" id="5546236">4</span><span class="op" id="5546237">:</span><span class="op" id="5546238">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546243">n</span><span class="op" id="5546244">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5546250">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5546266">//&nbsp;Otherwise,&nbsp;5&nbsp;base&nbsp;85&nbsp;digits&nbsp;starting&nbsp;at&nbsp;!.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5546314">for</span>&nbsp;<span class="ident" id="5546318">i</span>&nbsp;<span class="op" id="5546320">:=</span>&nbsp;<span class="num" id="5546323">4</span><span class="op" id="5546324">;</span>&nbsp;<span class="ident" id="5546326">i</span>&nbsp;<span class="op" id="5546328">&gt;=</span>&nbsp;<span class="num" id="5546331">0</span><span class="op" id="5546332">;</span>&nbsp;<span class="ident" id="5546334">i</span><span class="op" id="5546335">--</span>&nbsp;<span class="op" id="5546338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546343">dst</span><span class="op" id="5546346">[</span><span class="ident" id="5546347">i</span><span class="op" id="5546348">]</span>&nbsp;<span class="op" id="5546350">=</span>&nbsp;<span class="string" id="5546352">&#39;!&#39;</span>&nbsp;<span class="op" id="5546356">+</span>&nbsp;<span class="builtintype" id="5546358">byte</span><span class="op" id="5546362">(</span><span class="ident" id="5546363">v</span><span class="op" id="5546364">%</span><span class="num" id="5546365">85</span><span class="op" id="5546367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546372">v</span>&nbsp;<span class="op" id="5546374">/=</span>&nbsp;<span class="num" id="5546377">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546382">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5546387">//&nbsp;If&nbsp;src&nbsp;was&nbsp;short,&nbsp;discard&nbsp;the&nbsp;low&nbsp;destination&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546445">m</span>&nbsp;<span class="op" id="5546447">:=</span>&nbsp;<span class="num" id="5546450">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5546454">if</span>&nbsp;<span class="builtinfunc" id="5546457">len</span><span class="op" id="5546460">(</span><span class="ident" id="5546461">src</span><span class="op" id="5546464">)</span>&nbsp;<span class="op" id="5546466">&lt;</span>&nbsp;<span class="num" id="5546468">4</span>&nbsp;<span class="op" id="5546470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546475">m</span>&nbsp;<span class="op" id="5546477">-=</span>&nbsp;<span class="num" id="5546480">4</span>&nbsp;<span class="op" id="5546482">-</span>&nbsp;<span class="builtinfunc" id="5546484">len</span><span class="op" id="5546487">(</span><span class="ident" id="5546488">src</span><span class="op" id="5546491">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546496">src</span>&nbsp;<span class="op" id="5546500">=</span>&nbsp;<span class="builtintype" id="5546502">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546508">}</span>&nbsp;<span class="keyword" id="5546510">else</span>&nbsp;<span class="op" id="5546515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546520">src</span>&nbsp;<span class="op" id="5546524">=</span>&nbsp;<span class="ident" id="5546526">src</span><span class="op" id="5546529">[</span><span class="num" id="5546530">4</span><span class="op" id="5546531">:</span><span class="op" id="5546532">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546540">dst</span>&nbsp;<span class="op" id="5546544">=</span>&nbsp;<span class="ident" id="5546546">dst</span><span class="op" id="5546549">[</span><span class="ident" id="5546550">m</span><span class="op" id="5546551">:</span><span class="op" id="5546552">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546556">n</span>&nbsp;<span class="op" id="5546558">+=</span>&nbsp;<span class="ident" id="5546561">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5546567">return</span>&nbsp;<span class="ident" id="5546574">n</span><br>
<span class="lineno"></span><span class="op" id="5546576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5546579">//&nbsp;MaxEncodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;an&nbsp;encoding&nbsp;of&nbsp;n&nbsp;source&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5546657">func</span>&nbsp;<span class="ident" id="5546662">MaxEncodedLen</span><span class="op" id="5546675">(</span><span class="ident" id="5546676">n</span>&nbsp;<span class="builtintype" id="5546678">int</span><span class="op" id="5546681">)</span>&nbsp;<span class="builtintype" id="5546683">int</span>&nbsp;<span class="op" id="5546687">{</span>&nbsp;<span class="keyword" id="5546689">return</span>&nbsp;<span class="op" id="5546696">(</span><span class="ident" id="5546697">n</span>&nbsp;<span class="op" id="5546699">+</span>&nbsp;<span class="num" id="5546701">3</span><span class="op" id="5546702">)</span>&nbsp;<span class="op" id="5546704">/</span>&nbsp;<span class="num" id="5546706">4</span>&nbsp;<span class="op" id="5546708">*</span>&nbsp;<span class="num" id="5546710">5</span>&nbsp;<span class="op" id="5546712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5546715">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5546784">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">90</span><span class="comment" id="5546846">//&nbsp;Ascii85&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;32-bit&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="5546907">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5546975">//&nbsp;trailing&nbsp;partial&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="5547002">func</span>&nbsp;<span class="ident" id="5547007">NewEncoder</span><span class="op" id="5547017">(</span><span class="ident" id="5547018">w</span>&nbsp;<span class="ident" id="5547020">io</span><span class="op" id="5547022">.</span><span class="ident" id="5547023">Writer</span><span class="op" id="5547029">)</span>&nbsp;<span class="ident" id="5547031">io</span><span class="op" id="5547033">.</span><span class="ident" id="5547034">WriteCloser</span>&nbsp;<span class="op" id="5547046">{</span>&nbsp;<span class="keyword" id="5547048">return</span>&nbsp;<span class="op" id="5547055">&amp;</span><span class="ident" id="5547056">encoder</span><span class="op" id="5547063">{</span><span class="ident" id="5547064">w</span><span class="op" id="5547065">:</span>&nbsp;<span class="ident" id="5547067">w</span><span class="op" id="5547068">}</span>&nbsp;<span class="op" id="5547070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5547073">type</span>&nbsp;<span class="ident" id="5547078">encoder</span>&nbsp;<span class="keyword" id="5547086">struct</span>&nbsp;<span class="op" id="5547093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547096">err</span>&nbsp;&nbsp;<span class="builtintype" id="5547101">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547108">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547113">io</span><span class="op" id="5547115">.</span><span class="ident" id="5547116">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547124">buf</span>&nbsp;&nbsp;<span class="op" id="5547129">[</span><span class="num" id="5547130">4</span><span class="op" id="5547131">]</span><span class="builtintype" id="5547132">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5547140">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547180">nbuf</span>&nbsp;<span class="builtintype" id="5547185">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5547196">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547223">out</span>&nbsp;&nbsp;<span class="op" id="5547228">[</span><span class="num" id="5547229">1024</span><span class="op" id="5547233">]</span><span class="builtintype" id="5547234">byte</span>&nbsp;<span class="comment" id="5547239">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="5547256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5547259">func</span>&nbsp;<span class="op" id="5547264">(</span><span class="ident" id="5547265">e</span>&nbsp;<span class="op" id="5547267">*</span><span class="ident" id="5547268">encoder</span><span class="op" id="5547275">)</span>&nbsp;<span class="ident" id="5547277">Write</span><span class="op" id="5547282">(</span><span class="ident" id="5547283">p</span>&nbsp;<span class="op" id="5547285">[</span><span class="op" id="5547286">]</span><span class="builtintype" id="5547287">byte</span><span class="op" id="5547291">)</span>&nbsp;<span class="op" id="5547293">(</span><span class="ident" id="5547294">n</span>&nbsp;<span class="builtintype" id="5547296">int</span><span class="op" id="5547299">,</span>&nbsp;<span class="ident" id="5547301">err</span>&nbsp;<span class="builtintype" id="5547305">error</span><span class="op" id="5547310">)</span>&nbsp;<span class="op" id="5547312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547315">if</span>&nbsp;<span class="ident" id="5547318">e</span><span class="op" id="5547319">.</span><span class="ident" id="5547320">err</span>&nbsp;<span class="op" id="5547324">!=</span>&nbsp;<span class="builtintype" id="5547327">nil</span>&nbsp;<span class="op" id="5547331">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547335">return</span>&nbsp;<span class="num" id="5547342">0</span><span class="op" id="5547343">,</span>&nbsp;<span class="ident" id="5547345">e</span><span class="op" id="5547346">.</span><span class="ident" id="5547347">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5547352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5547356">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547376">if</span>&nbsp;<span class="ident" id="5547379">e</span><span class="op" id="5547380">.</span><span class="ident" id="5547381">nbuf</span>&nbsp;<span class="op" id="5547386">&gt;</span>&nbsp;<span class="num" id="5547388">0</span>&nbsp;<span class="op" id="5547390">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547394">var</span>&nbsp;<span class="ident" id="5547398">i</span>&nbsp;<span class="builtintype" id="5547400">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547406">for</span>&nbsp;<span class="ident" id="5547410">i</span>&nbsp;<span class="op" id="5547412">=</span>&nbsp;<span class="num" id="5547414">0</span><span class="op" id="5547415">;</span>&nbsp;<span class="ident" id="5547417">i</span>&nbsp;<span class="op" id="5547419">&lt;</span>&nbsp;<span class="builtinfunc" id="5547421">len</span><span class="op" id="5547424">(</span><span class="ident" id="5547425">p</span><span class="op" id="5547426">)</span>&nbsp;<span class="op" id="5547428">&amp;&amp;</span>&nbsp;<span class="ident" id="5547431">e</span><span class="op" id="5547432">.</span><span class="ident" id="5547433">nbuf</span>&nbsp;<span class="op" id="5547438">&lt;</span>&nbsp;<span class="num" id="5547440">4</span><span class="op" id="5547441">;</span>&nbsp;<span class="ident" id="5547443">i</span><span class="op" id="5547444">++</span>&nbsp;<span class="op" id="5547447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547452">e</span><span class="op" id="5547453">.</span><span class="ident" id="5547454">buf</span><span class="op" id="5547457">[</span><span class="ident" id="5547458">e</span><span class="op" id="5547459">.</span><span class="ident" id="5547460">nbuf</span><span class="op" id="5547464">]</span>&nbsp;<span class="op" id="5547466">=</span>&nbsp;<span class="ident" id="5547468">p</span><span class="op" id="5547469">[</span><span class="ident" id="5547470">i</span><span class="op" id="5547471">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547476">e</span><span class="op" id="5547477">.</span><span class="ident" id="5547478">nbuf</span><span class="op" id="5547482">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5547487">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547491">n</span>&nbsp;<span class="op" id="5547493">+=</span>&nbsp;<span class="ident" id="5547496">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547500">p</span>&nbsp;<span class="op" id="5547502">=</span>&nbsp;<span class="ident" id="5547504">p</span><span class="op" id="5547505">[</span><span class="ident" id="5547506">i</span><span class="op" id="5547507">:</span><span class="op" id="5547508">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547512">if</span>&nbsp;<span class="ident" id="5547515">e</span><span class="op" id="5547516">.</span><span class="ident" id="5547517">nbuf</span>&nbsp;<span class="op" id="5547522">&lt;</span>&nbsp;<span class="num" id="5547524">4</span>&nbsp;<span class="op" id="5547526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547531">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5547540">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547544">nout</span>&nbsp;<span class="op" id="5547549">:=</span>&nbsp;<span class="ident" id="5547552">Encode</span><span class="op" id="5547558">(</span><span class="ident" id="5547559">e</span><span class="op" id="5547560">.</span><span class="ident" id="5547561">out</span><span class="op" id="5547564">[</span><span class="num" id="5547565">0</span><span class="op" id="5547566">:</span><span class="op" id="5547567">]</span><span class="op" id="5547568">,</span>&nbsp;<span class="ident" id="5547570">e</span><span class="op" id="5547571">.</span><span class="ident" id="5547572">buf</span><span class="op" id="5547575">[</span><span class="num" id="5547576">0</span><span class="op" id="5547577">:</span><span class="op" id="5547578">]</span><span class="op" id="5547579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547583">if</span>&nbsp;<span class="ident" id="5547586">_</span><span class="op" id="5547587">,</span>&nbsp;<span class="ident" id="5547589">e</span><span class="op" id="5547590">.</span><span class="ident" id="5547591">err</span>&nbsp;<span class="op" id="5547595">=</span>&nbsp;<span class="ident" id="5547597">e</span><span class="op" id="5547598">.</span><span class="ident" id="5547599">w</span><span class="op" id="5547600">.</span><span class="ident" id="5547601">Write</span><span class="op" id="5547606">(</span><span class="ident" id="5547607">e</span><span class="op" id="5547608">.</span><span class="ident" id="5547609">out</span><span class="op" id="5547612">[</span><span class="num" id="5547613">0</span><span class="op" id="5547614">:</span><span class="ident" id="5547615">nout</span><span class="op" id="5547619">]</span><span class="op" id="5547620">)</span><span class="op" id="5547621">;</span>&nbsp;<span class="ident" id="5547623">e</span><span class="op" id="5547624">.</span><span class="ident" id="5547625">err</span>&nbsp;<span class="op" id="5547629">!=</span>&nbsp;<span class="builtintype" id="5547632">nil</span>&nbsp;<span class="op" id="5547636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547641">return</span>&nbsp;<span class="ident" id="5547648">n</span><span class="op" id="5547649">,</span>&nbsp;<span class="ident" id="5547651">e</span><span class="op" id="5547652">.</span><span class="ident" id="5547653">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5547659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547663">e</span><span class="op" id="5547664">.</span><span class="ident" id="5547665">nbuf</span>&nbsp;<span class="op" id="5547670">=</span>&nbsp;<span class="num" id="5547672">0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5547675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5547679">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547706">for</span>&nbsp;<span class="builtinfunc" id="5547710">len</span><span class="op" id="5547713">(</span><span class="ident" id="5547714">p</span><span class="op" id="5547715">)</span>&nbsp;<span class="op" id="5547717">&gt;=</span>&nbsp;<span class="num" id="5547720">4</span>&nbsp;<span class="op" id="5547722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547726">nn</span>&nbsp;<span class="op" id="5547729">:=</span>&nbsp;<span class="builtinfunc" id="5547732">len</span><span class="op" id="5547735">(</span><span class="ident" id="5547736">e</span><span class="op" id="5547737">.</span><span class="ident" id="5547738">out</span><span class="op" id="5547741">)</span>&nbsp;<span class="op" id="5547743">/</span>&nbsp;<span class="num" id="5547745">5</span>&nbsp;<span class="op" id="5547747">*</span>&nbsp;<span class="num" id="5547749">4</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547753">if</span>&nbsp;<span class="ident" id="5547756">nn</span>&nbsp;<span class="op" id="5547759">&gt;</span>&nbsp;<span class="builtinfunc" id="5547761">len</span><span class="op" id="5547764">(</span><span class="ident" id="5547765">p</span><span class="op" id="5547766">)</span>&nbsp;<span class="op" id="5547768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547773">nn</span>&nbsp;<span class="op" id="5547776">=</span>&nbsp;<span class="builtinfunc" id="5547778">len</span><span class="op" id="5547781">(</span><span class="ident" id="5547782">p</span><span class="op" id="5547783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5547787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547791">nn</span>&nbsp;<span class="op" id="5547794">-=</span>&nbsp;<span class="ident" id="5547797">nn</span>&nbsp;<span class="op" id="5547800">%</span>&nbsp;<span class="num" id="5547802">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547806">if</span>&nbsp;<span class="ident" id="5547809">nn</span>&nbsp;<span class="op" id="5547812">&gt;</span>&nbsp;<span class="num" id="5547814">0</span>&nbsp;<span class="op" id="5547816">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547821">nout</span>&nbsp;<span class="op" id="5547826">:=</span>&nbsp;<span class="ident" id="5547829">Encode</span><span class="op" id="5547835">(</span><span class="ident" id="5547836">e</span><span class="op" id="5547837">.</span><span class="ident" id="5547838">out</span><span class="op" id="5547841">[</span><span class="num" id="5547842">0</span><span class="op" id="5547843">:</span><span class="op" id="5547844">]</span><span class="op" id="5547845">,</span>&nbsp;<span class="ident" id="5547847">p</span><span class="op" id="5547848">[</span><span class="num" id="5547849">0</span><span class="op" id="5547850">:</span><span class="ident" id="5547851">nn</span><span class="op" id="5547853">]</span><span class="op" id="5547854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547859">if</span>&nbsp;<span class="ident" id="5547862">_</span><span class="op" id="5547863">,</span>&nbsp;<span class="ident" id="5547865">e</span><span class="op" id="5547866">.</span><span class="ident" id="5547867">err</span>&nbsp;<span class="op" id="5547871">=</span>&nbsp;<span class="ident" id="5547873">e</span><span class="op" id="5547874">.</span><span class="ident" id="5547875">w</span><span class="op" id="5547876">.</span><span class="ident" id="5547877">Write</span><span class="op" id="5547882">(</span><span class="ident" id="5547883">e</span><span class="op" id="5547884">.</span><span class="ident" id="5547885">out</span><span class="op" id="5547888">[</span><span class="num" id="5547889">0</span><span class="op" id="5547890">:</span><span class="ident" id="5547891">nout</span><span class="op" id="5547895">]</span><span class="op" id="5547896">)</span><span class="op" id="5547897">;</span>&nbsp;<span class="ident" id="5547899">e</span><span class="op" id="5547900">.</span><span class="ident" id="5547901">err</span>&nbsp;<span class="op" id="5547905">!=</span>&nbsp;<span class="builtintype" id="5547908">nil</span>&nbsp;<span class="op" id="5547912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547918">return</span>&nbsp;<span class="ident" id="5547925">n</span><span class="op" id="5547926">,</span>&nbsp;<span class="ident" id="5547928">e</span><span class="op" id="5547929">.</span><span class="ident" id="5547930">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5547937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5547941">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547945">n</span>&nbsp;<span class="op" id="5547947">+=</span>&nbsp;<span class="ident" id="5547950">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547955">p</span>&nbsp;<span class="op" id="5547957">=</span>&nbsp;<span class="ident" id="5547959">p</span><span class="op" id="5547960">[</span><span class="ident" id="5547961">nn</span><span class="op" id="5547963">:</span><span class="op" id="5547964">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5547967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5547971">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5547992">for</span>&nbsp;<span class="ident" id="5547996">i</span>&nbsp;<span class="op" id="5547998">:=</span>&nbsp;<span class="num" id="5548001">0</span><span class="op" id="5548002">;</span>&nbsp;<span class="ident" id="5548004">i</span>&nbsp;<span class="op" id="5548006">&lt;</span>&nbsp;<span class="builtinfunc" id="5548008">len</span><span class="op" id="5548011">(</span><span class="ident" id="5548012">p</span><span class="op" id="5548013">)</span><span class="op" id="5548014">;</span>&nbsp;<span class="ident" id="5548016">i</span><span class="op" id="5548017">++</span>&nbsp;<span class="op" id="5548020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5548024">e</span><span class="op" id="5548025">.</span><span class="ident" id="5548026">buf</span><span class="op" id="5548029">[</span><span class="ident" id="5548030">i</span><span class="op" id="5548031">]</span>&nbsp;<span class="op" id="5548033">=</span>&nbsp;<span class="ident" id="5548035">p</span><span class="op" id="5548036">[</span><span class="ident" id="5548037">i</span><span class="op" id="5548038">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5548041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5548044">e</span><span class="op" id="5548045">.</span><span class="ident" id="5548046">nbuf</span>&nbsp;<span class="op" id="5548051">=</span>&nbsp;<span class="builtinfunc" id="5548053">len</span><span class="op" id="5548056">(</span><span class="ident" id="5548057">p</span><span class="op" id="5548058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5548061">n</span>&nbsp;<span class="op" id="5548063">+=</span>&nbsp;<span class="builtinfunc" id="5548066">len</span><span class="op" id="5548069">(</span><span class="ident" id="5548070">p</span><span class="op" id="5548071">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5548074">return</span><br>
<span class="lineno"></span><span class="op" id="5548081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5548084">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5548138">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno">155</span><span class="keyword" id="5548191">func</span>&nbsp;<span class="op" id="5548196">(</span><span class="ident" id="5548197">e</span>&nbsp;<span class="op" id="5548199">*</span><span class="ident" id="5548200">encoder</span><span class="op" id="5548207">)</span>&nbsp;<span class="ident" id="5548209">Close</span><span class="op" id="5548214">(</span><span class="op" id="5548215">)</span>&nbsp;<span class="builtintype" id="5548217">error</span>&nbsp;<span class="op" id="5548223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5548226">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5548283">if</span>&nbsp;<span class="ident" id="5548286">e</span><span class="op" id="5548287">.</span><span class="ident" id="5548288">err</span>&nbsp;<span class="op" id="5548292">==</span>&nbsp;<span class="builtintype" id="5548295">nil</span>&nbsp;<span class="op" id="5548299">&amp;&amp;</span>&nbsp;<span class="ident" id="5548302">e</span><span class="op" id="5548303">.</span><span class="ident" id="5548304">nbuf</span>&nbsp;<span class="op" id="5548309">&gt;</span>&nbsp;<span class="num" id="5548311">0</span>&nbsp;<span class="op" id="5548313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5548317">nout</span>&nbsp;<span class="op" id="5548322">:=</span>&nbsp;<span class="ident" id="5548325">Encode</span><span class="op" id="5548331">(</span><span class="ident" id="5548332">e</span><span class="op" id="5548333">.</span><span class="ident" id="5548334">out</span><span class="op" id="5548337">[</span><span class="num" id="5548338">0</span><span class="op" id="5548339">:</span><span class="op" id="5548340">]</span><span class="op" id="5548341">,</span>&nbsp;<span class="ident" id="5548343">e</span><span class="op" id="5548344">.</span><span class="ident" id="5548345">buf</span><span class="op" id="5548348">[</span><span class="num" id="5548349">0</span><span class="op" id="5548350">:</span><span class="ident" id="5548351">e</span><span class="op" id="5548352">.</span><span class="ident" id="5548353">nbuf</span><span class="op" id="5548357">]</span><span class="op" id="5548358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5548362">e</span><span class="op" id="5548363">.</span><span class="ident" id="5548364">nbuf</span>&nbsp;<span class="op" id="5548369">=</span>&nbsp;<span class="num" id="5548371">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5548375">_</span><span class="op" id="5548376">,</span>&nbsp;<span class="ident" id="5548378">e</span><span class="op" id="5548379">.</span><span class="ident" id="5548380">err</span>&nbsp;<span class="op" id="5548384">=</span>&nbsp;<span class="ident" id="5548386">e</span><span class="op" id="5548387">.</span><span class="ident" id="5548388">w</span><span class="op" id="5548389">.</span><span class="ident" id="5548390">Write</span><span class="op" id="5548395">(</span><span class="ident" id="5548396">e</span><span class="op" id="5548397">.</span><span class="ident" id="5548398">out</span><span class="op" id="5548401">[</span><span class="num" id="5548402">0</span><span class="op" id="5548403">:</span><span class="ident" id="5548404">nout</span><span class="op" id="5548408">]</span><span class="op" id="5548409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5548412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5548415">return</span>&nbsp;<span class="ident" id="5548422">e</span><span class="op" id="5548423">.</span><span class="ident" id="5548424">err</span><br>
<span class="lineno"></span><span class="op" id="5548428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5548431">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5548450">type</span>&nbsp;<span class="ident" id="5548455">CorruptInputError</span>&nbsp;<span class="builtintype" id="5548473">int64</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5548480">func</span>&nbsp;<span class="op" id="5548485">(</span><span class="ident" id="5548486">e</span>&nbsp;<span class="ident" id="5548488">CorruptInputError</span><span class="op" id="5548505">)</span>&nbsp;<span class="ident" id="5548507">Error</span><span class="op" id="5548512">(</span><span class="op" id="5548513">)</span>&nbsp;<span class="builtintype" id="5548515">string</span>&nbsp;<span class="op" id="5548522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5548525">return</span>&nbsp;<span class="string" id="5548532">&#34;illegal&nbsp;ascii85&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="5548570">+</span>&nbsp;<span class="ident" id="5548572">strconv</span><span class="op" id="5548579">.</span><span class="ident" id="5548580">FormatInt</span><span class="op" id="5548589">(</span><span class="builtintype" id="5548590">int64</span><span class="op" id="5548595">(</span><span class="ident" id="5548596">e</span><span class="op" id="5548597">)</span><span class="op" id="5548598">,</span>&nbsp;<span class="num" id="5548600">10</span><span class="op" id="5548602">)</span><br>
<span class="lineno"></span><span class="op" id="5548604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5548607">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;into&nbsp;dst,&nbsp;returning&nbsp;both&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="5548665">//&nbsp;of&nbsp;bytes&nbsp;written&nbsp;to&nbsp;dst&nbsp;and&nbsp;the&nbsp;number&nbsp;consumed&nbsp;from&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="5548726">//&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;ascii85&nbsp;data,&nbsp;Decode&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5548790">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;a&nbsp;CorruptInputError.</span><br>
<span class="lineno"></span><span class="comment" id="5548855">//&nbsp;Decode&nbsp;ignores&nbsp;space&nbsp;and&nbsp;control&nbsp;characters&nbsp;in&nbsp;src.</span><br>
<span class="lineno">180</span><span class="comment" id="5548910">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="5548974">//&nbsp;Decode&nbsp;expects&nbsp;these&nbsp;to&nbsp;have&nbsp;been&nbsp;stripped&nbsp;by&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="5549035">//</span><br>
<span class="lineno"></span><span class="comment" id="5549038">//&nbsp;If&nbsp;flush&nbsp;is&nbsp;true,&nbsp;Decode&nbsp;assumes&nbsp;that&nbsp;src&nbsp;represents&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5549098">//&nbsp;end&nbsp;of&nbsp;the&nbsp;input&nbsp;stream&nbsp;and&nbsp;processes&nbsp;it&nbsp;completely&nbsp;rather</span><br>
<span class="lineno">185</span><span class="comment" id="5549160">//&nbsp;than&nbsp;wait&nbsp;for&nbsp;the&nbsp;completion&nbsp;of&nbsp;another&nbsp;32-bit&nbsp;block.</span><br>
<span class="lineno"></span><span class="comment" id="5549217">//</span><br>
<span class="lineno"></span><span class="comment" id="5549220">//&nbsp;NewDecoder&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;interface&nbsp;around&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="comment" id="5549278">//</span><br>
<span class="lineno"></span><span class="keyword" id="5549281">func</span>&nbsp;<span class="ident" id="5549286">Decode</span><span class="op" id="5549292">(</span><span class="ident" id="5549293">dst</span><span class="op" id="5549296">,</span>&nbsp;<span class="ident" id="5549298">src</span>&nbsp;<span class="op" id="5549302">[</span><span class="op" id="5549303">]</span><span class="builtintype" id="5549304">byte</span><span class="op" id="5549308">,</span>&nbsp;<span class="ident" id="5549310">flush</span>&nbsp;<span class="builtintype" id="5549316">bool</span><span class="op" id="5549320">)</span>&nbsp;<span class="op" id="5549322">(</span><span class="ident" id="5549323">ndst</span><span class="op" id="5549327">,</span>&nbsp;<span class="ident" id="5549329">nsrc</span>&nbsp;<span class="builtintype" id="5549334">int</span><span class="op" id="5549337">,</span>&nbsp;<span class="ident" id="5549339">err</span>&nbsp;<span class="builtintype" id="5549343">error</span><span class="op" id="5549348">)</span>&nbsp;<span class="op" id="5549350">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549353">var</span>&nbsp;<span class="ident" id="5549357">v</span>&nbsp;<span class="builtintype" id="5549359">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549367">var</span>&nbsp;<span class="ident" id="5549371">nb</span>&nbsp;<span class="builtintype" id="5549374">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549379">for</span>&nbsp;<span class="ident" id="5549383">i</span><span class="op" id="5549384">,</span>&nbsp;<span class="ident" id="5549386">b</span>&nbsp;<span class="op" id="5549388">:=</span>&nbsp;<span class="keyword" id="5549391">range</span>&nbsp;<span class="ident" id="5549397">src</span>&nbsp;<span class="op" id="5549401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549405">if</span>&nbsp;<span class="builtinfunc" id="5549408">len</span><span class="op" id="5549411">(</span><span class="ident" id="5549412">dst</span><span class="op" id="5549415">)</span><span class="op" id="5549416">-</span><span class="ident" id="5549417">ndst</span>&nbsp;<span class="op" id="5549422">&lt;</span>&nbsp;<span class="num" id="5549424">4</span>&nbsp;<span class="op" id="5549426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549431">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5549440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549444">switch</span>&nbsp;<span class="op" id="5549451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549455">case</span>&nbsp;<span class="ident" id="5549460">b</span>&nbsp;<span class="op" id="5549462">&lt;=</span>&nbsp;<span class="string" id="5549465">&#39;&nbsp;&#39;</span><span class="op" id="5549468">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549473">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549484">case</span>&nbsp;<span class="ident" id="5549489">b</span>&nbsp;<span class="op" id="5549491">==</span>&nbsp;<span class="string" id="5549494">&#39;z&#39;</span>&nbsp;<span class="op" id="5549498">&amp;&amp;</span>&nbsp;<span class="ident" id="5549501">nb</span>&nbsp;<span class="op" id="5549504">==</span>&nbsp;<span class="num" id="5549507">0</span><span class="op" id="5549508">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549513">nb</span>&nbsp;<span class="op" id="5549516">=</span>&nbsp;<span class="num" id="5549518">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549523">v</span>&nbsp;<span class="op" id="5549525">=</span>&nbsp;<span class="num" id="5549527">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549531">case</span>&nbsp;<span class="string" id="5549536">&#39;!&#39;</span>&nbsp;<span class="op" id="5549540">&lt;=</span>&nbsp;<span class="ident" id="5549543">b</span>&nbsp;<span class="op" id="5549545">&amp;&amp;</span>&nbsp;<span class="ident" id="5549548">b</span>&nbsp;<span class="op" id="5549550">&lt;=</span>&nbsp;<span class="string" id="5549553">&#39;u&#39;</span><span class="op" id="5549556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549561">v</span>&nbsp;<span class="op" id="5549563">=</span>&nbsp;<span class="ident" id="5549565">v</span><span class="op" id="5549566">*</span><span class="num" id="5549567">85</span>&nbsp;<span class="op" id="5549570">+</span>&nbsp;<span class="builtintype" id="5549572">uint32</span><span class="op" id="5549578">(</span><span class="ident" id="5549579">b</span><span class="op" id="5549580">-</span><span class="string" id="5549581">&#39;!&#39;</span><span class="op" id="5549584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549589">nb</span><span class="op" id="5549591">++</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549596">default</span><span class="op" id="5549603">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549608">return</span>&nbsp;<span class="num" id="5549615">0</span><span class="op" id="5549616">,</span>&nbsp;<span class="num" id="5549618">0</span><span class="op" id="5549619">,</span>&nbsp;<span class="ident" id="5549621">CorruptInputError</span><span class="op" id="5549638">(</span><span class="ident" id="5549639">i</span><span class="op" id="5549640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5549644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549648">if</span>&nbsp;<span class="ident" id="5549651">nb</span>&nbsp;<span class="op" id="5549654">==</span>&nbsp;<span class="num" id="5549657">5</span>&nbsp;<span class="op" id="5549659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549664">nsrc</span>&nbsp;<span class="op" id="5549669">=</span>&nbsp;<span class="ident" id="5549671">i</span>&nbsp;<span class="op" id="5549673">+</span>&nbsp;<span class="num" id="5549675">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549680">dst</span><span class="op" id="5549683">[</span><span class="ident" id="5549684">ndst</span><span class="op" id="5549688">]</span>&nbsp;<span class="op" id="5549690">=</span>&nbsp;<span class="builtintype" id="5549692">byte</span><span class="op" id="5549696">(</span><span class="ident" id="5549697">v</span>&nbsp;<span class="op" id="5549699">&gt;&gt;</span>&nbsp;<span class="num" id="5549702">24</span><span class="op" id="5549704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549709">dst</span><span class="op" id="5549712">[</span><span class="ident" id="5549713">ndst</span><span class="op" id="5549717">+</span><span class="num" id="5549718">1</span><span class="op" id="5549719">]</span>&nbsp;<span class="op" id="5549721">=</span>&nbsp;<span class="builtintype" id="5549723">byte</span><span class="op" id="5549727">(</span><span class="ident" id="5549728">v</span>&nbsp;<span class="op" id="5549730">&gt;&gt;</span>&nbsp;<span class="num" id="5549733">16</span><span class="op" id="5549735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549740">dst</span><span class="op" id="5549743">[</span><span class="ident" id="5549744">ndst</span><span class="op" id="5549748">+</span><span class="num" id="5549749">2</span><span class="op" id="5549750">]</span>&nbsp;<span class="op" id="5549752">=</span>&nbsp;<span class="builtintype" id="5549754">byte</span><span class="op" id="5549758">(</span><span class="ident" id="5549759">v</span>&nbsp;<span class="op" id="5549761">&gt;&gt;</span>&nbsp;<span class="num" id="5549764">8</span><span class="op" id="5549765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549770">dst</span><span class="op" id="5549773">[</span><span class="ident" id="5549774">ndst</span><span class="op" id="5549778">+</span><span class="num" id="5549779">3</span><span class="op" id="5549780">]</span>&nbsp;<span class="op" id="5549782">=</span>&nbsp;<span class="builtintype" id="5549784">byte</span><span class="op" id="5549788">(</span><span class="ident" id="5549789">v</span><span class="op" id="5549790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549795">ndst</span>&nbsp;<span class="op" id="5549800">+=</span>&nbsp;<span class="num" id="5549803">4</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549808">nb</span>&nbsp;<span class="op" id="5549811">=</span>&nbsp;<span class="num" id="5549813">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549818">v</span>&nbsp;<span class="op" id="5549820">=</span>&nbsp;<span class="num" id="5549822">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5549826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5549829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549832">if</span>&nbsp;<span class="ident" id="5549835">flush</span>&nbsp;<span class="op" id="5549841">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549845">nsrc</span>&nbsp;<span class="op" id="5549850">=</span>&nbsp;<span class="builtinfunc" id="5549852">len</span><span class="op" id="5549855">(</span><span class="ident" id="5549856">src</span><span class="op" id="5549859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5549863">if</span>&nbsp;<span class="ident" id="5549866">nb</span>&nbsp;<span class="op" id="5549869">&gt;</span>&nbsp;<span class="num" id="5549871">0</span>&nbsp;<span class="op" id="5549873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5549878">//&nbsp;The&nbsp;number&nbsp;of&nbsp;output&nbsp;bytes&nbsp;in&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5549932">//&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;leftover&nbsp;input&nbsp;bytes&nbsp;-&nbsp;1:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5549981">//&nbsp;the&nbsp;extra&nbsp;byte&nbsp;provides&nbsp;enough&nbsp;bits&nbsp;to&nbsp;cover</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5550032">//&nbsp;the&nbsp;inefficiency&nbsp;of&nbsp;the&nbsp;encoding&nbsp;for&nbsp;the&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550086">if</span>&nbsp;<span class="ident" id="5550089">nb</span>&nbsp;<span class="op" id="5550092">==</span>&nbsp;<span class="num" id="5550095">1</span>&nbsp;<span class="op" id="5550097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550103">return</span>&nbsp;<span class="num" id="5550110">0</span><span class="op" id="5550111">,</span>&nbsp;<span class="num" id="5550113">0</span><span class="op" id="5550114">,</span>&nbsp;<span class="ident" id="5550116">CorruptInputError</span><span class="op" id="5550133">(</span><span class="builtinfunc" id="5550134">len</span><span class="op" id="5550137">(</span><span class="ident" id="5550138">src</span><span class="op" id="5550141">)</span><span class="op" id="5550142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5550147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550152">for</span>&nbsp;<span class="ident" id="5550156">i</span>&nbsp;<span class="op" id="5550158">:=</span>&nbsp;<span class="ident" id="5550161">nb</span><span class="op" id="5550163">;</span>&nbsp;<span class="ident" id="5550165">i</span>&nbsp;<span class="op" id="5550167">&lt;</span>&nbsp;<span class="num" id="5550169">5</span><span class="op" id="5550170">;</span>&nbsp;<span class="ident" id="5550172">i</span><span class="op" id="5550173">++</span>&nbsp;<span class="op" id="5550176">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5550182">//&nbsp;The&nbsp;short&nbsp;encoding&nbsp;truncated&nbsp;the&nbsp;output&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5550236">//&nbsp;We&nbsp;have&nbsp;to&nbsp;assume&nbsp;the&nbsp;worst&nbsp;case&nbsp;values&nbsp;(digit&nbsp;84)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5550294">//&nbsp;in&nbsp;order&nbsp;to&nbsp;ensure&nbsp;that&nbsp;the&nbsp;top&nbsp;bits&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5550351">v</span>&nbsp;<span class="op" id="5550353">=</span>&nbsp;<span class="ident" id="5550355">v</span><span class="op" id="5550356">*</span><span class="num" id="5550357">85</span>&nbsp;<span class="op" id="5550360">+</span>&nbsp;<span class="num" id="5550362">84</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5550368">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550373">for</span>&nbsp;<span class="ident" id="5550377">i</span>&nbsp;<span class="op" id="5550379">:=</span>&nbsp;<span class="num" id="5550382">0</span><span class="op" id="5550383">;</span>&nbsp;<span class="ident" id="5550385">i</span>&nbsp;<span class="op" id="5550387">&lt;</span>&nbsp;<span class="ident" id="5550389">nb</span><span class="op" id="5550391">-</span><span class="num" id="5550392">1</span><span class="op" id="5550393">;</span>&nbsp;<span class="ident" id="5550395">i</span><span class="op" id="5550396">++</span>&nbsp;<span class="op" id="5550399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5550405">dst</span><span class="op" id="5550408">[</span><span class="ident" id="5550409">ndst</span><span class="op" id="5550413">]</span>&nbsp;<span class="op" id="5550415">=</span>&nbsp;<span class="builtintype" id="5550417">byte</span><span class="op" id="5550421">(</span><span class="ident" id="5550422">v</span>&nbsp;<span class="op" id="5550424">&gt;&gt;</span>&nbsp;<span class="num" id="5550427">24</span><span class="op" id="5550429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5550435">v</span>&nbsp;<span class="op" id="5550437">&lt;&lt;=</span>&nbsp;<span class="num" id="5550441">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5550447">ndst</span><span class="op" id="5550451">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5550457">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5550461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5550464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550467">return</span><br>
<span class="lineno"></span><span class="op" id="5550474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="5550477">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5550532">func</span>&nbsp;<span class="ident" id="5550537">NewDecoder</span><span class="op" id="5550547">(</span><span class="ident" id="5550548">r</span>&nbsp;<span class="ident" id="5550550">io</span><span class="op" id="5550552">.</span><span class="ident" id="5550553">Reader</span><span class="op" id="5550559">)</span>&nbsp;<span class="ident" id="5550561">io</span><span class="op" id="5550563">.</span><span class="ident" id="5550564">Reader</span>&nbsp;<span class="op" id="5550571">{</span>&nbsp;<span class="keyword" id="5550573">return</span>&nbsp;<span class="op" id="5550580">&amp;</span><span class="ident" id="5550581">decoder</span><span class="op" id="5550588">{</span><span class="ident" id="5550589">r</span><span class="op" id="5550590">:</span>&nbsp;<span class="ident" id="5550592">r</span><span class="op" id="5550593">}</span>&nbsp;<span class="op" id="5550595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5550598">type</span>&nbsp;<span class="ident" id="5550603">decoder</span>&nbsp;<span class="keyword" id="5550611">struct</span>&nbsp;<span class="op" id="5550618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5550621">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5550629">error</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5550636">readErr</span>&nbsp;<span class="builtintype" id="5550644">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5550651">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5550659">io</span><span class="op" id="5550661">.</span><span class="ident" id="5550662">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5550670">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5550678">[</span><span class="num" id="5550679">1024</span><span class="op" id="5550683">]</span><span class="builtintype" id="5550684">byte</span>&nbsp;<span class="comment" id="5550689">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5550708">nbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5550716">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5550721">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5550729">[</span><span class="op" id="5550730">]</span><span class="builtintype" id="5550731">byte</span>&nbsp;<span class="comment" id="5550736">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5550764">outbuf</span>&nbsp;&nbsp;<span class="op" id="5550772">[</span><span class="num" id="5550773">1024</span><span class="op" id="5550777">]</span><span class="builtintype" id="5550778">byte</span><br>
<span class="lineno"></span><span class="op" id="5550783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5550786">func</span>&nbsp;<span class="op" id="5550791">(</span><span class="ident" id="5550792">d</span>&nbsp;<span class="op" id="5550794">*</span><span class="ident" id="5550795">decoder</span><span class="op" id="5550802">)</span>&nbsp;<span class="ident" id="5550804">Read</span><span class="op" id="5550808">(</span><span class="ident" id="5550809">p</span>&nbsp;<span class="op" id="5550811">[</span><span class="op" id="5550812">]</span><span class="builtintype" id="5550813">byte</span><span class="op" id="5550817">)</span>&nbsp;<span class="op" id="5550819">(</span><span class="ident" id="5550820">n</span>&nbsp;<span class="builtintype" id="5550822">int</span><span class="op" id="5550825">,</span>&nbsp;<span class="ident" id="5550827">err</span>&nbsp;<span class="builtintype" id="5550831">error</span><span class="op" id="5550836">)</span>&nbsp;<span class="op" id="5550838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550841">if</span>&nbsp;<span class="builtinfunc" id="5550844">len</span><span class="op" id="5550847">(</span><span class="ident" id="5550848">p</span><span class="op" id="5550849">)</span>&nbsp;<span class="op" id="5550851">==</span>&nbsp;<span class="num" id="5550854">0</span>&nbsp;<span class="op" id="5550856">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550860">return</span>&nbsp;<span class="num" id="5550867">0</span><span class="op" id="5550868">,</span>&nbsp;<span class="builtintype" id="5550870">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5550875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550878">if</span>&nbsp;<span class="ident" id="5550881">d</span><span class="op" id="5550882">.</span><span class="ident" id="5550883">err</span>&nbsp;<span class="op" id="5550887">!=</span>&nbsp;<span class="builtintype" id="5550890">nil</span>&nbsp;<span class="op" id="5550894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550898">return</span>&nbsp;<span class="num" id="5550905">0</span><span class="op" id="5550906">,</span>&nbsp;<span class="ident" id="5550908">d</span><span class="op" id="5550909">.</span><span class="ident" id="5550910">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5550915">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550919">for</span>&nbsp;<span class="op" id="5550923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5550927">//&nbsp;Copy&nbsp;leftover&nbsp;output&nbsp;from&nbsp;last&nbsp;decode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5550971">if</span>&nbsp;<span class="builtinfunc" id="5550974">len</span><span class="op" id="5550977">(</span><span class="ident" id="5550978">d</span><span class="op" id="5550979">.</span><span class="ident" id="5550980">out</span><span class="op" id="5550983">)</span>&nbsp;<span class="op" id="5550985">&gt;</span>&nbsp;<span class="num" id="5550987">0</span>&nbsp;<span class="op" id="5550989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5550994">n</span>&nbsp;<span class="op" id="5550996">=</span>&nbsp;<span class="builtinfunc" id="5550998">copy</span><span class="op" id="5551002">(</span><span class="ident" id="5551003">p</span><span class="op" id="5551004">,</span>&nbsp;<span class="ident" id="5551006">d</span><span class="op" id="5551007">.</span><span class="ident" id="5551008">out</span><span class="op" id="5551011">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551016">d</span><span class="op" id="5551017">.</span><span class="ident" id="5551018">out</span>&nbsp;<span class="op" id="5551022">=</span>&nbsp;<span class="ident" id="5551024">d</span><span class="op" id="5551025">.</span><span class="ident" id="5551026">out</span><span class="op" id="5551029">[</span><span class="ident" id="5551030">n</span><span class="op" id="5551031">:</span><span class="op" id="5551032">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551037">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5551046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5551051">//&nbsp;Decode&nbsp;leftover&nbsp;input&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551094">var</span>&nbsp;<span class="ident" id="5551098">nn</span><span class="op" id="5551100">,</span>&nbsp;<span class="ident" id="5551102">nsrc</span><span class="op" id="5551106">,</span>&nbsp;<span class="ident" id="5551108">ndst</span>&nbsp;<span class="builtintype" id="5551113">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551119">if</span>&nbsp;<span class="ident" id="5551122">d</span><span class="op" id="5551123">.</span><span class="ident" id="5551124">nbuf</span>&nbsp;<span class="op" id="5551129">&gt;</span>&nbsp;<span class="num" id="5551131">0</span>&nbsp;<span class="op" id="5551133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551138">ndst</span><span class="op" id="5551142">,</span>&nbsp;<span class="ident" id="5551144">nsrc</span><span class="op" id="5551148">,</span>&nbsp;<span class="ident" id="5551150">d</span><span class="op" id="5551151">.</span><span class="ident" id="5551152">err</span>&nbsp;<span class="op" id="5551156">=</span>&nbsp;<span class="ident" id="5551158">Decode</span><span class="op" id="5551164">(</span><span class="ident" id="5551165">d</span><span class="op" id="5551166">.</span><span class="ident" id="5551167">outbuf</span><span class="op" id="5551173">[</span><span class="num" id="5551174">0</span><span class="op" id="5551175">:</span><span class="op" id="5551176">]</span><span class="op" id="5551177">,</span>&nbsp;<span class="ident" id="5551179">d</span><span class="op" id="5551180">.</span><span class="ident" id="5551181">buf</span><span class="op" id="5551184">[</span><span class="num" id="5551185">0</span><span class="op" id="5551186">:</span><span class="ident" id="5551187">d</span><span class="op" id="5551188">.</span><span class="ident" id="5551189">nbuf</span><span class="op" id="5551193">]</span><span class="op" id="5551194">,</span>&nbsp;<span class="ident" id="5551196">d</span><span class="op" id="5551197">.</span><span class="ident" id="5551198">readErr</span>&nbsp;<span class="op" id="5551206">!=</span>&nbsp;<span class="builtintype" id="5551209">nil</span><span class="op" id="5551212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551217">if</span>&nbsp;<span class="ident" id="5551220">ndst</span>&nbsp;<span class="op" id="5551225">&gt;</span>&nbsp;<span class="num" id="5551227">0</span>&nbsp;<span class="op" id="5551229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551235">d</span><span class="op" id="5551236">.</span><span class="ident" id="5551237">out</span>&nbsp;<span class="op" id="5551241">=</span>&nbsp;<span class="ident" id="5551243">d</span><span class="op" id="5551244">.</span><span class="ident" id="5551245">outbuf</span><span class="op" id="5551251">[</span><span class="num" id="5551252">0</span><span class="op" id="5551253">:</span><span class="ident" id="5551254">ndst</span><span class="op" id="5551258">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551264">d</span><span class="op" id="5551265">.</span><span class="ident" id="5551266">nbuf</span>&nbsp;<span class="op" id="5551271">=</span>&nbsp;<span class="builtinfunc" id="5551273">copy</span><span class="op" id="5551277">(</span><span class="ident" id="5551278">d</span><span class="op" id="5551279">.</span><span class="ident" id="5551280">buf</span><span class="op" id="5551283">[</span><span class="num" id="5551284">0</span><span class="op" id="5551285">:</span><span class="op" id="5551286">]</span><span class="op" id="5551287">,</span>&nbsp;<span class="ident" id="5551289">d</span><span class="op" id="5551290">.</span><span class="ident" id="5551291">buf</span><span class="op" id="5551294">[</span><span class="ident" id="5551295">nsrc</span><span class="op" id="5551299">:</span><span class="ident" id="5551300">d</span><span class="op" id="5551301">.</span><span class="ident" id="5551302">nbuf</span><span class="op" id="5551306">]</span><span class="op" id="5551307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551313">continue</span>&nbsp;<span class="comment" id="5551322">//&nbsp;copy&nbsp;out&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5551348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551353">if</span>&nbsp;<span class="ident" id="5551356">ndst</span>&nbsp;<span class="op" id="5551361">==</span>&nbsp;<span class="num" id="5551364">0</span>&nbsp;<span class="op" id="5551366">&amp;&amp;</span>&nbsp;<span class="ident" id="5551369">d</span><span class="op" id="5551370">.</span><span class="ident" id="5551371">err</span>&nbsp;<span class="op" id="5551375">==</span>&nbsp;<span class="builtintype" id="5551378">nil</span>&nbsp;<span class="op" id="5551382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5551388">//&nbsp;Special&nbsp;case:&nbsp;input&nbsp;buffer&nbsp;is&nbsp;mostly&nbsp;filled&nbsp;with&nbsp;non-data&nbsp;bytes.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5551460">//&nbsp;Filter&nbsp;out&nbsp;such&nbsp;bytes&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;more&nbsp;input.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551518">off</span>&nbsp;<span class="op" id="5551522">:=</span>&nbsp;<span class="num" id="5551525">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551531">for</span>&nbsp;<span class="ident" id="5551535">i</span>&nbsp;<span class="op" id="5551537">:=</span>&nbsp;<span class="num" id="5551540">0</span><span class="op" id="5551541">;</span>&nbsp;<span class="ident" id="5551543">i</span>&nbsp;<span class="op" id="5551545">&lt;</span>&nbsp;<span class="ident" id="5551547">d</span><span class="op" id="5551548">.</span><span class="ident" id="5551549">nbuf</span><span class="op" id="5551553">;</span>&nbsp;<span class="ident" id="5551555">i</span><span class="op" id="5551556">++</span>&nbsp;<span class="op" id="5551559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551566">if</span>&nbsp;<span class="ident" id="5551569">d</span><span class="op" id="5551570">.</span><span class="ident" id="5551571">buf</span><span class="op" id="5551574">[</span><span class="ident" id="5551575">i</span><span class="op" id="5551576">]</span>&nbsp;<span class="op" id="5551578">&gt;</span>&nbsp;<span class="string" id="5551580">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5551584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551592">d</span><span class="op" id="5551593">.</span><span class="ident" id="5551594">buf</span><span class="op" id="5551597">[</span><span class="ident" id="5551598">off</span><span class="op" id="5551601">]</span>&nbsp;<span class="op" id="5551603">=</span>&nbsp;<span class="ident" id="5551605">d</span><span class="op" id="5551606">.</span><span class="ident" id="5551607">buf</span><span class="op" id="5551610">[</span><span class="ident" id="5551611">i</span><span class="op" id="5551612">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551620">off</span><span class="op" id="5551623">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5551631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5551637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551643">d</span><span class="op" id="5551644">.</span><span class="ident" id="5551645">nbuf</span>&nbsp;<span class="op" id="5551650">=</span>&nbsp;<span class="ident" id="5551652">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5551659">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5551663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5551668">//&nbsp;Out&nbsp;of&nbsp;input,&nbsp;out&nbsp;of&nbsp;decoded&nbsp;output.&nbsp;&nbsp;Check&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551725">if</span>&nbsp;<span class="ident" id="5551728">d</span><span class="op" id="5551729">.</span><span class="ident" id="5551730">err</span>&nbsp;<span class="op" id="5551734">!=</span>&nbsp;<span class="builtintype" id="5551737">nil</span>&nbsp;<span class="op" id="5551741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551746">return</span>&nbsp;<span class="num" id="5551753">0</span><span class="op" id="5551754">,</span>&nbsp;<span class="ident" id="5551756">d</span><span class="op" id="5551757">.</span><span class="ident" id="5551758">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5551764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551768">if</span>&nbsp;<span class="ident" id="5551771">d</span><span class="op" id="5551772">.</span><span class="ident" id="5551773">readErr</span>&nbsp;<span class="op" id="5551781">!=</span>&nbsp;<span class="builtintype" id="5551784">nil</span>&nbsp;<span class="op" id="5551788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551793">d</span><span class="op" id="5551794">.</span><span class="ident" id="5551795">err</span>&nbsp;<span class="op" id="5551799">=</span>&nbsp;<span class="ident" id="5551801">d</span><span class="op" id="5551802">.</span><span class="ident" id="5551803">readErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5551814">return</span>&nbsp;<span class="num" id="5551821">0</span><span class="op" id="5551822">,</span>&nbsp;<span class="ident" id="5551824">d</span><span class="op" id="5551825">.</span><span class="ident" id="5551826">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5551832">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5551837">//&nbsp;Read&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551858">nn</span><span class="op" id="5551860">,</span>&nbsp;<span class="ident" id="5551862">d</span><span class="op" id="5551863">.</span><span class="ident" id="5551864">readErr</span>&nbsp;<span class="op" id="5551872">=</span>&nbsp;<span class="ident" id="5551874">d</span><span class="op" id="5551875">.</span><span class="ident" id="5551876">r</span><span class="op" id="5551877">.</span><span class="ident" id="5551878">Read</span><span class="op" id="5551882">(</span><span class="ident" id="5551883">d</span><span class="op" id="5551884">.</span><span class="ident" id="5551885">buf</span><span class="op" id="5551888">[</span><span class="ident" id="5551889">d</span><span class="op" id="5551890">.</span><span class="ident" id="5551891">nbuf</span><span class="op" id="5551895">:</span><span class="op" id="5551896">]</span><span class="op" id="5551897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5551901">d</span><span class="op" id="5551902">.</span><span class="ident" id="5551903">nbuf</span>&nbsp;<span class="op" id="5551908">+=</span>&nbsp;<span class="ident" id="5551911">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5551915">}</span><br>
<span class="lineno">310</span><span class="op" id="5551917">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
