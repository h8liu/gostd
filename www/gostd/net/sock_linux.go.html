<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3384880">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3384936">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3384990">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3385041">package</span>&nbsp;<span class="ident" id="3385049">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3385054">import</span>&nbsp;<span class="string" id="3385061">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3385072">func</span>&nbsp;<span class="ident" id="3385077">maxListenerBacklog</span><span class="op" id="3385095">(</span><span class="op" id="3385096">)</span>&nbsp;<span class="builtintype" id="3385098">int</span>&nbsp;<span class="op" id="3385102">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385105">fd</span><span class="op" id="3385107">,</span>&nbsp;<span class="ident" id="3385109">err</span>&nbsp;<span class="op" id="3385113">:=</span>&nbsp;<span class="ident" id="3385116">open</span><span class="op" id="3385120">(</span><span class="string" id="3385121">&#34;/proc/sys/net/core/somaxconn&#34;</span><span class="op" id="3385151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385154">if</span>&nbsp;<span class="ident" id="3385157">err</span>&nbsp;<span class="op" id="3385161">!=</span>&nbsp;<span class="ident" id="3385164">nil</span>&nbsp;<span class="op" id="3385168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385172">return</span>&nbsp;<span class="ident" id="3385179">syscall</span><span class="op" id="3385186">.</span><span class="ident" id="3385187">SOMAXCONN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3385198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385201">defer</span>&nbsp;<span class="ident" id="3385207">fd</span><span class="op" id="3385209">.</span><span class="builtinfunc" id="3385210">close</span><span class="op" id="3385215">(</span><span class="op" id="3385216">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385219">l</span><span class="op" id="3385220">,</span>&nbsp;<span class="ident" id="3385222">ok</span>&nbsp;<span class="op" id="3385225">:=</span>&nbsp;<span class="ident" id="3385228">fd</span><span class="op" id="3385230">.</span><span class="ident" id="3385231">readLine</span><span class="op" id="3385239">(</span><span class="op" id="3385240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385243">if</span>&nbsp;<span class="op" id="3385246">!</span><span class="ident" id="3385247">ok</span>&nbsp;<span class="op" id="3385250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385254">return</span>&nbsp;<span class="ident" id="3385261">syscall</span><span class="op" id="3385268">.</span><span class="ident" id="3385269">SOMAXCONN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3385280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385283">f</span>&nbsp;<span class="op" id="3385285">:=</span>&nbsp;<span class="ident" id="3385288">getFields</span><span class="op" id="3385297">(</span><span class="ident" id="3385298">l</span><span class="op" id="3385299">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385302">n</span><span class="op" id="3385303">,</span>&nbsp;<span class="ident" id="3385305">_</span><span class="op" id="3385306">,</span>&nbsp;<span class="ident" id="3385308">ok</span>&nbsp;<span class="op" id="3385311">:=</span>&nbsp;<span class="ident" id="3385314">dtoi</span><span class="op" id="3385318">(</span><span class="ident" id="3385319">f</span><span class="op" id="3385320">[</span><span class="num" id="3385321">0</span><span class="op" id="3385322">]</span><span class="op" id="3385323">,</span>&nbsp;<span class="num" id="3385325">0</span><span class="op" id="3385326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385329">if</span>&nbsp;<span class="ident" id="3385332">n</span>&nbsp;<span class="op" id="3385334">==</span>&nbsp;<span class="num" id="3385337">0</span>&nbsp;<span class="op" id="3385339">||</span>&nbsp;<span class="op" id="3385342">!</span><span class="ident" id="3385343">ok</span>&nbsp;<span class="op" id="3385346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385350">return</span>&nbsp;<span class="ident" id="3385357">syscall</span><span class="op" id="3385364">.</span><span class="ident" id="3385365">SOMAXCONN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3385376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3385379">//&nbsp;Linux&nbsp;stores&nbsp;the&nbsp;backlog&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3385421">//&nbsp;Truncate&nbsp;number&nbsp;to&nbsp;avoid&nbsp;wrapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3385460">//&nbsp;See&nbsp;issue&nbsp;5030.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385480">if</span>&nbsp;<span class="ident" id="3385483">n</span>&nbsp;<span class="op" id="3385485">&gt;</span>&nbsp;<span class="num" id="3385487">1</span><span class="op" id="3385488">&lt;&lt;</span><span class="num" id="3385490">16</span><span class="op" id="3385492">-</span><span class="num" id="3385493">1</span>&nbsp;<span class="op" id="3385495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385499">n</span>&nbsp;<span class="op" id="3385501">=</span>&nbsp;<span class="num" id="3385503">1</span><span class="op" id="3385504">&lt;&lt;</span><span class="num" id="3385506">16</span>&nbsp;<span class="op" id="3385509">-</span>&nbsp;<span class="num" id="3385511">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3385514">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385517">return</span>&nbsp;<span class="ident" id="3385524">n</span><br>
<span class="lineno"></span><span class="op" id="3385526">}</span>
</div>
</body>
</html>
