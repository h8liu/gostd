<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5058513">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5058568">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5058622">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5058673">package</span>&nbsp;<span class="ident" id="5058681">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5058688">type</span>&nbsp;<span class="ident" id="5058693">serializedFile</span>&nbsp;<span class="keyword" id="5058708">struct</span>&nbsp;<span class="op" id="5058715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5058718">//&nbsp;fields&nbsp;correspond&nbsp;1:1&nbsp;to&nbsp;fields&nbsp;with&nbsp;same&nbsp;(lower-case)&nbsp;name&nbsp;in&nbsp;File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058790">Name</span>&nbsp;&nbsp;<span class="builtintype" id="5058796">string</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058804">Base</span>&nbsp;&nbsp;<span class="builtintype" id="5058810">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058815">Size</span>&nbsp;&nbsp;<span class="builtintype" id="5058821">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058826">Lines</span>&nbsp;<span class="op" id="5058832">[</span><span class="op" id="5058833">]</span><span class="builtintype" id="5058834">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058839">Infos</span>&nbsp;<span class="op" id="5058845">[</span><span class="op" id="5058846">]</span><span class="ident" id="5058847">lineInfo</span><br>
<span class="lineno"></span><span class="op" id="5058856">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="5058859">type</span>&nbsp;<span class="ident" id="5058864">serializedFileSet</span>&nbsp;<span class="keyword" id="5058882">struct</span>&nbsp;<span class="op" id="5058889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058892">Base</span>&nbsp;&nbsp;<span class="builtintype" id="5058898">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058903">Files</span>&nbsp;<span class="op" id="5058909">[</span><span class="op" id="5058910">]</span><span class="ident" id="5058911">serializedFile</span><br>
<span class="lineno"></span><span class="op" id="5058926">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5058929">//&nbsp;Read&nbsp;calls&nbsp;decode&nbsp;to&nbsp;deserialize&nbsp;a&nbsp;file&nbsp;set&nbsp;into&nbsp;s;&nbsp;s&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5059003">func</span>&nbsp;<span class="op" id="5059008">(</span><span class="ident" id="5059009">s</span>&nbsp;<span class="op" id="5059011">*</span><span class="ident" id="5059012">FileSet</span><span class="op" id="5059019">)</span>&nbsp;<span class="ident" id="5059021">Read</span><span class="op" id="5059025">(</span><span class="ident" id="5059026">decode</span>&nbsp;<span class="keyword" id="5059033">func</span><span class="op" id="5059037">(</span><span class="keyword" id="5059038">interface</span><span class="op" id="5059047">{</span><span class="op" id="5059048">}</span><span class="op" id="5059049">)</span>&nbsp;<span class="builtintype" id="5059051">error</span><span class="op" id="5059056">)</span>&nbsp;<span class="builtintype" id="5059058">error</span>&nbsp;<span class="op" id="5059064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059067">var</span>&nbsp;<span class="ident" id="5059071">ss</span>&nbsp;<span class="ident" id="5059074">serializedFileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059093">if</span>&nbsp;<span class="ident" id="5059096">err</span>&nbsp;<span class="op" id="5059100">:=</span>&nbsp;<span class="ident" id="5059103">decode</span><span class="op" id="5059109">(</span><span class="op" id="5059110">&amp;</span><span class="ident" id="5059111">ss</span><span class="op" id="5059113">)</span><span class="op" id="5059114">;</span>&nbsp;<span class="ident" id="5059116">err</span>&nbsp;<span class="op" id="5059120">!=</span>&nbsp;<span class="ident" id="5059123">nil</span>&nbsp;<span class="op" id="5059127">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059131">return</span>&nbsp;<span class="ident" id="5059138">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5059143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059147">s</span><span class="op" id="5059148">.</span><span class="ident" id="5059149">mutex</span><span class="op" id="5059154">.</span><span class="ident" id="5059155">Lock</span><span class="op" id="5059159">(</span><span class="op" id="5059160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059163">s</span><span class="op" id="5059164">.</span><span class="ident" id="5059165">base</span>&nbsp;<span class="op" id="5059170">=</span>&nbsp;<span class="ident" id="5059172">ss</span><span class="op" id="5059174">.</span><span class="ident" id="5059175">Base</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059181">files</span>&nbsp;<span class="op" id="5059187">:=</span>&nbsp;<span class="builtinfunc" id="5059190">make</span><span class="op" id="5059194">(</span><span class="op" id="5059195">[</span><span class="op" id="5059196">]</span><span class="op" id="5059197">*</span><span class="ident" id="5059198">File</span><span class="op" id="5059202">,</span>&nbsp;<span class="builtinfunc" id="5059204">len</span><span class="op" id="5059207">(</span><span class="ident" id="5059208">ss</span><span class="op" id="5059210">.</span><span class="ident" id="5059211">Files</span><span class="op" id="5059216">)</span><span class="op" id="5059217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059220">for</span>&nbsp;<span class="ident" id="5059224">i</span>&nbsp;<span class="op" id="5059226">:=</span>&nbsp;<span class="num" id="5059229">0</span><span class="op" id="5059230">;</span>&nbsp;<span class="ident" id="5059232">i</span>&nbsp;<span class="op" id="5059234">&lt;</span>&nbsp;<span class="builtinfunc" id="5059236">len</span><span class="op" id="5059239">(</span><span class="ident" id="5059240">ss</span><span class="op" id="5059242">.</span><span class="ident" id="5059243">Files</span><span class="op" id="5059248">)</span><span class="op" id="5059249">;</span>&nbsp;<span class="ident" id="5059251">i</span><span class="op" id="5059252">++</span>&nbsp;<span class="op" id="5059255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059259">f</span>&nbsp;<span class="op" id="5059261">:=</span>&nbsp;<span class="op" id="5059264">&amp;</span><span class="ident" id="5059265">ss</span><span class="op" id="5059267">.</span><span class="ident" id="5059268">Files</span><span class="op" id="5059273">[</span><span class="ident" id="5059274">i</span><span class="op" id="5059275">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059279">files</span><span class="op" id="5059284">[</span><span class="ident" id="5059285">i</span><span class="op" id="5059286">]</span>&nbsp;<span class="op" id="5059288">=</span>&nbsp;<span class="op" id="5059290">&amp;</span><span class="ident" id="5059291">File</span><span class="op" id="5059295">{</span><span class="ident" id="5059296">s</span><span class="op" id="5059297">,</span>&nbsp;<span class="ident" id="5059299">f</span><span class="op" id="5059300">.</span><span class="ident" id="5059301">Name</span><span class="op" id="5059305">,</span>&nbsp;<span class="ident" id="5059307">f</span><span class="op" id="5059308">.</span><span class="ident" id="5059309">Base</span><span class="op" id="5059313">,</span>&nbsp;<span class="ident" id="5059315">f</span><span class="op" id="5059316">.</span><span class="ident" id="5059317">Size</span><span class="op" id="5059321">,</span>&nbsp;<span class="ident" id="5059323">f</span><span class="op" id="5059324">.</span><span class="ident" id="5059325">Lines</span><span class="op" id="5059330">,</span>&nbsp;<span class="ident" id="5059332">f</span><span class="op" id="5059333">.</span><span class="ident" id="5059334">Infos</span><span class="op" id="5059339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5059342">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059345">s</span><span class="op" id="5059346">.</span><span class="ident" id="5059347">files</span>&nbsp;<span class="op" id="5059353">=</span>&nbsp;<span class="ident" id="5059355">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059362">s</span><span class="op" id="5059363">.</span><span class="ident" id="5059364">last</span>&nbsp;<span class="op" id="5059369">=</span>&nbsp;<span class="ident" id="5059371">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059376">s</span><span class="op" id="5059377">.</span><span class="ident" id="5059378">mutex</span><span class="op" id="5059383">.</span><span class="ident" id="5059384">Unlock</span><span class="op" id="5059390">(</span><span class="op" id="5059391">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059395">return</span>&nbsp;<span class="ident" id="5059402">nil</span><br>
<span class="lineno">40</span><span class="op" id="5059406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5059409">//&nbsp;Write&nbsp;calls&nbsp;encode&nbsp;to&nbsp;serialize&nbsp;the&nbsp;file&nbsp;set&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="5059460">func</span>&nbsp;<span class="op" id="5059465">(</span><span class="ident" id="5059466">s</span>&nbsp;<span class="op" id="5059468">*</span><span class="ident" id="5059469">FileSet</span><span class="op" id="5059476">)</span>&nbsp;<span class="ident" id="5059478">Write</span><span class="op" id="5059483">(</span><span class="ident" id="5059484">encode</span>&nbsp;<span class="keyword" id="5059491">func</span><span class="op" id="5059495">(</span><span class="keyword" id="5059496">interface</span><span class="op" id="5059505">{</span><span class="op" id="5059506">}</span><span class="op" id="5059507">)</span>&nbsp;<span class="builtintype" id="5059509">error</span><span class="op" id="5059514">)</span>&nbsp;<span class="builtintype" id="5059516">error</span>&nbsp;<span class="op" id="5059522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059525">var</span>&nbsp;<span class="ident" id="5059529">ss</span>&nbsp;<span class="ident" id="5059532">serializedFileSet</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059552">s</span><span class="op" id="5059553">.</span><span class="ident" id="5059554">mutex</span><span class="op" id="5059559">.</span><span class="ident" id="5059560">Lock</span><span class="op" id="5059564">(</span><span class="op" id="5059565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059568">ss</span><span class="op" id="5059570">.</span><span class="ident" id="5059571">Base</span>&nbsp;<span class="op" id="5059576">=</span>&nbsp;<span class="ident" id="5059578">s</span><span class="op" id="5059579">.</span><span class="ident" id="5059580">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059586">files</span>&nbsp;<span class="op" id="5059592">:=</span>&nbsp;<span class="builtinfunc" id="5059595">make</span><span class="op" id="5059599">(</span><span class="op" id="5059600">[</span><span class="op" id="5059601">]</span><span class="ident" id="5059602">serializedFile</span><span class="op" id="5059616">,</span>&nbsp;<span class="builtinfunc" id="5059618">len</span><span class="op" id="5059621">(</span><span class="ident" id="5059622">s</span><span class="op" id="5059623">.</span><span class="ident" id="5059624">files</span><span class="op" id="5059629">)</span><span class="op" id="5059630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059633">for</span>&nbsp;<span class="ident" id="5059637">i</span><span class="op" id="5059638">,</span>&nbsp;<span class="ident" id="5059640">f</span>&nbsp;<span class="op" id="5059642">:=</span>&nbsp;<span class="keyword" id="5059645">range</span>&nbsp;<span class="ident" id="5059651">s</span><span class="op" id="5059652">.</span><span class="ident" id="5059653">files</span>&nbsp;<span class="op" id="5059659">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059663">files</span><span class="op" id="5059668">[</span><span class="ident" id="5059669">i</span><span class="op" id="5059670">]</span>&nbsp;<span class="op" id="5059672">=</span>&nbsp;<span class="ident" id="5059674">serializedFile</span><span class="op" id="5059688">{</span><span class="ident" id="5059689">f</span><span class="op" id="5059690">.</span><span class="ident" id="5059691">name</span><span class="op" id="5059695">,</span>&nbsp;<span class="ident" id="5059697">f</span><span class="op" id="5059698">.</span><span class="ident" id="5059699">base</span><span class="op" id="5059703">,</span>&nbsp;<span class="ident" id="5059705">f</span><span class="op" id="5059706">.</span><span class="ident" id="5059707">size</span><span class="op" id="5059711">,</span>&nbsp;<span class="ident" id="5059713">f</span><span class="op" id="5059714">.</span><span class="ident" id="5059715">lines</span><span class="op" id="5059720">,</span>&nbsp;<span class="ident" id="5059722">f</span><span class="op" id="5059723">.</span><span class="ident" id="5059724">infos</span><span class="op" id="5059729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5059732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059735">ss</span><span class="op" id="5059737">.</span><span class="ident" id="5059738">Files</span>&nbsp;<span class="op" id="5059744">=</span>&nbsp;<span class="ident" id="5059746">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5059753">s</span><span class="op" id="5059754">.</span><span class="ident" id="5059755">mutex</span><span class="op" id="5059760">.</span><span class="ident" id="5059761">Unlock</span><span class="op" id="5059767">(</span><span class="op" id="5059768">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5059772">return</span>&nbsp;<span class="ident" id="5059779">encode</span><span class="op" id="5059785">(</span><span class="ident" id="5059786">ss</span><span class="op" id="5059788">)</span><br>
<span class="lineno"></span><span class="op" id="5059790">}</span>
</div>
</body>
</html>
