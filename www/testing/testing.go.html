<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5620303">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5620358">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5620412">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5620463">//&nbsp;Package&nbsp;testing&nbsp;provides&nbsp;support&nbsp;for&nbsp;automated&nbsp;testing&nbsp;of&nbsp;Go&nbsp;packages.</span><br>
<span class="lineno"></span><span class="comment" id="5620537">//&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;in&nbsp;concert&nbsp;with&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command,&nbsp;which&nbsp;automates</span><br>
<span class="lineno"></span><span class="comment" id="5620623">//&nbsp;execution&nbsp;of&nbsp;any&nbsp;function&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5620664">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestXxx(*testing.T)</span><br>
<span class="lineno"></span><span class="comment" id="5620696">//&nbsp;where&nbsp;Xxx&nbsp;can&nbsp;be&nbsp;any&nbsp;alphanumeric&nbsp;string&nbsp;(but&nbsp;the&nbsp;first&nbsp;letter&nbsp;must&nbsp;not&nbsp;be&nbsp;in</span><br>
<span class="lineno">10</span><span class="comment" id="5620777">//&nbsp;[a-z])&nbsp;and&nbsp;serves&nbsp;to&nbsp;identify&nbsp;the&nbsp;test&nbsp;routine.</span><br>
<span class="lineno"></span><span class="comment" id="5620828">//</span><br>
<span class="lineno"></span><span class="comment" id="5620831">//&nbsp;Within&nbsp;these&nbsp;functions,&nbsp;use&nbsp;the&nbsp;Error,&nbsp;Fail&nbsp;or&nbsp;related&nbsp;methods&nbsp;to&nbsp;signal&nbsp;failure.</span><br>
<span class="lineno"></span><span class="comment" id="5620916">//</span><br>
<span class="lineno"></span><span class="comment" id="5620919">//&nbsp;To&nbsp;write&nbsp;a&nbsp;new&nbsp;test&nbsp;suite,&nbsp;create&nbsp;a&nbsp;file&nbsp;whose&nbsp;name&nbsp;ends&nbsp;_test.go&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="5620993">//&nbsp;contains&nbsp;the&nbsp;TestXxx&nbsp;functions&nbsp;as&nbsp;described&nbsp;here.&nbsp;Put&nbsp;the&nbsp;file&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="5621071">//&nbsp;package&nbsp;as&nbsp;the&nbsp;one&nbsp;being&nbsp;tested.&nbsp;The&nbsp;file&nbsp;will&nbsp;be&nbsp;excluded&nbsp;from&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="5621146">//&nbsp;package&nbsp;builds&nbsp;but&nbsp;will&nbsp;be&nbsp;included&nbsp;when&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span><span class="comment" id="5621222">//&nbsp;For&nbsp;more&nbsp;detail,&nbsp;run&nbsp;``go&nbsp;help&nbsp;test&#39;&#39;&nbsp;and&nbsp;``go&nbsp;help&nbsp;testflag&#39;&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="5621289">//</span><br>
<span class="lineno">20</span><span class="comment" id="5621292">//&nbsp;Tests&nbsp;and&nbsp;benchmarks&nbsp;may&nbsp;be&nbsp;skipped&nbsp;if&nbsp;not&nbsp;applicable&nbsp;with&nbsp;a&nbsp;call&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5621364">//&nbsp;the&nbsp;Skip&nbsp;method&nbsp;of&nbsp;*T&nbsp;and&nbsp;*B:</span><br>
<span class="lineno"></span><span class="comment" id="5621397">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestTimeConsuming(t&nbsp;*testing.T)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5621443">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;testing.Short()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5621475">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.Skip(&#34;skipping&nbsp;test&nbsp;in&nbsp;short&nbsp;mode.&#34;)</span><br>
<span class="lineno">25</span><span class="comment" id="5621529">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5621542">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5621557">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5621566">//</span><br>
<span class="lineno"></span><span class="comment" id="5621569">//&nbsp;Benchmarks</span><br>
<span class="lineno">30</span><span class="comment" id="5621583">//</span><br>
<span class="lineno"></span><span class="comment" id="5621586">//&nbsp;Functions&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5621611">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkXxx(*testing.B)</span><br>
<span class="lineno"></span><span class="comment" id="5621648">//&nbsp;are&nbsp;considered&nbsp;benchmarks,&nbsp;and&nbsp;are&nbsp;executed&nbsp;by&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="5621725">//&nbsp;its&nbsp;-bench&nbsp;flag&nbsp;is&nbsp;provided.&nbsp;Benchmarks&nbsp;are&nbsp;run&nbsp;sequentially.</span><br>
<span class="lineno">35</span><span class="comment" id="5621790">//</span><br>
<span class="lineno"></span><span class="comment" id="5621793">//&nbsp;For&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;testing&nbsp;flags,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="5621840">//&nbsp;http://golang.org/cmd/go/#hdr-Description_of_testing_flags.</span><br>
<span class="lineno"></span><span class="comment" id="5621903">//</span><br>
<span class="lineno"></span><span class="comment" id="5621906">//&nbsp;A&nbsp;sample&nbsp;benchmark&nbsp;function&nbsp;looks&nbsp;like&nbsp;this:</span><br>
<span class="lineno">40</span><span class="comment" id="5621954">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkHello(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5621997">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5622035">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Sprintf(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5622071">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5622084">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">45</span><span class="comment" id="5622093">//</span><br>
<span class="lineno"></span><span class="comment" id="5622096">//&nbsp;The&nbsp;benchmark&nbsp;function&nbsp;must&nbsp;run&nbsp;the&nbsp;target&nbsp;code&nbsp;b.N&nbsp;times.</span><br>
<span class="lineno"></span><span class="comment" id="5622158">//&nbsp;During&nbsp;benchark&nbsp;execution,&nbsp;b.N&nbsp;is&nbsp;adjusted&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;lasts</span><br>
<span class="lineno"></span><span class="comment" id="5622239">//&nbsp;long&nbsp;enough&nbsp;to&nbsp;be&nbsp;timed&nbsp;reliably.&nbsp;&nbsp;The&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="5622288">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp;10000000&nbsp;&nbsp;&nbsp;&nbsp;282&nbsp;ns/op</span><br>
<span class="lineno">50</span><span class="comment" id="5622335">//&nbsp;means&nbsp;that&nbsp;the&nbsp;loop&nbsp;ran&nbsp;10000000&nbsp;times&nbsp;at&nbsp;a&nbsp;speed&nbsp;of&nbsp;282&nbsp;ns&nbsp;per&nbsp;loop.</span><br>
<span class="lineno"></span><span class="comment" id="5622408">//</span><br>
<span class="lineno"></span><span class="comment" id="5622411">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;some&nbsp;expensive&nbsp;setup&nbsp;before&nbsp;running,&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="5622482">//&nbsp;may&nbsp;be&nbsp;reset:</span><br>
<span class="lineno"></span><span class="comment" id="5622499">//</span><br>
<span class="lineno">55</span><span class="comment" id="5622502">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkBigLen(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5622546">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big&nbsp;:=&nbsp;NewBig()</span><br>
<span class="lineno"></span><span class="comment" id="5622573">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.ResetTimer()</span><br>
<span class="lineno"></span><span class="comment" id="5622599">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5622637">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big.Len()</span><br>
<span class="lineno">60</span><span class="comment" id="5622662">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5622675">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5622684">//</span><br>
<span class="lineno"></span><span class="comment" id="5622687">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;to&nbsp;test&nbsp;performance&nbsp;in&nbsp;a&nbsp;parallel&nbsp;setting,&nbsp;it&nbsp;may&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="5622765">//&nbsp;the&nbsp;RunParallel&nbsp;helper&nbsp;function;&nbsp;such&nbsp;benchmarks&nbsp;are&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;with</span><br>
<span class="lineno">65</span><span class="comment" id="5622846">//&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag:</span><br>
<span class="lineno"></span><span class="comment" id="5622872">//</span><br>
<span class="lineno"></span><span class="comment" id="5622875">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkTemplateParallel(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5622929">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ&nbsp;:=&nbsp;template.Must(template.New(&#34;test&#34;).Parse(&#34;Hello,&nbsp;{{.}}!&#34;))</span><br>
<span class="lineno"></span><span class="comment" id="5623008">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.RunParallel(func(pb&nbsp;*testing.PB)&nbsp;{</span><br>
<span class="lineno">70</span><span class="comment" id="5623056">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;buf&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span><span class="comment" id="5623092">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;pb.Next()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5623123">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.Reset()</span><br>
<span class="lineno"></span><span class="comment" id="5623154">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ.Execute(&amp;buf,&nbsp;&#34;World&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5623202">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">75</span><span class="comment" id="5623219">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><br>
<span class="lineno"></span><span class="comment" id="5623233">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5623242">//</span><br>
<span class="lineno"></span><span class="comment" id="5623245">//&nbsp;Examples</span><br>
<span class="lineno"></span><span class="comment" id="5623257">//</span><br>
<span class="lineno">80</span><span class="comment" id="5623260">//&nbsp;The&nbsp;package&nbsp;also&nbsp;runs&nbsp;and&nbsp;verifies&nbsp;example&nbsp;code.&nbsp;Example&nbsp;functions&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="5623334">//&nbsp;include&nbsp;a&nbsp;concluding&nbsp;line&nbsp;comment&nbsp;that&nbsp;begins&nbsp;with&nbsp;&#34;Output:&#34;&nbsp;and&nbsp;is&nbsp;compared&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5623419">//&nbsp;the&nbsp;standard&nbsp;output&nbsp;of&nbsp;the&nbsp;function&nbsp;when&nbsp;the&nbsp;tests&nbsp;are&nbsp;run.&nbsp;(The&nbsp;comparison</span><br>
<span class="lineno"></span><span class="comment" id="5623498">//&nbsp;ignores&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.)&nbsp;These&nbsp;are&nbsp;examples&nbsp;of&nbsp;an&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="5623572">//</span><br>
<span class="lineno">85</span><span class="comment" id="5623575">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleHello()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5623604">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5623640">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:&nbsp;hello</span><br>
<span class="lineno"></span><span class="comment" id="5623672">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5623681">//</span><br>
<span class="lineno">90</span><span class="comment" id="5623684">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleSalutations()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5623719">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello,&nbsp;and&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5623760">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;goodbye&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5623798">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:</span><br>
<span class="lineno"></span><span class="comment" id="5623824">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;hello,&nbsp;and</span><br>
<span class="lineno">95</span><span class="comment" id="5623853">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;goodbye</span><br>
<span class="lineno"></span><span class="comment" id="5623879">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5623888">//</span><br>
<span class="lineno"></span><span class="comment" id="5623891">//&nbsp;Example&nbsp;functions&nbsp;without&nbsp;output&nbsp;comments&nbsp;are&nbsp;compiled&nbsp;but&nbsp;not&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="5623967">//</span><br>
<span class="lineno">100</span><span class="comment" id="5623970">//&nbsp;The&nbsp;naming&nbsp;convention&nbsp;to&nbsp;declare&nbsp;examples&nbsp;for&nbsp;the&nbsp;package,&nbsp;a&nbsp;function&nbsp;F,&nbsp;a&nbsp;type&nbsp;T&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5624059">//&nbsp;method&nbsp;M&nbsp;on&nbsp;type&nbsp;T&nbsp;are:</span><br>
<span class="lineno"></span><span class="comment" id="5624086">//</span><br>
<span class="lineno"></span><span class="comment" id="5624089">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5624119">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">105</span><span class="comment" id="5624150">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5624181">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5624214">//</span><br>
<span class="lineno"></span><span class="comment" id="5624217">//&nbsp;Multiple&nbsp;example&nbsp;functions&nbsp;for&nbsp;a&nbsp;package/type/function/method&nbsp;may&nbsp;be&nbsp;provided&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5624301">//&nbsp;appending&nbsp;a&nbsp;distinct&nbsp;suffix&nbsp;to&nbsp;the&nbsp;name.&nbsp;The&nbsp;suffix&nbsp;must&nbsp;start&nbsp;with&nbsp;a</span><br>
<span class="lineno">110</span><span class="comment" id="5624374">//&nbsp;lower-case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="comment" id="5624396">//</span><br>
<span class="lineno"></span><span class="comment" id="5624399">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5624436">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5624474">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">115</span><span class="comment" id="5624512">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5624552">//</span><br>
<span class="lineno"></span><span class="comment" id="5624555">//&nbsp;The&nbsp;entire&nbsp;test&nbsp;file&nbsp;is&nbsp;presented&nbsp;as&nbsp;the&nbsp;example&nbsp;when&nbsp;it&nbsp;contains&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="5624633">//&nbsp;example&nbsp;function,&nbsp;at&nbsp;least&nbsp;one&nbsp;other&nbsp;function,&nbsp;type,&nbsp;variable,&nbsp;or&nbsp;constant</span><br>
<span class="lineno"></span><span class="comment" id="5624711">//&nbsp;declaration,&nbsp;and&nbsp;no&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;functions.</span><br>
<span class="lineno">120</span><span class="comment" id="5624763">//</span><br>
<span class="lineno"></span><span class="comment" id="5624766">//&nbsp;Main</span><br>
<span class="lineno"></span><span class="comment" id="5624774">//</span><br>
<span class="lineno"></span><span class="comment" id="5624777">//&nbsp;It&nbsp;is&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;program&nbsp;to&nbsp;do&nbsp;extra&nbsp;setup&nbsp;or&nbsp;teardown</span><br>
<span class="lineno"></span><span class="comment" id="5624855">//&nbsp;before&nbsp;or&nbsp;after&nbsp;testing.&nbsp;It&nbsp;is&nbsp;also&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;to&nbsp;control</span><br>
<span class="lineno">125</span><span class="comment" id="5624936">//&nbsp;which&nbsp;code&nbsp;runs&nbsp;on&nbsp;the&nbsp;main&nbsp;thread.&nbsp;To&nbsp;support&nbsp;these&nbsp;and&nbsp;other&nbsp;cases,</span><br>
<span class="lineno"></span><span class="comment" id="5625009">//&nbsp;if&nbsp;a&nbsp;test&nbsp;file&nbsp;contains&nbsp;a&nbsp;function:</span><br>
<span class="lineno"></span><span class="comment" id="5625048">//</span><br>
<span class="lineno"></span><span class="comment" id="5625051">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)</span><br>
<span class="lineno"></span><span class="comment" id="5625082">//</span><br>
<span class="lineno">130</span><span class="comment" id="5625085">//&nbsp;then&nbsp;the&nbsp;generated&nbsp;test&nbsp;will&nbsp;call&nbsp;TestMain(m)&nbsp;instead&nbsp;of&nbsp;running&nbsp;the&nbsp;tests</span><br>
<span class="lineno"></span><span class="comment" id="5625163">//&nbsp;directly.&nbsp;TestMain&nbsp;runs&nbsp;in&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;and&nbsp;can&nbsp;do&nbsp;whatever&nbsp;setup</span><br>
<span class="lineno"></span><span class="comment" id="5625238">//&nbsp;and&nbsp;teardown&nbsp;is&nbsp;necessary&nbsp;around&nbsp;a&nbsp;call&nbsp;to&nbsp;m.Run.&nbsp;It&nbsp;should&nbsp;then&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="5625311">//&nbsp;os.Exit&nbsp;with&nbsp;the&nbsp;result&nbsp;of&nbsp;m.Run.</span><br>
<span class="lineno"></span><span class="comment" id="5625348">//</span><br>
<span class="lineno">135</span><span class="comment" id="5625351">//&nbsp;The&nbsp;minimal&nbsp;implementation&nbsp;of&nbsp;TestMain&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="5625397">//</span><br>
<span class="lineno"></span><span class="comment" id="5625400">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)&nbsp;{&nbsp;os.Exit(m.Run())&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5625452">//</span><br>
<span class="lineno"></span><span class="comment" id="5625455">//&nbsp;In&nbsp;effect,&nbsp;that&nbsp;is&nbsp;the&nbsp;implementation&nbsp;used&nbsp;when&nbsp;no&nbsp;TestMain&nbsp;is&nbsp;explicitly&nbsp;defined.</span><br>
<span class="lineno">140</span><span class="keyword" id="5625541">package</span>&nbsp;<span class="ident" id="5625549">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5625558">import</span>&nbsp;<span class="op" id="5625565">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5625568">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5625577">&#34;flag&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5625585">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5625592">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5625598">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5625609">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5625626">&#34;strconv&#34;</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5625637">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5625648">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5625656">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5625663">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="5625666">var</span>&nbsp;<span class="op" id="5625670">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5625673">//&nbsp;The&nbsp;short&nbsp;flag&nbsp;requests&nbsp;that&nbsp;tests&nbsp;run&nbsp;more&nbsp;quickly,&nbsp;but&nbsp;its&nbsp;functionality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5625752">//&nbsp;is&nbsp;provided&nbsp;by&nbsp;test&nbsp;writers&nbsp;themselves.&nbsp;&nbsp;The&nbsp;testing&nbsp;package&nbsp;is&nbsp;just&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5625829">//&nbsp;home.&nbsp;&nbsp;The&nbsp;all.bash&nbsp;installation&nbsp;script&nbsp;sets&nbsp;it&nbsp;to&nbsp;make&nbsp;installation&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5625907">//&nbsp;efficient,&nbsp;but&nbsp;by&nbsp;default&nbsp;the&nbsp;flag&nbsp;is&nbsp;off&nbsp;so&nbsp;a&nbsp;plain&nbsp;&#34;go&nbsp;test&#34;&nbsp;will&nbsp;do&nbsp;a</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5625984">//&nbsp;full&nbsp;test&nbsp;of&nbsp;the&nbsp;package.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5626014">short</span>&nbsp;<span class="op" id="5626020">=</span>&nbsp;<span class="ident" id="5626022">flag</span><span class="op" id="5626026">.</span><span class="ident" id="5626027">Bool</span><span class="op" id="5626031">(</span><span class="string" id="5626032">&#34;test.short&#34;</span><span class="op" id="5626044">,</span>&nbsp;<span class="ident" id="5626046">false</span><span class="op" id="5626051">,</span>&nbsp;<span class="string" id="5626053">&#34;run&nbsp;smaller&nbsp;test&nbsp;suite&nbsp;to&nbsp;save&nbsp;time&#34;</span><span class="op" id="5626090">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5626094">//&nbsp;The&nbsp;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;create&nbsp;profile&nbsp;files&nbsp;and&nbsp;the&nbsp;like.&nbsp;When&nbsp;run&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5626173">//&nbsp;&#34;go&nbsp;test&#34;,&nbsp;the&nbsp;binary&nbsp;always&nbsp;runs&nbsp;in&nbsp;the&nbsp;source&nbsp;directory&nbsp;for&nbsp;the&nbsp;package;</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5626252">//&nbsp;this&nbsp;flag&nbsp;lets&nbsp;&#34;go&nbsp;test&#34;&nbsp;tell&nbsp;the&nbsp;binary&nbsp;to&nbsp;write&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;directory&nbsp;where</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5626339">//&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5626373">outputDir</span>&nbsp;<span class="op" id="5626383">=</span>&nbsp;<span class="ident" id="5626385">flag</span><span class="op" id="5626389">.</span><span class="ident" id="5626390">String</span><span class="op" id="5626396">(</span><span class="string" id="5626397">&#34;test.outputdir&#34;</span><span class="op" id="5626413">,</span>&nbsp;<span class="string" id="5626415">&#34;&#34;</span><span class="op" id="5626417">,</span>&nbsp;<span class="string" id="5626419">&#34;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;write&nbsp;profiles&#34;</span><span class="op" id="5626457">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5626461">//&nbsp;Report&nbsp;as&nbsp;tests&nbsp;are&nbsp;run;&nbsp;default&nbsp;is&nbsp;silent&nbsp;for&nbsp;success.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5626521">chatty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5626538">=</span>&nbsp;<span class="ident" id="5626540">flag</span><span class="op" id="5626544">.</span><span class="ident" id="5626545">Bool</span><span class="op" id="5626549">(</span><span class="string" id="5626550">&#34;test.v&#34;</span><span class="op" id="5626558">,</span>&nbsp;<span class="ident" id="5626560">false</span><span class="op" id="5626565">,</span>&nbsp;<span class="string" id="5626567">&#34;verbose:&nbsp;print&nbsp;additional&nbsp;output&#34;</span><span class="op" id="5626601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5626604">coverProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5626621">=</span>&nbsp;<span class="ident" id="5626623">flag</span><span class="op" id="5626627">.</span><span class="ident" id="5626628">String</span><span class="op" id="5626634">(</span><span class="string" id="5626635">&#34;test.coverprofile&#34;</span><span class="op" id="5626654">,</span>&nbsp;<span class="string" id="5626656">&#34;&#34;</span><span class="op" id="5626658">,</span>&nbsp;<span class="string" id="5626660">&#34;write&nbsp;a&nbsp;coverage&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="5626720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5626723">match</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5626740">=</span>&nbsp;<span class="ident" id="5626742">flag</span><span class="op" id="5626746">.</span><span class="ident" id="5626747">String</span><span class="op" id="5626753">(</span><span class="string" id="5626754">&#34;test.run&#34;</span><span class="op" id="5626764">,</span>&nbsp;<span class="string" id="5626766">&#34;&#34;</span><span class="op" id="5626768">,</span>&nbsp;<span class="string" id="5626770">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;tests&nbsp;and&nbsp;examples&nbsp;to&nbsp;run&#34;</span><span class="op" id="5626826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5626829">memProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5626846">=</span>&nbsp;<span class="ident" id="5626848">flag</span><span class="op" id="5626852">.</span><span class="ident" id="5626853">String</span><span class="op" id="5626859">(</span><span class="string" id="5626860">&#34;test.memprofile&#34;</span><span class="op" id="5626877">,</span>&nbsp;<span class="string" id="5626879">&#34;&#34;</span><span class="op" id="5626881">,</span>&nbsp;<span class="string" id="5626883">&#34;write&nbsp;a&nbsp;memory&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="5626941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5626944">memProfileRate</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5626961">=</span>&nbsp;<span class="ident" id="5626963">flag</span><span class="op" id="5626967">.</span><span class="ident" id="5626968">Int</span><span class="op" id="5626971">(</span><span class="string" id="5626972">&#34;test.memprofilerate&#34;</span><span class="op" id="5626993">,</span>&nbsp;<span class="num" id="5626995">0</span><span class="op" id="5626996">,</span>&nbsp;<span class="string" id="5626998">&#34;if&nbsp;&gt;=0,&nbsp;sets&nbsp;runtime.MemProfileRate&#34;</span><span class="op" id="5627035">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627038">cpuProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5627055">=</span>&nbsp;<span class="ident" id="5627057">flag</span><span class="op" id="5627061">.</span><span class="ident" id="5627062">String</span><span class="op" id="5627068">(</span><span class="string" id="5627069">&#34;test.cpuprofile&#34;</span><span class="op" id="5627086">,</span>&nbsp;<span class="string" id="5627088">&#34;&#34;</span><span class="op" id="5627090">,</span>&nbsp;<span class="string" id="5627092">&#34;write&nbsp;a&nbsp;cpu&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;during&nbsp;execution&#34;</span><span class="op" id="5627148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627151">blockProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5627168">=</span>&nbsp;<span class="ident" id="5627170">flag</span><span class="op" id="5627174">.</span><span class="ident" id="5627175">String</span><span class="op" id="5627181">(</span><span class="string" id="5627182">&#34;test.blockprofile&#34;</span><span class="op" id="5627201">,</span>&nbsp;<span class="string" id="5627203">&#34;&#34;</span><span class="op" id="5627205">,</span>&nbsp;<span class="string" id="5627207">&#34;write&nbsp;a&nbsp;goroutine&nbsp;blocking&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="5627277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627280">blockProfileRate</span>&nbsp;<span class="op" id="5627297">=</span>&nbsp;<span class="ident" id="5627299">flag</span><span class="op" id="5627303">.</span><span class="ident" id="5627304">Int</span><span class="op" id="5627307">(</span><span class="string" id="5627308">&#34;test.blockprofilerate&#34;</span><span class="op" id="5627331">,</span>&nbsp;<span class="num" id="5627333">1</span><span class="op" id="5627334">,</span>&nbsp;<span class="string" id="5627336">&#34;if&nbsp;&gt;=&nbsp;0,&nbsp;calls&nbsp;runtime.SetBlockProfileRate()&#34;</span><span class="op" id="5627382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627385">timeout</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5627402">=</span>&nbsp;<span class="ident" id="5627404">flag</span><span class="op" id="5627408">.</span><span class="ident" id="5627409">Duration</span><span class="op" id="5627417">(</span><span class="string" id="5627418">&#34;test.timeout&#34;</span><span class="op" id="5627432">,</span>&nbsp;<span class="num" id="5627434">0</span><span class="op" id="5627435">,</span>&nbsp;<span class="string" id="5627437">&#34;if&nbsp;positive,&nbsp;sets&nbsp;an&nbsp;aggregate&nbsp;time&nbsp;limit&nbsp;for&nbsp;all&nbsp;tests&#34;</span><span class="op" id="5627494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627497">cpuListStr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5627514">=</span>&nbsp;<span class="ident" id="5627516">flag</span><span class="op" id="5627520">.</span><span class="ident" id="5627521">String</span><span class="op" id="5627527">(</span><span class="string" id="5627528">&#34;test.cpu&#34;</span><span class="op" id="5627538">,</span>&nbsp;<span class="string" id="5627540">&#34;&#34;</span><span class="op" id="5627542">,</span>&nbsp;<span class="string" id="5627544">&#34;comma-separated&nbsp;list&nbsp;of&nbsp;number&nbsp;of&nbsp;CPUs&nbsp;to&nbsp;use&nbsp;for&nbsp;each&nbsp;test&#34;</span><span class="op" id="5627605">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627608">parallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5627625">=</span>&nbsp;<span class="ident" id="5627627">flag</span><span class="op" id="5627631">.</span><span class="ident" id="5627632">Int</span><span class="op" id="5627635">(</span><span class="string" id="5627636">&#34;test.parallel&#34;</span><span class="op" id="5627651">,</span>&nbsp;<span class="ident" id="5627653">runtime</span><span class="op" id="5627660">.</span><span class="ident" id="5627661">GOMAXPROCS</span><span class="op" id="5627671">(</span><span class="num" id="5627672">0</span><span class="op" id="5627673">)</span><span class="op" id="5627674">,</span>&nbsp;<span class="string" id="5627676">&#34;maximum&nbsp;test&nbsp;parallelism&#34;</span><span class="op" id="5627702">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627706">haveExamples</span>&nbsp;<span class="builtintype" id="5627719">bool</span>&nbsp;<span class="comment" id="5627724">//&nbsp;are&nbsp;there&nbsp;examples?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627749">cpuList</span>&nbsp;<span class="op" id="5627757">[</span><span class="op" id="5627758">]</span><span class="builtintype" id="5627759">int</span><br>
<span class="lineno">185</span><span class="op" id="5627763">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5627766">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;elements&nbsp;common&nbsp;between&nbsp;T&nbsp;and&nbsp;B&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5627822">//&nbsp;captures&nbsp;common&nbsp;methods&nbsp;such&nbsp;as&nbsp;Errorf.</span><br>
<span class="lineno"></span><span class="keyword" id="5627865">type</span>&nbsp;<span class="ident" id="5627870">common</span>&nbsp;<span class="keyword" id="5627877">struct</span>&nbsp;<span class="op" id="5627884">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627887">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5627896">sync</span><span class="op" id="5627900">.</span><span class="ident" id="5627901">RWMutex</span>&nbsp;<span class="comment" id="5627909">//&nbsp;guards&nbsp;output&nbsp;and&nbsp;failed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627938">output</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5627947">[</span><span class="op" id="5627948">]</span><span class="builtintype" id="5627949">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5627960">//&nbsp;Output&nbsp;generated&nbsp;by&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5628003">failed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5628012">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5628025">//&nbsp;Test&nbsp;or&nbsp;benchmark&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5628059">skipped</span>&nbsp;&nbsp;<span class="builtintype" id="5628068">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5628081">//&nbsp;Test&nbsp;of&nbsp;benchmark&nbsp;has&nbsp;been&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5628121">finished</span>&nbsp;<span class="builtintype" id="5628130">bool</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5628137">start</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5628146">time</span><span class="op" id="5628150">.</span><span class="ident" id="5628151">Time</span>&nbsp;<span class="comment" id="5628156">//&nbsp;Time&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;started</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5628191">duration</span>&nbsp;<span class="ident" id="5628200">time</span><span class="op" id="5628204">.</span><span class="ident" id="5628205">Duration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5628215">self</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5628224">interface</span><span class="op" id="5628233">{</span><span class="op" id="5628234">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5628241">//&nbsp;To&nbsp;be&nbsp;sent&nbsp;on&nbsp;signal&nbsp;channel&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5628285">signal</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="5628294">chan</span>&nbsp;<span class="keyword" id="5628299">interface</span><span class="op" id="5628308">{</span><span class="op" id="5628309">}</span>&nbsp;<span class="comment" id="5628311">//&nbsp;Output&nbsp;for&nbsp;serial&nbsp;tests.</span><br>
<span class="lineno">200</span><span class="op" id="5628339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5628342">//&nbsp;Short&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.short&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="5628396">func</span>&nbsp;<span class="ident" id="5628401">Short</span><span class="op" id="5628406">(</span><span class="op" id="5628407">)</span>&nbsp;<span class="builtintype" id="5628409">bool</span>&nbsp;<span class="op" id="5628414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5628417">return</span>&nbsp;<span class="op" id="5628424">*</span><span class="ident" id="5628425">short</span><br>
<span class="lineno">205</span><span class="op" id="5628431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5628434">//&nbsp;Verbose&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="5628486">func</span>&nbsp;<span class="ident" id="5628491">Verbose</span><span class="op" id="5628498">(</span><span class="op" id="5628499">)</span>&nbsp;<span class="builtintype" id="5628501">bool</span>&nbsp;<span class="op" id="5628506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5628509">return</span>&nbsp;<span class="op" id="5628516">*</span><span class="ident" id="5628517">chatty</span><br>
<span class="lineno">210</span><span class="op" id="5628524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5628527">//&nbsp;decorate&nbsp;prefixes&nbsp;the&nbsp;string&nbsp;with&nbsp;the&nbsp;file&nbsp;and&nbsp;line&nbsp;of&nbsp;the&nbsp;call&nbsp;site</span><br>
<span class="lineno"></span><span class="comment" id="5628599">//&nbsp;and&nbsp;inserts&nbsp;the&nbsp;final&nbsp;newline&nbsp;if&nbsp;needed&nbsp;and&nbsp;indentation&nbsp;tabs&nbsp;for&nbsp;formatting.</span><br>
<span class="lineno"></span><span class="keyword" id="5628679">func</span>&nbsp;<span class="ident" id="5628684">decorate</span><span class="op" id="5628692">(</span><span class="ident" id="5628693">s</span>&nbsp;<span class="builtintype" id="5628695">string</span><span class="op" id="5628701">)</span>&nbsp;<span class="builtintype" id="5628703">string</span>&nbsp;<span class="op" id="5628710">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5628713">_</span><span class="op" id="5628714">,</span>&nbsp;<span class="ident" id="5628716">file</span><span class="op" id="5628720">,</span>&nbsp;<span class="ident" id="5628722">line</span><span class="op" id="5628726">,</span>&nbsp;<span class="ident" id="5628728">ok</span>&nbsp;<span class="op" id="5628731">:=</span>&nbsp;<span class="ident" id="5628734">runtime</span><span class="op" id="5628741">.</span><span class="ident" id="5628742">Caller</span><span class="op" id="5628748">(</span><span class="num" id="5628749">3</span><span class="op" id="5628750">)</span>&nbsp;<span class="comment" id="5628752">//&nbsp;decorate&nbsp;+&nbsp;log&nbsp;+&nbsp;public&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5628790">if</span>&nbsp;<span class="ident" id="5628793">ok</span>&nbsp;<span class="op" id="5628796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5628800">//&nbsp;Truncate&nbsp;file&nbsp;name&nbsp;at&nbsp;last&nbsp;file&nbsp;name&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5628853">if</span>&nbsp;<span class="ident" id="5628856">index</span>&nbsp;<span class="op" id="5628862">:=</span>&nbsp;<span class="ident" id="5628865">strings</span><span class="op" id="5628872">.</span><span class="ident" id="5628873">LastIndex</span><span class="op" id="5628882">(</span><span class="ident" id="5628883">file</span><span class="op" id="5628887">,</span>&nbsp;<span class="string" id="5628889">&#34;/&#34;</span><span class="op" id="5628892">)</span><span class="op" id="5628893">;</span>&nbsp;<span class="ident" id="5628895">index</span>&nbsp;<span class="op" id="5628901">&gt;=</span>&nbsp;<span class="num" id="5628904">0</span>&nbsp;<span class="op" id="5628906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5628911">file</span>&nbsp;<span class="op" id="5628916">=</span>&nbsp;<span class="ident" id="5628918">file</span><span class="op" id="5628922">[</span><span class="ident" id="5628923">index</span><span class="op" id="5628928">+</span><span class="num" id="5628929">1</span><span class="op" id="5628930">:</span><span class="op" id="5628931">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5628935">}</span>&nbsp;<span class="keyword" id="5628937">else</span>&nbsp;<span class="keyword" id="5628942">if</span>&nbsp;<span class="ident" id="5628945">index</span>&nbsp;<span class="op" id="5628951">=</span>&nbsp;<span class="ident" id="5628953">strings</span><span class="op" id="5628960">.</span><span class="ident" id="5628961">LastIndex</span><span class="op" id="5628970">(</span><span class="ident" id="5628971">file</span><span class="op" id="5628975">,</span>&nbsp;<span class="string" id="5628977">&#34;\\&#34;</span><span class="op" id="5628981">)</span><span class="op" id="5628982">;</span>&nbsp;<span class="ident" id="5628984">index</span>&nbsp;<span class="op" id="5628990">&gt;=</span>&nbsp;<span class="num" id="5628993">0</span>&nbsp;<span class="op" id="5628995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629000">file</span>&nbsp;<span class="op" id="5629005">=</span>&nbsp;<span class="ident" id="5629007">file</span><span class="op" id="5629011">[</span><span class="ident" id="5629012">index</span><span class="op" id="5629017">+</span><span class="num" id="5629018">1</span><span class="op" id="5629019">:</span><span class="op" id="5629020">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5629024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5629027">}</span>&nbsp;<span class="keyword" id="5629029">else</span>&nbsp;<span class="op" id="5629034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629038">file</span>&nbsp;<span class="op" id="5629043">=</span>&nbsp;<span class="string" id="5629045">&#34;???&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629053">line</span>&nbsp;<span class="op" id="5629058">=</span>&nbsp;<span class="num" id="5629060">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5629063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629066">buf</span>&nbsp;<span class="op" id="5629070">:=</span>&nbsp;<span class="builtinfunc" id="5629073">new</span><span class="op" id="5629076">(</span><span class="ident" id="5629077">bytes</span><span class="op" id="5629082">.</span><span class="ident" id="5629083">Buffer</span><span class="op" id="5629089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5629092">//&nbsp;Every&nbsp;line&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629137">buf</span><span class="op" id="5629140">.</span><span class="ident" id="5629141">WriteByte</span><span class="op" id="5629150">(</span><span class="string" id="5629151">&#39;\t&#39;</span><span class="op" id="5629155">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629158">fmt</span><span class="op" id="5629161">.</span><span class="ident" id="5629162">Fprintf</span><span class="op" id="5629169">(</span><span class="ident" id="5629170">buf</span><span class="op" id="5629173">,</span>&nbsp;<span class="string" id="5629175">&#34;%s:%d:&nbsp;&#34;</span><span class="op" id="5629184">,</span>&nbsp;<span class="ident" id="5629186">file</span><span class="op" id="5629190">,</span>&nbsp;<span class="ident" id="5629192">line</span><span class="op" id="5629196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629199">lines</span>&nbsp;<span class="op" id="5629205">:=</span>&nbsp;<span class="ident" id="5629208">strings</span><span class="op" id="5629215">.</span><span class="ident" id="5629216">Split</span><span class="op" id="5629221">(</span><span class="ident" id="5629222">s</span><span class="op" id="5629223">,</span>&nbsp;<span class="string" id="5629225">&#34;\n&#34;</span><span class="op" id="5629229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5629232">if</span>&nbsp;<span class="ident" id="5629235">l</span>&nbsp;<span class="op" id="5629237">:=</span>&nbsp;<span class="builtinfunc" id="5629240">len</span><span class="op" id="5629243">(</span><span class="ident" id="5629244">lines</span><span class="op" id="5629249">)</span><span class="op" id="5629250">;</span>&nbsp;<span class="ident" id="5629252">l</span>&nbsp;<span class="op" id="5629254">&gt;</span>&nbsp;<span class="num" id="5629256">1</span>&nbsp;<span class="op" id="5629258">&amp;&amp;</span>&nbsp;<span class="ident" id="5629261">lines</span><span class="op" id="5629266">[</span><span class="ident" id="5629267">l</span><span class="op" id="5629268">-</span><span class="num" id="5629269">1</span><span class="op" id="5629270">]</span>&nbsp;<span class="op" id="5629272">==</span>&nbsp;<span class="string" id="5629275">&#34;&#34;</span>&nbsp;<span class="op" id="5629278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629282">lines</span>&nbsp;<span class="op" id="5629288">=</span>&nbsp;<span class="ident" id="5629290">lines</span><span class="op" id="5629295">[</span><span class="op" id="5629296">:</span><span class="ident" id="5629297">l</span><span class="op" id="5629298">-</span><span class="num" id="5629299">1</span><span class="op" id="5629300">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5629303">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5629306">for</span>&nbsp;<span class="ident" id="5629310">i</span><span class="op" id="5629311">,</span>&nbsp;<span class="ident" id="5629313">line</span>&nbsp;<span class="op" id="5629318">:=</span>&nbsp;<span class="keyword" id="5629321">range</span>&nbsp;<span class="ident" id="5629327">lines</span>&nbsp;<span class="op" id="5629333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5629337">if</span>&nbsp;<span class="ident" id="5629340">i</span>&nbsp;<span class="op" id="5629342">&gt;</span>&nbsp;<span class="num" id="5629344">0</span>&nbsp;<span class="op" id="5629346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5629351">//&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;lines&nbsp;are&nbsp;indented&nbsp;an&nbsp;extra&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629412">buf</span><span class="op" id="5629415">.</span><span class="ident" id="5629416">WriteString</span><span class="op" id="5629427">(</span><span class="string" id="5629428">&#34;\n\t\t&#34;</span><span class="op" id="5629436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5629440">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629444">buf</span><span class="op" id="5629447">.</span><span class="ident" id="5629448">WriteString</span><span class="op" id="5629459">(</span><span class="ident" id="5629460">line</span><span class="op" id="5629464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5629467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629470">buf</span><span class="op" id="5629473">.</span><span class="ident" id="5629474">WriteByte</span><span class="op" id="5629483">(</span><span class="string" id="5629484">&#39;\n&#39;</span><span class="op" id="5629488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5629491">return</span>&nbsp;<span class="ident" id="5629498">buf</span><span class="op" id="5629501">.</span><span class="ident" id="5629502">String</span><span class="op" id="5629508">(</span><span class="op" id="5629509">)</span><br>
<span class="lineno"></span><span class="op" id="5629511">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="5629514">//&nbsp;fmtDuration&nbsp;returns&nbsp;a&nbsp;string&nbsp;representing&nbsp;d&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;87.00s&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5629583">func</span>&nbsp;<span class="ident" id="5629588">fmtDuration</span><span class="op" id="5629599">(</span><span class="ident" id="5629600">d</span>&nbsp;<span class="ident" id="5629602">time</span><span class="op" id="5629606">.</span><span class="ident" id="5629607">Duration</span><span class="op" id="5629615">)</span>&nbsp;<span class="builtintype" id="5629617">string</span>&nbsp;<span class="op" id="5629624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5629627">return</span>&nbsp;<span class="ident" id="5629634">fmt</span><span class="op" id="5629637">.</span><span class="ident" id="5629638">Sprintf</span><span class="op" id="5629645">(</span><span class="string" id="5629646">&#34;%.2fs&#34;</span><span class="op" id="5629653">,</span>&nbsp;<span class="ident" id="5629655">d</span><span class="op" id="5629656">.</span><span class="ident" id="5629657">Seconds</span><span class="op" id="5629664">(</span><span class="op" id="5629665">)</span><span class="op" id="5629666">)</span><br>
<span class="lineno"></span><span class="op" id="5629668">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="comment" id="5629671">//&nbsp;TB&nbsp;is&nbsp;the&nbsp;interface&nbsp;common&nbsp;to&nbsp;T&nbsp;and&nbsp;B.</span><br>
<span class="lineno"></span><span class="keyword" id="5629713">type</span>&nbsp;<span class="ident" id="5629718">TB</span>&nbsp;<span class="keyword" id="5629721">interface</span>&nbsp;<span class="op" id="5629731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629734">Error</span><span class="op" id="5629739">(</span><span class="ident" id="5629740">args</span>&nbsp;<span class="op" id="5629745">...</span><span class="keyword" id="5629748">interface</span><span class="op" id="5629757">{</span><span class="op" id="5629758">}</span><span class="op" id="5629759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629762">Errorf</span><span class="op" id="5629768">(</span><span class="ident" id="5629769">format</span>&nbsp;<span class="builtintype" id="5629776">string</span><span class="op" id="5629782">,</span>&nbsp;<span class="ident" id="5629784">args</span>&nbsp;<span class="op" id="5629789">...</span><span class="keyword" id="5629792">interface</span><span class="op" id="5629801">{</span><span class="op" id="5629802">}</span><span class="op" id="5629803">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629806">Fail</span><span class="op" id="5629810">(</span><span class="op" id="5629811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629814">FailNow</span><span class="op" id="5629821">(</span><span class="op" id="5629822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629825">Failed</span><span class="op" id="5629831">(</span><span class="op" id="5629832">)</span>&nbsp;<span class="builtintype" id="5629834">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629840">Fatal</span><span class="op" id="5629845">(</span><span class="ident" id="5629846">args</span>&nbsp;<span class="op" id="5629851">...</span><span class="keyword" id="5629854">interface</span><span class="op" id="5629863">{</span><span class="op" id="5629864">}</span><span class="op" id="5629865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629868">Fatalf</span><span class="op" id="5629874">(</span><span class="ident" id="5629875">format</span>&nbsp;<span class="builtintype" id="5629882">string</span><span class="op" id="5629888">,</span>&nbsp;<span class="ident" id="5629890">args</span>&nbsp;<span class="op" id="5629895">...</span><span class="keyword" id="5629898">interface</span><span class="op" id="5629907">{</span><span class="op" id="5629908">}</span><span class="op" id="5629909">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629912">Log</span><span class="op" id="5629915">(</span><span class="ident" id="5629916">args</span>&nbsp;<span class="op" id="5629921">...</span><span class="keyword" id="5629924">interface</span><span class="op" id="5629933">{</span><span class="op" id="5629934">}</span><span class="op" id="5629935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629938">Logf</span><span class="op" id="5629942">(</span><span class="ident" id="5629943">format</span>&nbsp;<span class="builtintype" id="5629950">string</span><span class="op" id="5629956">,</span>&nbsp;<span class="ident" id="5629958">args</span>&nbsp;<span class="op" id="5629963">...</span><span class="keyword" id="5629966">interface</span><span class="op" id="5629975">{</span><span class="op" id="5629976">}</span><span class="op" id="5629977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629980">Skip</span><span class="op" id="5629984">(</span><span class="ident" id="5629985">args</span>&nbsp;<span class="op" id="5629990">...</span><span class="keyword" id="5629993">interface</span><span class="op" id="5630002">{</span><span class="op" id="5630003">}</span><span class="op" id="5630004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630007">SkipNow</span><span class="op" id="5630014">(</span><span class="op" id="5630015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630018">Skipf</span><span class="op" id="5630023">(</span><span class="ident" id="5630024">format</span>&nbsp;<span class="builtintype" id="5630031">string</span><span class="op" id="5630037">,</span>&nbsp;<span class="ident" id="5630039">args</span>&nbsp;<span class="op" id="5630044">...</span><span class="keyword" id="5630047">interface</span><span class="op" id="5630056">{</span><span class="op" id="5630057">}</span><span class="op" id="5630058">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630061">Skipped</span><span class="op" id="5630068">(</span><span class="op" id="5630069">)</span>&nbsp;<span class="builtintype" id="5630071">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5630078">//&nbsp;A&nbsp;private&nbsp;method&nbsp;to&nbsp;prevent&nbsp;users&nbsp;implementing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5630133">//&nbsp;interface&nbsp;and&nbsp;so&nbsp;future&nbsp;additions&nbsp;to&nbsp;it&nbsp;will&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5630186">//&nbsp;violate&nbsp;Go&nbsp;1&nbsp;compatibility.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630218">private</span><span class="op" id="5630225">(</span><span class="op" id="5630226">)</span><br>
<span class="lineno"></span><span class="op" id="5630228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5630231">var</span>&nbsp;<span class="ident" id="5630235">_</span>&nbsp;<span class="ident" id="5630237">TB</span>&nbsp;<span class="op" id="5630240">=</span>&nbsp;<span class="op" id="5630242">(</span><span class="op" id="5630243">*</span><span class="ident" id="5630244">T</span><span class="op" id="5630245">)</span><span class="op" id="5630246">(</span><span class="ident" id="5630247">nil</span><span class="op" id="5630250">)</span><br>
<span class="lineno"></span><span class="keyword" id="5630252">var</span>&nbsp;<span class="ident" id="5630256">_</span>&nbsp;<span class="ident" id="5630258">TB</span>&nbsp;<span class="op" id="5630261">=</span>&nbsp;<span class="op" id="5630263">(</span><span class="op" id="5630264">*</span><span class="ident" id="5630265">B</span><span class="op" id="5630266">)</span><span class="op" id="5630267">(</span><span class="ident" id="5630268">nil</span><span class="op" id="5630271">)</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="5630274">//&nbsp;T&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Test&nbsp;functions&nbsp;to&nbsp;manage&nbsp;test&nbsp;state&nbsp;and&nbsp;support&nbsp;formatted&nbsp;test&nbsp;logs.</span><br>
<span class="lineno"></span><span class="comment" id="5630368">//&nbsp;Logs&nbsp;are&nbsp;accumulated&nbsp;during&nbsp;execution&nbsp;and&nbsp;dumped&nbsp;to&nbsp;standard&nbsp;error&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="5630449">type</span>&nbsp;<span class="ident" id="5630454">T</span>&nbsp;<span class="keyword" id="5630456">struct</span>&nbsp;<span class="op" id="5630463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630466">common</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630474">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5630488">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5630498">//&nbsp;Name&nbsp;of&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630516">startParallel</span>&nbsp;<span class="keyword" id="5630530">chan</span>&nbsp;<span class="builtintype" id="5630535">bool</span>&nbsp;<span class="comment" id="5630540">//&nbsp;Parallel&nbsp;tests&nbsp;will&nbsp;wait&nbsp;on&nbsp;this.</span><br>
<span class="lineno"></span><span class="op" id="5630577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5630580">func</span>&nbsp;<span class="op" id="5630585">(</span><span class="ident" id="5630586">c</span>&nbsp;<span class="op" id="5630588">*</span><span class="ident" id="5630589">common</span><span class="op" id="5630595">)</span>&nbsp;<span class="ident" id="5630597">private</span><span class="op" id="5630604">(</span><span class="op" id="5630605">)</span>&nbsp;<span class="op" id="5630607">{</span><span class="op" id="5630608">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="5630611">//&nbsp;Fail&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;but&nbsp;continues&nbsp;execution.</span><br>
<span class="lineno"></span><span class="keyword" id="5630680">func</span>&nbsp;<span class="op" id="5630685">(</span><span class="ident" id="5630686">c</span>&nbsp;<span class="op" id="5630688">*</span><span class="ident" id="5630689">common</span><span class="op" id="5630695">)</span>&nbsp;<span class="ident" id="5630697">Fail</span><span class="op" id="5630701">(</span><span class="op" id="5630702">)</span>&nbsp;<span class="op" id="5630704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630707">c</span><span class="op" id="5630708">.</span><span class="ident" id="5630709">mu</span><span class="op" id="5630711">.</span><span class="ident" id="5630712">Lock</span><span class="op" id="5630716">(</span><span class="op" id="5630717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5630720">defer</span>&nbsp;<span class="ident" id="5630726">c</span><span class="op" id="5630727">.</span><span class="ident" id="5630728">mu</span><span class="op" id="5630730">.</span><span class="ident" id="5630731">Unlock</span><span class="op" id="5630737">(</span><span class="op" id="5630738">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630741">c</span><span class="op" id="5630742">.</span><span class="ident" id="5630743">failed</span>&nbsp;<span class="op" id="5630750">=</span>&nbsp;<span class="ident" id="5630752">true</span><br>
<span class="lineno"></span><span class="op" id="5630757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5630760">//&nbsp;Failed&nbsp;reports&nbsp;whether&nbsp;the&nbsp;function&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="5630811">func</span>&nbsp;<span class="op" id="5630816">(</span><span class="ident" id="5630817">c</span>&nbsp;<span class="op" id="5630819">*</span><span class="ident" id="5630820">common</span><span class="op" id="5630826">)</span>&nbsp;<span class="ident" id="5630828">Failed</span><span class="op" id="5630834">(</span><span class="op" id="5630835">)</span>&nbsp;<span class="builtintype" id="5630837">bool</span>&nbsp;<span class="op" id="5630842">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630845">c</span><span class="op" id="5630846">.</span><span class="ident" id="5630847">mu</span><span class="op" id="5630849">.</span><span class="ident" id="5630850">RLock</span><span class="op" id="5630855">(</span><span class="op" id="5630856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5630859">defer</span>&nbsp;<span class="ident" id="5630865">c</span><span class="op" id="5630866">.</span><span class="ident" id="5630867">mu</span><span class="op" id="5630869">.</span><span class="ident" id="5630870">RUnlock</span><span class="op" id="5630877">(</span><span class="op" id="5630878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5630881">return</span>&nbsp;<span class="ident" id="5630888">c</span><span class="op" id="5630889">.</span><span class="ident" id="5630890">failed</span><br>
<span class="lineno"></span><span class="op" id="5630897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="5630900">//&nbsp;FailNow&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="5630972">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span><span class="comment" id="5631030">//&nbsp;FailNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5631087">//&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;function,&nbsp;not&nbsp;from&nbsp;other&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="5631144">//&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;FailNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno">305</span><span class="comment" id="5631202">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="5631229">func</span>&nbsp;<span class="op" id="5631234">(</span><span class="ident" id="5631235">c</span>&nbsp;<span class="op" id="5631237">*</span><span class="ident" id="5631238">common</span><span class="op" id="5631244">)</span>&nbsp;<span class="ident" id="5631246">FailNow</span><span class="op" id="5631253">(</span><span class="op" id="5631254">)</span>&nbsp;<span class="op" id="5631256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5631259">c</span><span class="op" id="5631260">.</span><span class="ident" id="5631261">Fail</span><span class="op" id="5631265">(</span><span class="op" id="5631266">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631270">//&nbsp;Calling&nbsp;runtime.Goexit&nbsp;will&nbsp;exit&nbsp;the&nbsp;goroutine,&nbsp;which</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631328">//&nbsp;will&nbsp;run&nbsp;the&nbsp;deferred&nbsp;functions&nbsp;in&nbsp;this&nbsp;goroutine,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631383">//&nbsp;which&nbsp;will&nbsp;eventually&nbsp;run&nbsp;the&nbsp;deferred&nbsp;lines&nbsp;in&nbsp;tRunner,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631444">//&nbsp;which&nbsp;will&nbsp;signal&nbsp;to&nbsp;the&nbsp;test&nbsp;loop&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631507">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631511">//&nbsp;A&nbsp;previous&nbsp;version&nbsp;of&nbsp;this&nbsp;code&nbsp;said:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631553">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631557">//&nbsp;&nbsp;&nbsp;&nbspc.duration&nbsp;=&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631578">//&nbsp;&nbsp;&nbsp;&nbspc.signal&nbsp;&lt;-&nbsp;c.self</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631601">//&nbsp;&nbsp;&nbsp;&nbspruntime.Goexit()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631622">//</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631626">//&nbsp;This&nbsp;previous&nbsp;version&nbsp;duplicated&nbsp;code&nbsp;(those&nbsp;lines&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631688">//&nbsp;tRunner&nbsp;no&nbsp;matter&nbsp;what),&nbsp;but&nbsp;worse&nbsp;the&nbsp;goroutine&nbsp;teardown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631750">//&nbsp;implicit&nbsp;in&nbsp;runtime.Goexit&nbsp;was&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631812">//&nbsp;before&nbsp;the&nbsp;test&nbsp;exited.&nbsp;&nbsp;If&nbsp;a&nbsp;test&nbsp;deferred&nbsp;an&nbsp;important&nbsp;cleanup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631881">//&nbsp;function&nbsp;(like&nbsp;removing&nbsp;temporary&nbsp;files),&nbsp;there&nbsp;was&nbsp;no&nbsp;guarantee</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631950">//&nbsp;it&nbsp;would&nbsp;run&nbsp;on&nbsp;a&nbsp;test&nbsp;failure.&nbsp;&nbsp;Because&nbsp;we&nbsp;send&nbsp;on&nbsp;c.signal&nbsp;during</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5632022">//&nbsp;a&nbsp;top-of-stack&nbsp;deferred&nbsp;function&nbsp;now,&nbsp;we&nbsp;know&nbsp;that&nbsp;the&nbsp;send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5632086">//&nbsp;only&nbsp;happens&nbsp;after&nbsp;any&nbsp;other&nbsp;stacked&nbsp;defers&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5632150">c</span><span class="op" id="5632151">.</span><span class="ident" id="5632152">finished</span>&nbsp;<span class="op" id="5632161">=</span>&nbsp;<span class="ident" id="5632163">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5632169">runtime</span><span class="op" id="5632176">.</span><span class="ident" id="5632177">Goexit</span><span class="op" id="5632183">(</span><span class="op" id="5632184">)</span><br>
<span class="lineno">330</span><span class="op" id="5632186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5632189">//&nbsp;log&nbsp;generates&nbsp;the&nbsp;output.&nbsp;It&#39;s&nbsp;always&nbsp;at&nbsp;the&nbsp;same&nbsp;stack&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5632255">func</span>&nbsp;<span class="op" id="5632260">(</span><span class="ident" id="5632261">c</span>&nbsp;<span class="op" id="5632263">*</span><span class="ident" id="5632264">common</span><span class="op" id="5632270">)</span>&nbsp;<span class="ident" id="5632272">log</span><span class="op" id="5632275">(</span><span class="ident" id="5632276">s</span>&nbsp;<span class="builtintype" id="5632278">string</span><span class="op" id="5632284">)</span>&nbsp;<span class="op" id="5632286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5632289">c</span><span class="op" id="5632290">.</span><span class="ident" id="5632291">mu</span><span class="op" id="5632293">.</span><span class="ident" id="5632294">Lock</span><span class="op" id="5632298">(</span><span class="op" id="5632299">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5632302">defer</span>&nbsp;<span class="ident" id="5632308">c</span><span class="op" id="5632309">.</span><span class="ident" id="5632310">mu</span><span class="op" id="5632312">.</span><span class="ident" id="5632313">Unlock</span><span class="op" id="5632319">(</span><span class="op" id="5632320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5632323">c</span><span class="op" id="5632324">.</span><span class="ident" id="5632325">output</span>&nbsp;<span class="op" id="5632332">=</span>&nbsp;<span class="builtinfunc" id="5632334">append</span><span class="op" id="5632340">(</span><span class="ident" id="5632341">c</span><span class="op" id="5632342">.</span><span class="ident" id="5632343">output</span><span class="op" id="5632349">,</span>&nbsp;<span class="ident" id="5632351">decorate</span><span class="op" id="5632359">(</span><span class="ident" id="5632360">s</span><span class="op" id="5632361">)</span><span class="op" id="5632362">...</span><span class="op" id="5632365">)</span><br>
<span class="lineno"></span><span class="op" id="5632367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5632370">//&nbsp;Log&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;using&nbsp;default&nbsp;formatting,&nbsp;analogous&nbsp;to&nbsp;Println,</span><br>
<span class="lineno">340</span><span class="comment" id="5632447">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5632522">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="5632568">func</span>&nbsp;<span class="op" id="5632573">(</span><span class="ident" id="5632574">c</span>&nbsp;<span class="op" id="5632576">*</span><span class="ident" id="5632577">common</span><span class="op" id="5632583">)</span>&nbsp;<span class="ident" id="5632585">Log</span><span class="op" id="5632588">(</span><span class="ident" id="5632589">args</span>&nbsp;<span class="op" id="5632594">...</span><span class="keyword" id="5632597">interface</span><span class="op" id="5632606">{</span><span class="op" id="5632607">}</span><span class="op" id="5632608">)</span>&nbsp;<span class="op" id="5632610">{</span>&nbsp;<span class="ident" id="5632612">c</span><span class="op" id="5632613">.</span><span class="ident" id="5632614">log</span><span class="op" id="5632617">(</span><span class="ident" id="5632618">fmt</span><span class="op" id="5632621">.</span><span class="ident" id="5632622">Sprintln</span><span class="op" id="5632630">(</span><span class="ident" id="5632631">args</span><span class="op" id="5632635">...</span><span class="op" id="5632638">)</span><span class="op" id="5632639">)</span>&nbsp;<span class="op" id="5632641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5632644">//&nbsp;Logf&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;according&nbsp;to&nbsp;the&nbsp;format,&nbsp;analogous&nbsp;to&nbsp;Printf,</span><br>
<span class="lineno">345</span><span class="comment" id="5632720">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5632795">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="5632841">func</span>&nbsp;<span class="op" id="5632846">(</span><span class="ident" id="5632847">c</span>&nbsp;<span class="op" id="5632849">*</span><span class="ident" id="5632850">common</span><span class="op" id="5632856">)</span>&nbsp;<span class="ident" id="5632858">Logf</span><span class="op" id="5632862">(</span><span class="ident" id="5632863">format</span>&nbsp;<span class="builtintype" id="5632870">string</span><span class="op" id="5632876">,</span>&nbsp;<span class="ident" id="5632878">args</span>&nbsp;<span class="op" id="5632883">...</span><span class="keyword" id="5632886">interface</span><span class="op" id="5632895">{</span><span class="op" id="5632896">}</span><span class="op" id="5632897">)</span>&nbsp;<span class="op" id="5632899">{</span>&nbsp;<span class="ident" id="5632901">c</span><span class="op" id="5632902">.</span><span class="ident" id="5632903">log</span><span class="op" id="5632906">(</span><span class="ident" id="5632907">fmt</span><span class="op" id="5632910">.</span><span class="ident" id="5632911">Sprintf</span><span class="op" id="5632918">(</span><span class="ident" id="5632919">format</span><span class="op" id="5632925">,</span>&nbsp;<span class="ident" id="5632927">args</span><span class="op" id="5632931">...</span><span class="op" id="5632934">)</span><span class="op" id="5632935">)</span>&nbsp;<span class="op" id="5632937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5632940">//&nbsp;Error&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno">350</span><span class="keyword" id="5632988">func</span>&nbsp;<span class="op" id="5632993">(</span><span class="ident" id="5632994">c</span>&nbsp;<span class="op" id="5632996">*</span><span class="ident" id="5632997">common</span><span class="op" id="5633003">)</span>&nbsp;<span class="ident" id="5633005">Error</span><span class="op" id="5633010">(</span><span class="ident" id="5633011">args</span>&nbsp;<span class="op" id="5633016">...</span><span class="keyword" id="5633019">interface</span><span class="op" id="5633028">{</span><span class="op" id="5633029">}</span><span class="op" id="5633030">)</span>&nbsp;<span class="op" id="5633032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633035">c</span><span class="op" id="5633036">.</span><span class="ident" id="5633037">log</span><span class="op" id="5633040">(</span><span class="ident" id="5633041">fmt</span><span class="op" id="5633044">.</span><span class="ident" id="5633045">Sprintln</span><span class="op" id="5633053">(</span><span class="ident" id="5633054">args</span><span class="op" id="5633058">...</span><span class="op" id="5633061">)</span><span class="op" id="5633062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633065">c</span><span class="op" id="5633066">.</span><span class="ident" id="5633067">Fail</span><span class="op" id="5633071">(</span><span class="op" id="5633072">)</span><br>
<span class="lineno"></span><span class="op" id="5633074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="5633077">//&nbsp;Errorf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno"></span><span class="keyword" id="5633127">func</span>&nbsp;<span class="op" id="5633132">(</span><span class="ident" id="5633133">c</span>&nbsp;<span class="op" id="5633135">*</span><span class="ident" id="5633136">common</span><span class="op" id="5633142">)</span>&nbsp;<span class="ident" id="5633144">Errorf</span><span class="op" id="5633150">(</span><span class="ident" id="5633151">format</span>&nbsp;<span class="builtintype" id="5633158">string</span><span class="op" id="5633164">,</span>&nbsp;<span class="ident" id="5633166">args</span>&nbsp;<span class="op" id="5633171">...</span><span class="keyword" id="5633174">interface</span><span class="op" id="5633183">{</span><span class="op" id="5633184">}</span><span class="op" id="5633185">)</span>&nbsp;<span class="op" id="5633187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633190">c</span><span class="op" id="5633191">.</span><span class="ident" id="5633192">log</span><span class="op" id="5633195">(</span><span class="ident" id="5633196">fmt</span><span class="op" id="5633199">.</span><span class="ident" id="5633200">Sprintf</span><span class="op" id="5633207">(</span><span class="ident" id="5633208">format</span><span class="op" id="5633214">,</span>&nbsp;<span class="ident" id="5633216">args</span><span class="op" id="5633220">...</span><span class="op" id="5633223">)</span><span class="op" id="5633224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633227">c</span><span class="op" id="5633228">.</span><span class="ident" id="5633229">Fail</span><span class="op" id="5633233">(</span><span class="op" id="5633234">)</span><br>
<span class="lineno"></span><span class="op" id="5633236">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="5633239">//&nbsp;Fatal&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="5633290">func</span>&nbsp;<span class="op" id="5633295">(</span><span class="ident" id="5633296">c</span>&nbsp;<span class="op" id="5633298">*</span><span class="ident" id="5633299">common</span><span class="op" id="5633305">)</span>&nbsp;<span class="ident" id="5633307">Fatal</span><span class="op" id="5633312">(</span><span class="ident" id="5633313">args</span>&nbsp;<span class="op" id="5633318">...</span><span class="keyword" id="5633321">interface</span><span class="op" id="5633330">{</span><span class="op" id="5633331">}</span><span class="op" id="5633332">)</span>&nbsp;<span class="op" id="5633334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633337">c</span><span class="op" id="5633338">.</span><span class="ident" id="5633339">log</span><span class="op" id="5633342">(</span><span class="ident" id="5633343">fmt</span><span class="op" id="5633346">.</span><span class="ident" id="5633347">Sprintln</span><span class="op" id="5633355">(</span><span class="ident" id="5633356">args</span><span class="op" id="5633360">...</span><span class="op" id="5633363">)</span><span class="op" id="5633364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633367">c</span><span class="op" id="5633368">.</span><span class="ident" id="5633369">FailNow</span><span class="op" id="5633376">(</span><span class="op" id="5633377">)</span><br>
<span class="lineno">365</span><span class="op" id="5633379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5633382">//&nbsp;Fatalf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="5633435">func</span>&nbsp;<span class="op" id="5633440">(</span><span class="ident" id="5633441">c</span>&nbsp;<span class="op" id="5633443">*</span><span class="ident" id="5633444">common</span><span class="op" id="5633450">)</span>&nbsp;<span class="ident" id="5633452">Fatalf</span><span class="op" id="5633458">(</span><span class="ident" id="5633459">format</span>&nbsp;<span class="builtintype" id="5633466">string</span><span class="op" id="5633472">,</span>&nbsp;<span class="ident" id="5633474">args</span>&nbsp;<span class="op" id="5633479">...</span><span class="keyword" id="5633482">interface</span><span class="op" id="5633491">{</span><span class="op" id="5633492">}</span><span class="op" id="5633493">)</span>&nbsp;<span class="op" id="5633495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633498">c</span><span class="op" id="5633499">.</span><span class="ident" id="5633500">log</span><span class="op" id="5633503">(</span><span class="ident" id="5633504">fmt</span><span class="op" id="5633507">.</span><span class="ident" id="5633508">Sprintf</span><span class="op" id="5633515">(</span><span class="ident" id="5633516">format</span><span class="op" id="5633522">,</span>&nbsp;<span class="ident" id="5633524">args</span><span class="op" id="5633528">...</span><span class="op" id="5633531">)</span><span class="op" id="5633532">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633535">c</span><span class="op" id="5633536">.</span><span class="ident" id="5633537">FailNow</span><span class="op" id="5633544">(</span><span class="op" id="5633545">)</span><br>
<span class="lineno"></span><span class="op" id="5633547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5633550">//&nbsp;Skip&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno"></span><span class="keyword" id="5633600">func</span>&nbsp;<span class="op" id="5633605">(</span><span class="ident" id="5633606">c</span>&nbsp;<span class="op" id="5633608">*</span><span class="ident" id="5633609">common</span><span class="op" id="5633615">)</span>&nbsp;<span class="ident" id="5633617">Skip</span><span class="op" id="5633621">(</span><span class="ident" id="5633622">args</span>&nbsp;<span class="op" id="5633627">...</span><span class="keyword" id="5633630">interface</span><span class="op" id="5633639">{</span><span class="op" id="5633640">}</span><span class="op" id="5633641">)</span>&nbsp;<span class="op" id="5633643">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633646">c</span><span class="op" id="5633647">.</span><span class="ident" id="5633648">log</span><span class="op" id="5633651">(</span><span class="ident" id="5633652">fmt</span><span class="op" id="5633655">.</span><span class="ident" id="5633656">Sprintln</span><span class="op" id="5633664">(</span><span class="ident" id="5633665">args</span><span class="op" id="5633669">...</span><span class="op" id="5633672">)</span><span class="op" id="5633673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633676">c</span><span class="op" id="5633677">.</span><span class="ident" id="5633678">SkipNow</span><span class="op" id="5633685">(</span><span class="op" id="5633686">)</span><br>
<span class="lineno"></span><span class="op" id="5633688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5633691">//&nbsp;Skipf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno">380</span><span class="keyword" id="5633743">func</span>&nbsp;<span class="op" id="5633748">(</span><span class="ident" id="5633749">c</span>&nbsp;<span class="op" id="5633751">*</span><span class="ident" id="5633752">common</span><span class="op" id="5633758">)</span>&nbsp;<span class="ident" id="5633760">Skipf</span><span class="op" id="5633765">(</span><span class="ident" id="5633766">format</span>&nbsp;<span class="builtintype" id="5633773">string</span><span class="op" id="5633779">,</span>&nbsp;<span class="ident" id="5633781">args</span>&nbsp;<span class="op" id="5633786">...</span><span class="keyword" id="5633789">interface</span><span class="op" id="5633798">{</span><span class="op" id="5633799">}</span><span class="op" id="5633800">)</span>&nbsp;<span class="op" id="5633802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633805">c</span><span class="op" id="5633806">.</span><span class="ident" id="5633807">log</span><span class="op" id="5633810">(</span><span class="ident" id="5633811">fmt</span><span class="op" id="5633814">.</span><span class="ident" id="5633815">Sprintf</span><span class="op" id="5633822">(</span><span class="ident" id="5633823">format</span><span class="op" id="5633829">,</span>&nbsp;<span class="ident" id="5633831">args</span><span class="op" id="5633835">...</span><span class="op" id="5633838">)</span><span class="op" id="5633839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633842">c</span><span class="op" id="5633843">.</span><span class="ident" id="5633844">SkipNow</span><span class="op" id="5633851">(</span><span class="op" id="5633852">)</span><br>
<span class="lineno"></span><span class="op" id="5633854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="5633857">//&nbsp;SkipNow&nbsp;marks&nbsp;the&nbsp;test&nbsp;as&nbsp;having&nbsp;been&nbsp;skipped&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="5633931">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.&nbsp;See&nbsp;also&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="comment" id="5634007">//&nbsp;SkipNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the&nbsp;test,&nbsp;not&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5634079">//&nbsp;other&nbsp;goroutines&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;SkipNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno"></span><span class="comment" id="5634154">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno">390</span><span class="keyword" id="5634181">func</span>&nbsp;<span class="op" id="5634186">(</span><span class="ident" id="5634187">c</span>&nbsp;<span class="op" id="5634189">*</span><span class="ident" id="5634190">common</span><span class="op" id="5634196">)</span>&nbsp;<span class="ident" id="5634198">SkipNow</span><span class="op" id="5634205">(</span><span class="op" id="5634206">)</span>&nbsp;<span class="op" id="5634208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5634211">c</span><span class="op" id="5634212">.</span><span class="ident" id="5634213">skip</span><span class="op" id="5634217">(</span><span class="op" id="5634218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5634221">c</span><span class="op" id="5634222">.</span><span class="ident" id="5634223">finished</span>&nbsp;<span class="op" id="5634232">=</span>&nbsp;<span class="ident" id="5634234">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5634240">runtime</span><span class="op" id="5634247">.</span><span class="ident" id="5634248">Goexit</span><span class="op" id="5634254">(</span><span class="op" id="5634255">)</span><br>
<span class="lineno"></span><span class="op" id="5634257">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="5634260">func</span>&nbsp;<span class="op" id="5634265">(</span><span class="ident" id="5634266">c</span>&nbsp;<span class="op" id="5634268">*</span><span class="ident" id="5634269">common</span><span class="op" id="5634275">)</span>&nbsp;<span class="ident" id="5634277">skip</span><span class="op" id="5634281">(</span><span class="op" id="5634282">)</span>&nbsp;<span class="op" id="5634284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5634287">c</span><span class="op" id="5634288">.</span><span class="ident" id="5634289">mu</span><span class="op" id="5634291">.</span><span class="ident" id="5634292">Lock</span><span class="op" id="5634296">(</span><span class="op" id="5634297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5634300">defer</span>&nbsp;<span class="ident" id="5634306">c</span><span class="op" id="5634307">.</span><span class="ident" id="5634308">mu</span><span class="op" id="5634310">.</span><span class="ident" id="5634311">Unlock</span><span class="op" id="5634317">(</span><span class="op" id="5634318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5634321">c</span><span class="op" id="5634322">.</span><span class="ident" id="5634323">skipped</span>&nbsp;<span class="op" id="5634331">=</span>&nbsp;<span class="ident" id="5634333">true</span><br>
<span class="lineno">400</span><span class="op" id="5634338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5634341">//&nbsp;Skipped&nbsp;reports&nbsp;whether&nbsp;the&nbsp;test&nbsp;was&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="5634390">func</span>&nbsp;<span class="op" id="5634395">(</span><span class="ident" id="5634396">c</span>&nbsp;<span class="op" id="5634398">*</span><span class="ident" id="5634399">common</span><span class="op" id="5634405">)</span>&nbsp;<span class="ident" id="5634407">Skipped</span><span class="op" id="5634414">(</span><span class="op" id="5634415">)</span>&nbsp;<span class="builtintype" id="5634417">bool</span>&nbsp;<span class="op" id="5634422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5634425">c</span><span class="op" id="5634426">.</span><span class="ident" id="5634427">mu</span><span class="op" id="5634429">.</span><span class="ident" id="5634430">RLock</span><span class="op" id="5634435">(</span><span class="op" id="5634436">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5634439">defer</span>&nbsp;<span class="ident" id="5634445">c</span><span class="op" id="5634446">.</span><span class="ident" id="5634447">mu</span><span class="op" id="5634449">.</span><span class="ident" id="5634450">RUnlock</span><span class="op" id="5634457">(</span><span class="op" id="5634458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5634461">return</span>&nbsp;<span class="ident" id="5634468">c</span><span class="op" id="5634469">.</span><span class="ident" id="5634470">skipped</span><br>
<span class="lineno"></span><span class="op" id="5634478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5634481">//&nbsp;Parallel&nbsp;signals&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;to&nbsp;be&nbsp;run&nbsp;in&nbsp;parallel&nbsp;with&nbsp;(and&nbsp;only&nbsp;with)</span><br>
<span class="lineno">410</span><span class="comment" id="5634562">//&nbsp;other&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="5634587">func</span>&nbsp;<span class="op" id="5634592">(</span><span class="ident" id="5634593">t</span>&nbsp;<span class="op" id="5634595">*</span><span class="ident" id="5634596">T</span><span class="op" id="5634597">)</span>&nbsp;<span class="ident" id="5634599">Parallel</span><span class="op" id="5634607">(</span><span class="op" id="5634608">)</span>&nbsp;<span class="op" id="5634610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5634613">t</span><span class="op" id="5634614">.</span><span class="ident" id="5634615">signal</span>&nbsp;<span class="op" id="5634622">&lt;-</span>&nbsp;<span class="op" id="5634625">(</span><span class="op" id="5634626">*</span><span class="ident" id="5634627">T</span><span class="op" id="5634628">)</span><span class="op" id="5634629">(</span><span class="ident" id="5634630">nil</span><span class="op" id="5634633">)</span>&nbsp;<span class="comment" id="5634635">//&nbsp;Release&nbsp;main&nbsp;testing&nbsp;loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5634665">&lt;-</span><span class="ident" id="5634667">t</span><span class="op" id="5634668">.</span><span class="ident" id="5634669">startParallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5634687">//&nbsp;Wait&nbsp;for&nbsp;serial&nbsp;tests&nbsp;to&nbsp;finish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5634723">//&nbsp;Assuming&nbsp;Parallel&nbsp;is&nbsp;the&nbsp;first&nbsp;thing&nbsp;a&nbsp;test&nbsp;does,&nbsp;which&nbsp;is&nbsp;reasonable,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5634798">//&nbsp;reinitialize&nbsp;the&nbsp;test&#39;s&nbsp;start&nbsp;time&nbsp;because&nbsp;it&#39;s&nbsp;actually&nbsp;starting&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5634873">t</span><span class="op" id="5634874">.</span><span class="ident" id="5634875">start</span>&nbsp;<span class="op" id="5634881">=</span>&nbsp;<span class="ident" id="5634883">time</span><span class="op" id="5634887">.</span><span class="ident" id="5634888">Now</span><span class="op" id="5634891">(</span><span class="op" id="5634892">)</span><br>
<span class="lineno"></span><span class="op" id="5634894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5634897">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno">420</span><span class="comment" id="5634986">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5635015">type</span>&nbsp;<span class="ident" id="5635020">InternalTest</span>&nbsp;<span class="keyword" id="5635033">struct</span>&nbsp;<span class="op" id="5635040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635043">Name</span>&nbsp;<span class="builtintype" id="5635048">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635056">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5635061">func</span><span class="op" id="5635065">(</span><span class="op" id="5635066">*</span><span class="ident" id="5635067">T</span><span class="op" id="5635068">)</span><br>
<span class="lineno"></span><span class="op" id="5635070">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="5635073">func</span>&nbsp;<span class="ident" id="5635078">tRunner</span><span class="op" id="5635085">(</span><span class="ident" id="5635086">t</span>&nbsp;<span class="op" id="5635088">*</span><span class="ident" id="5635089">T</span><span class="op" id="5635090">,</span>&nbsp;<span class="ident" id="5635092">test</span>&nbsp;<span class="op" id="5635097">*</span><span class="ident" id="5635098">InternalTest</span><span class="op" id="5635110">)</span>&nbsp;<span class="op" id="5635112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5635115">//&nbsp;When&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;done,&nbsp;either&nbsp;because&nbsp;test.F(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5635173">//&nbsp;returned&nbsp;normally&nbsp;or&nbsp;because&nbsp;a&nbsp;test&nbsp;failure&nbsp;triggered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5635231">//&nbsp;a&nbsp;call&nbsp;to&nbsp;runtime.Goexit,&nbsp;record&nbsp;the&nbsp;duration&nbsp;and&nbsp;send</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5635290">//&nbsp;a&nbsp;signal&nbsp;saying&nbsp;that&nbsp;the&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5635333">defer</span>&nbsp;<span class="keyword" id="5635339">func</span><span class="op" id="5635343">(</span><span class="op" id="5635344">)</span>&nbsp;<span class="op" id="5635346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635350">t</span><span class="op" id="5635351">.</span><span class="ident" id="5635352">duration</span>&nbsp;<span class="op" id="5635361">=</span>&nbsp;<span class="ident" id="5635363">time</span><span class="op" id="5635367">.</span><span class="ident" id="5635368">Now</span><span class="op" id="5635371">(</span><span class="op" id="5635372">)</span><span class="op" id="5635373">.</span><span class="ident" id="5635374">Sub</span><span class="op" id="5635377">(</span><span class="ident" id="5635378">t</span><span class="op" id="5635379">.</span><span class="ident" id="5635380">start</span><span class="op" id="5635385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5635389">//&nbsp;If&nbsp;the&nbsp;test&nbsp;panicked,&nbsp;print&nbsp;any&nbsp;test&nbsp;output&nbsp;before&nbsp;dying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635452">err</span>&nbsp;<span class="op" id="5635456">:=</span>&nbsp;<span class="builtinfunc" id="5635459">recover</span><span class="op" id="5635466">(</span><span class="op" id="5635467">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5635471">if</span>&nbsp;<span class="op" id="5635474">!</span><span class="ident" id="5635475">t</span><span class="op" id="5635476">.</span><span class="ident" id="5635477">finished</span>&nbsp;<span class="op" id="5635486">&amp;&amp;</span>&nbsp;<span class="ident" id="5635489">err</span>&nbsp;<span class="op" id="5635493">==</span>&nbsp;<span class="ident" id="5635496">nil</span>&nbsp;<span class="op" id="5635500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635505">err</span>&nbsp;<span class="op" id="5635509">=</span>&nbsp;<span class="ident" id="5635511">fmt</span><span class="op" id="5635514">.</span><span class="ident" id="5635515">Errorf</span><span class="op" id="5635521">(</span><span class="string" id="5635522">&#34;test&nbsp;executed&nbsp;panic(nil)&nbsp;or&nbsp;runtime.Goexit&#34;</span><span class="op" id="5635566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5635570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5635574">if</span>&nbsp;<span class="ident" id="5635577">err</span>&nbsp;<span class="op" id="5635581">!=</span>&nbsp;<span class="ident" id="5635584">nil</span>&nbsp;<span class="op" id="5635588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635593">t</span><span class="op" id="5635594">.</span><span class="ident" id="5635595">Fail</span><span class="op" id="5635599">(</span><span class="op" id="5635600">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635605">t</span><span class="op" id="5635606">.</span><span class="ident" id="5635607">report</span><span class="op" id="5635613">(</span><span class="op" id="5635614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5635619">panic</span><span class="op" id="5635624">(</span><span class="ident" id="5635625">err</span><span class="op" id="5635628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5635632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635636">t</span><span class="op" id="5635637">.</span><span class="ident" id="5635638">signal</span>&nbsp;<span class="op" id="5635645">&lt;-</span>&nbsp;<span class="ident" id="5635648">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5635651">}</span><span class="op" id="5635652">(</span><span class="op" id="5635653">)</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635657">t</span><span class="op" id="5635658">.</span><span class="ident" id="5635659">start</span>&nbsp;<span class="op" id="5635665">=</span>&nbsp;<span class="ident" id="5635667">time</span><span class="op" id="5635671">.</span><span class="ident" id="5635672">Now</span><span class="op" id="5635675">(</span><span class="op" id="5635676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635679">test</span><span class="op" id="5635683">.</span><span class="ident" id="5635684">F</span><span class="op" id="5635685">(</span><span class="ident" id="5635686">t</span><span class="op" id="5635687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635690">t</span><span class="op" id="5635691">.</span><span class="ident" id="5635692">finished</span>&nbsp;<span class="op" id="5635701">=</span>&nbsp;<span class="ident" id="5635703">true</span><br>
<span class="lineno"></span><span class="op" id="5635708">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="comment" id="5635711">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5635804">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5635833">func</span>&nbsp;<span class="ident" id="5635838">Main</span><span class="op" id="5635842">(</span><span class="ident" id="5635843">matchString</span>&nbsp;<span class="keyword" id="5635855">func</span><span class="op" id="5635859">(</span><span class="ident" id="5635860">pat</span><span class="op" id="5635863">,</span>&nbsp;<span class="ident" id="5635865">str</span>&nbsp;<span class="builtintype" id="5635869">string</span><span class="op" id="5635875">)</span>&nbsp;<span class="op" id="5635877">(</span><span class="builtintype" id="5635878">bool</span><span class="op" id="5635882">,</span>&nbsp;<span class="builtintype" id="5635884">error</span><span class="op" id="5635889">)</span><span class="op" id="5635890">,</span>&nbsp;<span class="ident" id="5635892">tests</span>&nbsp;<span class="op" id="5635898">[</span><span class="op" id="5635899">]</span><span class="ident" id="5635900">InternalTest</span><span class="op" id="5635912">,</span>&nbsp;<span class="ident" id="5635914">benchmarks</span>&nbsp;<span class="op" id="5635925">[</span><span class="op" id="5635926">]</span><span class="ident" id="5635927">InternalBenchmark</span><span class="op" id="5635944">,</span>&nbsp;<span class="ident" id="5635946">examples</span>&nbsp;<span class="op" id="5635955">[</span><span class="op" id="5635956">]</span><span class="ident" id="5635957">InternalExample</span><span class="op" id="5635972">)</span>&nbsp;<span class="op" id="5635974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635977">os</span><span class="op" id="5635979">.</span><span class="ident" id="5635980">Exit</span><span class="op" id="5635984">(</span><span class="ident" id="5635985">MainStart</span><span class="op" id="5635994">(</span><span class="ident" id="5635995">matchString</span><span class="op" id="5636006">,</span>&nbsp;<span class="ident" id="5636008">tests</span><span class="op" id="5636013">,</span>&nbsp;<span class="ident" id="5636015">benchmarks</span><span class="op" id="5636025">,</span>&nbsp;<span class="ident" id="5636027">examples</span><span class="op" id="5636035">)</span><span class="op" id="5636036">.</span><span class="ident" id="5636037">Run</span><span class="op" id="5636040">(</span><span class="op" id="5636041">)</span><span class="op" id="5636042">)</span><br>
<span class="lineno">455</span><span class="op" id="5636044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5636047">//&nbsp;M&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;a&nbsp;TestMain&nbsp;function&nbsp;to&nbsp;run&nbsp;the&nbsp;actual&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="5636117">type</span>&nbsp;<span class="ident" id="5636122">M</span>&nbsp;<span class="keyword" id="5636124">struct</span>&nbsp;<span class="op" id="5636131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636134">matchString</span>&nbsp;<span class="keyword" id="5636146">func</span><span class="op" id="5636150">(</span><span class="ident" id="5636151">pat</span><span class="op" id="5636154">,</span>&nbsp;<span class="ident" id="5636156">str</span>&nbsp;<span class="builtintype" id="5636160">string</span><span class="op" id="5636166">)</span>&nbsp;<span class="op" id="5636168">(</span><span class="builtintype" id="5636169">bool</span><span class="op" id="5636173">,</span>&nbsp;<span class="builtintype" id="5636175">error</span><span class="op" id="5636180">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636183">tests</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5636195">[</span><span class="op" id="5636196">]</span><span class="ident" id="5636197">InternalTest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636211">benchmarks</span>&nbsp;&nbsp;<span class="op" id="5636223">[</span><span class="op" id="5636224">]</span><span class="ident" id="5636225">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636244">examples</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5636256">[</span><span class="op" id="5636257">]</span><span class="ident" id="5636258">InternalExample</span><br>
<span class="lineno"></span><span class="op" id="5636274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="comment" id="5636277">//&nbsp;MainStart&nbsp;is&nbsp;meant&nbsp;for&nbsp;use&nbsp;by&nbsp;tests&nbsp;generated&nbsp;by&nbsp;&#39;go&nbsp;test&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="5636340">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;called&nbsp;directly&nbsp;and&nbsp;is&nbsp;not&nbsp;subject&nbsp;to&nbsp;the&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;document.</span><br>
<span class="lineno"></span><span class="comment" id="5636436">//&nbsp;It&nbsp;may&nbsp;change&nbsp;signature&nbsp;from&nbsp;release&nbsp;to&nbsp;release.</span><br>
<span class="lineno"></span><span class="keyword" id="5636488">func</span>&nbsp;<span class="ident" id="5636493">MainStart</span><span class="op" id="5636502">(</span><span class="ident" id="5636503">matchString</span>&nbsp;<span class="keyword" id="5636515">func</span><span class="op" id="5636519">(</span><span class="ident" id="5636520">pat</span><span class="op" id="5636523">,</span>&nbsp;<span class="ident" id="5636525">str</span>&nbsp;<span class="builtintype" id="5636529">string</span><span class="op" id="5636535">)</span>&nbsp;<span class="op" id="5636537">(</span><span class="builtintype" id="5636538">bool</span><span class="op" id="5636542">,</span>&nbsp;<span class="builtintype" id="5636544">error</span><span class="op" id="5636549">)</span><span class="op" id="5636550">,</span>&nbsp;<span class="ident" id="5636552">tests</span>&nbsp;<span class="op" id="5636558">[</span><span class="op" id="5636559">]</span><span class="ident" id="5636560">InternalTest</span><span class="op" id="5636572">,</span>&nbsp;<span class="ident" id="5636574">benchmarks</span>&nbsp;<span class="op" id="5636585">[</span><span class="op" id="5636586">]</span><span class="ident" id="5636587">InternalBenchmark</span><span class="op" id="5636604">,</span>&nbsp;<span class="ident" id="5636606">examples</span>&nbsp;<span class="op" id="5636615">[</span><span class="op" id="5636616">]</span><span class="ident" id="5636617">InternalExample</span><span class="op" id="5636632">)</span>&nbsp;<span class="op" id="5636634">*</span><span class="ident" id="5636635">M</span>&nbsp;<span class="op" id="5636637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636640">return</span>&nbsp;<span class="op" id="5636647">&amp;</span><span class="ident" id="5636648">M</span><span class="op" id="5636649">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636653">matchString</span><span class="op" id="5636664">:</span>&nbsp;<span class="ident" id="5636666">matchString</span><span class="op" id="5636677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636681">tests</span><span class="op" id="5636686">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5636694">tests</span><span class="op" id="5636699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636703">benchmarks</span><span class="op" id="5636713">:</span>&nbsp;&nbsp;<span class="ident" id="5636716">benchmarks</span><span class="op" id="5636726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636730">examples</span><span class="op" id="5636738">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5636743">examples</span><span class="op" id="5636751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5636754">}</span><br>
<span class="lineno">475</span><span class="op" id="5636756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5636759">//&nbsp;Run&nbsp;runs&nbsp;the&nbsp;tests.&nbsp;It&nbsp;returns&nbsp;an&nbsp;exit&nbsp;code&nbsp;to&nbsp;pass&nbsp;to&nbsp;os.Exit.</span><br>
<span class="lineno"></span><span class="keyword" id="5636826">func</span>&nbsp;<span class="op" id="5636831">(</span><span class="ident" id="5636832">m</span>&nbsp;<span class="op" id="5636834">*</span><span class="ident" id="5636835">M</span><span class="op" id="5636836">)</span>&nbsp;<span class="ident" id="5636838">Run</span><span class="op" id="5636841">(</span><span class="op" id="5636842">)</span>&nbsp;<span class="builtintype" id="5636844">int</span>&nbsp;<span class="op" id="5636848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636851">flag</span><span class="op" id="5636855">.</span><span class="ident" id="5636856">Parse</span><span class="op" id="5636861">(</span><span class="op" id="5636862">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636865">parseCpuList</span><span class="op" id="5636877">(</span><span class="op" id="5636878">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636882">before</span><span class="op" id="5636888">(</span><span class="op" id="5636889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636892">startAlarm</span><span class="op" id="5636902">(</span><span class="op" id="5636903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636906">haveExamples</span>&nbsp;<span class="op" id="5636919">=</span>&nbsp;<span class="builtinfunc" id="5636921">len</span><span class="op" id="5636924">(</span><span class="ident" id="5636925">m</span><span class="op" id="5636926">.</span><span class="ident" id="5636927">examples</span><span class="op" id="5636935">)</span>&nbsp;<span class="op" id="5636937">&gt;</span>&nbsp;<span class="num" id="5636939">0</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636942">testOk</span>&nbsp;<span class="op" id="5636949">:=</span>&nbsp;<span class="ident" id="5636952">RunTests</span><span class="op" id="5636960">(</span><span class="ident" id="5636961">m</span><span class="op" id="5636962">.</span><span class="ident" id="5636963">matchString</span><span class="op" id="5636974">,</span>&nbsp;<span class="ident" id="5636976">m</span><span class="op" id="5636977">.</span><span class="ident" id="5636978">tests</span><span class="op" id="5636983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636986">exampleOk</span>&nbsp;<span class="op" id="5636996">:=</span>&nbsp;<span class="ident" id="5636999">RunExamples</span><span class="op" id="5637010">(</span><span class="ident" id="5637011">m</span><span class="op" id="5637012">.</span><span class="ident" id="5637013">matchString</span><span class="op" id="5637024">,</span>&nbsp;<span class="ident" id="5637026">m</span><span class="op" id="5637027">.</span><span class="ident" id="5637028">examples</span><span class="op" id="5637036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637039">stopAlarm</span><span class="op" id="5637048">(</span><span class="op" id="5637049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637052">if</span>&nbsp;<span class="op" id="5637055">!</span><span class="ident" id="5637056">testOk</span>&nbsp;<span class="op" id="5637063">||</span>&nbsp;<span class="op" id="5637066">!</span><span class="ident" id="5637067">exampleOk</span>&nbsp;<span class="op" id="5637077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637081">fmt</span><span class="op" id="5637084">.</span><span class="ident" id="5637085">Println</span><span class="op" id="5637092">(</span><span class="string" id="5637093">&#34;FAIL&#34;</span><span class="op" id="5637099">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637103">after</span><span class="op" id="5637108">(</span><span class="op" id="5637109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637113">return</span>&nbsp;<span class="num" id="5637120">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5637123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637126">fmt</span><span class="op" id="5637129">.</span><span class="ident" id="5637130">Println</span><span class="op" id="5637137">(</span><span class="string" id="5637138">&#34;PASS&#34;</span><span class="op" id="5637144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637147">RunBenchmarks</span><span class="op" id="5637160">(</span><span class="ident" id="5637161">m</span><span class="op" id="5637162">.</span><span class="ident" id="5637163">matchString</span><span class="op" id="5637174">,</span>&nbsp;<span class="ident" id="5637176">m</span><span class="op" id="5637177">.</span><span class="ident" id="5637178">benchmarks</span><span class="op" id="5637188">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637191">after</span><span class="op" id="5637196">(</span><span class="op" id="5637197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637200">return</span>&nbsp;<span class="num" id="5637207">0</span><br>
<span class="lineno"></span><span class="op" id="5637209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5637212">func</span>&nbsp;<span class="op" id="5637217">(</span><span class="ident" id="5637218">t</span>&nbsp;<span class="op" id="5637220">*</span><span class="ident" id="5637221">T</span><span class="op" id="5637222">)</span>&nbsp;<span class="ident" id="5637224">report</span><span class="op" id="5637230">(</span><span class="op" id="5637231">)</span>&nbsp;<span class="op" id="5637233">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637236">dstr</span>&nbsp;<span class="op" id="5637241">:=</span>&nbsp;<span class="ident" id="5637244">fmtDuration</span><span class="op" id="5637255">(</span><span class="ident" id="5637256">t</span><span class="op" id="5637257">.</span><span class="ident" id="5637258">duration</span><span class="op" id="5637266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637269">format</span>&nbsp;<span class="op" id="5637276">:=</span>&nbsp;<span class="string" id="5637279">&#34;---&nbsp;%s:&nbsp;%s&nbsp;(%s)\n%s&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637302">if</span>&nbsp;<span class="ident" id="5637305">t</span><span class="op" id="5637306">.</span><span class="ident" id="5637307">Failed</span><span class="op" id="5637313">(</span><span class="op" id="5637314">)</span>&nbsp;<span class="op" id="5637316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637320">fmt</span><span class="op" id="5637323">.</span><span class="ident" id="5637324">Printf</span><span class="op" id="5637330">(</span><span class="ident" id="5637331">format</span><span class="op" id="5637337">,</span>&nbsp;<span class="string" id="5637339">&#34;FAIL&#34;</span><span class="op" id="5637345">,</span>&nbsp;<span class="ident" id="5637347">t</span><span class="op" id="5637348">.</span><span class="ident" id="5637349">name</span><span class="op" id="5637353">,</span>&nbsp;<span class="ident" id="5637355">dstr</span><span class="op" id="5637359">,</span>&nbsp;<span class="ident" id="5637361">t</span><span class="op" id="5637362">.</span><span class="ident" id="5637363">output</span><span class="op" id="5637369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5637372">}</span>&nbsp;<span class="keyword" id="5637374">else</span>&nbsp;<span class="keyword" id="5637379">if</span>&nbsp;<span class="op" id="5637382">*</span><span class="ident" id="5637383">chatty</span>&nbsp;<span class="op" id="5637390">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637394">if</span>&nbsp;<span class="ident" id="5637397">t</span><span class="op" id="5637398">.</span><span class="ident" id="5637399">Skipped</span><span class="op" id="5637406">(</span><span class="op" id="5637407">)</span>&nbsp;<span class="op" id="5637409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637414">fmt</span><span class="op" id="5637417">.</span><span class="ident" id="5637418">Printf</span><span class="op" id="5637424">(</span><span class="ident" id="5637425">format</span><span class="op" id="5637431">,</span>&nbsp;<span class="string" id="5637433">&#34;SKIP&#34;</span><span class="op" id="5637439">,</span>&nbsp;<span class="ident" id="5637441">t</span><span class="op" id="5637442">.</span><span class="ident" id="5637443">name</span><span class="op" id="5637447">,</span>&nbsp;<span class="ident" id="5637449">dstr</span><span class="op" id="5637453">,</span>&nbsp;<span class="ident" id="5637455">t</span><span class="op" id="5637456">.</span><span class="ident" id="5637457">output</span><span class="op" id="5637463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5637467">}</span>&nbsp;<span class="keyword" id="5637469">else</span>&nbsp;<span class="op" id="5637474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637479">fmt</span><span class="op" id="5637482">.</span><span class="ident" id="5637483">Printf</span><span class="op" id="5637489">(</span><span class="ident" id="5637490">format</span><span class="op" id="5637496">,</span>&nbsp;<span class="string" id="5637498">&#34;PASS&#34;</span><span class="op" id="5637504">,</span>&nbsp;<span class="ident" id="5637506">t</span><span class="op" id="5637507">.</span><span class="ident" id="5637508">name</span><span class="op" id="5637512">,</span>&nbsp;<span class="ident" id="5637514">dstr</span><span class="op" id="5637518">,</span>&nbsp;<span class="ident" id="5637520">t</span><span class="op" id="5637521">.</span><span class="ident" id="5637522">output</span><span class="op" id="5637528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5637532">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5637535">}</span><br>
<span class="lineno"></span><span class="op" id="5637537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5637540">func</span>&nbsp;<span class="ident" id="5637545">RunTests</span><span class="op" id="5637553">(</span><span class="ident" id="5637554">matchString</span>&nbsp;<span class="keyword" id="5637566">func</span><span class="op" id="5637570">(</span><span class="ident" id="5637571">pat</span><span class="op" id="5637574">,</span>&nbsp;<span class="ident" id="5637576">str</span>&nbsp;<span class="builtintype" id="5637580">string</span><span class="op" id="5637586">)</span>&nbsp;<span class="op" id="5637588">(</span><span class="builtintype" id="5637589">bool</span><span class="op" id="5637593">,</span>&nbsp;<span class="builtintype" id="5637595">error</span><span class="op" id="5637600">)</span><span class="op" id="5637601">,</span>&nbsp;<span class="ident" id="5637603">tests</span>&nbsp;<span class="op" id="5637609">[</span><span class="op" id="5637610">]</span><span class="ident" id="5637611">InternalTest</span><span class="op" id="5637623">)</span>&nbsp;<span class="op" id="5637625">(</span><span class="ident" id="5637626">ok</span>&nbsp;<span class="builtintype" id="5637629">bool</span><span class="op" id="5637633">)</span>&nbsp;<span class="op" id="5637635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637638">ok</span>&nbsp;<span class="op" id="5637641">=</span>&nbsp;<span class="ident" id="5637643">true</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637649">if</span>&nbsp;<span class="builtinfunc" id="5637652">len</span><span class="op" id="5637655">(</span><span class="ident" id="5637656">tests</span><span class="op" id="5637661">)</span>&nbsp;<span class="op" id="5637663">==</span>&nbsp;<span class="num" id="5637666">0</span>&nbsp;<span class="op" id="5637668">&amp;&amp;</span>&nbsp;<span class="op" id="5637671">!</span><span class="ident" id="5637672">haveExamples</span>&nbsp;<span class="op" id="5637685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637689">fmt</span><span class="op" id="5637692">.</span><span class="ident" id="5637693">Fprintln</span><span class="op" id="5637701">(</span><span class="ident" id="5637702">os</span><span class="op" id="5637704">.</span><span class="ident" id="5637705">Stderr</span><span class="op" id="5637711">,</span>&nbsp;<span class="string" id="5637713">&#34;testing:&nbsp;warning:&nbsp;no&nbsp;tests&nbsp;to&nbsp;run&#34;</span><span class="op" id="5637748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637752">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5637760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637763">for</span>&nbsp;<span class="ident" id="5637767">_</span><span class="op" id="5637768">,</span>&nbsp;<span class="ident" id="5637770">procs</span>&nbsp;<span class="op" id="5637776">:=</span>&nbsp;<span class="keyword" id="5637779">range</span>&nbsp;<span class="ident" id="5637785">cpuList</span>&nbsp;<span class="op" id="5637793">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637797">runtime</span><span class="op" id="5637804">.</span><span class="ident" id="5637805">GOMAXPROCS</span><span class="op" id="5637815">(</span><span class="ident" id="5637816">procs</span><span class="op" id="5637821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5637825">//&nbsp;We&nbsp;build&nbsp;a&nbsp;new&nbsp;channel&nbsp;tree&nbsp;for&nbsp;each&nbsp;run&nbsp;of&nbsp;the&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5637884">//&nbsp;collector&nbsp;merges&nbsp;in&nbsp;one&nbsp;channel&nbsp;all&nbsp;the&nbsp;upstream&nbsp;signals&nbsp;from&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5637967">//&nbsp;If&nbsp;all&nbsp;tests&nbsp;pump&nbsp;to&nbsp;the&nbsp;same&nbsp;channel,&nbsp;a&nbsp;bug&nbsp;can&nbsp;occur&nbsp;where&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638040">//&nbsp;kicks&nbsp;off&nbsp;a&nbsp;goroutine&nbsp;that&nbsp;Fails,&nbsp;yet&nbsp;the&nbsp;test&nbsp;still&nbsp;delivers&nbsp;a&nbsp;completion&nbsp;signal,</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638128">//&nbsp;which&nbsp;skews&nbsp;the&nbsp;counting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638159">var</span>&nbsp;<span class="ident" id="5638163">collector</span>&nbsp;<span class="op" id="5638173">=</span>&nbsp;<span class="builtinfunc" id="5638175">make</span><span class="op" id="5638179">(</span><span class="keyword" id="5638180">chan</span>&nbsp;<span class="keyword" id="5638185">interface</span><span class="op" id="5638194">{</span><span class="op" id="5638195">}</span><span class="op" id="5638196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638201">numParallel</span>&nbsp;<span class="op" id="5638213">:=</span>&nbsp;<span class="num" id="5638216">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638220">startParallel</span>&nbsp;<span class="op" id="5638234">:=</span>&nbsp;<span class="builtinfunc" id="5638237">make</span><span class="op" id="5638241">(</span><span class="keyword" id="5638242">chan</span>&nbsp;<span class="builtintype" id="5638247">bool</span><span class="op" id="5638251">)</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638256">for</span>&nbsp;<span class="ident" id="5638260">i</span>&nbsp;<span class="op" id="5638262">:=</span>&nbsp;<span class="num" id="5638265">0</span><span class="op" id="5638266">;</span>&nbsp;<span class="ident" id="5638268">i</span>&nbsp;<span class="op" id="5638270">&lt;</span>&nbsp;<span class="builtinfunc" id="5638272">len</span><span class="op" id="5638275">(</span><span class="ident" id="5638276">tests</span><span class="op" id="5638281">)</span><span class="op" id="5638282">;</span>&nbsp;<span class="ident" id="5638284">i</span><span class="op" id="5638285">++</span>&nbsp;<span class="op" id="5638288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638293">matched</span><span class="op" id="5638300">,</span>&nbsp;<span class="ident" id="5638302">err</span>&nbsp;<span class="op" id="5638306">:=</span>&nbsp;<span class="ident" id="5638309">matchString</span><span class="op" id="5638320">(</span><span class="op" id="5638321">*</span><span class="ident" id="5638322">match</span><span class="op" id="5638327">,</span>&nbsp;<span class="ident" id="5638329">tests</span><span class="op" id="5638334">[</span><span class="ident" id="5638335">i</span><span class="op" id="5638336">]</span><span class="op" id="5638337">.</span><span class="ident" id="5638338">Name</span><span class="op" id="5638342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638347">if</span>&nbsp;<span class="ident" id="5638350">err</span>&nbsp;<span class="op" id="5638354">!=</span>&nbsp;<span class="ident" id="5638357">nil</span>&nbsp;<span class="op" id="5638361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638367">fmt</span><span class="op" id="5638370">.</span><span class="ident" id="5638371">Fprintf</span><span class="op" id="5638378">(</span><span class="ident" id="5638379">os</span><span class="op" id="5638381">.</span><span class="ident" id="5638382">Stderr</span><span class="op" id="5638388">,</span>&nbsp;<span class="string" id="5638390">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.run:&nbsp;%s\n&#34;</span><span class="op" id="5638435">,</span>&nbsp;<span class="ident" id="5638437">err</span><span class="op" id="5638440">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638446">os</span><span class="op" id="5638448">.</span><span class="ident" id="5638449">Exit</span><span class="op" id="5638453">(</span><span class="num" id="5638454">1</span><span class="op" id="5638455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638465">if</span>&nbsp;<span class="op" id="5638468">!</span><span class="ident" id="5638469">matched</span>&nbsp;<span class="op" id="5638477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638483">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638495">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638500">testName</span>&nbsp;<span class="op" id="5638509">:=</span>&nbsp;<span class="ident" id="5638512">tests</span><span class="op" id="5638517">[</span><span class="ident" id="5638518">i</span><span class="op" id="5638519">]</span><span class="op" id="5638520">.</span><span class="ident" id="5638521">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638529">if</span>&nbsp;<span class="ident" id="5638532">procs</span>&nbsp;<span class="op" id="5638538">!=</span>&nbsp;<span class="num" id="5638541">1</span>&nbsp;<span class="op" id="5638543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638549">testName</span>&nbsp;<span class="op" id="5638558">=</span>&nbsp;<span class="ident" id="5638560">fmt</span><span class="op" id="5638563">.</span><span class="ident" id="5638564">Sprintf</span><span class="op" id="5638571">(</span><span class="string" id="5638572">&#34;%s-%d&#34;</span><span class="op" id="5638579">,</span>&nbsp;<span class="ident" id="5638581">tests</span><span class="op" id="5638586">[</span><span class="ident" id="5638587">i</span><span class="op" id="5638588">]</span><span class="op" id="5638589">.</span><span class="ident" id="5638590">Name</span><span class="op" id="5638594">,</span>&nbsp;<span class="ident" id="5638596">procs</span><span class="op" id="5638601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638611">t</span>&nbsp;<span class="op" id="5638613">:=</span>&nbsp;<span class="op" id="5638616">&amp;</span><span class="ident" id="5638617">T</span><span class="op" id="5638618">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638624">common</span><span class="op" id="5638630">:</span>&nbsp;<span class="ident" id="5638632">common</span><span class="op" id="5638638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638645">signal</span><span class="op" id="5638651">:</span>&nbsp;<span class="builtinfunc" id="5638653">make</span><span class="op" id="5638657">(</span><span class="keyword" id="5638658">chan</span>&nbsp;<span class="keyword" id="5638663">interface</span><span class="op" id="5638672">{</span><span class="op" id="5638673">}</span><span class="op" id="5638674">)</span><span class="op" id="5638675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638681">}</span><span class="op" id="5638682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638688">name</span><span class="op" id="5638692">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5638703">testName</span><span class="op" id="5638711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638717">startParallel</span><span class="op" id="5638730">:</span>&nbsp;<span class="ident" id="5638732">startParallel</span><span class="op" id="5638745">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638755">t</span><span class="op" id="5638756">.</span><span class="ident" id="5638757">self</span>&nbsp;<span class="op" id="5638762">=</span>&nbsp;<span class="ident" id="5638764">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638769">if</span>&nbsp;<span class="op" id="5638772">*</span><span class="ident" id="5638773">chatty</span>&nbsp;<span class="op" id="5638780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638786">fmt</span><span class="op" id="5638789">.</span><span class="ident" id="5638790">Printf</span><span class="op" id="5638796">(</span><span class="string" id="5638797">&#34;===&nbsp;RUN&nbsp;%s\n&#34;</span><span class="op" id="5638811">,</span>&nbsp;<span class="ident" id="5638813">t</span><span class="op" id="5638814">.</span><span class="ident" id="5638815">name</span><span class="op" id="5638819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638824">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638829">go</span>&nbsp;<span class="ident" id="5638832">tRunner</span><span class="op" id="5638839">(</span><span class="ident" id="5638840">t</span><span class="op" id="5638841">,</span>&nbsp;<span class="op" id="5638843">&amp;</span><span class="ident" id="5638844">tests</span><span class="op" id="5638849">[</span><span class="ident" id="5638850">i</span><span class="op" id="5638851">]</span><span class="op" id="5638852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638857">out</span>&nbsp;<span class="op" id="5638861">:=</span>&nbsp;<span class="op" id="5638864">(</span><span class="op" id="5638865">&lt;-</span><span class="ident" id="5638867">t</span><span class="op" id="5638868">.</span><span class="ident" id="5638869">signal</span><span class="op" id="5638875">)</span><span class="op" id="5638876">.</span><span class="op" id="5638877">(</span><span class="op" id="5638878">*</span><span class="ident" id="5638879">T</span><span class="op" id="5638880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638885">if</span>&nbsp;<span class="ident" id="5638888">out</span>&nbsp;<span class="op" id="5638892">==</span>&nbsp;<span class="ident" id="5638895">nil</span>&nbsp;<span class="op" id="5638899">{</span>&nbsp;<span class="comment" id="5638901">//&nbsp;Parallel&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638922">go</span>&nbsp;<span class="keyword" id="5638925">func</span><span class="op" id="5638929">(</span><span class="op" id="5638930">)</span>&nbsp;<span class="op" id="5638932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638939">collector</span>&nbsp;<span class="op" id="5638949">&lt;-</span>&nbsp;<span class="op" id="5638952">&lt;-</span><span class="ident" id="5638954">t</span><span class="op" id="5638955">.</span><span class="ident" id="5638956">signal</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638967">}</span><span class="op" id="5638968">(</span><span class="op" id="5638969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638975">numParallel</span><span class="op" id="5638986">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638993">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639010">t</span><span class="op" id="5639011">.</span><span class="ident" id="5639012">report</span><span class="op" id="5639018">(</span><span class="op" id="5639019">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639024">ok</span>&nbsp;<span class="op" id="5639027">=</span>&nbsp;<span class="ident" id="5639029">ok</span>&nbsp;<span class="op" id="5639032">&amp;&amp;</span>&nbsp;<span class="op" id="5639035">!</span><span class="ident" id="5639036">out</span><span class="op" id="5639039">.</span><span class="ident" id="5639040">Failed</span><span class="op" id="5639046">(</span><span class="op" id="5639047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639056">running</span>&nbsp;<span class="op" id="5639064">:=</span>&nbsp;<span class="num" id="5639067">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639071">for</span>&nbsp;<span class="ident" id="5639075">numParallel</span><span class="op" id="5639086">+</span><span class="ident" id="5639087">running</span>&nbsp;<span class="op" id="5639095">&gt;</span>&nbsp;<span class="num" id="5639097">0</span>&nbsp;<span class="op" id="5639099">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639104">if</span>&nbsp;<span class="ident" id="5639107">running</span>&nbsp;<span class="op" id="5639115">&lt;</span>&nbsp;<span class="op" id="5639117">*</span><span class="ident" id="5639118">parallel</span>&nbsp;<span class="op" id="5639127">&amp;&amp;</span>&nbsp;<span class="ident" id="5639130">numParallel</span>&nbsp;<span class="op" id="5639142">&gt;</span>&nbsp;<span class="num" id="5639144">0</span>&nbsp;<span class="op" id="5639146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639152">startParallel</span>&nbsp;<span class="op" id="5639166">&lt;-</span>&nbsp;<span class="ident" id="5639169">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639178">running</span><span class="op" id="5639185">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639192">numParallel</span><span class="op" id="5639203">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639210">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639227">t</span>&nbsp;<span class="op" id="5639229">:=</span>&nbsp;<span class="op" id="5639232">(</span><span class="op" id="5639233">&lt;-</span><span class="ident" id="5639235">collector</span><span class="op" id="5639244">)</span><span class="op" id="5639245">.</span><span class="op" id="5639246">(</span><span class="op" id="5639247">*</span><span class="ident" id="5639248">T</span><span class="op" id="5639249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639254">t</span><span class="op" id="5639255">.</span><span class="ident" id="5639256">report</span><span class="op" id="5639262">(</span><span class="op" id="5639263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639268">ok</span>&nbsp;<span class="op" id="5639271">=</span>&nbsp;<span class="ident" id="5639273">ok</span>&nbsp;<span class="op" id="5639276">&amp;&amp;</span>&nbsp;<span class="op" id="5639279">!</span><span class="ident" id="5639280">t</span><span class="op" id="5639281">.</span><span class="ident" id="5639282">Failed</span><span class="op" id="5639288">(</span><span class="op" id="5639289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639294">running</span><span class="op" id="5639301">--</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639312">return</span><br>
<span class="lineno"></span><span class="op" id="5639319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="comment" id="5639322">//&nbsp;before&nbsp;runs&nbsp;before&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="5639357">func</span>&nbsp;<span class="ident" id="5639362">before</span><span class="op" id="5639368">(</span><span class="op" id="5639369">)</span>&nbsp;<span class="op" id="5639371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639374">if</span>&nbsp;<span class="op" id="5639377">*</span><span class="ident" id="5639378">memProfileRate</span>&nbsp;<span class="op" id="5639393">&gt;</span>&nbsp;<span class="num" id="5639395">0</span>&nbsp;<span class="op" id="5639397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639401">runtime</span><span class="op" id="5639408">.</span><span class="ident" id="5639409">MemProfileRate</span>&nbsp;<span class="op" id="5639424">=</span>&nbsp;<span class="op" id="5639426">*</span><span class="ident" id="5639427">memProfileRate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639443">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639446">if</span>&nbsp;<span class="op" id="5639449">*</span><span class="ident" id="5639450">cpuProfile</span>&nbsp;<span class="op" id="5639461">!=</span>&nbsp;<span class="string" id="5639464">&#34;&#34;</span>&nbsp;<span class="op" id="5639467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639471">f</span><span class="op" id="5639472">,</span>&nbsp;<span class="ident" id="5639474">err</span>&nbsp;<span class="op" id="5639478">:=</span>&nbsp;<span class="ident" id="5639481">os</span><span class="op" id="5639483">.</span><span class="ident" id="5639484">Create</span><span class="op" id="5639490">(</span><span class="ident" id="5639491">toOutputDir</span><span class="op" id="5639502">(</span><span class="op" id="5639503">*</span><span class="ident" id="5639504">cpuProfile</span><span class="op" id="5639514">)</span><span class="op" id="5639515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639519">if</span>&nbsp;<span class="ident" id="5639522">err</span>&nbsp;<span class="op" id="5639526">!=</span>&nbsp;<span class="ident" id="5639529">nil</span>&nbsp;<span class="op" id="5639533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639538">fmt</span><span class="op" id="5639541">.</span><span class="ident" id="5639542">Fprintf</span><span class="op" id="5639549">(</span><span class="ident" id="5639550">os</span><span class="op" id="5639552">.</span><span class="ident" id="5639553">Stderr</span><span class="op" id="5639559">,</span>&nbsp;<span class="string" id="5639561">&#34;testing:&nbsp;%s&#34;</span><span class="op" id="5639574">,</span>&nbsp;<span class="ident" id="5639576">err</span><span class="op" id="5639579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639584">return</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639597">if</span>&nbsp;<span class="ident" id="5639600">err</span>&nbsp;<span class="op" id="5639604">:=</span>&nbsp;<span class="ident" id="5639607">pprof</span><span class="op" id="5639612">.</span><span class="ident" id="5639613">StartCPUProfile</span><span class="op" id="5639628">(</span><span class="ident" id="5639629">f</span><span class="op" id="5639630">)</span><span class="op" id="5639631">;</span>&nbsp;<span class="ident" id="5639633">err</span>&nbsp;<span class="op" id="5639637">!=</span>&nbsp;<span class="ident" id="5639640">nil</span>&nbsp;<span class="op" id="5639644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639649">fmt</span><span class="op" id="5639652">.</span><span class="ident" id="5639653">Fprintf</span><span class="op" id="5639660">(</span><span class="ident" id="5639661">os</span><span class="op" id="5639663">.</span><span class="ident" id="5639664">Stderr</span><span class="op" id="5639670">,</span>&nbsp;<span class="string" id="5639672">&#34;testing:&nbsp;can&#39;t&nbsp;start&nbsp;cpu&nbsp;profile:&nbsp;%s&#34;</span><span class="op" id="5639710">,</span>&nbsp;<span class="ident" id="5639712">err</span><span class="op" id="5639715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639720">f</span><span class="op" id="5639721">.</span><span class="ident" id="5639722">Close</span><span class="op" id="5639727">(</span><span class="op" id="5639728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639733">return</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5639746">//&nbsp;Could&nbsp;save&nbsp;f&nbsp;so&nbsp;after&nbsp;can&nbsp;call&nbsp;f.Close;&nbsp;not&nbsp;worth&nbsp;the&nbsp;effort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639815">if</span>&nbsp;<span class="op" id="5639818">*</span><span class="ident" id="5639819">blockProfile</span>&nbsp;<span class="op" id="5639832">!=</span>&nbsp;<span class="string" id="5639835">&#34;&#34;</span>&nbsp;<span class="op" id="5639838">&amp;&amp;</span>&nbsp;<span class="op" id="5639841">*</span><span class="ident" id="5639842">blockProfileRate</span>&nbsp;<span class="op" id="5639859">&gt;=</span>&nbsp;<span class="num" id="5639862">0</span>&nbsp;<span class="op" id="5639864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639868">runtime</span><span class="op" id="5639875">.</span><span class="ident" id="5639876">SetBlockProfileRate</span><span class="op" id="5639895">(</span><span class="op" id="5639896">*</span><span class="ident" id="5639897">blockProfileRate</span><span class="op" id="5639913">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639919">if</span>&nbsp;<span class="op" id="5639922">*</span><span class="ident" id="5639923">coverProfile</span>&nbsp;<span class="op" id="5639936">!=</span>&nbsp;<span class="string" id="5639939">&#34;&#34;</span>&nbsp;<span class="op" id="5639942">&amp;&amp;</span>&nbsp;<span class="ident" id="5639945">cover</span><span class="op" id="5639950">.</span><span class="ident" id="5639951">Mode</span>&nbsp;<span class="op" id="5639956">==</span>&nbsp;<span class="string" id="5639959">&#34;&#34;</span>&nbsp;<span class="op" id="5639962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639966">fmt</span><span class="op" id="5639969">.</span><span class="ident" id="5639970">Fprintf</span><span class="op" id="5639977">(</span><span class="ident" id="5639978">os</span><span class="op" id="5639980">.</span><span class="ident" id="5639981">Stderr</span><span class="op" id="5639987">,</span>&nbsp;<span class="string" id="5639989">&#34;testing:&nbsp;cannot&nbsp;use&nbsp;-test.coverprofile&nbsp;because&nbsp;test&nbsp;binary&nbsp;was&nbsp;not&nbsp;built&nbsp;with&nbsp;coverage&nbsp;enabled\n&#34;</span><span class="op" id="5640087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640091">os</span><span class="op" id="5640093">.</span><span class="ident" id="5640094">Exit</span><span class="op" id="5640098">(</span><span class="num" id="5640099">2</span><span class="op" id="5640100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640103">}</span><br>
<span class="lineno">610</span><span class="op" id="5640105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5640108">//&nbsp;after&nbsp;runs&nbsp;after&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="5640141">func</span>&nbsp;<span class="ident" id="5640146">after</span><span class="op" id="5640151">(</span><span class="op" id="5640152">)</span>&nbsp;<span class="op" id="5640154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640157">if</span>&nbsp;<span class="op" id="5640160">*</span><span class="ident" id="5640161">cpuProfile</span>&nbsp;<span class="op" id="5640172">!=</span>&nbsp;<span class="string" id="5640175">&#34;&#34;</span>&nbsp;<span class="op" id="5640178">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640182">pprof</span><span class="op" id="5640187">.</span><span class="ident" id="5640188">StopCPUProfile</span><span class="op" id="5640202">(</span><span class="op" id="5640203">)</span>&nbsp;<span class="comment" id="5640205">//&nbsp;flushes&nbsp;profile&nbsp;to&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640236">if</span>&nbsp;<span class="op" id="5640239">*</span><span class="ident" id="5640240">memProfile</span>&nbsp;<span class="op" id="5640251">!=</span>&nbsp;<span class="string" id="5640254">&#34;&#34;</span>&nbsp;<span class="op" id="5640257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640261">f</span><span class="op" id="5640262">,</span>&nbsp;<span class="ident" id="5640264">err</span>&nbsp;<span class="op" id="5640268">:=</span>&nbsp;<span class="ident" id="5640271">os</span><span class="op" id="5640273">.</span><span class="ident" id="5640274">Create</span><span class="op" id="5640280">(</span><span class="ident" id="5640281">toOutputDir</span><span class="op" id="5640292">(</span><span class="op" id="5640293">*</span><span class="ident" id="5640294">memProfile</span><span class="op" id="5640304">)</span><span class="op" id="5640305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640309">if</span>&nbsp;<span class="ident" id="5640312">err</span>&nbsp;<span class="op" id="5640316">!=</span>&nbsp;<span class="ident" id="5640319">nil</span>&nbsp;<span class="op" id="5640323">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640328">fmt</span><span class="op" id="5640331">.</span><span class="ident" id="5640332">Fprintf</span><span class="op" id="5640339">(</span><span class="ident" id="5640340">os</span><span class="op" id="5640342">.</span><span class="ident" id="5640343">Stderr</span><span class="op" id="5640349">,</span>&nbsp;<span class="string" id="5640351">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="5640366">,</span>&nbsp;<span class="ident" id="5640368">err</span><span class="op" id="5640371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640376">os</span><span class="op" id="5640378">.</span><span class="ident" id="5640379">Exit</span><span class="op" id="5640383">(</span><span class="num" id="5640384">2</span><span class="op" id="5640385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640393">runtime</span><span class="op" id="5640400">.</span><span class="ident" id="5640401">GC</span><span class="op" id="5640403">(</span><span class="op" id="5640404">)</span>&nbsp;<span class="comment" id="5640406">//&nbsp;materialize&nbsp;all&nbsp;statistics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640438">if</span>&nbsp;<span class="ident" id="5640441">err</span>&nbsp;<span class="op" id="5640445">=</span>&nbsp;<span class="ident" id="5640447">pprof</span><span class="op" id="5640452">.</span><span class="ident" id="5640453">WriteHeapProfile</span><span class="op" id="5640469">(</span><span class="ident" id="5640470">f</span><span class="op" id="5640471">)</span><span class="op" id="5640472">;</span>&nbsp;<span class="ident" id="5640474">err</span>&nbsp;<span class="op" id="5640478">!=</span>&nbsp;<span class="ident" id="5640481">nil</span>&nbsp;<span class="op" id="5640485">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640490">fmt</span><span class="op" id="5640493">.</span><span class="ident" id="5640494">Fprintf</span><span class="op" id="5640501">(</span><span class="ident" id="5640502">os</span><span class="op" id="5640504">.</span><span class="ident" id="5640505">Stderr</span><span class="op" id="5640511">,</span>&nbsp;<span class="string" id="5640513">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="5640544">,</span>&nbsp;<span class="op" id="5640546">*</span><span class="ident" id="5640547">memProfile</span><span class="op" id="5640557">,</span>&nbsp;<span class="ident" id="5640559">err</span><span class="op" id="5640562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640567">os</span><span class="op" id="5640569">.</span><span class="ident" id="5640570">Exit</span><span class="op" id="5640574">(</span><span class="num" id="5640575">2</span><span class="op" id="5640576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640584">f</span><span class="op" id="5640585">.</span><span class="ident" id="5640586">Close</span><span class="op" id="5640591">(</span><span class="op" id="5640592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640595">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640598">if</span>&nbsp;<span class="op" id="5640601">*</span><span class="ident" id="5640602">blockProfile</span>&nbsp;<span class="op" id="5640615">!=</span>&nbsp;<span class="string" id="5640618">&#34;&#34;</span>&nbsp;<span class="op" id="5640621">&amp;&amp;</span>&nbsp;<span class="op" id="5640624">*</span><span class="ident" id="5640625">blockProfileRate</span>&nbsp;<span class="op" id="5640642">&gt;=</span>&nbsp;<span class="num" id="5640645">0</span>&nbsp;<span class="op" id="5640647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640651">f</span><span class="op" id="5640652">,</span>&nbsp;<span class="ident" id="5640654">err</span>&nbsp;<span class="op" id="5640658">:=</span>&nbsp;<span class="ident" id="5640661">os</span><span class="op" id="5640663">.</span><span class="ident" id="5640664">Create</span><span class="op" id="5640670">(</span><span class="ident" id="5640671">toOutputDir</span><span class="op" id="5640682">(</span><span class="op" id="5640683">*</span><span class="ident" id="5640684">blockProfile</span><span class="op" id="5640696">)</span><span class="op" id="5640697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640701">if</span>&nbsp;<span class="ident" id="5640704">err</span>&nbsp;<span class="op" id="5640708">!=</span>&nbsp;<span class="ident" id="5640711">nil</span>&nbsp;<span class="op" id="5640715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640720">fmt</span><span class="op" id="5640723">.</span><span class="ident" id="5640724">Fprintf</span><span class="op" id="5640731">(</span><span class="ident" id="5640732">os</span><span class="op" id="5640734">.</span><span class="ident" id="5640735">Stderr</span><span class="op" id="5640741">,</span>&nbsp;<span class="string" id="5640743">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="5640758">,</span>&nbsp;<span class="ident" id="5640760">err</span><span class="op" id="5640763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640768">os</span><span class="op" id="5640770">.</span><span class="ident" id="5640771">Exit</span><span class="op" id="5640775">(</span><span class="num" id="5640776">2</span><span class="op" id="5640777">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640785">if</span>&nbsp;<span class="ident" id="5640788">err</span>&nbsp;<span class="op" id="5640792">=</span>&nbsp;<span class="ident" id="5640794">pprof</span><span class="op" id="5640799">.</span><span class="ident" id="5640800">Lookup</span><span class="op" id="5640806">(</span><span class="string" id="5640807">&#34;block&#34;</span><span class="op" id="5640814">)</span><span class="op" id="5640815">.</span><span class="ident" id="5640816">WriteTo</span><span class="op" id="5640823">(</span><span class="ident" id="5640824">f</span><span class="op" id="5640825">,</span>&nbsp;<span class="num" id="5640827">0</span><span class="op" id="5640828">)</span><span class="op" id="5640829">;</span>&nbsp;<span class="ident" id="5640831">err</span>&nbsp;<span class="op" id="5640835">!=</span>&nbsp;<span class="ident" id="5640838">nil</span>&nbsp;<span class="op" id="5640842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640847">fmt</span><span class="op" id="5640850">.</span><span class="ident" id="5640851">Fprintf</span><span class="op" id="5640858">(</span><span class="ident" id="5640859">os</span><span class="op" id="5640861">.</span><span class="ident" id="5640862">Stderr</span><span class="op" id="5640868">,</span>&nbsp;<span class="string" id="5640870">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="5640901">,</span>&nbsp;<span class="op" id="5640903">*</span><span class="ident" id="5640904">blockProfile</span><span class="op" id="5640916">,</span>&nbsp;<span class="ident" id="5640918">err</span><span class="op" id="5640921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640926">os</span><span class="op" id="5640928">.</span><span class="ident" id="5640929">Exit</span><span class="op" id="5640933">(</span><span class="num" id="5640934">2</span><span class="op" id="5640935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640939">}</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640943">f</span><span class="op" id="5640944">.</span><span class="ident" id="5640945">Close</span><span class="op" id="5640950">(</span><span class="op" id="5640951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640957">if</span>&nbsp;<span class="ident" id="5640960">cover</span><span class="op" id="5640965">.</span><span class="ident" id="5640966">Mode</span>&nbsp;<span class="op" id="5640971">!=</span>&nbsp;<span class="string" id="5640974">&#34;&#34;</span>&nbsp;<span class="op" id="5640977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640981">coverReport</span><span class="op" id="5640992">(</span><span class="op" id="5640993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640996">}</span><br>
<span class="lineno">645</span><span class="op" id="5640998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5641001">//&nbsp;toOutputDir&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;relocated,&nbsp;if&nbsp;required,&nbsp;to&nbsp;outputDir.</span><br>
<span class="lineno"></span><span class="comment" id="5641076">//&nbsp;Simple&nbsp;implementation&nbsp;to&nbsp;avoid&nbsp;pulling&nbsp;in&nbsp;path/filepath.</span><br>
<span class="lineno"></span><span class="keyword" id="5641136">func</span>&nbsp;<span class="ident" id="5641141">toOutputDir</span><span class="op" id="5641152">(</span><span class="ident" id="5641153">path</span>&nbsp;<span class="builtintype" id="5641158">string</span><span class="op" id="5641164">)</span>&nbsp;<span class="builtintype" id="5641166">string</span>&nbsp;<span class="op" id="5641173">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641176">if</span>&nbsp;<span class="op" id="5641179">*</span><span class="ident" id="5641180">outputDir</span>&nbsp;<span class="op" id="5641190">==</span>&nbsp;<span class="string" id="5641193">&#34;&#34;</span>&nbsp;<span class="op" id="5641196">||</span>&nbsp;<span class="ident" id="5641199">path</span>&nbsp;<span class="op" id="5641204">==</span>&nbsp;<span class="string" id="5641207">&#34;&#34;</span>&nbsp;<span class="op" id="5641210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641214">return</span>&nbsp;<span class="ident" id="5641221">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641230">if</span>&nbsp;<span class="ident" id="5641233">runtime</span><span class="op" id="5641240">.</span><span class="ident" id="5641241">GOOS</span>&nbsp;<span class="op" id="5641246">==</span>&nbsp;<span class="string" id="5641249">&#34;windows&#34;</span>&nbsp;<span class="op" id="5641259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641263">//&nbsp;On&nbsp;Windows,&nbsp;it&#39;s&nbsp;clumsy,&nbsp;but&nbsp;we&nbsp;can&nbsp;be&nbsp;almost&nbsp;always&nbsp;correct</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641329">//&nbsp;by&nbsp;just&nbsp;looking&nbsp;for&nbsp;a&nbsp;drive&nbsp;letter&nbsp;and&nbsp;a&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641382">//&nbsp;Absolute&nbsp;paths&nbsp;always&nbsp;have&nbsp;a&nbsp;drive&nbsp;letter&nbsp;(ignoring&nbsp;UNC).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641445">//&nbsp;Problem:&nbsp;if&nbsp;path&nbsp;==&nbsp;&#34;C:A&#34;&nbsp;and&nbsp;outputdir&nbsp;==&nbsp;&#34;C:\Go&#34;&nbsp;it&#39;s&nbsp;unclear</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641514">//&nbsp;what&nbsp;to&nbsp;do,&nbsp;but&nbsp;even&nbsp;then&nbsp;path/filepath&nbsp;doesn&#39;t&nbsp;help.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641573">//&nbsp;TODO:&nbsp;Worth&nbsp;doing&nbsp;better?&nbsp;Probably&nbsp;not,&nbsp;because&nbsp;we&#39;re&nbsp;here&nbsp;only</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641642">//&nbsp;under&nbsp;the&nbsp;management&nbsp;of&nbsp;go&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641680">if</span>&nbsp;<span class="builtinfunc" id="5641683">len</span><span class="op" id="5641686">(</span><span class="ident" id="5641687">path</span><span class="op" id="5641691">)</span>&nbsp;<span class="op" id="5641693">&gt;=</span>&nbsp;<span class="num" id="5641696">2</span>&nbsp;<span class="op" id="5641698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641703">letter</span><span class="op" id="5641709">,</span>&nbsp;<span class="ident" id="5641711">colon</span>&nbsp;<span class="op" id="5641717">:=</span>&nbsp;<span class="ident" id="5641720">path</span><span class="op" id="5641724">[</span><span class="num" id="5641725">0</span><span class="op" id="5641726">]</span><span class="op" id="5641727">,</span>&nbsp;<span class="ident" id="5641729">path</span><span class="op" id="5641733">[</span><span class="num" id="5641734">1</span><span class="op" id="5641735">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641740">if</span>&nbsp;<span class="op" id="5641743">(</span><span class="string" id="5641744">&#39;a&#39;</span>&nbsp;<span class="op" id="5641748">&lt;=</span>&nbsp;<span class="ident" id="5641751">letter</span>&nbsp;<span class="op" id="5641758">&amp;&amp;</span>&nbsp;<span class="ident" id="5641761">letter</span>&nbsp;<span class="op" id="5641768">&lt;=</span>&nbsp;<span class="string" id="5641771">&#39;z&#39;</span>&nbsp;<span class="op" id="5641775">||</span>&nbsp;<span class="string" id="5641778">&#39;A&#39;</span>&nbsp;<span class="op" id="5641782">&lt;=</span>&nbsp;<span class="ident" id="5641785">letter</span>&nbsp;<span class="op" id="5641792">&amp;&amp;</span>&nbsp;<span class="ident" id="5641795">letter</span>&nbsp;<span class="op" id="5641802">&lt;=</span>&nbsp;<span class="string" id="5641805">&#39;Z&#39;</span><span class="op" id="5641808">)</span>&nbsp;<span class="op" id="5641810">&amp;&amp;</span>&nbsp;<span class="ident" id="5641813">colon</span>&nbsp;<span class="op" id="5641819">==</span>&nbsp;<span class="string" id="5641822">&#39;:&#39;</span>&nbsp;<span class="op" id="5641826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641832">//&nbsp;If&nbsp;path&nbsp;starts&nbsp;with&nbsp;a&nbsp;drive&nbsp;letter&nbsp;we&#39;re&nbsp;stuck&nbsp;with&nbsp;it&nbsp;regardless.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641906">return</span>&nbsp;<span class="ident" id="5641913">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641931">if</span>&nbsp;<span class="ident" id="5641934">os</span><span class="op" id="5641936">.</span><span class="ident" id="5641937">IsPathSeparator</span><span class="op" id="5641952">(</span><span class="ident" id="5641953">path</span><span class="op" id="5641957">[</span><span class="num" id="5641958">0</span><span class="op" id="5641959">]</span><span class="op" id="5641960">)</span>&nbsp;<span class="op" id="5641962">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641966">return</span>&nbsp;<span class="ident" id="5641973">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641982">return</span>&nbsp;<span class="ident" id="5641989">fmt</span><span class="op" id="5641992">.</span><span class="ident" id="5641993">Sprintf</span><span class="op" id="5642000">(</span><span class="string" id="5642001">&#34;%s%c%s&#34;</span><span class="op" id="5642009">,</span>&nbsp;<span class="op" id="5642011">*</span><span class="ident" id="5642012">outputDir</span><span class="op" id="5642021">,</span>&nbsp;<span class="ident" id="5642023">os</span><span class="op" id="5642025">.</span><span class="ident" id="5642026">PathSeparator</span><span class="op" id="5642039">,</span>&nbsp;<span class="ident" id="5642041">path</span><span class="op" id="5642045">)</span><br>
<span class="lineno"></span><span class="op" id="5642047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="5642050">var</span>&nbsp;<span class="ident" id="5642054">timer</span>&nbsp;<span class="op" id="5642060">*</span><span class="ident" id="5642061">time</span><span class="op" id="5642065">.</span><span class="ident" id="5642066">Timer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5642073">//&nbsp;startAlarm&nbsp;starts&nbsp;an&nbsp;alarm&nbsp;if&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="5642117">func</span>&nbsp;<span class="ident" id="5642122">startAlarm</span><span class="op" id="5642132">(</span><span class="op" id="5642133">)</span>&nbsp;<span class="op" id="5642135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642138">if</span>&nbsp;<span class="op" id="5642141">*</span><span class="ident" id="5642142">timeout</span>&nbsp;<span class="op" id="5642150">&gt;</span>&nbsp;<span class="num" id="5642152">0</span>&nbsp;<span class="op" id="5642154">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642158">timer</span>&nbsp;<span class="op" id="5642164">=</span>&nbsp;<span class="ident" id="5642166">time</span><span class="op" id="5642170">.</span><span class="ident" id="5642171">AfterFunc</span><span class="op" id="5642180">(</span><span class="op" id="5642181">*</span><span class="ident" id="5642182">timeout</span><span class="op" id="5642189">,</span>&nbsp;<span class="keyword" id="5642191">func</span><span class="op" id="5642195">(</span><span class="op" id="5642196">)</span>&nbsp;<span class="op" id="5642198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5642203">panic</span><span class="op" id="5642208">(</span><span class="ident" id="5642209">fmt</span><span class="op" id="5642212">.</span><span class="ident" id="5642213">Sprintf</span><span class="op" id="5642220">(</span><span class="string" id="5642221">&#34;test&nbsp;timed&nbsp;out&nbsp;after&nbsp;%v&#34;</span><span class="op" id="5642246">,</span>&nbsp;<span class="op" id="5642248">*</span><span class="ident" id="5642249">timeout</span><span class="op" id="5642256">)</span><span class="op" id="5642257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642261">}</span><span class="op" id="5642262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642265">}</span><br>
<span class="lineno"></span><span class="op" id="5642267">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="5642270">//&nbsp;stopAlarm&nbsp;turns&nbsp;off&nbsp;the&nbsp;alarm.</span><br>
<span class="lineno"></span><span class="keyword" id="5642304">func</span>&nbsp;<span class="ident" id="5642309">stopAlarm</span><span class="op" id="5642318">(</span><span class="op" id="5642319">)</span>&nbsp;<span class="op" id="5642321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642324">if</span>&nbsp;<span class="op" id="5642327">*</span><span class="ident" id="5642328">timeout</span>&nbsp;<span class="op" id="5642336">&gt;</span>&nbsp;<span class="num" id="5642338">0</span>&nbsp;<span class="op" id="5642340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642344">timer</span><span class="op" id="5642349">.</span><span class="ident" id="5642350">Stop</span><span class="op" id="5642354">(</span><span class="op" id="5642355">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642358">}</span><br>
<span class="lineno"></span><span class="op" id="5642360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5642363">func</span>&nbsp;<span class="ident" id="5642368">parseCpuList</span><span class="op" id="5642380">(</span><span class="op" id="5642381">)</span>&nbsp;<span class="op" id="5642383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642386">for</span>&nbsp;<span class="ident" id="5642390">_</span><span class="op" id="5642391">,</span>&nbsp;<span class="ident" id="5642393">val</span>&nbsp;<span class="op" id="5642397">:=</span>&nbsp;<span class="keyword" id="5642400">range</span>&nbsp;<span class="ident" id="5642406">strings</span><span class="op" id="5642413">.</span><span class="ident" id="5642414">Split</span><span class="op" id="5642419">(</span><span class="op" id="5642420">*</span><span class="ident" id="5642421">cpuListStr</span><span class="op" id="5642431">,</span>&nbsp;<span class="string" id="5642433">&#34;,&#34;</span><span class="op" id="5642436">)</span>&nbsp;<span class="op" id="5642438">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642442">val</span>&nbsp;<span class="op" id="5642446">=</span>&nbsp;<span class="ident" id="5642448">strings</span><span class="op" id="5642455">.</span><span class="ident" id="5642456">TrimSpace</span><span class="op" id="5642465">(</span><span class="ident" id="5642466">val</span><span class="op" id="5642469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642473">if</span>&nbsp;<span class="ident" id="5642476">val</span>&nbsp;<span class="op" id="5642480">==</span>&nbsp;<span class="string" id="5642483">&#34;&#34;</span>&nbsp;<span class="op" id="5642486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642491">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642506">cpu</span><span class="op" id="5642509">,</span>&nbsp;<span class="ident" id="5642511">err</span>&nbsp;<span class="op" id="5642515">:=</span>&nbsp;<span class="ident" id="5642518">strconv</span><span class="op" id="5642525">.</span><span class="ident" id="5642526">Atoi</span><span class="op" id="5642530">(</span><span class="ident" id="5642531">val</span><span class="op" id="5642534">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642538">if</span>&nbsp;<span class="ident" id="5642541">err</span>&nbsp;<span class="op" id="5642545">!=</span>&nbsp;<span class="ident" id="5642548">nil</span>&nbsp;<span class="op" id="5642552">||</span>&nbsp;<span class="ident" id="5642555">cpu</span>&nbsp;<span class="op" id="5642559">&lt;=</span>&nbsp;<span class="num" id="5642562">0</span>&nbsp;<span class="op" id="5642564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642569">fmt</span><span class="op" id="5642572">.</span><span class="ident" id="5642573">Fprintf</span><span class="op" id="5642580">(</span><span class="ident" id="5642581">os</span><span class="op" id="5642583">.</span><span class="ident" id="5642584">Stderr</span><span class="op" id="5642590">,</span>&nbsp;<span class="string" id="5642592">&#34;testing:&nbsp;invalid&nbsp;value&nbsp;%q&nbsp;for&nbsp;-test.cpu\n&#34;</span><span class="op" id="5642635">,</span>&nbsp;<span class="ident" id="5642637">val</span><span class="op" id="5642640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642645">os</span><span class="op" id="5642647">.</span><span class="ident" id="5642648">Exit</span><span class="op" id="5642652">(</span><span class="num" id="5642653">1</span><span class="op" id="5642654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642662">cpuList</span>&nbsp;<span class="op" id="5642670">=</span>&nbsp;<span class="builtinfunc" id="5642672">append</span><span class="op" id="5642678">(</span><span class="ident" id="5642679">cpuList</span><span class="op" id="5642686">,</span>&nbsp;<span class="ident" id="5642688">cpu</span><span class="op" id="5642691">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642697">if</span>&nbsp;<span class="ident" id="5642700">cpuList</span>&nbsp;<span class="op" id="5642708">==</span>&nbsp;<span class="ident" id="5642711">nil</span>&nbsp;<span class="op" id="5642715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642719">cpuList</span>&nbsp;<span class="op" id="5642727">=</span>&nbsp;<span class="builtinfunc" id="5642729">append</span><span class="op" id="5642735">(</span><span class="ident" id="5642736">cpuList</span><span class="op" id="5642743">,</span>&nbsp;<span class="ident" id="5642745">runtime</span><span class="op" id="5642752">.</span><span class="ident" id="5642753">GOMAXPROCS</span><span class="op" id="5642763">(</span><span class="op" id="5642764">-</span><span class="num" id="5642765">1</span><span class="op" id="5642766">)</span><span class="op" id="5642767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642770">}</span><br>
<span class="lineno"></span><span class="op" id="5642772">}</span>
</div>
</body>
</html>
