<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5688964">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5689019">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5689073">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5689124">package</span>&nbsp;<span class="ident" id="5689132">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5689138">import</span>&nbsp;<span class="op" id="5689145">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5689148">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5689157">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5689167">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5689176">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5689191">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5689196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5689199">//&nbsp;min&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;of&nbsp;two&nbsp;integers.</span><br>
<span class="lineno"></span><span class="keyword" id="5689243">func</span>&nbsp;<span class="ident" id="5689248">min</span><span class="op" id="5689251">(</span><span class="ident" id="5689252">x</span><span class="op" id="5689253">,</span>&nbsp;<span class="ident" id="5689255">y</span>&nbsp;<span class="builtintype" id="5689257">int</span><span class="op" id="5689260">)</span>&nbsp;<span class="builtintype" id="5689262">int</span>&nbsp;<span class="op" id="5689266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689269">if</span>&nbsp;<span class="ident" id="5689272">x</span>&nbsp;<span class="op" id="5689274">&lt;</span>&nbsp;<span class="ident" id="5689276">y</span>&nbsp;<span class="op" id="5689278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689282">return</span>&nbsp;<span class="ident" id="5689289">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689292">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689295">return</span>&nbsp;<span class="ident" id="5689302">y</span><br>
<span class="lineno"></span><span class="op" id="5689304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5689307">//&nbsp;div&nbsp;returns&nbsp;a/b&nbsp;rounded&nbsp;to&nbsp;the&nbsp;nearest&nbsp;integer,&nbsp;instead&nbsp;of&nbsp;rounded&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><span class="keyword" id="5689386">func</span>&nbsp;<span class="ident" id="5689391">div</span><span class="op" id="5689394">(</span><span class="ident" id="5689395">a</span><span class="op" id="5689396">,</span>&nbsp;<span class="ident" id="5689398">b</span>&nbsp;<span class="builtintype" id="5689400">int32</span><span class="op" id="5689405">)</span>&nbsp;<span class="builtintype" id="5689407">int32</span>&nbsp;<span class="op" id="5689413">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689416">if</span>&nbsp;<span class="ident" id="5689419">a</span>&nbsp;<span class="op" id="5689421">&gt;=</span>&nbsp;<span class="num" id="5689424">0</span>&nbsp;<span class="op" id="5689426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689430">return</span>&nbsp;<span class="op" id="5689437">(</span><span class="ident" id="5689438">a</span>&nbsp;<span class="op" id="5689440">+</span>&nbsp;<span class="op" id="5689442">(</span><span class="ident" id="5689443">b</span>&nbsp;<span class="op" id="5689445">&gt;&gt;</span>&nbsp;<span class="num" id="5689448">1</span><span class="op" id="5689449">)</span><span class="op" id="5689450">)</span>&nbsp;<span class="op" id="5689452">/</span>&nbsp;<span class="ident" id="5689454">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689460">return</span>&nbsp;<span class="op" id="5689467">-</span><span class="op" id="5689468">(</span><span class="op" id="5689469">(</span><span class="op" id="5689470">-</span><span class="ident" id="5689471">a</span>&nbsp;<span class="op" id="5689473">+</span>&nbsp;<span class="op" id="5689475">(</span><span class="ident" id="5689476">b</span>&nbsp;<span class="op" id="5689478">&gt;&gt;</span>&nbsp;<span class="num" id="5689481">1</span><span class="op" id="5689482">)</span><span class="op" id="5689483">)</span>&nbsp;<span class="op" id="5689485">/</span>&nbsp;<span class="ident" id="5689487">b</span><span class="op" id="5689488">)</span><br>
<span class="lineno"></span><span class="op" id="5689490">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5689493">//&nbsp;bitCount&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;needed&nbsp;to&nbsp;hold&nbsp;an&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="5689558">var</span>&nbsp;<span class="ident" id="5689562">bitCount</span>&nbsp;<span class="op" id="5689571">=</span>&nbsp;<span class="op" id="5689573">[</span><span class="num" id="5689574">256</span><span class="op" id="5689577">]</span><span class="builtintype" id="5689578">byte</span><span class="op" id="5689582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5689585">0</span><span class="op" id="5689586">,</span>&nbsp;<span class="num" id="5689588">1</span><span class="op" id="5689589">,</span>&nbsp;<span class="num" id="5689591">2</span><span class="op" id="5689592">,</span>&nbsp;<span class="num" id="5689594">2</span><span class="op" id="5689595">,</span>&nbsp;<span class="num" id="5689597">3</span><span class="op" id="5689598">,</span>&nbsp;<span class="num" id="5689600">3</span><span class="op" id="5689601">,</span>&nbsp;<span class="num" id="5689603">3</span><span class="op" id="5689604">,</span>&nbsp;<span class="num" id="5689606">3</span><span class="op" id="5689607">,</span>&nbsp;<span class="num" id="5689609">4</span><span class="op" id="5689610">,</span>&nbsp;<span class="num" id="5689612">4</span><span class="op" id="5689613">,</span>&nbsp;<span class="num" id="5689615">4</span><span class="op" id="5689616">,</span>&nbsp;<span class="num" id="5689618">4</span><span class="op" id="5689619">,</span>&nbsp;<span class="num" id="5689621">4</span><span class="op" id="5689622">,</span>&nbsp;<span class="num" id="5689624">4</span><span class="op" id="5689625">,</span>&nbsp;<span class="num" id="5689627">4</span><span class="op" id="5689628">,</span>&nbsp;<span class="num" id="5689630">4</span><span class="op" id="5689631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5689634">5</span><span class="op" id="5689635">,</span>&nbsp;<span class="num" id="5689637">5</span><span class="op" id="5689638">,</span>&nbsp;<span class="num" id="5689640">5</span><span class="op" id="5689641">,</span>&nbsp;<span class="num" id="5689643">5</span><span class="op" id="5689644">,</span>&nbsp;<span class="num" id="5689646">5</span><span class="op" id="5689647">,</span>&nbsp;<span class="num" id="5689649">5</span><span class="op" id="5689650">,</span>&nbsp;<span class="num" id="5689652">5</span><span class="op" id="5689653">,</span>&nbsp;<span class="num" id="5689655">5</span><span class="op" id="5689656">,</span>&nbsp;<span class="num" id="5689658">5</span><span class="op" id="5689659">,</span>&nbsp;<span class="num" id="5689661">5</span><span class="op" id="5689662">,</span>&nbsp;<span class="num" id="5689664">5</span><span class="op" id="5689665">,</span>&nbsp;<span class="num" id="5689667">5</span><span class="op" id="5689668">,</span>&nbsp;<span class="num" id="5689670">5</span><span class="op" id="5689671">,</span>&nbsp;<span class="num" id="5689673">5</span><span class="op" id="5689674">,</span>&nbsp;<span class="num" id="5689676">5</span><span class="op" id="5689677">,</span>&nbsp;<span class="num" id="5689679">5</span><span class="op" id="5689680">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5689683">6</span><span class="op" id="5689684">,</span>&nbsp;<span class="num" id="5689686">6</span><span class="op" id="5689687">,</span>&nbsp;<span class="num" id="5689689">6</span><span class="op" id="5689690">,</span>&nbsp;<span class="num" id="5689692">6</span><span class="op" id="5689693">,</span>&nbsp;<span class="num" id="5689695">6</span><span class="op" id="5689696">,</span>&nbsp;<span class="num" id="5689698">6</span><span class="op" id="5689699">,</span>&nbsp;<span class="num" id="5689701">6</span><span class="op" id="5689702">,</span>&nbsp;<span class="num" id="5689704">6</span><span class="op" id="5689705">,</span>&nbsp;<span class="num" id="5689707">6</span><span class="op" id="5689708">,</span>&nbsp;<span class="num" id="5689710">6</span><span class="op" id="5689711">,</span>&nbsp;<span class="num" id="5689713">6</span><span class="op" id="5689714">,</span>&nbsp;<span class="num" id="5689716">6</span><span class="op" id="5689717">,</span>&nbsp;<span class="num" id="5689719">6</span><span class="op" id="5689720">,</span>&nbsp;<span class="num" id="5689722">6</span><span class="op" id="5689723">,</span>&nbsp;<span class="num" id="5689725">6</span><span class="op" id="5689726">,</span>&nbsp;<span class="num" id="5689728">6</span><span class="op" id="5689729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5689732">6</span><span class="op" id="5689733">,</span>&nbsp;<span class="num" id="5689735">6</span><span class="op" id="5689736">,</span>&nbsp;<span class="num" id="5689738">6</span><span class="op" id="5689739">,</span>&nbsp;<span class="num" id="5689741">6</span><span class="op" id="5689742">,</span>&nbsp;<span class="num" id="5689744">6</span><span class="op" id="5689745">,</span>&nbsp;<span class="num" id="5689747">6</span><span class="op" id="5689748">,</span>&nbsp;<span class="num" id="5689750">6</span><span class="op" id="5689751">,</span>&nbsp;<span class="num" id="5689753">6</span><span class="op" id="5689754">,</span>&nbsp;<span class="num" id="5689756">6</span><span class="op" id="5689757">,</span>&nbsp;<span class="num" id="5689759">6</span><span class="op" id="5689760">,</span>&nbsp;<span class="num" id="5689762">6</span><span class="op" id="5689763">,</span>&nbsp;<span class="num" id="5689765">6</span><span class="op" id="5689766">,</span>&nbsp;<span class="num" id="5689768">6</span><span class="op" id="5689769">,</span>&nbsp;<span class="num" id="5689771">6</span><span class="op" id="5689772">,</span>&nbsp;<span class="num" id="5689774">6</span><span class="op" id="5689775">,</span>&nbsp;<span class="num" id="5689777">6</span><span class="op" id="5689778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5689781">7</span><span class="op" id="5689782">,</span>&nbsp;<span class="num" id="5689784">7</span><span class="op" id="5689785">,</span>&nbsp;<span class="num" id="5689787">7</span><span class="op" id="5689788">,</span>&nbsp;<span class="num" id="5689790">7</span><span class="op" id="5689791">,</span>&nbsp;<span class="num" id="5689793">7</span><span class="op" id="5689794">,</span>&nbsp;<span class="num" id="5689796">7</span><span class="op" id="5689797">,</span>&nbsp;<span class="num" id="5689799">7</span><span class="op" id="5689800">,</span>&nbsp;<span class="num" id="5689802">7</span><span class="op" id="5689803">,</span>&nbsp;<span class="num" id="5689805">7</span><span class="op" id="5689806">,</span>&nbsp;<span class="num" id="5689808">7</span><span class="op" id="5689809">,</span>&nbsp;<span class="num" id="5689811">7</span><span class="op" id="5689812">,</span>&nbsp;<span class="num" id="5689814">7</span><span class="op" id="5689815">,</span>&nbsp;<span class="num" id="5689817">7</span><span class="op" id="5689818">,</span>&nbsp;<span class="num" id="5689820">7</span><span class="op" id="5689821">,</span>&nbsp;<span class="num" id="5689823">7</span><span class="op" id="5689824">,</span>&nbsp;<span class="num" id="5689826">7</span><span class="op" id="5689827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5689830">7</span><span class="op" id="5689831">,</span>&nbsp;<span class="num" id="5689833">7</span><span class="op" id="5689834">,</span>&nbsp;<span class="num" id="5689836">7</span><span class="op" id="5689837">,</span>&nbsp;<span class="num" id="5689839">7</span><span class="op" id="5689840">,</span>&nbsp;<span class="num" id="5689842">7</span><span class="op" id="5689843">,</span>&nbsp;<span class="num" id="5689845">7</span><span class="op" id="5689846">,</span>&nbsp;<span class="num" id="5689848">7</span><span class="op" id="5689849">,</span>&nbsp;<span class="num" id="5689851">7</span><span class="op" id="5689852">,</span>&nbsp;<span class="num" id="5689854">7</span><span class="op" id="5689855">,</span>&nbsp;<span class="num" id="5689857">7</span><span class="op" id="5689858">,</span>&nbsp;<span class="num" id="5689860">7</span><span class="op" id="5689861">,</span>&nbsp;<span class="num" id="5689863">7</span><span class="op" id="5689864">,</span>&nbsp;<span class="num" id="5689866">7</span><span class="op" id="5689867">,</span>&nbsp;<span class="num" id="5689869">7</span><span class="op" id="5689870">,</span>&nbsp;<span class="num" id="5689872">7</span><span class="op" id="5689873">,</span>&nbsp;<span class="num" id="5689875">7</span><span class="op" id="5689876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5689879">7</span><span class="op" id="5689880">,</span>&nbsp;<span class="num" id="5689882">7</span><span class="op" id="5689883">,</span>&nbsp;<span class="num" id="5689885">7</span><span class="op" id="5689886">,</span>&nbsp;<span class="num" id="5689888">7</span><span class="op" id="5689889">,</span>&nbsp;<span class="num" id="5689891">7</span><span class="op" id="5689892">,</span>&nbsp;<span class="num" id="5689894">7</span><span class="op" id="5689895">,</span>&nbsp;<span class="num" id="5689897">7</span><span class="op" id="5689898">,</span>&nbsp;<span class="num" id="5689900">7</span><span class="op" id="5689901">,</span>&nbsp;<span class="num" id="5689903">7</span><span class="op" id="5689904">,</span>&nbsp;<span class="num" id="5689906">7</span><span class="op" id="5689907">,</span>&nbsp;<span class="num" id="5689909">7</span><span class="op" id="5689910">,</span>&nbsp;<span class="num" id="5689912">7</span><span class="op" id="5689913">,</span>&nbsp;<span class="num" id="5689915">7</span><span class="op" id="5689916">,</span>&nbsp;<span class="num" id="5689918">7</span><span class="op" id="5689919">,</span>&nbsp;<span class="num" id="5689921">7</span><span class="op" id="5689922">,</span>&nbsp;<span class="num" id="5689924">7</span><span class="op" id="5689925">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5689928">7</span><span class="op" id="5689929">,</span>&nbsp;<span class="num" id="5689931">7</span><span class="op" id="5689932">,</span>&nbsp;<span class="num" id="5689934">7</span><span class="op" id="5689935">,</span>&nbsp;<span class="num" id="5689937">7</span><span class="op" id="5689938">,</span>&nbsp;<span class="num" id="5689940">7</span><span class="op" id="5689941">,</span>&nbsp;<span class="num" id="5689943">7</span><span class="op" id="5689944">,</span>&nbsp;<span class="num" id="5689946">7</span><span class="op" id="5689947">,</span>&nbsp;<span class="num" id="5689949">7</span><span class="op" id="5689950">,</span>&nbsp;<span class="num" id="5689952">7</span><span class="op" id="5689953">,</span>&nbsp;<span class="num" id="5689955">7</span><span class="op" id="5689956">,</span>&nbsp;<span class="num" id="5689958">7</span><span class="op" id="5689959">,</span>&nbsp;<span class="num" id="5689961">7</span><span class="op" id="5689962">,</span>&nbsp;<span class="num" id="5689964">7</span><span class="op" id="5689965">,</span>&nbsp;<span class="num" id="5689967">7</span><span class="op" id="5689968">,</span>&nbsp;<span class="num" id="5689970">7</span><span class="op" id="5689971">,</span>&nbsp;<span class="num" id="5689973">7</span><span class="op" id="5689974">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5689977">8</span><span class="op" id="5689978">,</span>&nbsp;<span class="num" id="5689980">8</span><span class="op" id="5689981">,</span>&nbsp;<span class="num" id="5689983">8</span><span class="op" id="5689984">,</span>&nbsp;<span class="num" id="5689986">8</span><span class="op" id="5689987">,</span>&nbsp;<span class="num" id="5689989">8</span><span class="op" id="5689990">,</span>&nbsp;<span class="num" id="5689992">8</span><span class="op" id="5689993">,</span>&nbsp;<span class="num" id="5689995">8</span><span class="op" id="5689996">,</span>&nbsp;<span class="num" id="5689998">8</span><span class="op" id="5689999">,</span>&nbsp;<span class="num" id="5690001">8</span><span class="op" id="5690002">,</span>&nbsp;<span class="num" id="5690004">8</span><span class="op" id="5690005">,</span>&nbsp;<span class="num" id="5690007">8</span><span class="op" id="5690008">,</span>&nbsp;<span class="num" id="5690010">8</span><span class="op" id="5690011">,</span>&nbsp;<span class="num" id="5690013">8</span><span class="op" id="5690014">,</span>&nbsp;<span class="num" id="5690016">8</span><span class="op" id="5690017">,</span>&nbsp;<span class="num" id="5690019">8</span><span class="op" id="5690020">,</span>&nbsp;<span class="num" id="5690022">8</span><span class="op" id="5690023">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5690026">8</span><span class="op" id="5690027">,</span>&nbsp;<span class="num" id="5690029">8</span><span class="op" id="5690030">,</span>&nbsp;<span class="num" id="5690032">8</span><span class="op" id="5690033">,</span>&nbsp;<span class="num" id="5690035">8</span><span class="op" id="5690036">,</span>&nbsp;<span class="num" id="5690038">8</span><span class="op" id="5690039">,</span>&nbsp;<span class="num" id="5690041">8</span><span class="op" id="5690042">,</span>&nbsp;<span class="num" id="5690044">8</span><span class="op" id="5690045">,</span>&nbsp;<span class="num" id="5690047">8</span><span class="op" id="5690048">,</span>&nbsp;<span class="num" id="5690050">8</span><span class="op" id="5690051">,</span>&nbsp;<span class="num" id="5690053">8</span><span class="op" id="5690054">,</span>&nbsp;<span class="num" id="5690056">8</span><span class="op" id="5690057">,</span>&nbsp;<span class="num" id="5690059">8</span><span class="op" id="5690060">,</span>&nbsp;<span class="num" id="5690062">8</span><span class="op" id="5690063">,</span>&nbsp;<span class="num" id="5690065">8</span><span class="op" id="5690066">,</span>&nbsp;<span class="num" id="5690068">8</span><span class="op" id="5690069">,</span>&nbsp;<span class="num" id="5690071">8</span><span class="op" id="5690072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5690075">8</span><span class="op" id="5690076">,</span>&nbsp;<span class="num" id="5690078">8</span><span class="op" id="5690079">,</span>&nbsp;<span class="num" id="5690081">8</span><span class="op" id="5690082">,</span>&nbsp;<span class="num" id="5690084">8</span><span class="op" id="5690085">,</span>&nbsp;<span class="num" id="5690087">8</span><span class="op" id="5690088">,</span>&nbsp;<span class="num" id="5690090">8</span><span class="op" id="5690091">,</span>&nbsp;<span class="num" id="5690093">8</span><span class="op" id="5690094">,</span>&nbsp;<span class="num" id="5690096">8</span><span class="op" id="5690097">,</span>&nbsp;<span class="num" id="5690099">8</span><span class="op" id="5690100">,</span>&nbsp;<span class="num" id="5690102">8</span><span class="op" id="5690103">,</span>&nbsp;<span class="num" id="5690105">8</span><span class="op" id="5690106">,</span>&nbsp;<span class="num" id="5690108">8</span><span class="op" id="5690109">,</span>&nbsp;<span class="num" id="5690111">8</span><span class="op" id="5690112">,</span>&nbsp;<span class="num" id="5690114">8</span><span class="op" id="5690115">,</span>&nbsp;<span class="num" id="5690117">8</span><span class="op" id="5690118">,</span>&nbsp;<span class="num" id="5690120">8</span><span class="op" id="5690121">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5690124">8</span><span class="op" id="5690125">,</span>&nbsp;<span class="num" id="5690127">8</span><span class="op" id="5690128">,</span>&nbsp;<span class="num" id="5690130">8</span><span class="op" id="5690131">,</span>&nbsp;<span class="num" id="5690133">8</span><span class="op" id="5690134">,</span>&nbsp;<span class="num" id="5690136">8</span><span class="op" id="5690137">,</span>&nbsp;<span class="num" id="5690139">8</span><span class="op" id="5690140">,</span>&nbsp;<span class="num" id="5690142">8</span><span class="op" id="5690143">,</span>&nbsp;<span class="num" id="5690145">8</span><span class="op" id="5690146">,</span>&nbsp;<span class="num" id="5690148">8</span><span class="op" id="5690149">,</span>&nbsp;<span class="num" id="5690151">8</span><span class="op" id="5690152">,</span>&nbsp;<span class="num" id="5690154">8</span><span class="op" id="5690155">,</span>&nbsp;<span class="num" id="5690157">8</span><span class="op" id="5690158">,</span>&nbsp;<span class="num" id="5690160">8</span><span class="op" id="5690161">,</span>&nbsp;<span class="num" id="5690163">8</span><span class="op" id="5690164">,</span>&nbsp;<span class="num" id="5690166">8</span><span class="op" id="5690167">,</span>&nbsp;<span class="num" id="5690169">8</span><span class="op" id="5690170">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5690173">8</span><span class="op" id="5690174">,</span>&nbsp;<span class="num" id="5690176">8</span><span class="op" id="5690177">,</span>&nbsp;<span class="num" id="5690179">8</span><span class="op" id="5690180">,</span>&nbsp;<span class="num" id="5690182">8</span><span class="op" id="5690183">,</span>&nbsp;<span class="num" id="5690185">8</span><span class="op" id="5690186">,</span>&nbsp;<span class="num" id="5690188">8</span><span class="op" id="5690189">,</span>&nbsp;<span class="num" id="5690191">8</span><span class="op" id="5690192">,</span>&nbsp;<span class="num" id="5690194">8</span><span class="op" id="5690195">,</span>&nbsp;<span class="num" id="5690197">8</span><span class="op" id="5690198">,</span>&nbsp;<span class="num" id="5690200">8</span><span class="op" id="5690201">,</span>&nbsp;<span class="num" id="5690203">8</span><span class="op" id="5690204">,</span>&nbsp;<span class="num" id="5690206">8</span><span class="op" id="5690207">,</span>&nbsp;<span class="num" id="5690209">8</span><span class="op" id="5690210">,</span>&nbsp;<span class="num" id="5690212">8</span><span class="op" id="5690213">,</span>&nbsp;<span class="num" id="5690215">8</span><span class="op" id="5690216">,</span>&nbsp;<span class="num" id="5690218">8</span><span class="op" id="5690219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5690222">8</span><span class="op" id="5690223">,</span>&nbsp;<span class="num" id="5690225">8</span><span class="op" id="5690226">,</span>&nbsp;<span class="num" id="5690228">8</span><span class="op" id="5690229">,</span>&nbsp;<span class="num" id="5690231">8</span><span class="op" id="5690232">,</span>&nbsp;<span class="num" id="5690234">8</span><span class="op" id="5690235">,</span>&nbsp;<span class="num" id="5690237">8</span><span class="op" id="5690238">,</span>&nbsp;<span class="num" id="5690240">8</span><span class="op" id="5690241">,</span>&nbsp;<span class="num" id="5690243">8</span><span class="op" id="5690244">,</span>&nbsp;<span class="num" id="5690246">8</span><span class="op" id="5690247">,</span>&nbsp;<span class="num" id="5690249">8</span><span class="op" id="5690250">,</span>&nbsp;<span class="num" id="5690252">8</span><span class="op" id="5690253">,</span>&nbsp;<span class="num" id="5690255">8</span><span class="op" id="5690256">,</span>&nbsp;<span class="num" id="5690258">8</span><span class="op" id="5690259">,</span>&nbsp;<span class="num" id="5690261">8</span><span class="op" id="5690262">,</span>&nbsp;<span class="num" id="5690264">8</span><span class="op" id="5690265">,</span>&nbsp;<span class="num" id="5690267">8</span><span class="op" id="5690268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5690271">8</span><span class="op" id="5690272">,</span>&nbsp;<span class="num" id="5690274">8</span><span class="op" id="5690275">,</span>&nbsp;<span class="num" id="5690277">8</span><span class="op" id="5690278">,</span>&nbsp;<span class="num" id="5690280">8</span><span class="op" id="5690281">,</span>&nbsp;<span class="num" id="5690283">8</span><span class="op" id="5690284">,</span>&nbsp;<span class="num" id="5690286">8</span><span class="op" id="5690287">,</span>&nbsp;<span class="num" id="5690289">8</span><span class="op" id="5690290">,</span>&nbsp;<span class="num" id="5690292">8</span><span class="op" id="5690293">,</span>&nbsp;<span class="num" id="5690295">8</span><span class="op" id="5690296">,</span>&nbsp;<span class="num" id="5690298">8</span><span class="op" id="5690299">,</span>&nbsp;<span class="num" id="5690301">8</span><span class="op" id="5690302">,</span>&nbsp;<span class="num" id="5690304">8</span><span class="op" id="5690305">,</span>&nbsp;<span class="num" id="5690307">8</span><span class="op" id="5690308">,</span>&nbsp;<span class="num" id="5690310">8</span><span class="op" id="5690311">,</span>&nbsp;<span class="num" id="5690313">8</span><span class="op" id="5690314">,</span>&nbsp;<span class="num" id="5690316">8</span><span class="op" id="5690317">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5690320">8</span><span class="op" id="5690321">,</span>&nbsp;<span class="num" id="5690323">8</span><span class="op" id="5690324">,</span>&nbsp;<span class="num" id="5690326">8</span><span class="op" id="5690327">,</span>&nbsp;<span class="num" id="5690329">8</span><span class="op" id="5690330">,</span>&nbsp;<span class="num" id="5690332">8</span><span class="op" id="5690333">,</span>&nbsp;<span class="num" id="5690335">8</span><span class="op" id="5690336">,</span>&nbsp;<span class="num" id="5690338">8</span><span class="op" id="5690339">,</span>&nbsp;<span class="num" id="5690341">8</span><span class="op" id="5690342">,</span>&nbsp;<span class="num" id="5690344">8</span><span class="op" id="5690345">,</span>&nbsp;<span class="num" id="5690347">8</span><span class="op" id="5690348">,</span>&nbsp;<span class="num" id="5690350">8</span><span class="op" id="5690351">,</span>&nbsp;<span class="num" id="5690353">8</span><span class="op" id="5690354">,</span>&nbsp;<span class="num" id="5690356">8</span><span class="op" id="5690357">,</span>&nbsp;<span class="num" id="5690359">8</span><span class="op" id="5690360">,</span>&nbsp;<span class="num" id="5690362">8</span><span class="op" id="5690363">,</span>&nbsp;<span class="num" id="5690365">8</span><span class="op" id="5690366">,</span><br>
<span class="lineno"></span><span class="op" id="5690368">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5690371">type</span>&nbsp;<span class="ident" id="5690376">quantIndex</span>&nbsp;<span class="builtintype" id="5690387">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5690392">const</span>&nbsp;<span class="op" id="5690398">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690401">quantIndexLuminance</span>&nbsp;<span class="ident" id="5690421">quantIndex</span>&nbsp;<span class="op" id="5690432">=</span>&nbsp;<span class="ident" id="5690434">iota</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690440">quantIndexChrominance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690463">nQuantIndex</span><br>
<span class="lineno"></span><span class="op" id="5690475">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5690478">//&nbsp;unscaledQuant&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;Each</span><br>
<span class="lineno">60</span><span class="comment" id="5690555">//&nbsp;encoder&nbsp;copies&nbsp;and&nbsp;scales&nbsp;the&nbsp;tables&nbsp;according&nbsp;to&nbsp;its&nbsp;quality&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="5690631">//&nbsp;The&nbsp;values&nbsp;are&nbsp;derived&nbsp;from&nbsp;section&nbsp;K.1&nbsp;after&nbsp;converting&nbsp;from&nbsp;natural&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5690707">//&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5690725">var</span>&nbsp;<span class="ident" id="5690729">unscaledQuant</span>&nbsp;<span class="op" id="5690743">=</span>&nbsp;<span class="op" id="5690745">[</span><span class="ident" id="5690746">nQuantIndex</span><span class="op" id="5690757">]</span><span class="op" id="5690758">[</span><span class="ident" id="5690759">blockSize</span><span class="op" id="5690768">]</span><span class="builtintype" id="5690769">byte</span><span class="op" id="5690773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5690776">//&nbsp;Luminance.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5690795">16</span><span class="op" id="5690797">,</span>&nbsp;<span class="num" id="5690799">11</span><span class="op" id="5690801">,</span>&nbsp;<span class="num" id="5690803">12</span><span class="op" id="5690805">,</span>&nbsp;<span class="num" id="5690807">14</span><span class="op" id="5690809">,</span>&nbsp;<span class="num" id="5690811">12</span><span class="op" id="5690813">,</span>&nbsp;<span class="num" id="5690815">10</span><span class="op" id="5690817">,</span>&nbsp;<span class="num" id="5690819">16</span><span class="op" id="5690821">,</span>&nbsp;<span class="num" id="5690823">14</span><span class="op" id="5690825">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5690829">13</span><span class="op" id="5690831">,</span>&nbsp;<span class="num" id="5690833">14</span><span class="op" id="5690835">,</span>&nbsp;<span class="num" id="5690837">18</span><span class="op" id="5690839">,</span>&nbsp;<span class="num" id="5690841">17</span><span class="op" id="5690843">,</span>&nbsp;<span class="num" id="5690845">16</span><span class="op" id="5690847">,</span>&nbsp;<span class="num" id="5690849">19</span><span class="op" id="5690851">,</span>&nbsp;<span class="num" id="5690853">24</span><span class="op" id="5690855">,</span>&nbsp;<span class="num" id="5690857">40</span><span class="op" id="5690859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5690863">26</span><span class="op" id="5690865">,</span>&nbsp;<span class="num" id="5690867">24</span><span class="op" id="5690869">,</span>&nbsp;<span class="num" id="5690871">22</span><span class="op" id="5690873">,</span>&nbsp;<span class="num" id="5690875">22</span><span class="op" id="5690877">,</span>&nbsp;<span class="num" id="5690879">24</span><span class="op" id="5690881">,</span>&nbsp;<span class="num" id="5690883">49</span><span class="op" id="5690885">,</span>&nbsp;<span class="num" id="5690887">35</span><span class="op" id="5690889">,</span>&nbsp;<span class="num" id="5690891">37</span><span class="op" id="5690893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5690897">29</span><span class="op" id="5690899">,</span>&nbsp;<span class="num" id="5690901">40</span><span class="op" id="5690903">,</span>&nbsp;<span class="num" id="5690905">58</span><span class="op" id="5690907">,</span>&nbsp;<span class="num" id="5690909">51</span><span class="op" id="5690911">,</span>&nbsp;<span class="num" id="5690913">61</span><span class="op" id="5690915">,</span>&nbsp;<span class="num" id="5690917">60</span><span class="op" id="5690919">,</span>&nbsp;<span class="num" id="5690921">57</span><span class="op" id="5690923">,</span>&nbsp;<span class="num" id="5690925">51</span><span class="op" id="5690927">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5690931">56</span><span class="op" id="5690933">,</span>&nbsp;<span class="num" id="5690935">55</span><span class="op" id="5690937">,</span>&nbsp;<span class="num" id="5690939">64</span><span class="op" id="5690941">,</span>&nbsp;<span class="num" id="5690943">72</span><span class="op" id="5690945">,</span>&nbsp;<span class="num" id="5690947">92</span><span class="op" id="5690949">,</span>&nbsp;<span class="num" id="5690951">78</span><span class="op" id="5690953">,</span>&nbsp;<span class="num" id="5690955">64</span><span class="op" id="5690957">,</span>&nbsp;<span class="num" id="5690959">68</span><span class="op" id="5690961">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5690965">87</span><span class="op" id="5690967">,</span>&nbsp;<span class="num" id="5690969">69</span><span class="op" id="5690971">,</span>&nbsp;<span class="num" id="5690973">55</span><span class="op" id="5690975">,</span>&nbsp;<span class="num" id="5690977">56</span><span class="op" id="5690979">,</span>&nbsp;<span class="num" id="5690981">80</span><span class="op" id="5690983">,</span>&nbsp;<span class="num" id="5690985">109</span><span class="op" id="5690988">,</span>&nbsp;<span class="num" id="5690990">81</span><span class="op" id="5690992">,</span>&nbsp;<span class="num" id="5690994">87</span><span class="op" id="5690996">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5691000">95</span><span class="op" id="5691002">,</span>&nbsp;<span class="num" id="5691004">98</span><span class="op" id="5691006">,</span>&nbsp;<span class="num" id="5691008">103</span><span class="op" id="5691011">,</span>&nbsp;<span class="num" id="5691013">104</span><span class="op" id="5691016">,</span>&nbsp;<span class="num" id="5691018">103</span><span class="op" id="5691021">,</span>&nbsp;<span class="num" id="5691023">62</span><span class="op" id="5691025">,</span>&nbsp;<span class="num" id="5691027">77</span><span class="op" id="5691029">,</span>&nbsp;<span class="num" id="5691031">113</span><span class="op" id="5691034">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5691038">121</span><span class="op" id="5691041">,</span>&nbsp;<span class="num" id="5691043">112</span><span class="op" id="5691046">,</span>&nbsp;<span class="num" id="5691048">100</span><span class="op" id="5691051">,</span>&nbsp;<span class="num" id="5691053">120</span><span class="op" id="5691056">,</span>&nbsp;<span class="num" id="5691058">92</span><span class="op" id="5691060">,</span>&nbsp;<span class="num" id="5691062">101</span><span class="op" id="5691065">,</span>&nbsp;<span class="num" id="5691067">103</span><span class="op" id="5691070">,</span>&nbsp;<span class="num" id="5691072">99</span><span class="op" id="5691074">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691077">}</span><span class="op" id="5691078">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5691081">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5691102">17</span><span class="op" id="5691104">,</span>&nbsp;<span class="num" id="5691106">18</span><span class="op" id="5691108">,</span>&nbsp;<span class="num" id="5691110">18</span><span class="op" id="5691112">,</span>&nbsp;<span class="num" id="5691114">24</span><span class="op" id="5691116">,</span>&nbsp;<span class="num" id="5691118">21</span><span class="op" id="5691120">,</span>&nbsp;<span class="num" id="5691122">24</span><span class="op" id="5691124">,</span>&nbsp;<span class="num" id="5691126">47</span><span class="op" id="5691128">,</span>&nbsp;<span class="num" id="5691130">26</span><span class="op" id="5691132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5691136">26</span><span class="op" id="5691138">,</span>&nbsp;<span class="num" id="5691140">47</span><span class="op" id="5691142">,</span>&nbsp;<span class="num" id="5691144">99</span><span class="op" id="5691146">,</span>&nbsp;<span class="num" id="5691148">66</span><span class="op" id="5691150">,</span>&nbsp;<span class="num" id="5691152">56</span><span class="op" id="5691154">,</span>&nbsp;<span class="num" id="5691156">66</span><span class="op" id="5691158">,</span>&nbsp;<span class="num" id="5691160">99</span><span class="op" id="5691162">,</span>&nbsp;<span class="num" id="5691164">99</span><span class="op" id="5691166">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5691170">99</span><span class="op" id="5691172">,</span>&nbsp;<span class="num" id="5691174">99</span><span class="op" id="5691176">,</span>&nbsp;<span class="num" id="5691178">99</span><span class="op" id="5691180">,</span>&nbsp;<span class="num" id="5691182">99</span><span class="op" id="5691184">,</span>&nbsp;<span class="num" id="5691186">99</span><span class="op" id="5691188">,</span>&nbsp;<span class="num" id="5691190">99</span><span class="op" id="5691192">,</span>&nbsp;<span class="num" id="5691194">99</span><span class="op" id="5691196">,</span>&nbsp;<span class="num" id="5691198">99</span><span class="op" id="5691200">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5691204">99</span><span class="op" id="5691206">,</span>&nbsp;<span class="num" id="5691208">99</span><span class="op" id="5691210">,</span>&nbsp;<span class="num" id="5691212">99</span><span class="op" id="5691214">,</span>&nbsp;<span class="num" id="5691216">99</span><span class="op" id="5691218">,</span>&nbsp;<span class="num" id="5691220">99</span><span class="op" id="5691222">,</span>&nbsp;<span class="num" id="5691224">99</span><span class="op" id="5691226">,</span>&nbsp;<span class="num" id="5691228">99</span><span class="op" id="5691230">,</span>&nbsp;<span class="num" id="5691232">99</span><span class="op" id="5691234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5691238">99</span><span class="op" id="5691240">,</span>&nbsp;<span class="num" id="5691242">99</span><span class="op" id="5691244">,</span>&nbsp;<span class="num" id="5691246">99</span><span class="op" id="5691248">,</span>&nbsp;<span class="num" id="5691250">99</span><span class="op" id="5691252">,</span>&nbsp;<span class="num" id="5691254">99</span><span class="op" id="5691256">,</span>&nbsp;<span class="num" id="5691258">99</span><span class="op" id="5691260">,</span>&nbsp;<span class="num" id="5691262">99</span><span class="op" id="5691264">,</span>&nbsp;<span class="num" id="5691266">99</span><span class="op" id="5691268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5691272">99</span><span class="op" id="5691274">,</span>&nbsp;<span class="num" id="5691276">99</span><span class="op" id="5691278">,</span>&nbsp;<span class="num" id="5691280">99</span><span class="op" id="5691282">,</span>&nbsp;<span class="num" id="5691284">99</span><span class="op" id="5691286">,</span>&nbsp;<span class="num" id="5691288">99</span><span class="op" id="5691290">,</span>&nbsp;<span class="num" id="5691292">99</span><span class="op" id="5691294">,</span>&nbsp;<span class="num" id="5691296">99</span><span class="op" id="5691298">,</span>&nbsp;<span class="num" id="5691300">99</span><span class="op" id="5691302">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5691306">99</span><span class="op" id="5691308">,</span>&nbsp;<span class="num" id="5691310">99</span><span class="op" id="5691312">,</span>&nbsp;<span class="num" id="5691314">99</span><span class="op" id="5691316">,</span>&nbsp;<span class="num" id="5691318">99</span><span class="op" id="5691320">,</span>&nbsp;<span class="num" id="5691322">99</span><span class="op" id="5691324">,</span>&nbsp;<span class="num" id="5691326">99</span><span class="op" id="5691328">,</span>&nbsp;<span class="num" id="5691330">99</span><span class="op" id="5691332">,</span>&nbsp;<span class="num" id="5691334">99</span><span class="op" id="5691336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5691340">99</span><span class="op" id="5691342">,</span>&nbsp;<span class="num" id="5691344">99</span><span class="op" id="5691346">,</span>&nbsp;<span class="num" id="5691348">99</span><span class="op" id="5691350">,</span>&nbsp;<span class="num" id="5691352">99</span><span class="op" id="5691354">,</span>&nbsp;<span class="num" id="5691356">99</span><span class="op" id="5691358">,</span>&nbsp;<span class="num" id="5691360">99</span><span class="op" id="5691362">,</span>&nbsp;<span class="num" id="5691364">99</span><span class="op" id="5691366">,</span>&nbsp;<span class="num" id="5691368">99</span><span class="op" id="5691370">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691373">}</span><span class="op" id="5691374">,</span><br>
<span class="lineno"></span><span class="op" id="5691376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5691379">type</span>&nbsp;<span class="ident" id="5691384">huffIndex</span>&nbsp;<span class="builtintype" id="5691394">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="5691399">const</span>&nbsp;<span class="op" id="5691405">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691408">huffIndexLuminanceDC</span>&nbsp;<span class="ident" id="5691429">huffIndex</span>&nbsp;<span class="op" id="5691439">=</span>&nbsp;<span class="ident" id="5691441">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691447">huffIndexLuminanceAC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691469">huffIndexChrominanceDC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691493">huffIndexChrominanceAC</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691517">nHuffIndex</span><br>
<span class="lineno"></span><span class="op" id="5691528">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5691531">//&nbsp;huffmanSpec&nbsp;specifies&nbsp;a&nbsp;Huffman&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5691576">type</span>&nbsp;<span class="ident" id="5691581">huffmanSpec</span>&nbsp;<span class="keyword" id="5691593">struct</span>&nbsp;<span class="op" id="5691600">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5691603">//&nbsp;count[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;length&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691657">count</span>&nbsp;<span class="op" id="5691663">[</span><span class="num" id="5691664">16</span><span class="op" id="5691666">]</span><span class="builtintype" id="5691667">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5691673">//&nbsp;value[i]&nbsp;is&nbsp;the&nbsp;decoded&nbsp;value&nbsp;of&nbsp;the&nbsp;i&#39;th&nbsp;codeword.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691729">value</span>&nbsp;<span class="op" id="5691735">[</span><span class="op" id="5691736">]</span><span class="builtintype" id="5691737">byte</span><br>
<span class="lineno"></span><span class="op" id="5691742">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="5691745">//&nbsp;theHuffmanSpec&nbsp;is&nbsp;the&nbsp;Huffman&nbsp;encoding&nbsp;specifications.</span><br>
<span class="lineno"></span><span class="comment" id="5691803">//&nbsp;This&nbsp;encoder&nbsp;uses&nbsp;the&nbsp;same&nbsp;Huffman&nbsp;encoding&nbsp;for&nbsp;all&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="5691866">var</span>&nbsp;<span class="ident" id="5691870">theHuffmanSpec</span>&nbsp;<span class="op" id="5691885">=</span>&nbsp;<span class="op" id="5691887">[</span><span class="ident" id="5691888">nHuffIndex</span><span class="op" id="5691898">]</span><span class="ident" id="5691899">huffmanSpec</span><span class="op" id="5691910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5691913">//&nbsp;Luminance&nbsp;DC.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691935">[</span><span class="num" id="5691936">16</span><span class="op" id="5691938">]</span><span class="builtintype" id="5691939">byte</span><span class="op" id="5691943">{</span><span class="num" id="5691944">0</span><span class="op" id="5691945">,</span>&nbsp;<span class="num" id="5691947">1</span><span class="op" id="5691948">,</span>&nbsp;<span class="num" id="5691950">5</span><span class="op" id="5691951">,</span>&nbsp;<span class="num" id="5691953">1</span><span class="op" id="5691954">,</span>&nbsp;<span class="num" id="5691956">1</span><span class="op" id="5691957">,</span>&nbsp;<span class="num" id="5691959">1</span><span class="op" id="5691960">,</span>&nbsp;<span class="num" id="5691962">1</span><span class="op" id="5691963">,</span>&nbsp;<span class="num" id="5691965">1</span><span class="op" id="5691966">,</span>&nbsp;<span class="num" id="5691968">1</span><span class="op" id="5691969">,</span>&nbsp;<span class="num" id="5691971">0</span><span class="op" id="5691972">,</span>&nbsp;<span class="num" id="5691974">0</span><span class="op" id="5691975">,</span>&nbsp;<span class="num" id="5691977">0</span><span class="op" id="5691978">,</span>&nbsp;<span class="num" id="5691980">0</span><span class="op" id="5691981">,</span>&nbsp;<span class="num" id="5691983">0</span><span class="op" id="5691984">,</span>&nbsp;<span class="num" id="5691986">0</span><span class="op" id="5691987">,</span>&nbsp;<span class="num" id="5691989">0</span><span class="op" id="5691990">}</span><span class="op" id="5691991">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691995">[</span><span class="op" id="5691996">]</span><span class="builtintype" id="5691997">byte</span><span class="op" id="5692001">{</span><span class="num" id="5692002">0</span><span class="op" id="5692003">,</span>&nbsp;<span class="num" id="5692005">1</span><span class="op" id="5692006">,</span>&nbsp;<span class="num" id="5692008">2</span><span class="op" id="5692009">,</span>&nbsp;<span class="num" id="5692011">3</span><span class="op" id="5692012">,</span>&nbsp;<span class="num" id="5692014">4</span><span class="op" id="5692015">,</span>&nbsp;<span class="num" id="5692017">5</span><span class="op" id="5692018">,</span>&nbsp;<span class="num" id="5692020">6</span><span class="op" id="5692021">,</span>&nbsp;<span class="num" id="5692023">7</span><span class="op" id="5692024">,</span>&nbsp;<span class="num" id="5692026">8</span><span class="op" id="5692027">,</span>&nbsp;<span class="num" id="5692029">9</span><span class="op" id="5692030">,</span>&nbsp;<span class="num" id="5692032">10</span><span class="op" id="5692034">,</span>&nbsp;<span class="num" id="5692036">11</span><span class="op" id="5692038">}</span><span class="op" id="5692039">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692042">}</span><span class="op" id="5692043">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5692046">//&nbsp;Luminance&nbsp;AC.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692068">[</span><span class="num" id="5692069">16</span><span class="op" id="5692071">]</span><span class="builtintype" id="5692072">byte</span><span class="op" id="5692076">{</span><span class="num" id="5692077">0</span><span class="op" id="5692078">,</span>&nbsp;<span class="num" id="5692080">2</span><span class="op" id="5692081">,</span>&nbsp;<span class="num" id="5692083">1</span><span class="op" id="5692084">,</span>&nbsp;<span class="num" id="5692086">3</span><span class="op" id="5692087">,</span>&nbsp;<span class="num" id="5692089">3</span><span class="op" id="5692090">,</span>&nbsp;<span class="num" id="5692092">2</span><span class="op" id="5692093">,</span>&nbsp;<span class="num" id="5692095">4</span><span class="op" id="5692096">,</span>&nbsp;<span class="num" id="5692098">3</span><span class="op" id="5692099">,</span>&nbsp;<span class="num" id="5692101">5</span><span class="op" id="5692102">,</span>&nbsp;<span class="num" id="5692104">5</span><span class="op" id="5692105">,</span>&nbsp;<span class="num" id="5692107">4</span><span class="op" id="5692108">,</span>&nbsp;<span class="num" id="5692110">4</span><span class="op" id="5692111">,</span>&nbsp;<span class="num" id="5692113">0</span><span class="op" id="5692114">,</span>&nbsp;<span class="num" id="5692116">0</span><span class="op" id="5692117">,</span>&nbsp;<span class="num" id="5692119">1</span><span class="op" id="5692120">,</span>&nbsp;<span class="num" id="5692122">125</span><span class="op" id="5692125">}</span><span class="op" id="5692126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692130">[</span><span class="op" id="5692131">]</span><span class="builtintype" id="5692132">byte</span><span class="op" id="5692136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5692141">0x01</span><span class="op" id="5692145">,</span>&nbsp;<span class="num" id="5692147">0x02</span><span class="op" id="5692151">,</span>&nbsp;<span class="num" id="5692153">0x03</span><span class="op" id="5692157">,</span>&nbsp;<span class="num" id="5692159">0x00</span><span class="op" id="5692163">,</span>&nbsp;<span class="num" id="5692165">0x04</span><span class="op" id="5692169">,</span>&nbsp;<span class="num" id="5692171">0x11</span><span class="op" id="5692175">,</span>&nbsp;<span class="num" id="5692177">0x05</span><span class="op" id="5692181">,</span>&nbsp;<span class="num" id="5692183">0x12</span><span class="op" id="5692187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5692192">0x21</span><span class="op" id="5692196">,</span>&nbsp;<span class="num" id="5692198">0x31</span><span class="op" id="5692202">,</span>&nbsp;<span class="num" id="5692204">0x41</span><span class="op" id="5692208">,</span>&nbsp;<span class="num" id="5692210">0x06</span><span class="op" id="5692214">,</span>&nbsp;<span class="num" id="5692216">0x13</span><span class="op" id="5692220">,</span>&nbsp;<span class="num" id="5692222">0x51</span><span class="op" id="5692226">,</span>&nbsp;<span class="num" id="5692228">0x61</span><span class="op" id="5692232">,</span>&nbsp;<span class="num" id="5692234">0x07</span><span class="op" id="5692238">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5692243">0x22</span><span class="op" id="5692247">,</span>&nbsp;<span class="num" id="5692249">0x71</span><span class="op" id="5692253">,</span>&nbsp;<span class="num" id="5692255">0x14</span><span class="op" id="5692259">,</span>&nbsp;<span class="num" id="5692261">0x32</span><span class="op" id="5692265">,</span>&nbsp;<span class="num" id="5692267">0x81</span><span class="op" id="5692271">,</span>&nbsp;<span class="num" id="5692273">0x91</span><span class="op" id="5692277">,</span>&nbsp;<span class="num" id="5692279">0xa1</span><span class="op" id="5692283">,</span>&nbsp;<span class="num" id="5692285">0x08</span><span class="op" id="5692289">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5692294">0x23</span><span class="op" id="5692298">,</span>&nbsp;<span class="num" id="5692300">0x42</span><span class="op" id="5692304">,</span>&nbsp;<span class="num" id="5692306">0xb1</span><span class="op" id="5692310">,</span>&nbsp;<span class="num" id="5692312">0xc1</span><span class="op" id="5692316">,</span>&nbsp;<span class="num" id="5692318">0x15</span><span class="op" id="5692322">,</span>&nbsp;<span class="num" id="5692324">0x52</span><span class="op" id="5692328">,</span>&nbsp;<span class="num" id="5692330">0xd1</span><span class="op" id="5692334">,</span>&nbsp;<span class="num" id="5692336">0xf0</span><span class="op" id="5692340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5692345">0x24</span><span class="op" id="5692349">,</span>&nbsp;<span class="num" id="5692351">0x33</span><span class="op" id="5692355">,</span>&nbsp;<span class="num" id="5692357">0x62</span><span class="op" id="5692361">,</span>&nbsp;<span class="num" id="5692363">0x72</span><span class="op" id="5692367">,</span>&nbsp;<span class="num" id="5692369">0x82</span><span class="op" id="5692373">,</span>&nbsp;<span class="num" id="5692375">0x09</span><span class="op" id="5692379">,</span>&nbsp;<span class="num" id="5692381">0x0a</span><span class="op" id="5692385">,</span>&nbsp;<span class="num" id="5692387">0x16</span><span class="op" id="5692391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5692396">0x17</span><span class="op" id="5692400">,</span>&nbsp;<span class="num" id="5692402">0x18</span><span class="op" id="5692406">,</span>&nbsp;<span class="num" id="5692408">0x19</span><span class="op" id="5692412">,</span>&nbsp;<span class="num" id="5692414">0x1a</span><span class="op" id="5692418">,</span>&nbsp;<span class="num" id="5692420">0x25</span><span class="op" id="5692424">,</span>&nbsp;<span class="num" id="5692426">0x26</span><span class="op" id="5692430">,</span>&nbsp;<span class="num" id="5692432">0x27</span><span class="op" id="5692436">,</span>&nbsp;<span class="num" id="5692438">0x28</span><span class="op" id="5692442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5692447">0x29</span><span class="op" id="5692451">,</span>&nbsp;<span class="num" id="5692453">0x2a</span><span class="op" id="5692457">,</span>&nbsp;<span class="num" id="5692459">0x34</span><span class="op" id="5692463">,</span>&nbsp;<span class="num" id="5692465">0x35</span><span class="op" id="5692469">,</span>&nbsp;<span class="num" id="5692471">0x36</span><span class="op" id="5692475">,</span>&nbsp;<span class="num" id="5692477">0x37</span><span class="op" id="5692481">,</span>&nbsp;<span class="num" id="5692483">0x38</span><span class="op" id="5692487">,</span>&nbsp;<span class="num" id="5692489">0x39</span><span class="op" id="5692493">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5692498">0x3a</span><span class="op" id="5692502">,</span>&nbsp;<span class="num" id="5692504">0x43</span><span class="op" id="5692508">,</span>&nbsp;<span class="num" id="5692510">0x44</span><span class="op" id="5692514">,</span>&nbsp;<span class="num" id="5692516">0x45</span><span class="op" id="5692520">,</span>&nbsp;<span class="num" id="5692522">0x46</span><span class="op" id="5692526">,</span>&nbsp;<span class="num" id="5692528">0x47</span><span class="op" id="5692532">,</span>&nbsp;<span class="num" id="5692534">0x48</span><span class="op" id="5692538">,</span>&nbsp;<span class="num" id="5692540">0x49</span><span class="op" id="5692544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5692549">0x4a</span><span class="op" id="5692553">,</span>&nbsp;<span class="num" id="5692555">0x53</span><span class="op" id="5692559">,</span>&nbsp;<span class="num" id="5692561">0x54</span><span class="op" id="5692565">,</span>&nbsp;<span class="num" id="5692567">0x55</span><span class="op" id="5692571">,</span>&nbsp;<span class="num" id="5692573">0x56</span><span class="op" id="5692577">,</span>&nbsp;<span class="num" id="5692579">0x57</span><span class="op" id="5692583">,</span>&nbsp;<span class="num" id="5692585">0x58</span><span class="op" id="5692589">,</span>&nbsp;<span class="num" id="5692591">0x59</span><span class="op" id="5692595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5692600">0x5a</span><span class="op" id="5692604">,</span>&nbsp;<span class="num" id="5692606">0x63</span><span class="op" id="5692610">,</span>&nbsp;<span class="num" id="5692612">0x64</span><span class="op" id="5692616">,</span>&nbsp;<span class="num" id="5692618">0x65</span><span class="op" id="5692622">,</span>&nbsp;<span class="num" id="5692624">0x66</span><span class="op" id="5692628">,</span>&nbsp;<span class="num" id="5692630">0x67</span><span class="op" id="5692634">,</span>&nbsp;<span class="num" id="5692636">0x68</span><span class="op" id="5692640">,</span>&nbsp;<span class="num" id="5692642">0x69</span><span class="op" id="5692646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5692651">0x6a</span><span class="op" id="5692655">,</span>&nbsp;<span class="num" id="5692657">0x73</span><span class="op" id="5692661">,</span>&nbsp;<span class="num" id="5692663">0x74</span><span class="op" id="5692667">,</span>&nbsp;<span class="num" id="5692669">0x75</span><span class="op" id="5692673">,</span>&nbsp;<span class="num" id="5692675">0x76</span><span class="op" id="5692679">,</span>&nbsp;<span class="num" id="5692681">0x77</span><span class="op" id="5692685">,</span>&nbsp;<span class="num" id="5692687">0x78</span><span class="op" id="5692691">,</span>&nbsp;<span class="num" id="5692693">0x79</span><span class="op" id="5692697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5692702">0x7a</span><span class="op" id="5692706">,</span>&nbsp;<span class="num" id="5692708">0x83</span><span class="op" id="5692712">,</span>&nbsp;<span class="num" id="5692714">0x84</span><span class="op" id="5692718">,</span>&nbsp;<span class="num" id="5692720">0x85</span><span class="op" id="5692724">,</span>&nbsp;<span class="num" id="5692726">0x86</span><span class="op" id="5692730">,</span>&nbsp;<span class="num" id="5692732">0x87</span><span class="op" id="5692736">,</span>&nbsp;<span class="num" id="5692738">0x88</span><span class="op" id="5692742">,</span>&nbsp;<span class="num" id="5692744">0x89</span><span class="op" id="5692748">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5692753">0x8a</span><span class="op" id="5692757">,</span>&nbsp;<span class="num" id="5692759">0x92</span><span class="op" id="5692763">,</span>&nbsp;<span class="num" id="5692765">0x93</span><span class="op" id="5692769">,</span>&nbsp;<span class="num" id="5692771">0x94</span><span class="op" id="5692775">,</span>&nbsp;<span class="num" id="5692777">0x95</span><span class="op" id="5692781">,</span>&nbsp;<span class="num" id="5692783">0x96</span><span class="op" id="5692787">,</span>&nbsp;<span class="num" id="5692789">0x97</span><span class="op" id="5692793">,</span>&nbsp;<span class="num" id="5692795">0x98</span><span class="op" id="5692799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5692804">0x99</span><span class="op" id="5692808">,</span>&nbsp;<span class="num" id="5692810">0x9a</span><span class="op" id="5692814">,</span>&nbsp;<span class="num" id="5692816">0xa2</span><span class="op" id="5692820">,</span>&nbsp;<span class="num" id="5692822">0xa3</span><span class="op" id="5692826">,</span>&nbsp;<span class="num" id="5692828">0xa4</span><span class="op" id="5692832">,</span>&nbsp;<span class="num" id="5692834">0xa5</span><span class="op" id="5692838">,</span>&nbsp;<span class="num" id="5692840">0xa6</span><span class="op" id="5692844">,</span>&nbsp;<span class="num" id="5692846">0xa7</span><span class="op" id="5692850">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5692855">0xa8</span><span class="op" id="5692859">,</span>&nbsp;<span class="num" id="5692861">0xa9</span><span class="op" id="5692865">,</span>&nbsp;<span class="num" id="5692867">0xaa</span><span class="op" id="5692871">,</span>&nbsp;<span class="num" id="5692873">0xb2</span><span class="op" id="5692877">,</span>&nbsp;<span class="num" id="5692879">0xb3</span><span class="op" id="5692883">,</span>&nbsp;<span class="num" id="5692885">0xb4</span><span class="op" id="5692889">,</span>&nbsp;<span class="num" id="5692891">0xb5</span><span class="op" id="5692895">,</span>&nbsp;<span class="num" id="5692897">0xb6</span><span class="op" id="5692901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5692906">0xb7</span><span class="op" id="5692910">,</span>&nbsp;<span class="num" id="5692912">0xb8</span><span class="op" id="5692916">,</span>&nbsp;<span class="num" id="5692918">0xb9</span><span class="op" id="5692922">,</span>&nbsp;<span class="num" id="5692924">0xba</span><span class="op" id="5692928">,</span>&nbsp;<span class="num" id="5692930">0xc2</span><span class="op" id="5692934">,</span>&nbsp;<span class="num" id="5692936">0xc3</span><span class="op" id="5692940">,</span>&nbsp;<span class="num" id="5692942">0xc4</span><span class="op" id="5692946">,</span>&nbsp;<span class="num" id="5692948">0xc5</span><span class="op" id="5692952">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5692957">0xc6</span><span class="op" id="5692961">,</span>&nbsp;<span class="num" id="5692963">0xc7</span><span class="op" id="5692967">,</span>&nbsp;<span class="num" id="5692969">0xc8</span><span class="op" id="5692973">,</span>&nbsp;<span class="num" id="5692975">0xc9</span><span class="op" id="5692979">,</span>&nbsp;<span class="num" id="5692981">0xca</span><span class="op" id="5692985">,</span>&nbsp;<span class="num" id="5692987">0xd2</span><span class="op" id="5692991">,</span>&nbsp;<span class="num" id="5692993">0xd3</span><span class="op" id="5692997">,</span>&nbsp;<span class="num" id="5692999">0xd4</span><span class="op" id="5693003">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5693008">0xd5</span><span class="op" id="5693012">,</span>&nbsp;<span class="num" id="5693014">0xd6</span><span class="op" id="5693018">,</span>&nbsp;<span class="num" id="5693020">0xd7</span><span class="op" id="5693024">,</span>&nbsp;<span class="num" id="5693026">0xd8</span><span class="op" id="5693030">,</span>&nbsp;<span class="num" id="5693032">0xd9</span><span class="op" id="5693036">,</span>&nbsp;<span class="num" id="5693038">0xda</span><span class="op" id="5693042">,</span>&nbsp;<span class="num" id="5693044">0xe1</span><span class="op" id="5693048">,</span>&nbsp;<span class="num" id="5693050">0xe2</span><span class="op" id="5693054">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5693059">0xe3</span><span class="op" id="5693063">,</span>&nbsp;<span class="num" id="5693065">0xe4</span><span class="op" id="5693069">,</span>&nbsp;<span class="num" id="5693071">0xe5</span><span class="op" id="5693075">,</span>&nbsp;<span class="num" id="5693077">0xe6</span><span class="op" id="5693081">,</span>&nbsp;<span class="num" id="5693083">0xe7</span><span class="op" id="5693087">,</span>&nbsp;<span class="num" id="5693089">0xe8</span><span class="op" id="5693093">,</span>&nbsp;<span class="num" id="5693095">0xe9</span><span class="op" id="5693099">,</span>&nbsp;<span class="num" id="5693101">0xea</span><span class="op" id="5693105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5693110">0xf1</span><span class="op" id="5693114">,</span>&nbsp;<span class="num" id="5693116">0xf2</span><span class="op" id="5693120">,</span>&nbsp;<span class="num" id="5693122">0xf3</span><span class="op" id="5693126">,</span>&nbsp;<span class="num" id="5693128">0xf4</span><span class="op" id="5693132">,</span>&nbsp;<span class="num" id="5693134">0xf5</span><span class="op" id="5693138">,</span>&nbsp;<span class="num" id="5693140">0xf6</span><span class="op" id="5693144">,</span>&nbsp;<span class="num" id="5693146">0xf7</span><span class="op" id="5693150">,</span>&nbsp;<span class="num" id="5693152">0xf8</span><span class="op" id="5693156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5693161">0xf9</span><span class="op" id="5693165">,</span>&nbsp;<span class="num" id="5693167">0xfa</span><span class="op" id="5693171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693175">}</span><span class="op" id="5693176">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693179">}</span><span class="op" id="5693180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5693183">//&nbsp;Chrominance&nbsp;DC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693207">[</span><span class="num" id="5693208">16</span><span class="op" id="5693210">]</span><span class="builtintype" id="5693211">byte</span><span class="op" id="5693215">{</span><span class="num" id="5693216">0</span><span class="op" id="5693217">,</span>&nbsp;<span class="num" id="5693219">3</span><span class="op" id="5693220">,</span>&nbsp;<span class="num" id="5693222">1</span><span class="op" id="5693223">,</span>&nbsp;<span class="num" id="5693225">1</span><span class="op" id="5693226">,</span>&nbsp;<span class="num" id="5693228">1</span><span class="op" id="5693229">,</span>&nbsp;<span class="num" id="5693231">1</span><span class="op" id="5693232">,</span>&nbsp;<span class="num" id="5693234">1</span><span class="op" id="5693235">,</span>&nbsp;<span class="num" id="5693237">1</span><span class="op" id="5693238">,</span>&nbsp;<span class="num" id="5693240">1</span><span class="op" id="5693241">,</span>&nbsp;<span class="num" id="5693243">1</span><span class="op" id="5693244">,</span>&nbsp;<span class="num" id="5693246">1</span><span class="op" id="5693247">,</span>&nbsp;<span class="num" id="5693249">0</span><span class="op" id="5693250">,</span>&nbsp;<span class="num" id="5693252">0</span><span class="op" id="5693253">,</span>&nbsp;<span class="num" id="5693255">0</span><span class="op" id="5693256">,</span>&nbsp;<span class="num" id="5693258">0</span><span class="op" id="5693259">,</span>&nbsp;<span class="num" id="5693261">0</span><span class="op" id="5693262">}</span><span class="op" id="5693263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693267">[</span><span class="op" id="5693268">]</span><span class="builtintype" id="5693269">byte</span><span class="op" id="5693273">{</span><span class="num" id="5693274">0</span><span class="op" id="5693275">,</span>&nbsp;<span class="num" id="5693277">1</span><span class="op" id="5693278">,</span>&nbsp;<span class="num" id="5693280">2</span><span class="op" id="5693281">,</span>&nbsp;<span class="num" id="5693283">3</span><span class="op" id="5693284">,</span>&nbsp;<span class="num" id="5693286">4</span><span class="op" id="5693287">,</span>&nbsp;<span class="num" id="5693289">5</span><span class="op" id="5693290">,</span>&nbsp;<span class="num" id="5693292">6</span><span class="op" id="5693293">,</span>&nbsp;<span class="num" id="5693295">7</span><span class="op" id="5693296">,</span>&nbsp;<span class="num" id="5693298">8</span><span class="op" id="5693299">,</span>&nbsp;<span class="num" id="5693301">9</span><span class="op" id="5693302">,</span>&nbsp;<span class="num" id="5693304">10</span><span class="op" id="5693306">,</span>&nbsp;<span class="num" id="5693308">11</span><span class="op" id="5693310">}</span><span class="op" id="5693311">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693314">}</span><span class="op" id="5693315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5693318">//&nbsp;Chrominance&nbsp;AC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693342">[</span><span class="num" id="5693343">16</span><span class="op" id="5693345">]</span><span class="builtintype" id="5693346">byte</span><span class="op" id="5693350">{</span><span class="num" id="5693351">0</span><span class="op" id="5693352">,</span>&nbsp;<span class="num" id="5693354">2</span><span class="op" id="5693355">,</span>&nbsp;<span class="num" id="5693357">1</span><span class="op" id="5693358">,</span>&nbsp;<span class="num" id="5693360">2</span><span class="op" id="5693361">,</span>&nbsp;<span class="num" id="5693363">4</span><span class="op" id="5693364">,</span>&nbsp;<span class="num" id="5693366">4</span><span class="op" id="5693367">,</span>&nbsp;<span class="num" id="5693369">3</span><span class="op" id="5693370">,</span>&nbsp;<span class="num" id="5693372">4</span><span class="op" id="5693373">,</span>&nbsp;<span class="num" id="5693375">7</span><span class="op" id="5693376">,</span>&nbsp;<span class="num" id="5693378">5</span><span class="op" id="5693379">,</span>&nbsp;<span class="num" id="5693381">4</span><span class="op" id="5693382">,</span>&nbsp;<span class="num" id="5693384">4</span><span class="op" id="5693385">,</span>&nbsp;<span class="num" id="5693387">0</span><span class="op" id="5693388">,</span>&nbsp;<span class="num" id="5693390">1</span><span class="op" id="5693391">,</span>&nbsp;<span class="num" id="5693393">2</span><span class="op" id="5693394">,</span>&nbsp;<span class="num" id="5693396">119</span><span class="op" id="5693399">}</span><span class="op" id="5693400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693404">[</span><span class="op" id="5693405">]</span><span class="builtintype" id="5693406">byte</span><span class="op" id="5693410">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5693415">0x00</span><span class="op" id="5693419">,</span>&nbsp;<span class="num" id="5693421">0x01</span><span class="op" id="5693425">,</span>&nbsp;<span class="num" id="5693427">0x02</span><span class="op" id="5693431">,</span>&nbsp;<span class="num" id="5693433">0x03</span><span class="op" id="5693437">,</span>&nbsp;<span class="num" id="5693439">0x11</span><span class="op" id="5693443">,</span>&nbsp;<span class="num" id="5693445">0x04</span><span class="op" id="5693449">,</span>&nbsp;<span class="num" id="5693451">0x05</span><span class="op" id="5693455">,</span>&nbsp;<span class="num" id="5693457">0x21</span><span class="op" id="5693461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5693466">0x31</span><span class="op" id="5693470">,</span>&nbsp;<span class="num" id="5693472">0x06</span><span class="op" id="5693476">,</span>&nbsp;<span class="num" id="5693478">0x12</span><span class="op" id="5693482">,</span>&nbsp;<span class="num" id="5693484">0x41</span><span class="op" id="5693488">,</span>&nbsp;<span class="num" id="5693490">0x51</span><span class="op" id="5693494">,</span>&nbsp;<span class="num" id="5693496">0x07</span><span class="op" id="5693500">,</span>&nbsp;<span class="num" id="5693502">0x61</span><span class="op" id="5693506">,</span>&nbsp;<span class="num" id="5693508">0x71</span><span class="op" id="5693512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5693517">0x13</span><span class="op" id="5693521">,</span>&nbsp;<span class="num" id="5693523">0x22</span><span class="op" id="5693527">,</span>&nbsp;<span class="num" id="5693529">0x32</span><span class="op" id="5693533">,</span>&nbsp;<span class="num" id="5693535">0x81</span><span class="op" id="5693539">,</span>&nbsp;<span class="num" id="5693541">0x08</span><span class="op" id="5693545">,</span>&nbsp;<span class="num" id="5693547">0x14</span><span class="op" id="5693551">,</span>&nbsp;<span class="num" id="5693553">0x42</span><span class="op" id="5693557">,</span>&nbsp;<span class="num" id="5693559">0x91</span><span class="op" id="5693563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5693568">0xa1</span><span class="op" id="5693572">,</span>&nbsp;<span class="num" id="5693574">0xb1</span><span class="op" id="5693578">,</span>&nbsp;<span class="num" id="5693580">0xc1</span><span class="op" id="5693584">,</span>&nbsp;<span class="num" id="5693586">0x09</span><span class="op" id="5693590">,</span>&nbsp;<span class="num" id="5693592">0x23</span><span class="op" id="5693596">,</span>&nbsp;<span class="num" id="5693598">0x33</span><span class="op" id="5693602">,</span>&nbsp;<span class="num" id="5693604">0x52</span><span class="op" id="5693608">,</span>&nbsp;<span class="num" id="5693610">0xf0</span><span class="op" id="5693614">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5693619">0x15</span><span class="op" id="5693623">,</span>&nbsp;<span class="num" id="5693625">0x62</span><span class="op" id="5693629">,</span>&nbsp;<span class="num" id="5693631">0x72</span><span class="op" id="5693635">,</span>&nbsp;<span class="num" id="5693637">0xd1</span><span class="op" id="5693641">,</span>&nbsp;<span class="num" id="5693643">0x0a</span><span class="op" id="5693647">,</span>&nbsp;<span class="num" id="5693649">0x16</span><span class="op" id="5693653">,</span>&nbsp;<span class="num" id="5693655">0x24</span><span class="op" id="5693659">,</span>&nbsp;<span class="num" id="5693661">0x34</span><span class="op" id="5693665">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5693670">0xe1</span><span class="op" id="5693674">,</span>&nbsp;<span class="num" id="5693676">0x25</span><span class="op" id="5693680">,</span>&nbsp;<span class="num" id="5693682">0xf1</span><span class="op" id="5693686">,</span>&nbsp;<span class="num" id="5693688">0x17</span><span class="op" id="5693692">,</span>&nbsp;<span class="num" id="5693694">0x18</span><span class="op" id="5693698">,</span>&nbsp;<span class="num" id="5693700">0x19</span><span class="op" id="5693704">,</span>&nbsp;<span class="num" id="5693706">0x1a</span><span class="op" id="5693710">,</span>&nbsp;<span class="num" id="5693712">0x26</span><span class="op" id="5693716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5693721">0x27</span><span class="op" id="5693725">,</span>&nbsp;<span class="num" id="5693727">0x28</span><span class="op" id="5693731">,</span>&nbsp;<span class="num" id="5693733">0x29</span><span class="op" id="5693737">,</span>&nbsp;<span class="num" id="5693739">0x2a</span><span class="op" id="5693743">,</span>&nbsp;<span class="num" id="5693745">0x35</span><span class="op" id="5693749">,</span>&nbsp;<span class="num" id="5693751">0x36</span><span class="op" id="5693755">,</span>&nbsp;<span class="num" id="5693757">0x37</span><span class="op" id="5693761">,</span>&nbsp;<span class="num" id="5693763">0x38</span><span class="op" id="5693767">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5693772">0x39</span><span class="op" id="5693776">,</span>&nbsp;<span class="num" id="5693778">0x3a</span><span class="op" id="5693782">,</span>&nbsp;<span class="num" id="5693784">0x43</span><span class="op" id="5693788">,</span>&nbsp;<span class="num" id="5693790">0x44</span><span class="op" id="5693794">,</span>&nbsp;<span class="num" id="5693796">0x45</span><span class="op" id="5693800">,</span>&nbsp;<span class="num" id="5693802">0x46</span><span class="op" id="5693806">,</span>&nbsp;<span class="num" id="5693808">0x47</span><span class="op" id="5693812">,</span>&nbsp;<span class="num" id="5693814">0x48</span><span class="op" id="5693818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5693823">0x49</span><span class="op" id="5693827">,</span>&nbsp;<span class="num" id="5693829">0x4a</span><span class="op" id="5693833">,</span>&nbsp;<span class="num" id="5693835">0x53</span><span class="op" id="5693839">,</span>&nbsp;<span class="num" id="5693841">0x54</span><span class="op" id="5693845">,</span>&nbsp;<span class="num" id="5693847">0x55</span><span class="op" id="5693851">,</span>&nbsp;<span class="num" id="5693853">0x56</span><span class="op" id="5693857">,</span>&nbsp;<span class="num" id="5693859">0x57</span><span class="op" id="5693863">,</span>&nbsp;<span class="num" id="5693865">0x58</span><span class="op" id="5693869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5693874">0x59</span><span class="op" id="5693878">,</span>&nbsp;<span class="num" id="5693880">0x5a</span><span class="op" id="5693884">,</span>&nbsp;<span class="num" id="5693886">0x63</span><span class="op" id="5693890">,</span>&nbsp;<span class="num" id="5693892">0x64</span><span class="op" id="5693896">,</span>&nbsp;<span class="num" id="5693898">0x65</span><span class="op" id="5693902">,</span>&nbsp;<span class="num" id="5693904">0x66</span><span class="op" id="5693908">,</span>&nbsp;<span class="num" id="5693910">0x67</span><span class="op" id="5693914">,</span>&nbsp;<span class="num" id="5693916">0x68</span><span class="op" id="5693920">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5693925">0x69</span><span class="op" id="5693929">,</span>&nbsp;<span class="num" id="5693931">0x6a</span><span class="op" id="5693935">,</span>&nbsp;<span class="num" id="5693937">0x73</span><span class="op" id="5693941">,</span>&nbsp;<span class="num" id="5693943">0x74</span><span class="op" id="5693947">,</span>&nbsp;<span class="num" id="5693949">0x75</span><span class="op" id="5693953">,</span>&nbsp;<span class="num" id="5693955">0x76</span><span class="op" id="5693959">,</span>&nbsp;<span class="num" id="5693961">0x77</span><span class="op" id="5693965">,</span>&nbsp;<span class="num" id="5693967">0x78</span><span class="op" id="5693971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5693976">0x79</span><span class="op" id="5693980">,</span>&nbsp;<span class="num" id="5693982">0x7a</span><span class="op" id="5693986">,</span>&nbsp;<span class="num" id="5693988">0x82</span><span class="op" id="5693992">,</span>&nbsp;<span class="num" id="5693994">0x83</span><span class="op" id="5693998">,</span>&nbsp;<span class="num" id="5694000">0x84</span><span class="op" id="5694004">,</span>&nbsp;<span class="num" id="5694006">0x85</span><span class="op" id="5694010">,</span>&nbsp;<span class="num" id="5694012">0x86</span><span class="op" id="5694016">,</span>&nbsp;<span class="num" id="5694018">0x87</span><span class="op" id="5694022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5694027">0x88</span><span class="op" id="5694031">,</span>&nbsp;<span class="num" id="5694033">0x89</span><span class="op" id="5694037">,</span>&nbsp;<span class="num" id="5694039">0x8a</span><span class="op" id="5694043">,</span>&nbsp;<span class="num" id="5694045">0x92</span><span class="op" id="5694049">,</span>&nbsp;<span class="num" id="5694051">0x93</span><span class="op" id="5694055">,</span>&nbsp;<span class="num" id="5694057">0x94</span><span class="op" id="5694061">,</span>&nbsp;<span class="num" id="5694063">0x95</span><span class="op" id="5694067">,</span>&nbsp;<span class="num" id="5694069">0x96</span><span class="op" id="5694073">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5694078">0x97</span><span class="op" id="5694082">,</span>&nbsp;<span class="num" id="5694084">0x98</span><span class="op" id="5694088">,</span>&nbsp;<span class="num" id="5694090">0x99</span><span class="op" id="5694094">,</span>&nbsp;<span class="num" id="5694096">0x9a</span><span class="op" id="5694100">,</span>&nbsp;<span class="num" id="5694102">0xa2</span><span class="op" id="5694106">,</span>&nbsp;<span class="num" id="5694108">0xa3</span><span class="op" id="5694112">,</span>&nbsp;<span class="num" id="5694114">0xa4</span><span class="op" id="5694118">,</span>&nbsp;<span class="num" id="5694120">0xa5</span><span class="op" id="5694124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5694129">0xa6</span><span class="op" id="5694133">,</span>&nbsp;<span class="num" id="5694135">0xa7</span><span class="op" id="5694139">,</span>&nbsp;<span class="num" id="5694141">0xa8</span><span class="op" id="5694145">,</span>&nbsp;<span class="num" id="5694147">0xa9</span><span class="op" id="5694151">,</span>&nbsp;<span class="num" id="5694153">0xaa</span><span class="op" id="5694157">,</span>&nbsp;<span class="num" id="5694159">0xb2</span><span class="op" id="5694163">,</span>&nbsp;<span class="num" id="5694165">0xb3</span><span class="op" id="5694169">,</span>&nbsp;<span class="num" id="5694171">0xb4</span><span class="op" id="5694175">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5694180">0xb5</span><span class="op" id="5694184">,</span>&nbsp;<span class="num" id="5694186">0xb6</span><span class="op" id="5694190">,</span>&nbsp;<span class="num" id="5694192">0xb7</span><span class="op" id="5694196">,</span>&nbsp;<span class="num" id="5694198">0xb8</span><span class="op" id="5694202">,</span>&nbsp;<span class="num" id="5694204">0xb9</span><span class="op" id="5694208">,</span>&nbsp;<span class="num" id="5694210">0xba</span><span class="op" id="5694214">,</span>&nbsp;<span class="num" id="5694216">0xc2</span><span class="op" id="5694220">,</span>&nbsp;<span class="num" id="5694222">0xc3</span><span class="op" id="5694226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5694231">0xc4</span><span class="op" id="5694235">,</span>&nbsp;<span class="num" id="5694237">0xc5</span><span class="op" id="5694241">,</span>&nbsp;<span class="num" id="5694243">0xc6</span><span class="op" id="5694247">,</span>&nbsp;<span class="num" id="5694249">0xc7</span><span class="op" id="5694253">,</span>&nbsp;<span class="num" id="5694255">0xc8</span><span class="op" id="5694259">,</span>&nbsp;<span class="num" id="5694261">0xc9</span><span class="op" id="5694265">,</span>&nbsp;<span class="num" id="5694267">0xca</span><span class="op" id="5694271">,</span>&nbsp;<span class="num" id="5694273">0xd2</span><span class="op" id="5694277">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5694282">0xd3</span><span class="op" id="5694286">,</span>&nbsp;<span class="num" id="5694288">0xd4</span><span class="op" id="5694292">,</span>&nbsp;<span class="num" id="5694294">0xd5</span><span class="op" id="5694298">,</span>&nbsp;<span class="num" id="5694300">0xd6</span><span class="op" id="5694304">,</span>&nbsp;<span class="num" id="5694306">0xd7</span><span class="op" id="5694310">,</span>&nbsp;<span class="num" id="5694312">0xd8</span><span class="op" id="5694316">,</span>&nbsp;<span class="num" id="5694318">0xd9</span><span class="op" id="5694322">,</span>&nbsp;<span class="num" id="5694324">0xda</span><span class="op" id="5694328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5694333">0xe2</span><span class="op" id="5694337">,</span>&nbsp;<span class="num" id="5694339">0xe3</span><span class="op" id="5694343">,</span>&nbsp;<span class="num" id="5694345">0xe4</span><span class="op" id="5694349">,</span>&nbsp;<span class="num" id="5694351">0xe5</span><span class="op" id="5694355">,</span>&nbsp;<span class="num" id="5694357">0xe6</span><span class="op" id="5694361">,</span>&nbsp;<span class="num" id="5694363">0xe7</span><span class="op" id="5694367">,</span>&nbsp;<span class="num" id="5694369">0xe8</span><span class="op" id="5694373">,</span>&nbsp;<span class="num" id="5694375">0xe9</span><span class="op" id="5694379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5694384">0xea</span><span class="op" id="5694388">,</span>&nbsp;<span class="num" id="5694390">0xf2</span><span class="op" id="5694394">,</span>&nbsp;<span class="num" id="5694396">0xf3</span><span class="op" id="5694400">,</span>&nbsp;<span class="num" id="5694402">0xf4</span><span class="op" id="5694406">,</span>&nbsp;<span class="num" id="5694408">0xf5</span><span class="op" id="5694412">,</span>&nbsp;<span class="num" id="5694414">0xf6</span><span class="op" id="5694418">,</span>&nbsp;<span class="num" id="5694420">0xf7</span><span class="op" id="5694424">,</span>&nbsp;<span class="num" id="5694426">0xf8</span><span class="op" id="5694430">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5694435">0xf9</span><span class="op" id="5694439">,</span>&nbsp;<span class="num" id="5694441">0xfa</span><span class="op" id="5694445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694449">}</span><span class="op" id="5694450">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694453">}</span><span class="op" id="5694454">,</span><br>
<span class="lineno"></span><span class="op" id="5694456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5694459">//&nbsp;huffmanLUT&nbsp;is&nbsp;a&nbsp;compiled&nbsp;look-up&nbsp;table&nbsp;representation&nbsp;of&nbsp;a&nbsp;huffmanSpec.</span><br>
<span class="lineno"></span><span class="comment" id="5694534">//&nbsp;Each&nbsp;value&nbsp;maps&nbsp;to&nbsp;a&nbsp;uint32&nbsp;of&nbsp;which&nbsp;the&nbsp;8&nbsp;most&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5694611">//&nbsp;codeword&nbsp;size&nbsp;in&nbsp;bits&nbsp;and&nbsp;the&nbsp;24&nbsp;least&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the&nbsp;codeword.</span><br>
<span class="lineno"></span><span class="comment" id="5694689">//&nbsp;The&nbsp;maximum&nbsp;codeword&nbsp;size&nbsp;is&nbsp;16&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="5694730">type</span>&nbsp;<span class="ident" id="5694735">huffmanLUT</span>&nbsp;<span class="op" id="5694746">[</span><span class="op" id="5694747">]</span><span class="builtintype" id="5694748">uint32</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="5694756">func</span>&nbsp;<span class="op" id="5694761">(</span><span class="ident" id="5694762">h</span>&nbsp;<span class="op" id="5694764">*</span><span class="ident" id="5694765">huffmanLUT</span><span class="op" id="5694775">)</span>&nbsp;<span class="ident" id="5694777">init</span><span class="op" id="5694781">(</span><span class="ident" id="5694782">s</span>&nbsp;<span class="ident" id="5694784">huffmanSpec</span><span class="op" id="5694795">)</span>&nbsp;<span class="op" id="5694797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694800">maxValue</span>&nbsp;<span class="op" id="5694809">:=</span>&nbsp;<span class="num" id="5694812">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694815">for</span>&nbsp;<span class="ident" id="5694819">_</span><span class="op" id="5694820">,</span>&nbsp;<span class="ident" id="5694822">v</span>&nbsp;<span class="op" id="5694824">:=</span>&nbsp;<span class="keyword" id="5694827">range</span>&nbsp;<span class="ident" id="5694833">s</span><span class="op" id="5694834">.</span><span class="ident" id="5694835">value</span>&nbsp;<span class="op" id="5694841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694845">if</span>&nbsp;<span class="builtintype" id="5694848">int</span><span class="op" id="5694851">(</span><span class="ident" id="5694852">v</span><span class="op" id="5694853">)</span>&nbsp;<span class="op" id="5694855">&gt;</span>&nbsp;<span class="ident" id="5694857">maxValue</span>&nbsp;<span class="op" id="5694866">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694871">maxValue</span>&nbsp;<span class="op" id="5694880">=</span>&nbsp;<span class="builtintype" id="5694882">int</span><span class="op" id="5694885">(</span><span class="ident" id="5694886">v</span><span class="op" id="5694887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694897">*</span><span class="ident" id="5694898">h</span>&nbsp;<span class="op" id="5694900">=</span>&nbsp;<span class="builtinfunc" id="5694902">make</span><span class="op" id="5694906">(</span><span class="op" id="5694907">[</span><span class="op" id="5694908">]</span><span class="builtintype" id="5694909">uint32</span><span class="op" id="5694915">,</span>&nbsp;<span class="ident" id="5694917">maxValue</span><span class="op" id="5694925">+</span><span class="num" id="5694926">1</span><span class="op" id="5694927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694930">code</span><span class="op" id="5694934">,</span>&nbsp;<span class="ident" id="5694936">k</span>&nbsp;<span class="op" id="5694938">:=</span>&nbsp;<span class="builtintype" id="5694941">uint32</span><span class="op" id="5694947">(</span><span class="num" id="5694948">0</span><span class="op" id="5694949">)</span><span class="op" id="5694950">,</span>&nbsp;<span class="num" id="5694952">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694955">for</span>&nbsp;<span class="ident" id="5694959">i</span>&nbsp;<span class="op" id="5694961">:=</span>&nbsp;<span class="num" id="5694964">0</span><span class="op" id="5694965">;</span>&nbsp;<span class="ident" id="5694967">i</span>&nbsp;<span class="op" id="5694969">&lt;</span>&nbsp;<span class="builtinfunc" id="5694971">len</span><span class="op" id="5694974">(</span><span class="ident" id="5694975">s</span><span class="op" id="5694976">.</span><span class="ident" id="5694977">count</span><span class="op" id="5694982">)</span><span class="op" id="5694983">;</span>&nbsp;<span class="ident" id="5694985">i</span><span class="op" id="5694986">++</span>&nbsp;<span class="op" id="5694989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694993">nBits</span>&nbsp;<span class="op" id="5694999">:=</span>&nbsp;<span class="builtintype" id="5695002">uint32</span><span class="op" id="5695008">(</span><span class="ident" id="5695009">i</span><span class="op" id="5695010">+</span><span class="num" id="5695011">1</span><span class="op" id="5695012">)</span>&nbsp;<span class="op" id="5695014">&lt;&lt;</span>&nbsp;<span class="num" id="5695017">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695022">for</span>&nbsp;<span class="ident" id="5695026">j</span>&nbsp;<span class="op" id="5695028">:=</span>&nbsp;<span class="builtintype" id="5695031">uint8</span><span class="op" id="5695036">(</span><span class="num" id="5695037">0</span><span class="op" id="5695038">)</span><span class="op" id="5695039">;</span>&nbsp;<span class="ident" id="5695041">j</span>&nbsp;<span class="op" id="5695043">&lt;</span>&nbsp;<span class="ident" id="5695045">s</span><span class="op" id="5695046">.</span><span class="ident" id="5695047">count</span><span class="op" id="5695052">[</span><span class="ident" id="5695053">i</span><span class="op" id="5695054">]</span><span class="op" id="5695055">;</span>&nbsp;<span class="ident" id="5695057">j</span><span class="op" id="5695058">++</span>&nbsp;<span class="op" id="5695061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695066">(</span><span class="op" id="5695067">*</span><span class="ident" id="5695068">h</span><span class="op" id="5695069">)</span><span class="op" id="5695070">[</span><span class="ident" id="5695071">s</span><span class="op" id="5695072">.</span><span class="ident" id="5695073">value</span><span class="op" id="5695078">[</span><span class="ident" id="5695079">k</span><span class="op" id="5695080">]</span><span class="op" id="5695081">]</span>&nbsp;<span class="op" id="5695083">=</span>&nbsp;<span class="ident" id="5695085">nBits</span>&nbsp;<span class="op" id="5695091">|</span>&nbsp;<span class="ident" id="5695093">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695101">code</span><span class="op" id="5695105">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695111">k</span><span class="op" id="5695112">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695121">code</span>&nbsp;<span class="op" id="5695126">&lt;&lt;=</span>&nbsp;<span class="num" id="5695130">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695133">}</span><br>
<span class="lineno"></span><span class="op" id="5695135">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5695138">//&nbsp;theHuffmanLUT&nbsp;are&nbsp;compiled&nbsp;representations&nbsp;of&nbsp;theHuffmanSpec.</span><br>
<span class="lineno"></span><span class="keyword" id="5695203">var</span>&nbsp;<span class="ident" id="5695207">theHuffmanLUT</span>&nbsp;<span class="op" id="5695221">[</span><span class="num" id="5695222">4</span><span class="op" id="5695223">]</span><span class="ident" id="5695224">huffmanLUT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5695236">func</span>&nbsp;<span class="ident" id="5695241">init</span><span class="op" id="5695245">(</span><span class="op" id="5695246">)</span>&nbsp;<span class="op" id="5695248">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695251">for</span>&nbsp;<span class="ident" id="5695255">i</span><span class="op" id="5695256">,</span>&nbsp;<span class="ident" id="5695258">s</span>&nbsp;<span class="op" id="5695260">:=</span>&nbsp;<span class="keyword" id="5695263">range</span>&nbsp;<span class="ident" id="5695269">theHuffmanSpec</span>&nbsp;<span class="op" id="5695284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695288">theHuffmanLUT</span><span class="op" id="5695301">[</span><span class="ident" id="5695302">i</span><span class="op" id="5695303">]</span><span class="op" id="5695304">.</span><span class="ident" id="5695305">init</span><span class="op" id="5695309">(</span><span class="ident" id="5695310">s</span><span class="op" id="5695311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695314">}</span><br>
<span class="lineno"></span><span class="op" id="5695316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="5695319">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5695351">type</span>&nbsp;<span class="ident" id="5695356">writer</span>&nbsp;<span class="keyword" id="5695363">interface</span>&nbsp;<span class="op" id="5695373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695376">Flush</span><span class="op" id="5695381">(</span><span class="op" id="5695382">)</span>&nbsp;<span class="builtintype" id="5695384">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695391">io</span><span class="op" id="5695393">.</span><span class="ident" id="5695394">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695402">io</span><span class="op" id="5695404">.</span><span class="ident" id="5695405">ByteWriter</span><br>
<span class="lineno">215</span><span class="op" id="5695416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5695419">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;JPEG&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="5695467">type</span>&nbsp;<span class="ident" id="5695472">encoder</span>&nbsp;<span class="keyword" id="5695480">struct</span>&nbsp;<span class="op" id="5695487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5695490">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5695565">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695636">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5695640">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695648">err</span>&nbsp;<span class="builtintype" id="5695652">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5695659">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695688">buf</span>&nbsp;<span class="op" id="5695692">[</span><span class="num" id="5695693">16</span><span class="op" id="5695695">]</span><span class="builtintype" id="5695696">byte</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5695702">//&nbsp;bits&nbsp;and&nbsp;nBits&nbsp;are&nbsp;accumulated&nbsp;bits&nbsp;to&nbsp;write&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695757">bits</span><span class="op" id="5695761">,</span>&nbsp;<span class="ident" id="5695763">nBits</span>&nbsp;<span class="builtintype" id="5695769">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5695777">//&nbsp;quant&nbsp;is&nbsp;the&nbsp;scaled&nbsp;quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695840">quant</span>&nbsp;<span class="op" id="5695846">[</span><span class="ident" id="5695847">nQuantIndex</span><span class="op" id="5695858">]</span><span class="op" id="5695859">[</span><span class="ident" id="5695860">blockSize</span><span class="op" id="5695869">]</span><span class="builtintype" id="5695870">byte</span><br>
<span class="lineno"></span><span class="op" id="5695875">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="5695878">func</span>&nbsp;<span class="op" id="5695883">(</span><span class="ident" id="5695884">e</span>&nbsp;<span class="op" id="5695886">*</span><span class="ident" id="5695887">encoder</span><span class="op" id="5695894">)</span>&nbsp;<span class="ident" id="5695896">flush</span><span class="op" id="5695901">(</span><span class="op" id="5695902">)</span>&nbsp;<span class="op" id="5695904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695907">if</span>&nbsp;<span class="ident" id="5695910">e</span><span class="op" id="5695911">.</span><span class="ident" id="5695912">err</span>&nbsp;<span class="op" id="5695916">!=</span>&nbsp;<span class="ident" id="5695919">nil</span>&nbsp;<span class="op" id="5695923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695927">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695935">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695938">e</span><span class="op" id="5695939">.</span><span class="ident" id="5695940">err</span>&nbsp;<span class="op" id="5695944">=</span>&nbsp;<span class="ident" id="5695946">e</span><span class="op" id="5695947">.</span><span class="ident" id="5695948">w</span><span class="op" id="5695949">.</span><span class="ident" id="5695950">Flush</span><span class="op" id="5695955">(</span><span class="op" id="5695956">)</span><br>
<span class="lineno"></span><span class="op" id="5695958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5695961">func</span>&nbsp;<span class="op" id="5695966">(</span><span class="ident" id="5695967">e</span>&nbsp;<span class="op" id="5695969">*</span><span class="ident" id="5695970">encoder</span><span class="op" id="5695977">)</span>&nbsp;<span class="ident" id="5695979">write</span><span class="op" id="5695984">(</span><span class="ident" id="5695985">p</span>&nbsp;<span class="op" id="5695987">[</span><span class="op" id="5695988">]</span><span class="builtintype" id="5695989">byte</span><span class="op" id="5695993">)</span>&nbsp;<span class="op" id="5695995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695998">if</span>&nbsp;<span class="ident" id="5696001">e</span><span class="op" id="5696002">.</span><span class="ident" id="5696003">err</span>&nbsp;<span class="op" id="5696007">!=</span>&nbsp;<span class="ident" id="5696010">nil</span>&nbsp;<span class="op" id="5696014">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696018">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696029">_</span><span class="op" id="5696030">,</span>&nbsp;<span class="ident" id="5696032">e</span><span class="op" id="5696033">.</span><span class="ident" id="5696034">err</span>&nbsp;<span class="op" id="5696038">=</span>&nbsp;<span class="ident" id="5696040">e</span><span class="op" id="5696041">.</span><span class="ident" id="5696042">w</span><span class="op" id="5696043">.</span><span class="ident" id="5696044">Write</span><span class="op" id="5696049">(</span><span class="ident" id="5696050">p</span><span class="op" id="5696051">)</span><br>
<span class="lineno"></span><span class="op" id="5696053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="5696056">func</span>&nbsp;<span class="op" id="5696061">(</span><span class="ident" id="5696062">e</span>&nbsp;<span class="op" id="5696064">*</span><span class="ident" id="5696065">encoder</span><span class="op" id="5696072">)</span>&nbsp;<span class="ident" id="5696074">writeByte</span><span class="op" id="5696083">(</span><span class="ident" id="5696084">b</span>&nbsp;<span class="builtintype" id="5696086">byte</span><span class="op" id="5696090">)</span>&nbsp;<span class="op" id="5696092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696095">if</span>&nbsp;<span class="ident" id="5696098">e</span><span class="op" id="5696099">.</span><span class="ident" id="5696100">err</span>&nbsp;<span class="op" id="5696104">!=</span>&nbsp;<span class="ident" id="5696107">nil</span>&nbsp;<span class="op" id="5696111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696115">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696126">e</span><span class="op" id="5696127">.</span><span class="ident" id="5696128">err</span>&nbsp;<span class="op" id="5696132">=</span>&nbsp;<span class="ident" id="5696134">e</span><span class="op" id="5696135">.</span><span class="ident" id="5696136">w</span><span class="op" id="5696137">.</span><span class="ident" id="5696138">WriteByte</span><span class="op" id="5696147">(</span><span class="ident" id="5696148">b</span><span class="op" id="5696149">)</span><br>
<span class="lineno">250</span><span class="op" id="5696151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5696154">//&nbsp;emit&nbsp;emits&nbsp;the&nbsp;least&nbsp;significant&nbsp;nBits&nbsp;bits&nbsp;of&nbsp;bits&nbsp;to&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno"></span><span class="comment" id="5696228">//&nbsp;The&nbsp;precondition&nbsp;is&nbsp;bits&nbsp;&lt;&nbsp;1&lt;&lt;nBits&nbsp;&amp;&amp;&nbsp;nBits&nbsp;&lt;=&nbsp;16.</span><br>
<span class="lineno"></span><span class="keyword" id="5696283">func</span>&nbsp;<span class="op" id="5696288">(</span><span class="ident" id="5696289">e</span>&nbsp;<span class="op" id="5696291">*</span><span class="ident" id="5696292">encoder</span><span class="op" id="5696299">)</span>&nbsp;<span class="ident" id="5696301">emit</span><span class="op" id="5696305">(</span><span class="ident" id="5696306">bits</span><span class="op" id="5696310">,</span>&nbsp;<span class="ident" id="5696312">nBits</span>&nbsp;<span class="builtintype" id="5696318">uint32</span><span class="op" id="5696324">)</span>&nbsp;<span class="op" id="5696326">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696329">nBits</span>&nbsp;<span class="op" id="5696335">+=</span>&nbsp;<span class="ident" id="5696338">e</span><span class="op" id="5696339">.</span><span class="ident" id="5696340">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696347">bits</span>&nbsp;<span class="op" id="5696352">&lt;&lt;=</span>&nbsp;<span class="num" id="5696356">32</span>&nbsp;<span class="op" id="5696359">-</span>&nbsp;<span class="ident" id="5696361">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696368">bits</span>&nbsp;<span class="op" id="5696373">|=</span>&nbsp;<span class="ident" id="5696376">e</span><span class="op" id="5696377">.</span><span class="ident" id="5696378">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696384">for</span>&nbsp;<span class="ident" id="5696388">nBits</span>&nbsp;<span class="op" id="5696394">&gt;=</span>&nbsp;<span class="num" id="5696397">8</span>&nbsp;<span class="op" id="5696399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696403">b</span>&nbsp;<span class="op" id="5696405">:=</span>&nbsp;<span class="builtintype" id="5696408">uint8</span><span class="op" id="5696413">(</span><span class="ident" id="5696414">bits</span>&nbsp;<span class="op" id="5696419">&gt;&gt;</span>&nbsp;<span class="num" id="5696422">24</span><span class="op" id="5696424">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696428">e</span><span class="op" id="5696429">.</span><span class="ident" id="5696430">writeByte</span><span class="op" id="5696439">(</span><span class="ident" id="5696440">b</span><span class="op" id="5696441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696445">if</span>&nbsp;<span class="ident" id="5696448">b</span>&nbsp;<span class="op" id="5696450">==</span>&nbsp;<span class="num" id="5696453">0xff</span>&nbsp;<span class="op" id="5696458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696463">e</span><span class="op" id="5696464">.</span><span class="ident" id="5696465">writeByte</span><span class="op" id="5696474">(</span><span class="num" id="5696475">0x00</span><span class="op" id="5696479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696487">bits</span>&nbsp;<span class="op" id="5696492">&lt;&lt;=</span>&nbsp;<span class="num" id="5696496">8</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696500">nBits</span>&nbsp;<span class="op" id="5696506">-=</span>&nbsp;<span class="num" id="5696509">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696515">e</span><span class="op" id="5696516">.</span><span class="ident" id="5696517">bits</span><span class="op" id="5696521">,</span>&nbsp;<span class="ident" id="5696523">e</span><span class="op" id="5696524">.</span><span class="ident" id="5696525">nBits</span>&nbsp;<span class="op" id="5696531">=</span>&nbsp;<span class="ident" id="5696533">bits</span><span class="op" id="5696537">,</span>&nbsp;<span class="ident" id="5696539">nBits</span><br>
<span class="lineno"></span><span class="op" id="5696545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5696548">//&nbsp;emitHuff&nbsp;emits&nbsp;the&nbsp;given&nbsp;value&nbsp;with&nbsp;the&nbsp;given&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5696614">func</span>&nbsp;<span class="op" id="5696619">(</span><span class="ident" id="5696620">e</span>&nbsp;<span class="op" id="5696622">*</span><span class="ident" id="5696623">encoder</span><span class="op" id="5696630">)</span>&nbsp;<span class="ident" id="5696632">emitHuff</span><span class="op" id="5696640">(</span><span class="ident" id="5696641">h</span>&nbsp;<span class="ident" id="5696643">huffIndex</span><span class="op" id="5696652">,</span>&nbsp;<span class="ident" id="5696654">value</span>&nbsp;<span class="builtintype" id="5696660">int32</span><span class="op" id="5696665">)</span>&nbsp;<span class="op" id="5696667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696670">x</span>&nbsp;<span class="op" id="5696672">:=</span>&nbsp;<span class="ident" id="5696675">theHuffmanLUT</span><span class="op" id="5696688">[</span><span class="ident" id="5696689">h</span><span class="op" id="5696690">]</span><span class="op" id="5696691">[</span><span class="ident" id="5696692">value</span><span class="op" id="5696697">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696700">e</span><span class="op" id="5696701">.</span><span class="ident" id="5696702">emit</span><span class="op" id="5696706">(</span><span class="ident" id="5696707">x</span><span class="op" id="5696708">&amp;</span><span class="op" id="5696709">(</span><span class="num" id="5696710">1</span><span class="op" id="5696711">&lt;&lt;</span><span class="num" id="5696713">24</span><span class="op" id="5696715">-</span><span class="num" id="5696716">1</span><span class="op" id="5696717">)</span><span class="op" id="5696718">,</span>&nbsp;<span class="ident" id="5696720">x</span><span class="op" id="5696721">&gt;&gt;</span><span class="num" id="5696723">24</span><span class="op" id="5696725">)</span><br>
<span class="lineno"></span><span class="op" id="5696727">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="5696730">//&nbsp;emitHuffRLE&nbsp;emits&nbsp;a&nbsp;run&nbsp;of&nbsp;runLength&nbsp;copies&nbsp;of&nbsp;value&nbsp;encoded&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="5696809">//&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5696829">func</span>&nbsp;<span class="op" id="5696834">(</span><span class="ident" id="5696835">e</span>&nbsp;<span class="op" id="5696837">*</span><span class="ident" id="5696838">encoder</span><span class="op" id="5696845">)</span>&nbsp;<span class="ident" id="5696847">emitHuffRLE</span><span class="op" id="5696858">(</span><span class="ident" id="5696859">h</span>&nbsp;<span class="ident" id="5696861">huffIndex</span><span class="op" id="5696870">,</span>&nbsp;<span class="ident" id="5696872">runLength</span><span class="op" id="5696881">,</span>&nbsp;<span class="ident" id="5696883">value</span>&nbsp;<span class="builtintype" id="5696889">int32</span><span class="op" id="5696894">)</span>&nbsp;<span class="op" id="5696896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696899">a</span><span class="op" id="5696900">,</span>&nbsp;<span class="ident" id="5696902">b</span>&nbsp;<span class="op" id="5696904">:=</span>&nbsp;<span class="ident" id="5696907">value</span><span class="op" id="5696912">,</span>&nbsp;<span class="ident" id="5696914">value</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696921">if</span>&nbsp;<span class="ident" id="5696924">a</span>&nbsp;<span class="op" id="5696926">&lt;</span>&nbsp;<span class="num" id="5696928">0</span>&nbsp;<span class="op" id="5696930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696934">a</span><span class="op" id="5696935">,</span>&nbsp;<span class="ident" id="5696937">b</span>&nbsp;<span class="op" id="5696939">=</span>&nbsp;<span class="op" id="5696941">-</span><span class="ident" id="5696942">value</span><span class="op" id="5696947">,</span>&nbsp;<span class="ident" id="5696949">value</span><span class="op" id="5696954">-</span><span class="num" id="5696955">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696961">var</span>&nbsp;<span class="ident" id="5696965">nBits</span>&nbsp;<span class="builtintype" id="5696971">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696979">if</span>&nbsp;<span class="ident" id="5696982">a</span>&nbsp;<span class="op" id="5696984">&lt;</span>&nbsp;<span class="num" id="5696986">0x100</span>&nbsp;<span class="op" id="5696992">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5696996">nBits</span>&nbsp;<span class="op" id="5697002">=</span>&nbsp;<span class="builtintype" id="5697004">uint32</span><span class="op" id="5697010">(</span><span class="ident" id="5697011">bitCount</span><span class="op" id="5697019">[</span><span class="ident" id="5697020">a</span><span class="op" id="5697021">]</span><span class="op" id="5697022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697025">}</span>&nbsp;<span class="keyword" id="5697027">else</span>&nbsp;<span class="op" id="5697032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697036">nBits</span>&nbsp;<span class="op" id="5697042">=</span>&nbsp;<span class="num" id="5697044">8</span>&nbsp;<span class="op" id="5697046">+</span>&nbsp;<span class="builtintype" id="5697048">uint32</span><span class="op" id="5697054">(</span><span class="ident" id="5697055">bitCount</span><span class="op" id="5697063">[</span><span class="ident" id="5697064">a</span><span class="op" id="5697065">&gt;&gt;</span><span class="num" id="5697067">8</span><span class="op" id="5697068">]</span><span class="op" id="5697069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697075">e</span><span class="op" id="5697076">.</span><span class="ident" id="5697077">emitHuff</span><span class="op" id="5697085">(</span><span class="ident" id="5697086">h</span><span class="op" id="5697087">,</span>&nbsp;<span class="ident" id="5697089">runLength</span><span class="op" id="5697098">&lt;&lt;</span><span class="num" id="5697100">4</span><span class="op" id="5697101">|</span><span class="builtintype" id="5697102">int32</span><span class="op" id="5697107">(</span><span class="ident" id="5697108">nBits</span><span class="op" id="5697113">)</span><span class="op" id="5697114">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697117">if</span>&nbsp;<span class="ident" id="5697120">nBits</span>&nbsp;<span class="op" id="5697126">&gt;</span>&nbsp;<span class="num" id="5697128">0</span>&nbsp;<span class="op" id="5697130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697134">e</span><span class="op" id="5697135">.</span><span class="ident" id="5697136">emit</span><span class="op" id="5697140">(</span><span class="builtintype" id="5697141">uint32</span><span class="op" id="5697147">(</span><span class="ident" id="5697148">b</span><span class="op" id="5697149">)</span><span class="op" id="5697150">&amp;</span><span class="op" id="5697151">(</span><span class="num" id="5697152">1</span><span class="op" id="5697153">&lt;&lt;</span><span class="ident" id="5697155">nBits</span><span class="op" id="5697160">-</span><span class="num" id="5697161">1</span><span class="op" id="5697162">)</span><span class="op" id="5697163">,</span>&nbsp;<span class="ident" id="5697165">nBits</span><span class="op" id="5697170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697173">}</span><br>
<span class="lineno"></span><span class="op" id="5697175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="5697178">//&nbsp;writeMarkerHeader&nbsp;writes&nbsp;the&nbsp;header&nbsp;for&nbsp;a&nbsp;marker&nbsp;with&nbsp;the&nbsp;given&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5697253">func</span>&nbsp;<span class="op" id="5697258">(</span><span class="ident" id="5697259">e</span>&nbsp;<span class="op" id="5697261">*</span><span class="ident" id="5697262">encoder</span><span class="op" id="5697269">)</span>&nbsp;<span class="ident" id="5697271">writeMarkerHeader</span><span class="op" id="5697288">(</span><span class="ident" id="5697289">marker</span>&nbsp;<span class="builtintype" id="5697296">uint8</span><span class="op" id="5697301">,</span>&nbsp;<span class="ident" id="5697303">markerlen</span>&nbsp;<span class="builtintype" id="5697313">int</span><span class="op" id="5697316">)</span>&nbsp;<span class="op" id="5697318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697321">e</span><span class="op" id="5697322">.</span><span class="ident" id="5697323">buf</span><span class="op" id="5697326">[</span><span class="num" id="5697327">0</span><span class="op" id="5697328">]</span>&nbsp;<span class="op" id="5697330">=</span>&nbsp;<span class="num" id="5697332">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697338">e</span><span class="op" id="5697339">.</span><span class="ident" id="5697340">buf</span><span class="op" id="5697343">[</span><span class="num" id="5697344">1</span><span class="op" id="5697345">]</span>&nbsp;<span class="op" id="5697347">=</span>&nbsp;<span class="ident" id="5697349">marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697357">e</span><span class="op" id="5697358">.</span><span class="ident" id="5697359">buf</span><span class="op" id="5697362">[</span><span class="num" id="5697363">2</span><span class="op" id="5697364">]</span>&nbsp;<span class="op" id="5697366">=</span>&nbsp;<span class="builtintype" id="5697368">uint8</span><span class="op" id="5697373">(</span><span class="ident" id="5697374">markerlen</span>&nbsp;<span class="op" id="5697384">&gt;&gt;</span>&nbsp;<span class="num" id="5697387">8</span><span class="op" id="5697388">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697391">e</span><span class="op" id="5697392">.</span><span class="ident" id="5697393">buf</span><span class="op" id="5697396">[</span><span class="num" id="5697397">3</span><span class="op" id="5697398">]</span>&nbsp;<span class="op" id="5697400">=</span>&nbsp;<span class="builtintype" id="5697402">uint8</span><span class="op" id="5697407">(</span><span class="ident" id="5697408">markerlen</span>&nbsp;<span class="op" id="5697418">&amp;</span>&nbsp;<span class="num" id="5697420">0xff</span><span class="op" id="5697424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697427">e</span><span class="op" id="5697428">.</span><span class="ident" id="5697429">write</span><span class="op" id="5697434">(</span><span class="ident" id="5697435">e</span><span class="op" id="5697436">.</span><span class="ident" id="5697437">buf</span><span class="op" id="5697440">[</span><span class="op" id="5697441">:</span><span class="num" id="5697442">4</span><span class="op" id="5697443">]</span><span class="op" id="5697444">)</span><br>
<span class="lineno"></span><span class="op" id="5697446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5697449">//&nbsp;writeDQT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Quantization&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno">305</span><span class="keyword" id="5697506">func</span>&nbsp;<span class="op" id="5697511">(</span><span class="ident" id="5697512">e</span>&nbsp;<span class="op" id="5697514">*</span><span class="ident" id="5697515">encoder</span><span class="op" id="5697522">)</span>&nbsp;<span class="ident" id="5697524">writeDQT</span><span class="op" id="5697532">(</span><span class="op" id="5697533">)</span>&nbsp;<span class="op" id="5697535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697538">const</span>&nbsp;<span class="ident" id="5697544">markerlen</span>&nbsp;<span class="op" id="5697554">=</span>&nbsp;<span class="num" id="5697556">2</span>&nbsp;<span class="op" id="5697558">+</span>&nbsp;<span class="builtintype" id="5697560">int</span><span class="op" id="5697563">(</span><span class="ident" id="5697564">nQuantIndex</span><span class="op" id="5697575">)</span><span class="op" id="5697576">*</span><span class="op" id="5697577">(</span><span class="num" id="5697578">1</span><span class="op" id="5697579">+</span><span class="ident" id="5697580">blockSize</span><span class="op" id="5697589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697592">e</span><span class="op" id="5697593">.</span><span class="ident" id="5697594">writeMarkerHeader</span><span class="op" id="5697611">(</span><span class="ident" id="5697612">dqtMarker</span><span class="op" id="5697621">,</span>&nbsp;<span class="ident" id="5697623">markerlen</span><span class="op" id="5697632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697635">for</span>&nbsp;<span class="ident" id="5697639">i</span>&nbsp;<span class="op" id="5697641">:=</span>&nbsp;<span class="keyword" id="5697644">range</span>&nbsp;<span class="ident" id="5697650">e</span><span class="op" id="5697651">.</span><span class="ident" id="5697652">quant</span>&nbsp;<span class="op" id="5697658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697662">e</span><span class="op" id="5697663">.</span><span class="ident" id="5697664">writeByte</span><span class="op" id="5697673">(</span><span class="builtintype" id="5697674">uint8</span><span class="op" id="5697679">(</span><span class="ident" id="5697680">i</span><span class="op" id="5697681">)</span><span class="op" id="5697682">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697686">e</span><span class="op" id="5697687">.</span><span class="ident" id="5697688">write</span><span class="op" id="5697693">(</span><span class="ident" id="5697694">e</span><span class="op" id="5697695">.</span><span class="ident" id="5697696">quant</span><span class="op" id="5697701">[</span><span class="ident" id="5697702">i</span><span class="op" id="5697703">]</span><span class="op" id="5697704">[</span><span class="op" id="5697705">:</span><span class="op" id="5697706">]</span><span class="op" id="5697707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697710">}</span><br>
<span class="lineno"></span><span class="op" id="5697712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5697715">//&nbsp;writeSOF0&nbsp;writes&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline)&nbsp;marker.</span><br>
<span class="lineno">315</span><span class="keyword" id="5697773">func</span>&nbsp;<span class="op" id="5697778">(</span><span class="ident" id="5697779">e</span>&nbsp;<span class="op" id="5697781">*</span><span class="ident" id="5697782">encoder</span><span class="op" id="5697789">)</span>&nbsp;<span class="ident" id="5697791">writeSOF0</span><span class="op" id="5697800">(</span><span class="ident" id="5697801">size</span>&nbsp;<span class="ident" id="5697806">image</span><span class="op" id="5697811">.</span><span class="ident" id="5697812">Point</span><span class="op" id="5697817">,</span>&nbsp;<span class="ident" id="5697819">nComponent</span>&nbsp;<span class="builtintype" id="5697830">int</span><span class="op" id="5697833">)</span>&nbsp;<span class="op" id="5697835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697838">markerlen</span>&nbsp;<span class="op" id="5697848">:=</span>&nbsp;<span class="num" id="5697851">8</span>&nbsp;<span class="op" id="5697853">+</span>&nbsp;<span class="num" id="5697855">3</span><span class="op" id="5697856">*</span><span class="ident" id="5697857">nComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697869">e</span><span class="op" id="5697870">.</span><span class="ident" id="5697871">writeMarkerHeader</span><span class="op" id="5697888">(</span><span class="ident" id="5697889">sof0Marker</span><span class="op" id="5697899">,</span>&nbsp;<span class="ident" id="5697901">markerlen</span><span class="op" id="5697910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697913">e</span><span class="op" id="5697914">.</span><span class="ident" id="5697915">buf</span><span class="op" id="5697918">[</span><span class="num" id="5697919">0</span><span class="op" id="5697920">]</span>&nbsp;<span class="op" id="5697922">=</span>&nbsp;<span class="num" id="5697924">8</span>&nbsp;<span class="comment" id="5697926">//&nbsp;8-bit&nbsp;color.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697943">e</span><span class="op" id="5697944">.</span><span class="ident" id="5697945">buf</span><span class="op" id="5697948">[</span><span class="num" id="5697949">1</span><span class="op" id="5697950">]</span>&nbsp;<span class="op" id="5697952">=</span>&nbsp;<span class="builtintype" id="5697954">uint8</span><span class="op" id="5697959">(</span><span class="ident" id="5697960">size</span><span class="op" id="5697964">.</span><span class="ident" id="5697965">Y</span>&nbsp;<span class="op" id="5697967">&gt;&gt;</span>&nbsp;<span class="num" id="5697970">8</span><span class="op" id="5697971">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697974">e</span><span class="op" id="5697975">.</span><span class="ident" id="5697976">buf</span><span class="op" id="5697979">[</span><span class="num" id="5697980">2</span><span class="op" id="5697981">]</span>&nbsp;<span class="op" id="5697983">=</span>&nbsp;<span class="builtintype" id="5697985">uint8</span><span class="op" id="5697990">(</span><span class="ident" id="5697991">size</span><span class="op" id="5697995">.</span><span class="ident" id="5697996">Y</span>&nbsp;<span class="op" id="5697998">&amp;</span>&nbsp;<span class="num" id="5698000">0xff</span><span class="op" id="5698004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698007">e</span><span class="op" id="5698008">.</span><span class="ident" id="5698009">buf</span><span class="op" id="5698012">[</span><span class="num" id="5698013">3</span><span class="op" id="5698014">]</span>&nbsp;<span class="op" id="5698016">=</span>&nbsp;<span class="builtintype" id="5698018">uint8</span><span class="op" id="5698023">(</span><span class="ident" id="5698024">size</span><span class="op" id="5698028">.</span><span class="ident" id="5698029">X</span>&nbsp;<span class="op" id="5698031">&gt;&gt;</span>&nbsp;<span class="num" id="5698034">8</span><span class="op" id="5698035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698038">e</span><span class="op" id="5698039">.</span><span class="ident" id="5698040">buf</span><span class="op" id="5698043">[</span><span class="num" id="5698044">4</span><span class="op" id="5698045">]</span>&nbsp;<span class="op" id="5698047">=</span>&nbsp;<span class="builtintype" id="5698049">uint8</span><span class="op" id="5698054">(</span><span class="ident" id="5698055">size</span><span class="op" id="5698059">.</span><span class="ident" id="5698060">X</span>&nbsp;<span class="op" id="5698062">&amp;</span>&nbsp;<span class="num" id="5698064">0xff</span><span class="op" id="5698068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698071">e</span><span class="op" id="5698072">.</span><span class="ident" id="5698073">buf</span><span class="op" id="5698076">[</span><span class="num" id="5698077">5</span><span class="op" id="5698078">]</span>&nbsp;<span class="op" id="5698080">=</span>&nbsp;<span class="builtintype" id="5698082">uint8</span><span class="op" id="5698087">(</span><span class="ident" id="5698088">nComponent</span><span class="op" id="5698098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698101">if</span>&nbsp;<span class="ident" id="5698104">nComponent</span>&nbsp;<span class="op" id="5698115">==</span>&nbsp;<span class="num" id="5698118">1</span>&nbsp;<span class="op" id="5698120">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698124">e</span><span class="op" id="5698125">.</span><span class="ident" id="5698126">buf</span><span class="op" id="5698129">[</span><span class="num" id="5698130">6</span><span class="op" id="5698131">]</span>&nbsp;<span class="op" id="5698133">=</span>&nbsp;<span class="num" id="5698135">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5698139">//&nbsp;No&nbsp;subsampling&nbsp;for&nbsp;grayscale&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698180">e</span><span class="op" id="5698181">.</span><span class="ident" id="5698182">buf</span><span class="op" id="5698185">[</span><span class="num" id="5698186">7</span><span class="op" id="5698187">]</span>&nbsp;<span class="op" id="5698189">=</span>&nbsp;<span class="num" id="5698191">0x11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698198">e</span><span class="op" id="5698199">.</span><span class="ident" id="5698200">buf</span><span class="op" id="5698203">[</span><span class="num" id="5698204">8</span><span class="op" id="5698205">]</span>&nbsp;<span class="op" id="5698207">=</span>&nbsp;<span class="num" id="5698209">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5698215">}</span>&nbsp;<span class="keyword" id="5698217">else</span>&nbsp;<span class="op" id="5698222">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698226">for</span>&nbsp;<span class="ident" id="5698230">i</span>&nbsp;<span class="op" id="5698232">:=</span>&nbsp;<span class="num" id="5698235">0</span><span class="op" id="5698236">;</span>&nbsp;<span class="ident" id="5698238">i</span>&nbsp;<span class="op" id="5698240">&lt;</span>&nbsp;<span class="ident" id="5698242">nComponent</span><span class="op" id="5698252">;</span>&nbsp;<span class="ident" id="5698254">i</span><span class="op" id="5698255">++</span>&nbsp;<span class="op" id="5698258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698263">e</span><span class="op" id="5698264">.</span><span class="ident" id="5698265">buf</span><span class="op" id="5698268">[</span><span class="num" id="5698269">3</span><span class="op" id="5698270">*</span><span class="ident" id="5698271">i</span><span class="op" id="5698272">+</span><span class="num" id="5698273">6</span><span class="op" id="5698274">]</span>&nbsp;<span class="op" id="5698276">=</span>&nbsp;<span class="builtintype" id="5698278">uint8</span><span class="op" id="5698283">(</span><span class="ident" id="5698284">i</span>&nbsp;<span class="op" id="5698286">+</span>&nbsp;<span class="num" id="5698288">1</span><span class="op" id="5698289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5698294">//&nbsp;We&nbsp;use&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698333">e</span><span class="op" id="5698334">.</span><span class="ident" id="5698335">buf</span><span class="op" id="5698338">[</span><span class="num" id="5698339">3</span><span class="op" id="5698340">*</span><span class="ident" id="5698341">i</span><span class="op" id="5698342">+</span><span class="num" id="5698343">7</span><span class="op" id="5698344">]</span>&nbsp;<span class="op" id="5698346">=</span>&nbsp;<span class="string" id="5698348">&#34;\x22\x11\x11&#34;</span><span class="op" id="5698362">[</span><span class="ident" id="5698363">i</span><span class="op" id="5698364">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698369">e</span><span class="op" id="5698370">.</span><span class="ident" id="5698371">buf</span><span class="op" id="5698374">[</span><span class="num" id="5698375">3</span><span class="op" id="5698376">*</span><span class="ident" id="5698377">i</span><span class="op" id="5698378">+</span><span class="num" id="5698379">8</span><span class="op" id="5698380">]</span>&nbsp;<span class="op" id="5698382">=</span>&nbsp;<span class="string" id="5698384">&#34;\x00\x01\x01&#34;</span><span class="op" id="5698398">[</span><span class="ident" id="5698399">i</span><span class="op" id="5698400">]</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5698404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5698407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698410">e</span><span class="op" id="5698411">.</span><span class="ident" id="5698412">write</span><span class="op" id="5698417">(</span><span class="ident" id="5698418">e</span><span class="op" id="5698419">.</span><span class="ident" id="5698420">buf</span><span class="op" id="5698423">[</span><span class="op" id="5698424">:</span><span class="num" id="5698425">3</span><span class="op" id="5698426">*</span><span class="op" id="5698427">(</span><span class="ident" id="5698428">nComponent</span><span class="op" id="5698438">-</span><span class="num" id="5698439">1</span><span class="op" id="5698440">)</span><span class="op" id="5698441">+</span><span class="num" id="5698442">9</span><span class="op" id="5698443">]</span><span class="op" id="5698444">)</span><br>
<span class="lineno"></span><span class="op" id="5698446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="5698449">//&nbsp;writeDHT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno"></span><span class="keyword" id="5698501">func</span>&nbsp;<span class="op" id="5698506">(</span><span class="ident" id="5698507">e</span>&nbsp;<span class="op" id="5698509">*</span><span class="ident" id="5698510">encoder</span><span class="op" id="5698517">)</span>&nbsp;<span class="ident" id="5698519">writeDHT</span><span class="op" id="5698527">(</span><span class="ident" id="5698528">nComponent</span>&nbsp;<span class="builtintype" id="5698539">int</span><span class="op" id="5698542">)</span>&nbsp;<span class="op" id="5698544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698547">markerlen</span>&nbsp;<span class="op" id="5698557">:=</span>&nbsp;<span class="num" id="5698560">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698563">specs</span>&nbsp;<span class="op" id="5698569">:=</span>&nbsp;<span class="ident" id="5698572">theHuffmanSpec</span><span class="op" id="5698586">[</span><span class="op" id="5698587">:</span><span class="op" id="5698588">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698591">if</span>&nbsp;<span class="ident" id="5698594">nComponent</span>&nbsp;<span class="op" id="5698605">==</span>&nbsp;<span class="num" id="5698608">1</span>&nbsp;<span class="op" id="5698610">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5698614">//&nbsp;Drop&nbsp;the&nbsp;Chrominance&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698648">specs</span>&nbsp;<span class="op" id="5698654">=</span>&nbsp;<span class="ident" id="5698656">specs</span><span class="op" id="5698661">[</span><span class="op" id="5698662">:</span><span class="num" id="5698663">2</span><span class="op" id="5698664">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5698667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698670">for</span>&nbsp;<span class="ident" id="5698674">_</span><span class="op" id="5698675">,</span>&nbsp;<span class="ident" id="5698677">s</span>&nbsp;<span class="op" id="5698679">:=</span>&nbsp;<span class="keyword" id="5698682">range</span>&nbsp;<span class="ident" id="5698688">specs</span>&nbsp;<span class="op" id="5698694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698698">markerlen</span>&nbsp;<span class="op" id="5698708">+=</span>&nbsp;<span class="num" id="5698711">1</span>&nbsp;<span class="op" id="5698713">+</span>&nbsp;<span class="num" id="5698715">16</span>&nbsp;<span class="op" id="5698718">+</span>&nbsp;<span class="builtinfunc" id="5698720">len</span><span class="op" id="5698723">(</span><span class="ident" id="5698724">s</span><span class="op" id="5698725">.</span><span class="ident" id="5698726">value</span><span class="op" id="5698731">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5698734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698737">e</span><span class="op" id="5698738">.</span><span class="ident" id="5698739">writeMarkerHeader</span><span class="op" id="5698756">(</span><span class="ident" id="5698757">dhtMarker</span><span class="op" id="5698766">,</span>&nbsp;<span class="ident" id="5698768">markerlen</span><span class="op" id="5698777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698780">for</span>&nbsp;<span class="ident" id="5698784">i</span><span class="op" id="5698785">,</span>&nbsp;<span class="ident" id="5698787">s</span>&nbsp;<span class="op" id="5698789">:=</span>&nbsp;<span class="keyword" id="5698792">range</span>&nbsp;<span class="ident" id="5698798">specs</span>&nbsp;<span class="op" id="5698804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698808">e</span><span class="op" id="5698809">.</span><span class="ident" id="5698810">writeByte</span><span class="op" id="5698819">(</span><span class="string" id="5698820">&#34;\x00\x10\x01\x11&#34;</span><span class="op" id="5698838">[</span><span class="ident" id="5698839">i</span><span class="op" id="5698840">]</span><span class="op" id="5698841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698845">e</span><span class="op" id="5698846">.</span><span class="ident" id="5698847">write</span><span class="op" id="5698852">(</span><span class="ident" id="5698853">s</span><span class="op" id="5698854">.</span><span class="ident" id="5698855">count</span><span class="op" id="5698860">[</span><span class="op" id="5698861">:</span><span class="op" id="5698862">]</span><span class="op" id="5698863">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698867">e</span><span class="op" id="5698868">.</span><span class="ident" id="5698869">write</span><span class="op" id="5698874">(</span><span class="ident" id="5698875">s</span><span class="op" id="5698876">.</span><span class="ident" id="5698877">value</span><span class="op" id="5698882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5698885">}</span><br>
<span class="lineno"></span><span class="op" id="5698887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5698890">//&nbsp;writeBlock&nbsp;writes&nbsp;a&nbsp;block&nbsp;of&nbsp;pixel&nbsp;data&nbsp;using&nbsp;the&nbsp;given&nbsp;quantization&nbsp;table,</span><br>
<span class="lineno">360</span><span class="comment" id="5698969">//&nbsp;returning&nbsp;the&nbsp;post-quantized&nbsp;DC&nbsp;value&nbsp;of&nbsp;the&nbsp;DCT-transformed&nbsp;block.&nbsp;b&nbsp;is&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5699048">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5699080">func</span>&nbsp;<span class="op" id="5699085">(</span><span class="ident" id="5699086">e</span>&nbsp;<span class="op" id="5699088">*</span><span class="ident" id="5699089">encoder</span><span class="op" id="5699096">)</span>&nbsp;<span class="ident" id="5699098">writeBlock</span><span class="op" id="5699108">(</span><span class="ident" id="5699109">b</span>&nbsp;<span class="op" id="5699111">*</span><span class="ident" id="5699112">block</span><span class="op" id="5699117">,</span>&nbsp;<span class="ident" id="5699119">q</span>&nbsp;<span class="ident" id="5699121">quantIndex</span><span class="op" id="5699131">,</span>&nbsp;<span class="ident" id="5699133">prevDC</span>&nbsp;<span class="builtintype" id="5699140">int32</span><span class="op" id="5699145">)</span>&nbsp;<span class="builtintype" id="5699147">int32</span>&nbsp;<span class="op" id="5699153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699156">fdct</span><span class="op" id="5699160">(</span><span class="ident" id="5699161">b</span><span class="op" id="5699162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5699165">//&nbsp;Emit&nbsp;the&nbsp;DC&nbsp;delta.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699188">dc</span>&nbsp;<span class="op" id="5699191">:=</span>&nbsp;<span class="ident" id="5699194">div</span><span class="op" id="5699197">(</span><span class="ident" id="5699198">b</span><span class="op" id="5699199">[</span><span class="num" id="5699200">0</span><span class="op" id="5699201">]</span><span class="op" id="5699202">,</span>&nbsp;<span class="num" id="5699204">8</span><span class="op" id="5699205">*</span><span class="builtintype" id="5699206">int32</span><span class="op" id="5699211">(</span><span class="ident" id="5699212">e</span><span class="op" id="5699213">.</span><span class="ident" id="5699214">quant</span><span class="op" id="5699219">[</span><span class="ident" id="5699220">q</span><span class="op" id="5699221">]</span><span class="op" id="5699222">[</span><span class="num" id="5699223">0</span><span class="op" id="5699224">]</span><span class="op" id="5699225">)</span><span class="op" id="5699226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699229">e</span><span class="op" id="5699230">.</span><span class="ident" id="5699231">emitHuffRLE</span><span class="op" id="5699242">(</span><span class="ident" id="5699243">huffIndex</span><span class="op" id="5699252">(</span><span class="num" id="5699253">2</span><span class="op" id="5699254">*</span><span class="ident" id="5699255">q</span><span class="op" id="5699256">+</span><span class="num" id="5699257">0</span><span class="op" id="5699258">)</span><span class="op" id="5699259">,</span>&nbsp;<span class="num" id="5699261">0</span><span class="op" id="5699262">,</span>&nbsp;<span class="ident" id="5699264">dc</span><span class="op" id="5699266">-</span><span class="ident" id="5699267">prevDC</span><span class="op" id="5699273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5699276">//&nbsp;Emit&nbsp;the&nbsp;AC&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699304">h</span><span class="op" id="5699305">,</span>&nbsp;<span class="ident" id="5699307">runLength</span>&nbsp;<span class="op" id="5699317">:=</span>&nbsp;<span class="ident" id="5699320">huffIndex</span><span class="op" id="5699329">(</span><span class="num" id="5699330">2</span><span class="op" id="5699331">*</span><span class="ident" id="5699332">q</span><span class="op" id="5699333">+</span><span class="num" id="5699334">1</span><span class="op" id="5699335">)</span><span class="op" id="5699336">,</span>&nbsp;<span class="builtintype" id="5699338">int32</span><span class="op" id="5699343">(</span><span class="num" id="5699344">0</span><span class="op" id="5699345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699348">for</span>&nbsp;<span class="ident" id="5699352">zig</span>&nbsp;<span class="op" id="5699356">:=</span>&nbsp;<span class="num" id="5699359">1</span><span class="op" id="5699360">;</span>&nbsp;<span class="ident" id="5699362">zig</span>&nbsp;<span class="op" id="5699366">&lt;</span>&nbsp;<span class="ident" id="5699368">blockSize</span><span class="op" id="5699377">;</span>&nbsp;<span class="ident" id="5699379">zig</span><span class="op" id="5699382">++</span>&nbsp;<span class="op" id="5699385">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699389">ac</span>&nbsp;<span class="op" id="5699392">:=</span>&nbsp;<span class="ident" id="5699395">div</span><span class="op" id="5699398">(</span><span class="ident" id="5699399">b</span><span class="op" id="5699400">[</span><span class="ident" id="5699401">unzig</span><span class="op" id="5699406">[</span><span class="ident" id="5699407">zig</span><span class="op" id="5699410">]</span><span class="op" id="5699411">]</span><span class="op" id="5699412">,</span>&nbsp;<span class="num" id="5699414">8</span><span class="op" id="5699415">*</span><span class="builtintype" id="5699416">int32</span><span class="op" id="5699421">(</span><span class="ident" id="5699422">e</span><span class="op" id="5699423">.</span><span class="ident" id="5699424">quant</span><span class="op" id="5699429">[</span><span class="ident" id="5699430">q</span><span class="op" id="5699431">]</span><span class="op" id="5699432">[</span><span class="ident" id="5699433">zig</span><span class="op" id="5699436">]</span><span class="op" id="5699437">)</span><span class="op" id="5699438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699442">if</span>&nbsp;<span class="ident" id="5699445">ac</span>&nbsp;<span class="op" id="5699448">==</span>&nbsp;<span class="num" id="5699451">0</span>&nbsp;<span class="op" id="5699453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699458">runLength</span><span class="op" id="5699467">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5699472">}</span>&nbsp;<span class="keyword" id="5699474">else</span>&nbsp;<span class="op" id="5699479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699484">for</span>&nbsp;<span class="ident" id="5699488">runLength</span>&nbsp;<span class="op" id="5699498">&gt;</span>&nbsp;<span class="num" id="5699500">15</span>&nbsp;<span class="op" id="5699503">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699509">e</span><span class="op" id="5699510">.</span><span class="ident" id="5699511">emitHuff</span><span class="op" id="5699519">(</span><span class="ident" id="5699520">h</span><span class="op" id="5699521">,</span>&nbsp;<span class="num" id="5699523">0xf0</span><span class="op" id="5699527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699533">runLength</span>&nbsp;<span class="op" id="5699543">-=</span>&nbsp;<span class="num" id="5699546">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5699552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699557">e</span><span class="op" id="5699558">.</span><span class="ident" id="5699559">emitHuffRLE</span><span class="op" id="5699570">(</span><span class="ident" id="5699571">h</span><span class="op" id="5699572">,</span>&nbsp;<span class="ident" id="5699574">runLength</span><span class="op" id="5699583">,</span>&nbsp;<span class="ident" id="5699585">ac</span><span class="op" id="5699587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699592">runLength</span>&nbsp;<span class="op" id="5699602">=</span>&nbsp;<span class="num" id="5699604">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5699608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5699611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699614">if</span>&nbsp;<span class="ident" id="5699617">runLength</span>&nbsp;<span class="op" id="5699627">&gt;</span>&nbsp;<span class="num" id="5699629">0</span>&nbsp;<span class="op" id="5699631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699635">e</span><span class="op" id="5699636">.</span><span class="ident" id="5699637">emitHuff</span><span class="op" id="5699645">(</span><span class="ident" id="5699646">h</span><span class="op" id="5699647">,</span>&nbsp;<span class="num" id="5699649">0x00</span><span class="op" id="5699653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5699656">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699659">return</span>&nbsp;<span class="ident" id="5699666">dc</span><br>
<span class="lineno"></span><span class="op" id="5699669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5699672">//&nbsp;toYCbCr&nbsp;converts&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5699746">//&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno">390</span><span class="keyword" id="5699763">func</span>&nbsp;<span class="ident" id="5699768">toYCbCr</span><span class="op" id="5699775">(</span><span class="ident" id="5699776">m</span>&nbsp;<span class="ident" id="5699778">image</span><span class="op" id="5699783">.</span><span class="ident" id="5699784">Image</span><span class="op" id="5699789">,</span>&nbsp;<span class="ident" id="5699791">p</span>&nbsp;<span class="ident" id="5699793">image</span><span class="op" id="5699798">.</span><span class="ident" id="5699799">Point</span><span class="op" id="5699804">,</span>&nbsp;<span class="ident" id="5699806">yBlock</span><span class="op" id="5699812">,</span>&nbsp;<span class="ident" id="5699814">cbBlock</span><span class="op" id="5699821">,</span>&nbsp;<span class="ident" id="5699823">crBlock</span>&nbsp;<span class="op" id="5699831">*</span><span class="ident" id="5699832">block</span><span class="op" id="5699837">)</span>&nbsp;<span class="op" id="5699839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699842">b</span>&nbsp;<span class="op" id="5699844">:=</span>&nbsp;<span class="ident" id="5699847">m</span><span class="op" id="5699848">.</span><span class="ident" id="5699849">Bounds</span><span class="op" id="5699855">(</span><span class="op" id="5699856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699859">xmax</span>&nbsp;<span class="op" id="5699864">:=</span>&nbsp;<span class="ident" id="5699867">b</span><span class="op" id="5699868">.</span><span class="ident" id="5699869">Max</span><span class="op" id="5699872">.</span><span class="ident" id="5699873">X</span>&nbsp;<span class="op" id="5699875">-</span>&nbsp;<span class="num" id="5699877">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699880">ymax</span>&nbsp;<span class="op" id="5699885">:=</span>&nbsp;<span class="ident" id="5699888">b</span><span class="op" id="5699889">.</span><span class="ident" id="5699890">Max</span><span class="op" id="5699893">.</span><span class="ident" id="5699894">Y</span>&nbsp;<span class="op" id="5699896">-</span>&nbsp;<span class="num" id="5699898">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699901">for</span>&nbsp;<span class="ident" id="5699905">j</span>&nbsp;<span class="op" id="5699907">:=</span>&nbsp;<span class="num" id="5699910">0</span><span class="op" id="5699911">;</span>&nbsp;<span class="ident" id="5699913">j</span>&nbsp;<span class="op" id="5699915">&lt;</span>&nbsp;<span class="num" id="5699917">8</span><span class="op" id="5699918">;</span>&nbsp;<span class="ident" id="5699920">j</span><span class="op" id="5699921">++</span>&nbsp;<span class="op" id="5699924">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699928">for</span>&nbsp;<span class="ident" id="5699932">i</span>&nbsp;<span class="op" id="5699934">:=</span>&nbsp;<span class="num" id="5699937">0</span><span class="op" id="5699938">;</span>&nbsp;<span class="ident" id="5699940">i</span>&nbsp;<span class="op" id="5699942">&lt;</span>&nbsp;<span class="num" id="5699944">8</span><span class="op" id="5699945">;</span>&nbsp;<span class="ident" id="5699947">i</span><span class="op" id="5699948">++</span>&nbsp;<span class="op" id="5699951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699956">r</span><span class="op" id="5699957">,</span>&nbsp;<span class="ident" id="5699959">g</span><span class="op" id="5699960">,</span>&nbsp;<span class="ident" id="5699962">b</span><span class="op" id="5699963">,</span>&nbsp;<span class="ident" id="5699965">_</span>&nbsp;<span class="op" id="5699967">:=</span>&nbsp;<span class="ident" id="5699970">m</span><span class="op" id="5699971">.</span><span class="ident" id="5699972">At</span><span class="op" id="5699974">(</span><span class="ident" id="5699975">min</span><span class="op" id="5699978">(</span><span class="ident" id="5699979">p</span><span class="op" id="5699980">.</span><span class="ident" id="5699981">X</span><span class="op" id="5699982">+</span><span class="ident" id="5699983">i</span><span class="op" id="5699984">,</span>&nbsp;<span class="ident" id="5699986">xmax</span><span class="op" id="5699990">)</span><span class="op" id="5699991">,</span>&nbsp;<span class="ident" id="5699993">min</span><span class="op" id="5699996">(</span><span class="ident" id="5699997">p</span><span class="op" id="5699998">.</span><span class="ident" id="5699999">Y</span><span class="op" id="5700000">+</span><span class="ident" id="5700001">j</span><span class="op" id="5700002">,</span>&nbsp;<span class="ident" id="5700004">ymax</span><span class="op" id="5700008">)</span><span class="op" id="5700009">)</span><span class="op" id="5700010">.</span><span class="ident" id="5700011">RGBA</span><span class="op" id="5700015">(</span><span class="op" id="5700016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700021">yy</span><span class="op" id="5700023">,</span>&nbsp;<span class="ident" id="5700025">cb</span><span class="op" id="5700027">,</span>&nbsp;<span class="ident" id="5700029">cr</span>&nbsp;<span class="op" id="5700032">:=</span>&nbsp;<span class="ident" id="5700035">color</span><span class="op" id="5700040">.</span><span class="ident" id="5700041">RGBToYCbCr</span><span class="op" id="5700051">(</span><span class="builtintype" id="5700052">uint8</span><span class="op" id="5700057">(</span><span class="ident" id="5700058">r</span><span class="op" id="5700059">&gt;&gt;</span><span class="num" id="5700061">8</span><span class="op" id="5700062">)</span><span class="op" id="5700063">,</span>&nbsp;<span class="builtintype" id="5700065">uint8</span><span class="op" id="5700070">(</span><span class="ident" id="5700071">g</span><span class="op" id="5700072">&gt;&gt;</span><span class="num" id="5700074">8</span><span class="op" id="5700075">)</span><span class="op" id="5700076">,</span>&nbsp;<span class="builtintype" id="5700078">uint8</span><span class="op" id="5700083">(</span><span class="ident" id="5700084">b</span><span class="op" id="5700085">&gt;&gt;</span><span class="num" id="5700087">8</span><span class="op" id="5700088">)</span><span class="op" id="5700089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700094">yBlock</span><span class="op" id="5700100">[</span><span class="num" id="5700101">8</span><span class="op" id="5700102">*</span><span class="ident" id="5700103">j</span><span class="op" id="5700104">+</span><span class="ident" id="5700105">i</span><span class="op" id="5700106">]</span>&nbsp;<span class="op" id="5700108">=</span>&nbsp;<span class="builtintype" id="5700110">int32</span><span class="op" id="5700115">(</span><span class="ident" id="5700116">yy</span><span class="op" id="5700118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700123">cbBlock</span><span class="op" id="5700130">[</span><span class="num" id="5700131">8</span><span class="op" id="5700132">*</span><span class="ident" id="5700133">j</span><span class="op" id="5700134">+</span><span class="ident" id="5700135">i</span><span class="op" id="5700136">]</span>&nbsp;<span class="op" id="5700138">=</span>&nbsp;<span class="builtintype" id="5700140">int32</span><span class="op" id="5700145">(</span><span class="ident" id="5700146">cb</span><span class="op" id="5700148">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700153">crBlock</span><span class="op" id="5700160">[</span><span class="num" id="5700161">8</span><span class="op" id="5700162">*</span><span class="ident" id="5700163">j</span><span class="op" id="5700164">+</span><span class="ident" id="5700165">i</span><span class="op" id="5700166">]</span>&nbsp;<span class="op" id="5700168">=</span>&nbsp;<span class="builtintype" id="5700170">int32</span><span class="op" id="5700175">(</span><span class="ident" id="5700176">cr</span><span class="op" id="5700178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5700182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5700185">}</span><br>
<span class="lineno"></span><span class="op" id="5700187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="5700190">//&nbsp;grayToY&nbsp;stores&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;in&nbsp;yBlock.</span><br>
<span class="lineno"></span><span class="keyword" id="5700266">func</span>&nbsp;<span class="ident" id="5700271">grayToY</span><span class="op" id="5700278">(</span><span class="ident" id="5700279">m</span>&nbsp;<span class="op" id="5700281">*</span><span class="ident" id="5700282">image</span><span class="op" id="5700287">.</span><span class="ident" id="5700288">Gray</span><span class="op" id="5700292">,</span>&nbsp;<span class="ident" id="5700294">p</span>&nbsp;<span class="ident" id="5700296">image</span><span class="op" id="5700301">.</span><span class="ident" id="5700302">Point</span><span class="op" id="5700307">,</span>&nbsp;<span class="ident" id="5700309">yBlock</span>&nbsp;<span class="op" id="5700316">*</span><span class="ident" id="5700317">block</span><span class="op" id="5700322">)</span>&nbsp;<span class="op" id="5700324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700327">b</span>&nbsp;<span class="op" id="5700329">:=</span>&nbsp;<span class="ident" id="5700332">m</span><span class="op" id="5700333">.</span><span class="ident" id="5700334">Bounds</span><span class="op" id="5700340">(</span><span class="op" id="5700341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700344">xmax</span>&nbsp;<span class="op" id="5700349">:=</span>&nbsp;<span class="ident" id="5700352">b</span><span class="op" id="5700353">.</span><span class="ident" id="5700354">Max</span><span class="op" id="5700357">.</span><span class="ident" id="5700358">X</span>&nbsp;<span class="op" id="5700360">-</span>&nbsp;<span class="num" id="5700362">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700365">ymax</span>&nbsp;<span class="op" id="5700370">:=</span>&nbsp;<span class="ident" id="5700373">b</span><span class="op" id="5700374">.</span><span class="ident" id="5700375">Max</span><span class="op" id="5700378">.</span><span class="ident" id="5700379">Y</span>&nbsp;<span class="op" id="5700381">-</span>&nbsp;<span class="num" id="5700383">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700386">pix</span>&nbsp;<span class="op" id="5700390">:=</span>&nbsp;<span class="ident" id="5700393">m</span><span class="op" id="5700394">.</span><span class="ident" id="5700395">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700400">for</span>&nbsp;<span class="ident" id="5700404">j</span>&nbsp;<span class="op" id="5700406">:=</span>&nbsp;<span class="num" id="5700409">0</span><span class="op" id="5700410">;</span>&nbsp;<span class="ident" id="5700412">j</span>&nbsp;<span class="op" id="5700414">&lt;</span>&nbsp;<span class="num" id="5700416">8</span><span class="op" id="5700417">;</span>&nbsp;<span class="ident" id="5700419">j</span><span class="op" id="5700420">++</span>&nbsp;<span class="op" id="5700423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700427">for</span>&nbsp;<span class="ident" id="5700431">i</span>&nbsp;<span class="op" id="5700433">:=</span>&nbsp;<span class="num" id="5700436">0</span><span class="op" id="5700437">;</span>&nbsp;<span class="ident" id="5700439">i</span>&nbsp;<span class="op" id="5700441">&lt;</span>&nbsp;<span class="num" id="5700443">8</span><span class="op" id="5700444">;</span>&nbsp;<span class="ident" id="5700446">i</span><span class="op" id="5700447">++</span>&nbsp;<span class="op" id="5700450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700455">idx</span>&nbsp;<span class="op" id="5700459">:=</span>&nbsp;<span class="ident" id="5700462">m</span><span class="op" id="5700463">.</span><span class="ident" id="5700464">PixOffset</span><span class="op" id="5700473">(</span><span class="ident" id="5700474">min</span><span class="op" id="5700477">(</span><span class="ident" id="5700478">p</span><span class="op" id="5700479">.</span><span class="ident" id="5700480">X</span><span class="op" id="5700481">+</span><span class="ident" id="5700482">i</span><span class="op" id="5700483">,</span>&nbsp;<span class="ident" id="5700485">xmax</span><span class="op" id="5700489">)</span><span class="op" id="5700490">,</span>&nbsp;<span class="ident" id="5700492">min</span><span class="op" id="5700495">(</span><span class="ident" id="5700496">p</span><span class="op" id="5700497">.</span><span class="ident" id="5700498">Y</span><span class="op" id="5700499">+</span><span class="ident" id="5700500">j</span><span class="op" id="5700501">,</span>&nbsp;<span class="ident" id="5700503">ymax</span><span class="op" id="5700507">)</span><span class="op" id="5700508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700513">yBlock</span><span class="op" id="5700519">[</span><span class="num" id="5700520">8</span><span class="op" id="5700521">*</span><span class="ident" id="5700522">j</span><span class="op" id="5700523">+</span><span class="ident" id="5700524">i</span><span class="op" id="5700525">]</span>&nbsp;<span class="op" id="5700527">=</span>&nbsp;<span class="builtintype" id="5700529">int32</span><span class="op" id="5700534">(</span><span class="ident" id="5700535">pix</span><span class="op" id="5700538">[</span><span class="ident" id="5700539">idx</span><span class="op" id="5700542">]</span><span class="op" id="5700543">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5700547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5700550">}</span><br>
<span class="lineno"></span><span class="op" id="5700552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5700555">//&nbsp;rgbaToYCbCr&nbsp;is&nbsp;a&nbsp;specialized&nbsp;version&nbsp;of&nbsp;toYCbCr&nbsp;for&nbsp;image.RGBA&nbsp;images.</span><br>
<span class="lineno">420</span><span class="keyword" id="5700629">func</span>&nbsp;<span class="ident" id="5700634">rgbaToYCbCr</span><span class="op" id="5700645">(</span><span class="ident" id="5700646">m</span>&nbsp;<span class="op" id="5700648">*</span><span class="ident" id="5700649">image</span><span class="op" id="5700654">.</span><span class="ident" id="5700655">RGBA</span><span class="op" id="5700659">,</span>&nbsp;<span class="ident" id="5700661">p</span>&nbsp;<span class="ident" id="5700663">image</span><span class="op" id="5700668">.</span><span class="ident" id="5700669">Point</span><span class="op" id="5700674">,</span>&nbsp;<span class="ident" id="5700676">yBlock</span><span class="op" id="5700682">,</span>&nbsp;<span class="ident" id="5700684">cbBlock</span><span class="op" id="5700691">,</span>&nbsp;<span class="ident" id="5700693">crBlock</span>&nbsp;<span class="op" id="5700701">*</span><span class="ident" id="5700702">block</span><span class="op" id="5700707">)</span>&nbsp;<span class="op" id="5700709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700712">b</span>&nbsp;<span class="op" id="5700714">:=</span>&nbsp;<span class="ident" id="5700717">m</span><span class="op" id="5700718">.</span><span class="ident" id="5700719">Bounds</span><span class="op" id="5700725">(</span><span class="op" id="5700726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700729">xmax</span>&nbsp;<span class="op" id="5700734">:=</span>&nbsp;<span class="ident" id="5700737">b</span><span class="op" id="5700738">.</span><span class="ident" id="5700739">Max</span><span class="op" id="5700742">.</span><span class="ident" id="5700743">X</span>&nbsp;<span class="op" id="5700745">-</span>&nbsp;<span class="num" id="5700747">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700750">ymax</span>&nbsp;<span class="op" id="5700755">:=</span>&nbsp;<span class="ident" id="5700758">b</span><span class="op" id="5700759">.</span><span class="ident" id="5700760">Max</span><span class="op" id="5700763">.</span><span class="ident" id="5700764">Y</span>&nbsp;<span class="op" id="5700766">-</span>&nbsp;<span class="num" id="5700768">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700771">for</span>&nbsp;<span class="ident" id="5700775">j</span>&nbsp;<span class="op" id="5700777">:=</span>&nbsp;<span class="num" id="5700780">0</span><span class="op" id="5700781">;</span>&nbsp;<span class="ident" id="5700783">j</span>&nbsp;<span class="op" id="5700785">&lt;</span>&nbsp;<span class="num" id="5700787">8</span><span class="op" id="5700788">;</span>&nbsp;<span class="ident" id="5700790">j</span><span class="op" id="5700791">++</span>&nbsp;<span class="op" id="5700794">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700798">sj</span>&nbsp;<span class="op" id="5700801">:=</span>&nbsp;<span class="ident" id="5700804">p</span><span class="op" id="5700805">.</span><span class="ident" id="5700806">Y</span>&nbsp;<span class="op" id="5700808">+</span>&nbsp;<span class="ident" id="5700810">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700814">if</span>&nbsp;<span class="ident" id="5700817">sj</span>&nbsp;<span class="op" id="5700820">&gt;</span>&nbsp;<span class="ident" id="5700822">ymax</span>&nbsp;<span class="op" id="5700827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700832">sj</span>&nbsp;<span class="op" id="5700835">=</span>&nbsp;<span class="ident" id="5700837">ymax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5700844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700848">offset</span>&nbsp;<span class="op" id="5700855">:=</span>&nbsp;<span class="op" id="5700858">(</span><span class="ident" id="5700859">sj</span><span class="op" id="5700861">-</span><span class="ident" id="5700862">b</span><span class="op" id="5700863">.</span><span class="ident" id="5700864">Min</span><span class="op" id="5700867">.</span><span class="ident" id="5700868">Y</span><span class="op" id="5700869">)</span><span class="op" id="5700870">*</span><span class="ident" id="5700871">m</span><span class="op" id="5700872">.</span><span class="ident" id="5700873">Stride</span>&nbsp;<span class="op" id="5700880">-</span>&nbsp;<span class="ident" id="5700882">b</span><span class="op" id="5700883">.</span><span class="ident" id="5700884">Min</span><span class="op" id="5700887">.</span><span class="ident" id="5700888">X</span><span class="op" id="5700889">*</span><span class="num" id="5700890">4</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700894">for</span>&nbsp;<span class="ident" id="5700898">i</span>&nbsp;<span class="op" id="5700900">:=</span>&nbsp;<span class="num" id="5700903">0</span><span class="op" id="5700904">;</span>&nbsp;<span class="ident" id="5700906">i</span>&nbsp;<span class="op" id="5700908">&lt;</span>&nbsp;<span class="num" id="5700910">8</span><span class="op" id="5700911">;</span>&nbsp;<span class="ident" id="5700913">i</span><span class="op" id="5700914">++</span>&nbsp;<span class="op" id="5700917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700922">sx</span>&nbsp;<span class="op" id="5700925">:=</span>&nbsp;<span class="ident" id="5700928">p</span><span class="op" id="5700929">.</span><span class="ident" id="5700930">X</span>&nbsp;<span class="op" id="5700932">+</span>&nbsp;<span class="ident" id="5700934">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700939">if</span>&nbsp;<span class="ident" id="5700942">sx</span>&nbsp;<span class="op" id="5700945">&gt;</span>&nbsp;<span class="ident" id="5700947">xmax</span>&nbsp;<span class="op" id="5700952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700958">sx</span>&nbsp;<span class="op" id="5700961">=</span>&nbsp;<span class="ident" id="5700963">xmax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5700971">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700976">pix</span>&nbsp;<span class="op" id="5700980">:=</span>&nbsp;<span class="ident" id="5700983">m</span><span class="op" id="5700984">.</span><span class="ident" id="5700985">Pix</span><span class="op" id="5700988">[</span><span class="ident" id="5700989">offset</span><span class="op" id="5700995">+</span><span class="ident" id="5700996">sx</span><span class="op" id="5700998">*</span><span class="num" id="5700999">4</span><span class="op" id="5701000">:</span><span class="op" id="5701001">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701006">yy</span><span class="op" id="5701008">,</span>&nbsp;<span class="ident" id="5701010">cb</span><span class="op" id="5701012">,</span>&nbsp;<span class="ident" id="5701014">cr</span>&nbsp;<span class="op" id="5701017">:=</span>&nbsp;<span class="ident" id="5701020">color</span><span class="op" id="5701025">.</span><span class="ident" id="5701026">RGBToYCbCr</span><span class="op" id="5701036">(</span><span class="ident" id="5701037">pix</span><span class="op" id="5701040">[</span><span class="num" id="5701041">0</span><span class="op" id="5701042">]</span><span class="op" id="5701043">,</span>&nbsp;<span class="ident" id="5701045">pix</span><span class="op" id="5701048">[</span><span class="num" id="5701049">1</span><span class="op" id="5701050">]</span><span class="op" id="5701051">,</span>&nbsp;<span class="ident" id="5701053">pix</span><span class="op" id="5701056">[</span><span class="num" id="5701057">2</span><span class="op" id="5701058">]</span><span class="op" id="5701059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701064">yBlock</span><span class="op" id="5701070">[</span><span class="num" id="5701071">8</span><span class="op" id="5701072">*</span><span class="ident" id="5701073">j</span><span class="op" id="5701074">+</span><span class="ident" id="5701075">i</span><span class="op" id="5701076">]</span>&nbsp;<span class="op" id="5701078">=</span>&nbsp;<span class="builtintype" id="5701080">int32</span><span class="op" id="5701085">(</span><span class="ident" id="5701086">yy</span><span class="op" id="5701088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701093">cbBlock</span><span class="op" id="5701100">[</span><span class="num" id="5701101">8</span><span class="op" id="5701102">*</span><span class="ident" id="5701103">j</span><span class="op" id="5701104">+</span><span class="ident" id="5701105">i</span><span class="op" id="5701106">]</span>&nbsp;<span class="op" id="5701108">=</span>&nbsp;<span class="builtintype" id="5701110">int32</span><span class="op" id="5701115">(</span><span class="ident" id="5701116">cb</span><span class="op" id="5701118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701123">crBlock</span><span class="op" id="5701130">[</span><span class="num" id="5701131">8</span><span class="op" id="5701132">*</span><span class="ident" id="5701133">j</span><span class="op" id="5701134">+</span><span class="ident" id="5701135">i</span><span class="op" id="5701136">]</span>&nbsp;<span class="op" id="5701138">=</span>&nbsp;<span class="builtintype" id="5701140">int32</span><span class="op" id="5701145">(</span><span class="ident" id="5701146">cr</span><span class="op" id="5701148">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5701152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5701155">}</span><br>
<span class="lineno"></span><span class="op" id="5701157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5701160">//&nbsp;scale&nbsp;scales&nbsp;the&nbsp;16x16&nbsp;region&nbsp;represented&nbsp;by&nbsp;the&nbsp;4&nbsp;src&nbsp;blocks&nbsp;to&nbsp;the&nbsp;8x8</span><br>
<span class="lineno">445</span><span class="comment" id="5701236">//&nbsp;dst&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="5701250">func</span>&nbsp;<span class="ident" id="5701255">scale</span><span class="op" id="5701260">(</span><span class="ident" id="5701261">dst</span>&nbsp;<span class="op" id="5701265">*</span><span class="ident" id="5701266">block</span><span class="op" id="5701271">,</span>&nbsp;<span class="ident" id="5701273">src</span>&nbsp;<span class="op" id="5701277">*</span><span class="op" id="5701278">[</span><span class="num" id="5701279">4</span><span class="op" id="5701280">]</span><span class="ident" id="5701281">block</span><span class="op" id="5701286">)</span>&nbsp;<span class="op" id="5701288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701291">for</span>&nbsp;<span class="ident" id="5701295">i</span>&nbsp;<span class="op" id="5701297">:=</span>&nbsp;<span class="num" id="5701300">0</span><span class="op" id="5701301">;</span>&nbsp;<span class="ident" id="5701303">i</span>&nbsp;<span class="op" id="5701305">&lt;</span>&nbsp;<span class="num" id="5701307">4</span><span class="op" id="5701308">;</span>&nbsp;<span class="ident" id="5701310">i</span><span class="op" id="5701311">++</span>&nbsp;<span class="op" id="5701314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701318">dstOff</span>&nbsp;<span class="op" id="5701325">:=</span>&nbsp;<span class="op" id="5701328">(</span><span class="ident" id="5701329">i</span><span class="op" id="5701330">&amp;</span><span class="num" id="5701331">2</span><span class="op" id="5701332">)</span><span class="op" id="5701333">&lt;&lt;</span><span class="num" id="5701335">4</span>&nbsp;<span class="op" id="5701337">|</span>&nbsp;<span class="op" id="5701339">(</span><span class="ident" id="5701340">i</span><span class="op" id="5701341">&amp;</span><span class="num" id="5701342">1</span><span class="op" id="5701343">)</span><span class="op" id="5701344">&lt;&lt;</span><span class="num" id="5701346">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701350">for</span>&nbsp;<span class="ident" id="5701354">y</span>&nbsp;<span class="op" id="5701356">:=</span>&nbsp;<span class="num" id="5701359">0</span><span class="op" id="5701360">;</span>&nbsp;<span class="ident" id="5701362">y</span>&nbsp;<span class="op" id="5701364">&lt;</span>&nbsp;<span class="num" id="5701366">4</span><span class="op" id="5701367">;</span>&nbsp;<span class="ident" id="5701369">y</span><span class="op" id="5701370">++</span>&nbsp;<span class="op" id="5701373">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701378">for</span>&nbsp;<span class="ident" id="5701382">x</span>&nbsp;<span class="op" id="5701384">:=</span>&nbsp;<span class="num" id="5701387">0</span><span class="op" id="5701388">;</span>&nbsp;<span class="ident" id="5701390">x</span>&nbsp;<span class="op" id="5701392">&lt;</span>&nbsp;<span class="num" id="5701394">4</span><span class="op" id="5701395">;</span>&nbsp;<span class="ident" id="5701397">x</span><span class="op" id="5701398">++</span>&nbsp;<span class="op" id="5701401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701407">j</span>&nbsp;<span class="op" id="5701409">:=</span>&nbsp;<span class="num" id="5701412">16</span><span class="op" id="5701414">*</span><span class="ident" id="5701415">y</span>&nbsp;<span class="op" id="5701417">+</span>&nbsp;<span class="num" id="5701419">2</span><span class="op" id="5701420">*</span><span class="ident" id="5701421">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701427">sum</span>&nbsp;<span class="op" id="5701431">:=</span>&nbsp;<span class="ident" id="5701434">src</span><span class="op" id="5701437">[</span><span class="ident" id="5701438">i</span><span class="op" id="5701439">]</span><span class="op" id="5701440">[</span><span class="ident" id="5701441">j</span><span class="op" id="5701442">]</span>&nbsp;<span class="op" id="5701444">+</span>&nbsp;<span class="ident" id="5701446">src</span><span class="op" id="5701449">[</span><span class="ident" id="5701450">i</span><span class="op" id="5701451">]</span><span class="op" id="5701452">[</span><span class="ident" id="5701453">j</span><span class="op" id="5701454">+</span><span class="num" id="5701455">1</span><span class="op" id="5701456">]</span>&nbsp;<span class="op" id="5701458">+</span>&nbsp;<span class="ident" id="5701460">src</span><span class="op" id="5701463">[</span><span class="ident" id="5701464">i</span><span class="op" id="5701465">]</span><span class="op" id="5701466">[</span><span class="ident" id="5701467">j</span><span class="op" id="5701468">+</span><span class="num" id="5701469">8</span><span class="op" id="5701470">]</span>&nbsp;<span class="op" id="5701472">+</span>&nbsp;<span class="ident" id="5701474">src</span><span class="op" id="5701477">[</span><span class="ident" id="5701478">i</span><span class="op" id="5701479">]</span><span class="op" id="5701480">[</span><span class="ident" id="5701481">j</span><span class="op" id="5701482">+</span><span class="num" id="5701483">9</span><span class="op" id="5701484">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701490">dst</span><span class="op" id="5701493">[</span><span class="num" id="5701494">8</span><span class="op" id="5701495">*</span><span class="ident" id="5701496">y</span><span class="op" id="5701497">+</span><span class="ident" id="5701498">x</span><span class="op" id="5701499">+</span><span class="ident" id="5701500">dstOff</span><span class="op" id="5701506">]</span>&nbsp;<span class="op" id="5701508">=</span>&nbsp;<span class="op" id="5701510">(</span><span class="ident" id="5701511">sum</span>&nbsp;<span class="op" id="5701515">+</span>&nbsp;<span class="num" id="5701517">2</span><span class="op" id="5701518">)</span>&nbsp;<span class="op" id="5701520">&gt;&gt;</span>&nbsp;<span class="num" id="5701523">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5701528">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5701532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5701535">}</span><br>
<span class="lineno"></span><span class="op" id="5701537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5701540">//&nbsp;sosHeaderY&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;8&nbsp;bytes:</span><br>
<span class="lineno">460</span><span class="comment" id="5701604">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x08&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5701639">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x01&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5701677">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5701737">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5701808">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno">465</span><span class="comment" id="5701883">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="5701926">var</span>&nbsp;<span class="ident" id="5701930">sosHeaderY</span>&nbsp;<span class="op" id="5701941">=</span>&nbsp;<span class="op" id="5701943">[</span><span class="op" id="5701944">]</span><span class="builtintype" id="5701945">byte</span><span class="op" id="5701949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5701952">0xff</span><span class="op" id="5701956">,</span>&nbsp;<span class="num" id="5701958">0xda</span><span class="op" id="5701962">,</span>&nbsp;<span class="num" id="5701964">0x00</span><span class="op" id="5701968">,</span>&nbsp;<span class="num" id="5701970">0x08</span><span class="op" id="5701974">,</span>&nbsp;<span class="num" id="5701976">0x01</span><span class="op" id="5701980">,</span>&nbsp;<span class="num" id="5701982">0x01</span><span class="op" id="5701986">,</span>&nbsp;<span class="num" id="5701988">0x00</span><span class="op" id="5701992">,</span>&nbsp;<span class="num" id="5701994">0x00</span><span class="op" id="5701998">,</span>&nbsp;<span class="num" id="5702000">0x3f</span><span class="op" id="5702004">,</span>&nbsp;<span class="num" id="5702006">0x00</span><span class="op" id="5702010">,</span><br>
<span class="lineno"></span><span class="op" id="5702012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="5702015">//&nbsp;sosHeaderYCbCr&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;12&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="5702084">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x0c&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5702119">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x03&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5702157">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5702217">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;2&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x02\x11&#34;,</span><br>
<span class="lineno">475</span><span class="comment" id="5702277">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;3&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x03\x11&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5702337">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5702408">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno"></span><span class="comment" id="5702483">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="5702526">var</span>&nbsp;<span class="ident" id="5702530">sosHeaderYCbCr</span>&nbsp;<span class="op" id="5702545">=</span>&nbsp;<span class="op" id="5702547">[</span><span class="op" id="5702548">]</span><span class="builtintype" id="5702549">byte</span><span class="op" id="5702553">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5702556">0xff</span><span class="op" id="5702560">,</span>&nbsp;<span class="num" id="5702562">0xda</span><span class="op" id="5702566">,</span>&nbsp;<span class="num" id="5702568">0x00</span><span class="op" id="5702572">,</span>&nbsp;<span class="num" id="5702574">0x0c</span><span class="op" id="5702578">,</span>&nbsp;<span class="num" id="5702580">0x03</span><span class="op" id="5702584">,</span>&nbsp;<span class="num" id="5702586">0x01</span><span class="op" id="5702590">,</span>&nbsp;<span class="num" id="5702592">0x00</span><span class="op" id="5702596">,</span>&nbsp;<span class="num" id="5702598">0x02</span><span class="op" id="5702602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5702605">0x11</span><span class="op" id="5702609">,</span>&nbsp;<span class="num" id="5702611">0x03</span><span class="op" id="5702615">,</span>&nbsp;<span class="num" id="5702617">0x11</span><span class="op" id="5702621">,</span>&nbsp;<span class="num" id="5702623">0x00</span><span class="op" id="5702627">,</span>&nbsp;<span class="num" id="5702629">0x3f</span><span class="op" id="5702633">,</span>&nbsp;<span class="num" id="5702635">0x00</span><span class="op" id="5702639">,</span><br>
<span class="lineno"></span><span class="op" id="5702641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5702644">//&nbsp;writeSOS&nbsp;writes&nbsp;the&nbsp;StartOfScan&nbsp;marker.</span><br>
<span class="lineno">485</span><span class="keyword" id="5702687">func</span>&nbsp;<span class="op" id="5702692">(</span><span class="ident" id="5702693">e</span>&nbsp;<span class="op" id="5702695">*</span><span class="ident" id="5702696">encoder</span><span class="op" id="5702703">)</span>&nbsp;<span class="ident" id="5702705">writeSOS</span><span class="op" id="5702713">(</span><span class="ident" id="5702714">m</span>&nbsp;<span class="ident" id="5702716">image</span><span class="op" id="5702721">.</span><span class="ident" id="5702722">Image</span><span class="op" id="5702727">)</span>&nbsp;<span class="op" id="5702729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702732">switch</span>&nbsp;<span class="ident" id="5702739">m</span><span class="op" id="5702740">.</span><span class="op" id="5702741">(</span><span class="keyword" id="5702742">type</span><span class="op" id="5702746">)</span>&nbsp;<span class="op" id="5702748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702751">case</span>&nbsp;<span class="op" id="5702756">*</span><span class="ident" id="5702757">image</span><span class="op" id="5702762">.</span><span class="ident" id="5702763">Gray</span><span class="op" id="5702767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702771">e</span><span class="op" id="5702772">.</span><span class="ident" id="5702773">write</span><span class="op" id="5702778">(</span><span class="ident" id="5702779">sosHeaderY</span><span class="op" id="5702789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702792">default</span><span class="op" id="5702799">:</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702803">e</span><span class="op" id="5702804">.</span><span class="ident" id="5702805">write</span><span class="op" id="5702810">(</span><span class="ident" id="5702811">sosHeaderYCbCr</span><span class="op" id="5702825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702831">var</span>&nbsp;<span class="op" id="5702835">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702839">//&nbsp;Scratch&nbsp;buffers&nbsp;to&nbsp;hold&nbsp;the&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702886">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702938">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5702945">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702953">cb</span><span class="op" id="5702955">,</span>&nbsp;<span class="ident" id="5702957">cr</span>&nbsp;<span class="op" id="5702960">[</span><span class="num" id="5702961">4</span><span class="op" id="5702962">]</span><span class="ident" id="5702963">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702971">//&nbsp;DC&nbsp;components&nbsp;are&nbsp;delta-encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703009">prevDCY</span><span class="op" id="5703016">,</span>&nbsp;<span class="ident" id="5703018">prevDCCb</span><span class="op" id="5703026">,</span>&nbsp;<span class="ident" id="5703028">prevDCCr</span>&nbsp;<span class="builtintype" id="5703037">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703044">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703047">bounds</span>&nbsp;<span class="op" id="5703054">:=</span>&nbsp;<span class="ident" id="5703057">m</span><span class="op" id="5703058">.</span><span class="ident" id="5703059">Bounds</span><span class="op" id="5703065">(</span><span class="op" id="5703066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703069">switch</span>&nbsp;<span class="ident" id="5703076">m</span>&nbsp;<span class="op" id="5703078">:=</span>&nbsp;<span class="ident" id="5703081">m</span><span class="op" id="5703082">.</span><span class="op" id="5703083">(</span><span class="keyword" id="5703084">type</span><span class="op" id="5703088">)</span>&nbsp;<span class="op" id="5703090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5703093">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703155">case</span>&nbsp;<span class="op" id="5703160">*</span><span class="ident" id="5703161">image</span><span class="op" id="5703166">.</span><span class="ident" id="5703167">Gray</span><span class="op" id="5703171">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703175">for</span>&nbsp;<span class="ident" id="5703179">y</span>&nbsp;<span class="op" id="5703181">:=</span>&nbsp;<span class="ident" id="5703184">bounds</span><span class="op" id="5703190">.</span><span class="ident" id="5703191">Min</span><span class="op" id="5703194">.</span><span class="ident" id="5703195">Y</span><span class="op" id="5703196">;</span>&nbsp;<span class="ident" id="5703198">y</span>&nbsp;<span class="op" id="5703200">&lt;</span>&nbsp;<span class="ident" id="5703202">bounds</span><span class="op" id="5703208">.</span><span class="ident" id="5703209">Max</span><span class="op" id="5703212">.</span><span class="ident" id="5703213">Y</span><span class="op" id="5703214">;</span>&nbsp;<span class="ident" id="5703216">y</span>&nbsp;<span class="op" id="5703218">+=</span>&nbsp;<span class="num" id="5703221">8</span>&nbsp;<span class="op" id="5703223">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703228">for</span>&nbsp;<span class="ident" id="5703232">x</span>&nbsp;<span class="op" id="5703234">:=</span>&nbsp;<span class="ident" id="5703237">bounds</span><span class="op" id="5703243">.</span><span class="ident" id="5703244">Min</span><span class="op" id="5703247">.</span><span class="ident" id="5703248">X</span><span class="op" id="5703249">;</span>&nbsp;<span class="ident" id="5703251">x</span>&nbsp;<span class="op" id="5703253">&lt;</span>&nbsp;<span class="ident" id="5703255">bounds</span><span class="op" id="5703261">.</span><span class="ident" id="5703262">Max</span><span class="op" id="5703265">.</span><span class="ident" id="5703266">X</span><span class="op" id="5703267">;</span>&nbsp;<span class="ident" id="5703269">x</span>&nbsp;<span class="op" id="5703271">+=</span>&nbsp;<span class="num" id="5703274">8</span>&nbsp;<span class="op" id="5703276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703282">p</span>&nbsp;<span class="op" id="5703284">:=</span>&nbsp;<span class="ident" id="5703287">image</span><span class="op" id="5703292">.</span><span class="ident" id="5703293">Pt</span><span class="op" id="5703295">(</span><span class="ident" id="5703296">x</span><span class="op" id="5703297">,</span>&nbsp;<span class="ident" id="5703299">y</span><span class="op" id="5703300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703306">grayToY</span><span class="op" id="5703313">(</span><span class="ident" id="5703314">m</span><span class="op" id="5703315">,</span>&nbsp;<span class="ident" id="5703317">p</span><span class="op" id="5703318">,</span>&nbsp;<span class="op" id="5703320">&amp;</span><span class="ident" id="5703321">b</span><span class="op" id="5703322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703328">prevDCY</span>&nbsp;<span class="op" id="5703336">=</span>&nbsp;<span class="ident" id="5703338">e</span><span class="op" id="5703339">.</span><span class="ident" id="5703340">writeBlock</span><span class="op" id="5703350">(</span><span class="op" id="5703351">&amp;</span><span class="ident" id="5703352">b</span><span class="op" id="5703353">,</span>&nbsp;<span class="num" id="5703355">0</span><span class="op" id="5703356">,</span>&nbsp;<span class="ident" id="5703358">prevDCY</span><span class="op" id="5703365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703370">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703377">default</span><span class="op" id="5703384">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703388">rgba</span><span class="op" id="5703392">,</span>&nbsp;<span class="ident" id="5703394">_</span>&nbsp;<span class="op" id="5703396">:=</span>&nbsp;<span class="ident" id="5703399">m</span><span class="op" id="5703400">.</span><span class="op" id="5703401">(</span><span class="op" id="5703402">*</span><span class="ident" id="5703403">image</span><span class="op" id="5703408">.</span><span class="ident" id="5703409">RGBA</span><span class="op" id="5703413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703417">for</span>&nbsp;<span class="ident" id="5703421">y</span>&nbsp;<span class="op" id="5703423">:=</span>&nbsp;<span class="ident" id="5703426">bounds</span><span class="op" id="5703432">.</span><span class="ident" id="5703433">Min</span><span class="op" id="5703436">.</span><span class="ident" id="5703437">Y</span><span class="op" id="5703438">;</span>&nbsp;<span class="ident" id="5703440">y</span>&nbsp;<span class="op" id="5703442">&lt;</span>&nbsp;<span class="ident" id="5703444">bounds</span><span class="op" id="5703450">.</span><span class="ident" id="5703451">Max</span><span class="op" id="5703454">.</span><span class="ident" id="5703455">Y</span><span class="op" id="5703456">;</span>&nbsp;<span class="ident" id="5703458">y</span>&nbsp;<span class="op" id="5703460">+=</span>&nbsp;<span class="num" id="5703463">16</span>&nbsp;<span class="op" id="5703466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703471">for</span>&nbsp;<span class="ident" id="5703475">x</span>&nbsp;<span class="op" id="5703477">:=</span>&nbsp;<span class="ident" id="5703480">bounds</span><span class="op" id="5703486">.</span><span class="ident" id="5703487">Min</span><span class="op" id="5703490">.</span><span class="ident" id="5703491">X</span><span class="op" id="5703492">;</span>&nbsp;<span class="ident" id="5703494">x</span>&nbsp;<span class="op" id="5703496">&lt;</span>&nbsp;<span class="ident" id="5703498">bounds</span><span class="op" id="5703504">.</span><span class="ident" id="5703505">Max</span><span class="op" id="5703508">.</span><span class="ident" id="5703509">X</span><span class="op" id="5703510">;</span>&nbsp;<span class="ident" id="5703512">x</span>&nbsp;<span class="op" id="5703514">+=</span>&nbsp;<span class="num" id="5703517">16</span>&nbsp;<span class="op" id="5703520">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703526">for</span>&nbsp;<span class="ident" id="5703530">i</span>&nbsp;<span class="op" id="5703532">:=</span>&nbsp;<span class="num" id="5703535">0</span><span class="op" id="5703536">;</span>&nbsp;<span class="ident" id="5703538">i</span>&nbsp;<span class="op" id="5703540">&lt;</span>&nbsp;<span class="num" id="5703542">4</span><span class="op" id="5703543">;</span>&nbsp;<span class="ident" id="5703545">i</span><span class="op" id="5703546">++</span>&nbsp;<span class="op" id="5703549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703556">xOff</span>&nbsp;<span class="op" id="5703561">:=</span>&nbsp;<span class="op" id="5703564">(</span><span class="ident" id="5703565">i</span>&nbsp;<span class="op" id="5703567">&amp;</span>&nbsp;<span class="num" id="5703569">1</span><span class="op" id="5703570">)</span>&nbsp;<span class="op" id="5703572">*</span>&nbsp;<span class="num" id="5703574">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703581">yOff</span>&nbsp;<span class="op" id="5703586">:=</span>&nbsp;<span class="op" id="5703589">(</span><span class="ident" id="5703590">i</span>&nbsp;<span class="op" id="5703592">&amp;</span>&nbsp;<span class="num" id="5703594">2</span><span class="op" id="5703595">)</span>&nbsp;<span class="op" id="5703597">*</span>&nbsp;<span class="num" id="5703599">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703606">p</span>&nbsp;<span class="op" id="5703608">:=</span>&nbsp;<span class="ident" id="5703611">image</span><span class="op" id="5703616">.</span><span class="ident" id="5703617">Pt</span><span class="op" id="5703619">(</span><span class="ident" id="5703620">x</span><span class="op" id="5703621">+</span><span class="ident" id="5703622">xOff</span><span class="op" id="5703626">,</span>&nbsp;<span class="ident" id="5703628">y</span><span class="op" id="5703629">+</span><span class="ident" id="5703630">yOff</span><span class="op" id="5703634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703641">if</span>&nbsp;<span class="ident" id="5703644">rgba</span>&nbsp;<span class="op" id="5703649">!=</span>&nbsp;<span class="ident" id="5703652">nil</span>&nbsp;<span class="op" id="5703656">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703664">rgbaToYCbCr</span><span class="op" id="5703675">(</span><span class="ident" id="5703676">rgba</span><span class="op" id="5703680">,</span>&nbsp;<span class="ident" id="5703682">p</span><span class="op" id="5703683">,</span>&nbsp;<span class="op" id="5703685">&amp;</span><span class="ident" id="5703686">b</span><span class="op" id="5703687">,</span>&nbsp;<span class="op" id="5703689">&amp;</span><span class="ident" id="5703690">cb</span><span class="op" id="5703692">[</span><span class="ident" id="5703693">i</span><span class="op" id="5703694">]</span><span class="op" id="5703695">,</span>&nbsp;<span class="op" id="5703697">&amp;</span><span class="ident" id="5703698">cr</span><span class="op" id="5703700">[</span><span class="ident" id="5703701">i</span><span class="op" id="5703702">]</span><span class="op" id="5703703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703710">}</span>&nbsp;<span class="keyword" id="5703712">else</span>&nbsp;<span class="op" id="5703717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703725">toYCbCr</span><span class="op" id="5703732">(</span><span class="ident" id="5703733">m</span><span class="op" id="5703734">,</span>&nbsp;<span class="ident" id="5703736">p</span><span class="op" id="5703737">,</span>&nbsp;<span class="op" id="5703739">&amp;</span><span class="ident" id="5703740">b</span><span class="op" id="5703741">,</span>&nbsp;<span class="op" id="5703743">&amp;</span><span class="ident" id="5703744">cb</span><span class="op" id="5703746">[</span><span class="ident" id="5703747">i</span><span class="op" id="5703748">]</span><span class="op" id="5703749">,</span>&nbsp;<span class="op" id="5703751">&amp;</span><span class="ident" id="5703752">cr</span><span class="op" id="5703754">[</span><span class="ident" id="5703755">i</span><span class="op" id="5703756">]</span><span class="op" id="5703757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703771">prevDCY</span>&nbsp;<span class="op" id="5703779">=</span>&nbsp;<span class="ident" id="5703781">e</span><span class="op" id="5703782">.</span><span class="ident" id="5703783">writeBlock</span><span class="op" id="5703793">(</span><span class="op" id="5703794">&amp;</span><span class="ident" id="5703795">b</span><span class="op" id="5703796">,</span>&nbsp;<span class="num" id="5703798">0</span><span class="op" id="5703799">,</span>&nbsp;<span class="ident" id="5703801">prevDCY</span><span class="op" id="5703808">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703820">scale</span><span class="op" id="5703825">(</span><span class="op" id="5703826">&amp;</span><span class="ident" id="5703827">b</span><span class="op" id="5703828">,</span>&nbsp;<span class="op" id="5703830">&amp;</span><span class="ident" id="5703831">cb</span><span class="op" id="5703833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703839">prevDCCb</span>&nbsp;<span class="op" id="5703848">=</span>&nbsp;<span class="ident" id="5703850">e</span><span class="op" id="5703851">.</span><span class="ident" id="5703852">writeBlock</span><span class="op" id="5703862">(</span><span class="op" id="5703863">&amp;</span><span class="ident" id="5703864">b</span><span class="op" id="5703865">,</span>&nbsp;<span class="num" id="5703867">1</span><span class="op" id="5703868">,</span>&nbsp;<span class="ident" id="5703870">prevDCCb</span><span class="op" id="5703878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703884">scale</span><span class="op" id="5703889">(</span><span class="op" id="5703890">&amp;</span><span class="ident" id="5703891">b</span><span class="op" id="5703892">,</span>&nbsp;<span class="op" id="5703894">&amp;</span><span class="ident" id="5703895">cr</span><span class="op" id="5703897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703903">prevDCCr</span>&nbsp;<span class="op" id="5703912">=</span>&nbsp;<span class="ident" id="5703914">e</span><span class="op" id="5703915">.</span><span class="ident" id="5703916">writeBlock</span><span class="op" id="5703926">(</span><span class="op" id="5703927">&amp;</span><span class="ident" id="5703928">b</span><span class="op" id="5703929">,</span>&nbsp;<span class="num" id="5703931">1</span><span class="op" id="5703932">,</span>&nbsp;<span class="ident" id="5703934">prevDCCr</span><span class="op" id="5703942">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5703957">//&nbsp;Pad&nbsp;the&nbsp;last&nbsp;byte&nbsp;with&nbsp;1&#39;s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703989">e</span><span class="op" id="5703990">.</span><span class="ident" id="5703991">emit</span><span class="op" id="5703995">(</span><span class="num" id="5703996">0x7f</span><span class="op" id="5704000">,</span>&nbsp;<span class="num" id="5704002">7</span><span class="op" id="5704003">)</span><br>
<span class="lineno">535</span><span class="op" id="5704005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5704008">//&nbsp;DefaultQuality&nbsp;is&nbsp;the&nbsp;default&nbsp;quality&nbsp;encoding&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="5704069">const</span>&nbsp;<span class="ident" id="5704075">DefaultQuality</span>&nbsp;<span class="op" id="5704090">=</span>&nbsp;<span class="num" id="5704092">75</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="5704096">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="comment" id="5704136">//&nbsp;Quality&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;100&nbsp;inclusive,&nbsp;higher&nbsp;is&nbsp;better.</span><br>
<span class="lineno"></span><span class="keyword" id="5704197">type</span>&nbsp;<span class="ident" id="5704202">Options</span>&nbsp;<span class="keyword" id="5704210">struct</span>&nbsp;<span class="op" id="5704217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704220">Quality</span>&nbsp;<span class="builtintype" id="5704228">int</span><br>
<span class="lineno"></span><span class="op" id="5704232">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="5704235">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;JPEG&nbsp;4:2:0&nbsp;baseline&nbsp;format&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="5704314">//&nbsp;options.&nbsp;Default&nbsp;parameters&nbsp;are&nbsp;used&nbsp;if&nbsp;a&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;passed.</span><br>
<span class="lineno"></span><span class="keyword" id="5704383">func</span>&nbsp;<span class="ident" id="5704388">Encode</span><span class="op" id="5704394">(</span><span class="ident" id="5704395">w</span>&nbsp;<span class="ident" id="5704397">io</span><span class="op" id="5704399">.</span><span class="ident" id="5704400">Writer</span><span class="op" id="5704406">,</span>&nbsp;<span class="ident" id="5704408">m</span>&nbsp;<span class="ident" id="5704410">image</span><span class="op" id="5704415">.</span><span class="ident" id="5704416">Image</span><span class="op" id="5704421">,</span>&nbsp;<span class="ident" id="5704423">o</span>&nbsp;<span class="op" id="5704425">*</span><span class="ident" id="5704426">Options</span><span class="op" id="5704433">)</span>&nbsp;<span class="builtintype" id="5704435">error</span>&nbsp;<span class="op" id="5704441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704444">b</span>&nbsp;<span class="op" id="5704446">:=</span>&nbsp;<span class="ident" id="5704449">m</span><span class="op" id="5704450">.</span><span class="ident" id="5704451">Bounds</span><span class="op" id="5704457">(</span><span class="op" id="5704458">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704461">if</span>&nbsp;<span class="ident" id="5704464">b</span><span class="op" id="5704465">.</span><span class="ident" id="5704466">Dx</span><span class="op" id="5704468">(</span><span class="op" id="5704469">)</span>&nbsp;<span class="op" id="5704471">&gt;=</span>&nbsp;<span class="num" id="5704474">1</span><span class="op" id="5704475">&lt;&lt;</span><span class="num" id="5704477">16</span>&nbsp;<span class="op" id="5704480">||</span>&nbsp;<span class="ident" id="5704483">b</span><span class="op" id="5704484">.</span><span class="ident" id="5704485">Dy</span><span class="op" id="5704487">(</span><span class="op" id="5704488">)</span>&nbsp;<span class="op" id="5704490">&gt;=</span>&nbsp;<span class="num" id="5704493">1</span><span class="op" id="5704494">&lt;&lt;</span><span class="num" id="5704496">16</span>&nbsp;<span class="op" id="5704499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704503">return</span>&nbsp;<span class="ident" id="5704510">errors</span><span class="op" id="5704516">.</span><span class="ident" id="5704517">New</span><span class="op" id="5704520">(</span><span class="string" id="5704521">&#34;jpeg:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="5704557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704563">var</span>&nbsp;<span class="ident" id="5704567">e</span>&nbsp;<span class="ident" id="5704569">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704578">if</span>&nbsp;<span class="ident" id="5704581">ww</span><span class="op" id="5704583">,</span>&nbsp;<span class="ident" id="5704585">ok</span>&nbsp;<span class="op" id="5704588">:=</span>&nbsp;<span class="ident" id="5704591">w</span><span class="op" id="5704592">.</span><span class="op" id="5704593">(</span><span class="ident" id="5704594">writer</span><span class="op" id="5704600">)</span><span class="op" id="5704601">;</span>&nbsp;<span class="ident" id="5704603">ok</span>&nbsp;<span class="op" id="5704606">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704610">e</span><span class="op" id="5704611">.</span><span class="ident" id="5704612">w</span>&nbsp;<span class="op" id="5704614">=</span>&nbsp;<span class="ident" id="5704616">ww</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704620">}</span>&nbsp;<span class="keyword" id="5704622">else</span>&nbsp;<span class="op" id="5704627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704631">e</span><span class="op" id="5704632">.</span><span class="ident" id="5704633">w</span>&nbsp;<span class="op" id="5704635">=</span>&nbsp;<span class="ident" id="5704637">bufio</span><span class="op" id="5704642">.</span><span class="ident" id="5704643">NewWriter</span><span class="op" id="5704652">(</span><span class="ident" id="5704653">w</span><span class="op" id="5704654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5704660">//&nbsp;Clip&nbsp;quality&nbsp;to&nbsp;[1,&nbsp;100].</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704690">quality</span>&nbsp;<span class="op" id="5704698">:=</span>&nbsp;<span class="ident" id="5704701">DefaultQuality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704717">if</span>&nbsp;<span class="ident" id="5704720">o</span>&nbsp;<span class="op" id="5704722">!=</span>&nbsp;<span class="ident" id="5704725">nil</span>&nbsp;<span class="op" id="5704729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704733">quality</span>&nbsp;<span class="op" id="5704741">=</span>&nbsp;<span class="ident" id="5704743">o</span><span class="op" id="5704744">.</span><span class="ident" id="5704745">Quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704755">if</span>&nbsp;<span class="ident" id="5704758">quality</span>&nbsp;<span class="op" id="5704766">&lt;</span>&nbsp;<span class="num" id="5704768">1</span>&nbsp;<span class="op" id="5704770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704775">quality</span>&nbsp;<span class="op" id="5704783">=</span>&nbsp;<span class="num" id="5704785">1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704789">}</span>&nbsp;<span class="keyword" id="5704791">else</span>&nbsp;<span class="keyword" id="5704796">if</span>&nbsp;<span class="ident" id="5704799">quality</span>&nbsp;<span class="op" id="5704807">&gt;</span>&nbsp;<span class="num" id="5704809">100</span>&nbsp;<span class="op" id="5704813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704818">quality</span>&nbsp;<span class="op" id="5704826">=</span>&nbsp;<span class="num" id="5704828">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5704840">//&nbsp;Convert&nbsp;from&nbsp;a&nbsp;quality&nbsp;rating&nbsp;to&nbsp;a&nbsp;scaling&nbsp;factor.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704895">var</span>&nbsp;<span class="ident" id="5704899">scale</span>&nbsp;<span class="builtintype" id="5704905">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704910">if</span>&nbsp;<span class="ident" id="5704913">quality</span>&nbsp;<span class="op" id="5704921">&lt;</span>&nbsp;<span class="num" id="5704923">50</span>&nbsp;<span class="op" id="5704926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704930">scale</span>&nbsp;<span class="op" id="5704936">=</span>&nbsp;<span class="num" id="5704938">5000</span>&nbsp;<span class="op" id="5704943">/</span>&nbsp;<span class="ident" id="5704945">quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704954">}</span>&nbsp;<span class="keyword" id="5704956">else</span>&nbsp;<span class="op" id="5704961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704965">scale</span>&nbsp;<span class="op" id="5704971">=</span>&nbsp;<span class="num" id="5704973">200</span>&nbsp;<span class="op" id="5704977">-</span>&nbsp;<span class="ident" id="5704979">quality</span><span class="op" id="5704986">*</span><span class="num" id="5704987">2</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5704993">//&nbsp;Initialize&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705033">for</span>&nbsp;<span class="ident" id="5705037">i</span>&nbsp;<span class="op" id="5705039">:=</span>&nbsp;<span class="keyword" id="5705042">range</span>&nbsp;<span class="ident" id="5705048">e</span><span class="op" id="5705049">.</span><span class="ident" id="5705050">quant</span>&nbsp;<span class="op" id="5705056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705060">for</span>&nbsp;<span class="ident" id="5705064">j</span>&nbsp;<span class="op" id="5705066">:=</span>&nbsp;<span class="keyword" id="5705069">range</span>&nbsp;<span class="ident" id="5705075">e</span><span class="op" id="5705076">.</span><span class="ident" id="5705077">quant</span><span class="op" id="5705082">[</span><span class="ident" id="5705083">i</span><span class="op" id="5705084">]</span>&nbsp;<span class="op" id="5705086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705091">x</span>&nbsp;<span class="op" id="5705093">:=</span>&nbsp;<span class="builtintype" id="5705096">int</span><span class="op" id="5705099">(</span><span class="ident" id="5705100">unscaledQuant</span><span class="op" id="5705113">[</span><span class="ident" id="5705114">i</span><span class="op" id="5705115">]</span><span class="op" id="5705116">[</span><span class="ident" id="5705117">j</span><span class="op" id="5705118">]</span><span class="op" id="5705119">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705124">x</span>&nbsp;<span class="op" id="5705126">=</span>&nbsp;<span class="op" id="5705128">(</span><span class="ident" id="5705129">x</span><span class="op" id="5705130">*</span><span class="ident" id="5705131">scale</span>&nbsp;<span class="op" id="5705137">+</span>&nbsp;<span class="num" id="5705139">50</span><span class="op" id="5705141">)</span>&nbsp;<span class="op" id="5705143">/</span>&nbsp;<span class="num" id="5705145">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705152">if</span>&nbsp;<span class="ident" id="5705155">x</span>&nbsp;<span class="op" id="5705157">&lt;</span>&nbsp;<span class="num" id="5705159">1</span>&nbsp;<span class="op" id="5705161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705167">x</span>&nbsp;<span class="op" id="5705169">=</span>&nbsp;<span class="num" id="5705171">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5705176">}</span>&nbsp;<span class="keyword" id="5705178">else</span>&nbsp;<span class="keyword" id="5705183">if</span>&nbsp;<span class="ident" id="5705186">x</span>&nbsp;<span class="op" id="5705188">&gt;</span>&nbsp;<span class="num" id="5705190">255</span>&nbsp;<span class="op" id="5705194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705200">x</span>&nbsp;<span class="op" id="5705202">=</span>&nbsp;<span class="num" id="5705204">255</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5705211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705216">e</span><span class="op" id="5705217">.</span><span class="ident" id="5705218">quant</span><span class="op" id="5705223">[</span><span class="ident" id="5705224">i</span><span class="op" id="5705225">]</span><span class="op" id="5705226">[</span><span class="ident" id="5705227">j</span><span class="op" id="5705228">]</span>&nbsp;<span class="op" id="5705230">=</span>&nbsp;<span class="builtintype" id="5705232">uint8</span><span class="op" id="5705237">(</span><span class="ident" id="5705238">x</span><span class="op" id="5705239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5705243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5705246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5705249">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;components&nbsp;based&nbsp;on&nbsp;input&nbsp;image&nbsp;type.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705309">nComponent</span>&nbsp;<span class="op" id="5705320">:=</span>&nbsp;<span class="num" id="5705323">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705326">switch</span>&nbsp;<span class="ident" id="5705333">m</span><span class="op" id="5705334">.</span><span class="op" id="5705335">(</span><span class="keyword" id="5705336">type</span><span class="op" id="5705340">)</span>&nbsp;<span class="op" id="5705342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5705345">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705407">case</span>&nbsp;<span class="op" id="5705412">*</span><span class="ident" id="5705413">image</span><span class="op" id="5705418">.</span><span class="ident" id="5705419">Gray</span><span class="op" id="5705423">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705427">nComponent</span>&nbsp;<span class="op" id="5705438">=</span>&nbsp;<span class="num" id="5705440">1</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5705443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5705446">//&nbsp;Write&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705483">e</span><span class="op" id="5705484">.</span><span class="ident" id="5705485">buf</span><span class="op" id="5705488">[</span><span class="num" id="5705489">0</span><span class="op" id="5705490">]</span>&nbsp;<span class="op" id="5705492">=</span>&nbsp;<span class="num" id="5705494">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705500">e</span><span class="op" id="5705501">.</span><span class="ident" id="5705502">buf</span><span class="op" id="5705505">[</span><span class="num" id="5705506">1</span><span class="op" id="5705507">]</span>&nbsp;<span class="op" id="5705509">=</span>&nbsp;<span class="num" id="5705511">0xd8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705517">e</span><span class="op" id="5705518">.</span><span class="ident" id="5705519">write</span><span class="op" id="5705524">(</span><span class="ident" id="5705525">e</span><span class="op" id="5705526">.</span><span class="ident" id="5705527">buf</span><span class="op" id="5705530">[</span><span class="op" id="5705531">:</span><span class="num" id="5705532">2</span><span class="op" id="5705533">]</span><span class="op" id="5705534">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5705537">//&nbsp;Write&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705572">e</span><span class="op" id="5705573">.</span><span class="ident" id="5705574">writeDQT</span><span class="op" id="5705582">(</span><span class="op" id="5705583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5705586">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;dimensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705618">e</span><span class="op" id="5705619">.</span><span class="ident" id="5705620">writeSOF0</span><span class="op" id="5705629">(</span><span class="ident" id="5705630">b</span><span class="op" id="5705631">.</span><span class="ident" id="5705632">Size</span><span class="op" id="5705636">(</span><span class="op" id="5705637">)</span><span class="op" id="5705638">,</span>&nbsp;<span class="ident" id="5705640">nComponent</span><span class="op" id="5705650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5705653">//&nbsp;Write&nbsp;the&nbsp;Huffman&nbsp;tables.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705683">e</span><span class="op" id="5705684">.</span><span class="ident" id="5705685">writeDHT</span><span class="op" id="5705693">(</span><span class="ident" id="5705694">nComponent</span><span class="op" id="5705704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5705707">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705733">e</span><span class="op" id="5705734">.</span><span class="ident" id="5705735">writeSOS</span><span class="op" id="5705743">(</span><span class="ident" id="5705744">m</span><span class="op" id="5705745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5705748">//&nbsp;Write&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705783">e</span><span class="op" id="5705784">.</span><span class="ident" id="5705785">buf</span><span class="op" id="5705788">[</span><span class="num" id="5705789">0</span><span class="op" id="5705790">]</span>&nbsp;<span class="op" id="5705792">=</span>&nbsp;<span class="num" id="5705794">0xff</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705800">e</span><span class="op" id="5705801">.</span><span class="ident" id="5705802">buf</span><span class="op" id="5705805">[</span><span class="num" id="5705806">1</span><span class="op" id="5705807">]</span>&nbsp;<span class="op" id="5705809">=</span>&nbsp;<span class="num" id="5705811">0xd9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705817">e</span><span class="op" id="5705818">.</span><span class="ident" id="5705819">write</span><span class="op" id="5705824">(</span><span class="ident" id="5705825">e</span><span class="op" id="5705826">.</span><span class="ident" id="5705827">buf</span><span class="op" id="5705830">[</span><span class="op" id="5705831">:</span><span class="num" id="5705832">2</span><span class="op" id="5705833">]</span><span class="op" id="5705834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705837">e</span><span class="op" id="5705838">.</span><span class="ident" id="5705839">flush</span><span class="op" id="5705844">(</span><span class="op" id="5705845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705848">return</span>&nbsp;<span class="ident" id="5705855">e</span><span class="op" id="5705856">.</span><span class="ident" id="5705857">err</span><br>
<span class="lineno"></span><span class="op" id="5705861">}</span>
</div>
</body>
</html>
