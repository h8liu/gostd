<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3462003">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3462058">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3462112">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3462163">package</span>&nbsp;<span class="ident" id="3462171">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3462176">import</span>&nbsp;<span class="op" id="3462183">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3462186">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3462196">&#34;crypto/hmac&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3462211">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3462225">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3462240">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3462257">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="3462264">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3462267">//&nbsp;Split&nbsp;a&nbsp;premaster&nbsp;secret&nbsp;in&nbsp;two&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3462339">func</span>&nbsp;<span class="ident" id="3462344">splitPreMasterSecret</span><span class="op" id="3462364">(</span><span class="ident" id="3462365">secret</span>&nbsp;<span class="op" id="3462372">[</span><span class="op" id="3462373">]</span><span class="builtintype" id="3462374">byte</span><span class="op" id="3462378">)</span>&nbsp;<span class="op" id="3462380">(</span><span class="ident" id="3462381">s1</span><span class="op" id="3462383">,</span>&nbsp;<span class="ident" id="3462385">s2</span>&nbsp;<span class="op" id="3462388">[</span><span class="op" id="3462389">]</span><span class="builtintype" id="3462390">byte</span><span class="op" id="3462394">)</span>&nbsp;<span class="op" id="3462396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3462399">s1</span>&nbsp;<span class="op" id="3462402">=</span>&nbsp;<span class="ident" id="3462404">secret</span><span class="op" id="3462410">[</span><span class="num" id="3462411">0</span>&nbsp;<span class="op" id="3462413">:</span>&nbsp;<span class="op" id="3462415">(</span><span class="builtinfunc" id="3462416">len</span><span class="op" id="3462419">(</span><span class="ident" id="3462420">secret</span><span class="op" id="3462426">)</span><span class="op" id="3462427">+</span><span class="num" id="3462428">1</span><span class="op" id="3462429">)</span><span class="op" id="3462430">/</span><span class="num" id="3462431">2</span><span class="op" id="3462432">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3462435">s2</span>&nbsp;<span class="op" id="3462438">=</span>&nbsp;<span class="ident" id="3462440">secret</span><span class="op" id="3462446">[</span><span class="builtinfunc" id="3462447">len</span><span class="op" id="3462450">(</span><span class="ident" id="3462451">secret</span><span class="op" id="3462457">)</span><span class="op" id="3462458">/</span><span class="num" id="3462459">2</span><span class="op" id="3462460">:</span><span class="op" id="3462461">]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3462464">return</span><br>
<span class="lineno"></span><span class="op" id="3462471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3462474">//&nbsp;pHash&nbsp;implements&nbsp;the&nbsp;P_hash&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3462550">func</span>&nbsp;<span class="ident" id="3462555">pHash</span><span class="op" id="3462560">(</span><span class="ident" id="3462561">result</span><span class="op" id="3462567">,</span>&nbsp;<span class="ident" id="3462569">secret</span><span class="op" id="3462575">,</span>&nbsp;<span class="ident" id="3462577">seed</span>&nbsp;<span class="op" id="3462582">[</span><span class="op" id="3462583">]</span><span class="builtintype" id="3462584">byte</span><span class="op" id="3462588">,</span>&nbsp;<span class="ident" id="3462590">hash</span>&nbsp;<span class="keyword" id="3462595">func</span><span class="op" id="3462599">(</span><span class="op" id="3462600">)</span>&nbsp;<span class="ident" id="3462602">hash</span><span class="op" id="3462606">.</span><span class="ident" id="3462607">Hash</span><span class="op" id="3462611">)</span>&nbsp;<span class="op" id="3462613">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3462616">h</span>&nbsp;<span class="op" id="3462618">:=</span>&nbsp;<span class="ident" id="3462621">hmac</span><span class="op" id="3462625">.</span><span class="ident" id="3462626">New</span><span class="op" id="3462629">(</span><span class="ident" id="3462630">hash</span><span class="op" id="3462634">,</span>&nbsp;<span class="ident" id="3462636">secret</span><span class="op" id="3462642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3462645">h</span><span class="op" id="3462646">.</span><span class="ident" id="3462647">Write</span><span class="op" id="3462652">(</span><span class="ident" id="3462653">seed</span><span class="op" id="3462657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3462660">a</span>&nbsp;<span class="op" id="3462662">:=</span>&nbsp;<span class="ident" id="3462665">h</span><span class="op" id="3462666">.</span><span class="ident" id="3462667">Sum</span><span class="op" id="3462670">(</span><span class="ident" id="3462671">nil</span><span class="op" id="3462674">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3462678">j</span>&nbsp;<span class="op" id="3462680">:=</span>&nbsp;<span class="num" id="3462683">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3462686">for</span>&nbsp;<span class="ident" id="3462690">j</span>&nbsp;<span class="op" id="3462692">&lt;</span>&nbsp;<span class="builtinfunc" id="3462694">len</span><span class="op" id="3462697">(</span><span class="ident" id="3462698">result</span><span class="op" id="3462704">)</span>&nbsp;<span class="op" id="3462706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3462710">h</span><span class="op" id="3462711">.</span><span class="ident" id="3462712">Reset</span><span class="op" id="3462717">(</span><span class="op" id="3462718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3462722">h</span><span class="op" id="3462723">.</span><span class="ident" id="3462724">Write</span><span class="op" id="3462729">(</span><span class="ident" id="3462730">a</span><span class="op" id="3462731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3462735">h</span><span class="op" id="3462736">.</span><span class="ident" id="3462737">Write</span><span class="op" id="3462742">(</span><span class="ident" id="3462743">seed</span><span class="op" id="3462747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3462751">b</span>&nbsp;<span class="op" id="3462753">:=</span>&nbsp;<span class="ident" id="3462756">h</span><span class="op" id="3462757">.</span><span class="ident" id="3462758">Sum</span><span class="op" id="3462761">(</span><span class="ident" id="3462762">nil</span><span class="op" id="3462765">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3462769">todo</span>&nbsp;<span class="op" id="3462774">:=</span>&nbsp;<span class="builtinfunc" id="3462777">len</span><span class="op" id="3462780">(</span><span class="ident" id="3462781">b</span><span class="op" id="3462782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3462786">if</span>&nbsp;<span class="ident" id="3462789">j</span><span class="op" id="3462790">+</span><span class="ident" id="3462791">todo</span>&nbsp;<span class="op" id="3462796">&gt;</span>&nbsp;<span class="builtinfunc" id="3462798">len</span><span class="op" id="3462801">(</span><span class="ident" id="3462802">result</span><span class="op" id="3462808">)</span>&nbsp;<span class="op" id="3462810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3462815">todo</span>&nbsp;<span class="op" id="3462820">=</span>&nbsp;<span class="builtinfunc" id="3462822">len</span><span class="op" id="3462825">(</span><span class="ident" id="3462826">result</span><span class="op" id="3462832">)</span>&nbsp;<span class="op" id="3462834">-</span>&nbsp;<span class="ident" id="3462836">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3462840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3462844">copy</span><span class="op" id="3462848">(</span><span class="ident" id="3462849">result</span><span class="op" id="3462855">[</span><span class="ident" id="3462856">j</span><span class="op" id="3462857">:</span><span class="ident" id="3462858">j</span><span class="op" id="3462859">+</span><span class="ident" id="3462860">todo</span><span class="op" id="3462864">]</span><span class="op" id="3462865">,</span>&nbsp;<span class="ident" id="3462867">b</span><span class="op" id="3462868">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3462872">j</span>&nbsp;<span class="op" id="3462874">+=</span>&nbsp;<span class="ident" id="3462877">todo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3462885">h</span><span class="op" id="3462886">.</span><span class="ident" id="3462887">Reset</span><span class="op" id="3462892">(</span><span class="op" id="3462893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3462897">h</span><span class="op" id="3462898">.</span><span class="ident" id="3462899">Write</span><span class="op" id="3462904">(</span><span class="ident" id="3462905">a</span><span class="op" id="3462906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3462910">a</span>&nbsp;<span class="op" id="3462912">=</span>&nbsp;<span class="ident" id="3462914">h</span><span class="op" id="3462915">.</span><span class="ident" id="3462916">Sum</span><span class="op" id="3462919">(</span><span class="ident" id="3462920">nil</span><span class="op" id="3462923">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3462926">}</span><br>
<span class="lineno"></span><span class="op" id="3462928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3462931">//&nbsp;prf10&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3463022">func</span>&nbsp;<span class="ident" id="3463027">prf10</span><span class="op" id="3463032">(</span><span class="ident" id="3463033">result</span><span class="op" id="3463039">,</span>&nbsp;<span class="ident" id="3463041">secret</span><span class="op" id="3463047">,</span>&nbsp;<span class="ident" id="3463049">label</span><span class="op" id="3463054">,</span>&nbsp;<span class="ident" id="3463056">seed</span>&nbsp;<span class="op" id="3463061">[</span><span class="op" id="3463062">]</span><span class="builtintype" id="3463063">byte</span><span class="op" id="3463067">)</span>&nbsp;<span class="op" id="3463069">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3463072">hashSHA1</span>&nbsp;<span class="op" id="3463081">:=</span>&nbsp;<span class="ident" id="3463084">sha1</span><span class="op" id="3463088">.</span><span class="ident" id="3463089">New</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3463094">hashMD5</span>&nbsp;<span class="op" id="3463102">:=</span>&nbsp;<span class="ident" id="3463105">md5</span><span class="op" id="3463108">.</span><span class="ident" id="3463109">New</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3463115">labelAndSeed</span>&nbsp;<span class="op" id="3463128">:=</span>&nbsp;<span class="builtinfunc" id="3463131">make</span><span class="op" id="3463135">(</span><span class="op" id="3463136">[</span><span class="op" id="3463137">]</span><span class="builtintype" id="3463138">byte</span><span class="op" id="3463142">,</span>&nbsp;<span class="builtinfunc" id="3463144">len</span><span class="op" id="3463147">(</span><span class="ident" id="3463148">label</span><span class="op" id="3463153">)</span><span class="op" id="3463154">+</span><span class="builtinfunc" id="3463155">len</span><span class="op" id="3463158">(</span><span class="ident" id="3463159">seed</span><span class="op" id="3463163">)</span><span class="op" id="3463164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3463167">copy</span><span class="op" id="3463171">(</span><span class="ident" id="3463172">labelAndSeed</span><span class="op" id="3463184">,</span>&nbsp;<span class="ident" id="3463186">label</span><span class="op" id="3463191">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3463194">copy</span><span class="op" id="3463198">(</span><span class="ident" id="3463199">labelAndSeed</span><span class="op" id="3463211">[</span><span class="builtinfunc" id="3463212">len</span><span class="op" id="3463215">(</span><span class="ident" id="3463216">label</span><span class="op" id="3463221">)</span><span class="op" id="3463222">:</span><span class="op" id="3463223">]</span><span class="op" id="3463224">,</span>&nbsp;<span class="ident" id="3463226">seed</span><span class="op" id="3463230">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3463234">s1</span><span class="op" id="3463236">,</span>&nbsp;<span class="ident" id="3463238">s2</span>&nbsp;<span class="op" id="3463241">:=</span>&nbsp;<span class="ident" id="3463244">splitPreMasterSecret</span><span class="op" id="3463264">(</span><span class="ident" id="3463265">secret</span><span class="op" id="3463271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3463274">pHash</span><span class="op" id="3463279">(</span><span class="ident" id="3463280">result</span><span class="op" id="3463286">,</span>&nbsp;<span class="ident" id="3463288">s1</span><span class="op" id="3463290">,</span>&nbsp;<span class="ident" id="3463292">labelAndSeed</span><span class="op" id="3463304">,</span>&nbsp;<span class="ident" id="3463306">hashMD5</span><span class="op" id="3463313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3463316">result2</span>&nbsp;<span class="op" id="3463324">:=</span>&nbsp;<span class="builtinfunc" id="3463327">make</span><span class="op" id="3463331">(</span><span class="op" id="3463332">[</span><span class="op" id="3463333">]</span><span class="builtintype" id="3463334">byte</span><span class="op" id="3463338">,</span>&nbsp;<span class="builtinfunc" id="3463340">len</span><span class="op" id="3463343">(</span><span class="ident" id="3463344">result</span><span class="op" id="3463350">)</span><span class="op" id="3463351">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3463354">pHash</span><span class="op" id="3463359">(</span><span class="ident" id="3463360">result2</span><span class="op" id="3463367">,</span>&nbsp;<span class="ident" id="3463369">s2</span><span class="op" id="3463371">,</span>&nbsp;<span class="ident" id="3463373">labelAndSeed</span><span class="op" id="3463385">,</span>&nbsp;<span class="ident" id="3463387">hashSHA1</span><span class="op" id="3463395">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463399">for</span>&nbsp;<span class="ident" id="3463403">i</span><span class="op" id="3463404">,</span>&nbsp;<span class="ident" id="3463406">b</span>&nbsp;<span class="op" id="3463408">:=</span>&nbsp;<span class="keyword" id="3463411">range</span>&nbsp;<span class="ident" id="3463417">result2</span>&nbsp;<span class="op" id="3463425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3463429">result</span><span class="op" id="3463435">[</span><span class="ident" id="3463436">i</span><span class="op" id="3463437">]</span>&nbsp;<span class="op" id="3463439">^=</span>&nbsp;<span class="ident" id="3463442">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3463445">}</span><br>
<span class="lineno">65</span><span class="op" id="3463447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3463450">//&nbsp;prf12&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.2&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3463541">func</span>&nbsp;<span class="ident" id="3463546">prf12</span><span class="op" id="3463551">(</span><span class="ident" id="3463552">result</span><span class="op" id="3463558">,</span>&nbsp;<span class="ident" id="3463560">secret</span><span class="op" id="3463566">,</span>&nbsp;<span class="ident" id="3463568">label</span><span class="op" id="3463573">,</span>&nbsp;<span class="ident" id="3463575">seed</span>&nbsp;<span class="op" id="3463580">[</span><span class="op" id="3463581">]</span><span class="builtintype" id="3463582">byte</span><span class="op" id="3463586">)</span>&nbsp;<span class="op" id="3463588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3463591">labelAndSeed</span>&nbsp;<span class="op" id="3463604">:=</span>&nbsp;<span class="builtinfunc" id="3463607">make</span><span class="op" id="3463611">(</span><span class="op" id="3463612">[</span><span class="op" id="3463613">]</span><span class="builtintype" id="3463614">byte</span><span class="op" id="3463618">,</span>&nbsp;<span class="builtinfunc" id="3463620">len</span><span class="op" id="3463623">(</span><span class="ident" id="3463624">label</span><span class="op" id="3463629">)</span><span class="op" id="3463630">+</span><span class="builtinfunc" id="3463631">len</span><span class="op" id="3463634">(</span><span class="ident" id="3463635">seed</span><span class="op" id="3463639">)</span><span class="op" id="3463640">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3463643">copy</span><span class="op" id="3463647">(</span><span class="ident" id="3463648">labelAndSeed</span><span class="op" id="3463660">,</span>&nbsp;<span class="ident" id="3463662">label</span><span class="op" id="3463667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3463670">copy</span><span class="op" id="3463674">(</span><span class="ident" id="3463675">labelAndSeed</span><span class="op" id="3463687">[</span><span class="builtinfunc" id="3463688">len</span><span class="op" id="3463691">(</span><span class="ident" id="3463692">label</span><span class="op" id="3463697">)</span><span class="op" id="3463698">:</span><span class="op" id="3463699">]</span><span class="op" id="3463700">,</span>&nbsp;<span class="ident" id="3463702">seed</span><span class="op" id="3463706">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3463710">pHash</span><span class="op" id="3463715">(</span><span class="ident" id="3463716">result</span><span class="op" id="3463722">,</span>&nbsp;<span class="ident" id="3463724">secret</span><span class="op" id="3463730">,</span>&nbsp;<span class="ident" id="3463732">labelAndSeed</span><span class="op" id="3463744">,</span>&nbsp;<span class="ident" id="3463746">sha256</span><span class="op" id="3463752">.</span><span class="ident" id="3463753">New</span><span class="op" id="3463756">)</span><br>
<span class="lineno"></span><span class="op" id="3463758">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="3463761">//&nbsp;prf30&nbsp;implements&nbsp;the&nbsp;SSL&nbsp;3.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3463831">//&nbsp;www.mozilla.org/projects/security/pki/nss/ssl/draft302.txt&nbsp;section&nbsp;6.</span><br>
<span class="lineno"></span><span class="keyword" id="3463904">func</span>&nbsp;<span class="ident" id="3463909">prf30</span><span class="op" id="3463914">(</span><span class="ident" id="3463915">result</span><span class="op" id="3463921">,</span>&nbsp;<span class="ident" id="3463923">secret</span><span class="op" id="3463929">,</span>&nbsp;<span class="ident" id="3463931">label</span><span class="op" id="3463936">,</span>&nbsp;<span class="ident" id="3463938">seed</span>&nbsp;<span class="op" id="3463943">[</span><span class="op" id="3463944">]</span><span class="builtintype" id="3463945">byte</span><span class="op" id="3463949">)</span>&nbsp;<span class="op" id="3463951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3463954">hashSHA1</span>&nbsp;<span class="op" id="3463963">:=</span>&nbsp;<span class="ident" id="3463966">sha1</span><span class="op" id="3463970">.</span><span class="ident" id="3463971">New</span><span class="op" id="3463974">(</span><span class="op" id="3463975">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3463978">hashMD5</span>&nbsp;<span class="op" id="3463986">:=</span>&nbsp;<span class="ident" id="3463989">md5</span><span class="op" id="3463992">.</span><span class="ident" id="3463993">New</span><span class="op" id="3463996">(</span><span class="op" id="3463997">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464001">done</span>&nbsp;<span class="op" id="3464006">:=</span>&nbsp;<span class="num" id="3464009">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464012">i</span>&nbsp;<span class="op" id="3464014">:=</span>&nbsp;<span class="num" id="3464017">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3464020">//&nbsp;RFC5246&nbsp;section&nbsp;6.3&nbsp;says&nbsp;that&nbsp;the&nbsp;largest&nbsp;PRF&nbsp;output&nbsp;needed&nbsp;is&nbsp;128</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3464091">//&nbsp;bytes.&nbsp;Since&nbsp;no&nbsp;more&nbsp;ciphersuites&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;SSLv3,&nbsp;this&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3464163">//&nbsp;remain&nbsp;true.&nbsp;Each&nbsp;iteration&nbsp;gives&nbsp;us&nbsp;16&nbsp;bytes&nbsp;so&nbsp;10&nbsp;iterations&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3464235">//&nbsp;be&nbsp;sufficient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3464254">var</span>&nbsp;<span class="ident" id="3464258">b</span>&nbsp;<span class="op" id="3464260">[</span><span class="num" id="3464261">11</span><span class="op" id="3464263">]</span><span class="builtintype" id="3464264">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3464270">for</span>&nbsp;<span class="ident" id="3464274">done</span>&nbsp;<span class="op" id="3464279">&lt;</span>&nbsp;<span class="builtinfunc" id="3464281">len</span><span class="op" id="3464284">(</span><span class="ident" id="3464285">result</span><span class="op" id="3464291">)</span>&nbsp;<span class="op" id="3464293">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3464297">for</span>&nbsp;<span class="ident" id="3464301">j</span>&nbsp;<span class="op" id="3464303">:=</span>&nbsp;<span class="num" id="3464306">0</span><span class="op" id="3464307">;</span>&nbsp;<span class="ident" id="3464309">j</span>&nbsp;<span class="op" id="3464311">&lt;=</span>&nbsp;<span class="ident" id="3464314">i</span><span class="op" id="3464315">;</span>&nbsp;<span class="ident" id="3464317">j</span><span class="op" id="3464318">++</span>&nbsp;<span class="op" id="3464321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464326">b</span><span class="op" id="3464327">[</span><span class="ident" id="3464328">j</span><span class="op" id="3464329">]</span>&nbsp;<span class="op" id="3464331">=</span>&nbsp;<span class="string" id="3464333">&#39;A&#39;</span>&nbsp;<span class="op" id="3464337">+</span>&nbsp;<span class="builtintype" id="3464339">byte</span><span class="op" id="3464343">(</span><span class="ident" id="3464344">i</span><span class="op" id="3464345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3464349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464354">hashSHA1</span><span class="op" id="3464362">.</span><span class="ident" id="3464363">Reset</span><span class="op" id="3464368">(</span><span class="op" id="3464369">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464373">hashSHA1</span><span class="op" id="3464381">.</span><span class="ident" id="3464382">Write</span><span class="op" id="3464387">(</span><span class="ident" id="3464388">b</span><span class="op" id="3464389">[</span><span class="op" id="3464390">:</span><span class="ident" id="3464391">i</span><span class="op" id="3464392">+</span><span class="num" id="3464393">1</span><span class="op" id="3464394">]</span><span class="op" id="3464395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464399">hashSHA1</span><span class="op" id="3464407">.</span><span class="ident" id="3464408">Write</span><span class="op" id="3464413">(</span><span class="ident" id="3464414">secret</span><span class="op" id="3464420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464424">hashSHA1</span><span class="op" id="3464432">.</span><span class="ident" id="3464433">Write</span><span class="op" id="3464438">(</span><span class="ident" id="3464439">seed</span><span class="op" id="3464443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464447">digest</span>&nbsp;<span class="op" id="3464454">:=</span>&nbsp;<span class="ident" id="3464457">hashSHA1</span><span class="op" id="3464465">.</span><span class="ident" id="3464466">Sum</span><span class="op" id="3464469">(</span><span class="ident" id="3464470">nil</span><span class="op" id="3464473">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464478">hashMD5</span><span class="op" id="3464485">.</span><span class="ident" id="3464486">Reset</span><span class="op" id="3464491">(</span><span class="op" id="3464492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464496">hashMD5</span><span class="op" id="3464503">.</span><span class="ident" id="3464504">Write</span><span class="op" id="3464509">(</span><span class="ident" id="3464510">secret</span><span class="op" id="3464516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464520">hashMD5</span><span class="op" id="3464527">.</span><span class="ident" id="3464528">Write</span><span class="op" id="3464533">(</span><span class="ident" id="3464534">digest</span><span class="op" id="3464540">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464545">done</span>&nbsp;<span class="op" id="3464550">+=</span>&nbsp;<span class="builtinfunc" id="3464553">copy</span><span class="op" id="3464557">(</span><span class="ident" id="3464558">result</span><span class="op" id="3464564">[</span><span class="ident" id="3464565">done</span><span class="op" id="3464569">:</span><span class="op" id="3464570">]</span><span class="op" id="3464571">,</span>&nbsp;<span class="ident" id="3464573">hashMD5</span><span class="op" id="3464580">.</span><span class="ident" id="3464581">Sum</span><span class="op" id="3464584">(</span><span class="ident" id="3464585">nil</span><span class="op" id="3464588">)</span><span class="op" id="3464589">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464593">i</span><span class="op" id="3464594">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3464598">}</span><br>
<span class="lineno"></span><span class="op" id="3464600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3464603">const</span>&nbsp;<span class="op" id="3464609">(</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464612">tlsRandomLength</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3464633">=</span>&nbsp;<span class="num" id="3464635">32</span>&nbsp;<span class="comment" id="3464638">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;random&nbsp;nonce&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464679">masterSecretLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3464700">=</span>&nbsp;<span class="num" id="3464702">48</span>&nbsp;<span class="comment" id="3464705">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;master&nbsp;secret&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464747">finishedVerifyLength</span>&nbsp;<span class="op" id="3464768">=</span>&nbsp;<span class="num" id="3464770">12</span>&nbsp;<span class="comment" id="3464773">//&nbsp;Length&nbsp;of&nbsp;verify_data&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="op" id="3464821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="3464824">var</span>&nbsp;<span class="ident" id="3464828">masterSecretLabel</span>&nbsp;<span class="op" id="3464846">=</span>&nbsp;<span class="op" id="3464848">[</span><span class="op" id="3464849">]</span><span class="builtintype" id="3464850">byte</span><span class="op" id="3464854">(</span><span class="string" id="3464855">&#34;master&nbsp;secret&#34;</span><span class="op" id="3464870">)</span><br>
<span class="lineno"></span><span class="keyword" id="3464872">var</span>&nbsp;<span class="ident" id="3464876">keyExpansionLabel</span>&nbsp;<span class="op" id="3464894">=</span>&nbsp;<span class="op" id="3464896">[</span><span class="op" id="3464897">]</span><span class="builtintype" id="3464898">byte</span><span class="op" id="3464902">(</span><span class="string" id="3464903">&#34;key&nbsp;expansion&#34;</span><span class="op" id="3464918">)</span><br>
<span class="lineno"></span><span class="keyword" id="3464920">var</span>&nbsp;<span class="ident" id="3464924">clientFinishedLabel</span>&nbsp;<span class="op" id="3464944">=</span>&nbsp;<span class="op" id="3464946">[</span><span class="op" id="3464947">]</span><span class="builtintype" id="3464948">byte</span><span class="op" id="3464952">(</span><span class="string" id="3464953">&#34;client&nbsp;finished&#34;</span><span class="op" id="3464970">)</span><br>
<span class="lineno"></span><span class="keyword" id="3464972">var</span>&nbsp;<span class="ident" id="3464976">serverFinishedLabel</span>&nbsp;<span class="op" id="3464996">=</span>&nbsp;<span class="op" id="3464998">[</span><span class="op" id="3464999">]</span><span class="builtintype" id="3465000">byte</span><span class="op" id="3465004">(</span><span class="string" id="3465005">&#34;server&nbsp;finished&#34;</span><span class="op" id="3465022">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="3465025">func</span>&nbsp;<span class="ident" id="3465030">prfForVersion</span><span class="op" id="3465043">(</span><span class="ident" id="3465044">version</span>&nbsp;<span class="builtintype" id="3465052">uint16</span><span class="op" id="3465058">)</span>&nbsp;<span class="keyword" id="3465060">func</span><span class="op" id="3465064">(</span><span class="ident" id="3465065">result</span><span class="op" id="3465071">,</span>&nbsp;<span class="ident" id="3465073">secret</span><span class="op" id="3465079">,</span>&nbsp;<span class="ident" id="3465081">label</span><span class="op" id="3465086">,</span>&nbsp;<span class="ident" id="3465088">seed</span>&nbsp;<span class="op" id="3465093">[</span><span class="op" id="3465094">]</span><span class="builtintype" id="3465095">byte</span><span class="op" id="3465099">)</span>&nbsp;<span class="op" id="3465101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465104">switch</span>&nbsp;<span class="ident" id="3465111">version</span>&nbsp;<span class="op" id="3465119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465122">case</span>&nbsp;<span class="ident" id="3465127">VersionSSL30</span><span class="op" id="3465139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465143">return</span>&nbsp;<span class="ident" id="3465150">prf30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465157">case</span>&nbsp;<span class="ident" id="3465162">VersionTLS10</span><span class="op" id="3465174">,</span>&nbsp;<span class="ident" id="3465176">VersionTLS11</span><span class="op" id="3465188">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465192">return</span>&nbsp;<span class="ident" id="3465199">prf10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465206">case</span>&nbsp;<span class="ident" id="3465211">VersionTLS12</span><span class="op" id="3465223">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465227">return</span>&nbsp;<span class="ident" id="3465234">prf12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465241">default</span><span class="op" id="3465248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3465252">panic</span><span class="op" id="3465257">(</span><span class="string" id="3465258">&#34;unknown&nbsp;version&#34;</span><span class="op" id="3465275">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3465278">}</span><br>
<span class="lineno"></span><span class="op" id="3465280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3465283">//&nbsp;masterFromPreMasterSecret&nbsp;generates&nbsp;the&nbsp;master&nbsp;secret&nbsp;from&nbsp;the&nbsp;pre-master</span><br>
<span class="lineno"></span><span class="comment" id="3465360">//&nbsp;secret.&nbsp;See&nbsp;http://tools.ietf.org/html/rfc5246#section-8.1</span><br>
<span class="lineno">135</span><span class="keyword" id="3465422">func</span>&nbsp;<span class="ident" id="3465427">masterFromPreMasterSecret</span><span class="op" id="3465452">(</span><span class="ident" id="3465453">version</span>&nbsp;<span class="builtintype" id="3465461">uint16</span><span class="op" id="3465467">,</span>&nbsp;<span class="ident" id="3465469">preMasterSecret</span><span class="op" id="3465484">,</span>&nbsp;<span class="ident" id="3465486">clientRandom</span><span class="op" id="3465498">,</span>&nbsp;<span class="ident" id="3465500">serverRandom</span>&nbsp;<span class="op" id="3465513">[</span><span class="op" id="3465514">]</span><span class="builtintype" id="3465515">byte</span><span class="op" id="3465519">)</span>&nbsp;<span class="op" id="3465521">[</span><span class="op" id="3465522">]</span><span class="builtintype" id="3465523">byte</span>&nbsp;<span class="op" id="3465528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465531">var</span>&nbsp;<span class="ident" id="3465535">seed</span>&nbsp;<span class="op" id="3465540">[</span><span class="ident" id="3465541">tlsRandomLength</span>&nbsp;<span class="op" id="3465557">*</span>&nbsp;<span class="num" id="3465559">2</span><span class="op" id="3465560">]</span><span class="builtintype" id="3465561">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3465567">copy</span><span class="op" id="3465571">(</span><span class="ident" id="3465572">seed</span><span class="op" id="3465576">[</span><span class="num" id="3465577">0</span><span class="op" id="3465578">:</span><span class="builtinfunc" id="3465579">len</span><span class="op" id="3465582">(</span><span class="ident" id="3465583">clientRandom</span><span class="op" id="3465595">)</span><span class="op" id="3465596">]</span><span class="op" id="3465597">,</span>&nbsp;<span class="ident" id="3465599">clientRandom</span><span class="op" id="3465611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3465614">copy</span><span class="op" id="3465618">(</span><span class="ident" id="3465619">seed</span><span class="op" id="3465623">[</span><span class="builtinfunc" id="3465624">len</span><span class="op" id="3465627">(</span><span class="ident" id="3465628">clientRandom</span><span class="op" id="3465640">)</span><span class="op" id="3465641">:</span><span class="op" id="3465642">]</span><span class="op" id="3465643">,</span>&nbsp;<span class="ident" id="3465645">serverRandom</span><span class="op" id="3465657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3465660">masterSecret</span>&nbsp;<span class="op" id="3465673">:=</span>&nbsp;<span class="builtinfunc" id="3465676">make</span><span class="op" id="3465680">(</span><span class="op" id="3465681">[</span><span class="op" id="3465682">]</span><span class="builtintype" id="3465683">byte</span><span class="op" id="3465687">,</span>&nbsp;<span class="ident" id="3465689">masterSecretLength</span><span class="op" id="3465707">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3465710">prfForVersion</span><span class="op" id="3465723">(</span><span class="ident" id="3465724">version</span><span class="op" id="3465731">)</span><span class="op" id="3465732">(</span><span class="ident" id="3465733">masterSecret</span><span class="op" id="3465745">,</span>&nbsp;<span class="ident" id="3465747">preMasterSecret</span><span class="op" id="3465762">,</span>&nbsp;<span class="ident" id="3465764">masterSecretLabel</span><span class="op" id="3465781">,</span>&nbsp;<span class="ident" id="3465783">seed</span><span class="op" id="3465787">[</span><span class="num" id="3465788">0</span><span class="op" id="3465789">:</span><span class="op" id="3465790">]</span><span class="op" id="3465791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465794">return</span>&nbsp;<span class="ident" id="3465801">masterSecret</span><br>
<span class="lineno"></span><span class="op" id="3465814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3465817">//&nbsp;keysFromMasterSecret&nbsp;generates&nbsp;the&nbsp;connection&nbsp;keys&nbsp;from&nbsp;the&nbsp;master</span><br>
<span class="lineno">145</span><span class="comment" id="3465887">//&nbsp;secret,&nbsp;given&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MAC&nbsp;key,&nbsp;cipher&nbsp;key&nbsp;and&nbsp;IV,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3465965">//&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;6.3.</span><br>
<span class="lineno"></span><span class="keyword" id="3465991">func</span>&nbsp;<span class="ident" id="3465996">keysFromMasterSecret</span><span class="op" id="3466016">(</span><span class="ident" id="3466017">version</span>&nbsp;<span class="builtintype" id="3466025">uint16</span><span class="op" id="3466031">,</span>&nbsp;<span class="ident" id="3466033">masterSecret</span><span class="op" id="3466045">,</span>&nbsp;<span class="ident" id="3466047">clientRandom</span><span class="op" id="3466059">,</span>&nbsp;<span class="ident" id="3466061">serverRandom</span>&nbsp;<span class="op" id="3466074">[</span><span class="op" id="3466075">]</span><span class="builtintype" id="3466076">byte</span><span class="op" id="3466080">,</span>&nbsp;<span class="ident" id="3466082">macLen</span><span class="op" id="3466088">,</span>&nbsp;<span class="ident" id="3466090">keyLen</span><span class="op" id="3466096">,</span>&nbsp;<span class="ident" id="3466098">ivLen</span>&nbsp;<span class="builtintype" id="3466104">int</span><span class="op" id="3466107">)</span>&nbsp;<span class="op" id="3466109">(</span><span class="ident" id="3466110">clientMAC</span><span class="op" id="3466119">,</span>&nbsp;<span class="ident" id="3466121">serverMAC</span><span class="op" id="3466130">,</span>&nbsp;<span class="ident" id="3466132">clientKey</span><span class="op" id="3466141">,</span>&nbsp;<span class="ident" id="3466143">serverKey</span><span class="op" id="3466152">,</span>&nbsp;<span class="ident" id="3466154">clientIV</span><span class="op" id="3466162">,</span>&nbsp;<span class="ident" id="3466164">serverIV</span>&nbsp;<span class="op" id="3466173">[</span><span class="op" id="3466174">]</span><span class="builtintype" id="3466175">byte</span><span class="op" id="3466179">)</span>&nbsp;<span class="op" id="3466181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466184">var</span>&nbsp;<span class="ident" id="3466188">seed</span>&nbsp;<span class="op" id="3466193">[</span><span class="ident" id="3466194">tlsRandomLength</span>&nbsp;<span class="op" id="3466210">*</span>&nbsp;<span class="num" id="3466212">2</span><span class="op" id="3466213">]</span><span class="builtintype" id="3466214">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3466220">copy</span><span class="op" id="3466224">(</span><span class="ident" id="3466225">seed</span><span class="op" id="3466229">[</span><span class="num" id="3466230">0</span><span class="op" id="3466231">:</span><span class="builtinfunc" id="3466232">len</span><span class="op" id="3466235">(</span><span class="ident" id="3466236">clientRandom</span><span class="op" id="3466248">)</span><span class="op" id="3466249">]</span><span class="op" id="3466250">,</span>&nbsp;<span class="ident" id="3466252">serverRandom</span><span class="op" id="3466264">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3466267">copy</span><span class="op" id="3466271">(</span><span class="ident" id="3466272">seed</span><span class="op" id="3466276">[</span><span class="builtinfunc" id="3466277">len</span><span class="op" id="3466280">(</span><span class="ident" id="3466281">serverRandom</span><span class="op" id="3466293">)</span><span class="op" id="3466294">:</span><span class="op" id="3466295">]</span><span class="op" id="3466296">,</span>&nbsp;<span class="ident" id="3466298">clientRandom</span><span class="op" id="3466310">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466314">n</span>&nbsp;<span class="op" id="3466316">:=</span>&nbsp;<span class="num" id="3466319">2</span><span class="op" id="3466320">*</span><span class="ident" id="3466321">macLen</span>&nbsp;<span class="op" id="3466328">+</span>&nbsp;<span class="num" id="3466330">2</span><span class="op" id="3466331">*</span><span class="ident" id="3466332">keyLen</span>&nbsp;<span class="op" id="3466339">+</span>&nbsp;<span class="num" id="3466341">2</span><span class="op" id="3466342">*</span><span class="ident" id="3466343">ivLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466350">keyMaterial</span>&nbsp;<span class="op" id="3466362">:=</span>&nbsp;<span class="builtinfunc" id="3466365">make</span><span class="op" id="3466369">(</span><span class="op" id="3466370">[</span><span class="op" id="3466371">]</span><span class="builtintype" id="3466372">byte</span><span class="op" id="3466376">,</span>&nbsp;<span class="ident" id="3466378">n</span><span class="op" id="3466379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466382">prfForVersion</span><span class="op" id="3466395">(</span><span class="ident" id="3466396">version</span><span class="op" id="3466403">)</span><span class="op" id="3466404">(</span><span class="ident" id="3466405">keyMaterial</span><span class="op" id="3466416">,</span>&nbsp;<span class="ident" id="3466418">masterSecret</span><span class="op" id="3466430">,</span>&nbsp;<span class="ident" id="3466432">keyExpansionLabel</span><span class="op" id="3466449">,</span>&nbsp;<span class="ident" id="3466451">seed</span><span class="op" id="3466455">[</span><span class="num" id="3466456">0</span><span class="op" id="3466457">:</span><span class="op" id="3466458">]</span><span class="op" id="3466459">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466462">clientMAC</span>&nbsp;<span class="op" id="3466472">=</span>&nbsp;<span class="ident" id="3466474">keyMaterial</span><span class="op" id="3466485">[</span><span class="op" id="3466486">:</span><span class="ident" id="3466487">macLen</span><span class="op" id="3466493">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466496">keyMaterial</span>&nbsp;<span class="op" id="3466508">=</span>&nbsp;<span class="ident" id="3466510">keyMaterial</span><span class="op" id="3466521">[</span><span class="ident" id="3466522">macLen</span><span class="op" id="3466528">:</span><span class="op" id="3466529">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466532">serverMAC</span>&nbsp;<span class="op" id="3466542">=</span>&nbsp;<span class="ident" id="3466544">keyMaterial</span><span class="op" id="3466555">[</span><span class="op" id="3466556">:</span><span class="ident" id="3466557">macLen</span><span class="op" id="3466563">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466566">keyMaterial</span>&nbsp;<span class="op" id="3466578">=</span>&nbsp;<span class="ident" id="3466580">keyMaterial</span><span class="op" id="3466591">[</span><span class="ident" id="3466592">macLen</span><span class="op" id="3466598">:</span><span class="op" id="3466599">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466602">clientKey</span>&nbsp;<span class="op" id="3466612">=</span>&nbsp;<span class="ident" id="3466614">keyMaterial</span><span class="op" id="3466625">[</span><span class="op" id="3466626">:</span><span class="ident" id="3466627">keyLen</span><span class="op" id="3466633">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466636">keyMaterial</span>&nbsp;<span class="op" id="3466648">=</span>&nbsp;<span class="ident" id="3466650">keyMaterial</span><span class="op" id="3466661">[</span><span class="ident" id="3466662">keyLen</span><span class="op" id="3466668">:</span><span class="op" id="3466669">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466672">serverKey</span>&nbsp;<span class="op" id="3466682">=</span>&nbsp;<span class="ident" id="3466684">keyMaterial</span><span class="op" id="3466695">[</span><span class="op" id="3466696">:</span><span class="ident" id="3466697">keyLen</span><span class="op" id="3466703">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466706">keyMaterial</span>&nbsp;<span class="op" id="3466718">=</span>&nbsp;<span class="ident" id="3466720">keyMaterial</span><span class="op" id="3466731">[</span><span class="ident" id="3466732">keyLen</span><span class="op" id="3466738">:</span><span class="op" id="3466739">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466742">clientIV</span>&nbsp;<span class="op" id="3466751">=</span>&nbsp;<span class="ident" id="3466753">keyMaterial</span><span class="op" id="3466764">[</span><span class="op" id="3466765">:</span><span class="ident" id="3466766">ivLen</span><span class="op" id="3466771">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466774">keyMaterial</span>&nbsp;<span class="op" id="3466786">=</span>&nbsp;<span class="ident" id="3466788">keyMaterial</span><span class="op" id="3466799">[</span><span class="ident" id="3466800">ivLen</span><span class="op" id="3466805">:</span><span class="op" id="3466806">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466809">serverIV</span>&nbsp;<span class="op" id="3466818">=</span>&nbsp;<span class="ident" id="3466820">keyMaterial</span><span class="op" id="3466831">[</span><span class="op" id="3466832">:</span><span class="ident" id="3466833">ivLen</span><span class="op" id="3466838">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466841">return</span><br>
<span class="lineno"></span><span class="op" id="3466848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3466851">func</span>&nbsp;<span class="ident" id="3466856">newFinishedHash</span><span class="op" id="3466871">(</span><span class="ident" id="3466872">version</span>&nbsp;<span class="builtintype" id="3466880">uint16</span><span class="op" id="3466886">)</span>&nbsp;<span class="ident" id="3466888">finishedHash</span>&nbsp;<span class="op" id="3466901">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466904">if</span>&nbsp;<span class="ident" id="3466907">version</span>&nbsp;<span class="op" id="3466915">&gt;=</span>&nbsp;<span class="ident" id="3466918">VersionTLS12</span>&nbsp;<span class="op" id="3466931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466935">return</span>&nbsp;<span class="ident" id="3466942">finishedHash</span><span class="op" id="3466954">{</span><span class="ident" id="3466955">sha256</span><span class="op" id="3466961">.</span><span class="ident" id="3466962">New</span><span class="op" id="3466965">(</span><span class="op" id="3466966">)</span><span class="op" id="3466967">,</span>&nbsp;<span class="ident" id="3466969">sha256</span><span class="op" id="3466975">.</span><span class="ident" id="3466976">New</span><span class="op" id="3466979">(</span><span class="op" id="3466980">)</span><span class="op" id="3466981">,</span>&nbsp;<span class="ident" id="3466983">nil</span><span class="op" id="3466986">,</span>&nbsp;<span class="ident" id="3466988">nil</span><span class="op" id="3466991">,</span>&nbsp;<span class="ident" id="3466993">version</span><span class="op" id="3467000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3467003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467006">return</span>&nbsp;<span class="ident" id="3467013">finishedHash</span><span class="op" id="3467025">{</span><span class="ident" id="3467026">sha1</span><span class="op" id="3467030">.</span><span class="ident" id="3467031">New</span><span class="op" id="3467034">(</span><span class="op" id="3467035">)</span><span class="op" id="3467036">,</span>&nbsp;<span class="ident" id="3467038">sha1</span><span class="op" id="3467042">.</span><span class="ident" id="3467043">New</span><span class="op" id="3467046">(</span><span class="op" id="3467047">)</span><span class="op" id="3467048">,</span>&nbsp;<span class="ident" id="3467050">md5</span><span class="op" id="3467053">.</span><span class="ident" id="3467054">New</span><span class="op" id="3467057">(</span><span class="op" id="3467058">)</span><span class="op" id="3467059">,</span>&nbsp;<span class="ident" id="3467061">md5</span><span class="op" id="3467064">.</span><span class="ident" id="3467065">New</span><span class="op" id="3467068">(</span><span class="op" id="3467069">)</span><span class="op" id="3467070">,</span>&nbsp;<span class="ident" id="3467072">version</span><span class="op" id="3467079">}</span><br>
<span class="lineno"></span><span class="op" id="3467081">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="3467084">//&nbsp;A&nbsp;finishedHash&nbsp;calculates&nbsp;the&nbsp;hash&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake&nbsp;messages&nbsp;suitable</span><br>
<span class="lineno"></span><span class="comment" id="3467162">//&nbsp;for&nbsp;including&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="3467202">type</span>&nbsp;<span class="ident" id="3467207">finishedHash</span>&nbsp;<span class="keyword" id="3467220">struct</span>&nbsp;<span class="op" id="3467227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467230">client</span>&nbsp;<span class="ident" id="3467237">hash</span><span class="op" id="3467241">.</span><span class="ident" id="3467242">Hash</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467248">server</span>&nbsp;<span class="ident" id="3467255">hash</span><span class="op" id="3467259">.</span><span class="ident" id="3467260">Hash</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3467267">//&nbsp;Prior&nbsp;to&nbsp;TLS&nbsp;1.2,&nbsp;an&nbsp;additional&nbsp;MD5&nbsp;hash&nbsp;is&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467325">clientMD5</span>&nbsp;<span class="ident" id="3467335">hash</span><span class="op" id="3467339">.</span><span class="ident" id="3467340">Hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467346">serverMD5</span>&nbsp;<span class="ident" id="3467356">hash</span><span class="op" id="3467360">.</span><span class="ident" id="3467361">Hash</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467368">version</span>&nbsp;<span class="builtintype" id="3467376">uint16</span><br>
<span class="lineno"></span><span class="op" id="3467383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3467386">func</span>&nbsp;<span class="op" id="3467391">(</span><span class="ident" id="3467392">h</span>&nbsp;<span class="ident" id="3467394">finishedHash</span><span class="op" id="3467406">)</span>&nbsp;<span class="ident" id="3467408">Write</span><span class="op" id="3467413">(</span><span class="ident" id="3467414">msg</span>&nbsp;<span class="op" id="3467418">[</span><span class="op" id="3467419">]</span><span class="builtintype" id="3467420">byte</span><span class="op" id="3467424">)</span>&nbsp;<span class="op" id="3467426">(</span><span class="ident" id="3467427">n</span>&nbsp;<span class="builtintype" id="3467429">int</span><span class="op" id="3467432">,</span>&nbsp;<span class="ident" id="3467434">err</span>&nbsp;<span class="builtintype" id="3467438">error</span><span class="op" id="3467443">)</span>&nbsp;<span class="op" id="3467445">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467448">h</span><span class="op" id="3467449">.</span><span class="ident" id="3467450">client</span><span class="op" id="3467456">.</span><span class="ident" id="3467457">Write</span><span class="op" id="3467462">(</span><span class="ident" id="3467463">msg</span><span class="op" id="3467466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467469">h</span><span class="op" id="3467470">.</span><span class="ident" id="3467471">server</span><span class="op" id="3467477">.</span><span class="ident" id="3467478">Write</span><span class="op" id="3467483">(</span><span class="ident" id="3467484">msg</span><span class="op" id="3467487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467491">if</span>&nbsp;<span class="ident" id="3467494">h</span><span class="op" id="3467495">.</span><span class="ident" id="3467496">version</span>&nbsp;<span class="op" id="3467504">&lt;</span>&nbsp;<span class="ident" id="3467506">VersionTLS12</span>&nbsp;<span class="op" id="3467519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467523">h</span><span class="op" id="3467524">.</span><span class="ident" id="3467525">clientMD5</span><span class="op" id="3467534">.</span><span class="ident" id="3467535">Write</span><span class="op" id="3467540">(</span><span class="ident" id="3467541">msg</span><span class="op" id="3467544">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467548">h</span><span class="op" id="3467549">.</span><span class="ident" id="3467550">serverMD5</span><span class="op" id="3467559">.</span><span class="ident" id="3467560">Write</span><span class="op" id="3467565">(</span><span class="ident" id="3467566">msg</span><span class="op" id="3467569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3467572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467575">return</span>&nbsp;<span class="builtinfunc" id="3467582">len</span><span class="op" id="3467585">(</span><span class="ident" id="3467586">msg</span><span class="op" id="3467589">)</span><span class="op" id="3467590">,</span>&nbsp;<span class="ident" id="3467592">nil</span><br>
<span class="lineno"></span><span class="op" id="3467596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3467599">//&nbsp;finishedSum30&nbsp;calculates&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;SSLv3</span><br>
<span class="lineno"></span><span class="comment" id="3467677">//&nbsp;Finished&nbsp;message&nbsp;given&nbsp;the&nbsp;MD5&nbsp;and&nbsp;SHA1&nbsp;hashes&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake</span><br>
<span class="lineno"></span><span class="comment" id="3467749">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="3467762">func</span>&nbsp;<span class="ident" id="3467767">finishedSum30</span><span class="op" id="3467780">(</span><span class="ident" id="3467781">md5</span><span class="op" id="3467784">,</span>&nbsp;<span class="ident" id="3467786">sha1</span>&nbsp;<span class="ident" id="3467791">hash</span><span class="op" id="3467795">.</span><span class="ident" id="3467796">Hash</span><span class="op" id="3467800">,</span>&nbsp;<span class="ident" id="3467802">masterSecret</span>&nbsp;<span class="op" id="3467815">[</span><span class="op" id="3467816">]</span><span class="builtintype" id="3467817">byte</span><span class="op" id="3467821">,</span>&nbsp;<span class="ident" id="3467823">magic</span>&nbsp;<span class="op" id="3467829">[</span><span class="num" id="3467830">4</span><span class="op" id="3467831">]</span><span class="builtintype" id="3467832">byte</span><span class="op" id="3467836">)</span>&nbsp;<span class="op" id="3467838">[</span><span class="op" id="3467839">]</span><span class="builtintype" id="3467840">byte</span>&nbsp;<span class="op" id="3467845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467848">md5</span><span class="op" id="3467851">.</span><span class="ident" id="3467852">Write</span><span class="op" id="3467857">(</span><span class="ident" id="3467858">magic</span><span class="op" id="3467863">[</span><span class="op" id="3467864">:</span><span class="op" id="3467865">]</span><span class="op" id="3467866">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467869">md5</span><span class="op" id="3467872">.</span><span class="ident" id="3467873">Write</span><span class="op" id="3467878">(</span><span class="ident" id="3467879">masterSecret</span><span class="op" id="3467891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467894">md5</span><span class="op" id="3467897">.</span><span class="ident" id="3467898">Write</span><span class="op" id="3467903">(</span><span class="ident" id="3467904">ssl30Pad1</span><span class="op" id="3467913">[</span><span class="op" id="3467914">:</span><span class="op" id="3467915">]</span><span class="op" id="3467916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467919">md5Digest</span>&nbsp;<span class="op" id="3467929">:=</span>&nbsp;<span class="ident" id="3467932">md5</span><span class="op" id="3467935">.</span><span class="ident" id="3467936">Sum</span><span class="op" id="3467939">(</span><span class="ident" id="3467940">nil</span><span class="op" id="3467943">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467947">md5</span><span class="op" id="3467950">.</span><span class="ident" id="3467951">Reset</span><span class="op" id="3467956">(</span><span class="op" id="3467957">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467960">md5</span><span class="op" id="3467963">.</span><span class="ident" id="3467964">Write</span><span class="op" id="3467969">(</span><span class="ident" id="3467970">masterSecret</span><span class="op" id="3467982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467985">md5</span><span class="op" id="3467988">.</span><span class="ident" id="3467989">Write</span><span class="op" id="3467994">(</span><span class="ident" id="3467995">ssl30Pad2</span><span class="op" id="3468004">[</span><span class="op" id="3468005">:</span><span class="op" id="3468006">]</span><span class="op" id="3468007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3468010">md5</span><span class="op" id="3468013">.</span><span class="ident" id="3468014">Write</span><span class="op" id="3468019">(</span><span class="ident" id="3468020">md5Digest</span><span class="op" id="3468029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3468032">md5Digest</span>&nbsp;<span class="op" id="3468042">=</span>&nbsp;<span class="ident" id="3468044">md5</span><span class="op" id="3468047">.</span><span class="ident" id="3468048">Sum</span><span class="op" id="3468051">(</span><span class="ident" id="3468052">nil</span><span class="op" id="3468055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3468059">sha1</span><span class="op" id="3468063">.</span><span class="ident" id="3468064">Write</span><span class="op" id="3468069">(</span><span class="ident" id="3468070">magic</span><span class="op" id="3468075">[</span><span class="op" id="3468076">:</span><span class="op" id="3468077">]</span><span class="op" id="3468078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3468081">sha1</span><span class="op" id="3468085">.</span><span class="ident" id="3468086">Write</span><span class="op" id="3468091">(</span><span class="ident" id="3468092">masterSecret</span><span class="op" id="3468104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3468107">sha1</span><span class="op" id="3468111">.</span><span class="ident" id="3468112">Write</span><span class="op" id="3468117">(</span><span class="ident" id="3468118">ssl30Pad1</span><span class="op" id="3468127">[</span><span class="op" id="3468128">:</span><span class="num" id="3468129">40</span><span class="op" id="3468131">]</span><span class="op" id="3468132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3468135">sha1Digest</span>&nbsp;<span class="op" id="3468146">:=</span>&nbsp;<span class="ident" id="3468149">sha1</span><span class="op" id="3468153">.</span><span class="ident" id="3468154">Sum</span><span class="op" id="3468157">(</span><span class="ident" id="3468158">nil</span><span class="op" id="3468161">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3468165">sha1</span><span class="op" id="3468169">.</span><span class="ident" id="3468170">Reset</span><span class="op" id="3468175">(</span><span class="op" id="3468176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3468179">sha1</span><span class="op" id="3468183">.</span><span class="ident" id="3468184">Write</span><span class="op" id="3468189">(</span><span class="ident" id="3468190">masterSecret</span><span class="op" id="3468202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3468205">sha1</span><span class="op" id="3468209">.</span><span class="ident" id="3468210">Write</span><span class="op" id="3468215">(</span><span class="ident" id="3468216">ssl30Pad2</span><span class="op" id="3468225">[</span><span class="op" id="3468226">:</span><span class="num" id="3468227">40</span><span class="op" id="3468229">]</span><span class="op" id="3468230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3468233">sha1</span><span class="op" id="3468237">.</span><span class="ident" id="3468238">Write</span><span class="op" id="3468243">(</span><span class="ident" id="3468244">sha1Digest</span><span class="op" id="3468254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3468257">sha1Digest</span>&nbsp;<span class="op" id="3468268">=</span>&nbsp;<span class="ident" id="3468270">sha1</span><span class="op" id="3468274">.</span><span class="ident" id="3468275">Sum</span><span class="op" id="3468278">(</span><span class="ident" id="3468279">nil</span><span class="op" id="3468282">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3468286">ret</span>&nbsp;<span class="op" id="3468290">:=</span>&nbsp;<span class="builtinfunc" id="3468293">make</span><span class="op" id="3468297">(</span><span class="op" id="3468298">[</span><span class="op" id="3468299">]</span><span class="builtintype" id="3468300">byte</span><span class="op" id="3468304">,</span>&nbsp;<span class="builtinfunc" id="3468306">len</span><span class="op" id="3468309">(</span><span class="ident" id="3468310">md5Digest</span><span class="op" id="3468319">)</span><span class="op" id="3468320">+</span><span class="builtinfunc" id="3468321">len</span><span class="op" id="3468324">(</span><span class="ident" id="3468325">sha1Digest</span><span class="op" id="3468335">)</span><span class="op" id="3468336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3468339">copy</span><span class="op" id="3468343">(</span><span class="ident" id="3468344">ret</span><span class="op" id="3468347">,</span>&nbsp;<span class="ident" id="3468349">md5Digest</span><span class="op" id="3468358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3468361">copy</span><span class="op" id="3468365">(</span><span class="ident" id="3468366">ret</span><span class="op" id="3468369">[</span><span class="builtinfunc" id="3468370">len</span><span class="op" id="3468373">(</span><span class="ident" id="3468374">md5Digest</span><span class="op" id="3468383">)</span><span class="op" id="3468384">:</span><span class="op" id="3468385">]</span><span class="op" id="3468386">,</span>&nbsp;<span class="ident" id="3468388">sha1Digest</span><span class="op" id="3468398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3468401">return</span>&nbsp;<span class="ident" id="3468408">ret</span><br>
<span class="lineno">230</span><span class="op" id="3468412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3468415">var</span>&nbsp;<span class="ident" id="3468419">ssl3ClientFinishedMagic</span>&nbsp;<span class="op" id="3468443">=</span>&nbsp;<span class="op" id="3468445">[</span><span class="num" id="3468446">4</span><span class="op" id="3468447">]</span><span class="builtintype" id="3468448">byte</span><span class="op" id="3468452">{</span><span class="num" id="3468453">0x43</span><span class="op" id="3468457">,</span>&nbsp;<span class="num" id="3468459">0x4c</span><span class="op" id="3468463">,</span>&nbsp;<span class="num" id="3468465">0x4e</span><span class="op" id="3468469">,</span>&nbsp;<span class="num" id="3468471">0x54</span><span class="op" id="3468475">}</span><br>
<span class="lineno"></span><span class="keyword" id="3468477">var</span>&nbsp;<span class="ident" id="3468481">ssl3ServerFinishedMagic</span>&nbsp;<span class="op" id="3468505">=</span>&nbsp;<span class="op" id="3468507">[</span><span class="num" id="3468508">4</span><span class="op" id="3468509">]</span><span class="builtintype" id="3468510">byte</span><span class="op" id="3468514">{</span><span class="num" id="3468515">0x53</span><span class="op" id="3468519">,</span>&nbsp;<span class="num" id="3468521">0x52</span><span class="op" id="3468525">,</span>&nbsp;<span class="num" id="3468527">0x56</span><span class="op" id="3468531">,</span>&nbsp;<span class="num" id="3468533">0x52</span><span class="op" id="3468537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="3468540">//&nbsp;clientSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;client&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3468614">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="3468635">func</span>&nbsp;<span class="op" id="3468640">(</span><span class="ident" id="3468641">h</span>&nbsp;<span class="ident" id="3468643">finishedHash</span><span class="op" id="3468655">)</span>&nbsp;<span class="ident" id="3468657">clientSum</span><span class="op" id="3468666">(</span><span class="ident" id="3468667">masterSecret</span>&nbsp;<span class="op" id="3468680">[</span><span class="op" id="3468681">]</span><span class="builtintype" id="3468682">byte</span><span class="op" id="3468686">)</span>&nbsp;<span class="op" id="3468688">[</span><span class="op" id="3468689">]</span><span class="builtintype" id="3468690">byte</span>&nbsp;<span class="op" id="3468695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3468698">if</span>&nbsp;<span class="ident" id="3468701">h</span><span class="op" id="3468702">.</span><span class="ident" id="3468703">version</span>&nbsp;<span class="op" id="3468711">==</span>&nbsp;<span class="ident" id="3468714">VersionSSL30</span>&nbsp;<span class="op" id="3468727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3468731">return</span>&nbsp;<span class="ident" id="3468738">finishedSum30</span><span class="op" id="3468751">(</span><span class="ident" id="3468752">h</span><span class="op" id="3468753">.</span><span class="ident" id="3468754">clientMD5</span><span class="op" id="3468763">,</span>&nbsp;<span class="ident" id="3468765">h</span><span class="op" id="3468766">.</span><span class="ident" id="3468767">client</span><span class="op" id="3468773">,</span>&nbsp;<span class="ident" id="3468775">masterSecret</span><span class="op" id="3468787">,</span>&nbsp;<span class="ident" id="3468789">ssl3ClientFinishedMagic</span><span class="op" id="3468812">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3468815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3468819">out</span>&nbsp;<span class="op" id="3468823">:=</span>&nbsp;<span class="builtinfunc" id="3468826">make</span><span class="op" id="3468830">(</span><span class="op" id="3468831">[</span><span class="op" id="3468832">]</span><span class="builtintype" id="3468833">byte</span><span class="op" id="3468837">,</span>&nbsp;<span class="ident" id="3468839">finishedVerifyLength</span><span class="op" id="3468859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3468862">if</span>&nbsp;<span class="ident" id="3468865">h</span><span class="op" id="3468866">.</span><span class="ident" id="3468867">version</span>&nbsp;<span class="op" id="3468875">&gt;=</span>&nbsp;<span class="ident" id="3468878">VersionTLS12</span>&nbsp;<span class="op" id="3468891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3468895">seed</span>&nbsp;<span class="op" id="3468900">:=</span>&nbsp;<span class="ident" id="3468903">h</span><span class="op" id="3468904">.</span><span class="ident" id="3468905">client</span><span class="op" id="3468911">.</span><span class="ident" id="3468912">Sum</span><span class="op" id="3468915">(</span><span class="ident" id="3468916">nil</span><span class="op" id="3468919">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3468923">prf12</span><span class="op" id="3468928">(</span><span class="ident" id="3468929">out</span><span class="op" id="3468932">,</span>&nbsp;<span class="ident" id="3468934">masterSecret</span><span class="op" id="3468946">,</span>&nbsp;<span class="ident" id="3468948">clientFinishedLabel</span><span class="op" id="3468967">,</span>&nbsp;<span class="ident" id="3468969">seed</span><span class="op" id="3468973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3468976">}</span>&nbsp;<span class="keyword" id="3468978">else</span>&nbsp;<span class="op" id="3468983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3468987">seed</span>&nbsp;<span class="op" id="3468992">:=</span>&nbsp;<span class="builtinfunc" id="3468995">make</span><span class="op" id="3468999">(</span><span class="op" id="3469000">[</span><span class="op" id="3469001">]</span><span class="builtintype" id="3469002">byte</span><span class="op" id="3469006">,</span>&nbsp;<span class="num" id="3469008">0</span><span class="op" id="3469009">,</span>&nbsp;<span class="ident" id="3469011">md5</span><span class="op" id="3469014">.</span><span class="ident" id="3469015">Size</span><span class="op" id="3469019">+</span><span class="ident" id="3469020">sha1</span><span class="op" id="3469024">.</span><span class="ident" id="3469025">Size</span><span class="op" id="3469029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3469033">seed</span>&nbsp;<span class="op" id="3469038">=</span>&nbsp;<span class="ident" id="3469040">h</span><span class="op" id="3469041">.</span><span class="ident" id="3469042">clientMD5</span><span class="op" id="3469051">.</span><span class="ident" id="3469052">Sum</span><span class="op" id="3469055">(</span><span class="ident" id="3469056">seed</span><span class="op" id="3469060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3469064">seed</span>&nbsp;<span class="op" id="3469069">=</span>&nbsp;<span class="ident" id="3469071">h</span><span class="op" id="3469072">.</span><span class="ident" id="3469073">client</span><span class="op" id="3469079">.</span><span class="ident" id="3469080">Sum</span><span class="op" id="3469083">(</span><span class="ident" id="3469084">seed</span><span class="op" id="3469088">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3469092">prf10</span><span class="op" id="3469097">(</span><span class="ident" id="3469098">out</span><span class="op" id="3469101">,</span>&nbsp;<span class="ident" id="3469103">masterSecret</span><span class="op" id="3469115">,</span>&nbsp;<span class="ident" id="3469117">clientFinishedLabel</span><span class="op" id="3469136">,</span>&nbsp;<span class="ident" id="3469138">seed</span><span class="op" id="3469142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3469145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3469148">return</span>&nbsp;<span class="ident" id="3469155">out</span><br>
<span class="lineno"></span><span class="op" id="3469159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="3469162">//&nbsp;serverSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;server&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3469236">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="3469257">func</span>&nbsp;<span class="op" id="3469262">(</span><span class="ident" id="3469263">h</span>&nbsp;<span class="ident" id="3469265">finishedHash</span><span class="op" id="3469277">)</span>&nbsp;<span class="ident" id="3469279">serverSum</span><span class="op" id="3469288">(</span><span class="ident" id="3469289">masterSecret</span>&nbsp;<span class="op" id="3469302">[</span><span class="op" id="3469303">]</span><span class="builtintype" id="3469304">byte</span><span class="op" id="3469308">)</span>&nbsp;<span class="op" id="3469310">[</span><span class="op" id="3469311">]</span><span class="builtintype" id="3469312">byte</span>&nbsp;<span class="op" id="3469317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3469320">if</span>&nbsp;<span class="ident" id="3469323">h</span><span class="op" id="3469324">.</span><span class="ident" id="3469325">version</span>&nbsp;<span class="op" id="3469333">==</span>&nbsp;<span class="ident" id="3469336">VersionSSL30</span>&nbsp;<span class="op" id="3469349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3469353">return</span>&nbsp;<span class="ident" id="3469360">finishedSum30</span><span class="op" id="3469373">(</span><span class="ident" id="3469374">h</span><span class="op" id="3469375">.</span><span class="ident" id="3469376">serverMD5</span><span class="op" id="3469385">,</span>&nbsp;<span class="ident" id="3469387">h</span><span class="op" id="3469388">.</span><span class="ident" id="3469389">server</span><span class="op" id="3469395">,</span>&nbsp;<span class="ident" id="3469397">masterSecret</span><span class="op" id="3469409">,</span>&nbsp;<span class="ident" id="3469411">ssl3ServerFinishedMagic</span><span class="op" id="3469434">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3469437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3469441">out</span>&nbsp;<span class="op" id="3469445">:=</span>&nbsp;<span class="builtinfunc" id="3469448">make</span><span class="op" id="3469452">(</span><span class="op" id="3469453">[</span><span class="op" id="3469454">]</span><span class="builtintype" id="3469455">byte</span><span class="op" id="3469459">,</span>&nbsp;<span class="ident" id="3469461">finishedVerifyLength</span><span class="op" id="3469481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3469484">if</span>&nbsp;<span class="ident" id="3469487">h</span><span class="op" id="3469488">.</span><span class="ident" id="3469489">version</span>&nbsp;<span class="op" id="3469497">&gt;=</span>&nbsp;<span class="ident" id="3469500">VersionTLS12</span>&nbsp;<span class="op" id="3469513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3469517">seed</span>&nbsp;<span class="op" id="3469522">:=</span>&nbsp;<span class="ident" id="3469525">h</span><span class="op" id="3469526">.</span><span class="ident" id="3469527">server</span><span class="op" id="3469533">.</span><span class="ident" id="3469534">Sum</span><span class="op" id="3469537">(</span><span class="ident" id="3469538">nil</span><span class="op" id="3469541">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3469545">prf12</span><span class="op" id="3469550">(</span><span class="ident" id="3469551">out</span><span class="op" id="3469554">,</span>&nbsp;<span class="ident" id="3469556">masterSecret</span><span class="op" id="3469568">,</span>&nbsp;<span class="ident" id="3469570">serverFinishedLabel</span><span class="op" id="3469589">,</span>&nbsp;<span class="ident" id="3469591">seed</span><span class="op" id="3469595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3469598">}</span>&nbsp;<span class="keyword" id="3469600">else</span>&nbsp;<span class="op" id="3469605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3469609">seed</span>&nbsp;<span class="op" id="3469614">:=</span>&nbsp;<span class="builtinfunc" id="3469617">make</span><span class="op" id="3469621">(</span><span class="op" id="3469622">[</span><span class="op" id="3469623">]</span><span class="builtintype" id="3469624">byte</span><span class="op" id="3469628">,</span>&nbsp;<span class="num" id="3469630">0</span><span class="op" id="3469631">,</span>&nbsp;<span class="ident" id="3469633">md5</span><span class="op" id="3469636">.</span><span class="ident" id="3469637">Size</span><span class="op" id="3469641">+</span><span class="ident" id="3469642">sha1</span><span class="op" id="3469646">.</span><span class="ident" id="3469647">Size</span><span class="op" id="3469651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3469655">seed</span>&nbsp;<span class="op" id="3469660">=</span>&nbsp;<span class="ident" id="3469662">h</span><span class="op" id="3469663">.</span><span class="ident" id="3469664">serverMD5</span><span class="op" id="3469673">.</span><span class="ident" id="3469674">Sum</span><span class="op" id="3469677">(</span><span class="ident" id="3469678">seed</span><span class="op" id="3469682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3469686">seed</span>&nbsp;<span class="op" id="3469691">=</span>&nbsp;<span class="ident" id="3469693">h</span><span class="op" id="3469694">.</span><span class="ident" id="3469695">server</span><span class="op" id="3469701">.</span><span class="ident" id="3469702">Sum</span><span class="op" id="3469705">(</span><span class="ident" id="3469706">seed</span><span class="op" id="3469710">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3469714">prf10</span><span class="op" id="3469719">(</span><span class="ident" id="3469720">out</span><span class="op" id="3469723">,</span>&nbsp;<span class="ident" id="3469725">masterSecret</span><span class="op" id="3469737">,</span>&nbsp;<span class="ident" id="3469739">serverFinishedLabel</span><span class="op" id="3469758">,</span>&nbsp;<span class="ident" id="3469760">seed</span><span class="op" id="3469764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3469767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3469770">return</span>&nbsp;<span class="ident" id="3469777">out</span><br>
<span class="lineno"></span><span class="op" id="3469781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="comment" id="3469784">//&nbsp;hashForClientCertificate&nbsp;returns&nbsp;a&nbsp;digest,&nbsp;hash&nbsp;function,&nbsp;and&nbsp;TLS&nbsp;1.2&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="3469862">//&nbsp;id&nbsp;suitable&nbsp;for&nbsp;signing&nbsp;by&nbsp;a&nbsp;TLS&nbsp;client&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="3469918">func</span>&nbsp;<span class="op" id="3469923">(</span><span class="ident" id="3469924">h</span>&nbsp;<span class="ident" id="3469926">finishedHash</span><span class="op" id="3469938">)</span>&nbsp;<span class="ident" id="3469940">hashForClientCertificate</span><span class="op" id="3469964">(</span><span class="ident" id="3469965">sigType</span>&nbsp;<span class="builtintype" id="3469973">uint8</span><span class="op" id="3469978">)</span>&nbsp;<span class="op" id="3469980">(</span><span class="op" id="3469981">[</span><span class="op" id="3469982">]</span><span class="builtintype" id="3469983">byte</span><span class="op" id="3469987">,</span>&nbsp;<span class="ident" id="3469989">crypto</span><span class="op" id="3469995">.</span><span class="ident" id="3469996">Hash</span><span class="op" id="3470000">,</span>&nbsp;<span class="builtintype" id="3470002">uint8</span><span class="op" id="3470007">)</span>&nbsp;<span class="op" id="3470009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470012">if</span>&nbsp;<span class="ident" id="3470015">h</span><span class="op" id="3470016">.</span><span class="ident" id="3470017">version</span>&nbsp;<span class="op" id="3470025">&gt;=</span>&nbsp;<span class="ident" id="3470028">VersionTLS12</span>&nbsp;<span class="op" id="3470041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3470045">digest</span>&nbsp;<span class="op" id="3470052">:=</span>&nbsp;<span class="ident" id="3470055">h</span><span class="op" id="3470056">.</span><span class="ident" id="3470057">server</span><span class="op" id="3470063">.</span><span class="ident" id="3470064">Sum</span><span class="op" id="3470067">(</span><span class="ident" id="3470068">nil</span><span class="op" id="3470071">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470075">return</span>&nbsp;<span class="ident" id="3470082">digest</span><span class="op" id="3470088">,</span>&nbsp;<span class="ident" id="3470090">crypto</span><span class="op" id="3470096">.</span><span class="ident" id="3470097">SHA256</span><span class="op" id="3470103">,</span>&nbsp;<span class="ident" id="3470105">hashSHA256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3470117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470120">if</span>&nbsp;<span class="ident" id="3470123">sigType</span>&nbsp;<span class="op" id="3470131">==</span>&nbsp;<span class="ident" id="3470134">signatureECDSA</span>&nbsp;<span class="op" id="3470149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3470153">digest</span>&nbsp;<span class="op" id="3470160">:=</span>&nbsp;<span class="ident" id="3470163">h</span><span class="op" id="3470164">.</span><span class="ident" id="3470165">server</span><span class="op" id="3470171">.</span><span class="ident" id="3470172">Sum</span><span class="op" id="3470175">(</span><span class="ident" id="3470176">nil</span><span class="op" id="3470179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470183">return</span>&nbsp;<span class="ident" id="3470190">digest</span><span class="op" id="3470196">,</span>&nbsp;<span class="ident" id="3470198">crypto</span><span class="op" id="3470204">.</span><span class="ident" id="3470205">SHA1</span><span class="op" id="3470209">,</span>&nbsp;<span class="ident" id="3470211">hashSHA1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3470221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3470225">digest</span>&nbsp;<span class="op" id="3470232">:=</span>&nbsp;<span class="builtinfunc" id="3470235">make</span><span class="op" id="3470239">(</span><span class="op" id="3470240">[</span><span class="op" id="3470241">]</span><span class="builtintype" id="3470242">byte</span><span class="op" id="3470246">,</span>&nbsp;<span class="num" id="3470248">0</span><span class="op" id="3470249">,</span>&nbsp;<span class="num" id="3470251">36</span><span class="op" id="3470253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3470256">digest</span>&nbsp;<span class="op" id="3470263">=</span>&nbsp;<span class="ident" id="3470265">h</span><span class="op" id="3470266">.</span><span class="ident" id="3470267">serverMD5</span><span class="op" id="3470276">.</span><span class="ident" id="3470277">Sum</span><span class="op" id="3470280">(</span><span class="ident" id="3470281">digest</span><span class="op" id="3470287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3470290">digest</span>&nbsp;<span class="op" id="3470297">=</span>&nbsp;<span class="ident" id="3470299">h</span><span class="op" id="3470300">.</span><span class="ident" id="3470301">server</span><span class="op" id="3470307">.</span><span class="ident" id="3470308">Sum</span><span class="op" id="3470311">(</span><span class="ident" id="3470312">digest</span><span class="op" id="3470318">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470321">return</span>&nbsp;<span class="ident" id="3470328">digest</span><span class="op" id="3470334">,</span>&nbsp;<span class="ident" id="3470336">crypto</span><span class="op" id="3470342">.</span><span class="ident" id="3470343">MD5SHA1</span><span class="op" id="3470350">,</span>&nbsp;<span class="num" id="3470352">0</span>&nbsp;<span class="comment" id="3470354">/*&nbsp;not&nbsp;specified&nbsp;in&nbsp;TLS&nbsp;1.2.&nbsp;*/</span><br>
<span class="lineno"></span><span class="op" id="3470386">}</span>
</div>
</body>
</html>
