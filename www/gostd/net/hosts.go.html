<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4064316">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4064371">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4064425">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4064476">//&nbsp;Read&nbsp;static&nbsp;host/IP&nbsp;entries&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4064525">package</span>&nbsp;<span class="ident" id="4064533">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4064538">import</span>&nbsp;<span class="op" id="4064545">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4064548">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4064556">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4064563">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4064566">const</span>&nbsp;<span class="ident" id="4064572">cacheMaxAge</span>&nbsp;<span class="op" id="4064584">=</span>&nbsp;<span class="num" id="4064586">5</span>&nbsp;<span class="op" id="4064588">*</span>&nbsp;<span class="ident" id="4064590">time</span><span class="op" id="4064594">.</span><span class="ident" id="4064595">Minute</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4064603">//&nbsp;hostsPath&nbsp;points&nbsp;to&nbsp;the&nbsp;file&nbsp;with&nbsp;static&nbsp;IP/address&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="4064667">var</span>&nbsp;<span class="ident" id="4064671">hostsPath</span>&nbsp;<span class="op" id="4064681">=</span>&nbsp;<span class="string" id="4064683">&#34;/etc/hosts&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4064697">//&nbsp;Simple&nbsp;cache.</span><br>
<span class="lineno">20</span><span class="keyword" id="4064714">var</span>&nbsp;<span class="ident" id="4064718">hosts</span>&nbsp;<span class="keyword" id="4064724">struct</span>&nbsp;<span class="op" id="4064731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064734">sync</span><span class="op" id="4064738">.</span><span class="ident" id="4064739">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064746">byName</span>&nbsp;<span class="keyword" id="4064753">map</span><span class="op" id="4064756">[</span><span class="builtintype" id="4064757">string</span><span class="op" id="4064763">]</span><span class="op" id="4064764">[</span><span class="op" id="4064765">]</span><span class="builtintype" id="4064766">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064774">byAddr</span>&nbsp;<span class="keyword" id="4064781">map</span><span class="op" id="4064784">[</span><span class="builtintype" id="4064785">string</span><span class="op" id="4064791">]</span><span class="op" id="4064792">[</span><span class="op" id="4064793">]</span><span class="builtintype" id="4064794">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064802">expire</span>&nbsp;<span class="ident" id="4064809">time</span><span class="op" id="4064813">.</span><span class="ident" id="4064814">Time</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064820">path</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4064827">string</span><br>
<span class="lineno"></span><span class="op" id="4064834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4064837">func</span>&nbsp;<span class="ident" id="4064842">readHosts</span><span class="op" id="4064851">(</span><span class="op" id="4064852">)</span>&nbsp;<span class="op" id="4064854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064857">now</span>&nbsp;<span class="op" id="4064861">:=</span>&nbsp;<span class="ident" id="4064864">time</span><span class="op" id="4064868">.</span><span class="ident" id="4064869">Now</span><span class="op" id="4064872">(</span><span class="op" id="4064873">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064876">hp</span>&nbsp;<span class="op" id="4064879">:=</span>&nbsp;<span class="ident" id="4064882">hostsPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064893">if</span>&nbsp;<span class="builtinfunc" id="4064896">len</span><span class="op" id="4064899">(</span><span class="ident" id="4064900">hosts</span><span class="op" id="4064905">.</span><span class="ident" id="4064906">byName</span><span class="op" id="4064912">)</span>&nbsp;<span class="op" id="4064914">==</span>&nbsp;<span class="num" id="4064917">0</span>&nbsp;<span class="op" id="4064919">||</span>&nbsp;<span class="ident" id="4064922">now</span><span class="op" id="4064925">.</span><span class="ident" id="4064926">After</span><span class="op" id="4064931">(</span><span class="ident" id="4064932">hosts</span><span class="op" id="4064937">.</span><span class="ident" id="4064938">expire</span><span class="op" id="4064944">)</span>&nbsp;<span class="op" id="4064946">||</span>&nbsp;<span class="ident" id="4064949">hosts</span><span class="op" id="4064954">.</span><span class="ident" id="4064955">path</span>&nbsp;<span class="op" id="4064960">!=</span>&nbsp;<span class="ident" id="4064963">hp</span>&nbsp;<span class="op" id="4064966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064970">hs</span>&nbsp;<span class="op" id="4064973">:=</span>&nbsp;<span class="builtinfunc" id="4064976">make</span><span class="op" id="4064980">(</span><span class="keyword" id="4064981">map</span><span class="op" id="4064984">[</span><span class="builtintype" id="4064985">string</span><span class="op" id="4064991">]</span><span class="op" id="4064992">[</span><span class="op" id="4064993">]</span><span class="builtintype" id="4064994">string</span><span class="op" id="4065000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065004">is</span>&nbsp;<span class="op" id="4065007">:=</span>&nbsp;<span class="builtinfunc" id="4065010">make</span><span class="op" id="4065014">(</span><span class="keyword" id="4065015">map</span><span class="op" id="4065018">[</span><span class="builtintype" id="4065019">string</span><span class="op" id="4065025">]</span><span class="op" id="4065026">[</span><span class="op" id="4065027">]</span><span class="builtintype" id="4065028">string</span><span class="op" id="4065034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065038">var</span>&nbsp;<span class="ident" id="4065042">file</span>&nbsp;<span class="op" id="4065047">*</span><span class="ident" id="4065048">file</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065055">if</span>&nbsp;<span class="ident" id="4065058">file</span><span class="op" id="4065062">,</span>&nbsp;<span class="ident" id="4065064">_</span>&nbsp;<span class="op" id="4065066">=</span>&nbsp;<span class="ident" id="4065068">open</span><span class="op" id="4065072">(</span><span class="ident" id="4065073">hp</span><span class="op" id="4065075">)</span><span class="op" id="4065076">;</span>&nbsp;<span class="ident" id="4065078">file</span>&nbsp;<span class="op" id="4065083">==</span>&nbsp;<span class="ident" id="4065086">nil</span>&nbsp;<span class="op" id="4065090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065095">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065108">for</span>&nbsp;<span class="ident" id="4065112">line</span><span class="op" id="4065116">,</span>&nbsp;<span class="ident" id="4065118">ok</span>&nbsp;<span class="op" id="4065121">:=</span>&nbsp;<span class="ident" id="4065124">file</span><span class="op" id="4065128">.</span><span class="ident" id="4065129">readLine</span><span class="op" id="4065137">(</span><span class="op" id="4065138">)</span><span class="op" id="4065139">;</span>&nbsp;<span class="ident" id="4065141">ok</span><span class="op" id="4065143">;</span>&nbsp;<span class="ident" id="4065145">line</span><span class="op" id="4065149">,</span>&nbsp;<span class="ident" id="4065151">ok</span>&nbsp;<span class="op" id="4065154">=</span>&nbsp;<span class="ident" id="4065156">file</span><span class="op" id="4065160">.</span><span class="ident" id="4065161">readLine</span><span class="op" id="4065169">(</span><span class="op" id="4065170">)</span>&nbsp;<span class="op" id="4065172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065177">if</span>&nbsp;<span class="ident" id="4065180">i</span>&nbsp;<span class="op" id="4065182">:=</span>&nbsp;<span class="ident" id="4065185">byteIndex</span><span class="op" id="4065194">(</span><span class="ident" id="4065195">line</span><span class="op" id="4065199">,</span>&nbsp;<span class="string" id="4065201">&#39;#&#39;</span><span class="op" id="4065204">)</span><span class="op" id="4065205">;</span>&nbsp;<span class="ident" id="4065207">i</span>&nbsp;<span class="op" id="4065209">&gt;=</span>&nbsp;<span class="num" id="4065212">0</span>&nbsp;<span class="op" id="4065214">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4065220">//&nbsp;Discard&nbsp;comments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065245">line</span>&nbsp;<span class="op" id="4065250">=</span>&nbsp;<span class="ident" id="4065252">line</span><span class="op" id="4065256">[</span><span class="num" id="4065257">0</span><span class="op" id="4065258">:</span><span class="ident" id="4065259">i</span><span class="op" id="4065260">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065270">f</span>&nbsp;<span class="op" id="4065272">:=</span>&nbsp;<span class="ident" id="4065275">getFields</span><span class="op" id="4065284">(</span><span class="ident" id="4065285">line</span><span class="op" id="4065289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065294">if</span>&nbsp;<span class="builtinfunc" id="4065297">len</span><span class="op" id="4065300">(</span><span class="ident" id="4065301">f</span><span class="op" id="4065302">)</span>&nbsp;<span class="op" id="4065304">&lt;</span>&nbsp;<span class="num" id="4065306">2</span>&nbsp;<span class="op" id="4065308">||</span>&nbsp;<span class="ident" id="4065311">ParseIP</span><span class="op" id="4065318">(</span><span class="ident" id="4065319">f</span><span class="op" id="4065320">[</span><span class="num" id="4065321">0</span><span class="op" id="4065322">]</span><span class="op" id="4065323">)</span>&nbsp;<span class="op" id="4065325">==</span>&nbsp;<span class="ident" id="4065328">nil</span>&nbsp;<span class="op" id="4065332">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065338">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065355">for</span>&nbsp;<span class="ident" id="4065359">i</span>&nbsp;<span class="op" id="4065361">:=</span>&nbsp;<span class="num" id="4065364">1</span><span class="op" id="4065365">;</span>&nbsp;<span class="ident" id="4065367">i</span>&nbsp;<span class="op" id="4065369">&lt;</span>&nbsp;<span class="builtinfunc" id="4065371">len</span><span class="op" id="4065374">(</span><span class="ident" id="4065375">f</span><span class="op" id="4065376">)</span><span class="op" id="4065377">;</span>&nbsp;<span class="ident" id="4065379">i</span><span class="op" id="4065380">++</span>&nbsp;<span class="op" id="4065383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065389">h</span>&nbsp;<span class="op" id="4065391">:=</span>&nbsp;<span class="ident" id="4065394">f</span><span class="op" id="4065395">[</span><span class="ident" id="4065396">i</span><span class="op" id="4065397">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065403">hs</span><span class="op" id="4065405">[</span><span class="ident" id="4065406">h</span><span class="op" id="4065407">]</span>&nbsp;<span class="op" id="4065409">=</span>&nbsp;<span class="builtinfunc" id="4065411">append</span><span class="op" id="4065417">(</span><span class="ident" id="4065418">hs</span><span class="op" id="4065420">[</span><span class="ident" id="4065421">h</span><span class="op" id="4065422">]</span><span class="op" id="4065423">,</span>&nbsp;<span class="ident" id="4065425">f</span><span class="op" id="4065426">[</span><span class="num" id="4065427">0</span><span class="op" id="4065428">]</span><span class="op" id="4065429">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065435">is</span><span class="op" id="4065437">[</span><span class="ident" id="4065438">f</span><span class="op" id="4065439">[</span><span class="num" id="4065440">0</span><span class="op" id="4065441">]</span><span class="op" id="4065442">]</span>&nbsp;<span class="op" id="4065444">=</span>&nbsp;<span class="builtinfunc" id="4065446">append</span><span class="op" id="4065452">(</span><span class="ident" id="4065453">is</span><span class="op" id="4065455">[</span><span class="ident" id="4065456">f</span><span class="op" id="4065457">[</span><span class="num" id="4065458">0</span><span class="op" id="4065459">]</span><span class="op" id="4065460">]</span><span class="op" id="4065461">,</span>&nbsp;<span class="ident" id="4065463">h</span><span class="op" id="4065464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4065477">//&nbsp;Update&nbsp;the&nbsp;data&nbsp;cache.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065505">hosts</span><span class="op" id="4065510">.</span><span class="ident" id="4065511">expire</span>&nbsp;<span class="op" id="4065518">=</span>&nbsp;<span class="ident" id="4065520">now</span><span class="op" id="4065523">.</span><span class="ident" id="4065524">Add</span><span class="op" id="4065527">(</span><span class="ident" id="4065528">cacheMaxAge</span><span class="op" id="4065539">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065543">hosts</span><span class="op" id="4065548">.</span><span class="ident" id="4065549">path</span>&nbsp;<span class="op" id="4065554">=</span>&nbsp;<span class="ident" id="4065556">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065561">hosts</span><span class="op" id="4065566">.</span><span class="ident" id="4065567">byName</span>&nbsp;<span class="op" id="4065574">=</span>&nbsp;<span class="ident" id="4065576">hs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065581">hosts</span><span class="op" id="4065586">.</span><span class="ident" id="4065587">byAddr</span>&nbsp;<span class="op" id="4065594">=</span>&nbsp;<span class="ident" id="4065596">is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065601">file</span><span class="op" id="4065605">.</span><span class="builtinfunc" id="4065606">close</span><span class="op" id="4065611">(</span><span class="op" id="4065612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065615">}</span><br>
<span class="lineno">60</span><span class="op" id="4065617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4065620">//&nbsp;lookupStaticHost&nbsp;looks&nbsp;up&nbsp;the&nbsp;addresses&nbsp;for&nbsp;the&nbsp;given&nbsp;host&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="4065699">func</span>&nbsp;<span class="ident" id="4065704">lookupStaticHost</span><span class="op" id="4065720">(</span><span class="ident" id="4065721">host</span>&nbsp;<span class="builtintype" id="4065726">string</span><span class="op" id="4065732">)</span>&nbsp;<span class="op" id="4065734">[</span><span class="op" id="4065735">]</span><span class="builtintype" id="4065736">string</span>&nbsp;<span class="op" id="4065743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065746">hosts</span><span class="op" id="4065751">.</span><span class="ident" id="4065752">Lock</span><span class="op" id="4065756">(</span><span class="op" id="4065757">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065760">defer</span>&nbsp;<span class="ident" id="4065766">hosts</span><span class="op" id="4065771">.</span><span class="ident" id="4065772">Unlock</span><span class="op" id="4065778">(</span><span class="op" id="4065779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065782">readHosts</span><span class="op" id="4065791">(</span><span class="op" id="4065792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065795">if</span>&nbsp;<span class="builtinfunc" id="4065798">len</span><span class="op" id="4065801">(</span><span class="ident" id="4065802">hosts</span><span class="op" id="4065807">.</span><span class="ident" id="4065808">byName</span><span class="op" id="4065814">)</span>&nbsp;<span class="op" id="4065816">!=</span>&nbsp;<span class="num" id="4065819">0</span>&nbsp;<span class="op" id="4065821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065825">if</span>&nbsp;<span class="ident" id="4065828">ips</span><span class="op" id="4065831">,</span>&nbsp;<span class="ident" id="4065833">ok</span>&nbsp;<span class="op" id="4065836">:=</span>&nbsp;<span class="ident" id="4065839">hosts</span><span class="op" id="4065844">.</span><span class="ident" id="4065845">byName</span><span class="op" id="4065851">[</span><span class="ident" id="4065852">host</span><span class="op" id="4065856">]</span><span class="op" id="4065857">;</span>&nbsp;<span class="ident" id="4065859">ok</span>&nbsp;<span class="op" id="4065862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065867">return</span>&nbsp;<span class="ident" id="4065874">ips</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065886">return</span>&nbsp;<span class="ident" id="4065893">nil</span><br>
<span class="lineno"></span><span class="op" id="4065897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="4065900">//&nbsp;lookupStaticAddr&nbsp;looks&nbsp;up&nbsp;the&nbsp;hosts&nbsp;for&nbsp;the&nbsp;given&nbsp;address&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="4065978">func</span>&nbsp;<span class="ident" id="4065983">lookupStaticAddr</span><span class="op" id="4065999">(</span><span class="ident" id="4066000">addr</span>&nbsp;<span class="builtintype" id="4066005">string</span><span class="op" id="4066011">)</span>&nbsp;<span class="op" id="4066013">[</span><span class="op" id="4066014">]</span><span class="builtintype" id="4066015">string</span>&nbsp;<span class="op" id="4066022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4066025">hosts</span><span class="op" id="4066030">.</span><span class="ident" id="4066031">Lock</span><span class="op" id="4066035">(</span><span class="op" id="4066036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066039">defer</span>&nbsp;<span class="ident" id="4066045">hosts</span><span class="op" id="4066050">.</span><span class="ident" id="4066051">Unlock</span><span class="op" id="4066057">(</span><span class="op" id="4066058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4066061">readHosts</span><span class="op" id="4066070">(</span><span class="op" id="4066071">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066074">if</span>&nbsp;<span class="builtinfunc" id="4066077">len</span><span class="op" id="4066080">(</span><span class="ident" id="4066081">hosts</span><span class="op" id="4066086">.</span><span class="ident" id="4066087">byAddr</span><span class="op" id="4066093">)</span>&nbsp;<span class="op" id="4066095">!=</span>&nbsp;<span class="num" id="4066098">0</span>&nbsp;<span class="op" id="4066100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066104">if</span>&nbsp;<span class="ident" id="4066107">hosts</span><span class="op" id="4066112">,</span>&nbsp;<span class="ident" id="4066114">ok</span>&nbsp;<span class="op" id="4066117">:=</span>&nbsp;<span class="ident" id="4066120">hosts</span><span class="op" id="4066125">.</span><span class="ident" id="4066126">byAddr</span><span class="op" id="4066132">[</span><span class="ident" id="4066133">addr</span><span class="op" id="4066137">]</span><span class="op" id="4066138">;</span>&nbsp;<span class="ident" id="4066140">ok</span>&nbsp;<span class="op" id="4066143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066148">return</span>&nbsp;<span class="ident" id="4066155">hosts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4066163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4066166">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066169">return</span>&nbsp;<span class="ident" id="4066176">nil</span><br>
<span class="lineno"></span><span class="op" id="4066180">}</span>
</div>
</body>
</html>
