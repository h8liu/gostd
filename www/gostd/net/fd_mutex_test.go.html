<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html" class="current">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6655065">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6655120">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6655174">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6655225">package</span>&nbsp;<span class="ident" id="6655233">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6655238">import</span>&nbsp;<span class="op" id="6655245">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6655248">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6655261">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6655272">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6655283">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6655290">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6655293">func</span>&nbsp;<span class="ident" id="6655298">TestMutexLock</span><span class="op" id="6655311">(</span><span class="ident" id="6655312">t</span>&nbsp;<span class="op" id="6655314">*</span><span class="ident" id="6655315"><a href="/gostd/net/fd_mutex_test.go.html#6655272">testing</a></span><span class="op" id="6655322">.</span><span class="ident" id="6655323"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6655324">)</span>&nbsp;<span class="op" id="6655326">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655329">var</span>&nbsp;<span class="ident" id="6655333">mu</span>&nbsp;<span class="ident" id="6655336"><a href="/gostd/net/fd_mutex.go.html#3249583">fdMutex</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655346">if</span>&nbsp;<span class="op" id="6655349">!</span><span class="ident" id="6655350"><a href="/gostd/net/fd_mutex_test.go.html#6655333">mu</a></span><span class="op" id="6655352">.</span><span class="ident" id="6655353"><a href="/gostd/net/fd_mutex.go.html#3250854">Incref</a></span><span class="op" id="6655359">(</span><span class="op" id="6655360">)</span>&nbsp;<span class="op" id="6655362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655366"><a href="/gostd/net/fd_mutex_test.go.html#6655312">t</a></span><span class="op" id="6655367">.</span><span class="ident" id="6655368"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6655373">(</span><span class="string" id="6655374">&#34;broken&#34;</span><span class="op" id="6655382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655385">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655388">if</span>&nbsp;<span class="ident" id="6655391"><a href="/gostd/net/fd_mutex_test.go.html#6655333">mu</a></span><span class="op" id="6655393">.</span><span class="ident" id="6655394"><a href="/gostd/net/fd_mutex.go.html#3251874">Decref</a></span><span class="op" id="6655400">(</span><span class="op" id="6655401">)</span>&nbsp;<span class="op" id="6655403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655407"><a href="/gostd/net/fd_mutex_test.go.html#6655312">t</a></span><span class="op" id="6655408">.</span><span class="ident" id="6655409"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6655414">(</span><span class="string" id="6655415">&#34;broken&#34;</span><span class="op" id="6655423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655430">if</span>&nbsp;<span class="op" id="6655433">!</span><span class="ident" id="6655434"><a href="/gostd/net/fd_mutex_test.go.html#6655333">mu</a></span><span class="op" id="6655436">.</span><span class="ident" id="6655437"><a href="/gostd/net/fd_mutex.go.html#3252171">RWLock</a></span><span class="op" id="6655443">(</span><span class="builtintype" id="6655444">true</span><span class="op" id="6655448">)</span>&nbsp;<span class="op" id="6655450">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655454"><a href="/gostd/net/fd_mutex_test.go.html#6655312">t</a></span><span class="op" id="6655455">.</span><span class="ident" id="6655456"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6655461">(</span><span class="string" id="6655462">&#34;broken&#34;</span><span class="op" id="6655470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655476">if</span>&nbsp;<span class="ident" id="6655479"><a href="/gostd/net/fd_mutex_test.go.html#6655333">mu</a></span><span class="op" id="6655481">.</span><span class="ident" id="6655482"><a href="/gostd/net/fd_mutex.go.html#3253103">RWUnlock</a></span><span class="op" id="6655490">(</span><span class="builtintype" id="6655491">true</span><span class="op" id="6655495">)</span>&nbsp;<span class="op" id="6655497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655501"><a href="/gostd/net/fd_mutex_test.go.html#6655312">t</a></span><span class="op" id="6655502">.</span><span class="ident" id="6655503"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6655508">(</span><span class="string" id="6655509">&#34;broken&#34;</span><span class="op" id="6655517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655520">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655524">if</span>&nbsp;<span class="op" id="6655527">!</span><span class="ident" id="6655528"><a href="/gostd/net/fd_mutex_test.go.html#6655333">mu</a></span><span class="op" id="6655530">.</span><span class="ident" id="6655531"><a href="/gostd/net/fd_mutex.go.html#3252171">RWLock</a></span><span class="op" id="6655537">(</span><span class="builtintype" id="6655538">false</span><span class="op" id="6655543">)</span>&nbsp;<span class="op" id="6655545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655549"><a href="/gostd/net/fd_mutex_test.go.html#6655312">t</a></span><span class="op" id="6655550">.</span><span class="ident" id="6655551"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6655556">(</span><span class="string" id="6655557">&#34;broken&#34;</span><span class="op" id="6655565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655571">if</span>&nbsp;<span class="ident" id="6655574"><a href="/gostd/net/fd_mutex_test.go.html#6655333">mu</a></span><span class="op" id="6655576">.</span><span class="ident" id="6655577"><a href="/gostd/net/fd_mutex.go.html#3253103">RWUnlock</a></span><span class="op" id="6655585">(</span><span class="builtintype" id="6655586">false</span><span class="op" id="6655591">)</span>&nbsp;<span class="op" id="6655593">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655597"><a href="/gostd/net/fd_mutex_test.go.html#6655312">t</a></span><span class="op" id="6655598">.</span><span class="ident" id="6655599"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6655604">(</span><span class="string" id="6655605">&#34;broken&#34;</span><span class="op" id="6655613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655616">}</span><br>
<span class="lineno"></span><span class="op" id="6655618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6655621">func</span>&nbsp;<span class="ident" id="6655626">TestMutexClose</span><span class="op" id="6655640">(</span><span class="ident" id="6655641">t</span>&nbsp;<span class="op" id="6655643">*</span><span class="ident" id="6655644"><a href="/gostd/net/fd_mutex_test.go.html#6655272">testing</a></span><span class="op" id="6655651">.</span><span class="ident" id="6655652"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6655653">)</span>&nbsp;<span class="op" id="6655655">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655658">var</span>&nbsp;<span class="ident" id="6655662">mu</span>&nbsp;<span class="ident" id="6655665"><a href="/gostd/net/fd_mutex.go.html#3249583">fdMutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655674">if</span>&nbsp;<span class="op" id="6655677">!</span><span class="ident" id="6655678"><a href="/gostd/net/fd_mutex_test.go.html#6655662">mu</a></span><span class="op" id="6655680">.</span><span class="ident" id="6655681"><a href="/gostd/net/fd_mutex.go.html#3251158">IncrefAndClose</a></span><span class="op" id="6655695">(</span><span class="op" id="6655696">)</span>&nbsp;<span class="op" id="6655698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655702"><a href="/gostd/net/fd_mutex_test.go.html#6655641">t</a></span><span class="op" id="6655703">.</span><span class="ident" id="6655704"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6655709">(</span><span class="string" id="6655710">&#34;broken&#34;</span><span class="op" id="6655718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655725">if</span>&nbsp;<span class="ident" id="6655728"><a href="/gostd/net/fd_mutex_test.go.html#6655662">mu</a></span><span class="op" id="6655730">.</span><span class="ident" id="6655731"><a href="/gostd/net/fd_mutex.go.html#3250854">Incref</a></span><span class="op" id="6655737">(</span><span class="op" id="6655738">)</span>&nbsp;<span class="op" id="6655740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655744"><a href="/gostd/net/fd_mutex_test.go.html#6655641">t</a></span><span class="op" id="6655745">.</span><span class="ident" id="6655746"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6655751">(</span><span class="string" id="6655752">&#34;broken&#34;</span><span class="op" id="6655760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655766">if</span>&nbsp;<span class="ident" id="6655769"><a href="/gostd/net/fd_mutex_test.go.html#6655662">mu</a></span><span class="op" id="6655771">.</span><span class="ident" id="6655772"><a href="/gostd/net/fd_mutex.go.html#3252171">RWLock</a></span><span class="op" id="6655778">(</span><span class="builtintype" id="6655779">true</span><span class="op" id="6655783">)</span>&nbsp;<span class="op" id="6655785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655789"><a href="/gostd/net/fd_mutex_test.go.html#6655641">t</a></span><span class="op" id="6655790">.</span><span class="ident" id="6655791"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6655796">(</span><span class="string" id="6655797">&#34;broken&#34;</span><span class="op" id="6655805">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655811">if</span>&nbsp;<span class="ident" id="6655814"><a href="/gostd/net/fd_mutex_test.go.html#6655662">mu</a></span><span class="op" id="6655816">.</span><span class="ident" id="6655817"><a href="/gostd/net/fd_mutex.go.html#3252171">RWLock</a></span><span class="op" id="6655823">(</span><span class="builtintype" id="6655824">false</span><span class="op" id="6655829">)</span>&nbsp;<span class="op" id="6655831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655835"><a href="/gostd/net/fd_mutex_test.go.html#6655641">t</a></span><span class="op" id="6655836">.</span><span class="ident" id="6655837"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6655842">(</span><span class="string" id="6655843">&#34;broken&#34;</span><span class="op" id="6655851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655857">if</span>&nbsp;<span class="ident" id="6655860"><a href="/gostd/net/fd_mutex_test.go.html#6655662">mu</a></span><span class="op" id="6655862">.</span><span class="ident" id="6655863"><a href="/gostd/net/fd_mutex.go.html#3251158">IncrefAndClose</a></span><span class="op" id="6655877">(</span><span class="op" id="6655878">)</span>&nbsp;<span class="op" id="6655880">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655884"><a href="/gostd/net/fd_mutex_test.go.html#6655641">t</a></span><span class="op" id="6655885">.</span><span class="ident" id="6655886"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6655891">(</span><span class="string" id="6655892">&#34;broken&#34;</span><span class="op" id="6655900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655903">}</span><br>
<span class="lineno"></span><span class="op" id="6655905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6655908">func</span>&nbsp;<span class="ident" id="6655913">TestMutexCloseUnblock</span><span class="op" id="6655934">(</span><span class="ident" id="6655935">t</span>&nbsp;<span class="op" id="6655937">*</span><span class="ident" id="6655938"><a href="/gostd/net/fd_mutex_test.go.html#6655272">testing</a></span><span class="op" id="6655945">.</span><span class="ident" id="6655946"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6655947">)</span>&nbsp;<span class="op" id="6655949">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655952">c</span>&nbsp;<span class="op" id="6655954">:=</span>&nbsp;<span class="builtinfunc" id="6655957">make</span><span class="op" id="6655961">(</span><span class="keyword" id="6655962">chan</span>&nbsp;<span class="builtintype" id="6655967">bool</span><span class="op" id="6655971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655974">var</span>&nbsp;<span class="ident" id="6655978">mu</span>&nbsp;<span class="ident" id="6655981"><a href="/gostd/net/fd_mutex.go.html#3249583">fdMutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655990"><a href="/gostd/net/fd_mutex_test.go.html#6655978">mu</a></span><span class="op" id="6655992">.</span><span class="ident" id="6655993"><a href="/gostd/net/fd_mutex.go.html#3252171">RWLock</a></span><span class="op" id="6655999">(</span><span class="builtintype" id="6656000">true</span><span class="op" id="6656004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656007">for</span>&nbsp;<span class="ident" id="6656011">i</span>&nbsp;<span class="op" id="6656013">:=</span>&nbsp;<span class="num" id="6656016">0</span><span class="op" id="6656017">;</span>&nbsp;<span class="ident" id="6656019"><a href="/gostd/net/fd_mutex_test.go.html#6656011">i</a></span>&nbsp;<span class="op" id="6656021">&lt;</span>&nbsp;<span class="num" id="6656023">4</span><span class="op" id="6656024">;</span>&nbsp;<span class="ident" id="6656026"><a href="/gostd/net/fd_mutex_test.go.html#6656011">i</a></span><span class="op" id="6656027">++</span>&nbsp;<span class="op" id="6656030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656034">go</span>&nbsp;<span class="keyword" id="6656037">func</span><span class="op" id="6656041">(</span><span class="op" id="6656042">)</span>&nbsp;<span class="op" id="6656044">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656049">if</span>&nbsp;<span class="ident" id="6656052"><a href="/gostd/net/fd_mutex_test.go.html#6655978">mu</a></span><span class="op" id="6656054">.</span><span class="ident" id="6656055"><a href="/gostd/net/fd_mutex.go.html#3252171">RWLock</a></span><span class="op" id="6656061">(</span><span class="builtintype" id="6656062">true</span><span class="op" id="6656066">)</span>&nbsp;<span class="op" id="6656068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656074"><a href="/gostd/net/fd_mutex_test.go.html#6655935">t</a></span><span class="op" id="6656075">.</span><span class="ident" id="6656076"><a href="/gostd/testing/testing.go.html#5479963">Error</a></span><span class="op" id="6656081">(</span><span class="string" id="6656082">&#34;broken&#34;</span><span class="op" id="6656090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656096">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656111"><a href="/gostd/net/fd_mutex_test.go.html#6655952">c</a></span>&nbsp;<span class="op" id="6656113">&lt;-</span>&nbsp;<span class="builtintype" id="6656116">true</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656123">}</span><span class="op" id="6656124">(</span><span class="op" id="6656125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6656131">//&nbsp;Concurrent&nbsp;goroutines&nbsp;must&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;lock&nbsp;the&nbsp;mutex.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656198"><a href="/gostd/net/fd_mutex_test.go.html#6655283">time</a></span><span class="op" id="6656202">.</span><span class="ident" id="6656203"><a href="/gostd/time/sleep.go.html#2713940">Sleep</a></span><span class="op" id="6656208">(</span><span class="ident" id="6656209"><a href="/gostd/net/fd_mutex_test.go.html#6655283">time</a></span><span class="op" id="6656213">.</span><span class="ident" id="6656214"><a href="/gostd/time/time.go.html#2734819">Millisecond</a></span><span class="op" id="6656225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656228">select</span>&nbsp;<span class="op" id="6656235">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656238">case</span>&nbsp;<span class="op" id="6656243">&lt;-</span><span class="ident" id="6656245"><a href="/gostd/net/fd_mutex_test.go.html#6655952">c</a></span><span class="op" id="6656246">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656250"><a href="/gostd/net/fd_mutex_test.go.html#6655935">t</a></span><span class="op" id="6656251">.</span><span class="ident" id="6656252"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6656257">(</span><span class="string" id="6656258">&#34;broken&#34;</span><span class="op" id="6656266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656269">default</span><span class="op" id="6656276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656282"><a href="/gostd/net/fd_mutex_test.go.html#6655978">mu</a></span><span class="op" id="6656284">.</span><span class="ident" id="6656285"><a href="/gostd/net/fd_mutex.go.html#3251158">IncrefAndClose</a></span><span class="op" id="6656299">(</span><span class="op" id="6656300">)</span>&nbsp;<span class="comment" id="6656302">//&nbsp;Must&nbsp;unblock&nbsp;the&nbsp;readers.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656332">for</span>&nbsp;<span class="ident" id="6656336">i</span>&nbsp;<span class="op" id="6656338">:=</span>&nbsp;<span class="num" id="6656341">0</span><span class="op" id="6656342">;</span>&nbsp;<span class="ident" id="6656344"><a href="/gostd/net/fd_mutex_test.go.html#6656336">i</a></span>&nbsp;<span class="op" id="6656346">&lt;</span>&nbsp;<span class="num" id="6656348">4</span><span class="op" id="6656349">;</span>&nbsp;<span class="ident" id="6656351"><a href="/gostd/net/fd_mutex_test.go.html#6656336">i</a></span><span class="op" id="6656352">++</span>&nbsp;<span class="op" id="6656355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656359">select</span>&nbsp;<span class="op" id="6656366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656370">case</span>&nbsp;<span class="op" id="6656375">&lt;-</span><span class="ident" id="6656377"><a href="/gostd/net/fd_mutex_test.go.html#6655952">c</a></span><span class="op" id="6656378">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656382">case</span>&nbsp;<span class="op" id="6656387">&lt;-</span><span class="ident" id="6656389"><a href="/gostd/net/fd_mutex_test.go.html#6655283">time</a></span><span class="op" id="6656393">.</span><span class="ident" id="6656394"><a href="/gostd/time/sleep.go.html#2716644">After</a></span><span class="op" id="6656399">(</span><span class="num" id="6656400">10</span>&nbsp;<span class="op" id="6656403">*</span>&nbsp;<span class="ident" id="6656405"><a href="/gostd/net/fd_mutex_test.go.html#6655283">time</a></span><span class="op" id="6656409">.</span><span class="ident" id="6656410"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="6656416">)</span><span class="op" id="6656417">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656422"><a href="/gostd/net/fd_mutex_test.go.html#6655935">t</a></span><span class="op" id="6656423">.</span><span class="ident" id="6656424"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6656429">(</span><span class="string" id="6656430">&#34;broken&#34;</span><span class="op" id="6656438">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656448">if</span>&nbsp;<span class="ident" id="6656451"><a href="/gostd/net/fd_mutex_test.go.html#6655978">mu</a></span><span class="op" id="6656453">.</span><span class="ident" id="6656454"><a href="/gostd/net/fd_mutex.go.html#3251874">Decref</a></span><span class="op" id="6656460">(</span><span class="op" id="6656461">)</span>&nbsp;<span class="op" id="6656463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656467"><a href="/gostd/net/fd_mutex_test.go.html#6655935">t</a></span><span class="op" id="6656468">.</span><span class="ident" id="6656469"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6656474">(</span><span class="string" id="6656475">&#34;broken&#34;</span><span class="op" id="6656483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656486">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656489">if</span>&nbsp;<span class="op" id="6656492">!</span><span class="ident" id="6656493"><a href="/gostd/net/fd_mutex_test.go.html#6655978">mu</a></span><span class="op" id="6656495">.</span><span class="ident" id="6656496"><a href="/gostd/net/fd_mutex.go.html#3253103">RWUnlock</a></span><span class="op" id="6656504">(</span><span class="builtintype" id="6656505">true</span><span class="op" id="6656509">)</span>&nbsp;<span class="op" id="6656511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656515"><a href="/gostd/net/fd_mutex_test.go.html#6655935">t</a></span><span class="op" id="6656516">.</span><span class="ident" id="6656517"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6656522">(</span><span class="string" id="6656523">&#34;broken&#34;</span><span class="op" id="6656531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656534">}</span><br>
<span class="lineno"></span><span class="op" id="6656536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6656539">func</span>&nbsp;<span class="ident" id="6656544">TestMutexPanic</span><span class="op" id="6656558">(</span><span class="ident" id="6656559">t</span>&nbsp;<span class="op" id="6656561">*</span><span class="ident" id="6656562"><a href="/gostd/net/fd_mutex_test.go.html#6655272">testing</a></span><span class="op" id="6656569">.</span><span class="ident" id="6656570"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6656571">)</span>&nbsp;<span class="op" id="6656573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656576">ensurePanics</span>&nbsp;<span class="op" id="6656589">:=</span>&nbsp;<span class="keyword" id="6656592">func</span><span class="op" id="6656596">(</span><span class="ident" id="6656597">f</span>&nbsp;<span class="keyword" id="6656599">func</span><span class="op" id="6656603">(</span><span class="op" id="6656604">)</span><span class="op" id="6656605">)</span>&nbsp;<span class="op" id="6656607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656611">defer</span>&nbsp;<span class="keyword" id="6656617">func</span><span class="op" id="6656621">(</span><span class="op" id="6656622">)</span>&nbsp;<span class="op" id="6656624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656629">if</span>&nbsp;<span class="builtinfunc" id="6656632">recover</span><span class="op" id="6656639">(</span><span class="op" id="6656640">)</span>&nbsp;<span class="op" id="6656642">==</span>&nbsp;<span class="builtintype" id="6656645">nil</span>&nbsp;<span class="op" id="6656649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656655"><a href="/gostd/net/fd_mutex_test.go.html#6656559">t</a></span><span class="op" id="6656656">.</span><span class="ident" id="6656657"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6656662">(</span><span class="string" id="6656663">&#34;does&nbsp;not&nbsp;panic&#34;</span><span class="op" id="6656679">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656688">}</span><span class="op" id="6656689">(</span><span class="op" id="6656690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656694"><a href="/gostd/net/fd_mutex_test.go.html#6656597">f</a></span><span class="op" id="6656695">(</span><span class="op" id="6656696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656703">var</span>&nbsp;<span class="ident" id="6656707">mu</span>&nbsp;<span class="ident" id="6656710"><a href="/gostd/net/fd_mutex.go.html#3249583">fdMutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656719"><a href="/gostd/net/fd_mutex_test.go.html#6656576">ensurePanics</a></span><span class="op" id="6656731">(</span><span class="keyword" id="6656732">func</span><span class="op" id="6656736">(</span><span class="op" id="6656737">)</span>&nbsp;<span class="op" id="6656739">{</span>&nbsp;<span class="ident" id="6656741"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6656743">.</span><span class="ident" id="6656744"><a href="/gostd/net/fd_mutex.go.html#3251874">Decref</a></span><span class="op" id="6656750">(</span><span class="op" id="6656751">)</span>&nbsp;<span class="op" id="6656753">}</span><span class="op" id="6656754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656757"><a href="/gostd/net/fd_mutex_test.go.html#6656576">ensurePanics</a></span><span class="op" id="6656769">(</span><span class="keyword" id="6656770">func</span><span class="op" id="6656774">(</span><span class="op" id="6656775">)</span>&nbsp;<span class="op" id="6656777">{</span>&nbsp;<span class="ident" id="6656779"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6656781">.</span><span class="ident" id="6656782"><a href="/gostd/net/fd_mutex.go.html#3253103">RWUnlock</a></span><span class="op" id="6656790">(</span><span class="builtintype" id="6656791">true</span><span class="op" id="6656795">)</span>&nbsp;<span class="op" id="6656797">}</span><span class="op" id="6656798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656801"><a href="/gostd/net/fd_mutex_test.go.html#6656576">ensurePanics</a></span><span class="op" id="6656813">(</span><span class="keyword" id="6656814">func</span><span class="op" id="6656818">(</span><span class="op" id="6656819">)</span>&nbsp;<span class="op" id="6656821">{</span>&nbsp;<span class="ident" id="6656823"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6656825">.</span><span class="ident" id="6656826"><a href="/gostd/net/fd_mutex.go.html#3253103">RWUnlock</a></span><span class="op" id="6656834">(</span><span class="builtintype" id="6656835">false</span><span class="op" id="6656840">)</span>&nbsp;<span class="op" id="6656842">}</span><span class="op" id="6656843">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656847"><a href="/gostd/net/fd_mutex_test.go.html#6656576">ensurePanics</a></span><span class="op" id="6656859">(</span><span class="keyword" id="6656860">func</span><span class="op" id="6656864">(</span><span class="op" id="6656865">)</span>&nbsp;<span class="op" id="6656867">{</span>&nbsp;<span class="ident" id="6656869"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6656871">.</span><span class="ident" id="6656872"><a href="/gostd/net/fd_mutex.go.html#3250854">Incref</a></span><span class="op" id="6656878">(</span><span class="op" id="6656879">)</span><span class="op" id="6656880">;</span>&nbsp;<span class="ident" id="6656882"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6656884">.</span><span class="ident" id="6656885"><a href="/gostd/net/fd_mutex.go.html#3251874">Decref</a></span><span class="op" id="6656891">(</span><span class="op" id="6656892">)</span><span class="op" id="6656893">;</span>&nbsp;<span class="ident" id="6656895"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6656897">.</span><span class="ident" id="6656898"><a href="/gostd/net/fd_mutex.go.html#3251874">Decref</a></span><span class="op" id="6656904">(</span><span class="op" id="6656905">)</span>&nbsp;<span class="op" id="6656907">}</span><span class="op" id="6656908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656911"><a href="/gostd/net/fd_mutex_test.go.html#6656576">ensurePanics</a></span><span class="op" id="6656923">(</span><span class="keyword" id="6656924">func</span><span class="op" id="6656928">(</span><span class="op" id="6656929">)</span>&nbsp;<span class="op" id="6656931">{</span>&nbsp;<span class="ident" id="6656933"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6656935">.</span><span class="ident" id="6656936"><a href="/gostd/net/fd_mutex.go.html#3252171">RWLock</a></span><span class="op" id="6656942">(</span><span class="builtintype" id="6656943">true</span><span class="op" id="6656947">)</span><span class="op" id="6656948">;</span>&nbsp;<span class="ident" id="6656950"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6656952">.</span><span class="ident" id="6656953"><a href="/gostd/net/fd_mutex.go.html#3253103">RWUnlock</a></span><span class="op" id="6656961">(</span><span class="builtintype" id="6656962">true</span><span class="op" id="6656966">)</span><span class="op" id="6656967">;</span>&nbsp;<span class="ident" id="6656969"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6656971">.</span><span class="ident" id="6656972"><a href="/gostd/net/fd_mutex.go.html#3253103">RWUnlock</a></span><span class="op" id="6656980">(</span><span class="builtintype" id="6656981">true</span><span class="op" id="6656985">)</span>&nbsp;<span class="op" id="6656987">}</span><span class="op" id="6656988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656991"><a href="/gostd/net/fd_mutex_test.go.html#6656576">ensurePanics</a></span><span class="op" id="6657003">(</span><span class="keyword" id="6657004">func</span><span class="op" id="6657008">(</span><span class="op" id="6657009">)</span>&nbsp;<span class="op" id="6657011">{</span>&nbsp;<span class="ident" id="6657013"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6657015">.</span><span class="ident" id="6657016"><a href="/gostd/net/fd_mutex.go.html#3252171">RWLock</a></span><span class="op" id="6657022">(</span><span class="builtintype" id="6657023">false</span><span class="op" id="6657028">)</span><span class="op" id="6657029">;</span>&nbsp;<span class="ident" id="6657031"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6657033">.</span><span class="ident" id="6657034"><a href="/gostd/net/fd_mutex.go.html#3253103">RWUnlock</a></span><span class="op" id="6657042">(</span><span class="builtintype" id="6657043">false</span><span class="op" id="6657048">)</span><span class="op" id="6657049">;</span>&nbsp;<span class="ident" id="6657051"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6657053">.</span><span class="ident" id="6657054"><a href="/gostd/net/fd_mutex.go.html#3253103">RWUnlock</a></span><span class="op" id="6657062">(</span><span class="builtintype" id="6657063">false</span><span class="op" id="6657068">)</span>&nbsp;<span class="op" id="6657070">}</span><span class="op" id="6657071">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6657075">//&nbsp;ensure&nbsp;that&nbsp;it&#39;s&nbsp;still&nbsp;not&nbsp;broken</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657113"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6657115">.</span><span class="ident" id="6657116"><a href="/gostd/net/fd_mutex.go.html#3250854">Incref</a></span><span class="op" id="6657122">(</span><span class="op" id="6657123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657126"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6657128">.</span><span class="ident" id="6657129"><a href="/gostd/net/fd_mutex.go.html#3251874">Decref</a></span><span class="op" id="6657135">(</span><span class="op" id="6657136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657139"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6657141">.</span><span class="ident" id="6657142"><a href="/gostd/net/fd_mutex.go.html#3252171">RWLock</a></span><span class="op" id="6657148">(</span><span class="builtintype" id="6657149">true</span><span class="op" id="6657153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657156"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6657158">.</span><span class="ident" id="6657159"><a href="/gostd/net/fd_mutex.go.html#3253103">RWUnlock</a></span><span class="op" id="6657167">(</span><span class="builtintype" id="6657168">true</span><span class="op" id="6657172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657175"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6657177">.</span><span class="ident" id="6657178"><a href="/gostd/net/fd_mutex.go.html#3252171">RWLock</a></span><span class="op" id="6657184">(</span><span class="builtintype" id="6657185">false</span><span class="op" id="6657190">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657193"><a href="/gostd/net/fd_mutex_test.go.html#6656707">mu</a></span><span class="op" id="6657195">.</span><span class="ident" id="6657196"><a href="/gostd/net/fd_mutex.go.html#3253103">RWUnlock</a></span><span class="op" id="6657204">(</span><span class="builtintype" id="6657205">false</span><span class="op" id="6657210">)</span><br>
<span class="lineno"></span><span class="op" id="6657212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6657215">func</span>&nbsp;<span class="ident" id="6657220">TestMutexStress</span><span class="op" id="6657235">(</span><span class="ident" id="6657236">t</span>&nbsp;<span class="op" id="6657238">*</span><span class="ident" id="6657239"><a href="/gostd/net/fd_mutex_test.go.html#6655272">testing</a></span><span class="op" id="6657246">.</span><span class="ident" id="6657247"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6657248">)</span>&nbsp;<span class="op" id="6657250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657253">P</span>&nbsp;<span class="op" id="6657255">:=</span>&nbsp;<span class="num" id="6657258">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657261">N</span>&nbsp;<span class="op" id="6657263">:=</span>&nbsp;<span class="builtintype" id="6657266">int</span><span class="op" id="6657269">(</span><span class="num" id="6657270">1e6</span><span class="op" id="6657273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657276">if</span>&nbsp;<span class="ident" id="6657279"><a href="/gostd/net/fd_mutex_test.go.html#6655272">testing</a></span><span class="op" id="6657286">.</span><span class="ident" id="6657287"><a href="/gostd/testing/testing.go.html#5475359">Short</a></span><span class="op" id="6657292">(</span><span class="op" id="6657293">)</span>&nbsp;<span class="op" id="6657295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657299"><a href="/gostd/net/fd_mutex_test.go.html#6657253">P</a></span>&nbsp;<span class="op" id="6657301">=</span>&nbsp;<span class="num" id="6657303">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657307"><a href="/gostd/net/fd_mutex_test.go.html#6657261">N</a></span>&nbsp;<span class="op" id="6657309">=</span>&nbsp;<span class="num" id="6657311">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6657316">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657319">defer</span>&nbsp;<span class="ident" id="6657325"><a href="/gostd/net/fd_mutex_test.go.html#6655261">runtime</a></span><span class="op" id="6657332">.</span><span class="ident" id="6657333"><a href="/gostd/runtime/debug.go.html#1521359">GOMAXPROCS</a></span><span class="op" id="6657343">(</span><span class="ident" id="6657344"><a href="/gostd/net/fd_mutex_test.go.html#6655261">runtime</a></span><span class="op" id="6657351">.</span><span class="ident" id="6657352"><a href="/gostd/runtime/debug.go.html#1521359">GOMAXPROCS</a></span><span class="op" id="6657362">(</span><span class="ident" id="6657363"><a href="/gostd/net/fd_mutex_test.go.html#6657253">P</a></span><span class="op" id="6657364">)</span><span class="op" id="6657365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657368">done</span>&nbsp;<span class="op" id="6657373">:=</span>&nbsp;<span class="builtinfunc" id="6657376">make</span><span class="op" id="6657380">(</span><span class="keyword" id="6657381">chan</span>&nbsp;<span class="builtintype" id="6657386">bool</span><span class="op" id="6657390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657393">var</span>&nbsp;<span class="ident" id="6657397">mu</span>&nbsp;<span class="ident" id="6657400"><a href="/gostd/net/fd_mutex.go.html#3249583">fdMutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657409">var</span>&nbsp;<span class="ident" id="6657413">readState</span>&nbsp;<span class="op" id="6657423">[</span><span class="num" id="6657424">2</span><span class="op" id="6657425">]</span><span class="builtintype" id="6657426">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657434">var</span>&nbsp;<span class="ident" id="6657438">writeState</span>&nbsp;<span class="op" id="6657449">[</span><span class="num" id="6657450">2</span><span class="op" id="6657451">]</span><span class="builtintype" id="6657452">uint64</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657460">for</span>&nbsp;<span class="ident" id="6657464">p</span>&nbsp;<span class="op" id="6657466">:=</span>&nbsp;<span class="num" id="6657469">0</span><span class="op" id="6657470">;</span>&nbsp;<span class="ident" id="6657472"><a href="/gostd/net/fd_mutex_test.go.html#6657464">p</a></span>&nbsp;<span class="op" id="6657474">&lt;</span>&nbsp;<span class="ident" id="6657476"><a href="/gostd/net/fd_mutex_test.go.html#6657253">P</a></span><span class="op" id="6657477">;</span>&nbsp;<span class="ident" id="6657479"><a href="/gostd/net/fd_mutex_test.go.html#6657464">p</a></span><span class="op" id="6657480">++</span>&nbsp;<span class="op" id="6657483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657487">go</span>&nbsp;<span class="keyword" id="6657490">func</span><span class="op" id="6657494">(</span><span class="op" id="6657495">)</span>&nbsp;<span class="op" id="6657497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657502">r</span>&nbsp;<span class="op" id="6657504">:=</span>&nbsp;<span class="ident" id="6657507"><a href="/gostd/net/fd_mutex_test.go.html#6655248">rand</a></span><span class="op" id="6657511">.</span><span class="ident" id="6657512"><a href="/gostd/math/rand/rand.go.html#2922124">New</a></span><span class="op" id="6657515">(</span><span class="ident" id="6657516"><a href="/gostd/net/fd_mutex_test.go.html#6655248">rand</a></span><span class="op" id="6657520">.</span><span class="ident" id="6657521"><a href="/gostd/math/rand/rand.go.html#2921867">NewSource</a></span><span class="op" id="6657530">(</span><span class="ident" id="6657531"><a href="/gostd/net/fd_mutex_test.go.html#6655248">rand</a></span><span class="op" id="6657535">.</span><span class="ident" id="6657536"><a href="/gostd/math/rand/rand.go.html#2926285">Int63</a></span><span class="op" id="6657541">(</span><span class="op" id="6657542">)</span><span class="op" id="6657543">)</span><span class="op" id="6657544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657549">for</span>&nbsp;<span class="ident" id="6657553">i</span>&nbsp;<span class="op" id="6657555">:=</span>&nbsp;<span class="num" id="6657558">0</span><span class="op" id="6657559">;</span>&nbsp;<span class="ident" id="6657561"><a href="/gostd/net/fd_mutex_test.go.html#6657553">i</a></span>&nbsp;<span class="op" id="6657563">&lt;</span>&nbsp;<span class="ident" id="6657565"><a href="/gostd/net/fd_mutex_test.go.html#6657261">N</a></span><span class="op" id="6657566">;</span>&nbsp;<span class="ident" id="6657568"><a href="/gostd/net/fd_mutex_test.go.html#6657553">i</a></span><span class="op" id="6657569">++</span>&nbsp;<span class="op" id="6657572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657578">switch</span>&nbsp;<span class="ident" id="6657585"><a href="/gostd/net/fd_mutex_test.go.html#6657502">r</a></span><span class="op" id="6657586">.</span><span class="ident" id="6657587"><a href="/gostd/math/rand/rand.go.html#2923767">Intn</a></span><span class="op" id="6657591">(</span><span class="num" id="6657592">3</span><span class="op" id="6657593">)</span>&nbsp;<span class="op" id="6657595">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657601">case</span>&nbsp;<span class="num" id="6657606">0</span><span class="op" id="6657607">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657614">if</span>&nbsp;<span class="op" id="6657617">!</span><span class="ident" id="6657618"><a href="/gostd/net/fd_mutex_test.go.html#6657397">mu</a></span><span class="op" id="6657620">.</span><span class="ident" id="6657621"><a href="/gostd/net/fd_mutex.go.html#3250854">Incref</a></span><span class="op" id="6657627">(</span><span class="op" id="6657628">)</span>&nbsp;<span class="op" id="6657630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657638"><a href="/gostd/net/fd_mutex_test.go.html#6657236">t</a></span><span class="op" id="6657639">.</span><span class="ident" id="6657640"><a href="/gostd/testing/testing.go.html#5479963">Error</a></span><span class="op" id="6657645">(</span><span class="string" id="6657646">&#34;broken&#34;</span><span class="op" id="6657654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657662">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6657674">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657681">if</span>&nbsp;<span class="ident" id="6657684"><a href="/gostd/net/fd_mutex_test.go.html#6657397">mu</a></span><span class="op" id="6657686">.</span><span class="ident" id="6657687"><a href="/gostd/net/fd_mutex.go.html#3251874">Decref</a></span><span class="op" id="6657693">(</span><span class="op" id="6657694">)</span>&nbsp;<span class="op" id="6657696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657704"><a href="/gostd/net/fd_mutex_test.go.html#6657236">t</a></span><span class="op" id="6657705">.</span><span class="ident" id="6657706"><a href="/gostd/testing/testing.go.html#5479963">Error</a></span><span class="op" id="6657711">(</span><span class="string" id="6657712">&#34;broken&#34;</span><span class="op" id="6657720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657728">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6657740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657746">case</span>&nbsp;<span class="num" id="6657751">1</span><span class="op" id="6657752">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657759">if</span>&nbsp;<span class="op" id="6657762">!</span><span class="ident" id="6657763"><a href="/gostd/net/fd_mutex_test.go.html#6657397">mu</a></span><span class="op" id="6657765">.</span><span class="ident" id="6657766"><a href="/gostd/net/fd_mutex.go.html#3252171">RWLock</a></span><span class="op" id="6657772">(</span><span class="builtintype" id="6657773">true</span><span class="op" id="6657777">)</span>&nbsp;<span class="op" id="6657779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657787"><a href="/gostd/net/fd_mutex_test.go.html#6657236">t</a></span><span class="op" id="6657788">.</span><span class="ident" id="6657789"><a href="/gostd/testing/testing.go.html#5479963">Error</a></span><span class="op" id="6657794">(</span><span class="string" id="6657795">&#34;broken&#34;</span><span class="op" id="6657803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657811">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6657823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6657830">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;readers.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657892">if</span>&nbsp;<span class="ident" id="6657895"><a href="/gostd/net/fd_mutex_test.go.html#6657413">readState</a></span><span class="op" id="6657904">[</span><span class="num" id="6657905">0</span><span class="op" id="6657906">]</span>&nbsp;<span class="op" id="6657908">!=</span>&nbsp;<span class="ident" id="6657911"><a href="/gostd/net/fd_mutex_test.go.html#6657413">readState</a></span><span class="op" id="6657920">[</span><span class="num" id="6657921">1</span><span class="op" id="6657922">]</span>&nbsp;<span class="op" id="6657924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657932"><a href="/gostd/net/fd_mutex_test.go.html#6657236">t</a></span><span class="op" id="6657933">.</span><span class="ident" id="6657934"><a href="/gostd/testing/testing.go.html#5479963">Error</a></span><span class="op" id="6657939">(</span><span class="string" id="6657940">&#34;broken&#34;</span><span class="op" id="6657948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657956">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6657968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657975"><a href="/gostd/net/fd_mutex_test.go.html#6657413">readState</a></span><span class="op" id="6657984">[</span><span class="num" id="6657985">0</span><span class="op" id="6657986">]</span><span class="op" id="6657987">++</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657995"><a href="/gostd/net/fd_mutex_test.go.html#6657413">readState</a></span><span class="op" id="6658004">[</span><span class="num" id="6658005">1</span><span class="op" id="6658006">]</span><span class="op" id="6658007">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658015">if</span>&nbsp;<span class="ident" id="6658018"><a href="/gostd/net/fd_mutex_test.go.html#6657397">mu</a></span><span class="op" id="6658020">.</span><span class="ident" id="6658021"><a href="/gostd/net/fd_mutex.go.html#3253103">RWUnlock</a></span><span class="op" id="6658029">(</span><span class="builtintype" id="6658030">true</span><span class="op" id="6658034">)</span>&nbsp;<span class="op" id="6658036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658044"><a href="/gostd/net/fd_mutex_test.go.html#6657236">t</a></span><span class="op" id="6658045">.</span><span class="ident" id="6658046"><a href="/gostd/testing/testing.go.html#5479963">Error</a></span><span class="op" id="6658051">(</span><span class="string" id="6658052">&#34;broken&#34;</span><span class="op" id="6658060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658068">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658080">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658086">case</span>&nbsp;<span class="num" id="6658091">2</span><span class="op" id="6658092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658099">if</span>&nbsp;<span class="op" id="6658102">!</span><span class="ident" id="6658103"><a href="/gostd/net/fd_mutex_test.go.html#6657397">mu</a></span><span class="op" id="6658105">.</span><span class="ident" id="6658106"><a href="/gostd/net/fd_mutex.go.html#3252171">RWLock</a></span><span class="op" id="6658112">(</span><span class="builtintype" id="6658113">false</span><span class="op" id="6658118">)</span>&nbsp;<span class="op" id="6658120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658128"><a href="/gostd/net/fd_mutex_test.go.html#6657236">t</a></span><span class="op" id="6658129">.</span><span class="ident" id="6658130"><a href="/gostd/testing/testing.go.html#5479963">Error</a></span><span class="op" id="6658135">(</span><span class="string" id="6658136">&#34;broken&#34;</span><span class="op" id="6658144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658152">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658164">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6658171">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;writers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658233">if</span>&nbsp;<span class="ident" id="6658236"><a href="/gostd/net/fd_mutex_test.go.html#6657438">writeState</a></span><span class="op" id="6658246">[</span><span class="num" id="6658247">0</span><span class="op" id="6658248">]</span>&nbsp;<span class="op" id="6658250">!=</span>&nbsp;<span class="ident" id="6658253"><a href="/gostd/net/fd_mutex_test.go.html#6657438">writeState</a></span><span class="op" id="6658263">[</span><span class="num" id="6658264">1</span><span class="op" id="6658265">]</span>&nbsp;<span class="op" id="6658267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658275"><a href="/gostd/net/fd_mutex_test.go.html#6657236">t</a></span><span class="op" id="6658276">.</span><span class="ident" id="6658277"><a href="/gostd/testing/testing.go.html#5479963">Error</a></span><span class="op" id="6658282">(</span><span class="string" id="6658283">&#34;broken&#34;</span><span class="op" id="6658291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658299">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658311">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658318"><a href="/gostd/net/fd_mutex_test.go.html#6657438">writeState</a></span><span class="op" id="6658328">[</span><span class="num" id="6658329">0</span><span class="op" id="6658330">]</span><span class="op" id="6658331">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658339"><a href="/gostd/net/fd_mutex_test.go.html#6657438">writeState</a></span><span class="op" id="6658349">[</span><span class="num" id="6658350">1</span><span class="op" id="6658351">]</span><span class="op" id="6658352">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658360">if</span>&nbsp;<span class="ident" id="6658363"><a href="/gostd/net/fd_mutex_test.go.html#6657397">mu</a></span><span class="op" id="6658365">.</span><span class="ident" id="6658366"><a href="/gostd/net/fd_mutex.go.html#3253103">RWUnlock</a></span><span class="op" id="6658374">(</span><span class="builtintype" id="6658375">false</span><span class="op" id="6658380">)</span>&nbsp;<span class="op" id="6658382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658390"><a href="/gostd/net/fd_mutex_test.go.html#6657236">t</a></span><span class="op" id="6658391">.</span><span class="ident" id="6658392"><a href="/gostd/testing/testing.go.html#5479963">Error</a></span><span class="op" id="6658397">(</span><span class="string" id="6658398">&#34;broken&#34;</span><span class="op" id="6658406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658414">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658442"><a href="/gostd/net/fd_mutex_test.go.html#6657368">done</a></span>&nbsp;<span class="op" id="6658447">&lt;-</span>&nbsp;<span class="builtintype" id="6658450">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658457">}</span><span class="op" id="6658458">(</span><span class="op" id="6658459">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658465">for</span>&nbsp;<span class="ident" id="6658469">p</span>&nbsp;<span class="op" id="6658471">:=</span>&nbsp;<span class="num" id="6658474">0</span><span class="op" id="6658475">;</span>&nbsp;<span class="ident" id="6658477"><a href="/gostd/net/fd_mutex_test.go.html#6658469">p</a></span>&nbsp;<span class="op" id="6658479">&lt;</span>&nbsp;<span class="ident" id="6658481"><a href="/gostd/net/fd_mutex_test.go.html#6657253">P</a></span><span class="op" id="6658482">;</span>&nbsp;<span class="ident" id="6658484"><a href="/gostd/net/fd_mutex_test.go.html#6658469">p</a></span><span class="op" id="6658485">++</span>&nbsp;<span class="op" id="6658488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658492">&lt;-</span><span class="ident" id="6658494"><a href="/gostd/net/fd_mutex_test.go.html#6657368">done</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658503">if</span>&nbsp;<span class="op" id="6658506">!</span><span class="ident" id="6658507"><a href="/gostd/net/fd_mutex_test.go.html#6657397">mu</a></span><span class="op" id="6658509">.</span><span class="ident" id="6658510"><a href="/gostd/net/fd_mutex.go.html#3251158">IncrefAndClose</a></span><span class="op" id="6658524">(</span><span class="op" id="6658525">)</span>&nbsp;<span class="op" id="6658527">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658531"><a href="/gostd/net/fd_mutex_test.go.html#6657236">t</a></span><span class="op" id="6658532">.</span><span class="ident" id="6658533"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6658538">(</span><span class="string" id="6658539">&#34;broken&#34;</span><span class="op" id="6658547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658553">if</span>&nbsp;<span class="op" id="6658556">!</span><span class="ident" id="6658557"><a href="/gostd/net/fd_mutex_test.go.html#6657397">mu</a></span><span class="op" id="6658559">.</span><span class="ident" id="6658560"><a href="/gostd/net/fd_mutex.go.html#3251874">Decref</a></span><span class="op" id="6658566">(</span><span class="op" id="6658567">)</span>&nbsp;<span class="op" id="6658569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658573"><a href="/gostd/net/fd_mutex_test.go.html#6657236">t</a></span><span class="op" id="6658574">.</span><span class="ident" id="6658575"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6658580">(</span><span class="string" id="6658581">&#34;broken&#34;</span><span class="op" id="6658589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658592">}</span><br>
<span class="lineno">195</span><span class="op" id="6658594">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
