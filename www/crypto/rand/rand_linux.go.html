<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3653242">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3653298">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3653352">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3653403">package</span>&nbsp;<span class="ident" id="3653411">rand</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3653417">import</span>&nbsp;<span class="op" id="3653424">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3653427">&#34;internal/syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3653447">&#34;sync&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3653454">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3653457">func</span>&nbsp;<span class="ident" id="3653462">init</span><span class="op" id="3653466">(</span><span class="op" id="3653467">)</span>&nbsp;<span class="op" id="3653469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3653472"><a href="/crypto/rand/rand_unix.go.html#3655047">altGetRandom</a></span>&nbsp;<span class="op" id="3653485">=</span>&nbsp;<span class="ident" id="3653487"><a href="/crypto/rand/rand_linux.go.html#3653965">getRandomLinux</a></span><br>
<span class="lineno"></span><span class="op" id="3653502">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3653505">var</span>&nbsp;<span class="op" id="3653509">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3653512">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653523"><a href="/crypto/rand/rand_linux.go.html#3653447">sync</a></span><span class="op" id="3653527">.</span><span class="ident" id="3653528">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3653534">useSyscall</span>&nbsp;<span class="builtintype" id="3653545">bool</span><br>
<span class="lineno"></span><span class="op" id="3653550">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3653553">func</span>&nbsp;<span class="ident" id="3653558">pickStrategy</span><span class="op" id="3653570">(</span><span class="op" id="3653571">)</span>&nbsp;<span class="op" id="3653573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3653576">//&nbsp;Test&nbsp;whether&nbsp;we&nbsp;should&nbsp;use&nbsp;the&nbsp;system&nbsp;call&nbsp;or&nbsp;/dev/urandom.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3653640">//&nbsp;We&#39;ll&nbsp;fall&nbsp;back&nbsp;to&nbsp;urandom&nbsp;if:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3653675">//&nbsp;-&nbsp;the&nbsp;kernel&nbsp;is&nbsp;too&nbsp;old&nbsp;(before&nbsp;3.17)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3653717">//&nbsp;-&nbsp;the&nbsp;machine&nbsp;has&nbsp;no&nbsp;entropy&nbsp;available&nbsp;(early&nbsp;boot&nbsp;+&nbsp;no&nbsp;hardware</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3653786">//&nbsp;&nbsp;&nbsp;entropy&nbsp;source?)&nbsp;and&nbsp;we&nbsp;want&nbsp;to&nbsp;avoid&nbsp;blocking&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3653846">var</span>&nbsp;<span class="ident" id="3653850">buf</span>&nbsp;<span class="op" id="3653854">[</span><span class="num" id="3653855">1</span><span class="op" id="3653856">]</span><span class="builtintype" id="3653857">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3653863">n</span><span class="op" id="3653864">,</span>&nbsp;<span class="ident" id="3653866">err</span>&nbsp;<span class="op" id="3653870">:=</span>&nbsp;<span class="ident" id="3653873"><a href="/crypto/rand/rand_linux.go.html#3653427">syscall</a></span><span class="op" id="3653880">.</span><span class="ident" id="3653881">GetRandom</span><span class="op" id="3653890">(</span><span class="ident" id="3653891"><a href="/crypto/rand/rand_linux.go.html#3653850">buf</a></span><span class="op" id="3653894">[</span><span class="op" id="3653895">:</span><span class="op" id="3653896">]</span><span class="op" id="3653897">,</span>&nbsp;<span class="ident" id="3653899"><a href="/crypto/rand/rand_linux.go.html#3653427">syscall</a></span><span class="op" id="3653906">.</span><span class="ident" id="3653907">GRND_NONBLOCK</span><span class="op" id="3653920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3653923"><a href="/crypto/rand/rand_linux.go.html#3653534">useSyscall</a></span>&nbsp;<span class="op" id="3653934">=</span>&nbsp;<span class="ident" id="3653936"><a href="/crypto/rand/rand_linux.go.html#3653863">n</a></span>&nbsp;<span class="op" id="3653938">==</span>&nbsp;<span class="num" id="3653941">1</span>&nbsp;<span class="op" id="3653943">&amp;&amp;</span>&nbsp;<span class="ident" id="3653946"><a href="/crypto/rand/rand_linux.go.html#3653866">err</a></span>&nbsp;<span class="op" id="3653950">==</span>&nbsp;<span class="ident" id="3653953">nil</span><br>
<span class="lineno">30</span><span class="op" id="3653957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3653960">func</span>&nbsp;<span class="ident" id="3653965">getRandomLinux</span><span class="op" id="3653979">(</span><span class="ident" id="3653980">p</span>&nbsp;<span class="op" id="3653982">[</span><span class="op" id="3653983">]</span><span class="builtintype" id="3653984">byte</span><span class="op" id="3653988">)</span>&nbsp;<span class="op" id="3653990">(</span><span class="ident" id="3653991">ok</span>&nbsp;<span class="builtintype" id="3653994">bool</span><span class="op" id="3653998">)</span>&nbsp;<span class="op" id="3654000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654003"><a href="/crypto/rand/rand_linux.go.html#3653512">once</a></span><span class="op" id="3654007">.</span><span class="ident" id="3654008">Do</span><span class="op" id="3654010">(</span><span class="ident" id="3654011"><a href="/crypto/rand/rand_linux.go.html#3653558">pickStrategy</a></span><span class="op" id="3654023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3654026">if</span>&nbsp;<span class="op" id="3654029">!</span><span class="ident" id="3654030"><a href="/crypto/rand/rand_linux.go.html#3653534">useSyscall</a></span>&nbsp;<span class="op" id="3654041">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3654045">return</span>&nbsp;<span class="builtintype" id="3654052">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3654059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654062">n</span><span class="op" id="3654063">,</span>&nbsp;<span class="ident" id="3654065">err</span>&nbsp;<span class="op" id="3654069">:=</span>&nbsp;<span class="ident" id="3654072"><a href="/crypto/rand/rand_linux.go.html#3653427">syscall</a></span><span class="op" id="3654079">.</span><span class="ident" id="3654080">GetRandom</span><span class="op" id="3654089">(</span><span class="ident" id="3654090"><a href="/crypto/rand/rand_linux.go.html#3653980">p</a></span><span class="op" id="3654091">,</span>&nbsp;<span class="num" id="3654093">0</span><span class="op" id="3654094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3654097">return</span>&nbsp;<span class="ident" id="3654104"><a href="/crypto/rand/rand_linux.go.html#3654062">n</a></span>&nbsp;<span class="op" id="3654106">==</span>&nbsp;<span class="builtinfunc" id="3654109">len</span><span class="op" id="3654112">(</span><span class="ident" id="3654113"><a href="/crypto/rand/rand_linux.go.html#3653980">p</a></span><span class="op" id="3654114">)</span>&nbsp;<span class="op" id="3654116">&amp;&amp;</span>&nbsp;<span class="ident" id="3654119"><a href="/crypto/rand/rand_linux.go.html#3654065">err</a></span>&nbsp;<span class="op" id="3654123">==</span>&nbsp;<span class="ident" id="3654126">nil</span><br>
<span class="lineno"></span><span class="op" id="3654130">}</span>
</div>
</body>
</html>
