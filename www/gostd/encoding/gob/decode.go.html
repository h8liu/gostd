<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html" class="current">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5899136">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5899191">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5899245">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5899296">//go:generate&nbsp;go&nbsp;run&nbsp;decgen.go&nbsp;-output&nbsp;dec_helpers.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5899351">package</span>&nbsp;<span class="ident" id="5899359">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5899364">import</span>&nbsp;<span class="op" id="5899371">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5899374">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5899386">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5899396">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5899402">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5899410">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5899420">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5899423">var</span>&nbsp;<span class="op" id="5899427">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899430">errBadUint</span>&nbsp;<span class="op" id="5899441">=</span>&nbsp;<span class="ident" id="5899443">errors</span><span class="op" id="5899449">.</span><span class="ident" id="5899450">New</span><span class="op" id="5899453">(</span><span class="string" id="5899454">&#34;gob:&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="5899498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899501">errBadType</span>&nbsp;<span class="op" id="5899512">=</span>&nbsp;<span class="ident" id="5899514">errors</span><span class="op" id="5899520">.</span><span class="ident" id="5899521">New</span><span class="op" id="5899524">(</span><span class="string" id="5899525">&#34;gob:&nbsp;unknown&nbsp;type&nbsp;id&nbsp;or&nbsp;corrupted&nbsp;data&#34;</span><span class="op" id="5899565">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899568">errRange</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5899579">=</span>&nbsp;<span class="ident" id="5899581">errors</span><span class="op" id="5899587">.</span><span class="ident" id="5899588">New</span><span class="op" id="5899591">(</span><span class="string" id="5899592">&#34;gob:&nbsp;bad&nbsp;data:&nbsp;field&nbsp;numbers&nbsp;out&nbsp;of&nbsp;bounds&#34;</span><span class="op" id="5899636">)</span><br>
<span class="lineno"></span><span class="op" id="5899638">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5899641">type</span>&nbsp;<span class="ident" id="5899646">decHelper</span>&nbsp;<span class="keyword" id="5899656">func</span><span class="op" id="5899660">(</span><span class="ident" id="5899661">state</span>&nbsp;<span class="op" id="5899667">*</span><span class="ident" id="5899668">decoderState</span><span class="op" id="5899680">,</span>&nbsp;<span class="ident" id="5899682">v</span>&nbsp;<span class="ident" id="5899684">reflect</span><span class="op" id="5899691">.</span><span class="ident" id="5899692">Value</span><span class="op" id="5899697">,</span>&nbsp;<span class="ident" id="5899699">length</span>&nbsp;<span class="builtintype" id="5899706">int</span><span class="op" id="5899709">,</span>&nbsp;<span class="ident" id="5899711">ovfl</span>&nbsp;<span class="builtintype" id="5899716">error</span><span class="op" id="5899721">)</span>&nbsp;<span class="builtintype" id="5899723">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5899729">//&nbsp;decoderState&nbsp;is&nbsp;the&nbsp;execution&nbsp;state&nbsp;of&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;decoder.&nbsp;A&nbsp;new&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="5899811">//&nbsp;is&nbsp;created&nbsp;for&nbsp;nested&nbsp;objects.</span><br>
<span class="lineno"></span><span class="keyword" id="5899845">type</span>&nbsp;<span class="ident" id="5899850">decoderState</span>&nbsp;<span class="keyword" id="5899863">struct</span>&nbsp;<span class="op" id="5899870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899873">dec</span>&nbsp;<span class="op" id="5899877">*</span><span class="ident" id="5899878">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5899887">//&nbsp;The&nbsp;buffer&nbsp;is&nbsp;stored&nbsp;with&nbsp;an&nbsp;extra&nbsp;indirection&nbsp;because&nbsp;it&nbsp;may&nbsp;be&nbsp;replaced</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5899965">//&nbsp;if&nbsp;we&nbsp;load&nbsp;a&nbsp;type&nbsp;during&nbsp;decode&nbsp;(when&nbsp;reading&nbsp;an&nbsp;interface&nbsp;value).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900036">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900045">*</span><span class="ident" id="5900046">decBuffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900057">fieldnum</span>&nbsp;<span class="builtintype" id="5900066">int</span>&nbsp;<span class="comment" id="5900070">//&nbsp;the&nbsp;last&nbsp;field&nbsp;number&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900102">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900111">[</span><span class="op" id="5900112">]</span><span class="builtintype" id="5900113">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900119">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900128">*</span><span class="ident" id="5900129">decoderState</span>&nbsp;<span class="comment" id="5900142">//&nbsp;for&nbsp;free&nbsp;list</span><br>
<span class="lineno">35</span><span class="op" id="5900159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5900162">//&nbsp;decBuffer&nbsp;is&nbsp;an&nbsp;extremely&nbsp;simple,&nbsp;fast&nbsp;implementation&nbsp;of&nbsp;a&nbsp;read-only&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5900247">//&nbsp;It&nbsp;is&nbsp;initialized&nbsp;by&nbsp;calling&nbsp;Size&nbsp;and&nbsp;then&nbsp;copying&nbsp;the&nbsp;data&nbsp;into&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;Bytes().</span><br>
<span class="lineno"></span><span class="keyword" id="5900346">type</span>&nbsp;<span class="ident" id="5900351">decBuffer</span>&nbsp;<span class="keyword" id="5900361">struct</span>&nbsp;<span class="op" id="5900368">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900371">data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5900378">[</span><span class="op" id="5900379">]</span><span class="builtintype" id="5900380">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900386">offset</span>&nbsp;<span class="builtintype" id="5900393">int</span>&nbsp;<span class="comment" id="5900397">//&nbsp;Read&nbsp;offset.</span><br>
<span class="lineno"></span><span class="op" id="5900413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5900416">func</span>&nbsp;<span class="op" id="5900421">(</span><span class="ident" id="5900422">d</span>&nbsp;<span class="op" id="5900424">*</span><span class="ident" id="5900425">decBuffer</span><span class="op" id="5900434">)</span>&nbsp;<span class="ident" id="5900436">Read</span><span class="op" id="5900440">(</span><span class="ident" id="5900441">p</span>&nbsp;<span class="op" id="5900443">[</span><span class="op" id="5900444">]</span><span class="builtintype" id="5900445">byte</span><span class="op" id="5900449">)</span>&nbsp;<span class="op" id="5900451">(</span><span class="builtintype" id="5900452">int</span><span class="op" id="5900455">,</span>&nbsp;<span class="builtintype" id="5900457">error</span><span class="op" id="5900462">)</span>&nbsp;<span class="op" id="5900464">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900467">n</span>&nbsp;<span class="op" id="5900469">:=</span>&nbsp;<span class="builtinfunc" id="5900472">copy</span><span class="op" id="5900476">(</span><span class="ident" id="5900477">p</span><span class="op" id="5900478">,</span>&nbsp;<span class="ident" id="5900480">d</span><span class="op" id="5900481">.</span><span class="ident" id="5900482">data</span><span class="op" id="5900486">[</span><span class="ident" id="5900487">d</span><span class="op" id="5900488">.</span><span class="ident" id="5900489">offset</span><span class="op" id="5900495">:</span><span class="op" id="5900496">]</span><span class="op" id="5900497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5900500">if</span>&nbsp;<span class="ident" id="5900503">n</span>&nbsp;<span class="op" id="5900505">==</span>&nbsp;<span class="num" id="5900508">0</span>&nbsp;<span class="op" id="5900510">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5900513">len</span><span class="op" id="5900516">(</span><span class="ident" id="5900517">p</span><span class="op" id="5900518">)</span>&nbsp;<span class="op" id="5900520">!=</span>&nbsp;<span class="num" id="5900523">0</span>&nbsp;<span class="op" id="5900525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5900529">return</span>&nbsp;<span class="num" id="5900536">0</span><span class="op" id="5900537">,</span>&nbsp;<span class="ident" id="5900539">io</span><span class="op" id="5900541">.</span><span class="ident" id="5900542">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5900547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900550">d</span><span class="op" id="5900551">.</span><span class="ident" id="5900552">offset</span>&nbsp;<span class="op" id="5900559">+=</span>&nbsp;<span class="ident" id="5900562">n</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5900565">return</span>&nbsp;<span class="ident" id="5900572">n</span><span class="op" id="5900573">,</span>&nbsp;<span class="ident" id="5900575">nil</span><br>
<span class="lineno"></span><span class="op" id="5900579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5900582">func</span>&nbsp;<span class="op" id="5900587">(</span><span class="ident" id="5900588">d</span>&nbsp;<span class="op" id="5900590">*</span><span class="ident" id="5900591">decBuffer</span><span class="op" id="5900600">)</span>&nbsp;<span class="ident" id="5900602">Drop</span><span class="op" id="5900606">(</span><span class="ident" id="5900607">n</span>&nbsp;<span class="builtintype" id="5900609">int</span><span class="op" id="5900612">)</span>&nbsp;<span class="op" id="5900614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5900617">if</span>&nbsp;<span class="ident" id="5900620">n</span>&nbsp;<span class="op" id="5900622">&gt;</span>&nbsp;<span class="ident" id="5900624">d</span><span class="op" id="5900625">.</span><span class="ident" id="5900626">Len</span><span class="op" id="5900629">(</span><span class="op" id="5900630">)</span>&nbsp;<span class="op" id="5900632">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5900636">panic</span><span class="op" id="5900641">(</span><span class="string" id="5900642">&#34;drop&#34;</span><span class="op" id="5900648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5900651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900654">d</span><span class="op" id="5900655">.</span><span class="ident" id="5900656">offset</span>&nbsp;<span class="op" id="5900663">+=</span>&nbsp;<span class="ident" id="5900666">n</span><br>
<span class="lineno"></span><span class="op" id="5900668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5900671">//&nbsp;Size&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;exactly&nbsp;n&nbsp;bytes,&nbsp;so&nbsp;d.Bytes()&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="5900734">//&nbsp;return&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n.&nbsp;Existing&nbsp;data&nbsp;is&nbsp;first&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5900799">func</span>&nbsp;<span class="op" id="5900804">(</span><span class="ident" id="5900805">d</span>&nbsp;<span class="op" id="5900807">*</span><span class="ident" id="5900808">decBuffer</span><span class="op" id="5900817">)</span>&nbsp;<span class="ident" id="5900819">Size</span><span class="op" id="5900823">(</span><span class="ident" id="5900824">n</span>&nbsp;<span class="builtintype" id="5900826">int</span><span class="op" id="5900829">)</span>&nbsp;<span class="op" id="5900831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900834">d</span><span class="op" id="5900835">.</span><span class="ident" id="5900836">Reset</span><span class="op" id="5900841">(</span><span class="op" id="5900842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5900845">if</span>&nbsp;<span class="builtinfunc" id="5900848">cap</span><span class="op" id="5900851">(</span><span class="ident" id="5900852">d</span><span class="op" id="5900853">.</span><span class="ident" id="5900854">data</span><span class="op" id="5900858">)</span>&nbsp;<span class="op" id="5900860">&lt;</span>&nbsp;<span class="ident" id="5900862">n</span>&nbsp;<span class="op" id="5900864">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900868">d</span><span class="op" id="5900869">.</span><span class="ident" id="5900870">data</span>&nbsp;<span class="op" id="5900875">=</span>&nbsp;<span class="builtinfunc" id="5900877">make</span><span class="op" id="5900881">(</span><span class="op" id="5900882">[</span><span class="op" id="5900883">]</span><span class="builtintype" id="5900884">byte</span><span class="op" id="5900888">,</span>&nbsp;<span class="ident" id="5900890">n</span><span class="op" id="5900891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5900894">}</span>&nbsp;<span class="keyword" id="5900896">else</span>&nbsp;<span class="op" id="5900901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900905">d</span><span class="op" id="5900906">.</span><span class="ident" id="5900907">data</span>&nbsp;<span class="op" id="5900912">=</span>&nbsp;<span class="ident" id="5900914">d</span><span class="op" id="5900915">.</span><span class="ident" id="5900916">data</span><span class="op" id="5900920">[</span><span class="num" id="5900921">0</span><span class="op" id="5900922">:</span><span class="ident" id="5900923">n</span><span class="op" id="5900924">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5900927">}</span><br>
<span class="lineno"></span><span class="op" id="5900929">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="5900932">func</span>&nbsp;<span class="op" id="5900937">(</span><span class="ident" id="5900938">d</span>&nbsp;<span class="op" id="5900940">*</span><span class="ident" id="5900941">decBuffer</span><span class="op" id="5900950">)</span>&nbsp;<span class="ident" id="5900952">ReadByte</span><span class="op" id="5900960">(</span><span class="op" id="5900961">)</span>&nbsp;<span class="op" id="5900963">(</span><span class="builtintype" id="5900964">byte</span><span class="op" id="5900968">,</span>&nbsp;<span class="builtintype" id="5900970">error</span><span class="op" id="5900975">)</span>&nbsp;<span class="op" id="5900977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5900980">if</span>&nbsp;<span class="ident" id="5900983">d</span><span class="op" id="5900984">.</span><span class="ident" id="5900985">offset</span>&nbsp;<span class="op" id="5900992">&gt;=</span>&nbsp;<span class="builtinfunc" id="5900995">len</span><span class="op" id="5900998">(</span><span class="ident" id="5900999">d</span><span class="op" id="5901000">.</span><span class="ident" id="5901001">data</span><span class="op" id="5901005">)</span>&nbsp;<span class="op" id="5901007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901011">return</span>&nbsp;<span class="num" id="5901018">0</span><span class="op" id="5901019">,</span>&nbsp;<span class="ident" id="5901021">io</span><span class="op" id="5901023">.</span><span class="ident" id="5901024">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5901029">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901032">c</span>&nbsp;<span class="op" id="5901034">:=</span>&nbsp;<span class="ident" id="5901037">d</span><span class="op" id="5901038">.</span><span class="ident" id="5901039">data</span><span class="op" id="5901043">[</span><span class="ident" id="5901044">d</span><span class="op" id="5901045">.</span><span class="ident" id="5901046">offset</span><span class="op" id="5901052">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901055">d</span><span class="op" id="5901056">.</span><span class="ident" id="5901057">offset</span><span class="op" id="5901063">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901067">return</span>&nbsp;<span class="ident" id="5901074">c</span><span class="op" id="5901075">,</span>&nbsp;<span class="ident" id="5901077">nil</span><br>
<span class="lineno"></span><span class="op" id="5901081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="5901084">func</span>&nbsp;<span class="op" id="5901089">(</span><span class="ident" id="5901090">d</span>&nbsp;<span class="op" id="5901092">*</span><span class="ident" id="5901093">decBuffer</span><span class="op" id="5901102">)</span>&nbsp;<span class="ident" id="5901104">Len</span><span class="op" id="5901107">(</span><span class="op" id="5901108">)</span>&nbsp;<span class="builtintype" id="5901110">int</span>&nbsp;<span class="op" id="5901114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901117">return</span>&nbsp;<span class="builtinfunc" id="5901124">len</span><span class="op" id="5901127">(</span><span class="ident" id="5901128">d</span><span class="op" id="5901129">.</span><span class="ident" id="5901130">data</span><span class="op" id="5901134">)</span>&nbsp;<span class="op" id="5901136">-</span>&nbsp;<span class="ident" id="5901138">d</span><span class="op" id="5901139">.</span><span class="ident" id="5901140">offset</span><br>
<span class="lineno"></span><span class="op" id="5901147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5901150">func</span>&nbsp;<span class="op" id="5901155">(</span><span class="ident" id="5901156">d</span>&nbsp;<span class="op" id="5901158">*</span><span class="ident" id="5901159">decBuffer</span><span class="op" id="5901168">)</span>&nbsp;<span class="ident" id="5901170">Bytes</span><span class="op" id="5901175">(</span><span class="op" id="5901176">)</span>&nbsp;<span class="op" id="5901178">[</span><span class="op" id="5901179">]</span><span class="builtintype" id="5901180">byte</span>&nbsp;<span class="op" id="5901185">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901188">return</span>&nbsp;<span class="ident" id="5901195">d</span><span class="op" id="5901196">.</span><span class="ident" id="5901197">data</span><span class="op" id="5901201">[</span><span class="ident" id="5901202">d</span><span class="op" id="5901203">.</span><span class="ident" id="5901204">offset</span><span class="op" id="5901210">:</span><span class="op" id="5901211">]</span><br>
<span class="lineno"></span><span class="op" id="5901213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5901216">func</span>&nbsp;<span class="op" id="5901221">(</span><span class="ident" id="5901222">d</span>&nbsp;<span class="op" id="5901224">*</span><span class="ident" id="5901225">decBuffer</span><span class="op" id="5901234">)</span>&nbsp;<span class="ident" id="5901236">Reset</span><span class="op" id="5901241">(</span><span class="op" id="5901242">)</span>&nbsp;<span class="op" id="5901244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901247">d</span><span class="op" id="5901248">.</span><span class="ident" id="5901249">data</span>&nbsp;<span class="op" id="5901254">=</span>&nbsp;<span class="ident" id="5901256">d</span><span class="op" id="5901257">.</span><span class="ident" id="5901258">data</span><span class="op" id="5901262">[</span><span class="num" id="5901263">0</span><span class="op" id="5901264">:</span><span class="num" id="5901265">0</span><span class="op" id="5901266">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901269">d</span><span class="op" id="5901270">.</span><span class="ident" id="5901271">offset</span>&nbsp;<span class="op" id="5901278">=</span>&nbsp;<span class="num" id="5901280">0</span><br>
<span class="lineno"></span><span class="op" id="5901282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5901285">//&nbsp;We&nbsp;pass&nbsp;the&nbsp;bytes.Buffer&nbsp;separately&nbsp;for&nbsp;easier&nbsp;testing&nbsp;of&nbsp;the&nbsp;infrastructure</span><br>
<span class="lineno"></span><span class="comment" id="5901365">//&nbsp;without&nbsp;requiring&nbsp;a&nbsp;full&nbsp;Decoder.</span><br>
<span class="lineno">95</span><span class="keyword" id="5901402">func</span>&nbsp;<span class="op" id="5901407">(</span><span class="ident" id="5901408">dec</span>&nbsp;<span class="op" id="5901412">*</span><span class="ident" id="5901413">Decoder</span><span class="op" id="5901420">)</span>&nbsp;<span class="ident" id="5901422">newDecoderState</span><span class="op" id="5901437">(</span><span class="ident" id="5901438">buf</span>&nbsp;<span class="op" id="5901442">*</span><span class="ident" id="5901443">decBuffer</span><span class="op" id="5901452">)</span>&nbsp;<span class="op" id="5901454">*</span><span class="ident" id="5901455">decoderState</span>&nbsp;<span class="op" id="5901468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901471">d</span>&nbsp;<span class="op" id="5901473">:=</span>&nbsp;<span class="ident" id="5901476">dec</span><span class="op" id="5901479">.</span><span class="ident" id="5901480">freeList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901490">if</span>&nbsp;<span class="ident" id="5901493">d</span>&nbsp;<span class="op" id="5901495">==</span>&nbsp;<span class="ident" id="5901498">nil</span>&nbsp;<span class="op" id="5901502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901506">d</span>&nbsp;<span class="op" id="5901508">=</span>&nbsp;<span class="builtinfunc" id="5901510">new</span><span class="op" id="5901513">(</span><span class="ident" id="5901514">decoderState</span><span class="op" id="5901526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901530">d</span><span class="op" id="5901531">.</span><span class="ident" id="5901532">dec</span>&nbsp;<span class="op" id="5901536">=</span>&nbsp;<span class="ident" id="5901538">dec</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901544">d</span><span class="op" id="5901545">.</span><span class="ident" id="5901546">buf</span>&nbsp;<span class="op" id="5901550">=</span>&nbsp;<span class="builtinfunc" id="5901552">make</span><span class="op" id="5901556">(</span><span class="op" id="5901557">[</span><span class="op" id="5901558">]</span><span class="builtintype" id="5901559">byte</span><span class="op" id="5901563">,</span>&nbsp;<span class="ident" id="5901565">uint64Size</span><span class="op" id="5901575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5901578">}</span>&nbsp;<span class="keyword" id="5901580">else</span>&nbsp;<span class="op" id="5901585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901589">dec</span><span class="op" id="5901592">.</span><span class="ident" id="5901593">freeList</span>&nbsp;<span class="op" id="5901602">=</span>&nbsp;<span class="ident" id="5901604">d</span><span class="op" id="5901605">.</span><span class="ident" id="5901606">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5901612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901615">d</span><span class="op" id="5901616">.</span><span class="ident" id="5901617">b</span>&nbsp;<span class="op" id="5901619">=</span>&nbsp;<span class="ident" id="5901621">buf</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901626">return</span>&nbsp;<span class="ident" id="5901633">d</span><br>
<span class="lineno"></span><span class="op" id="5901635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5901638">func</span>&nbsp;<span class="op" id="5901643">(</span><span class="ident" id="5901644">dec</span>&nbsp;<span class="op" id="5901648">*</span><span class="ident" id="5901649">Decoder</span><span class="op" id="5901656">)</span>&nbsp;<span class="ident" id="5901658">freeDecoderState</span><span class="op" id="5901674">(</span><span class="ident" id="5901675">d</span>&nbsp;<span class="op" id="5901677">*</span><span class="ident" id="5901678">decoderState</span><span class="op" id="5901690">)</span>&nbsp;<span class="op" id="5901692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901695">d</span><span class="op" id="5901696">.</span><span class="ident" id="5901697">next</span>&nbsp;<span class="op" id="5901702">=</span>&nbsp;<span class="ident" id="5901704">dec</span><span class="op" id="5901707">.</span><span class="ident" id="5901708">freeList</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901718">dec</span><span class="op" id="5901721">.</span><span class="ident" id="5901722">freeList</span>&nbsp;<span class="op" id="5901731">=</span>&nbsp;<span class="ident" id="5901733">d</span><br>
<span class="lineno"></span><span class="op" id="5901735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5901738">func</span>&nbsp;<span class="ident" id="5901743">overflow</span><span class="op" id="5901751">(</span><span class="ident" id="5901752">name</span>&nbsp;<span class="builtintype" id="5901757">string</span><span class="op" id="5901763">)</span>&nbsp;<span class="builtintype" id="5901765">error</span>&nbsp;<span class="op" id="5901771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901774">return</span>&nbsp;<span class="ident" id="5901781">errors</span><span class="op" id="5901787">.</span><span class="ident" id="5901788">New</span><span class="op" id="5901791">(</span><span class="string" id="5901792">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="5901806">+</span>&nbsp;<span class="ident" id="5901808">name</span>&nbsp;<span class="op" id="5901813">+</span>&nbsp;<span class="string" id="5901815">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="5901831">)</span><br>
<span class="lineno">115</span><span class="op" id="5901833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5901836">//&nbsp;decodeUintReader&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;an&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="5901909">//&nbsp;Used&nbsp;only&nbsp;by&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;read&nbsp;the&nbsp;message&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5901965">func</span>&nbsp;<span class="ident" id="5901970">decodeUintReader</span><span class="op" id="5901986">(</span><span class="ident" id="5901987">r</span>&nbsp;<span class="ident" id="5901989">io</span><span class="op" id="5901991">.</span><span class="ident" id="5901992">Reader</span><span class="op" id="5901998">,</span>&nbsp;<span class="ident" id="5902000">buf</span>&nbsp;<span class="op" id="5902004">[</span><span class="op" id="5902005">]</span><span class="builtintype" id="5902006">byte</span><span class="op" id="5902010">)</span>&nbsp;<span class="op" id="5902012">(</span><span class="ident" id="5902013">x</span>&nbsp;<span class="ident" id="5902015">uint64</span><span class="op" id="5902021">,</span>&nbsp;<span class="ident" id="5902023">width</span>&nbsp;<span class="builtintype" id="5902029">int</span><span class="op" id="5902032">,</span>&nbsp;<span class="ident" id="5902034">err</span>&nbsp;<span class="builtintype" id="5902038">error</span><span class="op" id="5902043">)</span>&nbsp;<span class="op" id="5902045">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902048">width</span>&nbsp;<span class="op" id="5902054">=</span>&nbsp;<span class="num" id="5902056">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902059">n</span><span class="op" id="5902060">,</span>&nbsp;<span class="ident" id="5902062">err</span>&nbsp;<span class="op" id="5902066">:=</span>&nbsp;<span class="ident" id="5902069">io</span><span class="op" id="5902071">.</span><span class="ident" id="5902072">ReadFull</span><span class="op" id="5902080">(</span><span class="ident" id="5902081">r</span><span class="op" id="5902082">,</span>&nbsp;<span class="ident" id="5902084">buf</span><span class="op" id="5902087">[</span><span class="num" id="5902088">0</span><span class="op" id="5902089">:</span><span class="ident" id="5902090">width</span><span class="op" id="5902095">]</span><span class="op" id="5902096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902099">if</span>&nbsp;<span class="ident" id="5902102">n</span>&nbsp;<span class="op" id="5902104">==</span>&nbsp;<span class="num" id="5902107">0</span>&nbsp;<span class="op" id="5902109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902113">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902121">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902124">b</span>&nbsp;<span class="op" id="5902126">:=</span>&nbsp;<span class="ident" id="5902129">buf</span><span class="op" id="5902132">[</span><span class="num" id="5902133">0</span><span class="op" id="5902134">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902137">if</span>&nbsp;<span class="ident" id="5902140">b</span>&nbsp;<span class="op" id="5902142">&lt;=</span>&nbsp;<span class="num" id="5902145">0x7f</span>&nbsp;<span class="op" id="5902150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902154">return</span>&nbsp;<span class="ident" id="5902161">uint64</span><span class="op" id="5902167">(</span><span class="ident" id="5902168">b</span><span class="op" id="5902169">)</span><span class="op" id="5902170">,</span>&nbsp;<span class="ident" id="5902172">width</span><span class="op" id="5902177">,</span>&nbsp;<span class="ident" id="5902179">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902187">n</span>&nbsp;<span class="op" id="5902189">=</span>&nbsp;<span class="op" id="5902191">-</span><span class="builtintype" id="5902192">int</span><span class="op" id="5902195">(</span><span class="builtintype" id="5902196">int8</span><span class="op" id="5902200">(</span><span class="ident" id="5902201">b</span><span class="op" id="5902202">)</span><span class="op" id="5902203">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902206">if</span>&nbsp;<span class="ident" id="5902209">n</span>&nbsp;<span class="op" id="5902211">&gt;</span>&nbsp;<span class="ident" id="5902213">uint64Size</span>&nbsp;<span class="op" id="5902224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902228">err</span>&nbsp;<span class="op" id="5902232">=</span>&nbsp;<span class="ident" id="5902234">errBadUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902247">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902258">width</span><span class="op" id="5902263">,</span>&nbsp;<span class="ident" id="5902265">err</span>&nbsp;<span class="op" id="5902269">=</span>&nbsp;<span class="ident" id="5902271">io</span><span class="op" id="5902273">.</span><span class="ident" id="5902274">ReadFull</span><span class="op" id="5902282">(</span><span class="ident" id="5902283">r</span><span class="op" id="5902284">,</span>&nbsp;<span class="ident" id="5902286">buf</span><span class="op" id="5902289">[</span><span class="num" id="5902290">0</span><span class="op" id="5902291">:</span><span class="ident" id="5902292">n</span><span class="op" id="5902293">]</span><span class="op" id="5902294">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902297">if</span>&nbsp;<span class="ident" id="5902300">err</span>&nbsp;<span class="op" id="5902304">!=</span>&nbsp;<span class="ident" id="5902307">nil</span>&nbsp;<span class="op" id="5902311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902315">if</span>&nbsp;<span class="ident" id="5902318">err</span>&nbsp;<span class="op" id="5902322">==</span>&nbsp;<span class="ident" id="5902325">io</span><span class="op" id="5902327">.</span><span class="ident" id="5902328">EOF</span>&nbsp;<span class="op" id="5902332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902337">err</span>&nbsp;<span class="op" id="5902341">=</span>&nbsp;<span class="ident" id="5902343">io</span><span class="op" id="5902345">.</span><span class="ident" id="5902346">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902369">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902380">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902446">for</span>&nbsp;<span class="ident" id="5902450">_</span><span class="op" id="5902451">,</span>&nbsp;<span class="ident" id="5902453">b</span>&nbsp;<span class="op" id="5902455">:=</span>&nbsp;<span class="keyword" id="5902458">range</span>&nbsp;<span class="ident" id="5902464">buf</span><span class="op" id="5902467">[</span><span class="num" id="5902468">0</span><span class="op" id="5902469">:</span><span class="ident" id="5902470">width</span><span class="op" id="5902475">]</span>&nbsp;<span class="op" id="5902477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902481">x</span>&nbsp;<span class="op" id="5902483">=</span>&nbsp;<span class="ident" id="5902485">x</span><span class="op" id="5902486">&lt;&lt;</span><span class="num" id="5902488">8</span>&nbsp;<span class="op" id="5902490">|</span>&nbsp;<span class="ident" id="5902492">uint64</span><span class="op" id="5902498">(</span><span class="ident" id="5902499">b</span><span class="op" id="5902500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902503">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902506">width</span><span class="op" id="5902511">++</span>&nbsp;<span class="comment" id="5902514">//&nbsp;+1&nbsp;for&nbsp;length&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902537">return</span><br>
<span class="lineno"></span><span class="op" id="5902544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5902547">//&nbsp;decodeUint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno">150</span><span class="comment" id="5902609">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="5902641">func</span>&nbsp;<span class="op" id="5902646">(</span><span class="ident" id="5902647">state</span>&nbsp;<span class="op" id="5902653">*</span><span class="ident" id="5902654">decoderState</span><span class="op" id="5902666">)</span>&nbsp;<span class="ident" id="5902668">decodeUint</span><span class="op" id="5902678">(</span><span class="op" id="5902679">)</span>&nbsp;<span class="op" id="5902681">(</span><span class="ident" id="5902682">x</span>&nbsp;<span class="ident" id="5902684">uint64</span><span class="op" id="5902690">)</span>&nbsp;<span class="op" id="5902692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902695">b</span><span class="op" id="5902696">,</span>&nbsp;<span class="ident" id="5902698">err</span>&nbsp;<span class="op" id="5902702">:=</span>&nbsp;<span class="ident" id="5902705">state</span><span class="op" id="5902710">.</span><span class="ident" id="5902711">b</span><span class="op" id="5902712">.</span><span class="ident" id="5902713">ReadByte</span><span class="op" id="5902721">(</span><span class="op" id="5902722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902725">if</span>&nbsp;<span class="ident" id="5902728">err</span>&nbsp;<span class="op" id="5902732">!=</span>&nbsp;<span class="ident" id="5902735">nil</span>&nbsp;<span class="op" id="5902739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902743">error_</span><span class="op" id="5902749">(</span><span class="ident" id="5902750">err</span><span class="op" id="5902753">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902759">if</span>&nbsp;<span class="ident" id="5902762">b</span>&nbsp;<span class="op" id="5902764">&lt;=</span>&nbsp;<span class="num" id="5902767">0x7f</span>&nbsp;<span class="op" id="5902772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902776">return</span>&nbsp;<span class="ident" id="5902783">uint64</span><span class="op" id="5902789">(</span><span class="ident" id="5902790">b</span><span class="op" id="5902791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902797">n</span>&nbsp;<span class="op" id="5902799">:=</span>&nbsp;<span class="op" id="5902802">-</span><span class="builtintype" id="5902803">int</span><span class="op" id="5902806">(</span><span class="builtintype" id="5902807">int8</span><span class="op" id="5902811">(</span><span class="ident" id="5902812">b</span><span class="op" id="5902813">)</span><span class="op" id="5902814">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902817">if</span>&nbsp;<span class="ident" id="5902820">n</span>&nbsp;<span class="op" id="5902822">&gt;</span>&nbsp;<span class="ident" id="5902824">uint64Size</span>&nbsp;<span class="op" id="5902835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902839">error_</span><span class="op" id="5902845">(</span><span class="ident" id="5902846">errBadUint</span><span class="op" id="5902856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902862">width</span><span class="op" id="5902867">,</span>&nbsp;<span class="ident" id="5902869">err</span>&nbsp;<span class="op" id="5902873">:=</span>&nbsp;<span class="ident" id="5902876">state</span><span class="op" id="5902881">.</span><span class="ident" id="5902882">b</span><span class="op" id="5902883">.</span><span class="ident" id="5902884">Read</span><span class="op" id="5902888">(</span><span class="ident" id="5902889">state</span><span class="op" id="5902894">.</span><span class="ident" id="5902895">buf</span><span class="op" id="5902898">[</span><span class="num" id="5902899">0</span><span class="op" id="5902900">:</span><span class="ident" id="5902901">n</span><span class="op" id="5902902">]</span><span class="op" id="5902903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902906">if</span>&nbsp;<span class="ident" id="5902909">err</span>&nbsp;<span class="op" id="5902913">!=</span>&nbsp;<span class="ident" id="5902916">nil</span>&nbsp;<span class="op" id="5902920">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902924">error_</span><span class="op" id="5902930">(</span><span class="ident" id="5902931">err</span><span class="op" id="5902934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902940">//&nbsp;Don&#39;t&nbsp;need&nbsp;to&nbsp;check&nbsp;error;&nbsp;it&#39;s&nbsp;safe&nbsp;to&nbsp;loop&nbsp;regardless.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5903001">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5903067">for</span>&nbsp;<span class="ident" id="5903071">_</span><span class="op" id="5903072">,</span>&nbsp;<span class="ident" id="5903074">b</span>&nbsp;<span class="op" id="5903076">:=</span>&nbsp;<span class="keyword" id="5903079">range</span>&nbsp;<span class="ident" id="5903085">state</span><span class="op" id="5903090">.</span><span class="ident" id="5903091">buf</span><span class="op" id="5903094">[</span><span class="num" id="5903095">0</span><span class="op" id="5903096">:</span><span class="ident" id="5903097">width</span><span class="op" id="5903102">]</span>&nbsp;<span class="op" id="5903104">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903108">x</span>&nbsp;<span class="op" id="5903110">=</span>&nbsp;<span class="ident" id="5903112">x</span><span class="op" id="5903113">&lt;&lt;</span><span class="num" id="5903115">8</span>&nbsp;<span class="op" id="5903117">|</span>&nbsp;<span class="ident" id="5903119">uint64</span><span class="op" id="5903125">(</span><span class="ident" id="5903126">b</span><span class="op" id="5903127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5903130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5903133">return</span>&nbsp;<span class="ident" id="5903140">x</span><br>
<span class="lineno"></span><span class="op" id="5903142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5903145">//&nbsp;decodeInt&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno"></span><span class="comment" id="5903204">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="5903236">func</span>&nbsp;<span class="op" id="5903241">(</span><span class="ident" id="5903242">state</span>&nbsp;<span class="op" id="5903248">*</span><span class="ident" id="5903249">decoderState</span><span class="op" id="5903261">)</span>&nbsp;<span class="ident" id="5903263">decodeInt</span><span class="op" id="5903272">(</span><span class="op" id="5903273">)</span>&nbsp;<span class="ident" id="5903275">int64</span>&nbsp;<span class="op" id="5903281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903284">x</span>&nbsp;<span class="op" id="5903286">:=</span>&nbsp;<span class="ident" id="5903289">state</span><span class="op" id="5903294">.</span><span class="ident" id="5903295">decodeUint</span><span class="op" id="5903305">(</span><span class="op" id="5903306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5903309">if</span>&nbsp;<span class="ident" id="5903312">x</span><span class="op" id="5903313">&amp;</span><span class="num" id="5903314">1</span>&nbsp;<span class="op" id="5903316">!=</span>&nbsp;<span class="num" id="5903319">0</span>&nbsp;<span class="op" id="5903321">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5903325">return</span>&nbsp;<span class="op" id="5903332">^</span><span class="ident" id="5903333">int64</span><span class="op" id="5903338">(</span><span class="ident" id="5903339">x</span>&nbsp;<span class="op" id="5903341">&gt;&gt;</span>&nbsp;<span class="num" id="5903344">1</span><span class="op" id="5903345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5903348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5903351">return</span>&nbsp;<span class="ident" id="5903358">int64</span><span class="op" id="5903363">(</span><span class="ident" id="5903364">x</span>&nbsp;<span class="op" id="5903366">&gt;&gt;</span>&nbsp;<span class="num" id="5903369">1</span><span class="op" id="5903370">)</span><br>
<span class="lineno"></span><span class="op" id="5903372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="5903375">//&nbsp;decOp&nbsp;is&nbsp;the&nbsp;signature&nbsp;of&nbsp;a&nbsp;decoding&nbsp;operator&nbsp;for&nbsp;a&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5903442">type</span>&nbsp;<span class="ident" id="5903447">decOp</span>&nbsp;<span class="keyword" id="5903453">func</span><span class="op" id="5903457">(</span><span class="ident" id="5903458">i</span>&nbsp;<span class="op" id="5903460">*</span><span class="ident" id="5903461">decInstr</span><span class="op" id="5903469">,</span>&nbsp;<span class="ident" id="5903471">state</span>&nbsp;<span class="op" id="5903477">*</span><span class="ident" id="5903478">decoderState</span><span class="op" id="5903490">,</span>&nbsp;<span class="ident" id="5903492">v</span>&nbsp;<span class="ident" id="5903494">reflect</span><span class="op" id="5903501">.</span><span class="ident" id="5903502">Value</span><span class="op" id="5903507">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5903510">//&nbsp;The&nbsp;&#39;instructions&#39;&nbsp;of&nbsp;the&nbsp;decoding&nbsp;machine</span><br>
<span class="lineno"></span><span class="keyword" id="5903556">type</span>&nbsp;<span class="ident" id="5903561">decInstr</span>&nbsp;<span class="keyword" id="5903570">struct</span>&nbsp;<span class="op" id="5903577">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903580">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903586">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903593">field</span>&nbsp;<span class="builtintype" id="5903599">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5903605">//&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;wire&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903639">index</span>&nbsp;<span class="op" id="5903645">[</span><span class="op" id="5903646">]</span><span class="builtintype" id="5903647">int</span>&nbsp;<span class="comment" id="5903651">//&nbsp;field&nbsp;access&nbsp;indices&nbsp;for&nbsp;destination&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903697">ovfl</span>&nbsp;&nbsp;<span class="builtintype" id="5903703">error</span>&nbsp;<span class="comment" id="5903709">//&nbsp;error&nbsp;message&nbsp;for&nbsp;overflow/underflow&nbsp;(for&nbsp;arrays,&nbsp;of&nbsp;the&nbsp;elements)</span><br>
<span class="lineno"></span><span class="op" id="5903779">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="5903782">//&nbsp;ignoreUint&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5903839">func</span>&nbsp;<span class="ident" id="5903844">ignoreUint</span><span class="op" id="5903854">(</span><span class="ident" id="5903855">i</span>&nbsp;<span class="op" id="5903857">*</span><span class="ident" id="5903858">decInstr</span><span class="op" id="5903866">,</span>&nbsp;<span class="ident" id="5903868">state</span>&nbsp;<span class="op" id="5903874">*</span><span class="ident" id="5903875">decoderState</span><span class="op" id="5903887">,</span>&nbsp;<span class="ident" id="5903889">v</span>&nbsp;<span class="ident" id="5903891">reflect</span><span class="op" id="5903898">.</span><span class="ident" id="5903899">Value</span><span class="op" id="5903904">)</span>&nbsp;<span class="op" id="5903906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903909">state</span><span class="op" id="5903914">.</span><span class="ident" id="5903915">decodeUint</span><span class="op" id="5903925">(</span><span class="op" id="5903926">)</span><br>
<span class="lineno"></span><span class="op" id="5903928">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5903931">//&nbsp;ignoreTwoUints&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;to&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="5904010">//&nbsp;complex&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5904029">func</span>&nbsp;<span class="ident" id="5904034">ignoreTwoUints</span><span class="op" id="5904048">(</span><span class="ident" id="5904049">i</span>&nbsp;<span class="op" id="5904051">*</span><span class="ident" id="5904052">decInstr</span><span class="op" id="5904060">,</span>&nbsp;<span class="ident" id="5904062">state</span>&nbsp;<span class="op" id="5904068">*</span><span class="ident" id="5904069">decoderState</span><span class="op" id="5904081">,</span>&nbsp;<span class="ident" id="5904083">v</span>&nbsp;<span class="ident" id="5904085">reflect</span><span class="op" id="5904092">.</span><span class="ident" id="5904093">Value</span><span class="op" id="5904098">)</span>&nbsp;<span class="op" id="5904100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904103">state</span><span class="op" id="5904108">.</span><span class="ident" id="5904109">decodeUint</span><span class="op" id="5904119">(</span><span class="op" id="5904120">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904123">state</span><span class="op" id="5904128">.</span><span class="ident" id="5904129">decodeUint</span><span class="op" id="5904139">(</span><span class="op" id="5904140">)</span><br>
<span class="lineno"></span><span class="op" id="5904142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5904145">//&nbsp;Since&nbsp;the&nbsp;encoder&nbsp;writes&nbsp;no&nbsp;zeros,&nbsp;if&nbsp;we&nbsp;arrive&nbsp;at&nbsp;a&nbsp;decoder&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="5904217">//&nbsp;a&nbsp;value&nbsp;to&nbsp;extract&nbsp;and&nbsp;store.&nbsp;&nbsp;The&nbsp;field&nbsp;number&nbsp;has&nbsp;already&nbsp;been&nbsp;read</span><br>
<span class="lineno">210</span><span class="comment" id="5904290">//&nbsp;(it&#39;s&nbsp;how&nbsp;we&nbsp;knew&nbsp;to&nbsp;call&nbsp;this&nbsp;decoder).</span><br>
<span class="lineno"></span><span class="comment" id="5904334">//&nbsp;Each&nbsp;decoder&nbsp;is&nbsp;responsible&nbsp;for&nbsp;handling&nbsp;any&nbsp;indirections&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="5904406">//&nbsp;with&nbsp;the&nbsp;data&nbsp;structure.&nbsp;&nbsp;If&nbsp;any&nbsp;pointer&nbsp;so&nbsp;reached&nbsp;is&nbsp;nil,&nbsp;allocation&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5904485">//&nbsp;be&nbsp;done.</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="5904498">//&nbsp;decAlloc&nbsp;takes&nbsp;a&nbsp;value&nbsp;and&nbsp;returns&nbsp;a&nbsp;settable&nbsp;value&nbsp;that&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="5904562">//&nbsp;be&nbsp;assigned&nbsp;to.&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer,&nbsp;decAlloc&nbsp;guarantees&nbsp;it&nbsp;points&nbsp;to&nbsp;storage.</span><br>
<span class="lineno"></span><span class="comment" id="5904650">//&nbsp;The&nbsp;callers&nbsp;to&nbsp;the&nbsp;individual&nbsp;decoders&nbsp;are&nbsp;expected&nbsp;to&nbsp;have&nbsp;used&nbsp;decAlloc.</span><br>
<span class="lineno"></span><span class="comment" id="5904728">//&nbsp;The&nbsp;individual&nbsp;decoders&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5904773">func</span>&nbsp;<span class="ident" id="5904778">decAlloc</span><span class="op" id="5904786">(</span><span class="ident" id="5904787">v</span>&nbsp;<span class="ident" id="5904789">reflect</span><span class="op" id="5904796">.</span><span class="ident" id="5904797">Value</span><span class="op" id="5904802">)</span>&nbsp;<span class="ident" id="5904804">reflect</span><span class="op" id="5904811">.</span><span class="ident" id="5904812">Value</span>&nbsp;<span class="op" id="5904818">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904821">for</span>&nbsp;<span class="ident" id="5904825">v</span><span class="op" id="5904826">.</span><span class="ident" id="5904827">Kind</span><span class="op" id="5904831">(</span><span class="op" id="5904832">)</span>&nbsp;<span class="op" id="5904834">==</span>&nbsp;<span class="ident" id="5904837">reflect</span><span class="op" id="5904844">.</span><span class="ident" id="5904845">Ptr</span>&nbsp;<span class="op" id="5904849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904853">if</span>&nbsp;<span class="ident" id="5904856">v</span><span class="op" id="5904857">.</span><span class="ident" id="5904858">IsNil</span><span class="op" id="5904863">(</span><span class="op" id="5904864">)</span>&nbsp;<span class="op" id="5904866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904871">v</span><span class="op" id="5904872">.</span><span class="ident" id="5904873">Set</span><span class="op" id="5904876">(</span><span class="ident" id="5904877">reflect</span><span class="op" id="5904884">.</span><span class="ident" id="5904885">New</span><span class="op" id="5904888">(</span><span class="ident" id="5904889">v</span><span class="op" id="5904890">.</span><span class="ident" id="5904891">Type</span><span class="op" id="5904895">(</span><span class="op" id="5904896">)</span><span class="op" id="5904897">.</span><span class="ident" id="5904898">Elem</span><span class="op" id="5904902">(</span><span class="op" id="5904903">)</span><span class="op" id="5904904">)</span><span class="op" id="5904905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5904909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904913">v</span>&nbsp;<span class="op" id="5904915">=</span>&nbsp;<span class="ident" id="5904917">v</span><span class="op" id="5904918">.</span><span class="ident" id="5904919">Elem</span><span class="op" id="5904923">(</span><span class="op" id="5904924">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5904927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904930">return</span>&nbsp;<span class="ident" id="5904937">v</span><br>
<span class="lineno"></span><span class="op" id="5904939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5904942">//&nbsp;decBool&nbsp;decodes&nbsp;a&nbsp;uint&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;boolean&nbsp;in&nbsp;value.</span><br>
<span class="lineno">230</span><span class="keyword" id="5905005">func</span>&nbsp;<span class="ident" id="5905010">decBool</span><span class="op" id="5905017">(</span><span class="ident" id="5905018">i</span>&nbsp;<span class="op" id="5905020">*</span><span class="ident" id="5905021">decInstr</span><span class="op" id="5905029">,</span>&nbsp;<span class="ident" id="5905031">state</span>&nbsp;<span class="op" id="5905037">*</span><span class="ident" id="5905038">decoderState</span><span class="op" id="5905050">,</span>&nbsp;<span class="ident" id="5905052">value</span>&nbsp;<span class="ident" id="5905058">reflect</span><span class="op" id="5905065">.</span><span class="ident" id="5905066">Value</span><span class="op" id="5905071">)</span>&nbsp;<span class="op" id="5905073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905076">value</span><span class="op" id="5905081">.</span><span class="ident" id="5905082">SetBool</span><span class="op" id="5905089">(</span><span class="ident" id="5905090">state</span><span class="op" id="5905095">.</span><span class="ident" id="5905096">decodeUint</span><span class="op" id="5905106">(</span><span class="op" id="5905107">)</span>&nbsp;<span class="op" id="5905109">!=</span>&nbsp;<span class="num" id="5905112">0</span><span class="op" id="5905113">)</span><br>
<span class="lineno"></span><span class="op" id="5905115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5905118">//&nbsp;decInt8&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int8&nbsp;in&nbsp;value.</span><br>
<span class="lineno">235</span><span class="keyword" id="5905183">func</span>&nbsp;<span class="ident" id="5905188">decInt8</span><span class="op" id="5905195">(</span><span class="ident" id="5905196">i</span>&nbsp;<span class="op" id="5905198">*</span><span class="ident" id="5905199">decInstr</span><span class="op" id="5905207">,</span>&nbsp;<span class="ident" id="5905209">state</span>&nbsp;<span class="op" id="5905215">*</span><span class="ident" id="5905216">decoderState</span><span class="op" id="5905228">,</span>&nbsp;<span class="ident" id="5905230">value</span>&nbsp;<span class="ident" id="5905236">reflect</span><span class="op" id="5905243">.</span><span class="ident" id="5905244">Value</span><span class="op" id="5905249">)</span>&nbsp;<span class="op" id="5905251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905254">v</span>&nbsp;<span class="op" id="5905256">:=</span>&nbsp;<span class="ident" id="5905259">state</span><span class="op" id="5905264">.</span><span class="ident" id="5905265">decodeInt</span><span class="op" id="5905274">(</span><span class="op" id="5905275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905278">if</span>&nbsp;<span class="ident" id="5905281">v</span>&nbsp;<span class="op" id="5905283">&lt;</span>&nbsp;<span class="ident" id="5905285">math</span><span class="op" id="5905289">.</span><span class="ident" id="5905290">MinInt8</span>&nbsp;<span class="op" id="5905298">||</span>&nbsp;<span class="ident" id="5905301">math</span><span class="op" id="5905305">.</span><span class="ident" id="5905306">MaxInt8</span>&nbsp;<span class="op" id="5905314">&lt;</span>&nbsp;<span class="ident" id="5905316">v</span>&nbsp;<span class="op" id="5905318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905322">error_</span><span class="op" id="5905328">(</span><span class="ident" id="5905329">i</span><span class="op" id="5905330">.</span><span class="ident" id="5905331">ovfl</span><span class="op" id="5905335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5905338">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905341">value</span><span class="op" id="5905346">.</span><span class="ident" id="5905347">SetInt</span><span class="op" id="5905353">(</span><span class="ident" id="5905354">v</span><span class="op" id="5905355">)</span><br>
<span class="lineno"></span><span class="op" id="5905357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5905360">//&nbsp;decUint8&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint8&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5905435">func</span>&nbsp;<span class="ident" id="5905440">decUint8</span><span class="op" id="5905448">(</span><span class="ident" id="5905449">i</span>&nbsp;<span class="op" id="5905451">*</span><span class="ident" id="5905452">decInstr</span><span class="op" id="5905460">,</span>&nbsp;<span class="ident" id="5905462">state</span>&nbsp;<span class="op" id="5905468">*</span><span class="ident" id="5905469">decoderState</span><span class="op" id="5905481">,</span>&nbsp;<span class="ident" id="5905483">value</span>&nbsp;<span class="ident" id="5905489">reflect</span><span class="op" id="5905496">.</span><span class="ident" id="5905497">Value</span><span class="op" id="5905502">)</span>&nbsp;<span class="op" id="5905504">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905507">v</span>&nbsp;<span class="op" id="5905509">:=</span>&nbsp;<span class="ident" id="5905512">state</span><span class="op" id="5905517">.</span><span class="ident" id="5905518">decodeUint</span><span class="op" id="5905528">(</span><span class="op" id="5905529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905532">if</span>&nbsp;<span class="ident" id="5905535">math</span><span class="op" id="5905539">.</span><span class="ident" id="5905540">MaxUint8</span>&nbsp;<span class="op" id="5905549">&lt;</span>&nbsp;<span class="ident" id="5905551">v</span>&nbsp;<span class="op" id="5905553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905557">error_</span><span class="op" id="5905563">(</span><span class="ident" id="5905564">i</span><span class="op" id="5905565">.</span><span class="ident" id="5905566">ovfl</span><span class="op" id="5905570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5905573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905576">value</span><span class="op" id="5905581">.</span><span class="ident" id="5905582">SetUint</span><span class="op" id="5905589">(</span><span class="ident" id="5905590">v</span><span class="op" id="5905591">)</span><br>
<span class="lineno">250</span><span class="op" id="5905593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5905596">//&nbsp;decInt16&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5905663">func</span>&nbsp;<span class="ident" id="5905668">decInt16</span><span class="op" id="5905676">(</span><span class="ident" id="5905677">i</span>&nbsp;<span class="op" id="5905679">*</span><span class="ident" id="5905680">decInstr</span><span class="op" id="5905688">,</span>&nbsp;<span class="ident" id="5905690">state</span>&nbsp;<span class="op" id="5905696">*</span><span class="ident" id="5905697">decoderState</span><span class="op" id="5905709">,</span>&nbsp;<span class="ident" id="5905711">value</span>&nbsp;<span class="ident" id="5905717">reflect</span><span class="op" id="5905724">.</span><span class="ident" id="5905725">Value</span><span class="op" id="5905730">)</span>&nbsp;<span class="op" id="5905732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905735">v</span>&nbsp;<span class="op" id="5905737">:=</span>&nbsp;<span class="ident" id="5905740">state</span><span class="op" id="5905745">.</span><span class="ident" id="5905746">decodeInt</span><span class="op" id="5905755">(</span><span class="op" id="5905756">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905759">if</span>&nbsp;<span class="ident" id="5905762">v</span>&nbsp;<span class="op" id="5905764">&lt;</span>&nbsp;<span class="ident" id="5905766">math</span><span class="op" id="5905770">.</span><span class="ident" id="5905771">MinInt16</span>&nbsp;<span class="op" id="5905780">||</span>&nbsp;<span class="ident" id="5905783">math</span><span class="op" id="5905787">.</span><span class="ident" id="5905788">MaxInt16</span>&nbsp;<span class="op" id="5905797">&lt;</span>&nbsp;<span class="ident" id="5905799">v</span>&nbsp;<span class="op" id="5905801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905805">error_</span><span class="op" id="5905811">(</span><span class="ident" id="5905812">i</span><span class="op" id="5905813">.</span><span class="ident" id="5905814">ovfl</span><span class="op" id="5905818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5905821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905824">value</span><span class="op" id="5905829">.</span><span class="ident" id="5905830">SetInt</span><span class="op" id="5905836">(</span><span class="ident" id="5905837">v</span><span class="op" id="5905838">)</span><br>
<span class="lineno"></span><span class="op" id="5905840">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="5905843">//&nbsp;decUint16&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5905920">func</span>&nbsp;<span class="ident" id="5905925">decUint16</span><span class="op" id="5905934">(</span><span class="ident" id="5905935">i</span>&nbsp;<span class="op" id="5905937">*</span><span class="ident" id="5905938">decInstr</span><span class="op" id="5905946">,</span>&nbsp;<span class="ident" id="5905948">state</span>&nbsp;<span class="op" id="5905954">*</span><span class="ident" id="5905955">decoderState</span><span class="op" id="5905967">,</span>&nbsp;<span class="ident" id="5905969">value</span>&nbsp;<span class="ident" id="5905975">reflect</span><span class="op" id="5905982">.</span><span class="ident" id="5905983">Value</span><span class="op" id="5905988">)</span>&nbsp;<span class="op" id="5905990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905993">v</span>&nbsp;<span class="op" id="5905995">:=</span>&nbsp;<span class="ident" id="5905998">state</span><span class="op" id="5906003">.</span><span class="ident" id="5906004">decodeUint</span><span class="op" id="5906014">(</span><span class="op" id="5906015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906018">if</span>&nbsp;<span class="ident" id="5906021">math</span><span class="op" id="5906025">.</span><span class="ident" id="5906026">MaxUint16</span>&nbsp;<span class="op" id="5906036">&lt;</span>&nbsp;<span class="ident" id="5906038">v</span>&nbsp;<span class="op" id="5906040">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906044">error_</span><span class="op" id="5906050">(</span><span class="ident" id="5906051">i</span><span class="op" id="5906052">.</span><span class="ident" id="5906053">ovfl</span><span class="op" id="5906057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906063">value</span><span class="op" id="5906068">.</span><span class="ident" id="5906069">SetUint</span><span class="op" id="5906076">(</span><span class="ident" id="5906077">v</span><span class="op" id="5906078">)</span><br>
<span class="lineno"></span><span class="op" id="5906080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5906083">//&nbsp;decInt32&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int32&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5906150">func</span>&nbsp;<span class="ident" id="5906155">decInt32</span><span class="op" id="5906163">(</span><span class="ident" id="5906164">i</span>&nbsp;<span class="op" id="5906166">*</span><span class="ident" id="5906167">decInstr</span><span class="op" id="5906175">,</span>&nbsp;<span class="ident" id="5906177">state</span>&nbsp;<span class="op" id="5906183">*</span><span class="ident" id="5906184">decoderState</span><span class="op" id="5906196">,</span>&nbsp;<span class="ident" id="5906198">value</span>&nbsp;<span class="ident" id="5906204">reflect</span><span class="op" id="5906211">.</span><span class="ident" id="5906212">Value</span><span class="op" id="5906217">)</span>&nbsp;<span class="op" id="5906219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906222">v</span>&nbsp;<span class="op" id="5906224">:=</span>&nbsp;<span class="ident" id="5906227">state</span><span class="op" id="5906232">.</span><span class="ident" id="5906233">decodeInt</span><span class="op" id="5906242">(</span><span class="op" id="5906243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906246">if</span>&nbsp;<span class="ident" id="5906249">v</span>&nbsp;<span class="op" id="5906251">&lt;</span>&nbsp;<span class="ident" id="5906253">math</span><span class="op" id="5906257">.</span><span class="ident" id="5906258">MinInt32</span>&nbsp;<span class="op" id="5906267">||</span>&nbsp;<span class="ident" id="5906270">math</span><span class="op" id="5906274">.</span><span class="ident" id="5906275">MaxInt32</span>&nbsp;<span class="op" id="5906284">&lt;</span>&nbsp;<span class="ident" id="5906286">v</span>&nbsp;<span class="op" id="5906288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906292">error_</span><span class="op" id="5906298">(</span><span class="ident" id="5906299">i</span><span class="op" id="5906300">.</span><span class="ident" id="5906301">ovfl</span><span class="op" id="5906305">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906311">value</span><span class="op" id="5906316">.</span><span class="ident" id="5906317">SetInt</span><span class="op" id="5906323">(</span><span class="ident" id="5906324">v</span><span class="op" id="5906325">)</span><br>
<span class="lineno"></span><span class="op" id="5906327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5906330">//&nbsp;decUint32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint32&nbsp;in&nbsp;value.</span><br>
<span class="lineno">280</span><span class="keyword" id="5906407">func</span>&nbsp;<span class="ident" id="5906412">decUint32</span><span class="op" id="5906421">(</span><span class="ident" id="5906422">i</span>&nbsp;<span class="op" id="5906424">*</span><span class="ident" id="5906425">decInstr</span><span class="op" id="5906433">,</span>&nbsp;<span class="ident" id="5906435">state</span>&nbsp;<span class="op" id="5906441">*</span><span class="ident" id="5906442">decoderState</span><span class="op" id="5906454">,</span>&nbsp;<span class="ident" id="5906456">value</span>&nbsp;<span class="ident" id="5906462">reflect</span><span class="op" id="5906469">.</span><span class="ident" id="5906470">Value</span><span class="op" id="5906475">)</span>&nbsp;<span class="op" id="5906477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906480">v</span>&nbsp;<span class="op" id="5906482">:=</span>&nbsp;<span class="ident" id="5906485">state</span><span class="op" id="5906490">.</span><span class="ident" id="5906491">decodeUint</span><span class="op" id="5906501">(</span><span class="op" id="5906502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906505">if</span>&nbsp;<span class="ident" id="5906508">math</span><span class="op" id="5906512">.</span><span class="ident" id="5906513">MaxUint32</span>&nbsp;<span class="op" id="5906523">&lt;</span>&nbsp;<span class="ident" id="5906525">v</span>&nbsp;<span class="op" id="5906527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906531">error_</span><span class="op" id="5906537">(</span><span class="ident" id="5906538">i</span><span class="op" id="5906539">.</span><span class="ident" id="5906540">ovfl</span><span class="op" id="5906544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906547">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906550">value</span><span class="op" id="5906555">.</span><span class="ident" id="5906556">SetUint</span><span class="op" id="5906563">(</span><span class="ident" id="5906564">v</span><span class="op" id="5906565">)</span><br>
<span class="lineno"></span><span class="op" id="5906567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5906570">//&nbsp;decInt64&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5906637">func</span>&nbsp;<span class="ident" id="5906642">decInt64</span><span class="op" id="5906650">(</span><span class="ident" id="5906651">i</span>&nbsp;<span class="op" id="5906653">*</span><span class="ident" id="5906654">decInstr</span><span class="op" id="5906662">,</span>&nbsp;<span class="ident" id="5906664">state</span>&nbsp;<span class="op" id="5906670">*</span><span class="ident" id="5906671">decoderState</span><span class="op" id="5906683">,</span>&nbsp;<span class="ident" id="5906685">value</span>&nbsp;<span class="ident" id="5906691">reflect</span><span class="op" id="5906698">.</span><span class="ident" id="5906699">Value</span><span class="op" id="5906704">)</span>&nbsp;<span class="op" id="5906706">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906709">v</span>&nbsp;<span class="op" id="5906711">:=</span>&nbsp;<span class="ident" id="5906714">state</span><span class="op" id="5906719">.</span><span class="ident" id="5906720">decodeInt</span><span class="op" id="5906729">(</span><span class="op" id="5906730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906733">value</span><span class="op" id="5906738">.</span><span class="ident" id="5906739">SetInt</span><span class="op" id="5906745">(</span><span class="ident" id="5906746">v</span><span class="op" id="5906747">)</span><br>
<span class="lineno"></span><span class="op" id="5906749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5906752">//&nbsp;decUint64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64&nbsp;in&nbsp;value.</span><br>
<span class="lineno">295</span><span class="keyword" id="5906829">func</span>&nbsp;<span class="ident" id="5906834">decUint64</span><span class="op" id="5906843">(</span><span class="ident" id="5906844">i</span>&nbsp;<span class="op" id="5906846">*</span><span class="ident" id="5906847">decInstr</span><span class="op" id="5906855">,</span>&nbsp;<span class="ident" id="5906857">state</span>&nbsp;<span class="op" id="5906863">*</span><span class="ident" id="5906864">decoderState</span><span class="op" id="5906876">,</span>&nbsp;<span class="ident" id="5906878">value</span>&nbsp;<span class="ident" id="5906884">reflect</span><span class="op" id="5906891">.</span><span class="ident" id="5906892">Value</span><span class="op" id="5906897">)</span>&nbsp;<span class="op" id="5906899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906902">v</span>&nbsp;<span class="op" id="5906904">:=</span>&nbsp;<span class="ident" id="5906907">state</span><span class="op" id="5906912">.</span><span class="ident" id="5906913">decodeUint</span><span class="op" id="5906923">(</span><span class="op" id="5906924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906927">value</span><span class="op" id="5906932">.</span><span class="ident" id="5906933">SetUint</span><span class="op" id="5906940">(</span><span class="ident" id="5906941">v</span><span class="op" id="5906942">)</span><br>
<span class="lineno"></span><span class="op" id="5906944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="5906947">//&nbsp;Floating-point&nbsp;numbers&nbsp;are&nbsp;transmitted&nbsp;as&nbsp;uint64s&nbsp;holding&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="5907017">//&nbsp;of&nbsp;the&nbsp;underlying&nbsp;representation.&nbsp;&nbsp;They&nbsp;are&nbsp;sent&nbsp;byte-reversed,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5907089">//&nbsp;the&nbsp;exponent&nbsp;end&nbsp;coming&nbsp;out&nbsp;first,&nbsp;so&nbsp;integer&nbsp;floating&nbsp;point&nbsp;numbers</span><br>
<span class="lineno"></span><span class="comment" id="5907161">//&nbsp;(for&nbsp;example)&nbsp;transmit&nbsp;more&nbsp;compactly.&nbsp;&nbsp;This&nbsp;routine&nbsp;does&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5907226">//&nbsp;unswizzling.</span><br>
<span class="lineno">305</span><span class="keyword" id="5907242">func</span>&nbsp;<span class="ident" id="5907247">float64FromBits</span><span class="op" id="5907262">(</span><span class="ident" id="5907263">u</span>&nbsp;<span class="ident" id="5907265">uint64</span><span class="op" id="5907271">)</span>&nbsp;<span class="builtintype" id="5907273">float64</span>&nbsp;<span class="op" id="5907281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907284">var</span>&nbsp;<span class="ident" id="5907288">v</span>&nbsp;<span class="ident" id="5907290">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907298">for</span>&nbsp;<span class="ident" id="5907302">i</span>&nbsp;<span class="op" id="5907304">:=</span>&nbsp;<span class="num" id="5907307">0</span><span class="op" id="5907308">;</span>&nbsp;<span class="ident" id="5907310">i</span>&nbsp;<span class="op" id="5907312">&lt;</span>&nbsp;<span class="num" id="5907314">8</span><span class="op" id="5907315">;</span>&nbsp;<span class="ident" id="5907317">i</span><span class="op" id="5907318">++</span>&nbsp;<span class="op" id="5907321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907325">v</span>&nbsp;<span class="op" id="5907327">&lt;&lt;=</span>&nbsp;<span class="num" id="5907331">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907335">v</span>&nbsp;<span class="op" id="5907337">|=</span>&nbsp;<span class="ident" id="5907340">u</span>&nbsp;<span class="op" id="5907342">&amp;</span>&nbsp;<span class="num" id="5907344">0xFF</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907351">u</span>&nbsp;<span class="op" id="5907353">&gt;&gt;=</span>&nbsp;<span class="num" id="5907357">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907363">return</span>&nbsp;<span class="ident" id="5907370">math</span><span class="op" id="5907374">.</span><span class="ident" id="5907375">Float64frombits</span><span class="op" id="5907390">(</span><span class="ident" id="5907391">v</span><span class="op" id="5907392">)</span><br>
<span class="lineno"></span><span class="op" id="5907394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="5907397">//&nbsp;float32FromBits&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="5907482">//&nbsp;number,&nbsp;and&nbsp;returns&nbsp;it.&nbsp;It&#39;s&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;float32&nbsp;and&nbsp;complex64.</span><br>
<span class="lineno"></span><span class="comment" id="5907559">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;float64&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;reflection&nbsp;needs,&nbsp;but&nbsp;its&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5907636">//&nbsp;value&nbsp;is&nbsp;known&nbsp;to&nbsp;be&nbsp;accurately&nbsp;representable&nbsp;in&nbsp;a&nbsp;float32.</span><br>
<span class="lineno"></span><span class="keyword" id="5907699">func</span>&nbsp;<span class="ident" id="5907704">float32FromBits</span><span class="op" id="5907719">(</span><span class="ident" id="5907720">u</span>&nbsp;<span class="ident" id="5907722">uint64</span><span class="op" id="5907728">,</span>&nbsp;<span class="ident" id="5907730">ovfl</span>&nbsp;<span class="builtintype" id="5907735">error</span><span class="op" id="5907740">)</span>&nbsp;<span class="builtintype" id="5907742">float64</span>&nbsp;<span class="op" id="5907750">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907753">v</span>&nbsp;<span class="op" id="5907755">:=</span>&nbsp;<span class="ident" id="5907758">float64FromBits</span><span class="op" id="5907773">(</span><span class="ident" id="5907774">u</span><span class="op" id="5907775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907778">av</span>&nbsp;<span class="op" id="5907781">:=</span>&nbsp;<span class="ident" id="5907784">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907787">if</span>&nbsp;<span class="ident" id="5907790">av</span>&nbsp;<span class="op" id="5907793">&lt;</span>&nbsp;<span class="num" id="5907795">0</span>&nbsp;<span class="op" id="5907797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907801">av</span>&nbsp;<span class="op" id="5907804">=</span>&nbsp;<span class="op" id="5907806">-</span><span class="ident" id="5907807">av</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907811">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5907814">//&nbsp;+Inf&nbsp;is&nbsp;OK&nbsp;in&nbsp;both&nbsp;32-&nbsp;and&nbsp;64-bit&nbsp;floats.&nbsp;&nbsp;Underflow&nbsp;is&nbsp;always&nbsp;OK.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907885">if</span>&nbsp;<span class="ident" id="5907888">math</span><span class="op" id="5907892">.</span><span class="ident" id="5907893">MaxFloat32</span>&nbsp;<span class="op" id="5907904">&lt;</span>&nbsp;<span class="ident" id="5907906">av</span>&nbsp;<span class="op" id="5907909">&amp;&amp;</span>&nbsp;<span class="ident" id="5907912">av</span>&nbsp;<span class="op" id="5907915">&lt;=</span>&nbsp;<span class="ident" id="5907918">math</span><span class="op" id="5907922">.</span><span class="ident" id="5907923">MaxFloat64</span>&nbsp;<span class="op" id="5907934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907938">error_</span><span class="op" id="5907944">(</span><span class="ident" id="5907945">ovfl</span><span class="op" id="5907949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907955">return</span>&nbsp;<span class="ident" id="5907962">v</span><br>
<span class="lineno">330</span><span class="op" id="5907964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5907967">//&nbsp;decFloat32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="5908047">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5908082">func</span>&nbsp;<span class="ident" id="5908087">decFloat32</span><span class="op" id="5908097">(</span><span class="ident" id="5908098">i</span>&nbsp;<span class="op" id="5908100">*</span><span class="ident" id="5908101">decInstr</span><span class="op" id="5908109">,</span>&nbsp;<span class="ident" id="5908111">state</span>&nbsp;<span class="op" id="5908117">*</span><span class="ident" id="5908118">decoderState</span><span class="op" id="5908130">,</span>&nbsp;<span class="ident" id="5908132">value</span>&nbsp;<span class="ident" id="5908138">reflect</span><span class="op" id="5908145">.</span><span class="ident" id="5908146">Value</span><span class="op" id="5908151">)</span>&nbsp;<span class="op" id="5908153">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908156">value</span><span class="op" id="5908161">.</span><span class="ident" id="5908162">SetFloat</span><span class="op" id="5908170">(</span><span class="ident" id="5908171">float32FromBits</span><span class="op" id="5908186">(</span><span class="ident" id="5908187">state</span><span class="op" id="5908192">.</span><span class="ident" id="5908193">decodeUint</span><span class="op" id="5908203">(</span><span class="op" id="5908204">)</span><span class="op" id="5908205">,</span>&nbsp;<span class="ident" id="5908207">i</span><span class="op" id="5908208">.</span><span class="ident" id="5908209">ovfl</span><span class="op" id="5908213">)</span><span class="op" id="5908214">)</span><br>
<span class="lineno"></span><span class="op" id="5908216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5908219">//&nbsp;decFloat64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;64-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="5908299">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">340</span><span class="keyword" id="5908334">func</span>&nbsp;<span class="ident" id="5908339">decFloat64</span><span class="op" id="5908349">(</span><span class="ident" id="5908350">i</span>&nbsp;<span class="op" id="5908352">*</span><span class="ident" id="5908353">decInstr</span><span class="op" id="5908361">,</span>&nbsp;<span class="ident" id="5908363">state</span>&nbsp;<span class="op" id="5908369">*</span><span class="ident" id="5908370">decoderState</span><span class="op" id="5908382">,</span>&nbsp;<span class="ident" id="5908384">value</span>&nbsp;<span class="ident" id="5908390">reflect</span><span class="op" id="5908397">.</span><span class="ident" id="5908398">Value</span><span class="op" id="5908403">)</span>&nbsp;<span class="op" id="5908405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908408">value</span><span class="op" id="5908413">.</span><span class="ident" id="5908414">SetFloat</span><span class="op" id="5908422">(</span><span class="ident" id="5908423">float64FromBits</span><span class="op" id="5908438">(</span><span class="ident" id="5908439">state</span><span class="op" id="5908444">.</span><span class="ident" id="5908445">decodeUint</span><span class="op" id="5908455">(</span><span class="op" id="5908456">)</span><span class="op" id="5908457">)</span><span class="op" id="5908458">)</span><br>
<span class="lineno"></span><span class="op" id="5908460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5908463">//&nbsp;decComplex64&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno">345</span><span class="comment" id="5908533">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5908609">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="5908639">func</span>&nbsp;<span class="ident" id="5908644">decComplex64</span><span class="op" id="5908656">(</span><span class="ident" id="5908657">i</span>&nbsp;<span class="op" id="5908659">*</span><span class="ident" id="5908660">decInstr</span><span class="op" id="5908668">,</span>&nbsp;<span class="ident" id="5908670">state</span>&nbsp;<span class="op" id="5908676">*</span><span class="ident" id="5908677">decoderState</span><span class="op" id="5908689">,</span>&nbsp;<span class="ident" id="5908691">value</span>&nbsp;<span class="ident" id="5908697">reflect</span><span class="op" id="5908704">.</span><span class="ident" id="5908705">Value</span><span class="op" id="5908710">)</span>&nbsp;<span class="op" id="5908712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5908715">real</span>&nbsp;<span class="op" id="5908720">:=</span>&nbsp;<span class="ident" id="5908723">float32FromBits</span><span class="op" id="5908738">(</span><span class="ident" id="5908739">state</span><span class="op" id="5908744">.</span><span class="ident" id="5908745">decodeUint</span><span class="op" id="5908755">(</span><span class="op" id="5908756">)</span><span class="op" id="5908757">,</span>&nbsp;<span class="ident" id="5908759">i</span><span class="op" id="5908760">.</span><span class="ident" id="5908761">ovfl</span><span class="op" id="5908765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5908768">imag</span>&nbsp;<span class="op" id="5908773">:=</span>&nbsp;<span class="ident" id="5908776">float32FromBits</span><span class="op" id="5908791">(</span><span class="ident" id="5908792">state</span><span class="op" id="5908797">.</span><span class="ident" id="5908798">decodeUint</span><span class="op" id="5908808">(</span><span class="op" id="5908809">)</span><span class="op" id="5908810">,</span>&nbsp;<span class="ident" id="5908812">i</span><span class="op" id="5908813">.</span><span class="ident" id="5908814">ovfl</span><span class="op" id="5908818">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908821">value</span><span class="op" id="5908826">.</span><span class="ident" id="5908827">SetComplex</span><span class="op" id="5908837">(</span><span class="builtinfunc" id="5908838">complex</span><span class="op" id="5908845">(</span><span class="builtinfunc" id="5908846">real</span><span class="op" id="5908850">,</span>&nbsp;<span class="builtinfunc" id="5908852">imag</span><span class="op" id="5908856">)</span><span class="op" id="5908857">)</span><br>
<span class="lineno"></span><span class="op" id="5908859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5908862">//&nbsp;decComplex128&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5908933">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex128&nbsp;in&nbsp;value.</span><br>
<span class="lineno">355</span><span class="comment" id="5909010">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="5909040">func</span>&nbsp;<span class="ident" id="5909045">decComplex128</span><span class="op" id="5909058">(</span><span class="ident" id="5909059">i</span>&nbsp;<span class="op" id="5909061">*</span><span class="ident" id="5909062">decInstr</span><span class="op" id="5909070">,</span>&nbsp;<span class="ident" id="5909072">state</span>&nbsp;<span class="op" id="5909078">*</span><span class="ident" id="5909079">decoderState</span><span class="op" id="5909091">,</span>&nbsp;<span class="ident" id="5909093">value</span>&nbsp;<span class="ident" id="5909099">reflect</span><span class="op" id="5909106">.</span><span class="ident" id="5909107">Value</span><span class="op" id="5909112">)</span>&nbsp;<span class="op" id="5909114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5909117">real</span>&nbsp;<span class="op" id="5909122">:=</span>&nbsp;<span class="ident" id="5909125">float64FromBits</span><span class="op" id="5909140">(</span><span class="ident" id="5909141">state</span><span class="op" id="5909146">.</span><span class="ident" id="5909147">decodeUint</span><span class="op" id="5909157">(</span><span class="op" id="5909158">)</span><span class="op" id="5909159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5909162">imag</span>&nbsp;<span class="op" id="5909167">:=</span>&nbsp;<span class="ident" id="5909170">float64FromBits</span><span class="op" id="5909185">(</span><span class="ident" id="5909186">state</span><span class="op" id="5909191">.</span><span class="ident" id="5909192">decodeUint</span><span class="op" id="5909202">(</span><span class="op" id="5909203">)</span><span class="op" id="5909204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909207">value</span><span class="op" id="5909212">.</span><span class="ident" id="5909213">SetComplex</span><span class="op" id="5909223">(</span><span class="builtinfunc" id="5909224">complex</span><span class="op" id="5909231">(</span><span class="builtinfunc" id="5909232">real</span><span class="op" id="5909236">,</span>&nbsp;<span class="builtinfunc" id="5909238">imag</span><span class="op" id="5909242">)</span><span class="op" id="5909243">)</span><br>
<span class="lineno">360</span><span class="op" id="5909245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5909248">//&nbsp;decUint8Slice&nbsp;decodes&nbsp;a&nbsp;byte&nbsp;slice&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;slice&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5909321">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5909345">//&nbsp;uint8&nbsp;slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">365</span><span class="keyword" id="5909421">func</span>&nbsp;<span class="ident" id="5909426">decUint8Slice</span><span class="op" id="5909439">(</span><span class="ident" id="5909440">i</span>&nbsp;<span class="op" id="5909442">*</span><span class="ident" id="5909443">decInstr</span><span class="op" id="5909451">,</span>&nbsp;<span class="ident" id="5909453">state</span>&nbsp;<span class="op" id="5909459">*</span><span class="ident" id="5909460">decoderState</span><span class="op" id="5909472">,</span>&nbsp;<span class="ident" id="5909474">value</span>&nbsp;<span class="ident" id="5909480">reflect</span><span class="op" id="5909487">.</span><span class="ident" id="5909488">Value</span><span class="op" id="5909493">)</span>&nbsp;<span class="op" id="5909495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909498">u</span>&nbsp;<span class="op" id="5909500">:=</span>&nbsp;<span class="ident" id="5909503">state</span><span class="op" id="5909508">.</span><span class="ident" id="5909509">decodeUint</span><span class="op" id="5909519">(</span><span class="op" id="5909520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909523">n</span>&nbsp;<span class="op" id="5909525">:=</span>&nbsp;<span class="builtintype" id="5909528">int</span><span class="op" id="5909531">(</span><span class="ident" id="5909532">u</span><span class="op" id="5909533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909536">if</span>&nbsp;<span class="ident" id="5909539">n</span>&nbsp;<span class="op" id="5909541">&lt;</span>&nbsp;<span class="num" id="5909543">0</span>&nbsp;<span class="op" id="5909545">||</span>&nbsp;<span class="ident" id="5909548">uint64</span><span class="op" id="5909554">(</span><span class="ident" id="5909555">n</span><span class="op" id="5909556">)</span>&nbsp;<span class="op" id="5909558">!=</span>&nbsp;<span class="ident" id="5909561">u</span>&nbsp;<span class="op" id="5909563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909567">errorf</span><span class="op" id="5909573">(</span><span class="string" id="5909574">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="5909618">,</span>&nbsp;<span class="ident" id="5909620">value</span><span class="op" id="5909625">.</span><span class="ident" id="5909626">Type</span><span class="op" id="5909630">(</span><span class="op" id="5909631">)</span><span class="op" id="5909632">,</span>&nbsp;<span class="ident" id="5909634">u</span><span class="op" id="5909635">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909641">if</span>&nbsp;<span class="ident" id="5909644">n</span>&nbsp;<span class="op" id="5909646">&gt;</span>&nbsp;<span class="ident" id="5909648">state</span><span class="op" id="5909653">.</span><span class="ident" id="5909654">b</span><span class="op" id="5909655">.</span><span class="ident" id="5909656">Len</span><span class="op" id="5909659">(</span><span class="op" id="5909660">)</span>&nbsp;<span class="op" id="5909662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909666">errorf</span><span class="op" id="5909672">(</span><span class="string" id="5909673">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="5909706">,</span>&nbsp;<span class="ident" id="5909708">value</span><span class="op" id="5909713">.</span><span class="ident" id="5909714">Type</span><span class="op" id="5909718">(</span><span class="op" id="5909719">)</span><span class="op" id="5909720">,</span>&nbsp;<span class="ident" id="5909722">n</span><span class="op" id="5909723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909729">if</span>&nbsp;<span class="ident" id="5909732">n</span>&nbsp;<span class="op" id="5909734">&gt;</span>&nbsp;<span class="ident" id="5909736">tooBig</span>&nbsp;<span class="op" id="5909743">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909747">errorf</span><span class="op" id="5909753">(</span><span class="string" id="5909754">&#34;byte&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&#34;</span><span class="op" id="5909778">,</span>&nbsp;<span class="ident" id="5909780">n</span><span class="op" id="5909781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909787">if</span>&nbsp;<span class="ident" id="5909790">value</span><span class="op" id="5909795">.</span><span class="ident" id="5909796">Cap</span><span class="op" id="5909799">(</span><span class="op" id="5909800">)</span>&nbsp;<span class="op" id="5909802">&lt;</span>&nbsp;<span class="ident" id="5909804">n</span>&nbsp;<span class="op" id="5909806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909810">value</span><span class="op" id="5909815">.</span><span class="ident" id="5909816">Set</span><span class="op" id="5909819">(</span><span class="ident" id="5909820">reflect</span><span class="op" id="5909827">.</span><span class="ident" id="5909828">MakeSlice</span><span class="op" id="5909837">(</span><span class="ident" id="5909838">value</span><span class="op" id="5909843">.</span><span class="ident" id="5909844">Type</span><span class="op" id="5909848">(</span><span class="op" id="5909849">)</span><span class="op" id="5909850">,</span>&nbsp;<span class="ident" id="5909852">n</span><span class="op" id="5909853">,</span>&nbsp;<span class="ident" id="5909855">n</span><span class="op" id="5909856">)</span><span class="op" id="5909857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909860">}</span>&nbsp;<span class="keyword" id="5909862">else</span>&nbsp;<span class="op" id="5909867">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909871">value</span><span class="op" id="5909876">.</span><span class="ident" id="5909877">Set</span><span class="op" id="5909880">(</span><span class="ident" id="5909881">value</span><span class="op" id="5909886">.</span><span class="ident" id="5909887">Slice</span><span class="op" id="5909892">(</span><span class="num" id="5909893">0</span><span class="op" id="5909894">,</span>&nbsp;<span class="ident" id="5909896">n</span><span class="op" id="5909897">)</span><span class="op" id="5909898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909904">if</span>&nbsp;<span class="ident" id="5909907">_</span><span class="op" id="5909908">,</span>&nbsp;<span class="ident" id="5909910">err</span>&nbsp;<span class="op" id="5909914">:=</span>&nbsp;<span class="ident" id="5909917">state</span><span class="op" id="5909922">.</span><span class="ident" id="5909923">b</span><span class="op" id="5909924">.</span><span class="ident" id="5909925">Read</span><span class="op" id="5909929">(</span><span class="ident" id="5909930">value</span><span class="op" id="5909935">.</span><span class="ident" id="5909936">Bytes</span><span class="op" id="5909941">(</span><span class="op" id="5909942">)</span><span class="op" id="5909943">)</span><span class="op" id="5909944">;</span>&nbsp;<span class="ident" id="5909946">err</span>&nbsp;<span class="op" id="5909950">!=</span>&nbsp;<span class="ident" id="5909953">nil</span>&nbsp;<span class="op" id="5909957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909961">errorf</span><span class="op" id="5909967">(</span><span class="string" id="5909968">&#34;error&nbsp;decoding&nbsp;[]byte:&nbsp;%s&#34;</span><span class="op" id="5909995">,</span>&nbsp;<span class="ident" id="5909997">err</span><span class="op" id="5910000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910003">}</span><br>
<span class="lineno">385</span><span class="op" id="5910005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5910008">//&nbsp;decString&nbsp;decodes&nbsp;byte&nbsp;array&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;string&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5910076">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5910100">//&nbsp;Strings&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">390</span><span class="keyword" id="5910171">func</span>&nbsp;<span class="ident" id="5910176">decString</span><span class="op" id="5910185">(</span><span class="ident" id="5910186">i</span>&nbsp;<span class="op" id="5910188">*</span><span class="ident" id="5910189">decInstr</span><span class="op" id="5910197">,</span>&nbsp;<span class="ident" id="5910199">state</span>&nbsp;<span class="op" id="5910205">*</span><span class="ident" id="5910206">decoderState</span><span class="op" id="5910218">,</span>&nbsp;<span class="ident" id="5910220">value</span>&nbsp;<span class="ident" id="5910226">reflect</span><span class="op" id="5910233">.</span><span class="ident" id="5910234">Value</span><span class="op" id="5910239">)</span>&nbsp;<span class="op" id="5910241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910244">u</span>&nbsp;<span class="op" id="5910246">:=</span>&nbsp;<span class="ident" id="5910249">state</span><span class="op" id="5910254">.</span><span class="ident" id="5910255">decodeUint</span><span class="op" id="5910265">(</span><span class="op" id="5910266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910269">n</span>&nbsp;<span class="op" id="5910271">:=</span>&nbsp;<span class="builtintype" id="5910274">int</span><span class="op" id="5910277">(</span><span class="ident" id="5910278">u</span><span class="op" id="5910279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910282">if</span>&nbsp;<span class="ident" id="5910285">n</span>&nbsp;<span class="op" id="5910287">&lt;</span>&nbsp;<span class="num" id="5910289">0</span>&nbsp;<span class="op" id="5910291">||</span>&nbsp;<span class="ident" id="5910294">uint64</span><span class="op" id="5910300">(</span><span class="ident" id="5910301">n</span><span class="op" id="5910302">)</span>&nbsp;<span class="op" id="5910304">!=</span>&nbsp;<span class="ident" id="5910307">u</span>&nbsp;<span class="op" id="5910309">||</span>&nbsp;<span class="ident" id="5910312">n</span>&nbsp;<span class="op" id="5910314">&gt;</span>&nbsp;<span class="ident" id="5910316">state</span><span class="op" id="5910321">.</span><span class="ident" id="5910322">b</span><span class="op" id="5910323">.</span><span class="ident" id="5910324">Len</span><span class="op" id="5910327">(</span><span class="op" id="5910328">)</span>&nbsp;<span class="op" id="5910330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910334">errorf</span><span class="op" id="5910340">(</span><span class="string" id="5910341">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="5910385">,</span>&nbsp;<span class="ident" id="5910387">value</span><span class="op" id="5910392">.</span><span class="ident" id="5910393">Type</span><span class="op" id="5910397">(</span><span class="op" id="5910398">)</span><span class="op" id="5910399">,</span>&nbsp;<span class="ident" id="5910401">u</span><span class="op" id="5910402">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910408">if</span>&nbsp;<span class="ident" id="5910411">n</span>&nbsp;<span class="op" id="5910413">&gt;</span>&nbsp;<span class="ident" id="5910415">state</span><span class="op" id="5910420">.</span><span class="ident" id="5910421">b</span><span class="op" id="5910422">.</span><span class="ident" id="5910423">Len</span><span class="op" id="5910426">(</span><span class="op" id="5910427">)</span>&nbsp;<span class="op" id="5910429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910433">errorf</span><span class="op" id="5910439">(</span><span class="string" id="5910440">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="5910473">,</span>&nbsp;<span class="ident" id="5910475">value</span><span class="op" id="5910480">.</span><span class="ident" id="5910481">Type</span><span class="op" id="5910485">(</span><span class="op" id="5910486">)</span><span class="op" id="5910487">,</span>&nbsp;<span class="ident" id="5910489">n</span><span class="op" id="5910490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5910496">//&nbsp;Read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910515">data</span>&nbsp;<span class="op" id="5910520">:=</span>&nbsp;<span class="builtinfunc" id="5910523">make</span><span class="op" id="5910527">(</span><span class="op" id="5910528">[</span><span class="op" id="5910529">]</span><span class="builtintype" id="5910530">byte</span><span class="op" id="5910534">,</span>&nbsp;<span class="ident" id="5910536">n</span><span class="op" id="5910537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910540">if</span>&nbsp;<span class="ident" id="5910543">_</span><span class="op" id="5910544">,</span>&nbsp;<span class="ident" id="5910546">err</span>&nbsp;<span class="op" id="5910550">:=</span>&nbsp;<span class="ident" id="5910553">state</span><span class="op" id="5910558">.</span><span class="ident" id="5910559">b</span><span class="op" id="5910560">.</span><span class="ident" id="5910561">Read</span><span class="op" id="5910565">(</span><span class="ident" id="5910566">data</span><span class="op" id="5910570">)</span><span class="op" id="5910571">;</span>&nbsp;<span class="ident" id="5910573">err</span>&nbsp;<span class="op" id="5910577">!=</span>&nbsp;<span class="ident" id="5910580">nil</span>&nbsp;<span class="op" id="5910584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910588">errorf</span><span class="op" id="5910594">(</span><span class="string" id="5910595">&#34;error&nbsp;decoding&nbsp;string:&nbsp;%s&#34;</span><span class="op" id="5910622">,</span>&nbsp;<span class="ident" id="5910624">err</span><span class="op" id="5910627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910633">value</span><span class="op" id="5910638">.</span><span class="ident" id="5910639">SetString</span><span class="op" id="5910648">(</span><span class="builtintype" id="5910649">string</span><span class="op" id="5910655">(</span><span class="ident" id="5910656">data</span><span class="op" id="5910660">)</span><span class="op" id="5910661">)</span><br>
<span class="lineno">405</span><span class="op" id="5910663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5910666">//&nbsp;ignoreUint8Array&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;byte&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5910750">func</span>&nbsp;<span class="ident" id="5910755">ignoreUint8Array</span><span class="op" id="5910771">(</span><span class="ident" id="5910772">i</span>&nbsp;<span class="op" id="5910774">*</span><span class="ident" id="5910775">decInstr</span><span class="op" id="5910783">,</span>&nbsp;<span class="ident" id="5910785">state</span>&nbsp;<span class="op" id="5910791">*</span><span class="ident" id="5910792">decoderState</span><span class="op" id="5910804">,</span>&nbsp;<span class="ident" id="5910806">value</span>&nbsp;<span class="ident" id="5910812">reflect</span><span class="op" id="5910819">.</span><span class="ident" id="5910820">Value</span><span class="op" id="5910825">)</span>&nbsp;<span class="op" id="5910827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910830">b</span>&nbsp;<span class="op" id="5910832">:=</span>&nbsp;<span class="builtinfunc" id="5910835">make</span><span class="op" id="5910839">(</span><span class="op" id="5910840">[</span><span class="op" id="5910841">]</span><span class="builtintype" id="5910842">byte</span><span class="op" id="5910846">,</span>&nbsp;<span class="ident" id="5910848">state</span><span class="op" id="5910853">.</span><span class="ident" id="5910854">decodeUint</span><span class="op" id="5910864">(</span><span class="op" id="5910865">)</span><span class="op" id="5910866">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910869">state</span><span class="op" id="5910874">.</span><span class="ident" id="5910875">b</span><span class="op" id="5910876">.</span><span class="ident" id="5910877">Read</span><span class="op" id="5910881">(</span><span class="ident" id="5910882">b</span><span class="op" id="5910883">)</span><br>
<span class="lineno"></span><span class="op" id="5910885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5910888">//&nbsp;Execution&nbsp;engine</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="5910909">//&nbsp;The&nbsp;encoder&nbsp;engine&nbsp;is&nbsp;an&nbsp;array&nbsp;of&nbsp;instructions&nbsp;indexed&nbsp;by&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="5910999">//&nbsp;decoder.&nbsp;&nbsp;It&nbsp;is&nbsp;executed&nbsp;with&nbsp;random&nbsp;access&nbsp;according&nbsp;to&nbsp;field&nbsp;number.</span><br>
<span class="lineno"></span><span class="keyword" id="5911073">type</span>&nbsp;<span class="ident" id="5911078">decEngine</span>&nbsp;<span class="keyword" id="5911088">struct</span>&nbsp;<span class="op" id="5911095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911098">instr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5911107">[</span><span class="op" id="5911108">]</span><span class="ident" id="5911109">decInstr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911119">numInstr</span>&nbsp;<span class="builtintype" id="5911128">int</span>&nbsp;<span class="comment" id="5911132">//&nbsp;the&nbsp;number&nbsp;of&nbsp;active&nbsp;instructions</span><br>
<span class="lineno">420</span><span class="op" id="5911169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5911172">//&nbsp;decodeSingle&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;value&nbsp;that&nbsp;is&nbsp;not&nbsp;a&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5911259">//&nbsp;Such&nbsp;values&nbsp;are&nbsp;preceded&nbsp;by&nbsp;a&nbsp;zero,&nbsp;making&nbsp;them&nbsp;have&nbsp;the&nbsp;memory&nbsp;layout&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5911338">//&nbsp;struct&nbsp;field&nbsp;(although&nbsp;with&nbsp;an&nbsp;illegal&nbsp;field&nbsp;number).</span><br>
<span class="lineno">425</span><span class="keyword" id="5911395">func</span>&nbsp;<span class="op" id="5911400">(</span><span class="ident" id="5911401">dec</span>&nbsp;<span class="op" id="5911405">*</span><span class="ident" id="5911406">Decoder</span><span class="op" id="5911413">)</span>&nbsp;<span class="ident" id="5911415">decodeSingle</span><span class="op" id="5911427">(</span><span class="ident" id="5911428">engine</span>&nbsp;<span class="op" id="5911435">*</span><span class="ident" id="5911436">decEngine</span><span class="op" id="5911445">,</span>&nbsp;<span class="ident" id="5911447">ut</span>&nbsp;<span class="op" id="5911450">*</span><span class="ident" id="5911451">userTypeInfo</span><span class="op" id="5911463">,</span>&nbsp;<span class="ident" id="5911465">value</span>&nbsp;<span class="ident" id="5911471">reflect</span><span class="op" id="5911478">.</span><span class="ident" id="5911479">Value</span><span class="op" id="5911484">)</span>&nbsp;<span class="op" id="5911486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911489">state</span>&nbsp;<span class="op" id="5911495">:=</span>&nbsp;<span class="ident" id="5911498">dec</span><span class="op" id="5911501">.</span><span class="ident" id="5911502">newDecoderState</span><span class="op" id="5911517">(</span><span class="op" id="5911518">&amp;</span><span class="ident" id="5911519">dec</span><span class="op" id="5911522">.</span><span class="ident" id="5911523">buf</span><span class="op" id="5911526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911529">defer</span>&nbsp;<span class="ident" id="5911535">dec</span><span class="op" id="5911538">.</span><span class="ident" id="5911539">freeDecoderState</span><span class="op" id="5911555">(</span><span class="ident" id="5911556">state</span><span class="op" id="5911561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911564">state</span><span class="op" id="5911569">.</span><span class="ident" id="5911570">fieldnum</span>&nbsp;<span class="op" id="5911579">=</span>&nbsp;<span class="ident" id="5911581">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911597">if</span>&nbsp;<span class="ident" id="5911600">state</span><span class="op" id="5911605">.</span><span class="ident" id="5911606">decodeUint</span><span class="op" id="5911616">(</span><span class="op" id="5911617">)</span>&nbsp;<span class="op" id="5911619">!=</span>&nbsp;<span class="num" id="5911622">0</span>&nbsp;<span class="op" id="5911624">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911628">errorf</span><span class="op" id="5911634">(</span><span class="string" id="5911635">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="5911689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5911692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911695">instr</span>&nbsp;<span class="op" id="5911701">:=</span>&nbsp;<span class="op" id="5911704">&amp;</span><span class="ident" id="5911705">engine</span><span class="op" id="5911711">.</span><span class="ident" id="5911712">instr</span><span class="op" id="5911717">[</span><span class="ident" id="5911718">singletonField</span><span class="op" id="5911732">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911735">instr</span><span class="op" id="5911740">.</span><span class="ident" id="5911741">op</span><span class="op" id="5911743">(</span><span class="ident" id="5911744">instr</span><span class="op" id="5911749">,</span>&nbsp;<span class="ident" id="5911751">state</span><span class="op" id="5911756">,</span>&nbsp;<span class="ident" id="5911758">value</span><span class="op" id="5911763">)</span><br>
<span class="lineno"></span><span class="op" id="5911765">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="5911768">//&nbsp;decodeStruct&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5911835">//&nbsp;Indir&nbsp;is&nbsp;for&nbsp;the&nbsp;value,&nbsp;not&nbsp;the&nbsp;type.&nbsp;&nbsp;At&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;call&nbsp;it&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="5911908">//&nbsp;differ&nbsp;from&nbsp;ut.indir,&nbsp;which&nbsp;was&nbsp;computed&nbsp;when&nbsp;the&nbsp;engine&nbsp;was&nbsp;built.</span><br>
<span class="lineno"></span><span class="comment" id="5911979">//&nbsp;This&nbsp;state&nbsp;cannot&nbsp;arise&nbsp;for&nbsp;decodeSingle,&nbsp;which&nbsp;is&nbsp;called&nbsp;directly</span><br>
<span class="lineno">440</span><span class="comment" id="5912049">//&nbsp;from&nbsp;the&nbsp;user&#39;s&nbsp;value,&nbsp;not&nbsp;from&nbsp;the&nbsp;innards&nbsp;of&nbsp;an&nbsp;engine.</span><br>
<span class="lineno"></span><span class="keyword" id="5912110">func</span>&nbsp;<span class="op" id="5912115">(</span><span class="ident" id="5912116">dec</span>&nbsp;<span class="op" id="5912120">*</span><span class="ident" id="5912121">Decoder</span><span class="op" id="5912128">)</span>&nbsp;<span class="ident" id="5912130">decodeStruct</span><span class="op" id="5912142">(</span><span class="ident" id="5912143">engine</span>&nbsp;<span class="op" id="5912150">*</span><span class="ident" id="5912151">decEngine</span><span class="op" id="5912160">,</span>&nbsp;<span class="ident" id="5912162">ut</span>&nbsp;<span class="op" id="5912165">*</span><span class="ident" id="5912166">userTypeInfo</span><span class="op" id="5912178">,</span>&nbsp;<span class="ident" id="5912180">value</span>&nbsp;<span class="ident" id="5912186">reflect</span><span class="op" id="5912193">.</span><span class="ident" id="5912194">Value</span><span class="op" id="5912199">)</span>&nbsp;<span class="op" id="5912201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912204">state</span>&nbsp;<span class="op" id="5912210">:=</span>&nbsp;<span class="ident" id="5912213">dec</span><span class="op" id="5912216">.</span><span class="ident" id="5912217">newDecoderState</span><span class="op" id="5912232">(</span><span class="op" id="5912233">&amp;</span><span class="ident" id="5912234">dec</span><span class="op" id="5912237">.</span><span class="ident" id="5912238">buf</span><span class="op" id="5912241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912244">defer</span>&nbsp;<span class="ident" id="5912250">dec</span><span class="op" id="5912253">.</span><span class="ident" id="5912254">freeDecoderState</span><span class="op" id="5912270">(</span><span class="ident" id="5912271">state</span><span class="op" id="5912276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912279">state</span><span class="op" id="5912284">.</span><span class="ident" id="5912285">fieldnum</span>&nbsp;<span class="op" id="5912294">=</span>&nbsp;<span class="op" id="5912296">-</span><span class="num" id="5912297">1</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912300">for</span>&nbsp;<span class="ident" id="5912304">state</span><span class="op" id="5912309">.</span><span class="ident" id="5912310">b</span><span class="op" id="5912311">.</span><span class="ident" id="5912312">Len</span><span class="op" id="5912315">(</span><span class="op" id="5912316">)</span>&nbsp;<span class="op" id="5912318">&gt;</span>&nbsp;<span class="num" id="5912320">0</span>&nbsp;<span class="op" id="5912322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912326">delta</span>&nbsp;<span class="op" id="5912332">:=</span>&nbsp;<span class="builtintype" id="5912335">int</span><span class="op" id="5912338">(</span><span class="ident" id="5912339">state</span><span class="op" id="5912344">.</span><span class="ident" id="5912345">decodeUint</span><span class="op" id="5912355">(</span><span class="op" id="5912356">)</span><span class="op" id="5912357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912361">if</span>&nbsp;<span class="ident" id="5912364">delta</span>&nbsp;<span class="op" id="5912370">&lt;</span>&nbsp;<span class="num" id="5912372">0</span>&nbsp;<span class="op" id="5912374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912379">errorf</span><span class="op" id="5912385">(</span><span class="string" id="5912386">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="5912426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912430">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912434">if</span>&nbsp;<span class="ident" id="5912437">delta</span>&nbsp;<span class="op" id="5912443">==</span>&nbsp;<span class="num" id="5912446">0</span>&nbsp;<span class="op" id="5912448">{</span>&nbsp;<span class="comment" id="5912450">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912497">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912509">fieldnum</span>&nbsp;<span class="op" id="5912518">:=</span>&nbsp;<span class="ident" id="5912521">state</span><span class="op" id="5912526">.</span><span class="ident" id="5912527">fieldnum</span>&nbsp;<span class="op" id="5912536">+</span>&nbsp;<span class="ident" id="5912538">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912546">if</span>&nbsp;<span class="ident" id="5912549">fieldnum</span>&nbsp;<span class="op" id="5912558">&gt;=</span>&nbsp;<span class="builtinfunc" id="5912561">len</span><span class="op" id="5912564">(</span><span class="ident" id="5912565">engine</span><span class="op" id="5912571">.</span><span class="ident" id="5912572">instr</span><span class="op" id="5912577">)</span>&nbsp;<span class="op" id="5912579">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912584">error_</span><span class="op" id="5912590">(</span><span class="ident" id="5912591">errRange</span><span class="op" id="5912599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912604">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912616">instr</span>&nbsp;<span class="op" id="5912622">:=</span>&nbsp;<span class="op" id="5912625">&amp;</span><span class="ident" id="5912626">engine</span><span class="op" id="5912632">.</span><span class="ident" id="5912633">instr</span><span class="op" id="5912638">[</span><span class="ident" id="5912639">fieldnum</span><span class="op" id="5912647">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912651">var</span>&nbsp;<span class="ident" id="5912655">field</span>&nbsp;<span class="ident" id="5912661">reflect</span><span class="op" id="5912668">.</span><span class="ident" id="5912669">Value</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912677">if</span>&nbsp;<span class="ident" id="5912680">instr</span><span class="op" id="5912685">.</span><span class="ident" id="5912686">index</span>&nbsp;<span class="op" id="5912692">!=</span>&nbsp;<span class="ident" id="5912695">nil</span>&nbsp;<span class="op" id="5912699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5912704">//&nbsp;Otherwise&nbsp;the&nbsp;field&nbsp;is&nbsp;unknown&nbsp;to&nbsp;us&nbsp;and&nbsp;instr.op&nbsp;is&nbsp;an&nbsp;ignore&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912777">field</span>&nbsp;<span class="op" id="5912783">=</span>&nbsp;<span class="ident" id="5912785">value</span><span class="op" id="5912790">.</span><span class="ident" id="5912791">FieldByIndex</span><span class="op" id="5912803">(</span><span class="ident" id="5912804">instr</span><span class="op" id="5912809">.</span><span class="ident" id="5912810">index</span><span class="op" id="5912815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912820">if</span>&nbsp;<span class="ident" id="5912823">field</span><span class="op" id="5912828">.</span><span class="ident" id="5912829">Kind</span><span class="op" id="5912833">(</span><span class="op" id="5912834">)</span>&nbsp;<span class="op" id="5912836">==</span>&nbsp;<span class="ident" id="5912839">reflect</span><span class="op" id="5912846">.</span><span class="ident" id="5912847">Ptr</span>&nbsp;<span class="op" id="5912851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912857">field</span>&nbsp;<span class="op" id="5912863">=</span>&nbsp;<span class="ident" id="5912865">decAlloc</span><span class="op" id="5912873">(</span><span class="ident" id="5912874">field</span><span class="op" id="5912879">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912892">instr</span><span class="op" id="5912897">.</span><span class="ident" id="5912898">op</span><span class="op" id="5912900">(</span><span class="ident" id="5912901">instr</span><span class="op" id="5912906">,</span>&nbsp;<span class="ident" id="5912908">state</span><span class="op" id="5912913">,</span>&nbsp;<span class="ident" id="5912915">field</span><span class="op" id="5912920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912924">state</span><span class="op" id="5912929">.</span><span class="ident" id="5912930">fieldnum</span>&nbsp;<span class="op" id="5912939">=</span>&nbsp;<span class="ident" id="5912941">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912951">}</span><br>
<span class="lineno">470</span><span class="op" id="5912953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5912956">var</span>&nbsp;<span class="ident" id="5912960">noValue</span>&nbsp;<span class="ident" id="5912968">reflect</span><span class="op" id="5912975">.</span><span class="ident" id="5912976">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5912983">//&nbsp;ignoreStruct&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;struct&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">475</span><span class="keyword" id="5913051">func</span>&nbsp;<span class="op" id="5913056">(</span><span class="ident" id="5913057">dec</span>&nbsp;<span class="op" id="5913061">*</span><span class="ident" id="5913062">Decoder</span><span class="op" id="5913069">)</span>&nbsp;<span class="ident" id="5913071">ignoreStruct</span><span class="op" id="5913083">(</span><span class="ident" id="5913084">engine</span>&nbsp;<span class="op" id="5913091">*</span><span class="ident" id="5913092">decEngine</span><span class="op" id="5913101">)</span>&nbsp;<span class="op" id="5913103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913106">state</span>&nbsp;<span class="op" id="5913112">:=</span>&nbsp;<span class="ident" id="5913115">dec</span><span class="op" id="5913118">.</span><span class="ident" id="5913119">newDecoderState</span><span class="op" id="5913134">(</span><span class="op" id="5913135">&amp;</span><span class="ident" id="5913136">dec</span><span class="op" id="5913139">.</span><span class="ident" id="5913140">buf</span><span class="op" id="5913143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913146">defer</span>&nbsp;<span class="ident" id="5913152">dec</span><span class="op" id="5913155">.</span><span class="ident" id="5913156">freeDecoderState</span><span class="op" id="5913172">(</span><span class="ident" id="5913173">state</span><span class="op" id="5913178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913181">state</span><span class="op" id="5913186">.</span><span class="ident" id="5913187">fieldnum</span>&nbsp;<span class="op" id="5913196">=</span>&nbsp;<span class="op" id="5913198">-</span><span class="num" id="5913199">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913202">for</span>&nbsp;<span class="ident" id="5913206">state</span><span class="op" id="5913211">.</span><span class="ident" id="5913212">b</span><span class="op" id="5913213">.</span><span class="ident" id="5913214">Len</span><span class="op" id="5913217">(</span><span class="op" id="5913218">)</span>&nbsp;<span class="op" id="5913220">&gt;</span>&nbsp;<span class="num" id="5913222">0</span>&nbsp;<span class="op" id="5913224">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913228">delta</span>&nbsp;<span class="op" id="5913234">:=</span>&nbsp;<span class="builtintype" id="5913237">int</span><span class="op" id="5913240">(</span><span class="ident" id="5913241">state</span><span class="op" id="5913246">.</span><span class="ident" id="5913247">decodeUint</span><span class="op" id="5913257">(</span><span class="op" id="5913258">)</span><span class="op" id="5913259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913263">if</span>&nbsp;<span class="ident" id="5913266">delta</span>&nbsp;<span class="op" id="5913272">&lt;</span>&nbsp;<span class="num" id="5913274">0</span>&nbsp;<span class="op" id="5913276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913281">errorf</span><span class="op" id="5913287">(</span><span class="string" id="5913288">&#34;ignore&nbsp;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="5913335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913343">if</span>&nbsp;<span class="ident" id="5913346">delta</span>&nbsp;<span class="op" id="5913352">==</span>&nbsp;<span class="num" id="5913355">0</span>&nbsp;<span class="op" id="5913357">{</span>&nbsp;<span class="comment" id="5913359">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913406">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913418">fieldnum</span>&nbsp;<span class="op" id="5913427">:=</span>&nbsp;<span class="ident" id="5913430">state</span><span class="op" id="5913435">.</span><span class="ident" id="5913436">fieldnum</span>&nbsp;<span class="op" id="5913445">+</span>&nbsp;<span class="ident" id="5913447">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913455">if</span>&nbsp;<span class="ident" id="5913458">fieldnum</span>&nbsp;<span class="op" id="5913467">&gt;=</span>&nbsp;<span class="builtinfunc" id="5913470">len</span><span class="op" id="5913473">(</span><span class="ident" id="5913474">engine</span><span class="op" id="5913480">.</span><span class="ident" id="5913481">instr</span><span class="op" id="5913486">)</span>&nbsp;<span class="op" id="5913488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913493">error_</span><span class="op" id="5913499">(</span><span class="ident" id="5913500">errRange</span><span class="op" id="5913508">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913516">instr</span>&nbsp;<span class="op" id="5913522">:=</span>&nbsp;<span class="op" id="5913525">&amp;</span><span class="ident" id="5913526">engine</span><span class="op" id="5913532">.</span><span class="ident" id="5913533">instr</span><span class="op" id="5913538">[</span><span class="ident" id="5913539">fieldnum</span><span class="op" id="5913547">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913551">instr</span><span class="op" id="5913556">.</span><span class="ident" id="5913557">op</span><span class="op" id="5913559">(</span><span class="ident" id="5913560">instr</span><span class="op" id="5913565">,</span>&nbsp;<span class="ident" id="5913567">state</span><span class="op" id="5913572">,</span>&nbsp;<span class="ident" id="5913574">noValue</span><span class="op" id="5913581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913585">state</span><span class="op" id="5913590">.</span><span class="ident" id="5913591">fieldnum</span>&nbsp;<span class="op" id="5913600">=</span>&nbsp;<span class="ident" id="5913602">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913612">}</span><br>
<span class="lineno">495</span><span class="op" id="5913614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5913617">//&nbsp;ignoreSingle&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;top-level&nbsp;non-struct&nbsp;value&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5913692">//&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;when&nbsp;calling&nbsp;Decode&nbsp;with&nbsp;a&nbsp;nil&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5913756">func</span>&nbsp;<span class="op" id="5913761">(</span><span class="ident" id="5913762">dec</span>&nbsp;<span class="op" id="5913766">*</span><span class="ident" id="5913767">Decoder</span><span class="op" id="5913774">)</span>&nbsp;<span class="ident" id="5913776">ignoreSingle</span><span class="op" id="5913788">(</span><span class="ident" id="5913789">engine</span>&nbsp;<span class="op" id="5913796">*</span><span class="ident" id="5913797">decEngine</span><span class="op" id="5913806">)</span>&nbsp;<span class="op" id="5913808">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913811">state</span>&nbsp;<span class="op" id="5913817">:=</span>&nbsp;<span class="ident" id="5913820">dec</span><span class="op" id="5913823">.</span><span class="ident" id="5913824">newDecoderState</span><span class="op" id="5913839">(</span><span class="op" id="5913840">&amp;</span><span class="ident" id="5913841">dec</span><span class="op" id="5913844">.</span><span class="ident" id="5913845">buf</span><span class="op" id="5913848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913851">defer</span>&nbsp;<span class="ident" id="5913857">dec</span><span class="op" id="5913860">.</span><span class="ident" id="5913861">freeDecoderState</span><span class="op" id="5913877">(</span><span class="ident" id="5913878">state</span><span class="op" id="5913883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913886">state</span><span class="op" id="5913891">.</span><span class="ident" id="5913892">fieldnum</span>&nbsp;<span class="op" id="5913901">=</span>&nbsp;<span class="ident" id="5913903">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913919">delta</span>&nbsp;<span class="op" id="5913925">:=</span>&nbsp;<span class="builtintype" id="5913928">int</span><span class="op" id="5913931">(</span><span class="ident" id="5913932">state</span><span class="op" id="5913937">.</span><span class="ident" id="5913938">decodeUint</span><span class="op" id="5913948">(</span><span class="op" id="5913949">)</span><span class="op" id="5913950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913953">if</span>&nbsp;<span class="ident" id="5913956">delta</span>&nbsp;<span class="op" id="5913962">!=</span>&nbsp;<span class="num" id="5913965">0</span>&nbsp;<span class="op" id="5913967">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913971">errorf</span><span class="op" id="5913977">(</span><span class="string" id="5913978">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="5914032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914038">instr</span>&nbsp;<span class="op" id="5914044">:=</span>&nbsp;<span class="op" id="5914047">&amp;</span><span class="ident" id="5914048">engine</span><span class="op" id="5914054">.</span><span class="ident" id="5914055">instr</span><span class="op" id="5914060">[</span><span class="ident" id="5914061">singletonField</span><span class="op" id="5914075">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914078">instr</span><span class="op" id="5914083">.</span><span class="ident" id="5914084">op</span><span class="op" id="5914086">(</span><span class="ident" id="5914087">instr</span><span class="op" id="5914092">,</span>&nbsp;<span class="ident" id="5914094">state</span><span class="op" id="5914099">,</span>&nbsp;<span class="ident" id="5914101">noValue</span><span class="op" id="5914108">)</span><br>
<span class="lineno"></span><span class="op" id="5914110">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="comment" id="5914113">//&nbsp;decodeArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;decoding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="5914180">func</span>&nbsp;<span class="op" id="5914185">(</span><span class="ident" id="5914186">dec</span>&nbsp;<span class="op" id="5914190">*</span><span class="ident" id="5914191">Decoder</span><span class="op" id="5914198">)</span>&nbsp;<span class="ident" id="5914200">decodeArrayHelper</span><span class="op" id="5914217">(</span><span class="ident" id="5914218">state</span>&nbsp;<span class="op" id="5914224">*</span><span class="ident" id="5914225">decoderState</span><span class="op" id="5914237">,</span>&nbsp;<span class="ident" id="5914239">value</span>&nbsp;<span class="ident" id="5914245">reflect</span><span class="op" id="5914252">.</span><span class="ident" id="5914253">Value</span><span class="op" id="5914258">,</span>&nbsp;<span class="ident" id="5914260">elemOp</span>&nbsp;<span class="ident" id="5914267">decOp</span><span class="op" id="5914272">,</span>&nbsp;<span class="ident" id="5914274">length</span>&nbsp;<span class="builtintype" id="5914281">int</span><span class="op" id="5914284">,</span>&nbsp;<span class="ident" id="5914286">ovfl</span>&nbsp;<span class="builtintype" id="5914291">error</span><span class="op" id="5914296">,</span>&nbsp;<span class="ident" id="5914298">helper</span>&nbsp;<span class="ident" id="5914305">decHelper</span><span class="op" id="5914314">)</span>&nbsp;<span class="op" id="5914316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914319">if</span>&nbsp;<span class="ident" id="5914322">helper</span>&nbsp;<span class="op" id="5914329">!=</span>&nbsp;<span class="ident" id="5914332">nil</span>&nbsp;<span class="op" id="5914336">&amp;&amp;</span>&nbsp;<span class="ident" id="5914339">helper</span><span class="op" id="5914345">(</span><span class="ident" id="5914346">state</span><span class="op" id="5914351">,</span>&nbsp;<span class="ident" id="5914353">value</span><span class="op" id="5914358">,</span>&nbsp;<span class="ident" id="5914360">length</span><span class="op" id="5914366">,</span>&nbsp;<span class="ident" id="5914368">ovfl</span><span class="op" id="5914372">)</span>&nbsp;<span class="op" id="5914374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914378">return</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914389">instr</span>&nbsp;<span class="op" id="5914395">:=</span>&nbsp;<span class="op" id="5914398">&amp;</span><span class="ident" id="5914399">decInstr</span><span class="op" id="5914407">{</span><span class="ident" id="5914408">elemOp</span><span class="op" id="5914414">,</span>&nbsp;<span class="num" id="5914416">0</span><span class="op" id="5914417">,</span>&nbsp;<span class="ident" id="5914419">nil</span><span class="op" id="5914422">,</span>&nbsp;<span class="ident" id="5914424">ovfl</span><span class="op" id="5914428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914431">isPtr</span>&nbsp;<span class="op" id="5914437">:=</span>&nbsp;<span class="ident" id="5914440">value</span><span class="op" id="5914445">.</span><span class="ident" id="5914446">Type</span><span class="op" id="5914450">(</span><span class="op" id="5914451">)</span><span class="op" id="5914452">.</span><span class="ident" id="5914453">Elem</span><span class="op" id="5914457">(</span><span class="op" id="5914458">)</span><span class="op" id="5914459">.</span><span class="ident" id="5914460">Kind</span><span class="op" id="5914464">(</span><span class="op" id="5914465">)</span>&nbsp;<span class="op" id="5914467">==</span>&nbsp;<span class="ident" id="5914470">reflect</span><span class="op" id="5914477">.</span><span class="ident" id="5914478">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914483">for</span>&nbsp;<span class="ident" id="5914487">i</span>&nbsp;<span class="op" id="5914489">:=</span>&nbsp;<span class="num" id="5914492">0</span><span class="op" id="5914493">;</span>&nbsp;<span class="ident" id="5914495">i</span>&nbsp;<span class="op" id="5914497">&lt;</span>&nbsp;<span class="ident" id="5914499">length</span><span class="op" id="5914505">;</span>&nbsp;<span class="ident" id="5914507">i</span><span class="op" id="5914508">++</span>&nbsp;<span class="op" id="5914511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914515">if</span>&nbsp;<span class="ident" id="5914518">state</span><span class="op" id="5914523">.</span><span class="ident" id="5914524">b</span><span class="op" id="5914525">.</span><span class="ident" id="5914526">Len</span><span class="op" id="5914529">(</span><span class="op" id="5914530">)</span>&nbsp;<span class="op" id="5914532">==</span>&nbsp;<span class="num" id="5914535">0</span>&nbsp;<span class="op" id="5914537">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914542">errorf</span><span class="op" id="5914548">(</span><span class="string" id="5914549">&#34;decoding&nbsp;array&nbsp;or&nbsp;slice:&nbsp;length&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;elements)&#34;</span><span class="op" id="5914615">,</span>&nbsp;<span class="ident" id="5914617">length</span><span class="op" id="5914623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914631">v</span>&nbsp;<span class="op" id="5914633">:=</span>&nbsp;<span class="ident" id="5914636">value</span><span class="op" id="5914641">.</span><span class="ident" id="5914642">Index</span><span class="op" id="5914647">(</span><span class="ident" id="5914648">i</span><span class="op" id="5914649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914653">if</span>&nbsp;<span class="ident" id="5914656">isPtr</span>&nbsp;<span class="op" id="5914662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914667">v</span>&nbsp;<span class="op" id="5914669">=</span>&nbsp;<span class="ident" id="5914671">decAlloc</span><span class="op" id="5914679">(</span><span class="ident" id="5914680">v</span><span class="op" id="5914681">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914689">elemOp</span><span class="op" id="5914695">(</span><span class="ident" id="5914696">instr</span><span class="op" id="5914701">,</span>&nbsp;<span class="ident" id="5914703">state</span><span class="op" id="5914708">,</span>&nbsp;<span class="ident" id="5914710">v</span><span class="op" id="5914711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914714">}</span><br>
<span class="lineno"></span><span class="op" id="5914716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="5914719">//&nbsp;decodeArray&nbsp;decodes&nbsp;an&nbsp;array&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5914775">//&nbsp;The&nbsp;length&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;preceding&nbsp;the&nbsp;elements.&nbsp;&nbsp;Even&nbsp;though&nbsp;the&nbsp;length&nbsp;is&nbsp;redundant</span><br>
<span class="lineno"></span><span class="comment" id="5914873">//&nbsp;(it&#39;s&nbsp;part&nbsp;of&nbsp;the&nbsp;type),&nbsp;it&#39;s&nbsp;a&nbsp;useful&nbsp;check&nbsp;and&nbsp;is&nbsp;included&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5914954">func</span>&nbsp;<span class="op" id="5914959">(</span><span class="ident" id="5914960">dec</span>&nbsp;<span class="op" id="5914964">*</span><span class="ident" id="5914965">Decoder</span><span class="op" id="5914972">)</span>&nbsp;<span class="ident" id="5914974">decodeArray</span><span class="op" id="5914985">(</span><span class="ident" id="5914986">atyp</span>&nbsp;<span class="ident" id="5914991">reflect</span><span class="op" id="5914998">.</span><span class="ident" id="5914999">Type</span><span class="op" id="5915003">,</span>&nbsp;<span class="ident" id="5915005">state</span>&nbsp;<span class="op" id="5915011">*</span><span class="ident" id="5915012">decoderState</span><span class="op" id="5915024">,</span>&nbsp;<span class="ident" id="5915026">value</span>&nbsp;<span class="ident" id="5915032">reflect</span><span class="op" id="5915039">.</span><span class="ident" id="5915040">Value</span><span class="op" id="5915045">,</span>&nbsp;<span class="ident" id="5915047">elemOp</span>&nbsp;<span class="ident" id="5915054">decOp</span><span class="op" id="5915059">,</span>&nbsp;<span class="ident" id="5915061">length</span>&nbsp;<span class="builtintype" id="5915068">int</span><span class="op" id="5915071">,</span>&nbsp;<span class="ident" id="5915073">ovfl</span>&nbsp;<span class="builtintype" id="5915078">error</span><span class="op" id="5915083">,</span>&nbsp;<span class="ident" id="5915085">helper</span>&nbsp;<span class="ident" id="5915092">decHelper</span><span class="op" id="5915101">)</span>&nbsp;<span class="op" id="5915103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915106">if</span>&nbsp;<span class="ident" id="5915109">n</span>&nbsp;<span class="op" id="5915111">:=</span>&nbsp;<span class="ident" id="5915114">state</span><span class="op" id="5915119">.</span><span class="ident" id="5915120">decodeUint</span><span class="op" id="5915130">(</span><span class="op" id="5915131">)</span><span class="op" id="5915132">;</span>&nbsp;<span class="ident" id="5915134">n</span>&nbsp;<span class="op" id="5915136">!=</span>&nbsp;<span class="ident" id="5915139">uint64</span><span class="op" id="5915145">(</span><span class="ident" id="5915146">length</span><span class="op" id="5915152">)</span>&nbsp;<span class="op" id="5915154">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915158">errorf</span><span class="op" id="5915164">(</span><span class="string" id="5915165">&#34;length&nbsp;mismatch&nbsp;in&nbsp;decodeArray&#34;</span><span class="op" id="5915197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915203">dec</span><span class="op" id="5915206">.</span><span class="ident" id="5915207">decodeArrayHelper</span><span class="op" id="5915224">(</span><span class="ident" id="5915225">state</span><span class="op" id="5915230">,</span>&nbsp;<span class="ident" id="5915232">value</span><span class="op" id="5915237">,</span>&nbsp;<span class="ident" id="5915239">elemOp</span><span class="op" id="5915245">,</span>&nbsp;<span class="ident" id="5915247">length</span><span class="op" id="5915253">,</span>&nbsp;<span class="ident" id="5915255">ovfl</span><span class="op" id="5915259">,</span>&nbsp;<span class="ident" id="5915261">helper</span><span class="op" id="5915267">)</span><br>
<span class="lineno"></span><span class="op" id="5915269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="5915272">//&nbsp;decodeIntoValue&nbsp;is&nbsp;a&nbsp;helper&nbsp;for&nbsp;map&nbsp;decoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5915321">func</span>&nbsp;<span class="ident" id="5915326">decodeIntoValue</span><span class="op" id="5915341">(</span><span class="ident" id="5915342">state</span>&nbsp;<span class="op" id="5915348">*</span><span class="ident" id="5915349">decoderState</span><span class="op" id="5915361">,</span>&nbsp;<span class="ident" id="5915363">op</span>&nbsp;<span class="ident" id="5915366">decOp</span><span class="op" id="5915371">,</span>&nbsp;<span class="ident" id="5915373">isPtr</span>&nbsp;<span class="builtintype" id="5915379">bool</span><span class="op" id="5915383">,</span>&nbsp;<span class="ident" id="5915385">value</span>&nbsp;<span class="ident" id="5915391">reflect</span><span class="op" id="5915398">.</span><span class="ident" id="5915399">Value</span><span class="op" id="5915404">,</span>&nbsp;<span class="ident" id="5915406">ovfl</span>&nbsp;<span class="builtintype" id="5915411">error</span><span class="op" id="5915416">)</span>&nbsp;<span class="ident" id="5915418">reflect</span><span class="op" id="5915425">.</span><span class="ident" id="5915426">Value</span>&nbsp;<span class="op" id="5915432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915435">instr</span>&nbsp;<span class="op" id="5915441">:=</span>&nbsp;<span class="op" id="5915444">&amp;</span><span class="ident" id="5915445">decInstr</span><span class="op" id="5915453">{</span><span class="ident" id="5915454">op</span><span class="op" id="5915456">,</span>&nbsp;<span class="num" id="5915458">0</span><span class="op" id="5915459">,</span>&nbsp;<span class="ident" id="5915461">nil</span><span class="op" id="5915464">,</span>&nbsp;<span class="ident" id="5915466">ovfl</span><span class="op" id="5915470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915473">v</span>&nbsp;<span class="op" id="5915475">:=</span>&nbsp;<span class="ident" id="5915478">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915485">if</span>&nbsp;<span class="ident" id="5915488">isPtr</span>&nbsp;<span class="op" id="5915494">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915498">v</span>&nbsp;<span class="op" id="5915500">=</span>&nbsp;<span class="ident" id="5915502">decAlloc</span><span class="op" id="5915510">(</span><span class="ident" id="5915511">value</span><span class="op" id="5915516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915522">op</span><span class="op" id="5915524">(</span><span class="ident" id="5915525">instr</span><span class="op" id="5915530">,</span>&nbsp;<span class="ident" id="5915532">state</span><span class="op" id="5915537">,</span>&nbsp;<span class="ident" id="5915539">v</span><span class="op" id="5915540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915543">return</span>&nbsp;<span class="ident" id="5915550">value</span><br>
<span class="lineno"></span><span class="op" id="5915556">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="5915559">//&nbsp;decodeMap&nbsp;decodes&nbsp;a&nbsp;map&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5915610">//&nbsp;Maps&nbsp;are&nbsp;encoded&nbsp;as&nbsp;a&nbsp;length&nbsp;followed&nbsp;by&nbsp;key:value&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="comment" id="5915671">//&nbsp;Because&nbsp;the&nbsp;internals&nbsp;of&nbsp;maps&nbsp;are&nbsp;not&nbsp;visible&nbsp;to&nbsp;us,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5915735">//&nbsp;use&nbsp;reflection&nbsp;rather&nbsp;than&nbsp;pointer&nbsp;magic.</span><br>
<span class="lineno">555</span><span class="keyword" id="5915780">func</span>&nbsp;<span class="op" id="5915785">(</span><span class="ident" id="5915786">dec</span>&nbsp;<span class="op" id="5915790">*</span><span class="ident" id="5915791">Decoder</span><span class="op" id="5915798">)</span>&nbsp;<span class="ident" id="5915800">decodeMap</span><span class="op" id="5915809">(</span><span class="ident" id="5915810">mtyp</span>&nbsp;<span class="ident" id="5915815">reflect</span><span class="op" id="5915822">.</span><span class="ident" id="5915823">Type</span><span class="op" id="5915827">,</span>&nbsp;<span class="ident" id="5915829">state</span>&nbsp;<span class="op" id="5915835">*</span><span class="ident" id="5915836">decoderState</span><span class="op" id="5915848">,</span>&nbsp;<span class="ident" id="5915850">value</span>&nbsp;<span class="ident" id="5915856">reflect</span><span class="op" id="5915863">.</span><span class="ident" id="5915864">Value</span><span class="op" id="5915869">,</span>&nbsp;<span class="ident" id="5915871">keyOp</span><span class="op" id="5915876">,</span>&nbsp;<span class="ident" id="5915878">elemOp</span>&nbsp;<span class="ident" id="5915885">decOp</span><span class="op" id="5915890">,</span>&nbsp;<span class="ident" id="5915892">ovfl</span>&nbsp;<span class="builtintype" id="5915897">error</span><span class="op" id="5915902">)</span>&nbsp;<span class="op" id="5915904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915907">if</span>&nbsp;<span class="ident" id="5915910">value</span><span class="op" id="5915915">.</span><span class="ident" id="5915916">IsNil</span><span class="op" id="5915921">(</span><span class="op" id="5915922">)</span>&nbsp;<span class="op" id="5915924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915928">//&nbsp;Allocate&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915947">value</span><span class="op" id="5915952">.</span><span class="ident" id="5915953">Set</span><span class="op" id="5915956">(</span><span class="ident" id="5915957">reflect</span><span class="op" id="5915964">.</span><span class="ident" id="5915965">MakeMap</span><span class="op" id="5915972">(</span><span class="ident" id="5915973">mtyp</span><span class="op" id="5915977">)</span><span class="op" id="5915978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915981">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915984">n</span>&nbsp;<span class="op" id="5915986">:=</span>&nbsp;<span class="builtintype" id="5915989">int</span><span class="op" id="5915992">(</span><span class="ident" id="5915993">state</span><span class="op" id="5915998">.</span><span class="ident" id="5915999">decodeUint</span><span class="op" id="5916009">(</span><span class="op" id="5916010">)</span><span class="op" id="5916011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916014">keyIsPtr</span>&nbsp;<span class="op" id="5916023">:=</span>&nbsp;<span class="ident" id="5916026">mtyp</span><span class="op" id="5916030">.</span><span class="ident" id="5916031">Key</span><span class="op" id="5916034">(</span><span class="op" id="5916035">)</span><span class="op" id="5916036">.</span><span class="ident" id="5916037">Kind</span><span class="op" id="5916041">(</span><span class="op" id="5916042">)</span>&nbsp;<span class="op" id="5916044">==</span>&nbsp;<span class="ident" id="5916047">reflect</span><span class="op" id="5916054">.</span><span class="ident" id="5916055">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916060">elemIsPtr</span>&nbsp;<span class="op" id="5916070">:=</span>&nbsp;<span class="ident" id="5916073">mtyp</span><span class="op" id="5916077">.</span><span class="ident" id="5916078">Elem</span><span class="op" id="5916082">(</span><span class="op" id="5916083">)</span><span class="op" id="5916084">.</span><span class="ident" id="5916085">Kind</span><span class="op" id="5916089">(</span><span class="op" id="5916090">)</span>&nbsp;<span class="op" id="5916092">==</span>&nbsp;<span class="ident" id="5916095">reflect</span><span class="op" id="5916102">.</span><span class="ident" id="5916103">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916108">for</span>&nbsp;<span class="ident" id="5916112">i</span>&nbsp;<span class="op" id="5916114">:=</span>&nbsp;<span class="num" id="5916117">0</span><span class="op" id="5916118">;</span>&nbsp;<span class="ident" id="5916120">i</span>&nbsp;<span class="op" id="5916122">&lt;</span>&nbsp;<span class="ident" id="5916124">n</span><span class="op" id="5916125">;</span>&nbsp;<span class="ident" id="5916127">i</span><span class="op" id="5916128">++</span>&nbsp;<span class="op" id="5916131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916135">key</span>&nbsp;<span class="op" id="5916139">:=</span>&nbsp;<span class="ident" id="5916142">decodeIntoValue</span><span class="op" id="5916157">(</span><span class="ident" id="5916158">state</span><span class="op" id="5916163">,</span>&nbsp;<span class="ident" id="5916165">keyOp</span><span class="op" id="5916170">,</span>&nbsp;<span class="ident" id="5916172">keyIsPtr</span><span class="op" id="5916180">,</span>&nbsp;<span class="ident" id="5916182">allocValue</span><span class="op" id="5916192">(</span><span class="ident" id="5916193">mtyp</span><span class="op" id="5916197">.</span><span class="ident" id="5916198">Key</span><span class="op" id="5916201">(</span><span class="op" id="5916202">)</span><span class="op" id="5916203">)</span><span class="op" id="5916204">,</span>&nbsp;<span class="ident" id="5916206">ovfl</span><span class="op" id="5916210">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916214">elem</span>&nbsp;<span class="op" id="5916219">:=</span>&nbsp;<span class="ident" id="5916222">decodeIntoValue</span><span class="op" id="5916237">(</span><span class="ident" id="5916238">state</span><span class="op" id="5916243">,</span>&nbsp;<span class="ident" id="5916245">elemOp</span><span class="op" id="5916251">,</span>&nbsp;<span class="ident" id="5916253">elemIsPtr</span><span class="op" id="5916262">,</span>&nbsp;<span class="ident" id="5916264">allocValue</span><span class="op" id="5916274">(</span><span class="ident" id="5916275">mtyp</span><span class="op" id="5916279">.</span><span class="ident" id="5916280">Elem</span><span class="op" id="5916284">(</span><span class="op" id="5916285">)</span><span class="op" id="5916286">)</span><span class="op" id="5916287">,</span>&nbsp;<span class="ident" id="5916289">ovfl</span><span class="op" id="5916293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916297">value</span><span class="op" id="5916302">.</span><span class="ident" id="5916303">SetMapIndex</span><span class="op" id="5916314">(</span><span class="ident" id="5916315">key</span><span class="op" id="5916318">,</span>&nbsp;<span class="ident" id="5916320">elem</span><span class="op" id="5916324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916327">}</span><br>
<span class="lineno"></span><span class="op" id="5916329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">570</span><span class="comment" id="5916332">//&nbsp;ignoreArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;discarding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="5916401">func</span>&nbsp;<span class="op" id="5916406">(</span><span class="ident" id="5916407">dec</span>&nbsp;<span class="op" id="5916411">*</span><span class="ident" id="5916412">Decoder</span><span class="op" id="5916419">)</span>&nbsp;<span class="ident" id="5916421">ignoreArrayHelper</span><span class="op" id="5916438">(</span><span class="ident" id="5916439">state</span>&nbsp;<span class="op" id="5916445">*</span><span class="ident" id="5916446">decoderState</span><span class="op" id="5916458">,</span>&nbsp;<span class="ident" id="5916460">elemOp</span>&nbsp;<span class="ident" id="5916467">decOp</span><span class="op" id="5916472">,</span>&nbsp;<span class="ident" id="5916474">length</span>&nbsp;<span class="builtintype" id="5916481">int</span><span class="op" id="5916484">)</span>&nbsp;<span class="op" id="5916486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916489">instr</span>&nbsp;<span class="op" id="5916495">:=</span>&nbsp;<span class="op" id="5916498">&amp;</span><span class="ident" id="5916499">decInstr</span><span class="op" id="5916507">{</span><span class="ident" id="5916508">elemOp</span><span class="op" id="5916514">,</span>&nbsp;<span class="num" id="5916516">0</span><span class="op" id="5916517">,</span>&nbsp;<span class="ident" id="5916519">nil</span><span class="op" id="5916522">,</span>&nbsp;<span class="ident" id="5916524">errors</span><span class="op" id="5916530">.</span><span class="ident" id="5916531">New</span><span class="op" id="5916534">(</span><span class="string" id="5916535">&#34;no&nbsp;error&#34;</span><span class="op" id="5916545">)</span><span class="op" id="5916546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916549">for</span>&nbsp;<span class="ident" id="5916553">i</span>&nbsp;<span class="op" id="5916555">:=</span>&nbsp;<span class="num" id="5916558">0</span><span class="op" id="5916559">;</span>&nbsp;<span class="ident" id="5916561">i</span>&nbsp;<span class="op" id="5916563">&lt;</span>&nbsp;<span class="ident" id="5916565">length</span><span class="op" id="5916571">;</span>&nbsp;<span class="ident" id="5916573">i</span><span class="op" id="5916574">++</span>&nbsp;<span class="op" id="5916577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916581">elemOp</span><span class="op" id="5916587">(</span><span class="ident" id="5916588">instr</span><span class="op" id="5916593">,</span>&nbsp;<span class="ident" id="5916595">state</span><span class="op" id="5916600">,</span>&nbsp;<span class="ident" id="5916602">noValue</span><span class="op" id="5916609">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916612">}</span><br>
<span class="lineno"></span><span class="op" id="5916614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5916617">//&nbsp;ignoreArray&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;array&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5916690">func</span>&nbsp;<span class="op" id="5916695">(</span><span class="ident" id="5916696">dec</span>&nbsp;<span class="op" id="5916700">*</span><span class="ident" id="5916701">Decoder</span><span class="op" id="5916708">)</span>&nbsp;<span class="ident" id="5916710">ignoreArray</span><span class="op" id="5916721">(</span><span class="ident" id="5916722">state</span>&nbsp;<span class="op" id="5916728">*</span><span class="ident" id="5916729">decoderState</span><span class="op" id="5916741">,</span>&nbsp;<span class="ident" id="5916743">elemOp</span>&nbsp;<span class="ident" id="5916750">decOp</span><span class="op" id="5916755">,</span>&nbsp;<span class="ident" id="5916757">length</span>&nbsp;<span class="builtintype" id="5916764">int</span><span class="op" id="5916767">)</span>&nbsp;<span class="op" id="5916769">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916772">if</span>&nbsp;<span class="ident" id="5916775">n</span>&nbsp;<span class="op" id="5916777">:=</span>&nbsp;<span class="ident" id="5916780">state</span><span class="op" id="5916785">.</span><span class="ident" id="5916786">decodeUint</span><span class="op" id="5916796">(</span><span class="op" id="5916797">)</span><span class="op" id="5916798">;</span>&nbsp;<span class="ident" id="5916800">n</span>&nbsp;<span class="op" id="5916802">!=</span>&nbsp;<span class="ident" id="5916805">uint64</span><span class="op" id="5916811">(</span><span class="ident" id="5916812">length</span><span class="op" id="5916818">)</span>&nbsp;<span class="op" id="5916820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916824">errorf</span><span class="op" id="5916830">(</span><span class="string" id="5916831">&#34;length&nbsp;mismatch&nbsp;in&nbsp;ignoreArray&#34;</span><span class="op" id="5916863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916869">dec</span><span class="op" id="5916872">.</span><span class="ident" id="5916873">ignoreArrayHelper</span><span class="op" id="5916890">(</span><span class="ident" id="5916891">state</span><span class="op" id="5916896">,</span>&nbsp;<span class="ident" id="5916898">elemOp</span><span class="op" id="5916904">,</span>&nbsp;<span class="ident" id="5916906">length</span><span class="op" id="5916912">)</span><br>
<span class="lineno"></span><span class="op" id="5916914">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="comment" id="5916917">//&nbsp;ignoreMap&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;map&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5916985">func</span>&nbsp;<span class="op" id="5916990">(</span><span class="ident" id="5916991">dec</span>&nbsp;<span class="op" id="5916995">*</span><span class="ident" id="5916996">Decoder</span><span class="op" id="5917003">)</span>&nbsp;<span class="ident" id="5917005">ignoreMap</span><span class="op" id="5917014">(</span><span class="ident" id="5917015">state</span>&nbsp;<span class="op" id="5917021">*</span><span class="ident" id="5917022">decoderState</span><span class="op" id="5917034">,</span>&nbsp;<span class="ident" id="5917036">keyOp</span><span class="op" id="5917041">,</span>&nbsp;<span class="ident" id="5917043">elemOp</span>&nbsp;<span class="ident" id="5917050">decOp</span><span class="op" id="5917055">)</span>&nbsp;<span class="op" id="5917057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917060">n</span>&nbsp;<span class="op" id="5917062">:=</span>&nbsp;<span class="builtintype" id="5917065">int</span><span class="op" id="5917068">(</span><span class="ident" id="5917069">state</span><span class="op" id="5917074">.</span><span class="ident" id="5917075">decodeUint</span><span class="op" id="5917085">(</span><span class="op" id="5917086">)</span><span class="op" id="5917087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917090">keyInstr</span>&nbsp;<span class="op" id="5917099">:=</span>&nbsp;<span class="op" id="5917102">&amp;</span><span class="ident" id="5917103">decInstr</span><span class="op" id="5917111">{</span><span class="ident" id="5917112">keyOp</span><span class="op" id="5917117">,</span>&nbsp;<span class="num" id="5917119">0</span><span class="op" id="5917120">,</span>&nbsp;<span class="ident" id="5917122">nil</span><span class="op" id="5917125">,</span>&nbsp;<span class="ident" id="5917127">errors</span><span class="op" id="5917133">.</span><span class="ident" id="5917134">New</span><span class="op" id="5917137">(</span><span class="string" id="5917138">&#34;no&nbsp;error&#34;</span><span class="op" id="5917148">)</span><span class="op" id="5917149">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917152">elemInstr</span>&nbsp;<span class="op" id="5917162">:=</span>&nbsp;<span class="op" id="5917165">&amp;</span><span class="ident" id="5917166">decInstr</span><span class="op" id="5917174">{</span><span class="ident" id="5917175">elemOp</span><span class="op" id="5917181">,</span>&nbsp;<span class="num" id="5917183">0</span><span class="op" id="5917184">,</span>&nbsp;<span class="ident" id="5917186">nil</span><span class="op" id="5917189">,</span>&nbsp;<span class="ident" id="5917191">errors</span><span class="op" id="5917197">.</span><span class="ident" id="5917198">New</span><span class="op" id="5917201">(</span><span class="string" id="5917202">&#34;no&nbsp;error&#34;</span><span class="op" id="5917212">)</span><span class="op" id="5917213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917216">for</span>&nbsp;<span class="ident" id="5917220">i</span>&nbsp;<span class="op" id="5917222">:=</span>&nbsp;<span class="num" id="5917225">0</span><span class="op" id="5917226">;</span>&nbsp;<span class="ident" id="5917228">i</span>&nbsp;<span class="op" id="5917230">&lt;</span>&nbsp;<span class="ident" id="5917232">n</span><span class="op" id="5917233">;</span>&nbsp;<span class="ident" id="5917235">i</span><span class="op" id="5917236">++</span>&nbsp;<span class="op" id="5917239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917243">keyOp</span><span class="op" id="5917248">(</span><span class="ident" id="5917249">keyInstr</span><span class="op" id="5917257">,</span>&nbsp;<span class="ident" id="5917259">state</span><span class="op" id="5917264">,</span>&nbsp;<span class="ident" id="5917266">noValue</span><span class="op" id="5917273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917277">elemOp</span><span class="op" id="5917283">(</span><span class="ident" id="5917284">elemInstr</span><span class="op" id="5917293">,</span>&nbsp;<span class="ident" id="5917295">state</span><span class="op" id="5917300">,</span>&nbsp;<span class="ident" id="5917302">noValue</span><span class="op" id="5917309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917312">}</span><br>
<span class="lineno">595</span><span class="op" id="5917314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5917317">//&nbsp;decodeSlice&nbsp;decodes&nbsp;a&nbsp;slice&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5917372">//&nbsp;Slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;length&nbsp;followed&nbsp;by&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="5917442">func</span>&nbsp;<span class="op" id="5917447">(</span><span class="ident" id="5917448">dec</span>&nbsp;<span class="op" id="5917452">*</span><span class="ident" id="5917453">Decoder</span><span class="op" id="5917460">)</span>&nbsp;<span class="ident" id="5917462">decodeSlice</span><span class="op" id="5917473">(</span><span class="ident" id="5917474">state</span>&nbsp;<span class="op" id="5917480">*</span><span class="ident" id="5917481">decoderState</span><span class="op" id="5917493">,</span>&nbsp;<span class="ident" id="5917495">value</span>&nbsp;<span class="ident" id="5917501">reflect</span><span class="op" id="5917508">.</span><span class="ident" id="5917509">Value</span><span class="op" id="5917514">,</span>&nbsp;<span class="ident" id="5917516">elemOp</span>&nbsp;<span class="ident" id="5917523">decOp</span><span class="op" id="5917528">,</span>&nbsp;<span class="ident" id="5917530">ovfl</span>&nbsp;<span class="builtintype" id="5917535">error</span><span class="op" id="5917540">,</span>&nbsp;<span class="ident" id="5917542">helper</span>&nbsp;<span class="ident" id="5917549">decHelper</span><span class="op" id="5917558">)</span>&nbsp;<span class="op" id="5917560">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917563">u</span>&nbsp;<span class="op" id="5917565">:=</span>&nbsp;<span class="ident" id="5917568">state</span><span class="op" id="5917573">.</span><span class="ident" id="5917574">decodeUint</span><span class="op" id="5917584">(</span><span class="op" id="5917585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917588">typ</span>&nbsp;<span class="op" id="5917592">:=</span>&nbsp;<span class="ident" id="5917595">value</span><span class="op" id="5917600">.</span><span class="ident" id="5917601">Type</span><span class="op" id="5917605">(</span><span class="op" id="5917606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917609">size</span>&nbsp;<span class="op" id="5917614">:=</span>&nbsp;<span class="ident" id="5917617">uint64</span><span class="op" id="5917623">(</span><span class="ident" id="5917624">typ</span><span class="op" id="5917627">.</span><span class="ident" id="5917628">Elem</span><span class="op" id="5917632">(</span><span class="op" id="5917633">)</span><span class="op" id="5917634">.</span><span class="ident" id="5917635">Size</span><span class="op" id="5917639">(</span><span class="op" id="5917640">)</span><span class="op" id="5917641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917644">nBytes</span>&nbsp;<span class="op" id="5917651">:=</span>&nbsp;<span class="ident" id="5917654">u</span>&nbsp;<span class="op" id="5917656">*</span>&nbsp;<span class="ident" id="5917658">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917664">n</span>&nbsp;<span class="op" id="5917666">:=</span>&nbsp;<span class="builtintype" id="5917669">int</span><span class="op" id="5917672">(</span><span class="ident" id="5917673">u</span><span class="op" id="5917674">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917677">//&nbsp;Take&nbsp;care&nbsp;with&nbsp;overflow&nbsp;in&nbsp;this&nbsp;calculation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917726">if</span>&nbsp;<span class="ident" id="5917729">n</span>&nbsp;<span class="op" id="5917731">&lt;</span>&nbsp;<span class="num" id="5917733">0</span>&nbsp;<span class="op" id="5917735">||</span>&nbsp;<span class="ident" id="5917738">uint64</span><span class="op" id="5917744">(</span><span class="ident" id="5917745">n</span><span class="op" id="5917746">)</span>&nbsp;<span class="op" id="5917748">!=</span>&nbsp;<span class="ident" id="5917751">u</span>&nbsp;<span class="op" id="5917753">||</span>&nbsp;<span class="ident" id="5917756">nBytes</span>&nbsp;<span class="op" id="5917763">&gt;</span>&nbsp;<span class="ident" id="5917765">tooBig</span>&nbsp;<span class="op" id="5917772">||</span>&nbsp;<span class="op" id="5917775">(</span><span class="ident" id="5917776">size</span>&nbsp;<span class="op" id="5917781">&gt;</span>&nbsp;<span class="num" id="5917783">0</span>&nbsp;<span class="op" id="5917785">&amp;&amp;</span>&nbsp;<span class="ident" id="5917788">nBytes</span><span class="op" id="5917794">/</span><span class="ident" id="5917795">size</span>&nbsp;<span class="op" id="5917800">!=</span>&nbsp;<span class="ident" id="5917803">u</span><span class="op" id="5917804">)</span>&nbsp;<span class="op" id="5917806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917810">//&nbsp;We&nbsp;don&#39;t&nbsp;check&nbsp;n&nbsp;against&nbsp;buffer&nbsp;length&nbsp;here&nbsp;because&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917883">//&nbsp;of&nbsp;interfaces,&nbsp;there&nbsp;will&nbsp;be&nbsp;buffer&nbsp;reloads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917933">errorf</span><span class="op" id="5917939">(</span><span class="string" id="5917940">&#34;%s&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&nbsp;elements&nbsp;of&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="5917983">,</span>&nbsp;<span class="ident" id="5917985">typ</span><span class="op" id="5917988">.</span><span class="ident" id="5917989">Elem</span><span class="op" id="5917993">(</span><span class="op" id="5917994">)</span><span class="op" id="5917995">,</span>&nbsp;<span class="ident" id="5917997">u</span><span class="op" id="5917998">,</span>&nbsp;<span class="ident" id="5918000">size</span><span class="op" id="5918004">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918010">if</span>&nbsp;<span class="ident" id="5918013">value</span><span class="op" id="5918018">.</span><span class="ident" id="5918019">Cap</span><span class="op" id="5918022">(</span><span class="op" id="5918023">)</span>&nbsp;<span class="op" id="5918025">&lt;</span>&nbsp;<span class="ident" id="5918027">n</span>&nbsp;<span class="op" id="5918029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918033">value</span><span class="op" id="5918038">.</span><span class="ident" id="5918039">Set</span><span class="op" id="5918042">(</span><span class="ident" id="5918043">reflect</span><span class="op" id="5918050">.</span><span class="ident" id="5918051">MakeSlice</span><span class="op" id="5918060">(</span><span class="ident" id="5918061">typ</span><span class="op" id="5918064">,</span>&nbsp;<span class="ident" id="5918066">n</span><span class="op" id="5918067">,</span>&nbsp;<span class="ident" id="5918069">n</span><span class="op" id="5918070">)</span><span class="op" id="5918071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918074">}</span>&nbsp;<span class="keyword" id="5918076">else</span>&nbsp;<span class="op" id="5918081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918085">value</span><span class="op" id="5918090">.</span><span class="ident" id="5918091">Set</span><span class="op" id="5918094">(</span><span class="ident" id="5918095">value</span><span class="op" id="5918100">.</span><span class="ident" id="5918101">Slice</span><span class="op" id="5918106">(</span><span class="num" id="5918107">0</span><span class="op" id="5918108">,</span>&nbsp;<span class="ident" id="5918110">n</span><span class="op" id="5918111">)</span><span class="op" id="5918112">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918118">dec</span><span class="op" id="5918121">.</span><span class="ident" id="5918122">decodeArrayHelper</span><span class="op" id="5918139">(</span><span class="ident" id="5918140">state</span><span class="op" id="5918145">,</span>&nbsp;<span class="ident" id="5918147">value</span><span class="op" id="5918152">,</span>&nbsp;<span class="ident" id="5918154">elemOp</span><span class="op" id="5918160">,</span>&nbsp;<span class="ident" id="5918162">n</span><span class="op" id="5918163">,</span>&nbsp;<span class="ident" id="5918165">ovfl</span><span class="op" id="5918169">,</span>&nbsp;<span class="ident" id="5918171">helper</span><span class="op" id="5918177">)</span><br>
<span class="lineno"></span><span class="op" id="5918179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5918182">//&nbsp;ignoreSlice&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">620</span><span class="keyword" id="5918256">func</span>&nbsp;<span class="op" id="5918261">(</span><span class="ident" id="5918262">dec</span>&nbsp;<span class="op" id="5918266">*</span><span class="ident" id="5918267">Decoder</span><span class="op" id="5918274">)</span>&nbsp;<span class="ident" id="5918276">ignoreSlice</span><span class="op" id="5918287">(</span><span class="ident" id="5918288">state</span>&nbsp;<span class="op" id="5918294">*</span><span class="ident" id="5918295">decoderState</span><span class="op" id="5918307">,</span>&nbsp;<span class="ident" id="5918309">elemOp</span>&nbsp;<span class="ident" id="5918316">decOp</span><span class="op" id="5918321">)</span>&nbsp;<span class="op" id="5918323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918326">dec</span><span class="op" id="5918329">.</span><span class="ident" id="5918330">ignoreArrayHelper</span><span class="op" id="5918347">(</span><span class="ident" id="5918348">state</span><span class="op" id="5918353">,</span>&nbsp;<span class="ident" id="5918355">elemOp</span><span class="op" id="5918361">,</span>&nbsp;<span class="builtintype" id="5918363">int</span><span class="op" id="5918366">(</span><span class="ident" id="5918367">state</span><span class="op" id="5918372">.</span><span class="ident" id="5918373">decodeUint</span><span class="op" id="5918383">(</span><span class="op" id="5918384">)</span><span class="op" id="5918385">)</span><span class="op" id="5918386">)</span><br>
<span class="lineno"></span><span class="op" id="5918388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5918391">//&nbsp;decodeInterface&nbsp;decodes&nbsp;an&nbsp;interface&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">625</span><span class="comment" id="5918461">//&nbsp;Interfaces&nbsp;are&nbsp;encoded&nbsp;as&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;concrete&nbsp;type&nbsp;followed&nbsp;by&nbsp;a&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5918539">//&nbsp;If&nbsp;the&nbsp;name&nbsp;is&nbsp;empty,&nbsp;the&nbsp;value&nbsp;is&nbsp;nil&nbsp;and&nbsp;no&nbsp;value&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="5918603">func</span>&nbsp;<span class="op" id="5918608">(</span><span class="ident" id="5918609">dec</span>&nbsp;<span class="op" id="5918613">*</span><span class="ident" id="5918614">Decoder</span><span class="op" id="5918621">)</span>&nbsp;<span class="ident" id="5918623">decodeInterface</span><span class="op" id="5918638">(</span><span class="ident" id="5918639">ityp</span>&nbsp;<span class="ident" id="5918644">reflect</span><span class="op" id="5918651">.</span><span class="ident" id="5918652">Type</span><span class="op" id="5918656">,</span>&nbsp;<span class="ident" id="5918658">state</span>&nbsp;<span class="op" id="5918664">*</span><span class="ident" id="5918665">decoderState</span><span class="op" id="5918677">,</span>&nbsp;<span class="ident" id="5918679">value</span>&nbsp;<span class="ident" id="5918685">reflect</span><span class="op" id="5918692">.</span><span class="ident" id="5918693">Value</span><span class="op" id="5918698">)</span>&nbsp;<span class="op" id="5918700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918703">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918743">nr</span>&nbsp;<span class="op" id="5918746">:=</span>&nbsp;<span class="ident" id="5918749">state</span><span class="op" id="5918754">.</span><span class="ident" id="5918755">decodeUint</span><span class="op" id="5918765">(</span><span class="op" id="5918766">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918769">if</span>&nbsp;<span class="ident" id="5918772">nr</span>&nbsp;<span class="op" id="5918775">&lt;</span>&nbsp;<span class="num" id="5918777">0</span>&nbsp;<span class="op" id="5918779">||</span>&nbsp;<span class="ident" id="5918782">nr</span>&nbsp;<span class="op" id="5918785">&gt;</span>&nbsp;<span class="num" id="5918787">1</span><span class="op" id="5918788">&lt;&lt;</span><span class="num" id="5918790">31</span>&nbsp;<span class="op" id="5918793">{</span>&nbsp;<span class="comment" id="5918795">//&nbsp;zero&nbsp;is&nbsp;permissible&nbsp;for&nbsp;anonymous&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918840">errorf</span><span class="op" id="5918846">(</span><span class="string" id="5918847">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d&#34;</span><span class="op" id="5918876">,</span>&nbsp;<span class="ident" id="5918878">nr</span><span class="op" id="5918880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918886">if</span>&nbsp;<span class="ident" id="5918889">nr</span>&nbsp;<span class="op" id="5918892">&gt;</span>&nbsp;<span class="ident" id="5918894">uint64</span><span class="op" id="5918900">(</span><span class="ident" id="5918901">state</span><span class="op" id="5918906">.</span><span class="ident" id="5918907">b</span><span class="op" id="5918908">.</span><span class="ident" id="5918909">Len</span><span class="op" id="5918912">(</span><span class="op" id="5918913">)</span><span class="op" id="5918914">)</span>&nbsp;<span class="op" id="5918916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918920">errorf</span><span class="op" id="5918926">(</span><span class="string" id="5918927">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d:&nbsp;exceeds&nbsp;input&nbsp;size&#34;</span><span class="op" id="5918976">,</span>&nbsp;<span class="ident" id="5918978">nr</span><span class="op" id="5918980">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918986">b</span>&nbsp;<span class="op" id="5918988">:=</span>&nbsp;<span class="builtinfunc" id="5918991">make</span><span class="op" id="5918995">(</span><span class="op" id="5918996">[</span><span class="op" id="5918997">]</span><span class="builtintype" id="5918998">byte</span><span class="op" id="5919002">,</span>&nbsp;<span class="ident" id="5919004">nr</span><span class="op" id="5919006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919009">state</span><span class="op" id="5919014">.</span><span class="ident" id="5919015">b</span><span class="op" id="5919016">.</span><span class="ident" id="5919017">Read</span><span class="op" id="5919021">(</span><span class="ident" id="5919022">b</span><span class="op" id="5919023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919026">name</span>&nbsp;<span class="op" id="5919031">:=</span>&nbsp;<span class="builtintype" id="5919034">string</span><span class="op" id="5919040">(</span><span class="ident" id="5919041">b</span><span class="op" id="5919042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919045">//&nbsp;Allocate&nbsp;the&nbsp;destination&nbsp;interface&nbsp;value.</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919091">if</span>&nbsp;<span class="ident" id="5919094">name</span>&nbsp;<span class="op" id="5919099">==</span>&nbsp;<span class="string" id="5919102">&#34;&#34;</span>&nbsp;<span class="op" id="5919105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919109">//&nbsp;Copy&nbsp;the&nbsp;nil&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919158">value</span><span class="op" id="5919163">.</span><span class="ident" id="5919164">Set</span><span class="op" id="5919167">(</span><span class="ident" id="5919168">reflect</span><span class="op" id="5919175">.</span><span class="ident" id="5919176">Zero</span><span class="op" id="5919180">(</span><span class="ident" id="5919181">value</span><span class="op" id="5919186">.</span><span class="ident" id="5919187">Type</span><span class="op" id="5919191">(</span><span class="op" id="5919192">)</span><span class="op" id="5919193">)</span><span class="op" id="5919194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919198">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919206">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919209">if</span>&nbsp;<span class="builtinfunc" id="5919212">len</span><span class="op" id="5919215">(</span><span class="ident" id="5919216">name</span><span class="op" id="5919220">)</span>&nbsp;<span class="op" id="5919222">&gt;</span>&nbsp;<span class="num" id="5919224">1024</span>&nbsp;<span class="op" id="5919229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919233">errorf</span><span class="op" id="5919239">(</span><span class="string" id="5919240">&#34;name&nbsp;too&nbsp;long&nbsp;(%d&nbsp;bytes):&nbsp;%.20q...&#34;</span><span class="op" id="5919276">,</span>&nbsp;<span class="builtinfunc" id="5919278">len</span><span class="op" id="5919281">(</span><span class="ident" id="5919282">name</span><span class="op" id="5919286">)</span><span class="op" id="5919287">,</span>&nbsp;<span class="ident" id="5919289">name</span><span class="op" id="5919293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919299">//&nbsp;The&nbsp;concrete&nbsp;type&nbsp;must&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919341">registerLock</span><span class="op" id="5919353">.</span><span class="ident" id="5919354">RLock</span><span class="op" id="5919359">(</span><span class="op" id="5919360">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919363">typ</span><span class="op" id="5919366">,</span>&nbsp;<span class="ident" id="5919368">ok</span>&nbsp;<span class="op" id="5919371">:=</span>&nbsp;<span class="ident" id="5919374">nameToConcreteType</span><span class="op" id="5919392">[</span><span class="ident" id="5919393">name</span><span class="op" id="5919397">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919400">registerLock</span><span class="op" id="5919412">.</span><span class="ident" id="5919413">RUnlock</span><span class="op" id="5919420">(</span><span class="op" id="5919421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919424">if</span>&nbsp;<span class="op" id="5919427">!</span><span class="ident" id="5919428">ok</span>&nbsp;<span class="op" id="5919431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919435">errorf</span><span class="op" id="5919441">(</span><span class="string" id="5919442">&#34;name&nbsp;not&nbsp;registered&nbsp;for&nbsp;interface:&nbsp;%q&#34;</span><span class="op" id="5919481">,</span>&nbsp;<span class="ident" id="5919483">name</span><span class="op" id="5919487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919490">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919493">//&nbsp;Read&nbsp;the&nbsp;type&nbsp;id&nbsp;of&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919537">concreteId</span>&nbsp;<span class="op" id="5919548">:=</span>&nbsp;<span class="ident" id="5919551">dec</span><span class="op" id="5919554">.</span><span class="ident" id="5919555">decodeTypeSequence</span><span class="op" id="5919573">(</span><span class="builtintype" id="5919574">true</span><span class="op" id="5919578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919581">if</span>&nbsp;<span class="ident" id="5919584">concreteId</span>&nbsp;<span class="op" id="5919595">&lt;</span>&nbsp;<span class="num" id="5919597">0</span>&nbsp;<span class="op" id="5919599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919603">error_</span><span class="op" id="5919609">(</span><span class="ident" id="5919610">dec</span><span class="op" id="5919613">.</span><span class="ident" id="5919614">err</span><span class="op" id="5919617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919620">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919623">//&nbsp;Byte&nbsp;count&nbsp;of&nbsp;value&nbsp;is&nbsp;next;&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;what&nbsp;it&nbsp;is&nbsp;(it&#39;s&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919693">//&nbsp;in&nbsp;case&nbsp;we&nbsp;want&nbsp;to&nbsp;ignore&nbsp;the&nbsp;value&nbsp;by&nbsp;skipping&nbsp;it&nbsp;completely).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919761">state</span><span class="op" id="5919766">.</span><span class="ident" id="5919767">decodeUint</span><span class="op" id="5919777">(</span><span class="op" id="5919778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919781">//&nbsp;Read&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919810">v</span>&nbsp;<span class="op" id="5919812">:=</span>&nbsp;<span class="ident" id="5919815">allocValue</span><span class="op" id="5919825">(</span><span class="ident" id="5919826">typ</span><span class="op" id="5919829">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919832">dec</span><span class="op" id="5919835">.</span><span class="ident" id="5919836">decodeValue</span><span class="op" id="5919847">(</span><span class="ident" id="5919848">concreteId</span><span class="op" id="5919858">,</span>&nbsp;<span class="ident" id="5919860">v</span><span class="op" id="5919861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919864">if</span>&nbsp;<span class="ident" id="5919867">dec</span><span class="op" id="5919870">.</span><span class="ident" id="5919871">err</span>&nbsp;<span class="op" id="5919875">!=</span>&nbsp;<span class="ident" id="5919878">nil</span>&nbsp;<span class="op" id="5919882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919886">error_</span><span class="op" id="5919892">(</span><span class="ident" id="5919893">dec</span><span class="op" id="5919896">.</span><span class="ident" id="5919897">err</span><span class="op" id="5919900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919906">//&nbsp;Assign&nbsp;the&nbsp;concrete&nbsp;value&nbsp;to&nbsp;the&nbsp;interface.</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919954">//&nbsp;Tread&nbsp;carefully;&nbsp;it&nbsp;might&nbsp;not&nbsp;satisfy&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920011">if</span>&nbsp;<span class="op" id="5920014">!</span><span class="ident" id="5920015">typ</span><span class="op" id="5920018">.</span><span class="ident" id="5920019">AssignableTo</span><span class="op" id="5920031">(</span><span class="ident" id="5920032">ityp</span><span class="op" id="5920036">)</span>&nbsp;<span class="op" id="5920038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920042">errorf</span><span class="op" id="5920048">(</span><span class="string" id="5920049">&#34;%s&nbsp;is&nbsp;not&nbsp;assignable&nbsp;to&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5920082">,</span>&nbsp;<span class="ident" id="5920084">typ</span><span class="op" id="5920087">,</span>&nbsp;<span class="ident" id="5920089">ityp</span><span class="op" id="5920093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920099">//&nbsp;Copy&nbsp;the&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920143">value</span><span class="op" id="5920148">.</span><span class="ident" id="5920149">Set</span><span class="op" id="5920152">(</span><span class="ident" id="5920153">v</span><span class="op" id="5920154">)</span><br>
<span class="lineno"></span><span class="op" id="5920156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5920159">//&nbsp;ignoreInterface&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;interface&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5920240">func</span>&nbsp;<span class="op" id="5920245">(</span><span class="ident" id="5920246">dec</span>&nbsp;<span class="op" id="5920250">*</span><span class="ident" id="5920251">Decoder</span><span class="op" id="5920258">)</span>&nbsp;<span class="ident" id="5920260">ignoreInterface</span><span class="op" id="5920275">(</span><span class="ident" id="5920276">state</span>&nbsp;<span class="op" id="5920282">*</span><span class="ident" id="5920283">decoderState</span><span class="op" id="5920295">)</span>&nbsp;<span class="op" id="5920297">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920300">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920340">b</span>&nbsp;<span class="op" id="5920342">:=</span>&nbsp;<span class="builtinfunc" id="5920345">make</span><span class="op" id="5920349">(</span><span class="op" id="5920350">[</span><span class="op" id="5920351">]</span><span class="builtintype" id="5920352">byte</span><span class="op" id="5920356">,</span>&nbsp;<span class="ident" id="5920358">state</span><span class="op" id="5920363">.</span><span class="ident" id="5920364">decodeUint</span><span class="op" id="5920374">(</span><span class="op" id="5920375">)</span><span class="op" id="5920376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920379">_</span><span class="op" id="5920380">,</span>&nbsp;<span class="ident" id="5920382">err</span>&nbsp;<span class="op" id="5920386">:=</span>&nbsp;<span class="ident" id="5920389">state</span><span class="op" id="5920394">.</span><span class="ident" id="5920395">b</span><span class="op" id="5920396">.</span><span class="ident" id="5920397">Read</span><span class="op" id="5920401">(</span><span class="ident" id="5920402">b</span><span class="op" id="5920403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920406">if</span>&nbsp;<span class="ident" id="5920409">err</span>&nbsp;<span class="op" id="5920413">!=</span>&nbsp;<span class="ident" id="5920416">nil</span>&nbsp;<span class="op" id="5920420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920424">error_</span><span class="op" id="5920430">(</span><span class="ident" id="5920431">err</span><span class="op" id="5920434">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920440">id</span>&nbsp;<span class="op" id="5920443">:=</span>&nbsp;<span class="ident" id="5920446">dec</span><span class="op" id="5920449">.</span><span class="ident" id="5920450">decodeTypeSequence</span><span class="op" id="5920468">(</span><span class="builtintype" id="5920469">true</span><span class="op" id="5920473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920476">if</span>&nbsp;<span class="ident" id="5920479">id</span>&nbsp;<span class="op" id="5920482">&lt;</span>&nbsp;<span class="num" id="5920484">0</span>&nbsp;<span class="op" id="5920486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920490">error_</span><span class="op" id="5920496">(</span><span class="ident" id="5920497">dec</span><span class="op" id="5920500">.</span><span class="ident" id="5920501">err</span><span class="op" id="5920504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920507">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920510">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;the&nbsp;decoder&nbsp;buffer&nbsp;contains&nbsp;a&nbsp;delimited&nbsp;value.&nbsp;Just&nbsp;toss&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920590">state</span><span class="op" id="5920595">.</span><span class="ident" id="5920596">b</span><span class="op" id="5920597">.</span><span class="ident" id="5920598">Drop</span><span class="op" id="5920602">(</span><span class="builtintype" id="5920603">int</span><span class="op" id="5920606">(</span><span class="ident" id="5920607">state</span><span class="op" id="5920612">.</span><span class="ident" id="5920613">decodeUint</span><span class="op" id="5920623">(</span><span class="op" id="5920624">)</span><span class="op" id="5920625">)</span><span class="op" id="5920626">)</span><br>
<span class="lineno"></span><span class="op" id="5920628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5920631">//&nbsp;decodeGobDecoder&nbsp;decodes&nbsp;something&nbsp;implementing&nbsp;the&nbsp;GobDecoder&nbsp;interface.</span><br>
<span class="lineno">695</span><span class="comment" id="5920708">//&nbsp;The&nbsp;data&nbsp;is&nbsp;encoded&nbsp;as&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="5920748">func</span>&nbsp;<span class="op" id="5920753">(</span><span class="ident" id="5920754">dec</span>&nbsp;<span class="op" id="5920758">*</span><span class="ident" id="5920759">Decoder</span><span class="op" id="5920766">)</span>&nbsp;<span class="ident" id="5920768">decodeGobDecoder</span><span class="op" id="5920784">(</span><span class="ident" id="5920785">ut</span>&nbsp;<span class="op" id="5920788">*</span><span class="ident" id="5920789">userTypeInfo</span><span class="op" id="5920801">,</span>&nbsp;<span class="ident" id="5920803">state</span>&nbsp;<span class="op" id="5920809">*</span><span class="ident" id="5920810">decoderState</span><span class="op" id="5920822">,</span>&nbsp;<span class="ident" id="5920824">value</span>&nbsp;<span class="ident" id="5920830">reflect</span><span class="op" id="5920837">.</span><span class="ident" id="5920838">Value</span><span class="op" id="5920843">)</span>&nbsp;<span class="op" id="5920845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920848">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920882">b</span>&nbsp;<span class="op" id="5920884">:=</span>&nbsp;<span class="builtinfunc" id="5920887">make</span><span class="op" id="5920891">(</span><span class="op" id="5920892">[</span><span class="op" id="5920893">]</span><span class="builtintype" id="5920894">byte</span><span class="op" id="5920898">,</span>&nbsp;<span class="ident" id="5920900">state</span><span class="op" id="5920905">.</span><span class="ident" id="5920906">decodeUint</span><span class="op" id="5920916">(</span><span class="op" id="5920917">)</span><span class="op" id="5920918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920921">_</span><span class="op" id="5920922">,</span>&nbsp;<span class="ident" id="5920924">err</span>&nbsp;<span class="op" id="5920928">:=</span>&nbsp;<span class="ident" id="5920931">state</span><span class="op" id="5920936">.</span><span class="ident" id="5920937">b</span><span class="op" id="5920938">.</span><span class="ident" id="5920939">Read</span><span class="op" id="5920943">(</span><span class="ident" id="5920944">b</span><span class="op" id="5920945">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920948">if</span>&nbsp;<span class="ident" id="5920951">err</span>&nbsp;<span class="op" id="5920955">!=</span>&nbsp;<span class="ident" id="5920958">nil</span>&nbsp;<span class="op" id="5920962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920966">error_</span><span class="op" id="5920972">(</span><span class="ident" id="5920973">err</span><span class="op" id="5920976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920982">//&nbsp;We&nbsp;know&nbsp;it&#39;s&nbsp;one&nbsp;of&nbsp;these.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921013">switch</span>&nbsp;<span class="ident" id="5921020">ut</span><span class="op" id="5921022">.</span><span class="ident" id="5921023">externalDec</span>&nbsp;<span class="op" id="5921035">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921038">case</span>&nbsp;<span class="ident" id="5921043">xGob</span><span class="op" id="5921047">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921051">err</span>&nbsp;<span class="op" id="5921055">=</span>&nbsp;<span class="ident" id="5921057">value</span><span class="op" id="5921062">.</span><span class="ident" id="5921063">Interface</span><span class="op" id="5921072">(</span><span class="op" id="5921073">)</span><span class="op" id="5921074">.</span><span class="op" id="5921075">(</span><span class="ident" id="5921076">GobDecoder</span><span class="op" id="5921086">)</span><span class="op" id="5921087">.</span><span class="ident" id="5921088">GobDecode</span><span class="op" id="5921097">(</span><span class="ident" id="5921098">b</span><span class="op" id="5921099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921102">case</span>&nbsp;<span class="ident" id="5921107">xBinary</span><span class="op" id="5921114">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921118">err</span>&nbsp;<span class="op" id="5921122">=</span>&nbsp;<span class="ident" id="5921124">value</span><span class="op" id="5921129">.</span><span class="ident" id="5921130">Interface</span><span class="op" id="5921139">(</span><span class="op" id="5921140">)</span><span class="op" id="5921141">.</span><span class="op" id="5921142">(</span><span class="ident" id="5921143">encoding</span><span class="op" id="5921151">.</span><span class="ident" id="5921152">BinaryUnmarshaler</span><span class="op" id="5921169">)</span><span class="op" id="5921170">.</span><span class="ident" id="5921171">UnmarshalBinary</span><span class="op" id="5921186">(</span><span class="ident" id="5921187">b</span><span class="op" id="5921188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921191">case</span>&nbsp;<span class="ident" id="5921196">xText</span><span class="op" id="5921201">:</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921205">err</span>&nbsp;<span class="op" id="5921209">=</span>&nbsp;<span class="ident" id="5921211">value</span><span class="op" id="5921216">.</span><span class="ident" id="5921217">Interface</span><span class="op" id="5921226">(</span><span class="op" id="5921227">)</span><span class="op" id="5921228">.</span><span class="op" id="5921229">(</span><span class="ident" id="5921230">encoding</span><span class="op" id="5921238">.</span><span class="ident" id="5921239">TextUnmarshaler</span><span class="op" id="5921254">)</span><span class="op" id="5921255">.</span><span class="ident" id="5921256">UnmarshalText</span><span class="op" id="5921269">(</span><span class="ident" id="5921270">b</span><span class="op" id="5921271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921277">if</span>&nbsp;<span class="ident" id="5921280">err</span>&nbsp;<span class="op" id="5921284">!=</span>&nbsp;<span class="ident" id="5921287">nil</span>&nbsp;<span class="op" id="5921291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921295">error_</span><span class="op" id="5921301">(</span><span class="ident" id="5921302">err</span><span class="op" id="5921305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921308">}</span><br>
<span class="lineno">715</span><span class="op" id="5921310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5921313">//&nbsp;ignoreGobDecoder&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;GobDecoder&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5921395">func</span>&nbsp;<span class="op" id="5921400">(</span><span class="ident" id="5921401">dec</span>&nbsp;<span class="op" id="5921405">*</span><span class="ident" id="5921406">Decoder</span><span class="op" id="5921413">)</span>&nbsp;<span class="ident" id="5921415">ignoreGobDecoder</span><span class="op" id="5921431">(</span><span class="ident" id="5921432">state</span>&nbsp;<span class="op" id="5921438">*</span><span class="ident" id="5921439">decoderState</span><span class="op" id="5921451">)</span>&nbsp;<span class="op" id="5921453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921456">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921490">b</span>&nbsp;<span class="op" id="5921492">:=</span>&nbsp;<span class="builtinfunc" id="5921495">make</span><span class="op" id="5921499">(</span><span class="op" id="5921500">[</span><span class="op" id="5921501">]</span><span class="builtintype" id="5921502">byte</span><span class="op" id="5921506">,</span>&nbsp;<span class="ident" id="5921508">state</span><span class="op" id="5921513">.</span><span class="ident" id="5921514">decodeUint</span><span class="op" id="5921524">(</span><span class="op" id="5921525">)</span><span class="op" id="5921526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921529">_</span><span class="op" id="5921530">,</span>&nbsp;<span class="ident" id="5921532">err</span>&nbsp;<span class="op" id="5921536">:=</span>&nbsp;<span class="ident" id="5921539">state</span><span class="op" id="5921544">.</span><span class="ident" id="5921545">b</span><span class="op" id="5921546">.</span><span class="ident" id="5921547">Read</span><span class="op" id="5921551">(</span><span class="ident" id="5921552">b</span><span class="op" id="5921553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921556">if</span>&nbsp;<span class="ident" id="5921559">err</span>&nbsp;<span class="op" id="5921563">!=</span>&nbsp;<span class="ident" id="5921566">nil</span>&nbsp;<span class="op" id="5921570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921574">error_</span><span class="op" id="5921580">(</span><span class="ident" id="5921581">err</span><span class="op" id="5921584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921587">}</span><br>
<span class="lineno">725</span><span class="op" id="5921589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5921592">//&nbsp;Index&nbsp;by&nbsp;Go&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="5921614">var</span>&nbsp;<span class="ident" id="5921618">decOpTable</span>&nbsp;<span class="op" id="5921629">=</span>&nbsp;<span class="op" id="5921631">[</span><span class="op" id="5921632">...</span><span class="op" id="5921635">]</span><span class="ident" id="5921636">decOp</span><span class="op" id="5921641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921644">reflect</span><span class="op" id="5921651">.</span><span class="ident" id="5921652">Bool</span><span class="op" id="5921656">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921664">decBool</span><span class="op" id="5921671">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921674">reflect</span><span class="op" id="5921681">.</span><span class="ident" id="5921682">Int8</span><span class="op" id="5921686">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921694">decInt8</span><span class="op" id="5921701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921704">reflect</span><span class="op" id="5921711">.</span><span class="ident" id="5921712">Int16</span><span class="op" id="5921717">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921724">decInt16</span><span class="op" id="5921732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921735">reflect</span><span class="op" id="5921742">.</span><span class="ident" id="5921743">Int32</span><span class="op" id="5921748">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921755">decInt32</span><span class="op" id="5921763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921766">reflect</span><span class="op" id="5921773">.</span><span class="ident" id="5921774">Int64</span><span class="op" id="5921779">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921786">decInt64</span><span class="op" id="5921794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921797">reflect</span><span class="op" id="5921804">.</span><span class="ident" id="5921805">Uint8</span><span class="op" id="5921810">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921817">decUint8</span><span class="op" id="5921825">,</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921828">reflect</span><span class="op" id="5921835">.</span><span class="ident" id="5921836">Uint16</span><span class="op" id="5921842">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921848">decUint16</span><span class="op" id="5921857">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921860">reflect</span><span class="op" id="5921867">.</span><span class="ident" id="5921868">Uint32</span><span class="op" id="5921874">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921880">decUint32</span><span class="op" id="5921889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921892">reflect</span><span class="op" id="5921899">.</span><span class="ident" id="5921900">Uint64</span><span class="op" id="5921906">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921912">decUint64</span><span class="op" id="5921921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921924">reflect</span><span class="op" id="5921931">.</span><span class="ident" id="5921932">Float32</span><span class="op" id="5921939">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921944">decFloat32</span><span class="op" id="5921954">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921957">reflect</span><span class="op" id="5921964">.</span><span class="ident" id="5921965">Float64</span><span class="op" id="5921972">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921977">decFloat64</span><span class="op" id="5921987">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921990">reflect</span><span class="op" id="5921997">.</span><span class="ident" id="5921998">Complex64</span><span class="op" id="5922007">:</span>&nbsp;&nbsp;<span class="ident" id="5922010">decComplex64</span><span class="op" id="5922022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922025">reflect</span><span class="op" id="5922032">.</span><span class="ident" id="5922033">Complex128</span><span class="op" id="5922043">:</span>&nbsp;<span class="ident" id="5922045">decComplex128</span><span class="op" id="5922058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922061">reflect</span><span class="op" id="5922068">.</span><span class="ident" id="5922069">String</span><span class="op" id="5922075">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922081">decString</span><span class="op" id="5922090">,</span><br>
<span class="lineno"></span><span class="op" id="5922092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">745</span><span class="comment" id="5922095">//&nbsp;Indexed&nbsp;by&nbsp;gob&nbsp;types.&nbsp;&nbsp;tComplex&nbsp;will&nbsp;be&nbsp;added&nbsp;during&nbsp;type.init().</span><br>
<span class="lineno"></span><span class="keyword" id="5922164">var</span>&nbsp;<span class="ident" id="5922168">decIgnoreOpMap</span>&nbsp;<span class="op" id="5922183">=</span>&nbsp;<span class="keyword" id="5922185">map</span><span class="op" id="5922188">[</span><span class="ident" id="5922189">typeId</span><span class="op" id="5922195">]</span><span class="ident" id="5922196">decOp</span><span class="op" id="5922201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922204">tBool</span><span class="op" id="5922209">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922214">ignoreUint</span><span class="op" id="5922224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922227">tInt</span><span class="op" id="5922231">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922237">ignoreUint</span><span class="op" id="5922247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922250">tUint</span><span class="op" id="5922255">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922260">ignoreUint</span><span class="op" id="5922270">,</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922273">tFloat</span><span class="op" id="5922279">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5922283">ignoreUint</span><span class="op" id="5922293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922296">tBytes</span><span class="op" id="5922302">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5922306">ignoreUint8Array</span><span class="op" id="5922322">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922325">tString</span><span class="op" id="5922332">:</span>&nbsp;&nbsp;<span class="ident" id="5922335">ignoreUint8Array</span><span class="op" id="5922351">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922354">tComplex</span><span class="op" id="5922362">:</span>&nbsp;<span class="ident" id="5922364">ignoreTwoUints</span><span class="op" id="5922378">,</span><br>
<span class="lineno"></span><span class="op" id="5922380">}</span><br>
<span class="lineno">755</span><br>
<span class="lineno"></span><span class="comment" id="5922383">//&nbsp;decOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;the&nbsp;base&nbsp;type&nbsp;under&nbsp;rt&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5922450">//&nbsp;the&nbsp;indirection&nbsp;count&nbsp;to&nbsp;reach&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5922488">func</span>&nbsp;<span class="op" id="5922493">(</span><span class="ident" id="5922494">dec</span>&nbsp;<span class="op" id="5922498">*</span><span class="ident" id="5922499">Decoder</span><span class="op" id="5922506">)</span>&nbsp;<span class="ident" id="5922508">decOpFor</span><span class="op" id="5922516">(</span><span class="ident" id="5922517">wireId</span>&nbsp;<span class="ident" id="5922524">typeId</span><span class="op" id="5922530">,</span>&nbsp;<span class="ident" id="5922532">rt</span>&nbsp;<span class="ident" id="5922535">reflect</span><span class="op" id="5922542">.</span><span class="ident" id="5922543">Type</span><span class="op" id="5922547">,</span>&nbsp;<span class="ident" id="5922549">name</span>&nbsp;<span class="builtintype" id="5922554">string</span><span class="op" id="5922560">,</span>&nbsp;<span class="ident" id="5922562">inProgress</span>&nbsp;<span class="keyword" id="5922573">map</span><span class="op" id="5922576">[</span><span class="ident" id="5922577">reflect</span><span class="op" id="5922584">.</span><span class="ident" id="5922585">Type</span><span class="op" id="5922589">]</span><span class="op" id="5922590">*</span><span class="ident" id="5922591">decOp</span><span class="op" id="5922596">)</span>&nbsp;<span class="op" id="5922598">*</span><span class="ident" id="5922599">decOp</span>&nbsp;<span class="op" id="5922605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922608">ut</span>&nbsp;<span class="op" id="5922611">:=</span>&nbsp;<span class="ident" id="5922614">userType</span><span class="op" id="5922622">(</span><span class="ident" id="5922623">rt</span><span class="op" id="5922625">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922628">//&nbsp;If&nbsp;the&nbsp;type&nbsp;implements&nbsp;GobEncoder,&nbsp;we&nbsp;handle&nbsp;it&nbsp;without&nbsp;further&nbsp;processing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922708">if</span>&nbsp;<span class="ident" id="5922711">ut</span><span class="op" id="5922713">.</span><span class="ident" id="5922714">externalDec</span>&nbsp;<span class="op" id="5922726">!=</span>&nbsp;<span class="num" id="5922729">0</span>&nbsp;<span class="op" id="5922731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922735">return</span>&nbsp;<span class="ident" id="5922742">dec</span><span class="op" id="5922745">.</span><span class="ident" id="5922746">gobDecodeOpFor</span><span class="op" id="5922760">(</span><span class="ident" id="5922761">ut</span><span class="op" id="5922763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922770">//&nbsp;If&nbsp;this&nbsp;type&nbsp;is&nbsp;already&nbsp;in&nbsp;progress,&nbsp;it&#39;s&nbsp;a&nbsp;recursive&nbsp;type&nbsp;(e.g.&nbsp;map[string]*T).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922855">//&nbsp;Return&nbsp;the&nbsp;pointer&nbsp;to&nbsp;the&nbsp;op&nbsp;we&#39;re&nbsp;already&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922912">if</span>&nbsp;<span class="ident" id="5922915">opPtr</span>&nbsp;<span class="op" id="5922921">:=</span>&nbsp;<span class="ident" id="5922924">inProgress</span><span class="op" id="5922934">[</span><span class="ident" id="5922935">rt</span><span class="op" id="5922937">]</span><span class="op" id="5922938">;</span>&nbsp;<span class="ident" id="5922940">opPtr</span>&nbsp;<span class="op" id="5922946">!=</span>&nbsp;<span class="ident" id="5922949">nil</span>&nbsp;<span class="op" id="5922953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922957">return</span>&nbsp;<span class="ident" id="5922964">opPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922971">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922974">typ</span>&nbsp;<span class="op" id="5922978">:=</span>&nbsp;<span class="ident" id="5922981">ut</span><span class="op" id="5922983">.</span><span class="ident" id="5922984">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922990">var</span>&nbsp;<span class="ident" id="5922994">op</span>&nbsp;<span class="ident" id="5922997">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923004">k</span>&nbsp;<span class="op" id="5923006">:=</span>&nbsp;<span class="ident" id="5923009">typ</span><span class="op" id="5923012">.</span><span class="ident" id="5923013">Kind</span><span class="op" id="5923017">(</span><span class="op" id="5923018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923021">if</span>&nbsp;<span class="builtintype" id="5923024">int</span><span class="op" id="5923027">(</span><span class="ident" id="5923028">k</span><span class="op" id="5923029">)</span>&nbsp;<span class="op" id="5923031">&lt;</span>&nbsp;<span class="builtinfunc" id="5923033">len</span><span class="op" id="5923036">(</span><span class="ident" id="5923037">decOpTable</span><span class="op" id="5923047">)</span>&nbsp;<span class="op" id="5923049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923053">op</span>&nbsp;<span class="op" id="5923056">=</span>&nbsp;<span class="ident" id="5923058">decOpTable</span><span class="op" id="5923068">[</span><span class="ident" id="5923069">k</span><span class="op" id="5923070">]</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923076">if</span>&nbsp;<span class="ident" id="5923079">op</span>&nbsp;<span class="op" id="5923082">==</span>&nbsp;<span class="ident" id="5923085">nil</span>&nbsp;<span class="op" id="5923089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923093">inProgress</span><span class="op" id="5923103">[</span><span class="ident" id="5923104">rt</span><span class="op" id="5923106">]</span>&nbsp;<span class="op" id="5923108">=</span>&nbsp;<span class="op" id="5923110">&amp;</span><span class="ident" id="5923111">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923116">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923135">switch</span>&nbsp;<span class="ident" id="5923142">t</span>&nbsp;<span class="op" id="5923144">:=</span>&nbsp;<span class="ident" id="5923147">typ</span><span class="op" id="5923150">;</span>&nbsp;<span class="ident" id="5923152">t</span><span class="op" id="5923153">.</span><span class="ident" id="5923154">Kind</span><span class="op" id="5923158">(</span><span class="op" id="5923159">)</span>&nbsp;<span class="op" id="5923161">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923165">case</span>&nbsp;<span class="ident" id="5923170">reflect</span><span class="op" id="5923177">.</span><span class="ident" id="5923178">Array</span><span class="op" id="5923183">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923188">name</span>&nbsp;<span class="op" id="5923193">=</span>&nbsp;<span class="string" id="5923195">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="5923209">+</span>&nbsp;<span class="ident" id="5923211">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923219">elemId</span>&nbsp;<span class="op" id="5923226">:=</span>&nbsp;<span class="ident" id="5923229">dec</span><span class="op" id="5923232">.</span><span class="ident" id="5923233">wireType</span><span class="op" id="5923241">[</span><span class="ident" id="5923242">wireId</span><span class="op" id="5923248">]</span><span class="op" id="5923249">.</span><span class="ident" id="5923250">ArrayT</span><span class="op" id="5923256">.</span><span class="ident" id="5923257">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923265">elemOp</span>&nbsp;<span class="op" id="5923272">:=</span>&nbsp;<span class="ident" id="5923275">dec</span><span class="op" id="5923278">.</span><span class="ident" id="5923279">decOpFor</span><span class="op" id="5923287">(</span><span class="ident" id="5923288">elemId</span><span class="op" id="5923294">,</span>&nbsp;<span class="ident" id="5923296">t</span><span class="op" id="5923297">.</span><span class="ident" id="5923298">Elem</span><span class="op" id="5923302">(</span><span class="op" id="5923303">)</span><span class="op" id="5923304">,</span>&nbsp;<span class="ident" id="5923306">name</span><span class="op" id="5923310">,</span>&nbsp;<span class="ident" id="5923312">inProgress</span><span class="op" id="5923322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923327">ovfl</span>&nbsp;<span class="op" id="5923332">:=</span>&nbsp;<span class="ident" id="5923335">overflow</span><span class="op" id="5923343">(</span><span class="ident" id="5923344">name</span><span class="op" id="5923348">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923353">helper</span>&nbsp;<span class="op" id="5923360">:=</span>&nbsp;<span class="ident" id="5923363">decArrayHelper</span><span class="op" id="5923377">[</span><span class="ident" id="5923378">t</span><span class="op" id="5923379">.</span><span class="ident" id="5923380">Elem</span><span class="op" id="5923384">(</span><span class="op" id="5923385">)</span><span class="op" id="5923386">.</span><span class="ident" id="5923387">Kind</span><span class="op" id="5923391">(</span><span class="op" id="5923392">)</span><span class="op" id="5923393">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923398">op</span>&nbsp;<span class="op" id="5923401">=</span>&nbsp;<span class="keyword" id="5923403">func</span><span class="op" id="5923407">(</span><span class="ident" id="5923408">i</span>&nbsp;<span class="op" id="5923410">*</span><span class="ident" id="5923411">decInstr</span><span class="op" id="5923419">,</span>&nbsp;<span class="ident" id="5923421">state</span>&nbsp;<span class="op" id="5923427">*</span><span class="ident" id="5923428">decoderState</span><span class="op" id="5923440">,</span>&nbsp;<span class="ident" id="5923442">value</span>&nbsp;<span class="ident" id="5923448">reflect</span><span class="op" id="5923455">.</span><span class="ident" id="5923456">Value</span><span class="op" id="5923461">)</span>&nbsp;<span class="op" id="5923463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923469">state</span><span class="op" id="5923474">.</span><span class="ident" id="5923475">dec</span><span class="op" id="5923478">.</span><span class="ident" id="5923479">decodeArray</span><span class="op" id="5923490">(</span><span class="ident" id="5923491">t</span><span class="op" id="5923492">,</span>&nbsp;<span class="ident" id="5923494">state</span><span class="op" id="5923499">,</span>&nbsp;<span class="ident" id="5923501">value</span><span class="op" id="5923506">,</span>&nbsp;<span class="op" id="5923508">*</span><span class="ident" id="5923509">elemOp</span><span class="op" id="5923515">,</span>&nbsp;<span class="ident" id="5923517">t</span><span class="op" id="5923518">.</span><span class="ident" id="5923519">Len</span><span class="op" id="5923522">(</span><span class="op" id="5923523">)</span><span class="op" id="5923524">,</span>&nbsp;<span class="ident" id="5923526">ovfl</span><span class="op" id="5923530">,</span>&nbsp;<span class="ident" id="5923532">helper</span><span class="op" id="5923538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923548">case</span>&nbsp;<span class="ident" id="5923553">reflect</span><span class="op" id="5923560">.</span><span class="ident" id="5923561">Map</span><span class="op" id="5923564">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923569">keyId</span>&nbsp;<span class="op" id="5923575">:=</span>&nbsp;<span class="ident" id="5923578">dec</span><span class="op" id="5923581">.</span><span class="ident" id="5923582">wireType</span><span class="op" id="5923590">[</span><span class="ident" id="5923591">wireId</span><span class="op" id="5923597">]</span><span class="op" id="5923598">.</span><span class="ident" id="5923599">MapT</span><span class="op" id="5923603">.</span><span class="ident" id="5923604">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923611">elemId</span>&nbsp;<span class="op" id="5923618">:=</span>&nbsp;<span class="ident" id="5923621">dec</span><span class="op" id="5923624">.</span><span class="ident" id="5923625">wireType</span><span class="op" id="5923633">[</span><span class="ident" id="5923634">wireId</span><span class="op" id="5923640">]</span><span class="op" id="5923641">.</span><span class="ident" id="5923642">MapT</span><span class="op" id="5923646">.</span><span class="ident" id="5923647">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923655">keyOp</span>&nbsp;<span class="op" id="5923661">:=</span>&nbsp;<span class="ident" id="5923664">dec</span><span class="op" id="5923667">.</span><span class="ident" id="5923668">decOpFor</span><span class="op" id="5923676">(</span><span class="ident" id="5923677">keyId</span><span class="op" id="5923682">,</span>&nbsp;<span class="ident" id="5923684">t</span><span class="op" id="5923685">.</span><span class="ident" id="5923686">Key</span><span class="op" id="5923689">(</span><span class="op" id="5923690">)</span><span class="op" id="5923691">,</span>&nbsp;<span class="string" id="5923693">&#34;key&nbsp;of&nbsp;&#34;</span><span class="op" id="5923702">+</span><span class="ident" id="5923703">name</span><span class="op" id="5923707">,</span>&nbsp;<span class="ident" id="5923709">inProgress</span><span class="op" id="5923719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923724">elemOp</span>&nbsp;<span class="op" id="5923731">:=</span>&nbsp;<span class="ident" id="5923734">dec</span><span class="op" id="5923737">.</span><span class="ident" id="5923738">decOpFor</span><span class="op" id="5923746">(</span><span class="ident" id="5923747">elemId</span><span class="op" id="5923753">,</span>&nbsp;<span class="ident" id="5923755">t</span><span class="op" id="5923756">.</span><span class="ident" id="5923757">Elem</span><span class="op" id="5923761">(</span><span class="op" id="5923762">)</span><span class="op" id="5923763">,</span>&nbsp;<span class="string" id="5923765">&#34;element&nbsp;of&nbsp;&#34;</span><span class="op" id="5923778">+</span><span class="ident" id="5923779">name</span><span class="op" id="5923783">,</span>&nbsp;<span class="ident" id="5923785">inProgress</span><span class="op" id="5923795">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923800">ovfl</span>&nbsp;<span class="op" id="5923805">:=</span>&nbsp;<span class="ident" id="5923808">overflow</span><span class="op" id="5923816">(</span><span class="ident" id="5923817">name</span><span class="op" id="5923821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923826">op</span>&nbsp;<span class="op" id="5923829">=</span>&nbsp;<span class="keyword" id="5923831">func</span><span class="op" id="5923835">(</span><span class="ident" id="5923836">i</span>&nbsp;<span class="op" id="5923838">*</span><span class="ident" id="5923839">decInstr</span><span class="op" id="5923847">,</span>&nbsp;<span class="ident" id="5923849">state</span>&nbsp;<span class="op" id="5923855">*</span><span class="ident" id="5923856">decoderState</span><span class="op" id="5923868">,</span>&nbsp;<span class="ident" id="5923870">value</span>&nbsp;<span class="ident" id="5923876">reflect</span><span class="op" id="5923883">.</span><span class="ident" id="5923884">Value</span><span class="op" id="5923889">)</span>&nbsp;<span class="op" id="5923891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923897">state</span><span class="op" id="5923902">.</span><span class="ident" id="5923903">dec</span><span class="op" id="5923906">.</span><span class="ident" id="5923907">decodeMap</span><span class="op" id="5923916">(</span><span class="ident" id="5923917">t</span><span class="op" id="5923918">,</span>&nbsp;<span class="ident" id="5923920">state</span><span class="op" id="5923925">,</span>&nbsp;<span class="ident" id="5923927">value</span><span class="op" id="5923932">,</span>&nbsp;<span class="op" id="5923934">*</span><span class="ident" id="5923935">keyOp</span><span class="op" id="5923940">,</span>&nbsp;<span class="op" id="5923942">*</span><span class="ident" id="5923943">elemOp</span><span class="op" id="5923949">,</span>&nbsp;<span class="ident" id="5923951">ovfl</span><span class="op" id="5923955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923965">case</span>&nbsp;<span class="ident" id="5923970">reflect</span><span class="op" id="5923977">.</span><span class="ident" id="5923978">Slice</span><span class="op" id="5923983">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923988">name</span>&nbsp;<span class="op" id="5923993">=</span>&nbsp;<span class="string" id="5923995">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="5924009">+</span>&nbsp;<span class="ident" id="5924011">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924019">if</span>&nbsp;<span class="ident" id="5924022">t</span><span class="op" id="5924023">.</span><span class="ident" id="5924024">Elem</span><span class="op" id="5924028">(</span><span class="op" id="5924029">)</span><span class="op" id="5924030">.</span><span class="ident" id="5924031">Kind</span><span class="op" id="5924035">(</span><span class="op" id="5924036">)</span>&nbsp;<span class="op" id="5924038">==</span>&nbsp;<span class="ident" id="5924041">reflect</span><span class="op" id="5924048">.</span><span class="ident" id="5924049">Uint8</span>&nbsp;<span class="op" id="5924055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924061">op</span>&nbsp;<span class="op" id="5924064">=</span>&nbsp;<span class="ident" id="5924066">decUint8Slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924084">break</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924098">var</span>&nbsp;<span class="ident" id="5924102">elemId</span>&nbsp;<span class="ident" id="5924109">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924119">if</span>&nbsp;<span class="ident" id="5924122">tt</span><span class="op" id="5924124">,</span>&nbsp;<span class="ident" id="5924126">ok</span>&nbsp;<span class="op" id="5924129">:=</span>&nbsp;<span class="ident" id="5924132">builtinIdToType</span><span class="op" id="5924147">[</span><span class="ident" id="5924148">wireId</span><span class="op" id="5924154">]</span><span class="op" id="5924155">;</span>&nbsp;<span class="ident" id="5924157">ok</span>&nbsp;<span class="op" id="5924160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924166">elemId</span>&nbsp;<span class="op" id="5924173">=</span>&nbsp;<span class="ident" id="5924175">tt</span><span class="op" id="5924177">.</span><span class="op" id="5924178">(</span><span class="op" id="5924179">*</span><span class="ident" id="5924180">sliceType</span><span class="op" id="5924189">)</span><span class="op" id="5924190">.</span><span class="ident" id="5924191">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924199">}</span>&nbsp;<span class="keyword" id="5924201">else</span>&nbsp;<span class="op" id="5924206">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924212">elemId</span>&nbsp;<span class="op" id="5924219">=</span>&nbsp;<span class="ident" id="5924221">dec</span><span class="op" id="5924224">.</span><span class="ident" id="5924225">wireType</span><span class="op" id="5924233">[</span><span class="ident" id="5924234">wireId</span><span class="op" id="5924240">]</span><span class="op" id="5924241">.</span><span class="ident" id="5924242">SliceT</span><span class="op" id="5924248">.</span><span class="ident" id="5924249">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924262">elemOp</span>&nbsp;<span class="op" id="5924269">:=</span>&nbsp;<span class="ident" id="5924272">dec</span><span class="op" id="5924275">.</span><span class="ident" id="5924276">decOpFor</span><span class="op" id="5924284">(</span><span class="ident" id="5924285">elemId</span><span class="op" id="5924291">,</span>&nbsp;<span class="ident" id="5924293">t</span><span class="op" id="5924294">.</span><span class="ident" id="5924295">Elem</span><span class="op" id="5924299">(</span><span class="op" id="5924300">)</span><span class="op" id="5924301">,</span>&nbsp;<span class="ident" id="5924303">name</span><span class="op" id="5924307">,</span>&nbsp;<span class="ident" id="5924309">inProgress</span><span class="op" id="5924319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924324">ovfl</span>&nbsp;<span class="op" id="5924329">:=</span>&nbsp;<span class="ident" id="5924332">overflow</span><span class="op" id="5924340">(</span><span class="ident" id="5924341">name</span><span class="op" id="5924345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924350">helper</span>&nbsp;<span class="op" id="5924357">:=</span>&nbsp;<span class="ident" id="5924360">decSliceHelper</span><span class="op" id="5924374">[</span><span class="ident" id="5924375">t</span><span class="op" id="5924376">.</span><span class="ident" id="5924377">Elem</span><span class="op" id="5924381">(</span><span class="op" id="5924382">)</span><span class="op" id="5924383">.</span><span class="ident" id="5924384">Kind</span><span class="op" id="5924388">(</span><span class="op" id="5924389">)</span><span class="op" id="5924390">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924395">op</span>&nbsp;<span class="op" id="5924398">=</span>&nbsp;<span class="keyword" id="5924400">func</span><span class="op" id="5924404">(</span><span class="ident" id="5924405">i</span>&nbsp;<span class="op" id="5924407">*</span><span class="ident" id="5924408">decInstr</span><span class="op" id="5924416">,</span>&nbsp;<span class="ident" id="5924418">state</span>&nbsp;<span class="op" id="5924424">*</span><span class="ident" id="5924425">decoderState</span><span class="op" id="5924437">,</span>&nbsp;<span class="ident" id="5924439">value</span>&nbsp;<span class="ident" id="5924445">reflect</span><span class="op" id="5924452">.</span><span class="ident" id="5924453">Value</span><span class="op" id="5924458">)</span>&nbsp;<span class="op" id="5924460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924466">state</span><span class="op" id="5924471">.</span><span class="ident" id="5924472">dec</span><span class="op" id="5924475">.</span><span class="ident" id="5924476">decodeSlice</span><span class="op" id="5924487">(</span><span class="ident" id="5924488">state</span><span class="op" id="5924493">,</span>&nbsp;<span class="ident" id="5924495">value</span><span class="op" id="5924500">,</span>&nbsp;<span class="op" id="5924502">*</span><span class="ident" id="5924503">elemOp</span><span class="op" id="5924509">,</span>&nbsp;<span class="ident" id="5924511">ovfl</span><span class="op" id="5924515">,</span>&nbsp;<span class="ident" id="5924517">helper</span><span class="op" id="5924523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924533">case</span>&nbsp;<span class="ident" id="5924538">reflect</span><span class="op" id="5924545">.</span><span class="ident" id="5924546">Struct</span><span class="op" id="5924552">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5924557">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924632">ut</span>&nbsp;<span class="op" id="5924635">:=</span>&nbsp;<span class="ident" id="5924638">userType</span><span class="op" id="5924646">(</span><span class="ident" id="5924647">typ</span><span class="op" id="5924650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924655">enginePtr</span><span class="op" id="5924664">,</span>&nbsp;<span class="ident" id="5924666">err</span>&nbsp;<span class="op" id="5924670">:=</span>&nbsp;<span class="ident" id="5924673">dec</span><span class="op" id="5924676">.</span><span class="ident" id="5924677">getDecEnginePtr</span><span class="op" id="5924692">(</span><span class="ident" id="5924693">wireId</span><span class="op" id="5924699">,</span>&nbsp;<span class="ident" id="5924701">ut</span><span class="op" id="5924703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924708">if</span>&nbsp;<span class="ident" id="5924711">err</span>&nbsp;<span class="op" id="5924715">!=</span>&nbsp;<span class="ident" id="5924718">nil</span>&nbsp;<span class="op" id="5924722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924728">error_</span><span class="op" id="5924734">(</span><span class="ident" id="5924735">err</span><span class="op" id="5924738">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924748">op</span>&nbsp;<span class="op" id="5924751">=</span>&nbsp;<span class="keyword" id="5924753">func</span><span class="op" id="5924757">(</span><span class="ident" id="5924758">i</span>&nbsp;<span class="op" id="5924760">*</span><span class="ident" id="5924761">decInstr</span><span class="op" id="5924769">,</span>&nbsp;<span class="ident" id="5924771">state</span>&nbsp;<span class="op" id="5924777">*</span><span class="ident" id="5924778">decoderState</span><span class="op" id="5924790">,</span>&nbsp;<span class="ident" id="5924792">value</span>&nbsp;<span class="ident" id="5924798">reflect</span><span class="op" id="5924805">.</span><span class="ident" id="5924806">Value</span><span class="op" id="5924811">)</span>&nbsp;<span class="op" id="5924813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5924819">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924896">dec</span><span class="op" id="5924899">.</span><span class="ident" id="5924900">decodeStruct</span><span class="op" id="5924912">(</span><span class="op" id="5924913">*</span><span class="ident" id="5924914">enginePtr</span><span class="op" id="5924923">,</span>&nbsp;<span class="ident" id="5924925">ut</span><span class="op" id="5924927">,</span>&nbsp;<span class="ident" id="5924929">value</span><span class="op" id="5924934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924939">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924943">case</span>&nbsp;<span class="ident" id="5924948">reflect</span><span class="op" id="5924955">.</span><span class="ident" id="5924956">Interface</span><span class="op" id="5924965">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924970">op</span>&nbsp;<span class="op" id="5924973">=</span>&nbsp;<span class="keyword" id="5924975">func</span><span class="op" id="5924979">(</span><span class="ident" id="5924980">i</span>&nbsp;<span class="op" id="5924982">*</span><span class="ident" id="5924983">decInstr</span><span class="op" id="5924991">,</span>&nbsp;<span class="ident" id="5924993">state</span>&nbsp;<span class="op" id="5924999">*</span><span class="ident" id="5925000">decoderState</span><span class="op" id="5925012">,</span>&nbsp;<span class="ident" id="5925014">value</span>&nbsp;<span class="ident" id="5925020">reflect</span><span class="op" id="5925027">.</span><span class="ident" id="5925028">Value</span><span class="op" id="5925033">)</span>&nbsp;<span class="op" id="5925035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925041">state</span><span class="op" id="5925046">.</span><span class="ident" id="5925047">dec</span><span class="op" id="5925050">.</span><span class="ident" id="5925051">decodeInterface</span><span class="op" id="5925066">(</span><span class="ident" id="5925067">t</span><span class="op" id="5925068">,</span>&nbsp;<span class="ident" id="5925070">state</span><span class="op" id="5925075">,</span>&nbsp;<span class="ident" id="5925077">value</span><span class="op" id="5925082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925091">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925097">if</span>&nbsp;<span class="ident" id="5925100">op</span>&nbsp;<span class="op" id="5925103">==</span>&nbsp;<span class="ident" id="5925106">nil</span>&nbsp;<span class="op" id="5925110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925114">errorf</span><span class="op" id="5925120">(</span><span class="string" id="5925121">&#34;decode&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5925150">,</span>&nbsp;<span class="ident" id="5925152">rt</span><span class="op" id="5925154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925160">return</span>&nbsp;<span class="op" id="5925167">&amp;</span><span class="ident" id="5925168">op</span><br>
<span class="lineno">840</span><span class="op" id="5925171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5925174">//&nbsp;decIgnoreOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;a&nbsp;field&nbsp;that&nbsp;has&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5925253">func</span>&nbsp;<span class="op" id="5925258">(</span><span class="ident" id="5925259">dec</span>&nbsp;<span class="op" id="5925263">*</span><span class="ident" id="5925264">Decoder</span><span class="op" id="5925271">)</span>&nbsp;<span class="ident" id="5925273">decIgnoreOpFor</span><span class="op" id="5925287">(</span><span class="ident" id="5925288">wireId</span>&nbsp;<span class="ident" id="5925295">typeId</span><span class="op" id="5925301">)</span>&nbsp;<span class="ident" id="5925303">decOp</span>&nbsp;<span class="op" id="5925309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925312">op</span><span class="op" id="5925314">,</span>&nbsp;<span class="ident" id="5925316">ok</span>&nbsp;<span class="op" id="5925319">:=</span>&nbsp;<span class="ident" id="5925322">decIgnoreOpMap</span><span class="op" id="5925336">[</span><span class="ident" id="5925337">wireId</span><span class="op" id="5925343">]</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925346">if</span>&nbsp;<span class="op" id="5925349">!</span><span class="ident" id="5925350">ok</span>&nbsp;<span class="op" id="5925353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925357">if</span>&nbsp;<span class="ident" id="5925360">wireId</span>&nbsp;<span class="op" id="5925367">==</span>&nbsp;<span class="ident" id="5925370">tInterface</span>&nbsp;<span class="op" id="5925381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925386">//&nbsp;Special&nbsp;case&nbsp;because&nbsp;it&#39;s&nbsp;a&nbsp;method:&nbsp;the&nbsp;ignored&nbsp;item&nbsp;might</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925451">//&nbsp;define&nbsp;types&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;record&nbsp;their&nbsp;state&nbsp;in&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925520">op</span>&nbsp;<span class="op" id="5925523">=</span>&nbsp;<span class="keyword" id="5925525">func</span><span class="op" id="5925529">(</span><span class="ident" id="5925530">i</span>&nbsp;<span class="op" id="5925532">*</span><span class="ident" id="5925533">decInstr</span><span class="op" id="5925541">,</span>&nbsp;<span class="ident" id="5925543">state</span>&nbsp;<span class="op" id="5925549">*</span><span class="ident" id="5925550">decoderState</span><span class="op" id="5925562">,</span>&nbsp;<span class="ident" id="5925564">value</span>&nbsp;<span class="ident" id="5925570">reflect</span><span class="op" id="5925577">.</span><span class="ident" id="5925578">Value</span><span class="op" id="5925583">)</span>&nbsp;<span class="op" id="5925585">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925591">state</span><span class="op" id="5925596">.</span><span class="ident" id="5925597">dec</span><span class="op" id="5925600">.</span><span class="ident" id="5925601">ignoreInterface</span><span class="op" id="5925616">(</span><span class="ident" id="5925617">state</span><span class="op" id="5925622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925632">return</span>&nbsp;<span class="ident" id="5925639">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925648">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925667">wire</span>&nbsp;<span class="op" id="5925672">:=</span>&nbsp;<span class="ident" id="5925675">dec</span><span class="op" id="5925678">.</span><span class="ident" id="5925679">wireType</span><span class="op" id="5925687">[</span><span class="ident" id="5925688">wireId</span><span class="op" id="5925694">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925698">switch</span>&nbsp;<span class="op" id="5925705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925709">case</span>&nbsp;<span class="ident" id="5925714">wire</span>&nbsp;<span class="op" id="5925719">==</span>&nbsp;<span class="ident" id="5925722">nil</span><span class="op" id="5925725">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925730">errorf</span><span class="op" id="5925736">(</span><span class="string" id="5925737">&#34;bad&nbsp;data:&nbsp;undefined&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5925766">,</span>&nbsp;<span class="ident" id="5925768">wireId</span><span class="op" id="5925774">.</span><span class="builtintype" id="5925775">string</span><span class="op" id="5925781">(</span><span class="op" id="5925782">)</span><span class="op" id="5925783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925787">case</span>&nbsp;<span class="ident" id="5925792">wire</span><span class="op" id="5925796">.</span><span class="ident" id="5925797">ArrayT</span>&nbsp;<span class="op" id="5925804">!=</span>&nbsp;<span class="ident" id="5925807">nil</span><span class="op" id="5925810">:</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925815">elemId</span>&nbsp;<span class="op" id="5925822">:=</span>&nbsp;<span class="ident" id="5925825">wire</span><span class="op" id="5925829">.</span><span class="ident" id="5925830">ArrayT</span><span class="op" id="5925836">.</span><span class="ident" id="5925837">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925845">elemOp</span>&nbsp;<span class="op" id="5925852">:=</span>&nbsp;<span class="ident" id="5925855">dec</span><span class="op" id="5925858">.</span><span class="ident" id="5925859">decIgnoreOpFor</span><span class="op" id="5925873">(</span><span class="ident" id="5925874">elemId</span><span class="op" id="5925880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925885">op</span>&nbsp;<span class="op" id="5925888">=</span>&nbsp;<span class="keyword" id="5925890">func</span><span class="op" id="5925894">(</span><span class="ident" id="5925895">i</span>&nbsp;<span class="op" id="5925897">*</span><span class="ident" id="5925898">decInstr</span><span class="op" id="5925906">,</span>&nbsp;<span class="ident" id="5925908">state</span>&nbsp;<span class="op" id="5925914">*</span><span class="ident" id="5925915">decoderState</span><span class="op" id="5925927">,</span>&nbsp;<span class="ident" id="5925929">value</span>&nbsp;<span class="ident" id="5925935">reflect</span><span class="op" id="5925942">.</span><span class="ident" id="5925943">Value</span><span class="op" id="5925948">)</span>&nbsp;<span class="op" id="5925950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925956">state</span><span class="op" id="5925961">.</span><span class="ident" id="5925962">dec</span><span class="op" id="5925965">.</span><span class="ident" id="5925966">ignoreArray</span><span class="op" id="5925977">(</span><span class="ident" id="5925978">state</span><span class="op" id="5925983">,</span>&nbsp;<span class="ident" id="5925985">elemOp</span><span class="op" id="5925991">,</span>&nbsp;<span class="ident" id="5925993">wire</span><span class="op" id="5925997">.</span><span class="ident" id="5925998">ArrayT</span><span class="op" id="5926004">.</span><span class="ident" id="5926005">Len</span><span class="op" id="5926008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926013">}</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926018">case</span>&nbsp;<span class="ident" id="5926023">wire</span><span class="op" id="5926027">.</span><span class="ident" id="5926028">MapT</span>&nbsp;<span class="op" id="5926033">!=</span>&nbsp;<span class="ident" id="5926036">nil</span><span class="op" id="5926039">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926044">keyId</span>&nbsp;<span class="op" id="5926050">:=</span>&nbsp;<span class="ident" id="5926053">dec</span><span class="op" id="5926056">.</span><span class="ident" id="5926057">wireType</span><span class="op" id="5926065">[</span><span class="ident" id="5926066">wireId</span><span class="op" id="5926072">]</span><span class="op" id="5926073">.</span><span class="ident" id="5926074">MapT</span><span class="op" id="5926078">.</span><span class="ident" id="5926079">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926086">elemId</span>&nbsp;<span class="op" id="5926093">:=</span>&nbsp;<span class="ident" id="5926096">dec</span><span class="op" id="5926099">.</span><span class="ident" id="5926100">wireType</span><span class="op" id="5926108">[</span><span class="ident" id="5926109">wireId</span><span class="op" id="5926115">]</span><span class="op" id="5926116">.</span><span class="ident" id="5926117">MapT</span><span class="op" id="5926121">.</span><span class="ident" id="5926122">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926130">keyOp</span>&nbsp;<span class="op" id="5926136">:=</span>&nbsp;<span class="ident" id="5926139">dec</span><span class="op" id="5926142">.</span><span class="ident" id="5926143">decIgnoreOpFor</span><span class="op" id="5926157">(</span><span class="ident" id="5926158">keyId</span><span class="op" id="5926163">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926168">elemOp</span>&nbsp;<span class="op" id="5926175">:=</span>&nbsp;<span class="ident" id="5926178">dec</span><span class="op" id="5926181">.</span><span class="ident" id="5926182">decIgnoreOpFor</span><span class="op" id="5926196">(</span><span class="ident" id="5926197">elemId</span><span class="op" id="5926203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926208">op</span>&nbsp;<span class="op" id="5926211">=</span>&nbsp;<span class="keyword" id="5926213">func</span><span class="op" id="5926217">(</span><span class="ident" id="5926218">i</span>&nbsp;<span class="op" id="5926220">*</span><span class="ident" id="5926221">decInstr</span><span class="op" id="5926229">,</span>&nbsp;<span class="ident" id="5926231">state</span>&nbsp;<span class="op" id="5926237">*</span><span class="ident" id="5926238">decoderState</span><span class="op" id="5926250">,</span>&nbsp;<span class="ident" id="5926252">value</span>&nbsp;<span class="ident" id="5926258">reflect</span><span class="op" id="5926265">.</span><span class="ident" id="5926266">Value</span><span class="op" id="5926271">)</span>&nbsp;<span class="op" id="5926273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926279">state</span><span class="op" id="5926284">.</span><span class="ident" id="5926285">dec</span><span class="op" id="5926288">.</span><span class="ident" id="5926289">ignoreMap</span><span class="op" id="5926298">(</span><span class="ident" id="5926299">state</span><span class="op" id="5926304">,</span>&nbsp;<span class="ident" id="5926306">keyOp</span><span class="op" id="5926311">,</span>&nbsp;<span class="ident" id="5926313">elemOp</span><span class="op" id="5926319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926329">case</span>&nbsp;<span class="ident" id="5926334">wire</span><span class="op" id="5926338">.</span><span class="ident" id="5926339">SliceT</span>&nbsp;<span class="op" id="5926346">!=</span>&nbsp;<span class="ident" id="5926349">nil</span><span class="op" id="5926352">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926357">elemId</span>&nbsp;<span class="op" id="5926364">:=</span>&nbsp;<span class="ident" id="5926367">wire</span><span class="op" id="5926371">.</span><span class="ident" id="5926372">SliceT</span><span class="op" id="5926378">.</span><span class="ident" id="5926379">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926387">elemOp</span>&nbsp;<span class="op" id="5926394">:=</span>&nbsp;<span class="ident" id="5926397">dec</span><span class="op" id="5926400">.</span><span class="ident" id="5926401">decIgnoreOpFor</span><span class="op" id="5926415">(</span><span class="ident" id="5926416">elemId</span><span class="op" id="5926422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926427">op</span>&nbsp;<span class="op" id="5926430">=</span>&nbsp;<span class="keyword" id="5926432">func</span><span class="op" id="5926436">(</span><span class="ident" id="5926437">i</span>&nbsp;<span class="op" id="5926439">*</span><span class="ident" id="5926440">decInstr</span><span class="op" id="5926448">,</span>&nbsp;<span class="ident" id="5926450">state</span>&nbsp;<span class="op" id="5926456">*</span><span class="ident" id="5926457">decoderState</span><span class="op" id="5926469">,</span>&nbsp;<span class="ident" id="5926471">value</span>&nbsp;<span class="ident" id="5926477">reflect</span><span class="op" id="5926484">.</span><span class="ident" id="5926485">Value</span><span class="op" id="5926490">)</span>&nbsp;<span class="op" id="5926492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926498">state</span><span class="op" id="5926503">.</span><span class="ident" id="5926504">dec</span><span class="op" id="5926507">.</span><span class="ident" id="5926508">ignoreSlice</span><span class="op" id="5926519">(</span><span class="ident" id="5926520">state</span><span class="op" id="5926525">,</span>&nbsp;<span class="ident" id="5926527">elemOp</span><span class="op" id="5926533">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926543">case</span>&nbsp;<span class="ident" id="5926548">wire</span><span class="op" id="5926552">.</span><span class="ident" id="5926553">StructT</span>&nbsp;<span class="op" id="5926561">!=</span>&nbsp;<span class="ident" id="5926564">nil</span><span class="op" id="5926567">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926572">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926647">enginePtr</span><span class="op" id="5926656">,</span>&nbsp;<span class="ident" id="5926658">err</span>&nbsp;<span class="op" id="5926662">:=</span>&nbsp;<span class="ident" id="5926665">dec</span><span class="op" id="5926668">.</span><span class="ident" id="5926669">getIgnoreEnginePtr</span><span class="op" id="5926687">(</span><span class="ident" id="5926688">wireId</span><span class="op" id="5926694">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926699">if</span>&nbsp;<span class="ident" id="5926702">err</span>&nbsp;<span class="op" id="5926706">!=</span>&nbsp;<span class="ident" id="5926709">nil</span>&nbsp;<span class="op" id="5926713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926719">error_</span><span class="op" id="5926725">(</span><span class="ident" id="5926726">err</span><span class="op" id="5926729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926739">op</span>&nbsp;<span class="op" id="5926742">=</span>&nbsp;<span class="keyword" id="5926744">func</span><span class="op" id="5926748">(</span><span class="ident" id="5926749">i</span>&nbsp;<span class="op" id="5926751">*</span><span class="ident" id="5926752">decInstr</span><span class="op" id="5926760">,</span>&nbsp;<span class="ident" id="5926762">state</span>&nbsp;<span class="op" id="5926768">*</span><span class="ident" id="5926769">decoderState</span><span class="op" id="5926781">,</span>&nbsp;<span class="ident" id="5926783">value</span>&nbsp;<span class="ident" id="5926789">reflect</span><span class="op" id="5926796">.</span><span class="ident" id="5926797">Value</span><span class="op" id="5926802">)</span>&nbsp;<span class="op" id="5926804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926810">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926886">state</span><span class="op" id="5926891">.</span><span class="ident" id="5926892">dec</span><span class="op" id="5926895">.</span><span class="ident" id="5926896">ignoreStruct</span><span class="op" id="5926908">(</span><span class="op" id="5926909">*</span><span class="ident" id="5926910">enginePtr</span><span class="op" id="5926919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926929">case</span>&nbsp;<span class="ident" id="5926934">wire</span><span class="op" id="5926938">.</span><span class="ident" id="5926939">GobEncoderT</span>&nbsp;<span class="op" id="5926951">!=</span>&nbsp;<span class="ident" id="5926954">nil</span><span class="op" id="5926957">,</span>&nbsp;<span class="ident" id="5926959">wire</span><span class="op" id="5926963">.</span><span class="ident" id="5926964">BinaryMarshalerT</span>&nbsp;<span class="op" id="5926981">!=</span>&nbsp;<span class="ident" id="5926984">nil</span><span class="op" id="5926987">,</span>&nbsp;<span class="ident" id="5926989">wire</span><span class="op" id="5926993">.</span><span class="ident" id="5926994">TextMarshalerT</span>&nbsp;<span class="op" id="5927009">!=</span>&nbsp;<span class="ident" id="5927012">nil</span><span class="op" id="5927015">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927020">op</span>&nbsp;<span class="op" id="5927023">=</span>&nbsp;<span class="keyword" id="5927025">func</span><span class="op" id="5927029">(</span><span class="ident" id="5927030">i</span>&nbsp;<span class="op" id="5927032">*</span><span class="ident" id="5927033">decInstr</span><span class="op" id="5927041">,</span>&nbsp;<span class="ident" id="5927043">state</span>&nbsp;<span class="op" id="5927049">*</span><span class="ident" id="5927050">decoderState</span><span class="op" id="5927062">,</span>&nbsp;<span class="ident" id="5927064">value</span>&nbsp;<span class="ident" id="5927070">reflect</span><span class="op" id="5927077">.</span><span class="ident" id="5927078">Value</span><span class="op" id="5927083">)</span>&nbsp;<span class="op" id="5927085">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927091">state</span><span class="op" id="5927096">.</span><span class="ident" id="5927097">dec</span><span class="op" id="5927100">.</span><span class="ident" id="5927101">ignoreGobDecoder</span><span class="op" id="5927117">(</span><span class="ident" id="5927118">state</span><span class="op" id="5927123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927138">if</span>&nbsp;<span class="ident" id="5927141">op</span>&nbsp;<span class="op" id="5927144">==</span>&nbsp;<span class="ident" id="5927147">nil</span>&nbsp;<span class="op" id="5927151">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927155">errorf</span><span class="op" id="5927161">(</span><span class="string" id="5927162">&#34;bad&nbsp;data:&nbsp;ignore&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5927201">,</span>&nbsp;<span class="ident" id="5927203">wireId</span><span class="op" id="5927209">.</span><span class="builtintype" id="5927210">string</span><span class="op" id="5927216">(</span><span class="op" id="5927217">)</span><span class="op" id="5927218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927224">return</span>&nbsp;<span class="ident" id="5927231">op</span><br>
<span class="lineno"></span><span class="op" id="5927234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="5927237">//&nbsp;gobDecodeOpFor&nbsp;returns&nbsp;the&nbsp;op&nbsp;for&nbsp;a&nbsp;type&nbsp;that&nbsp;is&nbsp;known&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="5927308">//&nbsp;GobDecoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5927323">func</span>&nbsp;<span class="op" id="5927328">(</span><span class="ident" id="5927329">dec</span>&nbsp;<span class="op" id="5927333">*</span><span class="ident" id="5927334">Decoder</span><span class="op" id="5927341">)</span>&nbsp;<span class="ident" id="5927343">gobDecodeOpFor</span><span class="op" id="5927357">(</span><span class="ident" id="5927358">ut</span>&nbsp;<span class="op" id="5927361">*</span><span class="ident" id="5927362">userTypeInfo</span><span class="op" id="5927374">)</span>&nbsp;<span class="op" id="5927376">*</span><span class="ident" id="5927377">decOp</span>&nbsp;<span class="op" id="5927383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927386">rcvrType</span>&nbsp;<span class="op" id="5927395">:=</span>&nbsp;<span class="ident" id="5927398">ut</span><span class="op" id="5927400">.</span><span class="ident" id="5927401">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927407">if</span>&nbsp;<span class="ident" id="5927410">ut</span><span class="op" id="5927412">.</span><span class="ident" id="5927413">decIndir</span>&nbsp;<span class="op" id="5927422">==</span>&nbsp;<span class="op" id="5927425">-</span><span class="num" id="5927426">1</span>&nbsp;<span class="op" id="5927428">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927432">rcvrType</span>&nbsp;<span class="op" id="5927441">=</span>&nbsp;<span class="ident" id="5927443">reflect</span><span class="op" id="5927450">.</span><span class="ident" id="5927451">PtrTo</span><span class="op" id="5927456">(</span><span class="ident" id="5927457">rcvrType</span><span class="op" id="5927465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927468">}</span>&nbsp;<span class="keyword" id="5927470">else</span>&nbsp;<span class="keyword" id="5927475">if</span>&nbsp;<span class="ident" id="5927478">ut</span><span class="op" id="5927480">.</span><span class="ident" id="5927481">decIndir</span>&nbsp;<span class="op" id="5927490">&gt;</span>&nbsp;<span class="num" id="5927492">0</span>&nbsp;<span class="op" id="5927494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927498">for</span>&nbsp;<span class="ident" id="5927502">i</span>&nbsp;<span class="op" id="5927504">:=</span>&nbsp;<span class="builtintype" id="5927507">int8</span><span class="op" id="5927511">(</span><span class="num" id="5927512">0</span><span class="op" id="5927513">)</span><span class="op" id="5927514">;</span>&nbsp;<span class="ident" id="5927516">i</span>&nbsp;<span class="op" id="5927518">&lt;</span>&nbsp;<span class="ident" id="5927520">ut</span><span class="op" id="5927522">.</span><span class="ident" id="5927523">decIndir</span><span class="op" id="5927531">;</span>&nbsp;<span class="ident" id="5927533">i</span><span class="op" id="5927534">++</span>&nbsp;<span class="op" id="5927537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927542">rcvrType</span>&nbsp;<span class="op" id="5927551">=</span>&nbsp;<span class="ident" id="5927553">rcvrType</span><span class="op" id="5927561">.</span><span class="ident" id="5927562">Elem</span><span class="op" id="5927566">(</span><span class="op" id="5927567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927571">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927577">var</span>&nbsp;<span class="ident" id="5927581">op</span>&nbsp;<span class="ident" id="5927584">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927591">op</span>&nbsp;<span class="op" id="5927594">=</span>&nbsp;<span class="keyword" id="5927596">func</span><span class="op" id="5927600">(</span><span class="ident" id="5927601">i</span>&nbsp;<span class="op" id="5927603">*</span><span class="ident" id="5927604">decInstr</span><span class="op" id="5927612">,</span>&nbsp;<span class="ident" id="5927614">state</span>&nbsp;<span class="op" id="5927620">*</span><span class="ident" id="5927621">decoderState</span><span class="op" id="5927633">,</span>&nbsp;<span class="ident" id="5927635">value</span>&nbsp;<span class="ident" id="5927641">reflect</span><span class="op" id="5927648">.</span><span class="ident" id="5927649">Value</span><span class="op" id="5927654">)</span>&nbsp;<span class="op" id="5927656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5927660">//&nbsp;We&nbsp;now&nbsp;have&nbsp;the&nbsp;base&nbsp;type.&nbsp;We&nbsp;need&nbsp;its&nbsp;address&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927742">if</span>&nbsp;<span class="ident" id="5927745">value</span><span class="op" id="5927750">.</span><span class="ident" id="5927751">Kind</span><span class="op" id="5927755">(</span><span class="op" id="5927756">)</span>&nbsp;<span class="op" id="5927758">!=</span>&nbsp;<span class="ident" id="5927761">reflect</span><span class="op" id="5927768">.</span><span class="ident" id="5927769">Ptr</span>&nbsp;<span class="op" id="5927773">&amp;&amp;</span>&nbsp;<span class="ident" id="5927776">rcvrType</span><span class="op" id="5927784">.</span><span class="ident" id="5927785">Kind</span><span class="op" id="5927789">(</span><span class="op" id="5927790">)</span>&nbsp;<span class="op" id="5927792">==</span>&nbsp;<span class="ident" id="5927795">reflect</span><span class="op" id="5927802">.</span><span class="ident" id="5927803">Ptr</span>&nbsp;<span class="op" id="5927807">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927812">value</span>&nbsp;<span class="op" id="5927818">=</span>&nbsp;<span class="ident" id="5927820">value</span><span class="op" id="5927825">.</span><span class="ident" id="5927826">Addr</span><span class="op" id="5927830">(</span><span class="op" id="5927831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927839">state</span><span class="op" id="5927844">.</span><span class="ident" id="5927845">dec</span><span class="op" id="5927848">.</span><span class="ident" id="5927849">decodeGobDecoder</span><span class="op" id="5927865">(</span><span class="ident" id="5927866">ut</span><span class="op" id="5927868">,</span>&nbsp;<span class="ident" id="5927870">state</span><span class="op" id="5927875">,</span>&nbsp;<span class="ident" id="5927877">value</span><span class="op" id="5927882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927888">return</span>&nbsp;<span class="op" id="5927895">&amp;</span><span class="ident" id="5927896">op</span><br>
<span class="lineno">925</span><span class="op" id="5927899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5927902">//&nbsp;compatibleType&nbsp;asks:&nbsp;Are&nbsp;these&nbsp;two&nbsp;gob&nbsp;Types&nbsp;compatible?</span><br>
<span class="lineno"></span><span class="comment" id="5927962">//&nbsp;Answers&nbsp;the&nbsp;question&nbsp;for&nbsp;basic&nbsp;types,&nbsp;arrays,&nbsp;maps&nbsp;and&nbsp;slices,&nbsp;plus</span><br>
<span class="lineno"></span><span class="comment" id="5928033">//&nbsp;GobEncoder/Decoder&nbsp;pairs.</span><br>
<span class="lineno">930</span><span class="comment" id="5928062">//&nbsp;Structs&nbsp;are&nbsp;considered&nbsp;ok;&nbsp;fields&nbsp;will&nbsp;be&nbsp;checked&nbsp;later.</span><br>
<span class="lineno"></span><span class="keyword" id="5928122">func</span>&nbsp;<span class="op" id="5928127">(</span><span class="ident" id="5928128">dec</span>&nbsp;<span class="op" id="5928132">*</span><span class="ident" id="5928133">Decoder</span><span class="op" id="5928140">)</span>&nbsp;<span class="ident" id="5928142">compatibleType</span><span class="op" id="5928156">(</span><span class="ident" id="5928157">fr</span>&nbsp;<span class="ident" id="5928160">reflect</span><span class="op" id="5928167">.</span><span class="ident" id="5928168">Type</span><span class="op" id="5928172">,</span>&nbsp;<span class="ident" id="5928174">fw</span>&nbsp;<span class="ident" id="5928177">typeId</span><span class="op" id="5928183">,</span>&nbsp;<span class="ident" id="5928185">inProgress</span>&nbsp;<span class="keyword" id="5928196">map</span><span class="op" id="5928199">[</span><span class="ident" id="5928200">reflect</span><span class="op" id="5928207">.</span><span class="ident" id="5928208">Type</span><span class="op" id="5928212">]</span><span class="ident" id="5928213">typeId</span><span class="op" id="5928219">)</span>&nbsp;<span class="builtintype" id="5928221">bool</span>&nbsp;<span class="op" id="5928226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928229">if</span>&nbsp;<span class="ident" id="5928232">rhs</span><span class="op" id="5928235">,</span>&nbsp;<span class="ident" id="5928237">ok</span>&nbsp;<span class="op" id="5928240">:=</span>&nbsp;<span class="ident" id="5928243">inProgress</span><span class="op" id="5928253">[</span><span class="ident" id="5928254">fr</span><span class="op" id="5928256">]</span><span class="op" id="5928257">;</span>&nbsp;<span class="ident" id="5928259">ok</span>&nbsp;<span class="op" id="5928262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928266">return</span>&nbsp;<span class="ident" id="5928273">rhs</span>&nbsp;<span class="op" id="5928277">==</span>&nbsp;<span class="ident" id="5928280">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928284">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928287">inProgress</span><span class="op" id="5928297">[</span><span class="ident" id="5928298">fr</span><span class="op" id="5928300">]</span>&nbsp;<span class="op" id="5928302">=</span>&nbsp;<span class="ident" id="5928304">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928308">ut</span>&nbsp;<span class="op" id="5928311">:=</span>&nbsp;<span class="ident" id="5928314">userType</span><span class="op" id="5928322">(</span><span class="ident" id="5928323">fr</span><span class="op" id="5928325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928328">wire</span><span class="op" id="5928332">,</span>&nbsp;<span class="ident" id="5928334">ok</span>&nbsp;<span class="op" id="5928337">:=</span>&nbsp;<span class="ident" id="5928340">dec</span><span class="op" id="5928343">.</span><span class="ident" id="5928344">wireType</span><span class="op" id="5928352">[</span><span class="ident" id="5928353">fw</span><span class="op" id="5928355">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928358">//&nbsp;If&nbsp;wire&nbsp;was&nbsp;encoded&nbsp;with&nbsp;an&nbsp;encoding&nbsp;method,&nbsp;fr&nbsp;must&nbsp;have&nbsp;that&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928433">//&nbsp;And&nbsp;if&nbsp;not,&nbsp;it&nbsp;must&nbsp;not.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928462">//&nbsp;At&nbsp;most&nbsp;one&nbsp;of&nbsp;the&nbsp;booleans&nbsp;in&nbsp;ut&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928508">//&nbsp;We&nbsp;could&nbsp;possibly&nbsp;relax&nbsp;this&nbsp;constraint&nbsp;in&nbsp;the&nbsp;future&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928578">//&nbsp;choose&nbsp;the&nbsp;decoding&nbsp;method&nbsp;using&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;wireType.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928641">//&nbsp;The&nbsp;parentheses&nbsp;look&nbsp;odd&nbsp;but&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928687">if</span>&nbsp;<span class="op" id="5928690">(</span><span class="ident" id="5928691">ut</span><span class="op" id="5928693">.</span><span class="ident" id="5928694">externalDec</span>&nbsp;<span class="op" id="5928706">==</span>&nbsp;<span class="ident" id="5928709">xGob</span><span class="op" id="5928713">)</span>&nbsp;<span class="op" id="5928715">!=</span>&nbsp;<span class="op" id="5928718">(</span><span class="ident" id="5928719">ok</span>&nbsp;<span class="op" id="5928722">&amp;&amp;</span>&nbsp;<span class="ident" id="5928725">wire</span><span class="op" id="5928729">.</span><span class="ident" id="5928730">GobEncoderT</span>&nbsp;<span class="op" id="5928742">!=</span>&nbsp;<span class="ident" id="5928745">nil</span><span class="op" id="5928748">)</span>&nbsp;<span class="op" id="5928750">||</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928755">(</span><span class="ident" id="5928756">ut</span><span class="op" id="5928758">.</span><span class="ident" id="5928759">externalDec</span>&nbsp;<span class="op" id="5928771">==</span>&nbsp;<span class="ident" id="5928774">xBinary</span><span class="op" id="5928781">)</span>&nbsp;<span class="op" id="5928783">!=</span>&nbsp;<span class="op" id="5928786">(</span><span class="ident" id="5928787">ok</span>&nbsp;<span class="op" id="5928790">&amp;&amp;</span>&nbsp;<span class="ident" id="5928793">wire</span><span class="op" id="5928797">.</span><span class="ident" id="5928798">BinaryMarshalerT</span>&nbsp;<span class="op" id="5928815">!=</span>&nbsp;<span class="ident" id="5928818">nil</span><span class="op" id="5928821">)</span>&nbsp;<span class="op" id="5928823">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928828">(</span><span class="ident" id="5928829">ut</span><span class="op" id="5928831">.</span><span class="ident" id="5928832">externalDec</span>&nbsp;<span class="op" id="5928844">==</span>&nbsp;<span class="ident" id="5928847">xText</span><span class="op" id="5928852">)</span>&nbsp;<span class="op" id="5928854">!=</span>&nbsp;<span class="op" id="5928857">(</span><span class="ident" id="5928858">ok</span>&nbsp;<span class="op" id="5928861">&amp;&amp;</span>&nbsp;<span class="ident" id="5928864">wire</span><span class="op" id="5928868">.</span><span class="ident" id="5928869">TextMarshalerT</span>&nbsp;<span class="op" id="5928884">!=</span>&nbsp;<span class="ident" id="5928887">nil</span><span class="op" id="5928890">)</span>&nbsp;<span class="op" id="5928892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928896">return</span>&nbsp;<span class="builtintype" id="5928903">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928913">if</span>&nbsp;<span class="ident" id="5928916">ut</span><span class="op" id="5928918">.</span><span class="ident" id="5928919">externalDec</span>&nbsp;<span class="op" id="5928931">!=</span>&nbsp;<span class="num" id="5928934">0</span>&nbsp;<span class="op" id="5928936">{</span>&nbsp;<span class="comment" id="5928938">//&nbsp;This&nbsp;test&nbsp;trumps&nbsp;all&nbsp;others.</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928972">return</span>&nbsp;<span class="builtintype" id="5928979">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928988">switch</span>&nbsp;<span class="ident" id="5928995">t</span>&nbsp;<span class="op" id="5928997">:=</span>&nbsp;<span class="ident" id="5929000">ut</span><span class="op" id="5929002">.</span><span class="ident" id="5929003">base</span><span class="op" id="5929007">;</span>&nbsp;<span class="ident" id="5929009">t</span><span class="op" id="5929010">.</span><span class="ident" id="5929011">Kind</span><span class="op" id="5929015">(</span><span class="op" id="5929016">)</span>&nbsp;<span class="op" id="5929018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929021">default</span><span class="op" id="5929028">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5929032">//&nbsp;chan,&nbsp;etc:&nbsp;cannot&nbsp;handle.</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929063">return</span>&nbsp;<span class="builtintype" id="5929070">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929077">case</span>&nbsp;<span class="ident" id="5929082">reflect</span><span class="op" id="5929089">.</span><span class="ident" id="5929090">Bool</span><span class="op" id="5929094">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929098">return</span>&nbsp;<span class="ident" id="5929105">fw</span>&nbsp;<span class="op" id="5929108">==</span>&nbsp;<span class="ident" id="5929111">tBool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929118">case</span>&nbsp;<span class="ident" id="5929123">reflect</span><span class="op" id="5929130">.</span><span class="ident" id="5929131">Int</span><span class="op" id="5929134">,</span>&nbsp;<span class="ident" id="5929136">reflect</span><span class="op" id="5929143">.</span><span class="ident" id="5929144">Int8</span><span class="op" id="5929148">,</span>&nbsp;<span class="ident" id="5929150">reflect</span><span class="op" id="5929157">.</span><span class="ident" id="5929158">Int16</span><span class="op" id="5929163">,</span>&nbsp;<span class="ident" id="5929165">reflect</span><span class="op" id="5929172">.</span><span class="ident" id="5929173">Int32</span><span class="op" id="5929178">,</span>&nbsp;<span class="ident" id="5929180">reflect</span><span class="op" id="5929187">.</span><span class="ident" id="5929188">Int64</span><span class="op" id="5929193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929197">return</span>&nbsp;<span class="ident" id="5929204">fw</span>&nbsp;<span class="op" id="5929207">==</span>&nbsp;<span class="ident" id="5929210">tInt</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929216">case</span>&nbsp;<span class="ident" id="5929221">reflect</span><span class="op" id="5929228">.</span><span class="ident" id="5929229">Uint</span><span class="op" id="5929233">,</span>&nbsp;<span class="ident" id="5929235">reflect</span><span class="op" id="5929242">.</span><span class="ident" id="5929243">Uint8</span><span class="op" id="5929248">,</span>&nbsp;<span class="ident" id="5929250">reflect</span><span class="op" id="5929257">.</span><span class="ident" id="5929258">Uint16</span><span class="op" id="5929264">,</span>&nbsp;<span class="ident" id="5929266">reflect</span><span class="op" id="5929273">.</span><span class="ident" id="5929274">Uint32</span><span class="op" id="5929280">,</span>&nbsp;<span class="ident" id="5929282">reflect</span><span class="op" id="5929289">.</span><span class="ident" id="5929290">Uint64</span><span class="op" id="5929296">,</span>&nbsp;<span class="ident" id="5929298">reflect</span><span class="op" id="5929305">.</span><span class="ident" id="5929306">Uintptr</span><span class="op" id="5929313">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929317">return</span>&nbsp;<span class="ident" id="5929324">fw</span>&nbsp;<span class="op" id="5929327">==</span>&nbsp;<span class="ident" id="5929330">tUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929337">case</span>&nbsp;<span class="ident" id="5929342">reflect</span><span class="op" id="5929349">.</span><span class="ident" id="5929350">Float32</span><span class="op" id="5929357">,</span>&nbsp;<span class="ident" id="5929359">reflect</span><span class="op" id="5929366">.</span><span class="ident" id="5929367">Float64</span><span class="op" id="5929374">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929378">return</span>&nbsp;<span class="ident" id="5929385">fw</span>&nbsp;<span class="op" id="5929388">==</span>&nbsp;<span class="ident" id="5929391">tFloat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929399">case</span>&nbsp;<span class="ident" id="5929404">reflect</span><span class="op" id="5929411">.</span><span class="ident" id="5929412">Complex64</span><span class="op" id="5929421">,</span>&nbsp;<span class="ident" id="5929423">reflect</span><span class="op" id="5929430">.</span><span class="ident" id="5929431">Complex128</span><span class="op" id="5929441">:</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929445">return</span>&nbsp;<span class="ident" id="5929452">fw</span>&nbsp;<span class="op" id="5929455">==</span>&nbsp;<span class="ident" id="5929458">tComplex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929468">case</span>&nbsp;<span class="ident" id="5929473">reflect</span><span class="op" id="5929480">.</span><span class="ident" id="5929481">String</span><span class="op" id="5929487">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929491">return</span>&nbsp;<span class="ident" id="5929498">fw</span>&nbsp;<span class="op" id="5929501">==</span>&nbsp;<span class="ident" id="5929504">tString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929513">case</span>&nbsp;<span class="ident" id="5929518">reflect</span><span class="op" id="5929525">.</span><span class="ident" id="5929526">Interface</span><span class="op" id="5929535">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929539">return</span>&nbsp;<span class="ident" id="5929546">fw</span>&nbsp;<span class="op" id="5929549">==</span>&nbsp;<span class="ident" id="5929552">tInterface</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929564">case</span>&nbsp;<span class="ident" id="5929569">reflect</span><span class="op" id="5929576">.</span><span class="ident" id="5929577">Array</span><span class="op" id="5929582">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929586">if</span>&nbsp;<span class="op" id="5929589">!</span><span class="ident" id="5929590">ok</span>&nbsp;<span class="op" id="5929593">||</span>&nbsp;<span class="ident" id="5929596">wire</span><span class="op" id="5929600">.</span><span class="ident" id="5929601">ArrayT</span>&nbsp;<span class="op" id="5929608">==</span>&nbsp;<span class="ident" id="5929611">nil</span>&nbsp;<span class="op" id="5929615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929620">return</span>&nbsp;<span class="builtintype" id="5929627">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929639">array</span>&nbsp;<span class="op" id="5929645">:=</span>&nbsp;<span class="ident" id="5929648">wire</span><span class="op" id="5929652">.</span><span class="ident" id="5929653">ArrayT</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929662">return</span>&nbsp;<span class="ident" id="5929669">t</span><span class="op" id="5929670">.</span><span class="ident" id="5929671">Len</span><span class="op" id="5929674">(</span><span class="op" id="5929675">)</span>&nbsp;<span class="op" id="5929677">==</span>&nbsp;<span class="ident" id="5929680">array</span><span class="op" id="5929685">.</span><span class="ident" id="5929686">Len</span>&nbsp;<span class="op" id="5929690">&amp;&amp;</span>&nbsp;<span class="ident" id="5929693">dec</span><span class="op" id="5929696">.</span><span class="ident" id="5929697">compatibleType</span><span class="op" id="5929711">(</span><span class="ident" id="5929712">t</span><span class="op" id="5929713">.</span><span class="ident" id="5929714">Elem</span><span class="op" id="5929718">(</span><span class="op" id="5929719">)</span><span class="op" id="5929720">,</span>&nbsp;<span class="ident" id="5929722">array</span><span class="op" id="5929727">.</span><span class="ident" id="5929728">Elem</span><span class="op" id="5929732">,</span>&nbsp;<span class="ident" id="5929734">inProgress</span><span class="op" id="5929744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929747">case</span>&nbsp;<span class="ident" id="5929752">reflect</span><span class="op" id="5929759">.</span><span class="ident" id="5929760">Map</span><span class="op" id="5929763">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929767">if</span>&nbsp;<span class="op" id="5929770">!</span><span class="ident" id="5929771">ok</span>&nbsp;<span class="op" id="5929774">||</span>&nbsp;<span class="ident" id="5929777">wire</span><span class="op" id="5929781">.</span><span class="ident" id="5929782">MapT</span>&nbsp;<span class="op" id="5929787">==</span>&nbsp;<span class="ident" id="5929790">nil</span>&nbsp;<span class="op" id="5929794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929799">return</span>&nbsp;<span class="builtintype" id="5929806">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929814">}</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929818">MapType</span>&nbsp;<span class="op" id="5929826">:=</span>&nbsp;<span class="ident" id="5929829">wire</span><span class="op" id="5929833">.</span><span class="ident" id="5929834">MapT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929841">return</span>&nbsp;<span class="ident" id="5929848">dec</span><span class="op" id="5929851">.</span><span class="ident" id="5929852">compatibleType</span><span class="op" id="5929866">(</span><span class="ident" id="5929867">t</span><span class="op" id="5929868">.</span><span class="ident" id="5929869">Key</span><span class="op" id="5929872">(</span><span class="op" id="5929873">)</span><span class="op" id="5929874">,</span>&nbsp;<span class="ident" id="5929876">MapType</span><span class="op" id="5929883">.</span><span class="ident" id="5929884">Key</span><span class="op" id="5929887">,</span>&nbsp;<span class="ident" id="5929889">inProgress</span><span class="op" id="5929899">)</span>&nbsp;<span class="op" id="5929901">&amp;&amp;</span>&nbsp;<span class="ident" id="5929904">dec</span><span class="op" id="5929907">.</span><span class="ident" id="5929908">compatibleType</span><span class="op" id="5929922">(</span><span class="ident" id="5929923">t</span><span class="op" id="5929924">.</span><span class="ident" id="5929925">Elem</span><span class="op" id="5929929">(</span><span class="op" id="5929930">)</span><span class="op" id="5929931">,</span>&nbsp;<span class="ident" id="5929933">MapType</span><span class="op" id="5929940">.</span><span class="ident" id="5929941">Elem</span><span class="op" id="5929945">,</span>&nbsp;<span class="ident" id="5929947">inProgress</span><span class="op" id="5929957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929960">case</span>&nbsp;<span class="ident" id="5929965">reflect</span><span class="op" id="5929972">.</span><span class="ident" id="5929973">Slice</span><span class="op" id="5929978">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5929982">//&nbsp;Is&nbsp;it&nbsp;an&nbsp;array&nbsp;of&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930012">if</span>&nbsp;<span class="ident" id="5930015">t</span><span class="op" id="5930016">.</span><span class="ident" id="5930017">Elem</span><span class="op" id="5930021">(</span><span class="op" id="5930022">)</span><span class="op" id="5930023">.</span><span class="ident" id="5930024">Kind</span><span class="op" id="5930028">(</span><span class="op" id="5930029">)</span>&nbsp;<span class="op" id="5930031">==</span>&nbsp;<span class="ident" id="5930034">reflect</span><span class="op" id="5930041">.</span><span class="ident" id="5930042">Uint8</span>&nbsp;<span class="op" id="5930048">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930053">return</span>&nbsp;<span class="ident" id="5930060">fw</span>&nbsp;<span class="op" id="5930063">==</span>&nbsp;<span class="ident" id="5930066">tBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5930079">//&nbsp;Extract&nbsp;and&nbsp;compare&nbsp;element&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930119">var</span>&nbsp;<span class="ident" id="5930123">sw</span>&nbsp;<span class="op" id="5930126">*</span><span class="ident" id="5930127">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930139">if</span>&nbsp;<span class="ident" id="5930142">tt</span><span class="op" id="5930144">,</span>&nbsp;<span class="ident" id="5930146">ok</span>&nbsp;<span class="op" id="5930149">:=</span>&nbsp;<span class="ident" id="5930152">builtinIdToType</span><span class="op" id="5930167">[</span><span class="ident" id="5930168">fw</span><span class="op" id="5930170">]</span><span class="op" id="5930171">;</span>&nbsp;<span class="ident" id="5930173">ok</span>&nbsp;<span class="op" id="5930176">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930181">sw</span><span class="op" id="5930183">,</span>&nbsp;<span class="ident" id="5930185">_</span>&nbsp;<span class="op" id="5930187">=</span>&nbsp;<span class="ident" id="5930189">tt</span><span class="op" id="5930191">.</span><span class="op" id="5930192">(</span><span class="op" id="5930193">*</span><span class="ident" id="5930194">sliceType</span><span class="op" id="5930203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930207">}</span>&nbsp;<span class="keyword" id="5930209">else</span>&nbsp;<span class="keyword" id="5930214">if</span>&nbsp;<span class="ident" id="5930217">wire</span>&nbsp;<span class="op" id="5930222">!=</span>&nbsp;<span class="ident" id="5930225">nil</span>&nbsp;<span class="op" id="5930229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930234">sw</span>&nbsp;<span class="op" id="5930237">=</span>&nbsp;<span class="ident" id="5930239">wire</span><span class="op" id="5930243">.</span><span class="ident" id="5930244">SliceT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930257">elem</span>&nbsp;<span class="op" id="5930262">:=</span>&nbsp;<span class="ident" id="5930265">userType</span><span class="op" id="5930273">(</span><span class="ident" id="5930274">t</span><span class="op" id="5930275">.</span><span class="ident" id="5930276">Elem</span><span class="op" id="5930280">(</span><span class="op" id="5930281">)</span><span class="op" id="5930282">)</span><span class="op" id="5930283">.</span><span class="ident" id="5930284">base</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930291">return</span>&nbsp;<span class="ident" id="5930298">sw</span>&nbsp;<span class="op" id="5930301">!=</span>&nbsp;<span class="ident" id="5930304">nil</span>&nbsp;<span class="op" id="5930308">&amp;&amp;</span>&nbsp;<span class="ident" id="5930311">dec</span><span class="op" id="5930314">.</span><span class="ident" id="5930315">compatibleType</span><span class="op" id="5930329">(</span><span class="ident" id="5930330">elem</span><span class="op" id="5930334">,</span>&nbsp;<span class="ident" id="5930336">sw</span><span class="op" id="5930338">.</span><span class="ident" id="5930339">Elem</span><span class="op" id="5930343">,</span>&nbsp;<span class="ident" id="5930345">inProgress</span><span class="op" id="5930355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930358">case</span>&nbsp;<span class="ident" id="5930363">reflect</span><span class="op" id="5930370">.</span><span class="ident" id="5930371">Struct</span><span class="op" id="5930377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930381">return</span>&nbsp;<span class="builtintype" id="5930388">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930394">}</span><br>
<span class="lineno"></span><span class="op" id="5930396">}</span><br>
<span class="lineno">1000</span><br>
<span class="lineno"></span><span class="comment" id="5930399">//&nbsp;typeString&nbsp;returns&nbsp;a&nbsp;human-readable&nbsp;description&nbsp;of&nbsp;the&nbsp;type&nbsp;identified&nbsp;by&nbsp;remoteId.</span><br>
<span class="lineno"></span><span class="keyword" id="5930486">func</span>&nbsp;<span class="op" id="5930491">(</span><span class="ident" id="5930492">dec</span>&nbsp;<span class="op" id="5930496">*</span><span class="ident" id="5930497">Decoder</span><span class="op" id="5930504">)</span>&nbsp;<span class="ident" id="5930506">typeString</span><span class="op" id="5930516">(</span><span class="ident" id="5930517">remoteId</span>&nbsp;<span class="ident" id="5930526">typeId</span><span class="op" id="5930532">)</span>&nbsp;<span class="builtintype" id="5930534">string</span>&nbsp;<span class="op" id="5930541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930544">if</span>&nbsp;<span class="ident" id="5930547">t</span>&nbsp;<span class="op" id="5930549">:=</span>&nbsp;<span class="ident" id="5930552">idToType</span><span class="op" id="5930560">[</span><span class="ident" id="5930561">remoteId</span><span class="op" id="5930569">]</span><span class="op" id="5930570">;</span>&nbsp;<span class="ident" id="5930572">t</span>&nbsp;<span class="op" id="5930574">!=</span>&nbsp;<span class="ident" id="5930577">nil</span>&nbsp;<span class="op" id="5930581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5930585">//&nbsp;globally&nbsp;known&nbsp;type.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930611">return</span>&nbsp;<span class="ident" id="5930618">t</span><span class="op" id="5930619">.</span><span class="builtintype" id="5930620">string</span><span class="op" id="5930626">(</span><span class="op" id="5930627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930633">return</span>&nbsp;<span class="ident" id="5930640">dec</span><span class="op" id="5930643">.</span><span class="ident" id="5930644">wireType</span><span class="op" id="5930652">[</span><span class="ident" id="5930653">remoteId</span><span class="op" id="5930661">]</span><span class="op" id="5930662">.</span><span class="builtintype" id="5930663">string</span><span class="op" id="5930669">(</span><span class="op" id="5930670">)</span><br>
<span class="lineno"></span><span class="op" id="5930672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1010</span><span class="comment" id="5930675">//&nbsp;compileSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value,&nbsp;including</span><br>
<span class="lineno"></span><span class="comment" id="5930764">//&nbsp;GobDecoders.</span><br>
<span class="lineno"></span><span class="keyword" id="5930780">func</span>&nbsp;<span class="op" id="5930785">(</span><span class="ident" id="5930786">dec</span>&nbsp;<span class="op" id="5930790">*</span><span class="ident" id="5930791">Decoder</span><span class="op" id="5930798">)</span>&nbsp;<span class="ident" id="5930800">compileSingle</span><span class="op" id="5930813">(</span><span class="ident" id="5930814">remoteId</span>&nbsp;<span class="ident" id="5930823">typeId</span><span class="op" id="5930829">,</span>&nbsp;<span class="ident" id="5930831">ut</span>&nbsp;<span class="op" id="5930834">*</span><span class="ident" id="5930835">userTypeInfo</span><span class="op" id="5930847">)</span>&nbsp;<span class="op" id="5930849">(</span><span class="ident" id="5930850">engine</span>&nbsp;<span class="op" id="5930857">*</span><span class="ident" id="5930858">decEngine</span><span class="op" id="5930867">,</span>&nbsp;<span class="ident" id="5930869">err</span>&nbsp;<span class="builtintype" id="5930873">error</span><span class="op" id="5930878">)</span>&nbsp;<span class="op" id="5930880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930883">rt</span>&nbsp;<span class="op" id="5930886">:=</span>&nbsp;<span class="ident" id="5930889">ut</span><span class="op" id="5930891">.</span><span class="ident" id="5930892">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930898">engine</span>&nbsp;<span class="op" id="5930905">=</span>&nbsp;<span class="builtinfunc" id="5930907">new</span><span class="op" id="5930910">(</span><span class="ident" id="5930911">decEngine</span><span class="op" id="5930920">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930923">engine</span><span class="op" id="5930929">.</span><span class="ident" id="5930930">instr</span>&nbsp;<span class="op" id="5930936">=</span>&nbsp;<span class="builtinfunc" id="5930938">make</span><span class="op" id="5930942">(</span><span class="op" id="5930943">[</span><span class="op" id="5930944">]</span><span class="ident" id="5930945">decInstr</span><span class="op" id="5930953">,</span>&nbsp;<span class="num" id="5930955">1</span><span class="op" id="5930956">)</span>&nbsp;<span class="comment" id="5930958">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930971">name</span>&nbsp;<span class="op" id="5930976">:=</span>&nbsp;<span class="ident" id="5930979">rt</span><span class="op" id="5930981">.</span><span class="ident" id="5930982">String</span><span class="op" id="5930988">(</span><span class="op" id="5930989">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5931006">//&nbsp;best&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5931025">if</span>&nbsp;<span class="op" id="5931028">!</span><span class="ident" id="5931029">dec</span><span class="op" id="5931032">.</span><span class="ident" id="5931033">compatibleType</span><span class="op" id="5931047">(</span><span class="ident" id="5931048">rt</span><span class="op" id="5931050">,</span>&nbsp;<span class="ident" id="5931052">remoteId</span><span class="op" id="5931060">,</span>&nbsp;<span class="builtinfunc" id="5931062">make</span><span class="op" id="5931066">(</span><span class="keyword" id="5931067">map</span><span class="op" id="5931070">[</span><span class="ident" id="5931071">reflect</span><span class="op" id="5931078">.</span><span class="ident" id="5931079">Type</span><span class="op" id="5931083">]</span><span class="ident" id="5931084">typeId</span><span class="op" id="5931090">)</span><span class="op" id="5931091">)</span>&nbsp;<span class="op" id="5931093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931097">remoteType</span>&nbsp;<span class="op" id="5931108">:=</span>&nbsp;<span class="ident" id="5931111">dec</span><span class="op" id="5931114">.</span><span class="ident" id="5931115">typeString</span><span class="op" id="5931125">(</span><span class="ident" id="5931126">remoteId</span><span class="op" id="5931134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5931138">//&nbsp;Common&nbsp;confusing&nbsp;case:&nbsp;local&nbsp;interface&nbsp;type,&nbsp;remote&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5931210">if</span>&nbsp;<span class="ident" id="5931213">ut</span><span class="op" id="5931215">.</span><span class="ident" id="5931216">base</span><span class="op" id="5931220">.</span><span class="ident" id="5931221">Kind</span><span class="op" id="5931225">(</span><span class="op" id="5931226">)</span>&nbsp;<span class="op" id="5931228">==</span>&nbsp;<span class="ident" id="5931231">reflect</span><span class="op" id="5931238">.</span><span class="ident" id="5931239">Interface</span>&nbsp;<span class="op" id="5931249">&amp;&amp;</span>&nbsp;<span class="ident" id="5931252">remoteId</span>&nbsp;<span class="op" id="5931261">!=</span>&nbsp;<span class="ident" id="5931264">tInterface</span>&nbsp;<span class="op" id="5931275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5931280">return</span>&nbsp;<span class="ident" id="5931287">nil</span><span class="op" id="5931290">,</span>&nbsp;<span class="ident" id="5931292">errors</span><span class="op" id="5931298">.</span><span class="ident" id="5931299">New</span><span class="op" id="5931302">(</span><span class="string" id="5931303">&#34;gob:&nbsp;local&nbsp;interface&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5931332">+</span>&nbsp;<span class="ident" id="5931334">name</span>&nbsp;<span class="op" id="5931339">+</span>&nbsp;<span class="string" id="5931341">&#34;&nbsp;can&nbsp;only&nbsp;be&nbsp;decoded&nbsp;from&nbsp;remote&nbsp;interface&nbsp;type;&nbsp;received&nbsp;concrete&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5931416">+</span>&nbsp;<span class="ident" id="5931418">remoteType</span><span class="op" id="5931428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5931432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5931436">return</span>&nbsp;<span class="ident" id="5931443">nil</span><span class="op" id="5931446">,</span>&nbsp;<span class="ident" id="5931448">errors</span><span class="op" id="5931454">.</span><span class="ident" id="5931455">New</span><span class="op" id="5931458">(</span><span class="string" id="5931459">&#34;gob:&nbsp;decoding&nbsp;into&nbsp;local&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5931492">+</span>&nbsp;<span class="ident" id="5931494">name</span>&nbsp;<span class="op" id="5931499">+</span>&nbsp;<span class="string" id="5931501">&#34;,&nbsp;received&nbsp;remote&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5931527">+</span>&nbsp;<span class="ident" id="5931529">remoteType</span><span class="op" id="5931539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5931542">}</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931545">op</span>&nbsp;<span class="op" id="5931548">:=</span>&nbsp;<span class="ident" id="5931551">dec</span><span class="op" id="5931554">.</span><span class="ident" id="5931555">decOpFor</span><span class="op" id="5931563">(</span><span class="ident" id="5931564">remoteId</span><span class="op" id="5931572">,</span>&nbsp;<span class="ident" id="5931574">rt</span><span class="op" id="5931576">,</span>&nbsp;<span class="ident" id="5931578">name</span><span class="op" id="5931582">,</span>&nbsp;<span class="builtinfunc" id="5931584">make</span><span class="op" id="5931588">(</span><span class="keyword" id="5931589">map</span><span class="op" id="5931592">[</span><span class="ident" id="5931593">reflect</span><span class="op" id="5931600">.</span><span class="ident" id="5931601">Type</span><span class="op" id="5931605">]</span><span class="op" id="5931606">*</span><span class="ident" id="5931607">decOp</span><span class="op" id="5931612">)</span><span class="op" id="5931613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931616">ovfl</span>&nbsp;<span class="op" id="5931621">:=</span>&nbsp;<span class="ident" id="5931624">errors</span><span class="op" id="5931630">.</span><span class="ident" id="5931631">New</span><span class="op" id="5931634">(</span><span class="string" id="5931635">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="5931649">+</span>&nbsp;<span class="ident" id="5931651">name</span>&nbsp;<span class="op" id="5931656">+</span>&nbsp;<span class="string" id="5931658">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="5931674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931677">engine</span><span class="op" id="5931683">.</span><span class="ident" id="5931684">instr</span><span class="op" id="5931689">[</span><span class="ident" id="5931690">singletonField</span><span class="op" id="5931704">]</span>&nbsp;<span class="op" id="5931706">=</span>&nbsp;<span class="ident" id="5931708">decInstr</span><span class="op" id="5931716">{</span><span class="op" id="5931717">*</span><span class="ident" id="5931718">op</span><span class="op" id="5931720">,</span>&nbsp;<span class="ident" id="5931722">singletonField</span><span class="op" id="5931736">,</span>&nbsp;<span class="ident" id="5931738">nil</span><span class="op" id="5931741">,</span>&nbsp;<span class="ident" id="5931743">ovfl</span><span class="op" id="5931747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931750">engine</span><span class="op" id="5931756">.</span><span class="ident" id="5931757">numInstr</span>&nbsp;<span class="op" id="5931766">=</span>&nbsp;<span class="num" id="5931768">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5931771">return</span><br>
<span class="lineno">1030</span><span class="op" id="5931778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5931781">//&nbsp;compileIgnoreSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value&nbsp;that&nbsp;will&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5931889">func</span>&nbsp;<span class="op" id="5931894">(</span><span class="ident" id="5931895">dec</span>&nbsp;<span class="op" id="5931899">*</span><span class="ident" id="5931900">Decoder</span><span class="op" id="5931907">)</span>&nbsp;<span class="ident" id="5931909">compileIgnoreSingle</span><span class="op" id="5931928">(</span><span class="ident" id="5931929">remoteId</span>&nbsp;<span class="ident" id="5931938">typeId</span><span class="op" id="5931944">)</span>&nbsp;<span class="op" id="5931946">(</span><span class="ident" id="5931947">engine</span>&nbsp;<span class="op" id="5931954">*</span><span class="ident" id="5931955">decEngine</span><span class="op" id="5931964">,</span>&nbsp;<span class="ident" id="5931966">err</span>&nbsp;<span class="builtintype" id="5931970">error</span><span class="op" id="5931975">)</span>&nbsp;<span class="op" id="5931977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931980">engine</span>&nbsp;<span class="op" id="5931987">=</span>&nbsp;<span class="builtinfunc" id="5931989">new</span><span class="op" id="5931992">(</span><span class="ident" id="5931993">decEngine</span><span class="op" id="5932002">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932005">engine</span><span class="op" id="5932011">.</span><span class="ident" id="5932012">instr</span>&nbsp;<span class="op" id="5932018">=</span>&nbsp;<span class="builtinfunc" id="5932020">make</span><span class="op" id="5932024">(</span><span class="op" id="5932025">[</span><span class="op" id="5932026">]</span><span class="ident" id="5932027">decInstr</span><span class="op" id="5932035">,</span>&nbsp;<span class="num" id="5932037">1</span><span class="op" id="5932038">)</span>&nbsp;<span class="comment" id="5932040">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932053">op</span>&nbsp;<span class="op" id="5932056">:=</span>&nbsp;<span class="ident" id="5932059">dec</span><span class="op" id="5932062">.</span><span class="ident" id="5932063">decIgnoreOpFor</span><span class="op" id="5932077">(</span><span class="ident" id="5932078">remoteId</span><span class="op" id="5932086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932089">ovfl</span>&nbsp;<span class="op" id="5932094">:=</span>&nbsp;<span class="ident" id="5932097">overflow</span><span class="op" id="5932105">(</span><span class="ident" id="5932106">dec</span><span class="op" id="5932109">.</span><span class="ident" id="5932110">typeString</span><span class="op" id="5932120">(</span><span class="ident" id="5932121">remoteId</span><span class="op" id="5932129">)</span><span class="op" id="5932130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932133">engine</span><span class="op" id="5932139">.</span><span class="ident" id="5932140">instr</span><span class="op" id="5932145">[</span><span class="num" id="5932146">0</span><span class="op" id="5932147">]</span>&nbsp;<span class="op" id="5932149">=</span>&nbsp;<span class="ident" id="5932151">decInstr</span><span class="op" id="5932159">{</span><span class="ident" id="5932160">op</span><span class="op" id="5932162">,</span>&nbsp;<span class="num" id="5932164">0</span><span class="op" id="5932165">,</span>&nbsp;<span class="ident" id="5932167">nil</span><span class="op" id="5932170">,</span>&nbsp;<span class="ident" id="5932172">ovfl</span><span class="op" id="5932176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932179">engine</span><span class="op" id="5932185">.</span><span class="ident" id="5932186">numInstr</span>&nbsp;<span class="op" id="5932195">=</span>&nbsp;<span class="num" id="5932197">1</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932200">return</span><br>
<span class="lineno"></span><span class="op" id="5932207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5932210">//&nbsp;compileDec&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;value.&nbsp;&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;a&nbsp;struct,</span><br>
<span class="lineno"></span><span class="comment" id="5932296">//&nbsp;it&nbsp;calls&nbsp;out&nbsp;to&nbsp;compileSingle.</span><br>
<span class="lineno">1045</span><span class="keyword" id="5932330">func</span>&nbsp;<span class="op" id="5932335">(</span><span class="ident" id="5932336">dec</span>&nbsp;<span class="op" id="5932340">*</span><span class="ident" id="5932341">Decoder</span><span class="op" id="5932348">)</span>&nbsp;<span class="ident" id="5932350">compileDec</span><span class="op" id="5932360">(</span><span class="ident" id="5932361">remoteId</span>&nbsp;<span class="ident" id="5932370">typeId</span><span class="op" id="5932376">,</span>&nbsp;<span class="ident" id="5932378">ut</span>&nbsp;<span class="op" id="5932381">*</span><span class="ident" id="5932382">userTypeInfo</span><span class="op" id="5932394">)</span>&nbsp;<span class="op" id="5932396">(</span><span class="ident" id="5932397">engine</span>&nbsp;<span class="op" id="5932404">*</span><span class="ident" id="5932405">decEngine</span><span class="op" id="5932414">,</span>&nbsp;<span class="ident" id="5932416">err</span>&nbsp;<span class="builtintype" id="5932420">error</span><span class="op" id="5932425">)</span>&nbsp;<span class="op" id="5932427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932430">rt</span>&nbsp;<span class="op" id="5932433">:=</span>&nbsp;<span class="ident" id="5932436">ut</span><span class="op" id="5932438">.</span><span class="ident" id="5932439">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932445">srt</span>&nbsp;<span class="op" id="5932449">:=</span>&nbsp;<span class="ident" id="5932452">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932456">if</span>&nbsp;<span class="ident" id="5932459">srt</span><span class="op" id="5932462">.</span><span class="ident" id="5932463">Kind</span><span class="op" id="5932467">(</span><span class="op" id="5932468">)</span>&nbsp;<span class="op" id="5932470">!=</span>&nbsp;<span class="ident" id="5932473">reflect</span><span class="op" id="5932480">.</span><span class="ident" id="5932481">Struct</span>&nbsp;<span class="op" id="5932488">||</span>&nbsp;<span class="ident" id="5932491">ut</span><span class="op" id="5932493">.</span><span class="ident" id="5932494">externalDec</span>&nbsp;<span class="op" id="5932506">!=</span>&nbsp;<span class="num" id="5932509">0</span>&nbsp;<span class="op" id="5932511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932515">return</span>&nbsp;<span class="ident" id="5932522">dec</span><span class="op" id="5932525">.</span><span class="ident" id="5932526">compileSingle</span><span class="op" id="5932539">(</span><span class="ident" id="5932540">remoteId</span><span class="op" id="5932548">,</span>&nbsp;<span class="ident" id="5932550">ut</span><span class="op" id="5932552">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932558">var</span>&nbsp;<span class="ident" id="5932562">wireStruct</span>&nbsp;<span class="op" id="5932573">*</span><span class="ident" id="5932574">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5932586">//&nbsp;Builtin&nbsp;types&nbsp;can&nbsp;come&nbsp;from&nbsp;global&nbsp;pool;&nbsp;the&nbsp;rest&nbsp;must&nbsp;be&nbsp;defined&nbsp;by&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5932672">//&nbsp;Also&nbsp;we&nbsp;know&nbsp;we&#39;re&nbsp;decoding&nbsp;a&nbsp;struct&nbsp;now,&nbsp;so&nbsp;the&nbsp;client&nbsp;must&nbsp;have&nbsp;sent&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932752">if</span>&nbsp;<span class="ident" id="5932755">t</span><span class="op" id="5932756">,</span>&nbsp;<span class="ident" id="5932758">ok</span>&nbsp;<span class="op" id="5932761">:=</span>&nbsp;<span class="ident" id="5932764">builtinIdToType</span><span class="op" id="5932779">[</span><span class="ident" id="5932780">remoteId</span><span class="op" id="5932788">]</span><span class="op" id="5932789">;</span>&nbsp;<span class="ident" id="5932791">ok</span>&nbsp;<span class="op" id="5932794">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932798">wireStruct</span><span class="op" id="5932808">,</span>&nbsp;<span class="ident" id="5932810">_</span>&nbsp;<span class="op" id="5932812">=</span>&nbsp;<span class="ident" id="5932814">t</span><span class="op" id="5932815">.</span><span class="op" id="5932816">(</span><span class="op" id="5932817">*</span><span class="ident" id="5932818">structType</span><span class="op" id="5932828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932831">}</span>&nbsp;<span class="keyword" id="5932833">else</span>&nbsp;<span class="op" id="5932838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932842">wire</span>&nbsp;<span class="op" id="5932847">:=</span>&nbsp;<span class="ident" id="5932850">dec</span><span class="op" id="5932853">.</span><span class="ident" id="5932854">wireType</span><span class="op" id="5932862">[</span><span class="ident" id="5932863">remoteId</span><span class="op" id="5932871">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932875">if</span>&nbsp;<span class="ident" id="5932878">wire</span>&nbsp;<span class="op" id="5932883">==</span>&nbsp;<span class="ident" id="5932886">nil</span>&nbsp;<span class="op" id="5932890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932895">error_</span><span class="op" id="5932901">(</span><span class="ident" id="5932902">errBadType</span><span class="op" id="5932912">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932920">wireStruct</span>&nbsp;<span class="op" id="5932931">=</span>&nbsp;<span class="ident" id="5932933">wire</span><span class="op" id="5932937">.</span><span class="ident" id="5932938">StructT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932950">if</span>&nbsp;<span class="ident" id="5932953">wireStruct</span>&nbsp;<span class="op" id="5932964">==</span>&nbsp;<span class="ident" id="5932967">nil</span>&nbsp;<span class="op" id="5932971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932975">errorf</span><span class="op" id="5932981">(</span><span class="string" id="5932982">&#34;type&nbsp;mismatch&nbsp;in&nbsp;decoder:&nbsp;want&nbsp;struct&nbsp;type&nbsp;%s;&nbsp;got&nbsp;non-struct&#34;</span><span class="op" id="5933045">,</span>&nbsp;<span class="ident" id="5933047">rt</span><span class="op" id="5933049">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933055">engine</span>&nbsp;<span class="op" id="5933062">=</span>&nbsp;<span class="builtinfunc" id="5933064">new</span><span class="op" id="5933067">(</span><span class="ident" id="5933068">decEngine</span><span class="op" id="5933077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933080">engine</span><span class="op" id="5933086">.</span><span class="ident" id="5933087">instr</span>&nbsp;<span class="op" id="5933093">=</span>&nbsp;<span class="builtinfunc" id="5933095">make</span><span class="op" id="5933099">(</span><span class="op" id="5933100">[</span><span class="op" id="5933101">]</span><span class="ident" id="5933102">decInstr</span><span class="op" id="5933110">,</span>&nbsp;<span class="builtinfunc" id="5933112">len</span><span class="op" id="5933115">(</span><span class="ident" id="5933116">wireStruct</span><span class="op" id="5933126">.</span><span class="ident" id="5933127">Field</span><span class="op" id="5933132">)</span><span class="op" id="5933133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933136">seen</span>&nbsp;<span class="op" id="5933141">:=</span>&nbsp;<span class="builtinfunc" id="5933144">make</span><span class="op" id="5933148">(</span><span class="keyword" id="5933149">map</span><span class="op" id="5933152">[</span><span class="ident" id="5933153">reflect</span><span class="op" id="5933160">.</span><span class="ident" id="5933161">Type</span><span class="op" id="5933165">]</span><span class="op" id="5933166">*</span><span class="ident" id="5933167">decOp</span><span class="op" id="5933172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5933175">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;wire&nbsp;type.</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933218">for</span>&nbsp;<span class="ident" id="5933222">fieldnum</span>&nbsp;<span class="op" id="5933231">:=</span>&nbsp;<span class="num" id="5933234">0</span><span class="op" id="5933235">;</span>&nbsp;<span class="ident" id="5933237">fieldnum</span>&nbsp;<span class="op" id="5933246">&lt;</span>&nbsp;<span class="builtinfunc" id="5933248">len</span><span class="op" id="5933251">(</span><span class="ident" id="5933252">wireStruct</span><span class="op" id="5933262">.</span><span class="ident" id="5933263">Field</span><span class="op" id="5933268">)</span><span class="op" id="5933269">;</span>&nbsp;<span class="ident" id="5933271">fieldnum</span><span class="op" id="5933279">++</span>&nbsp;<span class="op" id="5933282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933286">wireField</span>&nbsp;<span class="op" id="5933296">:=</span>&nbsp;<span class="ident" id="5933299">wireStruct</span><span class="op" id="5933309">.</span><span class="ident" id="5933310">Field</span><span class="op" id="5933315">[</span><span class="ident" id="5933316">fieldnum</span><span class="op" id="5933324">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933328">if</span>&nbsp;<span class="ident" id="5933331">wireField</span><span class="op" id="5933340">.</span><span class="ident" id="5933341">Name</span>&nbsp;<span class="op" id="5933346">==</span>&nbsp;<span class="string" id="5933349">&#34;&#34;</span>&nbsp;<span class="op" id="5933352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933357">errorf</span><span class="op" id="5933363">(</span><span class="string" id="5933364">&#34;empty&nbsp;name&nbsp;for&nbsp;remote&nbsp;field&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5933404">,</span>&nbsp;<span class="ident" id="5933406">wireStruct</span><span class="op" id="5933416">.</span><span class="ident" id="5933417">Name</span><span class="op" id="5933421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933425">}</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933429">ovfl</span>&nbsp;<span class="op" id="5933434">:=</span>&nbsp;<span class="ident" id="5933437">overflow</span><span class="op" id="5933445">(</span><span class="ident" id="5933446">wireField</span><span class="op" id="5933455">.</span><span class="ident" id="5933456">Name</span><span class="op" id="5933460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5933464">//&nbsp;Find&nbsp;the&nbsp;field&nbsp;of&nbsp;the&nbsp;local&nbsp;type&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933522">localField</span><span class="op" id="5933532">,</span>&nbsp;<span class="ident" id="5933534">present</span>&nbsp;<span class="op" id="5933542">:=</span>&nbsp;<span class="ident" id="5933545">srt</span><span class="op" id="5933548">.</span><span class="ident" id="5933549">FieldByName</span><span class="op" id="5933560">(</span><span class="ident" id="5933561">wireField</span><span class="op" id="5933570">.</span><span class="ident" id="5933571">Name</span><span class="op" id="5933575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5933579">//&nbsp;TODO(r):&nbsp;anonymous&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933609">if</span>&nbsp;<span class="op" id="5933612">!</span><span class="ident" id="5933613">present</span>&nbsp;<span class="op" id="5933621">||</span>&nbsp;<span class="op" id="5933624">!</span><span class="ident" id="5933625">isExported</span><span class="op" id="5933635">(</span><span class="ident" id="5933636">wireField</span><span class="op" id="5933645">.</span><span class="ident" id="5933646">Name</span><span class="op" id="5933650">)</span>&nbsp;<span class="op" id="5933652">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933657">op</span>&nbsp;<span class="op" id="5933660">:=</span>&nbsp;<span class="ident" id="5933663">dec</span><span class="op" id="5933666">.</span><span class="ident" id="5933667">decIgnoreOpFor</span><span class="op" id="5933681">(</span><span class="ident" id="5933682">wireField</span><span class="op" id="5933691">.</span><span class="ident" id="5933692">Id</span><span class="op" id="5933694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933699">engine</span><span class="op" id="5933705">.</span><span class="ident" id="5933706">instr</span><span class="op" id="5933711">[</span><span class="ident" id="5933712">fieldnum</span><span class="op" id="5933720">]</span>&nbsp;<span class="op" id="5933722">=</span>&nbsp;<span class="ident" id="5933724">decInstr</span><span class="op" id="5933732">{</span><span class="ident" id="5933733">op</span><span class="op" id="5933735">,</span>&nbsp;<span class="ident" id="5933737">fieldnum</span><span class="op" id="5933745">,</span>&nbsp;<span class="ident" id="5933747">nil</span><span class="op" id="5933750">,</span>&nbsp;<span class="ident" id="5933752">ovfl</span><span class="op" id="5933756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933761">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933776">if</span>&nbsp;<span class="op" id="5933779">!</span><span class="ident" id="5933780">dec</span><span class="op" id="5933783">.</span><span class="ident" id="5933784">compatibleType</span><span class="op" id="5933798">(</span><span class="ident" id="5933799">localField</span><span class="op" id="5933809">.</span><span class="ident" id="5933810">Type</span><span class="op" id="5933814">,</span>&nbsp;<span class="ident" id="5933816">wireField</span><span class="op" id="5933825">.</span><span class="ident" id="5933826">Id</span><span class="op" id="5933828">,</span>&nbsp;<span class="builtinfunc" id="5933830">make</span><span class="op" id="5933834">(</span><span class="keyword" id="5933835">map</span><span class="op" id="5933838">[</span><span class="ident" id="5933839">reflect</span><span class="op" id="5933846">.</span><span class="ident" id="5933847">Type</span><span class="op" id="5933851">]</span><span class="ident" id="5933852">typeId</span><span class="op" id="5933858">)</span><span class="op" id="5933859">)</span>&nbsp;<span class="op" id="5933861">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933866">errorf</span><span class="op" id="5933872">(</span><span class="string" id="5933873">&#34;wrong&nbsp;type&nbsp;(%s)&nbsp;for&nbsp;received&nbsp;field&nbsp;%s.%s&#34;</span><span class="op" id="5933915">,</span>&nbsp;<span class="ident" id="5933917">localField</span><span class="op" id="5933927">.</span><span class="ident" id="5933928">Type</span><span class="op" id="5933932">,</span>&nbsp;<span class="ident" id="5933934">wireStruct</span><span class="op" id="5933944">.</span><span class="ident" id="5933945">Name</span><span class="op" id="5933949">,</span>&nbsp;<span class="ident" id="5933951">wireField</span><span class="op" id="5933960">.</span><span class="ident" id="5933961">Name</span><span class="op" id="5933965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933973">op</span>&nbsp;<span class="op" id="5933976">:=</span>&nbsp;<span class="ident" id="5933979">dec</span><span class="op" id="5933982">.</span><span class="ident" id="5933983">decOpFor</span><span class="op" id="5933991">(</span><span class="ident" id="5933992">wireField</span><span class="op" id="5934001">.</span><span class="ident" id="5934002">Id</span><span class="op" id="5934004">,</span>&nbsp;<span class="ident" id="5934006">localField</span><span class="op" id="5934016">.</span><span class="ident" id="5934017">Type</span><span class="op" id="5934021">,</span>&nbsp;<span class="ident" id="5934023">localField</span><span class="op" id="5934033">.</span><span class="ident" id="5934034">Name</span><span class="op" id="5934038">,</span>&nbsp;<span class="ident" id="5934040">seen</span><span class="op" id="5934044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934048">engine</span><span class="op" id="5934054">.</span><span class="ident" id="5934055">instr</span><span class="op" id="5934060">[</span><span class="ident" id="5934061">fieldnum</span><span class="op" id="5934069">]</span>&nbsp;<span class="op" id="5934071">=</span>&nbsp;<span class="ident" id="5934073">decInstr</span><span class="op" id="5934081">{</span><span class="op" id="5934082">*</span><span class="ident" id="5934083">op</span><span class="op" id="5934085">,</span>&nbsp;<span class="ident" id="5934087">fieldnum</span><span class="op" id="5934095">,</span>&nbsp;<span class="ident" id="5934097">localField</span><span class="op" id="5934107">.</span><span class="ident" id="5934108">Index</span><span class="op" id="5934113">,</span>&nbsp;<span class="ident" id="5934115">ovfl</span><span class="op" id="5934119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934123">engine</span><span class="op" id="5934129">.</span><span class="ident" id="5934130">numInstr</span><span class="op" id="5934138">++</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934145">return</span><br>
<span class="lineno"></span><span class="op" id="5934152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5934155">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type.</span><br>
<span class="lineno">1095</span><span class="keyword" id="5934217">func</span>&nbsp;<span class="op" id="5934222">(</span><span class="ident" id="5934223">dec</span>&nbsp;<span class="op" id="5934227">*</span><span class="ident" id="5934228">Decoder</span><span class="op" id="5934235">)</span>&nbsp;<span class="ident" id="5934237">getDecEnginePtr</span><span class="op" id="5934252">(</span><span class="ident" id="5934253">remoteId</span>&nbsp;<span class="ident" id="5934262">typeId</span><span class="op" id="5934268">,</span>&nbsp;<span class="ident" id="5934270">ut</span>&nbsp;<span class="op" id="5934273">*</span><span class="ident" id="5934274">userTypeInfo</span><span class="op" id="5934286">)</span>&nbsp;<span class="op" id="5934288">(</span><span class="ident" id="5934289">enginePtr</span>&nbsp;<span class="op" id="5934299">*</span><span class="op" id="5934300">*</span><span class="ident" id="5934301">decEngine</span><span class="op" id="5934310">,</span>&nbsp;<span class="ident" id="5934312">err</span>&nbsp;<span class="builtintype" id="5934316">error</span><span class="op" id="5934321">)</span>&nbsp;<span class="op" id="5934323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934326">rt</span>&nbsp;<span class="op" id="5934329">:=</span>&nbsp;<span class="ident" id="5934332">ut</span><span class="op" id="5934334">.</span><span class="ident" id="5934335">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934341">decoderMap</span><span class="op" id="5934351">,</span>&nbsp;<span class="ident" id="5934353">ok</span>&nbsp;<span class="op" id="5934356">:=</span>&nbsp;<span class="ident" id="5934359">dec</span><span class="op" id="5934362">.</span><span class="ident" id="5934363">decoderCache</span><span class="op" id="5934375">[</span><span class="ident" id="5934376">rt</span><span class="op" id="5934378">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934381">if</span>&nbsp;<span class="op" id="5934384">!</span><span class="ident" id="5934385">ok</span>&nbsp;<span class="op" id="5934388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934392">decoderMap</span>&nbsp;<span class="op" id="5934403">=</span>&nbsp;<span class="builtinfunc" id="5934405">make</span><span class="op" id="5934409">(</span><span class="keyword" id="5934410">map</span><span class="op" id="5934413">[</span><span class="ident" id="5934414">typeId</span><span class="op" id="5934420">]</span><span class="op" id="5934421">*</span><span class="op" id="5934422">*</span><span class="ident" id="5934423">decEngine</span><span class="op" id="5934432">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934436">dec</span><span class="op" id="5934439">.</span><span class="ident" id="5934440">decoderCache</span><span class="op" id="5934452">[</span><span class="ident" id="5934453">rt</span><span class="op" id="5934455">]</span>&nbsp;<span class="op" id="5934457">=</span>&nbsp;<span class="ident" id="5934459">decoderMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934474">if</span>&nbsp;<span class="ident" id="5934477">enginePtr</span><span class="op" id="5934486">,</span>&nbsp;<span class="ident" id="5934488">ok</span>&nbsp;<span class="op" id="5934491">=</span>&nbsp;<span class="ident" id="5934493">decoderMap</span><span class="op" id="5934503">[</span><span class="ident" id="5934504">remoteId</span><span class="op" id="5934512">]</span><span class="op" id="5934513">;</span>&nbsp;<span class="op" id="5934515">!</span><span class="ident" id="5934516">ok</span>&nbsp;<span class="op" id="5934519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5934523">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934602">enginePtr</span>&nbsp;<span class="op" id="5934612">=</span>&nbsp;<span class="builtinfunc" id="5934614">new</span><span class="op" id="5934617">(</span><span class="op" id="5934618">*</span><span class="ident" id="5934619">decEngine</span><span class="op" id="5934628">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934632">decoderMap</span><span class="op" id="5934642">[</span><span class="ident" id="5934643">remoteId</span><span class="op" id="5934651">]</span>&nbsp;<span class="op" id="5934653">=</span>&nbsp;<span class="ident" id="5934655">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934667">*</span><span class="ident" id="5934668">enginePtr</span><span class="op" id="5934677">,</span>&nbsp;<span class="ident" id="5934679">err</span>&nbsp;<span class="op" id="5934683">=</span>&nbsp;<span class="ident" id="5934685">dec</span><span class="op" id="5934688">.</span><span class="ident" id="5934689">compileDec</span><span class="op" id="5934699">(</span><span class="ident" id="5934700">remoteId</span><span class="op" id="5934708">,</span>&nbsp;<span class="ident" id="5934710">ut</span><span class="op" id="5934712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934716">if</span>&nbsp;<span class="ident" id="5934719">err</span>&nbsp;<span class="op" id="5934723">!=</span>&nbsp;<span class="ident" id="5934726">nil</span>&nbsp;<span class="op" id="5934730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5934735">delete</span><span class="op" id="5934741">(</span><span class="ident" id="5934742">decoderMap</span><span class="op" id="5934752">,</span>&nbsp;<span class="ident" id="5934754">remoteId</span><span class="op" id="5934762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934766">}</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934772">return</span><br>
<span class="lineno"></span><span class="op" id="5934779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5934782">//&nbsp;emptyStruct&nbsp;is&nbsp;the&nbsp;type&nbsp;we&nbsp;compile&nbsp;into&nbsp;when&nbsp;ignoring&nbsp;a&nbsp;struct&nbsp;value.</span><br>
<span class="lineno">1115</span><span class="keyword" id="5934855">type</span>&nbsp;<span class="ident" id="5934860">emptyStruct</span>&nbsp;<span class="keyword" id="5934872">struct</span><span class="op" id="5934878">{</span><span class="op" id="5934879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5934882">var</span>&nbsp;<span class="ident" id="5934886">emptyStructType</span>&nbsp;<span class="op" id="5934902">=</span>&nbsp;<span class="ident" id="5934904">reflect</span><span class="op" id="5934911">.</span><span class="ident" id="5934912">TypeOf</span><span class="op" id="5934918">(</span><span class="ident" id="5934919">emptyStruct</span><span class="op" id="5934930">{</span><span class="op" id="5934931">}</span><span class="op" id="5934932">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5934935">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type&nbsp;when&nbsp;the&nbsp;value&nbsp;is&nbsp;to&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno">1120</span><span class="keyword" id="5935031">func</span>&nbsp;<span class="op" id="5935036">(</span><span class="ident" id="5935037">dec</span>&nbsp;<span class="op" id="5935041">*</span><span class="ident" id="5935042">Decoder</span><span class="op" id="5935049">)</span>&nbsp;<span class="ident" id="5935051">getIgnoreEnginePtr</span><span class="op" id="5935069">(</span><span class="ident" id="5935070">wireId</span>&nbsp;<span class="ident" id="5935077">typeId</span><span class="op" id="5935083">)</span>&nbsp;<span class="op" id="5935085">(</span><span class="ident" id="5935086">enginePtr</span>&nbsp;<span class="op" id="5935096">*</span><span class="op" id="5935097">*</span><span class="ident" id="5935098">decEngine</span><span class="op" id="5935107">,</span>&nbsp;<span class="ident" id="5935109">err</span>&nbsp;<span class="builtintype" id="5935113">error</span><span class="op" id="5935118">)</span>&nbsp;<span class="op" id="5935120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935123">var</span>&nbsp;<span class="ident" id="5935127">ok</span>&nbsp;<span class="builtintype" id="5935130">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935136">if</span>&nbsp;<span class="ident" id="5935139">enginePtr</span><span class="op" id="5935148">,</span>&nbsp;<span class="ident" id="5935150">ok</span>&nbsp;<span class="op" id="5935153">=</span>&nbsp;<span class="ident" id="5935155">dec</span><span class="op" id="5935158">.</span><span class="ident" id="5935159">ignorerCache</span><span class="op" id="5935171">[</span><span class="ident" id="5935172">wireId</span><span class="op" id="5935178">]</span><span class="op" id="5935179">;</span>&nbsp;<span class="op" id="5935181">!</span><span class="ident" id="5935182">ok</span>&nbsp;<span class="op" id="5935185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5935189">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935268">enginePtr</span>&nbsp;<span class="op" id="5935278">=</span>&nbsp;<span class="builtinfunc" id="5935280">new</span><span class="op" id="5935283">(</span><span class="op" id="5935284">*</span><span class="ident" id="5935285">decEngine</span><span class="op" id="5935294">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935298">dec</span><span class="op" id="5935301">.</span><span class="ident" id="5935302">ignorerCache</span><span class="op" id="5935314">[</span><span class="ident" id="5935315">wireId</span><span class="op" id="5935321">]</span>&nbsp;<span class="op" id="5935323">=</span>&nbsp;<span class="ident" id="5935325">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935337">wire</span>&nbsp;<span class="op" id="5935342">:=</span>&nbsp;<span class="ident" id="5935345">dec</span><span class="op" id="5935348">.</span><span class="ident" id="5935349">wireType</span><span class="op" id="5935357">[</span><span class="ident" id="5935358">wireId</span><span class="op" id="5935364">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935368">if</span>&nbsp;<span class="ident" id="5935371">wire</span>&nbsp;<span class="op" id="5935376">!=</span>&nbsp;<span class="ident" id="5935379">nil</span>&nbsp;<span class="op" id="5935383">&amp;&amp;</span>&nbsp;<span class="ident" id="5935386">wire</span><span class="op" id="5935390">.</span><span class="ident" id="5935391">StructT</span>&nbsp;<span class="op" id="5935399">!=</span>&nbsp;<span class="ident" id="5935402">nil</span>&nbsp;<span class="op" id="5935406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5935411">*</span><span class="ident" id="5935412">enginePtr</span><span class="op" id="5935421">,</span>&nbsp;<span class="ident" id="5935423">err</span>&nbsp;<span class="op" id="5935427">=</span>&nbsp;<span class="ident" id="5935429">dec</span><span class="op" id="5935432">.</span><span class="ident" id="5935433">compileDec</span><span class="op" id="5935443">(</span><span class="ident" id="5935444">wireId</span><span class="op" id="5935450">,</span>&nbsp;<span class="ident" id="5935452">userType</span><span class="op" id="5935460">(</span><span class="ident" id="5935461">emptyStructType</span><span class="op" id="5935476">)</span><span class="op" id="5935477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5935481">}</span>&nbsp;<span class="keyword" id="5935483">else</span>&nbsp;<span class="op" id="5935488">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5935493">*</span><span class="ident" id="5935494">enginePtr</span><span class="op" id="5935503">,</span>&nbsp;<span class="ident" id="5935505">err</span>&nbsp;<span class="op" id="5935509">=</span>&nbsp;<span class="ident" id="5935511">dec</span><span class="op" id="5935514">.</span><span class="ident" id="5935515">compileIgnoreSingle</span><span class="op" id="5935534">(</span><span class="ident" id="5935535">wireId</span><span class="op" id="5935541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5935545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935549">if</span>&nbsp;<span class="ident" id="5935552">err</span>&nbsp;<span class="op" id="5935556">!=</span>&nbsp;<span class="ident" id="5935559">nil</span>&nbsp;<span class="op" id="5935563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5935568">delete</span><span class="op" id="5935574">(</span><span class="ident" id="5935575">dec</span><span class="op" id="5935578">.</span><span class="ident" id="5935579">ignorerCache</span><span class="op" id="5935591">,</span>&nbsp;<span class="ident" id="5935593">wireId</span><span class="op" id="5935599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5935603">}</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5935606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935609">return</span><br>
<span class="lineno"></span><span class="op" id="5935616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5935619">//&nbsp;decodeValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">1140</span><span class="keyword" id="5935703">func</span>&nbsp;<span class="op" id="5935708">(</span><span class="ident" id="5935709">dec</span>&nbsp;<span class="op" id="5935713">*</span><span class="ident" id="5935714">Decoder</span><span class="op" id="5935721">)</span>&nbsp;<span class="ident" id="5935723">decodeValue</span><span class="op" id="5935734">(</span><span class="ident" id="5935735">wireId</span>&nbsp;<span class="ident" id="5935742">typeId</span><span class="op" id="5935748">,</span>&nbsp;<span class="ident" id="5935750">value</span>&nbsp;<span class="ident" id="5935756">reflect</span><span class="op" id="5935763">.</span><span class="ident" id="5935764">Value</span><span class="op" id="5935769">)</span>&nbsp;<span class="op" id="5935771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935774">defer</span>&nbsp;<span class="ident" id="5935780">catchError</span><span class="op" id="5935790">(</span><span class="op" id="5935791">&amp;</span><span class="ident" id="5935792">dec</span><span class="op" id="5935795">.</span><span class="ident" id="5935796">err</span><span class="op" id="5935799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5935802">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;nil,&nbsp;it&nbsp;means&nbsp;we&nbsp;should&nbsp;just&nbsp;ignore&nbsp;this&nbsp;item.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935869">if</span>&nbsp;<span class="op" id="5935872">!</span><span class="ident" id="5935873">value</span><span class="op" id="5935878">.</span><span class="ident" id="5935879">IsValid</span><span class="op" id="5935886">(</span><span class="op" id="5935887">)</span>&nbsp;<span class="op" id="5935889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935893">dec</span><span class="op" id="5935896">.</span><span class="ident" id="5935897">decodeIgnoredValue</span><span class="op" id="5935915">(</span><span class="ident" id="5935916">wireId</span><span class="op" id="5935922">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935926">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5935934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5935937">//&nbsp;Dereference&nbsp;down&nbsp;to&nbsp;the&nbsp;underlying&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935982">ut</span>&nbsp;<span class="op" id="5935985">:=</span>&nbsp;<span class="ident" id="5935988">userType</span><span class="op" id="5935996">(</span><span class="ident" id="5935997">value</span><span class="op" id="5936002">.</span><span class="ident" id="5936003">Type</span><span class="op" id="5936007">(</span><span class="op" id="5936008">)</span><span class="op" id="5936009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936012">base</span>&nbsp;<span class="op" id="5936017">:=</span>&nbsp;<span class="ident" id="5936020">ut</span><span class="op" id="5936022">.</span><span class="ident" id="5936023">base</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936029">var</span>&nbsp;<span class="ident" id="5936033">enginePtr</span>&nbsp;<span class="op" id="5936043">*</span><span class="op" id="5936044">*</span><span class="ident" id="5936045">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936056">enginePtr</span><span class="op" id="5936065">,</span>&nbsp;<span class="ident" id="5936067">dec</span><span class="op" id="5936070">.</span><span class="ident" id="5936071">err</span>&nbsp;<span class="op" id="5936075">=</span>&nbsp;<span class="ident" id="5936077">dec</span><span class="op" id="5936080">.</span><span class="ident" id="5936081">getDecEnginePtr</span><span class="op" id="5936096">(</span><span class="ident" id="5936097">wireId</span><span class="op" id="5936103">,</span>&nbsp;<span class="ident" id="5936105">ut</span><span class="op" id="5936107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936110">if</span>&nbsp;<span class="ident" id="5936113">dec</span><span class="op" id="5936116">.</span><span class="ident" id="5936117">err</span>&nbsp;<span class="op" id="5936121">!=</span>&nbsp;<span class="ident" id="5936124">nil</span>&nbsp;<span class="op" id="5936128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936132">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5936140">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936143">value</span>&nbsp;<span class="op" id="5936149">=</span>&nbsp;<span class="ident" id="5936151">decAlloc</span><span class="op" id="5936159">(</span><span class="ident" id="5936160">value</span><span class="op" id="5936165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936168">engine</span>&nbsp;<span class="op" id="5936175">:=</span>&nbsp;<span class="op" id="5936178">*</span><span class="ident" id="5936179">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936190">if</span>&nbsp;<span class="ident" id="5936193">st</span>&nbsp;<span class="op" id="5936196">:=</span>&nbsp;<span class="ident" id="5936199">base</span><span class="op" id="5936203">;</span>&nbsp;<span class="ident" id="5936205">st</span><span class="op" id="5936207">.</span><span class="ident" id="5936208">Kind</span><span class="op" id="5936212">(</span><span class="op" id="5936213">)</span>&nbsp;<span class="op" id="5936215">==</span>&nbsp;<span class="ident" id="5936218">reflect</span><span class="op" id="5936225">.</span><span class="ident" id="5936226">Struct</span>&nbsp;<span class="op" id="5936233">&amp;&amp;</span>&nbsp;<span class="ident" id="5936236">ut</span><span class="op" id="5936238">.</span><span class="ident" id="5936239">externalDec</span>&nbsp;<span class="op" id="5936251">==</span>&nbsp;<span class="num" id="5936254">0</span>&nbsp;<span class="op" id="5936256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936260">if</span>&nbsp;<span class="ident" id="5936263">engine</span><span class="op" id="5936269">.</span><span class="ident" id="5936270">numInstr</span>&nbsp;<span class="op" id="5936279">==</span>&nbsp;<span class="num" id="5936282">0</span>&nbsp;<span class="op" id="5936284">&amp;&amp;</span>&nbsp;<span class="ident" id="5936287">st</span><span class="op" id="5936289">.</span><span class="ident" id="5936290">NumField</span><span class="op" id="5936298">(</span><span class="op" id="5936299">)</span>&nbsp;<span class="op" id="5936301">&gt;</span>&nbsp;<span class="num" id="5936303">0</span>&nbsp;<span class="op" id="5936305">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936311">dec</span><span class="op" id="5936314">.</span><span class="ident" id="5936315">wireType</span><span class="op" id="5936323">[</span><span class="ident" id="5936324">wireId</span><span class="op" id="5936330">]</span>&nbsp;<span class="op" id="5936332">!=</span>&nbsp;<span class="ident" id="5936335">nil</span>&nbsp;<span class="op" id="5936339">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5936342">len</span><span class="op" id="5936345">(</span><span class="ident" id="5936346">dec</span><span class="op" id="5936349">.</span><span class="ident" id="5936350">wireType</span><span class="op" id="5936358">[</span><span class="ident" id="5936359">wireId</span><span class="op" id="5936365">]</span><span class="op" id="5936366">.</span><span class="ident" id="5936367">StructT</span><span class="op" id="5936374">.</span><span class="ident" id="5936375">Field</span><span class="op" id="5936380">)</span>&nbsp;<span class="op" id="5936382">&gt;</span>&nbsp;<span class="num" id="5936384">0</span>&nbsp;<span class="op" id="5936386">{</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936391">name</span>&nbsp;<span class="op" id="5936396">:=</span>&nbsp;<span class="ident" id="5936399">base</span><span class="op" id="5936403">.</span><span class="ident" id="5936404">Name</span><span class="op" id="5936408">(</span><span class="op" id="5936409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936414">errorf</span><span class="op" id="5936420">(</span><span class="string" id="5936421">&#34;type&nbsp;mismatch:&nbsp;no&nbsp;fields&nbsp;matched&nbsp;compiling&nbsp;decoder&nbsp;for&nbsp;%s&#34;</span><span class="op" id="5936480">,</span>&nbsp;<span class="ident" id="5936482">name</span><span class="op" id="5936486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5936490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936494">dec</span><span class="op" id="5936497">.</span><span class="ident" id="5936498">decodeStruct</span><span class="op" id="5936510">(</span><span class="ident" id="5936511">engine</span><span class="op" id="5936517">,</span>&nbsp;<span class="ident" id="5936519">ut</span><span class="op" id="5936521">,</span>&nbsp;<span class="ident" id="5936523">value</span><span class="op" id="5936528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5936531">}</span>&nbsp;<span class="keyword" id="5936533">else</span>&nbsp;<span class="op" id="5936538">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936542">dec</span><span class="op" id="5936545">.</span><span class="ident" id="5936546">decodeSingle</span><span class="op" id="5936558">(</span><span class="ident" id="5936559">engine</span><span class="op" id="5936565">,</span>&nbsp;<span class="ident" id="5936567">ut</span><span class="op" id="5936569">,</span>&nbsp;<span class="ident" id="5936571">value</span><span class="op" id="5936576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5936579">}</span><br>
<span class="lineno"></span><span class="op" id="5936581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5936584">//&nbsp;decodeIgnoredValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;and&nbsp;discards&nbsp;it.</span><br>
<span class="lineno">1170</span><span class="keyword" id="5936690">func</span>&nbsp;<span class="op" id="5936695">(</span><span class="ident" id="5936696">dec</span>&nbsp;<span class="op" id="5936700">*</span><span class="ident" id="5936701">Decoder</span><span class="op" id="5936708">)</span>&nbsp;<span class="ident" id="5936710">decodeIgnoredValue</span><span class="op" id="5936728">(</span><span class="ident" id="5936729">wireId</span>&nbsp;<span class="ident" id="5936736">typeId</span><span class="op" id="5936742">)</span>&nbsp;<span class="op" id="5936744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936747">var</span>&nbsp;<span class="ident" id="5936751">enginePtr</span>&nbsp;<span class="op" id="5936761">*</span><span class="op" id="5936762">*</span><span class="ident" id="5936763">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936774">enginePtr</span><span class="op" id="5936783">,</span>&nbsp;<span class="ident" id="5936785">dec</span><span class="op" id="5936788">.</span><span class="ident" id="5936789">err</span>&nbsp;<span class="op" id="5936793">=</span>&nbsp;<span class="ident" id="5936795">dec</span><span class="op" id="5936798">.</span><span class="ident" id="5936799">getIgnoreEnginePtr</span><span class="op" id="5936817">(</span><span class="ident" id="5936818">wireId</span><span class="op" id="5936824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936827">if</span>&nbsp;<span class="ident" id="5936830">dec</span><span class="op" id="5936833">.</span><span class="ident" id="5936834">err</span>&nbsp;<span class="op" id="5936838">!=</span>&nbsp;<span class="ident" id="5936841">nil</span>&nbsp;<span class="op" id="5936845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936849">return</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5936857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936860">wire</span>&nbsp;<span class="op" id="5936865">:=</span>&nbsp;<span class="ident" id="5936868">dec</span><span class="op" id="5936871">.</span><span class="ident" id="5936872">wireType</span><span class="op" id="5936880">[</span><span class="ident" id="5936881">wireId</span><span class="op" id="5936887">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936890">if</span>&nbsp;<span class="ident" id="5936893">wire</span>&nbsp;<span class="op" id="5936898">!=</span>&nbsp;<span class="ident" id="5936901">nil</span>&nbsp;<span class="op" id="5936905">&amp;&amp;</span>&nbsp;<span class="ident" id="5936908">wire</span><span class="op" id="5936912">.</span><span class="ident" id="5936913">StructT</span>&nbsp;<span class="op" id="5936921">!=</span>&nbsp;<span class="ident" id="5936924">nil</span>&nbsp;<span class="op" id="5936928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936932">dec</span><span class="op" id="5936935">.</span><span class="ident" id="5936936">ignoreStruct</span><span class="op" id="5936948">(</span><span class="op" id="5936949">*</span><span class="ident" id="5936950">enginePtr</span><span class="op" id="5936959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5936962">}</span>&nbsp;<span class="keyword" id="5936964">else</span>&nbsp;<span class="op" id="5936969">{</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936973">dec</span><span class="op" id="5936976">.</span><span class="ident" id="5936977">ignoreSingle</span><span class="op" id="5936989">(</span><span class="op" id="5936990">*</span><span class="ident" id="5936991">enginePtr</span><span class="op" id="5937000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937003">}</span><br>
<span class="lineno"></span><span class="op" id="5937005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5937008">func</span>&nbsp;<span class="ident" id="5937013">init</span><span class="op" id="5937017">(</span><span class="op" id="5937018">)</span>&nbsp;<span class="op" id="5937020">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937023">var</span>&nbsp;<span class="ident" id="5937027">iop</span><span class="op" id="5937030">,</span>&nbsp;<span class="ident" id="5937032">uop</span>&nbsp;<span class="ident" id="5937036">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937043">switch</span>&nbsp;<span class="ident" id="5937050">reflect</span><span class="op" id="5937057">.</span><span class="ident" id="5937058">TypeOf</span><span class="op" id="5937064">(</span><span class="builtintype" id="5937065">int</span><span class="op" id="5937068">(</span><span class="num" id="5937069">0</span><span class="op" id="5937070">)</span><span class="op" id="5937071">)</span><span class="op" id="5937072">.</span><span class="ident" id="5937073">Bits</span><span class="op" id="5937077">(</span><span class="op" id="5937078">)</span>&nbsp;<span class="op" id="5937080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937083">case</span>&nbsp;<span class="num" id="5937088">32</span><span class="op" id="5937090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937094">iop</span>&nbsp;<span class="op" id="5937098">=</span>&nbsp;<span class="ident" id="5937100">decInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937111">uop</span>&nbsp;<span class="op" id="5937115">=</span>&nbsp;<span class="ident" id="5937117">decUint32</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937128">case</span>&nbsp;<span class="num" id="5937133">64</span><span class="op" id="5937135">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937139">iop</span>&nbsp;<span class="op" id="5937143">=</span>&nbsp;<span class="ident" id="5937145">decInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937156">uop</span>&nbsp;<span class="op" id="5937160">=</span>&nbsp;<span class="ident" id="5937162">decUint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937173">default</span><span class="op" id="5937180">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5937184">panic</span><span class="op" id="5937189">(</span><span class="string" id="5937190">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;int/uint&#34;</span><span class="op" id="5937221">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937227">decOpTable</span><span class="op" id="5937237">[</span><span class="ident" id="5937238">reflect</span><span class="op" id="5937245">.</span><span class="ident" id="5937246">Int</span><span class="op" id="5937249">]</span>&nbsp;<span class="op" id="5937251">=</span>&nbsp;<span class="ident" id="5937253">iop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937258">decOpTable</span><span class="op" id="5937268">[</span><span class="ident" id="5937269">reflect</span><span class="op" id="5937276">.</span><span class="ident" id="5937277">Uint</span><span class="op" id="5937281">]</span>&nbsp;<span class="op" id="5937283">=</span>&nbsp;<span class="ident" id="5937285">uop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5937291">//&nbsp;Finally&nbsp;uintptr</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937311">switch</span>&nbsp;<span class="ident" id="5937318">reflect</span><span class="op" id="5937325">.</span><span class="ident" id="5937326">TypeOf</span><span class="op" id="5937332">(</span><span class="builtintype" id="5937333">uintptr</span><span class="op" id="5937340">(</span><span class="num" id="5937341">0</span><span class="op" id="5937342">)</span><span class="op" id="5937343">)</span><span class="op" id="5937344">.</span><span class="ident" id="5937345">Bits</span><span class="op" id="5937349">(</span><span class="op" id="5937350">)</span>&nbsp;<span class="op" id="5937352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937355">case</span>&nbsp;<span class="num" id="5937360">32</span><span class="op" id="5937362">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937366">uop</span>&nbsp;<span class="op" id="5937370">=</span>&nbsp;<span class="ident" id="5937372">decUint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937383">case</span>&nbsp;<span class="num" id="5937388">64</span><span class="op" id="5937390">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937394">uop</span>&nbsp;<span class="op" id="5937398">=</span>&nbsp;<span class="ident" id="5937400">decUint64</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937411">default</span><span class="op" id="5937418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5937422">panic</span><span class="op" id="5937427">(</span><span class="string" id="5937428">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;uintptr&#34;</span><span class="op" id="5937458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937464">decOpTable</span><span class="op" id="5937474">[</span><span class="ident" id="5937475">reflect</span><span class="op" id="5937482">.</span><span class="ident" id="5937483">Uintptr</span><span class="op" id="5937490">]</span>&nbsp;<span class="op" id="5937492">=</span>&nbsp;<span class="ident" id="5937494">uop</span><br>
<span class="lineno"></span><span class="op" id="5937498">}</span><br>
<span class="lineno">1210</span><br>
<span class="lineno"></span><span class="comment" id="5937501">//&nbsp;Gob&nbsp;depends&nbsp;on&nbsp;being&nbsp;able&nbsp;to&nbsp;take&nbsp;the&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="5937550">//&nbsp;of&nbsp;zeroed&nbsp;Values&nbsp;it&nbsp;creates,&nbsp;so&nbsp;use&nbsp;this&nbsp;wrapper&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="5937610">//&nbsp;of&nbsp;the&nbsp;standard&nbsp;reflect.Zero.</span><br>
<span class="lineno"></span><span class="comment" id="5937643">//&nbsp;Each&nbsp;call&nbsp;allocates&nbsp;once.</span><br>
<span class="lineno">1215</span><span class="keyword" id="5937672">func</span>&nbsp;<span class="ident" id="5937677">allocValue</span><span class="op" id="5937687">(</span><span class="ident" id="5937688">t</span>&nbsp;<span class="ident" id="5937690">reflect</span><span class="op" id="5937697">.</span><span class="ident" id="5937698">Type</span><span class="op" id="5937702">)</span>&nbsp;<span class="ident" id="5937704">reflect</span><span class="op" id="5937711">.</span><span class="ident" id="5937712">Value</span>&nbsp;<span class="op" id="5937718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937721">return</span>&nbsp;<span class="ident" id="5937728">reflect</span><span class="op" id="5937735">.</span><span class="ident" id="5937736">New</span><span class="op" id="5937739">(</span><span class="ident" id="5937740">t</span><span class="op" id="5937741">)</span><span class="op" id="5937742">.</span><span class="ident" id="5937743">Elem</span><span class="op" id="5937747">(</span><span class="op" id="5937748">)</span><br>
<span class="lineno"></span><span class="op" id="5937750">}</span>
</div>
</body>
</html>
