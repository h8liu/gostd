<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4071212">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4071267">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4071321">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4071372">package</span>&nbsp;<span class="ident" id="4071380">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4071386">import</span>&nbsp;<span class="op" id="4071393">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4071396">&#34;crypto/x509/pkix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4071416">&#34;encoding/asn1&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4071433">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4071443">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="4071449">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4071452">//&nbsp;pkcs8&nbsp;reflects&nbsp;an&nbsp;ASN.1,&nbsp;PKCS#8&nbsp;PrivateKey.&nbsp;See</span><br>
<span class="lineno">15</span><span class="comment" id="4071503">//&nbsp;ftp://ftp.rsasecurity.com/pub/pkcs/pkcs-8/pkcs-8v1_2.asn</span><br>
<span class="lineno"></span><span class="comment" id="4071563">//&nbsp;and&nbsp;RFC5208.</span><br>
<span class="lineno"></span><span class="keyword" id="4071579">type</span>&nbsp;<span class="ident" id="4071584">pkcs8</span>&nbsp;<span class="keyword" id="4071590">struct</span>&nbsp;<span class="op" id="4071597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071600">Version</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4071611">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071616">Algo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4071627">pkix</span><span class="op" id="4071631">.</span><span class="ident" id="4071632">AlgorithmIdentifier</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071653">PrivateKey</span>&nbsp;<span class="op" id="4071664">[</span><span class="op" id="4071665">]</span><span class="builtintype" id="4071666">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4071672">//&nbsp;optional&nbsp;attributes&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="op" id="4071704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4071707">//&nbsp;ParsePKCS8PrivateKey&nbsp;parses&nbsp;an&nbsp;unencrypted,&nbsp;PKCS#8&nbsp;private&nbsp;key.&nbsp;See</span><br>
<span class="lineno">25</span><span class="comment" id="4071778">//&nbsp;http://www.rsa.com/rsalabs/node.asp?id=2130&nbsp;and&nbsp;RFC5208.</span><br>
<span class="lineno"></span><span class="keyword" id="4071838">func</span>&nbsp;<span class="ident" id="4071843">ParsePKCS8PrivateKey</span><span class="op" id="4071863">(</span><span class="ident" id="4071864">der</span>&nbsp;<span class="op" id="4071868">[</span><span class="op" id="4071869">]</span><span class="builtintype" id="4071870">byte</span><span class="op" id="4071874">)</span>&nbsp;<span class="op" id="4071876">(</span><span class="ident" id="4071877">key</span>&nbsp;<span class="keyword" id="4071881">interface</span><span class="op" id="4071890">{</span><span class="op" id="4071891">}</span><span class="op" id="4071892">,</span>&nbsp;<span class="ident" id="4071894">err</span>&nbsp;<span class="builtintype" id="4071898">error</span><span class="op" id="4071903">)</span>&nbsp;<span class="op" id="4071905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4071908">var</span>&nbsp;<span class="ident" id="4071912">privKey</span>&nbsp;<span class="ident" id="4071920">pkcs8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4071927">if</span>&nbsp;<span class="ident" id="4071930">_</span><span class="op" id="4071931">,</span>&nbsp;<span class="ident" id="4071933">err</span>&nbsp;<span class="op" id="4071937">:=</span>&nbsp;<span class="ident" id="4071940">asn1</span><span class="op" id="4071944">.</span><span class="ident" id="4071945">Unmarshal</span><span class="op" id="4071954">(</span><span class="ident" id="4071955">der</span><span class="op" id="4071958">,</span>&nbsp;<span class="op" id="4071960">&amp;</span><span class="ident" id="4071961">privKey</span><span class="op" id="4071968">)</span><span class="op" id="4071969">;</span>&nbsp;<span class="ident" id="4071971">err</span>&nbsp;<span class="op" id="4071975">!=</span>&nbsp;<span class="ident" id="4071978">nil</span>&nbsp;<span class="op" id="4071982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4071986">return</span>&nbsp;<span class="ident" id="4071993">nil</span><span class="op" id="4071996">,</span>&nbsp;<span class="ident" id="4071998">err</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072006">switch</span>&nbsp;<span class="op" id="4072013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072016">case</span>&nbsp;<span class="ident" id="4072021">privKey</span><span class="op" id="4072028">.</span><span class="ident" id="4072029">Algo</span><span class="op" id="4072033">.</span><span class="ident" id="4072034">Algorithm</span><span class="op" id="4072043">.</span><span class="ident" id="4072044">Equal</span><span class="op" id="4072049">(</span><span class="ident" id="4072050">oidPublicKeyRSA</span><span class="op" id="4072065">)</span><span class="op" id="4072066">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072070">key</span><span class="op" id="4072073">,</span>&nbsp;<span class="ident" id="4072075">err</span>&nbsp;<span class="op" id="4072079">=</span>&nbsp;<span class="ident" id="4072081">ParsePKCS1PrivateKey</span><span class="op" id="4072101">(</span><span class="ident" id="4072102">privKey</span><span class="op" id="4072109">.</span><span class="ident" id="4072110">PrivateKey</span><span class="op" id="4072120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072124">if</span>&nbsp;<span class="ident" id="4072127">err</span>&nbsp;<span class="op" id="4072131">!=</span>&nbsp;<span class="ident" id="4072134">nil</span>&nbsp;<span class="op" id="4072138">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072143">return</span>&nbsp;<span class="ident" id="4072150">nil</span><span class="op" id="4072153">,</span>&nbsp;<span class="ident" id="4072155">errors</span><span class="op" id="4072161">.</span><span class="ident" id="4072162">New</span><span class="op" id="4072165">(</span><span class="string" id="4072166">&#34;x509:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;RSA&nbsp;private&nbsp;key&nbsp;embedded&nbsp;in&nbsp;PKCS#8:&nbsp;&#34;</span>&nbsp;<span class="op" id="4072227">+</span>&nbsp;<span class="ident" id="4072229">err</span><span class="op" id="4072232">.</span><span class="ident" id="4072233">Error</span><span class="op" id="4072238">(</span><span class="op" id="4072239">)</span><span class="op" id="4072240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072248">return</span>&nbsp;<span class="ident" id="4072255">key</span><span class="op" id="4072258">,</span>&nbsp;<span class="ident" id="4072260">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072266">case</span>&nbsp;<span class="ident" id="4072271">privKey</span><span class="op" id="4072278">.</span><span class="ident" id="4072279">Algo</span><span class="op" id="4072283">.</span><span class="ident" id="4072284">Algorithm</span><span class="op" id="4072293">.</span><span class="ident" id="4072294">Equal</span><span class="op" id="4072299">(</span><span class="ident" id="4072300">oidPublicKeyECDSA</span><span class="op" id="4072317">)</span><span class="op" id="4072318">:</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072322">bytes</span>&nbsp;<span class="op" id="4072328">:=</span>&nbsp;<span class="ident" id="4072331">privKey</span><span class="op" id="4072338">.</span><span class="ident" id="4072339">Algo</span><span class="op" id="4072343">.</span><span class="ident" id="4072344">Parameters</span><span class="op" id="4072354">.</span><span class="ident" id="4072355">FullBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072367">namedCurveOID</span>&nbsp;<span class="op" id="4072381">:=</span>&nbsp;<span class="builtinfunc" id="4072384">new</span><span class="op" id="4072387">(</span><span class="ident" id="4072388">asn1</span><span class="op" id="4072392">.</span><span class="ident" id="4072393">ObjectIdentifier</span><span class="op" id="4072409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072413">if</span>&nbsp;<span class="ident" id="4072416">_</span><span class="op" id="4072417">,</span>&nbsp;<span class="ident" id="4072419">err</span>&nbsp;<span class="op" id="4072423">:=</span>&nbsp;<span class="ident" id="4072426">asn1</span><span class="op" id="4072430">.</span><span class="ident" id="4072431">Unmarshal</span><span class="op" id="4072440">(</span><span class="ident" id="4072441">bytes</span><span class="op" id="4072446">,</span>&nbsp;<span class="ident" id="4072448">namedCurveOID</span><span class="op" id="4072461">)</span><span class="op" id="4072462">;</span>&nbsp;<span class="ident" id="4072464">err</span>&nbsp;<span class="op" id="4072468">!=</span>&nbsp;<span class="ident" id="4072471">nil</span>&nbsp;<span class="op" id="4072475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072480">namedCurveOID</span>&nbsp;<span class="op" id="4072494">=</span>&nbsp;<span class="ident" id="4072496">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072502">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072506">key</span><span class="op" id="4072509">,</span>&nbsp;<span class="ident" id="4072511">err</span>&nbsp;<span class="op" id="4072515">=</span>&nbsp;<span class="ident" id="4072517">parseECPrivateKey</span><span class="op" id="4072534">(</span><span class="ident" id="4072535">namedCurveOID</span><span class="op" id="4072548">,</span>&nbsp;<span class="ident" id="4072550">privKey</span><span class="op" id="4072557">.</span><span class="ident" id="4072558">PrivateKey</span><span class="op" id="4072568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072572">if</span>&nbsp;<span class="ident" id="4072575">err</span>&nbsp;<span class="op" id="4072579">!=</span>&nbsp;<span class="ident" id="4072582">nil</span>&nbsp;<span class="op" id="4072586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072591">return</span>&nbsp;<span class="ident" id="4072598">nil</span><span class="op" id="4072601">,</span>&nbsp;<span class="ident" id="4072603">errors</span><span class="op" id="4072609">.</span><span class="ident" id="4072610">New</span><span class="op" id="4072613">(</span><span class="string" id="4072614">&#34;x509:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;EC&nbsp;private&nbsp;key&nbsp;embedded&nbsp;in&nbsp;PKCS#8:&nbsp;&#34;</span>&nbsp;<span class="op" id="4072674">+</span>&nbsp;<span class="ident" id="4072676">err</span><span class="op" id="4072679">.</span><span class="ident" id="4072680">Error</span><span class="op" id="4072685">(</span><span class="op" id="4072686">)</span><span class="op" id="4072687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072695">return</span>&nbsp;<span class="ident" id="4072702">key</span><span class="op" id="4072705">,</span>&nbsp;<span class="ident" id="4072707">nil</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072713">default</span><span class="op" id="4072720">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072724">return</span>&nbsp;<span class="ident" id="4072731">nil</span><span class="op" id="4072734">,</span>&nbsp;<span class="ident" id="4072736">fmt</span><span class="op" id="4072739">.</span><span class="ident" id="4072740">Errorf</span><span class="op" id="4072746">(</span><span class="string" id="4072747">&#34;x509:&nbsp;PKCS#8&nbsp;wrapping&nbsp;contained&nbsp;private&nbsp;key&nbsp;with&nbsp;unknown&nbsp;algorithm:&nbsp;%v&#34;</span><span class="op" id="4072819">,</span>&nbsp;<span class="ident" id="4072821">privKey</span><span class="op" id="4072828">.</span><span class="ident" id="4072829">Algo</span><span class="op" id="4072833">.</span><span class="ident" id="4072834">Algorithm</span><span class="op" id="4072843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072846">}</span><br>
<span class="lineno"></span><span class="op" id="4072848">}</span>
</div>
</body>
</html>
